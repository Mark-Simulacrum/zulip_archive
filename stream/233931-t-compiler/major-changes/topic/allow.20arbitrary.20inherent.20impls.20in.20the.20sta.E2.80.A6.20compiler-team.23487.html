<html>
<head><meta charset="utf-8"><title>allow arbitrary inherent impls in the sta… compiler-team#487 · t-compiler/major changes · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/index.html">t-compiler/major changes</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/allow.20arbitrary.20inherent.20impls.20in.20the.20sta.E2.80.A6.20compiler-team.23487.html">allow arbitrary inherent impls in the sta… compiler-team#487</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="273614755"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/allow%20arbitrary%20inherent%20impls%20in%20the%20sta%E2%80%A6%20compiler-team%23487/near/273614755" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> triagebot <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/allow.20arbitrary.20inherent.20impls.20in.20the.20sta.E2.80.A6.20compiler-team.23487.html#273614755">(Mar 01 2022 at 09:56)</a>:</h4>
<p>A new proposal has been announced: <a href="https://github.com/rust-lang/compiler-team/issues/487">allow arbitrary inherent impls in the standard library #487</a>. It will be announced at the next meeting to try and draw attention to it, but usually MCPs are not discussed during triage meetings. If you think this would benefit from discussion amongst the team, consider proposing a design meeting.</p>



<a name="273615696"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/allow%20arbitrary%20inherent%20impls%20in%20the%20sta%E2%80%A6%20compiler-team%23487/near/273615696" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/allow.20arbitrary.20inherent.20impls.20in.20the.20sta.E2.80.A6.20compiler-team.23487.html#273615696">(Mar 01 2022 at 10:04)</a>:</h4>
<p>See <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/simplifying.20lang.20items.20to.20one.20per.20type">https://rust-lang.zulipchat.com/#narrow/stream/182449-t-compiler.2Fhelp/topic/simplifying.20lang.20items.20to.20one.20per.20type</a> for an extensive prior discussion about this.</p>



<a name="273615772"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/allow%20arbitrary%20inherent%20impls%20in%20the%20sta%E2%80%A6%20compiler-team%23487/near/273615772" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/allow.20arbitrary.20inherent.20impls.20in.20the.20sta.E2.80.A6.20compiler-team.23487.html#273615772">(Mar 01 2022 at 10:05)</a>:</h4>
<p>I don't think this can be (easily) implemented without a perf regression as I stated in that thread.</p>



<a name="273616298"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/allow%20arbitrary%20inherent%20impls%20in%20the%20sta%E2%80%A6%20compiler-team%23487/near/273616298" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/allow.20arbitrary.20inherent.20impls.20in.20the.20sta.E2.80.A6.20compiler-team.23487.html#273616298">(Mar 01 2022 at 10:09)</a>:</h4>
<p>I think that thread is missing context. Where did the discussion start?</p>



<a name="273616443"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/allow%20arbitrary%20inherent%20impls%20in%20the%20sta%E2%80%A6%20compiler-team%23487/near/273616443" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/allow.20arbitrary.20inherent.20impls.20in.20the.20sta.E2.80.A6.20compiler-team.23487.html#273616443">(Mar 01 2022 at 10:10)</a>:</h4>
<p>If we accumulate the inherent impls through <code>staged_api</code> (which could also double as the feature gate for arbitrary inherent impls), then I'd think that at worst we should get a bit of metadata overhead in libstd and liballoc. Or did you mean a different perf problem than "need to look everywhere for inherent impls now"</p>



<a name="273616607"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/allow%20arbitrary%20inherent%20impls%20in%20the%20sta%E2%80%A6%20compiler-team%23487/near/273616607" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/allow.20arbitrary.20inherent.20impls.20in.20the.20sta.E2.80.A6.20compiler-team.23487.html#273616607">(Mar 01 2022 at 10:11)</a>:</h4>
<p>right, it started somewher in <a href="#narrow/stream/213817-t-lang/topic/Implementation.20Specific.20Behaviour">https://rust-lang.zulipchat.com/#narrow/stream/213817-t-lang/topic/Implementation.20Specific.20Behaviour</a> I believe</p>



<a name="273616745"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/allow%20arbitrary%20inherent%20impls%20in%20the%20sta%E2%80%A6%20compiler-team%23487/near/273616745" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/allow.20arbitrary.20inherent.20impls.20in.20the.20sta.E2.80.A6.20compiler-team.23487.html#273616745">(Mar 01 2022 at 10:12)</a>:</h4>
<p>yeah, that and need to look for foreign inherent impls for every type, not just a fixed set.</p>



<a name="273617265"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/allow%20arbitrary%20inherent%20impls%20in%20the%20sta%E2%80%A6%20compiler-team%23487/near/273617265" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/allow.20arbitrary.20inherent.20impls.20in.20the.20sta.E2.80.A6.20compiler-team.23487.html#273617265">(Mar 01 2022 at 10:17)</a>:</h4>
<p>Oh right. That, too. I guess we'll let lcnr do perf experiments then?</p>



<a name="273618344"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/allow%20arbitrary%20inherent%20impls%20in%20the%20sta%E2%80%A6%20compiler-team%23487/near/273618344" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> triagebot <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/allow.20arbitrary.20inherent.20impls.20in.20the.20sta.E2.80.A6.20compiler-team.23487.html#273618344">(Mar 01 2022 at 10:25)</a>:</h4>
<p><span class="user-group-mention" data-user-group-id="492">@T-compiler</span>: Proposal <a href="https://github.com/rust-lang/compiler-team/issues/487#issuecomment-1055273925">#487</a> has been seconded, and will be approved in 10 days if no objections are raised.</p>



<a name="273618810"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/allow%20arbitrary%20inherent%20impls%20in%20the%20sta%E2%80%A6%20compiler-team%23487/near/273618810" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/allow.20arbitrary.20inherent.20impls.20in.20the.20sta.E2.80.A6.20compiler-team.23487.html#273618810">(Mar 01 2022 at 10:29)</a>:</h4>
<p>I seconded it. There's nothing inherently speaking against it, and I believe that we may be able to actually change the current infrastructure that requires per-builtin-type logic to something generic that is equally performant</p>



<a name="273634318"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/allow%20arbitrary%20inherent%20impls%20in%20the%20sta%E2%80%A6%20compiler-team%23487/near/273634318" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vadim Petrochenkov <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/allow.20arbitrary.20inherent.20impls.20in.20the.20sta.E2.80.A6.20compiler-team.23487.html#273634318">(Mar 01 2022 at 12:45)</a>:</h4>
<p>I'm interested in seeing this prototyped first so we can see the end result.<br>
It may end up worse than the current situation.</p>



<a name="273634463"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/allow%20arbitrary%20inherent%20impls%20in%20the%20sta%E2%80%A6%20compiler-team%23487/near/273634463" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vadim Petrochenkov <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/allow.20arbitrary.20inherent.20impls.20in.20the.20sta.E2.80.A6.20compiler-team.23487.html#273634463">(Mar 01 2022 at 12:46)</a>:</h4>
<p>For example, a number of places in the compiler rely on inherent impl types having <code>DefId</code>s.</p>



<a name="273634645"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/allow%20arbitrary%20inherent%20impls%20in%20the%20sta%E2%80%A6%20compiler-team%23487/near/273634645" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vadim Petrochenkov <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/allow.20arbitrary.20inherent.20impls.20in.20the.20sta.E2.80.A6.20compiler-team.23487.html#273634645">(Mar 01 2022 at 12:48)</a>:</h4>
<p>So you either have to remove this reliance, or give def-ids to primitive types by declaring them in libcore, for example, which may be a larger hackery than the status quo.</p>



<a name="275341984"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/allow%20arbitrary%20inherent%20impls%20in%20the%20sta%E2%80%A6%20compiler-team%23487/near/275341984" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> triagebot <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/allow.20arbitrary.20inherent.20impls.20in.20the.20sta.E2.80.A6.20compiler-team.23487.html#275341984">(Mar 15 2022 at 08:29)</a>:</h4>
<p>This proposal has been accepted: <a href="https://github.com/rust-lang/compiler-team/issues/487">#487</a>.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>