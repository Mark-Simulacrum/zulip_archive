<html>
<head><meta charset="utf-8"><title>`-Dwarnings` to cover all warnings compiler-team#473 · t-compiler/major changes · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/index.html">t-compiler/major changes</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/.60-Dwarnings.60.20to.20cover.20all.20warnings.20compiler-team.23473.html">`-Dwarnings` to cover all warnings compiler-team#473</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="262876072"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/%60-Dwarnings%60%20to%20cover%20all%20warnings%20compiler-team%23473/near/262876072" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> triagebot <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/.60-Dwarnings.60.20to.20cover.20all.20warnings.20compiler-team.23473.html#262876072">(Nov 27 2021 at 14:31)</a>:</h4>
<p>A new proposal has been announced: <a href="https://github.com/rust-lang/compiler-team/issues/473"><code>-Dwarnings</code> to cover all warnings #473</a>. It will be announced at the next meeting to try and draw attention to it, but usually MCPs are not discussed during triage meetings. If you think this would benefit from discussion amongst the team, consider proposing a design meeting.</p>



<a name="262876269"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/%60-Dwarnings%60%20to%20cover%20all%20warnings%20compiler-team%23473/near/262876269" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/.60-Dwarnings.60.20to.20cover.20all.20warnings.20compiler-team.23473.html#262876269">(Nov 27 2021 at 14:34)</a>:</h4>
<p>to be clear, "all warnings" means "not just lint warnings"; right now <code>deny(warnings)</code> only applies to lints and not to code using <code>sess.warn()</code></p>



<a name="262876349"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/%60-Dwarnings%60%20to%20cover%20all%20warnings%20compiler-team%23473/near/262876349" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/.60-Dwarnings.60.20to.20cover.20all.20warnings.20compiler-team.23473.html#262876349">(Nov 27 2021 at 14:36)</a>:</h4>
<p>(and not all warnings <em>can</em> be lints, the one <span class="user-mention" data-user-id="382653">@ojeda</span> mentions in the MCP happens during argument parsing before the tcx is created)</p>



<a name="262876820"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/%60-Dwarnings%60%20to%20cover%20all%20warnings%20compiler-team%23473/near/262876820" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/.60-Dwarnings.60.20to.20cover.20all.20warnings.20compiler-team.23473.html#262876820">(Nov 27 2021 at 14:48)</a>:</h4>
<p>Marking <code>-Dwarnings</code> cover all warnings may break cargo when using <code>-Dwarnings</code> in combination with compiling for targets not supporting dylibs, as in the case that one or more of the specified crate types are not supported by the target, but not all, rustc will give a warning like <code>dropping unsupported crate type `dylib` for target `wasm32-unknown-unknown` </code>. Cargo checks before compiling which crate types are supported and how they are named by running something like <code>rustc - --print file-names --crate-name ____ --crate-type rlib --crate-type dylib ...</code>.</p>
<p>There are also other cases where warnings are really warnings not caused by the code itself, like when failing to remove an old incremental cache due to eg permission errors.</p>



<a name="262876949"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/%60-Dwarnings%60%20to%20cover%20all%20warnings%20compiler-team%23473/near/262876949" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/.60-Dwarnings.60.20to.20cover.20all.20warnings.20compiler-team.23473.html#262876949">(Nov 27 2021 at 14:50)</a>:</h4>
<blockquote>
<p>Cargo checks before compiling which crate types are supported and how they are named by running something like rustc - --print file-names --crate-name ____ --crate-type rlib --crate-type dylib ....</p>
</blockquote>
<p>cargo shouldn't be passing -Dwarnings for that though, right? I don't think it even applies RUSTFLAGS to the <code>--print file-names</code> command.</p>
<blockquote>
<p>like when failing to remove an old incremental cache due to eg permission errors.</p>
</blockquote>
<p>maybe we could mark these as "internal" errors somehow, and omit them from the deny?</p>



<a name="262877413"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/%60-Dwarnings%60%20to%20cover%20all%20warnings%20compiler-team%23473/near/262877413" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/.60-Dwarnings.60.20to.20cover.20all.20warnings.20compiler-team.23473.html#262877413">(Nov 27 2021 at 15:01)</a>:</h4>
<p>these are the unconditional warnings I see currently: <a href="https://www.toptal.com/developers/hastebin/uxoteretil.rust">https://www.toptal.com/developers/hastebin/uxoteretil.rust</a></p>



<a name="262878126"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/%60-Dwarnings%60%20to%20cover%20all%20warnings%20compiler-team%23473/near/262878126" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/.60-Dwarnings.60.20to.20cover.20all.20warnings.20compiler-team.23473.html#262878126">(Nov 27 2021 at 15:16)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/233931-t-compiler.2Fmajor-changes/topic/.60-Dwarnings.60.20to.20cover.20all.20warnings.20compiler-team.23473/near/262876949">said</a>:</p>
<blockquote>
<p>cargo shouldn't be passing -Dwarnings for that though, right? I don't think it even applies RUSTFLAGS to the <code>--print file-names</code> command.</p>
</blockquote>
<p>The <code>--print</code> command gets RUSTFLAGS (needed for some things like <code>cfg</code> checking).</p>



<a name="262879307"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/%60-Dwarnings%60%20to%20cover%20all%20warnings%20compiler-team%23473/near/262879307" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/.60-Dwarnings.60.20to.20cover.20all.20warnings.20compiler-team.23473.html#262879307">(Nov 27 2021 at 15:46)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/233931-t-compiler.2Fmajor-changes/topic/.60-Dwarnings.60.20to.20cover.20all.20warnings.20compiler-team.23473/near/262876349">said</a>:</p>
<blockquote>
<p>(and not all warnings <em>can</em> be lints, the one <span class="user-mention silent" data-user-id="382653">ojeda</span> mentions in the MCP happens during argument parsing before the tcx is created)</p>
</blockquote>
<p>I thought we had a delayed linting scheme for this very reason?</p>



<a name="262879586"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/%60-Dwarnings%60%20to%20cover%20all%20warnings%20compiler-team%23473/near/262879586" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/.60-Dwarnings.60.20to.20cover.20all.20warnings.20compiler-team.23473.html#262879586">(Nov 27 2021 at 15:53)</a>:</h4>
<p>I believe the delayed linting scheme still needs a <code>ParseSess</code>. Creating a <code>ParseSess</code> needs argument parsing first AFAIK.</p>



<a name="262898230"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/%60-Dwarnings%60%20to%20cover%20all%20warnings%20compiler-team%23473/near/262898230" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/.60-Dwarnings.60.20to.20cover.20all.20warnings.20compiler-team.23473.html#262898230">(Nov 27 2021 at 23:19)</a>:</h4>
<p>There are two reasons to output warnings outside of the linting infrastructure – when it is intended that these warnings do not cause things to break (regardless of the flags specified) and when the linting infrastructure is not available at the location.</p>



<a name="262898232"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/%60-Dwarnings%60%20to%20cover%20all%20warnings%20compiler-team%23473/near/262898232" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/.60-Dwarnings.60.20to.20cover.20all.20warnings.20compiler-team.23473.html#262898232">(Nov 27 2021 at 23:20)</a>:</h4>
<p>in my experience latter is significantly more rare than the first.</p>



<a name="262898441"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/%60-Dwarnings%60%20to%20cover%20all%20warnings%20compiler-team%23473/near/262898441" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/.60-Dwarnings.60.20to.20cover.20all.20warnings.20compiler-team.23473.html#262898441">(Nov 27 2021 at 23:25)</a>:</h4>
<p>in particular json target schema is unstable and recently has been wildly so. Having it to deal with the concerns of people potentially using custom target jsons in combination of <code>-Dwarnings</code> would be pretty bad.</p>



<a name="262898443"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/%60-Dwarnings%60%20to%20cover%20all%20warnings%20compiler-team%23473/near/262898443" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/.60-Dwarnings.60.20to.20cover.20all.20warnings.20compiler-team.23473.html#262898443">(Nov 27 2021 at 23:25)</a>:</h4>
<p>at that point I would instead look at spending the work necessary to stabilize target customization.</p>



<a name="262898485"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/%60-Dwarnings%60%20to%20cover%20all%20warnings%20compiler-team%23473/near/262898485" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/.60-Dwarnings.60.20to.20cover.20all.20warnings.20compiler-team.23473.html#262898485">(Nov 27 2021 at 23:26)</a>:</h4>
<p>(JSON is probably not quite it)</p>



<a name="262914230"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/%60-Dwarnings%60%20to%20cover%20all%20warnings%20compiler-team%23473/near/262914230" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/.60-Dwarnings.60.20to.20cover.20all.20warnings.20compiler-team.23473.html#262914230">(Nov 28 2021 at 07:07)</a>:</h4>
<p>Yeah, I would love to see codegen options for half of what only target specs can currently do.</p>



<a name="263135570"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/%60-Dwarnings%60%20to%20cover%20all%20warnings%20compiler-team%23473/near/263135570" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ojeda <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/.60-Dwarnings.60.20to.20cover.20all.20warnings.20compiler-team.23473.html#263135570">(Nov 30 2021 at 12:16)</a>:</h4>
<p>Yes, please!</p>



<a name="263203025"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/%60-Dwarnings%60%20to%20cover%20all%20warnings%20compiler-team%23473/near/263203025" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/.60-Dwarnings.60.20to.20cover.20all.20warnings.20compiler-team.23473.html#263203025">(Nov 30 2021 at 20:22)</a>:</h4>
<p>I would like to see target specs in terms of Rust code, honestly.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>