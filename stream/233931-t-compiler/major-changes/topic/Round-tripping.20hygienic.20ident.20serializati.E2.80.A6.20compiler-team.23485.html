<html>
<head><meta charset="utf-8"><title>Round-tripping hygienic ident serializati… compiler-team#485 · t-compiler/major changes · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/index.html">t-compiler/major changes</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Round-tripping.20hygienic.20ident.20serializati.E2.80.A6.20compiler-team.23485.html">Round-tripping hygienic ident serializati… compiler-team#485</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="272032443"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Round-tripping%20hygienic%20ident%20serializati%E2%80%A6%20compiler-team%23485/near/272032443" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> triagebot <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Round-tripping.20hygienic.20ident.20serializati.E2.80.A6.20compiler-team.23485.html#272032443">(Feb 15 2022 at 20:21)</a>:</h4>
<p>A new proposal has been announced: <a href="https://github.com/rust-lang/compiler-team/issues/485">Round-tripping hygienic ident serialization #485</a>. It will be announced at the next meeting to try and draw attention to it, but usually MCPs are not discussed during triage meetings. If you think this would benefit from discussion amongst the team, consider proposing a design meeting.</p>



<a name="272033066"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Round-tripping%20hygienic%20ident%20serializati%E2%80%A6%20compiler-team%23485/near/272033066" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Round-tripping.20hygienic.20ident.20serializati.E2.80.A6.20compiler-team.23485.html#272033066">(Feb 15 2022 at 20:26)</a>:</h4>
<p>(another semi-obvious option here would be to change nothing about the output, but add an unstable compiler parsing mode  that treats the hygiene info in comments as significant. I'll update the description to acknowledge it as an option, though its not one I prefer (seems more fragile than adding a new form of identifier)</p>



<a name="272033461"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Round-tripping%20hygienic%20ident%20serializati%E2%80%A6%20compiler-team%23485/near/272033461" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Round-tripping.20hygienic.20ident.20serializati.E2.80.A6.20compiler-team.23485.html#272033461">(Feb 15 2022 at 20:29)</a>:</h4>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span> Sounds completely sensible to me. I don't <em>think</em> our grammar currently treats <code>ident#ident#...</code> as reserves in quite the same way <code>ident#ident</code> is, but it seems feasible.</p>



<a name="272033536"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Round-tripping%20hygienic%20ident%20serializati%E2%80%A6%20compiler-team%23485/near/272033536" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Round-tripping.20hygienic.20ident.20serializati.E2.80.A6.20compiler-team.23485.html#272033536">(Feb 15 2022 at 20:30)</a>:</h4>
<p>And the ability to parse the "human" identifier out by looking right after the <code>h#</code> makes sense as well.</p>



<a name="272033555"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Round-tripping%20hygienic%20ident%20serializati%E2%80%A6%20compiler-team%23485/near/272033555" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Round-tripping.20hygienic.20ident.20serializati.E2.80.A6.20compiler-team.23485.html#272033555">(Feb 15 2022 at 20:30)</a>:</h4>
<p>I'm now trying to double check whether my understanding of the identifier encoding is correct</p>



<a name="272033622"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Round-tripping%20hygienic%20ident%20serializati%E2%80%A6%20compiler-team%23485/near/272033622" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Round-tripping.20hygienic.20ident.20serializati.E2.80.A6.20compiler-team.23485.html#272033622">(Feb 15 2022 at 20:30)</a>:</h4>
<p>but it <em>seems</em> likely that it is, given the form of the output from <code>--expanded,hygiene</code></p>



<a name="272034396"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Round-tripping%20hygienic%20ident%20serializati%E2%80%A6%20compiler-team%23485/near/272034396" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Round-tripping.20hygienic.20ident.20serializati.E2.80.A6.20compiler-team.23485.html#272034396">(Feb 15 2022 at 20:37)</a>:</h4>
<p>I like it. If we want to go a little more lightweight on the first round we could attach the hygiene info just by separating it in regular identifiers by triple underscores or sth other equally rare (funky Unicode characters here we go)</p>



<a name="272088703"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Round-tripping%20hygienic%20ident%20serializati%E2%80%A6%20compiler-team%23485/near/272088703" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Round-tripping.20hygienic.20ident.20serializati.E2.80.A6.20compiler-team.23485.html#272088703">(Feb 16 2022 at 08:59)</a>:</h4>
<p>I guess since it is unstable, then there is no expectation that the hygiene annotations have any meaning nor will be round-trippable across versions? Because I imagine we want to be able to change hygiene info at will.</p>



<a name="272101623"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Round-tripping%20hygienic%20ident%20serializati%E2%80%A6%20compiler-team%23485/near/272101623" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> triagebot <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Round-tripping.20hygienic.20ident.20serializati.E2.80.A6.20compiler-team.23485.html#272101623">(Feb 16 2022 at 11:07)</a>:</h4>
<p><span class="user-group-mention" data-user-group-id="492">@T-compiler</span>: Proposal <a href="https://github.com/rust-lang/compiler-team/issues/485#issuecomment-1041373074">#485</a> has been seconded, and will be approved in 10 days if no objections are raised.</p>



<a name="272102106"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Round-tripping%20hygienic%20ident%20serializati%E2%80%A6%20compiler-team%23485/near/272102106" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Xavier Denis <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Round-tripping.20hygienic.20ident.20serializati.E2.80.A6.20compiler-team.23485.html#272102106">(Feb 16 2022 at 11:12)</a>:</h4>
<p>Yea I imagine this is considered perma-unstable? and should not be used even in custom rustc drivers?</p>



<a name="272102610"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Round-tripping%20hygienic%20ident%20serializati%E2%80%A6%20compiler-team%23485/near/272102610" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Round-tripping.20hygienic.20ident.20serializati.E2.80.A6.20compiler-team.23485.html#272102610">(Feb 16 2022 at 11:17)</a>:</h4>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span> some context / extra motivation, FWIW: <a href="#narrow/stream/136281-t-lang.2Fwg-unsafe-code-guidelines/topic/unstable.20features.20deliberately.20unsafe.2Funsound/near/270966982">https://rust-lang.zulipchat.com/#narrow/stream/136281-t-lang.2Fwg-unsafe-code-guidelines/topic/unstable.20features.20deliberately.20unsafe.2Funsound/near/270966982</a></p>



<a name="272479089"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Round-tripping%20hygienic%20ident%20serializati%E2%80%A6%20compiler-team%23485/near/272479089" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Round-tripping.20hygienic.20ident.20serializati.E2.80.A6.20compiler-team.23485.html#272479089">(Feb 19 2022 at 00:47)</a>:</h4>
<p><span class="user-mention" data-user-id="256841">@Nick Cameron</span> I wouldn’t want to try to guarantee portability across Rust versions, at least not at this stage. Maybe that comes later, after we have macros nailed down</p>



<a name="272661856"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Round-tripping%20hygienic%20ident%20serializati%E2%80%A6%20compiler-team%23485/near/272661856" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Round-tripping.20hygienic.20ident.20serializati.E2.80.A6.20compiler-team.23485.html#272661856">(Feb 21 2022 at 09:26)</a>:</h4>
<p>I think even with macros nailed down, we probably don't want to guarantee portability across Rust versions. Seems like an unnecessary constraint on future evolution.</p>



<a name="273699055"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Round-tripping%20hygienic%20ident%20serializati%E2%80%A6%20compiler-team%23485/near/273699055" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> triagebot <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Round-tripping.20hygienic.20ident.20serializati.E2.80.A6.20compiler-team.23485.html#273699055">(Mar 01 2022 at 19:43)</a>:</h4>
<p>This proposal has been accepted: <a href="https://github.com/rust-lang/compiler-team/issues/485">#485</a>.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>