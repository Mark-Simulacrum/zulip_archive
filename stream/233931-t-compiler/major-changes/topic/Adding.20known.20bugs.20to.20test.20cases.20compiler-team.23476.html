<html>
<head><meta charset="utf-8"><title>Adding known bugs to test cases compiler-team#476 · t-compiler/major changes · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/index.html">t-compiler/major changes</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html">Adding known bugs to test cases compiler-team#476</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="266376088"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/266376088" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> triagebot <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#266376088">(Dec 29 2021 at 20:30)</a>:</h4>
<p>A new proposal has been announced: <a href="https://github.com/rust-lang/compiler-team/issues/476">Adding known bugs to test cases #476</a>. It will be announced at the next meeting to try and draw attention to it, but usually MCPs are not discussed during triage meetings. If you think this would benefit from discussion amongst the team, consider proposing a design meeting.</p>



<a name="266376175"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/266376175" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#266376175">(Dec 29 2021 at 20:31)</a>:</h4>
<p><span class="user-mention" data-user-id="451171">@Patrick Poitras</span> see this topic :)</p>



<a name="266376234"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/266376234" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Poitras <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#266376234">(Dec 29 2021 at 20:32)</a>:</h4>
<p>Thanks for that, I was looking for where it was added :P</p>



<a name="266376235"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/266376235" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#266376235">(Dec 29 2021 at 20:32)</a>:</h4>
<p>prior discussion here: <a href="#narrow/stream/122651-general/topic/Glacier.20but.20for.20non-ICE.20bugs/near/266081697">https://rust-lang.zulipchat.com/#narrow/stream/122651-general/topic/Glacier.20but.20for.20non-ICE.20bugs/near/266081697</a></p>



<a name="266376251"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/266376251" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#266376251">(Dec 29 2021 at 20:32)</a>:</h4>
<p>and here: <a href="#narrow/stream/122651-general/topic/Tests.20from.20open.20issues/near/260826162">https://rust-lang.zulipchat.com/#narrow/stream/122651-general/topic/Tests.20from.20open.20issues/near/260826162</a></p>



<a name="266376611"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/266376611" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> triagebot <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#266376611">(Dec 29 2021 at 20:38)</a>:</h4>
<p><span class="user-group-mention" data-user-group-id="492">@T-compiler</span>: Proposal <a href="https://github.com/rust-lang/compiler-team/issues/476#issuecomment-1002768519">#476</a> has been seconded, and will be approved in 10 days if no objections are raised.</p>



<a name="268706292"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/268706292" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> triagebot <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#268706292">(Jan 20 2022 at 15:12)</a>:</h4>
<p>This proposal has been accepted: <a href="https://github.com/rust-lang/compiler-team/issues/476">#476</a>.</p>



<a name="268892771"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/268892771" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#268892771">(Jan 21 2022 at 19:39)</a>:</h4>
<p><span class="user-mention" data-user-id="451171">@Patrick Poitras</span> are you still interested in helping out here? I think there a couple "initial" tasks to do here:<br>
1) Probably make a new directory under <code>src/tests/</code> (I don't even know what a good name would be; what would you call this tests - they're like the opposite of regression tests). In theory, they could just go under <code>src/test/ui</code>, but splitting them out makes it very clear that they're behavior is <em>not</em> as intended. Either that (or in addition), add a new tag for <code>compiletest</code> to note this and maybe relax rules around error annotations or something.<br>
2) Another probably good thing to do would be to try to identify places in documentation, etc. where it would be beneficial to add a short blurb that "We also appreciate adding tests to the test suite (under <code>src/test/X</code>) that don't currently pass but should."</p>
<p>Thinking about this, I think we also probably want to include bad diagnostics as test cases. Even though we don't expect them to go from fail -&gt; pass, we still might expect "fixes" to diagnostics to happen from something unrelated.</p>



<a name="268892831"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/268892831" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#268892831">(Jan 21 2022 at 19:40)</a>:</h4>
<p>(If others are interested in helping out, that's cool too)</p>



<a name="268893003"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/268893003" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#268893003">(Jan 21 2022 at 19:41)</a>:</h4>
<p>I imagine the best "default" behavior for these tests is to have tracked and blessable <code>stderr</code> output, but not require error annotations.</p>



<a name="268893119"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/268893119" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#268893119">(Jan 21 2022 at 19:42)</a>:</h4>
<p>Also, adding some kind of github label to indicate that a test exists but fails is probably good.</p>



<a name="268893316"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/268893316" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#268893316">(Jan 21 2022 at 19:44)</a>:</h4>
<p>Maybe <code>S-has-test</code> or <code>S-tracked</code></p>



<a name="268893653"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/268893653" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Poitras <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#268893653">(Jan 21 2022 at 19:46)</a>:</h4>
<p>Yes, I'm expecting to spend some of the weekend on trying to make a proof of concept.</p>



<a name="268895278"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/268895278" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> inquisitivecrystal <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#268895278">(Jan 21 2022 at 19:55)</a>:</h4>
<p>I suspect that putting a tag and maybe putting them in a different subdirectory (that is, a different subdirectory of <code>src/tests/ui</code> would be a better idea. For one thing, there might someday be a desire to add such tests to other test suites, and that gets complicated if you have to make a new suite each time.</p>



<a name="268895792"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/268895792" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Poitras <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#268895792">(Jan 21 2022 at 19:59)</a>:</h4>
<p>I'm also thinking a separate folder makes most sense here. </p>
<p>For the grunt work of actually triaging the currently existing issues to "catch-up" so to speak, I was thinking of making a guide to make it very simple for newcomers to help. This seems to require not that much foreknowledge, as for the most part the code is written in old PRs. However, it does require some modifications, as rust has changed slightly since the older PRs. (e.g. <code>dyn</code> being required)</p>



<a name="268896103"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/268896103" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Poitras <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#268896103">(Jan 21 2022 at 20:01)</a>:</h4>
<p>I think there's a lot of people who are willing (and are skilled enough) to contribute, but don't know where to start, and this could be a good stepping stone.</p>



<a name="268899649"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/268899649" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#268899649">(Jan 21 2022 at 20:35)</a>:</h4>
<p><span class="user-mention silent" data-user-id="417924">inquisitivecrystal</span> <a href="#narrow/stream/233931-t-compiler.2Fmajor-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476/near/268895278">said</a>:</p>
<blockquote>
<p>I suspect that putting a tag and maybe putting them in a different subdirectory (that is, a different subdirectory of <code>src/tests/ui</code> would be a better idea. For one thing, there might someday be a desire to add such tests to other test suites, and that gets complicated if you have to make a new suite each time.</p>
</blockquote>
<p>I don't think there's a super clear answer, but I favor just adding a tag. Putting them in a separate test directory makes it very clear that they aren't "regression" tests. On the other hand, putting "expected" behavior next to "unexpected" for similar issues (e.g. GAT tests all the the same directory) is probably good. And, as you I think hinted, maybe there we want these tests for something other than ui tests (maybe mir-opt tests, for example).</p>
<p>I think I'm more convinced that only a tag is good</p>



<a name="268899940"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/268899940" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#268899940">(Jan 21 2022 at 20:37)</a>:</h4>
<p><span class="user-mention silent" data-user-id="451171">Patrick Poitras</span> <a href="#narrow/stream/233931-t-compiler.2Fmajor-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476/near/268895792">said</a>:</p>
<blockquote>
<p>For the grunt work of actually triaging the currently existing issues to "catch-up" so to speak, I was thinking of making a guide to make it very simple for newcomers to help. This seems to require not that much foreknowledge, as for the most part the code is written in old PRs. However, it does require some modifications, as rust has changed slightly since the older PRs. (e.g. <code>dyn</code> being required)</p>
</blockquote>
<p>This is a fantastic idea. To go along, maybe adding a tag like <code>has-MCVE</code> would be good. It would be similar to <code>needs-test</code>, but not for passing tests.</p>



<a name="268905662"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/268905662" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#268905662">(Jan 21 2022 at 21:29)</a>:</h4>
<p>Not sure if this was brought up in one of the previous threads, but it hasn't been here: glacier already has a list of tests for issues that ICE the compiler</p>



<a name="268905895"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/268905895" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#268905895">(Jan 21 2022 at 21:31)</a>:</h4>
<p>Yes it was</p>



<a name="268905905"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/268905905" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#268905905">(Jan 21 2022 at 21:31)</a>:</h4>
<p>let me find the link</p>



<a name="268905971"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/268905971" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#268905971">(Jan 21 2022 at 21:31)</a>:</h4>
<p>e.g. this comment from <span class="user-mention" data-user-id="217864">@matthiaskrgr</span> <a href="#narrow/stream/122651-general/topic/Glacier.20but.20for.20non-ICE.20bugs/near/266436664">https://rust-lang.zulipchat.com/#narrow/stream/122651-general/topic/Glacier.20but.20for.20non-ICE.20bugs/near/266436664</a></p>



<a name="268907052"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/268907052" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matthiaskrgr <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#268907052">(Jan 21 2022 at 21:42)</a>:</h4>
<p>there might have been around 20 crashes that were found with within "fixed" codesnippets inside the glacier repo. :)<br>
I've made a more proactive crashfinder which runs on rustcs .rs files every 24 hours and checks for new crashes  <a href="https://github.com/matthiaskrgr/icemaker">https://github.com/matthiaskrgr/icemaker</a> / <a href="https://github.com/matthiaskrgr/arctICE">https://github.com/matthiaskrgr/arctICE</a><br>
So more test files as cannonfodder is always welcome <span aria-label="grinning face with smiling eyes" class="emoji emoji-1f601" role="img" title="grinning face with smiling eyes">:grinning_face_with_smiling_eyes:</span></p>



<a name="268908348"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/268908348" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#268908348">(Jan 21 2022 at 21:54)</a>:</h4>
<p>I actually love that. Testing with different feature flags.</p>



<a name="268908401"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/268908401" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#268908401">(Jan 21 2022 at 21:55)</a>:</h4>
<p>With the caveat that unstable feature flags are "unstable" and it may not always be "right" to file issues (yet)</p>



<a name="268908414"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/268908414" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#268908414">(Jan 21 2022 at 21:55)</a>:</h4>
<p>(Thinking in particular for <code>-Z chalk</code>)</p>



<a name="268908426"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/268908426" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#268908426">(Jan 21 2022 at 21:55)</a>:</h4>
<p>But, for stable ones, this is great.</p>



<a name="268908763"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/268908763" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matthiaskrgr <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#268908763">(Jan 21 2022 at 21:59)</a>:</h4>
<p>well the unstable ones have higher chance of yielding crashes :&gt;</p>



<a name="268909361"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/268909361" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#268909361">(Jan 21 2022 at 22:04)</a>:</h4>
<p>yeah</p>



<a name="268909556"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/268909556" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#268909556">(Jan 21 2022 at 22:06)</a>:</h4>
<p>It's a balance. I wouldn't say that <code>-Z chalk</code> is a good candidate for trying to find ICEs. But <code>feature(generic_associated_types)</code> for sure.</p>



<a name="268909762"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/268909762" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matthiaskrgr <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#268909762">(Jan 21 2022 at 22:08)</a>:</h4>
<p>so that would be something like <code>-Z allow-features=generic_associated_types</code> ?</p>



<a name="268909966"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/268909966" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#268909966">(Jan 21 2022 at 22:11)</a>:</h4>
<p>Well, I dont know how icemaker works</p>



<a name="268909979"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/268909979" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#268909979">(Jan 21 2022 at 22:11)</a>:</h4>
<p>But I would presume you just don't enable chalk, but would for GATs</p>



<a name="268910101"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/268910101" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#268910101">(Jan 21 2022 at 22:12)</a>:</h4>
<p>Thought: can that detect when a test starts to pass with e.g. NLL enabled?</p>



<a name="268910130"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/268910130" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matthiaskrgr <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#268910130">(Jan 21 2022 at 22:12)</a>:</h4>
<p>I mean I can just easily add anything that can be enabled on rustc via a --arg.  adding something like <code>feature()</code> into a file is not something that it does do</p>



<a name="268910163"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/268910163" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#268910163">(Jan 21 2022 at 22:13)</a>:</h4>
<p>Hmm</p>



<a name="268910178"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/268910178" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matthiaskrgr <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#268910178">(Jan 21 2022 at 22:13)</a>:</h4>
<p>it does not do any kind of stderr comparison, it just looks "does the output look like a crash or not"</p>



<a name="268910203"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/268910203" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#268910203">(Jan 21 2022 at 22:13)</a>:</h4>
<p>Can you enable features through a -Z flag?</p>



<a name="268910349"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/268910349" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#268910349">(Jan 21 2022 at 22:14)</a>:</h4>
<p>Comparing stderr is probably too much. But checking pass to fail or vice-versa is probably simple enough and helpful</p>



<a name="268910614"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/268910614" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#268910614">(Jan 21 2022 at 22:17)</a>:</h4>
<p>probably <code>-Zcrate-attr=feature(generic_associated_types)</code> would work ?</p>



<a name="268911790"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/268911790" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matthiaskrgr <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#268911790">(Jan 21 2022 at 22:26)</a>:</h4>
<p>do we have a list of unstable features somewhere?</p>



<a name="268912206"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/268912206" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#268912206">(Jan 21 2022 at 22:30)</a>:</h4>
<p>there's at least the unstable book, but I'm not sure if it lists everything <a href="https://doc.rust-lang.org/unstable-book/language-features.html">https://doc.rust-lang.org/unstable-book/language-features.html</a></p>



<a name="268917551"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/268917551" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#268917551">(Jan 21 2022 at 23:27)</a>:</h4>
<p>This is the full list: <a href="https://github.com/rust-lang/rust/blob/master/compiler/rustc_feature/src/active.rs">https://github.com/rust-lang/rust/blob/master/compiler/rustc_feature/src/active.rs</a></p>



<a name="268917690"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/268917690" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#268917690">(Jan 21 2022 at 23:28)</a>:</h4>
<p>At least regarding language features. Library features are sourced from every library that has staged_api enabled.</p>



<a name="271697056"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/271697056" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Poitras <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#271697056">(Feb 12 2022 at 16:41)</a>:</h4>
<p>Hey all,</p>
<p>I've just got another job and will be moving across the country, so I won't be able to contribute to this for many months. If someone wants to take it over, that would be great. Otherwise I might reconnect with this in a few months and move it forward, but it's not possible for me to do it at this time.</p>



<a name="271716540"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/271716540" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#271716540">(Feb 12 2022 at 23:57)</a>:</h4>
<p>I opened <a href="https://github.com/rust-lang/rust/issues/93953">#93953</a> to add a <code>known-bug</code> directive to compiletest. It currently allows tests to not require error annotations.</p>



<a name="271716549"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/271716549" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#271716549">(Feb 12 2022 at 23:57)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/issues/93757">#93757</a> is already merged, which added some GAT regression tests</p>



<a name="271716608"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/271716608" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#271716608">(Feb 12 2022 at 23:58)</a>:</h4>
<p>At some point soon, I'll create a couple labels for issues along the lines of "has an MCVE to add to the test suite" and "has an MCVE in the test suite"</p>



<a name="271733588"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/271733588" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#271733588">(Feb 13 2022 at 07:54)</a>:</h4>
<p>I wonder if we could make a github bot that comments on the PR when the diagnostics of a known-bug change?</p>



<a name="271733608"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/271733608" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#271733608">(Feb 13 2022 at 07:55)</a>:</h4>
<p>Also I think we should require <code>known-bug</code> to be followed by a github URL so we can search for tests for an open issue or find the issue for a test.</p>



<a name="271751918"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/271751918" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#271751918">(Feb 13 2022 at 15:49)</a>:</h4>
<p>A github bot would be possible, but kind of heavy. It would have to look through all .stderr files that changed and look for known-bug. (But not just the diff)</p>



<a name="271751992"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/271751992" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#271751992">(Feb 13 2022 at 15:51)</a>:</h4>
<p>Yes, I had in mind two potential future extensions: 1) An issue or url 2) what we <em>expect</em> the test to eventually be (check-pass, check-fail, etc.)</p>



<a name="271752046"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/271752046" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#271752046">(Feb 13 2022 at 15:52)</a>:</h4>
<p>The first is sort of mitigated by the naming of the test (issue-XXXXX) for now</p>



<a name="271752081"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/271752081" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#271752081">(Feb 13 2022 at 15:53)</a>:</h4>
<p>The second is a bit tricky, because there's definitely been plenty of times where I thought a test <em>should</em> pass, but the bug got fixed and there was an error.</p>



<a name="271752134"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/271752134" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#271752134">(Feb 13 2022 at 15:54)</a>:</h4>
<blockquote>
<p>Adding it relaxes the requirement to add error annotations to the test (though it is still allowed). In the future, this could be extended with further relaxations - with the goal to make adding these tests need minimal effort.</p>
</blockquote>
<p>I'm curious about this element of the open PR - it sounds to me like it's intended to ease the addition of tests, but it also seems likely that in (many) cases what we actually sort of <em>want</em> is a "future" error (or lack thereof)? IOW, known-bug as-is primarily helps only with cases where the bug is about an incorrect error message, not so much with e.g. diagnostics bugs and such</p>



<a name="271752211"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/271752211" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#271752211">(Feb 13 2022 at 15:56)</a>:</h4>
<p>(and reading tests can be much easier with errors annotated)</p>



<a name="271754120"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/271754120" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#271754120">(Feb 13 2022 at 16:38)</a>:</h4>
<p>This was originally discussed to import glacier tests. So I think  known-bug should disable all output checking and only start notifying us when the current exit (success or failure) doesn't match anymore (hopefully turning into the expected one).<br>
ICE -&gt; regular pass or fail<br>
ICEs use a different exit code, right?<br>
That way these tests don't need blessing when some diagnostic output changes that isn't the purpose of the test.</p>



<a name="271756810"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/271756810" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#271756810">(Feb 13 2022 at 17:42)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116122">simulacrum</span> <a href="#narrow/stream/233931-t-compiler.2Fmajor-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476/near/271752134">said</a>:</p>
<blockquote>
<p>it sounds to me like it's intended to ease the addition of tests, but it also seems likely that in (many) cases what we actually sort of <em>want</em> is a "future" error (or lack thereof)?</p>
</blockquote>
<p>This is the intention, yes. My "shiny future" here goes something like this:<br>
1) Some opens an issue of something they think is a bug.<br>
  1a) If there isn't an MCVE, then E-needs-mcve gets added until one is made.<br>
2) Somebody confirms "yep, this is a bug" and adds a "S-tracking-has-mcve" or something along those lines, indicating that there is an mcve, but it hasn't been added to the test suite<br>
3) Somebody else decides "okay, I'm going to spend some time to make a PR adding known-bug tests" and searches using the above label. All they have to do is make a PR adding the MCVE from the issue, with the <code>known-bug</code> directive. Ideally, the test is an appropriate directory, but not necessarily required - imo it's better to have the test being tested than to know exactly how to categorize it.<br>
4) Once the test is added, the issue gets changed to "S-tracking-mcve-tested" or something.<br>
5) At some point, somebody makes a change somewhere that causes the test to pass, or change output. At first, I was thinking that not capturing stderr would be good for known-bugs; but thinking about it, I imagine it'll often-enough be the case (as I said above) that a test that was <em>expected</em> to pass actually fails for something unrelated to the actual bug. I check-fail -&gt; check-fail still might indicate a bug fix but without error annotations <em>or</em> stderr, you can't really tell that something changed.<br>
6) The test is probably categorized and annotated, and the issue can be closed.</p>
<p>Where not requiring error annotations really shines is for <em>existing</em> issues. There a lot of issues open with MCVEs. It's much easier to ask people to go an add tests if they don't have to go and add error annotations for each test.</p>



<a name="271756826"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/271756826" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#271756826">(Feb 13 2022 at 17:43)</a>:</h4>
<p><span class="user-mention silent" data-user-id="330154">The 8472</span> <a href="#narrow/stream/233931-t-compiler.2Fmajor-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476/near/271754120">said</a>:</p>
<blockquote>
<p>This was originally discussed to import glacier tests. So I think  known-bug should disable all output checking and only start notifying us when the current exit (success or failure) doesn't match anymore (hopefully turning into the expected one).<br>
ICE -&gt; regular pass or fail<br>
ICEs use a different exit code, right?</p>
</blockquote>
<p>For ICEs, I think the <code>should-ice</code> directive can cover that.</p>



<a name="271756882"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/271756882" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#271756882">(Feb 13 2022 at 17:44)</a>:</h4>
<p><span class="user-mention silent" data-user-id="330154">The 8472</span> <a href="#narrow/stream/233931-t-compiler.2Fmajor-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476/near/271754120">said</a>:</p>
<blockquote>
<p>That way these tests don't need blessing when some diagnostic output changes that isn't the purpose of the test.</p>
</blockquote>
<p>Blessing is easy though. It's very easy to bless, look at the changed output, and say "that's not special - it's expected from the changes made"</p>



<a name="271757109"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/271757109" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#271757109">(Feb 13 2022 at 17:51)</a>:</h4>
<p>It's annoying though if you work on stuff that's not expected to affect UI tests and so you don't run them locally and then in breaks in CI. So it would be nice to only check the output when the output is needed to identify the issue.</p>



<a name="271757116"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/271757116" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#271757116">(Feb 13 2022 at 17:51)</a>:</h4>
<p>Avoiding friction</p>



<a name="271757431"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/271757431" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#271757431">(Feb 13 2022 at 18:00)</a>:</h4>
<p>I mean, my argument is that the output <em>is</em> needed. Since oftentimes the output changes to be some other error, but the original bug is fixed.</p>



<a name="271757573"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/271757573" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#271757573">(Feb 13 2022 at 18:01)</a>:</h4>
<p>But also, I don't buy that as a strong argument. If there are changes that would affect known-bug test output then 1) That change is already covered under a different test, and you'll have to bless anyways or 2) The output change <em>isn't</em> covered by another test, in which case it's <em>good</em> to have the extra coverage.</p>



<a name="271757801"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/271757801" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#271757801">(Feb 13 2022 at 18:07)</a>:</h4>
<blockquote>
<p>Blessing is easy though. It's very easy to bless, look at the changed output, and say "that's not special - it's expected from the changes made"</p>
</blockquote>
<p>This seems almost too true -- one of the major motivations for existing annotations in .rs files is that it's really easy to overlook changes to bless'd stderr files, and it's frequently pretty hard to rebuild context from just the stderr file as you need to correlate with the .rs file and in e.g. Github that can be hard.</p>



<a name="271757870"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/271757870" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#271757870">(Feb 13 2022 at 18:08)</a>:</h4>
<p>Eh, sometimes when you touch a type in std it can change error output in a test because the test happened to use that particular type. Granted, it doesn't happen often.</p>



<a name="271758213"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/271758213" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#271758213">(Feb 13 2022 at 18:17)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116122">simulacrum</span> <a href="#narrow/stream/233931-t-compiler.2Fmajor-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476/near/271757801">said</a>:</p>
<blockquote>
<p>This seems almost too true -- one of the major motivations for existing annotations in .rs files is that it's really easy to overlook changes to bless'd stderr files, and it's frequently pretty hard to rebuild context from just the stderr file as you need to correlate with the .rs file and in e.g. Github that can be hard.</p>
</blockquote>
<p>I don't think any of this is <em>wrong</em>. I guess the tradeoff here is between how easy it is to miss a "bug fix" purely from stderr (so, this only is a problem for fail -&gt; fail known-bug tests) vs the additional overhead of adding new tests with error annotations <em>and</em> the additional overhead of known-bug test <em>maintenance</em> (i.e. updating error annotations when they change for unrelated reasons). I would argue that missing a fail -&gt; fail bug fix is not a big deal. In this case, we're no worse off than we are today: the issue sits open, unknowingly fixed. (Again, this is also only for fail -&gt; fail known-bug tests, fail -&gt; pass would require more than a bless). However, if the additional overhead of adding new tests prevents people from wanting to add tests, then we're back at square one. (I also personally can say from adding the GAT tests that it does get annoying. I added less than a dozen tests and it took me 20-30 minutes between copy-pasting, saving the correct name, writing out a reason for why it currently fails, blessing, adding error annotations, <em>re-blessing</em>.)</p>



<a name="271758216"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/271758216" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#271758216">(Feb 13 2022 at 18:17)</a>:</h4>
<p>(hit enter too soon, one sec)</p>



<a name="271758439"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/271758439" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#271758439">(Feb 13 2022 at 18:23)</a>:</h4>
<p><span class="user-mention silent" data-user-id="330154">The 8472</span> <a href="#narrow/stream/233931-t-compiler.2Fmajor-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476/near/271757870">said</a>:</p>
<blockquote>
<p>Eh, sometimes when you touch a type in std it can change error output in a test because the test happened to use that particular type. Granted, it doesn't happen often.</p>
</blockquote>
<p>Again, I don't really see the argument here. If that change is visible to the user, then coverage of that change isn't a bad thing?</p>



<a name="271759126"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/271759126" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#271759126">(Feb 13 2022 at 18:41)</a>:</h4>
<p>Take this PR for example. <a href="https://github.com/rust-lang/rust/pull/91928/files#diff-32978818e281df08640feda8871c93202f70e6c9bb6718d8ff6128fed4a76ad4">https://github.com/rust-lang/rust/pull/91928/files#diff-32978818e281df08640feda8871c93202f70e6c9bb6718d8ff6128fed4a76ad4</a><br>
The test just happens to use <code>Option</code> (which was changed in the PR) even though its intent is testing closures.</p>



<a name="271759250"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/271759250" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#271759250">(Feb 13 2022 at 18:44)</a>:</h4>
<p>The notes also point to particular lines, so if you reformat where bounds it breaks UI tests printing bounds in their notes. So "coverage" for the formatting of random signatures is not a beneficial thing imo.</p>



<a name="271759427"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/271759427" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#271759427">(Feb 13 2022 at 18:48)</a>:</h4>
<p>Well, then: why don't <em>all</em> tests default to not capturing stderr?</p>



<a name="271759630"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/271759630" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#271759630">(Feb 13 2022 at 18:52)</a>:</h4>
<p>Because they're intentional failures  (those that aren't -pass) with diagnostics for users. But unintentional failures are different. If they should pass then the diagnostics are not meant to be what's shown to the user. And if they're ICEs the output is supposed to go away too.</p>
<p>known bug -&gt; we know the output is wrong -&gt; why test the output?</p>



<a name="271759770"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/271759770" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#271759770">(Feb 13 2022 at 18:55)</a>:</h4>
<p>Okay, so how do you suggest we handle the case we a test should fail, but not for the reason it currently does</p>



<a name="271760062"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/271760062" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#271760062">(Feb 13 2022 at 19:02)</a>:</h4>
<p>Tell it which diagnostic code we expect but currently isn't there. This would be a failure and break the test-suite. But since it's a known-bug it basically inverts its meaning, causing it to pass until someone fixes the issue and updates the test.</p>



<a name="271760112"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/271760112" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#271760112">(Feb 13 2022 at 19:03)</a>:</h4>
<p>Once the test is updated and prints the diagnostics we <em>want</em> to be shown then the output can be captured.</p>



<a name="271760187"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/271760187" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#271760187">(Feb 13 2022 at 19:05)</a>:</h4>
<p>ICE -&gt; pass  - will never need to have its output checked<br>
fail -&gt; pass - ditto<br>
fail -&gt; fail - only once the correct diagnostics are printed<br>
pass -&gt; fail - there's no error to check for yet anyway</p>



<a name="271760332"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/271760332" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#271760332">(Feb 13 2022 at 19:08)</a>:</h4>
<p>This assumes you know what the "correct" diagnostics will be</p>



<a name="271760364"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/271760364" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#271760364">(Feb 13 2022 at 19:09)</a>:</h4>
<p>Well, you can also negate it and expect the current one not to be there. But that's a bit more fickle. The other one is preferable.</p>



<a name="271760412"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/271760412" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#271760412">(Feb 13 2022 at 19:10)</a>:</h4>
<p>It also goes back to "need to add error annotations"</p>



<a name="271760445"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/271760445" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#271760445">(Feb 13 2022 at 19:11)</a>:</h4>
<p>Only in the fail-&gt;fail scenario where you're saying there's an error here but we want a different one. In the other ones you don't need to.</p>



<a name="271760496"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/271760496" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#271760496">(Feb 13 2022 at 19:12)</a>:</h4>
<p>I think in that case an annotation -  or a header - is not wrong since it expresses intent.</p>



<a name="271760518"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/271760518" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#271760518">(Feb 13 2022 at 19:13)</a>:</h4>
<p>Maybe we can do a thing half-way in between:</p>
<ol>
<li>Use short error format for bug tests</li>
<li>Make bless add a comment at the end of the .rs file (containing the short message), unless the last line is already that error.</li>
</ol>
<p>This way we get a history, it's in the .rs file, it's not very verbose, it's automatic,</p>



<a name="271765790"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/271765790" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#271765790">(Feb 13 2022 at 21:12)</a>:</h4>
<p>That's not a terrible idea. But what about it there are multiple errors for a file?</p>



<a name="271765894"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/271765894" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#271765894">(Feb 13 2022 at 21:15)</a>:</h4>
<p>Yea I didn't come up with a good solution for that. We could insert them separated by an empty line?</p>



<a name="271803673"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/271803673" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#271803673">(Feb 14 2022 at 09:47)</a>:</h4>
<p>Oh, we should also check how ICEs and overflows (segfaults) appear and possibly special case them</p>



<a name="271838099"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/271838099" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#271838099">(Feb 14 2022 at 15:04)</a>:</h4>
<p><span class="user-mention silent" data-user-id="124288">oli</span> <a href="#narrow/stream/233931-t-compiler.2Fmajor-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476/near/271765894">said</a>:</p>
<blockquote>
<p>Yea I didn't come up with a good solution for that. We could insert them separated by an empty line?</p>
</blockquote>
<p>I don't know. This really seems like reinventing the stderr/bless wheel.</p>



<a name="271838126"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/271838126" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#271838126">(Feb 14 2022 at 15:05)</a>:</h4>
<p><span class="user-mention silent" data-user-id="124288">oli</span> <a href="#narrow/stream/233931-t-compiler.2Fmajor-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476/near/271803673">said</a>:</p>
<blockquote>
<p>Oh, we should also check how ICEs and overflows (segfaults) appear and possibly special case them</p>
</blockquote>
<p>ICEs can be tested with <code>should-ice</code></p>



<a name="271839030"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/271839030" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#271839030">(Feb 14 2022 at 15:10)</a>:</h4>
<p>I don't really want to get stuck here in a bikeshed-like discussion. <span class="user-mention" data-user-id="116122">@simulacrum</span> and <span class="user-mention" data-user-id="330154">@The 8472</span>: Do either of you <em>object</em> to merging <a href="https://github.com/rust-lang/rust/issues/93953">#93953</a>? If so, do you think you can outline more concretely your "shiny future" here - and how you would like to move going forward?</p>



<a name="271839321"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/271839321" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#271839321">(Feb 14 2022 at 15:12)</a>:</h4>
<p>No, I'm planning to finalize a review on it today and merge -- I think we should 'experiment in tree', so to speak</p>



<a name="271839552"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/271839552" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#271839552">(Feb 14 2022 at 15:13)</a>:</h4>
<p>If we see problems with it we can always relatively easily revert, IMO.</p>



<a name="271839691"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/271839691" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#271839691">(Feb 14 2022 at 15:14)</a>:</h4>
<blockquote>
<p>Do either of you object to merging <a href="https://github.com/rust-lang/rust/issues/93953">#93953</a>?</p>
</blockquote>
<p>No.</p>



<a name="271840539"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/271840539" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#271840539">(Feb 14 2022 at 15:20)</a>:</h4>
<p><span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span>great</p>



<a name="271844196"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/271844196" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#271844196">(Feb 14 2022 at 15:44)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232957">Jack Huey</span> <a href="#narrow/stream/233931-t-compiler.2Fmajor-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476/near/271838126">said</a>:</p>
<blockquote>
<p>ICEs can be tested with <code>should-ice</code></p>
</blockquote>
<p>Just want to make sure it is clear, <code>should-ice</code> only works for incremental tests. It could be extended for others, but that's not how it works today.</p>



<a name="271844673"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/271844673" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#271844673">(Feb 14 2022 at 15:47)</a>:</h4>
<p>Ah interesting. Probably should be extended :)</p>



<a name="272494393"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/272494393" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#272494393">(Feb 19 2022 at 05:18)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/issues/93953">#93953</a> just landed</p>



<a name="275111983"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/275111983" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#275111983">(Mar 12 2022 at 19:06)</a>:</h4>
<p>Minor update: I've added <code>S-bug-has-mcve</code> and <code>S-bug-has-test</code> labels and tagged all issues that have a <code>known-bug</code> test.</p>



<a name="275111998"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Adding%20known%20bugs%20to%20test%20cases%20compiler-team%23476/near/275111998" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476.html#275111998">(Mar 12 2022 at 19:07)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/issues?q=is%3Aopen+is%3Aissue+label%3AS-bug-has-test">https://github.com/rust-lang/rust/issues?q=is%3Aopen+is%3Aissue+label%3AS-bug-has-test</a></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>