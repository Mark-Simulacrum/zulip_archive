<html>
<head><meta charset="utf-8"><title>CI should exercise (subset of) tests unde… compiler-team#439 · t-compiler/major changes · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/index.html">t-compiler/major changes</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/CI.20should.20exercise.20(subset.20of).20tests.20unde.E2.80.A6.20compiler-team.23439.html">CI should exercise (subset of) tests unde… compiler-team#439</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="243040636"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/CI%20should%20exercise%20%28subset%20of%29%20tests%20unde%E2%80%A6%20compiler-team%23439/near/243040636" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> triagebot <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/CI.20should.20exercise.20(subset.20of).20tests.20unde.E2.80.A6.20compiler-team.23439.html#243040636">(Jun 17 2021 at 15:58)</a>:</h4>
<p>A new proposal has been announced: <a href="https://github.com/rust-lang/compiler-team/issues/439">CI should exercise (subset of) tests under --stage 1 #439</a>. It will be announced at the next meeting to try and draw attention to it, but usually MCPs are not discussed during triage meetings. If you think this would benefit from discussion amongst the team, consider proposing a design meeting.</p>



<a name="250942997"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/CI%20should%20exercise%20%28subset%20of%29%20tests%20unde%E2%80%A6%20compiler-team%23439/near/250942997" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/CI.20should.20exercise.20(subset.20of).20tests.20unde.E2.80.A6.20compiler-team.23439.html#250942997">(Aug 27 2021 at 14:50)</a>:</h4>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span> I like this idea (as discussed in the planning meeting today) :) what do you think about running just UI tests for now and seeing how much CI time that adds? we could maybe only do it for a full bors test since I don't expect it to come up much</p>



<a name="250943033"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/CI%20should%20exercise%20%28subset%20of%29%20tests%20unde%E2%80%A6%20compiler-team%23439/near/250943033" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/CI.20should.20exercise.20(subset.20of).20tests.20unde.E2.80.A6.20compiler-team.23439.html#250943033">(Aug 27 2021 at 14:50)</a>:</h4>
<p>("UI tests" -&gt; <code>x.py test --stage 1 src/test/{ui,rustdoc-ui}</code>)</p>



<a name="250943447"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/CI%20should%20exercise%20%28subset%20of%29%20tests%20unde%E2%80%A6%20compiler-team%23439/near/250943447" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/CI.20should.20exercise.20(subset.20of).20tests.20unde.E2.80.A6.20compiler-team.23439.html#250943447">(Aug 27 2021 at 14:53)</a>:</h4>
<p>we should probably loop in <span class="user-group-mention" data-user-group-id="2943">@T-infra</span> too - I don't know how much "slack" we have for CI time</p>



<a name="250943499"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/CI%20should%20exercise%20%28subset%20of%29%20tests%20unde%E2%80%A6%20compiler-team%23439/near/250943499" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/CI.20should.20exercise.20(subset.20of).20tests.20unde.E2.80.A6.20compiler-team.23439.html#250943499">(Aug 27 2021 at 14:53)</a>:</h4>
<p>Linux builders generally have a good bit of slack</p>



<a name="250943630"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/CI%20should%20exercise%20%28subset%20of%29%20tests%20unde%E2%80%A6%20compiler-team%23439/near/250943630" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/CI.20should.20exercise.20(subset.20of).20tests.20unde.E2.80.A6.20compiler-team.23439.html#250943630">(Aug 27 2021 at 14:54)</a>:</h4>
<p>ah ok, so run this on linux-only instead of bors-only? that seems fine too :)</p>



<a name="250943643"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/CI%20should%20exercise%20%28subset%20of%29%20tests%20unde%E2%80%A6%20compiler-team%23439/near/250943643" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/CI.20should.20exercise.20(subset.20of).20tests.20unde.E2.80.A6.20compiler-team.23439.html#250943643">(Aug 27 2021 at 14:54)</a>:</h4>
<p>and yeah let's do it just for a full bors test</p>



<a name="250943648"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/CI%20should%20exercise%20%28subset%20of%29%20tests%20unde%E2%80%A6%20compiler-team%23439/near/250943648" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/CI.20should.20exercise.20(subset.20of).20tests.20unde.E2.80.A6.20compiler-team.23439.html#250943648">(Aug 27 2021 at 14:54)</a>:</h4>
<p>no, no, bors-only</p>



<a name="250943670"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/CI%20should%20exercise%20%28subset%20of%29%20tests%20unde%E2%80%A6%20compiler-team%23439/near/250943670" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/CI.20should.20exercise.20(subset.20of).20tests.20unde.E2.80.A6.20compiler-team.23439.html#250943670">(Aug 27 2021 at 14:54)</a>:</h4>
<p>e.g. x86_64-gnu builder should be good</p>



<a name="250943681"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/CI%20should%20exercise%20%28subset%20of%29%20tests%20unde%E2%80%A6%20compiler-team%23439/near/250943681" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/CI.20should.20exercise.20(subset.20of).20tests.20unde.E2.80.A6.20compiler-team.23439.html#250943681">(Aug 27 2021 at 14:54)</a>:</h4>
<p>linux bors takes 40/50 minutes, macos bors takes 2hr45min</p>



<a name="250945279"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/CI%20should%20exercise%20%28subset%20of%29%20tests%20unde%E2%80%A6%20compiler-team%23439/near/250945279" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/CI.20should.20exercise.20(subset.20of).20tests.20unde.E2.80.A6.20compiler-team.23439.html#250945279">(Aug 27 2021 at 15:04)</a>:</h4>
<p>I also am in favor of this idea in general. I usually <em>only</em> run tests locally with stage1 and rarely encounter issues with the ui, debuginfo, codegen, codegen-units, incremental and mir-opt test suites.</p>



<a name="250978387"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/CI%20should%20exercise%20%28subset%20of%29%20tests%20unde%E2%80%A6%20compiler-team%23439/near/250978387" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/CI.20should.20exercise.20(subset.20of).20tests.20unde.E2.80.A6.20compiler-team.23439.html#250978387">(Aug 27 2021 at 18:56)</a>:</h4>
<p>I think running on <code>ui</code> alone will be a good step</p>



<a name="250978704"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/CI%20should%20exercise%20%28subset%20of%29%20tests%20unde%E2%80%A6%20compiler-team%23439/near/250978704" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/CI.20should.20exercise.20(subset.20of).20tests.20unde.E2.80.A6.20compiler-team.23439.html#250978704">(Aug 27 2021 at 18:58)</a>:</h4>
<p>but note that my original problem, as <span class="user-mention" data-user-id="232545">@Joshua Nelson</span> reminded me, was that I was hitting a <code>rustdoc-ui</code> test failure</p>



<a name="250978764"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/CI%20should%20exercise%20%28subset%20of%29%20tests%20unde%E2%80%A6%20compiler-team%23439/near/250978764" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/CI.20should.20exercise.20(subset.20of).20tests.20unde.E2.80.A6.20compiler-team.23439.html#250978764">(Aug 27 2021 at 18:58)</a>:</h4>
<p>so, I guess in my ideal world, we’d push on identifying the right superset</p>



<a name="250978776"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/CI%20should%20exercise%20%28subset%20of%29%20tests%20unde%E2%80%A6%20compiler-team%23439/near/250978776" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/CI.20should.20exercise.20(subset.20of).20tests.20unde.E2.80.A6.20compiler-team.23439.html#250978776">(Aug 27 2021 at 18:58)</a>:</h4>
<p>of ui</p>



<a name="250978829"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/CI%20should%20exercise%20%28subset%20of%29%20tests%20unde%E2%80%A6%20compiler-team%23439/near/250978829" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/CI.20should.20exercise.20(subset.20of).20tests.20unde.E2.80.A6.20compiler-team.23439.html#250978829">(Aug 27 2021 at 18:59)</a>:</h4>
<p>the <code>ui</code> / <code>ui-fulldeps</code> distinction used to be in support of the stage1/stage2 distinction, if I remember correctly</p>



<a name="250978867"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/CI%20should%20exercise%20%28subset%20of%29%20tests%20unde%E2%80%A6%20compiler-team%23439/near/250978867" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/CI.20should.20exercise.20(subset.20of).20tests.20unde.E2.80.A6.20compiler-team.23439.html#250978867">(Aug 27 2021 at 18:59)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116083">pnkfelix</span> <a href="#narrow/stream/233931-t-compiler.2Fmajor-changes/topic/CI.20should.20exercise.20.28subset.20of.29.20tests.20unde.E2.80.A6.20compiler-team.23439/near/250978829">said</a>:</p>
<blockquote>
<p>the <code>ui</code> / <code>ui-fulldeps</code> distinction used to be in support of the stage1/stage2 distinction, if I remember correclty</p>
</blockquote>
<p>yeah, I think a lot of the ui-fulldeps tests could be moved to ui</p>



<a name="250978881"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/CI%20should%20exercise%20%28subset%20of%29%20tests%20unde%E2%80%A6%20compiler-team%23439/near/250978881" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/CI.20should.20exercise.20(subset.20of).20tests.20unde.E2.80.A6.20compiler-team.23439.html#250978881">(Aug 27 2021 at 18:59)</a>:</h4>
<p>as in, stuff in <code>-fulldeps</code> was only guaranteed to work against stage2</p>



<a name="250978897"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/CI%20should%20exercise%20%28subset%20of%29%20tests%20unde%E2%80%A6%20compiler-team%23439/near/250978897" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/CI.20should.20exercise.20(subset.20of).20tests.20unde.E2.80.A6.20compiler-team.23439.html#250978897">(Aug 27 2021 at 18:59)</a>:</h4>
<p>I don’t really understand how things got moved around</p>



<a name="250979157"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/CI%20should%20exercise%20%28subset%20of%29%20tests%20unde%E2%80%A6%20compiler-team%23439/near/250979157" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/CI.20should.20exercise.20(subset.20of).20tests.20unde.E2.80.A6.20compiler-team.23439.html#250979157">(Aug 27 2021 at 19:01)</a>:</h4>
<p>I don't know if stuff was moved, I think it's just that proc-macros are now supported with stage 1</p>



<a name="250979681"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/CI%20should%20exercise%20%28subset%20of%29%20tests%20unde%E2%80%A6%20compiler-team%23439/near/250979681" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/CI.20should.20exercise.20(subset.20of).20tests.20unde.E2.80.A6.20compiler-team.23439.html#250979681">(Aug 27 2021 at 19:04)</a>:</h4>
<p>No, stuff was definitely moved, but I mean back with PR’s like PR <a href="https://github.com/rust-lang/rust/issues/32009">#32009</a></p>



<a name="250979934"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/CI%20should%20exercise%20%28subset%20of%29%20tests%20unde%E2%80%A6%20compiler-team%23439/near/250979934" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/CI.20should.20exercise.20(subset.20of).20tests.20unde.E2.80.A6.20compiler-team.23439.html#250979934">(Aug 27 2021 at 19:06)</a>:</h4>
<p>Okay, to be fair: The test family I was looking at here was things like <a href="http://dropck-tarena-cycle-checked.rs">dropck-tarena-cycle-checked.rs</a></p>



<a name="250979971"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/CI%20should%20exercise%20%28subset%20of%29%20tests%20unde%E2%80%A6%20compiler-team%23439/near/250979971" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/CI.20should.20exercise.20(subset.20of).20tests.20unde.E2.80.A6.20compiler-team.23439.html#250979971">(Aug 27 2021 at 19:06)</a>:</h4>
<p>which does use <code>extern crate arena;</code></p>



<a name="250980098"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/CI%20should%20exercise%20%28subset%20of%29%20tests%20unde%E2%80%A6%20compiler-team%23439/near/250980098" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/CI.20should.20exercise.20(subset.20of).20tests.20unde.E2.80.A6.20compiler-team.23439.html#250980098">(Aug 27 2021 at 19:07)</a>:</h4>
<p>I think my confusion here might stem from my use of <code>-fulldeps</code> as a proxy for “requires stage2”, when that’s really not precisely what it means.</p>



<a name="250980126"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/CI%20should%20exercise%20%28subset%20of%29%20tests%20unde%E2%80%A6%20compiler-team%23439/near/250980126" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/CI.20should.20exercise.20(subset.20of).20tests.20unde.E2.80.A6.20compiler-team.23439.html#250980126">(Aug 27 2021 at 19:07)</a>:</h4>
<p>I was pretty sure that's what it meant <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span> what does it mean?</p>



<a name="250980169"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/CI%20should%20exercise%20%28subset%20of%29%20tests%20unde%E2%80%A6%20compiler-team%23439/near/250980169" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/CI.20should.20exercise.20(subset.20of).20tests.20unde.E2.80.A6.20compiler-team.23439.html#250980169">(Aug 27 2021 at 19:07)</a>:</h4>
<p>Well, consider the case I just gave: The issue there isn’t whether that test requires a stage2 compiler</p>



<a name="250980271"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/CI%20should%20exercise%20%28subset%20of%29%20tests%20unde%E2%80%A6%20compiler-team%23439/near/250980271" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/CI.20should.20exercise.20(subset.20of).20tests.20unde.E2.80.A6.20compiler-team.23439.html#250980271">(Aug 27 2021 at 19:08)</a>:</h4>
<p>it is that the test uses <code>extern crate arena;</code>. It has a dependency on something that we do not distribute with <code>rust-std</code> package.</p>



<a name="257543246"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/CI%20should%20exercise%20%28subset%20of%29%20tests%20unde%E2%80%A6%20compiler-team%23439/near/257543246" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/CI.20should.20exercise.20(subset.20of).20tests.20unde.E2.80.A6.20compiler-team.23439.html#257543246">(Oct 14 2021 at 14:21)</a>:</h4>
<blockquote>
<p>This leads to scenarios where the common case for a contributor can break, and there is no record of it in the CI or in the offending PR.</p>
</blockquote>
<p>The same justification would also apply to some stage 0 tests. Especially libs. That would have caught <a href="https://github.com/rust-lang/rust/issues/89564">#89564</a></p>



<a name="257549378"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/CI%20should%20exercise%20%28subset%20of%29%20tests%20unde%E2%80%A6%20compiler-team%23439/near/257549378" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/CI.20should.20exercise.20(subset.20of).20tests.20unde.E2.80.A6.20compiler-team.23439.html#257549378">(Oct 14 2021 at 14:57)</a>:</h4>
<p>I also wonder if we want to test with <code>debug_assertions</code>, if stage 1 is the right place for that (this has been mentioned elsewhere)</p>



<a name="257707752"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/CI%20should%20exercise%20%28subset%20of%29%20tests%20unde%E2%80%A6%20compiler-team%23439/near/257707752" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/CI.20should.20exercise.20(subset.20of).20tests.20unde.E2.80.A6.20compiler-team.23439.html#257707752">(Oct 15 2021 at 14:35)</a>:</h4>
<p><span class="user-mention" data-user-id="330154">@The 8472</span> so are you thinking we should be running tests against <code>—stage 0</code> too? That would be interesting, even if <em>only</em> as a way to sanity-check the test suite itself. (Which is not the same as the benefit you described, which was more about catching a missing beta backport, but seems like a good thing to me nonetheless.)</p>



<a name="257707942"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/CI%20should%20exercise%20%28subset%20of%29%20tests%20unde%E2%80%A6%20compiler-team%23439/near/257707942" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/CI.20should.20exercise.20(subset.20of).20tests.20unde.E2.80.A6.20compiler-team.23439.html#257707942">(Oct 15 2021 at 14:36)</a>:</h4>
<p>although testing against <code>—stage 0</code> would mean we’d need to annotate tests of beta-regressions with <code>// ignore-stage0</code> until beta backports happen.</p>



<a name="257709762"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/CI%20should%20exercise%20%28subset%20of%29%20tests%20unde%E2%80%A6%20compiler-team%23439/near/257709762" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/CI.20should.20exercise.20(subset.20of).20tests.20unde.E2.80.A6.20compiler-team.23439.html#257709762">(Oct 15 2021 at 14:49)</a>:</h4>
<p>I mostly mean library tests. And maybe some tools tests... stuff that isn't testing the compiler itself and which contributors actually run with <code>--stage 0</code>.</p>



<a name="257709995"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/CI%20should%20exercise%20%28subset%20of%29%20tests%20unde%E2%80%A6%20compiler-team%23439/near/257709995" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/CI.20should.20exercise.20(subset.20of).20tests.20unde.E2.80.A6.20compiler-team.23439.html#257709995">(Oct 15 2021 at 14:50)</a>:</h4>
<p>The UI tests strongly discourage stage 0 testing after all:</p>
<div class="codehilite"><pre><span></span><code>error: `--stage 0` runs compiletest on the beta compiler, not your local changes, and will almost always cause tests to fail
help: to test the compiler, use `--stage 1` instead
help: to test the standard library, use `--stage 0 library/std` instead
note: if you&#39;re sure you want to do this, please open an issue as to why. In the meantime, you can override this with `COMPILETEST_FORCE_STAGE0=1`.
</code></pre></div>



<a name="257730985"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/CI%20should%20exercise%20%28subset%20of%29%20tests%20unde%E2%80%A6%20compiler-team%23439/near/257730985" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/CI.20should.20exercise.20(subset.20of).20tests.20unde.E2.80.A6.20compiler-team.23439.html#257730985">(Oct 15 2021 at 17:03)</a>:</h4>
<p>Yeah I don't see why we would run tests against beta on nightly, that seems wrong</p>



<a name="265920011"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/CI%20should%20exercise%20%28subset%20of%29%20tests%20unde%E2%80%A6%20compiler-team%23439/near/265920011" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/CI.20should.20exercise.20(subset.20of).20tests.20unde.E2.80.A6.20compiler-team.23439.html#265920011">(Dec 23 2021 at 14:13)</a>:</h4>
<p>Okay, I updated the text of the proposal to specifically say that we should start with deployment with just the ui and rustdoc-ui test suites driving the stage1-specific CI tests, and I included the detail that it would be Linux bors-only (if I understood the conversation correctly so far).</p>



<a name="266017387"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/CI%20should%20exercise%20%28subset%20of%29%20tests%20unde%E2%80%A6%20compiler-team%23439/near/266017387" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/CI.20should.20exercise.20(subset.20of).20tests.20unde.E2.80.A6.20compiler-team.23439.html#266017387">(Dec 24 2021 at 18:28)</a>:</h4>
<p><span class="user-mention" data-user-id="330154">@The 8472</span> suggested above that we also run the libstd tests with --stage 0 - <span class="user-mention" data-user-id="116083">@pnkfelix</span> did you miss that or is it intentional to start with just UI tests for now?</p>



<a name="266017511"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/CI%20should%20exercise%20%28subset%20of%29%20tests%20unde%E2%80%A6%20compiler-team%23439/near/266017511" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> triagebot <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/CI.20should.20exercise.20(subset.20of).20tests.20unde.E2.80.A6.20compiler-team.23439.html#266017511">(Dec 24 2021 at 18:31)</a>:</h4>
<p><span class="user-group-mention" data-user-group-id="492">@T-compiler</span>: Proposal <a href="https://github.com/rust-lang/compiler-team/issues/439#issuecomment-1000913567">#439</a> has been seconded, and will be approved in 10 days if no objections are raised.</p>



<a name="266017513"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/CI%20should%20exercise%20%28subset%20of%29%20tests%20unde%E2%80%A6%20compiler-team%23439/near/266017513" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/CI.20should.20exercise.20(subset.20of).20tests.20unde.E2.80.A6.20compiler-team.23439.html#266017513">(Dec 24 2021 at 18:31)</a>:</h4>
<p>well, I think this is a good idea either way  - left a second</p>



<a name="266034670"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/CI%20should%20exercise%20%28subset%20of%29%20tests%20unde%E2%80%A6%20compiler-team%23439/near/266034670" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/CI.20should.20exercise.20(subset.20of).20tests.20unde.E2.80.A6.20compiler-team.23439.html#266034670">(Dec 25 2021 at 01:20)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/233931-t-compiler.2Fmajor-changes/topic/CI.20should.20exercise.20.28subset.20of.29.20tests.20unde.E2.80.A6.20compiler-team.23439/near/266017387">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="330154">The 8472</span> suggested above that we also run the libstd tests with --stage 0 - <span class="user-mention silent" data-user-id="116083">pnkfelix</span> did you miss that or is it intentional to start with just UI tests for now?</p>
</blockquote>
<p>My intent is to focus on the stage1 case on the ui* suites for now. We can adjust later, or have a separate MCP, based on how this experience goes.</p>



<a name="268706318"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/CI%20should%20exercise%20%28subset%20of%29%20tests%20unde%E2%80%A6%20compiler-team%23439/near/268706318" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> triagebot <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/CI.20should.20exercise.20(subset.20of).20tests.20unde.E2.80.A6.20compiler-team.23439.html#268706318">(Jan 20 2022 at 15:12)</a>:</h4>
<p>This proposal has been accepted: <a href="https://github.com/rust-lang/compiler-team/issues/439">#439</a>.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>