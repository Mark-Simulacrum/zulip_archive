<html>
<head><meta charset="utf-8"><title>Dealing with type/const ambiguities compiler-team#480 · t-compiler/major changes · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/index.html">t-compiler/major changes</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Dealing.20with.20type.2Fconst.20ambiguities.20compiler-team.23480.html">Dealing with type/const ambiguities compiler-team#480</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="268533412"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Dealing%20with%20type/const%20ambiguities%20compiler-team%23480/near/268533412" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> triagebot <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Dealing.20with.20type.2Fconst.20ambiguities.20compiler-team.23480.html#268533412">(Jan 19 2022 at 12:49)</a>:</h4>
<p>A new proposal has been announced: <a href="https://github.com/rust-lang/compiler-team/issues/480">Dealing with type/const ambiguities #480</a>. It will be announced at the next meeting to try and draw attention to it, but usually MCPs are not discussed during triage meetings. If you think this would benefit from discussion amongst the team, consider proposing a design meeting.</p>



<a name="268533492"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Dealing%20with%20type/const%20ambiguities%20compiler-team%23480/near/268533492" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Dealing.20with.20type.2Fconst.20ambiguities.20compiler-team.23480.html#268533492">(Jan 19 2022 at 12:49)</a>:</h4>
<p>I am not 100% happy with this solution but wasn't able to think of a better one <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="268533540"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Dealing%20with%20type/const%20ambiguities%20compiler-team%23480/near/268533540" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Dealing.20with.20type.2Fconst.20ambiguities.20compiler-team.23480.html#268533540">(Jan 19 2022 at 12:50)</a>:</h4>
<p>especially the naming is a bit :/</p>



<a name="268533847"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Dealing%20with%20type/const%20ambiguities%20compiler-team%23480/near/268533847" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Dealing.20with.20type.2Fconst.20ambiguities.20compiler-team.23480.html#268533847">(Jan 19 2022 at 12:52)</a>:</h4>
<p>cc <span class="user-mention" data-user-id="123856">@Vadim Petrochenkov</span> in case you have any suggestions or concerns here, especially whether the idea of <code>Res::ForGenericArg</code> would work. i.e. resolve ambiguous paths as both a type and value and if they could be both, just remember that</p>



<a name="269057563"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Dealing%20with%20type/const%20ambiguities%20compiler-team%23480/near/269057563" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vadim Petrochenkov <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Dealing.20with.20type.2Fconst.20ambiguities.20compiler-team.23480.html#269057563">(Jan 24 2022 at 03:56)</a>:</h4>
<p><span class="user-mention silent" data-user-id="216206">lcnr</span> <a href="#narrow/stream/233931-t-compiler.2Fmajor-changes/topic/Dealing.20with.20type.2Fconst.20ambiguities.20compiler-team.23480/near/268533847">said</a>:</p>
<blockquote>
<p>especially whether the idea of <code>Res::ForGenericArg</code> would work</p>
</blockquote>
<p><code>Res</code> doesn't look like the right thing to extend, if a HIR node has two potential resolutions, then it needs two instances of <code>Res</code>.</p>



<a name="269057725"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Dealing%20with%20type/const%20ambiguities%20compiler-team%23480/near/269057725" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vadim Petrochenkov <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Dealing.20with.20type.2Fconst.20ambiguities.20compiler-team.23480.html#269057725">(Jan 24 2022 at 04:00)</a>:</h4>
<p>I can't say I like the specific set of structures listed in <a href="https://github.com/rust-lang/compiler-team/issues/480">https://github.com/rust-lang/compiler-team/issues/480</a>, but the best / most convenient set will probably be clear only after the implementation.</p>



<a name="269057953"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Dealing%20with%20type/const%20ambiguities%20compiler-team%23480/near/269057953" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vadim Petrochenkov <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Dealing.20with.20type.2Fconst.20ambiguities.20compiler-team.23480.html#269057953">(Jan 24 2022 at 04:03)</a>:</h4>
<p>I'd introduce an <code>AmbiguousPath</code> structure (with two <code>Res</code>s), and a variant with the same name in <code>GenericArg</code>, and keep regular paths in types and expressions without changes, most paths are not in the generic argument position after all.</p>



<a name="269058024"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Dealing%20with%20type/const%20ambiguities%20compiler-team%23480/near/269058024" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vadim Petrochenkov <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Dealing.20with.20type.2Fconst.20ambiguities.20compiler-team.23480.html#269058024">(Jan 24 2022 at 04:04)</a>:</h4>
<p>I guess it's probably easy to merge the least invasive solution that work first, and only then try to refactor it into something else.</p>



<a name="269058039"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Dealing%20with%20type/const%20ambiguities%20compiler-team%23480/near/269058039" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vadim Petrochenkov <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Dealing.20with.20type.2Fconst.20ambiguities.20compiler-team.23480.html#269058039">(Jan 24 2022 at 04:05)</a>:</h4>
<p>Do you plan to disambiguate only single-segment paths (like it's done now), or multi-segment paths too?</p>



<a name="269068361"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Dealing%20with%20type/const%20ambiguities%20compiler-team%23480/near/269068361" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Dealing.20with.20type.2Fconst.20ambiguities.20compiler-team.23480.html#269068361">(Jan 24 2022 at 07:40)</a>:</h4>
<p>i would like multi-segment paths as well, it seems nice to support. though that's not what i am an expert in, so i will probably just do whatever you think is appropriate</p>



<a name="269079022"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Dealing%20with%20type/const%20ambiguities%20compiler-team%23480/near/269079022" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Dealing.20with.20type.2Fconst.20ambiguities.20compiler-team.23480.html#269079022">(Jan 24 2022 at 09:31)</a>:</h4>
<p>my main concern with both paths and <code>_</code> is that we end up with a hir visitor looking at types which accidentally ignores <code>GenericArg::Path</code></p>



<a name="269079098"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Dealing%20with%20type/const%20ambiguities%20compiler-team%23480/near/269079098" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Dealing.20with.20type.2Fconst.20ambiguities.20compiler-team.23480.html#269079098">(Jan 24 2022 at 09:32)</a>:</h4>
<p>and moving <code>Path</code> out of <code>hir::Type</code> prevents that from happening (mostly)</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>