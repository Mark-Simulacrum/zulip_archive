<html>
<head><meta charset="utf-8"><title>Build-time execution sandboxing compiler-team#475 · t-compiler/major changes · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/index.html">t-compiler/major changes</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html">Build-time execution sandboxing compiler-team#475</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="265726650"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265726650" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> triagebot <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265726650">(Dec 21 2021 at 19:44)</a>:</h4>
<p>A new proposal has been announced: <a href="https://github.com/rust-lang/compiler-team/issues/475">Build-time execution sandboxing #475</a>. It will be announced at the next meeting to try and draw attention to it, but usually MCPs are not discussed during triage meetings. If you think this would benefit from discussion amongst the team, consider proposing a design meeting.</p>



<a name="265726889"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265726889" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Edward Shen <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265726889">(Dec 21 2021 at 19:46)</a>:</h4>
<p>Previous discussion in #general: <a href="#narrow/stream/122651-general/topic/Build.20script.20security.20and.20isolation">https://rust-lang.zulipchat.com/#narrow/stream/122651-general/topic/Build.20script.20security.20and.20isolation</a></p>



<a name="265727062"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265727062" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265727062">(Dec 21 2021 at 19:48)</a>:</h4>
<blockquote>
<p>Note that while I primarily want to push for it as a security feature, I want to emphasize that there are benefits beyond security.</p>
</blockquote>
<p>I assume that this refers to things like reproducible builds - could you expand on those benefits in the MCP?</p>



<a name="265727070"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265727070" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265727070">(Dec 21 2021 at 19:48)</a>:</h4>
<p>I think we should use the sandboxing code from one of the major browsers. Creating watertight sandboxes is notoriously difficult and even browser vendors mess up from time to time. Given that they spent a lot of resources on securing these sandboxes I think the best course of action would be to borrow the implementation rather than handrolling it.</p>



<a name="265727133"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265727133" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265727133">(Dec 21 2021 at 19:49)</a>:</h4>
<p>Also note that on linux at least full sandboxes need suid on the sandboxing executable to allow it to use certain kinds of namespaces.</p>



<a name="265727262"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265727262" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Edward Shen <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265727262">(Dec 21 2021 at 19:50)</a>:</h4>
<p><span class="user-mention silent" data-user-id="125294">Aaron Hill</span> <a href="#narrow/stream/233931-t-compiler.2Fmajor-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475/near/265727062">said</a>:</p>
<blockquote>
<p>I assume that this refers to things like reproducible builds - could you expand on those benefits in the MCP?</p>
</blockquote>
<p>Will do, thanks for the feedback!</p>



<a name="265727313"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265727313" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265727313">(Dec 21 2021 at 19:51)</a>:</h4>
<blockquote>
<p>As far as I’m aware, no other major language supports something like this. A successful implementation may encourage other languages to do the same, improving security across the industry.</p>
</blockquote>
<p>Some build systems like bazel sandbox everything.</p>



<a name="265727519"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265727519" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265727519">(Dec 21 2021 at 19:53)</a>:</h4>
<p>This is similar to what I'm planning on eventually doing for a game I'm writing, it would run cargo/rustc for compiling game plugins inside a wasm/wasi sandbox with a virtual filesystem and limited network access</p>



<a name="265727551"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265727551" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Edward Shen <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265727551">(Dec 21 2021 at 19:54)</a>:</h4>
<p><span class="user-mention silent" data-user-id="133247">bjorn3</span> <a href="#narrow/stream/233931-t-compiler.2Fmajor-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475/near/265727070">said</a>:</p>
<blockquote>
<p>I think we should use the sandboxing code from one of the major browsers. Creating watertight sandboxes is notoriously difficult and even browser vendors mess up from time to time. Given that they spent a lot of resources on securing these sandboxes I think the best course of action would be to borrow the implementation rather than handrolling it.</p>
</blockquote>
<p>I didn't explicitly mention it since I wanted the proposal to be implementation agnostic (maybe I should?) but I think people have been generally receptive of using a wasm runtime (e.g. wasmtime) as our sandboxed runtime. Would that address your concerns?</p>



<a name="265727591"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265727591" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265727591">(Dec 21 2021 at 19:54)</a>:</h4>
<p>How should the sandboxing configuration look like if you want to for example build a C library? Will you have to manually allow the C compiler (which a user may want to override), every system library and every header location? Or will there be ways to do a blanket allow of reading <code>/usr</code>? And what if the user installed the C compiler in a non-standard location? Would the end user be able to override the sandbox configuration?</p>



<a name="265727642"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265727642" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265727642">(Dec 21 2021 at 19:55)</a>:</h4>
<p>for running cargo in wasi: <a href="https://github.com/rust-lang/cargo/issues/9287">https://github.com/rust-lang/cargo/issues/9287</a></p>



<a name="265727684"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265727684" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265727684">(Dec 21 2021 at 19:55)</a>:</h4>
<p><span class="user-mention silent" data-user-id="133247">bjorn3</span> <a href="#narrow/stream/233931-t-compiler.2Fmajor-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475/near/265727133">said</a>:</p>
<blockquote>
<p>Also note that on linux at least full sandboxes need suid on the sandboxing executable to allow it to use certain kinds of namespaces.</p>
</blockquote>
<p>I don't think that's true any longer with user namespaces (which, granted, aren't enabled on all distros). But you lose the ability to setup network bridges and such without suid helpers. But that's probably not needed for isolated builds?</p>



<a name="265727705"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265727705" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265727705">(Dec 21 2021 at 19:55)</a>:</h4>
<p><span class="user-mention silent" data-user-id="462933">Edward Shen</span> <a href="#narrow/stream/233931-t-compiler.2Fmajor-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475/near/265727551">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="133247">bjorn3</span> <a href="#narrow/stream/233931-t-compiler.2Fmajor-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475/near/265727070">said</a>:</p>
<blockquote>
<p>I think we should use the sandboxing code from one of the major browsers. Creating watertight sandboxes is notoriously difficult and even browser vendors mess up from time to time. Given that they spent a lot of resources on securing these sandboxes I think the best course of action would be to borrow the implementation rather than handrolling it.</p>
</blockquote>
<p>I didn't explicitly mention it since I wanted the proposal to be implementation agnostic (maybe I should?) but I think people have been generally receptive of using a wasm runtime (e.g. wasmtime) as our sandboxed runtime. Would that address your concerns?</p>
</blockquote>
<p>A lot of build scripts exist to build C dependencies. Running a C compiler in a wasm runtime would require compiling every part of the toolchain to wasm. How would this C compiler be distributed? And how will it remain compatible with the native toolchain?</p>



<a name="265728010"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265728010" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265728010">(Dec 21 2021 at 19:58)</a>:</h4>
<p>for compiling c code, we could do it similarly to how zig allows cross-compilation of c code <a href="https://andrewkelley.me/post/zig-cc-powerful-drop-in-replacement-gcc-clang.html">https://andrewkelley.me/post/zig-cc-powerful-drop-in-replacement-gcc-clang.html</a></p>



<a name="265728057"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265728057" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265728057">(Dec 21 2021 at 19:59)</a>:</h4>
<p>Zig isn't compiled to wasm, right?</p>



<a name="265728100"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265728100" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265728100">(Dec 21 2021 at 19:59)</a>:</h4>
<blockquote>
<p>Sandboxing build time execution greatly reduces the attack surface. This is a huge win for CI or any remote build system, as it provides a layer of security ensuring that build-time execution, for example, is not leaking sensitive data.</p>
</blockquote>
<p>I think it would be helpful to describe briefly what the threat model is and how sandboxing build time execution helps resolve threats there. My inference is that the threat model is "you have a malicious dependency that runs <a href="http://build.rs">build.rs</a> or proc macros" but given that most CI systems immediately follow <code>cargo build</code> with <code>cargo test</code>, I don't see how this actually provides security.</p>



<a name="265728104"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265728104" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265728104">(Dec 21 2021 at 19:59)</a>:</h4>
<p>and it builds on llvm, so you don't get gcc-supported targets. which isn't relevant yet, but might be at some point.</p>



<a name="265728582"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265728582" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265728582">(Dec 21 2021 at 20:04)</a>:</h4>
<p><span class="user-mention" data-user-id="125250">@Wesley Wiser</span> alternatively that's an argument for also running tests in a sandbox.</p>



<a name="265728610"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265728610" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265728610">(Dec 21 2021 at 20:05)</a>:</h4>
<p>But at some point you'll have to trust your build results, yeah.</p>



<a name="265728732"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265728732" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265728732">(Dec 21 2021 at 20:06)</a>:</h4>
<p>Depending on what your code does, that might be totally valid as well but I would imagine for more "integration" level tests, you probably want to run them in a similar environment as to where they will actually be running.</p>



<a name="265728761"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265728761" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265728761">(Dec 21 2021 at 20:07)</a>:</h4>
<p>But yeah, even then, if your dependency is actually malicious, it will just wait until prod to run the payload.</p>



<a name="265728778"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265728778" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265728778">(Dec 21 2021 at 20:07)</a>:</h4>
<p>I've done some fairly interesting things in <a href="http://build.rs">build.rs</a>, and sandboxing might make that very difficult.</p>



<a name="265728904"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265728904" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Edward Shen <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265728904">(Dec 21 2021 at 20:08)</a>:</h4>
<p><span class="user-mention" data-user-id="133247">@bjorn3</span> Thanks for the comments! I expected C dependencies to be especially tricky and I won't say that I have a concrete solution for. I'd need to investigate alternatives, but for now the MCP has no support for C dependencies and those build targets would be out-of-scope for at least this MCP (and left for a future improvement?)</p>



<a name="265728913"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265728913" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265728913">(Dec 21 2021 at 20:08)</a>:</h4>
<p>(And I don't necessarily trust that rustc cc would support every thing I'd want to check using a C compiler - for example, I'd prefer that my system use x86_64-pc-linux-gnu for the C target, rather than <code>*-unknown-*</code>)</p>



<a name="265728929"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265728929" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265728929">(Dec 21 2021 at 20:09)</a>:</h4>
<p>For rustc devs it could be useful to have a sandboxed build when debugging/profiling random reproducer code.</p>



<a name="265729070"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265729070" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265729070">(Dec 21 2021 at 20:10)</a>:</h4>
<p>I certainly feel a bit paranoid whenever someone points to an entire repo full of non-reduced reproducer for their issue.</p>



<a name="265729123"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265729123" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265729123">(Dec 21 2021 at 20:11)</a>:</h4>
<blockquote>
<p>Zig isn't compiled to wasm, right?</p>
</blockquote>
<p>afaict, zig isn't currently compiled to wasm. this is likely for similar reasons as why cargo can't run in wasi -- it's missing spawning processes, pipes, and network access</p>



<a name="265729202"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265729202" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Edward Shen <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265729202">(Dec 21 2021 at 20:12)</a>:</h4>
<p><span class="user-mention silent" data-user-id="257758">Connor Horman</span> <a href="#narrow/stream/233931-t-compiler.2Fmajor-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475/near/265728778">said</a>:</p>
<blockquote>
<p>I've done some fairly interesting things in <a href="http://build.rs">build.rs</a>, and sandboxing might make that very difficult.</p>
</blockquote>
<p>I would love to have some examples! And to be clear, this proposal is opt-in and meant to be non-breaking, so in the worst case your use cases can justifiably chose not to sandbox.</p>



<a name="265729398"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265729398" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265729398">(Dec 21 2021 at 20:14)</a>:</h4>
<p>seconding the request for a threat model.</p>



<a name="265729591"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265729591" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265729591">(Dec 21 2021 at 20:16)</a>:</h4>
<p><a href="https://github.com/LightningCreations/lccc">https://github.com/LightningCreations/lccc</a> has a few examples, both for it's stdlib (<a href="https://github.com/LightningCreations/lccc/blob/main/lcrust/libraries/libstd/build.rs">https://github.com/LightningCreations/lccc/blob/main/lcrust/libraries/libstd/build.rs</a>), and in the host (though the checks in xlang_host are not yet complete, it will be similar in that it calls out to the C compiler and tries to compile a bunch of programs autotools style).</p>



<a name="265729671"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265729671" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265729671">(Dec 21 2021 at 20:17)</a>:</h4>
<p>(... I forgot I removed the libstd checks to refactor, and never actually did complete the refactor)</p>



<a name="265729758"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265729758" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265729758">(Dec 21 2021 at 20:18)</a>:</h4>
<p>TL;DR, instead of hardcoding a bunch of platforms, I test for the features I need, usually by asking the C compiler nicely.</p>



<a name="265731410"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265731410" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Edward Shen <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265731410">(Dec 21 2021 at 20:35)</a>:</h4>
<p>Re: threat modeling; I'll incorporate that feedback as changes into the MCP when I get a chance. But otherwise, you have the gist of it.</p>
<p>We're specifically targeting malicious dependencies that try to exfiltrate data at build-time, via a malicious proc-macro or build script. We assume that the prod environment is sufficiently secured such that malicious actors aren't able to do anything if they get malicious code running (e.g. there's network mitigations in place).</p>
<p>We can't strictly apply the same security measures on our prod hosts as we do with our CI as there's necessary holes we need to make in our security for CI to be functional (network access, for example, to fetch resources). As a result, we need a mitigation lower in the stack to help with this; this is that mitigation.</p>
<p>This is a very weak layer of defense, and there are other ways for malware to bypass this as people have mentioned, but the goal here is to block the lowest hanging fruit. Forcing malicious actors to defer to runtime or to tests (which a can be a good security followup), where other mitigations should be in place, is the entire goal. We can build upon this layer of defense later; but for now _something_ is better than _nothing_, in my opinion.</p>
<p>This MCP (because of it's scope) only targets build time, but isolating tests would be a good follow-up.</p>
<p>I hope this threat model address your concerns. Please feel free to give feedback as well; I'd very much appreciate it.</p>



<a name="265732063"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265732063" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Edward Shen <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265732063">(Dec 21 2021 at 20:42)</a>:</h4>
<p><span class="user-mention silent" data-user-id="257758">Connor Horman</span> <a href="#narrow/stream/233931-t-compiler.2Fmajor-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475/near/265729591">said</a>:</p>
<blockquote>
<p><a href="https://github.com/LightningCreations/lccc">https://github.com/LightningCreations/lccc</a> has a few examples, both for it's stdlib (<a href="https://github.com/LightningCreations/lccc/blob/main/lcrust/libraries/libstd/build.rs">https://github.com/LightningCreations/lccc/blob/main/lcrust/libraries/libstd/build.rs</a>), and in the host (though the checks in xlang_host are not yet complete, it will be similar in that it calls out to the C compiler and tries to compile a bunch of programs autotools style).</p>
</blockquote>
<p>Thanks, I'll take a glance at this later!</p>



<a name="265733692"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265733692" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265733692">(Dec 21 2021 at 21:01)</a>:</h4>
<blockquote>
<p>as we do with our CI as there's necessary holes we need to make in our security for CI to be functional (network access, for example, to fetch resources)</p>
</blockquote>
<p>Couldn't this also be achieved by cargo vendor/cargo --offline &amp; co and then doing the actual build in a similarly isolated environment as prod?<br>
Also, the "prod is isolated" argument might not be applicable for many uses.</p>



<a name="265733888"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265733888" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265733888">(Dec 21 2021 at 21:03)</a>:</h4>
<p>I mean I can see some uses, but they quite process-specific</p>



<a name="265734281"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265734281" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265734281">(Dec 21 2021 at 21:07)</a>:</h4>
<p>I don't think this has to support all use-cases to start with (or maybe ever) to be useful</p>



<a name="265734381"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265734381" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265734381">(Dec 21 2021 at 21:08)</a>:</h4>
<p>For the reproducible build use-cases, I think it would be great to be able to guarantee that a pure-rust crate graph isn't pulling the contents of arbitrary files / network requests into the build</p>



<a name="265734556"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265734556" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265734556">(Dec 21 2021 at 21:10)</a>:</h4>
<p>If I'm just running <code>cargo build; cargo clean; cargo build</code>, then the output could still be depending on my system in some undesirable way - however, I won't know if that dependency happens to stay unchanged across by two builds</p>



<a name="265734665"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265734665" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265734665">(Dec 21 2021 at 21:11)</a>:</h4>
<p>Being able to isolate proc macros (and maybe see a report that "X out of Y proc macros in your graph support isolation" would be very useful</p>



<a name="265738196"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265738196" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265738196">(Dec 21 2021 at 21:45)</a>:</h4>
<p>ability to ship wasm or similarly portable precompiled build scripts and proc-macros in crates is another very desirable feature which can make whatever is being attempted here easier to push through.</p>



<a name="265738378"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265738378" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265738378">(Dec 21 2021 at 21:47)</a>:</h4>
<p>In the other direction, it may make sense to approach this piecemeal. <code>build.rs</code> scripts are entirely a concern of Cargo team and proc macros are mostly a concern of the compiler team. Having those be separate efforts, even if the effort is towards the same goals, may make it easier to get something to experiment with first and then the other side can be easier to motivate.</p>



<a name="265740509"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265740509" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Edward Shen <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265740509">(Dec 21 2021 at 22:10)</a>:</h4>
<p><span class="user-mention silent" data-user-id="123586">nagisa</span> <a href="#narrow/stream/233931-t-compiler.2Fmajor-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475/near/265738378">said</a>:</p>
<blockquote>
<p>In the other direction, it may make sense to approach this piecemeal. <code>build.rs</code> scripts are entirely a concern of Cargo team and proc macros are mostly a concern of the compiler team. Having those be separate efforts, even if the effort is towards the same goals, may make it easier to get something to experiment with first and then the other side can be easier to motivate.</p>
</blockquote>
<p>Yeah, this MCP is intended to be relatively broad and unspecific as I expected talking about implementation details too heavily won't get anything moving at all. The goal here was to have a north star in terms of  "hey this is what we want to work towards" and lay enough groundwork for people to think "yeah this is possible and we can work towards it".</p>
<p>Implementation of this will likely be incremental and modular. Other than getting an sandboxing environment in first, what we decide to work towards after will likely depend on the situation at the time (who's available to mentor, if a working group is formed then the opinions on it, etc). I personally think going for proc macros first might be a good way to experiment and ease-in, since we have a lot more prior artwork for it, but of course, I am open to other opinions as well once the time arrives.</p>



<a name="265741025"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265741025" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265741025">(Dec 21 2021 at 22:13)</a>:</h4>
<p><span class="user-mention" data-user-id="462933">@Edward Shen</span> I think a standalone wasm runtime with wasi support is the right answer as well. wasmtime seems ideal.</p>



<a name="265741171"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265741171" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265741171">(Dec 21 2021 at 22:15)</a>:</h4>
<p>I also love the idea of preventing network access, or access to the home directory other than the source dir.</p>



<a name="265744782"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265744782" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Edward Shen <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265744782">(Dec 21 2021 at 22:58)</a>:</h4>
<p>Just want to thank everyone here again! I've incorporated the discussion here as part of the MCP. Let me know if I've missed something or if there's any additional feedback :)</p>



<a name="265792631"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265792631" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265792631">(Dec 22 2021 at 11:17)</a>:</h4>
<p><span class="user-mention silent" data-user-id="123586">nagisa</span> <a href="#narrow/stream/233931-t-compiler.2Fmajor-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475/near/265738378">said</a>:</p>
<blockquote>
<p>In the other direction, it may make sense to approach this piecemeal. <code>build.rs</code> scripts are entirely a concern of Cargo team and proc macros are mostly a concern of the compiler team. Having those be separate efforts, even if the effort is towards the same goals, may make it easier to get something to experiment with first and then the other side can be easier to motivate.</p>
</blockquote>
<p>Yeah, focusing at the start on proc macros seems best to me, also because I <em>think</em> they will have the biggest impact compared to sandboxing build scripts. Most build scripts need to interact with the host system (git, c compiler...), while a lot of proc macros don't need any access in addition to the input token stream. Having a sandbox with no exceptions would allow a lot of proc macros to leverage it, while it would prevent most build scripts from doing so.</p>



<a name="265792706"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265792706" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265792706">(Dec 22 2021 at 11:18)</a>:</h4>
<p>Also, this seems too "big" for a compiler team MCP? Considering we'll need to decide on the sandbox runtime, what APIs it will allow and how to best expose it, this seems to be RFC-worthy.</p>



<a name="265825396"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265825396" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Chin (eminence) <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265825396">(Dec 22 2021 at 16:43)</a>:</h4>
<p>I think I share the same intuition as <span class="user-mention" data-user-id="121055">@Pietro Albini</span>  -- <a href="http://build.rs">build.rs</a> scripts are much more likely to touch external resources, while proc macros are more likely to just operate on the token stream.  I wonder if there's a way to analyze published proc macros and see how many of them depend only on syn/quote and how many depend on other things</p>



<a name="265827006"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265827006" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Chin (eminence) <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265827006">(Dec 22 2021 at 16:58)</a>:</h4>
<p>(hmm, not as easy as I was hoping:  the crates.io-index entries don't indicate if a crate is a proc-macro -- you have to download and inspect the Cargo.toml to learn if it's a proc macro or not)</p>



<a name="265827519"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265827519" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265827519">(Dec 22 2021 at 17:02)</a>:</h4>
<p><a href="https://www.pietroalbini.org/blog/downloading-crates-io/">https://www.pietroalbini.org/blog/downloading-crates-io/</a></p>



<a name="265832526"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265832526" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Edward Shen <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265832526">(Dec 22 2021 at 17:48)</a>:</h4>
<p><span class="user-mention silent" data-user-id="121055">Pietro Albini</span> <a href="#narrow/stream/233931-t-compiler.2Fmajor-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475/near/265792706">said</a>:</p>
<blockquote>
<p>Also, this seems too "big" for a compiler team MCP? Considering we'll need to decide on the sandbox runtime, what APIs it will allow and how to best expose it, this seems to be RFC-worthy.</p>
</blockquote>
<p>I was suggested to write an MCP first by <span class="user-mention" data-user-id="239881">@Josh Triplett</span> , and once the MCP gets approved to then write proper RFCs (whether that be alone or with a working group). My understanding is that this MCP is more for visibility than anything.</p>



<a name="265832689"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265832689" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265832689">(Dec 22 2021 at 17:49)</a>:</h4>
<p>Right. I <em>do</em> think this will need an RFC or two, but it made sense to me that it might want to start with a proposal, rough alignment and requirements discussion, experimentation, and then an RFC.</p>



<a name="265948216"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265948216" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Edward Shen <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265948216">(Dec 23 2021 at 19:53)</a>:</h4>
<p><span class="user-mention silent" data-user-id="222286">Andrew Chin (eminence)</span> <a href="#narrow/stream/233931-t-compiler.2Fmajor-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475/near/265827006">said</a>:</p>
<blockquote>
<p>(hmm, not as easy as I was hoping:  the crates.io-index entries don't indicate if a crate is a proc-macro -- you have to download and inspect the Cargo.toml to learn if it's a proc macro or not)</p>
</blockquote>
<p>I've sent an email to <a href="mailto:help@crates.io">help@crates.io</a> to see if they can accommodate exposing whether or not a crate is a proc-macro or not. Hopefully we'll hear back soon with good news!</p>



<a name="265961474"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265961474" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Chin (eminence) <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265961474">(Dec 23 2021 at 23:07)</a>:</h4>
<p>I'm already downloading the latest version of every crate (36k downloaded so far), with the idea of seeing how many are proc macros (and then looking at their dependencies).  It's a fun holiday project.  I'll for sure report back to this thread with the results.  But feel free to also poke at this too</p>



<a name="265970293"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265970293" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Edward Shen <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265970293">(Dec 24 2021 at 02:03)</a>:</h4>
<p>Oh whoops, I didn't see your message. I've spent today writing a <a href="https://github.com/edward-shen/proc-macro-stats">script</a> that fetches from <a href="http://static.crates.io">static.crates.io</a> and have some results.</p>
<p>The script utilizes the git index to get all crate names, and fetches and caches Cargo.toml files on disk, so hacking on this should be pretty easy and won't constantly redownload Cargo.toml files. I used natural rate limiting (blocking network requests + rayon) so your mileage may vary on speed, but it doesn't take long to download it all.</p>
<p>Out of the snapshot I took of 71036 crates, only 3397 have <code>lib.proc-macro</code> set to <code>true</code>.  Of those 3397, 1716 have non-standard dependencies (where "standard dependencies" are <code>syn</code>, <code>quote</code>, and <code>proc-macro2</code>; this might need fine tuning).</p>
<p>I've posted the data in that repo (see <code>data</code> for a proc-macro to dependency mapping, and <code>stats</code> for counts of dependencies). I don't have anything conclusive at this time, but just letting people know if they want to investigate for themselves.</p>



<a name="265970436"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265970436" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Chin (eminence) <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265970436">(Dec 24 2021 at 02:07)</a>:</h4>
<p>Is it worth taking a sample of those 1716 proc macros to see if they may or may not work well in a highly constrained wasm sandbox?</p>



<a name="265970520"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265970520" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Edward Shen <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265970520">(Dec 24 2021 at 02:09)</a>:</h4>
<p>Maybe! I think that number is conservative; included in that count of  1716 crates are proc macros for the actual crate. e.g. <code>axum-debug-macros</code> has a non-standard dependency of <code>axum</code>, which makes sense</p>



<a name="265970811"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265970811" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Chin (eminence) <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265970811">(Dec 24 2021 at 02:16)</a>:</h4>
<p>Yeah</p>



<a name="265970818"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265970818" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Edward Shen <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265970818">(Dec 24 2021 at 02:16)</a>:</h4>
<p>Yeah, I think this script needs support for recursive dependencies but that's a headache I'd rather not tackle for today.</p>
<p>In the mean time I'm going to see which direct dependencies we can ignore; stuff like, <code>proc-macro-{crate,hack,error}</code>, <code>heck</code>, <code>darling</code>, and <code>lazy_static</code> are just some of the more popular ones, and that cuts it down to 1352 crates.</p>



<a name="265970879"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265970879" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Chin (eminence) <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265970879">(Dec 24 2021 at 02:18)</a>:</h4>
<p>I'm still having fun with this coding project, so I'll continue to try to get more data.  But if the theory is that "proc macros would be a good initial focus for sandboxing", maybe we don't need hard data to actually make the MPC/RFC.  Maybe we just declare this, and then in the background continue to do some research and data collection.</p>



<a name="265970942"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265970942" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Edward Shen <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265970942">(Dec 24 2021 at 02:20)</a>:</h4>
<p>Yeah, I'd like to have independent confirmation of my results too. That will definitely be helpful in finding weirdness, I think.</p>



<a name="265971134"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265971134" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Chin (eminence) <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265971134">(Dec 24 2021 at 02:25)</a>:</h4>
<p>I'll soon share my code soon.  I've gotten some crazy ideas that's leading me down some tangents, like being able to compile an arbitrary "filter function" to wasm, which can be loaded at runtime to find crates of interest.  But that's pretty off-topic for this thread, so I won't say much more about it.  I can ping you with details later, if you want</p>



<a name="265971982"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265971982" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Edward Shen <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265971982">(Dec 24 2021 at 02:47)</a>:</h4>
<p>I added some crates that I knew should be pure and ignored proc macros with 1 or 0 dependencies (assuming those with a singular dependency is an associated crate) and I'm down to 223 proc macros, or about 6%. We can probably get lower; but I'm calling it here for tonight at least.</p>
<blockquote>
<p>I've gotten some crazy ideas that's leading me down some tangents, like being able to compile an arbitrary "filter function" to wasm, which can be loaded at runtime to find crates of interest.</p>
</blockquote>
<p>That's just cool! :) Plugin architecture is always something I've wanted to do in Rust but never got the chance to. But yeah, maybe best kept to a PM.</p>



<a name="265980796"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265980796" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265980796">(Dec 24 2021 at 06:21)</a>:</h4>
<p><span class="user-mention" data-user-id="462933">@Edward Shen</span> Can you post the list of 223 proc macro crates somewhere?</p>



<a name="265981472"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265981472" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Edward Shen <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265981472">(Dec 24 2021 at 06:38)</a>:</h4>
<p>Sorry; I got confused earlier; I confused the proc macro with their dependencies in the code. Of the 3397 proc macros, 1110 proc macros have "non-standard" dependencies. Of those 1110 proc macros, only 402 have &gt; 1 dependency. Here's the list of the 402 proc macros: <a href="/user_uploads/4715/PgfphoRko4RnpCCDaZNEyygA/data">data</a></p>
<p>To clarify, this list only maps a proc macro to it's "non-standard" deps; the standard ones have been removed for clarity.</p>



<a name="265981538"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265981538" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Edward Shen <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265981538">(Dec 24 2021 at 06:38)</a>:</h4>
<p>Let me know if you need less filtering of that or in a different format (I posted src if you also want to fiddle around with it as well)</p>



<a name="265981662"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/265981662" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Edward Shen <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#265981662">(Dec 24 2021 at 06:41)</a>:</h4>
<p>Actually, here's the list of the full 1100 proc macros as well, since it was easy for me to do: <a href="/user_uploads/4715/2kBs_JBO-RoKx27Y2l_oHCEA/data">data</a></p>



<a name="266025652"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/266025652" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Chin (eminence) <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#266025652">(Dec 24 2021 at 21:45)</a>:</h4>
<p>Here's a few interesting and popular procmacros that currently do something that's not easily sandboxed:</p>
<ul>
<li><a href="https://github.com/dtolnay/rustversion">https://github.com/dtolnay/rustversion</a> -- Uses a <a href="http://build.rs">build.rs</a> script to get the current rustc version, to allow for conditional compilation based on rust version</li>
<li><a href="https://crates.io/crates/migrations_macros/">https://crates.io/crates/migrations_macros/</a> -- From the diesel project, looks like it can read migration files from disk at compile time to embed into a project</li>
<li><a href="https://github.com/SergioBenitez/Rocket/tree/master/core/codegen">https://github.com/SergioBenitez/Rocket/tree/master/core/codegen</a> -- I can't tell exactly what this does, but it will read files from $CARGO_MANIFEST_DIR</li>
<li><a href="https://crates.io/crates/sqlx-macros">https://crates.io/crates/sqlx-macros</a> -- I think this might actually talk to a live database server</li>
</ul>
<p>(Will update this msg later as I find more)</p>



<a name="266026673"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/266026673" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#266026673">(Dec 24 2021 at 22:09)</a>:</h4>
<p>Reading files from the source directory should be fine even for sandboxed proc macros, right?</p>



<a name="266026924"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/266026924" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Chin (eminence) <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#266026924">(Dec 24 2021 at 22:15)</a>:</h4>
<p>Yes, we probably would want to allow that (but doing so would require WASI and support from the sandboxing runtime)</p>



<a name="266027568"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/266027568" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#266027568">(Dec 24 2021 at 22:32)</a>:</h4>
<p>we'd want to eventually have some way of having a separate api or just intercepting <code>File</code> anyway for cargo tracking which files a proc macro depends on so it knows when to rebuild, sandboxing with wasi is a good way to intercept that</p>



<a name="266038251"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/266038251" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Chin (eminence) <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#266038251">(Dec 25 2021 at 03:04)</a>:</h4>
<p>I suspect that proc-macros and build scripts might need to opt-in to sandboxing (which is essentially the 'separate api'), at least at the start</p>



<a name="266049958"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/266049958" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#266049958">(Dec 25 2021 at 08:57)</a>:</h4>
<p>We could have a separate target for sandboxed proc macros. This target could be implemented using wasm+wasi for sandboxing or the native target for codegen backends that don't support wasm or if something better pops up. (maybe a custom syscall interface is better suited for proc macros)</p>



<a name="266061601"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/266061601" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#266061601">(Dec 25 2021 at 14:28)</a>:</h4>
<p>Like <a href="https://crates.io/crates/watt">https://crates.io/crates/watt</a> but motivated by sandboxing instead of ahead-of-time compilation.</p>



<a name="266061618"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/266061618" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#266061618">(Dec 25 2021 at 14:29)</a>:</h4>
<p>(watt does mention isolation already)</p>



<a name="266094906"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/266094906" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#266094906">(Dec 26 2021 at 06:42)</a>:</h4>
<p>It could be motivated by both.</p>



<a name="266094921"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/266094921" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#266094921">(Dec 26 2021 at 06:43)</a>:</h4>
<p>Such a target would be a good candidate for the oft discussed proposals to precompile binary artifacts on <a href="http://crates.io">crates.io</a>.</p>



<a name="266102659"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/266102659" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#266102659">(Dec 26 2021 at 10:18)</a>:</h4>
<p>precompiled binaries on <a href="http://crates.io">crates.io</a> get really complex really fast</p>



<a name="266102724"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/266102724" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#266102724">(Dec 26 2021 at 10:20)</a>:</h4>
<ul>
<li>the compiler will have to offer a stable ABI for proc macros, otherwise we'd have to rebuild everything every six weeks</li>
<li>how will new dependencies versions be handled?</li>
</ul>



<a name="266116663"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/266116663" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#266116663">(Dec 26 2021 at 16:32)</a>:</h4>
<p>Yeah, I'd rather see focus on the isolation part, still compiling from source and representing everything in <code>Cargo.lock</code>/tree/vendor/etc.</p>



<a name="266123898"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/266123898" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Weimer <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#266123898">(Dec 26 2021 at 19:21)</a>:</h4>
<p>I'm worried that every sandbox escape and many vulnerability in the libraries bundled within the sandboxed environment would have to be treated as a <em>Rust</em> security vulnerability once this is adopted.</p>



<a name="266125825"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/266125825" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Quy Nguyen <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#266125825">(Dec 26 2021 at 20:14)</a>:</h4>
<p>Right now, every proc macro and/or buildscript is a possible security vulnerability, so that's a defeatist attitude I think. I'd think a good approach would be to compile everything from source to WASI/WASM. This lets us punt on the stable ABI side of things (although it would be a pretty good extension).</p>



<a name="266127581"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/266127581" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#266127581">(Dec 26 2021 at 21:03)</a>:</h4>
<p>I think the concern is that if one makes security promises people may start relying on them and shift their expectations. And once those new expectations are violated there'll be demand for fixing things on short timelines. So the increased maintenance should be considered or disclaimed.</p>



<a name="266127582"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/266127582" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#266127582">(Dec 26 2021 at 21:03)</a>:</h4>
<p><span class="user-mention" data-user-id="121055">@Pietro Albini</span> I would expect wasm-targeted proc macros to have a stable wasm ABI.</p>



<a name="266127691"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/266127691" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#266127691">(Dec 26 2021 at 21:06)</a>:</h4>
<p>I agree that new dependency versions would be an issue, but many common proc macro crates don't actually have their dependencies change that often, or at least not substantially more often than themselves. So the bigger issue would be if some crate had a <code>&lt;</code> or <code>=</code> constraint on a dependency shared with the proc macro crate, and since crates typically <em>shouldn't</em> use <code>&lt;</code> or <code>=</code> constraints, I think it'd be fine if crates that do end up having to rebuild from source.</p>



<a name="266128959"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/266128959" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#266128959">(Dec 26 2021 at 21:39)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/233931-t-compiler.2Fmajor-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475/near/266127691">said</a>:</p>
<blockquote>
<p>I agree that new dependency versions would be an issue, but many common proc macro crates don't actually have their dependencies change that often, or at least not substantially more often than themselves. So the bigger issue would be if some crate had a <code>&lt;</code> or <code>=</code> constraint on a dependency shared with the proc macro crate, and since crates typically <em>shouldn't</em> use <code>&lt;</code> or <code>=</code> constraints, I think it'd be fine if crates that do end up having to rebuild from source.</p>
</blockquote>
<p>I don't think that's the only case. I could see a project wanting to bump to a newer <code>syn</code> version to gain support for new syntax, or pinning a specific version of a dependency to avoid a regression.</p>



<a name="266129029"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/266129029" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#266129029">(Dec 26 2021 at 21:41)</a>:</h4>
<p>(anyway, I think it's better to focus first on having compile-time wasm sandboxing, which doesn't have the abi nor deps issue, and then later think about redistributing precompiled macros)</p>



<a name="266130681"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/266130681" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#266130681">(Dec 26 2021 at 22:22)</a>:</h4>
<p>Why would wasm proc macros have a stable abi when regular proc macros don't?</p>



<a name="266130713"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/266130713" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#266130713">(Dec 26 2021 at 22:23)</a>:</h4>
<p>Regular proc macros already don't depend on the rust abi. The abi is defined in terms of the C abi yo ensure building rustc itself can use proc macros.</p>



<a name="266130838"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/266130838" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#266130838">(Dec 26 2021 at 22:26)</a>:</h4>
<p>The abi changes because we change the crate metadata format (used to encode what macros exist in the crate), because we add or remove exposed interfaces and because we move code between the proc macro client and server side (this can reduce the amount of calls between both sides which are slow, especially when sandboxing or possibly in the future running on another thread.)</p>



<a name="266131072"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/266131072" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#266131072">(Dec 26 2021 at 22:32)</a>:</h4>
<p><span class="user-mention silent" data-user-id="133247">bjorn3</span> <a href="#narrow/stream/233931-t-compiler.2Fmajor-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475/near/266130713">said</a>:</p>
<blockquote>
<p>Regular proc macros already don't depend on the rust abi. The abi is defined in terms of the C abi yo ensure building rustc itself can use proc macros.</p>
</blockquote>
<p>It's not specified, though, so even though rustc internally uses the C abi, it's fairly moot as soon as we get anything other than rustc. Unless rust wants to specify the abi of everything in <code>proc_macro</code> as well.</p>



<a name="266131225"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/266131225" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#266131225">(Dec 26 2021 at 22:36)</a>:</h4>
<p><span class="user-mention silent" data-user-id="133247">bjorn3</span> <a href="#narrow/stream/233931-t-compiler.2Fmajor-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475/near/266130681">said</a>:</p>
<blockquote>
<p>Why would wasm proc macros have a stable abi when regular proc macros don't?</p>
</blockquote>
<p>the stable ABI is needed to make precompiled macros available through <a href="http://crates.io">crates.io</a> (or well, a related service like we did with <a href="http://docs.rs">docs.rs</a>) a possibility, if we want to do so (would be nice!)</p>



<a name="266131238"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/266131238" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#266131238">(Dec 26 2021 at 22:37)</a>:</h4>
<p>otherwise we'd need to rebuild all proc macros every time a stable compiler comes out, and we wouldn't be able to support nightly and beta (as rebuilding everything every day is really not feasible)</p>



<a name="266131284"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/266131284" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#266131284">(Dec 26 2021 at 22:38)</a>:</h4>
<p><span class="user-mention silent" data-user-id="121055">Pietro Albini</span> <a href="#narrow/stream/233931-t-compiler.2Fmajor-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475/near/266129029">said</a>:</p>
<blockquote>
<p>(anyway, I think it's better to focus first on having compile-time wasm sandboxing, which doesn't have the abi nor deps issue, and then later think about redistributing precompiled macros)</p>
</blockquote>
<p>but like, it'd be better to just focus first on one thing and then incrementally make progress on the others, otherwise we'll never finish designing this <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="266131500"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/266131500" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#266131500">(Dec 26 2021 at 22:45)</a>:</h4>
<blockquote>
<p>It's not specified, though, so even though rustc internally uses the C abi, it's fairly moot as soon as we get anything other than rustc. Unless rust wants to specify the abi of everything in <code>proc_macro</code> as well.</p>
</blockquote>
<p>My posts after the post you quoted say that too. I was explaining why non-wasm vs wasm shouldn't matter for the proc macro abi stability.</p>



<a name="266132211"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/266132211" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#266132211">(Dec 26 2021 at 23:03)</a>:</h4>
<p><span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span> sorry it's late</p>



<a name="266133587"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/266133587" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Edward Shen <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#266133587">(Dec 26 2021 at 23:39)</a>:</h4>
<p>Thanks folks for the activity! I really do appreciate that this is getting attention, espeically during the holiday season. I've updated the MCP to include notes on maintenance costs (w.r.t bugs in sandboxing becoming a Rust vulnerability) and made a list of explicit items not in scope, including binary artifact distribution on <a href="http://crates.io">crates.io</a>. I agree with the sentiment that considering that feature now is too much, and that something like that should be deferred for consideration after this feature is accepted and implemented.</p>
<p>As always, please let me know if I missed a concern!</p>



<a name="267000140"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/267000140" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#267000140">(Jan 05 2022 at 22:22)</a>:</h4>
<p>From reading through the discussion, it seems like there's lots of opinions on what exactly this should (or should not) look like, but no objections to the idea of sandboxing itself</p>



<a name="267000265"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/267000265" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#267000265">(Jan 05 2022 at 22:23)</a>:</h4>
<p>As I understand it, the purpose of this MCP is ensure acceptance of the overall idea, and then to begin discussing the design and implementation in more detail</p>



<a name="267000365"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/267000365" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#267000365">(Jan 05 2022 at 22:24)</a>:</h4>
<p>Unless anyone objects to my summary, I'm going to second this proposal</p>



<a name="267004417"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/267004417" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#267004417">(Jan 05 2022 at 23:04)</a>:</h4>
<p>I was sort under an impression that it was more a discussion about scope and less about an implementation approach.</p>



<a name="267004486"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/267004486" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#267004486">(Jan 05 2022 at 23:04)</a>:</h4>
<p>Seems to be fairly universally accepted that the sandboxing would involve a wasm runtime of some sort, at least.</p>



<a name="267004630"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/267004630" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#267004630">(Jan 05 2022 at 23:05)</a>:</h4>
<p>I mean that the design and implementation would occur after it's accepted</p>



<a name="267005314"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/267005314" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#267005314">(Jan 05 2022 at 23:12)</a>:</h4>
<p>I do think that we should, before the MCP gets seconded, agree on the different scopes that should be treated independently.</p>



<a name="267005368"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/267005368" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#267005368">(Jan 05 2022 at 23:13)</a>:</h4>
<p>For instance, I think it's important to observe that sandboxing of proc macros is very different from sandboxing of build scripts, and that there's value in doing the former even if we haven't yet done the latter.</p>



<a name="267005403"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/267005403" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#267005403">(Jan 05 2022 at 23:13)</a>:</h4>
<p>With that caveat, I completely agree that the right approach here is to green-light experimentation with possible designs.</p>



<a name="267520705"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/267520705" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Edward Shen <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#267520705">(Jan 11 2022 at 00:15)</a>:</h4>
<p>Sounds good. Is there anything else blocking this or for me to address? Or can we move ahead with a second (and full approval and FCP?)?</p>



<a name="270237663"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/270237663" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Quy Nguyen <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#270237663">(Feb 01 2022 at 16:13)</a>:</h4>
<p>Any update on this? Are we waiting on a meeting or clarification for this to move forward or did this simply fall through the cracks?</p>



<a name="270905429"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/233931-t-compiler/major%20changes/topic/Build-time%20execution%20sandboxing%20compiler-team%23475/near/270905429" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Edward Shen <a href="https://zulip-archive.rust-lang.org/stream/233931-t-compiler/major-changes/topic/Build-time.20execution.20sandboxing.20compiler-team.23475.html#270905429">(Feb 06 2022 at 19:00)</a>:</h4>
<p>Not sure. I think we just need someone to second this (followed by a FCP?) as there isn't much concern with this, but I think people are just busy and haven't gotten back to this issue yet.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>