<html>
<head><meta charset="utf-8"><title>Delayed awaiting · wg-async · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/index.html">wg-async</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Delayed.20awaiting.html">Delayed awaiting</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="249890870"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Delayed%20awaiting/near/249890870" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eholk <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Delayed.20awaiting.html#249890870">(Aug 18 2021 at 18:18)</a>:</h4>
<p>Currently you can do something like this:</p>
<div class="codehilite"><pre><span></span><code>let future = async_function_call();
... do other stuff ...
let result = future.await;
</code></pre></div>
<p>Is there any reason to do that? In theory it would allow eager execution so that the eventual <code>await</code> call returns immediately if the future got done before we needed it. However, Rust doesn't do anything with futures until they are polled, so it seems like the main benefit of not immediately awaiting doesn't apply.</p>



<a name="249893053"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Delayed%20awaiting/near/249893053" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rpjohnst <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Delayed.20awaiting.html#249893053">(Aug 18 2021 at 18:35)</a>:</h4>
<p>right, there's not much point to that pattern in rust. the equivalent pattern  if you do want some amount of concurrency is to spawn the future as a new task, or else use some combinator like <code>join!</code> or <code>select!</code></p>



<a name="249915149"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Delayed%20awaiting/near/249915149" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Delayed.20awaiting.html#249915149">(Aug 18 2021 at 21:37)</a>:</h4>
<p>spawned task handles are actually a decent use case for this pattern, since they allow for the "concurrency in the meantime" you're talking about, while still allowing you to sequence operations after the spawned code</p>



<a name="249923315"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Delayed%20awaiting/near/249923315" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eholk <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Delayed.20awaiting.html#249923315">(Aug 18 2021 at 23:17)</a>:</h4>
<p>So would that look something like this?</p>
<div class="codehilite"><pre><span></span><code>let handle = spawn(async { do_some_computation() });
do_some_stuff_in_the_meantime();
let result = handle.await;
</code></pre></div>



<a name="249923380"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Delayed%20awaiting/near/249923380" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eholk <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Delayed.20awaiting.html#249923380">(Aug 18 2021 at 23:18)</a>:</h4>
<p>Where <code>handle.await</code> is basically the same as <code>join!</code></p>



<a name="249923565"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Delayed%20awaiting/near/249923565" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Delayed.20awaiting.html#249923565">(Aug 18 2021 at 23:21)</a>:</h4>
<p><code>join!</code> in future land is quite distinct</p>



<a name="249923583"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Delayed%20awaiting/near/249923583" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Delayed.20awaiting.html#249923583">(Aug 18 2021 at 23:21)</a>:</h4>
<p>but <code>handle.await</code> is basically the same as "joining a thread" in that case</p>



<a name="250141953"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Delayed%20awaiting/near/250141953" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Delayed.20awaiting.html#250141953">(Aug 20 2021 at 16:38)</a>:</h4>
<p><span class="user-mention silent" data-user-id="421986">eholk</span> <a href="#narrow/stream/187312-wg-async-foundations/topic/Delayed.20awaiting/near/249923315">said</a>:</p>
<blockquote>
<p>So would that look something like this?</p>
<p><div class="codehilite"><pre><span></span><code>let handle = spawn(async { do_some_computation() });
do_some_stuff_in_the_meantime();
let result = handle.await;
</code></pre></div><br>
</p>
</blockquote>
<p>Very common is this:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">handles</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Vec</span>::<span class="n">with_capacity</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span><span class="w"></span>
<span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">0</span><span class="o">..</span><span class="mi">10</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">handles</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">spawn</span><span class="p">(</span><span class="n">reqwest</span>::<span class="n">get</span><span class="p">(</span><span class="s">"..."</span><span class="p">)));</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">for</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">handles</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">h</span><span class="p">.</span><span class="k">await</span><span class="p">.</span><span class="n">unwrap</span><span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>