<html>
<head><meta charset="utf-8"><title>join! · wg-async · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/index.html">wg-async</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html">join!</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="264059800"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264059800" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264059800">(Dec 07 2021 at 19:38)</a>:</h4>
<p>Do you think <code>std::future::join!</code> requires an RFC or could I just PR it?</p>



<a name="264059876"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264059876" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264059876">(Dec 07 2021 at 19:39)</a>:</h4>
<p>The variadic version</p>



<a name="264060331"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264060331" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264060331">(Dec 07 2021 at 19:42)</a>:</h4>
<p>I think an unstable version could just be a PR with an r+ or <em>at most</em> an FCP.</p>



<a name="264060839"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264060839" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264060839">(Dec 07 2021 at 19:45)</a>:</h4>
<p>Aren't macros insta-stable?</p>



<a name="264061101"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264061101" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264061101">(Dec 07 2021 at 19:47)</a>:</h4>
<p>Oh, hmmm. For some reason I thought it was possible to have an unstable macro. If it's not then yeah, it'd need <em>at least</em> an FCP if not an RFC.</p>



<a name="264061286"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264061286" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264061286">(Dec 07 2021 at 19:48)</a>:</h4>
<p>It looks like <code>#[unstable</code> can be applied to <code>macro_rules!</code>.</p>



<a name="264061345"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264061345" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264061345">(Dec 07 2021 at 19:49)</a>:</h4>
<p>Oh I was under the impression that it couldn't</p>



<a name="264061427"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264061427" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264061427">(Dec 07 2021 at 19:49)</a>:</h4>
<p><code>library/stdarch/crates/std_detect/src/detect/error_macros.rs</code></p>



<a name="264061437"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264061437" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264061437">(Dec 07 2021 at 19:49)</a>:</h4>
<p>I think it would be a proc-macro though</p>



<a name="264061542"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264061542" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264061542">(Dec 07 2021 at 19:50)</a>:</h4>
<p>It's possible to write as a macro_rules! macro, though it might not be the most efficient implementation.</p>



<a name="264061595"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264061595" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264061595">(Dec 07 2021 at 19:50)</a>:</h4>
<p>I don't think it affects efficiency</p>



<a name="264061761"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264061761" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264061761">(Dec 07 2021 at 19:52)</a>:</h4>
<p><a href="https://docs.rs/tokio/latest/src/tokio/macros/join.rs.html#57-119">https://docs.rs/tokio/latest/src/tokio/macros/join.rs.html#57-119</a></p>



<a name="264061905"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264061905" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264061905">(Dec 07 2021 at 19:53)</a>:</h4>
<p>Ah so it looks like decl macros 1.0 were insta-stable, but 2.0s aren't</p>



<a name="264062004"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264062004" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264062004">(Dec 07 2021 at 19:53)</a>:</h4>
<p>A decl macro implementation would have to be recursive</p>



<a name="264062141"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264062141" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264062141">(Dec 07 2021 at 19:54)</a>:</h4>
<p>That doesn't seem like a critical issue; it seems unlikely to call <code>join!(...)</code> on thousands of arguments.</p>



<a name="264063808"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264063808" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264063808">(Dec 07 2021 at 20:05)</a>:</h4>
<p>Can macros 2.0 currently use private items in the expansion?</p>



<a name="264086466"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264086466" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264086466">(Dec 07 2021 at 23:02)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#![feature(decl_macro)]</span><span class="w"></span>

<span class="k">pub</span><span class="w"> </span><span class="k">mod</span> <span class="nn">foo</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">struct</span> <span class="nc">Foo</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="kr">macro</span><span class="w"> </span><span class="n">foo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">Foo</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">mod</span> <span class="nn">bar</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">bar</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">crate</span>::<span class="n">foo</span>::<span class="n">foo</span><span class="o">!</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="264086479"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264086479" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264086479">(Dec 07 2021 at 23:02)</a>:</h4>
<p>Is this supposed to work?</p>



<a name="264086545"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264086545" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264086545">(Dec 07 2021 at 23:03)</a>:</h4>
<p>It's not right now</p>



<a name="264086587"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264086587" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264086587">(Dec 07 2021 at 23:03)</a>:</h4>
<p>The macro needs access to a <code>MaybeDone</code> type that stores the output of the future until all of them are done</p>



<a name="264086928"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264086928" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264086928">(Dec 07 2021 at 23:06)</a>:</h4>
<p>I guess it could generate the code for that with an extra tuple of options...</p>



<a name="264094428"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264094428" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264094428">(Dec 08 2021 at 00:15)</a>:</h4>
<p>That actually wouldn't work either, both the inner futures and the outer future need mutable access the the outputs</p>



<a name="264095205"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264095205" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264095205">(Dec 08 2021 at 00:24)</a>:</h4>
<p>I can't think of a good way to do this without adding a <code>MaybeDone</code> type to std.</p>



<a name="264101133"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264101133" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264101133">(Dec 08 2021 at 01:51)</a>:</h4>
<p>Scratch that, I got it working</p>



<a name="264101946"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264101946" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264101946">(Dec 08 2021 at 02:04)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/pull/91645">https://github.com/rust-lang/rust/pull/91645</a></p>



<a name="264149149"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264149149" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264149149">(Dec 08 2021 at 12:44)</a>:</h4>
<p><span class="user-mention silent" data-user-id="363998">Ibraheem Ahmed</span> <a href="#narrow/stream/187312-wg-async-foundations/topic/join!/near/264086479">said</a>:</p>
<blockquote>
<p>Is this supposed to work?</p>
</blockquote>
<p>There is a difference between <em>path</em> privacy and inherent <em>type</em> privacy. Your <code>Foo</code> there is type-private, but a <code>mod private { pub struct Foo; }</code> wouldn't. With the latter your <code>macro</code> approach would work, since proper hygiene is able to use the <em>path</em> privacy of the macro definition site, which in this instance would be able to access <code>private::Foo</code>.</p>



<a name="264149253"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264149253" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264149253">(Dec 08 2021 at 12:45)</a>:</h4>
<p>(This should sound very similar to trait-sealing requiring a <code>mod private { pub trait … }</code> rather than a non-<code>pub</code> <code>trait …</code>)</p>



<a name="264151130"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264151130" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264151130">(Dec 08 2021 at 13:02)</a>:</h4>
<p>Ah okay, that makes sense</p>



<a name="264151135"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264151135" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264151135">(Dec 08 2021 at 13:02)</a>:</h4>
<p>Thanks</p>



<a name="264224127"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264224127" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264224127">(Dec 08 2021 at 21:36)</a>:</h4>
<p><span class="user-mention" data-user-id="239881">@Josh Triplett</span> Do you think the return type of <code>join!</code> should be exposed publicly?</p>



<a name="264224251"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264224251" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264224251">(Dec 08 2021 at 21:36)</a>:</h4>
<p>I think it'd be fine for the <em>logical</em> return type of <code>join!</code> to be <code>impl Future</code>, personally.</p>



<a name="264224277"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264224277" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264224277">(Dec 08 2021 at 21:36)</a>:</h4>
<p>So in short, no.</p>



<a name="264229409"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264229409" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264229409">(Dec 08 2021 at 22:19)</a>:</h4>
<p>Ready for review :)</p>



<a name="264253158"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264253158" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264253158">(Dec 09 2021 at 03:44)</a>:</h4>
<p><span class="user-mention" data-user-id="363998">@Ibraheem Ahmed</span> Looks good to me. I'm going to go ahead and approve.</p>



<a name="264253183"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264253183" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264253183">(Dec 09 2021 at 03:45)</a>:</h4>
<p><span class="user-mention" data-user-id="363998">@Ibraheem Ahmed</span> One thought that crosses my mind: since it's a macro, and it does <code>async move</code> in the expansion, is there any possibility that it could unintentionally move something the caller owned and expected to be borrowed?</p>



<a name="264253208"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264253208" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264253208">(Dec 09 2021 at 03:45)</a>:</h4>
<p>I <em>think</em> it can't, but I don't fully know if <code>async move</code> has the right semantics for any possible macro argument.</p>



<a name="264254077"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264254077" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264254077">(Dec 09 2021 at 04:00)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/187312-wg-async-foundations/topic/join!/near/264253183">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="363998">Ibraheem Ahmed</span> One thought that crosses my mind: since it's a macro, and it does <code>async move</code> in the expansion, is there any possibility that it could unintentionally move something the caller owned and expected to be borrowed?</p>
</blockquote>
<p>Yeah I thought of that too, I added a basic test for an explicit borrow as a sanity check <a href="https://github.com/rust-lang/rust/blob/5478f439e13b55c7b9b858f76986786371b97c8f/library/core/tests/future.rs#L57">https://github.com/rust-lang/rust/blob/5478f439e13b55c7b9b858f76986786371b97c8f/library/core/tests/future.rs#L57</a>.</p>



<a name="264254231"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264254231" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264254231">(Dec 09 2021 at 04:03)</a>:</h4>
<p>To remove any uncertainty  it could return something like:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">struct</span> <span class="nc">JoinFut</span><span class="o">&lt;</span><span class="n">FutTuple</span><span class="p">,</span><span class="w"> </span><span class="n">PollFn</span><span class="o">&gt;</span><span class="p">(</span><span class="n">FutTuple</span><span class="p">,</span><span class="w"> </span><span class="n">PollFn</span><span class="p">);</span><span class="w"></span>
</code></pre></div>



<a name="264254345"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264254345" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264254345">(Dec 09 2021 at 04:04)</a>:</h4>
<p>That's actually why I was asking about publicly exposing the return type</p>



<a name="264254403"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264254403" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264254403">(Dec 09 2021 at 04:05)</a>:</h4>
<p>Although I guess leaving <code>JoinFut</code> public but unexported would work with macro hygiene right?</p>



<a name="264261603"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264261603" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264261603">(Dec 09 2021 at 06:20)</a>:</h4>
<p>I'm not actually sure what macros can get away with.</p>



<a name="264261608"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264261608" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264261608">(Dec 09 2021 at 06:20)</a>:</h4>
<p>I <em>think</em> if a macro constructs it, it might actually have to be a public type.</p>



<a name="264283626"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264283626" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264283626">(Dec 09 2021 at 10:51)</a>:</h4>
<p>Can we send PRs to futures-rs and other runtimes to re-export the std version rather than using their own?</p>



<a name="264293660"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264293660" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264293660">(Dec 09 2021 at 12:33)</a>:</h4>
<p>Wow, that was merged so fast! Faster than I could review <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span> </p>
<ul>
<li>I'd have expected the creator of <code>.ready()?</code> to use that in their own PR <span aria-label="stuck out tongue" class="emoji emoji-1f61b" role="img" title="stuck out tongue">:stuck_out_tongue:</span> </li>
<li>
<p>More seriously, there is an important (classic) issue with macros, that the arguments are not pre-evaluated. This will indeed cause trouble with the <code>async move</code> (<em>e.g.</em>, <code>join!(static_future(&amp;thing), …)</code> will consume ownership of <code>thing</code>) as well as when doing, say, <code>join!(maybe_fut?, …)</code>.</p>
</li>
<li>
<p>Unit tests for those cases ought to be added as well</p>
</li>
</ul>
<p>So it should be doing:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">match</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="cp">$(</span><span class="w"> </span><span class="n">MaybeDone</span>::<span class="n">Future</span><span class="p">(</span><span class="cp">$fut</span><span class="p">),</span><span class="w"> </span><span class="p">)</span><span class="o">*</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">futures</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="k">move</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// …</span>
<span class="p">}}</span><span class="w"></span>
</code></pre></div>
<p>(<em>c.f.</em> the <code>$_:value</code> matcher pre-RFC to avoid this kind of pitfalls)</p>



<a name="264293774"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264293774" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264293774">(Dec 09 2021 at 12:34)</a>:</h4>
<p>(neat <code>(_, _, … _, var, ..)</code> trick, though <span aria-label="ok" class="emoji emoji-1f44c" role="img" title="ok">:ok:</span>)</p>



<a name="264294261"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264294261" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264294261">(Dec 09 2021 at 12:38)</a>:</h4>
<p>We can and should iterate before stabilising, so please file issues or send PRs <span aria-label="heart" class="emoji emoji-2764" role="img" title="heart">:heart:</span>️</p>



<a name="264297186"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264297186" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264297186">(Dec 09 2021 at 13:03)</a>:</h4>
<blockquote>
<p>I'd have expected the creator of .ready()? to use that in their own PR</p>
</blockquote>
<p>Oh right I could have enabled the feature in core <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="264297332"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264297332" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264297332">(Dec 09 2021 at 13:04)</a>:</h4>
<p><span class="user-mention silent" data-user-id="256841">Nick Cameron</span> <a href="#narrow/stream/187312-wg-async-foundations/topic/join!/near/264283626">said</a>:</p>
<blockquote>
<p>Can we send PRs to futures-rs and other runtimes to re-export the std version rather than using their own?</p>
</blockquote>
<p>Once it's stable in their MSRV....</p>



<a name="264297550"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264297550" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264297550">(Dec 09 2021 at 13:06)</a>:</h4>
<p>Urgh, I hate MSRV :-(</p>



<a name="264297808"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264297808" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264297808">(Dec 09 2021 at 13:09)</a>:</h4>
<p>Can we cfg on version or channel? I fear that we won't get momentum for people to change to use the std version without the runtimes changing, and without that we won't get the experience we need to stabilise</p>



<a name="264298340"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264298340" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264298340">(Dec 09 2021 at 13:13)</a>:</h4>
<p>Maybe in <code>futures</code> and <code>async-std</code>, but tokio has strict stability guarantees</p>



<a name="264298355"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264298355" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264298355">(Dec 09 2021 at 13:13)</a>:</h4>
<p>The std version doesn't implicitly .await, so it would be a breaking change</p>



<a name="264298521"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264298521" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264298521">(Dec 09 2021 at 13:14)</a>:</h4>
<blockquote>
<p>The Tokio 1.0 release ends this churn. As part of the release, we are committing to providing a stable foundation for the ecosystem. We have no current plans for Tokio 2.0 and we commit to holding back on a Tokio 2.0 release for at least 3 years. We plan to maintain the Tokio 1.0 branch for a minimum of 5 years. Tokio will keep a rolling MSRV (minimum supported rust version) policy of 6 months. When increasing the MSRV, the new Rust version must have been released at least six months ago.</p>
</blockquote>



<a name="264298537"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264298537" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264298537">(Dec 09 2021 at 13:14)</a>:</h4>
<p>:(</p>



<a name="264299072"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264299072" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264299072">(Dec 09 2021 at 13:19)</a>:</h4>
<p>Yeah, I think the best we can hope for Tokio is to have lots of things ready (and Tokio folk eager to have those changes) so when they start working on the 2.0 release, we get as much in as possible (I assume they will want to have a 2.0 preview available some time before the actual release for the sake of testing, etc.)</p>



<a name="264299172"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264299172" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264299172">(Dec 09 2021 at 13:20)</a>:</h4>
<p>Changing futures-rs seems the most possible and perhaps most useful</p>



<a name="264299257"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264299257" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264299257">(Dec 09 2021 at 13:20)</a>:</h4>
<p>If one were to change from futures::join to std::join, they would presumably then get a lint warning about the missing .await?</p>



<a name="264299284"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264299284" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264299284">(Dec 09 2021 at 13:20)</a>:</h4>
<p>Yes they would</p>



<a name="264299319"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264299319" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264299319">(Dec 09 2021 at 13:21)</a>:</h4>
<p>If not, we probably need to just remove join from futures rather than re-export the std version or there would be nasty silent breakage</p>



<a name="264299342"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264299342" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264299342">(Dec 09 2021 at 13:21)</a>:</h4>
<p>Would it make sense to remove the implicit .await from futures <em>now</em> to make the migration easier?</p>



<a name="264299452"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264299452" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264299452">(Dec 09 2021 at 13:22)</a>:</h4>
<p>I don't think so, if we re-export then the change should be transparent, otherwise, right?</p>



<a name="264299526"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264299526" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264299526">(Dec 09 2021 at 13:22)</a>:</h4>
<p>Hmm, actually does futures-rs support stable Rust?</p>



<a name="264299595"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264299595" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264299595">(Dec 09 2021 at 13:23)</a>:</h4>
<p>futures-util's MSRV is 1.45</p>



<a name="264299598"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264299598" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264299598">(Dec 09 2021 at 13:23)</a>:</h4>
<p>Presumably re-exporting an unstable item doesn't work on stable rust channel?</p>



<a name="264299889"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264299889" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264299889">(Dec 09 2021 at 13:24)</a>:</h4>
<p><a href="/user_uploads/4715/e6QeP98_3cMhCO8Ds8PfT9nw/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/e6QeP98_3cMhCO8Ds8PfT9nw/image.png" title="image.png"><img src="/user_uploads/4715/e6QeP98_3cMhCO8Ds8PfT9nw/image.png"></a></div>



<a name="264299951"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264299951" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264299951">(Dec 09 2021 at 13:25)</a>:</h4>
<p><a href="https://github.com/rust-lang/futures-rs/issues/2207">https://github.com/rust-lang/futures-rs/issues/2207</a></p>



<a name="264301562"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264301562" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264301562">(Dec 09 2021 at 13:36)</a>:</h4>
<p>So, I guess for futures-rs we should keep that impl in sync with the libcore one and add a line to the docs saying it is available in core?</p>



<a name="264301642"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264301642" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264301642">(Dec 09 2021 at 13:37)</a>:</h4>
<p>I guess it would be good to open a PR for that so we can discuss at least (not sure how futures-rs feel about breaking changes like that)</p>



<a name="264301789"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264301789" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264301789">(Dec 09 2021 at 13:38)</a>:</h4>
<p>(Seems like cfg on version is still unstable and cfg(accessible) is not properly implemented yet, although it is possible to 'cfg' on version using a build script)</p>



<a name="264303288"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264303288" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264303288">(Dec 09 2021 at 13:50)</a>:</h4>
<p>cc <span class="user-mention" data-user-id="213313">@Taiki Endo</span></p>



<a name="264343187"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264343187" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264343187">(Dec 09 2021 at 18:15)</a>:</h4>
<p>Now for <code>try_join!</code> which is arguably even more useful than <code>join!</code></p>



<a name="264343302"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264343302" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264343302">(Dec 09 2021 at 18:15)</a>:</h4>
<p>If <code>join!</code> returns a concrete future, we could have <code>join!(a, b).try().await</code> instead of <code>try_join!(a, b).await</code></p>



<a name="264343371"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264343371" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264343371">(Dec 09 2021 at 18:16)</a>:</h4>
<p>Contemplating whether it's nicer that way</p>



<a name="264350117"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264350117" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264350117">(Dec 09 2021 at 19:01)</a>:</h4>
<p><span class="user-mention silent" data-user-id="256841">Nick Cameron</span> <a href="#narrow/stream/187312-wg-async-foundations/topic/join!/near/264294261">said</a>:</p>
<blockquote>
<p>We can and should iterate before stabilising, so please file issues or send PRs <span aria-label="heart" class="emoji emoji-2764" role="img" title="heart">:heart:</span>️</p>
</blockquote>
<p>Done: <a href="https://github.com/rust-lang/rust/pull/91721">https://github.com/rust-lang/rust/pull/91721</a>. I've tagged you as a reviewer, but if <span class="user-mention" data-user-id="239881">@Josh Triplett</span> (or <span class="user-mention" data-user-id="363998">@Ibraheem Ahmed</span>   if they have the rights) prefers to take over, they should feel free to do so <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="264360510"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264360510" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264360510">(Dec 09 2021 at 20:18)</a>:</h4>
<p><span class="user-mention" data-user-id="232018">@Daniel Henry-Mantilla</span> Looks good to me. Can you take a look at the structured suggestion and disposition it, and then I'll merge?</p>



<a name="264362071"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264362071" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264362071">(Dec 09 2021 at 20:33)</a>:</h4>
<p>I'll try to first add a unit test for the two issues I mentioned above (<code>join!(async_fun(&amp;borrowed), opt_fut?)</code> should neither consume <code>borrowed</code>, nor complain about / misuse the <code>?</code>), and then I'll <code>r?</code> you</p>



<a name="264370196"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264370196" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264370196">(Dec 09 2021 at 21:37)</a>:</h4>
<p><span class="user-mention" data-user-id="232018">@Daniel Henry-Mantilla</span> Sounds good.</p>



<a name="264370304"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264370304" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264370304">(Dec 09 2021 at 21:38)</a>:</h4>
<p><span class="user-mention silent" data-user-id="363998">Ibraheem Ahmed</span> <a href="#narrow/stream/187312-wg-async-foundations/topic/join!/near/264343302">said</a>:</p>
<blockquote>
<p>If <code>join!</code> returns a concrete future, we could have <code>join!(a, b).try().await</code> instead of <code>try_join!(a, b).await</code></p>
</blockquote>
<p>I personally think <code>try_join!</code> seems clearer.</p>



<a name="264370353"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264370353" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264370353">(Dec 09 2021 at 21:38)</a>:</h4>
<p>It makes the type of the future ("something that might fail") clear up front.</p>



<a name="264370362"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264370362" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264370362">(Dec 09 2021 at 21:38)</a>:</h4>
<p>Kinda like a type signature.</p>



<a name="264370393"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264370393" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264370393">(Dec 09 2021 at 21:39)</a>:</h4>
<p><span class="user-mention" data-user-id="232018">@Daniel Henry-Mantilla</span> pointed out that <code>try</code> is a keyword</p>



<a name="264370396"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264370396" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264370396">(Dec 09 2021 at 21:39)</a>:</h4>
<p>Also, <code>.try()</code> isn't an option anyway, since try is a keyword. ;)</p>



<a name="264370411"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264370411" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264370411">(Dec 09 2021 at 21:39)</a>:</h4>
<p>(jinx)</p>



<a name="264370415"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264370415" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264370415">(Dec 09 2021 at 21:39)</a>:</h4>
<p>Yeah :)</p>



<a name="264370517"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264370517" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264370517">(Dec 09 2021 at 21:40)</a>:</h4>
<p>Thank you both so much for working on this! It's exciting to see bits of the async ecosystem starting to filter into the standard library.</p>



<a name="264370540"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264370540" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264370540">(Dec 09 2021 at 21:40)</a>:</h4>
<p>I added a couple alternative syntaxes for join! on the tracking issue</p>



<a name="264370585"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264370585" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264370585">(Dec 09 2021 at 21:40)</a>:</h4>
<p>I've started to quite like <code>await_all!</code></p>



<a name="264370829"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264370829" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264370829">(Dec 09 2021 at 21:42)</a>:</h4>
<p>But also <code>impl&lt;A...N&gt; Future for (A...N)</code>, which would allow <code>(a, b, c).await</code></p>



<a name="264370852"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264370852" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264370852">(Dec 09 2021 at 21:42)</a>:</h4>
<p>...huh.</p>



<a name="264370860"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264370860" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264370860">(Dec 09 2021 at 21:43)</a>:</h4>
<p>That's a <em>fascinating</em> idea...</p>



<a name="264370898"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264370898" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264370898">(Dec 09 2021 at 21:43)</a>:</h4>
<p>That's starting to almost feel like <code>collect</code>.</p>



<a name="264370916"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264370916" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264370916">(Dec 09 2021 at 21:43)</a>:</h4>
<p>Huh.</p>



<a name="264370984"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264370984" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264370984">(Dec 09 2021 at 21:44)</a>:</h4>
<p>How <em>ridiculous</em> would it be to make <code>.collect().await</code> work to collect a collection of futures into a collection of results?</p>



<a name="264371024"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264371024" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264371024">(Dec 09 2021 at 21:44)</a>:</h4>
<p>That might not be possible, not sure.</p>



<a name="264371076"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264371076" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264371076">(Dec 09 2021 at 21:44)</a>:</h4>
<p>Hm you mean like adding a <code>AsyncCollect</code> trait implemented for tuples?</p>



<a name="264371153"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264371153" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Khionu Sybiern <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264371153">(Dec 09 2021 at 21:45)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/187312-wg-async-foundations/topic/join!/near/264370984">said</a>:</p>
<blockquote>
<p>How <em>ridiculous</em> would it be to make <code>.collect().await</code> work to collect a collection of futures into a collection of results?</p>
</blockquote>
<p>I want this so bad, for tuples and <code>Vec&lt;impl Future&gt;</code></p>



<a name="264371190"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264371190" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264371190">(Dec 09 2021 at 21:45)</a>:</h4>
<p>For <code>Vec&lt;impl Future&gt;</code> there's <code>FuturesUnordered</code></p>



<a name="264371585"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264371585" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Khionu Sybiern <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264371585">(Dec 09 2021 at 21:48)</a>:</h4>
<p>Forgot about that, but I think it might also be a good addition to std as well. Another RFC, though, I think?</p>



<a name="264371609"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264371609" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264371609">(Dec 09 2021 at 21:48)</a>:</h4>
<p>Yeah probably</p>



<a name="264371628"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264371628" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264371628">(Dec 09 2021 at 21:48)</a>:</h4>
<p>A tuple of futures is a much more general use case</p>



<a name="264371901"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264371901" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264371901">(Dec 09 2021 at 21:50)</a>:</h4>
<p><code>FuturesUnordered</code> is <em>significantly</em> more complicated as well</p>



<a name="264372218"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264372218" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264372218">(Dec 09 2021 at 21:53)</a>:</h4>
<p><span class="user-mention silent" data-user-id="363998">Ibraheem Ahmed</span> <a href="#narrow/stream/187312-wg-async-foundations/topic/join!/near/264371076">said</a>:</p>
<blockquote>
<p>Hm you mean like adding a <code>AsyncCollect</code> trait implemented for tuples?</p>
</blockquote>
<p>I don't mean tuples, those would have to be separate. I mean making <code>collect</code> itself work for an iterator of futures, returning a future of a collection.</p>



<a name="264372414"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264372414" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Khionu Sybiern <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264372414">(Dec 09 2021 at 21:54)</a>:</h4>
<p>It would leave the question open whether <code>collect().await</code> would be ordered or unordered. There might be a <em>good</em> assumption there, but I'm not sure an <em>obvious</em> one.</p>



<a name="264372467"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264372467" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264372467">(Dec 09 2021 at 21:55)</a>:</h4>
<p>Imagine if this could work:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">v</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">fallible_fut</span><span class="p">(),</span><span class="w"> </span><span class="n">fallible_fut2</span><span class="p">(),</span><span class="w"> </span><span class="n">fallible_fut3</span><span class="p">()].</span><span class="n">collect</span>::<span class="o">&lt;</span><span class="k">impl</span><span class="w"> </span><span class="n">Future</span><span class="o">&lt;</span><span class="nb">Result</span><span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">E</span><span class="o">&gt;&gt;</span><span class="p">().</span><span class="k">await</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
</code></pre></div>



<a name="264373662"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264373662" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264373662">(Dec 09 2021 at 22:03)</a>:</h4>
<p>I'm don't think that can work, but <code>.collect::&lt;future::Collect&lt;Result&lt;Vec&lt;T&gt;, E&gt;&gt;&gt;</code> might</p>



<a name="264373985"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264373985" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264373985">(Dec 09 2021 at 22:05)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">v</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">fallible_fut</span><span class="p">(),</span><span class="w"> </span><span class="n">fallible_fut2</span><span class="p">(),</span><span class="w"> </span><span class="n">fallible_fut3</span><span class="p">()].</span><span class="n">into_iter</span><span class="p">().</span><span class="n">collect</span>::<span class="o">&lt;</span><span class="k">impl</span><span class="w"> </span><span class="n">Future</span><span class="o">&lt;</span><span class="nb">Result</span><span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">E</span><span class="o">&gt;&gt;</span><span class="p">().</span><span class="k">await</span><span class="o">?</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">v</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">fallible_fut</span><span class="p">(),</span><span class="w"> </span><span class="n">fallible_fut2</span><span class="p">(),</span><span class="w"> </span><span class="n">fallible_fut3</span><span class="p">()].</span><span class="n">into_stream</span><span class="p">().</span><span class="n">collect</span>::<span class="o">&lt;</span><span class="nb">Result</span><span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">E</span><span class="o">&gt;&gt;</span><span class="p">().</span><span class="k">await</span><span class="o">?</span><span class="w"></span>
</code></pre></div>



<a name="264374075"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264374075" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264374075">(Dec 09 2021 at 22:06)</a>:</h4>
<p><code>IntoStream</code> and <code>FromStream</code> are probably coming eventually, so...</p>



<a name="264374839"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264374839" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264374839">(Dec 09 2021 at 22:13)</a>:</h4>
<p><span class="user-mention" data-user-id="360486">@Kestrer</span> pointed out that it would have to be <code>impl&lt;A...N&gt; IntoFuture for (A...N)</code>, and I actually think that's a much more logical impl to have</p>



<a name="264422478"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264422478" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264422478">(Dec 10 2021 at 09:40)</a>:</h4>
<p><span class="user-mention" data-user-id="232018">@Daniel Henry-Mantilla</span> <span class="user-mention" data-user-id="239881">@Josh Triplett</span> thanks for the PR and review, respectively :-)</p>



<a name="264422667"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264422667" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264422667">(Dec 10 2021 at 09:41)</a>:</h4>
<p>I like the collect idea, but it feels like its solving a different problem to join! or await on a tuple. If you have an iterator of futures already, then I'd want to use collect, but if you have a bunch of individual futures, then putting them into a collection, iterating it, then collecting it is a lot of boilerplate (and probably inefficient).</p>



<a name="264422844"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264422844" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264422844">(Dec 10 2021 at 09:43)</a>:</h4>
<p>I guess that it is kind of subtle that await on a tuple awaits in parallel rather than sequentially (this is hard enough to explain already, so I wonder if slightly magical syntax is the best idea here)</p>



<a name="264423085"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264423085" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264423085">(Dec 10 2021 at 09:45)</a>:</h4>
<p><span class="user-mention" data-user-id="363998">@Ibraheem Ahmed</span> could you explain your into_iter/into_stream example please? I am interested in how collect would work with iterators of futures vs streams, but I'm not sure what you are trying to demonstrate with the example</p>



<a name="264433806"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264433806" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264433806">(Dec 10 2021 at 11:31)</a>:</h4>
<p><span class="user-mention silent" data-user-id="256841">Nick Cameron</span> <a href="#narrow/stream/187312-wg-async-foundations/topic/join!/near/264422667">said</a>:</p>
<blockquote>
<p>I like the collect idea, but it feels like its solving a different problem to join! or await on a tuple. If you have an iterator of futures already, then I'd want to use collect, but if you have a bunch of individual futures, then putting them into a collection, iterating it, then collecting it is a lot of boilerplate (and probably inefficient).</p>
</blockquote>
<p>In case it wasn't clear, I completely agree, and I wasn't suggesting <code>collect</code> as a <em>replacement</em> for join or similar.</p>



<a name="264450529"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264450529" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264450529">(Dec 10 2021 at 13:59)</a>:</h4>
<p>Am I correct in the assumption that we would only stabilize the behavior of <code>join!</code> (as opposed to the code the macro expands to)? I'm asking because there might multiple basically equivalent ways to implement this -- but some of them would make it very hard for a debugger to reconstruct things from debuginfo while other implementation strategies might make it trivial.</p>



<a name="264450845"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264450845" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264450845">(Dec 10 2021 at 14:01)</a>:</h4>
<p>Yeah, we never stabilise implementations, so as long as the behaviour is unchanged, the implementation can change as much as we like</p>



<a name="264450887"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264450887" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264450887">(Dec 10 2021 at 14:01)</a>:</h4>
<p>I have yet to collect more experience on what exactly makes it easy for a debugger to detect a join (either on the call stack or in a suspended generator frame) and thus can't give feedback on any specific implementation now. So it would be great if retained some flexibility in what's implemented.</p>



<a name="264450928"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264450928" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264450928">(Dec 10 2021 at 14:01)</a>:</h4>
<p>Having said that, if you have concerns, it might be better to make a change sooner rather than later just in case it is a behaviour-changing change</p>



<a name="264450929"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264450929" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264450929">(Dec 10 2021 at 14:01)</a>:</h4>
<p>OK, that sounds good</p>



<a name="264451281"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264451281" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264451281">(Dec 10 2021 at 14:04)</a>:</h4>
<p>I suspect that behavior would not have to be changed. It would more be something like "wrap things in a helper struct with a well-known name instead of generating a bunch of unrecognizable variables on the stack"</p>



<a name="264451753"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264451753" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264451753">(Dec 10 2021 at 14:08)</a>:</h4>
<p>Is this expected to be stabilized soon?</p>



<a name="264452328"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264452328" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264452328">(Dec 10 2021 at 14:12)</a>:</h4>
<p>Given that we've changed the interface slightly from what is in futures-rs and Tokio, I'd think we'd want to get a decent amount of experience before stabilising it</p>



<a name="264463695"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264463695" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264463695">(Dec 10 2021 at 15:34)</a>:</h4>
<p><span class="user-mention silent" data-user-id="256841">Nick Cameron</span> <a href="#narrow/stream/187312-wg-async-foundations/topic/join!/near/264423085">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="363998">Ibraheem Ahmed</span> could you explain your into_iter/into_stream example please? I am interested in how collect would work with iterators of futures vs streams, but I'm not sure what you are trying to demonstrate with the example</p>
</blockquote>
<p>The <code>into_iter</code> version is what <span class="user-mention" data-user-id="239881">@Josh Triplett</span> was thinking about, but if there was an <code>impl IntoStream for I: IntoIterator&lt;Item: Future&gt;</code>, that could be nicer.</p>



<a name="264463746"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264463746" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264463746">(Dec 10 2021 at 15:35)</a>:</h4>
<p><span class="user-mention silent" data-user-id="256841">Nick Cameron</span> <a href="#narrow/stream/187312-wg-async-foundations/topic/join!/near/264422844">said</a>:</p>
<blockquote>
<p>I guess that it is kind of subtle that await on a tuple awaits in parallel rather than sequentially (this is hard enough to explain already, so I wonder if slightly magical syntax is the best idea here)</p>
</blockquote>
<p>Concurrently not in parallel, but yes I agree. A macro is easier to document and teach.</p>



<a name="264463810"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264463810" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264463810">(Dec 10 2021 at 15:36)</a>:</h4>
<p>I think <code>await_all!</code> is the clearest (<code>Task.WhenAll</code>, <code>Promise.All</code> from other languages)</p>



<a name="264535715"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264535715" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias247 <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264535715">(Dec 11 2021 at 02:30)</a>:</h4>
<blockquote>
<p>FuturesUnordered is significantly more complicated as well</p>
</blockquote>
<p>It's also significantly less expensive, and the exponential complexity of the plain <code>join!</code> might surprise some people. That's one reason against including it in <code>std</code></p>



<a name="264539858"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264539858" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264539858">(Dec 11 2021 at 04:09)</a>:</h4>
<p>Because it takes tuples I don't think that's a big problem</p>



<a name="264737045"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264737045" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264737045">(Dec 13 2021 at 17:04)</a>:</h4>
<p><span class="user-mention silent" data-user-id="363998">Ibraheem Ahmed</span> <a href="#narrow/stream/187312-wg-async-foundations/topic/join!/near/264059800">said</a>:</p>
<blockquote>
<p>Do you think <code>std::future::join!</code> requires an RFC or could I just PR it?</p>
</blockquote>
<p>I don't think adding <code>std::future::join!</code> in the current macro form would be the right direction for the stdlib. I wrote a post earlier this year on the design of <code>join!</code>, <code>join_all!</code>, <code>try_join!</code>, <code>race!</code> and <code>try_race!</code> here: <a href="https://blog.yoshuawuyts.com/futures-concurrency-2/">FUTURES CONCURRENCY II</a>.</p>
<p>The prototype library described in the post can be found here: <a href="https://docs.rs/futures-concurrency/1.1.0/futures_concurrency/index.html">yoshuawuyts/futures-concurrency</a>. Here's an example of what using that library looks like today:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="c1">// Await multiple similarly-typed futures.</span>
<span class="kd">let</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">future</span>::<span class="n">ready</span><span class="p">(</span><span class="mi">1</span><span class="k">u8</span><span class="p">);</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">future</span>::<span class="n">ready</span><span class="p">(</span><span class="mi">2</span><span class="k">u8</span><span class="p">);</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">future</span>::<span class="n">ready</span><span class="p">(</span><span class="mi">3</span><span class="k">u8</span><span class="p">);</span><span class="w"></span>
<span class="fm">assert_eq!</span><span class="p">([</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">].</span><span class="n">join</span><span class="p">().</span><span class="k">await</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">]);</span><span class="w"></span>

<span class="c1">// Await multiple differently-typed futures.</span>
<span class="kd">let</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">future</span>::<span class="n">ready</span><span class="p">(</span><span class="mi">1</span><span class="k">u8</span><span class="p">);</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">future</span>::<span class="n">ready</span><span class="p">(</span><span class="s">"hello"</span><span class="p">);</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">future</span>::<span class="n">ready</span><span class="p">(</span><span class="mi">3</span><span class="k">u16</span><span class="p">);</span><span class="w"></span>
<span class="fm">assert_eq!</span><span class="p">((</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">).</span><span class="n">join</span><span class="p">().</span><span class="k">await</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">"hello"</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">));</span><span class="w"></span>

<span class="c1">// It even works with vectors of futures, providing an alternative</span>
<span class="c1">// to futures-rs' `join_all`.</span>
<span class="kd">let</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">future</span>::<span class="n">ready</span><span class="p">(</span><span class="mi">1</span><span class="k">u8</span><span class="p">);</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">future</span>::<span class="n">ready</span><span class="p">(</span><span class="mi">2</span><span class="k">u8</span><span class="p">);</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">future</span>::<span class="n">ready</span><span class="p">(</span><span class="mi">3</span><span class="k">u8</span><span class="p">);</span><span class="w"></span>
<span class="fm">assert_eq!</span><span class="p">(</span><span class="fm">vec!</span><span class="p">[</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">].</span><span class="n">join</span><span class="p">().</span><span class="k">await</span><span class="p">,</span><span class="w"> </span><span class="fm">vec!</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">]);</span><span class="w"></span>
</code></pre></div>
<hr>
<p>The whole post might be worth a read. It covers some issues that I haven't seen brought up yet in this thread. For example: the return types of the various macros tend to be incompatible (I'm of the opinion we should aim to return convenient <em>named</em> futures, not just anonymous <code>impl Future</code> instances or N-level nested <code>Join&lt;Join&lt;Join&lt;&gt;&gt;&gt;</code> types). And having two separate interfaces to perform <code>join!</code> vs <code>join_all</code> is not particularly ergonomic from an end-user perspective.</p>
<p>I feel like I've gone fairly deep on the topic of async concurrency API design, but haven't ironed out all the kinks yet.  I feel strongly that futures concurrency should be treated as a single topic that requires a cohesive design, and should go through the RFC process.  But before that: I think we should experiment outside of the stdlib more before we propose to merge anything,  as the space seems somewhat under-explored. And perhaps a group under the async-foundations WG might be the right venue to do that?</p>



<a name="264739511"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264739511" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264739511">(Dec 13 2021 at 17:20)</a>:</h4>
<blockquote>
<p>I'm of the opinion we should aim to return convenient named futures</p>
</blockquote>
<p>Why? If in the rare case someone needs a named future they can just use TAIT themselves.</p>



<a name="264740258"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264740258" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264740258">(Dec 13 2021 at 17:25)</a>:</h4>
<p>So far all futures in the stdlib have intentionally been named, and I don't think we should break from that.</p>



<a name="264740401"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264740401" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264740401">(Dec 13 2021 at 17:26)</a>:</h4>
<p>We made the mistake of not doing that in <code>async-std</code>, and in hindsight that's been one of our major flaws. What we gained in implementation speed, we lost in usability.</p>



<a name="264740496"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264740496" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264740496">(Dec 13 2021 at 17:26)</a>:</h4>
<p>There are reasons why we <em>temporarily</em> might want to expose an anonymous future (see also: "road to std" in my post). But it should not be the final state a design finds itself in.</p>



<a name="264740800"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264740800" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264740800">(Dec 13 2021 at 17:28)</a>:</h4>
<p>I don't think there's really any basis for judging how rare a case might be. But even assuming the case is rare, if it's included in the stdlib by virtue of scale the rare case will still happen all the time.</p>



<a name="264741074"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264741074" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264741074">(Dec 13 2021 at 17:30)</a>:</h4>
<p>From your post:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">type</span> <span class="nc">JoinFuture</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">impl</span><span class="w"> </span><span class="n">Future</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>

<span class="c1">// Implement `Join` for tuple `(A, B)`.</span>
<span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">N</span>: <span class="kt">usize</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Join</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">)</span><span class="w"></span>
<span class="k">where</span><span class="w"></span>
<span class="w">    </span><span class="n">A</span>: <span class="nc">Future</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">B</span>: <span class="nc">Future</span><span class="p">,</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">Output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">A</span>::<span class="n">Output</span><span class="p">,</span><span class="w"> </span><span class="n">B</span>::<span class="n">Output</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">join</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">JoinFuture</span><span class="o">&lt;</span><span class="bp">Self</span>::<span class="n">Output</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// ...and repeat for all other tuples (likely using a macro).</span>
<span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">N</span>: <span class="kt">usize</span><span class="o">&gt;</span><span class="w"> </span><span class="n">JoinTrait</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">C</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">N</span>: <span class="kt">usize</span><span class="o">&gt;</span><span class="w"> </span><span class="n">JoinTrait</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">C</span><span class="p">,</span><span class="w"> </span><span class="n">D</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">N</span>: <span class="kt">usize</span><span class="o">&gt;</span><span class="w"> </span><span class="n">JoinTrait</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">C</span><span class="p">,</span><span class="w"> </span><span class="n">D</span><span class="p">,</span><span class="w"> </span><span class="n">E</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>I don't believe this will work with TAIT.</p>



<a name="264741089"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264741089" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264741089">(Dec 13 2021 at 17:31)</a>:</h4>
<p>Each async block will generate a new opaque type.</p>



<a name="264742059"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264742059" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264742059">(Dec 13 2021 at 17:38)</a>:</h4>
<p>Oh I see, yeah I think you might be right</p>



<a name="264742754"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264742754" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264742754">(Dec 13 2021 at 17:41)</a>:</h4>
<p>You could have <code>impl&lt;T..N&gt; Future for JoinFuture&lt;(T..N)&gt;</code> with a macro or eventually variadics.</p>



<a name="264743278"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264743278" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264743278">(Dec 13 2021 at 17:43)</a>:</h4>
<p>Yeah, that's what I was hoping for. TAITs were only meant to act as an intermediate state; working from the assumption that we'd have access to TAITs before we have access to variadics / variadic tuples.</p>



<a name="264743481"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264743481" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264743481">(Dec 13 2021 at 17:44)</a>:</h4>
<p>That is also possible with the <code>join!</code> macro though.</p>



<a name="264743541"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264743541" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264743541">(Dec 13 2021 at 17:45)</a>:</h4>
<p><a href="#narrow/stream/187312-wg-async-foundations/topic/join!/near/264224251">https://rust-lang.zulipchat.com/#narrow/stream/187312-wg-async-foundations/topic/join!/near/264224251</a></p>



<a name="264743619"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264743619" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264743619">(Dec 13 2021 at 17:45)</a>:</h4>
<p>Oh I missed that <a href="https://github.com/rust-lang/rust/pull/91645">https://github.com/rust-lang/rust/pull/91645</a> had been merged</p>



<a name="264743680"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264743680" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264743680">(Dec 13 2021 at 17:46)</a>:</h4>
<p>The wg-async-foundations team was never tagged :/</p>



<a name="264743715"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264743715" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264743715">(Dec 13 2021 at 17:46)</a>:</h4>
<p>Oh yes, it's unstable though of course.</p>



<a name="264743732"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264743732" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264743732">(Dec 13 2021 at 17:46)</a>:</h4>
<p>I think I did tag wg-async-foundations?</p>



<a name="264743767"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264743767" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264743767">(Dec 13 2021 at 17:46)</a>:</h4>
<p>the tag doesn't resolve, meaning the WG never got the notification</p>



<a name="264743780"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264743780" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264743780">(Dec 13 2021 at 17:47)</a>:</h4>
<p>I would've written what I just wrote ^ in the issue</p>



<a name="264743838"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264743838" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264743838">(Dec 13 2021 at 17:47)</a>:</h4>
<p>async concurrency is a big enough topic that I don't think we should be merging it piece-meal</p>



<a name="264743914"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264743914" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264743914">(Dec 13 2021 at 17:47)</a>:</h4>
<p>I agree that we should come up with a coherent interface for join, try_join, and join_all before merging.</p>



<a name="264746972"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264746972" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264746972">(Dec 13 2021 at 18:07)</a>:</h4>
<p>I don't agree that <code>await_all!(a, b, c)</code> is "awkward" compared to <code>(a, b, c).join().await</code>, and I also think that the API for ordered/unordered stream collection is a more powerful and just as usable of an interface compared to <code>.join()</code>, but given the many design possiblities, I do think an RFC is the best path forward.</p>



<a name="264753532"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264753532" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264753532">(Dec 13 2021 at 18:58)</a>:</h4>
<p>Filed a comment on the tracking issue: <a href="https://github.com/rust-lang/rust/issues/91642#issuecomment-992773288">https://github.com/rust-lang/rust/issues/91642#issuecomment-992773288</a> -- this roughly maps to what I would've said on the PR if the notification would've gone out.</p>



<a name="264781448"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264781448" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264781448">(Dec 13 2021 at 22:41)</a>:</h4>
<p>FWIW, in general we do tend to merge unstable PRs on the basis of "looks reasonable", and then take <em>much</em> more care when stabilizing them.</p>



<a name="264781528"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264781528" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264781528">(Dec 13 2021 at 22:42)</a>:</h4>
<p><span class="user-mention" data-user-id="211722">@Yoshua Wuyts [he/they]</span> So please don't take the straightforward merger of this PR as an indication that we won't take substantial care before stabilizing; in particular, we'll pay attention to the note you sent.</p>



<a name="264781574"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264781574" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264781574">(Dec 13 2021 at 22:42)</a>:</h4>
<p>I do personally think that <code>.join()</code> on a tuple might make sense (and I like that better than just <code>.await</code> on a tuple).</p>



<a name="264781642"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264781642" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264781642">(Dec 13 2021 at 22:43)</a>:</h4>
<p>And I like that that would be postfix here.</p>



<a name="264813568"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264813568" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Chin (eminence) <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264813568">(Dec 14 2021 at 05:17)</a>:</h4>
<p>Is the primary reason for <code>join</code> being a macro is that it's variadic?</p>



<a name="264813790"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264813790" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Chin (eminence) <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264813790">(Dec 14 2021 at 05:19)</a>:</h4>
<p>(maybe someone's done this already, but it'd probably be good to document the ergonomic benefits of variadic macros and weight them against the ergonomic costs of macros)</p>



<a name="264848361"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264848361" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264848361">(Dec 14 2021 at 12:19)</a>:</h4>
<p><span class="user-mention silent" data-user-id="222286">Andrew Chin (eminence)</span> <a href="#narrow/stream/187312-wg-async-foundations/topic/join!/near/264813568">said</a>:</p>
<blockquote>
<p>Is the primary reason for <code>join</code> being a macro is that it's variadic?</p>
</blockquote>
<p>that's right</p>



<a name="264890413"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264890413" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264890413">(Dec 14 2021 at 17:07)</a>:</h4>
<p><span class="user-mention" data-user-id="211722">@Yoshua Wuyts [he/they]</span> while I think that <code>.join().await</code> makes sense, even despite the variadics / maximum arity concerns for differently-typed futures, that doesn't subsume the other necessary <code>.race()</code>ing APIs. It has been discussed here about a <code>(…).join().try().await</code> API design (don't mind the keyword issue, that's just bikeshedding), whereby <code>.try()</code> would have been an adaptor to change the semantics of the previous <code>.join()</code> (conceptually) by changing the semantics of the following <code>.await</code> (implementation-wise). The initial reaction from some people (among the few people "polled" (heh)) was that that was maybe too subtle/terse: <code>join()</code> is written, but then <code>race</code>-ing behavior is showcased for <code>Err</code>s. That's why then having extra names makes sense: <code>.try_join().await</code> / <code>.race().await</code> / <code>.try_race().await</code>: these four concurrency primitives you talk about are each unique and important enough on its own to be written as standalone constructions, I'd say.</p>
<p>Finally, there was a double question:</p>
<ul>
<li>other languages feature a "<code>all()</code>-based naming" (<em>e.g.</em>, <code>Promise::all()</code>): that <em>all</em> element in the name seems interesting / relevant.</li>
<li><em>with the macro syntax</em>, should the <code>.await</code> be explicit or implicit. </li>
</ul>
<p>Hence the idea of an <code>await_all!(…)</code> macro: there is both <code>await</code> and <code>all</code> in the name, with the <em>await</em> part playing a double role: it disambiguates / brings <code>async</code> context to the <code>all</code> part, so that we understand what is going on; by virtue of being called, <em>verbatim</em>, <em>await</em>, we can afford to offer an "implicitly" <code>.await</code>-ed API, without falling into "too terse" territory.</p>
<p>So, my personal takeaway would be that the two best candidate APIs would be <code>await_all!(…)</code> and <code>(…).join().await</code>. Given the variadic limitations at the moment, the macro API has the advantage of being more flexible. But since <code>[…].join().await</code>, on the other hand, seems like an interesting <em>complementary</em> addition, for those dealing with a <code>const</code>-generic len, or a runtime-variable length (<code>vec![…].join()</code>) —I don't know how often that occurs in practice—, then I can see the point for a <code>(…).join().await</code> API, much alike <code>task::ready!(…)</code> having already become a <code>.ready()?</code> method for <code>Poll</code>. Making such a switch in the future wouldn't be hard.</p>



<a name="264892704"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264892704" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264892704">(Dec 14 2021 at 17:20)</a>:</h4>
<p>Regarding the nameability of the returned futures, I think that they should only be nameable through <code>impl Future</code> aliases, or using <code>&lt;(…) as Join&gt;::Output</code>, at least for the heterogenous futures situation: there should be no concrete type, or if there is one, it should be perma-<code>unstable</code>. This is indeed different from, say, <code>&lt;Vec&lt;T&gt; as IntoIterator&gt;::IntoIter</code> being nameable (as <code>::std::vec::IntoIter&lt;T&gt;</code>). The reason for that being that, especially with the whole variadic situation being unclear, the actual implementation details are susceptible to evolve.<br>
This is not such a big deal for libraries, since there is always the possibility to perform a new major release.<br>
But if we take the current implementation of <code>join!</code>, for instance, the currently yielded future, should there not be an <code>async  { … .await }</code> layer, would have been an <code>PollFn&lt;…&gt;</code>. This means that people would then have been able to write <code>let PollFn { .. } = join!(…);</code> and, from there, the stdlib would have been doomed to always yield a <code>PollFn</code> with the exact same type arity (modulo defaulted type params) just for back-compat.</p>
<p>Moreover, by the time this whole std effort lands on stable, it's very likely that we'll already have TAITs, or a subset of them (<code>min_…</code>), precisely to reduce the current sore points with Voldemort futures.</p>



<a name="264942672"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264942672" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eholk <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264942672">(Dec 14 2021 at 23:17)</a>:</h4>
<blockquote>
<p>Voldemort futures</p>
</blockquote>
<p>Not really relevant, but this is an amazing term!</p>



<a name="264970516"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/join%21/near/264970516" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kestrer <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/join!.html#264970516">(Dec 15 2021 at 06:30)</a>:</h4>
<p>I don't think <code>(...).join().await</code> is the best solution, because it adds a function <code>&lt;(T...)&gt;::join</code> that doesn't immediately carry the message of being async. In the mindset of writing async code it makes sense, but <code>join</code> is quite a generic word and outside <code>async</code> a method named <code>join</code> on tuples could potentially do things completely unrelated to joining futures - concatenate two tuples, for example. It would be quite easy for a beginner to stumble into that method, assume it's some generic operation and be confused because they don't know what a "future" is - in contrast, if <code>join</code> were to be located in a <code>future</code> module it would be clear that it's only used for async code and if you don't need futures you don't need it. Of course it could be implemented with an extension trait, but that would be a weird API design when we _are_ the standard library, and it would effectively create two "modes" of Rust, each one where <code>(...).join()</code> means a different thing - like it's some feature flag.</p>
<p>Additionally, tuples don't play well with rustfmt. Often it ends up being formatted like this:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="n">a</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">b</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">c</span><span class="p">,</span><span class="w"></span>
<span class="p">)</span><span class="w"></span>
<span class="p">.</span><span class="n">join</span><span class="p">()</span><span class="w"></span>
<span class="p">.</span><span class="k">await</span><span class="w"></span>
</code></pre></div>
<p>which is a one extra line and a weird-looking lone opening bracket. In comparison:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">future</span>::<span class="n">join</span><span class="o">!</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="n">a</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">b</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">c</span><span class="p">,</span><span class="w"></span>
<span class="p">)</span><span class="w"></span>
<span class="p">.</span><span class="k">await</span><span class="w"></span>
</code></pre></div>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>