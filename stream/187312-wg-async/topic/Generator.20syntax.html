<html>
<head><meta charset="utf-8"><title>Generator syntax Â· wg-async Â· Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/index.html">wg-async</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html">Generator syntax</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="261165338"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261165338" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261165338">(Nov 11 2021 at 17:52)</a>:</h4>
<p><span class="user-mention" data-user-id="119031">@Esteban KÃ¼ber</span> is it ok to discuss/bikeshed <a href="https://estebank.github.io/rust-iterator-item-syntax.html">https://estebank.github.io/rust-iterator-item-syntax.html</a> here? Or do you have a different preferred channel?</p>



<a name="261165400"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261165400" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Esteban KÃ¼ber <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261165400">(Nov 11 2021 at 17:52)</a>:</h4>
<p>No! Here is great.</p>



<a name="261165420"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261165420" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261165420">(Nov 11 2021 at 17:52)</a>:</h4>
<p>Cool!</p>



<a name="261165428"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261165428" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Esteban KÃ¼ber <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261165428">(Nov 11 2021 at 17:52)</a>:</h4>
<p>I do prefer to have at least a summary as a ticket on the repo, or ideally a PR :)</p>



<a name="261165464"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261165464" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Esteban KÃ¼ber <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261165464">(Nov 11 2021 at 17:52)</a>:</h4>
<p>The biggest value I see is in people actually <em>using</em> these different syntaxes</p>



<a name="261165537"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261165537" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261165537">(Nov 11 2021 at 17:53)</a>:</h4>
<p>So, I have a question, is it necessary to have the * in fn* as well as using <code>yields</code> instead of <code>return</code> or is it just a stylistic preference?</p>



<a name="261165626"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261165626" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261165626">(Nov 11 2021 at 17:54)</a>:</h4>
<p>(other than to avoid an explicit <code>yields ()</code>, I guess)</p>



<a name="261165862"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261165862" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Esteban KÃ¼ber <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261165862">(Nov 11 2021 at 17:56)</a>:</h4>
<p>None, other than taking a maximalist approach to syntax: the bigger the distance between two different features (in this case, functions and generators), the better for diagnostics, but in this case it might be enough to <em>only</em> have <code>yields</code> and make people be explicit about <code>yields ()</code>.</p>



<a name="261165872"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261165872" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Esteban KÃ¼ber <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261165872">(Nov 11 2021 at 17:57)</a>:</h4>
<p>There are some people that want the <code>-&gt;</code> syntax for <code>yields</code> though.</p>



<a name="261166017"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261166017" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261166017">(Nov 11 2021 at 17:58)</a>:</h4>
<p>That means using <code>-&gt;</code> instead of yields like in regular functions?</p>



<a name="261166052"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261166052" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261166052">(Nov 11 2021 at 17:58)</a>:</h4>
<p>(Whoops, I meant <code>-&gt;</code> not <code>return</code> in my question)</p>



<a name="261166106"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261166106" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261166106">(Nov 11 2021 at 17:59)</a>:</h4>
<p>I like <code>yields</code>, but I also like <code>throws</code> :-)</p>



<a name="261166332"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261166332" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Esteban KÃ¼ber <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261166332">(Nov 11 2021 at 18:00)</a>:</h4>
<p>hahaha, I think people would get even madder with me if I took that one away from them</p>



<a name="261166354"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261166354" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Esteban KÃ¼ber <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261166354">(Nov 11 2021 at 18:01)</a>:</h4>
<p><code>yeets</code> <span aria-label="eyes" class="emoji emoji-1f440" role="img" title="eyes">:eyes:</span></p>



<a name="261166382"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261166382" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261166382">(Nov 11 2021 at 18:01)</a>:</h4>
<p>lol, I meant for errors, not for generators :-)</p>



<a name="261166391"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261166391" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Esteban KÃ¼ber <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261166391">(Nov 11 2021 at 18:01)</a>:</h4>
<p>ah! I see, yes.</p>



<a name="261166419"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261166419" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Esteban KÃ¼ber <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261166419">(Nov 11 2021 at 18:02)</a>:</h4>
<p>I see what you mean, you're qualifying your sense of taste <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="261166510"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261166510" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261166510">(Nov 11 2021 at 18:02)</a>:</h4>
<p>indeed, I believe it is a sense of taste that is not universally popular :-)</p>



<a name="261166619"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261166619" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Esteban KÃ¼ber <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261166619">(Nov 11 2021 at 18:03)</a>:</h4>
<p>I started the <code>fn*</code> version as a joke, I have to say I kind of like it now.</p>



<a name="261166772"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261166772" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Esteban KÃ¼ber <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261166772">(Nov 11 2021 at 18:05)</a>:</h4>
<p>and I liked the idea of having a modifier as part of the header of the item, likely due to anchorage from the initial proposal of <code>gen foo</code> and <code>gen fn foo</code>, but the more I think about it, the trailing <code>yields Ty</code> serves it function...</p>



<a name="261166810"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261166810" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Esteban KÃ¼ber <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261166810">(Nov 11 2021 at 18:05)</a>:</h4>
<p>I've seen some people that missed the <code>*</code>, I wonder if they missed the <code>yields</code> too</p>



<a name="261166879"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261166879" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Esteban KÃ¼ber <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261166879">(Nov 11 2021 at 18:06)</a>:</h4>
<p>if you scan through code, I'm guessing you tend to look before the arguments for info of a function... but maybe I'm wrong</p>



<a name="261167089"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261167089" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261167089">(Nov 11 2021 at 18:08)</a>:</h4>
<p>I wonder how important it is to notice? Python at least doesnâ€™t make any distinction in the signature</p>



<a name="261167163"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261167163" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Sartor <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261167163">(Nov 11 2021 at 18:09)</a>:</h4>
<p>Not that they exact syntax needs to be settled right away, but IMO iterator/stream blocks are just as important as iterator/stream functions (if not more so).</p>



<a name="261167178"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261167178" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261167178">(Nov 11 2021 at 18:09)</a>:</h4>
<p>I must admit to often missing the â€˜asyncâ€™ when reviewing code, so I am maybe not the best person to answer this question ðŸ˜€</p>



<a name="261167396"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261167396" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Sartor <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261167396">(Nov 11 2021 at 18:11)</a>:</h4>
<p>That makes a keyword-less version of the feature kinda hard.</p>



<a name="261167545"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261167545" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Sartor <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261167545">(Nov 11 2021 at 18:12)</a>:</h4>
<p>(sorry to interject but I have a hard time letting go of generator/coroutine/iterator proposals lol)</p>



<a name="261167616"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261167616" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Esteban KÃ¼ber <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261167616">(Nov 11 2021 at 18:13)</a>:</h4>
<p>Why is the expression version more important, if I can ask?</p>



<a name="261167975"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261167975" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Sartor <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261167975">(Nov 11 2021 at 18:17)</a>:</h4>
<p>The trivial argument is that it parallels async and try blocks. But in general I think it is very nice to be able to capture data in iterators/streams vs pass it in explicitly. Obviously we could add iterator closures, but arguments act basically the same as captures in that case so it just feels sorta silly.</p>



<a name="261168209"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261168209" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Sartor <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261168209">(Nov 11 2021 at 18:19)</a>:</h4>
<p>The underlying mechanism for iterator items supports captures, so I'd feel bad not allowing users to take advantage.</p>



<a name="261168417"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261168417" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Esteban KÃ¼ber <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261168417">(Nov 11 2021 at 18:21)</a>:</h4>
<p>I agree, it's just that I'm trying to land the smallest possible unit on a path to stabilization that <em>doesn't preclude</em> later expansions.</p>



<a name="261168605"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261168605" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Esteban KÃ¼ber <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261168605">(Nov 11 2021 at 18:23)</a>:</h4>
<p>For sync iterators, <code>from_fn</code> <em>already</em> serves the function of the closure generator relatively well, while the item version has the benefit of being able to be <em>very</em> specific on what the types involved are. I think that inference might be tricky when it comes to the closure version (despite nightly already having them).</p>



<a name="261168648"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261168648" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Esteban KÃ¼ber <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261168648">(Nov 11 2021 at 18:23)</a>:</h4>
<p>I think we want to have them, but I fear they'll stop <em>anything</em> landing if we don't focus on a specific part :)</p>



<a name="261168992"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261168992" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Sartor <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261168992">(Nov 11 2021 at 18:27)</a>:</h4>
<p>Totally! I would personally focus on blocks first and do functions later but that is just my style. I just wanted to throw it out there that an <code>fn*</code> or implicit syntax conflicts roughly with obvious future expansions in my mind.</p>



<a name="261169032"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261169032" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Sartor <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261169032">(Nov 11 2021 at 18:27)</a>:</h4>
<p>Definitely a bikeshed though.</p>



<a name="261169103"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261169103" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Sartor <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261169103">(Nov 11 2021 at 18:28)</a>:</h4>
<p>I have lots of options on paint color <span aria-label="grinning face with smiling eyes" class="emoji emoji-1f601" role="img" title="grinning face with smiling eyes">:grinning_face_with_smiling_eyes:</span></p>



<a name="261169763"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261169763" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Esteban KÃ¼ber <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261169763">(Nov 11 2021 at 18:34)</a>:</h4>
<p>I am very much <em>against</em> implicit syntax for this</p>



<a name="261169798"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261169798" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Esteban KÃ¼ber <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261169798">(Nov 11 2021 at 18:34)</a>:</h4>
<p>I'm not sure what <code>fn*</code> precludes, but that's why I created the proc-macro, so that we can explore these in public :)</p>



<a name="261170176"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261170176" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Sartor <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261170176">(Nov 11 2021 at 18:38)</a>:</h4>
<p>It think precludes any sort of iterator blocks in the future. A <code>gen</code> keyword does not.</p>



<a name="261170393"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261170393" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Esteban KÃ¼ber <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261170393">(Nov 11 2021 at 18:40)</a>:</h4>
<p>Adding a whole new keyword requires a new edition, it might still be worth it, but it is a consideration</p>



<a name="261170410"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261170410" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Sartor <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261170410">(Nov 11 2021 at 18:40)</a>:</h4>
<p>Totally</p>



<a name="261170444"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261170444" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Sartor <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261170444">(Nov 11 2021 at 18:40)</a>:</h4>
<p>I do agree that from_fn + a coroutine syntax works pretty well for the capturing case, so maybe we don't really need to worry about iterator blocks at all. But at this point I am not optimistic about the language getting coroutines done in the near future.</p>



<a name="261170802"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261170802" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Sartor <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261170802">(Nov 11 2021 at 18:44)</a>:</h4>
<p>I feel bad I'm bikeshedding when you specifically created the proc_macro so people can show rather than tell. I'll call it quits here and go make a demo if you want.</p>



<a name="261172897"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261172897" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Esteban KÃ¼ber <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261172897">(Nov 11 2021 at 19:05)</a>:</h4>
<p>I want to make sure these convos are not left in chat only, I want that repo to be self-contained with enough context for answering these questions to t-lang.</p>



<a name="261195221"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261195221" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261195221">(Nov 11 2021 at 23:19)</a>:</h4>
<p><span class="user-mention silent" data-user-id="119031">Esteban KÃ¼ber</span> <a href="#narrow/stream/187312-wg-async-foundations/topic/Generator.20syntax/near/261170393">said</a>:</p>
<blockquote>
<p>Adding a whole new keyword requires a new edition, it might still be worth it, but it is a consideration</p>
</blockquote>
<p>Actually adding the keyword requires an edition, but we can start with <code>k#gen</code>.</p>



<a name="261195252"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261195252" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261195252">(Nov 11 2021 at 23:19)</a>:</h4>
<p><span class="user-mention" data-user-id="119031">@Esteban KÃ¼ber</span> Also, I like the idea of having a keyword like <code>gen fn</code>, rather than <code>fn*</code>, because that naturally extends to <code>gen || { ... }</code> and possibly <code>gen { ... }</code>.</p>



<a name="261195355"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261195355" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261195355">(Nov 11 2021 at 23:21)</a>:</h4>
<p>(Also, we've talked about letting people opt-in to new keywords, prior to an edition boundary making it available by default.)</p>



<a name="261195428"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261195428" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261195428">(Nov 11 2021 at 23:22)</a>:</h4>
<p>So you could write <code>k#gen</code>, or you could write <code>#![keywords(gen)]</code> ( <span aria-label="bike" class="emoji emoji-1f6b2" role="img" title="bike">:bike:</span> <span aria-label="house" class="emoji emoji-1f3e0" role="img" title="house">:house:</span> <span aria-label="painting" class="emoji emoji-1f3a8" role="img" title="painting">:painting:</span>) at the top of your module and then write <code>gen</code>.</p>



<a name="261195469"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261195469" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261195469">(Nov 11 2021 at 23:23)</a>:</h4>
<p><span class="user-mention" data-user-id="119031">@Esteban KÃ¼ber</span> Does that make the idea of a keyword more appealing?</p>



<a name="261195483"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261195483" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Esteban KÃ¼ber <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261195483">(Nov 11 2021 at 23:23)</a>:</h4>
<p>Oh! That's an interesting idea that I hadn't heard of</p>



<a name="261195492"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261195492" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Esteban KÃ¼ber <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261195492">(Nov 11 2021 at 23:23)</a>:</h4>
<p>it absolutely changes my opinion</p>



<a name="261195569"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261195569" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Esteban KÃ¼ber <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261195569">(Nov 11 2021 at 23:24)</a>:</h4>
<p>for things like <code>gen</code> I can treat it in the parser and suggest <code>k#gen</code> automatically, but that doesn't please by aesthetic sensitivities, but being able to opt-into the new keywords flips the equation in my eyes</p>



<a name="261195603"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261195603" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261195603">(Nov 11 2021 at 23:25)</a>:</h4>
<p>Yeah, I think you'd just emit a suggestion to add the opt-in to the module.</p>



<a name="261195684"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261195684" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261195684">(Nov 11 2021 at 23:26)</a>:</h4>
<p>On a different note, I wonder if we could define a shorthand syntax that would allow <code>-&gt; impl Iterator&lt;T&gt;</code> rather than <code>-&gt; impl Iterator&lt;Item = T&gt;</code>.</p>



<a name="261195702"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261195702" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261195702">(Nov 11 2021 at 23:27)</a>:</h4>
<p>I think that'd feel <em>substantially</em> less verbose.</p>



<a name="261195724"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261195724" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Sartor <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261195724">(Nov 11 2021 at 23:27)</a>:</h4>
<p>I was really wishing for <code>Iterator&lt;T&gt;</code> just minutes ago when sketching this out.</p>



<a name="261195777"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261195777" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Sartor <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261195777">(Nov 11 2021 at 23:28)</a>:</h4>
<p>I don't know how you'd motivate it in Rust, but someone coming from Python for example probably just expects that to work in any case.</p>



<a name="261195813"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261195813" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Sartor <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261195813">(Nov 11 2021 at 23:29)</a>:</h4>
<p>It could be <code>fn thing() -&gt; Iterator!&lt;i32&gt;</code> I guess, but that seems super ugly.</p>



<a name="261195821"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261195821" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261195821">(Nov 11 2021 at 23:29)</a>:</h4>
<p><span class="user-mention silent" data-user-id="222520">Sam Sartor</span> <a href="#narrow/stream/187312-wg-async-foundations/topic/Generator.20syntax/near/261195777">said</a>:</p>
<blockquote>
<p>I don't know how you'd motivate it in Rust, but someone coming from Python for example probably just expects that to work in any case.</p>
</blockquote>
<p>I have no problem with the idea of "if a trait has exactly one associated type, and zero generic arguments, you may abbreviate <code>Trait&lt;typename=T&gt;</code> as <code>Trait&lt;T&gt;</code>".</p>



<a name="261195837"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261195837" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261195837">(Nov 11 2021 at 23:29)</a>:</h4>
<p>(and if there's any ambiguity, you go back to having to write <code>typename=</code>.)</p>



<a name="261195892"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261195892" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Sartor <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261195892">(Nov 11 2021 at 23:30)</a>:</h4>
<p>It would be sooo nice with Future too</p>



<a name="261195895"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261195895" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261195895">(Nov 11 2021 at 23:30)</a>:</h4>
<p>Yup.</p>



<a name="261195911"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261195911" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261195911">(Nov 11 2021 at 23:30)</a>:</h4>
<p>If someone feels sufficiently motivated to follow through with an MCP writeup, I'll happily second it.</p>



<a name="261195936"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261195936" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261195936">(Nov 11 2021 at 23:30)</a>:</h4>
<p>Just for that narrow case (single associated type, no generic arguments).</p>



<a name="261195965"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261195965" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261195965">(Nov 11 2021 at 23:31)</a>:</h4>
<p>Hmmm. One alternative that might be even better: make it opt-in by the trait.</p>



<a name="261195975"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261195975" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261195975">(Nov 11 2021 at 23:31)</a>:</h4>
<p>Then if you think you might add more arguments in the future (with defaults, so that they might be compatible), you could avoid opting in.</p>



<a name="261196029"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261196029" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Sartor <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261196029">(Nov 11 2021 at 23:32)</a>:</h4>
<p>Yah, I was just wondering if it should be an attribute or something.</p>



<a name="261196045"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261196045" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Sartor <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261196045">(Nov 11 2021 at 23:32)</a>:</h4>
<p>I'd love to put together an MCP!</p>



<a name="261196153"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261196153" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Sartor <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261196153">(Nov 11 2021 at 23:34)</a>:</h4>
<p>My big question is would this increase new user confusion with associated types or decrease it?</p>



<a name="261196175"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261196175" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261196175">(Nov 11 2021 at 23:35)</a>:</h4>
<p>We may want to check with people who teach Rust, but I suspect they may appreciate the ability to defer discussion of associated types.</p>



<a name="261196181"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261196181" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Esteban KÃ¼ber <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261196181">(Nov 11 2021 at 23:35)</a>:</h4>
<p>Regarding expectations, I've been beating the drum of "use errors to tell people how their expectation diverged, and if we know what they wanted, recover to continue evaluating and suggest the right auto-applicable code"</p>



<a name="261196248"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261196248" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Esteban KÃ¼ber <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261196248">(Nov 11 2021 at 23:36)</a>:</h4>
<p>I'm slightly concerned about changing the trait suddenly breaking things (which is expected for type params, but nor for assoc types). That changes the stability guarantees that APIs have.</p>



<a name="261196258"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261196258" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Esteban KÃ¼ber <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261196258">(Nov 11 2021 at 23:36)</a>:</h4>
<p>Might not be a show-stopper, but it's something to consider.</p>



<a name="261196271"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261196271" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261196271">(Nov 11 2021 at 23:36)</a>:</h4>
<p>The opt-in would help with that.</p>



<a name="261196293"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261196293" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261196293">(Nov 11 2021 at 23:37)</a>:</h4>
<p>Vague idea for initial syntax bikeshed: <code>#[positional]</code></p>



<a name="261196302"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261196302" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261196302">(Nov 11 2021 at 23:37)</a>:</h4>
<p>(since it turns what looks like a named argument into a positional one)</p>



<a name="261196361"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261196361" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Sartor <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261196361">(Nov 11 2021 at 23:38)</a>:</h4>
<p>I like that. I don't see a reason to limit it to 1 associated type at that point either. Might as well give the attribute full control.</p>



<a name="261196410"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261196410" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261196410">(Nov 11 2021 at 23:39)</a>:</h4>
<p><span class="user-mention" data-user-id="222520">@Sam Sartor</span> Since it's opt-in, that's true.</p>



<a name="261196422"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261196422" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261196422">(Nov 11 2021 at 23:39)</a>:</h4>
<p>Presumably, then, they become positional arguments in the order they appear.</p>



<a name="261196464"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261196464" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261196464">(Nov 11 2021 at 23:40)</a>:</h4>
<p>I <em>do</em> think, however, it should be disallowed for any trait that has generic arguments.</p>



<a name="261196482"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261196482" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261196482">(Nov 11 2021 at 23:40)</a>:</h4>
<p>In theory you could arrange to put them in a specific order, but I think that's likely to lead to confusion.</p>



<a name="261196506"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261196506" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Sartor <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261196506">(Nov 11 2021 at 23:41)</a>:</h4>
<p>Agreed. It is technically doable but has no wholesome usecases that I can think of</p>



<a name="261196536"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261196536" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261196536">(Nov 11 2021 at 23:41)</a>:</h4>
<p><span class="user-mention silent" data-user-id="222520">Sam Sartor</span> <a href="#narrow/stream/187312-wg-async-foundations/topic/Generator.20syntax/near/261196506">said</a>:</p>
<blockquote>
<p>Agreed. It is technically doable but has no wholesome usecases that I can think of</p>
</blockquote>
<p>I love the phrase "no wholesome use cases".</p>



<a name="261196610"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261196610" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261196610">(Nov 11 2021 at 23:42)</a>:</h4>
<p><span class="user-mention" data-user-id="222520">@Sam Sartor</span> On a related note, we've been experimenting in the lang team with allowing more experimentation in nightly when doing so doesn't commit us to any stable expectations. So I think a seconded MCP would be sufficient to start <em>implementing</em> it in the nightly compiler.</p>



<a name="261196722"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261196722" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261196722">(Nov 11 2021 at 23:44)</a>:</h4>
<p>Rough sketch of how this could go:<br>
File MCP -&gt; second MCP -&gt; implement in nightly -&gt; experiment in nightly for a while -&gt; decide if we need an RFC -&gt; FCP to stabilize</p>



<a name="261196735"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261196735" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261196735">(Nov 11 2021 at 23:44)</a>:</h4>
<p>(We might also opt to stabilize <code>Iterator&lt;T&gt;</code> before stabilizing <code>#[positional]</code> itself, though I don't think we need to.)</p>



<a name="261196759"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261196759" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Sartor <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261196759">(Nov 11 2021 at 23:45)</a>:</h4>
<p>Hmmm, I sorta like that! It does seem like more and more steps keep getting added to the feature proposal process over the years, to better filter stuff out. But often that means that discussions just get bogged down without a concrete implementation to look at.</p>



<a name="261196856"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261196856" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Sartor <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261196856">(Nov 11 2021 at 23:46)</a>:</h4>
<p>Like, coroutines have been in that boat for ages now. A nightly experiment would have done a lot to sort it out.</p>



<a name="261196870"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261196870" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261196870">(Nov 11 2021 at 23:46)</a>:</h4>
<p><span class="user-mention" data-user-id="222520">@Sam Sartor</span> Yeah, when we first introduced the MCP process it felt like a net increase in complexity for proposers; we're trying to make it a net <em>decrease</em>.</p>



<a name="261196962"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261196962" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261196962">(Nov 11 2021 at 23:48)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/187312-wg-async-foundations/topic/Generator.20syntax/near/261196464">said</a>:</p>
<blockquote>
<p>I <em>do</em> think, however, it should be disallowed for any trait that has generic arguments.</p>
</blockquote>
<p>This is interesting to me, because I have a very strong intuition that associated types go after generic arguments, and would be surprised if it was written any other way, so I don't see an issue with allowing generic args before the "positional" args</p>



<a name="261197029"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261197029" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261197029">(Nov 11 2021 at 23:49)</a>:</h4>
<p><span class="user-mention" data-user-id="271719">@Mario Carneiro</span> I feel like allowing that might close off some opportunities, such as supporting named generic arguments, or improving the ability to evolve generics over time with defaults.</p>



<a name="261197041"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261197041" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261197041">(Nov 11 2021 at 23:49)</a>:</h4>
<p>I'm not saying we <em>couldn't</em> support it, but I'd want to see a good use case.</p>



<a name="261197123"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261197123" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261197123">(Nov 11 2021 at 23:50)</a>:</h4>
<p>I agree that <em>default</em> generics should be incompatible with positional args, which suggests that positional args really ought to be opt in</p>



<a name="261197155"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261197155" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261197155">(Nov 11 2021 at 23:51)</a>:</h4>
<p>but besides that, you can think of positional args as another kind of default generic syntax</p>



<a name="261197246"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261197246" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261197246">(Nov 11 2021 at 23:52)</a>:</h4>
<p>I don't think that named generic arguments are inhibited by positional args, you just need some rule for how to handle the mixture, same as any other language that does optionally named function arguments</p>



<a name="261197271"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261197271" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261197271">(Nov 11 2021 at 23:53)</a>:</h4>
<p><span class="user-mention silent" data-user-id="271719">Mario Carneiro</span> <a href="#narrow/stream/187312-wg-async-foundations/topic/Generator.20syntax/near/261197246">said</a>:</p>
<blockquote>
<p>I don't think that named generic arguments are inhibited by positional args, you just need some rule for how to handle the mixture, same as any other language that does optionally named function arguments</p>
</blockquote>
<p>Sure. But I'd propose that, in lieu of designing that rule, we prohibit the combination for now. :)</p>



<a name="261197307"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261197307" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261197307">(Nov 11 2021 at 23:53)</a>:</h4>
<p>We have an important and pervasive use case for <code>Iterator&lt;T&gt;</code> and <code>Future&lt;T&gt;</code>. I don't want to delay that while designing a rule to handle complex combinations of generic arguments and associated types.</p>



<a name="261197314"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261197314" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261197314">(Nov 11 2021 at 23:53)</a>:</h4>
<p>well, it's not hard to prohibit, considering that named generic args don't even exist yet</p>



<a name="261197373"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261197373" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261197373">(Nov 11 2021 at 23:54)</a>:</h4>
<p>(by which I mean type parameters referred by name, not associated types)</p>



<a name="261197374"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261197374" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261197374">(Nov 11 2021 at 23:54)</a>:</h4>
<p>I mean, I'd prefer to prohibit the combination with <em>any</em> generic arguments, for now, to bypass several potential design traps that seem likely to produce extended discussions.</p>



<a name="261197391"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261197391" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261197391">(Nov 11 2021 at 23:54)</a>:</h4>
<p>(Again, no opposition to the combination, but I'd like to conserve design bandwidth.)</p>



<a name="261200344"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261200344" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261200344">(Nov 12 2021 at 00:40)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/187312-wg-async-foundations/topic/Generator.20syntax/near/261195684">said</a>:</p>
<blockquote>
<p>On a different note, I wonder if we could define a shorthand syntax that would allow <code>-&gt; impl Iterator&lt;T&gt;</code> rather than <code>-&gt; impl Iterator&lt;Item = T&gt;</code>.</p>
</blockquote>
<p>See <a href="https://docs.rs/async_fn/0.0.2/async_fn/trait.Fut.html">https://docs.rs/async_fn/0.0.2/async_fn/trait.Fut.html</a></p>
<p>The above, btw, proves that your whole suggestion, <strong>at the cost of distinct names</strong>, could be covered by <code>trait</code> aliases:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">trait</span><span class="w"> </span><span class="n">Iter</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Iterator</span><span class="o">&lt;</span><span class="n">Item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>
<span class="k">trait</span><span class="w"> </span><span class="n">Fut</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Future</span><span class="o">&lt;</span><span class="n">Output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
<p>or use a module to handle the naming issue:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">mod</span> <span class="nn">generic_trait_shorthands</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">trait</span><span class="w"> </span><span class="n">Future</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>::<span class="n">core</span>::<span class="n">future</span>::<span class="n">Future</span><span class="o">&lt;</span><span class="n">Output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">trait</span><span class="w"> </span><span class="nb">Iterator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>::<span class="n">core</span>::<span class="n">iter</span>::<span class="nb">Iterator</span><span class="o">&lt;</span><span class="n">Item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>so as to do:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">use</span><span class="w"> </span><span class="o">..</span><span class="p">.</span>::<span class="n">generic_trait_shorthands</span>::<span class="p">{</span><span class="n">Future</span><span class="p">,</span><span class="w"> </span><span class="nb">Iterator</span><span class="p">};</span><span class="w"></span>
</code></pre></div>



<a name="261200753"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261200753" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261200753">(Nov 12 2021 at 00:48)</a>:</h4>
<p><span class="user-mention" data-user-id="232018">@Daniel Henry-Mantilla</span> Absolutely, but I'm not sure if that makes the proposal unnecessary.</p>



<a name="261200771"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261200771" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261200771">(Nov 12 2021 at 00:49)</a>:</h4>
<p>Not least of which that it'd be nice to support both <code>Iterator&lt;T&gt;</code> and <code>Iterator&lt;Item = T&gt;</code>.</p>



<a name="261202121"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261202121" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Sartor <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261202121">(Nov 12 2021 at 01:14)</a>:</h4>
<p>What do you all think? <a href="https://github.com/rust-lang/lang-team/issues/126">https://github.com/rust-lang/lang-team/issues/126</a></p>



<a name="261788982"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261788982" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261788982">(Nov 17 2021 at 14:13)</a>:</h4>
<p><span class="user-mention" data-user-id="119031">@Esteban KÃ¼ber</span> another question: I'm a bit unclear on the terminology from the blog post, in particular the difference (if any) between "iterator items" and "generators". AIUI, currently there is unstable syntax for generator closures - are you proposing keeping that around or removing/changing it? You are proposing iterator items (with the strawman <code>fn*</code> syntax), are these the only kind of generator functions we would support? Or would there be syntax for generator functions which are not iterator items too? Is there (or will you propose) syntax for invoking generators which are not iterators?</p>



<a name="261790911"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261790911" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261790911">(Nov 17 2021 at 14:26)</a>:</h4>
<p>And on a terminology note, AIUI, using "coroutine" to mean an async or parallel generator is a Python quirk. There seem to be many definitions for coroutines floating around so it's probably best avoiding the term altogether. But using it to mean an async generator seems to be begging for confusion</p>



<a name="261791056"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261791056" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261791056">(Nov 17 2021 at 14:27)</a>:</h4>
<p>In particular, for some definitions, I think the Generator trait defines a coroutine rather than a strict generator :-|</p>



<a name="261792782"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261792782" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Sartor <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261792782">(Nov 17 2021 at 14:39)</a>:</h4>
<p>I'll mention that in <a href="https://lang-team.rust-lang.org/design_notes/general_coroutines.html">the generalizing coroutines notes</a> I used "generator" strictly to mean any syntax which produces an <code>impl Iterator</code> or <code>impl Stream</code> and "corountine" to mean the syntax which underlies futures/generators (needs resume arguments and arbitrary return/yield types). But whatever terminology we use there are tradeoffs because "generator" is very overloaded: referring both to the current unstable feature which supports futures and a number of proposed Iterator/Stream syntaxes. I guess that is the reason why this proposal calls them "iterator items". But unfortunately the obvious keyword to reserve for an iterator item is "gen"...</p>



<a name="261795025"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261795025" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Sartor <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261795025">(Nov 17 2021 at 14:55)</a>:</h4>
<p>I've been doing my best not to shill yield closures here. But since I just linked the notes, here is the view from 30,000ft:</p>
<ul>
<li>Rust  needs some coroutine syntax somewhere which receives resume arguments</li>
<li>The most ergonomic generator syntax for <code>impl Stream</code> can not also take resume arguments</li>
</ul>



<a name="261795190"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261795190" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261795190">(Nov 17 2021 at 14:56)</a>:</h4>
<p>"Rust needs some coroutine syntax somewhere which receives resume arguments" - why?</p>



<a name="261795263"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261795263" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Sartor <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261795263">(Nov 17 2021 at 14:56)</a>:</h4>
<p>In my mind there is now way around having two separate features for the two different cases even if one is just a macro. Hence, it is a good idea for this proposal to focus strictly on <code>impl Iterator</code>/<code>impl Stream</code> and we just need to make sure it doesn't preclude stabilizing some form of general coroutine in the future.</p>



<a name="261795285"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261795285" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261795285">(Nov 17 2021 at 14:57)</a>:</h4>
<p>"The most ergonomic generator syntax for impl Stream can not also take resume arguments" I'm confused by this statement - does "can not" here mean "must not" or "does not"?</p>



<a name="261795444"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261795444" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261795444">(Nov 17 2021 at 14:58)</a>:</h4>
<p>Sorry, I meant why does Rust need the flexibility of generators which take arguments? What are the motivating use cases?</p>



<a name="261796335"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261796335" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Sartor <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261796335">(Nov 17 2021 at 15:04)</a>:</h4>
<p>Gosh, I really just need to write a whole blog post on resume arguments at this point. But pending that:<br>
Other programming languages can easily pass data by sharing a mutable reference between the inside of the coroutine and the outside world. Rust does not like that. This can be seen with the early implementation of <code>async { }</code>, which passed the <code>&amp;mut Context</code> via a thread_local and UnsafeCell (gross).  Futures got a significant elegance and performance bump with <a href="https://github.com/rust-lang/rust/pull/68524">https://github.com/rust-lang/rust/pull/68524</a>, which allowed the <code>&amp;mut Context</code> to be passed to the resume function directly. This could be a one-off thing inside the compiler just to support futures, but users of Rust are often in the same boat. <a href="https://docs.rs/futures/0.3.17/futures/io/trait.AsyncRead.html"><code>AsyncRead</code></a> is the first example which springs to mind: it receives the buffer on each resume. I can take the time to create some proper user stories if you want.</p>



<a name="261796971"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261796971" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Sartor <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261796971">(Nov 17 2021 at 15:08)</a>:</h4>
<p>The problem with adding user-defined resume arguments to any syntax which produces <code>impl Stream</code> is the <code>&amp;mut Context</code> resume argument. It conflicts fundamentally with those user-defined resume arguments. Conceptually: should the user-defined resume arguments be passed on every call to <code>poll_next</code> along with <code>&amp;mut Context</code>, or should the user-defined resume arguments be passed once per yield to produce a <code>impl Future</code> which then receives the async context separately? If you dig deeper into either option it gets nasty.</p>



<a name="261797101"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261797101" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Sartor <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261797101">(Nov 17 2021 at 15:09)</a>:</h4>
<p>That being said, any well-designed general coroutine syntax can be used to author Stream quite easily, with just a little bit of async-context-juggling and type conversion boilerplate. But Rust usually tries to avoid exposing <code>&amp;mut Context</code> when possible.</p>



<a name="261798821"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261798821" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Sartor <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261798821">(Nov 17 2021 at 15:20)</a>:</h4>
<p>Hence, there are good syntaxes for streams and good syntaxes for resume aguments but no good syntax for both. I admit the two syntaxes could be quite similar on their faces to the point that users might not notice the distinction, but the distinction must be there.</p>



<a name="261809417"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261809417" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261809417">(Nov 17 2021 at 16:29)</a>:</h4>
<p>Thanks for the explanations! Will digest ...</p>



<a name="261810153"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261810153" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Sartor <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261810153">(Nov 17 2021 at 16:34)</a>:</h4>
<p>Yah, that discussion is a heck of a tangent away from "what terminology is in use?" and should really happen at a future time and place.</p>



<a name="261823839"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261823839" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261823839">(Nov 17 2021 at 18:06)</a>:</h4>
<p>Hmm, does an iterator item desugar to a function which returns a generator object (analogous to async functions) or is the function itself the generator?</p>



<a name="261823962"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261823962" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261823962">(Nov 17 2021 at 18:06)</a>:</h4>
<p>And what does <code>return</code> mean in an iterator item?</p>



<a name="261824046"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261824046" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Sartor <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261824046">(Nov 17 2021 at 18:07)</a>:</h4>
<p>In this proposal it is the former, analogous to async functions. Generator blocks (i.e. <code>gen { ... }</code>) would give you a generator object directly.</p>



<a name="261824199"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261824199" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261824199">(Nov 17 2021 at 18:07)</a>:</h4>
<p>hmm, I guess that answers my generator block vs generator lambda question</p>



<a name="261824257"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261824257" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Sartor <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261824257">(Nov 17 2021 at 18:08)</a>:</h4>
<p><span class="user-mention silent" data-user-id="256841">Nick Cameron</span> <a href="#narrow/stream/187312-wg-async-foundations/topic/Generator.20syntax/near/261823962">said</a>:</p>
<blockquote>
<p>And what does <code>return</code> mean in an iterator item?</p>
</blockquote>
<p>Upon returning, the <code>next</code> impl will produce None and the underlying coroutine enters a poisoned state.</p>



<a name="261824288"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261824288" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Sartor <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261824288">(Nov 17 2021 at 18:08)</a>:</h4>
<p>Same as a async function really, but with Poll::Ready(T) instead of None.</p>



<a name="261824341"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261824341" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261824341">(Nov 17 2021 at 18:08)</a>:</h4>
<p>right, makes sense</p>



<a name="261824962"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261824962" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Sartor <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261824962">(Nov 17 2021 at 18:12)</a>:</h4>
<p>If we were to desugar into MCP-49-style yield closures, iterator items would look like:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">gen</span><span class="w"> </span><span class="k">fn</span> <span class="nf">foo</span><span class="p">(</span><span class="n">len</span>: <span class="kt">usize</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">usize</span> <span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">0</span><span class="o">..</span><span class="n">len</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kr">yield</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// BECOMES</span>

<span class="k">fn</span> <span class="nf">foo</span><span class="p">(</span><span class="n">len</span>: <span class="kt">usize</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">impl</span><span class="w"> </span><span class="nb">Iterator</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">=</span><span class="kt">usize</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">iter</span>::<span class="n">from_fn</span><span class="p">(</span><span class="k">move</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">0</span><span class="o">..</span><span class="n">len</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="kr">yield</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="nb">None</span><span class="w"></span>
<span class="w">    </span><span class="p">})</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="261825642"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261825642" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Sartor <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261825642">(Nov 17 2021 at 18:18)</a>:</h4>
<p>Or to illustrate my tangent above, a stream item will look like:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">async</span><span class="w"> </span><span class="n">gen</span><span class="w"> </span><span class="k">fn</span> <span class="nf">foo</span><span class="p">(</span><span class="n">len</span>: <span class="nc">impl</span><span class="w"> </span><span class="n">Future</span><span class="o">&lt;</span><span class="n">Output</span><span class="o">=</span><span class="kt">usize</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">usize</span> <span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">len</span><span class="p">.</span><span class="k">await</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">0</span><span class="o">..</span><span class="n">len</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kr">yield</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// BECOMES</span>

<span class="k">fn</span> <span class="nf">foo</span><span class="p">(</span><span class="n">len</span>: <span class="nc">impl</span><span class="w"> </span><span class="n">Future</span><span class="o">&lt;</span><span class="n">Output</span><span class="o">=</span><span class="kt">usize</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">impl</span><span class="w"> </span><span class="n">Stream</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">=</span><span class="kt">usize</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">stream</span>::<span class="n">from_fn</span><span class="p">(</span><span class="k">move</span><span class="w"> </span><span class="o">|</span><span class="n">ctx</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">len</span><span class="p">.</span><span class="k">await</span><span class="o">!</span><span class="p">(</span><span class="n">ctx</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">0</span><span class="o">..</span><span class="n">len</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="kr">yield</span><span class="w"> </span><span class="n">Ready</span><span class="p">(</span><span class="nb">Some</span><span class="p">(</span><span class="n">i</span><span class="p">));</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="n">Ready</span><span class="p">(</span><span class="nb">None</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">})</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="261826102"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261826102" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Sartor <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261826102">(Nov 17 2021 at 18:21)</a>:</h4>
<p>Although I should mention that the current iterator items prototype includes a way of specifying  size_hint, which the desugars above don't show.</p>



<a name="261827293"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261827293" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261827293">(Nov 17 2021 at 18:29)</a>:</h4>
<p>In Estebanâ€˜s doc?</p>



<a name="261827519"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261827519" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Sartor <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261827519">(Nov 17 2021 at 18:31)</a>:</h4>
<p><a href="https://github.com/estebank/iterator_item/blob/master/tests/gen_2996.rs#L6">https://github.com/estebank/iterator_item/blob/master/tests/gen_2996.rs#L6</a></p>



<a name="261911834"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261911834" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261911834">(Nov 18 2021 at 10:55)</a>:</h4>
<p><span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="261942508"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261942508" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261942508">(Nov 18 2021 at 15:29)</a>:</h4>
<p><span class="user-mention" data-user-id="222520">@Sam Sartor</span> <span class="user-mention" data-user-id="116883">@tmandry</span> and I have actually been thinking about a more general solution to this problem of "threading <code>&amp;mut</code> context around", we call them "with clauses" or "capabilities"</p>



<a name="261942669"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261942669" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261942669">(Nov 18 2021 at 15:30)</a>:</h4>
<p>there's a somewhat dated explanation <a href="https://rust-lang.github.io/async-fundamentals-initiative/evaluation/design/with_clauses.html">here</a></p>



<a name="261942680"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261942680" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261942680">(Nov 18 2021 at 15:30)</a>:</h4>
<p>I should probably take some time and bring it up to date</p>



<a name="261942808"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261942808" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261942808">(Nov 18 2021 at 15:31)</a>:</h4>
<p>in any case, I think the only sensible interpretation (although not the only <em>possible one</em>) around generators is that with clauses would be "resupplied" after each yield</p>



<a name="261942815"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261942815" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261942815">(Nov 18 2021 at 15:31)</a>:</h4>
<p>but I've been wanting to put more thought into that</p>



<a name="261942878"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261942878" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261942878">(Nov 18 2021 at 15:32)</a>:</h4>
<p><span class="user-mention" data-user-id="211722">@Yoshua Wuyts [he/they]</span> was pointing out to me the connection to effects, which seems right.</p>



<a name="261943134"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261943134" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Sartor <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261943134">(Nov 18 2021 at 15:34)</a>:</h4>
<p>Hmmmm, that is definitely a very interesting version of this which I'll need to think about more. It is also a feature I've wanted desperately in other contexts.</p>



<a name="261943258"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261943258" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261943258">(Nov 18 2021 at 15:35)</a>:</h4>
<p>Yes, I want it so bad.</p>



<a name="261943346"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261943346" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261943346">(Nov 18 2021 at 15:35)</a>:</h4>
<p>in the limit, you could imagine threading around an async runtime this way -- or all of std!</p>



<a name="261943426"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261943426" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261943426">(Nov 18 2021 at 15:36)</a>:</h4>
<p>that would push us into territory like <a href="https://blog.sunfishcode.online/introducing-cap-std/">cap-std</a>, hence the reason I've started calling these capabilities</p>



<a name="261943430"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261943430" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Sartor <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261943430">(Nov 18 2021 at 15:36)</a>:</h4>
<p>Certainly it is not necessary for general coroutines. But is opens up some interesting possibilities, especially if traits like Iterator/Future have default "associated clauses".</p>



<a name="261943587"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261943587" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Sartor <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261943587">(Nov 18 2021 at 15:37)</a>:</h4>
<p>Actix would love it because you could get a mutable reference to your actor by putting a with clause on your async blocks/fns.</p>



<a name="261943717"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Generator%20syntax/near/261943717" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Sartor <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Generator.20syntax.html#261943717">(Nov 18 2021 at 15:38)</a>:</h4>
<p>(which would be resupplied on resume)</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>