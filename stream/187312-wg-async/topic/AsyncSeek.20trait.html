<html>
<head><meta charset="utf-8"><title>AsyncSeek trait · wg-async · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/index.html">wg-async</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/AsyncSeek.20trait.html">AsyncSeek trait</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="275839250"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/AsyncSeek%20trait/near/275839250" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/AsyncSeek.20trait.html#275839250">(Mar 18 2022 at 17:49)</a>:</h4>
<p>Does anybody have experience using the AsyncSeek trait? Or thought about using Seek with async in any way?</p>



<a name="275839602"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/AsyncSeek%20trait/near/275839602" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/AsyncSeek.20trait.html#275839602">(Mar 18 2022 at 17:52)</a>:</h4>
<p>ISTM that it only makes sense with files? Is that why Tokio has a completion-like API for Seek rather than a readiness style one?</p>



<a name="275841617"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/AsyncSeek%20trait/near/275841617" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/AsyncSeek.20trait.html#275841617">(Mar 18 2022 at 18:06)</a>:</h4>
<p>It also makes sense with buffers.</p>



<a name="275841718"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/AsyncSeek%20trait/near/275841718" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/AsyncSeek.20trait.html#275841718">(Mar 18 2022 at 18:07)</a>:</h4>
<p>Right, true</p>



<a name="275841913"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/AsyncSeek%20trait/near/275841913" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/AsyncSeek.20trait.html#275841913">(Mar 18 2022 at 18:08)</a>:</h4>
<p>I wonder how useful that is? Like most seeks on a buffer should be sync, I'd expect reading into the buffer would want to be managed explicitly? (I have no experience using Seek, sync or async)</p>



<a name="275841962"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/AsyncSeek%20trait/near/275841962" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/AsyncSeek.20trait.html#275841962">(Mar 18 2022 at 18:09)</a>:</h4>
<p>"most seeks on a buffer should be sync" - I mean, there should be no need to be async because they'd be quick</p>



<a name="275844198"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/AsyncSeek%20trait/near/275844198" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/AsyncSeek.20trait.html#275844198">(Mar 18 2022 at 18:27)</a>:</h4>
<p>I came up with my own variants <code>Read</code>/<code>Write</code>/<code>Seek</code> when I first started Rust years ago; translating existing work from JavaScript to Rust: <a href="https://github.com/datrs/random-access-storage">https://github.com/datrs/random-access-storage</a>. If I had to redo this work today I would've just used the standard IO interfaces for it.</p>
<p>What's interesting about this crate imo is that it supported variable backends. So you could provide either a file or memory as the backend, and seek to random offsets in either. That made it especially useful when testing.</p>



<a name="275844553"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/AsyncSeek%20trait/near/275844553" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/AsyncSeek.20trait.html#275844553">(Mar 18 2022 at 18:30)</a>:</h4>
<p>Other prior art (I was involved with introducing both of these, as none existed at the time):</p>
<ul>
<li><a href="https://docs.rs/futures-io/latest/futures_io/trait.AsyncSeek.html"><code>futures_io::AsyncSeek</code></a></li>
<li><a href="https://docs.rs/async-std/latest/async_std/io/trait.Seek.html"><code>async_std::io::Seek</code></a></li>
</ul>



<a name="275861454"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/AsyncSeek%20trait/near/275861454" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/AsyncSeek.20trait.html#275861454">(Mar 18 2022 at 20:55)</a>:</h4>
<p><span class="user-mention silent" data-user-id="256841">Nick Cameron</span> <a href="#narrow/stream/187312-wg-async/topic/AsyncSeek.20trait/near/275841962">said</a>:</p>
<blockquote>
<p>"most seeks on a buffer should be sync" - I mean, there should be no need to be async because they'd be quick</p>
</blockquote>
<p>No need, true, but handling buffers and files in a uniform way requires them both to support async.</p>



<a name="275861475"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/AsyncSeek%20trait/near/275861475" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/AsyncSeek.20trait.html#275861475">(Mar 18 2022 at 20:55)</a>:</h4>
<p>I mean, arguably there's no reason to have async <em>write</em> on a buffer, either.</p>



<a name="275878752"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/AsyncSeek%20trait/near/275878752" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/AsyncSeek.20trait.html#275878752">(Mar 19 2022 at 00:38)</a>:</h4>
<p>No experience, but to me it seems a lot more natural to express something like this using an async <code>read_at</code> instead of awaiting a <code>seek</code> operation...</p>



<a name="275878770"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/AsyncSeek%20trait/near/275878770" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/AsyncSeek.20trait.html#275878770">(Mar 19 2022 at 00:38)</a>:</h4>
<p>That said, if you are literally reading off a magnetic tape, I can imagine such an API being quite useful.</p>



<a name="275878897"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/AsyncSeek%20trait/near/275878897" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/AsyncSeek.20trait.html#275878897">(Mar 19 2022 at 00:41)</a>:</h4>
<p>not sure we want to be optimizing that use case though :)</p>



<a name="275878908"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/AsyncSeek%20trait/near/275878908" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/AsyncSeek.20trait.html#275878908">(Mar 19 2022 at 00:41)</a>:</h4>
<p>/me adds "cassette tape RAID array" to the side projects list</p>



<a name="275881392"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/AsyncSeek%20trait/near/275881392" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/AsyncSeek.20trait.html#275881392">(Mar 19 2022 at 01:30)</a>:</h4>
<p>Common use case: you have modular code, and the other module isn't designed to read_at or write_at.</p>



<a name="275881400"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/AsyncSeek%20trait/near/275881400" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/AsyncSeek.20trait.html#275881400">(Mar 19 2022 at 01:30)</a>:</h4>
<p>Seek, then call some code to parse a format.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>