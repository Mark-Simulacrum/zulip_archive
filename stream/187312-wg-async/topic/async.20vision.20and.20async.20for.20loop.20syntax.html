<html>
<head><meta charset="utf-8"><title>async vision and async for loop syntax · wg-async · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/index.html">wg-async</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html">async vision and async for loop syntax</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="270789815"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270789815" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eholk <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270789815">(Feb 05 2022 at 00:03)</a>:</h4>
<p>Oh no, I think maybe I got the order wrong in mine...</p>



<a name="270789826"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270789826" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Khionu Sybiern <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270789826">(Feb 05 2022 at 00:03)</a>:</h4>
<p>No, your order reflected what was being proposed</p>



<a name="270789849"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270789849" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Khionu Sybiern <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270789849">(Feb 05 2022 at 00:03)</a>:</h4>
<p>I think we're in agreement that the order of operations matter in the order of the keywords</p>



<a name="270789906"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270789906" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270789906">(Feb 05 2022 at 00:04)</a>:</h4>
<p><span class="user-mention silent" data-user-id="421986">eholk</span> <a href="#narrow/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops/near/270789587">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="232018">Daniel Henry-Mantilla</span>'s suggestion to use braces makes the ordering clear, although I worry that the braces might be a little heavy syntactically.</p>
</blockquote>
<p>I'm actually still not clear on the ordering even with braces. I parse <code>for async try x in ...</code> as <code>for async { try { x } } in ...</code>, but it's not obvious if the ordering comes from "pulling" the <code>...</code> through the blocks or "pulling" the <code>x</code> through the blocks, which would produce two different orders.</p>



<a name="270789928"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270789928" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Khionu Sybiern <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270789928">(Feb 05 2022 at 00:04)</a>:</h4>
<p>So... I guess it's just a matter of keywords between the <code>for</code> keyword and the variable created</p>



<a name="270789940"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270789940" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270789940">(Feb 05 2022 at 00:04)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232018">Daniel Henry-Mantilla</span> <a href="#narrow/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops/near/270789658">said</a>:</p>
<blockquote>
<p><del>Oh yeah sorry I wrote an iterator of fallible futures <span aria-label="face palm" class="emoji emoji-1f926" role="img" title="face palm">:face_palm:</span></del></p>
<p>No wait, <code>Some((x, ))</code> first <code>.unwrap()</code>s, then does the <code>.0</code>, so <code>for async try</code> would indeed handle the <code>.await</code> first, and then the <code>?</code>: that is, we still read left-to-right, it's just that the binding is at the right of it all</p>
</blockquote>
<p>Edited it</p>



<a name="270789984"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270789984" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eholk <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270789984">(Feb 05 2022 at 00:05)</a>:</h4>
<p>I'm trying to think of this with a rough analogy to doing algebra, where <code>async { }</code> and <code>.await</code> are inverses, and <code>try { }</code> and <code>?</code> are inverses.</p>



<a name="270789990"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270789990" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270789990">(Feb 05 2022 at 00:05)</a>:</h4>
<p><span class="user-mention" data-user-id="232018">@Daniel Henry-Mantilla</span> That seems to assume that a future is logically an <code>async { code }</code> block, and you're pattern-matching away the <code>async { }</code> part as if it were a constructor.</p>



<a name="270790010"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270790010" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270790010">(Feb 05 2022 at 00:05)</a>:</h4>
<p>Which makes a kind of sense, but it isn't clear to me that it's the only semantic interpretation.</p>



<a name="270790012"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270790012" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Khionu Sybiern <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270790012">(Feb 05 2022 at 00:05)</a>:</h4>
<p>I think it's clear. Everything left of the <code>in</code> is left-to-right, everything right of is right-to-left</p>



<a name="270790076"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270790076" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270790076">(Feb 05 2022 at 00:06)</a>:</h4>
<p><span class="user-mention" data-user-id="252217">@Khionu Sybiern</span> s/left-to-right/outside-to-inside/ (since patterns can nest)?</p>



<a name="270790090"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270790090" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Khionu Sybiern <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270790090">(Feb 05 2022 at 00:06)</a>:</h4>
<p>Yeah</p>



<a name="270790091"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270790091" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eholk <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270790091">(Feb 05 2022 at 00:06)</a>:</h4>
<p><span class="user-mention silent" data-user-id="421986">eholk</span> <a href="#narrow/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops/near/270789984">said</a>:</p>
<blockquote>
<p>I'm trying to think of this with a rough analogy to doing algebra, where <code>async { }</code> and <code>.await</code> are inverses, and <code>try { }</code> and <code>?</code> are inverses.</p>
</blockquote>
<p>So you'd do something like:</p>
<div class="codehilite"><pre><span></span><code>let async { try { x } } = foo;
</code></pre></div>
<p>-&gt;</p>
<div class="codehilite"><pre><span></span><code>let async { try { x } }.await = foo.await;
</code></pre></div>
<p>-&gt;</p>
<div class="codehilite"><pre><span></span><code>let try { x } = foo.await;
</code></pre></div>
<p>-&gt;</p>
<div class="codehilite"><pre><span></span><code>let try { x }? = foo.await?;
</code></pre></div>
<p>-&gt;</p>
<div class="codehilite"><pre><span></span><code>let x = foo.await?;
</code></pre></div>



<a name="270790099"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270790099" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270790099">(Feb 05 2022 at 00:06)</a>:</h4>
<p>I'd hope that <code>for ANewtype(async try x) in ...</code> also works.</p>



<a name="270790161"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270790161" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270790161">(Feb 05 2022 at 00:07)</a>:</h4>
<p>And writing it that way, I think I <em>do</em> see the parse-order argument for why <code>.await?</code> could be confusing as well; in <code>for ANewtype(x.await?) in</code>, you'd peel off the ANewtype, then you'd run <code>await</code> and then <code>?</code>, which is neither fully inside-out nor fully outside-in.</p>



<a name="270790172"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270790172" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270790172">(Feb 05 2022 at 00:08)</a>:</h4>
<p>So, regarding the <code>Future</code> needs to be an <code>async { ... }</code> construct, I think we can then defer (<del>deref</del> <span aria-label="stuck out tongue closed eyes" class="emoji emoji-1f61d" role="img" title="stuck out tongue closed eyes">:stuck_out_tongue_closed_eyes:</span>) to the deref patterns proposals, which managed to suggest something trait-impl based rather than raw type based</p>



<a name="270790244"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270790244" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270790244">(Feb 05 2022 at 00:08)</a>:</h4>
<p>cc <span class="user-mention" data-user-id="116009">@nikomatsakis</span> who has had various thoughts on patterns and composability.</p>



<a name="270790262"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270790262" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270790262">(Feb 05 2022 at 00:08)</a>:</h4>
<p>And from there, deconstructing <code>async</code>-pattern would be an <code>.await</code> for any <code>impl Future</code>, and deconstructing a <code>try</code> would be a <code>?</code> for any <code>impl Try</code></p>



<a name="270790362"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270790362" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270790362">(Feb 05 2022 at 00:10)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops/near/270790099">said</a>:</p>
<blockquote>
<p>I'd hope that <code>for ANewtype(async try x) in ...</code> also works.</p>
</blockquote>
<p>So that, here, it would be <code>for async try ANewType(x)</code> when against an<br>
<code>impl IntoIterator&lt;_ = impl Future&lt;_ = impl Try&lt;Output = ANewType&gt;&gt;&gt;</code></p>



<a name="270790445"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270790445" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270790445">(Feb 05 2022 at 00:11)</a>:</h4>
<p><em>nod</em> (though that's still feeling painful to get the ordering right on), and what I wrote was intended for an iterator of <code>ANewtype</code> wrappers around futures returning results.</p>



<a name="270790521"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270790521" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270790521">(Feb 05 2022 at 00:12)</a>:</h4>
<p>e.g. <code>struct Newtype(Box&lt;dyn Future&lt;Output=Result&lt;...&gt;&gt;&gt;)</code></p>



<a name="270790541"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270790541" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270790541">(Feb 05 2022 at 00:13)</a>:</h4>
<p>w.r.t. ordering, at least when <em>writing</em> code, the type system would help; but w.r.t. <em>reading</em> code, maybe a warn-by-default-lint could start requiring bracesm, to later on be disabled once ppl get used to it</p>



<a name="270790578"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270790578" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270790578">(Feb 05 2022 at 00:13)</a>:</h4>
<p>/me is still not convinced that we can't find a readable way to use expression syntax to make this easier to understand the ordering of, though.</p>



<a name="270790641"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270790641" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270790641">(Feb 05 2022 at 00:14)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232018">Daniel Henry-Mantilla</span> <a href="#narrow/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops/near/270790541">said</a>:</p>
<blockquote>
<p>w.r.t. ordering, at least when <em>writing</em> code, the type system would help; but w.r.t. <em>reading</em> code, maybe a warn-by-default-lint could start requiring bracesm, to later on be disabled once ppl get used to it</p>
</blockquote>
<p>The ordering confusion I'm experiencing isn't helped by braces.</p>



<a name="270790680"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270790680" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270790680">(Feb 05 2022 at 00:15)</a>:</h4>
<p>So, another possibility:</p>



<a name="270790689"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270790689" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270790689">(Feb 05 2022 at 00:15)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops/near/270790578">said</a>:</p>
<p>It's an interesting venue, for sure <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="270790725"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270790725" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270790725">(Feb 05 2022 at 00:15)</a>:</h4>
<p>Haskell has "view patterns", in which you can write a pattern like <code>Thing(viewFunction =&gt; AnotherThing(value))</code>.</p>



<a name="270790773"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270790773" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270790773">(Feb 05 2022 at 00:16)</a>:</h4>
<p>We have ... macros <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="270790774"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270790774" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270790774">(Feb 05 2022 at 00:16)</a>:</h4>
<p>And that has the semantic effect of matching a Thing, then feeding the insides to <code>viewFunction</code>, then continuing to pattern match on the return value of <code>viewFunction</code>.</p>



<a name="270790810"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270790810" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270790810">(Feb 05 2022 at 00:16)</a>:</h4>
<p>If <code>ANewtype(thing.await?)</code> is confusing as a pattern (and I at least <em>understand</em> why it could be), what if we introduced a view-pattern-like syntax that lets us do things like <code>.await</code> or <code>?</code> and then continue to pattern-match?</p>



<a name="270790854"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270790854" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Khionu Sybiern <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270790854">(Feb 05 2022 at 00:17)</a>:</h4>
<p>I feel like this should be addressed from the LHS/RHS dichotomy, as the flow of state does reflect it</p>



<a name="270790908"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270790908" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270790908">(Feb 05 2022 at 00:18)</a>:</h4>
<p>Conceptual bikeshed, not a complete proposal <code>for ANewtype(`.await?` =&gt; thing) in ...</code></p>



<a name="270790910"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270790910" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270790910">(Feb 05 2022 at 00:18)</a>:</h4>
<p>Something like:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="kr">do</span><span class="w"> </span><span class="p">.</span><span class="k">await</span><span class="o">?</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"></span>
</code></pre></div>
<p><span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="270790935"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270790935" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270790935">(Feb 05 2022 at 00:18)</a>:</h4>
<p><span class="user-mention" data-user-id="232018">@Daniel Henry-Mantilla</span> So, one thought that <em>that</em> raises is that it might make sense to only allow these in infallible patterns, at least for now.</p>



<a name="270790951"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270790951" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Khionu Sybiern <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270790951">(Feb 05 2022 at 00:19)</a>:</h4>
<p>I wouldn't want this to be how the result of this discussion is explained, but you could say this is destructuring of a Future into it's awaited equivalent</p>



<a name="270790955"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270790955" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270790955">(Feb 05 2022 at 00:19)</a>:</h4>
<p>If we allowed them in fallible patterns, we'd have to deal with cases like "what if it doesn't match, will the next pattern await it <em>again</em>?".</p>



<a name="270790974"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270790974" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270790974">(Feb 05 2022 at 00:19)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops/near/270790935">said</a>:<br>
The part after the <code>=&gt;</code> would need to be infallible, yeah</p>



<a name="270790984"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270790984" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270790984">(Feb 05 2022 at 00:19)</a>:</h4>
<p><span class="user-mention" data-user-id="232018">@Daniel Henry-Mantilla</span> Fair distinction, yeah; the outer part <em>could</em> be fallible.</p>



<a name="270791050"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270791050" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270791050">(Feb 05 2022 at 00:20)</a>:</h4>
<p>But I also don't have a problem with simplifying to "the whole thing is only allowed in an infallible-pattern case, such as a loop pattern".</p>



<a name="270791105"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270791105" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270791105">(Feb 05 2022 at 00:21)</a>:</h4>
<p>So, <code>for SomeWrapper(viewpattern_bikeshed!(.await?) =&gt; thing) in ...</code></p>



<a name="270791169"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270791169" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270791169">(Feb 05 2022 at 00:22)</a>:</h4>
<p>Possible bikeshed issues: do we write the expression without a receiver, do we name the receiver somehow...</p>



<a name="270791185"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270791185" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270791185">(Feb 05 2022 at 00:22)</a>:</h4>
<p>I think in the common case, someone would want to <em>not</em> have to name two things if they only need one of those names.</p>



<a name="270791199"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270791199" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270791199">(Feb 05 2022 at 00:22)</a>:</h4>
<p>I was thinking that if it starts with a <code>.</code>, then it's an implicit receiver, otherwise, it's a callable against which it is piped</p>



<a name="270791238"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270791238" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270791238">(Feb 05 2022 at 00:23)</a>:</h4>
<p>Anyhow, maybe that ought to be split into another thread, for further discussion, and keep the <code>async try</code> discussion here</p>



<a name="270791372"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270791372" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270791372">(Feb 05 2022 at 00:25)</a>:</h4>
<p>I mean, this whole thread was about syntax and what that syntax should be. :)</p>



<a name="270791434"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270791434" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270791434">(Feb 05 2022 at 00:26)</a>:</h4>
<p>It's not like it's an off-topic syntax bikeshed for an underlying semantic construct; I think we're all in agreement that there should be a construct for looping over futures / results / etc.</p>



<a name="270791452"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270791452" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270791452">(Feb 05 2022 at 00:26)</a>:</h4>
<p><span class="user-mention silent" data-user-id="252217">Khionu Sybiern</span> <a href="#narrow/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops/near/270790951">said</a>:</p>
<blockquote>
<p>I wouldn't want this to be how the result of this discussion is explained, but you could say this is destructuring of a Future into it's awaited equivalent</p>
</blockquote>
<p>Sorry I haven't understood this <span aria-label="bow" class="emoji emoji-1f647" role="img" title="bow">:bow:</span> Would it be a description of what pattern-matching against <code>async _</code> would do/mean?</p>



<a name="270791487"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270791487" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Khionu Sybiern <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270791487">(Feb 05 2022 at 00:27)</a>:</h4>
<p>No, just how we're trying to insert awaiting as an operation</p>



<a name="270791569"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270791569" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270791569">(Feb 05 2022 at 00:28)</a>:</h4>
<p>Even though <code>async { }</code> is the dual of <code>.await</code>, and <code>try { }</code> is the dual of <code>?</code>, it still doesn't quite feel like a dual in the way that a <em>pattern</em> normally is.</p>



<a name="270791624"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270791624" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270791624">(Feb 05 2022 at 00:29)</a>:</h4>
<p>In particular, I think in part I'm finding it confusing because <code>try { code }</code> typically means "run this code and catch errors", and this would be introducing a <em>different</em> meaning of <code>try</code>.</p>



<a name="270791633"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270791633" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Khionu Sybiern <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270791633">(Feb 05 2022 at 00:29)</a>:</h4>
<p>True. <code>try { }</code> and <code>?</code> are equivalents while <code>async { }</code> and <code>.await</code> are beginning/end</p>



<a name="270791652"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270791652" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Khionu Sybiern <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270791652">(Feb 05 2022 at 00:29)</a>:</h4>
<p>Well... no, sorry, confused how <code>try</code> works</p>



<a name="270791656"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270791656" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270791656">(Feb 05 2022 at 00:29)</a>:</h4>
<p><span class="user-mention" data-user-id="252217">@Khionu Sybiern</span> I think I don't understand what you meant by that.</p>



<a name="270791716"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270791716" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Khionu Sybiern <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270791716">(Feb 05 2022 at 00:30)</a>:</h4>
<p>Nvm, just a blip in my thinking</p>



<a name="270791731"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270791731" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Khionu Sybiern <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270791731">(Feb 05 2022 at 00:30)</a>:</h4>
<p>I get what you mean, though, about how the relationships feel different</p>



<a name="270791738"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270791738" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270791738">(Feb 05 2022 at 00:30)</a>:</h4>
<p>This feels like it's using <code>try</code> and <code>async</code> to mean something noticeably different than what it usually means.</p>



<a name="270791740"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270791740" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eholk <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270791740">(Feb 05 2022 at 00:31)</a>:</h4>
<p>One thing that's kind of weird about <code>try { ... }</code> as a pattern is what infallibility means.</p>



<a name="270791753"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270791753" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270791753">(Feb 05 2022 at 00:31)</a>:</h4>
<p>True</p>



<a name="270791760"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270791760" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270791760">(Feb 05 2022 at 00:31)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="kr">try</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"></span>
</code></pre></div>



<a name="270791783"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270791783" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eholk <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270791783">(Feb 05 2022 at 00:31)</a>:</h4>
<p>If <code>let try { x } = foo()</code> is equivalent to <code>let x = foo()?</code>, it's weird that <code>try { ... }</code> on the left hand side leads to a control flow transfer to the end of the function.</p>



<a name="270791790"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270791790" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270791790">(Feb 05 2022 at 00:32)</a>:</h4>
<p><em>nod</em></p>



<a name="270791837"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270791837" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270791837">(Feb 05 2022 at 00:32)</a>:</h4>
<p>That's a great way of flagging the issue here.</p>



<a name="270791843"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270791843" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eholk <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270791843">(Feb 05 2022 at 00:32)</a>:</h4>
<p>And yeah, <code>if let try { ... } = foo()</code> is even weirder.</p>



<a name="270791848"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270791848" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270791848">(Feb 05 2022 at 00:32)</a>:</h4>
<p>We're used to <code>?</code> meaning a control-flow transfer; making <code>try</code> mean a control-flow transfer seems bad.</p>



<a name="270791867"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270791867" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eholk <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270791867">(Feb 05 2022 at 00:32)</a>:</h4>
<p>If the <code>...</code> returns <code>Err</code>, does the if test fail, or do we return from the function?</p>



<a name="270791869"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270791869" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270791869">(Feb 05 2022 at 00:32)</a>:</h4>
<p>Likewise, we're used to <code>.await</code> being a suspension point. We're not used to <code>async</code> being a suspension point.</p>



<a name="270791871"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270791871" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Khionu Sybiern <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270791871">(Feb 05 2022 at 00:32)</a>:</h4>
<p><code>let try { x }</code> then becomes equivalent to <code>let Ok(x)</code></p>



<a name="270791887"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270791887" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270791887">(Feb 05 2022 at 00:33)</a>:</h4>
<p>Yeah that's why I had started with <code>await</code> and <code>?</code> as the patterns themselves, despite the "inconsistency" with other patterns</p>



<a name="270791889"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270791889" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270791889">(Feb 05 2022 at 00:33)</a>:</h4>
<p>I think that captures what's bugging me here: we're making people have two names for the same semantic operation.</p>



<a name="270791891"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270791891" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Khionu Sybiern <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270791891">(Feb 05 2022 at 00:33)</a>:</h4>
<p>Actually, maybe it should be that simple</p>



<a name="270791895"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270791895" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270791895">(Feb 05 2022 at 00:33)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="o">?</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">..</span><span class="p">.;</span><span class="w"></span>
</code></pre></div>



<a name="270791913"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270791913" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Khionu Sybiern <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270791913">(Feb 05 2022 at 00:33)</a>:</h4>
<p><code>for Poll::Ready(x) in vec_of_futures</code></p>



<a name="270791920"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270791920" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270791920">(Feb 05 2022 at 00:33)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232018">Daniel Henry-Mantilla</span> <a href="#narrow/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax/near/270791887">said</a>:</p>
<blockquote>
<p>Yeah that's why I had started with <code>await</code> and <code>?</code> as the patterns themselves, despite the "inconsistency" with other patterns</p>
</blockquote>
<p>Right. But if we're going to make <code>?</code> and <code>await</code> be the patterns themselves, I'd prefer to have them be written like they would be in an expression, despite the ordering inconsistency that introduces.</p>



<a name="270791922"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270791922" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Khionu Sybiern <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270791922">(Feb 05 2022 at 00:33)</a>:</h4>
<p>Well... nvm</p>



<a name="270791984"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270791984" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Khionu Sybiern <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270791984">(Feb 05 2022 at 00:34)</a>:</h4>
<p>Is there any reason <code>async for</code> hasn't been brought up?</p>



<a name="270792027"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270792027" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Khionu Sybiern <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270792027">(Feb 05 2022 at 00:35)</a>:</h4>
<p>Feels like something that would be obvious if there wasn't a clear reason against it</p>



<a name="270792029"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270792029" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270792029">(Feb 05 2022 at 00:35)</a>:</h4>
<p><code>async for</code> reads very well, but then wouldn't "scale" / generalize to patterns. But then, do we really need the latter?</p>



<a name="270792032"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270792032" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eholk <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270792032">(Feb 05 2022 at 00:35)</a>:</h4>
<p>To me <code>async for</code> reads more like <code>async { for ... }</code></p>



<a name="270792044"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270792044" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270792044">(Feb 05 2022 at 00:35)</a>:</h4>
<p><span class="user-mention" data-user-id="252217">@Khionu Sybiern</span> It has, but 1) it has the same ordering confusion as <code>for async</code> (what does <code>async try for</code> mean), and 2) it doesn't compose, in that you can't use that to handle <code>ANewtype</code>-wrapped futures of results.</p>



<a name="270792050"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270792050" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270792050">(Feb 05 2022 at 00:35)</a>:</h4>
<p><span class="user-mention silent" data-user-id="421986">eholk</span> <a href="#narrow/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax/near/270792032">said</a>:</p>
<blockquote>
<p>To me <code>async for</code> reads more like <code>async { for ... }</code></p>
</blockquote>
<p>That too.</p>



<a name="270792052"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270792052" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Khionu Sybiern <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270792052">(Feb 05 2022 at 00:35)</a>:</h4>
<p>Alrighty, that all makes sense</p>



<a name="270792053"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270792053" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eholk <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270792053">(Feb 05 2022 at 00:35)</a>:</h4>
<p>Having the async to the right of the <code>for</code> makes it clearer to me that we are awaiting each item in the iterator.</p>



<a name="270792142"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270792142" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270792142">(Feb 05 2022 at 00:37)</a>:</h4>
<p><span class="user-mention" data-user-id="232018">@Daniel Henry-Mantilla</span> Ignoring the exact syntax bikeshed at the moment, would you anticipate any reason why <code>for SomeTupleType(x.await?, y?) in ...</code> (or <code>for SomeTupleType(async try x, try y) in</code>) shouldn't work?</p>



<a name="270792147"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270792147" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eholk <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270792147">(Feb 05 2022 at 00:37)</a>:</h4>
<p>Maybe it's worth bringing up here that I feel like the <code>ref</code> in <code>if let Some(ref x) = ...</code> is confusing to me, maybe for similar reasons to what we're talking about here?</p>



<a name="270792199"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270792199" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270792199">(Feb 05 2022 at 00:38)</a>:</h4>
<p><span class="user-mention" data-user-id="239881">@Josh Triplett</span> I don't</p>



<a name="270792239"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270792239" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Khionu Sybiern <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270792239">(Feb 05 2022 at 00:38)</a>:</h4>
<p>The only thing I see is the confusion between how this <code>try</code> keyword works and the <code>try</code> block</p>



<a name="270792247"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270792247" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270792247">(Feb 05 2022 at 00:39)</a>:</h4>
<p><span class="user-mention" data-user-id="421986">@eholk</span> Fair. I've gotten used to what <code>ref</code> and <code>ref mut</code> mean, and I feel like these are similar: "I'm matching a thing, and then I actually want the thing to be processed like this before I get it".</p>



<a name="270792252"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270792252" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270792252">(Feb 05 2022 at 00:39)</a>:</h4>
<p><span class="user-mention" data-user-id="421986">@eholk</span> heh, <a href="https://github.com/danielhenrymantilla/prettyplease-cli/blob/master/src/main.rs#L39-L42">I love <code>ref</code></a>, but I feel like I'm a minority, so the strangeness budget is indeed something to be mindful of</p>
<div class="spoiler-block"><div class="spoiler-header">
<p>Aside</p>
</div><div class="spoiler-content" aria-hidden="true">
<p>I could rant a bit about why I even like it for <code>let</code>s <span aria-label="scream" class="emoji emoji-1f631" role="img" title="scream">:scream:</span>, but since it's offtopic I won't (feel free to PM if curious)</p>
</div></div>



<a name="270792265"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270792265" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270792265">(Feb 05 2022 at 00:39)</a>:</h4>
<p>First you match inwards until you get to the <code>ref</code> or <code>ref mut</code>, then you take the thing you matched and take a <code>&amp;</code> or <code>&amp;mut</code> of that thing respectively.</p>



<a name="270792271"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270792271" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270792271">(Feb 05 2022 at 00:39)</a>:</h4>
<p>This does seem like a "view" in a similar way.</p>



<a name="270792310"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270792310" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270792310">(Feb 05 2022 at 00:40)</a>:</h4>
<p><span class="user-mention" data-user-id="232018">@Daniel Henry-Mantilla</span> I'm in the same group of preferring to write ref and ref mut, though I don't tend to use them in <code>let</code>.</p>



<a name="270792356"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270792356" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eholk <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270792356">(Feb 05 2022 at 00:40)</a>:</h4>
<p>Ah, that makes sense! The clarification is helpful.</p>



<a name="270792366"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270792366" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eholk <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270792366">(Feb 05 2022 at 00:41)</a>:</h4>
<p>I always feel like <code>let ref x = ...</code> and <code>let &amp;x = ...</code> should mean the same thing.</p>



<a name="270792615"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270792615" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Khionu Sybiern <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270792615">(Feb 05 2022 at 00:45)</a>:</h4>
<p>To share what's been on my mind while pondering this, Elixir is the one language I know of that has more powerful pattern matching than Rust, but a lot of that is due to type simplicity and very little (arguably no) syntactic magic. I would be interested in seeing this as simple from the pattern matching perspective as possible, though the whole process of awaiting does add complexity</p>



<a name="270792626"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270792626" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eholk <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270792626">(Feb 05 2022 at 00:46)</a>:</h4>
<p><code>for x.await? in ...</code> feels similar to <code>for ref x in ...</code> to me, now that I think about it a little more.</p>



<a name="270794161"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270794161" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270794161">(Feb 05 2022 at 01:09)</a>:</h4>
<p><span class="user-mention" data-user-id="421986">@eholk</span> I don't tend to use that, because I find <code>for x in something.iter()</code> or similar clearer to me, but I know many people do use it.</p>



<a name="270803132"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270803132" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270803132">(Feb 05 2022 at 04:05)</a>:</h4>
<p><code>for await x in …</code> is more consistent with <code>ref</code>, so the effect would be that it’s easier to remember what <code>ref</code> does</p>



<a name="270803373"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270803373" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270803373">(Feb 05 2022 at 04:10)</a>:</h4>
<p><span class="user-mention" data-user-id="116883">@tmandry</span> How would you envision it combining with <code>?</code> or with other patterns, though?</p>



<a name="270803381"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270803381" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270803381">(Feb 05 2022 at 04:10)</a>:</h4>
<p>I don’t think it’s entirely awful to use <code>?</code> in this way. <code>for ?await? x in …</code> is a little unfortunate but very consistent. you’re applying these operators left-to-right to the thing being matched, not the values you’re binding to</p>



<a name="270803391"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270803391" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270803391">(Feb 05 2022 at 04:11)</a>:</h4>
<p>also, that hopefully wouldn’t be common :)</p>



<a name="270803398"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270803398" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270803398">(Feb 05 2022 at 04:11)</a>:</h4>
<p>but I like the idea of views in patterns too. that seems generally useful in other ways</p>



<a name="270803746"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270803746" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270803746">(Feb 05 2022 at 04:22)</a>:</h4>
<p>if we could add <code>.ref</code> as a suffix operator it would start make more sense, too :)</p>



<a name="270803797"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270803797" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270803797">(Feb 05 2022 at 04:23)</a>:</h4>
<p><code>for ?await x in ..</code> seems really... not nice</p>



<a name="270803950"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270803950" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270803950">(Feb 05 2022 at 04:27)</a>:</h4>
<p>it might be ugly but it seems more consistent</p>



<a name="270804008"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270804008" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270804008">(Feb 05 2022 at 04:28)</a>:</h4>
<p>another option is making <code>.try</code> equivalent to <code>?</code> and using <code>try</code>..</p>



<a name="270804082"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270804082" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270804082">(Feb 05 2022 at 04:30)</a>:</h4>
<p>I highly value internal consistency, it means simpler mental models</p>



<a name="270804092"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270804092" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270804092">(Feb 05 2022 at 04:30)</a>:</h4>
<p>of course I’d also like it if we could figure out a syntax for views so we can sidestep this question :)</p>



<a name="270804149"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270804149" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270804149">(Feb 05 2022 at 04:32)</a>:</h4>
<p><code>for x =&gt; x?.await? in …</code> could mean “take this binding, evaluate the expression after =&gt;, and re-bind the result”</p>



<a name="270804162"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270804162" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270804162">(Feb 05 2022 at 04:33)</a>:</h4>
<p>but then we’re adding more syntax to the language instead of using it as a chance to reinforce stuff that rust already has</p>



<a name="270806658"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270806658" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rpjohnst <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270806658">(Feb 05 2022 at 05:26)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax/near/270791569">said</a>:</p>
<blockquote>
<p>Even though <code>async { }</code> is the dual of <code>.await</code>, and <code>try { }</code> is the dual of <code>?</code>, it still doesn't quite feel like a dual in the way that a <em>pattern</em> normally is.</p>
</blockquote>
<p>i want to push back on this idea that this would be a different kind of dual than other patterns. i agree it could be <em>confusing</em> for <code>let try { x } = foo</code> to transfer control, or for <code>let async { x } = foo</code> to suspend the function, but just like a <code>.x</code> expression corresponds to a <code>Struct { x }</code> pattern, <code>?</code> and <code>.await</code> really would correspond in the same way to <code>try { x }</code> and <code>async { x }</code> patterns.</p>
<p>instead, i would say that the real difference and source of confusion is that the expression-side "eliminators" <code>?</code> and <code>.await</code> have those extra control flow "side effects," while the struct eliminator <code>.x</code> does not.</p>



<a name="270953959"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270953959" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270953959">(Feb 07 2022 at 09:49)</a>:</h4>
<p>I'm pretty negative about this kind of approach for a few reasons: as mentioned above, the 'backwards' aspect of patterns is a big sticking point for new and intermediate users. I feel that we're in a good place with match ergonomics now, but for most users <code>ref</code> is still a confusing stumbling block. Making patterns more complex feels like it would be a step backwards. Second, I'm wary of patterns executing code rather than being totally passive destructuring. On the technical side, what happens if you have <code>x.await</code> on multiple match arms? Do you await once or twice? But more importantly, I think it makes things confusing for users, building a mental model of pattern matching (which is a new concept for most users) is tricky enough, but having to handle excecuting code as part of that seems rough</p>



<a name="270954092"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270954092" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270954092">(Feb 07 2022 at 09:50)</a>:</h4>
<p>Also, given the confusion between ref and &amp;, I'm very negative on the specifics of using try/?/Result and of async/await</p>



<a name="270985604"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270985604" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Frank Steffahn <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270985604">(Feb 07 2022 at 14:28)</a>:</h4>
<p>Some (deliberately) weird ideas of mine how to – potentially – extend this.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="k">await</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">42</span><span class="p">;</span><span class="w"></span>
<span class="c1">// x is a Future that outputs 42 now</span>
<span class="fm">assert_eq!</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="k">await</span><span class="p">,</span><span class="w"> </span><span class="mi">42</span><span class="p">);</span><span class="w"></span>
</code></pre></div>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">&amp;</span><span class="n">foo</span><span class="p">.</span><span class="k">await</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">expr</span><span class="p">;</span><span class="w"></span>
<span class="c1">// expr was a `Future&lt;Output = &amp;i32&gt;`, now `foo` is a `Future&lt;Output = i32&gt;`</span>
</code></pre></div>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="o">?</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">foo</span><span class="p">();</span><span class="w"></span>
<span class="c1">// same as</span>
<span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kr">try</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">foo</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
</code></pre></div>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="kr">try</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="o">?</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bar</span><span class="p">();</span><span class="w"></span>
<span class="c1">// only works if the Residual is `Copy`</span>
<span class="c1">// will turn e.g. `bar(): Option&lt;(S, T)&gt;` into</span>
<span class="c1">// a: Option&lt;S&gt;, and b: Option&lt;T&gt;</span>
</code></pre></div>



<a name="270995141"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270995141" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Ombura Jr. <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270995141">(Feb 07 2022 at 15:32)</a>:</h4>
<p>Hey all, wondering where the #wg-async-foundations stream is for today's meeting?</p>



<a name="270995991"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270995991" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Abhinav Kumar <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270995991">(Feb 07 2022 at 15:37)</a>:</h4>
<p><span class="user-mention silent" data-user-id="321490">Martin Ombura Jr.</span> <a href="#narrow/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax/near/270995141">said</a>:</p>
<blockquote>
<p>Hey all, wondering where the #wg-async-foundations stream is for today's meeting?</p>
</blockquote>
<p>This is my first time.. Trying to get the information myself</p>



<a name="270999837"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270999837" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Zeeshan Ali <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270999837">(Feb 07 2022 at 16:01)</a>:</h4>
<p>it's a text-chat-only and it happens right here :)</p>



<a name="270999946"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/270999946" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Ombura Jr. <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#270999946">(Feb 07 2022 at 16:02)</a>:</h4>
<p><span class="user-mention" data-user-id="400241">@Zeeshan Ali</span> so I assume it didnt take place today <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="271000406"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/271000406" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Zeeshan Ali <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#271000406">(Feb 07 2022 at 16:05)</a>:</h4>
<p>there are still 25 mins left afaik</p>



<a name="271021796"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/271021796" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eholk <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#271021796">(Feb 07 2022 at 18:29)</a>:</h4>
<p><span class="user-mention" data-user-id="476886">@Abhinav Kumar</span> - Sorry I didn't see this earlier. We did have the meeting today. It happens in a new topic in this Zulip stream, usually titled "Triage meeting YYYY-MM-DD." Normally the topic doesn't show up until right when we start it, although sometimes I put up a reminder a few minutes before. Hope you can make it next time!</p>



<a name="271034447"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/271034447" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#271034447">(Feb 07 2022 at 20:03)</a>:</h4>
<p><span class="user-mention silent" data-user-id="256841">Nick Cameron</span> <a href="#narrow/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax/near/270953959">said</a>:</p>
<blockquote>
<p>On the technical side, what happens if you have <code>x.await</code> on multiple match arms? Do you await once or twice?</p>
</blockquote>
<p>FWIW, this is a large part of why I'd suggest that we only allow this at a point where the pattern has been otherwise matched and is no longer refutable. Or, for simplicity's sake, only allow it in irrefutable patterns.</p>



<a name="271034503"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/271034503" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#271034503">(Feb 07 2022 at 20:04)</a>:</h4>
<p>That would still handle for-loops nicely.</p>



<a name="271074472"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/271074472" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Abhinav Kumar <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#271074472">(Feb 08 2022 at 02:53)</a>:</h4>
<p><span class="user-mention silent" data-user-id="421986">eholk</span> <a href="#narrow/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax/near/271021796">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="476886">Abhinav Kumar</span> - Sorry I didn't see this earlier. We did have the meeting today. It happens in a new topic in this Zulip stream, usually titled "Triage meeting YYYY-MM-DD." Normally the topic doesn't show up until right when we start it, although sometimes I put up a reminder a few minutes before. Hope you can make it next time!</p>
</blockquote>
<p>No problem <span class="user-mention" data-user-id="421986">@eholk</span> I will see you next time.</p>



<a name="272299479"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272299479" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272299479">(Feb 17 2022 at 18:05)</a>:</h4>
<p><span class="user-mention silent" data-user-id="363998">Ibraheem Ahmed</span> <a href="#narrow/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax/near/270803797">said</a>:</p>
<blockquote>
<p><code>for ?await x in ..</code> seems really... not nice</p>
</blockquote>
<p>I've not caught up on everything here <em>but</em> this is not what you would write, though. You want <code>for await? y in x</code> -- the effects for patterns go "inside out". The first thing we do is await. The next thing we do is apply <code>?</code>, and then we match what's left with <code>y</code>. If you want <code>for y.await? in x</code> (which might indeed be more learnable, I'd like to test that experimentally), then you do need to "invert" the order for postfix patterns (and you get a bunch of fun precedence problems... e.g. <code>&amp;x.await?</code>, what does that mean? (<code>await? &amp;x</code> vs <code>&amp;await? x</code> is unambiguous)</p>



<a name="272299634"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272299634" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272299634">(Feb 17 2022 at 18:06)</a>:</h4>
<p>in case you can't tell I favor extending patterns with</p>
<div class="codehilite"><pre><span></span><code>Pat := await Pat | ? Pat | ...
</code></pre></div>
<p>and then using analysis to ensure that those occur only in "irrefutable" positions (perhaps, to start, just in irrefutable patterns like <code>for</code> and <code>let</code>, though I'd like to support them in match arms too if they are guaranteed to execute)</p>



<a name="272299691"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272299691" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272299691">(Feb 17 2022 at 18:06)</a>:</h4>
<p>but I do have concerns because of the experience of <code>&amp;x</code> in pattern vs expr being confusing to folks</p>



<a name="272299707"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272299707" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272299707">(Feb 17 2022 at 18:06)</a>:</h4>
<p>I'm not sure that this is comparable though</p>



<a name="272300624"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272300624" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272300624">(Feb 17 2022 at 18:13)</a>:</h4>
<p>It seems not comparable, in that I expect await and ? as prefixes to be <em>harder</em> to deal with than &amp;.</p>



<a name="272300752"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272300752" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272300752">(Feb 17 2022 at 18:14)</a>:</h4>
<p>With &amp;, you're matching a reference with &amp; which logically "peels off" the &amp; and leaves you with the thing it references.</p>



<a name="272300779"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272300779" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272300779">(Feb 17 2022 at 18:14)</a>:</h4>
<p>Match &amp;x against &amp;thing and clearly x is thing.</p>



<a name="272300806"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272300806" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272300806">(Feb 17 2022 at 18:14)</a>:</h4>
<p>people do not experience it that way</p>



<a name="272300821"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272300821" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272300821">(Feb 17 2022 at 18:15)</a>:</h4>
<p>but carry on :)</p>



<a name="272300849"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272300849" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272300849">(Feb 17 2022 at 18:15)</a>:</h4>
<p>Hi, I'm a people. ;)</p>



<a name="272300869"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272300869" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272300869">(Feb 17 2022 at 18:15)</a>:</h4>
<p>there exist people who do not see it that way, is what I mean</p>



<a name="272300879"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272300879" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272300879">(Feb 17 2022 at 18:15)</a>:</h4>
<p>not all people, I agree, poor phrasing :)</p>



<a name="272300888"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272300888" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272300888">(Feb 17 2022 at 18:15)</a>:</h4>
<p>But acknowledged that this isn't the universal interpretation. It just seems like a logical one.</p>



<a name="272300920"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272300920" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272300920">(Feb 17 2022 at 18:15)</a>:</h4>
<p>in any case, you're saying that <code>await x</code> as a pattern doesn't lend itself to that interpretation?</p>



<a name="272300982"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272300982" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272300982">(Feb 17 2022 at 18:16)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax/near/272300888">said</a>:</p>
<blockquote>
<p>But acknowledged that this isn't the universal interpretation. It just seems like a logical one.</p>
</blockquote>
<p>I think part of is that the <code>&amp;x</code> rarely appears in the expression</p>



<a name="272300986"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272300986" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272300986">(Feb 17 2022 at 18:16)</a>:</h4>
<p>With await and ?, You don't use those symbols to construct the thing in the first place, so there's nothing for those symbols to match directly, and you have to think of them more abstractly.</p>



<a name="272300997"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272300997" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272300997">(Feb 17 2022 at 18:16)</a>:</h4>
<p>e.g. probably <code>for &amp;x in &amp;vec</code> is ... one thing, but <code>for &amp;x in vec.iter()</code> is another</p>



<a name="272301012"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272301012" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272301012">(Feb 17 2022 at 18:16)</a>:</h4>
<p>which seems potentially relevant here</p>



<a name="272301030"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272301030" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272301030">(Feb 17 2022 at 18:16)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> It appears in the "value" underneath, though.</p>



<a name="272301058"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272301058" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272301058">(Feb 17 2022 at 18:17)</a>:</h4>
<p>it appears in the <em>type</em>, right?</p>



<a name="272301071"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272301071" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272301071">(Feb 17 2022 at 18:17)</a>:</h4>
<p>"that function returns a &amp; so I'm peeling off the &amp;"</p>



<a name="272301129"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272301129" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272301129">(Feb 17 2022 at 18:17)</a>:</h4>
<p>I guess I expect the main source of confusion being that "you sometimes write <code>await x</code> and sometimes <code>x.await</code>"</p>



<a name="272301136"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272301136" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272301136">(Feb 17 2022 at 18:17)</a>:</h4>
<p>That too, but also, even if the value hasn't been named it's a reference, so it's not hard to think of a reference as logically being a value with a &amp; in it.</p>



<a name="272301166"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272301166" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272301166">(Feb 17 2022 at 18:18)</a>:</h4>
<p>like quite literally it's just not the same keystrokes :)</p>



<a name="272301167"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272301167" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272301167">(Feb 17 2022 at 18:18)</a>:</h4>
<p>That's a big part of what I'm getting at, yeah.</p>



<a name="272301253"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272301253" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272301253">(Feb 17 2022 at 18:18)</a>:</h4>
<p>At least if we spelled it <code>for async x</code>, you can imagine that all async blocks have an async on the outside of them, and you can peel it off to get to the inside.</p>



<a name="272301268"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272301268" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272301268">(Feb 17 2022 at 18:18)</a>:</h4>
<p>side note that .. hmm.. <code>fn foo() -&gt; async T</code> would be cool :) ah well</p>



<a name="272301291"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272301291" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272301291">(Feb 17 2022 at 18:18)</a>:</h4>
<p>I'm not convinced about the "matching and peeling" thing, I guess</p>



<a name="272301294"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272301294" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272301294">(Feb 17 2022 at 18:18)</a>:</h4>
<p>Which feels less accurate than it does for references, but nonetheless it makes a weird kind of sense.</p>



<a name="272301330"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272301330" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272301330">(Feb 17 2022 at 18:19)</a>:</h4>
<p>or, to put another way, I think there's <em>another</em> correspondence</p>



<a name="272301340"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272301340" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272301340">(Feb 17 2022 at 18:19)</a>:</h4>
<p>between <code>x.await</code> as an expression and a pattern</p>



<a name="272301368"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272301368" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272301368">(Feb 17 2022 at 18:19)</a>:</h4>
<p>that seems much more important than anything that appears in the <code>async fn</code> declaration</p>



<a name="272301381"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272301381" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272301381">(Feb 17 2022 at 18:19)</a>:</h4>
<p>anyway, to step back, I am interested in actually <em>measuring</em> this</p>



<a name="272301387"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272301387" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272301387">(Feb 17 2022 at 18:19)</a>:</h4>
<p>To be clear, I <em>do</em> favor x.await? as a pattern.</p>



<a name="272301399"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272301399" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272301399">(Feb 17 2022 at 18:19)</a>:</h4>
<p>this seems like just the kind of thing we can potentially run targeted experiments</p>



<a name="272301406"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272301406" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272301406">(Feb 17 2022 at 18:19)</a>:</h4>
<p>we should to Felienne about it :)</p>



<a name="272301503"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272301503" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272301503">(Feb 17 2022 at 18:20)</a>:</h4>
<blockquote>
<p>side note that .. hmm.. <code>fn foo() -&gt; async T</code> would be cool :) ah well</p>
</blockquote>
<p><code>trait Foo { async type O; fn foo() -&gt; Self::O; }</code></p>



<a name="272301507"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272301507" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272301507">(Feb 17 2022 at 18:20)</a>:</h4>
<p>I'm not opposed to <code>x.await?</code>, but I am very curious how to manage the precedence</p>



<a name="272301556"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272301556" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272301556">(Feb 17 2022 at 18:20)</a>:</h4>
<p>would be good to enumerate all the expected patterns</p>



<a name="272301986"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272301986" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272301986">(Feb 17 2022 at 18:23)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> One possibility: make it non-associative, such that you have to parenthesize, possibly with one or two exceptions.</p>



<a name="272302122"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272302122" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272302122">(Feb 17 2022 at 18:24)</a>:</h4>
<p>Another, which I think I'd favor: require that <code>.await</code> and <code>?</code> are done last in the pattern and can only occur after everything potentially refutable.</p>



<a name="272302207"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272302207" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272302207">(Feb 17 2022 at 18:25)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax/near/272301399">said</a>:</p>
<blockquote>
<p>this seems like just the kind of thing we can potentially run targeted experiments</p>
</blockquote>
<p><span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span> for measuring it if we can.</p>



<a name="272302398"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272302398" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272302398">(Feb 17 2022 at 18:26)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax/near/272301291">said</a>:</p>
<blockquote>
<p>I'm not convinced about the "matching and peeling" thing, I guess</p>
</blockquote>
<p>FWIW, "peeling" isn't quite the right metaphor to me, either, it's just a description of the later step. The important part of the metaphor, to me, is that:</p>
<ul>
<li>A pattern looks like a value, with placeholders</li>
<li>matching puts the pattern in correspondence with the value, and then sees what goes in the placeholders.</li>
</ul>



<a name="272302464"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272302464" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272302464">(Feb 17 2022 at 18:27)</a>:</h4>
<p><code>&amp;</code> is a thing that appears in a value, and the above works.</p>



<a name="272302525"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272302525" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272302525">(Feb 17 2022 at 18:27)</a>:</h4>
<p>This is why I <em>did</em> have sympathy for <code>ref</code> and <code>mut</code> being confusing in patterns, because they're an exception to the above.</p>



<a name="272302639"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272302639" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272302639">(Feb 17 2022 at 18:28)</a>:</h4>
<p><code>ref</code> <em>isn't</em> like a value; it's creating a <code>&amp;</code> where none existed before.</p>



<a name="272302708"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272302708" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272302708">(Feb 17 2022 at 18:29)</a>:</h4>
<p>It's logically "part of the placeholder".</p>



<a name="272302765"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272302765" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272302765">(Feb 17 2022 at 18:29)</a>:</h4>
<p>And I'd favor <code>.await</code> and <code>?</code> being "part of the placeholder" as well: you finish the match, then apply any placeholder modifiers.</p>



<a name="272304788"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272304788" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272304788">(Feb 17 2022 at 18:44)</a>:</h4>
<p>If we use <code>.await</code> in patterns I'd like to support <code>.ref</code> and <code>.mut</code> and maybe deprecate the prefix syntax</p>



<a name="272305703"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272305703" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272305703">(Feb 17 2022 at 18:51)</a>:</h4>
<p>user studies sound good, though I'm curious how you would measuring both "initial reaction" and approximating "how it is to use day to day"</p>



<a name="272305732"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272305732" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272305732">(Feb 17 2022 at 18:51)</a>:</h4>
<p>This all sounds like a lot of confusion, complex rules, and churn just to avoid a simpler special case in loops?</p>



<a name="272306096"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272306096" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272306096">(Feb 17 2022 at 18:54)</a>:</h4>
<p>Can you be more concrete about the simpler special case?</p>



<a name="272306165"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272306165" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272306165">(Feb 17 2022 at 18:54)</a>:</h4>
<p>sorry if we discussed it above, this thread is pretty long</p>



<a name="272307057"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272307057" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272307057">(Feb 17 2022 at 19:01)</a>:</h4>
<p>I think there have been a few different proposals, but something like for await x in foo</p>



<a name="272307162"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272307162" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272307162">(Feb 17 2022 at 19:02)</a>:</h4>
<p>In certain ways that doesn't seem simpler.</p>



<a name="272307229"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272307229" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272307229">(Feb 17 2022 at 19:03)</a>:</h4>
<p>Insofar as what it means in combination with other things.</p>



<a name="272307248"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272307248" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272307248">(Feb 17 2022 at 19:03)</a>:</h4>
<p>Not least of which <code>?</code>.</p>



<a name="272307259"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272307259" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dominik Stolz <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272307259">(Feb 17 2022 at 19:03)</a>:</h4>
<p>Hi, I was wondering how a composable "await pattern" is related to consuming an <code>AsyncIterator&lt;Item=T&gt;</code>. To me, having a special pattern that awaits would rather imply consuming an <code>Iterator&lt;Item=Future&lt;Output=T&gt;&gt;</code> or an arbitrarily nested variation thereof. My intuition, as an outsider, is that <code>AsyncIterator</code> is different from <code>Iterator</code> and as such requires a different kind of <code>for</code>-loop (e.g. a <code>for await</code>-loop).</p>



<a name="272307329"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272307329" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272307329">(Feb 17 2022 at 19:03)</a>:</h4>
<p>We went to a great deal of effort to create a .await syntax that nicely fit and was orthogonal to other things in the language, and I'd hate to lose that.</p>



<a name="272308107"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272308107" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272308107">(Feb 17 2022 at 19:09)</a>:</h4>
<p><span class="user-mention silent" data-user-id="302700">Dominik Stolz</span> <a href="#narrow/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax/near/272307259">said</a>:</p>
<blockquote>
<p>Hi, I was wondering how a composable "await pattern" is related to consuming an <code>AsyncIterator&lt;Item=T&gt;</code>. To me, having a special pattern that awaits would rather imply consuming an <code>Iterator&lt;Item=Future&lt;Output=T&gt;&gt;</code> or an arbitrarily nested variation thereof. My intuition, as an outsider, is that <code>AsyncIterator</code> is different from <code>Iterator</code> and as such requires a different kind of <code>for</code>-loop (e.g. a <code>for await</code>-loop).</p>
</blockquote>
<p>This is a good point. We need the loop itself to change; it doesn't really fit the "placeholder modifier" pattern, because after awaiting we may discover there is no value for the placeholder to bind to. In other words, you get a <code>Future&lt;Output = Option&lt;Item&gt;&gt;</code>, not an <code>Option&lt;Future&lt;Output = Item&gt;&gt;</code></p>



<a name="272308483"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272308483" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272308483">(Feb 17 2022 at 19:12)</a>:</h4>
<p>That’s fair but I’d also hate to complicate patterns, which are a really fundamental part of the language, for the sake of orthogonality</p>



<a name="272308526"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272308526" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272308526">(Feb 17 2022 at 19:13)</a>:</h4>
<p><span class="user-mention silent" data-user-id="256841">Nick Cameron</span> <a href="#narrow/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax/near/272308483">said</a>:</p>
<blockquote>
<p>That’s fair but I’d also hate to complicate patterns, which are a really fundamental part of the language, for the sake of orthogonality</p>
</blockquote>
<p>We complicated <code>.</code> syntax, which is rather fundamental, for the sake of orthogonality. :)</p>



<a name="272308691"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272308691" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272308691">(Feb 17 2022 at 19:14)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116883">tmandry</span> <a href="#narrow/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax/near/272308107">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="302700">Dominik Stolz</span> <a href="#narrow/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax/near/272307259">said</a>:</p>
<blockquote>
<p>Hi, I was wondering how a composable "await pattern" is related to consuming an <code>AsyncIterator&lt;Item=T&gt;</code>. To me, having a special pattern that awaits would rather imply consuming an <code>Iterator&lt;Item=Future&lt;Output=T&gt;&gt;</code> or an arbitrarily nested variation thereof. My intuition, as an outsider, is that <code>AsyncIterator</code> is different from <code>Iterator</code> and as such requires a different kind of <code>for</code>-loop (e.g. a <code>for await</code>-loop).</p>
</blockquote>
<p>This is a good point. We need the loop itself to change; it doesn't really fit the "placeholder modifier" pattern, because after awaiting we may discover there is no value for the placeholder to bind to. In other words, you get a <code>Future&lt;Output = Option&lt;Item&gt;&gt;</code>, not an <code>Option&lt;Future&lt;Output = Item&gt;&gt;</code></p>
</blockquote>
<p>Interesting point. The "placeholder modifier" syntax seems useful for the case of iterating over <code>Result</code> values and applying <code>?</code> (which comes up reasonably often), and for the case of iterating over <code>Future</code> values (which comes up much less often), but I agree that it doesn't quite work for the iterator itself being asynchronous.</p>



<a name="272309006"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272309006" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272309006">(Feb 17 2022 at 19:16)</a>:</h4>
<p><span class="user-mention silent" data-user-id="256841">Nick Cameron</span> <a href="#narrow/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax/near/272308483">said</a>:</p>
<blockquote>
<p>That’s fair but I’d also hate to complicate patterns, which are a really fundamental part of the language, for the sake of orthogonality</p>
</blockquote>
<p>I'm pretty sympathetic to this. My counterpoint is that the idea of placeholder modifiers we were discussing already exists, and by "putting more eggs in that basket" users would see them more and be less confused by <code>ref</code> and <code>ref mut</code></p>



<a name="272309187"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272309187" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272309187">(Feb 17 2022 at 19:18)</a>:</h4>
<p>but I'm also open to the possibility that actually we should avoid doing that because it will just add more cases to a fundamentally confusing concept</p>



<a name="272310000"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272310000" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272310000">(Feb 17 2022 at 19:24)</a>:</h4>
<p>I think the beauty of .await is that it doesn’t really complicate the . Syntax. Admittedly it’s not quite like a field access but it doesn’t have different rules for when it can be used or special ordering or anything, if you think of await as a method you’re not too far wrong</p>



<a name="272310103"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272310103" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272310103">(Feb 17 2022 at 19:25)</a>:</h4>
<p>I think users don’t see ref much any more so that confusion is much diminished. That’s another reason I’d be sad to make patterns more complicated again</p>



<a name="272329310"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272329310" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272329310">(Feb 17 2022 at 21:50)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116883">tmandry</span> <a href="#narrow/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax/near/272308107">said</a>:</p>
<blockquote>
<p>This is a good point. We need the loop itself to change; it doesn't really fit the "placeholder modifier" pattern, because after awaiting we may discover there is no value for the placeholder to bind to. In other words, you get a <code>Future&lt;Output = Option&lt;Item&gt;&gt;</code>, not an <code>Option&lt;Future&lt;Output = Item&gt;&gt;</code></p>
</blockquote>
<p>this...is true. I hadn't realized that indeed <code>for await</code> is not <em>quite</em> as orthogonal as I would like, though I think that saying "for await pattern" desugars to <code>while let await Some(pattern) = ...</code> is not the worst thing ever</p>



<a name="272329703"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272329703" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272329703">(Feb 17 2022 at 21:54)</a>:</h4>
<p><span class="user-mention silent" data-user-id="256841">Nick Cameron</span> <a href="#narrow/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax/near/272308483">said</a>:</p>
<blockquote>
<p>That’s fair but I’d also hate to complicate patterns, which are a really fundamental part of the language, for the sake of orthogonality</p>
</blockquote>
<p>I guess one person's "complicate" is another's enrich? I see value in being able to do (e.g.)</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">maybe_future</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nb">Option</span><span class="o">&lt;</span><span class="k">impl</span><span class="w"> </span><span class="n">Future</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="k">await</span><span class="w"> </span><span class="n">result</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">maybe_future</span><span class="p">()</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">"default"</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>More to the point, I do feel that having "special case" syntax that doesn't fit nicely together winds up feeling <em>more</em> complex in the end. I'm not sure where this falls, but I don't think the "complicated vs not" is as simple as you're making it out to be. </p>
<p>There's some good writing on this topic in <a href="https://www.manning.com/books/the-programmers-brain">The Programmer's Brain</a>; it kind of comes down to "if you are able to build an abstraction for something, it becomes 1 thing in your memory, even when it's complex".</p>
<p>It's not open-and-shut in either direction, but I am quite wary of trying to add "special forms" that can't be understood as "instances of a more general pattern".</p>



<a name="272380314"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272380314" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272380314">(Feb 18 2022 at 09:46)</a>:</h4>
<blockquote>
<p>I guess one person's "complicate" is another's enrich?</p>
</blockquote>
<p>true, true, and I don't want to over-simplify things. I'm not making an argument that we should never enhance features for the sake of simplicity</p>



<a name="272380855"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272380855" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272380855">(Feb 18 2022 at 09:52)</a>:</h4>
<blockquote>
<p>I see value in being able to do (e.g.)</p>
</blockquote>
<p>I feel like the examples so far (other than looping on streams) are a bit shallow, in this case one could do <code>let Some(result) = maybe_future().map(|f| f.await) else { ... }</code> and it is not that much less convenient. Even spelling the whole thing out with a match is not much worse. Perhaps you're thinking that real world examples will add enough complexity that the simple workarounds add up to inconvenience?</p>



<a name="272381362"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272381362" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272381362">(Feb 18 2022 at 09:58)</a>:</h4>
<blockquote>
<p>It's not open-and-shut in either direction, but I am quite wary of trying to add "special forms" that can't be understood as "instances of a more general pattern".</p>
</blockquote>
<p>My concern is that we make patterns less general and harder to form a single abstraction of. I wouldn't mind if we were adding something to patterns which fit with the existing abstraction (e.g., deref patterns - which I love). But here it seems like we're adding expression execution to patterns which didn't exist before and is a new concept to reason about, plus some patterns will not be allowed to be repeated, which is another fundamental change to the model of pattern. AND for the await keyword, there are now two syntaxes used in different places but which do fundamentally the same thing (worse, the one which will be more familiar to users from other languages is the one which is used less frequently).</p>



<a name="272381444"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272381444" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272381444">(Feb 18 2022 at 09:59)</a>:</h4>
<p>So, I don't like to add special forms as much as the next language designer :-), but in this case it seems like the less special thing in terms of complicating the user's mental models</p>



<a name="272381609"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272381609" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272381609">(Feb 18 2022 at 10:00)</a>:</h4>
<p>So <code>for await</code> is kind of ugly, but also I think intuitively it is very clear: it is just a for loop which awaits on each iteration, so I don't think that complicates the mental model for <code>for</code> very much</p>



<a name="272381656"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loop%20syntax/near/272381656" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loop.20syntax.html#272381656">(Feb 18 2022 at 10:01)</a>:</h4>
<p>Maybe <code>for.await</code> is better to make clear that the <code>await</code> modifies the <code>for</code> rather than the pattern?</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>