<html>
<head><meta charset="utf-8"><title>debuginfo: suspend points locations · wg-async · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/index.html">wg-async</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/debuginfo.3A.20suspend.20points.20locations.html">debuginfo: suspend points locations</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="275372810"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/debuginfo%3A%20suspend%20points%20locations/near/275372810" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/debuginfo.3A.20suspend.20points.20locations.html#275372810">(Mar 15 2022 at 13:31)</a>:</h4>
<p>At the moment the compiler encodes the <code>file:line</code> of <code>.await</code>s in debuginfo as  DW_AT_decl_file/ DW_AT_decl_line attributes of the DW_TAG_member representing the corresponding generator state. However, so far I found no way to actually access this information in a debugger. The extension APIs of GDB, LLDB, and WinDbg don't seem to expose this. <span class="user-mention" data-user-id="116883">@tmandry</span>, do you know if this is actively used somewhere?</p>
<p>It would be really nice to be able to see where in the code a given async fn is suspended :)</p>



<a name="275609962"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/debuginfo%3A%20suspend%20points%20locations/near/275609962" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/debuginfo.3A.20suspend.20points.20locations.html#275609962">(Mar 17 2022 at 05:50)</a>:</h4>
<p><span class="user-mention" data-user-id="124287">@mw</span> I don't know of anywhere it's actively used. I was hoping to have this prototyped in the fuchsia debugger but it never happened</p>



<a name="275628030"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/debuginfo%3A%20suspend%20points%20locations/near/275628030" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/debuginfo.3A.20suspend.20points.20locations.html#275628030">(Mar 17 2022 at 09:52)</a>:</h4>
<p>Thanks, <span class="user-mention" data-user-id="116883">@tmandry</span>!</p>
<p>I'm wondering how to best make this info available in all debuggers. How it's done currently looks like a clean solution to me -- but that doesn't help us if we can't get at the information <code>:)</code></p>
<p>The simplest way to do it might be to add an artificial field to the state struct description, the name of which encodes the info. </p>
<p>Another way would be to add an artifical type definition that has such a field for each state. That might be better because otherwise that weird artificial field would show up when looking at generators in the debugger. The only potential problem I see with that is that the linker or some other step would prune that debuginfo because it thinks it's unused. I'll experiment with that.</p>



<a name="275686321"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/debuginfo%3A%20suspend%20points%20locations/near/275686321" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/debuginfo.3A.20suspend.20points.20locations.html#275686321">(Mar 17 2022 at 16:33)</a>:</h4>
<p>The artificial type approach sounds good. You could link to it with an artificial field from the original type to prevent it from being pruned. That field would still show up but it would be a mundane name like <code>_dbginfo</code> instead of a bunch of gobbledegook</p>



<a name="275686455"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/debuginfo%3A%20suspend%20points%20locations/near/275686455" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/debuginfo.3A.20suspend.20points.20locations.html#275686455">(Mar 17 2022 at 16:34)</a>:</h4>
<p>and you could potentially hide the field with plugins</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>