<html>
<head><meta charset="utf-8"><title>async vision and async for loops · wg-async · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/index.html">wg-async</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops.html">async vision and async for loops</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="270787645"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loops/near/270787645" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops.html#270787645">(Feb 04 2022 at 23:38)</a>:</h4>
<p>I read the vision post at <a href="https://blog.rust-lang.org/inside-rust/2022/02/03/async-in-2022.html">https://blog.rust-lang.org/inside-rust/2022/02/03/async-in-2022.html</a> , and I wanted to bring up a syntax question we've discussed a few times in the lang team.</p>



<a name="270787666"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loops/near/270787666" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops.html#270787666">(Feb 04 2022 at 23:38)</a>:</h4>
<p>Rather than having a special-case syntax for <code>for await?</code> that people need to interpret, I'd love to extend pattern syntax in a composable way.</p>



<a name="270787704"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loops/near/270787704" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops.html#270787704">(Feb 04 2022 at 23:39)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">issue</span><span class="p">.</span><span class="k">await</span><span class="o">?</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">crabbycat</span>::<span class="n">issues</span><span class="p">(</span><span class="s">"https://github.com/rust-lang/rust"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</code></pre></div>



<a name="270787723"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loops/near/270787723" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops.html#270787723">(Feb 04 2022 at 23:39)</a>:</h4>
<p>Initially, we could define <code>?</code> and <code>.await</code> patterns, and those could compose.</p>



<a name="270787801"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loops/near/270787801" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops.html#270787801">(Feb 04 2022 at 23:40)</a>:</h4>
<p>So <code>for issue? in ...</code> would work in sync code, and <code>for issue?.await?</code> would work for the unusual case of something that can both fail to generate a future <em>and</em> fail in the future.</p>



<a name="270787869"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loops/near/270787869" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops.html#270787869">(Feb 04 2022 at 23:40)</a>:</h4>
<p>That feels more orthogonal and compositional.</p>



<a name="270787882"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loops/near/270787882" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops.html#270787882">(Feb 04 2022 at 23:41)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops/near/270787704">said</a>:</p>
<blockquote>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">issue</span><span class="p">.</span><span class="k">await</span><span class="o">?</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">crabbycat</span>::<span class="n">issues</span><span class="p">(</span><span class="s">"https://github.com/rust-lang/rust"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</code></pre></div><br>
</p>
</blockquote>
<p>is this equivalent to </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">for</span><span class="w"> </span><span class="n">issue</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">crabbycat</span>::<span class="n">issues</span><span class="p">(</span><span class="s">"https://github.com/rust-lang/rust"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">issue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">issue</span><span class="p">.</span><span class="k">await</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
</code></pre></div>



<a name="270787885"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loops/near/270787885" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops.html#270787885">(Feb 04 2022 at 23:41)</a>:</h4>
<p>Yes, exactly.</p>



<a name="270788011"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loops/near/270788011" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops.html#270788011">(Feb 04 2022 at 23:42)</a>:</h4>
<p>(Open question: we <em>could</em> allow that pattern syntax elsewhere, and make <code>match x { Variant(y.await?) =&gt; println!("{y}"), ... </code> work, but I'm not sure if we should or not. I like the orthogonality, but I also don't want to gate doing this for for loops on allowing it <em>everywhere</em>.)</p>



<a name="270788032"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loops/near/270788032" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops.html#270788032">(Feb 04 2022 at 23:42)</a>:</h4>
<p>(I think it's less <em>useful</em> in most places other than a loop.)</p>



<a name="270788539"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loops/near/270788539" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eholk <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops.html#270788539">(Feb 04 2022 at 23:49)</a>:</h4>
<p>Are there differences in what patterns are allowed in different contexts currently?</p>



<a name="270788636"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loops/near/270788636" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eholk <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops.html#270788636">(Feb 04 2022 at 23:50)</a>:</h4>
<p>It seems like saying "these are loop patterns," "these are match patterns," and "these are let patterns" would undo some of the advantages of orthogonality and composability that you get by making await patterns.</p>



<a name="270788676"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loops/near/270788676" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops.html#270788676">(Feb 04 2022 at 23:50)</a>:</h4>
<p>I agree, and that's my motivation for just allowing them everywhere.</p>



<a name="270788707"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loops/near/270788707" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops.html#270788707">(Feb 04 2022 at 23:51)</a>:</h4>
<p>I don't actually know if there are any patterns that we allow in some places and not others.</p>



<a name="270788742"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loops/near/270788742" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eholk <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops.html#270788742">(Feb 04 2022 at 23:51)</a>:</h4>
<p>Does this also mean that we'd be able to write both</p>
<div class="codehilite"><pre><span></span><code>let x.await? = foo();
</code></pre></div>
<p>and</p>
<div class="codehilite"><pre><span></span><code>let x = foo().await?;
</code></pre></div>
<p>?</p>



<a name="270788749"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loops/near/270788749" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops.html#270788749">(Feb 04 2022 at 23:51)</a>:</h4>
<p><span class="user-mention" data-user-id="239881">@Josh Triplett</span> I agree with it being a more general thing other than in <code>for</code> loops, and I agree with it being composable: this is exactly what patterns are about. I strongly disagree, however, with it using expression syntax rather than the classic dual of pattern syntax:</p>
<ul>
<li>
<p>we write <code>let [a, b] = arr;</code> not <code>let (a[0], b[1]) = arr</code>,</p>
</li>
<li>
<p>we write <code>for &amp;x in &amp;slice_of_copy_types</code>, not <code>for *x in &amp;slice_of_copy_types</code>;</p>
</li>
<li>
<p>thus, we should write <code>for await x in iterator_of_futures</code></p>
</li>
<li>
<p>and <code>for ?x in iterator_of_tryables</code></p>
</li>
</ul>



<a name="270788869"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loops/near/270788869" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops.html#270788869">(Feb 04 2022 at 23:52)</a>:</h4>
<p>(technically it should even have been <code>for async { x }</code> and <code>for try { x }</code>, but I'll grant that that doesn't read very naturally)</p>



<a name="270788890"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loops/near/270788890" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops.html#270788890">(Feb 04 2022 at 23:53)</a>:</h4>
<p><span class="user-mention" data-user-id="421986">@eholk</span> Yeah, it would.</p>



<a name="270788915"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loops/near/270788915" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops.html#270788915">(Feb 04 2022 at 23:53)</a>:</h4>
<p><span class="user-mention" data-user-id="232018">@Daniel Henry-Mantilla</span> I actually think <code>for async</code> or <code>async for</code> reads <em>better</em> than await.</p>



<a name="270788968"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loops/near/270788968" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops.html#270788968">(Feb 04 2022 at 23:54)</a>:</h4>
<p><code>try async for x in ...</code></p>



<a name="270788977"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loops/near/270788977" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops.html#270788977">(Feb 04 2022 at 23:54)</a>:</h4>
<p>Oh, interesting</p>



<a name="270788980"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loops/near/270788980" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops.html#270788980">(Feb 04 2022 at 23:54)</a>:</h4>
<p>But I expect it'd be confusing when composed.</p>



<a name="270788998"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loops/near/270788998" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops.html#270788998">(Feb 04 2022 at 23:54)</a>:</h4>
<p>But it would have to go after the <code>for</code>, still, if it is to be a pattern</p>



<a name="270789016"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loops/near/270789016" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eholk <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops.html#270789016">(Feb 04 2022 at 23:54)</a>:</h4>
<p>I think I like <code>try async</code> better after the <code>for</code></p>



<a name="270789025"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loops/near/270789025" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eholk <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops.html#270789025">(Feb 04 2022 at 23:54)</a>:</h4>
<p><code>for try async x in ...</code></p>



<a name="270789039"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loops/near/270789039" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops.html#270789039">(Feb 04 2022 at 23:55)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232018">Daniel Henry-Mantilla</span> <a href="#narrow/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops/near/270788998">said</a>:</p>
<blockquote>
<p>But it would have to go after the <code>for</code>, still, if it is to be a pattern</p>
</blockquote>
<p>I had been thinking about the proposed special cases of <code>try for</code> and <code>async for</code>, but you're right, this <em>could</em> be a pattern and use those syntaxes.</p>



<a name="270789047"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loops/near/270789047" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops.html#270789047">(Feb 04 2022 at 23:55)</a>:</h4>
<p>I'm not sure if they'd be confusing or not.</p>



<a name="270789075"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loops/near/270789075" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Khionu Sybiern <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops.html#270789075">(Feb 04 2022 at 23:55)</a>:</h4>
<p>So, in LHS patterns, it would be a prefix, and in RHS a suffix? I like the symmetry</p>



<a name="270789084"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loops/near/270789084" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops.html#270789084">(Feb 04 2022 at 23:55)</a>:</h4>
<p>Patterns are known to be a bit confusing at first, since they go "backwards". But that ship has sailed, I suspect it would be more jarring to change direction now</p>



<a name="270789152"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loops/near/270789152" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops.html#270789152">(Feb 04 2022 at 23:56)</a>:</h4>
<p>Priority 1 for me: I'd like a non-special-case syntax that composes, as part of patterns. For instance, if <code>for issue.await? in</code> works, <code>for SomeNewtype(issue.await?) in</code> should work.</p>



<a name="270789164"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loops/near/270789164" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops.html#270789164">(Feb 04 2022 at 23:56)</a>:</h4>
<p>Priority 2: making the syntax as understandable as possible.</p>



<a name="270789171"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loops/near/270789171" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops.html#270789171">(Feb 04 2022 at 23:56)</a>:</h4>
<p>Ok, posting it for myself mainly, to read it and see if I get used to it:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">for</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="kr">try</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</code></pre></div>



<a name="270789184"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loops/near/270789184" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops.html#270789184">(Feb 04 2022 at 23:56)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232018">Daniel Henry-Mantilla</span> <a href="#narrow/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops/near/270789084">said</a>:</p>
<blockquote>
<p>Patterns are known to be a bit confusing at first, since they go "backwards". But that ship has sailed, I suspect it would be more jarring to change direction now</p>
</blockquote>
<p>I'm not <em>actually</em> convinced that ship has fully sailed, or that we couldn't fix it.</p>



<a name="270789245"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loops/near/270789245" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Khionu Sybiern <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops.html#270789245">(Feb 04 2022 at 23:57)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">for</span><span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="kr">try</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</code></pre></div>
<p>This reads to me as more "handle as Future, then handle as Result"</p>



<a name="270789317"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loops/near/270789317" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Khionu Sybiern <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops.html#270789317">(Feb 04 2022 at 23:58)</a>:</h4>
<p>Wait, is <code>try</code> even legal there yet?</p>



<a name="270789322"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loops/near/270789322" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops.html#270789322">(Feb 04 2022 at 23:58)</a>:</h4>
<p><span class="user-mention" data-user-id="252217">@Khionu Sybiern</span> I'm genuinely confused about <em>which</em> way around to interpret <code>for async try</code>.</p>



<a name="270789330"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loops/near/270789330" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops.html#270789330">(Feb 04 2022 at 23:58)</a>:</h4>
<p>(It isn't, neither is async.)</p>



<a name="270789334"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loops/near/270789334" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eholk <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops.html#270789334">(Feb 04 2022 at 23:58)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232018">Daniel Henry-Mantilla</span> <a href="#narrow/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops/near/270789171">said</a>:</p>
<blockquote>
<p>Ok, posting it for myself mainly, to read it and see if I get used to it:</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">for</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="kr">try</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">foo</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</code></pre></div><br>
</p>
</blockquote>
<p>To me that reads as being equivalent to:</p>
<div class="codehilite"><pre><span></span><code>for x in ... {
    let x = foo?.await;
   ...
}
</code></pre></div>



<a name="270789360"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loops/near/270789360" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops.html#270789360">(Feb 04 2022 at 23:58)</a>:</h4>
<p>Let's ignore for the moment what precedents we have elsewhere about patterns.</p>



<a name="270789371"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loops/near/270789371" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops.html#270789371">(Feb 04 2022 at 23:59)</a>:</h4>
<p>Suppose we wrote <code>for x.await? in foo { ... }</code>.</p>



<a name="270789381"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loops/near/270789381" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops.html#270789381">(Feb 04 2022 at 23:59)</a>:</h4>
<p>It's <em>really obvious</em> what order that happens in.</p>



<a name="270789390"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loops/near/270789390" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops.html#270789390">(Feb 04 2022 at 23:59)</a>:</h4>
<p>If we're going to use some other syntax for it, it should be <em>just as obvious</em> what order it happens in.</p>



<a name="270789419"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loops/near/270789419" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops.html#270789419">(Feb 04 2022 at 23:59)</a>:</h4>
<p>I'm not arguing we can't use a different syntax, just that it should be obvious.</p>



<a name="270789587"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loops/near/270789587" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eholk <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops.html#270789587">(Feb 05 2022 at 00:00)</a>:</h4>
<p><span class="user-mention" data-user-id="232018">@Daniel Henry-Mantilla</span>'s suggestion to use braces makes the ordering clear, although I worry that the braces might be a little heavy syntactically.</p>



<a name="270789639"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loops/near/270789639" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eholk <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops.html#270789639">(Feb 05 2022 at 00:01)</a>:</h4>
<p>But it works nicely with let bindings:</p>
<div class="codehilite"><pre><span></span><code>let try { async { x } } = try { async { foo() } };
</code></pre></div>



<a name="270789658"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loops/near/270789658" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops.html#270789658">(Feb 05 2022 at 00:01)</a>:</h4>
<p>Oh yeah sorry I wrote an iterator of fallible futures <span aria-label="face palm" class="emoji emoji-1f926" role="img" title="face palm">:face_palm:</span></p>



<a name="270789670"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loops/near/270789670" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Khionu Sybiern <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops.html#270789670">(Feb 05 2022 at 00:01)</a>:</h4>
<p>Yeah, this is where my concern came from</p>



<a name="270789676"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loops/near/270789676" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops.html#270789676">(Feb 05 2022 at 00:01)</a>:</h4>
<p>I tunnel-visioned on <code>for async</code></p>



<a name="270789722"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loops/near/270789722" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eholk <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops.html#270789722">(Feb 05 2022 at 00:02)</a>:</h4>
<p>We have braces for record patterns already though, so maybe the braces aren't too heavy?</p>



<a name="270789723"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20vision%20and%20async%20for%20loops/near/270789723" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Khionu Sybiern <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20vision.20and.20async.20for.20loops.html#270789723">(Feb 05 2022 at 00:02)</a>:</h4>
<p><code>try { async { ... } } </code>vs <code>async { try { ... } }</code></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>