<html>
<head><meta charset="utf-8"><title>Informative symbol names in stack traces · wg-async · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/index.html">wg-async</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Informative.20symbol.20names.20in.20stack.20traces.html">Informative symbol names in stack traces</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="267667477"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Informative%20symbol%20names%20in%20stack%20traces/near/267667477" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eholk <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Informative.20symbol.20names.20in.20stack.20traces.html#267667477">(Jan 12 2022 at 00:32)</a>:</h4>
<p>I was thinking of an idea for a small change we could make to make async stack traces better. The basic idea is that currently <code>foo::generator$0</code> is surprising because a user shouldn't need to have any expectation that generators are involved in async code, even if they are used under the hood as an implementation detail.</p>
<p>So, we could change backtrace printing code to render <code>foo::generator$0</code> as <code>async fn foo</code>. Except, we run into the reverse issue if the user actually wrote a generator ("why does it as <code>async fn foo</code>? I didn't write any async code, I'm just using generators"). So, we'd want to tweak the symbol name to describe whether this function came from an async fn, an async block, a generator, or perhaps some other source. For async blocks, we might consider including the line number in the symbol name to give a more user-friendly way of distinguishing them.</p>
<p>I wrote some about this idea here: <a href="https://github.com/rust-lang/wg-async-foundations/pull/265">https://github.com/rust-lang/wg-async-foundations/pull/265</a></p>
<p>It seems like this should be an easy change to make, since I would expect we don't need to preserve backwards compatibility for generated symbol names like this.</p>
<p>What do folks think?</p>



<a name="267674107"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Informative%20symbol%20names%20in%20stack%20traces/near/267674107" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Informative.20symbol.20names.20in.20stack.20traces.html#267674107">(Jan 12 2022 at 02:04)</a>:</h4>
<p>Yes! I love it</p>



<a name="267674186"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Informative%20symbol%20names%20in%20stack%20traces/near/267674186" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Informative.20symbol.20names.20in.20stack.20traces.html#267674186">(Jan 12 2022 at 02:06)</a>:</h4>
<p>last time I was thinking about this I remember there being an extra stack frame for each async fn for the <code>from_generator</code> future adapter or similar. not sure if this was already solved with inlining or other tricks.</p>



<a name="267674328"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Informative%20symbol%20names%20in%20stack%20traces/near/267674328" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Informative.20symbol.20names.20in.20stack.20traces.html#267674328">(Jan 12 2022 at 02:09)</a>:</h4>
<p>The other question I have is: should these kinds of "function decorators" included in <a href="https://github.com/rust-lang/rust/issues/60705">v0 symbol mangling scheme</a>? cc <span class="user-mention" data-user-id="119009">@eddyb</span></p>



<a name="267678658"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Informative%20symbol%20names%20in%20stack%20traces/near/267678658" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Chin (eminence) <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Informative.20symbol.20names.20in.20stack.20traces.html#267678658">(Jan 12 2022 at 03:31)</a>:</h4>
<p>i guess this means we can easily distinguish generators created by async stuff and manually created generators?</p>



<a name="267688562"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Informative%20symbol%20names%20in%20stack%20traces/near/267688562" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Informative.20symbol.20names.20in.20stack.20traces.html#267688562">(Jan 12 2022 at 07:04)</a>:</h4>
<p>that’s the idea of <span class="user-mention silent" data-user-id="421986">eholk</span>’s proposal. mine is one approach to implementing it at the debuginfo level. We need some standard way to go from a mangled symbol name to <code>async fn foo</code>; v0 symbol mangling is a standard that we can change and is close to becoming the default</p>



<a name="267688767"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Informative%20symbol%20names%20in%20stack%20traces/near/267688767" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Informative.20symbol.20names.20in.20stack.20traces.html#267688767">(Jan 12 2022 at 07:08)</a>:</h4>
<p>(I’m hoping we could do it without updating the standard though, since there are already a number of implementations out there that would have to change)</p>



<a name="267782864"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Informative%20symbol%20names%20in%20stack%20traces/near/267782864" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eholk <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Informative.20symbol.20names.20in.20stack.20traces.html#267782864">(Jan 12 2022 at 20:39)</a>:</h4>
<p>That's a good question about the symbol naming. I imagined this would be sort of another layer of mangling on top of what we already do, but it might be better to fold it into the existing mangling scheme instead.</p>



<a name="267948460"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Informative%20symbol%20names%20in%20stack%20traces/near/267948460" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Informative.20symbol.20names.20in.20stack.20traces.html#267948460">(Jan 13 2022 at 23:42)</a>:</h4>
<p>I'd rather not have additional schemes on top that still have to be supported by all the debuggers</p>



<a name="267948536"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Informative%20symbol%20names%20in%20stack%20traces/near/267948536" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Informative.20symbol.20names.20in.20stack.20traces.html#267948536">(Jan 13 2022 at 23:42)</a>:</h4>
<p>I need to check that RFC again to find out what the options are</p>



<a name="267949642"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Informative%20symbol%20names%20in%20stack%20traces/near/267949642" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eholk <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Informative.20symbol.20names.20in.20stack.20traces.html#267949642">(Jan 13 2022 at 23:55)</a>:</h4>
<p>I just put up <a href="https://github.com/rust-lang/rust/issues/92873">#92873</a> to make different names based on the generator kind. It's pretty straightforward but should still make things a little better.</p>



<a name="268011752"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Informative%20symbol%20names%20in%20stack%20traces/near/268011752" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Informative.20symbol.20names.20in.20stack.20traces.html#268011752">(Jan 14 2022 at 13:17)</a>:</h4>
<p>A change like that can easily break any existing  debugger plugins that rely on names in debuginfo looking a certain way. It's not a problem right now, I think -- but it would be great if we had regression tests that make sure things keep working and a specification of debuginfo.</p>



<a name="268040915"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Informative%20symbol%20names%20in%20stack%20traces/near/268040915" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eholk <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Informative.20symbol.20names.20in.20stack.20traces.html#268040915">(Jan 14 2022 at 16:54)</a>:</h4>
<p>Thanks, <span class="user-mention" data-user-id="124287">@mw</span>, that's  good point. I wasn't sure what kind of stability guarantees we make about symbol names, but it sounds like we don't have much here. Of course, not making stability guarantees doesn't stop people from depending on them :)</p>



<a name="268043652"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Informative%20symbol%20names%20in%20stack%20traces/near/268043652" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Informative.20symbol.20names.20in.20stack.20traces.html#268043652">(Jan 14 2022 at 17:14)</a>:</h4>
<p>Yeah, once you have debugger plugins that are shipped separately from the compiler, then debuginfo becomes part of the public interface of a crate. We've gotten away with keeping debuginfo unstable so far -- but that instability might be a reason why we don't see many plugins.</p>



<a name="268061111"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Informative%20symbol%20names%20in%20stack%20traces/near/268061111" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Informative.20symbol.20names.20in.20stack.20traces.html#268061111">(Jan 14 2022 at 19:33)</a>:</h4>
<p>This is part of why I'd like to incorporate into something with more explicit stability guarantees like (eventually) v0 symbol mangling</p>



<a name="268061412"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Informative%20symbol%20names%20in%20stack%20traces/near/268061412" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Informative.20symbol.20names.20in.20stack.20traces.html#268061412">(Jan 14 2022 at 19:35)</a>:</h4>
<p>it's not clear to me what interface we actually <em>want</em>, though</p>



<a name="268062133"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Informative%20symbol%20names%20in%20stack%20traces/near/268062133" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Informative.20symbol.20names.20in.20stack.20traces.html#268062133">(Jan 14 2022 at 19:41)</a>:</h4>
<p>and it's also hard to update that spec</p>



<a name="268062243"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Informative%20symbol%20names%20in%20stack%20traces/near/268062243" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Informative.20symbol.20names.20in.20stack.20traces.html#268062243">(Jan 14 2022 at 19:42)</a>:</h4>
<p>so, using the existing spec, for <code>async fn</code> we could (ab)use the ABI specifier by making the ABI <code>async</code></p>



<a name="268062287"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Informative%20symbol%20names%20in%20stack%20traces/near/268062287" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Informative.20symbol.20names.20in.20stack.20traces.html#268062287">(Jan 14 2022 at 19:42)</a>:</h4>
<p>(this isn't totally out of the blue, we've talked about async being an ABI before, but it is a bit weird)</p>



<a name="268062329"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Informative%20symbol%20names%20in%20stack%20traces/near/268062329" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Informative.20symbol.20names.20in.20stack.20traces.html#268062329">(Jan 14 2022 at 19:43)</a>:</h4>
<p>for async blocks and closures, using a nested path within the function path (as we do today) probably continues to make the most sense</p>



<a name="268062730"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Informative%20symbol%20names%20in%20stack%20traces/near/268062730" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Informative.20symbol.20names.20in.20stack.20traces.html#268062730">(Jan 14 2022 at 19:46)</a>:</h4>
<p>other than the ABI, the closest thing we have to an <code>async</code> prefix is <code>unsafe</code>, which is directly built in to the spec</p>



<a name="268068746"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Informative%20symbol%20names%20in%20stack%20traces/near/268068746" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Informative.20symbol.20names.20in.20stack.20traces.html#268068746">(Jan 14 2022 at 20:31)</a>:</h4>
<p>Okay, I was talking with <span class="user-mention" data-user-id="119009">@eddyb</span> just now and it turns out there <em>is</em> a concept for something like this in v0 mangling</p>



<a name="268068831"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Informative%20symbol%20names%20in%20stack%20traces/near/268068831" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Informative.20symbol.20names.20in.20stack.20traces.html#268068831">(Jan 14 2022 at 20:32)</a>:</h4>
<p>tbc, the mangling concept maps 1:1 this data: <a href="https://github.com/rust-lang/rust/blob/02c9e73e6ca7e2bd444d39182f8dee7e2ba4a609/compiler/rustc_hir/src/definitions.rs#L284-L285">https://github.com/rust-lang/rust/blob/02c9e73e6ca7e2bd444d39182f8dee7e2ba4a609/compiler/rustc_hir/src/definitions.rs#L284-L285</a></p>



<a name="268068850"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Informative%20symbol%20names%20in%20stack%20traces/near/268068850" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Informative.20symbol.20names.20in.20stack.20traces.html#268068850">(Jan 14 2022 at 20:32)</a>:</h4>
<p>so you would have to change the compiler as a whole</p>



<a name="268068962"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Informative%20symbol%20names%20in%20stack%20traces/near/268068962" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Informative.20symbol.20names.20in.20stack.20traces.html#268068962">(Jan 14 2022 at 20:33)</a>:</h4>
<p>you can see it says <code>::{closure#0}</code> in paths w/o going through mangling: <a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2021&amp;gist=066de567145fba40e1c853d990617f2b">https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2021&amp;gist=066de567145fba40e1c853d990617f2b</a></p>



<a name="268068973"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Informative%20symbol%20names%20in%20stack%20traces/near/268068973" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Informative.20symbol.20names.20in.20stack.20traces.html#268068973">(Jan 14 2022 at 20:33)</a>:</h4>
<p>you want to change <em>that</em>, and mangling follows</p>



<a name="268069048"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Informative%20symbol%20names%20in%20stack%20traces/near/268069048" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Informative.20symbol.20names.20in.20stack.20traces.html#268069048">(Jan 14 2022 at 20:34)</a>:</h4>
<p>Relevant part of the spec:</p>
<div class="codehilite"><pre><span></span><code>// Namespace of the identifier in a (nested) path.
// It&#39;s an a-zA-Z character, with a-z reserved for implementation-internal
// disambiguation categories (and demanglers should never show them), while
// A-Z are used for special namespaces (e.g. closures), which the demangler
// can show in a special way (e.g. `NC...` as `...::{closure}`), or just
// default to showing the uppercase character.
&lt;namespace&gt; = &quot;C&quot;      // closure
            | &quot;S&quot;      // shim
            | &lt;A-Z&gt;    // other special namespaces
            | &lt;a-z&gt;    // internal namespaces
</code></pre></div>



<a name="268069185"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Informative%20symbol%20names%20in%20stack%20traces/near/268069185" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Informative.20symbol.20names.20in.20stack.20traces.html#268069185">(Jan 14 2022 at 20:35)</a>:</h4>
<p>so we could potentially add more builtin namespaces for e.g. <code>async_block</code> (and make the changes <span class="user-mention" data-user-id="119009">@eddyb</span> mentioned above)</p>



<a name="268069256"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Informative%20symbol%20names%20in%20stack%20traces/near/268069256" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Informative.20symbol.20names.20in.20stack.20traces.html#268069256">(Jan 14 2022 at 20:36)</a>:</h4>
<p>and we probably want to do this for the code written in an <code>async fn</code>, instead of using only closure paths</p>



<a name="268069297"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Informative%20symbol%20names%20in%20stack%20traces/near/268069297" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Informative.20symbol.20names.20in.20stack.20traces.html#268069297">(Jan 14 2022 at 20:36)</a>:</h4>
<p>I'd be worried about adding a whole menagerie but if it needs done, it's not <em>hard</em></p>



<a name="268069367"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Informative%20symbol%20names%20in%20stack%20traces/near/268069367" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Informative.20symbol.20names.20in.20stack.20traces.html#268069367">(Jan 14 2022 at 20:36)</a>:</h4>
<p>based on this, you need 4 new namespaces in <code>DefPathData</code> and mangling: <a href="https://github.com/rust-lang/rust/pull/92873/files#diff-e0465b23357962aaea9ec60b764de458bda0e9e9b55f745328078cebc0d02f68R522-R526">https://github.com/rust-lang/rust/pull/92873/files#diff-e0465b23357962aaea9ec60b764de458bda0e9e9b55f745328078cebc0d02f68R522-R526</a></p>



<a name="268069383"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Informative%20symbol%20names%20in%20stack%20traces/near/268069383" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Informative.20symbol.20names.20in.20stack.20traces.html#268069383">(Jan 14 2022 at 20:37)</a>:</h4>
<p>(unless you conflate some of them together)</p>



<a name="268069434"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Informative%20symbol%20names%20in%20stack%20traces/near/268069434" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Informative.20symbol.20names.20in.20stack.20traces.html#268069434">(Jan 14 2022 at 20:37)</a>:</h4>
<p>..I'm wondering if we'd need another set for generator functions (and async generators?)</p>



<a name="268069583"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Informative%20symbol%20names%20in%20stack%20traces/near/268069583" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Informative.20symbol.20names.20in.20stack.20traces.html#268069583">(Jan 14 2022 at 20:38)</a>:</h4>
<p>btw you can already do some shenanigans</p>
<div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="go">~ $ echo _RNCNvC3foo3bar0 | rustfilt</span>
<span class="gp">foo::bar::{closure#</span><span class="m">0</span><span class="o">}</span>
<span class="go">~ $ echo _RNCNvC3foo3bar5async | rustfilt</span>
<span class="gp">foo::bar::{closure:async#</span><span class="m">0</span><span class="o">}</span>
</code></pre></div>



<a name="268069832"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Informative%20symbol%20names%20in%20stack%20traces/near/268069832" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Informative.20symbol.20names.20in.20stack.20traces.html#268069832">(Jan 14 2022 at 20:40)</a>:</h4>
<p>oh, interesting</p>



<a name="268069896"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Informative%20symbol%20names%20in%20stack%20traces/near/268069896" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Informative.20symbol.20names.20in.20stack.20traces.html#268069896">(Jan 14 2022 at 20:41)</a>:</h4>
<p>but note that that's more wasteful</p>



<a name="268069959"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Informative%20symbol%20names%20in%20stack%20traces/near/268069959" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Informative.20symbol.20names.20in.20stack.20traces.html#268069959">(Jan 14 2022 at 20:41)</a>:</h4>
<p>also this is what happens for an unknown namespace letter:</p>
<div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="go">~ $ echo _RNGNvC3foo3bar0 | rustfilt</span>
<span class="gp">foo::bar::{G#</span><span class="m">0</span><span class="o">}</span>
<span class="go">~ $ echo _RNGNvC3foo3bar5async | rustfilt</span>
<span class="gp">foo::bar::{G:async#</span><span class="m">0</span><span class="o">}</span>
</code></pre></div>



<a name="268070040"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Informative%20symbol%20names%20in%20stack%20traces/near/268070040" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Informative.20symbol.20names.20in.20stack.20traces.html#268070040">(Jan 14 2022 at 20:42)</a>:</h4>
<p>so it doesn't break existing demanglers, it's just not as pretty</p>



<a name="268072181"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Informative%20symbol%20names%20in%20stack%20traces/near/268072181" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eholk <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Informative.20symbol.20names.20in.20stack.20traces.html#268072181">(Jan 14 2022 at 21:00)</a>:</h4>
<p>Ah, this is helpful!</p>



<a name="268072235"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Informative%20symbol%20names%20in%20stack%20traces/near/268072235" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eholk <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Informative.20symbol.20names.20in.20stack.20traces.html#268072235">(Jan 14 2022 at 21:01)</a>:</h4>
<p>I suspect once generators are stabilized we'll have a similar <code>generator_fn</code> and <code>generator_block</code> at least that we'll need. Probably <code>async_generator_fn</code> and <code>async_generator_block</code> too.</p>



<a name="268289743"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/Informative%20symbol%20names%20in%20stack%20traces/near/268289743" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/Informative.20symbol.20names.20in.20stack.20traces.html#268289743">(Jan 17 2022 at 16:09)</a>:</h4>
<p>As a side note: the names in debuginfo are not really related to symbol mangling. Debuginfo stores unmangled/human-readable names (see e.g. <a href="http://wiki.dwarfstd.org/index.php?title=Best_Practices#Names_of_Program_Entities">http://wiki.dwarfstd.org/index.php?title=Best_Practices#Names_of_Program_Entities</a>). Some restrictions apply for those too because that's what consumers of debuginfo usually work with.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>