<html>
<head><meta charset="utf-8"><title>the challenges of introducing async scopes · wg-async · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/index.html">wg-async</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/the.20challenges.20of.20introducing.20async.20scopes.html">the challenges of introducing async scopes</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="272106960"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/the%20challenges%20of%20introducing%20async%20scopes/near/272106960" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/the.20challenges.20of.20introducing.20async.20scopes.html#272106960">(Feb 16 2022 at 12:04)</a>:</h4>
<p>Does anyone have a writeup about the issues we face when attempting to implement async scopes today? I've seen folks assert that: "unless we can disallow futures from being cancelled, async scopes cannot be implemetned", and "it's unlikely we can have multi-threaded scopes at all, only single-threaded scopes". This comes up relatively frequently, and though I trust that these assertions are well-informed, I do not feel it's well-documented yet.</p>
<p>I'd like to better understand which challenges people see, and explainers of how they work. I was wondering if anyone has / is planning to expand on this. It doesn't need to be long, but without it I find it difficult to meaningfully engage in any conversation that covers async scopes.</p>
<p>If nobody's planning has / is planning to write about it, I'd be happy to volunteer. But because it sounds like others have thought this through already, I figured I'd ask first.</p>



<a name="272107086"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/the%20challenges%20of%20introducing%20async%20scopes/near/272107086" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/the.20challenges.20of.20introducing.20async.20scopes.html#272107086">(Feb 16 2022 at 12:06)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> was looking at this, he probably has a half-written blog post draft :-)</p>



<a name="272107294"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/the%20challenges%20of%20introducing%20async%20scopes/near/272107294" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/the.20challenges.20of.20introducing.20async.20scopes.html#272107294">(Feb 16 2022 at 12:08)</a>:</h4>
<p>Neat! -- oh, also happy to proof read any early drafts if that's helpful for folks</p>



<a name="272111587"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/the%20challenges%20of%20introducing%20async%20scopes/near/272111587" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pachi <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/the.20challenges.20of.20introducing.20async.20scopes.html#272111587">(Feb 16 2022 at 12:54)</a>:</h4>
<p><span class="user-mention" data-user-id="211722">@Yoshua Wuyts [he/they]</span> Not sure if it's completely related, but there's ongoing discussion on scoped threads and some problems related to the enclosing scope lifetime (and maybe that's what happens also for async scopes). There's this comment by <span class="user-mention" data-user-id="116009">@nikomatsakis</span> on the details <a href="https://github.com/rust-lang/rust/issues/93203#issuecomment-1040720703">https://github.com/rust-lang/rust/issues/93203#issuecomment-1040720703</a></p>



<a name="272111695"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/the%20challenges%20of%20introducing%20async%20scopes/near/272111695" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/the.20challenges.20of.20introducing.20async.20scopes.html#272111695">(Feb 16 2022 at 12:55)</a>:</h4>
<p>Thanks, yes that definitely seems useful!</p>



<a name="272289525"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/the%20challenges%20of%20introducing%20async%20scopes/near/272289525" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/the.20challenges.20of.20introducing.20async.20scopes.html#272289525">(Feb 17 2022 at 17:03)</a>:</h4>
<p>I don't have a half-written blog post but I will write one! I've definitely thought a lot about it</p>



<a name="272293644"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/the%20challenges%20of%20introducing%20async%20scopes/near/272293644" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gus Wynn <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/the.20challenges.20of.20introducing.20async.20scopes.html#272293644">(Feb 17 2022 at 17:27)</a>:</h4>
<p>Oh I would be extremely interested in this as well, I am in the "unless we can disallow futures from being cancelled, async scopes cannot be implemetned" camp but I could be wrong</p>



<a name="272563684"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/the%20challenges%20of%20introducing%20async%20scopes/near/272563684" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias247 <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/the.20challenges.20of.20introducing.20async.20scopes.html#272563684">(Feb 20 2022 at 04:00)</a>:</h4>
<p>No summary, but <a href="https://github.com/tokio-rs/tokio/issues/1879">https://github.com/tokio-rs/tokio/issues/1879</a> was the initial exploration of async scopes, which yielded the knowledge that they are not possible with borrowing anything from the parent task at the moment - and even are not without challenges without allowing to borrow - which is why this never landed anywhere.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>