<html>
<head><meta charset="utf-8"><title>async overloading · wg-async · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/index.html">wg-async</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html">async overloading</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="250150999"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250150999" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250150999">(Aug 20 2021 at 17:53)</a>:</h4>
<p>Yeah so I've been talking some to <span class="user-mention" data-user-id="211722">@Yoshua Wuyts</span> and some to <span class="user-mention" data-user-id="116883">@tmandry</span> about async overloading and I thought I'd bring some of those ideas here to chew on</p>



<a name="250151400"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250151400" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250151400">(Aug 20 2021 at 17:57)</a>:</h4>
<p><span class="user-mention" data-user-id="211722">@Yoshua Wuyts</span> pointed out that <a href="https://github.com/groue/swift-evolution/blob/93f0092fc46609a00c48c8436a2b56edd852666e/proposals/0296-async-await.md#overloading-and-overload-resolution">Swift has some cool stuff on this point</a></p>



<a name="250151445"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250151445" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250151445">(Aug 20 2021 at 17:57)</a>:</h4>
<p>I was talking some to <span class="user-mention" data-user-id="116883">@tmandry</span> about it today and we were sketching out an overall setup that seems to me like it could work</p>



<a name="250151668"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250151668" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250151668">(Aug 20 2021 at 17:59)</a>:</h4>
<p>one way to think about it is as a kind of ABI</p>



<a name="250151688"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250151688" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250151688">(Aug 20 2021 at 17:59)</a>:</h4>
<p>e.g., you have the standard "Rust" ABI, but you could also have a "Rust-Async" ABI</p>



<a name="250151966"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250151966" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250151966">(Aug 20 2021 at 18:01)</a>:</h4>
<p>now if you imagine that when you write <code>fn foo()</code> the ABI is not yet determined</p>



<a name="250152001"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250152001" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250152001">(Aug 20 2021 at 18:02)</a>:</h4>
<p>it's only when you go to create a fn pointer that you determine it</p>



<a name="250152112"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250152112" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250152112">(Aug 20 2021 at 18:02)</a>:</h4>
<p>I'm not sure if the ABI metaphor is <em>super</em> useful, but it may be; I thought of it because we've talked about the option of taking an arbitrary <code>fn foo()</code> and letting you make an <code>extern "C" fn()</code> from it (i.e., we compile a <code>fn foo()</code> into whaever ABI(s) it needs to be compiled into)</p>



<a name="250152134"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250152134" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250152134">(Aug 20 2021 at 18:02)</a>:</h4>
<p>you can also think of it a bit like a generic parameter, with monomorphization</p>



<a name="250152146"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250152146" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250152146">(Aug 20 2021 at 18:02)</a>:</h4>
<p>i.e., a non-async fn can be compiled in 2 modes</p>



<a name="250152255"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250152255" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250152255">(Aug 20 2021 at 18:04)</a>:</h4>
<p>when you compile it in sync mode, it's just like today</p>



<a name="250152324"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250152324" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250152324">(Aug 20 2021 at 18:04)</a>:</h4>
<p>when you compile it in <em>async</em> mode, and it calls other funtions that don't have a fixed mode, they are compiled into async mode, and there is an implicit <code>await</code> loop</p>



<a name="250152365"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250152365" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250152365">(Aug 20 2021 at 18:04)</a>:</h4>
<p>like today, async fns can call sync, so this doesn't prevent you from doing blocking things</p>



<a name="250152378"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250152378" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250152378">(Aug 20 2021 at 18:05)</a>:</h4>
<p>but then you could supply async versions of sync primitives</p>



<a name="250152420"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250152420" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250152420">(Aug 20 2021 at 18:05)</a>:</h4>
<p>And you wouldn't be allowed to call the sync version in an async fn?</p>



<a name="250152448"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250152448" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250152448">(Aug 20 2021 at 18:05)</a>:</h4>
<p>in talking to <span class="user-mention" data-user-id="211722">@Yoshua Wuyts</span> he was emphasizing this point, because it's super impactful-- maybe the way to do I/O in Rust becomes "just use the same functions no matter what"</p>



<a name="250152463"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250152463" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250152463">(Aug 20 2021 at 18:05)</a>:</h4>
<p><span class="user-mention silent" data-user-id="363998">Ibraheem Ahmed</span> <a href="#narrow/stream/187312-wg-async-foundations/topic/async.20overloading/near/250152420">said</a>:</p>
<blockquote>
<p>And you wouldn't be allowed to call the sync version in an async fn?</p>
</blockquote>
<p>no you can</p>



<a name="250152474"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250152474" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250152474">(Aug 20 2021 at 18:06)</a>:</h4>
<p>just like today</p>



<a name="250152532"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250152532" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250152532">(Aug 20 2021 at 18:06)</a>:</h4>
<p>but if you have an overloaded version, then it runs in async mode</p>



<a name="250152560"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250152560" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250152560">(Aug 20 2021 at 18:06)</a>:</h4>
<p>(interesting question whether you get a future out of it)</p>



<a name="250152733"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250152733" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250152733">(Aug 20 2021 at 18:07)</a>:</h4>
<p><span class="user-mention silent" data-user-id="363998">Ibraheem Ahmed</span> <a href="#narrow/stream/187312-wg-async-foundations/topic/async.20overloading/near/250152420">said</a>:</p>
<blockquote>
<p>And you wouldn't be allowed to call the sync version in an async fn?</p>
</blockquote>
<p>to this point, things like the blocking lint become very important</p>



<a name="250152795"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250152795" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250152795">(Aug 20 2021 at 18:08)</a>:</h4>
<p>the other "rubber hits the road" point is <code>dyn Trait</code></p>



<a name="250152806"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250152806" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250152806">(Aug 20 2021 at 18:08)</a>:</h4>
<p>Yeah, that's what I was thinking of.</p>



<a name="250152831"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250152831" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250152831">(Aug 20 2021 at 18:08)</a>:</h4>
<p>But with things like locks, it might be more confusing.</p>



<a name="250152858"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250152858" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250152858">(Aug 20 2021 at 18:08)</a>:</h4>
<p>Because you usually want the sync version even in async code.</p>



<a name="250152861"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250152861" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250152861">(Aug 20 2021 at 18:08)</a>:</h4>
<p>it depends how successful we are I guess</p>



<a name="250152873"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250152873" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250152873">(Aug 20 2021 at 18:08)</a>:</h4>
<p>yeah, that seems plausible</p>



<a name="250152886"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250152886" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250152886">(Aug 20 2021 at 18:09)</a>:</h4>
<p>we might have two variants of locks even so?</p>



<a name="250152911"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250152911" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250152911">(Aug 20 2021 at 18:09)</a>:</h4>
<p>I do think the idea would be that <em>the majority of code</em> can run successfully in sync or async modes</p>



<a name="250152931"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250152931" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250152931">(Aug 20 2021 at 18:09)</a>:</h4>
<p>it would only be stuff that calls into FFI functions that may block that has trouble</p>



<a name="250152944"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250152944" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250152944">(Aug 20 2021 at 18:09)</a>:</h4>
<p>I guess locks are an interesting question</p>



<a name="250153042"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250153042" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250153042">(Aug 20 2021 at 18:10)</a>:</h4>
<p>Another interesting alternative is something like <code>#[cfg(async)]</code></p>



<a name="250153092"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250153092" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250153092">(Aug 20 2021 at 18:10)</a>:</h4>
<p>Although I don't think that would be very ergonomic for library authors.</p>



<a name="250153137"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250153137" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250153137">(Aug 20 2021 at 18:11)</a>:</h4>
<p>something I'm wondering about is if we could leverage this so that we can make <code>?</code> work in iterators :)</p>



<a name="250153158"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250153158" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250153158">(Aug 20 2021 at 18:11)</a>:</h4>
<p>by work I mean: return from the enclosing function</p>



<a name="250153166"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250153166" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250153166">(Aug 20 2021 at 18:11)</a>:</h4>
<p>but that's another story</p>



<a name="250153231"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250153231" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250153231">(Aug 20 2021 at 18:11)</a>:</h4>
<p>well, it's related to the thing I was thinking about.. this can solve the iterator combinator problem with <code>async</code> really really nicely</p>



<a name="250153287"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250153287" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250153287">(Aug 20 2021 at 18:12)</a>:</h4>
<p>Does swift do implicit await?</p>



<a name="250153312"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250153312" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250153312">(Aug 20 2021 at 18:12)</a>:</h4>
<p>no, it's explicit</p>



<a name="250153395"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250153395" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250153395">(Aug 20 2021 at 18:13)</a>:</h4>
<p>I don't think swift actually does the thing being proposed here, it's more "shallow"</p>



<a name="250153407"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250153407" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250153407">(Aug 20 2021 at 18:13)</a>:</h4>
<p>anyway I just wanted to float those ideas more broadly</p>



<a name="250153420"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250153420" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250153420">(Aug 20 2021 at 18:13)</a>:</h4>
<p>I guess <span class="user-mention" data-user-id="211722">@Yoshua Wuyts</span> is asleep or I might've waited to bring it up until they were around</p>



<a name="250153430"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250153430" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250153430">(Aug 20 2021 at 18:13)</a>:</h4>
<p>because indeed much of this stems from them talking to me about it</p>



<a name="250153439"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250153439" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250153439">(Aug 20 2021 at 18:13)</a>:</h4>
<p>I do think it's something we should dig into---</p>



<a name="250153445"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250153445" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250153445">(Aug 20 2021 at 18:13)</a>:</h4>
<p>of all the problems on the list</p>



<a name="250153454"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250153454" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250153454">(Aug 20 2021 at 18:13)</a>:</h4>
<p>we have no solutions to the async-sync-async sandwich</p>



<a name="250153466"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250153466" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250153466">(Aug 20 2021 at 18:13)</a>:</h4>
<p>(except this one)</p>



<a name="250153470"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250153470" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250153470">(Aug 20 2021 at 18:13)</a>:</h4>
<p>and it could be transformative</p>



<a name="250153533"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250153533" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250153533">(Aug 20 2021 at 18:14)</a>:</h4>
<p>I also don't thik it blocks us making progress on other things</p>



<a name="250153549"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250153549" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250153549">(Aug 20 2021 at 18:14)</a>:</h4>
<p>we still have to solve all the same issues</p>



<a name="250153568"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250153568" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250153568">(Aug 20 2021 at 18:14)</a>:</h4>
<p>C# has gotten along fine with async/sync versions of everything.</p>



<a name="250153871"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250153871" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250153871">(Aug 20 2021 at 18:17)</a>:</h4>
<p>I'm not a big C# user, but I'm sure it's the same as in most other languages --- yes, you can do it</p>



<a name="250153888"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250153888" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250153888">(Aug 20 2021 at 18:17)</a>:</h4>
<p>it's just the soruce of footguns and copy-pasting and having 2 variants of everything</p>



<a name="250153897"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250153897" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250153897">(Aug 20 2021 at 18:17)</a>:</h4>
<p>it's not the end of the world</p>



<a name="250153915"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250153915" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250153915">(Aug 20 2021 at 18:17)</a>:</h4>
<p>but if we can cleanly solve it, maybe it's worth it</p>



<a name="250153933"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250153933" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250153933">(Aug 20 2021 at 18:17)</a>:</h4>
<p>The other thing we'll have to consider is how this impacts compile times. If a crate exports a function and we don't know if it will be called in sync or async contexts, do we codegen it for both?</p>



<a name="250153967"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250153967" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250153967">(Aug 20 2021 at 18:18)</a>:</h4>
<p>yeah</p>



<a name="250154010"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250154010" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250154010">(Aug 20 2021 at 18:18)</a>:</h4>
<p>mmm <span class="user-mention" data-user-id="124287">@mw</span> ready to do MIR-only rlibs?</p>



<a name="250154014"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250154014" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250154014">(Aug 20 2021 at 18:18)</a>:</h4>
<p>that would solve it :)</p>



<a name="250154043"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250154043" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250154043">(Aug 20 2021 at 18:18)</a>:</h4>
<p>Well it's the same as if there was <code>foo</code> and <code>foo_async()</code> exported</p>



<a name="250154050"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250154050" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250154050">(Aug 20 2021 at 18:18)</a>:</h4>
<p>Just cleaner</p>



<a name="250154102"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250154102" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250154102">(Aug 20 2021 at 18:19)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/187312-wg-async-foundations/topic/async.20overloading/near/250154010">said</a>:</p>
<blockquote>
<p>mmm <span class="user-mention silent" data-user-id="124287">mw</span> ready to do MIR-only rlibs?</p>
</blockquote>
<p>that would have a big impact on compile times too, unless there's a plan I don't know about</p>



<a name="250154238"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250154238" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250154238">(Aug 20 2021 at 18:20)</a>:</h4>
<p>deferring codegen until the end is essentially like (Thin)LTO, which slows down compilation by a lot</p>



<a name="250154328"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250154328" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eholk <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250154328">(Aug 20 2021 at 18:20)</a>:</h4>
<p>I talked with <span class="user-mention" data-user-id="211722">@Yoshua Wuyts</span> a little about this too, and I think what he had in mind (which I think is basically what Swift does) is that you can write two functions:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">foo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="o">..</span><span class="p">.}</span><span class="w"></span>
<span class="k">async</span><span class="w"> </span><span class="k">fn</span> <span class="nf">foo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="o">..</span><span class="p">.}</span><span class="w"></span>
</code></pre></div>
<p>And then automagically the right version of <code>foo</code> gets called depending on whether you're in a sync or async context.</p>



<a name="250154353"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250154353" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250154353">(Aug 20 2021 at 18:21)</a>:</h4>
<p><span class="user-mention silent" data-user-id="363998">Ibraheem Ahmed</span> <a href="#narrow/stream/187312-wg-async-foundations/topic/async.20overloading/near/250154043">said</a>:</p>
<blockquote>
<p>Well it's the same as if there was <code>foo</code> and <code>foo_async()</code> exported</p>
</blockquote>
<p>except that it's applied to all the normal functions you write, not just the ones the crate author knows are needed for something. it's a cost you would pay whether someone actually needed it or not</p>



<a name="250154499"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250154499" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250154499">(Aug 20 2021 at 18:22)</a>:</h4>
<p>maybe a reasonable default is to codegen for sync and put MIR in rlibs in case async is needed, with attributes / flags to tweak the behavior</p>



<a name="250154533"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250154533" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eholk <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250154533">(Aug 20 2021 at 18:22)</a>:</h4>
<p>Does this require making <code>await</code> implicit?</p>



<a name="250154567"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250154567" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eholk <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250154567">(Aug 20 2021 at 18:22)</a>:</h4>
<p>At least, if I want to make a function that's polymorphic over sync and async?</p>



<a name="250154573"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250154573" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250154573">(Aug 20 2021 at 18:22)</a>:</h4>
<p><span class="user-mention silent" data-user-id="421986">eholk</span> <a href="#narrow/stream/187312-wg-async-foundations/topic/async.20overloading/near/250154328">said</a>:</p>
<blockquote>
<p>I talked with <span class="user-mention silent" data-user-id="211722">Yoshua Wuyts</span> a little about this too, and I think what he had in mind (which I think is basically what Swift does) is that you can write two functions:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">foo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="o">..</span><span class="p">.}</span><span class="w"></span>
<span class="k">async</span><span class="w"> </span><span class="k">fn</span> <span class="nf">foo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="o">..</span><span class="p">.}</span><span class="w"></span>
</code></pre></div>
<p>And then automagically the right version of <code>foo</code> gets called depending on whether you're in a sync or async context.</p>
</blockquote>
<p>the question is, what happens when you do async -&gt; sync -&gt; async?</p>



<a name="250154780"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250154780" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eholk <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250154780">(Aug 20 2021 at 18:24)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116883">tmandry</span> <a href="#narrow/stream/187312-wg-async-foundations/topic/async.20overloading/near/250154573">said</a>:</p>
<blockquote>
<p>the question is, what happens when you do async -&gt; sync -&gt; async?</p>
</blockquote>
<p>So you'd have A call B call C, where A and C are async, right?</p>



<a name="250154789"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250154789" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250154789">(Aug 20 2021 at 18:24)</a>:</h4>
<p>yes</p>



<a name="250154808"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250154808" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eholk <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250154808">(Aug 20 2021 at 18:24)</a>:</h4>
<p>I think the way it'd work is that if B only has a sync overload, you'd still have the async sandwich.</p>



<a name="250154849"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250154849" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250154849">(Aug 20 2021 at 18:25)</a>:</h4>
<p><span class="user-mention silent" data-user-id="421986">eholk</span> <a href="#narrow/stream/187312-wg-async-foundations/topic/async.20overloading/near/250154567">said</a>:</p>
<blockquote>
<p>At least, if I want to make a function that's polymorphic over sync and async?</p>
</blockquote>
<p>If you write normal code for a sync function, then if it gets translated all the await points would be implicit. (This would only work with poll-to-completion futures, of course)</p>



<a name="250154909"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250154909" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250154909">(Aug 20 2021 at 18:25)</a>:</h4>
<p>I don't really see this as a problem, though</p>



<a name="250154981"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250154981" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eholk <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250154981">(Aug 20 2021 at 18:26)</a>:</h4>
<p>in a lot of cases, writing an async version of <code>B</code> would basically be copy and paste, which is where async polymorphism would come into play.</p>



<a name="250155049"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250155049" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250155049">(Aug 20 2021 at 18:26)</a>:</h4>
<p>right, and the idea is to do that for you unless you want to specialize</p>



<a name="250155183"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250155183" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250155183">(Aug 20 2021 at 18:27)</a>:</h4>
<p>I'm worried about auto traits though.. when a variable is held across one of those implicit await points, your function might be <code>Send</code> in sync and <code>!Send</code> in async</p>



<a name="250155230"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250155230" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250155230">(Aug 20 2021 at 18:28)</a>:</h4>
<p>and this <code>!Send</code>-ness would propagate up the call stack, not down</p>



<a name="250155328"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250155328" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eholk <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250155328">(Aug 20 2021 at 18:29)</a>:</h4>
<p>Would we want a way to opt-out of auto-generating the async version?</p>



<a name="250155402"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250155402" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250155402">(Aug 20 2021 at 18:29)</a>:</h4>
<p>probably</p>



<a name="250155432"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250155432" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250155432">(Aug 20 2021 at 18:29)</a>:</h4>
<p>some low-level functions can't really be made async</p>



<a name="250155587"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250155587" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eholk <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250155587">(Aug 20 2021 at 18:30)</a>:</h4>
<p>Kind of off topic, but do we have a way to yield or await on nothing? Like what if I write a big matrix multiply function that's pure computation but takes a long time? Is there a way to say in the middle "hey, block here in case there are other tasks that need to run"?</p>



<a name="250155638"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250155638" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eholk <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250155638">(Aug 20 2021 at 18:31)</a>:</h4>
<p>I imagine being able to do that matters more if we auto-generate async functions from sync functions.</p>



<a name="250155822"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250155822" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250155822">(Aug 20 2021 at 18:32)</a>:</h4>
<p>there's <code>yield_now</code>, which isn't in the standard library, though it's something we could include</p>



<a name="250155861"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250155861" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250155861">(Aug 20 2021 at 18:33)</a>:</h4>
<p>the reason it's not in std today is there's not a standard way for executors to handle it</p>



<a name="250155874"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250155874" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250155874">(Aug 20 2021 at 18:33)</a>:</h4>
<p>but maybe that's something we want to change</p>



<a name="250155911"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250155911" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250155911">(Aug 20 2021 at 18:33)</a>:</h4>
<p>(it's just a future that returns <code>Poll::Pending</code> once and then <code>Poll::Ready</code> thereafter)</p>



<a name="250175113"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250175113" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kestrer <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250175113">(Aug 20 2021 at 21:31)</a>:</h4>
<p>Something like this would not just be nice to have, but potentially necessary if we want mandatory async drop. I have spent lots of time attempting to design a way to support it, and I have basically concluded it would need some kind of generic-over-async method like this.</p>



<a name="250322432"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250322432" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250322432">(Aug 23 2021 at 08:17)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> MIR-only RLIBs are blocked on codegen being too slow/not parallel and the duplication of work they cause when there are multiple leaf crates (e.g. cargo integration tests). However, deferring codegen for functions that are not being called in the current crate (like we do for generic functions) would not be too hard, I think. Not sure if that would help.</p>



<a name="250507111"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250507111" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250507111">(Aug 24 2021 at 16:04)</a>:</h4>
<p>Published my blog post on async overloading: <a href="https://blog.yoshuawuyts.com/async-overloading/">https://blog.yoshuawuyts.com/async-overloading/</a></p>



<a name="250534594"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async/topic/async%20overloading/near/250534594" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async/topic/async.20overloading.html#250534594">(Aug 24 2021 at 19:18)</a>:</h4>
<p><span class="user-mention" data-user-id="124287">@mw</span> those both seem like surmountable problems, but that sonds right</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>