<html>
<head><meta charset="utf-8"><title>pgo llvm · t-compiler/wg-llvm · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/index.html">t-compiler/wg-llvm</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/pgo.20llvm.html">pgo llvm</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="255968735"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/pgo%20llvm/near/255968735" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/pgo.20llvm.html#255968735">(Oct 03 2021 at 18:10)</a>:</h4>
<p>It looks like landing <a href="https://github.com/rust-lang/rust/pull/88069">https://github.com/rust-lang/rust/pull/88069</a> (enabling PGO for LLVM) which <em>did</em> result in good performance improvement also introduced:</p>
<div class="codehilite"><pre><span></span><code>LLVM Profile Error: Runtime and instrumentation version mismatch : expected 5, but get 7
</code></pre></div>
<p>I <em>think</em> this is because we're trying to collect profdata for both LLVM and rustc at the same time, and the LLVM is built with clang version 12, while rustc is using the in-tree LLVM v13. It seems like PGO still <em>works</em> -- I'm not clear if this is actually a problem -- certainly we didn't see any regressions</p>



<a name="255968755"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/pgo%20llvm/near/255968755" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/pgo.20llvm.html#255968755">(Oct 03 2021 at 18:11)</a>:</h4>
<p>but it might be nice to bump the clang + LLVM we build on the dist-x86_64-linux builder to be version 13 anyway, especially now that it's tagged upstream</p>



<a name="255968767"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/pgo%20llvm/near/255968767" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/pgo.20llvm.html#255968767">(Oct 03 2021 at 18:11)</a>:</h4>
<p>which might be as simple as updating <a href="https://github.com/rust-lang/rust/blob/master/src/ci/docker/host-x86_64/dist-x86_64-linux/build-clang.sh#L7">https://github.com/rust-lang/rust/blob/master/src/ci/docker/host-x86_64/dist-x86_64-linux/build-clang.sh#L7</a></p>



<a name="255968948"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/pgo%20llvm/near/255968948" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/pgo.20llvm.html#255968948">(Oct 03 2021 at 18:14)</a>:</h4>
<p>wanted to flag it here just in case someone was familiar for whatever reason with the error and can say "just noise", or, potentially if we should look to always keep the baseline LLVM on the same general version</p>



<a name="255969106"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/pgo%20llvm/near/255969106" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/pgo.20llvm.html#255969106">(Oct 03 2021 at 18:17)</a>:</h4>
<p>filed <a href="https://github.com/rust-lang/rust/pull/89499">https://github.com/rust-lang/rust/pull/89499</a></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>