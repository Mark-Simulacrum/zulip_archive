<html>
<head><meta charset="utf-8"><title>wasm determinism backports · t-compiler/wg-llvm · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/index.html">t-compiler/wg-llvm</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/wasm.20determinism.20backports.html">wasm determinism backports</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="203418579"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/wasm%20determinism%20backports/near/203418579" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/wasm.20determinism.20backports.html#203418579">(Jul 09 2020 at 17:57)</a>:</h4>
<p>I've just narrowed down some build nondeterminism in a large wasm codebase, to the pass that this commit changed <a href="https://github.com/llvm/llvm-project/commit/3648370a79235ddc7a26c2db5b968725c320f6aa">https://github.com/llvm/llvm-project/commit/3648370a79235ddc7a26c2db5b968725c320f6aa</a></p>



<a name="203418685"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/wasm%20determinism%20backports/near/203418685" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/wasm.20determinism.20backports.html#203418685">(Jul 09 2020 at 17:58)</a>:</h4>
<p>I haven't yet confirmed that fixes the problem, but if I do, should I just submit it as a PR?</p>



<a name="203418723"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/wasm%20determinism%20backports/near/203418723" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/wasm.20determinism.20backports.html#203418723">(Jul 09 2020 at 17:59)</a>:</h4>
<p>also, how can I tell what the active branch is? that's always confusing</p>



<a name="203419660"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/wasm%20determinism%20backports/near/203419660" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/wasm.20determinism.20backports.html#203419660">(Jul 09 2020 at 18:06)</a>:</h4>
<p>cc <span class="user-mention" data-user-id="133224">@Nikita Popov</span> <span class="user-mention" data-user-id="138448">@cuviper</span></p>



<a name="203419751"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/wasm%20determinism%20backports/near/203419751" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/wasm.20determinism.20backports.html#203419751">(Jul 09 2020 at 18:07)</a>:</h4>
<p><code>.gitmodules</code> should specify the active branch</p>



<a name="203419775"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/wasm%20determinism%20backports/near/203419775" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/wasm.20determinism.20backports.html#203419775">(Jul 09 2020 at 18:07)</a>:</h4>
<p>(in rust-lang/rust)</p>



<a name="203419861"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/wasm%20determinism%20backports/near/203419861" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/wasm.20determinism.20backports.html#203419861">(Jul 09 2020 at 18:08)</a>:</h4>
<p>ah, thanks!</p>



<a name="203420113"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/wasm%20determinism%20backports/near/203420113" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/wasm.20determinism.20backports.html#203420113">(Jul 09 2020 at 18:10)</a>:</h4>
<p>so yeah, backport the commit to that branch, PR on rust-lang/llvm-project, then PR on rust-lang/rust updating the submodule</p>



<a name="203420118"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/wasm%20determinism%20backports/near/203420118" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/wasm.20determinism.20backports.html#203420118">(Jul 09 2020 at 18:11)</a>:</h4>
<p><a href="https://rustc-dev-guide.rust-lang.org/backend/updating-llvm.html">https://rustc-dev-guide.rust-lang.org/backend/updating-llvm.html</a></p>



<a name="203420179"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/wasm%20determinism%20backports/near/203420179" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/wasm.20determinism.20backports.html#203420179">(Jul 09 2020 at 18:11)</a>:</h4>
<p>I've done it before but I don't remember how I found the right branch, lol. probably just picked the most recent one</p>



<a name="203430729"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/wasm%20determinism%20backports/near/203430729" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/wasm.20determinism.20backports.html#203430729">(Jul 09 2020 at 19:45)</a>:</h4>
<p><span class="user-mention" data-user-id="138448">@cuviper</span> this good? <a href="https://github.com/rust-lang/llvm-project/pull/68">https://github.com/rust-lang/llvm-project/pull/68</a></p>



<a name="203434281"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/wasm%20determinism%20backports/near/203434281" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/wasm.20determinism.20backports.html#203434281">(Jul 09 2020 at 20:14)</a>:</h4>
<p><span class="user-mention" data-user-id="138448">@cuviper</span> btw I saw that in another thread, backporting to 10.0.1 came up. there's no chance this patch is making it into anything, right?</p>



<a name="203434295"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/wasm%20determinism%20backports/near/203434295" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/wasm.20determinism.20backports.html#203434295">(Jul 09 2020 at 20:14)</a>:</h4>
<p>other than LLVM 11</p>



<a name="203434863"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/wasm%20determinism%20backports/near/203434863" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/wasm.20determinism.20backports.html#203434863">(Jul 09 2020 at 20:19)</a>:</h4>
<p><span class="user-mention" data-user-id="138448">@cuviper</span> thanks! can I go make a rust-lang/rust PR now?</p>



<a name="203434900"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/wasm%20determinism%20backports/near/203434900" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/wasm.20determinism.20backports.html#203434900">(Jul 09 2020 at 20:19)</a>:</h4>
<p><span class="user-mention" data-user-id="119009">@eddyb</span> yes, but there's also <a href="https://github.com/rust-lang/rust/issues/74116">#74116</a> touching the submodule</p>



<a name="203435001"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/wasm%20determinism%20backports/near/203435001" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/wasm.20determinism.20backports.html#203435001">(Jul 09 2020 at 20:20)</a>:</h4>
<p>ugh</p>



<a name="203435018"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/wasm%20determinism%20backports/near/203435018" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/wasm.20determinism.20backports.html#203435018">(Jul 09 2020 at 20:20)</a>:</h4>
<p>and it looks like that PR keeps failing?</p>



<a name="203435060"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/wasm%20determinism%20backports/near/203435060" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/wasm.20determinism.20backports.html#203435060">(Jul 09 2020 at 20:20)</a>:</h4>
<p>RE: 10.0.1, I guess you could file a backport bug, but I think tstellar is itching to get it released</p>



<a name="203435097"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/wasm%20determinism%20backports/near/203435097" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/wasm.20determinism.20backports.html#203435097">(Jul 09 2020 at 20:20)</a>:</h4>
<p>yeah I didn't expect to get anything in</p>



<a name="203435109"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/wasm%20determinism%20backports/near/203435109" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/wasm.20determinism.20backports.html#203435109">(Jul 09 2020 at 20:21)</a>:</h4>
<p>the rollup keeps failing, but it doesn't look like anyone is blaming that PR</p>



<a name="203435121"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/wasm%20determinism%20backports/near/203435121" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/wasm.20determinism.20backports.html#203435121">(Jul 09 2020 at 20:21)</a>:</h4>
<p>had I tracked this down like two weeks ago maybe it would've helped</p>



<a name="203435156"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/wasm%20determinism%20backports/near/203435156" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/wasm.20determinism.20backports.html#203435156">(Jul 09 2020 at 20:21)</a>:</h4>
<p>shouldn't we make it <code>rollup=never</code> just in case?</p>



<a name="203435408"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/wasm%20determinism%20backports/near/203435408" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/wasm.20determinism.20backports.html#203435408">(Jul 09 2020 at 20:23)</a>:</h4>
<p>if it's suspicious, yes, but of course that will slow down its merge</p>



<a name="203435436"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/wasm%20determinism%20backports/near/203435436" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/wasm.20determinism.20backports.html#203435436">(Jul 09 2020 at 20:23)</a>:</h4>
<p>maybe I'll just come back to this tomorrow (since it's like midnight for me here)</p>



<a name="203435560"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/wasm%20determinism%20backports/near/203435560" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/wasm.20determinism.20backports.html#203435560">(Jul 09 2020 at 20:24)</a>:</h4>
<p>sure</p>



<a name="203435623"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/wasm%20determinism%20backports/near/203435623" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/wasm.20determinism.20backports.html#203435623">(Jul 09 2020 at 20:25)</a>:</h4>
<p>note that rust's beta branch is soon too, if you're hoping to land this in 1.46</p>



<a name="203436261"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/wasm%20determinism%20backports/near/203436261" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/wasm.20determinism.20backports.html#203436261">(Jul 09 2020 at 20:30)</a>:</h4>
<p>the project who hit this uses nightly for their wasm side, and it only hurts their determinism so I'm not too worried</p>



<a name="203467099"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/wasm%20determinism%20backports/near/203467099" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/wasm.20determinism.20backports.html#203467099">(Jul 10 2020 at 03:52)</a>:</h4>
<p>woke up and <a href="https://github.com/rust-lang/rust/pull/74208">https://github.com/rust-lang/rust/pull/74208</a> exists, hoping it succeeds</p>



<a name="203610462"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/wasm%20determinism%20backports/near/203610462" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/wasm.20determinism.20backports.html#203610462">(Jul 11 2020 at 19:41)</a>:</h4>
<p>another day, another rollup: <a href="https://github.com/rust-lang/rust/pull/74245">https://github.com/rust-lang/rust/pull/74245</a> (10th time's the charm, right?)</p>



<a name="203612724"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/wasm%20determinism%20backports/near/203612724" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/wasm.20determinism.20backports.html#203612724">(Jul 11 2020 at 20:45)</a>:</h4>
<p>And now there's a new one that includes your change too: <a href="https://github.com/rust-lang/rust/pull/74239">https://github.com/rust-lang/rust/pull/74239</a></p>



<a name="203612780"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/wasm%20determinism%20backports/near/203612780" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/wasm.20determinism.20backports.html#203612780">(Jul 11 2020 at 20:46)</a>:</h4>
<p>But I'll hold on that until the other one finally lands</p>



<a name="203618399"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/wasm%20determinism%20backports/near/203618399" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/wasm.20determinism.20backports.html#203618399">(Jul 11 2020 at 23:34)</a>:</h4>
<p>haha</p>



<a name="203618401"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/wasm%20determinism%20backports/near/203618401" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/wasm.20determinism.20backports.html#203618401">(Jul 11 2020 at 23:34)</a>:</h4>
<p>well that spares me a worktree, thanks :D</p>



<a name="203618513"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/wasm%20determinism%20backports/near/203618513" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/wasm.20determinism.20backports.html#203618513">(Jul 11 2020 at 23:38)</a>:</h4>
<p>I probably was overthinking it and wasted some time but eh</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>