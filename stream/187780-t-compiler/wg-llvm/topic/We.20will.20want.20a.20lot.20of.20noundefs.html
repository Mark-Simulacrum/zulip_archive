<html>
<head><meta charset="utf-8"><title>We will want a lot of noundefs · t-compiler/wg-llvm · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/index.html">t-compiler/wg-llvm</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/We.20will.20want.20a.20lot.20of.20noundefs.html">We will want a lot of noundefs</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="256106096"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/We%20will%20want%20a%20lot%20of%20noundefs/near/256106096" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/We.20will.20want.20a.20lot.20of.20noundefs.html#256106096">(Oct 04 2021 at 18:15)</a>:</h4>
<p><a href="https://aqjune.github.io/posts/2021-10-4.the-select-story.html">https://aqjune.github.io/posts/2021-10-4.the-select-story.html</a></p>
<p>Right now I believe we dont apply noundef anywhere pretty much and we should be applying at least never-poison pretty much almost everywhere.</p>



<a name="256122151"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/We%20will%20want%20a%20lot%20of%20noundefs/near/256122151" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Popov <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/We.20will.20want.20a.20lot.20of.20noundefs.html#256122151">(Oct 04 2021 at 19:56)</a>:</h4>
<p>There is no nopoison, only noundef. And yes, we can apply it liberally, though we probably need to regress mem::uninitialized() to return the same as mem::zeroed() (just with strong assertions) first.</p>



<a name="256122218"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/We%20will%20want%20a%20lot%20of%20noundefs/near/256122218" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Popov <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/We.20will.20want.20a.20lot.20of.20noundefs.html#256122218">(Oct 04 2021 at 19:57)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/issues/74378">https://github.com/rust-lang/rust/issues/74378</a></p>



<a name="256133003"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/We%20will%20want%20a%20lot%20of%20noundefs/near/256133003" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/We.20will.20want.20a.20lot.20of.20noundefs.html#256133003">(Oct 04 2021 at 21:09)</a>:</h4>
<p>Why is <code>uninitialized</code> a problem? Any use of value containing it is already UB?</p>



<a name="256133034"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/We%20will%20want%20a%20lot%20of%20noundefs/near/256133034" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/We.20will.20want.20a.20lot.20of.20noundefs.html#256133034">(Oct 04 2021 at 21:09)</a>:</h4>
<p>as long as we somehow avoid introducing noundef directly on the <code>undef</code> that <code>mem::uninitialized</code> produces, things should be fine?</p>



<a name="256133187"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/We%20will%20want%20a%20lot%20of%20noundefs/near/256133187" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/We.20will.20want.20a.20lot.20of.20noundefs.html#256133187">(Oct 04 2021 at 21:11)</a>:</h4>
<p>Also, from what I can tell a problem with noundef is that it only applies to parameters and return values. We can't e.g. say <code>%x = add nuw ..., !noundef</code> or somesuch</p>



<a name="256133262"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/We%20will%20want%20a%20lot%20of%20noundefs/near/256133262" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/We.20will.20want.20a.20lot.20of.20noundefs.html#256133262">(Oct 04 2021 at 21:11)</a>:</h4>
<p>this seems particularly relevant to e.g. shifts because we always wraparound the shift amount to fit.</p>



<a name="256212305"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/We%20will%20want%20a%20lot%20of%20noundefs/near/256212305" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Popov <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/We.20will.20want.20a.20lot.20of.20noundefs.html#256212305">(Oct 05 2021 at 10:41)</a>:</h4>
<p>Not a problem as far as semantics are concerned, just suspect that the practical impact there might be large as uses of mem::uninitialized() do tend to be UB that is currently mostly ignored for types without a trap representation.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>