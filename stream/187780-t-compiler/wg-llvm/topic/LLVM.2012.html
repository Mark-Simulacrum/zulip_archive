<html>
<head><meta charset="utf-8"><title>LLVM 12 · t-compiler/wg-llvm · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/index.html">t-compiler/wg-llvm</a></h2>
<h3>Topic: <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html">LLVM 12</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://rust-lang.github.io/zulip_archive/style.css" rel="stylesheet"></head>

<a name="223963373"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/223963373" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Popov <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#223963373">(Jan 25 2021 at 21:31)</a>:</h4>
<p>I've started working on upgrading to LLVM 12, which branches tomorrow...</p>



<a name="223963434"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/223963434" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Popov <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#223963434">(Jan 25 2021 at 21:31)</a>:</h4>
<p>This one fixes quite a few things relevant to us.</p>



<a name="223963525"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/223963525" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#223963525">(Jan 25 2021 at 21:32)</a>:</h4>
<p>there was a request to prefix rust-specific patches, if you could edit that in your rebase</p>



<a name="223963536"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/223963536" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#223963536">(Jan 25 2021 at 21:32)</a>:</h4>
<p>a simple <code>[rust] ...</code> should suffice</p>



<a name="223963918"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/223963918" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Popov <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#223963918">(Jan 25 2021 at 21:35)</a>:</h4>
<p>Sure, will do that</p>



<a name="223964362"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/223964362" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Popov <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#223964362">(Jan 25 2021 at 21:39)</a>:</h4>
<blockquote>
<p>rustc: /home/nikic/rust/src/llvm-project/llvm/include/llvm/MC/MCInst.h:65: unsigned int llvm::MCOperand::getReg() const: Assertion `isReg() &amp;&amp; "This is not a register operand!"' failed.</p>
</blockquote>
<p>Guess that's the first new bug...</p>



<a name="223964398"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/223964398" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#223964398">(Jan 25 2021 at 21:39)</a>:</h4>
<p>that seems vaguely familiar</p>



<a name="223965349"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/223965349" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Popov <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#223965349">(Jan 25 2021 at 21:48)</a>:</h4>
<p>Do you happen to know how to manually re-run the rustc command from bootstrapping? I thought it's a matter of replacing build/bootstrap/debug/rustc with build/x86_64-unknown-linux-gnu/stage1/bin/rustc but that results in lots of "use of unstable library feature 'rustc_private': this crate is being loaded from the sysroot, an unstable location" errors.</p>



<a name="223965405"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/223965405" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#223965405">(Jan 25 2021 at 21:48)</a>:</h4>
<p><code>RUSTC_BOOTSTRAP=1</code> for starters</p>



<a name="223965422"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/223965422" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#223965422">(Jan 25 2021 at 21:48)</a>:</h4>
<p>but I think there are more environment variables involved</p>



<a name="223965487"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/223965487" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#223965487">(Jan 25 2021 at 21:49)</a>:</h4>
<p>I'm not sure what you mean by "replacing .../rustc" though</p>



<a name="223966071"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/223966071" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#223966071">(Jan 25 2021 at 21:54)</a>:</h4>
<p>I think <code>x.py build -v -v</code> will show at least some of the environment, but there are a few more things set by the <code>src/bootstrap/bin/rustc.rs</code> wrapper</p>



<a name="223966595"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/223966595" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Popov <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#223966595">(Jan 25 2021 at 21:58)</a>:</h4>
<p>Thanks! The <code>-v -v</code> provided the information I needed.</p>



<a name="223974880"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/223974880" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#223974880">(Jan 25 2021 at 22:57)</a>:</h4>
<p>BTW, our alloc patch is outdated: <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/llvm.20fork.20prototypes.20rust_alloc.20with.203.20params/near/223948353">https://rust-lang.zulipchat.com/#narrow/stream/182449-t-compiler.2Fhelp/topic/llvm.20fork.20prototypes.20rust_alloc.20with.203.20params/near/223948353</a></p>



<a name="223975685"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/223975685" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Popov <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#223975685">(Jan 25 2021 at 23:05)</a>:</h4>
<p>Wonder why that went unnoticed. Shouldn't that have broken codegen tests for allocations being optimized away?</p>



<a name="223975769"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/223975769" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#223975769">(Jan 25 2021 at 23:05)</a>:</h4>
<p>maybe LLVM is managing to see through it anyway?</p>



<a name="223976115"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/223976115" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#223976115">(Jan 25 2021 at 23:09)</a>:</h4>
<p><code>git grep rust_alloc</code> doesn't reveal any tests though -- I was hoping for a <code>CHECK-NOT</code></p>



<a name="223976285"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/223976285" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Popov <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#223976285">(Jan 25 2021 at 23:11)</a>:</h4>
<p>Heh</p>



<a name="223979837"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/223979837" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#223979837">(Jan 25 2021 at 23:53)</a>:</h4>
<p>Looks like there's this one: <a href="https://github.com/rust-lang/rust/blob/master/src/test/codegen/alloc-optimisation.rs">https://github.com/rust-lang/rust/blob/master/src/test/codegen/alloc-optimisation.rs</a></p>



<a name="224087400"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/224087400" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Popov <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#224087400">(Jan 26 2021 at 19:07)</a>:</h4>
<p>For the record: <a href="https://bugs.llvm.org/show_bug.cgi?id=48888">https://bugs.llvm.org/show_bug.cgi?id=48888</a></p>



<a name="224247865"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/224247865" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#224247865">(Jan 27 2021 at 21:10)</a>:</h4>
<p>I found a C ABI break: <a href="https://bugs.llvm.org/show_bug.cgi?id=48905">https://bugs.llvm.org/show_bug.cgi?id=48905</a></p>



<a name="224247908"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/224247908" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#224247908">(Jan 27 2021 at 21:11)</a>:</h4>
<p>We do use <code>LLVMTypeKind</code>, but I don't see any use of the affected variants</p>



<a name="225714950"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/225714950" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Popov <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#225714950">(Feb 09 2021 at 16:20)</a>:</h4>
<p>So, anyone want to take a look over <a href="https://github.com/rust-lang/rust/pull/81451">https://github.com/rust-lang/rust/pull/81451</a>? I think it's ready ... minus all the CI failures that will turn up.</p>



<a name="225715319"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/225715319" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#225715319">(Feb 09 2021 at 16:23)</a>:</h4>
<p>I'd like to figure out the perf thing before we merge - I'm not sold it's because of try builds; those should work.</p>



<a name="225717212"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/225717212" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#225717212">(Feb 09 2021 at 16:34)</a>:</h4>
<p>Did we figure out the linker error? What was the solution?</p>



<a name="225718798"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/225718798" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Popov <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#225718798">(Feb 09 2021 at 16:45)</a>:</h4>
<p><span class="user-mention" data-user-id="116122">@simulacrum</span> Hm, how does rust-perf actually handle try commits? Not obvious how they are fetched as they're temporary and not connected to a branch.</p>



<a name="225718941"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/225718941" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#225718941">(Feb 09 2021 at 16:46)</a>:</h4>
<p>They're still not garbage collected by git; my quick glance at the code suggested we force reset to them.. not 100% sure how that works, tbh</p>



<a name="225719083"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/225719083" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#225719083">(Feb 09 2021 at 16:47)</a>:</h4>
<p>er, github that is</p>



<a name="225719126"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/225719126" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Popov <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#225719126">(Feb 09 2021 at 16:47)</a>:</h4>
<p>Is there something special rust does to prevent GC? I've been wondering about that as well.</p>



<a name="225719721"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/225719721" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Popov <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#225719721">(Feb 09 2021 at 16:51)</a>:</h4>
<p>Hm, just doing a <code>git fetch origin try-commit-id</code> does indeed work. Didn't expect that.</p>



<a name="225722439"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/225722439" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#225722439">(Feb 09 2021 at 17:06)</a>:</h4>
<p>I think it gets GC'd eventually but it might be months or something.</p>



<a name="225729782"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/225729782" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Popov <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#225729782">(Feb 09 2021 at 17:54)</a>:</h4>
<p>Doing a manual run I can see that rustc fails to link, but I'll have to redo with larger -s to see the error message...</p>



<a name="225733372"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/225733372" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Popov <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#225733372">(Feb 09 2021 at 18:19)</a>:</h4>
<p>Hm okay, that one did fail due to the morestack issue.</p>



<a name="225733902"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/225733902" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Popov <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#225733902">(Feb 09 2021 at 18:23)</a>:</h4>
<p>Oooh I get it. It did not fail with master builds because llvm-project wasn't updated, so it used the old <a href="http://libLLVM.so">libLLVM.so</a> and thus did not run into the morestack issue. It does run into it here because we also update llvm-project and actually end up using the new <a href="http://libLLVM.so">libLLVM.so</a>.</p>



<a name="225734246"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/225734246" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Popov <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#225734246">(Feb 09 2021 at 18:25)</a>:</h4>
<p>Well, I triggered a new try build, hopefully it will work now.</p>



<a name="225773419"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/225773419" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mati865 <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#225773419">(Feb 09 2021 at 23:30)</a>:</h4>
<p>I can run failing Dockerfiles on my box in case you need help.</p>



<a name="225880890"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/225880890" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Popov <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#225880890">(Feb 10 2021 at 18:00)</a>:</h4>
<p>The new perf run worked (<a href="https://perf.rust-lang.org/compare.html?start=ea098255f74923d69ea234ee526df6b9cecc3b9b&amp;end=cdf4d8eebff783a7bf3da9267accea75dcf6938f">https://perf.rust-lang.org/compare.html?start=ea098255f74923d69ea234ee526df6b9cecc3b9b&amp;end=cdf4d8eebff783a7bf3da9267accea75dcf6938f</a>), but unfortunately shows a regression on bootstrap (2% overall). It's weird how most everything seems to benefit, but rustc itself is the other way around :/</p>



<a name="225881701"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/225881701" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Popov <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#225881701">(Feb 10 2021 at 18:06)</a>:</h4>
<p><span class="user-mention" data-user-id="123586">@nagisa</span> I'm currently avoiding the linker error by building both python 2 and python 3, which means we don't have to update clang, and thus don't get a linker error.</p>



<a name="225882110"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/225882110" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tm <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#225882110">(Feb 10 2021 at 18:08)</a>:</h4>
<p>Benchmarks wall-times results are mixed, max-rss and page faults are consistently regressions.</p>



<a name="225884880"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/225884880" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tm <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#225884880">(Feb 10 2021 at 18:29)</a>:</h4>
<p>and <a href="http://libLLVM.so">libLLVM.so</a> size increased by +8.6%</p>



<a name="226549838"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/226549838" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Popov <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#226549838">(Feb 16 2021 at 17:52)</a>:</h4>
<p>I've collected profiles for rustc_hir (where the impact is highest), and this doesn't seem to be a question of wall-time. There's an instruction retired increase from 29B to 32B as well.</p>



<a name="226550040"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/226550040" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Popov <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#226550040">(Feb 16 2021 at 17:53)</a>:</h4>
<p>And the cause seems to be that a lot more IR is getting processed. E.g. number of calls to SelectBasicBlock goes up from 5104 to 6597. Correspondingly compile-time increases.</p>



<a name="226558959"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/226558959" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Popov <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#226558959">(Feb 16 2021 at 18:57)</a>:</h4>
<p>Specifically, what seems to happen in the rustc_hir case is that all the insert() calls in <a href="https://github.com/rust-lang/rust/blob/f1c47c79fe8438ed241630f885797eebef3a6cab/compiler/rustc_hir/src/lang_items.rs#L121-L125">https://github.com/rust-lang/rust/blob/f1c47c79fe8438ed241630f885797eebef3a6cab/compiler/rustc_hir/src/lang_items.rs#L121-L125</a> get inlined :/</p>



<a name="226559113"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/226559113" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Popov <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#226559113">(Feb 16 2021 at 18:58)</a>:</h4>
<p>While previously the function was not imported by ThinLTO.</p>



<a name="226564393"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/226564393" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Popov <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#226564393">(Feb 16 2021 at 19:35)</a>:</h4>
<p>So yeah, I don't think this is actionable as far as the LLVM upgrade is concerned (though that particular case could be mitigated). The good news is that the new pass manager does not inline this.</p>



<a name="226658578"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/226658578" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#226658578">(Feb 17 2021 at 13:54)</a>:</h4>
<p><span class="user-mention" data-user-id="133224">@Nikita Popov</span> I assume that "good news" should be interpreted as: We do not plan to switch to the new pass manager as part of the upgrade itself (because it would add additional risk, as well as make the performance eval harder to interpret), but rather we should expect this particular cost to be mitigated in the near future when we <em>do</em> switch to the new pass manager?</p>



<a name="226658616"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/226658616" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#226658616">(Feb 17 2021 at 13:55)</a>:</h4>
<p>Does that sound like a correct interpretation of your remark?</p>



<a name="226686210"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/226686210" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Popov <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#226686210">(Feb 17 2021 at 16:43)</a>:</h4>
<p>Yeah, sounds right :) I do want to mitigate that particular regression in the meantime, I think just adding a <code>#[cold]</code> will probably do it.</p>



<a name="226686646"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/226686646" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Popov <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#226686646">(Feb 17 2021 at 16:46)</a>:</h4>
<p>I've also profiled aho_corasick, which is the second largest regression. In this case we now spend much more time in LICM promotion (again as a result of incoming IR changes). This is a known compile-time bottleneck for which I actually have a patch (<a href="https://reviews.llvm.org/D89264">https://reviews.llvm.org/D89264</a>), but it's been stalled for a while.</p>



<a name="227504199"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/227504199" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#227504199">(Feb 23 2021 at 21:13)</a>:</h4>
<p><span class="user-mention" data-user-id="133224">@Nikita Popov</span> feel free to <code>@bors r=nagisa rollup=never</code> the upgrade PR yourself whenever you are happy with it.</p>



<a name="228925246"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/228925246" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matthiaskrgr <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#228925246">(Mar 05 2021 at 09:42)</a>:</h4>
<p>do we have tests for <a href="https://github.com/rust-lang/rust/issues/28728">https://github.com/rust-lang/rust/issues/28728</a> and <a href="https://github.com/rust-lang/rust/issues/80309">https://github.com/rust-lang/rust/issues/80309</a> ?<br>
Both tickets were closed after the llvm upgrade but I couldn't see any related testfiles in the llvm PR.</p>



<a name="228927383"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/228927383" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Popov <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#228927383">(Mar 05 2021 at 10:00)</a>:</h4>
<p>I plan to work on the infinite loop issue (remove/limit sideeffect insertion), can add additional tests while doing that.</p>



<a name="229106788"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/229106788" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matthiaskrgr <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#229106788">(Mar 06 2021 at 15:38)</a>:</h4>
<p>mmh I also remember I had some segfault inside llvm trigger <a href="https://github.com/rust-lang/rust/issues/76213">#76213</a> and a pr that lead to some noticeable perf improvements had to be reverter <a href="https://github.com/rust-lang/rust/issues/80122">#80122</a><br>
Is there a chance that the underlying llvm issue has been fixed in the meantime?</p>



<a name="229106926"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/229106926" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matthiaskrgr <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#229106926">(Mar 06 2021 at 15:40)</a>:</h4>
<p>going down the ticket-rabbithole a bit I found a llvm ticket but it seesm to be not fixed :/ <a href="https://bugs.llvm.org/show_bug.cgi?id=48340">https://bugs.llvm.org/show_bug.cgi?id=48340</a></p>



<a name="229108500"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/229108500" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#229108500">(Mar 06 2021 at 16:02)</a>:</h4>
<p>tests for infinite loop are in <code>src/test/codegen/non-terminate</code></p>



<a name="229108549"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/229108549" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#229108549">(Mar 06 2021 at 16:03)</a>:</h4>
<p>I reopened the <a href="https://github.com/rust-lang/rust/issues/80309">#80309</a> with E-needs-test.</p>



<a name="229108846"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/229108846" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#229108846">(Mar 06 2021 at 16:07)</a>:</h4>
<p>I think <a href="https://github.com/rust-lang/rust/issues/80309">#80309</a> is still not fixed, it still compiles down to a unconditional trap...</p>



<a name="229110429"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/229110429" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Popov <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#229110429">(Mar 06 2021 at 16:31)</a>:</h4>
<p><span class="user-mention" data-user-id="217864">@matthiaskrgr</span> I believe <a href="https://reviews.llvm.org/D91250">https://reviews.llvm.org/D91250</a> fixes that vectorization issue, but it's not merged yet.</p>



<a name="229110525"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/229110525" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matthiaskrgr <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#229110525">(Mar 06 2021 at 16:32)</a>:</h4>
<p>llvm 13 then, ok :P</p>



<a name="229220234"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/229220234" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#229220234">(Mar 07 2021 at 21:44)</a>:</h4>
<p>thinking about the infinite loop workaround, I think it might be worthwhile to make ourselves an issue, but keep the workaround in place for a couple of cycles, or maybe make it conditional on the LLVM version so that we don't regress people using rustc shipped by distributions (possibly linked against slightly older LLVM)</p>



<a name="229220281"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/229220281" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#229220281">(Mar 07 2021 at 21:45)</a>:</h4>
<p>you mean the workaround for the trivial loop case?</p>



<a name="229220283"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/229220283" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#229220283">(Mar 07 2021 at 21:45)</a>:</h4>
<p>(i.e., unconditional branch to same basic block, IIRC)</p>



<a name="229220348"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/229220348" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#229220348">(Mar 07 2021 at 21:46)</a>:</h4>
<p>I agree we should keep it for &lt;= 11 versions; I don't think we need to keep the -Zinsert-sideffect flag though.</p>



<a name="229220604"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/229220604" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#229220604">(Mar 07 2021 at 21:50)</a>:</h4>
<p>yeah, that's what I mean.</p>



<a name="229220713"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/229220713" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#229220713">(Mar 07 2021 at 21:52)</a>:</h4>
<p><span class="user-mention" data-user-id="133224">@Nikita Popov</span> if you don't have bandwidth to implement this / are busy looking at other LLVM 12 fallout, I'm happy to do something about the loop workaround.</p>



<a name="229221342"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/229221342" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Popov <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#229221342">(Mar 07 2021 at 22:02)</a>:</h4>
<p><span class="user-mention" data-user-id="123586">@nagisa</span> Feel free :) What I was planning to do is drop the flag and keep the insert of sideeffect in trivial loop{} only in LLVM &lt; 12.</p>



<a name="229270965"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/229270965" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Popov <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#229270965">(Mar 08 2021 at 09:36)</a>:</h4>
<p>Looks like bors "forgot" the try build on <a href="https://github.com/rust-lang/rust/pull/82884">https://github.com/rust-lang/rust/pull/82884</a>.</p>



<a name="229272219"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/229272219" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yuki Okushi <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#229272219">(Mar 08 2021 at 09:48)</a>:</h4>
<p><span class="user-mention silent" data-user-id="133224">Nikita Popov</span> <a href="#narrow/stream/187780-t-compiler.2Fwg-llvm/topic/LLVM.2012/near/229270965">said</a>:</p>
<blockquote>
<p>Looks like bors "forgot" the try build on <a href="https://github.com/rust-lang/rust/pull/82884">https://github.com/rust-lang/rust/pull/82884</a>.</p>
</blockquote>
<p>it's because of force push, I think</p>



<a name="229272459"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/229272459" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Popov <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#229272459">(Mar 08 2021 at 09:51)</a>:</h4>
<p>Is there some way to get bors to make the comment for the finished build (assuming that's what rust-timer looks for), or just need to retry?</p>



<a name="229272618"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/229272618" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yuki Okushi <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#229272618">(Mar 08 2021 at 09:52)</a>:</h4>
<p>AFAIK we need a retry</p>



<a name="229272921"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/229272921" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yuki Okushi <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#229272921">(Mar 08 2021 at 09:55)</a>:</h4>
<p>ah we can also use a commit sha but I think retrying makes more sense here if it's the needed change?</p>



<a name="229273347"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/229273347" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Popov <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#229273347">(Mar 08 2021 at 09:59)</a>:</h4>
<p>Yeah, I guess that point of the force push was to make the check cheaper, so retrying makes sense.</p>



<a name="229273967"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/229273967" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yuki Okushi <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#229273967">(Mar 08 2021 at 10:04)</a>:</h4>
<p><code>@bors retry</code> doesn't trigger a try build, we should do <code>@bors try @rust-timer queue</code> once more :)</p>



<a name="229275312"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/229275312" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Popov <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#229275312">(Mar 08 2021 at 10:15)</a>:</h4>
<p>Ugh</p>



<a name="229275395"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/229275395" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Popov <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#229275395">(Mar 08 2021 at 10:16)</a>:</h4>
<p>Does retry do anything at all for unapproved PRs?</p>



<a name="229287065"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/229287065" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yuki Okushi <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#229287065">(Mar 08 2021 at 11:59)</a>:</h4>
<p>yep, AFAIK</p>



<a name="233888857"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/233888857" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#233888857">(Apr 09 2021 at 20:57)</a>:</h4>
<p>Note -- when we next get around to a <code>release/12.x</code> merge, or rebase on the final 12.0.0, we can drop the Windows delete-on-close revert. The fix for that issue has been backported to the 12.x branch.</p>



<a name="234740242"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/234740242" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#234740242">(Apr 15 2021 at 19:42)</a>:</h4>
<p>I will rebase onto <code>llvmorg-12.0.0</code> this afternoon, unless someone is already working on it</p>



<a name="234745169"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/234745169" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#234745169">(Apr 15 2021 at 20:15)</a>:</h4>
<p>It's been tagged? Didn't see the ann for the tag yet.</p>



<a name="234745238"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/234745238" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#234745238">(Apr 15 2021 at 20:15)</a>:</h4>
<p>We got a couple other backports on top so should just roll everything together to avoid extra work..</p>



<a name="234747766"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/234747766" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Popov <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#234747766">(Apr 15 2021 at 20:32)</a>:</h4>
<p>Oh nice, I didn't notice that the release has happened already. The rebase should fix <a href="https://github.com/rust-lang/rust/issues/82890">https://github.com/rust-lang/rust/issues/82890</a>.</p>



<a name="234747983"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/234747983" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Popov <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#234747983">(Apr 15 2021 at 20:33)</a>:</h4>
<p>Probably also a good time to beta backport the submodule, to make sure all the LLVM 12 regression fixes make it there...</p>



<a name="234755294"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/234755294" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#234755294">(Apr 15 2021 at 21:14)</a>:</h4>
<p>just confirmed with Tom, he's mailing the announcement now</p>



<a name="234755475"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/234755475" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#234755475">(Apr 15 2021 at 21:14)</a>:</h4>
<p><span class="user-mention" data-user-id="123586">@nagisa</span> do you want me to get those backports? or let you do it after I push a branch?</p>



<a name="234759131"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/234759131" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#234759131">(Apr 15 2021 at 21:43)</a>:</h4>
<p>I'm ok with either way but won't have time for it before Tomorrow</p>



<a name="234759259"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/234759259" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#234759259">(Apr 15 2021 at 21:44)</a>:</h4>
<p>I suspect we may need to look through all of the issues we have to see if there are more to be had too than just the one I have in mind.</p>



<a name="234937123"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/234937123" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#234937123">(Apr 16 2021 at 23:51)</a>:</h4>
<p>Is it a goal to retain test changes/have tests passing in our fork?</p>



<a name="234937132"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/234937132" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#234937132">(Apr 16 2021 at 23:51)</a>:</h4>
<p>I have some test failures in my cherrypick and am not really in a mood to verify tests pass after my merge resolutions.</p>



<a name="234937456"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/234937456" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#234937456">(Apr 16 2021 at 23:57)</a>:</h4>
<p>Also wow, we do have a fair number of cherry picks, and the tag has been _just_ cut.</p>



<a name="234949794"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%2012/near/234949794" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://rust-lang.github.io/zulip_archive/stream/187780-t-compiler/wg-llvm/topic/LLVM.2012.html#234949794">(Apr 17 2021 at 01:46)</a>:</h4>
<p>it would be <em>nice</em> to keep tests working, but I haven't even checked the state of LLVM tests in our fork right now, so...</p>



<hr><p>Last updated: Aug 07 2021 at 22:04 UTC</p>
</html>