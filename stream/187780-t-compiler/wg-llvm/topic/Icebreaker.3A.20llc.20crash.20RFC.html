<html>
<head><meta charset="utf-8"><title>Icebreaker: llc crash RFC · t-compiler/wg-llvm · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/index.html">t-compiler/wg-llvm</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/Icebreaker.3A.20llc.20crash.20RFC.html">Icebreaker: llc crash RFC</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="275640094"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/Icebreaker%3A%20llc%20crash%20RFC/near/275640094" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nashe Mncube <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/Icebreaker.3A.20llc.20crash.20RFC.html#275640094">(Mar 17 2022 at 11:49)</a>:</h4>
<p>Hi all, I'm new to contributing to <code>rustc</code> and I've found some time here and there over the past couple of weeks to understand one of the LLVM icebreakers in the issue backlog. The issue is the following <a href="https://github.com/rust-lang/rust/issues/80268">https://github.com/rust-lang/rust/issues/80268</a> . I've been able to reduce it down to the exact cause in the LLVM backend and it's related to <code>globalisel</code> <a href="https://github.com/llvm/llvm-project/issues/54339">https://github.com/llvm/llvm-project/issues/54339</a> . I've been thinking about how to approach a solution to this problem but I wanted to ask for thoughts on best approaches (if that's ok for the chat?).</p>



<a name="275726510"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/Icebreaker%3A%20llc%20crash%20RFC/near/275726510" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Popov <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/Icebreaker.3A.20llc.20crash.20RFC.html#275726510">(Mar 17 2022 at 21:02)</a>:</h4>
<p>I don't think your reduction is correct. <code>-global-isel=1</code>, maybe somewhat confusingly, enables GlobalISel in abort mode, which means that it errors if GlobalISel would otherwise fall back to SelectionDAG. However, the actual AArch64 backend enables GlobalISel at <code>-O0</code> with abort mode disabled, which means that it will silently fall back to SelectionDAG.</p>



<a name="275726615"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/Icebreaker%3A%20llc%20crash%20RFC/near/275726615" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Popov <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/Icebreaker.3A.20llc.20crash.20RFC.html#275726615">(Mar 17 2022 at 21:03)</a>:</h4>
<p>You want to do the reduction with <code>llc -O0</code>, not with <code>llc -global-isel=1</code>.</p>



<a name="276036315"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/Icebreaker%3A%20llc%20crash%20RFC/near/276036315" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nashe Mncube <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/Icebreaker.3A.20llc.20crash.20RFC.html#276036315">(Mar 21 2022 at 11:25)</a>:</h4>
<p>Thanks Nikita! That is a bit confusing. I’ll close my reduction and poke around again</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>