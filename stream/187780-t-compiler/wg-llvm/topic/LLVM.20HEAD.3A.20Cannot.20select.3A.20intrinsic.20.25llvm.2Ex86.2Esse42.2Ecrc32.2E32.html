<html>
<head><meta charset="utf-8"><title>LLVM HEAD: Cannot select: intrinsic %llvm.x86.sse42.crc32.32 · t-compiler/wg-llvm · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/index.html">t-compiler/wg-llvm</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html">LLVM HEAD: Cannot select: intrinsic %llvm.x86.sse42.crc32.32</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="253108521"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253108521" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> durin42 <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253108521">(Sep 13 2021 at 15:25)</a>:</h4>
<p>Howdy folks! I've got rustc building on my workstation against LLVM HEAD again, but my CI box is mysteriously failing with the $SUBJECT error. More output at <a href="https://buildkite.com/llvm-project/rust-llvm-integrate-prototype/builds/4643#6d90c69f-a642-4b5d-ada8-6438134c16e9">https://buildkite.com/llvm-project/rust-llvm-integrate-prototype/builds/4643#6d90c69f-a642-4b5d-ada8-6438134c16e9</a>, but it's not really very enlightening. Does anyone here know how I'm failing at computer and triggering this only on the CI machine?</p>



<a name="253108997"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253108997" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253108997">(Sep 13 2021 at 15:28)</a>:</h4>
<p>Hm, do you have -Ctarget-cpu=native or something similar?</p>



<a name="253109086"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253109086" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253109086">(Sep 13 2021 at 15:28)</a>:</h4>
<p>This can likely be minified to something using the _mm_crc32_u8 intrinsic (in core::arch::x86_64)</p>



<a name="253109125"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253109125" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253109125">(Sep 13 2021 at 15:28)</a>:</h4>
<p>(<a href="https://doc.rust-lang.org/nightly/src/core/up/up/stdarch/crates/core_arch/src/x86/sse42.rs.html#602">https://doc.rust-lang.org/nightly/src/core/up/up/stdarch/crates/core_arch/src/x86/sse42.rs.html#602</a>)</p>



<a name="253109709"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253109709" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> durin42 <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253109709">(Sep 13 2021 at 15:32)</a>:</h4>
<p>Would that be in how I'm building LLVM? I don't see anything obviously-like -Ctarget in the cmake invocations...</p>



<a name="253110168"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253110168" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253110168">(Sep 13 2021 at 15:34)</a>:</h4>
<p>no, rustc invocations</p>



<a name="253110463"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253110463" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253110463">(Sep 13 2021 at 15:36)</a>:</h4>
<p>In particular the target_feature sse4.2 is maybe statically disabled/enabled then that might change whether this intrinsic gets used by the failing crate</p>



<a name="253110534"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253110534" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253110534">(Sep 13 2021 at 15:36)</a>:</h4>
<p>though it looks like it's supposed to be runtime detected, not static, in theory</p>



<a name="253112171"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253112171" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253112171">(Sep 13 2021 at 15:45)</a>:</h4>
<p>Stuff like CRC and rdrand are platform features that can't really be emulated so if you unconditionally call that without a #[target_feature="..."] or the equivalent cli call then it will fail to select.</p>



<a name="253112298"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253112298" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253112298">(Sep 13 2021 at 15:46)</a>:</h4>
<p>It might be the case that llvm got more strict about verifying this specific intrinsic or worse at optimizing unused stuff out</p>



<a name="253112377"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253112377" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253112377">(Sep 13 2021 at 15:46)</a>:</h4>
<p>(or maybe does invalid inlining decisions or...)</p>



<a name="253113129"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253113129" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Popov <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253113129">(Sep 13 2021 at 15:51)</a>:</h4>
<p>The relevant call is presumably <a href="https://github.com/BurntSushi/rust-snappy/blob/44b40d70a330ad0e283b25c934387f96b6d47490/src/crc32.rs#L71">https://github.com/BurntSushi/rust-snappy/blob/44b40d70a330ad0e283b25c934387f96b6d47490/src/crc32.rs#L71</a></p>



<a name="253117804"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253117804" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> durin42 <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253117804">(Sep 13 2021 at 16:18)</a>:</h4>
<p>Could this be a failure that would only show up on machines without sse2 enabled?</p>



<a name="253118282"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253118282" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> durin42 <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253118282">(Sep 13 2021 at 16:21)</a>:</h4>
<div class="codehilite"><pre><span></span><code>error: could not compile `snap`
</code></pre></div>
<p>So I suspect it's from the <code>snap</code> crate?</p>
<p>I guess at this point what I need is a way to reproduce this not on the CI machine so I can bisect...</p>



<a name="253119946"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253119946" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253119946">(Sep 13 2021 at 16:32)</a>:</h4>
<p>Yeah, you can at least try to minimize this to a smaller test case (e.g., just building the snap crate -- the code was linked)</p>



<a name="253122653"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253122653" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> durin42 <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253122653">(Sep 13 2021 at 16:50)</a>:</h4>
<p>Right, first I have to have a place where I have shell access that I can reproduce this. :/</p>



<a name="253148076"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253148076" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253148076">(Sep 13 2021 at 19:44)</a>:</h4>
<p>It looks like that call has a <code>#[target_feature(enable="sse4.1")]</code> on top of it, so it really smells like something going awry on the LLVM rather than Rust side of things. (If its really the call that's causing problems)</p>



<a name="253160418"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253160418" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> durin42 <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253160418">(Sep 13 2021 at 21:07)</a>:</h4>
<p>My LLVM gurus are asking for a list of compilation commands so I can try and reproduce this further, but I'm not finding the button on x.py to do that. Any guidance? (I'm still digging in parallel)</p>



<a name="253161307"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253161307" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253161307">(Sep 13 2021 at 21:13)</a>:</h4>
<p>Yeah, this is gonna be hard ^^ x.py does a lot of weird stuff. If only we still had <code>--on-fail</code> <span aria-label="frown" class="emoji emoji-1f641" role="img" title="frown">:frown:</span></p>



<a name="253161420"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253161420" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253161420">(Sep 13 2021 at 21:14)</a>:</h4>
<p>Wait, I think Felix did add some sort of a command at some point in the past.</p>



<a name="253161490"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253161490" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253161490">(Sep 13 2021 at 21:14)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/pull/82403">https://github.com/rust-lang/rust/pull/82403</a></p>



<a name="253161632"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253161632" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253161632">(Sep 13 2021 at 21:16)</a>:</h4>
<p>this should make <code>x.py</code> give you sufficient information.</p>



<a name="253162379"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253162379" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> durin42 <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253162379">(Sep 13 2021 at 21:20)</a>:</h4>
<p><code>"/build/rust/build/x86_64-unknown-linux-gnu/stage1/bin/rustc" "--crate-name" "snap" "--edition=2018" "/root/.cargo/registry/src/github.com-1ecc6299db9ec823/snap-1.0.1/src/lib.rs" "--error-format=json" "--json=diagnostic-rendered-ansi,artifacts" "--crate-type" "lib" "--emit=dep-info,metadata,link" "-C" "opt-level=3" "-C" "embed-bitcode=no" "-C" "debuginfo=0" "-C" "metadata=b68732a17f006f26" "-C" "extra-filename=-b68732a17f006f26" "--out-dir" "/build/rust/build/x86_64-unknown-linux-gnu/stage1-rustc/x86_64-unknown-linux-gnu/release/deps" "--target" "x86_64-unknown-linux-gnu" "-C" "linker=/usr/bin/clang-12" "-L" "dependency=/build/rust/build/x86_64-unknown-linux-gnu/stage1-rustc/x86_64-unknown-linux-gnu/release/deps" "-L" "dependency=/build/rust/build/x86_64-unknown-linux-gnu/stage1-rustc/release/deps" "--cap-lints" "allow" "-Zmacro-backtrace" "-Clink-args=-Wl,-rpath,$ORIGIN/../lib" "-Ztls-model=initial-exec" "-Zunstable-options" "-Wrustc::internal" "-Cprefer-dynamic" "-Z" "binary-dep-depinfo" "-Wrust_2018_idioms" "-Wunused_lifetimes" "-Wsemicolon_in_expressions_from_macros" "-Dwarnings" "--sysroot" "/build/rust/build/x86_64-unknown-linux-gnu/stage1" "-Z" "force-unstable-if-unmarked"</code></p>



<a name="253162436"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253162436" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> durin42 <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253162436">(Sep 13 2021 at 21:20)</a>:</h4>
<p>So that's not nothing, I guess? Since it's the stage1 is it plausible I should try and bisect LLVM to have a better sense of what to sniff-test next?</p>



<a name="253167957"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253167957" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253167957">(Sep 13 2021 at 22:04)</a>:</h4>
<p>If I was investigating this, I would grab the <code>snap</code> crate and try to minimize it to a single self-contained reproducer first (using the stage1 compiler)</p>



<a name="253167988"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253167988" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253167988">(Sep 13 2021 at 22:04)</a>:</h4>
<p>though I guess you can work on that in parallel to bisecting LLVM too.</p>



<a name="253278550"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253278550" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> durin42 <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253278550">(Sep 14 2021 at 16:17)</a>:</h4>
<p>Okay, now I feel like I'm taking crazy pills. <code>python3 x.py build compiler/rustc</code> fails, <code>python3 x.py build</code> succeeds. That doesn't make any kind of sense, does it?</p>



<a name="253298621"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253298621" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253298621">(Sep 14 2021 at 18:22)</a>:</h4>
<p>x.py build compiler/rustc only compilers for stage1 a subset of all crates.</p>



<a name="253316469"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253316469" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> durin42 <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253316469">(Sep 14 2021 at 20:13)</a>:</h4>
<p>Seems like we need to patch x.py then?</p>



<a name="253316598"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253316598" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> durin42 <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253316598">(Sep 14 2021 at 20:14)</a>:</h4>
<p>Also, I'm seeing <code>python3 x.py test src/test/run-make src/test/run-make-fulldeps src/test/run-pass-valgrind</code> fail with the same intrinsic selection error. I assume there's some sort of broken dependency or something?</p>



<a name="253318331"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253318331" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Popov <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253318331">(Sep 14 2021 at 20:25)</a>:</h4>
<p>Does that fail while building rustc or running tests?</p>



<a name="253318413"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253318413" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> durin42 <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253318413">(Sep 14 2021 at 20:26)</a>:</h4>
<p><code>Building stage1 compiler artifacts (x86_64-unknown-linux-gnu -&gt; x86_64-unknown-linux-gnu)</code> in that phase</p>



<a name="253318459"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253318459" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Popov <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253318459">(Sep 14 2021 at 20:26)</a>:</h4>
<p>Okay, sounds like the same issue then.</p>



<a name="253318506"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253318506" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Popov <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253318506">(Sep 14 2021 at 20:26)</a>:</h4>
<p>Run the build with <code>-vvv</code> to extract the relevant rustc invocation.</p>



<a name="253318600"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253318600" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Popov <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253318600">(Sep 14 2021 at 20:27)</a>:</h4>
<p>Ah, scroling up I see that you already did that</p>



<a name="253318622"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253318622" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> durin42 <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253318622">(Sep 14 2021 at 20:27)</a>:</h4>
<p>Okay and I can reproduce it outside the docker container now!</p>



<a name="253318690"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253318690" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> durin42 <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253318690">(Sep 14 2021 at 20:28)</a>:</h4>
<p>so I can give you an easy reproduction recipe if you want it</p>



<a name="253347244"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253347244" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> durin42 <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253347244">(Sep 15 2021 at 01:01)</a>:</h4>
<p>oh for crying out loud <a href="https://reviews.llvm.org/D105462">https://reviews.llvm.org/D105462</a></p>



<a name="253347814"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253347814" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253347814">(Sep 15 2021 at 01:08)</a>:</h4>
<p>I have no idea why people keep trying to disable vector register on x64 /biased</p>



<a name="253348149"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253348149" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> durin42 <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253348149">(Sep 15 2021 at 01:13)</a>:</h4>
<p>the committer is from Intel, so I feel like they must know something about CPUs?</p>



<a name="253348213"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253348213" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> durin42 <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253348213">(Sep 15 2021 at 01:14)</a>:</h4>
<p>I guess we need to make sse4.2 imply crc32 somehow?</p>



<a name="253348544"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253348544" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253348544">(Sep 15 2021 at 01:18)</a>:</h4>
<p>Oh, I assume they are doing it properly, I just scratch my head at it.<br>
Though, I suppose it makes sense for kernel code.</p>



<a name="253348571"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253348571" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> durin42 <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253348571">(Sep 15 2021 at 01:19)</a>:</h4>
<p>Any idea where in rustc I should be looking to fix this?</p>



<a name="253348687"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253348687" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253348687">(Sep 15 2021 at 01:20)</a>:</h4>
<p>So, on x86, there is now an additional flag to build with? Hmm.</p>



<a name="253348746"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253348746" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> durin42 <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253348746">(Sep 15 2021 at 01:21)</a>:</h4>
<p>At least by default, I guess?</p>



<a name="253348843"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253348843" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253348843">(Sep 15 2021 at 01:22)</a>:</h4>
<p>Much of the code concerning target features is somewhere hereabouts: <a href="https://github.com/rust-lang/rust/blob/2b8de6f21286d6dbd7dd692af7da7dc6937861d3/compiler/rustc_codegen_ssa/src/target_features.rs">https://github.com/rust-lang/rust/blob/2b8de6f21286d6dbd7dd692af7da7dc6937861d3/compiler/rustc_codegen_ssa/src/target_features.rs</a> and <br>
<a href="https://github.com/rust-lang/rust/tree/ca712bc4255cd0912e00ec2eee5b6a547385c2b0/compiler/rustc_target/src">https://github.com/rust-lang/rust/tree/ca712bc4255cd0912e00ec2eee5b6a547385c2b0/compiler/rustc_target/src</a></p>



<a name="253348932"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253348932" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253348932">(Sep 15 2021 at 01:23)</a>:</h4>
<p>enabling crc32 when sse4.2 is enabled is fairly reasonable.</p>



<a name="253349022"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253349022" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> durin42 <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253349022">(Sep 15 2021 at 01:25)</a>:</h4>
<p>I assume should I add crc32 to X86_ALLOWED_FEATURES?</p>



<a name="253349203"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253349203" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253349203">(Sep 15 2021 at 01:27)</a>:</h4>
<p>Not really. I'm not sure we want to allow crc32 as a standalone feature on our end. And it wouldn't help with the backcompat either way.</p>



<a name="253349286"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253349286" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253349286">(Sep 15 2021 at 01:28)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/blob/master/compiler/rustc_codegen_llvm/src/llvm_util.rs#L159-L189">https://github.com/rust-lang/rust/blob/master/compiler/rustc_codegen_llvm/src/llvm_util.rs#L159-L189</a> seems like it would be an okay place to implement the… ahem… hack(?)..</p>



<a name="253349293"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253349293" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253349293">(Sep 15 2021 at 01:28)</a>:</h4>
<p>but this is currently 1:1 mapping only.</p>



<a name="253349317"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253349317" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253349317">(Sep 15 2021 at 01:29)</a>:</h4>
<p>Ah that's the function I was missing.</p>



<a name="253349320"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253349320" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253349320">(Sep 15 2021 at 01:29)</a>:</h4>
<p>would have to adjust it so that sse4.2 can map to multiple distinct features.</p>



<a name="253349458"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253349458" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253349458">(Sep 15 2021 at 01:30)</a>:</h4>
<p>the warning on top of this function and the fallback case <code>(_, s) =&gt; s</code> makes me wonder if that can be exploited to cause a compiler crash <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="253349798"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253349798" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> durin42 <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253349798">(Sep 15 2021 at 01:35)</a>:</h4>
<p>I could add some sort of implied_features function too? Though making that existing <code>to_llvm_feature</code> return a set of enabled features I guess makes sense.</p>



<a name="253349852"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253349852" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> durin42 <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253349852">(Sep 15 2021 at 01:36)</a>:</h4>
<p>Also looks like we need to gate reporting the crc32 feature on it being LLVM 14, but I assume that's easy enough.</p>



<a name="253349985"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253349985" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253349985">(Sep 15 2021 at 01:38)</a>:</h4>
<p>Until recently we have mostly been just deferring to LLVM handling the implications.</p>



<a name="253349999"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253349999" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253349999">(Sep 15 2021 at 01:38)</a>:</h4>
<p>at least, as far as I can tell.</p>



<a name="253350020"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253350020" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253350020">(Sep 15 2021 at 01:38)</a>:</h4>
<p>Also, we don't report all LLVM features and expose our own names for some of them.</p>



<a name="253350048"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253350048" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> durin42 <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253350048">(Sep 15 2021 at 01:39)</a>:</h4>
<p>From the commit message upstream it sorta sounds like sse4.2 could still imply crc32?</p>



<a name="253350094"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253350094" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253350094">(Sep 15 2021 at 01:39)</a>:</h4>
<p>Yeah, it's fine for sse4.2 to imply crc32 when passed to LLVM.</p>



<a name="253350101"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253350101" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> durin42 <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253350101">(Sep 15 2021 at 01:39)</a>:</h4>
<p>At least, from my very weak understanding that seems to be the case? They wanted to make it possible to use crc32 without sse4.2, not the other way.</p>



<a name="253350156"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253350156" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> durin42 <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253350156">(Sep 15 2021 at 01:40)</a>:</h4>
<p>Okay, maybe I should be sending LLVM folks a patch then?</p>



<a name="253350323"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253350323" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253350323">(Sep 15 2021 at 01:42)</a>:</h4>
<p>I don't think I understand the LLVM patch rn, doesn't it do that?</p>



<a name="253350544"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253350544" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> durin42 <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253350544">(Sep 15 2021 at 01:46)</a>:</h4>
<p>it must not if we're getting this error, no?</p>



<a name="253350737"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253350737" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253350737">(Sep 15 2021 at 01:48)</a>:</h4>
<p><a href="https://godbolt.org/z/9Y7hv4TKa">https://godbolt.org/z/9Y7hv4TKa</a> well this compiles?</p>



<a name="253350778"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253350778" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253350778">(Sep 15 2021 at 01:49)</a>:</h4>
<p>The clang parts of the patch explicitly allows using sse4.2 with crc32 disabled however useless that is.</p>



<a name="253350830"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253350830" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253350830">(Sep 15 2021 at 01:49)</a>:</h4>
<p>There's a code comment calling that usecase out too.</p>



<a name="253350910"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253350910" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253350910">(Sep 15 2021 at 01:50)</a>:</h4>
<p>yeah.</p>



<a name="253351067"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253351067" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253351067">(Sep 15 2021 at 01:53)</a>:</h4>
<p>Ah so that's what I was confused about then:<br>
clang handles passing in the crc32 feature?<br>
Okay, yeah, then we have to, too. <span aria-label="shrug" class="emoji emoji-1f937" role="img" title="shrug">:shrug:</span></p>



<a name="253351169"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253351169" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> durin42 <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253351169">(Sep 15 2021 at 01:54)</a>:</h4>
<p>Yeah, clang handles it explicitly. I don't see the bit that lets you do sse4.2 without crc32 in clang? So I guess we're back to making that function return a list instead of a single string?</p>



<a name="253351217"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253351217" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253351217">(Sep 15 2021 at 01:55)</a>:</h4>
<p>yup</p>



<a name="253351479"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253351479" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253351479">(Sep 15 2021 at 01:59)</a>:</h4>
<p>And we have to make sure that it only does so if we know it's LLVM 14 or greater</p>



<a name="253351653"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253351653" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253351653">(Sep 15 2021 at 02:00)</a>:</h4>
<p>I mean I would also probably submit a patch to LLVM if it were me, because it seems like pointless breakage, but I would also expect to lose that debate <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="253352261"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253352261" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> durin42 <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253352261">(Sep 15 2021 at 02:08)</a>:</h4>
<p>Yeah, I'll try and flag down an LLVM expert tomorrow from $WORK and see what their advice is on the LLVM side</p>



<a name="253378344"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253378344" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253378344">(Sep 15 2021 at 08:19)</a>:</h4>
<p>I was referencing <a href="https://reviews.llvm.org/source/llvm-github/browse/main/clang/lib/Basic/Targets/X86.cpp$158">https://reviews.llvm.org/source/llvm-github/browse/main/clang/lib/Basic/Targets/X86.cpp$158</a></p>



<a name="253378453"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253378453" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253378453">(Sep 15 2021 at 08:20)</a>:</h4>
<p>LLVM making some ill considered changes and then backpedaling on them is not all that rare.</p>



<a name="253378509"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253378509" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253378509">(Sep 15 2021 at 08:21)</a>:</h4>
<p>But yeah LLVM is not super strict with regards to the backwards compatibility. When you have a couple hundred-or-so users (rather than a millions), its way easier to justify it.</p>



<a name="253414558"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253414558" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> durin42 <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253414558">(Sep 15 2021 at 13:38)</a>:</h4>
<p>Ah fascinating. Yeah, sse4.2 implies crc32, but you can still force it off. That seems silly to me...</p>



<a name="253422231"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253422231" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> durin42 <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253422231">(Sep 15 2021 at 14:22)</a>:</h4>
<p>So, to make sure I understood (and that it would work) I tried writing <a href="https://github.com/durin42/rust/commit/400bf0fd8d94a91a718f90fff91f4185f002bf2c">https://github.com/durin42/rust/commit/400bf0fd8d94a91a718f90fff91f4185f002bf2c</a>, and it's not actually allowing the <code>snap</code> crate to compile. Is there anything obviously wrong with that patch?</p>



<a name="253423043"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253423043" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253423043">(Sep 15 2021 at 14:27)</a>:</h4>
<p>That will only apply when a function specifies specific features, but not when these features are specified via a compiler flag.</p>



<a name="253423075"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253423075" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253423075">(Sep 15 2021 at 14:27)</a>:</h4>
<p>so it should work for <code>#[target_feature(enable...)]</code> hmmm...</p>



<a name="253423148"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253423148" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253423148">(Sep 15 2021 at 14:27)</a>:</h4>
<p>Ah, you're missing the preceding <code>+</code> sign for enable.</p>



<a name="253423271"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253423271" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253423271">(Sep 15 2021 at 14:28)</a>:</h4>
<p>llvm just silently ignores features names it knows of but that don't start with a + or - because it has two different places where it validates these things <span aria-label="shrug" class="emoji emoji-1f937" role="img" title="shrug">:shrug:</span></p>



<a name="253424424"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253424424" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> durin42 <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253424424">(Sep 15 2021 at 14:34)</a>:</h4>
<p>oh for crying out loud</p>



<a name="253424763"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253424763" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> durin42 <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253424763">(Sep 15 2021 at 14:36)</a>:</h4>
<p>So I can be dirty and poke it in there, or I can make to_llvm_feature return a Vec&lt;String&gt;. Any preference?</p>



<a name="253425642"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253425642" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253425642">(Sep 15 2021 at 14:42)</a>:</h4>
<p>well the dirty hack will solve the immediate issue, but probably not, like I mentioned, the case where <code>-Ctarget-feature=+sse4.2</code> is specified.</p>



<a name="253425747"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253425747" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253425747">(Sep 15 2021 at 14:42)</a>:</h4>
<p><code>to_llvm_feature</code> can probably return a <code>&amp;'static [&amp;'static str]</code>, I think.</p>



<a name="253426868"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253426868" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> durin42 <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253426868">(Sep 15 2021 at 14:49)</a>:</h4>
<p>Do we have any tests around -Ctarget-feature that I could cargo-cult from to add a test for that? Seems like we should probably have a test.</p>



<a name="253427634"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253427634" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> durin42 <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253427634">(Sep 15 2021 at 14:54)</a>:</h4>
<p>looks like <code>src/test/codegen/target-feature-overrides.rs</code> might be the thing to try and copy from</p>



<a name="253431040"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253431040" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> durin42 <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253431040">(Sep 15 2021 at 15:13)</a>:</h4>
<p><a href="https://github.com/durin42/rust/commit/28ce260263f95a51909c2589a6dffa445561ff57#diff-3f7853de8eb4803e88e699841c99812f30b75c92fa5b6fd2080141699e5aa6a7">here's a test I've written</a> for the <code>#[target_feature(enable = "sse4.2")]</code> case. Still not quite sure how I should (or if?) I should have a matching test for the <code>-Ctarget-feature</code> compiler flag flavor. Let me know?</p>
<p>I'm going to rework the change now to make <code>to_llvm_feature</code> return a list and see how that goes.</p>



<a name="253433176"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253433176" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253433176">(Sep 15 2021 at 15:26)</a>:</h4>
<p>just check that it builds with the flag but without attribute or write an assembly test.</p>



<a name="253450232"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253450232" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> durin42 <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253450232">(Sep 15 2021 at 17:00)</a>:</h4>
<p>Do you have any examples of how I should do that check? I think other than tests I might be good to go.</p>



<a name="253454506"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253454506" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253454506">(Sep 15 2021 at 17:24)</a>:</h4>
<p>like idk, an assembly test could look like this:</p>
<div class="codehilite"><pre><span></span><code>// compile-flags: --emit=asm -Ctarget-feature=+sse4.2

CHECK-LABEL: banana
CHECK: crc32
fn banana() {
    _mm_crc32_thing_or_whatever_its_called()
}
</code></pre></div>



<a name="253454564"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253454564" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253454564">(Sep 15 2021 at 17:25)</a>:</h4>
<p>slap on some <code>//only-x86</code> on there, perhaps also fix whatever typos I made in there and it should be good? Especially if you're careful about not including <code>crc32</code> in the test name. It'd go into <code>src/test/assembly</code></p>



<a name="253457347"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253457347" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> durin42 <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253457347">(Sep 15 2021 at 17:43)</a>:</h4>
<p>Alrighty, let me see if I can set that up so it fails without my patch first. :)</p>



<a name="253459531"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253459531" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> durin42 <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253459531">(Sep 15 2021 at 17:57)</a>:</h4>
<p>So I've got</p>
<div class="codehilite"><pre><span></span><code>// assembly-output: emit-asm
// compile-flags: --crate-type staticlib -Ctarget-feature=+sse4.2
// needs-llvm-components: x86

// CHECK-LABEL: banana
// CHECK: crc32
#[no_mangle]
pub unsafe fn banana(v: u8) -&gt; u32 {
    use std::arch::x86_64::*;
    let mut out = !0u32;
    _mm_crc32_u8(out, v);
    out
}
</code></pre></div>
<p>but it fails with no match (this is without my change), and the resulting asm is</p>
<div class="codehilite"><pre><span></span><code>    .text
    .file   &quot;x86_64_sse_crc.bced63b9-cgu.0&quot;
    .section    .text.banana,&quot;ax&quot;,@progbits
    .globl  banana
    .p2align    4, 0x90
    .type   banana,@function
banana:
    .cfi_startproc
    movl    $-1, %eax
    retq
.Lfunc_end0:
    .size   banana, .Lfunc_end0-banana
    .cfi_endproc

    .section    &quot;.note.GNU-stack&quot;,&quot;&quot;,@progbits
</code></pre></div>



<a name="253477040"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253477040" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253477040">(Sep 15 2021 at 19:53)</a>:</h4>
<p>that's… interesting and weird too.</p>



<a name="253477065"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253477065" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253477065">(Sep 15 2021 at 19:54)</a>:</h4>
<p>Ah, I think it might be const-evaluating the CRC perhaps?</p>



<a name="253477141"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253477141" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253477141">(Sep 15 2021 at 19:54)</a>:</h4>
<p>No, that can't be it, <code>v</code> is an argument.</p>



<a name="253524897"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253524897" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> erikdesjardins <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253524897">(Sep 16 2021 at 03:50)</a>:</h4>
<p>i imagine you've already figured it out but<br>
<code>_mm_crc32_u8</code> returns the crc, so you want something like</p>
<div class="codehilite"><pre><span></span><code>pub unsafe fn banana(v: u8) -&gt; u32 {
    use std::arch::x86_64::*;
    let init = !0u32;
    _mm_crc32_u8(init, v)
}
</code></pre></div>



<a name="253604603"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253604603" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> durin42 <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253604603">(Sep 16 2021 at 15:56)</a>:</h4>
<p>I had not! That explains a ton. Thanks!</p>



<a name="253616237"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253616237" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> durin42 <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253616237">(Sep 16 2021 at 17:11)</a>:</h4>
<p><span class="user-mention" data-user-id="123586">@nagisa</span> should I squash now, or wait for the perf run to finish first?</p>



<a name="253619061"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253619061" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253619061">(Sep 16 2021 at 17:31)</a>:</h4>
<p>I think the perf run will get cancelled if you squash and force push before its complete.</p>



<a name="253619088"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253619088" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253619088">(Sep 16 2021 at 17:31)</a>:</h4>
<p>not entirely sure though.</p>



<a name="253619286"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253619286" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> durin42 <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253619286">(Sep 16 2021 at 17:32)</a>:</h4>
<p>Okay, I'll hold off, I was afraid that kind of thing might happen</p>



<a name="253619384"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253619384" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253619384">(Sep 16 2021 at 17:33)</a>:</h4>
<p>I think that is only the case for the bors try run. I think as soon as the try run completes and rust-timer posts a comment about the perf run being queued it is fine to push.</p>



<a name="253619409"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/LLVM%20HEAD%3A%20Cannot%20select%3A%20intrinsic%20%25llvm.x86.sse42.crc32.32/near/253619409" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/LLVM.20HEAD.3A.20Cannot.20select.3A.20intrinsic.20.25llvm.2Ex86.2Esse42.2Ecrc32.2E32.html#253619409">(Sep 16 2021 at 17:33)</a>:</h4>
<p>Not quite sure though.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>