<html>
<head><meta charset="utf-8"><title>Compile time blowup associated with asan? · t-compiler/wg-llvm · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/index.html">t-compiler/wg-llvm</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/Compile.20time.20blowup.20associated.20with.20asan.3F.html">Compile time blowup associated with asan?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="262968197"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/Compile%20time%20blowup%20associated%20with%20asan%3F/near/262968197" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> (Saethlin) Ben Kimock <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/Compile.20time.20blowup.20associated.20with.20asan.3F.html#262968197">(Nov 29 2021 at 05:20)</a>:</h4>
<p>Is anyone aware of a massive compile time increase associated with -Zsanitizer=address? I and a few others have noticed that when building crates for fuzzing that contain the crate curve25519-dalek in their dependency tree, curve25519-dalek's compile time explodes (16s -&gt; 570s) when asan is added among all the other flags that cargo-fuzz passes. It's hard for me (a non-expert) to tell if this is a bug or if asan doing its thing just generates an enormous number of basic blocks in this particular crate. I'm attaching the output of building an empty fuzz target in curve25519-dalek with <code>RUSTFLAGS="-Ztime-passes -Cllvm-args=--debug-pass=Details" cargo +stage1 fuzz run fuzz_target_1</code> (my stage1 is just with debug info). I'm attaching as xz because it's too large for zulip with gzip. <a href="/user_uploads/4715/3BvlShU6jFIEntUsU4qYgbdW/passes.xz">passes.xz</a></p>



<a name="262975683"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/Compile%20time%20blowup%20associated%20with%20asan%3F/near/262975683" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matthiaskrgr <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/Compile.20time.20blowup.20associated.20with.20asan.3F.html#262975683">(Nov 29 2021 at 07:56)</a>:</h4>
<p>well, asan includes tons of extra checks in your code that the optimizer has to churn through, so im not really surprised.<br>
Asan + debuginfo + O3 + lto can easily blow up compiletimes.</p>



<a name="263017954"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187780-t-compiler/wg-llvm/topic/Compile%20time%20blowup%20associated%20with%20asan%3F/near/263017954" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> (Saethlin) Ben Kimock <a href="https://zulip-archive.rust-lang.org/stream/187780-t-compiler/wg-llvm/topic/Compile.20time.20blowup.20associated.20with.20asan.3F.html#263017954">(Nov 29 2021 at 14:51)</a>:</h4>
<p>You're not wrong, but it feels like 35x is a bit rich. I've never seen another crate's compile time grow like this due to the collection of fuzzing flags + asan</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>