<html>
<head><meta charset="utf-8"><title>Using -Zprint-type-sizes in the compiler · t-compiler/performance · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/index.html">t-compiler/performance</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Using.20-Zprint-type-sizes.20in.20the.20compiler.html">Using -Zprint-type-sizes in the compiler</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="260887424"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Using%20-Zprint-type-sizes%20in%20the%20compiler/near/260887424" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Using.20-Zprint-type-sizes.20in.20the.20compiler.html#260887424">(Nov 10 2021 at 01:17)</a>:</h4>
<p>The bottom part of <a href="https://blog.mozilla.org/nnethercote/2018/11/09/how-to-get-the-size-of-rust-types-with-zprint-type-sizes/">https://blog.mozilla.org/nnethercote/2018/11/09/how-to-get-the-size-of-rust-types-with-zprint-type-sizes/</a> describes how to print the sizes of types within the compiler. I last tried it a year or so ago, but it's no longer working</p>



<a name="260887438"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Using%20-Zprint-type-sizes%20in%20the%20compiler/near/260887438" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Using.20-Zprint-type-sizes.20in.20the.20compiler.html#260887438">(Nov 10 2021 at 01:17)</a>:</h4>
<div class="codehilite"><pre><span></span><code>[gulf:~/dev/rust2] RUSTC_BOOTSTRAP=1 $RUSTC0 -Zprint-type-sizes b.rs
error[E0463]: can&#39;t find crate for `rustc_middle`
 --&gt; b.rs:4:1
  |
4 | extern crate rustc_middle;
  | ^^^^^^^^^^^^^^^^^^^^^^^^^^ can&#39;t find crate
  |
  = help: maybe you need to install the missing components with: `rustup component add rust-src rustc-dev llvm-tools-preview`

error: aborting due to previous error
</code></pre></div>



<a name="260887494"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Using%20-Zprint-type-sizes%20in%20the%20compiler/near/260887494" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Using.20-Zprint-type-sizes.20in.20the.20compiler.html#260887494">(Nov 10 2021 at 01:18)</a>:</h4>
<p>I tried running the suggested <code>rustup</code> command but it didn't help.</p>



<a name="260887996"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Using%20-Zprint-type-sizes%20in%20the%20compiler/near/260887996" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Using.20-Zprint-type-sizes.20in.20the.20compiler.html#260887996">(Nov 10 2021 at 01:26)</a>:</h4>
<p>Hm - are you using a stage1/bin/rustc with that command?</p>



<a name="260888016"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Using%20-Zprint-type-sizes%20in%20the%20compiler/near/260888016" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Using.20-Zprint-type-sizes.20in.20the.20compiler.html#260888016">(Nov 10 2021 at 01:26)</a>:</h4>
<p>ah, yes!  I used to use a stage2</p>



<a name="260888027"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Using%20-Zprint-type-sizes%20in%20the%20compiler/near/260888027" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Using.20-Zprint-type-sizes.20in.20the.20compiler.html#260888027">(Nov 10 2021 at 01:26)</a>:</h4>
<p>You would need to do x.py build with compiler/rustc to get what you want here, since you need the compiler libraries</p>



<a name="260888083"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Using%20-Zprint-type-sizes%20in%20the%20compiler/near/260888083" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Using.20-Zprint-type-sizes.20in.20the.20compiler.html#260888083">(Nov 10 2021 at 01:27)</a>:</h4>
<p>(either stage 1 or stage 2 will work, but once you've built the second compiler you basically already have the stage 2 compiler)</p>



<a name="260889890"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Using%20-Zprint-type-sizes%20in%20the%20compiler/near/260889890" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Using.20-Zprint-type-sizes.20in.20the.20compiler.html#260889890">(Nov 10 2021 at 01:53)</a>:</h4>
<p><code>./x.py build --stage 1 compiler/rustc</code> gives me a compiler that says this:</p>
<div class="codehilite"><pre><span></span><code>error[E0463]: can&#39;t find crate for `std`
</code></pre></div>



<a name="260889979"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Using%20-Zprint-type-sizes%20in%20the%20compiler/near/260889979" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Using.20-Zprint-type-sizes.20in.20the.20compiler.html#260889979">(Nov 10 2021 at 01:54)</a>:</h4>
<p>Hmm, <code>./x.py build --stage 2 compiler/rustc</code> works</p>



<a name="260889992"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Using%20-Zprint-type-sizes%20in%20the%20compiler/near/260889992" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Using.20-Zprint-type-sizes.20in.20the.20compiler.html#260889992">(Nov 10 2021 at 01:54)</a>:</h4>
<p>And the BOOTSTRAP thing works again, yay</p>



<a name="260891300"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Using%20-Zprint-type-sizes%20in%20the%20compiler/near/260891300" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Using.20-Zprint-type-sizes.20in.20the.20compiler.html#260891300">(Nov 10 2021 at 02:18)</a>:</h4>
<p>Huh. I would expect the first thing to work - is that running stage1/bin/rustc where the error comes from?</p>



<a name="260891356"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Using%20-Zprint-type-sizes%20in%20the%20compiler/near/260891356" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Using.20-Zprint-type-sizes.20in.20the.20compiler.html#260891356">(Nov 10 2021 at 02:19)</a>:</h4>
<p>stage2/bin/rustc may exist after the stage 1 command but probably won't fully work. The second command should be fine though.</p>



<a name="260914653"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Using%20-Zprint-type-sizes%20in%20the%20compiler/near/260914653" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Using.20-Zprint-type-sizes.20in.20the.20compiler.html#260914653">(Nov 10 2021 at 02:41)</a>:</h4>
<p><code>./x.py build --stage 2 library/test</code> also works</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>