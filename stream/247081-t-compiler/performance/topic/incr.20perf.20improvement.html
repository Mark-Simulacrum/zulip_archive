<html>
<head><meta charset="utf-8"><title>incr perf improvement · t-compiler/performance · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rust-lang.github.io/zulip_archive/stream/247081-t-compiler/performance/index.html">t-compiler/performance</a></h2>
<h3>Topic: <a href="https://rust-lang.github.io/zulip_archive/stream/247081-t-compiler/performance/topic/incr.20perf.20improvement.html">incr perf improvement</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://rust-lang.github.io/zulip_archive/style.css" rel="stylesheet"></head>

<a name="205074307"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/incr%20perf%20improvement/near/205074307" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/247081-t-compiler/performance/topic/incr.20perf.20improvement.html#205074307">(Jul 27 2020 at 00:48)</a>:</h4>
<p><span class="user-mention" data-user-id="120989">@njn</span> FYI, it looks like <a href="https://github.com/rust-lang/rustc-perf/pull/717">https://github.com/rust-lang/rustc-perf/pull/717</a> had the unintended side-effect of being a big incremental performance improvement, e.g., see the green on <a href="https://perf.rust-lang.org/compare.html?start=62392966a3937362146d7228444c8d843d972857&amp;end=6d6de91382400102c81ff15aa825b3bf9bb04396">https://perf.rust-lang.org/compare.html?start=62392966a3937362146d7228444c8d843d972857&amp;end=6d6de91382400102c81ff15aa825b3bf9bb04396</a></p>



<a name="205074311"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/incr%20perf%20improvement/near/205074311" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/247081-t-compiler/performance/topic/incr.20perf.20improvement.html#205074311">(Jul 27 2020 at 00:48)</a>:</h4>
<p>I personally suspect that's because previously cargo or rustc was ignoring the incremental cache because a dependency was being rebuilt or something like that</p>



<a name="205074312"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/incr%20perf%20improvement/near/205074312" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/247081-t-compiler/performance/topic/incr.20perf.20improvement.html#205074312">(Jul 27 2020 at 00:48)</a>:</h4>
<p>I'll need to investigate</p>



<a name="205074379"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/incr%20perf%20improvement/near/205074379" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://rust-lang.github.io/zulip_archive/stream/247081-t-compiler/performance/topic/incr.20perf.20improvement.html#205074379">(Jul 27 2020 at 00:50)</a>:</h4>
<p>A big improvement on style-servo but a regression on everything else?!</p>



<a name="205074380"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/incr%20perf%20improvement/near/205074380" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/247081-t-compiler/performance/topic/incr.20perf.20improvement.html#205074380">(Jul 27 2020 at 00:50)</a>:</h4>
<p>that's a try build</p>



<a name="205074382"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/incr%20perf%20improvement/near/205074382" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/247081-t-compiler/performance/topic/incr.20perf.20improvement.html#205074382">(Jul 27 2020 at 00:51)</a>:</h4>
<p>the regression is expected, and not related</p>



<a name="205074388"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/incr%20perf%20improvement/near/205074388" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/247081-t-compiler/performance/topic/incr.20perf.20improvement.html#205074388">(Jul 27 2020 at 00:51)</a>:</h4>
<p>see discussion on <a href="https://github.com/rust-lang/rust/pull/74726">https://github.com/rust-lang/rust/pull/74726</a></p>



<a name="205074389"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/incr%20perf%20improvement/near/205074389" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/247081-t-compiler/performance/topic/incr.20perf.20improvement.html#205074389">(Jul 27 2020 at 00:51)</a>:</h4>
<p>(sorry, should've said so)</p>



<a name="205089254"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/incr%20perf%20improvement/near/205089254" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mati865 <a href="https://rust-lang.github.io/zulip_archive/stream/247081-t-compiler/performance/topic/incr.20perf.20improvement.html#205089254">(Jul 27 2020 at 07:48)</a>:</h4>
<p>So this is unintended improvement too <a href="https://perf.rust-lang.org/compare.html?start=62392966a3937362146d7228444c8d843d972857&amp;end=6c8927b0cf80ceee19386026cf9d7fd4fd9d486f&amp;stat=instructions:u">https://perf.rust-lang.org/compare.html?start=62392966a3937362146d7228444c8d843d972857&amp;end=6c8927b0cf80ceee19386026cf9d7fd4fd9d486f&amp;stat=instructions:u</a></p>



<a name="205089278"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/incr%20perf%20improvement/near/205089278" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mati865 <a href="https://rust-lang.github.io/zulip_archive/stream/247081-t-compiler/performance/topic/incr.20perf.20improvement.html#205089278">(Jul 27 2020 at 07:48)</a>:</h4>
<p>That PR touched only Clippy which is not even ran on perf.rlo</p>



<a name="205106995"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/incr%20perf%20improvement/near/205106995" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/247081-t-compiler/performance/topic/incr.20perf.20improvement.html#205106995">(Jul 27 2020 at 11:48)</a>:</h4>
<p>Yes, I believe so. Good that it's a clippy PR actually</p>



<a name="205124974"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/incr%20perf%20improvement/near/205124974" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/247081-t-compiler/performance/topic/incr.20perf.20improvement.html#205124974">(Jul 27 2020 at 14:38)</a>:</h4>
<p>okay I can reproduce this locally with style-servo, reverting just <a href="https://github.com/rust-lang/rust/commit/0fe5046e47846f264a48875f06b840985f251723">0fe5046e47846f264a48875f06b840985f251723</a> and <a href="https://github.com/rust-lang/rust/commit/0e774e5b5bc527af45cde0a4ca690ebf895bf02f">0e774e5b5bc527af45cde0a4ca690ebf895bf02f</a> which are build script rerun edits</p>



<a name="205128097"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/incr%20perf%20improvement/near/205128097" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/247081-t-compiler/performance/topic/incr.20perf.20improvement.html#205128097">(Jul 27 2020 at 15:01)</a>:</h4>
<p>okay, investigation determines that <a href="https://github.com/rust-lang/rustc-perf/commit/0e774e5b5bc527af45cde0a4ca690ebf895bf02f">https://github.com/rust-lang/rustc-perf/commit/0e774e5b5bc527af45cde0a4ca690ebf895bf02f</a> is the cause of the incremental improvement in style-servo, and I'm going to leave it there</p>



<a name="205128531"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/incr%20perf%20improvement/near/205128531" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/247081-t-compiler/performance/topic/incr.20perf.20improvement.html#205128531">(Jul 27 2020 at 15:04)</a>:</h4>
<p>well, actually, that feels perhaps wrong</p>



<a name="205128555"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/incr%20perf%20improvement/near/205128555" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/247081-t-compiler/performance/topic/incr.20perf.20improvement.html#205128555">(Jul 27 2020 at 15:04)</a>:</h4>
<p>in the sense that we're not matching upstream rebuilds on this?</p>



<a name="205128578"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/incr%20perf%20improvement/near/205128578" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/247081-t-compiler/performance/topic/incr.20perf.20improvement.html#205128578">(Jul 27 2020 at 15:05)</a>:</h4>
<p>I'm going to try and determine <em>why</em> rerunning the build script is so bad</p>



<a name="205132538"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/incr%20perf%20improvement/near/205132538" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mati865 <a href="https://rust-lang.github.io/zulip_archive/stream/247081-t-compiler/performance/topic/incr.20perf.20improvement.html#205132538">(Jul 27 2020 at 15:35)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116122">simulacrum</span> <a href="#narrow/stream/247081-t-compiler.2Fperformance/topic/incr.20perf.20improvement/near/205106995">said</a>:</p>
<blockquote>
<p>Yes, I believe so. Good that it's a clippy PR actually</p>
</blockquote>
<p>We were lucky <span aria-label="grinning face with smiling eyes" class="emoji emoji-1f601" role="img" title="grinning face with smiling eyes">:grinning_face_with_smiling_eyes:</span></p>



<a name="205133961"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/incr%20perf%20improvement/near/205133961" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/247081-t-compiler/performance/topic/incr.20perf.20improvement.html#205133961">(Jul 27 2020 at 15:48)</a>:</h4>
<p>ah okay, so not rerunning the build script means we're not patching anything at all</p>



<a name="205133966"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/incr%20perf%20improvement/near/205133966" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/247081-t-compiler/performance/topic/incr.20perf.20improvement.html#205133966">(Jul 27 2020 at 15:48)</a>:</h4>
<p>which I guess makes sense</p>



<a name="205134022"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/incr%20perf%20improvement/near/205134022" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/247081-t-compiler/performance/topic/incr.20perf.20improvement.html#205134022">(Jul 27 2020 at 15:49)</a>:</h4>
<p>I'm going to move the println! patch to a different file. We'll probably want to rebuild all the stable artifacts as well, since style-servo is a stable benchmark, but that shouldn't be a problem</p>



<a name="205134097"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/incr%20perf%20improvement/near/205134097" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/247081-t-compiler/performance/topic/incr.20perf.20improvement.html#205134097">(Jul 27 2020 at 15:49)</a>:</h4>
<p>IMO testing println! addition to a template file is not really what println! benches are about</p>



<a name="205141121"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/incr%20perf%20improvement/near/205141121" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Félix Fischer <a href="https://rust-lang.github.io/zulip_archive/stream/247081-t-compiler/performance/topic/incr.20perf.20improvement.html#205141121">(Jul 27 2020 at 16:50)</a>:</h4>
<p>That makes sense</p>



<a name="205141172"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/incr%20perf%20improvement/near/205141172" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Félix Fischer <a href="https://rust-lang.github.io/zulip_archive/stream/247081-t-compiler/performance/topic/incr.20perf.20improvement.html#205141172">(Jul 27 2020 at 16:51)</a>:</h4>
<p>Template files are compiled more than once, right?</p>



<a name="205141286"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/incr%20perf%20improvement/near/205141286" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Félix Fischer <a href="https://rust-lang.github.io/zulip_archive/stream/247081-t-compiler/performance/topic/incr.20perf.20improvement.html#205141286">(Jul 27 2020 at 16:52)</a>:</h4>
<p>Ideally I'd want println! benches to be an easy to add, minimal</p>



<a name="205141298"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/incr%20perf%20improvement/near/205141298" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Félix Fischer <a href="https://rust-lang.github.io/zulip_archive/stream/247081-t-compiler/performance/topic/incr.20perf.20improvement.html#205141298">(Jul 27 2020 at 16:52)</a>:</h4>
<p>-ish</p>



<a name="205141314"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/incr%20perf%20improvement/near/205141314" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Félix Fischer <a href="https://rust-lang.github.io/zulip_archive/stream/247081-t-compiler/performance/topic/incr.20perf.20improvement.html#205141314">(Jul 27 2020 at 16:52)</a>:</h4>
<p>incremental compilation test</p>



<a name="205144717"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/incr%20perf%20improvement/near/205144717" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/247081-t-compiler/performance/topic/incr.20perf.20improvement.html#205144717">(Jul 27 2020 at 17:22)</a>:</h4>
<p>Well they're not actually a rustc thing</p>



<a name="205161375"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/incr%20perf%20improvement/near/205161375" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Félix Fischer <a href="https://rust-lang.github.io/zulip_archive/stream/247081-t-compiler/performance/topic/incr.20perf.20improvement.html#205161375">(Jul 27 2020 at 19:59)</a>:</h4>
<p>Ohh</p>



<hr><p>Last updated: Aug 07 2021 at 22:04 UTC</p>
</html>