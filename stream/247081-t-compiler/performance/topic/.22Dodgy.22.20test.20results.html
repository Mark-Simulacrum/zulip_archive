<html>
<head><meta charset="utf-8"><title>&quot;Dodgy&quot; test results · t-compiler/performance · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/index.html">t-compiler/performance</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/.22Dodgy.22.20test.20results.html">&quot;Dodgy&quot; test results</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="277390748"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/%22Dodgy%22%20test%20results/near/277390748" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rylev <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/.22Dodgy.22.20test.20results.html#277390748">(Apr 01 2022 at 09:28)</a>:</h4>
<p>We currently indicate a "dodgy" test result by putting a "?" next to the percent change. A "dodgy" test result is generally meant to indicate that these test results are less reliable than other test results because they historically have much more variance. A couple of thoughts:</p>
<ul>
<li>Does anyone actually pay attention to the "?" - I know I have stopped really giving much thought to it. It's very easy to ignore.</li>
<li>Dodginess is defined as having a significance threshold over 0.2%. Is this a good definition? (note: significance threshold itself is defined as the q3 fence over the past 100 results of the benchmark - i.e., q3 + (q3 - q1) * IQR_MULTIPLIER where IQR_MULTIPLIER is currently 3) </li>
<li>Currently 54% of test cases are marked as dodgy.</li>
</ul>
<p>Some questions then;</p>
<ul>
<li>Should we make "dodginess" more apparent?</li>
<li>Should we change the definition of dodginess? If so, how? A high significance threshold indicates high variance but perhaps we should be more direct about measuring variance. Also, our data is just naturally a bit variable. Perhaps we need to be more lenient with what we consider too variable.</li>
</ul>



<a name="277402710"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/%22Dodgy%22%20test%20results/near/277402710" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/.22Dodgy.22.20test.20results.html#277402710">(Apr 01 2022 at 11:29)</a>:</h4>
<p>I think we should drop dodginess entirely from the comparison UI and probably have a separate view on the graphs page (or perhaps detailed-query pages can show this / another column on comparison) that actually just gives the user the %chg boundaries, potentially as a small box-and-whisker plot or so</p>



<a name="277464104"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/%22Dodgy%22%20test%20results/near/277464104" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Kimock (Saethlin) <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/.22Dodgy.22.20test.20results.html#277464104">(Apr 01 2022 at 18:56)</a>:</h4>
<p>What does "historically" mean? I've been running the system locally and I get much higher significance factors and no ?s. If the ? requires some extra state, that would make sense.</p>



<a name="277480390"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/%22Dodgy%22%20test%20results/near/277480390" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/.22Dodgy.22.20test.20results.html#277480390">(Apr 01 2022 at 21:32)</a>:</h4>
<p>I have learned to ignore the "?" because so many results have it. I've never quite understood the difference between "dodgy" and "not significant". It feels like there should be a single measure indicating if a particular measurement is worth paying attention to.</p>



<a name="277517150"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/%22Dodgy%22%20test%20results/near/277517150" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/.22Dodgy.22.20test.20results.html#277517150">(Apr 02 2022 at 09:03)</a>:</h4>
<p>The ? predates the significance logic iirc</p>



<a name="277523349"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/%22Dodgy%22%20test%20results/near/277523349" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/.22Dodgy.22.20test.20results.html#277523349">(Apr 02 2022 at 11:17)</a>:</h4>
<p>I originally marked one or two benchmarks with ? because they had high variance. That was before all the significance and relevance (a third categorizations of results!) stuff was added, and it's been changed a lot over time.</p>



<a name="277694585"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/%22Dodgy%22%20test%20results/near/277694585" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rylev <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/.22Dodgy.22.20test.20results.html#277694585">(Apr 04 2022 at 07:59)</a>:</h4>
<p><span class="user-mention silent" data-user-id="120827">Ben Kimock (Saethlin)</span> <a href="#narrow/stream/247081-t-compiler.2Fperformance/topic/.22Dodgy.22.20test.20results/near/277464104">said</a>:</p>
<blockquote>
<p>What does "historically" mean? I've been running the system locally and I get much higher significance factors and no ?s. If the ? requires some extra state, that would make sense.</p>
</blockquote>
<p>"Historically" means the last 50-100 changes for a given test case (benchmark, profile, scenario trio). We look at those historical changes and determine if the variance looks high. This is done by looking at the significance threshold for a test case. This significance threshold is the threshold at which we declare whether a particular test case result is <em>actually</em> a real performance change or rather just noise. The significance threshold is computed using <a href="https://www.statisticshowto.com/upper-and-lower-fences/#:~:text=Upper%20and%20lower%20fences%20cordon,%E2%80%93%20(1.5%20*%20IQR).">the upper IQR fence</a> of the historical data. A dodgy test case (i.e., a test case with a "?") is that which has an upper IQR fence greater than 0.2% - i.e., changes must be above 0.2% to be considered real.</p>



<a name="277694807"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/%22Dodgy%22%20test%20results/near/277694807" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rylev <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/.22Dodgy.22.20test.20results.html#277694807">(Apr 04 2022 at 08:00)</a>:</h4>
<p>Terms like these should be documented in the <a href="https://github.com/rust-lang/rustc-perf/blob/master/docs/glossary.md">glossary</a>. <a href="https://github.com/rust-lang/rustc-perf/pull/1266">#1266</a> has some changes to the glossary.</p>



<a name="277694864"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/%22Dodgy%22%20test%20results/near/277694864" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rylev <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/.22Dodgy.22.20test.20results.html#277694864">(Apr 04 2022 at 08:01)</a>:</h4>
<p><a href="https://github.com/rust-lang/rustc-perf/pull/1270">#1270</a> seems to also be discussing some of this terminology as well.</p>



<a name="277705327"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/%22Dodgy%22%20test%20results/near/277705327" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rylev <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/.22Dodgy.22.20test.20results.html#277705327">(Apr 04 2022 at 09:32)</a>:</h4>
<p>My hope is that the changes in <a href="https://github.com/rust-lang/rustc-perf/pull/1266">#1266</a> (now merged) and in <a href="https://github.com/rust-lang/rustc-perf/pull/1271">#1271</a> help clarify all of this even more.</p>



<a name="277713042"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/%22Dodgy%22%20test%20results/near/277713042" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pachi <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/.22Dodgy.22.20test.20results.html#277713042">(Apr 04 2022 at 10:50)</a>:</h4>
<p>I'm not sure if the current strategy takes into account only statistical significance of the differences but not effect size. This would alleviate the problems with short number of series, etc.<br>
This is a good intro <a href="https://towardsdatascience.com/a-definitive-guide-to-effect-size-9bc93f00db86">https://towardsdatascience.com/a-definitive-guide-to-effect-size-9bc93f00db86</a></p>



<a name="277719846"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/%22Dodgy%22%20test%20results/near/277719846" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rylev <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/.22Dodgy.22.20test.20results.html#277719846">(Apr 04 2022 at 11:59)</a>:</h4>
<p>This is taken into account by measuring the "magnitude" which you will find in how we determine "relevance". Whether we're doing it in the optimal way or not is another question.</p>



<a name="277723717"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/%22Dodgy%22%20test%20results/near/277723717" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pachi <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/.22Dodgy.22.20test.20results.html#277723717">(Apr 04 2022 at 12:33)</a>:</h4>
<p>There are some statistics (such as Cohen's d) that help to qualify those magnitudes so they could help to filter out some uninteresting results in the same way that the inner bounds are computed (to exclude outlayers). I'm no expert and these are time series, so I'm sure there could be some statistic that is better suited for this kind of data.</p>



<a name="277723826"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/%22Dodgy%22%20test%20results/near/277723826" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pachi <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/.22Dodgy.22.20test.20results.html#277723826">(Apr 04 2022 at 12:34)</a>:</h4>
<p>I'm sorry for not being more helpful... it's just that there's something missing in that kind of analysis.</p>



<a name="277843384"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/%22Dodgy%22%20test%20results/near/277843384" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rylev <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/.22Dodgy.22.20test.20results.html#277843384">(Apr 05 2022 at 08:31)</a>:</h4>
<p>Here's a PR which removes the concept of dodginess: <a href="https://github.com/rust-lang/rustc-perf/pull/1275">https://github.com/rust-lang/rustc-perf/pull/1275</a></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>