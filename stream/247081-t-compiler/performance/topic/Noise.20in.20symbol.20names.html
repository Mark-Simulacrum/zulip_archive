<html>
<head><meta charset="utf-8"><title>Noise in symbol names · t-compiler/performance · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/index.html">t-compiler/performance</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Noise.20in.20symbol.20names.html">Noise in symbol names</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="266172827"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Noise%20in%20symbol%20names/near/266172827" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vadim Petrochenkov <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Noise.20in.20symbol.20names.html#266172827">(Dec 27 2021 at 13:32)</a>:</h4>
<p>Quick question (continuing the <code>cg_diff</code> discussion):</p>
<p>Does anybody know what causes differences like this in symbol names</p>
<div class="codehilite"><pre><span></span><code>-1,091,056  /home/we/.cargo/registry/src/github.com-1ecc6299db9ec823/rustc-hash-1.1.0/src/lib.rs:_RINvXs0_NtNtCshJKh12GrzIx_4core4hash5implseNtB8_4Hash4hashNtCs3ZmDe2HJv4f_10rustc_hash8FxHasherECs9J0VgQh6xgN_10rustc_span.llvm.5193847260293977479
 1,090,956  /home/we/.cargo/registry/src/github.com-1ecc6299db9ec823/rustc-hash-1.1.0/src/lib.rs:_RINvXs0_NtNtCshJKh12GrzIx_4core4hash5implseNtB8_4Hash4hashNtCs3ZmDe2HJv4f_10rustc_hash8FxHasherECs9J0VgQh6xgN_10rustc_span.llvm.8995515151883743931
</code></pre></div>
<p>(the hash-like suffix after <code>.llvm</code>)?</p>



<a name="266173408"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Noise%20in%20symbol%20names/near/266173408" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Noise.20in.20symbol.20names.html#266173408">(Dec 27 2021 at 13:43)</a>:</h4>
<p>That is caused by ThinLTO. When inlining a function into a different codegen unit LLVM appends a hash to all local functions the inlined function uses before making them public to prevent symbol conflicts. This hash needs to be unique for each CGU.</p>



<a name="266174305"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Noise%20in%20symbol%20names/near/266174305" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vadim Petrochenkov <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Noise.20in.20symbol.20names.html#266174305">(Dec 27 2021 at 13:58)</a>:</h4>
<p>I see, thanks.<br>
I guess it'll be more reasonable to just normalize them away with <code>cg_diff</code> than rebuild the compiler without Thin LTO.</p>



<a name="266174649"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Noise%20in%20symbol%20names/near/266174649" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Noise.20in.20symbol.20names.html#266174649">(Dec 27 2021 at 14:03)</a>:</h4>
<p>It could be built with fat lto instead?</p>



<a name="266221759"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Noise%20in%20symbol%20names/near/266221759" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vadim Petrochenkov <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Noise.20in.20symbol.20names.html#266221759">(Dec 28 2021 at 01:19)</a>:</h4>
<p><span class="user-mention silent" data-user-id="330154">The 8472</span> <a href="#narrow/stream/247081-t-compiler.2Fperformance/topic/Noise.20in.20symbol.20names/near/266174649">said</a>:</p>
<blockquote>
<p>It could be built with fat lto instead?</p>
</blockquote>
<p>I'm afraid my laptop will refuse to cooperate if I try that <span aria-label="grinning" class="emoji emoji-1f600" role="img" title="grinning">:grinning:</span></p>



<a name="266231918"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Noise%20in%20symbol%20names/near/266231918" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vadim Petrochenkov <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Noise.20in.20symbol.20names.html#266231918">(Dec 28 2021 at 05:12)</a>:</h4>
<p><span class="user-mention" data-user-id="120989">@nnethercote</span></p>



<a name="266231940"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Noise%20in%20symbol%20names/near/266231940" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vadim Petrochenkov <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Noise.20in.20symbol.20names.html#266231940">(Dec 28 2021 at 05:13)</a>:</h4>
<p>By the way, valgrind doesn't correctly demangle these symbols with <code>.llvm.HASH</code> in the end.</p>



<a name="266231991"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Noise%20in%20symbol%20names/near/266231991" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vadim Petrochenkov <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Noise.20in.20symbol.20names.html#266231991">(Dec 28 2021 at 05:14)</a>:</h4>
<p>(valgrind on master)</p>



<a name="266232127"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Noise%20in%20symbol%20names/near/266232127" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vadim Petrochenkov <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Noise.20in.20symbol.20names.html#266232127">(Dec 28 2021 at 05:17)</a>:</h4>
<p>Actually maybe it's a rustc's problem?<br>
If the compiler is producing symbols that don't match our own format, then something is wrong either with the format or with the compiler.</p>



<a name="266232535"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Noise%20in%20symbol%20names/near/266232535" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Noise.20in.20symbol.20names.html#266232535">(Dec 28 2021 at 05:27)</a>:</h4>
<p><span class="user-mention" data-user-id="123856">@Vadim Petrochenkov</span> There's progress being made on the gcc/libiberty/Valgrind side for this, see <a href="https://bugs.kde.org/show_bug.cgi?id=445916">https://bugs.kde.org/show_bug.cgi?id=445916</a> for details</p>



<a name="266233328"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Noise%20in%20symbol%20names/near/266233328" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vadim Petrochenkov <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Noise.20in.20symbol.20names.html#266233328">(Dec 28 2021 at 05:48)</a>:</h4>
<p>Thanks, applied <a href="https://gcc.gnu.org/pipermail/gcc-patches/2021-December/586058.html">https://gcc.gnu.org/pipermail/gcc-patches/2021-December/586058.html</a> locally and it helped.</p>



<a name="266233420"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Noise%20in%20symbol%20names/near/266233420" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vadim Petrochenkov <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Noise.20in.20symbol.20names.html#266233420">(Dec 28 2021 at 05:50)</a>:</h4>
<p>FWIW, my personal conclusion from the linked threads is that the <code>. &lt;vendor-specific suffix&gt;</code> thing should officially be a part of v0 spec, similarly to itanium abi.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>