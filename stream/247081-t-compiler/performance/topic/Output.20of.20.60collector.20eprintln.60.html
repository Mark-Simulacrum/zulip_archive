<html>
<head><meta charset="utf-8"><title>Output of `collector eprintln` · t-compiler/performance · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/index.html">t-compiler/performance</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html">Output of `collector eprintln`</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="204872083"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204872083" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204872083">(Jul 24 2020 at 01:46)</a>:</h4>
<p>If I compile <code>collector/benchmarks/hyper-2</code> in its directory with <code>cargo build</code> I get lots of lines of output, like so:</p>
<div class="codehilite"><pre><span></span><code>   Checking cfg-if v0.1.10
   Compiling libc v0.2.65
   Compiling proc-macro2 v1.0.6
   Compiling unicode-xid v0.2.0
   Compiling semver-parser v0.7.0
   Compiling syn v1.0.8
   ...
   Checking hyper v0.13.0-alpha.4 (/home/njn/moz/rustc-perf/collector/benchmarks/hyper-2)
   &lt;lots of warnings&gt;
    Finished check [unoptimized + debuginfo] target(s) in 11.48s
</code></pre></div>



<a name="204872231"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204872231" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204872231">(Jul 24 2020 at 01:51)</a>:</h4>
<p>When I run it via <code>collector eprintln</code>, it only captures the following output:</p>



<a name="204872234"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204872234" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204872234">(Jul 24 2020 at 01:51)</a>:</h4>
<div class="codehilite"><pre><span></span><code>   Compiling proc-macro-nested v0.1.3
   Compiling futures-util v0.3.1
   Compiling hyper v0.13.0-alpha.4 (/tmp/.tmpL5PfJH)
    Finished dev [unoptimized + debuginfo] target(s) in 3.43s
</code></pre></div>



<a name="204872290"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204872290" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204872290">(Jul 24 2020 at 01:52)</a>:</h4>
<p>The difference is that in the <code>collector eprintln</code> case, it's only capturing output for the final <code>rustc</code> invocation.</p>



<a name="204872307"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204872307" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204872307">(Jul 24 2020 at 01:53)</a>:</h4>
<p>futures-util and proc-macro-nested both have build scripts or something like that which are causing spurious recompiles (possibly will be fixed by <a href="https://github.com/rust-lang/cargo/pull/8497">https://github.com/rust-lang/cargo/pull/8497</a>, otherwise we should investigate, it's a bug in Cargo almost certainly)</p>



<a name="204872309"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204872309" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204872309">(Jul 24 2020 at 01:53)</a>:</h4>
<p>I don't understand in the latter case why there are lines for <code>proc-macro-nested</code> and <code>futures-util</code>, but there aren't warning lines</p>



<a name="204872351"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204872351" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204872351">(Jul 24 2020 at 01:54)</a>:</h4>
<p>What are the warnings specifically? Maybe it's an incremental bug or something</p>



<a name="204872364"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204872364" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204872364">(Jul 24 2020 at 01:54)</a>:</h4>
<p>also possible that warnings are being sent to stdout and not stderr for some reason? would be odd though</p>



<a name="204872418"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204872418" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204872418">(Jul 24 2020 at 01:56)</a>:</h4>
<p>we should probably record stdout and stderr both regardless in the eprintln and llvm-lines cases, just in case it's useful</p>



<a name="204872421"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204872421" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204872421">(Jul 24 2020 at 01:56)</a>:</h4>
<p>(or alternatively dump it to stdout)</p>



<a name="204872461"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204872461" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204872461">(Jul 24 2020 at 01:58)</a>:</h4>
<p>four warnings, all of the form "warning: use of deprecated item 'std::error::Error::description': use the Display impl or to_string()"</p>



<a name="204872637"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204872637" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204872637">(Jul 24 2020 at 02:01)</a>:</h4>
<p>For the <code>eprintln</code> runs I'm doing "Full" builds, which don't involve incremental</p>



<a name="204872858"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204872858" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204872858">(Jul 24 2020 at 02:06)</a>:</h4>
<p>hm</p>



<a name="204872870"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204872870" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204872870">(Jul 24 2020 at 02:06)</a>:</h4>
<p>oh</p>



<a name="204872875"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204872875" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204872875">(Jul 24 2020 at 02:06)</a>:</h4>
<p>We have <code>-Adeprecated -Aunknown-lints</code> in <a href="http://rustc-fake.rs">rustc-fake.rs</a> for all things</p>



<a name="204872886"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204872886" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204872886">(Jul 24 2020 at 02:07)</a>:</h4>
<p>I think they're mostly just there because they're usually just adding noise and are otherwise unhelpful</p>



<a name="204872897"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204872897" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204872897">(Jul 24 2020 at 02:07)</a>:</h4>
<p>(and rustc, currently, does not to my knowledge do less work depending on lint levels at all)</p>



<a name="204872901"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204872901" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204872901">(Jul 24 2020 at 02:07)</a>:</h4>
<p><span class="user-mention" data-user-id="120989">@njn</span> ^</p>



<a name="204873424"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204873424" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204873424">(Jul 24 2020 at 02:20)</a>:</h4>
<p>For the other profilers, such as DHAT, the build script invocations are (a) using RUSTC_REAL, but (b) not being run under DHAT</p>



<a name="204873435"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204873435" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204873435">(Jul 24 2020 at 02:21)</a>:</h4>
<p>Wait, no</p>



<a name="204873438"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204873438" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204873438">(Jul 24 2020 at 02:21)</a>:</h4>
<p>Wait, yes</p>



<a name="204873662"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204873662" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204873662">(Jul 24 2020 at 02:27)</a>:</h4>
<p>That should be correct, I think; we do not expect anything but the leaf to use DHAT (or whatever profiler)</p>



<a name="204873670"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204873670" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204873670">(Jul 24 2020 at 02:27)</a>:</h4>
<p>Maybe I'm misunderstanding?</p>



<a name="204873684"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204873684" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204873684">(Jul 24 2020 at 02:27)</a>:</h4>
<p>IOW, at most one rustc invocation for any given benchmark should run under the profiler.</p>



<a name="204873988"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204873988" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204873988">(Jul 24 2020 at 02:34)</a>:</h4>
<p>I'm still digging, but the build script invocations of rustc are <em>not</em> getting a <code>--wrap-rustc-with</code> argument</p>



<a name="204873994"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204873994" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204873994">(Jul 24 2020 at 02:34)</a>:</h4>
<p>which is why they don't get DHATted</p>



<a name="204874018"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204874018" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204874018">(Jul 24 2020 at 02:35)</a>:</h4>
<p>I don't yet understand why the build script invocations don't get wrapped</p>



<a name="204874161"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204874161" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204874161">(Jul 24 2020 at 02:38)</a>:</h4>
<p>My best guess is this: the <code>cargo rustc</code> invocation is like this: <code>RUSTC=fake-rustc RUSTC_REAL=my-rustc cargo rustc -- --wrap-rustc-with=dhat</code></p>



<a name="204874170"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204874170" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204874170">(Jul 24 2020 at 02:39)</a>:</h4>
<p>When cargo does the build script, I guess it ignores the stuff after the <code>--</code>?</p>



<a name="204874175"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204874175" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204874175">(Jul 24 2020 at 02:39)</a>:</h4>
<p>But it preserves the stuff after the <code>--</code> for the leaf crate</p>



<a name="204874180"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204874180" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204874180">(Jul 24 2020 at 02:39)</a>:</h4>
<p>The reason I'm looking at this is that I was seeing some discrepancies in <code>collector dhat</code> and <code>collector eprintln</code>.</p>



<a name="204874225"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204874225" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204874225">(Jul 24 2020 at 02:40)</a>:</h4>
<p>The reason is that <code>collect  eprintln</code> collects output from RUSTC_REAL on the build scripts as well as the leaf crate, while DHAT only collects data from the leaf crate.</p>



<a name="204874237"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204874237" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204874237">(Jul 24 2020 at 02:41)</a>:</h4>
<p>(This is because <code>eprintln</code> doesn't actually require <code>--wrap-rustc-with</code> to work, its wrapping is a no-op, and <code>collector</code> itself captures the stderr output, rather than <code>rustc-fake</code>+wrapping)</p>



<a name="204874744"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204874744" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204874744">(Jul 24 2020 at 02:55)</a>:</h4>
<p>Ah, llvm-lines profiling got busted by the rustdoc change. Should be an easy fix though</p>



<a name="204875047"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204875047" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204875047">(Jul 24 2020 at 03:03)</a>:</h4>
<p>And my decision to only add testing of <code>eprintln</code> profiling has almost immediately been exposed as a bad one :(</p>



<a name="204875468"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204875468" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204875468">(Jul 24 2020 at 03:13)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116122">simulacrum</span> <a href="#narrow/stream/247081-t-compiler.2Fperformance/topic/Output.20of.20.60collector.20eprintln.60/near/204872897">said</a>:</p>
<blockquote>
<p>(and rustc, currently, does not to my knowledge do less work depending on lint levels at all)</p>
</blockquote>
<p>that sounds like an easy fix and performance improvement</p>



<a name="204875483"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204875483" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204875483">(Jul 24 2020 at 03:13)</a>:</h4>
<p>you'd just modify the query provider like I did for rustdoc</p>



<a name="204875533"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204875533" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204875533">(Jul 24 2020 at 03:14)</a>:</h4>
<p>I'll open an issue, I wonder how much that would help compile times since cargo always passes <code>--cap-lints allow</code></p>



<a name="204875546"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204875546" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204875546">(Jul 24 2020 at 03:14)</a>:</h4>
<p>cc <span class="user-mention" data-user-id="119009">@eddyb</span>, this is right up your alley</p>



<a name="204875890"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204875890" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204875890">(Jul 24 2020 at 03:22)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/issues/74704">https://github.com/rust-lang/rust/issues/74704</a></p>



<a name="204915774"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204915774" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204915774">(Jul 24 2020 at 13:37)</a>:</h4>
<p><span class="user-mention silent" data-user-id="120989">njn</span> <a href="#narrow/stream/247081-t-compiler.2Fperformance/topic/Output.20of.20.60collector.20eprintln.60/near/204874237">said</a>:</p>
<blockquote>
<p>(This is because <code>eprintln</code> doesn't actually require <code>--wrap-rustc-with</code> to work, its wrapping is a no-op, and <code>collector</code> itself captures the stderr output, rather than <code>rustc-fake</code>+wrapping)</p>
</blockquote>
<p>We could capture the stderr of rustc specifically for eprintln instead of cargo, I guess</p>



<a name="204919331"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204919331" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204919331">(Jul 24 2020 at 14:07)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/247081-t-compiler.2Fperformance/topic/Output.20of.20.60collector.20eprintln.60/near/204875468">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="116122">simulacrum</span> <a href="#narrow/stream/247081-t-compiler.2Fperformance/topic/Output.20of.20.60collector.20eprintln.60/near/204872897">said</a>:</p>
<blockquote>
<p>(and rustc, currently, does not to my knowledge do less work depending on lint levels at all)</p>
</blockquote>
<p>that sounds like an easy fix and performance improvement</p>
</blockquote>
<p>do we currently  measure time to compile including dependencies? Or just the final crate?</p>



<a name="204919374"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204919374" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204919374">(Jul 24 2020 at 14:07)</a>:</h4>
<p>Just the final crate. I want to add cargo's -Ztiming graphs but haven't gotten around to it yet</p>



<a name="204919423"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204919423" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204919423">(Jul 24 2020 at 14:08)</a>:</h4>
<p>ok, I'll hold off on the lint thing until we measure that</p>



<a name="204919478"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204919478" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204919478">(Jul 24 2020 at 14:08)</a>:</h4>
<p>I might have time to help this weekend if you ping me</p>



<a name="204920158"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204920158" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204920158">(Jul 24 2020 at 14:13)</a>:</h4>
<p>I personally suspect you won't see any gains from the lint thing, or at least nothing significant. Most projects don't allow lints at all, and rustc already runs them all in a single pass over the crate (2, maybe? but basically it's not a pass per lint)</p>



<a name="204921357"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204921357" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204921357">(Jul 24 2020 at 14:22)</a>:</h4>
<blockquote>
<p>Most projects don't allow lints at all</p>
</blockquote>
<p>They do though! Cargo passes <code>--cap-lints allow</code> to every dependency</p>



<a name="204921385"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204921385" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204921385">(Jul 24 2020 at 14:22)</a>:</h4>
<p>imagine not running any lints, then multiply it by 490, that's how much you're speeding up the <a href="http://docs.rs">docs.rs</a> build</p>



<a name="204921456"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204921456" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204921456">(Jul 24 2020 at 14:23)</a>:</h4>
<p>AFAIK, in at least the leaf crates, we don't see lints on the self-profile charts at all</p>



<a name="204921472"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204921472" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204921472">(Jul 24 2020 at 14:23)</a>:</h4>
<p>compared to things like borrow checking and type checking lints are really cheap</p>



<a name="204921478"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204921478" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204921478">(Jul 24 2020 at 14:23)</a>:</h4>
<p>but I could be wrong!</p>



<a name="204921489"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204921489" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204921489">(Jul 24 2020 at 14:23)</a>:</h4>
<p>well, I guess that makes sense</p>



<a name="204921497"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204921497" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204921497">(Jul 24 2020 at 14:23)</a>:</h4>
<p>fortunately it's easy to change</p>



<a name="204921564"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204921564" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204921564">(Jul 24 2020 at 14:24)</a>:</h4>
<p>I would start by just posting a quick PR that comments out / deletes the lint passes, and see what perf says about that</p>



<a name="204921854"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204921854" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204921854">(Jul 24 2020 at 14:26)</a>:</h4>
<p><span class="user-mention" data-user-id="119009">@eddyb</span> suggested it could speed up clippy a lot more than it would speed up rustc</p>



<a name="204922431"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204922431" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204922431">(Jul 24 2020 at 14:31)</a>:</h4>
<p>afaik, clippy doesn't do the pass bundling thing</p>



<a name="204922447"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204922447" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204922447">(Jul 24 2020 at 14:31)</a>:</h4>
<p>so that would not surprise me</p>



<a name="204927571"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204927571" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204927571">(Jul 24 2020 at 15:08)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/pull/74718">https://github.com/rust-lang/rust/pull/74718</a></p>



<a name="204931404"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204931404" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204931404">(Jul 24 2020 at 15:38)</a>:</h4>
<p>how do I cancel a try run?</p>



<a name="204932240"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204932240" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204932240">(Jul 24 2020 at 15:47)</a>:</h4>
<p>wow, only 40 minutes for a try run! I like GHA :)</p>



<a name="204932958"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204932958" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204932958">(Jul 24 2020 at 15:54)</a>:</h4>
<p>@bors try- IIRC</p>



<a name="204933115"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204933115" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204933115">(Jul 24 2020 at 15:55)</a>:</h4>
<p>well I had trouble getting the late lint passes not to run so it works out</p>



<a name="204933233"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204933233" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204933233">(Jul 24 2020 at 15:56)</a>:</h4>
<p>not sure how to turn off deny(warnings), it's throwing up a ton from unknown lint names</p>



<a name="204933252"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204933252" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204933252">(Jul 24 2020 at 15:56)</a>:</h4>
<p>On CI?</p>



<a name="204933287"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204933287" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204933287">(Jul 24 2020 at 15:57)</a>:</h4>
<p>you can probably edit boostrap's default config to turn it off, <a href="https://github.com/Mark-Simulacrum/rust/blob/6eaaff4f1f24c8d512ab1d9ecd0295add1683a7e/src/bootstrap/config.rs#L464">https://github.com/Mark-Simulacrum/rust/blob/6eaaff4f1f24c8d512ab1d9ecd0295add1683a7e/src/bootstrap/config.rs#L464</a></p>



<a name="204933769"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204933769" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204933769">(Jul 24 2020 at 16:01)</a>:</h4>
<p>I have deny-warnings = false so I don't think that's the issue</p>



<a name="204933881"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204933881" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204933881">(Jul 24 2020 at 16:02)</a>:</h4>
<p>can I pass <code>--cap-lints allow</code> somehow?</p>



<a name="204935145"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204935145" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204935145">(Jul 24 2020 at 16:14)</a>:</h4>
<p><span class="user-mention" data-user-id="232545">@Joshua Nelson</span> where are you seeing deny(warnings) take effect then?</p>



<a name="204935212"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204935212" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204935212">(Jul 24 2020 at 16:14)</a>:</h4>
<div class="codehilite"><pre><span></span><code>Building stage1 std artifacts (x86_64-unknown-linux-gnu -&gt; x86_64-unknown-linux-gnu)
   Compiling core v0.0.0 (/home/joshua/src/rust/src/libcore)
error[E0602]: unknown lint: `rust_2018_idioms`
  |
  = note: requested on the command line with `-W rust_2018_idioms`

error[E0602]: unknown lint: `unused_lifetimes`
  |
  = note: requested on the command line with `-W unused_lifetimes`
</code></pre></div>



<a name="204935292"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204935292" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204935292">(Jul 24 2020 at 16:15)</a>:</h4>
<p>Huh. It doesn't tell you why it's an error?</p>



<a name="204935325"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204935325" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204935325">(Jul 24 2020 at 16:15)</a>:</h4>
<p>nope :(</p>



<a name="204935336"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204935336" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204935336">(Jul 24 2020 at 16:15)</a>:</h4>
<p>Please file a bug for that, we should indicate that</p>



<a name="204935403"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204935403" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204935403">(Jul 24 2020 at 16:16)</a>:</h4>
<p>you can probably remove those lints from being specified in <a href="https://github.com/Mark-Simulacrum/rust/blob/6eaaff4f1f24c8d512ab1d9ecd0295add1683a7e/src/bootstrap/builder.rs#L1140-L1141">https://github.com/Mark-Simulacrum/rust/blob/6eaaff4f1f24c8d512ab1d9ecd0295add1683a7e/src/bootstrap/builder.rs#L1140-L1141</a></p>



<a name="204935435"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204935435" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204935435">(Jul 24 2020 at 16:16)</a>:</h4>
<p>will do</p>



<a name="204935549"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204935549" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204935549">(Jul 24 2020 at 16:17)</a>:</h4>
<p>I think it just always errors for unknown lints on the command line</p>



<a name="204935653"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204935653" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204935653">(Jul 24 2020 at 16:18)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/issues/74722">https://github.com/rust-lang/rust/issues/74722</a></p>



<a name="204978797"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204978797" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204978797">(Jul 25 2020 at 00:16)</a>:</h4>
<p>look at that! <a href="https://perf.rust-lang.org/compare.html?start=900869371e13cead086f4f9809419daa6a63cfaf&amp;end=4874c68561d0727f5ff895edef9e1e3473b6e389">https://perf.rust-lang.org/compare.html?start=900869371e13cead086f4f9809419daa6a63cfaf&amp;end=4874c68561d0727f5ff895edef9e1e3473b6e389</a></p>



<a name="204978811"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204978811" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204978811">(Jul 25 2020 at 00:17)</a>:</h4>
<p>decrease of at most 3.5%, mostly in the 1% range, no increases at all :D</p>



<a name="204996006"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204996006" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matthiaskrgr <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204996006">(Jul 25 2020 at 09:09)</a>:</h4>
<p>why would changing lints change the number of instructions emitted?? <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="204997646"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204997646" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204997646">(Jul 25 2020 at 10:01)</a>:</h4>
<p>That's instructions run I think</p>



<a name="204997688"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/204997688" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#204997688">(Jul 25 2020 at 10:02)</a>:</h4>
<p>So since the lints aren't run at all it has better performance :)</p>



<a name="205000054"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/205000054" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mati865 <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#205000054">(Jul 25 2020 at 11:21)</a>:</h4>
<p>TBH I expected bigger numbers.</p>



<a name="205001132"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/205001132" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#205001132">(Jul 25 2020 at 12:00)</a>:</h4>
<p>well it didn't catch all the lints: <a href="https://github.com/rust-lang/rust/pull/74718#issuecomment-663589975">https://github.com/rust-lang/rust/pull/74718#issuecomment-663589975</a></p>



<a name="205001184"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Output%20of%20%60collector%20eprintln%60/near/205001184" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Output.20of.20.60collector.20eprintln.60.html#205001184">(Jul 25 2020 at 12:00)</a>:</h4>
<p>so I could make a follow-up run removing those, I tried to do that yesterday but ran into issues with <a href="https://github.com/rust-lang/rust/issues/74722">https://github.com/rust-lang/rust/issues/74722</a></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>