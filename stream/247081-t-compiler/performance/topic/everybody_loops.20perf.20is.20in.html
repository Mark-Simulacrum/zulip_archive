<html>
<head><meta charset="utf-8"><title>everybody_loops perf is in · t-compiler/performance · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/index.html">t-compiler/performance</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html">everybody_loops perf is in</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="204037612"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204037612" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204037612">(Jul 16 2020 at 02:20)</a>:</h4>
<p>Compilers hate them! <a href="https://perf.rust-lang.org/compare.html?start=d9e8d6290745a65025a3e082aea72fbe372292c6&amp;end=97f1e6ff90848792722f9636e4a11368bb3b14c2">https://perf.rust-lang.org/compare.html?start=d9e8d6290745a65025a3e082aea72fbe372292c6&amp;end=97f1e6ff90848792722f9636e4a11368bb3b14c2</a></p>



<a name="204037709"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204037709" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204037709">(Jul 16 2020 at 02:22)</a>:</h4>
<p>cc <span class="user-mention" data-user-id="119009">@eddyb</span> <span aria-label="slight smile" class="emoji emoji-1f642" role="img" title="slight smile">:slight_smile:</span></p>



<a name="204037719"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204037719" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204037719">(Jul 16 2020 at 02:22)</a>:</h4>
<p>amazing</p>



<a name="204037732"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204037732" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204037732">(Jul 16 2020 at 02:22)</a>:</h4>
<p>this seems acceptable, I think</p>



<a name="204037743"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204037743" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204037743">(Jul 16 2020 at 02:23)</a>:</h4>
<p>also <span class="user-mention" data-user-id="116122">@simulacrum</span> you should probably change Doc runs to only do one of the three run-kinds, rustdoc doesn't believe in incremental</p>



<a name="204037769"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204037769" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204037769">(Jul 16 2020 at 02:23)</a>:</h4>
<p>some of these I guess are from stuff you haven't turned off, although I don't know for sure what</p>



<a name="204037771"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204037771" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204037771">(Jul 16 2020 at 02:23)</a>:</h4>
<p>the -62% is unbelievable lol</p>



<a name="204037772"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204037772" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204037772">(Jul 16 2020 at 02:23)</a>:</h4>
<p>Hm yeah that's probably a good call</p>



<a name="204037822"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204037822" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204037822">(Jul 16 2020 at 02:24)</a>:</h4>
<p><code>-Z self-profile</code> for <code>rustdoc</code> would be nice tho</p>



<a name="204037825"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204037825" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204037825">(Jul 16 2020 at 02:24)</a>:</h4>
<p>yeah I don't know where the +15% is coming from</p>



<a name="204037827"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204037827" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204037827">(Jul 16 2020 at 02:24)</a>:</h4>
<p>to see what actually <em>is</em> running</p>



<a name="204037844"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204037844" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204037844">(Jul 16 2020 at 02:24)</a>:</h4>
<p>Support in perf just needs rustdoc to do it and would be great</p>



<a name="204037857"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204037857" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204037857">(Jul 16 2020 at 02:25)</a>:</h4>
<p>I think it just needs to pass the flag to <code>rustc</code></p>



<a name="204037863"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204037863" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204037863">(Jul 16 2020 at 02:25)</a>:</h4>
<p>which might already happen</p>



<a name="204037864"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204037864" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204037864">(Jul 16 2020 at 02:25)</a>:</h4>
<p>where does rustc do it? shouldn't be too hard to add in rustdoc</p>



<a name="204037886"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204037886" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204037886">(Jul 16 2020 at 02:25)</a>:</h4>
<p>just try passing it</p>



<a name="204037890"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204037890" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204037890">(Jul 16 2020 at 02:25)</a>:</h4>
<p><code>-Z treat-err-as-bug</code> worked so I don't see why other flags wouldn't</p>



<a name="204037907"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204037907" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204037907">(Jul 16 2020 at 02:25)</a>:</h4>
<p>no errors but also no output <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="204037948"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204037948" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204037948">(Jul 16 2020 at 02:26)</a>:</h4>
<p>oh it's in .events</p>



<a name="204037958"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204037958" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204037958">(Jul 16 2020 at 02:26)</a>:</h4>
<p>if it made the files that's confirmation</p>



<a name="204037963"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204037963" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204037963">(Jul 16 2020 at 02:26)</a>:</h4>
<p>remind me the command to look at the binary file?</p>



<a name="204037968"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204037968" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204037968">(Jul 16 2020 at 02:26)</a>:</h4>
<p>the fun thing about these scales is the noise is drowned out <a href="https://perf.rust-lang.org/compare.html?start=d9e8d6290745a65025a3e082aea72fbe372292c6&amp;end=97f1e6ff90848792722f9636e4a11368bb3b14c2&amp;stat=wall-time">https://perf.rust-lang.org/compare.html?start=d9e8d6290745a65025a3e082aea72fbe372292c6&amp;end=97f1e6ff90848792722f9636e4a11368bb3b14c2&amp;stat=wall-time</a></p>



<a name="204037971"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204037971" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204037971">(Jul 16 2020 at 02:26)</a>:</h4>
<p><span class="user-mention" data-user-id="232545">@Joshua Nelson</span> <code>summarize</code></p>



<a name="204038016"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204038016" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204038016">(Jul 16 2020 at 02:27)</a>:</h4>
<p>top three for a trivial program are</p>
<div class="codehilite"><pre><span></span><code>+---------------------------------+-----------+-----------------+----------+------------+
| metadata_decode_entry           | 337.48ms  | 31.731          | 403.13ms | 240303     |
+---------------------------------+-----------+-----------------+----------+------------+
| &lt;unknown&gt;                       | 236.37ms  | 22.225          | 1.71s    | 251354     |
+---------------------------------+-----------+-----------------+----------+------------+
| metadata_register_crate         | 56.59ms   | 5.321           | 86.71ms  | 14         |
</code></pre></div>



<a name="204038020"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204038020" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204038020">(Jul 16 2020 at 02:27)</a>:</h4>
<p>lol what is '&lt;unknown&gt;'</p>



<a name="204038069"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204038069" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204038069">(Jul 16 2020 at 02:28)</a>:</h4>
<p>let me try on cargo, it's one of the ones that regressed</p>



<a name="204038197"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204038197" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204038197">(Jul 16 2020 at 02:30)</a>:</h4>
<p>ugh have to rebuild rustdoc <span aria-label="face palm" class="emoji emoji-1f926" role="img" title="face palm">:face_palm:</span> I'll get the numbers from master in the meantime</p>



<a name="204038238"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204038238" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204038238">(Jul 16 2020 at 02:31)</a>:</h4>
<p><span class="user-mention" data-user-id="232545">@Joshua Nelson</span> once you get two sets, <code>summarize diff</code> exists</p>



<a name="204038311"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204038311" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204038311">(Jul 16 2020 at 02:32)</a>:</h4>
<p>on master the top ones for cargo are</p>
<div class="codehilite"><pre><span></span><code>| &lt;unknown&gt;                       | 2.35s     | 27.137          | 7.07s    | 824225     |
+---------------------------------+-----------+-----------------+----------+------------+
| expand_crate                    | 2.01s     | 23.161          | 2.11s    | 1          |
+---------------------------------+-----------+-----------------+----------+------------+
| metadata_decode_entry           | 509.62ms  | 5.874           | 546.76ms | 530639     |
</code></pre></div>



<a name="204038316"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204038316" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204038316">(Jul 16 2020 at 02:33)</a>:</h4>
<p>what I'm seeing is that rustdoc isn't very good at timing itself <span aria-label="face palm" class="emoji emoji-1f926" role="img" title="face palm">:face_palm:</span></p>



<a name="204038317"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204038317" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204038317">(Jul 16 2020 at 02:33)</a>:</h4>
<p>/me stares</p>



<a name="204038323"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204038323" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204038323">(Jul 16 2020 at 02:33)</a>:</h4>
<p><span class="user-mention" data-user-id="232545">@Joshua Nelson</span> oh I'm dumb. that's rustdoc</p>



<a name="204038334"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204038334" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204038334">(Jul 16 2020 at 02:33)</a>:</h4>
<p>since it doesn't label itself</p>



<a name="204038381"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204038381" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204038381">(Jul 16 2020 at 02:34)</a>:</h4>
<p><code>tcx.sess.time("rustdoc", || ...)</code> should be enough</p>



<a name="204038383"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204038383" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204038383">(Jul 16 2020 at 02:34)</a>:</h4>
<p>if you want to label it</p>



<a name="204038385"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204038385" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204038385">(Jul 16 2020 at 02:34)</a>:</h4>
<p>I'm surprised it spends so much time not in rustc ... maybe <code>clean</code> is expensive? or generating the HTML?</p>



<a name="204038390"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204038390" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204038390">(Jul 16 2020 at 02:34)</a>:</h4>
<p>you could find out if you split those into multiple <code>.time</code> :P</p>



<a name="204038411"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204038411" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204038411">(Jul 16 2020 at 02:35)</a>:</h4>
<p><code>clean</code> might be wasteful. among other things it turns <code>Symbol</code> into <code>String</code> which is neither necessary nor cheap</p>



<a name="204038483"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204038483" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204038483">(Jul 16 2020 at 02:36)</a>:</h4>
<p>this looks useful</p>
<div class="codehilite"><pre><span></span><code><span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                        </span><span class="n">debug</span><span class="o">!</span><span class="p">(</span><span class="s">&quot;running pass {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">pass</span><span class="p">.</span><span class="n">name</span><span class="p">);</span><span class="w"></span>
<span class="w">                        </span><span class="n">ctxt</span><span class="p">.</span><span class="n">tcx</span><span class="p">.</span><span class="n">sess</span><span class="p">.</span><span class="n">time</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">pass</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                            </span><span class="n">krate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">pass</span><span class="p">.</span><span class="n">run</span><span class="p">)(</span><span class="n">krate</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ctxt</span><span class="p">);</span><span class="w"></span>
<span class="w">                        </span><span class="p">}</span><span class="w"></span>
<span class="w">                    </span><span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="204038494"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204038494" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204038494">(Jul 16 2020 at 02:36)</a>:</h4>
<p>what happens if I call <code>.time()</code> and then some of the code I call calls <code>time()</code> again?</p>



<a name="204038496"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204038496" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204038496">(Jul 16 2020 at 02:37)</a>:</h4>
<p>it's fine</p>



<a name="204038509"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204038509" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204038509">(Jul 16 2020 at 02:37)</a>:</h4>
<p>note the columns in the table, there's "total time" and "self time"</p>



<a name="204038514"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204038514" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204038514">(Jul 16 2020 at 02:37)</a>:</h4>
<p>ahhh nice</p>



<a name="204038525"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204038525" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204038525">(Jul 16 2020 at 02:37)</a>:</h4>
<p>"self time" being "total time" minus the total time of anything nested</p>



<a name="204038579"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204038579" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204038579">(Jul 16 2020 at 02:38)</a>:</h4>
<p>lol rustdoc recognizes everything except -Z help</p>



<a name="204038582"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204038582" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204038582">(Jul 16 2020 at 02:38)</a>:</h4>
<p>amazing</p>



<a name="204038698"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204038698" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204038698">(Jul 16 2020 at 02:40)</a>:</h4>
<p><span class="user-mention" data-user-id="232545">@Joshua Nelson</span> wait why not <code>rustup-install-toolchain-master</code> or w/e the two builds that the perf run used?</p>



<a name="204038699"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204038699" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204038699">(Jul 16 2020 at 02:40)</a>:</h4>
<p>that way we can get <em>exactly</em> the missing data</p>



<a name="204038705"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204038705" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204038705">(Jul 16 2020 at 02:41)</a>:</h4>
<p>... I forgot that was a thing</p>



<a name="204038707"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204038707" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204038707">(Jul 16 2020 at 02:41)</a>:</h4>
<p>heh</p>



<a name="204038827"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204038827" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204038827">(Jul 16 2020 at 02:43)</a>:</h4>
<p><span class="user-mention" data-user-id="116122">@simulacrum</span> <code>/detailed-query.html</code> is giving me 502 bad gateway in a popup</p>



<a name="204038834"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204038834" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204038834">(Jul 16 2020 at 02:43)</a>:</h4>
<p><a href="https://perf.rust-lang.org/detailed-query.html?commit=97f1e6ff90848792722f9636e4a11368bb3b14c2&amp;base_commit=d9e8d6290745a65025a3e082aea72fbe372292c6&amp;benchmark=deep-vector-doc&amp;run_name=full">https://perf.rust-lang.org/detailed-query.html?commit=97f1e6ff90848792722f9636e4a11368bb3b14c2&amp;base_commit=d9e8d6290745a65025a3e082aea72fbe372292c6&amp;benchmark=deep-vector-doc&amp;run_name=full</a></p>



<a name="204038837"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204038837" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204038837">(Jul 16 2020 at 02:43)</a>:</h4>
<p>I assume that's just missing data</p>



<a name="204038888"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204038888" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204038888">(Jul 16 2020 at 02:44)</a>:</h4>
<p>and the wrong error code =))</p>



<a name="204038927"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204038927" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204038927">(Jul 16 2020 at 02:45)</a>:</h4>
<p>ok wow that was so much faster lol</p>



<a name="204038987"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204038987" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204038987">(Jul 16 2020 at 02:46)</a>:</h4>
<div class="codehilite"><pre><span></span><code>+---------------------------------+-----------+-----------------+----------+------------+
| Item                            | Self time | % of total time | Time     | Item count |
+---------------------------------+-----------+-----------------+----------+------------+
| &lt;unknown&gt;                       | 1.21s     | 29.525          | 3.75s    | 824339     |
+---------------------------------+-----------+-----------------+----------+------------+
| expand_crate                    | 841.70ms  | 20.538          | 888.88ms | 1          |
+---------------------------------+-----------+-----------------+----------+------------+
| metadata_decode_entry           | 256.55ms  | 6.260           | 278.78ms | 530750     |
</code></pre></div>


<p>this is the master it compared to</p>



<a name="204038990"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204038990" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204038990">(Jul 16 2020 at 02:47)</a>:</h4>
<p>can you include the table heading?</p>



<a name="204039002"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204039002" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204039002">(Jul 16 2020 at 02:47)</a>:</h4>
<p>also, is this <code>summarize diff</code>?</p>



<a name="204039007"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204039007" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204039007">(Jul 16 2020 at 02:47)</a>:</h4>
<p>this is <code>summarize summarize</code></p>



<a name="204039019"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204039019" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204039019">(Jul 16 2020 at 02:47)</a>:</h4>
<p>will send a diff once I have one</p>



<a name="204039021"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204039021" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204039021">(Jul 16 2020 at 02:47)</a>:</h4>
<p>you want the compare mode for sanity reasons</p>



<a name="204039091"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204039091" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204039091">(Jul 16 2020 at 02:48)</a>:</h4>
<p>hmm my numbers are not matching perf.rlo at all</p>



<a name="204039096"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204039096" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204039096">(Jul 16 2020 at 02:49)</a>:</h4>
<p>it says it took almost exactly 4 seconds for both</p>



<a name="204039101"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204039101" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204039101">(Jul 16 2020 at 02:49)</a>:</h4>
<div class="codehilite"><pre><span></span><code>(-bash@build-server) ~/src/cargo ▶️ summarize diff master_perf/unknown-crate-5176.events everybody_loops/unknown-crate-8085.events
 +---------------------------------+---------------+------------------+---------------+-------------+------------+------------+--------------+-----------------------+
| Item                            | Self Time     | Self Time Change | Time          | Time Change | Item count | Cache hits | Blocked time | Incremental load time |
+---------------------------------+---------------+------------------+---------------+-------------+------------+------------+--------------+-----------------------+
| &lt;unknown&gt;                       | -363.93668ms  | -30.08%          | -1.326167095s | -35.38%     | -66001     | +0         | +0ns         | +0ns                  |
+---------------------------------+---------------+------------------+---------------+-------------+------------+------------+--------------+-----------------------+
| resolve_crate                   | +161.222999ms | +222.66%         | +161.765543ms | +218.32%    | +0         | +0         | +0ns         | +0ns                  |
+---------------------------------+---------------+------------------+---------------+-------------+------------+------------+--------------+-----------------------+
| hir_lowering                    | +109.586203ms | +295.67%         | +109.586203ms | +295.67%    | +0         | +0         | +0ns         | +0ns                  |
</code></pre></div>



<a name="204039147"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204039147" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204039147">(Jul 16 2020 at 02:50)</a>:</h4>
<p><span class="user-mention" data-user-id="232545">@Joshua Nelson</span> oh run them multiple times, you might be seeing file caching effects</p>



<a name="204039166"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204039166" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204039166">(Jul 16 2020 at 02:50)</a>:</h4>
<p>also, grab the top 10 or so</p>



<a name="204039177"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204039177" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204039177">(Jul 16 2020 at 02:50)</a>:</h4>
<p>both <code>resolve_crate</code> and <code>hir_lowering</code> make sense. the <code>&lt;unknown&gt;</code> should largely remain unchanged AFAIK</p>



<a name="204039260"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204039260" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204039260">(Jul 16 2020 at 02:52)</a>:</h4>
<p>still only shows 10ms difference</p>
<div class="codehilite"><pre><span></span><code>(-bash@build-server) ~/src/cargo ▶️ summarize diff master_perf/unknown-crate-11799.events everybody_loops/unknown-crate-8601.events
+---------------------------------+---------------+------------------+---------------+-------------+------------+------------+--------------+-----------------------+
| Item                            | Self Time     | Self Time Change | Time          | Time Change | Item count | Cache hits | Blocked time | Incremental load time |
+---------------------------------+---------------+------------------+---------------+-------------+------------+------------+--------------+-----------------------+
| &lt;unknown&gt;                       | -368.126753ms | -30.12%          | -1.332377885s | -35.29%     | -66001     | +0         | +0ns         | +0ns                  |
+---------------------------------+---------------+------------------+---------------+-------------+------------+------------+--------------+-----------------------+
| resolve_crate                   | +166.668739ms | +225.35%         | +167.188961ms | +220.98%    | +0         | +0         | +0ns         | +0ns                  |
+---------------------------------+---------------+------------------+---------------+-------------+------------+------------+--------------+-----------------------+
| hir_lowering                    | +109.982559ms | +291.43%         | +109.982559ms | +291.43%    | +0         | +0         | +0ns         | +0ns                  |
+---------------------------------+---------------+------------------+---------------+-------------+------------+------------+--------------+-----------------------+
| build_hir_map                   | +69.766132ms  | +323.68%         | +69.766132ms  | +323.68%    | +0         | +0         | +0ns         | +0ns                  |
+---------------------------------+---------------+------------------+---------------+-------------+------------+------------+--------------+-----------------------+
| configure_and_expand            | -33.141565ms  | -99.76%          | +143.123542ms | +14.77%     | +0         | +0         | +0ns         | +0ns                  |
+---------------------------------+---------------+------------------+---------------+-------------+------------+------------+--------------+-----------------------+
| early_lint_checks               | +20.245762ms  | +277.58%         | +20.245762ms  | +277.58%    | +0         | +0         | +0ns         | +0ns                  |
+---------------------------------+---------------+------------------+---------------+-------------+------------+------------+--------------+-----------------------+
| complete_gated_feature_checking | +10.659805ms  | +247.34%         | +10.659805ms  | +247.34%    | +0         | +0         | +0ns         | +0ns                  |
+---------------------------------+---------------+------------------+---------------+-------------+------------+------------+--------------+-----------------------+
| death_checking                  | -10.272364ms  | -100.00%         | -11.970467ms  | -100.00%    | -1         | +0         | -0ns         | -0ns                  |
+---------------------------------+---------------+------------------+---------------+-------------+------------+------------+--------------+-----------------------+
| free_global_ctxt                | +9.536383ms   | +22.32%          | +9.536383ms   | +22.32%     | +0         | +0         | +0ns         | +0ns                  |
+---------------------------------+---------------+------------------+---------------+-------------+------------+------------+--------------+-----------------------+
| expand_crate                    | -7.918964ms   | -0.98%           | -6.910984ms   | -0.81%      | +0         | +0         | +0ns         | +0ns                  |
+---------------------------------+---------------+------------------+---------------+-------------+------------+------------+--------------+-----------------------+
</code></pre></div>



<a name="204039288"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204039288" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204039288">(Jul 16 2020 at 02:53)</a>:</h4>
<p>I ran both three times in a row then used the last</p>



<a name="204039297"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204039297" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204039297">(Jul 16 2020 at 02:53)</a>:</h4>
<p>not particularly scientific but should have been enough to have <em>roughly</em> the same as perf.rlo <span aria-label="confused" class="emoji emoji-1f615" role="img" title="confused">:confused:</span></p>



<a name="204039316"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204039316" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204039316">(Jul 16 2020 at 02:54)</a>:</h4>
<p>let me try recompiling so we can break up the <code>&lt;unknown&gt;</code> a little</p>



<a name="204039687"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204039687" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204039687">(Jul 16 2020 at 03:01)</a>:</h4>
<p><span class="user-mention" data-user-id="232545">@Joshua Nelson</span> anyway all of this makes sense, it's not throwing away function bodies, so some boring stuff still r uns</p>



<a name="204039691"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204039691" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204039691">(Jul 16 2020 at 03:01)</a>:</h4>
<p>also what is <code>death_checking</code>? idk seems morbid</p>



<a name="204039693"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204039693" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204039693">(Jul 16 2020 at 03:01)</a>:</h4>
<p>lol I wondered too</p>



<a name="204039694"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204039694" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204039694">(Jul 16 2020 at 03:01)</a>:</h4>
<p>maybe liveness analysis?</p>



<a name="204039713"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204039713" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204039713">(Jul 16 2020 at 03:02)</a>:</h4>
<p>doubtful, that's still called liveness</p>



<a name="204039776"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204039776" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204039776">(Jul 16 2020 at 03:03)</a>:</h4>
<p>ugh rustc doesn't understand it's not the same crate every time</p>
<div class="codehilite"><pre><span></span><code><span class="n">error</span><span class="p">[</span><span class="n">E0382</span><span class="p">]</span>: <span class="nc">use</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">moved</span><span class="w"> </span><span class="n">value</span>: <span class="err">`</span><span class="n">krate</span><span class="err">`</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">librustdoc</span><span class="o">/</span><span class="n">core</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">601</span>:<span class="mi">57</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">502</span><span class="w"> </span><span class="o">|</span><span class="w">                 </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">krate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">clean</span>::<span class="n">krate</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">ctxt</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">                     </span><span class="o">---------</span><span class="w"> </span><span class="k">move</span><span class="w"> </span><span class="n">occurs</span><span class="w"> </span><span class="n">because</span><span class="w"> </span><span class="err">`</span><span class="n">krate</span><span class="err">`</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="k">type</span> <span class="err">`</span><span class="n">clean</span>::<span class="n">types</span>::<span class="n">Crate</span><span class="err">`</span><span class="p">,</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">implement</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="err">`</span><span class="nb">Copy</span><span class="err">`</span><span class="w"> </span><span class="k">trait</span><span class="w"></span>
<span class="o">..</span><span class="p">.</span><span class="w"></span>
<span class="mi">601</span><span class="w"> </span><span class="o">|</span><span class="w">                         </span><span class="n">ctxt</span><span class="p">.</span><span class="n">tcx</span><span class="p">.</span><span class="n">sess</span><span class="p">.</span><span class="n">time</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">pass</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">                                                         </span><span class="o">^^</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">moved</span><span class="w"> </span><span class="n">into</span><span class="w"> </span><span class="n">closure</span><span class="w"> </span><span class="n">here</span><span class="p">,</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">previous</span><span class="w"> </span><span class="n">iteration</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="k">loop</span><span class="w"></span>
<span class="mi">602</span><span class="w"> </span><span class="o">|</span><span class="w">                             </span><span class="n">krate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">pass</span><span class="p">.</span><span class="n">run</span><span class="p">)(</span><span class="n">krate</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ctxt</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">                                                  </span><span class="o">-----</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="n">occurs</span><span class="w"> </span><span class="n">due</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">closure</span><span class="w"></span>
</code></pre></div>



<a name="204039872"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204039872" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204039872">(Jul 16 2020 at 03:05)</a>:</h4>
<p>here we go, I can do <code>krate = time(...)</code></p>



<a name="204040027"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204040027" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204040027">(Jul 16 2020 at 03:08)</a>:</h4>
<p>lol</p>



<a name="204040044"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204040044" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204040044">(Jul 16 2020 at 03:08)</a>:</h4>
<p>well that's certainly not what I expected</p>
<div class="codehilite"><pre><span></span><code>(-bash@build-server) ~/src/cargo ▶️ summarize summarize everybody_loops_subdivided/unknown-crate-21132.events
+---------------------------------+-----------+-----------------+----------+------------+
| Item                            | Self time | % of total time | Time     | Item count |
+---------------------------------+-----------+-----------------+----------+------------+
| collect-trait-impls             | 2.10s     | 33.735          | 2.91s    | 1          |
+---------------------------------+-----------+-----------------+----------+------------+
| &lt;unknown&gt;                       | 1.40s     | 22.421          | 3.66s    | 758415     |
+---------------------------------+-----------+-----------------+----------+------------+
| expand_crate                    | 1.24s     | 19.961          | 1.30s    | 1          |
+---------------------------------+-----------+-----------------+----------+------------+
| metadata_decode_entry           | 353.08ms  | 5.673           | 380.60ms | 529337     |
+---------------------------------+-----------+-----------------+----------+------------+
| resolve_crate                   | 327.94ms  | 5.269           | 330.98ms | 1          |
+---------------------------------+-----------+-----------------+----------+------------+
| hir_lowering                    | 192.81ms  | 3.098           | 192.81ms | 1          |
+---------------------------------+-----------+-----------------+----------+------------+
| build_hir_map                   | 115.09ms  | 1.849           | 115.09ms | 1          |
+---------------------------------+-----------+-----------------+----------+------------+
| free_global_ctxt                | 53.78ms   | 0.864           | 53.78ms  | 1          |
+---------------------------------+-----------+-----------------+----------+------------+
| metadata_register_crate         | 50.82ms   | 0.817           | 75.97ms  | 109        |
+---------------------------------+-----------+-----------------+----------+------------+
</code></pre></div>



<a name="204040047"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204040047" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204040047">(Jul 16 2020 at 03:08)</a>:</h4>
<p>collect-trait-impls ??</p>



<a name="204040052"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204040052" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204040052">(Jul 16 2020 at 03:09)</a>:</h4>
<p>that's a rustdoc thing right?</p>



<a name="204040055"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204040055" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204040055">(Jul 16 2020 at 03:09)</a>:</h4>
<p>it's a pass, yeah</p>



<a name="204040072"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204040072" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204040072">(Jul 16 2020 at 03:09)</a>:</h4>
<p>not actually sure what it does</p>



<a name="204040073"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204040073" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204040073">(Jul 16 2020 at 03:09)</a>:</h4>
<p>makes sense, rustc isn't exactly slow :P</p>



<a name="204040077"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204040077" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204040077">(Jul 16 2020 at 03:09)</a>:</h4>
<p>those are fighting words <span aria-label="very angry" class="emoji emoji-1f621" role="img" title="very angry">:very_angry:</span></p>



<a name="204040123"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204040123" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204040123">(Jul 16 2020 at 03:10)</a>:</h4>
<p><code>description: "retrieves trait impls for items in the crate"</code></p>



<a name="204040130"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204040130" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204040130">(Jul 16 2020 at 03:10)</a>:</h4>
<p>welcome to "eddyb dislikes a lot of things about rustdoc but doesn't have the bandwidth to refactor them"</p>



<a name="204040132"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204040132" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204040132">(Jul 16 2020 at 03:10)</a>:</h4>
<p>Hm 502 errors sounds like probably perf is missing some branch somewhere and is panicking as a result. I'll try and debug it later, please file an issue</p>



<a name="204040146"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204040146" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204040146">(Jul 16 2020 at 03:10)</a>:</h4>
<p>I once promised <span class="user-mention" data-user-id="210316">@GuillaumeGomez</span> I would try to help out but I don't think I did much :(</p>



<a name="204040267"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204040267" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204040267">(Jul 16 2020 at 03:13)</a>:</h4>
<p>aha, I might have found why <a href="https://github.com/rust-lang/rust/pull/73101#discussion_r453274499">https://github.com/rust-lang/rust/pull/73101#discussion_r453274499</a> is broken though</p>



<a name="204040274"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204040274" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204040274">(Jul 16 2020 at 03:13)</a>:</h4>
<p>or at least the relevant code, it's <code>inline::build_impl</code></p>



<a name="204040331"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204040331" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204040331">(Jul 16 2020 at 03:14)</a>:</h4>
<p>ugh <code>clean</code> makes things so confusing</p>



<a name="204040540"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204040540" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204040540">(Jul 16 2020 at 03:18)</a>:</h4>
<p>anyway it looks like we can just land your PR, it's slower but not by much. unless you want to wait for <a href="http://perf.rust-lang.org">perf.rust-lang.org</a> to get the query details</p>



<a name="204040575"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204040575" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204040575">(Jul 16 2020 at 03:19)</a>:</h4>
<p>oh you mean adding <code>sess.time()</code>? nah I don't think we need to block on that</p>



<a name="204040659"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204040659" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204040659">(Jul 16 2020 at 03:21)</a>:</h4>
<p>how expensive is <code>sess.time()</code>? Can I add it basically every other line?</p>



<a name="204040720"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204040720" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204040720">(Jul 16 2020 at 03:22)</a>:</h4>
<p>interesting, the time is _not_ being spent in the traits belonging to cargo</p>



<a name="204040722"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204040722" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204040722">(Jul 16 2020 at 03:22)</a>:</h4>
<p>maybe it's std traits?</p>



<a name="204040724"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204040724" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204040724">(Jul 16 2020 at 03:22)</a>:</h4>
<p>no I mean the 502</p>



<a name="204040726"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204040726" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204040726">(Jul 16 2020 at 03:22)</a>:</h4>
<div class="codehilite"><pre><span></span><code>(-bash@build-server) ~/src/cargo ▶️ summarize summarize everybody_loops_subdivided/unknown-crate-22566.events
+---------------------------------+-----------+-----------------+----------+------------+
| Item                            | Self time | % of total time | Time     | Item count |
+---------------------------------+-----------+-----------------+----------+------------+
| collect-trait-impls             | 2.09s     | 33.453          | 2.95s    | 1          |
+---------------------------------+-----------+-----------------+----------+------------+
| &lt;unknown&gt;                       | 1.41s     | 22.549          | 3.69s    | 758415     |
+---------------------------------+-----------+-----------------+----------+------------+
| expand_crate                    | 1.22s     | 19.550          | 1.28s    | 1          |
+---------------------------------+-----------+-----------------+----------+------------+
| metadata_decode_entry           | 354.78ms  | 5.678           | 382.28ms | 529337     |
+---------------------------------+-----------+-----------------+----------+------------+
| resolve_crate                   | 328.40ms  | 5.256           | 331.45ms | 1          |
+---------------------------------+-----------+-----------------+----------+------------+
| hir_lowering                    | 192.94ms  | 3.088           | 192.94ms | 1          |
+---------------------------------+-----------+-----------------+----------+------------+
| build_hir_map                   | 114.64ms  | 1.835           | 114.64ms | 1          |
+---------------------------------+-----------+-----------------+----------+------------+
| free_global_ctxt                | 53.93ms   | 0.863           | 53.93ms  | 1          |
+---------------------------------+-----------+-----------------+----------+------------+
| metadata_register_crate         | 50.56ms   | 0.809           | 75.36ms  | 109        |
+---------------------------------+-----------+-----------------+----------+------------+
| build trait impl                | 42.45ms   | 0.679           | 43.90ms  | 30665      |
</code></pre></div>



<a name="204040729"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204040729" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204040729">(Jul 16 2020 at 03:23)</a>:</h4>
<p>ah ok</p>



<a name="204040804"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204040804" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204040804">(Jul 16 2020 at 03:24)</a>:</h4>
<p>adding random .time() is so much fun lmao</p>



<a name="204040817"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204040817" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204040817">(Jul 16 2020 at 03:25)</a>:</h4>
<p>let me time the new visitor too, <code>EmitIgnoredResolutionErrors</code></p>



<a name="204040884"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204040884" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204040884">(Jul 16 2020 at 03:26)</a>:</h4>
<p>ok yeah most of the time in cargo is going to external traits</p>
<div class="codehilite"><pre><span></span><code>(-bash@build-server) ~/src/cargo ▶️ summarize summarize everybody_loops_subdivided/unknown-crate-24013.events
+---------------------------------+-----------+-----------------+----------+------------+
| Item                            | Self time | % of total time | Time     | Item count |
+---------------------------------+-----------+-----------------+----------+------------+
| &lt;unknown&gt;                       | 1.49s     | 22.653          | 3.88s    | 758415     |
+---------------------------------+-----------+-----------------+----------+------------+
| collect-trait-impls             | 1.41s     | 21.457          | 3.09s    | 1          |
+---------------------------------+-----------+-----------------+----------+------------+
| expand_crate                    | 1.29s     | 19.701          | 1.36s    | 1          |
+---------------------------------+-----------+-----------------+----------+------------+
| build extern trait impl         | 784.21ms  | 11.949          | 1.18s    | 19520      |
+---------------------------------+-----------+-----------------+----------+------------+
| metadata_decode_entry           | 370.51ms  | 5.645           | 399.48ms | 529337     |
+---------------------------------+-----------+-----------------+----------+------------+
| resolve_crate                   | 340.93ms  | 5.195           | 344.21ms | 1          |
+---------------------------------+-----------+-----------------+----------+------------+
| hir_lowering                    | 199.77ms  | 3.044           | 199.77ms | 1          |
+---------------------------------+-----------+-----------------+----------+------------+
| build_hir_map                   | 120.69ms  | 1.839           | 120.69ms | 1          |
+---------------------------------+-----------+-----------------+----------+------------+
| free_global_ctxt                | 56.27ms   | 0.857           | 56.27ms  | 1          |
+---------------------------------+-----------+-----------------+----------+------------+
| metadata_register_crate         | 52.91ms   | 0.806           | 78.69ms  | 109        |
+---------------------------------+-----------+-----------------+----------+------------+
| build local trait impl          | 44.71ms   | 0.681           | 46.33ms  | 30665      |
+---------------------------------+-----------+-----------------+----------+------------+
</code></pre></div>



<a name="204040888"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204040888" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204040888">(Jul 16 2020 at 03:26)</a>:</h4>
<p>that &lt;unknown&gt; is bugging me</p>



<a name="204041012"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204041012" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204041012">(Jul 16 2020 at 03:29)</a>:</h4>
<p>ok nice, basically nothing <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span> </p>
<div class="codehilite"><pre><span></span><code>| emit ignored resolution errors  | 132.16µs  | 0.002           | 132.16µs | 227        |
</code></pre></div>



<a name="204042196"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204042196" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204042196">(Jul 16 2020 at 03:54)</a>:</h4>
<p>not surprised</p>



<a name="204042212"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204042212" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204042212">(Jul 16 2020 at 03:55)</a>:</h4>
<p><span class="user-mention" data-user-id="232545">@Joshua Nelson</span> just wrap everything rustdoc does in <code>time("rustdoc"</code></p>



<a name="204042221"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204042221" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204042221">(Jul 16 2020 at 03:55)</a>:</h4>
<p>like, everything that has a <code>tcx</code> in scope</p>



<a name="204054563"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204054563" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204054563">(Jul 16 2020 at 07:47)</a>:</h4>
<p><span class="user-mention" data-user-id="119009">@eddyb</span> Well, it's fine. The point is mostly to make it work and you helped me and other rustdoc people a lot. Perf is considered secondary for the moment in there. :)</p>



<a name="204076324"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204076324" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204076324">(Jul 16 2020 at 12:34)</a>:</h4>
<p>Whatever the <code>&lt;unknown&gt;</code> thing is, it's getting run <em>a lot</em> (<code>758415</code> times) which makes me think it isn't the outer "rustdoc" executable.</p>



<a name="204076422"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204076422" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204076422">(Jul 16 2020 at 12:35)</a>:</h4>
<p>It almost feels like it's a query or something that isn't being instrumented but I don't see how that could happen.</p>



<a name="204076547"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204076547" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204076547">(Jul 16 2020 at 12:36)</a>:</h4>
<p>hmm</p>



<a name="204076597"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204076597" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204076597">(Jul 16 2020 at 12:37)</a>:</h4>
<p>that part is weird, but also I don't see how it could happen</p>



<a name="204076611"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204076611" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204076611">(Jul 16 2020 at 12:37)</a>:</h4>
<p>maybe something passes an empty string somewhere and that gets interpreted as <code>&lt;unknown&gt;</code></p>



<a name="204076638"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204076638" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204076638">(Jul 16 2020 at 12:37)</a>:</h4>
<p>Hmm</p>



<a name="204076672"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204076672" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204076672">(Jul 16 2020 at 12:38)</a>:</h4>
<p>It's a good thought but I just can't see how it would happen</p>



<a name="204076701"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204076701" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204076701">(Jul 16 2020 at 12:38)</a>:</h4>
<p>still, labeling the scope of the <code>TyCtxt</code> (or the whole time <code>Session</code> is alive, as probably the better thing to do) shooould allow e.g. using <code>crox</code> to see what's going on</p>



<a name="204076703"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204076703" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204076703">(Jul 16 2020 at 12:38)</a>:</h4>
<p>actually, hang on</p>



<a name="204076712"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204076712" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204076712">(Jul 16 2020 at 12:38)</a>:</h4>
<p>can we introduce an assert for non-unknown strings? I guess probably no?</p>



<a name="204076713"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204076713" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204076713">(Jul 16 2020 at 12:38)</a>:</h4>
<p><span class="user-mention" data-user-id="232545">@Joshua Nelson</span> just use <code>crox</code> lol</p>



<a name="204076761"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204076761" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204076761">(Jul 16 2020 at 12:38)</a>:</h4>
<p><span class="user-mention" data-user-id="125250">@Wesley Wiser</span> I mean something silly like <code>rustdoc</code> using <code>time(</code> (prior to any of this) but getting the string from somewhere where it's empty sometimes</p>



<a name="204076766"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204076766" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204076766">(Jul 16 2020 at 12:38)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116122">simulacrum</span> <a href="#narrow/stream/247081-t-compiler.2Fperformance/topic/everybody_loops.20perf.20is.20in/near/204076712">said</a>:</p>
<blockquote>
<p>can we introduce an assert for non-unknown strings? I guess probably no?</p>
</blockquote>
<p>We could perhaps have a debugging flag that would enable that behavior.</p>



<a name="204076799"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204076799" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204076799">(Jul 16 2020 at 12:39)</a>:</h4>
<p>Right</p>



<a name="204076810"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204076810" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204076810">(Jul 16 2020 at 12:39)</a>:</h4>
<p>But then I think the count would only be like 1 right?</p>



<a name="204076815"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204076815" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204076815">(Jul 16 2020 at 12:39)</a>:</h4>
<p>from what <span class="user-mention" data-user-id="232545">@Joshua Nelson</span> was pasting I think <code>rustdoc</code> already tracks per-pass times? (in the sense of "rustdoc pass"). and each pass has a name</p>



<a name="204076826"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204076826" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204076826">(Jul 16 2020 at 12:39)</a>:</h4>
<p><span class="user-mention" data-user-id="125250">@Wesley Wiser</span> not if it's done deep inside something else</p>



<a name="204076839"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204076839" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204076839">(Jul 16 2020 at 12:39)</a>:</h4>
<p>Fair enough</p>



<a name="204076896"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204076896" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204076896">(Jul 16 2020 at 12:40)</a>:</h4>
<p>I know nothing about rustdoc <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="204076900"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204076900" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204076900">(Jul 16 2020 at 12:40)</a>:</h4>
<p>anyway use <code>crox</code> then look at it :P</p>



<a name="204076931"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204076931" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204076931">(Jul 16 2020 at 12:40)</a>:</h4>
<p>should be easy to spot given how much cumulative time it takes</p>



<a name="204076940"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204076940" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204076940">(Jul 16 2020 at 12:40)</a>:</h4>
<p>I keep forgetting how useful the visual intuition is</p>



<a name="204076955"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204076955" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204076955">(Jul 16 2020 at 12:40)</a>:</h4>
<p>just wish I could e.g. color some stuff dynamically, to see it better</p>



<a name="204077875"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204077875" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204077875">(Jul 16 2020 at 12:49)</a>:</h4>
<p><span class="user-mention silent" data-user-id="119009">eddyb</span> <a href="#narrow/stream/247081-t-compiler.2Fperformance/topic/everybody_loops.20perf.20is.20in/near/204076815">said</a>:</p>
<blockquote>
<p>from what <span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> was pasting I think <code>rustdoc</code> already tracks per-pass times? (in the sense of "rustdoc pass"). and each pass has a name</p>
</blockquote>
<p>no, sorry, I just added that</p>



<a name="204077889"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204077889" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204077889">(Jul 16 2020 at 12:49)</a>:</h4>
<p>forgot to push my changes, let me finish <a href="http://docs.rs">docs.rs</a> things</p>



<a name="204077899"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204077899" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204077899">(Jul 16 2020 at 12:49)</a>:</h4>
<p>oh</p>



<a name="204077926"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204077926" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204077926">(Jul 16 2020 at 12:49)</a>:</h4>
<p>it looked like you found it, oops</p>



<a name="204077932"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204077932" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204077932">(Jul 16 2020 at 12:49)</a>:</h4>
<p>each pass does have a name though which makes things easier</p>



<a name="204077985"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204077985" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204077985">(Jul 16 2020 at 12:50)</a>:</h4>
<p>can you check if any are empty?</p>



<a name="204078024"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204078024" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204078024">(Jul 16 2020 at 12:50)</a>:</h4>
<p>not right now but it would be somewhere near <code>librustdoc/passes/mod.rs</code></p>



<a name="204079164"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204079164" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204079164">(Jul 16 2020 at 13:00)</a>:</h4>
<p>all of them look to be non-empty to me</p>



<a name="204079490"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204079490" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204079490">(Jul 16 2020 at 13:03)</a>:</h4>
<p><span class="user-mention" data-user-id="119009">@eddyb</span> do you want timing info in everybody_loops or a follow-up PR?</p>



<a name="204079497"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204079497" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204079497">(Jul 16 2020 at 13:03)</a>:</h4>
<p>since we plan to merge either way</p>



<a name="204079572"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204079572" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204079572">(Jul 16 2020 at 13:03)</a>:</h4>
<p>oh you can just merge the PR</p>



<a name="204079633"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204079633" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204079633">(Jul 16 2020 at 13:04)</a>:</h4>
<p>let me get rid of lazy_Static first</p>



<a name="204079687"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204079687" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204079687">(Jul 16 2020 at 13:04)</a>:</h4>
<p>ok done :)</p>



<a name="204079765"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204079765" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204079765">(Jul 16 2020 at 13:05)</a>:</h4>
<p>oh wait I think <span class="user-mention" data-user-id="210316">@GuillaumeGomez</span> wanted to wait for ollie</p>



<a name="204079889"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204079889" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204079889">(Jul 16 2020 at 13:06)</a>:</h4>
<p>Try pinging them again. They were around yesterday. :)</p>



<a name="204079990"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204079990" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204079990">(Jul 16 2020 at 13:07)</a>:</h4>
<p>And more generally, if you can, use <code>once_cell</code> instead of <code>lazy_static</code></p>



<a name="204080132"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204080132" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204080132">(Jul 16 2020 at 13:08)</a>:</h4>
<p>yes, I ended up using once_cell in rustc_interface instead of rustdoc</p>



<a name="204080540"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/everybody_loops%20perf%20is%20in/near/204080540" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/everybody_loops.20perf.20is.20in.html#204080540">(Jul 16 2020 at 13:11)</a>:</h4>
<p>ok I pinged them :)</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>