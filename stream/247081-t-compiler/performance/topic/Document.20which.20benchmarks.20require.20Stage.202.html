<html>
<head><meta charset="utf-8"><title>Document which benchmarks require Stage 2 · t-compiler/performance · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/index.html">t-compiler/performance</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Document.20which.20benchmarks.20require.20Stage.202.html">Document which benchmarks require Stage 2</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="261371478"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Document%20which%20benchmarks%20require%20Stage%202/near/261371478" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Document.20which.20benchmarks.20require.20Stage.202.html#261371478">(Nov 13 2021 at 17:39)</a>:</h4>
<p>Is it possible to document which rustc-perf benchmarks actually require a stage 2 rustc? I was running a subset of the benches yesterday, and I simply assumed stage 2 was needed for the ones I was running, but I realize that may not have been the case. I'd be happy to submit the updated documentation myself if someone points me to where I can find that information</p>



<a name="261371542"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Document%20which%20benchmarks%20require%20Stage%202/near/261371542" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Document.20which.20benchmarks.20require.20Stage.202.html#261371542">(Nov 13 2021 at 17:41)</a>:</h4>
<p>I don't think any of them require it</p>



<a name="261371544"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Document%20which%20benchmarks%20require%20Stage%202/near/261371544" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Document.20which.20benchmarks.20require.20Stage.202.html#261371544">(Nov 13 2021 at 17:41)</a>:</h4>
<p>but not 100% sure -- the servo ones might still be on plugins? I think we dropped that though.</p>



<a name="261371595"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Document%20which%20benchmarks%20require%20Stage%202/near/261371595" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Document.20which.20benchmarks.20require.20Stage.202.html#261371595">(Nov 13 2021 at 17:42)</a>:</h4>
<p>I should be able to just test this by running the suite locally using stage1 but only doing <code>Full</code> runs right?</p>



<a name="261371613"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Document%20which%20benchmarks%20require%20Stage%202/near/261371613" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Document.20which.20benchmarks.20require.20Stage.202.html#261371613">(Nov 13 2021 at 17:44)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116122">simulacrum</span> <a href="#narrow/stream/247081-t-compiler.2Fperformance/topic/Document.20which.20benchmarks.20require.20Stage.202/near/261371544">said</a>:</p>
<blockquote>
<p>but not 100% sure -- the servo ones might still be on plugins? I think we dropped that though.</p>
</blockquote>
<p>Only the script crate uses a plugin. It doesn't seem like the script crate is benchmarked.</p>



<a name="261371659"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Document%20which%20benchmarks%20require%20Stage%202/near/261371659" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Document.20which.20benchmarks.20require.20Stage.202.html#261371659">(Nov 13 2021 at 17:44)</a>:</h4>
<p>They may not require it but they wouldn't be comparable to a stage 2 run because the compiler itself would be built with an older compiler, so less optimized. So for comparisons both would have to be stage1.</p>



<a name="261371739"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Document%20which%20benchmarks%20require%20Stage%202/near/261371739" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Document.20which.20benchmarks.20require.20Stage.202.html#261371739">(Nov 13 2021 at 17:46)</a>:</h4>
<p>I believe <code>--stage 1</code> and <code>--stage 2</code> use the same rustc binary but with <code>--stage 1</code> not having a sysroot unless you do <code>full-bootstrap = true</code> in which case rustc is rebuilt, though it should still result in the same rustc binary.</p>



<a name="261371781"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Document%20which%20benchmarks%20require%20Stage%202/near/261371781" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Document.20which.20benchmarks.20require.20Stage.202.html#261371781">(Nov 13 2021 at 17:47)</a>:</h4>
<p>ah well, I guess I still don't understand the stages</p>



<a name="261371786"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Document%20which%20benchmarks%20require%20Stage%202/near/261371786" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Document.20which.20benchmarks.20require.20Stage.202.html#261371786">(Nov 13 2021 at 17:47)</a>:</h4>
<p>Yeah this is fine I think, the collector README just says you need stage 2 to run local benchmarks right now, so replacing that with a note that stage 1 is fine as long as you use it consistently seems good. I'm gonna make sure this local test passes and if so I'll submit the PR</p>



<a name="261372051"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Document%20which%20benchmarks%20require%20Stage%202/near/261372051" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Document.20which.20benchmarks.20require.20Stage.202.html#261372051">(Nov 13 2021 at 17:53)</a>:</h4>
<p>Happy to take a PR.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>