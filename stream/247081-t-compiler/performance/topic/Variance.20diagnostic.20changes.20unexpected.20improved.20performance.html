<html>
<head><meta charset="utf-8"><title>Variance diagnostic changes unexpected improved performance · t-compiler/performance · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/index.html">t-compiler/performance</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Variance.20diagnostic.20changes.20unexpected.20improved.20performance.html">Variance diagnostic changes unexpected improved performance</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="266202800"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Variance%20diagnostic%20changes%20unexpected%20improved%20performance/near/266202800" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Variance.20diagnostic.20changes.20unexpected.20improved.20performance.html#266202800">(Dec 27 2021 at 20:34)</a>:</h4>
<p>This PR improved performance on several benchmarks, but I have no idea why: <a href="https://github.com/rust-lang/rust/pull/89336#issuecomment-1001716165">https://github.com/rust-lang/rust/pull/89336#issuecomment-1001716165</a></p>



<a name="266204114"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Variance%20diagnostic%20changes%20unexpected%20improved%20performance/near/266204114" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tm <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Variance.20diagnostic.20changes.20unexpected.20improved.20performance.html#266204114">(Dec 27 2021 at 20:55)</a>:</h4>
<p>Compare with <a href="https://perf.rust-lang.org/compare.html?start=aad4f1039fd5d6bf961ed08eebc6eb69b577f1be&amp;end=475b00aa4037461b506539a06d15ca6091b461a7">https://perf.rust-lang.org/compare.html?start=aad4f1039fd5d6bf961ed08eebc6eb69b577f1be&amp;end=475b00aa4037461b506539a06d15ca6091b461a7</a> and <a href="https://perf.rust-lang.org/compare.html?start=f8abed9ed48bace6be0087bcd44ed534e239b8d8&amp;end=d74f38771301649fff720b71840f0d706c349198">https://perf.rust-lang.org/compare.html?start=f8abed9ed48bace6be0087bcd44ed534e239b8d8&amp;end=d74f38771301649fff720b71840f0d706c349198</a> (which is another pull request and its revert).</p>



<a name="266204807"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Variance%20diagnostic%20changes%20unexpected%20improved%20performance/near/266204807" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tm <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Variance.20diagnostic.20changes.20unexpected.20improved.20performance.html#266204807">(Dec 27 2021 at 21:04)</a>:</h4>
<p>All of those impact performance the same function <code>process_obligations</code> for no apparent reasons.</p>



<a name="266740463"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Variance%20diagnostic%20changes%20unexpected%20improved%20performance/near/266740463" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Variance.20diagnostic.20changes.20unexpected.20improved.20performance.html#266740463">(Jan 03 2022 at 21:47)</a>:</h4>
<p>In general, <code>keccak</code> and <code>inflate</code> are the two benchmarks most affected by the performance of <code>process_obligations</code>, they call it a lot. It's quite possible that very minor changes could change codegen, inlining, etc., in a way that affects them</p>



<a name="266740519"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Variance%20diagnostic%20changes%20unexpected%20improved%20performance/near/266740519" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Variance.20diagnostic.20changes.20unexpected.20improved.20performance.html#266740519">(Jan 03 2022 at 21:48)</a>:</h4>
<p>Though <span class="user-mention" data-user-id="125294">@Aaron Hill</span> 's first example is <code>wg-grammar</code>, which doesn't fit that pattern</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>