<html>
<head><meta charset="utf-8"><title>perf triage 2021 11 23 · t-compiler/performance · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/index.html">t-compiler/performance</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/perf.20triage.202021.2011.2023.html">perf triage 2021 11 23</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="262474752"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/perf%20triage%202021%2011%2023/near/262474752" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/perf.20triage.202021.2011.2023.html#262474752">(Nov 23 2021 at 15:57)</a>:</h4>
<p>Starting triage now</p>



<a name="262478444"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/perf%20triage%202021%2011%2023/near/262478444" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/perf.20triage.202021.2011.2023.html#262478444">(Nov 23 2021 at 16:24)</a>:</h4>
<p>I’m thrilled to see all the “regressions” that have already been triaged by the PR authors.</p>



<a name="262478588"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/perf%20triage%202021%2011%2023/near/262478588" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/perf.20triage.202021.2011.2023.html#262478588">(Nov 23 2021 at 16:25)</a>:</h4>
<p>And I especially liked the evidence presented by <span class="user-mention" data-user-id="120989">@nnethercote</span> for why the regressions flagged by PR <a href="https://github.com/rust-lang/rust/issues/90919">#90919</a> are just noise. More specifically, I’m wondering: Can we <strong>automate</strong> the heuristic that “totally different sets of benchmarks were flagged pre- and post-merge” ?</p>



<a name="262478929"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/perf%20triage%202021%2011%2023/near/262478929" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/perf.20triage.202021.2011.2023.html#262478929">(Nov 23 2021 at 16:28)</a>:</h4>
<p>It's one of the things we've flagged in the other direction (lots of the same benchmark means it's probably not noise) but if we come up with something for that I expect it'll work in the reverse for this case as well.</p>



<a name="262480206"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/perf%20triage%202021%2011%2023/near/262480206" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/perf.20triage.202021.2011.2023.html#262480206">(Nov 23 2021 at 16:38)</a>:</h4>
<p>I will admit, the heuristic does assume that “pre-merge” and “post-merge” should have nearly identical performance profiles, which is not a perfect assumption to make. (I.e. it would overlook cases where there is some weird interaction from merge artifacts)</p>



<a name="262480243"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/perf%20triage%202021%2011%2023/near/262480243" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/perf.20triage.202021.2011.2023.html#262480243">(Nov 23 2021 at 16:38)</a>:</h4>
<p>But it seems like a great thing to at least <em>highlight</em> in the initially generated template, when the information is available.</p>



<a name="262504387"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/perf%20triage%202021%2011%2023/near/262504387" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/perf.20triage.202021.2011.2023.html#262504387">(Nov 23 2021 at 19:49)</a>:</h4>
<p>I am struck by how often “inflate” is occurring on the list, various improvements and regressions up and down by 5% to 6%</p>



<a name="262504746"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/perf%20triage%202021%2011%2023/near/262504746" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/perf.20triage.202021.2011.2023.html#262504746">(Nov 23 2021 at 19:52)</a>:</h4>
<p>incr-unchanged? probably incremental verification noise.</p>



<a name="262505449"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/perf%20triage%202021%2011%2023/near/262505449" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/perf.20triage.202021.2011.2023.html#262505449">(Nov 23 2021 at 19:58)</a>:</h4>
<p>Yeah, all the inflate cases are incr-unchanged.</p>



<a name="262505530"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/perf%20triage%202021%2011%2023/near/262505530" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/perf.20triage.202021.2011.2023.html#262505530">(Nov 23 2021 at 19:58)</a>:</h4>
<p>could we put the incremental verification codepaths in standalone tasks/events in -Zself-profile, just to check if it's that or <a href="https://github.com/rust-lang/rustc-perf/issues/1105">https://github.com/rust-lang/rustc-perf/issues/1105</a> ?</p>



<a name="262505595"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/perf%20triage%202021%2011%2023/near/262505595" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/perf.20triage.202021.2011.2023.html#262505595">(Nov 23 2021 at 19:59)</a>:</h4>
<p>er, 1105 is the incremental verification?</p>



<a name="262505614"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/perf%20triage%202021%2011%2023/near/262505614" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/perf.20triage.202021.2011.2023.html#262505614">(Nov 23 2021 at 19:59)</a>:</h4>
<p>and we should probably follow through and blanket enable it</p>



<a name="262505806"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/perf%20triage%202021%2011%2023/near/262505806" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/perf.20triage.202021.2011.2023.html#262505806">(Nov 23 2021 at 20:00)</a>:</h4>
<p>blanket enable, but only on perf.rlo? Isn't that at odds of the “measure what you ship” point that we’re discussing on <a class="stream-topic" data-stream-id="247081" href="/#narrow/stream/247081-t-compiler.2Fperformance/topic/PR.20.2390951.20mixed.20results">#t-compiler/performance &gt; PR #90951 mixed results</a>  ?</p>



<a name="262505958"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/perf%20triage%202021%2011%2023/near/262505958" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/perf.20triage.202021.2011.2023.html#262505958">(Nov 23 2021 at 20:01)</a>:</h4>
<p><span class="user-mention" data-user-id="116122">@simulacrum</span>  I understood 1105 as related to your change enabling one specific different incr flag on 1/32th query, while I was thinking of all the incremental verification, so I may have misunderstood ?</p>



<a name="262506009"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/perf%20triage%202021%2011%2023/near/262506009" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/perf.20triage.202021.2011.2023.html#262506009">(Nov 23 2021 at 20:02)</a>:</h4>
<p>we would still measure the same compiler build we ship but profile with a different <em>runtime</em> option</p>



<a name="262506117"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/perf%20triage%202021%2011%2023/near/262506117" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/perf.20triage.202021.2011.2023.html#262506117">(Nov 23 2021 at 20:02)</a>:</h4>
<p>which I think is acceptable to reduce noise, especially since it just does <em>more</em> than what we ship to endusers.</p>



<a name="262506201"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/perf%20triage%202021%2011%2023/near/262506201" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/perf.20triage.202021.2011.2023.html#262506201">(Nov 23 2021 at 20:03)</a>:</h4>
<p><span class="user-mention silent" data-user-id="330154">The 8472</span> <a href="#narrow/stream/247081-t-compiler.2Fperformance/topic/perf.20triage.202021.2011.2023/near/262506009">said</a>:</p>
<blockquote>
<p>we would still measure the same compiler build we ship but profile with a different <em>runtime</em> option</p>
</blockquote>
<p>I understand the distinction. The main question is whether it could possibly <em>mask</em> a regression</p>



<a name="262506220"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/perf%20triage%202021%2011%2023/near/262506220" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/perf.20triage.202021.2011.2023.html#262506220">(Nov 23 2021 at 20:03)</a>:</h4>
<p>(but I don’t think it is likely to do so.)</p>



<a name="262506256"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/perf%20triage%202021%2011%2023/near/262506256" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/perf.20triage.202021.2011.2023.html#262506256">(Nov 23 2021 at 20:04)</a>:</h4>
<p>changes in verification time might deemphasize other changes</p>



<a name="262506323"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/perf%20triage%202021%2011%2023/near/262506323" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/perf.20triage.202021.2011.2023.html#262506323">(Nov 23 2021 at 20:04)</a>:</h4>
<p>Yes, I guess that is a form of masking</p>



<a name="262506392"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/perf%20triage%202021%2011%2023/near/262506392" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/perf.20triage.202021.2011.2023.html#262506392">(Nov 23 2021 at 20:04)</a>:</h4>
<p>But probably an acceptable one, especially if it makes the perf triage process more systematic</p>



<a name="262506401"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/perf%20triage%202021%2011%2023/near/262506401" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/perf.20triage.202021.2011.2023.html#262506401">(Nov 23 2021 at 20:05)</a>:</h4>
<p>but if people code-golf verification until it's fast then the oh so terrible outcome would be that we can enable it all the time :D</p>



<a name="262506449"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/perf%20triage%202021%2011%2023/near/262506449" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/perf.20triage.202021.2011.2023.html#262506449">(Nov 23 2021 at 20:05)</a>:</h4>
<p>i.e. of the things to be concerned about, I think <strong>human error</strong> presents the biggest risk.</p>



<a name="262540031"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/perf%20triage%202021%2011%2023/near/262540031" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/perf.20triage.202021.2011.2023.html#262540031">(Nov 24 2021 at 02:31)</a>:</h4>
<p>Report PR for this week is up: <a href="https://github.com/rust-lang/rustc-perf/pull/1110">https://github.com/rust-lang/rustc-perf/pull/1110</a></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>