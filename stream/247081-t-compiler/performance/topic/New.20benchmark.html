<html>
<head><meta charset="utf-8"><title>New benchmark · t-compiler/performance · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/index.html">t-compiler/performance</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/New.20benchmark.html">New benchmark</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="254956393"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/New%20benchmark/near/254956393" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/New.20benchmark.html#254956393">(Sep 26 2021 at 19:43)</a>:</h4>
<p>I just made a PR to add a new benchmark: <a href="https://github.com/rust-lang/rustc-perf/pull/1033">https://github.com/rust-lang/rustc-perf/pull/1033</a></p>



<a name="254956395"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/New%20benchmark/near/254956395" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/New.20benchmark.html#254956395">(Sep 26 2021 at 19:43)</a>:</h4>
<p><span class="user-mention" data-user-id="116122">@simulacrum</span></p>



<a name="254956470"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/New%20benchmark/near/254956470" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/New.20benchmark.html#254956470">(Sep 26 2021 at 19:44)</a>:</h4>
<p>What's the runtime of that test like with latest(ish) master? (just <code>time rustc foo.rs</code> should be OK for measuring or similar)</p>



<a name="254956482"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/New%20benchmark/near/254956482" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/New.20benchmark.html#254956482">(Sep 26 2021 at 19:44)</a>:</h4>
<p>2-3 seconds</p>



<a name="254956514"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/New%20benchmark/near/254956514" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/New.20benchmark.html#254956514">(Sep 26 2021 at 19:45)</a>:</h4>
<p>hm, ok, seems not terrible</p>



<a name="254956528"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/New%20benchmark/near/254956528" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/New.20benchmark.html#254956528">(Sep 26 2021 at 19:45)</a>:</h4>
<p>a little faster (1 second) would be ideal, but this doesn't seem easy to scale down, so it's OK</p>



<a name="254956529"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/New%20benchmark/near/254956529" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/New.20benchmark.html#254956529">(Sep 26 2021 at 19:45)</a>:</h4>
<p>Think I have a fix for perf regression in <a href="https://github.com/rust-lang/rust/issues/88862">#88862</a>, but this seems like a really important case to have a benchmark for</p>



<a name="254956553"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/New%20benchmark/near/254956553" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/New.20benchmark.html#254956553">(Sep 26 2021 at 19:45)</a>:</h4>
<p>Once that fix gets merged, it'll go down to .3 seconds</p>



<a name="254956557"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/New%20benchmark/near/254956557" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/New.20benchmark.html#254956557">(Sep 26 2021 at 19:46)</a>:</h4>
<p>oh, ok</p>



<a name="254956589"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/New%20benchmark/near/254956589" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/New.20benchmark.html#254956589">(Sep 26 2021 at 19:46)</a>:</h4>
<p>well then seems fine :)</p>



<a name="254956632"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/New%20benchmark/near/254956632" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/New.20benchmark.html#254956632">(Sep 26 2021 at 19:46)</a>:</h4>
<p>I'll merge the PR once CI passes (which'll just check the benchmark) and we can go from there</p>



<a name="254956658"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/New%20benchmark/near/254956658" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/New.20benchmark.html#254956658">(Sep 26 2021 at 19:47)</a>:</h4>
<p>great</p>



<a name="254956690"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/New%20benchmark/near/254956690" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/New.20benchmark.html#254956690">(Sep 26 2021 at 19:47)</a>:</h4>
<p>I realized: there should probably be some short blurb somewhere in the README of basically "How to add a benchmark"</p>



<a name="254956790"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/New%20benchmark/near/254956790" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/New.20benchmark.html#254956790">(Sep 26 2021 at 19:49)</a>:</h4>
<p>yeah, we should add that -- happy to take a PR :)</p>



<a name="254956826"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/New%20benchmark/near/254956826" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/New.20benchmark.html#254956826">(Sep 26 2021 at 19:49)</a>:</h4>
<p>Is there anything to keep in mind other than 1) Add the benchmark into <code>collector/benchmarks</code> and 2) Add some info in the README?</p>



<a name="254956880"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/New%20benchmark/near/254956880" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/New.20benchmark.html#254956880">(Sep 26 2021 at 19:50)</a>:</h4>
<p>Should it include "try to keep the benchmark to less than a second"?</p>



<a name="254957044"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/New%20benchmark/near/254957044" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/New.20benchmark.html#254957044">(Sep 26 2021 at 19:52)</a>:</h4>
<p>Hm, I think that pretty much covers it</p>



<a name="254957106"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/New%20benchmark/near/254957106" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/New.20benchmark.html#254957106">(Sep 26 2021 at 19:53)</a>:</h4>
<p>okay cool</p>



<a name="254957109"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/New%20benchmark/near/254957109" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/New.20benchmark.html#254957109">(Sep 26 2021 at 19:53)</a>:</h4>
<p>I think one second is probably a good thing to mention but more of a "hint", and in any case all benchmarks are evaluated on a need basis -- if it tracks a regression, that's more likely to get added, particularly if it's a relatively minimal example</p>



<a name="254957162"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/New%20benchmark/near/254957162" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/New.20benchmark.html#254957162">(Sep 26 2021 at 19:54)</a>:</h4>
<p>(it should also note that 1 second can exclude deps, in case that's relevant)</p>



<a name="254957366"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/New%20benchmark/near/254957366" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/New.20benchmark.html#254957366">(Sep 26 2021 at 19:57)</a>:</h4>
<p>okay, I'll make a PR shortly</p>



<a name="254957373"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/New%20benchmark/near/254957373" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/New.20benchmark.html#254957373">(Sep 26 2021 at 19:57)</a>:</h4>
<p>gotta go make some food</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>