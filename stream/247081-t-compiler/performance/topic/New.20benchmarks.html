<html>
<head><meta charset="utf-8"><title>New benchmarks · t-compiler/performance · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/index.html">t-compiler/performance</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/New.20benchmarks.html">New benchmarks</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="278275246"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/New%20benchmarks/near/278275246" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rylev <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/New.20benchmarks.html#278275246">(Apr 08 2022 at 09:01)</a>:</h4>
<p><span class="user-mention" data-user-id="120989">@nnethercote</span> The <a href="https://hackmd.io/d9uE7qgtTWKDLivy0uoVQw?view">upgrade doc</a> mentions potential new benchmarks. Do we have any criteria for deciding whether a benchmark is interesting enough to add. The crates mentioned in the doc as being potentially good to add seem reasonable to me, but I'm unsure how we want to evaluate whether a crate is indeed worth it to add.</p>



<a name="278275424"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/New%20benchmarks/near/278275424" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/New.20benchmarks.html#278275424">(Apr 08 2022 at 09:02)</a>:</h4>
<p><span class="user-mention" data-user-id="224872">@rylev</span> I've been looking at them, I have a short list: serde_derive, http, bitmasks, a stress test I have relating to <code>quote</code></p>



<a name="278275461"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/New%20benchmarks/near/278275461" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/New.20benchmarks.html#278275461">(Apr 08 2022 at 09:03)</a>:</h4>
<p>Maybe nalgebra; it's interesting but also very big and slow, not sure if it's worth it</p>



<a name="278275481"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/New%20benchmarks/near/278275481" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/New.20benchmarks.html#278275481">(Apr 08 2022 at 09:03)</a>:</h4>
<p>The others are generally pretty vanilla, don't offer much interesting stuff beyond the existing benchmarks</p>



<a name="278275599"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/New%20benchmarks/near/278275599" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rylev <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/New.20benchmarks.html#278275599">(Apr 08 2022 at 09:04)</a>:</h4>
<p>I left a note asking whether <code>serde_json</code> would be interesting (given its popularity and difference with the rest of the serde suite). Any thoughts on that?</p>



<a name="278275769"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/New%20benchmarks/near/278275769" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rylev <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/New.20benchmarks.html#278275769">(Apr 08 2022 at 09:06)</a>:</h4>
<p>And now that you have a list of good candidates, should we make note of that in the doc and post about it in the "Task for contributors" topic?</p>



<a name="278275865"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/New%20benchmarks/near/278275865" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/New.20benchmarks.html#278275865">(Apr 08 2022 at 09:06)</a>:</h4>
<p>I haven't looked at serde_json, it could be interesting.</p>



<a name="278275907"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/New%20benchmarks/near/278275907" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/New.20benchmarks.html#278275907">(Apr 08 2022 at 09:07)</a>:</h4>
<p>You're pushing me to firm the list, I wasn't quite at the delegation step yet, have been mulling it over <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="278275925"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/New%20benchmarks/near/278275925" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/New.20benchmarks.html#278275925">(Apr 08 2022 at 09:07)</a>:</h4>
<p>I was planning to do that next week</p>



<a name="278275963"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/New%20benchmarks/near/278275963" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rylev <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/New.20benchmarks.html#278275963">(Apr 08 2022 at 09:07)</a>:</h4>
<p>Ok. I don't mean to apply undue pressure. Let me know if there's anything I can do to help</p>



<a name="278276142"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/New%20benchmarks/near/278276142" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/New.20benchmarks.html#278276142">(Apr 08 2022 at 09:09)</a>:</h4>
<p>Thanks! Will do</p>



<a name="278276208"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/New%20benchmarks/near/278276208" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/New.20benchmarks.html#278276208">(Apr 08 2022 at 09:09)</a>:</h4>
<p>I should ask <span class="user-mention" data-user-id="116122">@simulacrum</span> how much headroom we have to add new benchmarks, CI time wise. I think we're using less time than before we started the upgrade...</p>



<a name="278276786"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/New%20benchmarks/near/278276786" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rylev <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/New.20benchmarks.html#278276786">(Apr 08 2022 at 09:14)</a>:</h4>
<p>We should be able to tell how much time we took before since we record benchmarking durations. I can look into that.</p>



<a name="278278596"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/New%20benchmarks/near/278278596" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rylev <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/New.20benchmarks.html#278278596">(Apr 08 2022 at 09:31)</a>:</h4>
<p>We're taking about ~1000 seconds (~16.5 minutes) less now than before the great benchmark swap</p>



<a name="278278996"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/New%20benchmarks/near/278278996" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rylev <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/New.20benchmarks.html#278278996">(Apr 08 2022 at 09:34)</a>:</h4>
<p>And historically speaking only 144 runs have taken less time the last run did so we're sort of near a historical low in terms of the amount of time it takes.</p>



<a name="278280832"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/New%20benchmarks/near/278280832" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/New.20benchmarks.html#278280832">(Apr 08 2022 at 09:53)</a>:</h4>
<p>Great! So what's the total time we're getting now?</p>



<a name="278281551"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/New%20benchmarks/near/278281551" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rylev <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/New.20benchmarks.html#278281551">(Apr 08 2022 at 10:00)</a>:</h4>
<p>In total it's around 72 minutes</p>



<a name="278288894"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/New%20benchmarks/near/278288894" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/New.20benchmarks.html#278288894">(Apr 08 2022 at 11:14)</a>:</h4>
<p>My dashboard says 1.22 hours now, and before all the work it was 1.5 hours</p>



<a name="278297781"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/New%20benchmarks/near/278297781" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rylev <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/New.20benchmarks.html#278297781">(Apr 08 2022 at 12:40)</a>:</h4>
<p>Idea: on the status page it could be nice to graph the benchmark run time for the last 10 runs and to link to these runs' comparison pages. When debugging things, it's often nice to see a few of the last runs. This isn't really useful for users but could be useful for those working on rustc-perf.</p>



<a name="278512907"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/New%20benchmarks/near/278512907" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/New.20benchmarks.html#278512907">(Apr 11 2022 at 06:31)</a>:</h4>
<p><span class="user-mention" data-user-id="224872">@rylev</span> I looked at <code>serde_json</code>, pretty boring, similar to several existing benchmarks</p>



<a name="278513173"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/New%20benchmarks/near/278513173" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rylev <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/New.20benchmarks.html#278513173">(Apr 11 2022 at 06:37)</a>:</h4>
<p>Can you explain a bit about what criteria you’re applying? I’m curious</p>



<a name="278524023"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/New%20benchmarks/near/278524023" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/New.20benchmarks.html#278524023">(Apr 11 2022 at 08:48)</a>:</h4>
<p>Just eyeballing the top functions in Cachegrind. Not very scientific, but if you look at a few profiles the same functions appear over and over for a lot of the benchmakrs.</p>



<a name="278525594"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/New%20benchmarks/near/278525594" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rylev <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/New.20benchmarks.html#278525594">(Apr 11 2022 at 09:03)</a>:</h4>
<p>I noticed that the section "To add" has been updated. Is this the final list. Shall we start adding the ones listed there or are you still thinking about which ones are interesting enough?</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>