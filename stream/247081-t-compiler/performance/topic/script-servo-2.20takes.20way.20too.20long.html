<html>
<head><meta charset="utf-8"><title>script-servo-2 takes way too long · t-compiler/performance · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/index.html">t-compiler/performance</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/script-servo-2.20takes.20way.20too.20long.html">script-servo-2 takes way too long</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="204866031"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/script-servo-2%20takes%20way%20too%20long/near/204866031" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/script-servo-2.20takes.20way.20too.20long.html#204866031">(Jul 23 2020 at 23:46)</a>:</h4>
<table>
<thead>
<tr>
<th>step</th>
<th>min</th>
<th>duration</th>
<th>max</th>
<th>delta</th>
<th>points</th>
</tr>
</thead>
<tbody>
<tr>
<td>script-servo-2</td>
<td>00:52:24.422709</td>
<td>00:52:38.30694</td>
<td>00:52:46.667524</td>
<td>00:00:22.244815</td>
<td>10</td>
</tr>
<tr>
<td>style-servo</td>
<td>00:16:08.323251</td>
<td>00:16:13.806416</td>
<td>00:16:17.857307</td>
<td>00:00:09.534056</td>
<td>9</td>
</tr>
<tr>
<td>webrender-wrench</td>
<td>00:14:24.848538</td>
<td>00:14:31.730265</td>
<td>00:14:41.130318</td>
<td>00:00:16.28178</td>
<td>8</td>
</tr>
<tr>
<td>cargo</td>
<td>00:06:48.296966</td>
<td>00:06:50.804955</td>
<td>00:06:52.53552</td>
<td>00:00:04.238554</td>
<td>10</td>
</tr>
<tr>
<td>packed-simd</td>
<td>00:04:57.403402</td>
<td>00:04:58.502164</td>
<td>00:04:59.607664</td>
<td>00:00:02.204262</td>
<td>10</td>
</tr>
<tr>
<td>cranelift-codegen</td>
<td>00:04:27.27746</td>
<td>00:04:29.01858</td>
<td>00:04:30.290482</td>
<td>00:00:03.013022</td>
<td>10</td>
</tr>
<tr>
<td>webrender</td>
<td>00:04:26.536715</td>
<td>00:04:28.17794</td>
<td>00:04:29.545559</td>
<td>00:00:03.008844</td>
<td>8</td>
</tr>
<tr>
<td>regex</td>
<td>00:03:53.064631</td>
<td>00:03:56.078153</td>
<td>00:03:59.311631</td>
<td>00:00:06.247</td>
<td>10</td>
</tr>
<tr>
<td>clap-rs</td>
<td>00:03:03.99469</td>
<td>00:03:05.411468</td>
<td>00:03:06.490934</td>
<td>00:00:02.496244</td>
<td>10</td>
</tr>
<tr>
<td>ripgrep</td>
<td>00:02:51.883454</td>
<td>00:02:54.078789</td>
<td>00:02:56.73584</td>
<td>00:00:04.852386</td>
<td>10</td>
</tr>
<tr>
<td>hyper-2</td>
<td>00:02:49.324197</td>
<td>00:02:50.636992</td>
<td>00:02:51.543099</td>
<td>00:00:02.218902</td>
<td>10</td>
</tr>
<tr>
<td>wg-grammar</td>
<td>00:02:42.164479</td>
<td>00:02:43.64106</td>
<td>00:02:44.909471</td>
<td>00:00:02.744992</td>
<td>8</td>
</tr>
<tr>
<td>tokio-webpush-simple</td>
<td>00:02:40.17114</td>
<td>00:02:41.239153</td>
<td>00:02:42.622671</td>
<td>00:00:02.451531</td>
<td>8</td>
</tr>
<tr>
<td>ctfe-stress-4</td>
<td>00:02:35.420051</td>
<td>00:02:37.553023</td>
<td>00:02:38.860999</td>
<td>00:00:03.440948</td>
<td>10</td>
</tr>
<tr>
<td>keccak</td>
<td>00:02:27.125584</td>
<td>00:02:29.454525</td>
<td>00:02:36.090336</td>
<td>00:00:08.964752</td>
<td>10</td>
</tr>
<tr>
<td>html5ever</td>
<td>00:02:05.545028</td>
<td>00:02:06.809501</td>
<td>00:02:08.550163</td>
<td>00:00:03.005135</td>
<td>10</td>
</tr>
<tr>
<td>serde</td>
<td>00:01:55.106183</td>
<td>00:01:56.123117</td>
<td>00:01:57.124809</td>
<td>00:00:02.018626</td>
<td>10</td>
</tr>
<tr>
<td>inflate</td>
<td>00:01:51.884388</td>
<td>00:01:53.013393</td>
<td>00:01:54.035424</td>
<td>00:00:02.151036</td>
<td>10</td>
</tr>
<tr>
<td>deep-vector</td>
<td>00:01:48.694768</td>
<td>00:01:50.140532</td>
<td>00:01:51.140086</td>
<td>00:00:02.445318</td>
<td>10</td>
</tr>
<tr>
<td>ucd</td>
<td>00:01:46.788575</td>
<td>00:01:47.109023</td>
<td>00:01:47.453228</td>
<td>00:00:00.664653</td>
<td>8</td>
</tr>
<tr>
<td>piston-image</td>
<td>00:01:30.914542</td>
<td>00:01:31.755887</td>
<td>00:01:32.401378</td>
<td>00:00:01.486836</td>
<td>10</td>
</tr>
<tr>
<td>tuple-stress</td>
<td>00:01:28.088439</td>
<td>00:01:29.3923</td>
<td>00:01:30.225791</td>
<td>00:00:02.137352</td>
<td>8</td>
</tr>
<tr>
<td>syn</td>
<td>00:01:18.870981</td>
<td>00:01:20.043315</td>
<td>00:01:21.436504</td>
<td>00:00:02.565523</td>
<td>9</td>
</tr>
<tr>
<td>coercions</td>
<td>00:01:13.962623</td>
<td>00:01:15.217044</td>
<td>00:01:16.353412</td>
<td>00:00:02.390789</td>
<td>10</td>
</tr>
<tr>
<td>unicode_normalization</td>
<td>00:01:08.616724</td>
<td>00:01:09.685466</td>
<td>00:01:10.57283</td>
<td>00:00:01.956106</td>
<td>8</td>
</tr>
<tr>
<td>issue-46449</td>
<td>00:01:07.166663</td>
<td>00:01:09.192104</td>
<td>00:01:11.491057</td>
<td>00:00:04.324394</td>
<td>10</td>
</tr>
<tr>
<td>encoding</td>
<td>00:01:07.515718</td>
<td>00:01:08.120918</td>
<td>00:01:09.284611</td>
<td>00:00:01.768893</td>
<td>10</td>
</tr>
<tr>
<td>regression-31157</td>
<td>00:01:02.263842</td>
<td>00:01:03.145532</td>
<td>00:01:04.171286</td>
<td>00:00:01.907444</td>
<td>10</td>
</tr>
<tr>
<td>many-assoc-items</td>
<td>00:01:01.227579</td>
<td>00:01:02.297189</td>
<td>00:01:03.058821</td>
<td>00:00:01.831242</td>
<td>10</td>
</tr>
<tr>
<td>futures</td>
<td>00:00:49.30049</td>
<td>00:00:59.639172</td>
<td>00:02:25.779153</td>
<td>00:01:36.478663</td>
<td>10</td>
</tr>
<tr>
<td>unused-warnings</td>
<td>00:00:52.848726</td>
<td>00:00:53.336023</td>
<td>00:00:54.317456</td>
<td>00:00:01.46873</td>
<td>8</td>
</tr>
<tr>
<td>token-stream-stress</td>
<td>00:00:37.777829</td>
<td>00:00:38.438836</td>
<td>00:00:39.31282</td>
<td>00:00:01.534991</td>
<td>8</td>
</tr>
<tr>
<td>unify-linearly</td>
<td>00:00:34.901029</td>
<td>00:00:35.746932</td>
<td>00:00:36.843082</td>
<td>00:00:01.942053</td>
<td>8</td>
</tr>
<tr>
<td>helloworld</td>
<td>00:00:33.814299</td>
<td>00:00:35.529219</td>
<td>00:00:37.420863</td>
<td>00:00:03.606564</td>
<td>10</td>
</tr>
<tr>
<td>wf-projection-stress-65510</td>
<td>00:00:33.694186</td>
<td>00:00:34.286424</td>
<td>00:00:35.103877</td>
<td>00:00:01.409691</td>
<td>8</td>
</tr>
<tr>
<td>issue-58319</td>
<td>00:00:28.674385</td>
<td>00:00:29.787979</td>
<td>00:00:30.753245</td>
<td>00:00:02.07886</td>
<td>10</td>
</tr>
<tr>
<td>deeply-nested</td>
<td>00:00:27.144737</td>
<td>00:00:27.873554</td>
<td>00:00:28.59006</td>
<td>00:00:01.445323</td>
<td>10</td>
</tr>
<tr>
<td>await-call-tree</td>
<td>00:00:25.582319</td>
<td>00:00:26.321523</td>
<td>00:00:27.123145</td>
<td>00:00:01.540826</td>
<td>10</td>
</tr>
</tbody>
</table>



<a name="204866048"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/script-servo-2%20takes%20way%20too%20long/near/204866048" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/script-servo-2.20takes.20way.20too.20long.html#204866048">(Jul 23 2020 at 23:46)</a>:</h4>
<p>that's a table of all our benchmarks, sorted by how long they take on the official collector machine</p>



<a name="204866056"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/script-servo-2%20takes%20way%20too%20long/near/204866056" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/script-servo-2.20takes.20way.20too.20long.html#204866056">(Jul 23 2020 at 23:47)</a>:</h4>
<p>script-servo-2 is a clear outlier at 52 minutes</p>



<a name="204866075"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/script-servo-2%20takes%20way%20too%20long/near/204866075" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/script-servo-2.20takes.20way.20too.20long.html#204866075">(Jul 23 2020 at 23:47)</a>:</h4>
<p>I think if we don't have good solutions here soon, we're going to have to make it opt-in to run it or something like that -- or cut parts of it, like debug or opt builds.</p>



<a name="204866729"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/script-servo-2%20takes%20way%20too%20long/near/204866729" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/script-servo-2.20takes.20way.20too.20long.html#204866729">(Jul 23 2020 at 23:57)</a>:</h4>
<p>I will try to investigate to make sure we're not rebuilding anything except script servo itself (and hopefully add asserts to that effect) this weekend.</p>



<a name="204867685"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/script-servo-2%20takes%20way%20too%20long/near/204867685" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/script-servo-2.20takes.20way.20too.20long.html#204867685">(Jul 24 2020 at 00:14)</a>:</h4>
<p>Cc <span class="user-mention" data-user-id="120989">@njn</span> on this - I think with ci times on rust-lang/rust being 2 hours we need to shave off around 45 minutes from our time or so or we won't keep up</p>



<a name="204867839"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/script-servo-2%20takes%20way%20too%20long/near/204867839" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/script-servo-2.20takes.20way.20too.20long.html#204867839">(Jul 24 2020 at 00:17)</a>:</h4>
<p>Is it really only 2 hrs for rustc?</p>



<a name="204867921"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/script-servo-2%20takes%20way%20too%20long/near/204867921" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/script-servo-2.20takes.20way.20too.20long.html#204867921">(Jul 24 2020 at 00:18)</a>:</h4>
<p>What are the "points" in that table?</p>



<a name="204867930"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/script-servo-2%20takes%20way%20too%20long/near/204867930" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/script-servo-2.20takes.20way.20too.20long.html#204867930">(Jul 24 2020 at 00:19)</a>:</h4>
<p>The easy option is to just skip script-servo. I almost never run it when I do local runs</p>



<a name="204868015"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/script-servo-2%20takes%20way%20too%20long/near/204868015" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/script-servo-2.20takes.20way.20too.20long.html#204868015">(Jul 24 2020 at 00:20)</a>:</h4>
<p>I also don't like packed-simd much. It's a weird benchmark. I guess you could say that's an argument for keeping it, but I don't feel like I've gotten utility from it</p>



<a name="204868045"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/script-servo-2%20takes%20way%20too%20long/near/204868045" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/script-servo-2.20takes.20way.20too.20long.html#204868045">(Jul 24 2020 at 00:21)</a>:</h4>
<p>script-servo-2 also dominates the "summary" results</p>



<a name="204868122"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/script-servo-2%20takes%20way%20too%20long/near/204868122" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/script-servo-2.20takes.20way.20too.20long.html#204868122">(Jul 24 2020 at 00:22)</a>:</h4>
<p>Oh, is it 2 hours now due to the change to GitHub Actions?</p>



<a name="204868182"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/script-servo-2%20takes%20way%20too%20long/near/204868182" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/script-servo-2.20takes.20way.20too.20long.html#204868182">(Jul 24 2020 at 00:23)</a>:</h4>
<p>Good, that should reduce the average size of a rollup, hopefully</p>



<a name="204869111"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/script-servo-2%20takes%20way%20too%20long/near/204869111" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/script-servo-2.20takes.20way.20too.20long.html#204869111">(Jul 24 2020 at 00:40)</a>:</h4>
<blockquote>
<p>I also don't like packed-simd much. It's a weird benchmark. I guess you could say that's an argument for keeping it, but I don't feel like I've gotten utility from it</p>
</blockquote>
<p>I have, it stresses certain parts of rustc in ways that other benches don't (coherence)</p>



<a name="204869870"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/script-servo-2%20takes%20way%20too%20long/near/204869870" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/script-servo-2.20takes.20way.20too.20long.html#204869870">(Jul 24 2020 at 00:55)</a>:</h4>
<p><span class="user-mention" data-user-id="211727">@Jonas Schievink</span> I wonder if it could be cut down to something that doesn't take as long to run? It sounds like a stress test, basically, so it would be nice if it wasn't the 5th slowest benchmark</p>



<a name="204871634"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/script-servo-2%20takes%20way%20too%20long/near/204871634" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/script-servo-2.20takes.20way.20too.20long.html#204871634">(Jul 24 2020 at 01:35)</a>:</h4>
<p><span class="user-mention" data-user-id="120989">@njn</span> points are just how many times we've run that step so far, since we started gathering this data.</p>



<a name="204892230"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/script-servo-2%20takes%20way%20too%20long/near/204892230" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mati865 <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/script-servo-2.20takes.20way.20too.20long.html#204892230">(Jul 24 2020 at 08:46)</a>:</h4>
<p>IIRC packed-simd showed huge changes (40% and more) for few PRs while other benchmarks were neutral. Recently it was quite silent though.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>