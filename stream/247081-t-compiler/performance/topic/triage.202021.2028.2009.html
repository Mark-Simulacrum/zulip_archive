<html>
<head><meta charset="utf-8"><title>triage 2021 28 09 · t-compiler/performance · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/index.html">t-compiler/performance</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/triage.202021.2028.2009.html">triage 2021 28 09</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="255207859"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/triage%202021%2028%2009/near/255207859" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rylev <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/triage.202021.2028.2009.html#255207859">(Sep 28 2021 at 12:30)</a>:</h4>
<p>Starting triage now</p>



<a name="255208127"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/triage%202021%2028%2009/near/255208127" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rylev <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/triage.202021.2028.2009.html#255208127">(Sep 28 2021 at 12:32)</a>:</h4>
<p>One interesting change between calcNewSig and the old sig is <a href="https://perf.rust-lang.org/compare.html?start=583437a6dd58ee266839d2dac940642a0752a6dd&amp;end=3e8f32e1c52ca493c862facb7a69e7c3f1f97a18&amp;stat=instructions:u">this</a> is considered a regression in the old scheme and a "probably relevant" in the new scheme. The change is limited to one test case but the change is fairly large 2% change which 16 times bigger than the significance threshold. The reason we don't show this is because the change is rated as a "medium" siuze magnitude. This seems wrong.</p>



<a name="255208291"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/triage%202021%2028%2009/near/255208291" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rylev <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/triage.202021.2028.2009.html#255208291">(Sep 28 2021 at 12:33)</a>:</h4>
<p><a href="https://github.com/rust-lang/rustc-perf/blob/ff5938c1ae2f1098345ea3bdc5a74dad707bfc73/site/src/comparison.rs#L877">Here</a> is where we calculate magnitude of change. I think it's wrong to require a jump from 6 times the significance threshold to 18 times in order to go from a medium size change to a large one.</p>



<a name="255208334"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/triage%202021%2028%2009/near/255208334" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rylev <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/triage.202021.2028.2009.html#255208334">(Sep 28 2021 at 12:33)</a>:</h4>
<p>Again this is all arbitrary, but it feels wrong.</p>



<a name="255208650"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/triage%202021%2028%2009/near/255208650" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rylev <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/triage.202021.2028.2009.html#255208650">(Sep 28 2021 at 12:36)</a>:</h4>
<p>A cursory Google search doesn't return an obvious and common way to rank outliers (this is pushing my stats knowledge to its limit I'm afraid).</p>



<a name="255209205"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/triage%202021%2028%2009/near/255209205" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rylev <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/triage.202021.2028.2009.html#255209205">(Sep 28 2021 at 12:41)</a>:</h4>
<p>This medium to large change threshold used to be less than 10 times the significance threshold for medium and less than 25 times the significance threshold for large, but this was reduced a week ago</p>



<a name="255209958"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/triage%202021%2028%2009/near/255209958" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rylev <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/triage.202021.2028.2009.html#255209958">(Sep 28 2021 at 12:46)</a>:</h4>
<p>I created a PR that we can consider merging: <a href="https://github.com/rust-lang/rustc-perf/pull/1036">https://github.com/rust-lang/rustc-perf/pull/1036</a>. This moves the very large threshold to be 12x the significance threshold instead of 18x</p>



<a name="255212765"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/triage%202021%2028%2009/near/255212765" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rylev <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/triage.202021.2028.2009.html#255212765">(Sep 28 2021 at 13:07)</a>:</h4>
<p><span class="user-mention" data-user-id="116122">@simulacrum</span> I'm surprised to see a 10x sig threshold change on a change to only std lib doc comments (<a href="https://perf.rust-lang.org/compare.html?start=9620f3a84b079decfdc2e557be007580b097fe43&amp;end=addb4da686a97da46159f0123cb6cdc2ce3d7fdb&amp;stat=instructions:u">here</a>). Any thoughts on what could be causing that?</p>



<a name="255214116"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/triage%202021%2028%2009/near/255214116" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/triage.202021.2028.2009.html#255214116">(Sep 28 2021 at 13:17)</a>:</h4>
<p>The detailed view shows most of the regression in metadata_decode_entry_adt_def; maybe the size of the doc-comments has increased and the crate is so small it makes a noticeable difference?</p>



<a name="255222034"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/triage%202021%2028%2009/near/255222034" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/triage.202021.2028.2009.html#255222034">(Sep 28 2021 at 14:06)</a>:</h4>
<p>I think we're emitting a diagnostic we weren't before</p>



<a name="255222049"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/triage%202021%2028%2009/near/255222049" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/triage.202021.2028.2009.html#255222049">(Sep 28 2021 at 14:06)</a>:</h4>
<p>(or at least, that's my theory)</p>



<a name="255222074"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/triage%202021%2028%2009/near/255222074" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/triage.202021.2028.2009.html#255222074">(Sep 28 2021 at 14:07)</a>:</h4>
<p>will try to verify</p>



<a name="255222636"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/triage%202021%2028%2009/near/255222636" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/triage.202021.2028.2009.html#255222636">(Sep 28 2021 at 14:10)</a>:</h4>
<p>hm, no, that isn't it</p>



<a name="255222967"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/triage%202021%2028%2009/near/255222967" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/triage.202021.2028.2009.html#255222967">(Sep 28 2021 at 14:12)</a>:</h4>
<p>check_mod_liveness just ... didn't run in the parent?</p>



<a name="255224455"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/triage%202021%2028%2009/near/255224455" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/triage.202021.2028.2009.html#255224455">(Sep 28 2021 at 14:21)</a>:</h4>
<p>presumably incrunchanged changed the incr cache a little, trying to dump that now</p>



<a name="255228559"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/triage%202021%2028%2009/near/255228559" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/triage.202021.2028.2009.html#255228559">(Sep 28 2021 at 14:45)</a>:</h4>
<p>-Zdump-dep-graph seems to just.. not work</p>



<a name="255230058"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/triage%202021%2028%2009/near/255230058" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/triage.202021.2028.2009.html#255230058">(Sep 28 2021 at 14:54)</a>:</h4>
<p>ah, you need to pass query dep graph too...</p>



<a name="255250767"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/triage%202021%2028%2009/near/255250767" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rylev <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/triage.202021.2028.2009.html#255250767">(Sep 28 2021 at 16:56)</a>:</h4>
<p>Are we reasonably confident this wasn't a fluke? Would running the benchmark with these artifacts locally help?</p>



<a name="255251513"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/triage%202021%2028%2009/near/255251513" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/triage.202021.2028.2009.html#255251513">(Sep 28 2021 at 17:00)</a>:</h4>
<p>I'm working on investigating</p>



<a name="255251568"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/triage%202021%2028%2009/near/255251568" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/triage.202021.2028.2009.html#255251568">(Sep 28 2021 at 17:00)</a>:</h4>
<p>I'm pretty sure it's not a fluke in some sense, but I can't explain it just yet</p>



<a name="255251608"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/triage%202021%2028%2009/near/255251608" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/triage.202021.2028.2009.html#255251608">(Sep 28 2021 at 17:00)</a>:</h4>
<p>the query/dump dep graph are ICE'ing for me even in super simple programs, so that's stalling some of the work</p>



<a name="255251660"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/triage%202021%2028%2009/near/255251660" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rylev <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/triage.202021.2028.2009.html#255251660">(Sep 28 2021 at 17:01)</a>:</h4>
<p><span class="user-mention" data-user-id="116122">@simulacrum</span> any insight into what how you're investigating would be much appreciated. I'm not familiar with the best way to look into incremental compilation issues</p>



<a name="255251689"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/triage%202021%2028%2009/near/255251689" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/triage.202021.2028.2009.html#255251689">(Sep 28 2021 at 17:01)</a>:</h4>
<p>yeah I'll be sure to write it up</p>



<a name="255261397"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/triage%202021%2028%2009/near/255261397" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/triage.202021.2028.2009.html#255261397">(Sep 28 2021 at 17:19)</a>:</h4>
<p>It's definitely possible rustc is spending more time on an <code>allow</code>ed lint or something</p>



<a name="255262715"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/triage%202021%2028%2009/near/255262715" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/triage.202021.2028.2009.html#255262715">(Sep 28 2021 at 17:26)</a>:</h4>
<p>I don't think it's that</p>



<a name="255262756"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/triage%202021%2028%2009/near/255262756" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/triage.202021.2028.2009.html#255262756">(Sep 28 2021 at 17:27)</a>:</h4>
<p>there's a clear difference in query execution, some dependency edge is red now</p>



<a name="255273791"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/triage%202021%2028%2009/near/255273791" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rylev <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/triage.202021.2028.2009.html#255273791">(Sep 28 2021 at 18:29)</a>:</h4>
<p>PR is up: <a href="https://github.com/rust-lang/rustc-perf/pull/1037">https://github.com/rust-lang/rustc-perf/pull/1037</a></p>



<a name="255316931"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/triage%202021%2028%2009/near/255316931" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/triage.202021.2028.2009.html#255316931">(Sep 28 2021 at 23:25)</a>:</h4>
<p>well, that was fun</p>



<a name="255316942"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/triage%202021%2028%2009/near/255316942" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/triage.202021.2028.2009.html#255316942">(Sep 28 2021 at 23:25)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/pull/89343">https://github.com/rust-lang/rust/pull/89343</a> fixes -Zquery-dep-graph</p>



<a name="255316953"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/triage%202021%2028%2009/near/255316953" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/triage.202021.2028.2009.html#255316953">(Sep 28 2021 at 23:25)</a>:</h4>
<p>will try to get back to investigating this bug now</p>



<a name="255322804"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/triage%202021%2028%2009/near/255322804" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/triage.202021.2028.2009.html#255322804">(Sep 29 2021 at 00:30)</a>:</h4>
<p>sorry for meta, but what's up with the  "YYYY DD MM" date in the topic?</p>



<a name="255338971"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/triage%202021%2028%2009/near/255338971" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/triage.202021.2028.2009.html#255338971">(Sep 29 2021 at 04:08)</a>:</h4>
<p>oh wow yeah that's a very unfortunate format</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>