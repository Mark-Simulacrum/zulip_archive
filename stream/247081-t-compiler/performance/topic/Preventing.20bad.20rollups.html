<html>
<head><meta charset="utf-8"><title>Preventing bad rollups · t-compiler/performance · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/index.html">t-compiler/performance</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Preventing.20bad.20rollups.html">Preventing bad rollups</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="278527937"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Preventing%20bad%20rollups/near/278527937" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rylev <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Preventing.20bad.20rollups.html#278527937">(Apr 11 2022 at 09:26)</a>:</h4>
<p>Recently, <a href="https://github.com/rust-lang/rust/pull/95512">https://github.com/rust-lang/rust/pull/95512</a> was merged through a rollup. This is despite the fact that it changes 101 files and adds new dependencies. Unsurprisingly, it resulted in performance regressions but because it was rolled up it's very hard to look at the change in isolation. We've talked before about heuristics about what can and cannot be rolled up. Perhaps we can start by deny listing anything that adds dependencies to the compiler. This seems like an obvious heuristic for when not to roll a PR up.</p>



<a name="278529774"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Preventing%20bad%20rollups/near/278529774" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Preventing.20bad.20rollups.html#278529774">(Apr 11 2022 at 09:44)</a>:</h4>
<p>I can think of a few other good heuristics as well to disable roll-up by default. But also, difficulty of rolling back in isolation aside, I do think the amount of performance loss there is worth a roll back.</p>



<a name="278531431"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Preventing%20bad%20rollups/near/278531431" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matthiaskrgr <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Preventing.20bad.20rollups.html#278531431">(Apr 11 2022 at 10:01)</a>:</h4>
<p>Maybe we can just be a bit more careful with the rollups? :)<br>
If a pr already gets p=1 due to high bitrot chance and changes several thousand lines, just don't roll it up?  <br>
cc <span class="user-mention" data-user-id="120823">@DPC</span> do you check the prs in particular before adding them to a rollup or do you just tick a couple of boxes and launch the rollup ('cuz that could as well be automated).<br>
If there's something that looks risky by just touching a ton of different areas or having several thousand linechanges, it is usually better to just let it go through on its own.<br>
If there were prs that seemed risky I would usually just rollup=never them to eliminate the danger and make them jump up in the queue a bit.</p>



<a name="278531616"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Preventing%20bad%20rollups/near/278531616" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rylev <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Preventing.20bad.20rollups.html#278531616">(Apr 11 2022 at 10:03)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/247081-t-compiler.2Fperformance/topic/Preventing.20bad.20rollups/near/278529774">said</a>:</p>
<blockquote>
<p>But also, difficulty of rolling back in isolation aside, I do think the amount of performance loss there is worth a roll back.</p>
</blockquote>
<p>I created a <a href="#narrow/stream/247081-t-compiler.2Fperformance/topic/Reverting.20.2395512">new topic</a> to discuss this.</p>



<a name="278531716"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Preventing%20bad%20rollups/near/278531716" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rylev <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Preventing.20bad.20rollups.html#278531716">(Apr 11 2022 at 10:04)</a>:</h4>
<p><span class="user-mention silent" data-user-id="217864">matthiaskrgr</span> <a href="#narrow/stream/247081-t-compiler.2Fperformance/topic/Preventing.20bad.20rollups/near/278531431">said</a>:</p>
<blockquote>
<p>Maybe we can just be a bit more careful with the rollups? :)</p>
</blockquote>
<p>While I'm happy to have discussions on how we can all learn to be better at rollups, if we can automate something, we should.</p>



<a name="278532230"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Preventing%20bad%20rollups/near/278532230" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matthiaskrgr <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Preventing.20bad.20rollups.html#278532230">(Apr 11 2022 at 10:09)</a>:</h4>
<p>we could probably automate rollup=always rollups in batches of X or something.<br>
BUT when doing manual rollups, it can be nice to actually have a mix "might fail" and "rollup=always" because if the prs fails, it is usually easier to check 3 rollup=maybe prs for the failure than 7 or 10 <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span></p>



<a name="278535732"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Preventing%20bad%20rollups/near/278535732" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> DPC <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Preventing.20bad.20rollups.html#278535732">(Apr 11 2022 at 10:48)</a>:</h4>
<p>I do check the PRs as much as I can, not all depending on the situation</p>



<a name="278536045"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Preventing%20bad%20rollups/near/278536045" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> DPC <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Preventing.20bad.20rollups.html#278536045">(Apr 11 2022 at 10:52)</a>:</h4>
<p>I wouldn't automate rollup=always pr since generally those prs are small and shouldn't get more priority than ones in the queue</p>



<a name="278664817"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Preventing%20bad%20rollups/near/278664817" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rylev <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Preventing.20bad.20rollups.html#278664817">(Apr 12 2022 at 08:55)</a>:</h4>
<p>FYI: talking in <a class="stream" data-stream-id="242791" href="/#narrow/stream/242791-t-infra">#t-infra</a>  about ways to address this <a href="#narrow/stream/242791-t-infra/topic/Reactive.20rustbot">here</a>.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>