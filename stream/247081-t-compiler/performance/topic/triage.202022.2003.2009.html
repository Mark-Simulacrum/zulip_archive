<html>
<head><meta charset="utf-8"><title>triage 2022 03 09 · t-compiler/performance · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/index.html">t-compiler/performance</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/triage.202022.2003.2009.html">triage 2022 03 09</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="274736142"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/triage%202022%2003%2009/near/274736142" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/triage.202022.2003.2009.html#274736142">(Mar 09 2022 at 19:03)</a>:</h4>
<p>getting absurdly late start on this week's triage, sorry y'all. <span aria-label="sad" class="emoji emoji-2639" role="img" title="sad">:sad:</span></p>



<a name="274752589"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/triage%202022%2003%2009/near/274752589" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/triage.202022.2003.2009.html#274752589">(Mar 09 2022 at 21:07)</a>:</h4>
<p>Rollup of 9 pull requests <a href="https://github.com/rust-lang/rust/pull/94541">#94541</a></p>
<ul>
<li>Arithmetic mean of relevant regressions: 1.5%</li>
<li>Largest regression in <a href="https://perf.rust-lang.org/compare.html?start=8769f4ef2fe1efddd1f072485f97f568e7328f79&amp;end=2f\
8d1a835b4e7feaf625f74d0d5cb9b84dbc845a&amp;stat=instructions:u">instruction counts</a>: 3.9% on <code>full</code> builds of <code>deeply-nested-async check</code></li>
</ul>



<a name="274752730"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/triage%202022%2003%2009/near/274752730" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/triage.202022.2003.2009.html#274752730">(Mar 09 2022 at 21:09)</a>:</h4>
<p>not clear on what PR in the rollup caused the regressions. (Also, can someone remind me: Do we not do perf runs on rollups ahead of time because ... it would overload the perf runner? Because people doing rollups would not know what to do with the results? I'm having difficulty understanding why we wouldn't do this safeguard <em>ahead</em> of time here.)</p>



<a name="274752965"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/triage%202022%2003%2009/near/274752965" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/triage.202022.2003.2009.html#274752965">(Mar 09 2022 at 21:11)</a>:</h4>
<p>The regressions more significant than 1% are isolated to <code>deeply-nested-async</code> (which is consistently seeing between 3-4% regression) and <code>ctfe-stress-4</code> (which is seeing 1.2% regression).</p>



<a name="274753810"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/triage%202022%2003%2009/near/274753810" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/triage.202022.2003.2009.html#274753810">(Mar 09 2022 at 21:19)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116083">pnkfelix</span> <a href="#narrow/stream/247081-t-compiler.2Fperformance/topic/triage.202022.2003.2009/near/274752730">said</a>:</p>
<blockquote>
<p>not clear on what PR in the rollup caused the regressions. (Also, can someone remind me: Do we not do perf runs on rollups ahead of time because ... it would overload the perf runner? Because people doing rollups would not know what to do with the results? I'm having difficulty understanding why we wouldn't do this safeguard <em>ahead</em> of time here.)</p>
</blockquote>
<p>(i moved follow up notes here over to <a class="stream-topic" data-stream-id="247081" href="/#narrow/stream/247081-t-compiler.2Fperformance/topic/why.20no.20perf.20runs.20on.20rollup.20PRs.20before.20merge.3F">#t-compiler/performance &gt; why no perf runs on rollup PRs before merge?</a>  )</p>



<a name="274755829"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/triage%202022%2003%2009/near/274755829" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/triage.202022.2003.2009.html#274755829">(Mar 09 2022 at 21:36)</a>:</h4>
<p>the deeply-nested-async regressions <a href="https://perf.rust-lang.org/detailed-query.html?sort_idx=-11&amp;commit=2f8d1a835b4e7feaf625f74d0d5cb9b84dbc845a&amp;base_commit=8769f4ef2fe1efddd1f072485f97f568e7328f79&amp;benchmark=deeply-nested-async-check&amp;scenario=full">appear to be</a> in check_mod_privacy, according to self-profile results.</p>



<a name="274756115"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/triage%202022%2003%2009/near/274756115" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/triage.202022.2003.2009.html#274756115">(Mar 09 2022 at 21:39)</a>:</h4>
<p>(ctfe-stress-4 doesn't have as much useful info in its <a href="https://perf.rust-lang.org/detailed-query.html?commit=2f8d1a835b4e7feaf625f74d0d5cb9b84dbc845a&amp;base_commit=8769f4ef2fe1efddd1f072485f97f568e7328f79&amp;benchmark=ctfe-stress-4-check&amp;scenario=incr-full">detailed results</a> ...)</p>



<a name="274758200"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/triage%202022%2003%2009/near/274758200" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/triage.202022.2003.2009.html#274758200">(Mar 09 2022 at 21:58)</a>:</h4>
<p>At this point, looking at the chart, deeply-nested-async regressed with PR <a href="https://github.com/rust-lang/rust/issues/94541">#94541</a> and stayed at the regressed level until PR <a href="https://github.com/rust-lang/rust/issues/94570">#94570</a> landed. Once the latter landed, deeply-nested-async improved by 6.9%. (The 6.9% improvement was registered in PR <a href="https://github.com/rust-lang/rust/issues/95470">#95470</a> both <a href="https://github.com/rust-lang/rust/pull/94570#issuecomment-1058839731">before merge</a> and <a href="https://github.com/rust-lang/rust/pull/94570#issuecomment-1059367507">after merge</a>, which leads me to think that the improvement there is legitimate, but it wasn't a matter of it undoing the regression; just masking it...</p>



<a name="274758898"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/triage%202022%2003%2009/near/274758898" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/triage.202022.2003.2009.html#274758898">(Mar 09 2022 at 22:03)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116083">pnkfelix</span> <a href="#narrow/stream/247081-t-compiler.2Fperformance/topic/triage.202022.2003.2009/near/274758200">said</a>:</p>
<blockquote>
<p>it wasn't a matter of it undoing the regression; just masking it...</p>
</blockquote>
<p>The concrete numbers support this, I think. check_mod_privacy took <a href="https://perf.rust-lang.org/detailed-query.html?commit=2f8d1a835b4e7feaf625f74d0d5cb9b84dbc845a&amp;benchmark=deeply-nested-async-check&amp;scenario=full">0.076 s</a> with <a href="https://github.com/rust-lang/rust/issues/94541">#94541</a>, and still takes <a href="https://perf.rust-lang.org/detailed-query.html?commit=b4bf56cd66ca83e908fd43bde4c627f94b2a8a9f&amp;base_commit=047f9c4bc4e26df4f54c3c76af3e963782ed05e4&amp;benchmark=deeply-nested-async-check&amp;scenario=full">0.072 s</a> with <a href="https://github.com/rust-lang/rust/issues/94570">#94570</a>. Before <a href="https://github.com/rust-lang/rust/issues/94541">#94541</a>, it took <a href="https://perf.rust-lang.org/detailed-query.html?commit=8769f4ef2fe1efddd1f072485f97f568e7328f79&amp;benchmark=deeply-nested-async-check&amp;scenario=full">0.067 s</a></p>



<a name="274758981"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/triage%202022%2003%2009/near/274758981" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/triage.202022.2003.2009.html#274758981">(Mar 09 2022 at 22:04)</a>:</h4>
<p>though at this point I think this all still might be in the noise, especially since I didn't see anything in the rollup PR that seemed like it could affect <code>check_mod_privacy</code> ...</p>



<a name="274759216"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/triage%202022%2003%2009/near/274759216" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/triage.202022.2003.2009.html#274759216">(Mar 09 2022 at 22:06)</a>:</h4>
<p>marking as triaged</p>



<a name="274760087"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/triage%202022%2003%2009/near/274760087" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/triage.202022.2003.2009.html#274760087">(Mar 09 2022 at 22:14)</a>:</h4>
<p>Support GATs in Rustdoc <a href="https://github.com/rust-lang/rust/pull/94009">#94009</a></p>
<ul>
<li>Arithmetic mean of relevant regressions: 0.8%</li>
<li>Largest regression in <a href="https://perf.rust-lang.org/compare.html?start=40d3040ae19b8c43c0027bc6d3e9805e5ee5e0ee&amp;end=6d\
7684101a51f1c375ec84aef5d2fbdeb214bbc2&amp;stat=instructions:u">instruction counts</a>: 1.1% on <code>full</code> builds of <code>ctfe-stress-4 doc</code></li>
</ul>



<a name="274760434"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/triage%202022%2003%2009/near/274760434" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/triage.202022.2003.2009.html#274760434">(Mar 09 2022 at 22:16)</a>:</h4>
<p>Already triaged by rustdoc team. <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span></p>



<a name="274760621"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/triage%202022%2003%2009/near/274760621" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/triage.202022.2003.2009.html#274760621">(Mar 09 2022 at 22:18)</a>:</h4>
<p>rustdoc: Stop textually replacing <code>Self</code> in doc links before resolving them <a href="https://github.com/rust-lang/rust/pull/93805">#93805</a></p>
<ul>
<li>Arithmetic mean of relevant regressions: 0.3%</li>
<li>Arithmetic mean of all relevant changes: 0.3%</li>
<li>Largest regression in <a href="https://perf.rust-lang.org/compare.html?start=0cbef1c6a7f4ee33cd41d91778544c5399f10f39&amp;end=16\
61e4c7e0e68b4297aec095064d80566d4ea2b1&amp;stat=instructions:u">instruction counts</a>: 1.0% on <code>full</code> builds of <code>serde doc</code></li>
</ul>



<a name="274760651"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/triage%202022%2003%2009/near/274760651" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/triage.202022.2003.2009.html#274760651">(Mar 09 2022 at 22:18)</a>:</h4>
<p>rustdoc team left comment; they did not expect a regression here.</p>



<a name="274760729"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/triage%202022%2003%2009/near/274760729" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/triage.202022.2003.2009.html#274760729">(Mar 09 2022 at 22:18)</a>:</h4>
<p>to be fair, the only notable regression, I think, was to serde doc. Everything else is very low, e.g. 0.27%</p>



<a name="274766517"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/triage%202022%2003%2009/near/274766517" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/triage.202022.2003.2009.html#274766517">(Mar 09 2022 at 23:12)</a>:</h4>
<p>okay, triage report PR is up here: <a href="https://github.com/rust-lang/rustc-perf/pull/1198">https://github.com/rust-lang/rustc-perf/pull/1198</a></p>



<a name="274766565"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/triage%202022%2003%2009/near/274766565" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/triage.202022.2003.2009.html#274766565">(Mar 09 2022 at 23:12)</a>:</h4>
<p>wait, I forgot to write a summary <span aria-label="face palm" class="emoji emoji-1f926" role="img" title="face palm">:face_palm:</span></p>



<a name="274766732"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/triage%202022%2003%2009/near/274766732" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/triage.202022.2003.2009.html#274766732">(Mar 09 2022 at 23:14)</a>:</h4>
<p>okay, fixed that</p>



<a name="274766889"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/triage%202022%2003%2009/near/274766889" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/triage.202022.2003.2009.html#274766889">(Mar 09 2022 at 23:16)</a>:</h4>
<p>and TWIR PR is up here: <a href="https://github.com/rust-lang/this-week-in-rust/pull/3024">https://github.com/rust-lang/this-week-in-rust/pull/3024</a></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>