<html>
<head><meta charset="utf-8"><title>max-rss over 2022-03 · t-compiler/performance · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/index.html">t-compiler/performance</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/max-rss.20over.202022-03.html">max-rss over 2022-03</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="277194155"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/max-rss%20over%202022-03/near/277194155" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/max-rss.20over.202022-03.html#277194155">(Mar 30 2022 at 19:22)</a>:</h4>
<p>Hey y'all, I was looking at the <a href="https://perf.rust-lang.org/?start=2022-03-01&amp;end=2022-03-30&amp;kind=percentfromfirst&amp;stat=max-rss">max-rss data for march</a> and it seemed worth talking about</p>



<a name="277194190"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/max-rss%20over%202022-03/near/277194190" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/max-rss.20over.202022-03.html#277194190">(Mar 30 2022 at 19:23)</a>:</h4>
<p>It <em>seems</em> like we might have had a slight regression here over the past month. I'm not yet sure what to attribute it to</p>



<a name="277194322"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/max-rss%20over%202022-03/near/277194322" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/max-rss.20over.202022-03.html#277194322">(Mar 30 2022 at 19:24)</a>:</h4>
<p>Some of the phase shift might be attributable to PR <a href="https://github.com/rust-lang/rust/issues/90253">#90253</a>; if you look at <a href="https://perf.rust-lang.org/compare.html?start=af8604faddc44b27a59d1a719ff6ceca8bc145eb&amp;end=c9b45e601065c3fb71a4f67481e912391d075621&amp;stat=max-rss">max-rss for its associated perf run</a> you do see a fair amount of red</p>



<a name="277194370"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/max-rss%20over%202022-03/near/277194370" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/max-rss.20over.202022-03.html#277194370">(Mar 30 2022 at 19:24)</a>:</h4>
<p>(though the "low" significance factor may lead me to conclude that its a mistake to look just there...)</p>



<a name="277194686"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/max-rss%20over%202022-03/near/277194686" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/max-rss.20over.202022-03.html#277194686">(Mar 30 2022 at 19:28)</a>:</h4>
<p>maybe I'm just attaching too much importance to small shifts in the summary data.  E.g. I thought from the Summary-debug graph that maybe <a href="https://github.com/rust-lang/rust/issues/95056">#95056</a> represents another regressive phase shift, but the associated <a href="https://perf.rust-lang.org/compare.html?start=4ca56d2b7bbe275bc6c9f3cd698c6e0719a07182&amp;end=cd119057160cedea245aa2679add56723f3dc784&amp;stat=max-rss">max-rss for its perf run</a> isn't triggering any red flags for me.</p>



<a name="277194803"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/max-rss%20over%202022-03/near/277194803" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/max-rss.20over.202022-03.html#277194803">(Mar 30 2022 at 19:29)</a>:</h4>
<p>I'm currently planning to at least mention the max-rss in the triage report</p>



<a name="277197916"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/max-rss%20over%202022-03/near/277197916" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Beránek <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/max-rss.20over.202022-03.html#277197916">(Mar 30 2022 at 20:00)</a>:</h4>
<p>We should add a notification to the PR comment summary if RSS changes too much (<a href="#narrow/stream/247081-t-compiler.2Fperformance/topic/Performance.20summary.20only.20warns.20about.20icount">https://rust-lang.zulipchat.com/#narrow/stream/247081-t-compiler.2Fperformance/topic/Performance.20summary.20only.20warns.20about.20icount</a>). I'll try to design some prototype once <a href="https://github.com/rust-lang/rustc-perf/pull/1245">https://github.com/rust-lang/rustc-perf/pull/1245</a> lands.</p>



<a name="277202072"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/max-rss%20over%202022-03/near/277202072" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/max-rss.20over.202022-03.html#277202072">(Mar 30 2022 at 20:47)</a>:</h4>
<p>It's expected that <code>IndexMap</code> takes more space than <code>HashMap</code> for the same data, because it adds index storage, and also stores hashes to recoup some performance.</p>



<a name="277202241"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/max-rss%20over%202022-03/near/277202241" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/max-rss.20over.202022-03.html#277202241">(Mar 30 2022 at 20:49)</a>:</h4>
<p>Whether that's significant in the grand scheme is another question.</p>



<a name="277293740"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/max-rss%20over%202022-03/near/277293740" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/max-rss.20over.202022-03.html#277293740">(Mar 31 2022 at 14:54)</a>:</h4>
<p><span class="user-mention silent" data-user-id="138448">cuviper</span> <a href="#narrow/stream/247081-t-compiler.2Fperformance/topic/max-rss.20over.202022-03/near/277202072">said</a>:</p>
<blockquote>
<p>It's expected that <code>IndexMap</code> takes more space than <code>HashMap</code> for the same data, because it adds index storage, and also stores hashes to recoup some performance.</p>
</blockquote>
<p>huh. "adds index storage" ==&gt; I would have assumed the indexes were left implicit, and you'd convert back from <code>usize</code> to the index type on demand.</p>



<a name="277293794"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/max-rss%20over%202022-03/near/277293794" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/max-rss.20over.202022-03.html#277293794">(Mar 31 2022 at 14:55)</a>:</h4>
<p>so now I'm looking at the implementation ...</p>



<a name="277294045"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/max-rss%20over%202022-03/near/277294045" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/max-rss.20over.202022-03.html#277294045">(Mar 31 2022 at 14:56)</a>:</h4>
<p>oh oh oh, of course: to be drop-in replacement for HashMap, you need to have map from hashcode to index</p>



<a name="277294144"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/max-rss%20over%202022-03/near/277294144" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/max-rss.20over.202022-03.html#277294144">(Mar 31 2022 at 14:57)</a>:</h4>
<p>(I was assuming <code>IndexMap</code> was something else entirely; a map structure where the keys are themselves newtype'd usizes)</p>



<a name="277294354"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/max-rss%20over%202022-03/near/277294354" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/max-rss.20over.202022-03.html#277294354">(Mar 31 2022 at 14:59)</a>:</h4>
<p>okay, yes, I was thinking of <a href="https://docs.rs/index_vec/latest/index_vec/"><code>index_vec</code></a></p>



<a name="277295116"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/max-rss%20over%202022-03/near/277295116" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/max-rss.20over.202022-03.html#277295116">(Mar 31 2022 at 15:04)</a>:</h4>
<p>The <code>vec_map</code> crate is another form of implicit <code>usize</code> key</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>