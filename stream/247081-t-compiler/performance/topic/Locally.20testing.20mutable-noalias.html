<html>
<head><meta charset="utf-8"><title>Locally testing mutable-noalias · t-compiler/performance · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/index.html">t-compiler/performance</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Locally.20testing.20mutable-noalias.html">Locally testing mutable-noalias</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="278595809"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Locally%20testing%20mutable-noalias/near/278595809" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Kimock (Saethlin) <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Locally.20testing.20mutable-noalias.html#278595809">(Apr 11 2022 at 18:20)</a>:</h4>
<p>I'm trying to get some idea of the impact of <code>mutable-noalias</code>, so I figured I'd start with the rustc-perf suite. I built the compiler with <code>RUSTFLAGS_BOOTSTRAP=-Zmutable-noalias=yes x build --stage 2</code> then I ran the collector with these arguments:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">bench_local</span><span class="w"> </span><span class="o">--</span><span class="n">id</span><span class="w"> </span><span class="n">yes</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">ben</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">stage2</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">rustc</span><span class="w"> </span><span class="o">--</span><span class="n">scenarios</span><span class="w"> </span><span class="n">Full</span><span class="w"> </span><span class="o">--</span><span class="n">profiles</span><span class="w"> </span><span class="n">Check</span><span class="w"> </span><span class="o">--</span><span class="n">iterations</span><span class="w"> </span><span class="mi">20</span><span class="w"></span>
</code></pre></div>
<p>I found that switching to <code>mutable-noalias=no</code> was a 0.0% difference with some incredible precision, only about +/- 0.05% across benchmarks.</p>
<p>Did I do something wrong here? I feel like I should have seen <em>something</em>.</p>



<a name="278595938"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Locally%20testing%20mutable-noalias/near/278595938" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Locally.20testing.20mutable-noalias.html#278595938">(Apr 11 2022 at 18:21)</a>:</h4>
<p>RUSTFLAGS_BOOTSTRAP will not affect the stage 2 binary, I believe, so that seems unsurprising. You probably want regular RUSTFLAGS.</p>



<a name="278602260"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Locally%20testing%20mutable-noalias/near/278602260" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Kimock (Saethlin) <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Locally.20testing.20mutable-noalias.html#278602260">(Apr 11 2022 at 19:06)</a>:</h4>
<p>Would it affect the stage 1 binary?</p>



<a name="278602960"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Locally%20testing%20mutable-noalias/near/278602960" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Locally.20testing.20mutable-noalias.html#278602960">(Apr 11 2022 at 19:13)</a>:</h4>
<p>You are benchmarking the stage 2 binary.</p>



<a name="278603315"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Locally%20testing%20mutable-noalias/near/278603315" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Kimock (Saethlin) <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Locally.20testing.20mutable-noalias.html#278603315">(Apr 11 2022 at 19:16)</a>:</h4>
<p>Uhhhh yeah but I could be benchmarking the stage 1 binary</p>



<a name="278603615"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Locally%20testing%20mutable-noalias/near/278603615" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Kimock (Saethlin) <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Locally.20testing.20mutable-noalias.html#278603615">(Apr 11 2022 at 19:19)</a>:</h4>
<p><span aria-label="face palm" class="emoji emoji-1f926" role="img" title="face palm">:face_palm:</span> I just totally missed the part of the dev guide that explains this</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>