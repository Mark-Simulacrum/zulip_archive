<html>
<head><meta charset="utf-8"><title>Updating real-world benchmarks · t-compiler/performance · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/index.html">t-compiler/performance</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html">Updating real-world benchmarks</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="273700357"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/273700357" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#273700357">(Mar 01 2022 at 19:52)</a>:</h4>
<p>The <a href="https://hackmd.io/YJQSj_nLSZWl2sbI84R1qA?view">perf roadmap</a> has a "Better benchmarks" section. The first item is 'Split into “primary” and “secondary” benchmarks', which <span class="user-mention" data-user-id="266526">@Jakub Beránek</span> has well in hand.</p>
<p>The second item is 'Update the real-world benchmarks'. I'd like to get this done sooner rather than later. Our real-world benchmarks are largely years out of date and I think we should update them all. Some considerations...</p>
<ul>
<li>This would give us a big discontinuity in the data. But we've had that before, e.g. two years ago the data format changed and you can't make comparisons earlier than that. I think having a long-term data set isn't that important, short- to medium-term regression/improvement detection is more important, and my blog posts can be used (roughly) for longer term evaluations.</li>
<li>Having said that, <a href="https://perf.rust-lang.org/dashboard.html">https://perf.rust-lang.org/dashboard.html</a> <em>is</em> nice, and is based on a subset of 8 benchmarks: encoding, futures, html5ever, inflate, regex, style-servo, syn, tokio-webpush-simple. Not sure what to do about this.</li>
<li>How should we name things? In the past we've just added numeric suffixes, e.g. <code>hyper-2</code> and <code>ctfe-stress-4</code>. For real-world benchmarks, I think we should go with proper version numbers, e.g. <code>syn-1.0.86</code>. It's a bit visually noisy, but very precise.</li>
<li>Who wants to do the updating? <span class="user-mention" data-user-id="116122">@simulacrum</span>, you've done it in the past, but I know you're also busy with many different things.</li>
</ul>



<a name="273701000"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/273701000" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#273701000">(Mar 01 2022 at 19:56)</a>:</h4>
<blockquote>
<p>I think having a long-term data set isn't that important, </p>
</blockquote>
<p>It can be useful for pointing people to how rustc gets faster when they complain that rust is fundamentally a slow language.</p>



<a name="273701076"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/273701076" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#273701076">(Mar 01 2022 at 19:56)</a>:</h4>
<p>Yeah, the dashboard is an interesting question. I think there's been a bunch of debate over the methodology there too (e.g., arith mean vs. geomean on the set of benchmarks). I suspect that if we arrive at a set of benchmarks that work across all those releases, we could update the set, but it's probably difficult to find a modern crate that builds in 1.20 or something.</p>



<a name="273701105"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/273701105" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#273701105">(Mar 01 2022 at 19:57)</a>:</h4>
<p>I think putting version numbers for <a href="http://crates.io">crates.io</a> crates makes sense to me.</p>



<a name="273701186"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/273701186" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#273701186">(Mar 01 2022 at 19:57)</a>:</h4>
<p>In terms of the update itself, I think we'll want to <em>add</em> new benchmarks, and then 24-48 hours later, drop the old ones. That way no try build &amp; master commit is useless, etc.</p>



<a name="273703886"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/273703886" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#273703886">(Mar 01 2022 at 20:17)</a>:</h4>
<p><span class="user-mention silent" data-user-id="133247">bjorn3</span> <a href="#narrow/stream/247081-t-compiler.2Fperformance/topic/Updating.20real-world.20benchmarks/near/273701000">said</a>:</p>
<blockquote>
<blockquote>
<p>I think having a long-term data set isn't that important, </p>
</blockquote>
<p>It can be useful for pointing people to how rustc gets faster when they complain that rust is fundamentally a slow language.</p>
</blockquote>
<p>It can be, but for me that's a relatively low priority. There's an inherent tension between "have up-to-date benchmarks" and "have a long data history" and "keep the benchmark suite a manageable size", and for me the long data history is less important.</p>



<a name="273704186"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/273704186" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#273704186">(Mar 01 2022 at 20:20)</a>:</h4>
<p>We could semi-retire some benchmarks and only run them once &lt;some interval&gt;?</p>



<a name="273704370"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/273704370" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#273704370">(Mar 01 2022 at 20:21)</a>:</h4>
<p>I think that has fairly high complexity costs and is not worthwhile IMO; I agree that long data history is not <em>that</em> critical. In practice, measuring a constant set of benchmarks also means we're missing out on newer features that may contribute to compile times, so there's no actual good answer here I suspect</p>



<a name="273705039"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/273705039" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#273705039">(Mar 01 2022 at 20:26)</a>:</h4>
<p>Analyze history to find those benchmarks that managed to identify some regressions/improvements that others weren't? Or clusters of redundant benchmarks that always point in the same direction (something like PCA?).</p>



<a name="273870229"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/273870229" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#273870229">(Mar 02 2022 at 20:16)</a>:</h4>
<p>Another possibility: keep the "stable" benchmarks around, possibly as "secondary" benchmarks, possibly in a separate category from "primary" and "secondary", and only run them for the dashboard.</p>



<a name="273870568"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/273870568" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#273870568">(Mar 02 2022 at 20:19)</a>:</h4>
<p>Yeah, I'd worry about them breaking over time -- we've had to patch a little -- but it seems OK</p>



<a name="273870653"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/273870653" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#273870653">(Mar 02 2022 at 20:20)</a>:</h4>
<p>the last point (master) is problematic there, but solvable with some work</p>



<a name="273870710"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/273870710" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#273870710">(Mar 02 2022 at 20:20)</a>:</h4>
<p>I'm also interested in removing style-servo, because it's so slow and doesn't provide enough insight for its size, especially the opt builds</p>



<a name="273870737"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/273870737" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#273870737">(Mar 02 2022 at 20:21)</a>:</h4>
<p><span class="user-mention" data-user-id="116122">@simulacrum</span> sorry, what does "master" mean here?</p>



<a name="273870764"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/273870764" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#273870764">(Mar 02 2022 at 20:21)</a>:</h4>
<p><a href="/user_uploads/4715/apfC9lOfI0GRDrrB5dhpTwgO/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/apfC9lOfI0GRDrrB5dhpTwgO/image.png" title="image.png"><img src="/user_uploads/4715/apfC9lOfI0GRDrrB5dhpTwgO/image.png"></a></div>



<a name="273870789"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/273870789" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#273870789">(Mar 02 2022 at 20:21)</a>:</h4>
<p>the last datapoint we show is from master data collection, not a dedicated nightly run or somethin</p>



<a name="273870974"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/273870974" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#273870974">(Mar 02 2022 at 20:23)</a>:</h4>
<p>Oh, so keeping that data point up to date would be hard if we don't run the stable benchmarks every time?</p>



<a name="273871144"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/273871144" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#273871144">(Mar 02 2022 at 20:24)</a>:</h4>
<p>right. we could just delete it.</p>



<a name="273871209"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/273871209" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#273871209">(Mar 02 2022 at 20:24)</a>:</h4>
<p>Yeah, I can live without that point on the graph. How are the other points collected? Is there a special per-release run?</p>



<a name="273871290"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/273871290" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#273871290">(Mar 02 2022 at 20:25)</a>:</h4>
<p>yeah, ad-hoc</p>



<a name="273871713"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/273871713" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#273871713">(Mar 02 2022 at 20:28)</a>:</h4>
<p>Ok, then I suggest keeping the dashboard ones around in their current state, and putting them in their own category. (They already kind of have their own category, "supports_stable: true".) Only measure them for the dashboard. Drop the "master" data point on the dashboard. And include updated versions in the primary benchmarks (e.g. <code>syn-1.0.86</code>).</p>



<a name="273871750"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/273871750" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#273871750">(Mar 02 2022 at 20:28)</a>:</h4>
<p>That sounds good to me.</p>



<a name="273871839"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/273871839" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#273871839">(Mar 02 2022 at 20:29)</a>:</h4>
<p>I wonder if putting benchmarks in directories to reflect their category is wise, e.g. <code>primary/</code>, <code>secondary/</code>, and <code>stable/</code> (or whatever this last category is called)</p>



<a name="273871965"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/273871965" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#273871965">(Mar 02 2022 at 20:30)</a>:</h4>
<p>Yeah, seems ok. Definitely increases burden of moving them (since there's typically lots and lots of files), vs. just editing a field in JSON</p>



<a name="273872162"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/273872162" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#273872162">(Mar 02 2022 at 20:30)</a>:</h4>
<p>(I half want to move the database-name of crates into the JSON for similar reasons).</p>



<a name="273872184"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/273872184" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#273872184">(Mar 02 2022 at 20:30)</a>:</h4>
<p><span class="user-mention" data-user-id="266526">@Jakub Beránek</span> Not sure if these ideas affect <a href="https://github.com/rust-lang/rustc-perf/pull/1181">https://github.com/rust-lang/rustc-perf/pull/1181</a></p>



<a name="273872209"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/273872209" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#273872209">(Mar 02 2022 at 20:30)</a>:</h4>
<p>Increases the burden? Isn't it just a <code>git mv</code>? Or is there more to it than that</p>



<a name="273872317"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/273872317" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#273872317">(Mar 02 2022 at 20:31)</a>:</h4>
<p>I just mean in terms of, like, git diff</p>



<a name="273872386"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/273872386" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#273872386">(Mar 02 2022 at 20:32)</a>:</h4>
<p>and probably long-term git history bloat, though maybe compression is magical</p>



<a name="273872855"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/273872855" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Beránek <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#273872855">(Mar 02 2022 at 20:36)</a>:</h4>
<p>I suppose that it's mostly orthogonal. But we can also generalize the category concept and have something like "stable", "latest" and "stress-test" categories or something like that. I suppose that stress tests don't need updating and only the real world crates should be updated from time to time.</p>



<a name="273877128"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/273877128" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#273877128">(Mar 02 2022 at 21:07)</a>:</h4>
<p>I can draft a document today capturing all these details, including which benchmarks need updating, etc.</p>



<a name="273929451"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/273929451" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#273929451">(Mar 03 2022 at 06:35)</a>:</h4>
<p>Ok, <a href="https://hackmd.io/d9uE7qgtTWKDLivy0uoVQw?view">https://hackmd.io/d9uE7qgtTWKDLivy0uoVQw?view</a> is the doc, I've done a draft of the "primary" section, I'll do the "secondary" section tomorrow.</p>



<a name="273948194"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/273948194" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#273948194">(Mar 03 2022 at 09:52)</a>:</h4>
<p>I ended up doing the secondary section now, it was much quicker</p>



<a name="274006473"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/274006473" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rylev <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#274006473">(Mar 03 2022 at 17:20)</a>:</h4>
<p>Does it make sense for us to document a justification for why each of the benchmarks is included? It would be nice to have at least some prose that provides an idea of why a benchmark is included and a rough idea of how representative the benchmarks are of all Rust "interesting" programs (by interesting I just mean having some sort of real world use or relevance)</p>



<a name="274007358"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/274007358" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#274007358">(Mar 03 2022 at 17:26)</a>:</h4>
<p>One possible concern for applying these is the runtime of the performance suite. Right now we're at ~1.5 hours pretty much exactly, which I suspect is not our <em>limit</em> but something we shouldn't go too much above. (CI takes ~2h20m on auto; around 1.5 hours for try builds). We can definitely horizontally scale out but it would take some engineering work (mostly not design, though).</p>
<p>I think this is something that we'll just need to deal with on a case-by-case basis though.</p>



<a name="274007463"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/274007463" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#274007463">(Mar 03 2022 at 17:27)</a>:</h4>
<p>I think justifications are a good idea, particularly around those that are explicitly regression tests -- maybe regression-issue-num is enough for that though in the future.</p>



<a name="274015291"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/274015291" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#274015291">(Mar 03 2022 at 18:16)</a>:</h4>
<p>It would also be good to describe what part of the compiler or which scenario a benchmark exercises, link to the issue where it was introduced etc. A little README.perf.md for each?</p>



<a name="274035242"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/274035242" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#274035242">(Mar 03 2022 at 20:30)</a>:</h4>
<p>Clearly everyone has forgotten about <a href="https://github.com/rust-lang/rustc-perf/blob/master/collector/benchmarks/README.md">https://github.com/rust-lang/rustc-perf/blob/master/collector/benchmarks/README.md</a> <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="274035301"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/274035301" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#274035301">(Mar 03 2022 at 20:31)</a>:</h4>
<p><span class="user-mention" data-user-id="116122">@simulacrum</span> about runtime: this is part of the reason I'm keen to remove a few benchmarks, including style-servo</p>



<a name="274035379"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/274035379" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#274035379">(Mar 03 2022 at 20:32)</a>:</h4>
<p>README.md is great, we should just keep it in sync as we make these changes :)</p>



<a name="274035410"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/274035410" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#274035410">(Mar 03 2022 at 20:32)</a>:</h4>
<p>Yep, <span class="user-mention" data-user-id="266526">@Jakub Beránek</span> has updates for it for the primary/secondary split</p>



<a name="274035421"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/274035421" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#274035421">(Mar 03 2022 at 20:32)</a>:</h4>
<p>Yes, I think dropping style-servo and some others is a good idea. It's hard to estimate what the total runtime will be, but I figure we can play it by ear.</p>



<a name="274056082"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/274056082" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#274056082">(Mar 03 2022 at 23:26)</a>:</h4>
<p>I restructured the doc slightly so the primary benchmarks that require decisions are all grouped together, and the easy cases are grouped together</p>



<a name="276262752"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/276262752" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#276262752">(Mar 22 2022 at 22:22)</a>:</h4>
<p><span class="user-mention" data-user-id="266526">@Jakub Beránek</span> Something weird has happened in <a href="https://github.com/rust-lang/rustc-perf/pull/1224/commits">https://github.com/rust-lang/rustc-perf/pull/1224/commits</a></p>



<a name="276262754"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/276262754" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#276262754">(Mar 22 2022 at 22:22)</a>:</h4>
<p>I see this:</p>



<a name="276262766"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/276262766" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#276262766">(Mar 22 2022 at 22:22)</a>:</h4>
<p><a href="/user_uploads/4715/GXjutEh6MO_NpYX5NmkU9JL3/ripgrep.png">ripgrep.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/GXjutEh6MO_NpYX5NmkU9JL3/ripgrep.png" title="ripgrep.png"><img src="/user_uploads/4715/GXjutEh6MO_NpYX5NmkU9JL3/ripgrep.png"></a></div>



<a name="276262836"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/276262836" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#276262836">(Mar 22 2022 at 22:23)</a>:</h4>
<p>It looks like the first line of the commit message is just <code>@Kobzol</code>.</p>



<a name="276262859"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/276262859" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#276262859">(Mar 22 2022 at 22:23)</a>:</h4>
<p>And GitHub is linkifying that to your profile, so I can't click on it to look at the individual commit.</p>



<a name="276263755"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/276263755" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Beránek <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#276263755">(Mar 22 2022 at 22:33)</a>:</h4>
<p>Yeah it's rendered in a weird way <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span> You can see the diff here: <a href="https://github.com/rust-lang/rustc-perf/compare/52168972f03438ebc9f27d8f405638542b5c8559..2850d140b2594572f62542013ab4bd070b798395">https://github.com/rust-lang/rustc-perf/compare/52168972f03438ebc9f27d8f405638542b5c8559..2850d140b2594572f62542013ab4bd070b798395</a></p>



<a name="276264878"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/276264878" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#276264878">(Mar 22 2022 at 22:46)</a>:</h4>
<p><span class="user-mention" data-user-id="266526">@Jakub Beránek</span> I think that's just the changes you made in response to my earlier comments?</p>



<a name="276265788"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/276265788" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#276265788">(Mar 22 2022 at 22:58)</a>:</h4>
<p>About webrender: I asked one of the devs about cutting a new release, but he didn't sound very keen. So I will just pull a recent revision. Question is what to name it. Two options come to mind:</p>
<ul>
<li><code>webrender-78502fd</code> (where 78502fd is the revision)</li>
</ul>



<a name="276265826"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/276265826" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#276265826">(Mar 22 2022 at 22:59)</a>:</h4>
<ul>
<li><code>webrender-2022</code></li>
</ul>



<a name="276265857"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/276265857" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#276265857">(Mar 22 2022 at 22:59)</a>:</h4>
<p>Please vote for your favourite with an emoji reaction, or suggest an alternative</p>



<a name="276266772"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/276266772" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Beránek <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#276266772">(Mar 22 2022 at 23:09)</a>:</h4>
<p><span class="user-mention" data-user-id="120989">@nnethercote</span> yup, you can see that diff by clicking on the "force-pushed" text on the PR. The full diff can be seen <a href="https://github.com/rust-lang/rustc-perf/pull/1224/commits/2850d140b2594572f62542013ab4bd070b798395">here</a>.</p>



<a name="276267472"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/276267472" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#276267472">(Mar 22 2022 at 23:17)</a>:</h4>
<p><span class="user-mention" data-user-id="266526">@Jakub Beránek</span> What does the commit message look like on your machine?</p>



<a name="276268420"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/276268420" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#276268420">(Mar 22 2022 at 23:28)</a>:</h4>
<p><code>html5ever</code> is similar to webrender: still under development, but no release for 2+ years. I'll probably end up pulling in a recent revision as <code>html5ever-2022</code></p>



<a name="276279768"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/276279768" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#276279768">(Mar 23 2022 at 01:48)</a>:</h4>
<p>I just talked to one of the html5ever maintainers, he said he'll do a release for me this week, yay</p>



<a name="276298022"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/276298022" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Beránek <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#276298022">(Mar 23 2022 at 07:54)</a>:</h4>
<p><span class="user-mention" data-user-id="120989">@nnethercote</span> oh, the commit message indeed did contain my nickname, I probably pasted it by accident <span aria-label="face palm" class="emoji emoji-1f926" role="img" title="face palm">:face_palm:</span> fixed now, thanks.</p>



<a name="276396926"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/276396926" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#276396926">(Mar 23 2022 at 20:39)</a>:</h4>
<p>I asked <span class="user-mention" data-user-id="222471">@BurntSushi</span> about <code>ripgrep</code> and <code>regex</code> as benchmarks he said the following:</p>



<a name="276397113"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/276397113" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#276397113">(Mar 23 2022 at 20:41)</a>:</h4>
<blockquote>
<p>BurntSushi: to be honest, i don't know. i'm not sure i know what it is that you should watch out for in such a benchmark.</p>
<p>when it comes to ripgrep, indeed, most of the code is in other crates. grep 0.2 itself doesn't have much actually. it's a facade in front of a whole bunch of other crates: grep-searcher, grep-matcher, grep-regex, grep-printer, etc etc.</p>
<p>compile time of the final crate is definitely less interesting. what would be more interesting i think is the compilation time of the final crate plus a few of the core crates, e.g., any crate with a prefix of grep-. that would be good. but that's interesting to _me and my workflow_, which may not be interesting to y'all.</p>
<p>another interesting bit is the link time to produce the final executable, but i presume that is not something y'all are measuring.</p>
<p>as for regex, i can't think of anything at present. but it's worth mentioning i think that in the next ~year or so, regex will itself become much thinner, with most of the code moving out to regex-automata.</p>
<p>. o O { i wonder if it's useful to add a new benchmark? regex-syntax in particular is what I'm thinking of. it's a beefy crate, changes very slowly and is a required dependency of regex that itself has no dependencies. }</p>
<p>memchr crate might be another one. it is depended on a lot, and i recently (about a year ago) added a fair bit more code to it.</p>
</blockquote>



<a name="276397187"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/276397187" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#276397187">(Mar 23 2022 at 20:41)</a>:</h4>
<p>I already have memchr on my list of benchmarks to potentially add, because it's used so widely.</p>



<a name="276397291"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/276397291" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#276397291">(Mar 23 2022 at 20:42)</a>:</h4>
<p>I'm wondering if we should (a) do <code>regex-syntax</code> instead of <code>regex</code>, and (b) possibly just drop ripgrep-13.0.0.</p>



<a name="276397335"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/276397335" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#276397335">(Mar 23 2022 at 20:42)</a>:</h4>
<p>(I know people have done the work to update <code>ripgrep</code> and <code>regex</code> already, so apologies for the lateness of this discusion.)</p>



<a name="276397362"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/276397362" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#276397362">(Mar 23 2022 at 20:43)</a>:</h4>
<p>I am interested to hear people's thoughts here</p>



<a name="276408681"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/276408681" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rylev <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#276408681">(Mar 23 2022 at 22:18)</a>:</h4>
<p>It sounds like there’s a good argument for removing ripgrep. I’m less convinced that removing regex is a good idea. It seems like it’s currently still going to exercise the compiler enough to be interesting even if it’s possible that this might change in the future. </p>
<p>I think there’s also a non-technical argument to be had for keeping popular crates as benchmarks even if there might be other crates that are ever so slightly better benchmarks as this gives people confidence we’re testing crates the community cares about. Obviously this could be fixed with good communication and docs, but I do think it’s worth considering. </p>
<p>That all being said I don’t feel strongly either way.</p>



<a name="276408776"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/276408776" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#276408776">(Mar 23 2022 at 22:19)</a>:</h4>
<p>I do think it's worth adding dependency crates when those are the ones that are more complex and performance-sensitive.</p>



<a name="276408793"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/276408793" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#276408793">(Mar 23 2022 at 22:19)</a>:</h4>
<p>regex-syntax for instance.</p>



<a name="276408869"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/276408869" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#276408869">(Mar 23 2022 at 22:20)</a>:</h4>
<p>I do wonder to what extent people <em>know</em> that seeing <code>ripgrep</code> in the benchmark suite doesn't mean it includes all dependencies.</p>



<a name="276408886"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/276408886" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rylev <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#276408886">(Mar 23 2022 at 22:20)</a>:</h4>
<p>Also, as a semi-related side note: it would be good to document our decision making for all crates we’ve included and left out. For instance it would be good to note in docs that we don’t benchmark the futures crates because it’s essentially just re-exporting</p>



<a name="276410550"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/276410550" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#276410550">(Mar 23 2022 at 22:33)</a>:</h4>
<p><a href="https://github.com/rust-lang/rustc-perf/blob/master/collector/benchmarks/README.md">https://github.com/rust-lang/rustc-perf/blob/master/collector/benchmarks/README.md</a></p>



<a name="276412047"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/276412047" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#276412047">(Mar 23 2022 at 22:46)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/247081-t-compiler.2Fperformance/topic/Updating.20real-world.20benchmarks/near/276408869">said</a>:</p>
<blockquote>
<p>I do wonder to what extent people <em>know</em> that seeing <code>ripgrep</code> in the benchmark suite doesn't mean it includes all dependencies.</p>
</blockquote>
<p>I wouldn't assume anything on this front <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="276429953"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/276429953" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#276429953">(Mar 24 2022 at 03:52)</a>:</h4>
<p>I swear <code>collector download</code> was doing 4 space indents on <code>perf-config.json</code> the other day, but I just ran it and got 2 spaces</p>



<a name="276436838"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/276436838" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#276436838">(Mar 24 2022 at 06:25)</a>:</h4>
<p>Wild idea: is it possible to do some analysis on the historical data and say "benchmark X doesn't seem useful because every regression or improvement it had also appeared on some other benchmark in the same run"?</p>



<a name="276444085"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/276444085" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#276444085">(Mar 24 2022 at 08:30)</a>:</h4>
<p>some of the old benchmarks had a <code>touch_file</code> in their perf config, am I missing some use cases of that key ?</p>
<ul>
<li>the benchmark had multiple bin/lib targets</li>
<li>the benchmark was a workspace with multiple in-tree members </li>
</ul>
<p>I'm assuming that if the new benchmarks aren't in either of these 2 cases that we don't need to add anything special in <code>perf-config.json</code>, is that correct ?</p>



<a name="276550377"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/276550377" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#276550377">(Mar 24 2022 at 23:01)</a>:</h4>
<p>That matches my understanding. It would be good to have the perf-config.json fields documented somewhere, I don't think we have that currently</p>



<a name="277193309"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/277193309" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#277193309">(Mar 30 2022 at 19:15)</a>:</h4>
<p><span class="user-mention" data-user-id="116113">@lqd</span> I think removing hyper-2 is the only step remaining for updating the existing primary benchmarks. Are you happy to do that?</p>



<a name="277193436"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/277193436" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#277193436">(Mar 30 2022 at 19:16)</a>:</h4>
<p>absolutely, I'll do that now (edit: opened PR 1262)</p>



<a name="277194423"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/277194423" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#277194423">(Mar 30 2022 at 19:25)</a>:</h4>
<p><span class="user-mention" data-user-id="116113">@lqd</span> thanks!   r=me</p>



<a name="277194499"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/277194499" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#277194499">(Mar 30 2022 at 19:26)</a>:</h4>
<p>I'll merge as soon as CI is green then</p>



<a name="277195231"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/277195231" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#277195231">(Mar 30 2022 at 19:33)</a>:</h4>
<p>a cool trick hackmd supports (and so does GH) and we could have used in the doc is:</p>
<ul>
<li>[ ] for tasks to do</li>
<li>[x] for completed tasks</li>
</ul>
<p><a href="/user_uploads/4715/WRCWyF2aTTC9XZYV61-X6_ep/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/WRCWyF2aTTC9XZYV61-X6_ep/image.png" title="image.png"><img src="/user_uploads/4715/WRCWyF2aTTC9XZYV61-X6_ep/image.png"></a></div>



<a name="277198657"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/277198657" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#277198657">(Mar 30 2022 at 20:08)</a>:</h4>
<p>Oh, that's much better than the <del>strikeout</del> I've been using. I'll change the documents accordingly</p>



<a name="277199990"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/277199990" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#277199990">(Mar 30 2022 at 20:23)</a>:</h4>
<p>I was about to update that document earlier today but waited a bit to check if you also liked it</p>



<a name="277200033"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/277200033" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#277200033">(Mar 30 2022 at 20:23)</a>:</h4>
<p>I just finished updating the benchmark overhaul doc and the roadmap doc <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="277200119"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/277200119" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#277200119">(Mar 30 2022 at 20:24)</a>:</h4>
<p>And I see you merged the hyper-2 removal, which means I can tick the "Update the real-world benchmarks." item in the roadmap <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="277200423"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Updating%20real-world%20benchmarks/near/277200423" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Updating.20real-world.20benchmarks.html#277200423">(Mar 30 2022 at 20:28)</a>:</h4>
<p>I had it already <del>struckthrough</del> <span aria-label="joy" class="emoji emoji-1f602" role="img" title="joy">:joy:</span> (is that a word ? it should be a word)</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>