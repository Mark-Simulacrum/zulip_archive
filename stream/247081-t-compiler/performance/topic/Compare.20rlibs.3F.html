<html>
<head><meta charset="utf-8"><title>Compare rlibs? · t-compiler/performance · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/index.html">t-compiler/performance</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Compare.20rlibs.3F.html">Compare rlibs?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="259437048"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Compare%20rlibs%3F/near/259437048" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Compare.20rlibs.3F.html#259437048">(Oct 28 2021 at 19:05)</a>:</h4>
<p>How do I compare two rlibs produced by different versions of the compiler? I have a compiler change that causes the binary size to increase and I want to find out where the increase occurs.</p>



<a name="259440704"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Compare%20rlibs%3F/near/259440704" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Compare.20rlibs.3F.html#259440704">(Oct 28 2021 at 19:35)</a>:</h4>
<p>rlibs are regular static archives, so you can use binutils on them</p>



<a name="259440789"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Compare%20rlibs%3F/near/259440789" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Compare.20rlibs.3F.html#259440789">(Oct 28 2021 at 19:36)</a>:</h4>
<p>like <code>ar tv foo.rlib</code> to get a verbose list of contents</p>



<a name="259441122"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Compare%20rlibs%3F/near/259441122" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Compare.20rlibs.3F.html#259441122">(Oct 28 2021 at 19:39)</a>:</h4>
<p>I discovered <code>objdump -d</code> but it's too verbose to make sense of the diff. Is there a way to get just instruction counts per function?</p>



<a name="259463619"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Compare%20rlibs%3F/near/259463619" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> erikdesjardins <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Compare.20rlibs.3F.html#259463619">(Oct 28 2021 at 23:03)</a>:</h4>
<p><code>nm --size-sort -r foo.rlib</code> will give sizes in bytes, although it may only include exported symbols</p>



<a name="259463666"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Compare%20rlibs%3F/near/259463666" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> erikdesjardins <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Compare.20rlibs.3F.html#259463666">(Oct 28 2021 at 23:04)</a>:</h4>
<p>i don't know of an easy way to get instruction count; you could hack it together with <code>objdump -d | awk 'count lines after each header - left as an exercise for the reader'</code><br>
but i don't think instruction count is quite what you want if you're concerned about binary size</p>



<a name="259464021"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Compare%20rlibs%3F/near/259464021" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Compare.20rlibs.3F.html#259464021">(Oct 28 2021 at 23:08)</a>:</h4>
<p>see also <a href="https://github.com/RazrFalcon/cargo-bloat">https://github.com/RazrFalcon/cargo-bloat</a>, but</p>
<blockquote>
<p>only 'bin', 'dylib' and 'cdylib' crate types are supported.</p>
</blockquote>



<a name="259464039"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Compare%20rlibs%3F/near/259464039" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Compare.20rlibs.3F.html#259464039">(Oct 28 2021 at 23:08)</a>:</h4>
<p>seems like it should be possible to do the same for <code>rlib</code> objects though</p>



<a name="259532017"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Compare%20rlibs%3F/near/259532017" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Compare.20rlibs.3F.html#259532017">(Oct 29 2021 at 14:26)</a>:</h4>
<p>Thanks for the tips. Another question - is it possible to get a MIR dump of an entire crate?</p>



<a name="259532984"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/Compare%20rlibs%3F/near/259532984" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/Compare.20rlibs.3F.html#259532984">(Oct 29 2021 at 14:34)</a>:</h4>
<p>--emit=mir should work</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>