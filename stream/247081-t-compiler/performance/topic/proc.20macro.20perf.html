<html>
<head><meta charset="utf-8"><title>proc macro perf · t-compiler/performance · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/index.html">t-compiler/performance</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html">proc macro perf</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="260859556"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260859556" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexis King <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260859556">(Nov 09 2021 at 20:57)</a>:</h4>
<p><span class="user-mention silent" data-user-id="133247">bjorn3</span> <a href="#narrow/stream/131828-t-compiler/topic/The.20state.20of.20proc.20macros/near/260859110">said</a>:</p>
<blockquote>
<p>Macros are currently expanded before the incremental compilation system kicks in. The HIR is the input to the incremental compilation system. Everything before it is done every compilation. Some proc macros also can't be cached as they eg read from files or query a database for the database schema.</p>
</blockquote>
<p>Yes, this was the impression I’d gotten from reading around, thanks. Do you know if this causes meaningful compile-time perf issues in real programs?</p>



<a name="260859703"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260859703" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexis King <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260859703">(Nov 09 2021 at 20:58)</a>:</h4>
<p>i.e. would it be worth it to make it possible for macroexpansion to be more incremental, or is it a non-issue and therefore not worth the effort</p>



<a name="260860359"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260860359" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260860359">(Nov 09 2021 at 21:00)</a>:</h4>
<p>FYI, there's documentation about the query system <a href="https://rustc-dev-guide.rust-lang.org/overview.html#queries">here</a> and <a href="https://rustc-dev-guide.rust-lang.org/query.html">here</a>.</p>



<a name="260860780"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260860780" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexis King <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260860780">(Nov 09 2021 at 21:03)</a>:</h4>
<p>Yes, I’ve been reading it! Though I’ll admit I can only really claim to have skimmed a lot of it so far :)</p>



<a name="260861075"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260861075" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260861075">(Nov 09 2021 at 21:05)</a>:</h4>
<p><span class="user-mention" data-user-id="456123">@Alexis King</span> HIR lowering needs to be incremental before it's possible for resolving to be incremental. See most of the PRs by <span class="user-mention silent" data-user-id="248906">cjgillot</span> : <a href="https://github.com/rust-lang/rust/pulls/cjgillot">https://github.com/rust-lang/rust/pulls/cjgillot</a></p>
<p>If resolving were incremental it would fix quite a lot of rustdoc's problems, but that's still probably several years out. <a href="https://github.com/rust-lang/rust/issues/83761">https://github.com/rust-lang/rust/issues/83761</a></p>



<a name="260861233"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260861233" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260861233">(Nov 09 2021 at 21:06)</a>:</h4>
<p>I wouldn't expect the time saved from not running the resolver to be significant, but it might cause downstream queries not to be rerun, which could save a lot of time</p>



<a name="260861307"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260861307" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260861307">(Nov 09 2021 at 21:06)</a>:</h4>
<blockquote>
<p>Do you know if this causes meaningful compile-time perf issues in real programs?</p>
</blockquote>
<p>It depends a lot on the program. For some programs, link time is the largest factor especially in incremental scenarios. Other programs lean heavily into type-level programming and trait resolution takes a significant amount of time. </p>
<p>Usually macro expansion isn't a significant amount of time because if it does a while to run, it's usually generating a lot of code which then takes much longer to type check, codegen, etc.</p>



<a name="260861800"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260861800" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexis King <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260861800">(Nov 09 2021 at 21:10)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/131828-t-compiler/topic/The.20state.20of.20proc.20macros/near/260861075">said</a>:</p>
<blockquote>
<p>HIR lowering needs to be incremental before it's possible for resolving to be incremental.</p>
</blockquote>
<p>Ah, that makes sense, thanks… I don’t think I understand the rustdoc issue you linked, but I think that’s probably okay for now, haha</p>



<a name="260861854"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260861854" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260861854">(Nov 09 2021 at 21:11)</a>:</h4>
<p>yeah it's quite complicated <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span> and not really related to macros</p>



<a name="260861948"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260861948" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexis King <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260861948">(Nov 09 2021 at 21:12)</a>:</h4>
<p><span class="user-mention silent" data-user-id="125250">Wesley Wiser</span> <a href="#narrow/stream/131828-t-compiler/topic/The.20state.20of.20proc.20macros/near/260861307">said</a>:</p>
<blockquote>
<p>Usually macro expansion isn't a significant amount of time because if it does a while to run, it's usually generating a lot of code which then takes much longer to type check, codegen, etc.</p>
</blockquote>
<p>But the typechecking, codegen, etc. can be incrementalized, right? Whereas the macroexpansion currently cannot be, so I don’t immediately see how it would necessarily be in the margins</p>



<a name="260862031"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260862031" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260862031">(Nov 09 2021 at 21:12)</a>:</h4>
<p><span class="user-mention" data-user-id="456123">@Alexis King</span> consider running <code>-Ztime-passes</code> on a rust crate and seeing how long it takes in practice</p>



<a name="260862227"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260862227" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexis King <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260862227">(Nov 09 2021 at 21:14)</a>:</h4>
<p>Sure—is there a particular crate that would be a good test here/uses a lot of proc macros? I am afraid I am not very familiar at all with the Rust ecosystem</p>



<a name="260862526"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260862526" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260862526">(Nov 09 2021 at 21:16)</a>:</h4>
<p>here's a random one for cargo: <a href="https://perf.rust-lang.org/detailed-query.html?sort_idx=-2&amp;commit=07acdb48a0e0b22d08a45e3ced0378e0027b40eb&amp;run_name=incr-patched:%20println&amp;benchmark=cargo-opt">https://perf.rust-lang.org/detailed-query.html?sort_idx=-2&amp;commit=07acdb48a0e0b22d08a45e3ced0378e0027b40eb&amp;run_name=incr-patched:%20println&amp;benchmark=cargo-opt</a></p>



<a name="260862547"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260862547" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260862547">(Nov 09 2021 at 21:16)</a>:</h4>
<p>notice how codegen vastly dominates the time</p>



<a name="260862589"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260862589" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260862589">(Nov 09 2021 at 21:16)</a>:</h4>
<p>wow it really just be all LLVM huh <span aria-label="sob" class="emoji emoji-1f62d" role="img" title="sob">:sob:</span></p>



<a name="260862647"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260862647" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260862647">(Nov 09 2021 at 21:17)</a>:</h4>
<p>here's one from the same commit for diesel, which is extremely trait heavy: <a href="https://perf.rust-lang.org/detailed-query.html?sort_idx=-2&amp;commit=07acdb48a0e0b22d08a45e3ced0378e0027b40eb&amp;run_name=full&amp;benchmark=diesel-opt">https://perf.rust-lang.org/detailed-query.html?sort_idx=-2&amp;commit=07acdb48a0e0b22d08a45e3ced0378e0027b40eb&amp;run_name=full&amp;benchmark=diesel-opt</a></p>



<a name="260862685"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260862685" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260862685">(Nov 09 2021 at 21:17)</a>:</h4>
<p>is <code>expand_crate</code> macro stuff</p>



<a name="260862741"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260862741" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260862741">(Nov 09 2021 at 21:18)</a>:</h4>
<p>yeah, macro expansion + resolution (they happen at the same time)</p>



<a name="260862820"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260862820" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260862820">(Nov 09 2021 at 21:18)</a>:</h4>
<p>I've noticed that <code>expand_crate</code> takes up a significant percentage of rustdoc doc runs (although perhaps that's resolution as Joshua said)</p>



<a name="260862884"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260862884" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260862884">(Nov 09 2021 at 21:19)</a>:</h4>
<p><span class="user-mention" data-user-id="307537">@Noah Lev</span> rustdoc also does a lot less work than the compiler usually</p>



<a name="260862942"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260862942" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260862942">(Nov 09 2021 at 21:19)</a>:</h4>
<p>Yeah, but it's still worth improving rustdoc run times :)</p>



<a name="260863112"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260863112" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260863112">(Nov 09 2021 at 21:20)</a>:</h4>
<p>I would rather reduce the amount of memory resolution uses; <a href="https://github.com/microsoft/windows-docs-rs/pull/6#issuecomment-904022881">https://github.com/microsoft/windows-docs-rs/pull/6#issuecomment-904022881</a> has some truly horrifying numbers lol</p>



<a name="260863218"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260863218" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260863218">(Nov 09 2021 at 21:21)</a>:</h4>
<p>(reducing memory usage will probably make it faster anyway since malloc is doing less work)</p>



<a name="260863247"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260863247" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260863247">(Nov 09 2021 at 21:21)</a>:</h4>
<blockquote>
<p>(for the curious, here is the output of -Ztime-passes on bindings, I hope to take a closer look at it this weekend)</p>
</blockquote>
<p>oof</p>



<a name="260863449"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260863449" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexis King <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260863449">(Nov 09 2021 at 21:23)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/131828-t-compiler/topic/The.20state.20of.20proc.20macros/near/260862547">said</a>:</p>
<blockquote>
<p>notice how codegen vastly dominates the time</p>
</blockquote>
<p>what I’d really like to see are the numbers for an incremental rebuild after a trivial change (i.e. one that invalidates almost nothing in the cache) with no LTO and no optimizations… which I can try myself, ofc, I was just curious if anyone was already complaining about this</p>



<a name="260863506"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260863506" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260863506">(Nov 09 2021 at 21:23)</a>:</h4>
<p>You can get those numbers from rustc-perf as well</p>



<a name="260863536"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260863536" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260863536">(Nov 09 2021 at 21:24)</a>:</h4>
<p>that <em>was</em> incremental :P</p>



<a name="260863576"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260863576" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260863576">(Nov 09 2021 at 21:24)</a>:</h4>
<p>it says "incr-patched" at the top</p>



<a name="260863589"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260863589" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260863589">(Nov 09 2021 at 21:24)</a>:</h4>
<p>Yeah, I just noticed that <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="260863621"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260863621" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260863621">(Nov 09 2021 at 21:24)</a>:</h4>
<p>Although that's an opt build</p>



<a name="260863646"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260863646" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260863646">(Nov 09 2021 at 21:24)</a>:</h4>
<p>debug: <a href="https://perf.rust-lang.org/detailed-query.html?sort_idx=-2&amp;commit=07acdb48a0e0b22d08a45e3ced0378e0027b40eb&amp;run_name=incr-patched:%20println&amp;benchmark=cargo-debug">https://perf.rust-lang.org/detailed-query.html?sort_idx=-2&amp;commit=07acdb48a0e0b22d08a45e3ced0378e0027b40eb&amp;run_name=incr-patched:%20println&amp;benchmark=cargo-debug</a><br>
check: <a href="https://perf.rust-lang.org/detailed-query.html?sort_idx=-2&amp;commit=07acdb48a0e0b22d08a45e3ced0378e0027b40eb&amp;run_name=incr-patched:%20println&amp;benchmark=cargo-check">https://perf.rust-lang.org/detailed-query.html?sort_idx=-2&amp;commit=07acdb48a0e0b22d08a45e3ced0378e0027b40eb&amp;run_name=incr-patched:%20println&amp;benchmark=cargo-check</a></p>



<a name="260863651"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260863651" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260863651">(Nov 09 2021 at 21:24)</a>:</h4>
<p>Here's a debug build: <a href="https://perf.rust-lang.org/detailed-query.html?sort_idx=-2&amp;commit=07acdb48a0e0b22d08a45e3ced0378e0027b40eb&amp;run_name=incr-patched:%20println&amp;benchmark=cargo-debug">https://perf.rust-lang.org/detailed-query.html?sort_idx=-2&amp;commit=07acdb48a0e0b22d08a45e3ced0378e0027b40eb&amp;run_name=incr-patched:%20println&amp;benchmark=cargo-debug</a></p>



<a name="260863669"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260863669" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexis King <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260863669">(Nov 09 2021 at 21:24)</a>:</h4>
<p>Yes, I did say “with no LTO and no optimizations” for a reason :) So thanks!</p>



<a name="260863714"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260863714" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260863714">(Nov 09 2021 at 21:25)</a>:</h4>
<p>whats the <code>check:</code> one from?</p>



<a name="260863726"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260863726" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260863726">(Nov 09 2021 at 21:25)</a>:</h4>
<p>it doesnt seem to actually say the crate</p>



<a name="260863734"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260863734" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260863734">(Nov 09 2021 at 21:25)</a>:</h4>
<p>Cargo</p>



<a name="260863756"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260863756" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260863756">(Nov 09 2021 at 21:25)</a>:</h4>
<blockquote>
<p>07acdb48a0: Self profile results for <strong>cargo</strong>-check run incr-patched: println</p>
</blockquote>



<a name="260863772"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260863772" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260863772">(Nov 09 2021 at 21:25)</a>:</h4>
<p>(The benchmark <em>is</em> cargo)</p>



<a name="260863775"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260863775" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260863775">(Nov 09 2021 at 21:25)</a>:</h4>
<p>i thought that was the command being run...</p>



<a name="260863780"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260863780" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260863780">(Nov 09 2021 at 21:25)</a>:</h4>
<p>lol</p>



<a name="260863858"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260863858" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260863858">(Nov 09 2021 at 21:26)</a>:</h4>
<p>Yeah, the UI could be improved</p>



<a name="260863873"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260863873" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260863873">(Nov 09 2021 at 21:26)</a>:</h4>
<p>okay wow then.. so cargo also spends most of its time doing macro expansion?</p>



<a name="260863879"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260863879" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexis King <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260863879">(Nov 09 2021 at 21:26)</a>:</h4>
<p>What is the actual patch being applied before the incremental rebuild here?</p>



<a name="260863925"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260863925" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260863925">(Nov 09 2021 at 21:26)</a>:</h4>
<p><a href="https://github.com/rust-lang/rustc-perf/blob/master/collector/benchmarks/cargo/0-println.patch">https://github.com/rust-lang/rustc-perf/blob/master/collector/benchmarks/cargo/0-println.patch</a></p>



<a name="260863985"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260863985" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexis King <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260863985">(Nov 09 2021 at 21:27)</a>:</h4>
<p>Ah cool, thanks… that’s definitely still a lot of time in codegen, then, haha</p>



<a name="260864123"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260864123" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260864123">(Nov 09 2021 at 21:28)</a>:</h4>
<p>do we have these benches setup to also give timings with cg-cranelift</p>



<a name="260864131"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260864131" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260864131">(Nov 09 2021 at 21:28)</a>:</h4>
<p><span class="user-mention silent" data-user-id="456123">Alexis King</span> <a href="#narrow/stream/131828-t-compiler/topic/proc.20macro.20perf/near/260863985">said</a>:</p>
<blockquote>
<p>Ah cool, thanks… that’s definitely still a lot of time in codegen, then, haha</p>
</blockquote>
<p>see also <a href="https://github.com/rust-lang/rust/issues/82685">https://github.com/rust-lang/rust/issues/82685</a> and <a href="https://github.com/rust-lang/rust/issues/89308">https://github.com/rust-lang/rust/issues/89308</a></p>



<a name="260864137"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260864137" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260864137">(Nov 09 2021 at 21:28)</a>:</h4>
<p><span class="user-mention" data-user-id="326176">@Boxy [she/her]</span> no, not to my knowledge</p>



<a name="260864217"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260864217" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260864217">(Nov 09 2021 at 21:29)</a>:</h4>
<p>we should land <a href="https://github.com/rust-lang/rust/pull/81746">https://github.com/rust-lang/rust/pull/81746</a> first IMO</p>



<a name="260864226"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260864226" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexis King <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260864226">(Nov 09 2021 at 21:29)</a>:</h4>
<p>the expansion time does still seem less trivial to me than one would probably hope given how little has changed, but it does seem like probably small potatoes relatively speaking, I guess</p>



<a name="260864274"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260864274" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260864274">(Nov 09 2021 at 21:29)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/131828-t-compiler/topic/proc.20macro.20perf/near/260863646">said</a>:</p>
<blockquote>
<p>check: <a href="https://perf.rust-lang.org/detailed-query.html?sort_idx=-2&amp;commit=07acdb48a0e0b22d08a45e3ced0378e0027b40eb&amp;run_name=incr-patched:%20println&amp;benchmark=cargo-check">https://perf.rust-lang.org/detailed-query.html?sort_idx=-2&amp;commit=07acdb48a0e0b22d08a45e3ced0378e0027b40eb&amp;run_name=incr-patched:%20println&amp;benchmark=cargo-check</a></p>
</blockquote>
<p><span class="user-mention" data-user-id="456123">@Alexis King</span> FWIW it's pretty large in the <code>check</code> build</p>



<a name="260864467"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260864467" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260864467">(Nov 09 2021 at 21:31)</a>:</h4>
<p>but also, that's counting resolution <em>and</em> MBE expansion <em>and</em> running proc-macros</p>



<a name="260864484"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260864484" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260864484">(Nov 09 2021 at 21:31)</a>:</h4>
<p>plus things like <code>include_str</code> which touch disk</p>



<a name="260864530"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260864530" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260864530">(Nov 09 2021 at 21:31)</a>:</h4>
<p>unsure if out-of-line modules are loaded from disk during parsing or not</p>



<a name="260864533"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260864533" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260864533">(Nov 09 2021 at 21:31)</a>:</h4>
<p>this thread is a rollercoaster</p>



<a name="260864541"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260864541" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexis King <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260864541">(Nov 09 2021 at 21:31)</a>:</h4>
<p>yeah, I saw that… I was thinking maybe that wasn’t a huge deal because it wasn’t clear to me how important that was, but I guess that’s a bit of a stupid thought in retrospect, given all the tooling support needs to pay that time but doesn’t need to do any codegen</p>



<a name="260864677"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260864677" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260864677">(Nov 09 2021 at 21:32)</a>:</h4>
<p><span class="user-mention silent" data-user-id="326176">Boxy [she/her]</span> <a href="#narrow/stream/131828-t-compiler/topic/proc.20macro.20perf/near/260864533">said</a>:</p>
<blockquote>
<p>this thread is a rollercoaster</p>
</blockquote>
<p>josh's top tip for recruiting people to work on rustc: flood them with information until they find some of it interesting <span aria-label="joy" class="emoji emoji-1f602" role="img" title="joy">:joy:</span></p>



<a name="260864793"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260864793" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260864793">(Nov 09 2021 at 21:33)</a>:</h4>
<p><span class="user-mention silent" data-user-id="456123">Alexis King</span> <a href="#narrow/stream/131828-t-compiler/topic/proc.20macro.20perf/near/260864541">said</a>:</p>
<blockquote>
<p>yeah, I saw that… I was thinking maybe that wasn’t a huge deal because it wasn’t clear to me how important that was, but I guess that’s a bit of a stupid thought in retrospect, given all the tooling support needs to pay that time but doesn’t need to do any codegen</p>
</blockquote>
<p>yeah I would say <code>check</code> time is pretty important; there's a reason it started being measured way before rustdoc</p>



<a name="260864929"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260864929" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexis King <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260864929">(Nov 09 2021 at 21:34)</a>:</h4>
<p>yeah I am coming from a haskell background where all our tooling is broken anyway so all that matters is <code>-O0</code> build times <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span></p>



<a name="260864982"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260864982" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260864982">(Nov 09 2021 at 21:34)</a>:</h4>
<p>That sure is what i recall of Haskell</p>



<a name="260864984"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260864984" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexis King <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260864984">(Nov 09 2021 at 21:34)</a>:</h4>
<p>(sort of joking, it’s gotten better in recent years, but it’s still fun to laugh about it)</p>



<a name="260865216"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260865216" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260865216">(Nov 09 2021 at 21:36)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/131828-t-compiler/topic/proc.20macro.20perf/near/260864484">said</a>:</p>
<blockquote>
<p>plus things like <code>include_str</code> which touch disk</p>
</blockquote>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/131828-t-compiler/topic/proc.20macro.20perf/near/260864530">said</a>:</p>
<blockquote>
<p>unsure if out-of-line modules are loaded from disk during parsing or not</p>
</blockquote>
<p>if someone wants to work on expansion perf, measuring this and other built-in macros separately might be a good first step</p>



<a name="260865322"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260865322" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260865322">(Nov 09 2021 at 21:37)</a>:</h4>
<p>is <code>check</code> a good thing to measure if you want to measure like... "IDE response time" of spitting out errors</p>



<a name="260865337"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260865337" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexis King <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260865337">(Nov 09 2021 at 21:37)</a>:</h4>
<p>yeah, I’d be interested in trying to measure the cost a bit more carefully eventually, but for now I’m mostly just trying to get a vague intuition for where the problem points of the current impl are</p>



<a name="260865346"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260865346" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260865346">(Nov 09 2021 at 21:37)</a>:</h4>
<p>I'm not actually sure how separate rust-analyser is from rustc...</p>



<a name="260865378"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260865378" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260865378">(Nov 09 2021 at 21:37)</a>:</h4>
<p><span class="user-mention" data-user-id="326176">@Boxy [she/her]</span> depends on the IDE? rust-analyzer does its own lints but also runs <code>cargo check</code> in the background</p>



<a name="260865388"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260865388" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260865388">(Nov 09 2021 at 21:37)</a>:</h4>
<p>it's a separate implementation right now unfortunately, only the lexer is shared</p>



<a name="260865464"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260865464" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260865464">(Nov 09 2021 at 21:38)</a>:</h4>
<p>only RLS is super duper reliant on <code>cargo check</code> to my knowledge</p>



<a name="260865506"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260865506" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260865506">(Nov 09 2021 at 21:38)</a>:</h4>
<p>I've been thinking of trying to add more fine-grained measurements for <code>expand_crate</code> for a while now; I think that'd definitely be helpful</p>



<a name="260865589"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260865589" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260865589">(Nov 09 2021 at 21:39)</a>:</h4>
<p>I've certainly managed to crash the RA suggestions box a lot lately by having 5000+ constants</p>



<a name="260865740"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260865740" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexis King <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260865740">(Nov 09 2021 at 21:40)</a>:</h4>
<p>My general experience of working on macros and macro-related things has been that everyone is extremely skeptical all the time about them making compile times and error messages terrible, so I would like to at least know roughly where the bar is currently set before I consider subjecting myself to any of that scrutiny :)</p>



<a name="260865831"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260865831" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260865831">(Nov 09 2021 at 21:41)</a>:</h4>
<p>oh heh that's quite funny given that the immediate reaction at the top of the topic was "macros don't take that long to expand"</p>



<a name="260865857"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260865857" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260865857">(Nov 09 2021 at 21:41)</a>:</h4>
<p>yeah i won't count the number of code crimes I've done in the name of avoiding a macro "because they slow the build"</p>



<a name="260865900"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260865900" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260865900">(Nov 09 2021 at 21:41)</a>:</h4>
<p>oh my god</p>



<a name="260865908"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260865908" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260865908">(Nov 09 2021 at 21:42)</a>:</h4>
<p>macros <em>destroy</em> compile times of ECS lol</p>



<a name="260866029"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260866029" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260866029">(Nov 09 2021 at 21:42)</a>:</h4>
<p>I should go bench one and see if its macro expansion or the volume of generated code that causes issues</p>



<a name="260866159"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260866159" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexis King <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260866159">(Nov 09 2021 at 21:43)</a>:</h4>
<p>yeah I think it would be nice to find a way to make that somehow not be such a point of extreme suspicion</p>



<a name="260866236"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260866236" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260866236">(Nov 09 2021 at 21:44)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/131828-t-compiler/topic/proc.20macro.20perf/near/260865216">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/131828-t-compiler/topic/proc.20macro.20perf/near/260864484">said</a>:</p>
<blockquote>
<p>plus things like <code>include_str</code> which touch disk</p>
</blockquote>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/131828-t-compiler/topic/proc.20macro.20perf/near/260864530">said</a>:</p>
<blockquote>
<p>unsure if out-of-line modules are loaded from disk during parsing or not</p>
</blockquote>
<p>if someone wants to work on expansion perf, measuring this and other built-in macros separately might be a good first step</p>
</blockquote>
<p>:P</p>



<a name="260866290"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260866290" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260866290">(Nov 09 2021 at 21:44)</a>:</h4>
<p>I've even started to avoid <code>write!</code> when possible</p>



<a name="260866303"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260866303" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexis King <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260866303">(Nov 09 2021 at 21:45)</a>:</h4>
<p>Racket compilation is, in fact, pretty slow, but it’s sort of an extreme point on various spectra, so I don’t think it necessarily suggests all uses of macros have to be meaningfully slower than just parsing and compiling the code they expand to</p>



<a name="260866323"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260866323" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260866323">(Nov 09 2021 at 21:45)</a>:</h4>
<p><span class="user-mention silent" data-user-id="224471">Lokathor</span> <a href="#narrow/stream/131828-t-compiler/topic/proc.20macro.20perf/near/260866290">said</a>:</p>
<blockquote>
<p>I've even started to avoid <code>write!</code> when possible</p>
</blockquote>
<p>that's because <code>write!</code> generates slow code though, not because write is slow to expand</p>



<a name="260866462"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260866462" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260866462">(Nov 09 2021 at 21:46)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/issues/76490">https://github.com/rust-lang/rust/issues/76490</a></p>



<a name="260866594"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260866594" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260866594">(Nov 09 2021 at 21:47)</a>:</h4>
<p><span class="user-mention" data-user-id="116122">@simulacrum</span> could you move this to <a class="stream" data-stream-id="247081" href="/#narrow/stream/247081-t-compiler.2Fperformance">#t-compiler/performance</a> ?</p>



<a name="260866653"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260866653" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexis King <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260866653">(Nov 09 2021 at 21:48)</a>:</h4>
<p>imo there’s no fundamental reason that parsing code that uses proc macros should necessarily need to be meaningfully slower than parsing other bits of Rust code, given they’re ultimately both “just” parsers of token trees written in Rust (ignoring, like, the effect of code locality on the icache or whatever)</p>



<a name="260866771"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260866771" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260866771">(Nov 09 2021 at 21:48)</a>:</h4>
<p>hmm, I would expect there to be <em>some</em> inherent overhead from having to also either (parse + compile) or interpret the proc-macro code</p>



<a name="260866813"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260866813" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexis King <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260866813">(Nov 09 2021 at 21:49)</a>:</h4>
<p>but on an incremental recompile the crate with the proc macro code is already built</p>



<a name="260866825"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260866825" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260866825">(Nov 09 2021 at 21:49)</a>:</h4>
<p>like, if you compile <code>syn</code> with optimizations it can actually <em>improve</em> compile times</p>



<a name="260866841"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260866841" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260866841">(Nov 09 2021 at 21:49)</a>:</h4>
<p>oh sure, yeah I don't think there's an inherent reason proc-macros can't have incremental support</p>



<a name="260866964"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260866964" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexis King <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260866964">(Nov 09 2021 at 21:50)</a>:</h4>
<p>I mean even on an incremental build today you don’t have to recompile your dependencies, so if the crate containing the proc macro definition didn’t change, there’s no fundamental reason using it in a downstream crate should impose any significant overhead</p>



<a name="260867012"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260867012" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260867012">(Nov 09 2021 at 21:51)</a>:</h4>
<p>This topic was moved here from <a class="stream-topic" data-stream-id="131828" href="/#narrow/stream/131828-t-compiler/topic/proc.20macro.20perf">#t-compiler &gt; proc macro perf</a> by <span class="user-mention silent" data-user-id="116122">simulacrum</span></p>



<a name="260867123"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260867123" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260867123">(Nov 09 2021 at 21:52)</a>:</h4>
<p><span class="user-mention silent" data-user-id="326176">Boxy [she/her]</span> <a href="#narrow/stream/247081-t-compiler.2Fperformance/topic/proc.20macro.20perf/near/260864533">said</a>:</p>
<blockquote>
<p>this thread is a rollercoaster</p>
</blockquote>
<p><span class="user-mention" data-user-id="326176">@Boxy [she/her]</span> have I lived up to your expectations? <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="260867126"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260867126" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260867126">(Nov 09 2021 at 21:52)</a>:</h4>
<p><span class="user-mention silent" data-user-id="456123">Alexis King</span> <a href="#narrow/stream/247081-t-compiler.2Fperformance/topic/proc.20macro.20perf/near/260866964">said</a>:</p>
<blockquote>
<p>I mean even on an incremental build today you don’t have to recompile your dependencies, so if the crate containing the proc macro definition didn’t change, there’s no fundamental reason using it in a downstream crate should impose any significant overhead</p>
</blockquote>
<p>Dependencies aren't rebuilt even if incremental is off, right?</p>



<a name="260867169"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260867169" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260867169">(Nov 09 2021 at 21:52)</a>:</h4>
<p>yes</p>



<a name="260867211"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260867211" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260867211">(Nov 09 2021 at 21:53)</a>:</h4>
<p>as long as you don't have something weird like a build script that depends on all other files in the workspace <em>cough</em> rustc_llvm <em>cough</em></p>



<a name="260867281"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260867281" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexis King <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260867281">(Nov 09 2021 at 21:53)</a>:</h4>
<p>yes, you’re right, that shouldn’t matter; my point is just that there’s no fundamental reason that using a proc macro must make compilation times meaningfully worse</p>



<a name="260867361"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260867361" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexis King <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260867361">(Nov 09 2021 at 21:54)</a>:</h4>
<p>(or a MBE macro, for that matter)</p>



<a name="260867389"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260867389" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260867389">(Nov 09 2021 at 21:54)</a>:</h4>
<p>an interesting example here is <a href="https://docs.rs/gumdrop/0.8.0/gumdrop/">https://docs.rs/gumdrop/0.8.0/gumdrop/</a>, which compiles <em>significantly</em> faster than <a href="https://docs.rs/structopt/0.3.25/structopt/">https://docs.rs/structopt/0.3.25/structopt/</a> even though they're both proc-macros</p>



<a name="260867424"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260867424" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260867424">(Nov 09 2021 at 21:55)</a>:</h4>
<p>because structopt generates a bunch of code it sends to <code>clap</code>, which in turn has a bunch of dependencies</p>



<a name="260867564"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260867564" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexis King <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260867564">(Nov 09 2021 at 21:56)</a>:</h4>
<p>that’s interesting, yeah</p>



<a name="260867695"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260867695" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexis King <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260867695">(Nov 09 2021 at 21:57)</a>:</h4>
<p>One of the interesting tradeoffs that shows up in Racket-land is that when you have macros used to implement other macros (like, say, <code>quote!</code> in Rust), you can do more work in the macro to generate better code, which makes compiling uses of the macros you implement using it faster, but makes compiling those macros’ definitions slower :/</p>



<a name="260867766"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260867766" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260867766">(Nov 09 2021 at 21:58)</a>:</h4>
<p><span class="user-mention silent" data-user-id="456123">Alexis King</span> <a href="#narrow/stream/247081-t-compiler.2Fperformance/topic/proc.20macro.20perf/near/260867695">said</a>:</p>
<blockquote>
<p>One of the interesting tradeoffs that shows up in Racket-land is that when you have macros used to implement other macros (like, say, <code>quote!</code> in Rust), you can do more work in the macro to generate better code, which makes compiling uses of the macros you implement using it faster, but makes compiling those macros’ definitions slower :/</p>
</blockquote>
<p>heh, this is almost exactly the <code>syn</code> thing I was talking about before<br>
<span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/247081-t-compiler.2Fperformance/topic/proc.20macro.20perf/near/260866825">said</a>:</p>
<blockquote>
<p>like, if you compile <code>syn</code> with optimizations it can actually <em>improve</em> compile times</p>
</blockquote>



<a name="260867869"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260867869" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260867869">(Nov 09 2021 at 21:58)</a>:</h4>
<p>(syn is a library used by almost every proc-macro: <a href="https://docs.rs/syn/1.0.81/syn/">https://docs.rs/syn/1.0.81/syn/</a>)</p>



<a name="260867875"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260867875" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexis King <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260867875">(Nov 09 2021 at 21:58)</a>:</h4>
<p>yeah, this is just one more level deeper, because it’s optimizations performed by the proc macro itself, not by the compiler :)</p>



<a name="260868083"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260868083" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexis King <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260868083">(Nov 09 2021 at 22:00)</a>:</h4>
<p>For example, most macros in Racket are implemented using <code>syntax-parse</code>, which has a small optimizer in it that implements fairly standard pattern-matching compilation techniques, which is usually a win because most macros implemented using <code>syntax-parse</code> only have to pay for the compilation of <code>syntax-parse</code> once but are used many times, so they benefit from the extra work… but macro-defining macros would incur that cost at every use site, which may not be worth it</p>



<a name="260868250"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260868250" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexis King <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260868250">(Nov 09 2021 at 22:01)</a>:</h4>
<p>So if you are really an Advanced Macrologist and really want to optimize your compile times, you might use the simpler <code>syntax-case</code> form in the expansion of a macro-defining macro, so use sites don’t pay that optimization cost that they probably won’t benefit from</p>



<a name="260868411"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260868411" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260868411">(Nov 09 2021 at 22:02)</a>:</h4>
<blockquote>
<p>Advanced Macrologist</p>
</blockquote>
<p>careful, you'll summon <span class="user-mention silent" data-user-id="232018">Daniel Henry-Mantilla</span> <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="260868443"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260868443" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexis King <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260868443">(Nov 09 2021 at 22:02)</a>:</h4>
<p>And whether or not that’s a good tradeoff depends on knowledge that the macro author has about how the macro will probably be used, so it’s not really a decision that can be made automatically, which I think is sort of interesting… sufficiently complex macros are basically miniature compilers and therefore can benefit from having optimization flags of their own <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span></p>



<a name="260868562"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260868562" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexis King <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260868562">(Nov 09 2021 at 22:03)</a>:</h4>
<p>(Also, fwiw, <code>syntax-parse</code> was a fairly direct inspiration for much of the <code>macro_rules!</code> pattern and template languages, IIUC)</p>



<a name="260868960"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260868960" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexis King <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260868960">(Nov 09 2021 at 22:06)</a>:</h4>
<p>I guess the other funny thing about the “sufficiently complex macros start to resemble miniature compilers” point is that eventually to start wanting to use macros that assist in defining macros to define those macros (e.g. you might want to use macros provided by <code>syn</code> to implement <code>syn</code>)… which is to say you start wanting some way to bootstrap those miniature compilers. But even Racket hasn’t really attempted to solve that problem in any systematic way yet, haha</p>



<a name="260869019"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260869019" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260869019">(Nov 09 2021 at 22:07)</a>:</h4>
<p>I'm not sure I follow - isn't that just a normal library the macro uses?</p>



<a name="260869065"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260869065" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260869065">(Nov 09 2021 at 22:07)</a>:</h4>
<p>like, I can imagine <code>syn</code> being broken up into different crates, and having some depend on the others</p>



<a name="260869124"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260869124" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexis King <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260869124">(Nov 09 2021 at 22:08)</a>:</h4>
<p>well, I mean, suppose you want to use <code>parse_quote!</code> from <code>syn</code> in the implementation of <code>parse_quote!</code></p>



<a name="260869192"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260869192" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260869192">(Nov 09 2021 at 22:08)</a>:</h4>
<p>but like ... why is this a reoccuring problem? you have to implement parse_quote at <em>some</em> point anyway</p>



<a name="260869204"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260869204" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260869204">(Nov 09 2021 at 22:08)</a>:</h4>
<p>but after that you can reuse it</p>



<a name="260869220"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260869220" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexis King <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260869220">(Nov 09 2021 at 22:09)</a>:</h4>
<p>why do you want to bootstrap any compiler?</p>



<a name="260869291"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260869291" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexis King <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260869291">(Nov 09 2021 at 22:09)</a>:</h4>
<p>or perhaps more precisely, why is it beneficial for a compiler to be self-hosting?</p>



<a name="260869504"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260869504" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260869504">(Nov 09 2021 at 22:11)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/247081-t-compiler.2Fperformance/topic/proc.20macro.20perf/near/260865831">said</a>:</p>
<blockquote>
<p>oh heh that's quite funny given that the immediate reaction at the top of the topic was "macros don't take that long to expand"</p>
</blockquote>
<p>I'm happy to be proven wrong but I think it's worth pointing out that <code>expand_crate</code> also includes the time taken for eager resolution which I would hesitate to qualify as "macro expansion". <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="260869730"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260869730" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260869730">(Nov 09 2021 at 22:12)</a>:</h4>
<p>Which suggests to me, we should be collecting more fine-grained data here.</p>



<a name="260869736"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260869736" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260869736">(Nov 09 2021 at 22:12)</a>:</h4>
<p><span class="user-mention" data-user-id="125250">@Wesley Wiser</span> yup! I mentioned that above, I know it's a very long thread haha <br>
<span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/247081-t-compiler.2Fperformance/topic/proc.20macro.20perf/near/260865216">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/131828-t-compiler/topic/proc.20macro.20perf/near/260864484">said</a>:</p>
<blockquote>
<p>plus things like <code>include_str</code> which touch disk</p>
</blockquote>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/131828-t-compiler/topic/proc.20macro.20perf/near/260864530">said</a>:</p>
<blockquote>
<p>unsure if out-of-line modules are loaded from disk during parsing or not</p>
</blockquote>
<p>if someone wants to work on expansion perf, measuring this and other built-in macros separately might be a good first step</p>
</blockquote>



<a name="260869743"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260869743" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexis King <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260869743">(Nov 09 2021 at 22:12)</a>:</h4>
<p>To be a little less Socratic, to use the example of <code>syntax-parse</code>, it really does behave like a miniature compiler, with a front-end, middle-end, and back-end, and it does a lot of work to handle a lot of subtle details that are very laborious to get right by hand, but <code>syntax-parse</code> cannot be implemented in terms of itself, so it <em>does</em> have to try to get all those subtle details right by hand (and, amusingly, it genuinely does sometimes get them wrong, and those issues have to be fixed as they are discovered)</p>



<a name="260869778"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260869778" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260869778">(Nov 09 2021 at 22:12)</a>:</h4>
<p>Ah, yeah. Sorry, I missed that in the thread move when I lost my place.</p>



<a name="260869826"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260869826" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260869826">(Nov 09 2021 at 22:12)</a>:</h4>
<blockquote>
<p>or perhaps more precisely, why is it beneficial for a compiler to be self-hosting?</p>
</blockquote>
<p>The parser of <code>macro_rules!</code> macro definitions is implemented using the same parser used to parse the input to <code>macro_rules!</code> macros I believe.</p>



<a name="260869886"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260869886" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexis King <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260869886">(Nov 09 2021 at 22:13)</a>:</h4>
<p>That’s cute… how does the bootstrapping work for that?</p>



<a name="260869940"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260869940" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260869940">(Nov 09 2021 at 22:14)</a>:</h4>
<p>well macro_rules! is part of the compiler, not the standard library</p>



<a name="260870014"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260870014" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexis King <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260870014">(Nov 09 2021 at 22:14)</a>:</h4>
<p>(I guess this is sort of well off-topic for perf, though—maybe answer this in the other thread, haha)</p>



<a name="260870144"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260870144" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260870144">(Nov 09 2021 at 22:15)</a>:</h4>
<p>The <code>maco_rules!</code> input parser normally requires a data structure generated by the <code>macro_rules!</code> def parser. For the <code>macro_rules!</code> def parser the rustc source contains this datastructure directly.</p>



<a name="260870274"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260870274" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexis King <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260870274">(Nov 09 2021 at 22:16)</a>:</h4>
<p>Ah, I see, yeah—it’s not fully bootstrapped but it shares the same underlying code path. Parts of <code>syntax-parse</code> do similar things, I think</p>



<a name="260870376"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/proc%20macro%20perf/near/260870376" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/proc.20macro.20perf.html#260870376">(Nov 09 2021 at 22:17)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/blob/d6082292a6f3207cbdacd6633a5b9d1476bb6772/compiler/rustc_expand/src/mbe/macro_rules.rs#L421">https://github.com/rust-lang/rust/blob/d6082292a6f3207cbdacd6633a5b9d1476bb6772/compiler/rustc_expand/src/mbe/macro_rules.rs#L421</a></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>