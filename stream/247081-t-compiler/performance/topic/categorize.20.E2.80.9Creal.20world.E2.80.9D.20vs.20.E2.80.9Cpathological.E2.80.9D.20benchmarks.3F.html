<html>
<head><meta charset="utf-8"><title>categorize “real world” vs “pathological” benchmarks? · t-compiler/performance · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/index.html">t-compiler/performance</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/categorize.20.E2.80.9Creal.20world.E2.80.9D.20vs.20.E2.80.9Cpathological.E2.80.9D.20benchmarks.3F.html">categorize “real world” vs “pathological” benchmarks?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="264966561"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/categorize%20%E2%80%9Creal%20world%E2%80%9D%20vs%20%E2%80%9Cpathological%E2%80%9D%20benchmarks%3F/near/264966561" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/categorize.20.E2.80.9Creal.20world.E2.80.9D.20vs.20.E2.80.9Cpathological.E2.80.9D.20benchmarks.3F.html#264966561">(Dec 15 2021 at 05:10)</a>:</h4>
<p>Some of our benchmarks, like <a href="https://github.com/rust-lang/rustc-perf/blob/master/collector/benchmarks/externs/src/lib.rs">externs</a>, are designed to exericise certain paths of the compiler in a pathological way.</p>



<a name="264966574"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/categorize%20%E2%80%9Creal%20world%E2%80%9D%20vs%20%E2%80%9Cpathological%E2%80%9D%20benchmarks%3F/near/264966574" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/categorize.20.E2.80.9Creal.20world.E2.80.9D.20vs.20.E2.80.9Cpathological.E2.80.9D.20benchmarks.3F.html#264966574">(Dec 15 2021 at 05:10)</a>:</h4>
<p>I understand why we have such benchmarks</p>



<a name="264966575"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/categorize%20%E2%80%9Creal%20world%E2%80%9D%20vs%20%E2%80%9Cpathological%E2%80%9D%20benchmarks%3F/near/264966575" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/categorize.20.E2.80.9Creal.20world.E2.80.9D.20vs.20.E2.80.9Cpathological.E2.80.9D.20benchmarks.3F.html#264966575">(Dec 15 2021 at 05:10)</a>:</h4>
<p>however:</p>



<a name="264966582"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/categorize%20%E2%80%9Creal%20world%E2%80%9D%20vs%20%E2%80%9Cpathological%E2%80%9D%20benchmarks%3F/near/264966582" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/categorize.20.E2.80.9Creal.20world.E2.80.9D.20vs.20.E2.80.9Cpathological.E2.80.9D.20benchmarks.3F.html#264966582">(Dec 15 2021 at 05:10)</a>:</h4>
<ol>
<li>it would be nice if they were separated from the “real world” benchmarks in the summary presentations.</li>
</ol>



<a name="264966610"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/categorize%20%E2%80%9Creal%20world%E2%80%9D%20vs%20%E2%80%9Cpathological%E2%80%9D%20benchmarks%3F/near/264966610" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/categorize.20.E2.80.9Creal.20world.E2.80.9D.20vs.20.E2.80.9Cpathological.E2.80.9D.20benchmarks.3F.html#264966610">(Dec 15 2021 at 05:11)</a>:</h4>
<ol start="2">
<li>maybe the threshold for when we trigger a regresion warning should be higher for such cases? Like, no one cares if <a href="https://github.com/rust-lang/rustc-perf/blob/master/collector/benchmarks/externs/src/lib.rs">externs</a> compile-time goes up (or down!) by 0.8% , right?</li>
</ol>



<a name="264966940"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/categorize%20%E2%80%9Creal%20world%E2%80%9D%20vs%20%E2%80%9Cpathological%E2%80%9D%20benchmarks%3F/near/264966940" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/categorize.20.E2.80.9Creal.20world.E2.80.9D.20vs.20.E2.80.9Cpathological.E2.80.9D.20benchmarks.3F.html#264966940">(Dec 15 2021 at 05:17)</a>:</h4>
<p><span class="user-mention" data-user-id="120989">@nnethercote</span> I think you might have had comments along these lines recently, though I couldn’t immediately find them</p>



<a name="264967020"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/categorize%20%E2%80%9Creal%20world%E2%80%9D%20vs%20%E2%80%9Cpathological%E2%80%9D%20benchmarks%3F/near/264967020" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/categorize.20.E2.80.9Creal.20world.E2.80.9D.20vs.20.E2.80.9Cpathological.E2.80.9D.20benchmarks.3F.html#264967020">(Dec 15 2021 at 05:18)</a>:</h4>
<p>I think I mentioned it as a tangent in a thread about something else. I agree with the idea of separating them!</p>



<a name="264967066"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/categorize%20%E2%80%9Creal%20world%E2%80%9D%20vs%20%E2%80%9Cpathological%E2%80%9D%20benchmarks%3F/near/264967066" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/categorize.20.E2.80.9Creal.20world.E2.80.9D.20vs.20.E2.80.9Cpathological.E2.80.9D.20benchmarks.3F.html#264967066">(Dec 15 2021 at 05:19)</a>:</h4>
<p>I can mentally filter out the uninteresting ones, but it's a bit annoying, and most people don't have that knowledge of the benchmark suite</p>



<a name="264967175"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/categorize%20%E2%80%9Creal%20world%E2%80%9D%20vs%20%E2%80%9Cpathological%E2%80%9D%20benchmarks%3F/near/264967175" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/categorize.20.E2.80.9Creal.20world.E2.80.9D.20vs.20.E2.80.9Cpathological.E2.80.9D.20benchmarks.3F.html#264967175">(Dec 15 2021 at 05:21)</a>:</h4>
<p>One big potential benefit of tagging+separating them would also to have separate summary from just combining the real-world cases, which is harder to do in one’s head.</p>



<a name="264969382"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/categorize%20%E2%80%9Creal%20world%E2%80%9D%20vs%20%E2%80%9Cpathological%E2%80%9D%20benchmarks%3F/near/264969382" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/categorize.20.E2.80.9Creal.20world.E2.80.9D.20vs.20.E2.80.9Cpathological.E2.80.9D.20benchmarks.3F.html#264969382">(Dec 15 2021 at 06:07)</a>:</h4>
<p>Another pattern I find myself doing that we might be able to automate in our tooling: When there’s only one benchmark regressing, I look at the preceding and successor PRs, to see if this was just a “bounce.” We could/should make that either easier (i.e. detect it as part of report genreation and remove it) or completely unnecessary.</p>



<a name="264969884"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/categorize%20%E2%80%9Creal%20world%E2%80%9D%20vs%20%E2%80%9Cpathological%E2%80%9D%20benchmarks%3F/near/264969884" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/categorize.20.E2.80.9Creal.20world.E2.80.9D.20vs.20.E2.80.9Cpathological.E2.80.9D.20benchmarks.3F.html#264969884">(Dec 15 2021 at 06:17)</a>:</h4>
<p>I haven't had any good idea about how do do the real-world/artificial split in the presentation</p>



<a name="264969935"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/categorize%20%E2%80%9Creal%20world%E2%80%9D%20vs%20%E2%80%9Cpathological%E2%80%9D%20benchmarks%3F/near/264969935" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/categorize.20.E2.80.9Creal.20world.E2.80.9D.20vs.20.E2.80.9Cpathological.E2.80.9D.20benchmarks.3F.html#264969935">(Dec 15 2021 at 06:18)</a>:</h4>
<p>I guess the dumb thing is to just split everything (tables, pages of graphs, etc.) into two halves: real first, then artificial</p>



<a name="264983666"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/categorize%20%E2%80%9Creal%20world%E2%80%9D%20vs%20%E2%80%9Cpathological%E2%80%9D%20benchmarks%3F/near/264983666" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/categorize.20.E2.80.9Creal.20world.E2.80.9D.20vs.20.E2.80.9Cpathological.E2.80.9D.20benchmarks.3F.html#264983666">(Dec 15 2021 at 09:31)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116083">pnkfelix</span> <a href="#narrow/stream/247081-t-compiler.2Fperformance/topic/categorize.20.E2.80.9Creal.20world.E2.80.9D.20vs.20.E2.80.9Cpathological.E2.80.9D.20benchmarks.3F/near/264969382">said</a>:</p>
<blockquote>
<p>Another pattern I find myself doing that we might be able to automate in our tooling: When there’s only one benchmark regressing, I look at the preceding and successor PRs, to see if this was just a “bounce.” We could/should make that either easier (i.e. detect it as part of report genreation and remove it) or completely unnecessary.</p>
</blockquote>
<p>Is that all that common outside the incremental verification issue?</p>



<a name="265027695"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/categorize%20%E2%80%9Creal%20world%E2%80%9D%20vs%20%E2%80%9Cpathological%E2%80%9D%20benchmarks%3F/near/265027695" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/categorize.20.E2.80.9Creal.20world.E2.80.9D.20vs.20.E2.80.9Cpathological.E2.80.9D.20benchmarks.3F.html#265027695">(Dec 15 2021 at 15:39)</a>:</h4>
<p><span class="user-mention silent" data-user-id="330154">The 8472</span> <a href="#narrow/stream/247081-t-compiler.2Fperformance/topic/categorize.20.E2.80.9Creal.20world.E2.80.9D.20vs.20.E2.80.9Cpathological.E2.80.9D.20benchmarks.3F/near/264983666">said</a>:</p>
<blockquote>
<p>Is that all that common outside the incremental verification issue?</p>
</blockquote>
<p>Hmm I’d have to go back and look again at the cases that arose to check if they all fell into that category.</p>



<a name="265075720"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/categorize%20%E2%80%9Creal%20world%E2%80%9D%20vs%20%E2%80%9Cpathological%E2%80%9D%20benchmarks%3F/near/265075720" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/categorize.20.E2.80.9Creal.20world.E2.80.9D.20vs.20.E2.80.9Cpathological.E2.80.9D.20benchmarks.3F.html#265075720">(Dec 15 2021 at 21:13)</a>:</h4>
<p>I like the idea of separating out artificial regression tests for pathological cases. I don't have that knowledge of the perf suite either, and in general I think many people who encounter what look like performance regressions don't.</p>



<a name="265075762"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/categorize%20%E2%80%9Creal%20world%E2%80%9D%20vs%20%E2%80%9Cpathological%E2%80%9D%20benchmarks%3F/near/265075762" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/categorize.20.E2.80.9Creal.20world.E2.80.9D.20vs.20.E2.80.9Cpathological.E2.80.9D.20benchmarks.3F.html#265075762">(Dec 15 2021 at 21:13)</a>:</h4>
<p>It seems OK if some of the pathological regression cases go up by 2% in exchange for everything else going down by 1%.</p>



<a name="265075813"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/categorize%20%E2%80%9Creal%20world%E2%80%9D%20vs%20%E2%80%9Cpathological%E2%80%9D%20benchmarks%3F/near/265075813" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/categorize.20.E2.80.9Creal.20world.E2.80.9D.20vs.20.E2.80.9Cpathological.E2.80.9D.20benchmarks.3F.html#265075813">(Dec 15 2021 at 21:14)</a>:</h4>
<p>As long as the pathological regression cases don't go up by 20%.</p>



<a name="265077338"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/categorize%20%E2%80%9Creal%20world%E2%80%9D%20vs%20%E2%80%9Cpathological%E2%80%9D%20benchmarks%3F/near/265077338" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/categorize.20.E2.80.9Creal.20world.E2.80.9D.20vs.20.E2.80.9Cpathological.E2.80.9D.20benchmarks.3F.html#265077338">(Dec 15 2021 at 21:27)</a>:</h4>
<p>Aren't many of the pathological cases just distilled versions of real workloads? So if they regress that'll also regress real crates.</p>



<a name="265087311"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/categorize%20%E2%80%9Creal%20world%E2%80%9D%20vs%20%E2%80%9Cpathological%E2%80%9D%20benchmarks%3F/near/265087311" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/categorize.20.E2.80.9Creal.20world.E2.80.9D.20vs.20.E2.80.9Cpathological.E2.80.9D.20benchmarks.3F.html#265087311">(Dec 15 2021 at 22:48)</a>:</h4>
<p>There's a mixture. The real vs artificial categorization is more of a spectrum. E.g.</p>
<ul>
<li><code>deep-vector</code> just contains a <code>vec!()</code> literal with 135,000 <code>0</code> elements, which is 100% artificial.</li>
<li><code>tuple-stress</code> contains an array with 64k tuples of real geographic data, which was stripped out of a real program. So it's partly real and partly artificial.</li>
</ul>



<a name="265087384"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/categorize%20%E2%80%9Creal%20world%E2%80%9D%20vs%20%E2%80%9Cpathological%E2%80%9D%20benchmarks%3F/near/265087384" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/categorize.20.E2.80.9Creal.20world.E2.80.9D.20vs.20.E2.80.9Cpathological.E2.80.9D.20benchmarks.3F.html#265087384">(Dec 15 2021 at 22:49)</a>:</h4>
<p>But I think a binary split is still reasonable, and better than what we currently have. I'm happy to propose what benchmarks goes in which half of the split.</p>



<a name="265087521"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/categorize%20%E2%80%9Creal%20world%E2%80%9D%20vs%20%E2%80%9Cpathological%E2%80%9D%20benchmarks%3F/near/265087521" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/categorize.20.E2.80.9Creal.20world.E2.80.9D.20vs.20.E2.80.9Cpathological.E2.80.9D.20benchmarks.3F.html#265087521">(Dec 15 2021 at 22:50)</a>:</h4>
<p>Basically the predicate would be "is this a real crate?"  And then I'd probably include <code>helloworld</code> among the "real" ones, because it's representative of tiny programs</p>



<a name="265087610"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/categorize%20%E2%80%9Creal%20world%E2%80%9D%20vs%20%E2%80%9Cpathological%E2%80%9D%20benchmarks%3F/near/265087610" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/categorize.20.E2.80.9Creal.20world.E2.80.9D.20vs.20.E2.80.9Cpathological.E2.80.9D.20benchmarks.3F.html#265087610">(Dec 15 2021 at 22:51)</a>:</h4>
<p>Encouraging the artificial ones to be stripped down versions of real code (like <code>tuple-stress</code>) rather than synthetic (like <code>deep-vector</code>) is also worthwhile.</p>



<a name="265093122"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/categorize%20%E2%80%9Creal%20world%E2%80%9D%20vs%20%E2%80%9Cpathological%E2%80%9D%20benchmarks%3F/near/265093122" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/categorize.20.E2.80.9Creal.20world.E2.80.9D.20vs.20.E2.80.9Cpathological.E2.80.9D.20benchmarks.3F.html#265093122">(Dec 15 2021 at 23:45)</a>:</h4>
<p>Similarly, I'm guessing <code>issue-*</code> tests are closer to artificial?</p>



<a name="265093251"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/categorize%20%E2%80%9Creal%20world%E2%80%9D%20vs%20%E2%80%9Cpathological%E2%80%9D%20benchmarks%3F/near/265093251" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/categorize.20.E2.80.9Creal.20world.E2.80.9D.20vs.20.E2.80.9Cpathological.E2.80.9D.20benchmarks.3F.html#265093251">(Dec 15 2021 at 23:46)</a>:</h4>
<p>I think they're regression tests, more pathological than synthetic.</p>



<a name="265181046"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/categorize%20%E2%80%9Creal%20world%E2%80%9D%20vs%20%E2%80%9Cpathological%E2%80%9D%20benchmarks%3F/near/265181046" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/categorize.20.E2.80.9Creal.20world.E2.80.9D.20vs.20.E2.80.9Cpathological.E2.80.9D.20benchmarks.3F.html#265181046">(Dec 16 2021 at 16:30)</a>:</h4>
<p>I brought up this topic (of “real world” vs “pathological” benchmarks) in today’s T-compiler triage meeting, and the group agreed to dedicate tomorrow’s steering meeting to that topic. <span class="user-mention" data-user-id="224872">@rylev</span> and <span class="user-mention" data-user-id="116122">@simulacrum</span> , do you think you’d be able to make it to a zulip meeting at <time datetime="2021-12-17T15:00:00Z">2021-12-17T10:00:00-05:00</time>  ?</p>



<a name="265181273"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/categorize%20%E2%80%9Creal%20world%E2%80%9D%20vs%20%E2%80%9Cpathological%E2%80%9D%20benchmarks%3F/near/265181273" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/categorize.20.E2.80.9Creal.20world.E2.80.9D.20vs.20.E2.80.9Cpathological.E2.80.9D.20benchmarks.3F.html#265181273">(Dec 16 2021 at 16:31)</a>:</h4>
<p>should be</p>



<a name="265181436"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/categorize%20%E2%80%9Creal%20world%E2%80%9D%20vs%20%E2%80%9Cpathological%E2%80%9D%20benchmarks%3F/near/265181436" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rylev <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/categorize.20.E2.80.9Creal.20world.E2.80.9D.20vs.20.E2.80.9Cpathological.E2.80.9D.20benchmarks.3F.html#265181436">(Dec 16 2021 at 16:32)</a>:</h4>
<p>I'd likely be yes (though if I'm not and <span class="user-mention" data-user-id="116122">@simulacrum</span> is that's as good as me being there IMO)</p>



<a name="265181532"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/categorize%20%E2%80%9Creal%20world%E2%80%9D%20vs%20%E2%80%9Cpathological%E2%80%9D%20benchmarks%3F/near/265181532" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/categorize.20.E2.80.9Creal.20world.E2.80.9D.20vs.20.E2.80.9Cpathological.E2.80.9D.20benchmarks.3F.html#265181532">(Dec 16 2021 at 16:33)</a>:</h4>
<p>fwiw, I am not sure there's meeting-worthy discussion at a glance -- or, at least, it would be good to go in with a categorized list I suspect.</p>



<a name="265196671"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/categorize%20%E2%80%9Creal%20world%E2%80%9D%20vs%20%E2%80%9Cpathological%E2%80%9D%20benchmarks%3F/near/265196671" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/categorize.20.E2.80.9Creal.20world.E2.80.9D.20vs.20.E2.80.9Cpathological.E2.80.9D.20benchmarks.3F.html#265196671">(Dec 16 2021 at 18:15)</a>:</h4>
<p><span class="user-mention" data-user-id="116122">@simulacrum</span> that’s a good reminder: I was going to see if I could put a write-up together</p>



<a name="265196859"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/categorize%20%E2%80%9Creal%20world%E2%80%9D%20vs%20%E2%80%9Cpathological%E2%80%9D%20benchmarks%3F/near/265196859" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/categorize.20.E2.80.9Creal.20world.E2.80.9D.20vs.20.E2.80.9Cpathological.E2.80.9D.20benchmarks.3F.html#265196859">(Dec 16 2021 at 18:16)</a>:</h4>
<p>The main points I’d want to address are: 1. <em>why</em> we include pathological benchmarks in the test suite. (It is definitely motivated. But its good to make sure everyone is on the same page about that point.) and then 2. How to categorize the existing set of benchmarks</p>



<a name="265222970"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/categorize%20%E2%80%9Creal%20world%E2%80%9D%20vs%20%E2%80%9Cpathological%E2%80%9D%20benchmarks%3F/near/265222970" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/categorize.20.E2.80.9Creal.20world.E2.80.9D.20vs.20.E2.80.9Cpathological.E2.80.9D.20benchmarks.3F.html#265222970">(Dec 16 2021 at 21:37)</a>:</h4>
<p>My draft classification:</p>
<ul>
<li>Real: cargo, clap-rs, cranelife-codegen, diesel, encoding, futures, html5ever, hyper-2, piston-image, regex, ripgrep, serde, stm32f4, style-servo, syn, tokio-webpush-simple, ucd, webrender, webrender-wrench</li>
<li>Maybe real: inflate, keccak, wg-grammar, unicode_normalization</li>
<li>Artificial: coercions, ctfe-stress-4, deeply-nested, deeply-nested-async, deeply-nested-closures, deep-vector, derive, externs, issue-*, many-assoc-items, match-stress-enum, match-stress-exhaustive_patterns, regression-31157, token-stream-stress, tuple-stress, unify-linearly, unused-warnings, wf-projection-stress-65510</li>
</ul>



<a name="265223117"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/categorize%20%E2%80%9Creal%20world%E2%80%9D%20vs%20%E2%80%9Cpathological%E2%80%9D%20benchmarks%3F/near/265223117" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/categorize.20.E2.80.9Creal.20world.E2.80.9D.20vs.20.E2.80.9Cpathological.E2.80.9D.20benchmarks.3F.html#265223117">(Dec 16 2021 at 21:38)</a>:</h4>
<p>I suspect "real"/"artificial" are not the best terms, particularly since some of the "artificial" ones are derived from real crates. Perhaps "typical" vs "atypical" or "stress" might be better, feels less judgmental</p>



<a name="265223402"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/categorize%20%E2%80%9Creal%20world%E2%80%9D%20vs%20%E2%80%9Cpathological%E2%80%9D%20benchmarks%3F/near/265223402" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/categorize.20.E2.80.9Creal.20world.E2.80.9D.20vs.20.E2.80.9Cpathological.E2.80.9D.20benchmarks.3F.html#265223402">(Dec 16 2021 at 21:41)</a>:</h4>
<p>Avoids the "no true Scotsman" problem</p>



<a name="265223935"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/categorize%20%E2%80%9Creal%20world%E2%80%9D%20vs%20%E2%80%9Cpathological%E2%80%9D%20benchmarks%3F/near/265223935" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/categorize.20.E2.80.9Creal.20world.E2.80.9D.20vs.20.E2.80.9Cpathological.E2.80.9D.20benchmarks.3F.html#265223935">(Dec 16 2021 at 21:45)</a>:</h4>
<p>Really, it comes down to a "more important" vs "less important" distinction</p>



<a name="265227370"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/categorize%20%E2%80%9Creal%20world%E2%80%9D%20vs%20%E2%80%9Cpathological%E2%80%9D%20benchmarks%3F/near/265227370" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/categorize.20.E2.80.9Creal.20world.E2.80.9D.20vs.20.E2.80.9Cpathological.E2.80.9D.20benchmarks.3F.html#265227370">(Dec 16 2021 at 22:13)</a>:</h4>
<p>I think one idea was to distinguish between pathological cases that are reduced from real world code, versus pathological cases that are constructed by taking some example (which may have been reduced from real world code), and then artificially repeating it in order to scale up its effect on performance, and/or expose quadratic blowup issues, etc.</p>



<a name="265238201"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/categorize%20%E2%80%9Creal%20world%E2%80%9D%20vs%20%E2%80%9Cpathological%E2%80%9D%20benchmarks%3F/near/265238201" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/categorize.20.E2.80.9Creal.20world.E2.80.9D.20vs.20.E2.80.9Cpathological.E2.80.9D.20benchmarks.3F.html#265238201">(Dec 17 2021 at 00:09)</a>:</h4>
<p>Yes, I was saying "synthetic" where you would use "artificial", as it is quite literally synthesized from something else, and I think some synthetic cases could conceivably be non-pathological, but Of Interest nonetheless, though the dominant tendency will be that a synthetic case will be pathological.</p>
<p>Vice versa, some "real" cases (I would call them "wild", "observed", or "community" perhaps) expose a pathological pattern, but the dominant tendency will be away from pathological patterns.</p>



<a name="265241206"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/categorize%20%E2%80%9Creal%20world%E2%80%9D%20vs%20%E2%80%9Cpathological%E2%80%9D%20benchmarks%3F/near/265241206" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/categorize.20.E2.80.9Creal.20world.E2.80.9D.20vs.20.E2.80.9Cpathological.E2.80.9D.20benchmarks.3F.html#265241206">(Dec 17 2021 at 00:52)</a>:</h4>
<p>A fine-grained classifications is certainly possible. But is it useful? I really just want a "primary" vs "secondary" distinction, because that's the filter I do in my head</p>



<a name="265243202"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/categorize%20%E2%80%9Creal%20world%E2%80%9D%20vs%20%E2%80%9Cpathological%E2%80%9D%20benchmarks%3F/near/265243202" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/categorize.20.E2.80.9Creal.20world.E2.80.9D.20vs.20.E2.80.9Cpathological.E2.80.9D.20benchmarks.3F.html#265243202">(Dec 17 2021 at 01:23)</a>:</h4>
<p>I expect everyone involved to also wind up with that as a result, tbh, no matter how many actual categories are drawn up, I think the only merit of cutting more finely is a contemplative exercise on trying to see if there is something "underneath".</p>



<a name="265250143"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/categorize%20%E2%80%9Creal%20world%E2%80%9D%20vs%20%E2%80%9Cpathological%E2%80%9D%20benchmarks%3F/near/265250143" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/categorize.20.E2.80.9Creal.20world.E2.80.9D.20vs.20.E2.80.9Cpathological.E2.80.9D.20benchmarks.3F.html#265250143">(Dec 17 2021 at 03:32)</a>:</h4>
<p>One advantage of primary/secondary vs real/artificial (or whatever) is that we can choose to make "real" crates secondary. E.g. I think <code>inflate</code> is a really old version of that crate that doesn't reflect the current version, and it's a weird example. So I'd be fine with making it "secondary", even though it is undeniably "real world code"</p>



<a name="265250157"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/categorize%20%E2%80%9Creal%20world%E2%80%9D%20vs%20%E2%80%9Cpathological%E2%80%9D%20benchmarks%3F/near/265250157" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/categorize.20.E2.80.9Creal.20world.E2.80.9D.20vs.20.E2.80.9Cpathological.E2.80.9D.20benchmarks.3F.html#265250157">(Dec 17 2021 at 03:32)</a>:</h4>
<p>I certainly don't think it's as important as, say, <code>cargo</code> or <code>webrender</code></p>



<a name="265253955"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/categorize%20%E2%80%9Creal%20world%E2%80%9D%20vs%20%E2%80%9Cpathological%E2%80%9D%20benchmarks%3F/near/265253955" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/categorize.20.E2.80.9Creal.20world.E2.80.9D.20vs.20.E2.80.9Cpathological.E2.80.9D.20benchmarks.3F.html#265253955">(Dec 17 2021 at 04:50)</a>:</h4>
<p>For anyone who likes thinking about this topic, sections 2.2-2.4 of <a href="http://web.mit.edu/~ezyang/Public/10.1.1.53.4124.pdf">http://web.mit.edu/~ezyang/Public/10.1.1.53.4124.pdf</a> may be of interest. It's a Haskell benchmarking suite divided into "real", "spectral", and "imaginary"</p>



<a name="265254034"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/categorize%20%E2%80%9Creal%20world%E2%80%9D%20vs%20%E2%80%9Cpathological%E2%80%9D%20benchmarks%3F/near/265254034" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/categorize.20.E2.80.9Creal.20world.E2.80.9D.20vs.20.E2.80.9Cpathological.E2.80.9D.20benchmarks.3F.html#265254034">(Dec 17 2021 at 04:52)</a>:</h4>
<p>Hennessy &amp; Patterson is always good for this sort of thing, too. Chapter 1 distinguishes: real applications, modified applications, kernels, toy benchmarks, and synthetic benchmarks</p>



<a name="265294531"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/categorize%20%E2%80%9Creal%20world%E2%80%9D%20vs%20%E2%80%9Cpathological%E2%80%9D%20benchmarks%3F/near/265294531" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/categorize.20.E2.80.9Creal.20world.E2.80.9D.20vs.20.E2.80.9Cpathological.E2.80.9D.20benchmarks.3F.html#265294531">(Dec 17 2021 at 13:22)</a>:</h4>
<p>Thanks so much for these inputs. That <code>nofib</code> paper was a really neat find, <span class="user-mention" data-user-id="120989">@nnethercote</span></p>



<a name="265295083"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/categorize%20%E2%80%9Creal%20world%E2%80%9D%20vs%20%E2%80%9Cpathological%E2%80%9D%20benchmarks%3F/near/265295083" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/categorize.20.E2.80.9Creal.20world.E2.80.9D.20vs.20.E2.80.9Cpathological.E2.80.9D.20benchmarks.3F.html#265295083">(Dec 17 2021 at 13:27)</a>:</h4>
<p>I wrote a doc, mostly cribbed from the comments here and from yesterday’s team meeting. It is linked from the first message in <a class="stream-topic" data-stream-id="238009" href="/#narrow/stream/238009-t-compiler.2Fmeetings/topic/.5Bsteering.20meeting.5D.202021-12-17">#t-compiler/meetings &gt; [steering meeting] 2021-12-17</a></p>



<a name="265680521"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/categorize%20%E2%80%9Creal%20world%E2%80%9D%20vs%20%E2%80%9Cpathological%E2%80%9D%20benchmarks%3F/near/265680521" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Julian-Wollersberger <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/categorize.20.E2.80.9Creal.20world.E2.80.9D.20vs.20.E2.80.9Cpathological.E2.80.9D.20benchmarks.3F.html#265680521">(Dec 21 2021 at 12:40)</a>:</h4>
<p>As an idea for how to display it: Make the names of the "synthetic" benchmarks grey instead of black.<br>
That should intuitively give the impression that grey benchmarks are less important than black ones</p>



<a name="265721705"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/247081-t-compiler/performance/topic/categorize%20%E2%80%9Creal%20world%E2%80%9D%20vs%20%E2%80%9Cpathological%E2%80%9D%20benchmarks%3F/near/265721705" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/247081-t-compiler/performance/topic/categorize.20.E2.80.9Creal.20world.E2.80.9D.20vs.20.E2.80.9Cpathological.E2.80.9D.20benchmarks.3F.html#265721705">(Dec 21 2021 at 18:55)</a>:</h4>
<p>I'd prefer a second section. With greying you might still have to scan past a bunch of less-interesting results to get to the more-interesting results</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>