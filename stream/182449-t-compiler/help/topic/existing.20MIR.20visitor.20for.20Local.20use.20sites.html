<html>
<head><meta charset="utf-8"><title>existing MIR visitor for Local use sites · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/existing.20MIR.20visitor.20for.20Local.20use.20sites.html">existing MIR visitor for Local use sites</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="252017274"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/existing%20MIR%20visitor%20for%20Local%20use%20sites/near/252017274" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/existing.20MIR.20visitor.20for.20Local.20use.20sites.html#252017274">(Sep 04 2021 at 18:19)</a>:</h4>
<p>I'm working on a PR (<a href="https://github.com/rust-lang/rust/issues/83174">#83174</a>) where I need to find all the use sites (e.g., <code>Location</code>s) of a <code>Local</code>. <span class="user-mention silent" data-user-id="124288">oli</span> said there is an existing pass for that, but they don't remember which one it is an suggested I look through the impls <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/mir/visit/trait.Visitor.html">here</a>. I found several that seem close to what I want, but the one that seems like it would fully cover my use case is <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_mir/borrow_check/type_check/liveness/polonius/struct.UseFactsExtractor.html">in the <code>rustc_mir::borrow_check::type_check::liveness::polonius</code> module</a>, and it is private to the <code>rustc_mir::borrow_check::type_check::liveness</code> module, which I don't think I can access from where I want to run this pass.</p>
<p>Is it okay to make it <code>pub(in rustc_mir::borrow_check)</code>; or, is there a better pass I should be using?</p>
<p>Thanks!</p>



<a name="252207577"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/existing%20MIR%20visitor%20for%20Local%20use%20sites/near/252207577" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/existing.20MIR.20visitor.20for.20Local.20use.20sites.html#252207577">(Sep 06 2021 at 18:08)</a>:</h4>
<p>I re-asked this in <a class="stream" data-stream-id="189540" href="/#narrow/stream/189540-t-compiler.2Fwg-mir-opt">#t-compiler/wg-mir-opt</a> since I realized it might be a better fit for that stream.</p>



<a name="252360950"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/existing%20MIR%20visitor%20for%20Local%20use%20sites/near/252360950" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Xavier Denis <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/existing.20MIR.20visitor.20for.20Local.20use.20sites.html#252360950">(Sep 07 2021 at 19:42)</a>:</h4>
<p>hmm couldn't you use the liveness pass from <code>dataflow</code>?</p>



<a name="252360991"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/existing%20MIR%20visitor%20for%20Local%20use%20sites/near/252360991" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Xavier Denis <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/existing.20MIR.20visitor.20for.20Local.20use.20sites.html#252360991">(Sep 07 2021 at 19:42)</a>:</h4>
<p>or did I not understand what you're looking for?</p>



<a name="252502530"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/existing%20MIR%20visitor%20for%20Local%20use%20sites/near/252502530" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/existing.20MIR.20visitor.20for.20Local.20use.20sites.html#252502530">(Sep 08 2021 at 17:42)</a>:</h4>
<p>Would that allow finding all (or at least one) of the use sites of a <code>Local</code>? (Which pass are you referring to by the way? Is it <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_mir/dataflow/impls/liveness/struct.MaybeLiveLocals.html">this</a>?)</p>



<a name="252813815"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/existing%20MIR%20visitor%20for%20Local%20use%20sites/near/252813815" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Xavier Denis <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/existing.20MIR.20visitor.20for.20Local.20use.20sites.html#252813815">(Sep 10 2021 at 16:34)</a>:</h4>
<p>well liveness would find the locations a local <em>can</em> be used</p>



<a name="252813972"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/existing%20MIR%20visitor%20for%20Local%20use%20sites/near/252813972" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Xavier Denis <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/existing.20MIR.20visitor.20for.20Local.20use.20sites.html#252813972">(Sep 10 2021 at 16:35)</a>:</h4>
<p>actually you may want: <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_borrowck/diagnostics/find_use/index.html">https://doc.rust-lang.org/nightly/nightly-rustc/rustc_borrowck/diagnostics/find_use/index.html</a></p>



<a name="252814146"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/existing%20MIR%20visitor%20for%20Local%20use%20sites/near/252814146" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Xavier Denis <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/existing.20MIR.20visitor.20for.20Local.20use.20sites.html#252814146">(Sep 10 2021 at 16:36)</a>:</h4>
<p>no nvm, that doesn't find the right things</p>



<a name="252814190"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/existing%20MIR%20visitor%20for%20Local%20use%20sites/near/252814190" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Xavier Denis <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/existing.20MIR.20visitor.20for.20Local.20use.20sites.html#252814190">(Sep 10 2021 at 16:37)</a>:</h4>
<p><a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_mir_transform/const_debuginfo/struct.LocalUseVisitor.html">https://doc.rust-lang.org/nightly/nightly-rustc/rustc_mir_transform/const_debuginfo/struct.LocalUseVisitor.html</a></p>



<a name="252814199"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/existing%20MIR%20visitor%20for%20Local%20use%20sites/near/252814199" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Xavier Denis <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/existing.20MIR.20visitor.20for.20Local.20use.20sites.html#252814199">(Sep 10 2021 at 16:37)</a>:</h4>
<p>this gives you the assignments of a local</p>



<a name="252814208"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/existing%20MIR%20visitor%20for%20Local%20use%20sites/near/252814208" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Xavier Denis <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/existing.20MIR.20visitor.20for.20Local.20use.20sites.html#252814208">(Sep 10 2021 at 16:37)</a>:</h4>
<p>is that good enough?</p>



<a name="252943545"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/existing%20MIR%20visitor%20for%20Local%20use%20sites/near/252943545" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/existing.20MIR.20visitor.20for.20Local.20use.20sites.html#252943545">(Sep 11 2021 at 23:43)</a>:</h4>
<p>No, I need to find uses that are in rvalues.</p>



<a name="252943551"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/existing%20MIR%20visitor%20for%20Local%20use%20sites/near/252943551" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/existing.20MIR.20visitor.20for.20Local.20use.20sites.html#252943551">(Sep 11 2021 at 23:43)</a>:</h4>
<p>But thank you for looking :)</p>



<a name="252943666"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/existing%20MIR%20visitor%20for%20Local%20use%20sites/near/252943666" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/existing.20MIR.20visitor.20for.20Local.20use.20sites.html#252943666">(Sep 11 2021 at 23:46)</a>:</h4>
<p><span class="user-mention silent" data-user-id="312719">Xavier Denis</span> <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/existing.20MIR.20visitor.20for.20Local.20use.20sites/near/252813972">said</a>:</p>
<blockquote>
<p>actually you may want: <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_borrowck/diagnostics/find_use/index.html">https://doc.rust-lang.org/nightly/nightly-rustc/rustc_borrowck/diagnostics/find_use/index.html</a></p>
</blockquote>
<p>This one could be useful, but it would probably be better to find all uses; otherwise, it'd probably make my check fragile to changes in how the MIR is built.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>