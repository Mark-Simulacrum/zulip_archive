<html>
<head><meta charset="utf-8"><title>Detect eager expansion span? · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Detect.20eager.20expansion.20span.3F.html">Detect eager expansion span?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="263083863"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Detect%20eager%20expansion%20span%3F/near/263083863" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Detect.20eager.20expansion.20span.3F.html#263083863">(Nov 29 2021 at 23:49)</a>:</h4>
<p>I am working on making Clippy able to scan macro expansions for inputs without depending on the exact structure of the expansion (<a href="https://github.com/rust-lang/rust-clippy/issues/7843">https://github.com/rust-lang/rust-clippy/issues/7843</a>).</p>
<p>I've nearly got it, but one weird case I am bumping into is eagerly expanded macros. They create spans that seem to be not from expansion. Is there any general way to detect these? Otherwise, I would falsely assume that <code>true</code> from <code>debug_assert! -&gt; cfg!</code> is an <em>input</em> to <code>debug_assert!</code>. <span class="user-mention" data-user-id="123856">@Vadim Petrochenkov</span></p>



<a name="263085858"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Detect%20eager%20expansion%20span%3F/near/263085858" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vadim Petrochenkov <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Detect.20eager.20expansion.20span.3F.html#263085858">(Nov 30 2021 at 00:13)</a>:</h4>
<blockquote>
<p>They create spans that seem to be not from expansion.</p>
</blockquote>



<a name="263085910"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Detect%20eager%20expansion%20span%3F/near/263085910" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vadim Petrochenkov <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Detect.20eager.20expansion.20span.3F.html#263085910">(Nov 30 2021 at 00:14)</a>:</h4>
<p>If they do, then it's a bug.<br>
Could you give an example of such macro?</p>



<a name="263086006"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Detect%20eager%20expansion%20span%3F/near/263086006" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vadim Petrochenkov <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Detect.20eager.20expansion.20span.3F.html#263086006">(Nov 30 2021 at 00:15)</a>:</h4>
<p><code>cfg!</code> seems to add a macro layer to the result's span.</p>



<a name="263086098"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Detect%20eager%20expansion%20span%3F/near/263086098" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Detect.20eager.20expansion.20span.3F.html#263086098">(Nov 30 2021 at 00:17)</a>:</h4>
<p>I'm working with the example <code>debug_assert!(true)</code></p>



<a name="263086228"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Detect%20eager%20expansion%20span%3F/near/263086228" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Detect.20eager.20expansion.20span.3F.html#263086228">(Nov 30 2021 at 00:18)</a>:</h4>
<p>uh oh, I might be mistaken...does the input to that macro get repeated?</p>



<a name="263086254"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Detect%20eager%20expansion%20span%3F/near/263086254" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Detect.20eager.20expansion.20span.3F.html#263086254">(Nov 30 2021 at 00:19)</a>:</h4>
<p>(expanded in two places?)</p>



<a name="263086389"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Detect%20eager%20expansion%20span%3F/near/263086389" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Detect.20eager.20expansion.20span.3F.html#263086389">(Nov 30 2021 at 00:20)</a>:</h4>
<p>oh yeah be cause it prints the value. sorry, I think this is a big false alarm</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>