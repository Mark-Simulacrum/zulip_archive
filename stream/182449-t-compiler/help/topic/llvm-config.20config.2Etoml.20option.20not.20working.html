<html>
<head><meta charset="utf-8"><title>llvm-config config.toml option not working · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/llvm-config.20config.2Etoml.20option.20not.20working.html">llvm-config config.toml option not working</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="263692150"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/llvm-config%20config.toml%20option%20not%20working/near/263692150" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dominic DeMarco <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/llvm-config.20config.2Etoml.20option.20not.20working.html#263692150">(Dec 04 2021 at 08:15)</a>:</h4>
<p>Hi All. I'm poking around trying to get rust to output some z80 assembly from an llvm fork I stumbled across.<br>
According to the doc here: <a href="https://rustc-dev-guide.rust-lang.org/building/new-target.html">https://rustc-dev-guide.rust-lang.org/building/new-target.html</a></p>
<p>Adding an llvm-config path to config.toml for the newly defined triplet should be all that's needed to use a pre-compiled llvm (I even specified the filecheck path)</p>
<p>However, when I try to actually emit some code, I'm greeted with the lovely <br>
error: Could not create LLVM TargetMachine for triple: z80: No available targets are compatible with triple "z80"<br>
message. It seems like it's trying to use the llvm version it built and not the one specified. Is there anything I can do to increase verbosity to try and debug this?</p>



<a name="263692416"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/llvm-config%20config.toml%20option%20not%20working/near/263692416" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/llvm-config.20config.2Etoml.20option.20not.20working.html#263692416">(Dec 04 2021 at 08:23)</a>:</h4>
<p>You can try <code>-v</code> or <code>-vv</code> but I don't know if x.py logs anything relevant</p>



<a name="263692505"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/llvm-config%20config.toml%20option%20not%20working/near/263692505" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dominic DeMarco <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/llvm-config.20config.2Etoml.20option.20not.20working.html#263692505">(Dec 04 2021 at 08:25)</a>:</h4>
<p>Gave that a shot already, didn't see anything worthwhile... tried on rustc itself too, got no more info out of it</p>



<a name="263692569"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/llvm-config%20config.toml%20option%20not%20working/near/263692569" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/llvm-config.20config.2Etoml.20option.20not.20working.html#263692569">(Dec 04 2021 at 08:26)</a>:</h4>
<p><code>rustc --version -v</code> should show which llvm version it's using</p>



<a name="263692576"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/llvm-config%20config.toml%20option%20not%20working/near/263692576" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/llvm-config.20config.2Etoml.20option.20not.20working.html#263692576">(Dec 04 2021 at 08:27)</a>:</h4>
<p>(or maybe -V, don't remember)</p>



<a name="263692649"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/llvm-config%20config.toml%20option%20not%20working/near/263692649" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dominic DeMarco <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/llvm-config.20config.2Etoml.20option.20not.20working.html#263692649">(Dec 04 2021 at 08:29)</a>:</h4>
<p>right, and it's showing me:<br>
rustc 1.59.0-dev<br>
binary: rustc<br>
commit-hash: unknown<br>
commit-date: unknown<br>
host: x86_64-pc-windows-msvc<br>
release: 1.59.0-dev<br>
LLVM version: 13.0.0</p>
<p>which I would expect, it's what x.py pulled and built, but according to the rustc dev guide doc, specifying the llvm-config for the triplet should allow me to use this external (version 14) llvm I've compiled, correct?</p>
<p>Info on that external version, if curious:<br>
.\llc.exe --version<br>
LLVM (<a href="http://llvm.org/">http://llvm.org/</a>):<br>
  LLVM version 14.0.0git<br>
  DEBUG build with assertions.<br>
  Default target: x86_64-pc-windows-msvc<br>
  Host CPU: skylake</p>
<p>Registered Targets:<br>
    ez80   - eZ80 [experimental]<br>
    x86    - 32-bit X86: Pentium-Pro and above<br>
    x86-64 - 64-bit X86: EM64T and AMD64<br>
    z80    - Z80 [experimental]</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>