<html>
<head><meta charset="utf-8"><title>local tidy misses issues reported on CI · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/local.20tidy.20misses.20issues.20reported.20on.20CI.html">local tidy misses issues reported on CI</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://rust-lang.github.io/zulip_archive/style.css" rel="stylesheet"></head>

<a name="245553198"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/local%20tidy%20misses%20issues%20reported%20on%20CI/near/245553198" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/local.20tidy.20misses.20issues.20reported.20on.20CI.html#245553198">(Jul 10 2021 at 14:28)</a>:</h4>
<p>I ran a <code>./x.py test tidy</code> locally, pushed the branch and then got a CI failure on a file that isn't dirty. Any idea what might be causing this? running <code>./x.py fmt</code> also doesn't change it.</p>



<a name="245554028"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/local%20tidy%20misses%20issues%20reported%20on%20CI/near/245554028" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/local.20tidy.20misses.20issues.20reported.20on.20CI.html#245554028">(Jul 10 2021 at 14:43)</a>:</h4>
<p>What error did you get?</p>



<a name="245554101"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/local%20tidy%20misses%20issues%20reported%20on%20CI/near/245554101" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/local.20tidy.20misses.20issues.20reported.20on.20CI.html#245554101">(Jul 10 2021 at 14:44)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/pull/87025#issuecomment-877645205">https://github.com/rust-lang/rust/pull/87025#issuecomment-877645205</a></p>



<a name="245558184"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/local%20tidy%20misses%20issues%20reported%20on%20CI/near/245558184" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Yu [they/she] <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/local.20tidy.20misses.20issues.20reported.20on.20CI.html#245558184">(Jul 10 2021 at 15:57)</a>:</h4>
<p>did you run <code>./x.py fmt</code> exactly like that, or did you specify some directory names? i found that sometimes misses stuff that's caught by the full <code>./x.py fmt</code></p>



<a name="245558513"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/local%20tidy%20misses%20issues%20reported%20on%20CI/near/245558513" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/local.20tidy.20misses.20issues.20reported.20on.20CI.html#245558513">(Jul 10 2021 at 16:02)</a>:</h4>
<p>Exactly <code>./x.py fmt</code>, yes.</p>



<a name="245558756"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/local%20tidy%20misses%20issues%20reported%20on%20CI/near/245558756" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Yu [they/she] <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/local.20tidy.20misses.20issues.20reported.20on.20CI.html#245558756">(Jul 10 2021 at 16:07)</a>:</h4>
<p>yeah those particular kinds of changes from rustfmt look really familiar. i wonder if it's a stable vs beta thing? or in-tree vs not?</p>



<a name="245558836"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/local%20tidy%20misses%20issues%20reported%20on%20CI/near/245558836" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/local.20tidy.20misses.20issues.20reported.20on.20CI.html#245558836">(Jul 10 2021 at 16:09)</a>:</h4>
<p>Hrrm, maybe <code>x.py fmt --stage 1</code> should build rustfmt and use that. Or tidy could use it opportunistically if it has been built.</p>



<a name="245559338"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/local%20tidy%20misses%20issues%20reported%20on%20CI/near/245559338" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/local.20tidy.20misses.20issues.20reported.20on.20CI.html#245559338">(Jul 10 2021 at 16:21)</a>:</h4>
<p>x.py uses a nightly rustfmt, it's neither in-tree nor beta. You can see the version in src/stage0.txt.</p>
<p>I don't think having a fmt --stage 1 command is useful - at best it does nothing, at worst it behaves differently, which will actually break when you push to CI. Gating on stage 1 is really painful for people working on the standard library, since they now need a compiler build no matter what.</p>



<a name="245559531"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/local%20tidy%20misses%20issues%20reported%20on%20CI/near/245559531" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/local.20tidy.20misses.20issues.20reported.20on.20CI.html#245559531">(Jul 10 2021 at 16:25)</a>:</h4>
<p>If it uses nightly then what could cause it to behave differently compared to CI?</p>



<a name="245559545"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/local%20tidy%20misses%20issues%20reported%20on%20CI/near/245559545" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/local.20tidy.20misses.20issues.20reported.20on.20CI.html#245559545">(Jul 10 2021 at 16:25)</a>:</h4>
<p>Oh you mean a nightly build from the rustfmt repository?</p>



<a name="245559557"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/local%20tidy%20misses%20issues%20reported%20on%20CI/near/245559557" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/local.20tidy.20misses.20issues.20reported.20on.20CI.html#245559557">(Jul 10 2021 at 16:25)</a>:</h4>
<p>I don't know, sorry. You can check to see if you've modified stage 0.txt by accident maybe? Or do you have RUSTFMT set in your environment?</p>



<a name="245559609"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/local%20tidy%20misses%20issues%20reported%20on%20CI/near/245559609" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/local.20tidy.20misses.20issues.20reported.20on.20CI.html#245559609">(Jul 10 2021 at 16:26)</a>:</h4>
<p><span class="user-mention" data-user-id="330154">@The 8472</span> I mean a nightly toolchain, like the ones distributed by rustup</p>



<a name="245559627"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/local%20tidy%20misses%20issues%20reported%20on%20CI/near/245559627" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/local.20tidy.20misses.20issues.20reported.20on.20CI.html#245559627">(Jul 10 2021 at 16:26)</a>:</h4>
<p>(but x.py downloads it directly instead of going through rustup)</p>



<a name="245559642"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/local%20tidy%20misses%20issues%20reported%20on%20CI/near/245559642" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/local.20tidy.20misses.20issues.20reported.20on.20CI.html#245559642">(Jul 10 2021 at 16:27)</a>:</h4>
<p><code>src/stage0.txt</code> is unmodified according to git. RUSTFMT is not set. I do have a dirty cargo submodule though.</p>



<a name="245559690"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/local%20tidy%20misses%20issues%20reported%20on%20CI/near/245559690" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/local.20tidy.20misses.20issues.20reported.20on.20CI.html#245559690">(Jul 10 2021 at 16:28)</a>:</h4>
<p>Hmm, do you have rustc = ... in config.toml?</p>



<a name="245559701"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/local%20tidy%20misses%20issues%20reported%20on%20CI/near/245559701" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/local.20tidy.20misses.20issues.20reported.20on.20CI.html#245559701">(Jul 10 2021 at 16:28)</a>:</h4>
<p>Oh! You may need to rebase over master if this branch is highly outdated, stage0.txt may have changed in the meantime</p>



<a name="245559798"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/local%20tidy%20misses%20issues%20reported%20on%20CI/near/245559798" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/local.20tidy.20misses.20issues.20reported.20on.20CI.html#245559798">(Jul 10 2021 at 16:31)</a>:</h4>
<p>no <code>rustc =</code></p>
<div class="codehilite"><pre><span></span><code>$ git fetch upstream &amp;&amp; git rebase upstream/master
Current branch opt-dropless-arena-from-iter is up to date.
</code></pre></div>



<a name="245559805"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/local%20tidy%20misses%20issues%20reported%20on%20CI/near/245559805" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/local.20tidy.20misses.20issues.20reported.20on.20CI.html#245559805">(Jul 10 2021 at 16:31)</a>:</h4>
<p>Yeah I'm baffled</p>



<a name="245559807"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/local%20tidy%20misses%20issues%20reported%20on%20CI/near/245559807" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/local.20tidy.20misses.20issues.20reported.20on.20CI.html#245559807">(Jul 10 2021 at 16:31)</a>:</h4>
<p>Sorry :/</p>



<a name="245560552"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/local%20tidy%20misses%20issues%20reported%20on%20CI/near/245560552" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/local.20tidy.20misses.20issues.20reported.20on.20CI.html#245560552">(Jul 10 2021 at 16:49)</a>:</h4>
<p>Running the exact command listed as failing by CI (without checkout replaced with an absolute path to the root of your repository) may be helpful... but this does look strange. Not expected behavior for sure.</p>



<a name="245573160"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/local%20tidy%20misses%20issues%20reported%20on%20CI/near/245573160" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/local.20tidy.20misses.20issues.20reported.20on.20CI.html#245573160">(Jul 10 2021 at 21:36)</a>:</h4>
<p>hmm, this happened in another PR too: <a href="https://github.com/rust-lang/rust/pull/73936#issuecomment-877705438">https://github.com/rust-lang/rust/pull/73936#issuecomment-877705438</a></p>



<hr><p>Last updated: Aug 07 2021 at 22:04 UTC</p>
</html>