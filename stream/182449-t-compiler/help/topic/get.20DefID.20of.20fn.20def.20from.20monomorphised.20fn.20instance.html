<html>
<head><meta charset="utf-8"><title>get DefID of fn def from monomorphised fn instance · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/get.20DefID.20of.20fn.20def.20from.20monomorphised.20fn.20instance.html">get DefID of fn def from monomorphised fn instance</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="273523186"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/get%20DefID%20of%20fn%20def%20from%20monomorphised%20fn%20instance/near/273523186" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Hughes <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/get.20DefID.20of.20fn.20def.20from.20monomorphised.20fn.20instance.html#273523186">(Feb 28 2022 at 17:19)</a>:</h4>
<p>Hi, if I have an <code>Instance</code> of a function which I know has the monomorphised substitutions, is there a way use that to get the <code>DefId</code> of the generic function which it was monomorphised from? Or is this information lost at this stage?</p>



<a name="273527190"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/get%20DefID%20of%20fn%20def%20from%20monomorphised%20fn%20instance/near/273527190" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tm <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/get.20DefID.20of.20fn.20def.20from.20monomorphised.20fn.20instance.html#273527190">(Feb 28 2022 at 17:46)</a>:</h4>
<p><code>instance.def_id()</code>?</p>



<a name="273527953"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/get%20DefID%20of%20fn%20def%20from%20monomorphised%20fn%20instance/near/273527953" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Hughes <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/get.20DefID.20of.20fn.20def.20from.20monomorphised.20fn.20instance.html#273527953">(Feb 28 2022 at 17:52)</a>:</h4>
<p>But that gets the monomorphised DefId</p>



<a name="273528109"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/get%20DefID%20of%20fn%20def%20from%20monomorphised%20fn%20instance/near/273528109" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Hughes <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/get.20DefID.20of.20fn.20def.20from.20monomorphised.20fn.20instance.html#273528109">(Feb 28 2022 at 17:53)</a>:</h4>
<p>I think I've explained this poorly, sorry. I've basically used <code>Instance::resolve</code> to go from a trait method's<code>def_id</code> to the actual instance. But I want to go back the other way, and get the <code>DefId</code> of the trait method from the <code>Instance</code>.</p>



<a name="273533366"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/get%20DefID%20of%20fn%20def%20from%20monomorphised%20fn%20instance/near/273533366" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/get.20DefID.20of.20fn.20def.20from.20monomorphised.20fn.20instance.html#273533366">(Feb 28 2022 at 18:30)</a>:</h4>
<p>(deleted)</p>



<a name="273533611"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/get%20DefID%20of%20fn%20def%20from%20monomorphised%20fn%20instance/near/273533611" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/get.20DefID.20of.20fn.20def.20from.20monomorphised.20fn.20instance.html#273533611">(Feb 28 2022 at 18:31)</a>:</h4>
<p>The def id returned by <code>instance.def_id()</code> is the def id of the method inside the trait implementation.</p>



<a name="273533752"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/get%20DefID%20of%20fn%20def%20from%20monomorphised%20fn%20instance/near/273533752" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Hughes <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/get.20DefID.20of.20fn.20def.20from.20monomorphised.20fn.20instance.html#273533752">(Feb 28 2022 at 18:32)</a>:</h4>
<p><span class="user-mention" data-user-id="133247">@bjorn3</span> Ok, how do I get from that to the def id of the trait method's definition?</p>



<a name="273533855"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/get%20DefID%20of%20fn%20def%20from%20monomorphised%20fn%20instance/near/273533855" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/get.20DefID.20of.20fn.20def.20from.20monomorphised.20fn.20instance.html#273533855">(Feb 28 2022 at 18:33)</a>:</h4>
<p><code>tcx.trait_of_item(instance.def_id())</code> gives the def id of the trait I think.</p>



<a name="273534436"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/get%20DefID%20of%20fn%20def%20from%20monomorphised%20fn%20instance/near/273534436" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Hughes <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/get.20DefID.20of.20fn.20def.20from.20monomorphised.20fn.20instance.html#273534436">(Feb 28 2022 at 18:38)</a>:</h4>
<p>It's returning <code>None</code> unfortunately. Does this only work if the trait def is from the same crate?</p>



<a name="273535746"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/get%20DefID%20of%20fn%20def%20from%20monomorphised%20fn%20instance/near/273535746" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/get.20DefID.20of.20fn.20def.20from.20monomorphised.20fn.20instance.html#273535746">(Feb 28 2022 at 18:49)</a>:</h4>
<p>I don't know. I think I can't help you further.</p>



<a name="273539397"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/get%20DefID%20of%20fn%20def%20from%20monomorphised%20fn%20instance/near/273539397" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Hughes <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/get.20DefID.20of.20fn.20def.20from.20monomorphised.20fn.20instance.html#273539397">(Feb 28 2022 at 19:16)</a>:</h4>
<p>No worries. Thanks anyway</p>



<a name="273546502"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/get%20DefID%20of%20fn%20def%20from%20monomorphised%20fn%20instance/near/273546502" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/get.20DefID.20of.20fn.20def.20from.20monomorphised.20fn.20instance.html#273546502">(Feb 28 2022 at 20:08)</a>:</h4>
<p>This should definitely work. Try printing your def id and see what it actually points to</p>



<a name="273547893"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/get%20DefID%20of%20fn%20def%20from%20monomorphised%20fn%20instance/near/273547893" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Hughes <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/get.20DefID.20of.20fn.20def.20from.20monomorphised.20fn.20instance.html#273547893">(Feb 28 2022 at 20:20)</a>:</h4>
<p>Hi Oli, it prints <code>filename.rs::{impl#1}::trait_method)</code> so I'm guessing something went wrong because the trait name was replaced by <code>impl#1</code>. Maybe this could be because I'm doing this in the monomorphisation collector and it hasn't pulled in the trait yet?</p>



<a name="273547969"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/get%20DefID%20of%20fn%20def%20from%20monomorphised%20fn%20instance/near/273547969" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Hughes <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/get.20DefID.20of.20fn.20def.20from.20monomorphised.20fn.20instance.html#273547969">(Feb 28 2022 at 20:21)</a>:</h4>
<p>the trait in question is a custom one I added to libcore</p>



<a name="273549318"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/get%20DefID%20of%20fn%20def%20from%20monomorphised%20fn%20instance/near/273549318" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/get.20DefID.20of.20fn.20def.20from.20monomorphised.20fn.20instance.html#273549318">(Feb 28 2022 at 20:32)</a>:</h4>
<p><code>impl#1</code> is the first implementation block in the module.</p>



<a name="273551229"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/get%20DefID%20of%20fn%20def%20from%20monomorphised%20fn%20instance/near/273551229" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cjgillot <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/get.20DefID.20of.20fn.20def.20from.20monomorphised.20fn.20instance.html#273551229">(Feb 28 2022 at 20:45)</a>:</h4>
<p>You can use <code>tcx.associated_item(instance.def_id()).trait_item_def_id</code>.</p>



<a name="275086551"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/get%20DefID%20of%20fn%20def%20from%20monomorphised%20fn%20instance/near/275086551" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/get.20DefID.20of.20fn.20def.20from.20monomorphised.20fn.20instance.html#275086551">(Mar 12 2022 at 09:08)</a>:</h4>
<p><span class="user-mention" data-user-id="362398">@Aurel Bílý</span> I think this is the same as what you were asking</p>



<a name="275104124"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/get%20DefID%20of%20fn%20def%20from%20monomorphised%20fn%20instance/near/275104124" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aurel Bílý <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/get.20DefID.20of.20fn.20def.20from.20monomorphised.20fn.20instance.html#275104124">(Mar 12 2022 at 16:04)</a>:</h4>
<p><span class="user-mention" data-user-id="124288">@oli</span> Thanks! Unfortunately, just figuring out the corresponding <code>DefId</code> of the trait's method is not what I want (I already had that working). I need to go from the substs of a call to an implementation method to the substs of a (hypothetical) call to the trait method. The type substitutions are important, not just the <code>DefId</code>s.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>