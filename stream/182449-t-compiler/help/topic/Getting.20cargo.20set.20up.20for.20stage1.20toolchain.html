<html>
<head><meta charset="utf-8"><title>Getting cargo set up for stage1 toolchain · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20cargo.20set.20up.20for.20stage1.20toolchain.html">Getting cargo set up for stage1 toolchain</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="277054583"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20cargo%20set%20up%20for%20stage1%20toolchain/near/277054583" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Goulet (compiler-errors) <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20cargo.20set.20up.20for.20stage1.20toolchain.html#277054583">(Mar 29 2022 at 19:33)</a>:</h4>
<p>howdy y'all -- I currently have rustc linked to the stage1 toolchain following the <a href="https://rustc-dev-guide.rust-lang.org/building/how-to-build-and-run.html#creating-a-rustup-toolchain">instructions in the dev guide</a>, but when stage1 is built, it doesn't include cargo, so I can't do <code>cargo +stage1 build</code> on a project (it falls back to the default rustc toolchain).</p>



<a name="277054591"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20cargo%20set%20up%20for%20stage1%20toolchain/near/277054591" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Goulet (compiler-errors) <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20cargo.20set.20up.20for.20stage1.20toolchain.html#277054591">(Mar 29 2022 at 19:33)</a>:</h4>
<p>That's fine, and makes sense, but then when I do something like <code>x build --stage=1 cargo</code>, I _still_ can't build with <code>cargo +stage1 build</code> because the cargo binary is located somewhere different than the rustc compiler artifacts.</p>



<a name="277054681"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20cargo%20set%20up%20for%20stage1%20toolchain/near/277054681" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Goulet (compiler-errors) <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20cargo.20set.20up.20for.20stage1.20toolchain.html#277054681">(Mar 29 2022 at 19:34)</a>:</h4>
<p>Is there something simple that I'm missing to get a stage1 flavor of cargo built and setup -- preferrably not including copying build artifacts around in the various subdirectories of <code>build/</code>?</p>



<a name="277055501"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20cargo%20set%20up%20for%20stage1%20toolchain/near/277055501" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20cargo.20set.20up.20for.20stage1.20toolchain.html#277055501">(Mar 29 2022 at 19:41)</a>:</h4>
<p>I had the same issue/question, and even after adding the tools keys to config.toml wasn't able to make it magically work with rustup (so there may be a different rustup link command to actually add it there) but after your cargo stage 1 build, the cargo binary will be available in <code>build/x86_64-unknown-linux-gnu/stage1-tools-bin/cargo</code> and I just used that (though I don't remember if using it requires setting the <code>RUSTC</code> env var to the stage1 rustc path, I <em>think</em> you don't need to set it yourself)</p>



<a name="277061114"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20cargo%20set%20up%20for%20stage1%20toolchain/near/277061114" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20cargo.20set.20up.20for.20stage1.20toolchain.html#277061114">(Mar 29 2022 at 20:31)</a>:</h4>
<p>AIUI you you need <code>./x.py build --stage 1</code>, not <code>./x.py build --stage 1 cargo</code>. The former builds the stage1 toolchain, the latter builds cargo <em>with</em> the stage1 toolchain. I could be wrong though, the stage stuff is confusing.</p>



<a name="277061956"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20cargo%20set%20up%20for%20stage1%20toolchain/near/277061956" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20cargo.20set.20up.20for.20stage1.20toolchain.html#277061956">(Mar 29 2022 at 20:39)</a>:</h4>
<blockquote>
<p>when stage1 is built, it doesn't include cargo, so I can't do cargo +stage1 build on a project (it falls back to the default rustc toolchain).</p>
</blockquote>
<p>this doesn't sound right. it falls back to the <em>cargo</em> from the default toolchain, but it will still use your newly built rustc.</p>



<a name="277062020"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20cargo%20set%20up%20for%20stage1%20toolchain/near/277062020" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20cargo.20set.20up.20for.20stage1.20toolchain.html#277062020">(Mar 29 2022 at 20:40)</a>:</h4>
<p>and yes, <span class="user-mention" data-user-id="330154">@The 8472</span> is right that <code>build --stage 1</code> means "build using stage1"</p>



<a name="277062061"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20cargo%20set%20up%20for%20stage1%20toolchain/near/277062061" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20cargo.20set.20up.20for.20stage1.20toolchain.html#277062061">(Mar 29 2022 at 20:40)</a>:</h4>
<p>are you modifying both cargo and rustc in-tree? modifying cargo in-tree is not super supported ...</p>



<a name="277062274"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20cargo%20set%20up%20for%20stage1%20toolchain/near/277062274" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20cargo.20set.20up.20for.20stage1.20toolchain.html#277062274">(Mar 29 2022 at 20:42)</a>:</h4>
<p>anyway, I think it would be reasonable to teach x.py to copy stage1-tools-bin/cargo into stage2/bin/cargo, see <a href="https://github.com/rust-lang/rust/issues/81431">https://github.com/rust-lang/rust/issues/81431</a></p>



<a name="277065907"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20cargo%20set%20up%20for%20stage1%20toolchain/near/277065907" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Goulet (compiler-errors) <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20cargo.20set.20up.20for.20stage1.20toolchain.html#277065907">(Mar 29 2022 at 21:18)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/Getting.20cargo.20set.20up.20for.20stage1.20toolchain/near/277062061">said</a>:</p>
<blockquote>
<p>are you modifying both cargo and rustc in-tree? modifying cargo in-tree is not super supported ...</p>
</blockquote>
<p>No, just modifying rustc. And yeah, I'm building rustc first with <code>x build --stage=1</code>. I was under the impression that it wasn't using the built rustc, but maybe I was misled by checking <code>cargo +stage1 -V</code> and it actually is using the newly built rustc.</p>



<a name="277065966"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20cargo%20set%20up%20for%20stage1%20toolchain/near/277065966" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20cargo.20set.20up.20for.20stage1.20toolchain.html#277065966">(Mar 29 2022 at 21:18)</a>:</h4>
<p>ah yeah the proper check is either <code>rustc +stage1 -V</code> or <code>cargo rustc -- -V</code></p>



<a name="277066772"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20cargo%20set%20up%20for%20stage1%20toolchain/near/277066772" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20cargo.20set.20up.20for.20stage1.20toolchain.html#277066772">(Mar 29 2022 at 21:26)</a>:</h4>
<p>Oh, you may have to set <code>build.extended = true</code> in your <code>config.toml</code><br>
And you can also check where it's looking with<br>
<code>rustup +stage1 which rustc</code><br>
<code>rustup +stage1 which cargo</code></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>