<html>
<head><meta charset="utf-8"><title>cargo build-std linking failed · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/cargo.20build-std.20linking.20failed.html">cargo build-std linking failed</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="276440951"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/cargo%20build-std%20linking%20failed/near/276440951" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> yoru <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/cargo.20build-std.20linking.20failed.html#276440951">(Mar 24 2022 at 07:46)</a>:</h4>
<p>I'm testing cargo build-std feature with the following code:<br>
<a href="http://main.rs">main.rs</a></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#![no_main]</span><span class="w"></span>
<span class="cp">#![no_std]</span><span class="w"></span>

<span class="k">use</span><span class="w"> </span><span class="n">core</span>::<span class="n">panic</span>::<span class="n">PanicInfo</span><span class="p">;</span><span class="w"></span>

<span class="cp">#[panic_handler]</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">panic</span><span class="p">(</span><span class="n">_panic</span>: <span class="kp">&amp;</span><span class="nc">PanicInfo</span><span class="o">&lt;'</span><span class="nb">_</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="o">!</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">loop</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="cp">#[no_mangle]</span><span class="w"></span>
<span class="k">pub</span><span class="w"> </span><span class="k">extern</span><span class="w"> </span><span class="s">"C"</span><span class="w"> </span><span class="k">fn</span> <span class="nf">_start</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="o">!</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">loop</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>x86_64-unknown-none.json:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="s">"is-builtin"</span>: <span class="nc">false</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="s">"llvm-target"</span>: <span class="s">"x86_64-unknown-none"</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="s">"data-layout"</span>: <span class="s">"e-m:e-i64:64-f80:128-n8:16:32:64-S128"</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="s">"arch"</span>: <span class="s">"x86_64"</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="s">"target-endian"</span>: <span class="s">"little"</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="s">"target-pointer-width"</span>: <span class="s">"64"</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="s">"target-c-int-width"</span>: <span class="s">"32"</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="s">"os"</span>: <span class="s">"none"</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="s">"executables"</span>: <span class="nc">true</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="s">"panic-strategy"</span>: <span class="s">"abort"</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="s">"disable-redzone"</span>: <span class="nc">true</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="s">"features"</span>: <span class="s">"-mmx,-sse,+soft-float"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>Build command: <code>cargo build -Z build-std=core,alloc --target x86_64-unknown-none.json</code></p>
<p>But i'm getting this error:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">error</span>: <span class="nc">linking</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">cc</span><span class="err">`</span><span class="w"> </span><span class="n">failed</span>: <span class="nc">exit</span><span class="w"> </span><span class="n">status</span>: <span class="mi">1</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"></span>
<span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="s">"cc"</span><span class="w"> </span><span class="s">"/home/yoru/G/Projects/OS/sysroot-test/target/x86_64-unknown-none/debug/deps/MyProject-7c87417b24b424fa.3nlffb4k7pac6yqh.rcgu.o"</span><span class="w"> </span><span class="s">"-Wl,--as-needed"</span><span class="w"> </span><span class="s">"-L"</span><span class="w"> </span><span class="s">"/home/yoru/G/Projects/OS/sysroot-test/target/x86_64-unknown-none/debug/deps"</span><span class="w"> </span><span class="s">"-L"</span><span class="w"> </span><span class="s">"/home/yoru/G/Projects/OS/sysroot-test/target/debug/deps"</span><span class="w"> </span><span class="s">"-L"</span><span class="w"> </span><span class="s">"/home/yoru/.rustup/toolchains/nightly-2022-03-24-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-none/lib"</span><span class="w"> </span><span class="s">"-Wl,-Bstatic"</span><span class="w"> </span><span class="s">"/home/yoru/G/Projects/OS/sysroot-test/target/x86_64-unknown-none/debug/deps/librustc_std_workspace_core-3b54680dbe9079a5.rlib"</span><span class="w"> </span><span class="s">"/home/yoru/G/Projects/OS/sysroot-test/target/x86_64-unknown-none/debug/deps/libcore-1784180a37a7e44b.rlib"</span><span class="w"> </span><span class="s">"/home/yoru/G/Projects/OS/sysroot-test/target/x86_64-unknown-none/debug/deps/libcompiler_builtins-48fe58420f5e0c79.rlib"</span><span class="w"> </span><span class="s">"-Wl,-Bdynamic"</span><span class="w"> </span><span class="s">"-Wl,--eh-frame-hdr"</span><span class="w"> </span><span class="s">"-Wl,-znoexecstack"</span><span class="w"> </span><span class="s">"-L"</span><span class="w"> </span><span class="s">"/home/yoru/.rustup/toolchains/nightly-2022-03-24-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-none/lib"</span><span class="w"> </span><span class="s">"-o"</span><span class="w"> </span><span class="s">"/home/yoru/G/Projects/OS/sysroot-test/target/x86_64-unknown-none/debug/deps/MyProject-7c87417b24b424fa"</span><span class="w"> </span><span class="s">"-Wl,--gc-sections"</span><span class="w"> </span><span class="s">"-no-pie"</span><span class="w"> </span><span class="s">"-nodefaultlibs"</span><span class="w"></span>
<span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">ld</span>: <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">yoru</span><span class="o">/</span><span class="n">G</span><span class="o">/</span><span class="n">Projects</span><span class="o">/</span><span class="n">OS</span><span class="o">/</span><span class="n">sysroot</span><span class="o">-</span><span class="n">test</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">none</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">deps</span><span class="o">/</span><span class="n">MyProject</span><span class="o">-</span><span class="mi">7</span><span class="n">c87417b24b424fa</span><span class="p">.</span><span class="mi">3</span><span class="n">nlffb4k7pac6yqh</span><span class="p">.</span><span class="n">rcgu</span><span class="p">.</span><span class="n">o</span>: <span class="nc">in</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="err">`</span><span class="n">_start</span><span class="o">'</span>:
          <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">yoru</span><span class="o">/</span><span class="n">G</span><span class="o">/</span><span class="n">Projects</span><span class="o">/</span><span class="n">OS</span><span class="o">/</span><span class="n">sysroot</span><span class="o">-</span><span class="n">test</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">13</span>: <span class="nc">multiple</span><span class="w"> </span><span class="n">definition</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="err">`</span><span class="n">_start</span><span class="o">'</span><span class="p">;</span><span class="w"> </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">gcc</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="mi">9</span><span class="o">/../../../</span><span class="n">x86_64</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">crt1</span><span class="p">.</span><span class="n">o</span>:<span class="p">(.</span><span class="n">text</span><span class="o">+</span><span class="mh">0x0</span><span class="p">)</span>: <span class="nc">first</span><span class="w"> </span><span class="n">defined</span><span class="w"> </span><span class="n">here</span><span class="w"></span>
<span class="w">          </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">ld</span>: <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">gcc</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="mi">9</span><span class="o">/../../../</span><span class="n">x86_64</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">crt1</span><span class="p">.</span><span class="n">o</span>: <span class="nc">in</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="err">`</span><span class="n">_start</span><span class="o">'</span>:
          <span class="p">(.</span><span class="n">text</span><span class="o">+</span><span class="mh">0x16</span><span class="p">)</span>: <span class="nc">undefined</span><span class="w"> </span><span class="n">reference</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="err">`</span><span class="n">__libc_csu_fini</span><span class="o">'</span><span class="w"></span>
<span class="w">          </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">ld</span>: <span class="p">(.</span><span class="n">text</span><span class="o">+</span><span class="mh">0x1d</span><span class="p">)</span>: <span class="nc">undefined</span><span class="w"> </span><span class="n">reference</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="err">`</span><span class="n">__libc_csu_init</span><span class="o">'</span><span class="w"></span>
<span class="w">          </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">ld</span>: <span class="p">(.</span><span class="n">text</span><span class="o">+</span><span class="mh">0x24</span><span class="p">)</span>: <span class="nc">undefined</span><span class="w"> </span><span class="n">reference</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="err">`</span><span class="n">main</span><span class="o">'</span><span class="w"></span>
<span class="w">          </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">ld</span>: <span class="p">(.</span><span class="n">text</span><span class="o">+</span><span class="mh">0x2a</span><span class="p">)</span>: <span class="nc">undefined</span><span class="w"> </span><span class="n">reference</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="err">`</span><span class="n">__libc_start_main</span><span class="o">'</span><span class="w"></span>
<span class="w">          </span><span class="n">collect2</span>: <span class="nc">error</span>: <span class="nc">ld</span><span class="w"> </span><span class="n">returned</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">exit</span><span class="w"> </span><span class="n">status</span><span class="w"></span>

<span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">help</span>: <span class="nc">some</span><span class="w"> </span><span class="err">`</span><span class="k">extern</span><span class="err">`</span><span class="w"> </span><span class="n">functions</span><span class="w"> </span><span class="n">couldn</span><span class="o">'</span><span class="na">t</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">found</span><span class="p">;</span><span class="w"> </span><span class="n">some</span><span class="w"> </span><span class="n">native</span><span class="w"> </span><span class="n">libraries</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">need</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">installed</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">their</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="n">specified</span><span class="w"></span>
<span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">use</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="err">`</span><span class="o">-</span><span class="n">l</span><span class="err">`</span><span class="w"> </span><span class="n">flag</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">specify</span><span class="w"> </span><span class="n">native</span><span class="w"> </span><span class="n">libraries</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">link</span><span class="w"></span>
<span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">use</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="err">`</span><span class="n">cargo</span>:<span class="nc">rustc</span><span class="o">-</span><span class="n">link</span><span class="o">-</span><span class="n">lib</span><span class="err">`</span><span class="w"> </span><span class="n">directive</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">specify</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">native</span><span class="w"> </span><span class="n">libraries</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">link</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">Cargo</span><span class="w"> </span><span class="p">(</span><span class="n">see</span><span class="w"> </span><span class="n">https</span>:<span class="c1">//doc.rust-lang.org/cargo/reference/build-scripts.html#cargorustc-link-libkindname)</span>

<span class="n">warning</span>: <span class="err">`</span><span class="n">MyProject</span><span class="err">`</span><span class="w"> </span><span class="p">(</span><span class="n">bin</span><span class="w"> </span><span class="s">"MyProject"</span><span class="p">)</span><span class="w"> </span><span class="n">generated</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">warning</span><span class="w"></span>
<span class="n">error</span>: <span class="nc">could</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">compile</span><span class="w"> </span><span class="err">`</span><span class="n">MyProject</span><span class="err">`</span><span class="w"> </span><span class="n">due</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">previous</span><span class="w"> </span><span class="n">error</span><span class="p">;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">warning</span><span class="w"> </span><span class="n">emitted</span><span class="w"></span>
</code></pre></div>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>