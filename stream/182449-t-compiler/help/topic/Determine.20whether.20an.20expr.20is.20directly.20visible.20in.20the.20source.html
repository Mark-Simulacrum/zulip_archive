<html>
<head><meta charset="utf-8"><title>Determine whether an expr is directly visible in the source · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Determine.20whether.20an.20expr.20is.20directly.20visible.20in.20the.20source.html">Determine whether an expr is directly visible in the source</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="260307953"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Determine%20whether%20an%20expr%20is%20directly%20visible%20in%20the%20source/near/260307953" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Will Crichton <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Determine.20whether.20an.20expr.20is.20directly.20visible.20in.20the.20source.html#260307953">(Nov 04 2021 at 17:42)</a>:</h4>
<p>My goal is to determine given a HIR Expr, is the source of that Expr directly visible in the source code. I thought this problem reduced to "is this span coming from a macro", i.e. <code>ex.span.from_expansion()</code>. But I'm encountering some weird cases esp with procedural macros.</p>
<p>For example, I found a span whose ExpnData says <code>kind: Root</code> (and therefore <code>from_expansion</code> returns false), but also <code>macro_def_id</code> is <code>Some(...)</code>. This span was definitely generated by a macro. Any ideas on why this would happen, or how I should accomplish my higher-level goal?</p>



<a name="260314211"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Determine%20whether%20an%20expr%20is%20directly%20visible%20in%20the%20source/near/260314211" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Determine.20whether.20an.20expr.20is.20directly.20visible.20in.20the.20source.html#260314211">(Nov 04 2021 at 18:28)</a>:</h4>
<p>In general, this isn't possible. Procedural macros can apply arbitrary spans to tokens, which can make macro-generated code appear to come from the source code (or vice-versa). Can you elaborate on your use case?</p>



<a name="260319282"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Determine%20whether%20an%20expr%20is%20directly%20visible%20in%20the%20source/near/260319282" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Will Crichton <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Determine.20whether.20an.20expr.20is.20directly.20visible.20in.20the.20source.html#260319282">(Nov 04 2021 at 19:05)</a>:</h4>
<p>The use case is the scrape-examples feature for Rustdoc (see <a href="https://twitter.com/wcrichton/status/1456112165744615426">https://twitter.com/wcrichton/status/1456112165744615426</a>). I'm searching for examples of calls to a function, but I want to exclude calls that were generated by a macro, and hence would not be a useful example since the call doesn't appear in the source.</p>
<div class="inline-preview-twitter"><div class="twitter-tweet"><a href="https://twitter.com/wcrichton/status/1456112165744615426"><img class="twitter-avatar" src="https://uploads.zulipusercontent.net/81c0e0938f855d4e587b1f08664488f20e9c83aa/68747470733a2f2f7062732e7477696d672e636f6d2f70726f66696c655f696d616765732f313239303039393235393430393137343532392f6a2d54326f494d415f6e6f726d616c2e6a7067"></a><p>1 year, 1 RFC, and 1k LOC later... it's finally here! Rustdoc can now automatically scrape code examples from your workspace's examples/ directory as documentation for functions. Check out a live demo:

<a href="https://t.co/abw1GenHWt">https://willcrichton.net/example-analyzer/warp/trait.Filter.html#scraped-examples-5</a> <a href="https://t.co/Ax1QRrwgUa">https://twitter.com/wcrichton/status/1456112165744615426/photo/1</a></p><span>- Will Crichton (@wcrichton)</span><div class="twitter-image"><a href="https://t.co/Ax1QRrwgUa"><img src="https://uploads.zulipusercontent.net/2649dcf392858bd8d6f56c11472d6940d0d9a59c/68747470733a2f2f7062732e7477696d672e636f6d2f6d656469612f4644556c476e6e5645415169646f422e6a70673a736d616c6c"></a></div></div></div>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>