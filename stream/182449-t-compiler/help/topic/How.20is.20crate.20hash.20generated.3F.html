<html>
<head><meta charset="utf-8"><title>How is crate hash generated? · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/How.20is.20crate.20hash.20generated.3F.html">How is crate hash generated?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="273589378"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/How%20is%20crate%20hash%20generated%3F/near/273589378" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jerome Wu <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/How.20is.20crate.20hash.20generated.3F.html#273589378">(Mar 01 2022 at 04:20)</a>:</h4>
<p>Hi there, I am looking at the crate hash generated from TyCtxt::crate_hash (<a href="https://doc.rust-lang.org/stable/nightly-rustc/rustc_middle/ty/struct.TyCtxt.html#method.crate_hash">https://doc.rust-lang.org/stable/nightly-rustc/rustc_middle/ty/struct.TyCtxt.html#method.crate_hash</a>), and I am wondering from what information is the hash generated? I seems that I got two different hashes of the same crate with the same version, and it helps a lot if anyone could give me a pointer where I could find the implementation of crate_hash or probably some documentation. </p>
<p>Thanks in advance!</p>



<a name="273592684"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/How%20is%20crate%20hash%20generated%3F/near/273592684" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> LegionMammal978 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/How.20is.20crate.20hash.20generated.3F.html#273592684">(Mar 01 2022 at 05:15)</a>:</h4>
<p>Some grepping reveals that <code>crate_hash</code> is implemented in <code>compiler/rustc_middle/src/hir/map/mod.rs</code> (from line 1091). You could probably compare the hashes after each step to see where they diverge.</p>



<a name="273711909"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/How%20is%20crate%20hash%20generated%3F/near/273711909" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/How.20is.20crate.20hash.20generated.3F.html#273711909">(Mar 01 2022 at 21:19)</a>:</h4>
<p>See also <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_hir/def_id/struct.StableCrateId.html"><code>rustc_hir::def_id::StableCrateId</code></a>, just because it's interesting :)</p>



<a name="273718334"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/How%20is%20crate%20hash%20generated%3F/near/273718334" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cjgillot <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/How.20is.20crate.20hash.20generated.3F.html#273718334">(Mar 01 2022 at 22:06)</a>:</h4>
<p>There are two concepts.<br>
The stable crate id is a hash, and is used to uniquely identify a crate as part of a compilation. This is contains the crate name, the kind of compilation (check, build...), the dependencies' ids. <br>
The crate hash is used for incremental compilation, to check whether metadata has changed between one run and the next, without having to read the whole metadata file. It's derived from much more information, among which most of the command line arguments, the AST...</p>



<a name="273723526"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/How%20is%20crate%20hash%20generated%3F/near/273723526" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/How.20is.20crate.20hash.20generated.3F.html#273723526">(Mar 01 2022 at 22:50)</a>:</h4>
<p>The crate hash is also used to check if a dependency is still compatible or has changed in the mean time.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>