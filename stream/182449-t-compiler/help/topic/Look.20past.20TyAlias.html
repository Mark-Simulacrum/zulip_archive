<html>
<head><meta charset="utf-8"><title>Look past TyAlias · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Look.20past.20TyAlias.html">Look past TyAlias</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="269437702"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Look%20past%20TyAlias/near/269437702" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hgm4 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Look.20past.20TyAlias.html#269437702">(Jan 26 2022 at 16:17)</a>:</h4>
<p>What is the best way to look past a <code>TyAlias</code> when calling something like <code>def_path_str(def_id)</code>? Trying to figure out the smartest way to go from def_id of the TyAlias to the def_id of item it is aliasing.</p>



<a name="269439710"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Look%20past%20TyAlias/near/269439710" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Look.20past.20TyAlias.html#269439710">(Jan 26 2022 at 16:29)</a>:</h4>
<p>Do you mean <code>hir::ItemKind::TyAlias</code>? If so the fields of it already define the type it aliases. By the way not every type has a <code>DefId</code>. For example all primitive types don't.</p>



<a name="269440222"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Look%20past%20TyAlias/near/269440222" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hgm4 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Look.20past.20TyAlias.html#269440222">(Jan 26 2022 at 16:32)</a>:</h4>
<p>That is good to know, thanks @bjorn3. Right now, I am emitting a string using tcx.def_path_str(def_id) but would like to special case TyAlias to emit the original type. I can wrangle the given def_id I have an get back a <code>hir::ItemKind::TyAlias</code>. Maybe there is something equivalent / better than def_path_str?</p>



<a name="269443558"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Look%20past%20TyAlias/near/269443558" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Look.20past.20TyAlias.html#269443558">(Jan 26 2022 at 16:52)</a>:</h4>
<p>Why do you exactly want to emit a string?</p>



<a name="269444552"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Look%20past%20TyAlias/near/269444552" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hgm4 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Look.20past.20TyAlias.html#269444552">(Jan 26 2022 at 16:58)</a>:</h4>
<p>Lowering to an alternate IR (for research purposes) from HIR and am emitting call targets as strings. Would like to have calls resolve to the same target without having to worry about type aliases.</p>



<a name="269446089"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Look%20past%20TyAlias/near/269446089" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Look.20past.20TyAlias.html#269446089">(Jan 26 2022 at 17:07)</a>:</h4>
<p>Are you sure you want to lower HIR and not MIR? HIR doesn't directly contain type information or any of the type dependent adjustments. HIR becomes immutable after being lowered from the AST and before typechecking. All typechecking information is stored in side tables.</p>



<a name="269447483"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Look%20past%20TyAlias/near/269447483" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hgm4 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Look.20past.20TyAlias.html#269447483">(Jan 26 2022 at 17:17)</a>:</h4>
<p>I think so. In some cases the MIR is too low (I need to be capture certain things, such as patterns, that no longer exist in MIR). I am able to type check everything in the HIR and have the necessary types/adjustments. I'm using <code>tcx.typeck_body(body_id)</code>, where <code>body_id</code> is obtained from <code>tcx.hir().maybe_body_owned_by(tcx.hir().local_def_id_to_hir_id(e.hir_id.owner))</code>, to do so. Getting the resulting type from <code>expr_ty</code> and any adjustments via <code>expr_adjustments</code>.</p>



<a name="269447801"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Look%20past%20TyAlias/near/269447801" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Look.20past.20TyAlias.html#269447801">(Jan 26 2022 at 17:19)</a>:</h4>
<p>Would the THIR layer work? It is roughly HIR except with types and adjustments already applied. It isn't public though at the moment: <a href="https://github.com/rust-lang/rust/tree/master/compiler/rustc_mir_build/src/thir">https://github.com/rust-lang/rust/tree/master/compiler/rustc_mir_build/src/thir</a></p>



<a name="269448520"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Look%20past%20TyAlias/near/269448520" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hgm4 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Look.20past.20TyAlias.html#269448520">(Jan 26 2022 at 17:23)</a>:</h4>
<p>I'll take a look. Thank you.</p>



<a name="269494239"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Look%20past%20TyAlias/near/269494239" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Xavier Denis <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Look.20past.20TyAlias.html#269494239">(Jan 26 2022 at 22:45)</a>:</h4>
<p>The THIR is public, I use it for my verification tool in combination with MIR, it’s a good IR for many translations/analyses</p>



<a name="269494362"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Look%20past%20TyAlias/near/269494362" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Xavier Denis <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Look.20past.20TyAlias.html#269494362">(Jan 26 2022 at 22:46)</a>:</h4>
<p>One gotcha is that typechecking failure is represented by an empty thir</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>