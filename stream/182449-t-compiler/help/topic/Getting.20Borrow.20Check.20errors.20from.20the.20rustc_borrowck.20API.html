<html>
<head><meta charset="utf-8"><title>Getting Borrow Check errors from the rustc_borrowck API · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20Borrow.20Check.20errors.20from.20the.20rustc_borrowck.20API.html">Getting Borrow Check errors from the rustc_borrowck API</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="260809650"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20Borrow%20Check%20errors%20from%20the%20rustc_borrowck%20API/near/260809650" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kiran Gopinathan <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20Borrow.20Check.20errors.20from.20the.20rustc_borrowck.20API.html#260809650">(Nov 09 2021 at 15:00)</a>:</h4>
<p>Is there a reliable way to obtain borrow check errors using the rustc_borrowck public API (i.e while using rustc_borrowck as an external crate)?</p>
<p>Currently, as I understand it, the only interface to the borrow checker exposed in the public api is <code>get_body_with_borrowck_facts</code></p>
<div class="codehilite"><pre><span></span><code>rustc_borrowck::consumers::get_body_with_borrowck_facts(tcx, def)
</code></pre></div>
<p>As I understand, the returned result should contain input and output facts regarding lifetime information that has been inferred by the borrow checker.</p>
<p>The input facts field doesn't contain any error information but can map variables to their uses/borrows/drops, although they only seem to be fully populated if you invoke the compiler with <code>-Znll-facts=y</code>.</p>
<p>However, when running the rustc driver, I've found that the output facts field seems to always be empty, or sometimes has some fields populated (such as <code>move_errors</code>), but this is not consistent.</p>
<p>Is there a better/recommended way of obtaining the error information?</p>



<a name="260821280"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20Borrow%20Check%20errors%20from%20the%20rustc_borrowck%20API/near/260821280" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Xavier Denis <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20Borrow.20Check.20errors.20from.20the.20rustc_borrowck.20API.html#260821280">(Nov 09 2021 at 16:15)</a>:</h4>
<p>Could you explain your objective with this information? I might be able to direct you better if I understood what you are seeking to accomplish. In general extracting usable information from the borrow checker is challenging, but maybe there's an alternative for you</p>



<a name="260888933"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20Borrow%20Check%20errors%20from%20the%20rustc_borrowck%20API/near/260888933" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kiran Gopinathan <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20Borrow.20Check.20errors.20from.20the.20rustc_borrowck.20API.html#260888933">(Nov 10 2021 at 01:39)</a>:</h4>
<p>I'd like to get granular details on the borrow check errors for feedback during a sort of mechanical transpilation into rust - i.e it seems exactly the kind of information that would be present in the <code>output_facts</code> field of <code>BodyWithBorrowChk</code> if it were populated consistently. I am aware that a possible alternative would be to parse the errors output by the rust compiler (some string surgery is still needed even if I ouptut as json), but I would prefer to access this information through the rustc api.</p>
<p>I'm fairly certain this isn't a case of an XY problem - I need the rustc borrow check facts in a programmatic way and I don't see a way around that.</p>



<a name="260984189"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20Borrow%20Check%20errors%20from%20the%20rustc_borrowck%20API/near/260984189" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Xavier Denis <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20Borrow.20Check.20errors.20from.20the.20rustc_borrowck.20API.html#260984189">(Nov 10 2021 at 12:51)</a>:</h4>
<blockquote>
<p>Is there a better way of acessing these errors than through deserialization of the json error messages + string surgery?</p>
</blockquote>
<p>Unfortunately, I don't think so</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>