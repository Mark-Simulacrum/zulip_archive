<html>
<head><meta charset="utf-8"><title>compile external rust crate as static library · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/compile.20external.20rust.20crate.20as.20static.20library.html">compile external rust crate as static library</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="257891755"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/compile%20external%20rust%20crate%20as%20static%20library/near/257891755" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gladys <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/compile.20external.20rust.20crate.20as.20static.20library.html#257891755">(Oct 17 2021 at 05:57)</a>:</h4>
<p>Hi all, my project uses quite a number of dependencies such as tokio. Notice that when compiling my executable, these dependencies mostly is produced as .rlib. Can i check if it is possible to produce them as .a (static lib) instead of .rlib?</p>



<a name="257896019"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/compile%20external%20rust%20crate%20as%20static%20library/near/257896019" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/compile.20external.20rust.20crate.20as.20static.20library.html#257896019">(Oct 17 2021 at 07:11)</a>:</h4>
<p>rlibs are not just object code, they contain a lot of metadata, one important bit being the MIR of generic and <code>#[inline]</code> functions. Machine code cant really encoded generics so its a bit impossible to use them as intermediate reprs of depedencies. Besides, rust doesnt have a stable ABI so it needs to check if version matches or stuff could blow up.</p>



<a name="257896270"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/compile%20external%20rust%20crate%20as%20static%20library/near/257896270" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/compile.20external.20rust.20crate.20as.20static.20library.html#257896270">(Oct 17 2021 at 07:15)</a>:</h4>
<p>if you were to do this anyways, i dont see the benefit, because you couldnt shared dependency static libs because some generic functions may not be monomorphized to what one executable needs, or they could be built with different versions or targets, or with different cfgs, features, etc.</p>



<a name="258016540"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/compile%20external%20rust%20crate%20as%20static%20library/near/258016540" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gladys <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/compile.20external.20rust.20crate.20as.20static.20library.html#258016540">(Oct 18 2021 at 11:56)</a>:</h4>
<p>Hi, reason for compiling to .a (static libs) is because i wanted to add custom llvm pass to the rustc emitted .bc. Which i could then convert the .bc to .s and then use clang to compile into final executable. problem is the linkage, clang would definitely not recognize .rlib. Appreciate if anyone know if it is possible to produce those dependencies in .a instead of .rlib. thanks!</p>



<a name="258054585"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/compile%20external%20rust%20crate%20as%20static%20library/near/258054585" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/compile.20external.20rust.20crate.20as.20static.20library.html#258054585">(Oct 18 2021 at 16:13)</a>:</h4>
<p>Can you use linker plugin LTO and then tell the linker to use this custom LLVM pass or use a wrapper around the linker that runs this LLVM pass?</p>



<a name="258125005"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/compile%20external%20rust%20crate%20as%20static%20library/near/258125005" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gladys <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/compile.20external.20rust.20crate.20as.20static.20library.html#258125005">(Oct 19 2021 at 00:52)</a>:</h4>
<p>Hi bjorn3, will read up and try your suggestion. I am actually new to rust, appreciate if you could give me more direction or example. Thanks :)</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>