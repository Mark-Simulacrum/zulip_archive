<html>
<head><meta charset="utf-8"><title>Multiple Devtool crashes stemming from malloc error · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Multiple.20Devtool.20crashes.20stemming.20from.20malloc.20error.html">Multiple Devtool crashes stemming from malloc error</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="265654824"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Multiple%20Devtool%20crashes%20stemming%20from%20malloc%20error/near/265654824" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keegan Bilodeau <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Multiple.20Devtool.20crashes.20stemming.20from.20malloc.20error.html#265654824">(Dec 21 2021 at 07:23)</a>:</h4>
<p>As of now, I have found two major dev tools - clippy and miri - that are suffering from crashes as a result of a malloc error.  They are as follows:</p>
<div class="codehilite"><pre><span></span><code>Crashed Thread:        1  rustc

Exception Type:        EXC_CRASH (SIGABRT)
Exception Codes:       0x0000000000000000, 0x0000000000000000
Exception Note:        EXC_CORPSE_NOTIFY

Application Specific Information:
clippy-driver(20172,0x7000098d8000) malloc: *** error for object 0x600002e23b00: pointer being realloc&#39;d was not allocated
abort() called
</code></pre></div>
<div class="codehilite"><pre><span></span><code>Crashed Thread:        1  rustc

Exception Type:        EXC_CRASH (SIGABRT)
Exception Codes:       0x0000000000000000, 0x0000000000000000
Exception Note:        EXC_CORPSE_NOTIFY

Application Specific Information:
miri(14735,0x70000800a000) malloc: *** error for object 0x60000461ba00: pointer being realloc&#39;d was not allocated
abort() called
</code></pre></div>



<a name="265654937"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Multiple%20Devtool%20crashes%20stemming%20from%20malloc%20error/near/265654937" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keegan Bilodeau <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Multiple.20Devtool.20crashes.20stemming.20from.20malloc.20error.html#265654937">(Dec 21 2021 at 07:25)</a>:</h4>
<p>This issue seems to be localized to the MacOS nightly builds of rustc starting 2021-12-05 and onwards.</p>



<a name="265654986"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Multiple%20Devtool%20crashes%20stemming%20from%20malloc%20error/near/265654986" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keegan Bilodeau <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Multiple.20Devtool.20crashes.20stemming.20from.20malloc.20error.html#265654986">(Dec 21 2021 at 07:26)</a>:</h4>
<p>Would it be helpful to have the complete crash logs?</p>



<a name="265655603"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Multiple%20Devtool%20crashes%20stemming%20from%20malloc%20error/near/265655603" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keegan Bilodeau <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Multiple.20Devtool.20crashes.20stemming.20from.20malloc.20error.html#265655603">(Dec 21 2021 at 07:38)</a>:</h4>
<p><a href="/user_uploads/4715/jEYqeOoZX9efmNcyYvJyaf5U/clippy-driver-2021-12-21-010508.ips">clippy-driver-2021-12-21-010508.ips</a> <br>
<a href="/user_uploads/4715/njY-z4ZKlBxhZ6Hp8HvKkZoN/miri-2021-12-20-182132.ips">miri-2021-12-20-182132.ips</a> <br>
it is 1 am for me, so I am leaving this here just in case it will be helpful for someone before I wake up again</p>



<a name="265655799"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Multiple%20Devtool%20crashes%20stemming%20from%20malloc%20error/near/265655799" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keegan Bilodeau <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Multiple.20Devtool.20crashes.20stemming.20from.20malloc.20error.html#265655799">(Dec 21 2021 at 07:40)</a>:</h4>
<p>text versions for non-mac users who'd like to help investigate as well<br>
<a href="/user_uploads/4715/o335PeoN-YxjNQV6pvayOwY2/clippy.txt">clippy.txt</a><br>
<a href="/user_uploads/4715/vIdyoF8DDgrGp-A8GVYhpAaq/miri.txt">miri.txt</a></p>



<a name="265659349"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Multiple%20Devtool%20crashes%20stemming%20from%20malloc%20error/near/265659349" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Multiple.20Devtool.20crashes.20stemming.20from.20malloc.20error.html#265659349">(Dec 21 2021 at 08:33)</a>:</h4>
<p>Can you open an issue?</p>



<a name="265700037"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Multiple%20Devtool%20crashes%20stemming%20from%20malloc%20error/near/265700037" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keegan Bilodeau <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Multiple.20Devtool.20crashes.20stemming.20from.20malloc.20error.html#265700037">(Dec 21 2021 at 15:48)</a>:</h4>
<p><span class="user-mention silent" data-user-id="133247">bjorn3</span> <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/Multiple.20Devtool.20crashes.20stemming.20from.20malloc.20error/near/265659349">said</a>:</p>
<blockquote>
<p>Can you open an issue?</p>
</blockquote>
<p>On the rust repo?</p>



<a name="265703177"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Multiple%20Devtool%20crashes%20stemming%20from%20malloc%20error/near/265703177" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Multiple.20Devtool.20crashes.20stemming.20from.20malloc.20error.html#265703177">(Dec 21 2021 at 16:13)</a>:</h4>
<p>Yes</p>



<a name="265725235"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Multiple%20Devtool%20crashes%20stemming%20from%20malloc%20error/near/265725235" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Multiple.20Devtool.20crashes.20stemming.20from.20malloc.20error.html#265725235">(Dec 21 2021 at 19:29)</a>:</h4>
<p><span class="user-mention" data-user-id="457767">@Keegan Bilodeau</span> Can you confirm where you installed Rust from?  Was it the official builds via rustup?</p>
<p>Over at <a href="https://github.com/rust-lang/cargo/issues/10022">https://github.com/rust-lang/cargo/issues/10022</a> we have determined that builds done without jemalloc have been crashing with a similar realloc failure.  I forgot to file an issue on it, but I have now opened <a href="https://github.com/rust-lang/rust/issues/92173">#92173</a>.  Not sure if you have a similar situation.</p>



<a name="265759576"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Multiple%20Devtool%20crashes%20stemming%20from%20malloc%20error/near/265759576" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keegan Bilodeau <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Multiple.20Devtool.20crashes.20stemming.20from.20malloc.20error.html#265759576">(Dec 22 2021 at 02:35)</a>:</h4>
<p><span class="user-mention silent" data-user-id="120518">Eric Huss</span> <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/Multiple.20Devtool.20crashes.20stemming.20from.20malloc.20error/near/265725235">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="457767">Keegan Bilodeau</span> Can you confirm where you installed Rust from?  Was it the official builds via rustup?</p>
<p>Over at <a href="https://github.com/rust-lang/cargo/issues/10022">https://github.com/rust-lang/cargo/issues/10022</a> we have determined that builds done without jemalloc have been crashing with a similar realloc failure.  I forgot to file an issue on it, but I have now opened <a href="https://github.com/rust-lang/rust/issues/92173">#92173</a>.  Not sure if you have a similar situation.</p>
</blockquote>
<p>I can confirm that I did install Rust officially through Rustup, so I have opened this issue on the rust repo <a href="https://github.com/rust-lang/rust/issues/92185">https://github.com/rust-lang/rust/issues/92185</a></p>



<a name="265759641"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Multiple%20Devtool%20crashes%20stemming%20from%20malloc%20error/near/265759641" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keegan Bilodeau <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Multiple.20Devtool.20crashes.20stemming.20from.20malloc.20error.html#265759641">(Dec 22 2021 at 02:36)</a>:</h4>
<p>Also, I have determined that this issue specifically affects crates that involve proc macro crates, either it is a proc macro crate or it's a workspace that contains a proc macro crate.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>