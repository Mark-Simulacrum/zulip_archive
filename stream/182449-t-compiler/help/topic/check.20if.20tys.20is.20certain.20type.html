<html>
<head><meta charset="utf-8"><title>check if tys is certain type · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/check.20if.20tys.20is.20certain.20type.html">check if tys is certain type</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="259193915"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/check%20if%20tys%20is%20certain%20type/near/259193915" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/check.20if.20tys.20is.20certain.20type.html#259193915">(Oct 27 2021 at 05:09)</a>:</h4>
<p>What is the best way to check if the ty of a struct is a specific type in an easy manner? such as if i want to find out if a TyS is <code>somecrate::foo::Bar</code></p>



<a name="259761570"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/check%20if%20tys%20is%20certain%20type/near/259761570" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/check.20if.20tys.20is.20certain.20type.html#259761570">(Oct 31 2021 at 01:21)</a>:</h4>
<p>If you're specifically checking the type of a struct, couldn't you compare the <code>DefId</code> of the struct in question against the <code>DefId</code> of <code>somecrate::foo::Bar</code>? Or did I misunderstand your question?</p>



<a name="259778420"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/check%20if%20tys%20is%20certain%20type/near/259778420" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Xavier Denis <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/check.20if.20tys.20is.20certain.20type.html#259778420">(Oct 31 2021 at 09:11)</a>:</h4>
<p>I think his question is how to find the DefId of <code>somecrate::foo::Bar</code>. Depending on your restrictions you may be able to use a <code>rustc_diagnostic_item</code></p>



<a name="259806793"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/check%20if%20tys%20is%20certain%20type/near/259806793" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/check.20if.20tys.20is.20certain.20type.html#259806793">(Oct 31 2021 at 20:30)</a>:</h4>
<p>I'm not sure how to <em>get</em> the DefId of that struct, i'd need to get rustc to find it somehow</p>



<a name="259809326"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/check%20if%20tys%20is%20certain%20type/near/259809326" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/check.20if.20tys.20is.20certain.20type.html#259809326">(Oct 31 2021 at 21:31)</a>:</h4>
<p>Is this a struct known in advance, something like <code>Vec</code>?</p>



<a name="259809645"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/check%20if%20tys%20is%20certain%20type/near/259809645" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/check.20if.20tys.20is.20certain.20type.html#259809645">(Oct 31 2021 at 21:40)</a>:</h4>
<p>Yes</p>



<a name="259809717"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/check%20if%20tys%20is%20certain%20type/near/259809717" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/check.20if.20tys.20is.20certain.20type.html#259809717">(Oct 31 2021 at 21:42)</a>:</h4>
<p>If this is for diagnostics purposes, use a <a href="https://rustc-dev-guide.rust-lang.org/diagnostics/diagnostic-items.html">diagnostic item</a>. If it could change program behavior, use a <a href="https://rustc-dev-guide.rust-lang.org/lang-items.html">language item</a>.</p>



<a name="259809808"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/check%20if%20tys%20is%20certain%20type/near/259809808" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/check.20if.20tys.20is.20certain.20type.html#259809808">(Oct 31 2021 at 21:45)</a>:</h4>
<p>This is for my custom codegen backend, i want to support the OptiX library (gpu-side), but optix has some very... exotic ways of doing things. For example, only certain programs are allowed to call certain functions, for example, an <code>__anyhit__</code> program (if a ray hits any object) cannot call trace (to trace a new ray), stuff like that. So i was thinking of implementing certain checks as lints, since i can register them because codegens are rustc_private</p>



<a name="259809815"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/check%20if%20tys%20is%20certain%20type/near/259809815" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/check.20if.20tys.20is.20certain.20type.html#259809815">(Oct 31 2021 at 21:45)</a>:</h4>
<p>so i need to check that certain structs in a crate called <code>optix_gpu</code> are not being used incorrectly/in an odd way</p>



<a name="259810283"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/check%20if%20tys%20is%20certain%20type/near/259810283" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/check.20if.20tys.20is.20certain.20type.html#259810283">(Oct 31 2021 at 21:57)</a>:</h4>
<p>Well, I think the only "correct" way to do it would be to add <code>rustc_diagnostic_item</code> to that library, but that's probably impractical. A somewhat hacky way of doing it, which would have to be updated whenever something was moved or renamed in the library, would be to do a string comparison of <code>def_path_str</code> against <code>somecrate::foo::Bar</code>.</p>



<a name="259810318"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/check%20if%20tys%20is%20certain%20type/near/259810318" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/check.20if.20tys.20is.20certain.20type.html#259810318">(Oct 31 2021 at 21:58)</a>:</h4>
<p>Hmm i see, i think checking def_path_str should be mostly fine, since the path of those structs should not change</p>



<a name="259810441"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/check%20if%20tys%20is%20certain%20type/near/259810441" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/check.20if.20tys.20is.20certain.20type.html#259810441">(Oct 31 2021 at 22:00)</a>:</h4>
<p>although the first would prob work too, since the codegen needs to be build with rustc_private, and on the nvptx targets the crate only builds if its using the custom codegen</p>



<a name="259810538"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/check%20if%20tys%20is%20certain%20type/near/259810538" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/check.20if.20tys.20is.20certain.20type.html#259810538">(Oct 31 2021 at 22:01)</a>:</h4>
<p>Note that <code>rustc_diagnostic_item</code> is an internal-use-only attribute; it's feature-gated behind <code>rustc_attrs</code> (or similar). So adding it to the library is probably still not great.</p>



<a name="259810557"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/check%20if%20tys%20is%20certain%20type/near/259810557" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/check.20if.20tys.20is.20certain.20type.html#259810557">(Oct 31 2021 at 22:01)</a>:</h4>
<p>I don't think it matters if the said library can only be used with a custom codegen</p>



<a name="259810607"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/check%20if%20tys%20is%20certain%20type/near/259810607" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/check.20if.20tys.20is.20certain.20type.html#259810607">(Oct 31 2021 at 22:02)</a>:</h4>
<p>Codegen backends are more rustc internal than lang items or diagnostic items</p>



<a name="259813351"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/check%20if%20tys%20is%20certain%20type/near/259813351" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Xavier Denis <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/check.20if.20tys.20is.20certain.20type.html#259813351">(Oct 31 2021 at 23:05)</a>:</h4>
<p>yea use <code>rustc_diagnostic_item</code> for this. In my verification tool I heavily (ab)use this to allow my verification backend to be aware of certain information.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>