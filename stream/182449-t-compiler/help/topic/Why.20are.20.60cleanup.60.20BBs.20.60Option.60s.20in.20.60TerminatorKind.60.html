<html>
<head><meta charset="utf-8"><title>Why are `cleanup` BBs `Option`s in `TerminatorKind` · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Why.20are.20.60cleanup.60.20BBs.20.60Option.60s.20in.20.60TerminatorKind.60.html">Why are `cleanup` BBs `Option`s in `TerminatorKind`</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="275309970"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Why%20are%20%60cleanup%60%20BBs%20%60Option%60s%20in%20%60TerminatorKind%60/near/275309970" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Why.20are.20.60cleanup.60.20BBs.20.60Option.60s.20in.20.60TerminatorKind.60.html#275309970">(Mar 14 2022 at 23:06)</a>:</h4>
<p>For <code>InlineAsm</code> this makes sense, but why does eg <code>Assert</code> have a <code>cleanup: Option&lt;BasicBlock&gt;</code>? What does it being <code>None</code> indicate? I originally thought this might be for double panics, but that doesn't seem to be what codegen implements. Is it being <code>None</code> just an "unsafe" assertion that this won't unwind?</p>



<a name="275311079"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Why%20are%20%60cleanup%60%20BBs%20%60Option%60s%20in%20%60TerminatorKind%60/near/275311079" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Why.20are.20.60cleanup.60.20BBs.20.60Option.60s.20in.20.60TerminatorKind.60.html#275311079">(Mar 14 2022 at 23:19)</a>:</h4>
<p>Looking at e.g. <a href="https://github.com/rust-lang/rust/blob/285fa7ecd05dcbfdaf2faaf20400f5f92b39b3c6/compiler/rustc_mir_transform/src/abort_unwinding_calls.rs#L88"><code>AbortUnwindingCalls::run_pass</code></a>, it seems like <code>Assert</code> terminators can have a cleanup block or not depending on whether <code>panic=abort</code> or <code>panic=unwind</code> is set</p>



<a name="275355702"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Why%20are%20%60cleanup%60%20BBs%20%60Option%60s%20in%20%60TerminatorKind%60/near/275355702" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tm <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Why.20are.20.60cleanup.60.20BBs.20.60Option.60s.20in.20.60TerminatorKind.60.html#275355702">(Mar 15 2022 at 10:41)</a>:</h4>
<p>None means no cleanup is to be performed during unwinding. Either because it is known that terminator will never unwind, i.e., the case already mentioned, or because there is simply nothing to clean up. For the latter situation see <code>RemoveNoopLandingPads</code>.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>