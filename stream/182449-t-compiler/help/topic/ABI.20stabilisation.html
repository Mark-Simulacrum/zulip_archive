<html>
<head><meta charset="utf-8"><title>ABI stabilisation · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/ABI.20stabilisation.html">ABI stabilisation</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="258316806"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/ABI%20stabilisation/near/258316806" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Vente <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/ABI.20stabilisation.html#258316806">(Oct 20 2021 at 06:03)</a>:</h4>
<p>Hi. I'm aware that this is a potentially huge topic, so I'm not expecting a definitive or exhaustive answer. The question is, what would it take for the rust ABI to be stabilised? For context, I was reading this blog series about developing a system that can integrate Rust plugins: <a href="https://nullderef.com/blog/plugin-start/">https://nullderef.com/blog/plugin-start/</a> and there it mentions that even though the entire stack is Rust, because the ABI interface is unstable even between compiler runs, they had to resort to the "C" ABI which massively added the amount of  <code>unsafe</code> code. I have some interest in systems like these, but I do also think that being able to create system that can handle plugins with minimal <code>unsafe</code> code would be a boon for the ecosystem (along with other benefits of course). </p>
<p>I know this is probably RFC worthy so I just wanted to ask around what people thought before diving into that. This is not even something I'm remotely skilled enough to work on myself, but I did just want to start a conversation about it. Is it even remotely realistic to expect? Would people see the benefit? What kind of work would need to happen?</p>



<a name="258319998"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/ABI%20stabilisation/near/258319998" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/ABI.20stabilisation.html#258319998">(Oct 20 2021 at 06:48)</a>:</h4>
<p>Rust ABI is intentionally unstable</p>



<a name="258322328"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/ABI%20stabilisation/near/258322328" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/ABI.20stabilisation.html#258322328">(Oct 20 2021 at 07:11)</a>:</h4>
<p>I wouldnt say its realistic to expect any time soon, same with a spec. Honestly, if ever, not even C++ has a stable ABI (cross-os/compiler). Stabilizing the ABI would be a huge amount of work and be potentially catastrophic if all of the sudden we want to change it for performance, memory use, safety, whatever. So i am personally opposed to ever stabilizing it, but having a definite list of "this is ub, this isnt" is certainly very helpful, but we won't see this any time soon because specs are difficult and rust is still under heavy development</p>



<a name="258322494"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/ABI%20stabilisation/near/258322494" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/ABI.20stabilisation.html#258322494">(Oct 20 2021 at 07:13)</a>:</h4>
<p>besides, using the rust ABI for plugins is not a good thing anyways, because the C abi can be used by... basically all languages used by more than 20 people. While the rust ABI would not be implemented by others because theres no point, the C abi is supported by everything</p>



<a name="258326132"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/ABI%20stabilisation/near/258326132" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/ABI.20stabilisation.html#258326132">(Oct 20 2021 at 07:48)</a>:</h4>
<p>Part of the issue, as well, is that a Rust ABI isn't just about "how to pass arguments", or even the semantics of things like lifetimes and references; the Rust ABI includes generics, and any generic function can't just be supplied as a single function pointer.</p>



<a name="258326169"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/ABI%20stabilisation/near/258326169" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/ABI.20stabilisation.html#258326169">(Oct 20 2021 at 07:48)</a>:</h4>
<p>When a Rust crate exposes a function with generics in it, that function isn't just supplied as a linkable library to the crates consuming it.</p>



<a name="258326218"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/ABI%20stabilisation/near/258326218" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/ABI.20stabilisation.html#258326218">(Oct 20 2021 at 07:49)</a>:</h4>
<p>It's supplied in a form that can be compiled with different types substituted in, and the crate linking in the function will compile a copy for any given set of generic types it uses.</p>



<a name="258326298"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/ABI%20stabilisation/near/258326298" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/ABI.20stabilisation.html#258326298">(Oct 20 2021 at 07:50)</a>:</h4>
<p>There are ways around that; it'd be possible, for instance, to expose an ABI based on <code>dyn Trait</code> and runtime dispatch. That's what Swift did to provide an ABI that supports generics.</p>



<a name="258326332"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/ABI%20stabilisation/near/258326332" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/ABI.20stabilisation.html#258326332">(Oct 20 2021 at 07:50)</a>:</h4>
<p>But such an ABI doesn't exist yet, and we can't stabilize something that hasn't even been written yet.</p>



<a name="258326443"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/ABI%20stabilisation/near/258326443" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/ABI.20stabilisation.html#258326443">(Oct 20 2021 at 07:51)</a>:</h4>
<p>I don't think we'll ever stabilize <code>extern "Rust"</code>, but I personally would be in favor of stabilizing an <code>extern "safe"</code> or similar, which provides a superset of C, along with types like <code>Vec</code>, <code>String</code>, <code>&amp;str</code>, <code>&amp;[slices]</code>, <code>dyn Trait</code>, and a handful of other things.</p>



<a name="258401585"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/ABI%20stabilisation/near/258401585" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/ABI.20stabilisation.html#258401585">(Oct 20 2021 at 16:46)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/ABI.20stabilisation/near/258326298">said</a>:</p>
<blockquote>
<p>There are ways around that; it'd be possible, for instance, to expose an ABI based on <code>dyn Trait</code> and runtime dispatch. That's what Swift did to provide an ABI that supports generics.</p>
</blockquote>
<p>wouldnt that be fundamentally impossible for a lot of cases? do you mean like being able to mark a generic function as <code>extern "traitobj"</code> or something like that, and having rustc error if the type cannot be made into a trait object?</p>



<a name="258442711"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/ABI%20stabilisation/near/258442711" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/ABI.20stabilisation.html#258442711">(Oct 20 2021 at 20:55)</a>:</h4>
<p>I think I wouldn't want it to be automatically converted. I would want the ABI to act like extern "C" and complain if you use it with unsupported types.</p>



<a name="258683195"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/ABI%20stabilisation/near/258683195" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Vente <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/ABI.20stabilisation.html#258683195">(Oct 22 2021 at 09:05)</a>:</h4>
<p>This was a helpful read, thanks everyone :D</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>