<html>
<head><meta charset="utf-8"><title>how to build stage0 with unmodified std? · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/how.20to.20build.20stage0.20with.20unmodified.20std.3F.html">how to build stage0 with unmodified std?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="274180644"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/how%20to%20build%20stage0%20with%20unmodified%20std%3F/near/274180644" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/how.20to.20build.20stage0.20with.20unmodified.20std.3F.html#274180644">(Mar 04 2022 at 19:55)</a>:</h4>
<p>I'm doing some changes to std that make it no longer buildable by stage0. Is there a way to make stage0 std be built from an unmodified source?</p>
<p>(I'm experimenting with addihg a <code>?Leak</code> trait that works  like <code>?Sized</code>. This means I have to write <code>T: ?Sized + ?Leak</code>  which is currently not accepted. I could <code>#[cfg(bootstrap)]</code> every single instance of it, but there are a lot...)</p>



<a name="274181795"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/how%20to%20build%20stage0%20with%20unmodified%20std%3F/near/274181795" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/how.20to.20build.20stage0.20with.20unmodified.20std.3F.html#274181795">(Mar 04 2022 at 20:04)</a>:</h4>
<p>Rustc itself often uses methods added to libstd before the bootstrap compiler is bumped to a new version with them, so it needs the libstd build from <code>library/std</code>.</p>



<a name="274182576"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/how%20to%20build%20stage0%20with%20unmodified%20std%3F/near/274182576" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/how.20to.20build.20stage0.20with.20unmodified.20std.3F.html#274182576">(Mar 04 2022 at 20:11)</a>:</h4>
<p>so if I copy <code>library/std</code> to <code>library/std0</code> then apply my changes to <code>library/std</code> only</p>



<a name="274182612"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/how%20to%20build%20stage0%20with%20unmodified%20std%3F/near/274182612" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/how.20to.20build.20stage0.20with.20unmodified.20std.3F.html#274182612">(Mar 04 2022 at 20:11)</a>:</h4>
<p>is there any way to force the build system to build stage0 std from <code>std0</code> instead?</p>



<a name="274184957"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/how%20to%20build%20stage0%20with%20unmodified%20std%3F/near/274184957" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/how.20to.20build.20stage0.20with.20unmodified.20std.3F.html#274184957">(Mar 04 2022 at 20:32)</a>:</h4>
<p>oh well, I guess I can do this</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#[cfg_attr(bootstrap, path = </span><span class="s">"marker_bootstrap.rs"</span><span class="cp">)]</span><span class="w"></span>
<span class="k">pub</span><span class="w"> </span><span class="k">mod</span> <span class="nn">marker</span><span class="p">;</span><span class="w"></span>
</code></pre></div>



<a name="274216201"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/how%20to%20build%20stage0%20with%20unmodified%20std%3F/near/274216201" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/how.20to.20build.20stage0.20with.20unmodified.20std.3F.html#274216201">(Mar 05 2022 at 03:21)</a>:</h4>
<p>If you just need it locally for experimenting, one hack that can suffice is to build once without your changes, then build only with <code>--keep-stage-std 0</code> afterwards so it doesn't rebuild the library.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>