<html>
<head><meta charset="utf-8"><title>Linking with mold · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Linking.20with.20mold.html">Linking with mold</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="265036534"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Linking%20with%20mold/near/265036534" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ruster <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Linking.20with.20mold.html#265036534">(Dec 15 2021 at 16:35)</a>:</h4>
<p>Hello, I believe Rust should use mold as its default linker and or support it in the future. Can I open an issue about that on &lt;<a href="https://github.com/rust-lang/rust/issues">https://github.com/rust-lang/rust/issues</a>&gt;?</p>



<a name="265036761"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Linking%20with%20mold/near/265036761" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ruster <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Linking.20with.20mold.html#265036761">(Dec 15 2021 at 16:36)</a>:</h4>
<p>It is faster than LLVM lld: <a href="https://github.com/rui314/mold/tree/v1.0.0#mold-a-modern-linker">https://github.com/rui314/mold/tree/v1.0.0#mold-a-modern-linker</a></p>



<a name="265037071"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Linking%20with%20mold/near/265037071" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Linking.20with.20mold.html#265037071">(Dec 15 2021 at 16:39)</a>:</h4>
<p>For it to be the default one it would have to support all the use-cases that are currently supported. and afaik the default linker actually is platform specific because not all linkers work on all platforms.<br>
The hurdle for opt-in support may be lower.</p>



<a name="265037241"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Linking%20with%20mold/near/265037241" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Linking.20with.20mold.html#265037241">(Dec 15 2021 at 16:40)</a>:</h4>
<p>And all those benchmarks are C/C++ code, a rust-specific one would help making the argument for it.</p>



<a name="265049885"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Linking%20with%20mold/near/265049885" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Linking.20with.20mold.html#265049885">(Dec 15 2021 at 18:03)</a>:</h4>
<p>I'd love to see mold become more widely used as well, but the first step would be to add support for it at all.</p>



<a name="265061920"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Linking%20with%20mold/near/265061920" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ruster <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Linking.20with.20mold.html#265061920">(Dec 15 2021 at 19:28)</a>:</h4>
<p>I did <code>mold -run cargo build</code> and it seemed to have worked. I tested it on a pretty big Rust project. However I think I did something wrong when benchmarking so I refrained from opening that issue for now.</p>



<a name="265061931"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Linking%20with%20mold/near/265061931" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hans Kratz <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Linking.20with.20mold.html#265061931">(Dec 15 2021 at 19:28)</a>:</h4>
<p>Mold works fine with Rust on Linux with both <code>mold -run cargo build</code> and <code>RUSTFLAGS="-Clink-arg=-fuse-ld=mold" cargo build</code>. Is there any further support required on the Rust side? It's a main goal of mold to be fully compatible with gold and lld.</p>
<p>It still needs a bit of time before it could become default IMHO even for Linux ELF. It just hit 1.0 and it notably <a href="https://github.com/rui314/mold/issues/88#issuecomment-960600648">does not support LTO yet</a>.</p>



<a name="265064830"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Linking%20with%20mold/near/265064830" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Linking.20with.20mold.html#265064830">(Dec 15 2021 at 19:47)</a>:</h4>
<p>If you are using LTO, most of the "linking" time will be spent inside LLVM anyway, so a fast linker missing LTO support is not a big deal. Just switch to a slower linker when enabling LTO.</p>



<a name="265069183"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Linking%20with%20mold/near/265069183" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ruster <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Linking.20with.20mold.html#265069183">(Dec 15 2021 at 20:15)</a>:</h4>
<p>Exactly.</p>
<p>Well, if anyone wants to open an issue, please go ahead so we can track it.</p>



<a name="265069499"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Linking%20with%20mold/near/265069499" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Linking.20with.20mold.html#265069499">(Dec 15 2021 at 20:18)</a>:</h4>
<p>what are we tracking, though?</p>



<a name="265069571"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Linking%20with%20mold/near/265069571" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Linking.20with.20mold.html#265069571">(Dec 15 2021 at 20:18)</a>:</h4>
<p>it seems to work fine today</p>



<a name="265307472"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Linking%20with%20mold/near/265307472" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ruster <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Linking.20with.20mold.html#265307472">(Dec 17 2021 at 15:07)</a>:</h4>
<p><span class="user-mention" data-user-id="232545">@Joshua Nelson</span>  I guess making it the default one maybe? Isn't the "Linking with lld" about making it the default as well? So I don't see why we wouldn't want to do the same with mold, considering that most statistics say that it's even faster than lld</p>



<a name="265309951"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Linking%20with%20mold/near/265309951" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Linking.20with.20mold.html#265309951">(Dec 17 2021 at 15:24)</a>:</h4>
<p><span aria-label="shrug" class="emoji emoji-1f937" role="img" title="shrug">:shrug:</span> I think it's too early to plan making it the default</p>



<a name="265322137"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Linking%20with%20mold/near/265322137" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ruster <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Linking.20with.20mold.html#265322137">(Dec 17 2021 at 16:27)</a>:</h4>
<p>Well recently it's made its 1.0 release with the Linux platform now stable. I think it's never too early to open an issue just to not forget about it.</p>



<a name="265322899"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Linking%20with%20mold/near/265322899" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Linking.20with.20mold.html#265322899">(Dec 17 2021 at 16:32)</a>:</h4>
<blockquote>
<p>implying that issues aren't forgotten almost as soon as they're opened</p>
</blockquote>



<a name="265324581"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Linking%20with%20mold/near/265324581" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ruster <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Linking.20with.20mold.html#265324581">(Dec 17 2021 at 16:44)</a>:</h4>
<p>imo no, they are not forgotten because they will be saved on that tracker and everyone can subscribe to the issue and get notifications on updates. this Zulip discussion is far more likely to be forgotten imo</p>



<a name="265337765"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Linking%20with%20mold/near/265337765" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Linking.20with.20mold.html#265337765">(Dec 17 2021 at 18:15)</a>:</h4>
<p>please do not.</p>



<a name="265337954"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Linking%20with%20mold/near/265337954" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Linking.20with.20mold.html#265337954">(Dec 17 2021 at 18:16)</a>:</h4>
<p>The issue tracker is cluttered with seven thousand issues.<br>
You have not even presented a compelling reason why we should switch to it as opposed to well-tested linkers like gold, lld, etc.</p>



<a name="265338270"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Linking%20with%20mold/near/265338270" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Linking.20with.20mold.html#265338270">(Dec 17 2021 at 18:19)</a>:</h4>
<p>Really, we should only switch to mold instead of those if it also would fix every <code>A-linkage</code> issue and introduce no new ones. Which won't be the case.</p>



<a name="265338508"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Linking%20with%20mold/near/265338508" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Linking.20with.20mold.html#265338508">(Dec 17 2021 at 18:20)</a>:</h4>
<p>A fair amount of <code>A-linkage</code> issues are in rustc itself and not the linker.</p>



<a name="265338866"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Linking%20with%20mold/near/265338866" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Linking.20with.20mold.html#265338866">(Dec 17 2021 at 18:23)</a>:</h4>
<p>Yes.<br>
But at least some of them have to do with correctly passing on invocations to the linker, and introducing a new linker to transition to, when we have already been gradually transitioning towards using lld, means we would now have to teach rustc to correctly invoke <strong>yet another</strong> linker.</p>



<a name="265338991"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Linking%20with%20mold/near/265338991" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Linking.20with.20mold.html#265338991">(Dec 17 2021 at 18:24)</a>:</h4>
<p>The same trick used to invoke lld should work for mold I think, so maybe a couple of lines extra?</p>



<a name="265339084"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Linking%20with%20mold/near/265339084" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Linking.20with.20mold.html#265339084">(Dec 17 2021 at 18:25)</a>:</h4>
<p>And then we get to find all the bugs in mold that haven't been found and tested yet. :D</p>



<a name="265340363"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Linking%20with%20mold/near/265340363" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Linking.20with.20mold.html#265340363">(Dec 17 2021 at 18:35)</a>:</h4>
<p>There were definitely references to “weird concurrency bugs” I've seen around mold's issue tracker, so I definitely would be quite wary of making the linker a default for a time being.</p>



<a name="265342026"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Linking%20with%20mold/near/265342026" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Linking.20with.20mold.html#265342026">(Dec 17 2021 at 18:48)</a>:</h4>
<p>And linking with LLD and gold was something people were interested in because it not only gave a speedup, but also those linkers had good, widely-tested support for many of our platforms of interest already, and at least in the gold case is already present on many hosts people are using.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>