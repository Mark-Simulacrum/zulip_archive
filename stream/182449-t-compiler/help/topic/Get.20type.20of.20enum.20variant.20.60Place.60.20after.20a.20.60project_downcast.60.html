<html>
<head><meta charset="utf-8"><title>Get type of enum variant `Place` after a `project_downcast` · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Get.20type.20of.20enum.20variant.20.60Place.60.20after.20a.20.60project_downcast.60.html">Get type of enum variant `Place` after a `project_downcast`</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="275428981"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Get%20type%20of%20enum%20variant%20%60Place%60%20after%20a%20%60project_downcast%60/near/275428981" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Hughes <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Get.20type.20of.20enum.20variant.20.60Place.60.20after.20a.20.60project_downcast.60.html#275428981">(Mar 15 2022 at 20:11)</a>:</h4>
<p>Hi, during codegen, how do I get the type of an enum variant from the <code>Place</code> after a <code>place.project_downcast(builder, vidx)</code> call? </p>
<p>For example:</p>
<div class="codehilite"><pre><span></span><code>let variant_place = place.project_downcast(builder, variant_index);
let variant_ty = variant_place.layout.ty.subst(builder.tcx, adt_substs);
</code></pre></div>
<p><code>variant_ty</code> seems to return the type of the enum adt, not the type of the variant. What am I doing wrong here?</p>



<a name="275429403"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Get%20type%20of%20enum%20variant%20%60Place%60%20after%20a%20%60project_downcast%60/near/275429403" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Get.20type.20of.20enum.20variant.20.60Place.60.20after.20a.20.60project_downcast.60.html#275429403">(Mar 15 2022 at 20:14)</a>:</h4>
<p>Enum variants don't have types. The closest to what you want I think is <code>mir::Place::ty</code> (<a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/mir/struct.Place.html#method.ty">https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/mir/struct.Place.html#method.ty</a>) which returns a <code>PlaceTy</code> which is a combination of a <code>Ty</code> and an optional variant index. Note that this method is on <code>mir::Place</code> and not on the <code>Place</code> of cg_ssa.</p>



<a name="275431620"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Get%20type%20of%20enum%20variant%20%60Place%60%20after%20a%20%60project_downcast%60/near/275431620" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Hughes <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Get.20type.20of.20enum.20variant.20.60Place.60.20after.20a.20.60project_downcast.60.html#275431620">(Mar 15 2022 at 20:34)</a>:</h4>
<p>thanks bjorn, that looks like it might be what i'm after</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>