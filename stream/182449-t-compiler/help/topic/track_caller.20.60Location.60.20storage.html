<html>
<head><meta charset="utf-8"><title>track_caller `Location` storage · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/track_caller.20.60Location.60.20storage.html">track_caller `Location` storage</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="251948997"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/track_caller%20%60Location%60%20storage/near/251948997" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Reeves <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/track_caller.20.60Location.60.20storage.html#251948997">(Sep 03 2021 at 22:15)</a>:</h4>
<p>When allocating static memory for <code>panic::Location</code> structs, what determines the actual location of the structs in the final object file? I tried to figure this out on my own but there's not much written documentation I could find about the MIR interpreter's memory allocation.</p>
<p>The reason I ask is because I would like to try to hack the compiler to make all <code>Location</code> structs land in a dedicated section of the binary. If that is already the case, then even better :)</p>



<a name="251949478"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/track_caller%20%60Location%60%20storage/near/251949478" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/track_caller.20.60Location.60.20storage.html#251949478">(Sep 03 2021 at 22:21)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/blob/9556d7a09a7e80e84430071b29d118f39dde8205/compiler/rustc_codegen_ssa/src/mir/block.rs#L1146">https://github.com/rust-lang/rust/blob/9556d7a09a7e80e84430071b29d118f39dde8205/compiler/rustc_codegen_ssa/src/mir/block.rs#L1146</a></p>



<a name="251949756"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/track_caller%20%60Location%60%20storage/near/251949756" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/track_caller.20.60Location.60.20storage.html#251949756">(Sep 03 2021 at 22:24)</a>:</h4>
<p>creation of the llvm static is done around <a href="https://github.com/rust-lang/rust/blob/d54fbb98555c107fb62fb5ae1a5b8f4fc6ed3edc/compiler/rustc_codegen_llvm/src/common.rs#L246">https://github.com/rust-lang/rust/blob/d54fbb98555c107fb62fb5ae1a5b8f4fc6ed3edc/compiler/rustc_codegen_llvm/src/common.rs#L246</a></p>



<a name="251949800"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/track_caller%20%60Location%60%20storage/near/251949800" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/track_caller.20.60Location.60.20storage.html#251949800">(Sep 03 2021 at 22:25)</a>:</h4>
<p>this is shared with all static memory, including promoted values.</p>



<a name="251953787"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/track_caller%20%60Location%60%20storage/near/251953787" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Reeves <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/track_caller.20.60Location.60.20storage.html#251953787">(Sep 03 2021 at 23:14)</a>:</h4>
<p>Is this the same mechanism that an item tagged with an explicit <code>#[link_section]</code> would go through? That's the same kind of thing I want to achieve.</p>



<a name="251955952"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/track_caller%20%60Location%60%20storage/near/251955952" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/track_caller.20.60Location.60.20storage.html#251955952">(Sep 03 2021 at 23:46)</a>:</h4>
<p>I don't think this is currently possible</p>



<a name="251956022"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/track_caller%20%60Location%60%20storage/near/251956022" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Reeves <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/track_caller.20.60Location.60.20storage.html#251956022">(Sep 03 2021 at 23:48)</a>:</h4>
<p><span class="user-mention silent" data-user-id="303710">Gary Guo</span> <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/track_caller.20.60Location.60.20storage/near/251955952">said</a>:</p>
<blockquote>
<p>I don't think this is currently possible</p>
</blockquote>
<p>Hrm <span aria-label="oh no" class="emoji emoji-1f615" role="img" title="oh no">:oh_no:</span> could you provide a brief explanation as to why you think that's the case? And whether you mean "possible" as in "possible without hacking the compiler" or as in "possible without drastic changes to the compiler"?</p>



<a name="251956273"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/track_caller%20%60Location%60%20storage/near/251956273" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/track_caller.20.60Location.60.20storage.html#251956273">(Sep 03 2021 at 23:51)</a>:</h4>
<p>Without major change</p>



<a name="251956351"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/track_caller%20%60Location%60%20storage/near/251956351" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/track_caller.20.60Location.60.20storage.html#251956351">(Sep 03 2021 at 23:52)</a>:</h4>
<p>As bjorn3 said, it's treated similar to all static memory &amp; promotions</p>



<a name="251956367"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/track_caller%20%60Location%60%20storage/near/251956367" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/track_caller.20.60Location.60.20storage.html#251956367">(Sep 03 2021 at 23:53)</a>:</h4>
<p>So this information has to be carried along all the way to codegen</p>



<a name="251956396"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/track_caller%20%60Location%60%20storage/near/251956396" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Reeves <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/track_caller.20.60Location.60.20storage.html#251956396">(Sep 03 2021 at 23:54)</a>:</h4>
<p>I'm not familiar enough with this stuff to understand the difference between what you're referring to as "static memory" and what a user would refer to as a static variable with a <code>#[link_section]</code> attribute.</p>



<a name="251956557"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/track_caller%20%60Location%60%20storage/near/251956557" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/track_caller.20.60Location.60.20storage.html#251956557">(Sep 03 2021 at 23:56)</a>:</h4>
<p>a static variable has a <code>DefId</code> which the backend could go and retrieve its codegen attributes</p>



<a name="251956575"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/track_caller%20%60Location%60%20storage/near/251956575" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/track_caller.20.60Location.60.20storage.html#251956575">(Sep 03 2021 at 23:56)</a>:</h4>
<p>Caller location is however entirely anonymous</p>



<a name="251956619"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/track_caller%20%60Location%60%20storage/near/251956619" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/track_caller.20.60Location.60.20storage.html#251956619">(Sep 03 2021 at 23:57)</a>:</h4>
<p>Basically codegen only sees the layout and its bytes (plus few other things like relocation)</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>