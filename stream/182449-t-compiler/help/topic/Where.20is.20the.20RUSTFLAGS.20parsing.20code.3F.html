<html>
<head><meta charset="utf-8"><title>Where is the RUSTFLAGS parsing code? · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Where.20is.20the.20RUSTFLAGS.20parsing.20code.3F.html">Where is the RUSTFLAGS parsing code?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="275416256"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Where%20is%20the%20RUSTFLAGS%20parsing%20code%3F/near/275416256" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Kimock (Saethlin) <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Where.20is.20the.20RUSTFLAGS.20parsing.20code.3F.html#275416256">(Mar 15 2022 at 18:28)</a>:</h4>
<p>Someone is tripping over Miri's MIRIFLAGS parsing (which is very hand-rolled). Where is the RUSTFLAGS parsing code? I'd like to look over it as a reference.</p>



<a name="275416556"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Where%20is%20the%20RUSTFLAGS%20parsing%20code%3F/near/275416556" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Where.20is.20the.20RUSTFLAGS.20parsing.20code.3F.html#275416556">(Mar 15 2022 at 18:30)</a>:</h4>
<p>That code is here: <a href="https://github.com/rust-lang/miri/blob/2170d7a7c9ee7c7ee943acf6d7db928b9587cb39/cargo-miri/bin.rs#L934-L939">https://github.com/rust-lang/miri/blob/2170d7a7c9ee7c7ee943acf6d7db928b9587cb39/cargo-miri/bin.rs#L934-L939</a> According to the comment it is a taken from the RUSTFLAGS parsing code in cargo.</p>



<a name="275416613"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Where%20is%20the%20RUSTFLAGS%20parsing%20code%3F/near/275416613" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Where.20is.20the.20RUSTFLAGS.20parsing.20code.3F.html#275416613">(Mar 15 2022 at 18:31)</a>:</h4>
<p>Do you want an argument with a space? Neither MIRIFLAGS nor RUSTFLAGS supports that.</p>



<a name="275416830"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Where%20is%20the%20RUSTFLAGS%20parsing%20code%3F/near/275416830" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Where.20is.20the.20RUSTFLAGS.20parsing.20code.3F.html#275416830">(Mar 15 2022 at 18:32)</a>:</h4>
<p>Cargo has <code>CARGO_ENCODED_RUSTFLAGS</code> which does support spaces inside arguments. It requires arguments to be separated by <code>\x1f</code> (ASCII Unit Separator)</p>



<a name="275416836"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Where%20is%20the%20RUSTFLAGS%20parsing%20code%3F/near/275416836" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Kimock (Saethlin) <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Where.20is.20the.20RUSTFLAGS.20parsing.20code.3F.html#275416836">(Mar 15 2022 at 18:32)</a>:</h4>
<p>Well, in RUSTFLAGS I can say <code>RUSTFLAGS="-C opt-level=1</code>, but <code>MIRIFLAGS=-Z miri-tag-raw-pointers</code> is rejected. So I do want a space, but not the one you're thinking of?</p>



<a name="275416900"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Where%20is%20the%20RUSTFLAGS%20parsing%20code%3F/near/275416900" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Kimock (Saethlin) <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Where.20is.20the.20RUSTFLAGS.20parsing.20code.3F.html#275416900">(Mar 15 2022 at 18:33)</a>:</h4>
<p>So what Miri is missing is the space replacement?</p>



<a name="275417103"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Where%20is%20the%20RUSTFLAGS%20parsing%20code%3F/near/275417103" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Where.20is.20the.20RUSTFLAGS.20parsing.20code.3F.html#275417103">(Mar 15 2022 at 18:34)</a>:</h4>
<p>That code starts here: <a href="https://github.com/rust-lang/miri/blob/2170d7a7c9ee7c7ee943acf6d7db928b9587cb39/src/bin/miri.rs#L300">https://github.com/rust-lang/miri/blob/2170d7a7c9ee7c7ee943acf6d7db928b9587cb39/src/bin/miri.rs#L300</a> It hard codes specific strings.</p>



<a name="275417142"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Where%20is%20the%20RUSTFLAGS%20parsing%20code%3F/near/275417142" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Where.20is.20the.20RUSTFLAGS.20parsing.20code.3F.html#275417142">(Mar 15 2022 at 18:34)</a>:</h4>
<p>Unlike rustc which uses getopts for parsing arguments.</p>



<a name="275417238"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Where%20is%20the%20RUSTFLAGS%20parsing%20code%3F/near/275417238" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Where.20is.20the.20RUSTFLAGS.20parsing.20code.3F.html#275417238">(Mar 15 2022 at 18:35)</a>:</h4>
<p>I'm not sure it is possible for miri to use getopts as miri needs to pass all unrecognized arguments verbatim to rustc.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>