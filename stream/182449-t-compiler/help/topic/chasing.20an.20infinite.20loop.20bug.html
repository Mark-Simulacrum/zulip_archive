<html>
<head><meta charset="utf-8"><title>chasing an infinite loop bug · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/chasing.20an.20infinite.20loop.20bug.html">chasing an infinite loop bug</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="253405204"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/chasing%20an%20infinite%20loop%20bug/near/253405204" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Trevor Arjeski <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/chasing.20an.20infinite.20loop.20bug.html#253405204">(Sep 15 2021 at 12:32)</a>:</h4>
<p>Taking this problem here from <a class="stream" data-stream-id="122651" href="/#narrow/stream/122651-general">#general</a> ... My (very large) project does not compile with <code>--release</code> on the latest nightly. It gets SIGKILL'd and appears to be stuck in an endless loop. I'd like to find the root cause of the issue -- maybe a piece of code that is causing it, so that I can effectively report a bug.</p>
<p>I've already pulled <code>rustc</code> and built a stage1 toolchain so that I can get more debug information, but now I'm a bit lost. </p>
<p>Is there a way that I can actually see which code/MIR/IR the compiler is stuck compiling?</p>



<a name="253405826"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/chasing%20an%20infinite%20loop%20bug/near/253405826" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fee1-dead <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/chasing.20an.20infinite.20loop.20bug.html#253405826">(Sep 15 2021 at 12:37)</a>:</h4>
<p>You could enable RUSTC_LOG, and see all the logging messages. It should be stuck in a loop, and that should give you the idea that which part is looping.</p>



<a name="253405999"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/chasing%20an%20infinite%20loop%20bug/near/253405999" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Trevor Arjeski <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/chasing.20an.20infinite.20loop.20bug.html#253405999">(Sep 15 2021 at 12:38)</a>:</h4>
<p>Yeah i have that with a filter on the module that seems to come up when i do a ctrl+c with gdb. The amount of logs are insane, and don't tell me much about what is being compiled (maybe i just can't read them)</p>



<a name="253406077"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/chasing%20an%20infinite%20loop%20bug/near/253406077" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Trevor Arjeski <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/chasing.20an.20infinite.20loop.20bug.html#253406077">(Sep 15 2021 at 12:39)</a>:</h4>
<p>maybe i need a better filter</p>



<a name="253406420"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/chasing%20an%20infinite%20loop%20bug/near/253406420" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fee1-dead <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/chasing.20an.20infinite.20loop.20bug.html#253406420">(Sep 15 2021 at 12:42)</a>:</h4>
<p>The logs show you the relevant functions, you could track down the call path. It might just be too large though.</p>



<a name="253412311"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/chasing%20an%20infinite%20loop%20bug/near/253412311" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/chasing.20an.20infinite.20loop.20bug.html#253412311">(Sep 15 2021 at 13:24)</a>:</h4>
<p><span class="user-mention" data-user-id="439914">@Trevor Arjeski</span> what RUSTC_LOG setting are you currently using? Maybe we can help you narrow it down to reduce the output</p>



<a name="253416595"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/chasing%20an%20infinite%20loop%20bug/near/253416595" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Trevor Arjeski <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/chasing.20an.20infinite.20loop.20bug.html#253416595">(Sep 15 2021 at 13:49)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116083">pnkfelix</span> <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/chasing.20an.20infinite.20loop.20bug/near/253412311">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="439914">Trevor Arjeski</span> what RUSTC_LOG setting are you currently using? Maybe we can help you narrow it down to reduce the output</p>
</blockquote>
<p><code>RUSTC_LOG=rustc_monomorphize::collector=debug cargo +stage1 b --release</code></p>



<a name="253417320"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/chasing%20an%20infinite%20loop%20bug/near/253417320" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Trevor Arjeski <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/chasing.20an.20infinite.20loop.20bug.html#253417320">(Sep 15 2021 at 13:53)</a>:</h4>
<p>i will let it SIGKILL and then see what the last log lines are</p>



<a name="253432669"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/chasing%20an%20infinite%20loop%20bug/near/253432669" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Trevor Arjeski <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/chasing.20an.20infinite.20loop.20bug.html#253432669">(Sep 15 2021 at 15:23)</a>:</h4>
<p>ok well even without the filter, the only thing happening is monomorphize collector</p>



<a name="253459563"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/chasing%20an%20infinite%20loop%20bug/near/253459563" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/chasing.20an.20infinite.20loop.20bug.html#253459563">(Sep 15 2021 at 17:57)</a>:</h4>
<p>I wonder if this is the same bug as <a href="https://github.com/rust-lang/rust/issues/88862">#88862</a>; that one hangs in the monomorphization collector too (it eventually does finish, but it takes much longer than it used to).</p>



<a name="253462222"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/chasing%20an%20infinite%20loop%20bug/near/253462222" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Trevor Arjeski <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/chasing.20an.20infinite.20loop.20bug.html#253462222">(Sep 15 2021 at 18:13)</a>:</h4>
<p>thanks for this link. it does seem very similar, especially since debug profile allows it to finish after a long while</p>



<a name="253463786"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/chasing%20an%20infinite%20loop%20bug/near/253463786" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/chasing.20an.20infinite.20loop.20bug.html#253463786">(Sep 15 2021 at 18:24)</a>:</h4>
<p>did this start appearing after <a href="https://github.com/rust-lang/rust/pull/85499">https://github.com/rust-lang/rust/pull/85499</a> as well ?</p>



<a name="253464128"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/chasing%20an%20infinite%20loop%20bug/near/253464128" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Trevor Arjeski <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/chasing.20an.20infinite.20loop.20bug.html#253464128">(Sep 15 2021 at 18:27)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116113">lqd</span> <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/chasing.20an.20infinite.20loop.20bug/near/253463786">said</a>:</p>
<blockquote>
<p>did this start appearing after <a href="https://github.com/rust-lang/rust/pull/85499">https://github.com/rust-lang/rust/pull/85499</a> as well ?</p>
</blockquote>
<p>My codebase is working on a nightly from late august, so I don't think so</p>



<a name="253464395"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/chasing%20an%20infinite%20loop%20bug/near/253464395" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/chasing.20an.20infinite.20loop.20bug.html#253464395">(Sep 15 2021 at 18:28)</a>:</h4>
<p>Hmm, that PR landed in late August (I think its first nightly would have been 2021-08-25 or 2021-08-26). Do you know which nightly your codebase worked on?</p>



<a name="253464519"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/chasing%20an%20infinite%20loop%20bug/near/253464519" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Trevor Arjeski <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/chasing.20an.20infinite.20loop.20bug.html#253464519">(Sep 15 2021 at 18:29)</a>:</h4>
<p><span aria-label="shock" class="emoji emoji-1f628" role="img" title="shock">:shock:</span>  mine is nightly-2021-08-23</p>



<a name="253464903"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/chasing%20an%20infinite%20loop%20bug/near/253464903" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/chasing.20an.20infinite.20loop.20bug.html#253464903">(Sep 15 2021 at 18:31)</a>:</h4>
<p>Yeah, I think that PR might have been the cause ;)</p>



<a name="253464942"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/chasing%20an%20infinite%20loop%20bug/near/253464942" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/chasing.20an.20infinite.20loop.20bug.html#253464942">(Sep 15 2021 at 18:32)</a>:</h4>
<p>cc <span class="user-mention" data-user-id="232957">@Jack Huey</span></p>



<a name="253475325"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/chasing%20an%20infinite%20loop%20bug/near/253475325" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/chasing.20an.20infinite.20loop.20bug.html#253475325">(Sep 15 2021 at 19:41)</a>:</h4>
<p>maybe related: <a href="#narrow/stream/122651-general/topic/cargo.20build.20hangs.2C.20how.20to.20minimize">https://rust-lang.zulipchat.com/#narrow/stream/122651-general/topic/cargo.20build.20hangs.2C.20how.20to.20minimize</a></p>



<a name="253475495"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/chasing%20an%20infinite%20loop%20bug/near/253475495" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/chasing.20an.20infinite.20loop.20bug.html#253475495">(Sep 15 2021 at 19:42)</a>:</h4>
<p>While a minimization is "best", doing <code>RUSTC_LOG=rustc_trait_selection,rustc_infer</code> is also helpful</p>



<a name="253475576"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/chasing%20an%20infinite%20loop%20bug/near/253475576" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/chasing.20an.20infinite.20loop.20bug.html#253475576">(Sep 15 2021 at 19:43)</a>:</h4>
<p>Shouldn't need more than a few seconds. You'll likely see lots of recursion near the end; most of that can be truncated</p>



<a name="253475639"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/chasing%20an%20infinite%20loop%20bug/near/253475639" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/chasing.20an.20infinite.20loop.20bug.html#253475639">(Sep 15 2021 at 19:43)</a>:</h4>
<p>If that is too much, also just doing <code>RUSTC_LOG=rustc_trait_selection</code> can be helpful</p>



<a name="253496207"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/chasing%20an%20infinite%20loop%20bug/near/253496207" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/chasing.20an.20infinite.20loop.20bug.html#253496207">(Sep 15 2021 at 22:14)</a>:</h4>
<p>it seems there's a more minimal version available now <span aria-label="thumbs up" class="emoji emoji-1f44d" role="img" title="thumbs up">:thumbs_up:</span> <a href="https://github.com/rust-lang/rust/issues/88862#issuecomment-920413133">https://github.com/rust-lang/rust/issues/88862#issuecomment-920413133</a></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>