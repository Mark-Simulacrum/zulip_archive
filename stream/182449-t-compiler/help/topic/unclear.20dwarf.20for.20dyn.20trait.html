<html>
<head><meta charset="utf-8"><title>unclear dwarf for dyn trait · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/unclear.20dwarf.20for.20dyn.20trait.html">unclear dwarf for dyn trait</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="260616563"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/unclear%20dwarf%20for%20dyn%20trait/near/260616563" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manuel Drehwald <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/unclear.20dwarf.20for.20dyn.20trait.html#260616563">(Nov 08 2021 at 05:24)</a>:</h4>
<p>I'm currently trying to add support for Rust traits to an Auto-diff tool: <a href="https://github.com/wsmoses/Enzyme/pull/307">https://github.com/wsmoses/Enzyme/pull/307</a><br>
Enzyme is, to some extend, able to deduce the type/size of variables and generate the correct gradients.<br>
It is however preferable to pass a precise TypeTree along with each variable, such that Enzyme doesn't have to apply heuristics.</p>
<p>Examples for the explicit handling of other types are here: <a href="https://github.com/wsmoses/Enzyme/pull/307/files#diff-7022452470a9ea83bd88f50e7a337b0f3e62ebcf34ca5055ecba36f7f91974ad">https://github.com/wsmoses/Enzyme/pull/307/files#diff-7022452470a9ea83bd88f50e7a337b0f3e62ebcf34ca5055ecba36f7f91974ad</a><br>
I have created a short example rust code which uses dyn Animal here: <a href="https://github.com/ZuseZ4/dwarf">https://github.com/ZuseZ4/dwarf</a><br>
For convenience I've extracted relevant dwarf info into the README.md</p>
<p>My issue here is that the Debug Info leads to a struct { pointer, vtable } struct of type { *mut u8, [usize; 3] }, no matter if I follow it's <br>
elements, or its templateParams entry.<br>
I am missing some kind of forward link here, in order to know that we might continue with any of [cat, horse, sheep, cow], to generate <br>
a SubTypetTree for each of the cases. </p>
<p>Is there any general reason why such a forward link can't be included into the dwarf debug information of the animal variable?<br>
As a side note, I've been working on some other area of enzyme before, I've not implemented the TypeTree analysis for the other Rust types.</p>
<p>I've found these two entries. To me they read like my issue could be solved, but would require to adjust the entire toolchain, is that correct?<br>
<a href="https://rustc-dev-guide.rust-lang.org/debugging-support-in-rustc.html#dwarf-and-traits">https://rustc-dev-guide.rust-lang.org/debugging-support-in-rustc.html#dwarf-and-traits</a><br>
<a href="https://github.com/rust-lang/rust/issues/33014">https://github.com/rust-lang/rust/issues/33014</a></p>



<a name="260673898"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/unclear%20dwarf%20for%20dyn%20trait/near/260673898" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kyle Huey <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/unclear.20dwarf.20for.20dyn.20trait.html#260673898">(Nov 08 2021 at 15:40)</a>:</h4>
<p>How would this forward link actually work? The trait object could potentially point to any implementation of the trait, even ones that aren't in the current CU.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>