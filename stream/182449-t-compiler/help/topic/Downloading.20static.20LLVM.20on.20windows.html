<html>
<head><meta charset="utf-8"><title>Downloading static LLVM on windows · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html">Downloading static LLVM on windows</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="222369943"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222369943" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222369943">(Jan 11 2021 at 22:56)</a>:</h4>
<p>So I found that <code>download-ci-llvm = true</code> actually works without changes on windows if you do the following things:</p>
<ul>
<li>Build LLVM from source (<code>x.py --stage 0 compiler/rustc</code> and cancel it when it starts cargo)</li>
<li><code>cp -r build/$TARGET/llvm build/$TARGET/ci-llvm</code></li>
<li>Add <code>[llvm] download-ci-llvm = true</code> in config.toml</li>
<li>Apply the following diff to bootstrap:</li>
</ul>
<div class="codehilite" data-code-language="Diff"><pre><span></span><code><span class="gh">diff --git a/src/bootstrap/config.rs b/src/bootstrap/config.rs</span>
<span class="gh">index f4d89a89c14..448cdf7bbc7 100644</span>
<span class="gd">--- a/src/bootstrap/config.rs</span>
<span class="gi">+++ b/src/bootstrap/config.rs</span>
<span class="gu">@@ -817,7 +817,7 @@ pub fn parse(args: &amp;[String]) -&gt; Config {</span>
                 check_ci_llvm!(llvm.polly);

                 // CI-built LLVM is shared
<span class="gd">-                config.llvm_link_shared = true;</span>
<span class="gi">+                //config.llvm_link_shared = true;</span>
             }

             if config.llvm_thin_lto {
</code></pre></div>
<p>So I think this might actually be doable! As I see it, there are two things we need to do to actually make this work without hacks:</p>
<ol>
<li>Add the static LLVM libraries to <code>rust-dev</code> on CI. Right now the <code>lib/</code> folder is completely missing.</li>
<li>Detect whether the downloaded LLVM is using dynamic or static linking in bootstrap. Right now it unconditionally assumes dynamic linking - maybe this is as easy as adding a sentinal file?</li>
</ol>
<p><span class="user-mention" data-user-id="116122">@simulacrum</span> what do you think? :)<br>
cc <span class="user-mention" data-user-id="224471">@Lokathor</span></p>



<a name="222370058"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222370058" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222370058">(Jan 11 2021 at 22:57)</a>:</h4>
<p>I know this doesn't use dynamic linking which you wanted to do, but just saving the initial build is worth it I think</p>



<a name="222370126"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222370126" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222370126">(Jan 11 2021 at 22:58)</a>:</h4>
<p>especially since I don't think ThinLTO runs at all in debug mode, and I expect most people to use this in debug mode</p>



<a name="222371024"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222371024" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222371024">(Jan 11 2021 at 23:06)</a>:</h4>
<p>dynamic linking is not necessary on my side</p>



<a name="222371035"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222371035" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222371035">(Jan 11 2021 at 23:06)</a>:</h4>
<p>that's more of a thinlto thing</p>



<a name="222371046"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222371046" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222371046">(Jan 11 2021 at 23:07)</a>:</h4>
<p>we don't use thinlto on windows</p>



<a name="222371145"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222371145" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222371145">(Jan 11 2021 at 23:08)</a>:</h4>
<p>ok great! should I make a PR uploading the static files to S3?</p>



<a name="222371168"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222371168" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222371168">(Jan 11 2021 at 23:08)</a>:</h4>
<p>(also, is there a way to test the behavior without having to get it merged to master first?)</p>



<a name="222371187"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222371187" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222371187">(Jan 11 2021 at 23:08)</a>:</h4>
<p>yep you can switch try to produce windows artifacts, just edit the file</p>



<a name="222371318"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222371318" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222371318">(Jan 11 2021 at 23:10)</a>:</h4>
<p>which file, sorry? <a href="http://dist.rs">dist.rs</a>?</p>



<a name="222371377"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222371377" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222371377">(Jan 11 2021 at 23:10)</a>:</h4>
<p>Uh ci.yml somewhere, there's two, one should tell you to edit the other at the top</p>



<a name="222371391"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222371391" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222371391">(Jan 11 2021 at 23:11)</a>:</h4>
<p>Sorry not at a computer</p>



<a name="222371407"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222371407" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222371407">(Jan 11 2021 at 23:11)</a>:</h4>
<p>np, that gets me close enough</p>



<a name="222371421"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222371421" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222371421">(Jan 11 2021 at 23:11)</a>:</h4>
<p>Look in .GitHub first that'll give you the non canonical one with instructions</p>



<a name="222380529"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222380529" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222380529">(Jan 12 2021 at 01:06)</a>:</h4>
<p><span class="user-mention" data-user-id="116122">@simulacrum</span> <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/Downloading.20static.20LLVM.20on.20windows/near/222371187">said</a>:</p>
<blockquote>
<p>yep you can switch try to produce windows artifacts, just edit the file</p>
</blockquote>
<p>I found</p>
<div class="codehilite" data-code-language="YAML"><pre><span></span><code>  <span class="nt">try</span><span class="p">:</span>
    <span class="nt">&lt;&lt;</span><span class="p">:</span> <span class="nv">*base-ci-job</span>
    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">try</span>
    <span class="nt">env</span><span class="p">:</span>
      <span class="nt">&lt;&lt;</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="nv">*shared-ci-variables</span><span class="p p-Indicator">,</span> <span class="nv">*prod-variables</span><span class="p p-Indicator">]</span>
    <span class="nt">if</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">github.event_name == 'push' &amp;&amp; (github.ref == 'refs/heads/try' || github.ref == 'refs/heads/try-perf') &amp;&amp; github.repository == 'rust-lang-ci/rust'</span>
    <span class="nt">strategy</span><span class="p">:</span>
      <span class="nt">matrix</span><span class="p">:</span>
        <span class="nt">include</span><span class="p">:</span>
          <span class="p p-Indicator">-</span> <span class="nv">*dist-x86_64-linux</span>
</code></pre></div>
<p>in <code>src/ci/githuib-actions/ci.yml</code>. Should I add <code>dist-x86_64-pc-windows-msvc</code>? That adds an extra job, which doesn't seem quite right</p>



<a name="222380634"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222380634" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222380634">(Jan 12 2021 at 01:08)</a>:</h4>
<p>the only mention of LLVM I see in that file is <code>--set llvm.ninja=false</code></p>



<a name="222380658"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222380658" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222380658">(Jan 12 2021 at 01:09)</a>:</h4>
<p>oh wait I think I misunderstood - was the bit about windows artifacts a way for me to test my changes with <code>rustup-toolchain-install-master</code>?</p>



<a name="222380851"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222380851" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222380851">(Jan 12 2021 at 01:12)</a>:</h4>
<p>ok yes, and the bit where bootstrap actually uploads LLVM artifacts to s3 is <code>dist::maybe_install_llvm</code> I think</p>



<a name="222382324"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222382324" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222382324">(Jan 12 2021 at 01:37)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/pull/80932">https://github.com/rust-lang/rust/pull/80932</a> (but no idea if it works yet)</p>



<a name="222382334"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222382334" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222382334">(Jan 12 2021 at 01:37)</a>:</h4>
<p>if someone uses windows and wants to help test, please let me know!</p>



<a name="222382449"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222382449" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222382449">(Jan 12 2021 at 01:39)</a>:</h4>
<p>how do I cancel a <code>@bors try</code>? I forgot to run expand-yaml-anchors :/</p>



<a name="222382707"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222382707" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222382707">(Jan 12 2021 at 01:43)</a>:</h4>
<p>does anyone understand this error?</p>
<div class="codehilite"><pre><span></span><code>error: failed to expand src/ci/github-actions/ci.yml into .github/workflows/ci.yml
caused by: failed to parse src/ci/github-actions/ci.yml
caused by: while parsing node, found unknown anchor at line 647 column 13
</code></pre></div>
<p>that line is </p>
<div class="codehilite" data-code-language="YAML"><pre><span></span><code>        <span class="nt">include</span><span class="p">:</span>
          <span class="p p-Indicator">-</span> <span class="nv">*dist-x86_64-msvc</span>
</code></pre></div>



<a name="222382783"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222382783" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222382783">(Jan 12 2021 at 01:44)</a>:</h4>
<p>I checked and there's a msvc job on line 580 :/</p>



<a name="222382901"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222382901" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222382901">(Jan 12 2021 at 01:46)</a>:</h4>
<p>ok I think this worked:</p>
<div class="codehilite" data-code-language="Diff"><pre><span></span><code><span class="gh">diff --git a/src/ci/github-actions/ci.yml b/src/ci/github-actions/ci.yml</span>
<span class="gh">index 56e9623b2c1..d4df212cd0c 100644</span>
<span class="gd">--- a/src/ci/github-actions/ci.yml</span>
<span class="gi">+++ b/src/ci/github-actions/ci.yml</span>
<span class="gu">@@ -577,7 +577,8 @@ jobs:</span>
               CUSTOM_MINGW: 1
             &lt;&lt;: *job-windows-xl

<span class="gd">-          - name: dist-x86_64-msvc</span>
<span class="gi">+          - &amp;dist-x86_64-msvc</span>
<span class="gi">+            name: dist-x86_64-msvc</span>
             env:
               RUST_CONFIGURE_ARGS: &gt;-
                 --build=x86_64-pc-windows-msvc
</code></pre></div>



<a name="222386245"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222386245" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222386245">(Jan 12 2021 at 02:53)</a>:</h4>
<p>does anyone know what this means?</p>
<div class="codehilite"><pre><span></span><code>llvm-config: error: component libraries and shared library

 llvm-config: error: missing: D:\a\rust\rust\build\x86_64-pc-windows-msvc\llvm\build\lib\gtest.lib
llvm-config: error: missing: D:\a\rust\rust\build\x86_64-pc-windows-msvc\llvm\build\lib\gtest_main.lib
llvm-config: error: missing: D:\a\rust\rust\build\x86_64-pc-windows-msvc\llvm\build\lib\LLVMTestingSupport.lib
thread &#39;main&#39; panicked at &#39;command did not execute successfully: &quot;D:\\a\\rust\\rust\\build\\x86_64-pc-windows-msvc\\llvm\\build\\bin\\llvm-config.exe&quot; &quot;--libfiles&quot;
</code></pre></div>



<a name="222386260"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222386260" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222386260">(Jan 12 2021 at 02:53)</a>:</h4>
<p>I think it's coming from <a href="https://github.com/rust-lang/rust/blob/fe531d5a5f1404281e3fb237daaf87b8180bd13d/src/bootstrap/dist.rs#L1847">https://github.com/rust-lang/rust/blob/fe531d5a5f1404281e3fb237daaf87b8180bd13d/src/bootstrap/dist.rs#L1847</a></p>



<a name="222386414"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222386414" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222386414">(Jan 12 2021 at 02:57)</a>:</h4>
<p>the same command locally works fine :/ <a href="https://hastebin.com/acoborigor.apache">https://hastebin.com/acoborigor.apache</a></p>



<a name="222386475"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222386475" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222386475">(Jan 12 2021 at 02:58)</a>:</h4>
<p>oh boo it got deleted, but it was a bunch of <code>.lib</code> files in <code>build/$TARGET/llvm</code></p>



<a name="222387439"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222387439" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222387439">(Jan 12 2021 at 03:18)</a>:</h4>
<p>the llvm-config error is emitted here: <a href="https://github.com/rust-lang/llvm-project/blob/fb115ee43b77601b237717c21ab0a8f5b5b9d50a/llvm/tools/llvm-config/llvm-config.cpp#L649">https://github.com/rust-lang/llvm-project/blob/fb115ee43b77601b237717c21ab0a8f5b5b9d50a/llvm/tools/llvm-config/llvm-config.cpp#L649</a></p>



<a name="222387446"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222387446" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222387446">(Jan 12 2021 at 03:18)</a>:</h4>
<p>my best guess is that LLVM expects the test libraries to be built but they aren't? I don't know why tests would be necessary just to run <code>--libfiles</code></p>



<a name="222387448"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222387448" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222387448">(Jan 12 2021 at 03:18)</a>:</h4>
<p><span class="user-mention" data-user-id="138448">@cuviper</span> do you happen to have ideas? or know who I would ask?</p>



<a name="222390380"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222390380" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222390380">(Jan 12 2021 at 04:23)</a>:</h4>
<p>I'm not sure -- usually I build dynamic</p>



<a name="222390390"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222390390" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222390390">(Jan 12 2021 at 04:23)</a>:</h4>
<p>(and I haven't booted Windows in months... <span aria-label="wink" class="emoji emoji-1f609" role="img" title="wink">:wink:</span> )</p>



<a name="222390624"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222390624" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222390624">(Jan 12 2021 at 04:29)</a>:</h4>
<p>I don't think this is actually related to windows</p>



<a name="222390628"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222390628" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222390628">(Jan 12 2021 at 04:29)</a>:</h4>
<p>it looks rustbuild has never called <code>llvm-config --libfiles</code> with  static linking before</p>



<a name="222390738"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222390738" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222390738">(Jan 12 2021 at 04:31)</a>:</h4>
<p>I think for now I'll try enabling the test components and see if it helps</p>



<a name="222426334"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222426334" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222426334">(Jan 12 2021 at 13:00)</a>:</h4>
<p><span class="user-mention" data-user-id="232545">@Joshua Nelson</span> it might help to look at llvm-config's help and explicitly tell it you are using static files, but it's quite possible that the tool itself is broken - I ran into quite a few bugs myself.</p>



<a name="222436234"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222436234" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222436234">(Jan 12 2021 at 14:18)</a>:</h4>
<p>I'm waiting to work on this more until a friend with a windows machine has time to help - 45 minute turnaround times are really frustrating</p>



<a name="222436257"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222436257" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222436257">(Jan 12 2021 at 14:18)</a>:</h4>
<p>is there a way to link statically on linux btw? that would let me test locally</p>



<a name="222437139"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222437139" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oliver <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222437139">(Jan 12 2021 at 14:24)</a>:</h4>
<p>not sure exactly but you can install .NET on linux</p>



<a name="222437306"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222437306" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oliver <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222437306">(Jan 12 2021 at 14:26)</a>:</h4>
<p>that's how you would compile C#</p>



<a name="222437341"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222437341" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222437341">(Jan 12 2021 at 14:26)</a>:</h4>
<p>I don't need a windows runtime environment, I just need static linking to work</p>



<a name="222437364"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222437364" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222437364">(Jan 12 2021 at 14:26)</a>:</h4>
<p>I'm trying link-shared = false for now</p>



<a name="222437398"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222437398" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oliver <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222437398">(Jan 12 2021 at 14:26)</a>:</h4>
<p>yeah I'm not certain</p>



<a name="222438386"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222438386" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222438386">(Jan 12 2021 at 14:33)</a>:</h4>
<p>apparently that means I have to rebuild llvm <span aria-label="sob" class="emoji emoji-1f62d" role="img" title="sob">:sob:</span></p>



<a name="222443550"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222443550" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222443550">(Jan 12 2021 at 15:08)</a>:</h4>
<p>ayyy that worked <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span> only took 35 minutes to find out <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span> </p>
<div class="codehilite"><pre><span></span><code>thread &#39;main&#39; panicked at &#39;Error: File &quot;/home/joshua/rustc2/build/x86_64-unknown-linux-gnu/llvm/build/lib/libLLVMXRay.a /home/joshua/rustc2/build/x86_64-unknown-linux-gnu/llvm/build/lib/libLLVMWindowsManifest.a /home/joshua/rustc2/build/x86_64-unknown-linux-gnu/llvm/build/lib/libLLVMTestingSupport.a /home/joshua/rustc2/build/x86_64-unknown-li
</code></pre></div>



<a name="222448241"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222448241" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oliver <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222448241">(Jan 12 2021 at 15:38)</a>:</h4>
<p>what is libLLVMWindowsManifest.a?</p>



<a name="222451089"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222451089" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222451089">(Jan 12 2021 at 15:56)</a>:</h4>
<p>these are static libraries used by LLVM</p>



<a name="222451141"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222451141" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222451141">(Jan 12 2021 at 15:57)</a>:</h4>
<p>by default they're all shoved together into one giant <code>libLLVM.so</code> file, I changed it to use separate archive files to replicate the windows behavior</p>



<a name="222451204"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222451204" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222451204">(Jan 12 2021 at 15:57)</a>:</h4>
<p>the 'file not found error' is a pre-existing bug - it should be splitting on spaces, not lines. It didn't show up before because when linking dynamically there's only one .so file.</p>



<a name="222460615"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222460615" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222460615">(Jan 12 2021 at 16:54)</a>:</h4>
<p>is there a way to tell x.py dist 'run <code>RustDev</code> first'? Right now it takes like 5 minutes repackaging <code>rustc</code> and the docs every time</p>



<a name="222460863"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222460863" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222460863">(Jan 12 2021 at 16:56)</a>:</h4>
<p>I tried</p>
<div class="codehilite" data-code-language="Diff"><pre><span></span><code><span class="gh">diff --git a/src/bootstrap/builder.rs b/src/bootstrap/builder.rs</span>
<span class="gh">index ec9ce4c820c..a49512cd4e4 100644</span>
<span class="gd">--- a/src/bootstrap/builder.rs</span>
<span class="gi">+++ b/src/bootstrap/builder.rs</span>
<span class="gu">@@ -450,6 +450,7 @@ fn get_step_descriptions(kind: Kind) -&gt; Vec&lt;StepDescription&gt; {</span>
                 doc::EditionGuide,
             ),
             Kind::Dist =&gt; describe!(
<span class="gi">+                dist::RustDev,</span>
                 dist::Docs,
                 dist::RustcDocs,
                 dist::Mingw,
<span class="gu">@@ -467,7 +468,6 @@ fn get_step_descriptions(kind: Kind) -&gt; Vec&lt;StepDescription&gt; {</span>
                 dist::Clippy,
                 dist::Miri,
                 dist::LlvmTools,
<span class="gd">-                dist::RustDev,</span>
                 dist::Extended,
                 dist::BuildManifest,
                 dist::ReproducibleArtifacts,
</code></pre></div>
<p>but it didn't seem to do anythign</p>



<a name="222462039"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222462039" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222462039">(Jan 12 2021 at 17:03)</a>:</h4>
<p>oh I see it's there I just missed it</p>



<a name="222462230"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222462230" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222462230">(Jan 12 2021 at 17:04)</a>:</h4>
<p>well this is certainly encouraging</p>
<div class="codehilite"><pre><span></span><code>&gt; tar -tf build/dist/rust-dev-1.51.0-dev-x86_64-unknown-linux-gnu.tar.xz  | grep &#39;\.a$&#39; | head
rust-dev-1.51.0-dev-x86_64-unknown-linux-gnu/rust-dev/lib/libLLVMMCA.a
rust-dev-1.51.0-dev-x86_64-unknown-linux-gnu/rust-dev/lib/libLLVMDebugInfoPDB.a
rust-dev-1.51.0-dev-x86_64-unknown-linux-gnu/rust-dev/lib/libLLVMMC.a
rust-dev-1.51.0-dev-x86_64-unknown-linux-gnu/rust-dev/lib/libLLVMDebugInfoDWARF.a
rust-dev-1.51.0-dev-x86_64-unknown-linux-gnu/rust-dev/lib/libLLVMDebugInfoMSF.a
rust-dev-1.51.0-dev-x86_64-unknown-linux-gnu/rust-dev/lib/libLLVMSelectionDAG.a
rust-dev-1.51.0-dev-x86_64-unknown-linux-gnu/rust-dev/lib/libLLVMTextAPI.a
rust-dev-1.51.0-dev-x86_64-unknown-linux-gnu/rust-dev/lib/libLLVMObjectYAML.a
rust-dev-1.51.0-dev-x86_64-unknown-linux-gnu/rust-dev/lib/libLLVMDebugInfoGSYM.a
rust-dev-1.51.0-dev-x86_64-unknown-linux-gnu/rust-dev/lib/libLLVMLTO.a
</code></pre></div>



<a name="222462243"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222462243" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222462243">(Jan 12 2021 at 17:04)</a>:</h4>
<p>time for another try run :)</p>



<a name="222464406"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222464406" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222464406">(Jan 12 2021 at 17:17)</a>:</h4>
<p>hmm, bors seems to be confused?</p>
<p><a href="https://github.com/rust-lang/rust/pull/80932/#issuecomment-758804138">https://github.com/rust-lang/rust/pull/80932/#issuecomment-758804138</a></p>



<a name="222473320"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222473320" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222473320">(Jan 12 2021 at 18:22)</a>:</h4>
<p><span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span> <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span>  <a href="https://github.com/rust-lang/rust/pull/80932/#issuecomment-758845857">https://github.com/rust-lang/rust/pull/80932/#issuecomment-758845857</a></p>



<a name="222474009"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222474009" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222474009">(Jan 12 2021 at 18:27)</a>:</h4>
<p>does someone with a windows box have a second to try it out?</p>



<a name="222474046"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222474046" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222474046">(Jan 12 2021 at 18:27)</a>:</h4>
<p>it should be as simple as on linux :) just <code>[llvm] download-ci-llvm = true</code> in config.toml</p>



<a name="222476902"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222476902" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222476902">(Jan 12 2021 at 18:49)</a>:</h4>
<p>if you have a Mac I would also be interested to know if it works on MacOS</p>



<a name="222495612"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222495612" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222495612">(Jan 12 2021 at 21:15)</a>:</h4>
<p>I have a windows VM with a checkout (which takes _ages_!) but currently busy T_T</p>



<a name="222495676"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222495676" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222495676">(Jan 12 2021 at 21:16)</a>:</h4>
<p>if nobody takes a step forward I'll get to it in ~hour</p>



<a name="222505380"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222505380" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222505380">(Jan 12 2021 at 22:31)</a>:</h4>
<blockquote>
<p>Submodules updated in -7194.49 seconds</p>
</blockquote>
<p>heh.</p>



<a name="222505486"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222505486" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222505486">(Jan 12 2021 at 22:32)</a>:</h4>
<p><span class="user-mention" data-user-id="232545">@Joshua Nelson</span> it fails ooking for <code>build/i686-pc-windows-msvc/ci-llvm/lib/*.lib</code>. A bunch of <code>.lib</code>s are missing. Fails when invoking <code>llvm-config</code>.</p>



<a name="222505529"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222505529" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222505529">(Jan 12 2021 at 22:33)</a>:</h4>
<p><span class="user-mention" data-user-id="123586">@nagisa</span> can you send the full error? I would be surprised if anything is missing, I uploaded a whole bunch of files</p>



<a name="222505555"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222505555" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222505555">(Jan 12 2021 at 22:33)</a>:</h4>
<p>uh, I don't have a mouse on this and I have no idea how to copy terminal buffer without one...</p>



<a name="222505566"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222505566" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222505566">(Jan 12 2021 at 22:33)</a>:</h4>
<p>oh hmm</p>



<a name="222505570"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222505570" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222505570">(Jan 12 2021 at 22:33)</a>:</h4>
<p>let me attach a wacom to it</p>



<a name="222505590"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222505590" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222505590">(Jan 12 2021 at 22:33)</a>:</h4>
<p>did you check out my PR first? (have to ask the silly questions, sorry)</p>



<a name="222505697"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222505697" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222505697">(Jan 12 2021 at 22:34)</a>:</h4>
<p><a href="https://paste.rs/TXZ">https://paste.rs/TXZ</a></p>



<a name="222505704"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222505704" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222505704">(Jan 12 2021 at 22:34)</a>:</h4>
<p>hmm I guess another possibility is that bootstrap.py didn't invalidate its LLVM cache?</p>



<a name="222505751"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222505751" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222505751">(Jan 12 2021 at 22:35)</a>:</h4>
<p>what's in <code>C:\Users\nagisa\Desktop\rust\build\i686-pc-windows-msvc\ci-llvm\lib\</code> ? That looks like <em>everything</em> is missing</p>



<a name="222505759"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222505759" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222505759">(Jan 12 2021 at 22:35)</a>:</h4>
<p>I can see that ahppening, let me nuke entire build</p>



<a name="222505772"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222505772" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222505772">(Jan 12 2021 at 22:35)</a>:</h4>
<p>no no you shouldn't need to</p>



<a name="222505780"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222505780" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222505780">(Jan 12 2021 at 22:35)</a>:</h4>
<p>that's a bootstrap bug I'd need to fix</p>



<a name="222505793"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222505793" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222505793">(Jan 12 2021 at 22:35)</a>:</h4>
<p>otherwise <em>everyone</em> will run into it</p>



<a name="222505856"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222505856" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222505856">(Jan 12 2021 at 22:36)</a>:</h4>
<p>ok I see the issue, the caching is by LLVM SHA and doesn't account for the version of bootstrap</p>



<a name="222505869"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222505869" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222505869">(Jan 12 2021 at 22:36)</a>:</h4>
<p>hmm, I'm not sure how to do this in a general way</p>



<a name="222505873"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222505873" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222505873">(Jan 12 2021 at 22:36)</a>:</h4>
<p>sure, uh, I already did it, but I guess easily reproducible by running bootstrap on origin/master and then back on your branch</p>



<a name="222505925"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222505925" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222505925">(Jan 12 2021 at 22:37)</a>:</h4>
<p>I don't think everybody will start running into this</p>



<a name="222505938"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222505938" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222505938">(Jan 12 2021 at 22:37)</a>:</h4>
<p>because people are unlikely to have ever had set the option on windows in the first place.</p>



<a name="222505952"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222505952" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222505952">(Jan 12 2021 at 22:37)</a>:</h4>
<p>well, everybody until LLVM gets bumped</p>



<a name="222505955"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222505955" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222505955">(Jan 12 2021 at 22:37)</a>:</h4>
<p>so there was never a download or extraction of the llvm tar.xz</p>



<a name="222505967"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222505967" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222505967">(Jan 12 2021 at 22:37)</a>:</h4>
<p>the caching is against the <em>git</em> history, it doesn't care what's in ci-llvm/</p>



<a name="222506029"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222506029" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222506029">(Jan 12 2021 at 22:38)</a>:</h4>
<p>ok I'm going to hard code it for now, one sec</p>



<a name="222506121"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222506121" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222506121">(Jan 12 2021 at 22:39)</a>:</h4>
<p>still failed even after the nuke, gimme a sec to get you the contents of the dir</p>



<a name="222506123"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222506123" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222506123">(Jan 12 2021 at 22:39)</a>:</h4>
<p>try this:</p>
<div class="codehilite" data-code-language="Diff"><pre><span></span><code><span class="gh">diff --git a/src/bootstrap/bootstrap.py b/src/bootstrap/bootstrap.py</span>
<span class="gh">index f60ae02bffe..e0d1768664e 100644</span>
<span class="gd">--- a/src/bootstrap/bootstrap.py</span>
<span class="gi">+++ b/src/bootstrap/bootstrap.py</span>
<span class="gu">@@ -443,13 +443,7 @@ class RustBuild(object):</span>
             top_level = subprocess.check_output([
                 "git", "rev-parse", "--show-toplevel",
             ]).decode(sys.getdefaultencoding()).strip()
<span class="gd">-            llvm_sha = subprocess.check_output([</span>
<span class="gd">-                "git", "log", "--author=bors", "--format=%H", "-n1",</span>
<span class="gd">-                "-m", "--first-parent",</span>
<span class="gd">-                "--",</span>
<span class="gd">-                "{}/src/llvm-project".format(top_level),</span>
<span class="gd">-                "{}/src/bootstrap/download-ci-llvm-stamp".format(top_level),</span>
<span class="gd">-            ]).decode(sys.getdefaultencoding()).strip()</span>
<span class="gi">+            llvm_sha = "3732cb605c03d534702b237eb667d313f6fd015c"</span>
             llvm_assertions = self.get_toml('assertions', 'llvm') == 'true'
             if self.program_out_of_date(self.llvm_stamp(), llvm_sha + str(llvm_assertions)):
                 self._download_ci_llvm(llvm_sha, llvm_assertions)
</code></pre></div>



<a name="222506148"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222506148" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222506148">(Jan 12 2021 at 22:39)</a>:</h4>
<p>(if that's hard to copy paste you can get the SHA from <a href="https://github.com/rust-lang/rust/pull/80932/commits">https://github.com/rust-lang/rust/pull/80932/commits</a>)</p>



<a name="222506162"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222506162" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222506162">(Jan 12 2021 at 22:39)</a>:</h4>
<p>it only has bin/ and include/</p>



<a name="222506187"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222506187" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222506187">(Jan 12 2021 at 22:39)</a>:</h4>
<p><span class="user-mention silent" data-user-id="123586">nagisa</span> <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/Downloading.20static.20LLVM.20on.20windows/near/222506162">said</a>:</p>
<blockquote>
<p>it only has bin/ and include/</p>
</blockquote>
<p>yup, that's definitely a caching issue then</p>



<a name="222506277"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222506277" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222506277">(Jan 12 2021 at 22:40)</a>:</h4>
<p>oh waaaait</p>



<a name="222506281"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222506281" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222506281">(Jan 12 2021 at 22:40)</a>:</h4>
<p>you know wha</p>



<a name="222506311"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222506311" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222506311">(Jan 12 2021 at 22:40)</a>:</h4>
<p>I might have done the same thing previously and hardcoded llvm_sha to something else</p>



<a name="222506321"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222506321" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222506321">(Jan 12 2021 at 22:40)</a>:</h4>
<p>ah but no, its old code there, let me try the hash thing</p>



<a name="222506594"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222506594" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222506594">(Jan 12 2021 at 22:43)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/Downloading.20static.20LLVM.20on.20windows/near/222505869">said</a>:</p>
<blockquote>
<p>hmm, I'm not sure how to do this in a general way</p>
</blockquote>
<p>the hack of course is to do the git version of <code>llvm_sha = newest(3732cb605c03d534702b237eb667d313f6fd015c, llvm_sha)</code> but I don't think <span class="user-mention silent" data-user-id="116122">simulacrum</span> would like that <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="222506623"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222506623" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222506623">(Jan 12 2021 at 22:43)</a>:</h4>
<p>hm?</p>



<a name="222506633"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222506633" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222506633">(Jan 12 2021 at 22:43)</a>:</h4>
<p>there should be a stamp file you can touch</p>



<a name="222506634"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222506634" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222506634">(Jan 12 2021 at 22:43)</a>:</h4>
<p>is the hash right? its saying 404.</p>



<a name="222506670"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222506670" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222506670">(Jan 12 2021 at 22:44)</a>:</h4>
<p><span class="user-mention" data-user-id="116122">@simulacrum</span> <code>llvm_sha</code> is calculated <em>only</em> based on the LLVM version</p>



<a name="222506696"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222506696" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222506696">(Jan 12 2021 at 22:44)</a>:</h4>
<p>the stamp file won't help, it will still download the wrong version</p>



<a name="222506735"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222506735" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222506735">(Jan 12 2021 at 22:44)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/Downloading.20static.20LLVM.20on.20windows/near/222506670">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="116122">simulacrum</span> <code>llvm_sha</code> is calculated <em>only</em> based on the LLVM version</p>
</blockquote>
<p>I want it to include my changes to bootstrap, which only changed the tarball, not <code>src/llvm-project</code></p>



<a name="222506742"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222506742" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222506742">(Jan 12 2021 at 22:44)</a>:</h4>
<p>I don't know what you mean by llvm version I guess</p>



<a name="222506759"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222506759" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222506759">(Jan 12 2021 at 22:44)</a>:</h4>
<blockquote>
<ul>
<li>"{}/src/bootstrap/download-ci-llvm-stamp".format(top_level),</li>
</ul>
</blockquote>



<a name="222506770"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222506770" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222506770">(Jan 12 2021 at 22:44)</a>:</h4>
<p>this is the stamp</p>



<a name="222506780"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222506780" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222506780">(Jan 12 2021 at 22:45)</a>:</h4>
<p>fwiw, llvm will soon update to 11.0.1, so this may be a transient issue, right?</p>



<a name="222506812"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222506812" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222506812">(Jan 12 2021 at 22:45)</a>:</h4>
<p><span class="user-mention silent" data-user-id="138448">cuviper</span> <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/Downloading.20static.20LLVM.20on.20windows/near/222506780">said</a>:</p>
<blockquote>
<p>fwiw, llvm will soon update to 11.0.1, so this may be a transient issue, right?</p>
</blockquote>
<p>yeah I suppose so</p>



<a name="222506824"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222506824" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222506824">(Jan 12 2021 at 22:45)</a>:</h4>
<p>any LLVM update would fix the issue as long as the PR gets merged first</p>



<a name="222506826"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222506826" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222506826">(Jan 12 2021 at 22:45)</a>:</h4>
<p>this should not be a problem</p>



<a name="222506853"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222506853" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222506853">(Jan 12 2021 at 22:45)</a>:</h4>
<p>/me tries x86_64-pc-windows-msvc to see if that will have the llvm's tar.xz</p>



<a name="222506864"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222506864" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222506864">(Jan 12 2021 at 22:46)</a>:</h4>
<p>do you mean that the directory is not purged and replaced on a bump of the stamp file?</p>



<a name="222506922"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222506922" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222506922">(Jan 12 2021 at 22:46)</a>:</h4>
<p>if so, then we should include the stamp file's contents in the cache name</p>



<a name="222506929"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222506929" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222506929">(Jan 12 2021 at 22:46)</a>:</h4>
<p>(or whatever)</p>



<a name="222506932"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222506932" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222506932">(Jan 12 2021 at 22:46)</a>:</h4>
<p>no, I mean that's it's purged and replaced with the wrong tarball</p>



<a name="222506956"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222506956" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222506956">(Jan 12 2021 at 22:46)</a>:</h4>
<p>I continue to be a bit baffled, I admit</p>



<a name="222506996"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222506996" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222506996">(Jan 12 2021 at 22:46)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/commit/3732cb605c03d534702b237eb667d313f6fd015c">3732cb605c03d534702b237eb667d313f6fd015c</a> will not have associated tarball</p>



<a name="222507001"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222507001" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222507001">(Jan 12 2021 at 22:46)</a>:</h4>
<p>so the tarball that gets downloaded is based on when LLVM last changed.</p>



<a name="222507033"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222507033" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222507033">(Jan 12 2021 at 22:47)</a>:</h4>
<p>folks testing need to check out the try commit, and the pr should likely bump the stamp file (which would then make that try commit the one bootstrap uses to download from)</p>



<a name="222507058"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222507058" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222507058">(Jan 12 2021 at 22:47)</a>:</h4>
<p><span class="user-mention silent" data-user-id="123586">nagisa</span> <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/Downloading.20static.20LLVM.20on.20windows/near/222506634">said</a>:</p>
<blockquote>
<p>is the hash right? its saying 404.</p>
</blockquote>
<p>oh, it's probably the hash of the <code>bors try</code>, not the commit I made - try using <code>f092cb6bc7133a66e68327189cb1cb39af7cc38e</code> instead</p>



<a name="222507203"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222507203" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222507203">(Jan 12 2021 at 22:49)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116122">simulacrum</span> <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/Downloading.20static.20LLVM.20on.20windows/near/222507033">said</a>:</p>
<blockquote>
<p>folks testing need to check out the try commit, and the pr should likely bump the stamp file (which would then make that try commit the one bootstrap uses to download from)</p>
</blockquote>
<p>this is not related to the stamp file. The bug happens <em>before</em> <code>self.program_out_of_date</code>. <code>git log src/llvm-project</code> shows <a href="https://github.com/rust-lang/rust/commit/26daa656624deb54a8f3c754893635ebe46eed10">26daa656624deb54a8f3c754893635ebe46eed10</a> as the most recent commit way back in december. <em>regardless</em> of whether the stamp file is outdated or not, bootstrap will download the december tarball and put it in <code>ci-llvm</code>.</p>



<a name="222507242"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222507242" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222507242">(Jan 12 2021 at 22:49)</a>:</h4>
<p>but that tarball has a different contents than the tarball from my PR - it's missing all the static libraries</p>



<a name="222507310"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222507310" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222507310">(Jan 12 2021 at 22:50)</a>:</h4>
<p>right so what I did was...</p>



<a name="222507459"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222507459" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222507459">(Jan 12 2021 at 22:51)</a>:</h4>
<div class="codehilite"><pre><span></span><code>git fetch origin f092cb6bc7133a66e68327189cb1cb39af7cc38e
git checkout FETCH_HEAD -f
rmdir ./build
python x.py build
</code></pre></div>
<p>the error was <a href="https://paste.rs/oWL">https://paste.rs/oWL</a>. Note that it still downloaded an old llvm tarball. Hardcoding the hash in bootstrap.py now.</p>



<a name="222507605"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222507605" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222507605">(Jan 12 2021 at 22:52)</a>:</h4>
<p>right, this is what I mean - the SHA bootstrap uses for LLVM is independent of the current commit you're on, it only cares about the commit <code>src/llvm-project</code> is on</p>



<a name="222507883"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222507883" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222507883">(Jan 12 2021 at 22:55)</a>:</h4>
<p><em>or when the stamp file was bumped</em></p>



<a name="222507903"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222507903" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222507903">(Jan 12 2021 at 22:55)</a>:</h4>
<p>no ugh</p>



<a name="222507905"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222507905" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222507905">(Jan 12 2021 at 22:55)</a>:</h4>
<p>there should be no worry here, if you had bumped the stamp file, then checking out the try commit would just work</p>



<a name="222507923"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222507923" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222507923">(Jan 12 2021 at 22:56)</a>:</h4>
<p>look, this is the code:</p>
<div class="codehilite" data-code-language="Python"><pre><span></span><code>            <span class="n">llvm_sha</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span>
                <span class="s2">"git"</span><span class="p">,</span> <span class="s2">"log"</span><span class="p">,</span> <span class="s2">"--author=bors"</span><span class="p">,</span> <span class="s2">"--format=%H"</span><span class="p">,</span> <span class="s2">"-n1"</span><span class="p">,</span>
                <span class="s2">"-m"</span><span class="p">,</span> <span class="s2">"--first-parent"</span><span class="p">,</span>
                <span class="s2">"--"</span><span class="p">,</span>
                <span class="s2">"</span><span class="si">{}</span><span class="s2">/src/llvm-project"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">top_level</span><span class="p">),</span>
                <span class="s2">"</span><span class="si">{}</span><span class="s2">/src/bootstrap/download-ci-llvm-stamp"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">top_level</span><span class="p">),</span>
            <span class="p">])</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">getdefaultencoding</span><span class="p">())</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">llvm_assertions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_toml</span><span class="p">(</span><span class="s1">'assertions'</span><span class="p">,</span> <span class="s1">'llvm'</span><span class="p">)</span> <span class="o">==</span> <span class="s1">'true'</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">program_out_of_date</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">llvm_stamp</span><span class="p">(),</span> <span class="n">llvm_sha</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">llvm_assertions</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_download_ci_llvm</span><span class="p">(</span><span class="n">llvm_sha</span><span class="p">,</span> <span class="n">llvm_assertions</span><span class="p">)</span>
</code></pre></div>



<a name="222507964"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222507964" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222507964">(Jan 12 2021 at 22:56)</a>:</h4>
<p>but you need to check out the try comit</p>



<a name="222507986"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222507986" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222507986">(Jan 12 2021 at 22:56)</a>:</h4>
<p>if the stamp file gets bumped, <code>_download_ci_llvm</code> <em>will</em> get called</p>



<a name="222507991"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222507991" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222507991">(Jan 12 2021 at 22:56)</a>:</h4>
<p>that lists src/llvm-project and the download-ci-llvm-stamp?</p>



<a name="222508002"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222508002" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222508002">(Jan 12 2021 at 22:56)</a>:</h4>
<p>but it will get called with the wrong llvm_sha</p>



<a name="222508013"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222508013" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222508013">(Jan 12 2021 at 22:56)</a>:</h4>
<p>why?</p>



<a name="222508015"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222508015" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222508015">(Jan 12 2021 at 22:56)</a>:</h4>
<p>I can bump the stamp locally and try it ^^</p>



<a name="222508054"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222508054" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222508054">(Jan 12 2021 at 22:56)</a>:</h4>
<p>you have to bump it and then have a bors-authored merge commit after it which has artifacts</p>



<a name="222508078"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222508078" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222508078">(Jan 12 2021 at 22:57)</a>:</h4>
<p>like, there's not a way to do this without a try build</p>



<a name="222508079"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222508079" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222508079">(Jan 12 2021 at 22:57)</a>:</h4>
<p>git commit --amend?</p>



<a name="222508082"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222508082" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222508082">(Jan 12 2021 at 22:57)</a>:</h4>
<p>oh I'm dumb I'm sorry - there are <em>two</em> different stamp files</p>



<a name="222508088"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222508088" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222508088">(Jan 12 2021 at 22:57)</a>:</h4>
<p>no, that would change the sha</p>



<a name="222508089"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222508089" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222508089">(Jan 12 2021 at 22:57)</a>:</h4>
<p>oh but that changes hash</p>



<a name="222508090"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222508090" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222508090">(Jan 12 2021 at 22:57)</a>:</h4>
<p>yeah</p>



<a name="222508101"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222508101" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222508101">(Jan 12 2021 at 22:57)</a>:</h4>
<p>you were talking about <code>download-ci-llvm-stamp</code>, I was talking about <code>llvm_stamp()</code></p>



<a name="222508111"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222508111" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222508111">(Jan 12 2021 at 22:57)</a>:</h4>
<p>ah</p>



<a name="222508113"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222508113" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222508113">(Jan 12 2021 at 22:57)</a>:</h4>
<p>yes</p>



<a name="222508139"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222508139" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222508139">(Jan 12 2021 at 22:57)</a>:</h4>
<p>side note</p>



<a name="222508155"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222508155" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222508155">(Jan 12 2021 at 22:58)</a>:</h4>
<p>ok, I'll bump that as part of the PR. <span class="user-mention" data-user-id="123586">@nagisa</span> will still have to hard-code the hash until I get another try run to finish</p>



<a name="222508194"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222508194" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222508194">(Jan 12 2021 at 22:58)</a>:</h4>
<p>does anyone know if you can prevent tidy from running/building for x.py test?</p>



<a name="222508206"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222508206" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222508206">(Jan 12 2021 at 22:58)</a>:</h4>
<p><span class="user-mention silent" data-user-id="123586">nagisa</span> <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/Downloading.20static.20LLVM.20on.20windows/near/222508194">said</a>:</p>
<blockquote>
<p>does anyone know if you can prevent tidy from running/building for x.py test?</p>
</blockquote>
<p><code>x.py test src/test/ui</code></p>



<a name="222508209"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222508209" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222508209">(Jan 12 2021 at 22:58)</a>:</h4>
<p>or any other subset of tests</p>



<a name="222508216"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222508216" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222508216">(Jan 12 2021 at 22:58)</a>:</h4>
<p>cool.</p>



<a name="222508287"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222508287" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222508287">(Jan 12 2021 at 22:59)</a>:</h4>
<p>or --exclude src/tools/tidy</p>



<a name="222508316"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222508316" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222508316">(Jan 12 2021 at 22:59)</a>:</h4>
<p>oh that's better <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="222508449"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222508449" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222508449">(Jan 12 2021 at 23:00)</a>:</h4>
<p>s0 it went past the original error, still waiting for it to build the backend to make absolutely sure things work</p>



<a name="222508505"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222508505" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222508505">(Jan 12 2021 at 23:01)</a>:</h4>
<p>yay <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span> <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span></p>



<a name="222508613"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222508613" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222508613">(Jan 12 2021 at 23:02)</a>:</h4>
<p>yeah the next place I would expect to break is <code>compiler/rustc_llvm</code></p>



<a name="222508628"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222508628" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222508628">(Jan 12 2021 at 23:02)</a>:</h4>
<p>if that works we might actually be ready to go :)</p>



<a name="222508672"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222508672" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222508672">(Jan 12 2021 at 23:02)</a>:</h4>
<p>building ... rustc_llvm (build) :suspense:</p>



<a name="222508723"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222508723" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222508723">(Jan 12 2021 at 23:03)</a>:</h4>
<p>looks like it went through.</p>



<a name="222508825"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222508825" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222508825">(Jan 12 2021 at 23:04)</a>:</h4>
<p>I'm not celebrating till we get std built :)</p>



<a name="222508892"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222508892" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222508892">(Jan 12 2021 at 23:05)</a>:</h4>
<p>I'm already wondering if it will work on MacOS <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="222508905"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222508905" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222508905">(Jan 12 2021 at 23:05)</a>:</h4>
<p>I would expect it to, none of my changes were specific to windows</p>



<a name="222508987"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222508987" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222508987">(Jan 12 2021 at 23:06)</a>:</h4>
<p>hey <span class="user-mention" data-user-id="307289">@Poliorcetics</span> ;)</p>



<a name="222510087"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222510087" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222510087">(Jan 12 2021 at 23:18)</a>:</h4>
<p><span class="user-mention" data-user-id="123586">@nagisa</span> did you get stage1 std built?</p>



<a name="222510111"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222510111" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222510111">(Jan 12 2021 at 23:18)</a>:</h4>
<p>(if that works I would expect tests to pass)</p>



<a name="222510138"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222510138" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222510138">(Jan 12 2021 at 23:19)</a>:</h4>
<p>still waiting. I only have 6 cores on that VM and rustc_middle is making things difficult ^^</p>



<a name="222510495"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222510495" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222510495">(Jan 12 2021 at 23:22)</a>:</h4>
<p>well, if you want a problem to ponder, it baffles me why I needed to take out <code>LLVM_INCLUDE_TESTS=OFF</code> from the cmake config: <a href="https://github.com/rust-lang/rust/pull/80932/files#diff-ca6526d91d41c31fad645c46417e0f1ce61e324542994e8c8b72b1f7a08c91bdL174">https://github.com/rust-lang/rust/pull/80932/files#diff-ca6526d91d41c31fad645c46417e0f1ce61e324542994e8c8b72b1f7a08c91bdL174</a></p>



<a name="222510509"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222510509" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> J. Ryan Stinnett <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222510509">(Jan 12 2021 at 23:23)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/Downloading.20static.20LLVM.20on.20windows/near/222508892">said</a>:</p>
<blockquote>
<p>I'm already wondering if it will work on MacOS <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>
</blockquote>
<p>I am happy to test on macOS (and Windows as well) if it would help <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="222510634"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222510634" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222510634">(Jan 12 2021 at 23:24)</a>:</h4>
<p><span class="user-mention silent" data-user-id="220326">J. Ryan Stinnett</span> <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/Downloading.20static.20LLVM.20on.20windows/near/222510509">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/Downloading.20static.20LLVM.20on.20windows/near/222508892">said</a>:</p>
<blockquote>
<p>I'm already wondering if it will work on MacOS <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>
</blockquote>
<p>I am happy to test on macOS (and Windows as well) if it would help <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>
</blockquote>
<p>that would be great! you can test with <code>git fetch origin pull/80932/head &amp;&amp; git checkout FETCH_HEAD</code>, then edit bootstrap.py like in <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/Downloading.20static.20LLVM.20on.20windows/near/222506123">https://rust-lang.zulipchat.com/#narrow/stream/182449-t-compiler.2Fhelp/topic/Downloading.20static.20LLVM.20on.20windows/near/222506123</a>, but with the hash <code>f092cb6bc7133a66e68327189cb1cb39af7cc38e</code>. Then add <code>[llvm] download-ci-llvm = true</code> to config.toml and see if x.py build works.</p>



<a name="222510727"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222510727" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222510727">(Jan 12 2021 at 23:25)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/Downloading.20static.20LLVM.20on.20windows/near/222510495">said</a>:</p>
<blockquote>
<p>well, if you want a problem to ponder, it baffles me why I needed to take out <code>LLVM_INCLUDE_TESTS=OFF</code> from the cmake config: <a href="https://github.com/rust-lang/rust/pull/80932/files#diff-ca6526d91d41c31fad645c46417e0f1ce61e324542994e8c8b72b1f7a08c91bdL174">https://github.com/rust-lang/rust/pull/80932/files#diff-ca6526d91d41c31fad645c46417e0f1ce61e324542994e8c8b72b1f7a08c91bdL174</a></p>
</blockquote>
<p>here's the error without:</p>
<div class="codehilite"><pre><span></span><code>llvm-config: error: component libraries and shared library

llvm-config: error: missing: /home/joshua/rustc2/build/x86_64-unknown-linux-gnu/llvm/build/lib/libgtest.a
llvm-config: error: missing: /home/joshua/rustc2/build/x86_64-unknown-linux-gnu/llvm/build/lib/libgtest_main.a
llvm-config: error: missing: /home/joshua/rustc2/build/x86_64-unknown-linux-gnu/llvm/build/lib/libLLVMTestingSupport.a
thread &#39;main&#39; panicked at &#39;command did not execute successfully: &quot;/home/joshua/rustc2/build/x86_64-unknown-linux-gnu/llvm/build/bin/llvm-config&quot; &quot;--libfiles&quot;
</code></pre></div>



<a name="222510730"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222510730" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222510730">(Jan 12 2021 at 23:26)</a>:</h4>
<p>a bunch of link errors when linking librustc_driver, in the form of llvm stuff depending on __imp___std_init_once_complete and not finding it</p>



<a name="222510774"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222510774" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222510774">(Jan 12 2021 at 23:26)</a>:</h4>
<p>but that's the only symbol that's missing.</p>



<a name="222510789"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222510789" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222510789">(Jan 12 2021 at 23:26)</a>:</h4>
<p>do you know what <code>__imp___std_init_once_complete</code> is?</p>



<a name="222510855"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222510855" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222510855">(Jan 12 2021 at 23:27)</a>:</h4>
<p>seems weird it would only break when downloading and re-uploading, it worked fine for me locally</p>



<a name="222510871"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222510871" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222510871">(Jan 12 2021 at 23:27)</a>:</h4>
<p>no idea what it is, sadly.</p>



<a name="222510885"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222510885" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222510885">(Jan 12 2021 at 23:27)</a>:</h4>
<p>and I don't know about intiricacies of linking on windows to investigate T_T</p>



<a name="222510966"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222510966" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222510966">(Jan 12 2021 at 23:28)</a>:</h4>
<p>hmm, I think this is the first time <code>rg</code> has failed me</p>



<a name="222510967"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222510967" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222510967">(Jan 12 2021 at 23:28)</a>:</h4>
<p>I do know for sure I could build llvm this weekend and have it work tho</p>



<a name="222510985"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222510985" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222510985">(Jan 12 2021 at 23:28)</a>:</h4>
<p>oh, I mean it is internal implementation function of msvc's standard library</p>



<a name="222510986"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222510986" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222510986">(Jan 12 2021 at 23:28)</a>:</h4>
<p><span class="user-mention silent" data-user-id="123586">nagisa</span> <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/Downloading.20static.20LLVM.20on.20windows/near/222510967">said</a>:</p>
<blockquote>
<p>I do know for sure I could build llvm this weekend and have it work tho</p>
</blockquote>
<p>what do you mean? like build from source?</p>



<a name="222510992"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222510992" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222510992">(Jan 12 2021 at 23:28)</a>:</h4>
<p>not in rust.</p>



<a name="222511009"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222511009" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222511009">(Jan 12 2021 at 23:29)</a>:</h4>
<p>ahhh ok</p>



<a name="222511016"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222511016" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222511016">(Jan 12 2021 at 23:29)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/Downloading.20static.20LLVM.20on.20windows/near/222510986">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="123586">nagisa</span> <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/Downloading.20static.20LLVM.20on.20windows/near/222510967">said</a>:</p>
<blockquote>
<p>I do know for sure I could build llvm this weekend and have it work tho</p>
</blockquote>
<p>what do you mean? like build from source?</p>
</blockquote>
<p>yaeh, I built LLVM from source this weekend.</p>



<a name="222511059"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222511059" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222511059">(Jan 12 2021 at 23:29)</a>:</h4>
<p>So what I suspect could be happening is llvm-config not printing all the link arguments for some reason.</p>



<a name="222511104"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222511104" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222511104">(Jan 12 2021 at 23:30)</a>:</h4>
<p>ok, so this probably is actually the test thing going wrong, that's the only thing I changed in LLVM directly</p>



<a name="222511132"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222511132" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222511132">(Jan 12 2021 at 23:30)</a>:</h4>
<p>if you have another hour you could try commenting that out and see if it works <span aria-label="joy" class="emoji emoji-1f602" role="img" title="joy">:joy:</span></p>



<a name="222511178"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222511178" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222511178">(Jan 12 2021 at 23:30)</a>:</h4>
<p>sadly I'm hitting bed in hour and I wont be able to wait for rustc build after that</p>



<a name="222511194"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222511194" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222511194">(Jan 12 2021 at 23:31)</a>:</h4>
<p>tomorrow maybe, even better if there's a try build to try ^^</p>



<a name="222511206"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222511206" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> J. Ryan Stinnett <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222511206">(Jan 12 2021 at 23:31)</a>:</h4>
<p>Ah, I guess I am hitting the python 2 vs. 3 fun on macOS?</p>
<div class="codehilite"><pre><span></span><code>error: XZ support is required to download LLVM
help: consider disabling `download-ci-llvm` or using python3
</code></pre></div>



<a name="222511220"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222511220" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222511220">(Jan 12 2021 at 23:31)</a>:</h4>
<p><span class="user-mention" data-user-id="220326">@J. Ryan Stinnett</span> yeah, use <code>python3</code> instead</p>



<a name="222511295"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222511295" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> J. Ryan Stinnett <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222511295">(Jan 12 2021 at 23:32)</a>:</h4>
<div class="codehilite"><pre><span></span><code>downloading https://ci-artifacts.rust-lang.org/rustc-builds/f092cb6bc7133a66e68327189cb1cb39af7cc38e/rust-dev-nightly-x86_64-apple-darwin.tar.xz
#=#=-#   #
curl: (22) The requested URL returned error: 404
</code></pre></div>



<a name="222511307"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222511307" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222511307">(Jan 12 2021 at 23:32)</a>:</h4>
<p><span class="user-mention silent" data-user-id="220326">J. Ryan Stinnett</span> <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/Downloading.20static.20LLVM.20on.20windows/near/222511295">said</a>:</p>
<blockquote>
<p><div class="codehilite"><pre><span></span><code>downloading https://ci-artifacts.rust-lang.org/rustc-builds/f092cb6bc7133a66e68327189cb1cb39af7cc38e/rust-dev-nightly-x86_64-apple-darwin.tar.xz
#=#=-#   #
curl: (22) The requested URL returned error: 404
</code></pre></div><br>
</p>
</blockquote>
<p>oh right, the try build was only for windows</p>



<a name="222511309"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222511309" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222511309">(Jan 12 2021 at 23:32)</a>:</h4>
<p>booo</p>



<a name="222511367"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222511367" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222511367">(Jan 12 2021 at 23:33)</a>:</h4>
<p><span class="user-mention silent" data-user-id="123586">nagisa</span> <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/Downloading.20static.20LLVM.20on.20windows/near/222511194">said</a>:</p>
<blockquote>
<p>tomorrow maybe, even better if there's a try build to try ^^</p>
</blockquote>
<p>well the issue is that if I disable the tests again then llvm-config dies :(</p>



<a name="222511379"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222511379" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222511379">(Jan 12 2021 at 23:33)</a>:</h4>
<p>for reasons unknown</p>



<a name="222511810"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222511810" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222511810">(Jan 12 2021 at 23:38)</a>:</h4>
<p>so I guess the thing to do in the meantime is see if this works on mac, let me start a try run</p>



<a name="222511843"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222511843" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222511843">(Jan 12 2021 at 23:38)</a>:</h4>
<p>If you want to write down instructions somewhere in the issue I'm happy to spend some time tomorrow pointing my eyeballs to them</p>



<a name="222511861"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222511861" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Halkcyon <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222511861">(Jan 12 2021 at 23:39)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/Downloading.20static.20LLVM.20on.20windows/near/222510634">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="220326">J. Ryan Stinnett</span> <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/Downloading.20static.20LLVM.20on.20windows/near/222510509">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/Downloading.20static.20LLVM.20on.20windows/near/222508892">said</a>:</p>
<blockquote>
<p>I'm already wondering if it will work on MacOS <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>
</blockquote>
<p>I am happy to test on macOS (and Windows as well) if it would help <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>
</blockquote>
<p>that would be great! you can test with <code>git fetch origin pull/80932/head &amp;&amp; git checkout FETCH_HEAD</code>, then edit bootstrap.py like in <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/Downloading.20static.20LLVM.20on.20windows/near/222506123">https://rust-lang.zulipchat.com/#narrow/stream/182449-t-compiler.2Fhelp/topic/Downloading.20static.20LLVM.20on.20windows/near/222506123</a>, but with the hash <code>f092cb6bc7133a66e68327189cb1cb39af7cc38e</code>. Then add <code>[llvm] download-ci-llvm = true</code> to config.toml and see if x.py build works.</p>
</blockquote>
<p>I've initiated these steps on a Windows machine.  I'll report back when complete.</p>



<a name="222511870"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222511870" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222511870">(Jan 12 2021 at 23:39)</a>:</h4>
<p>well I'm unsure how to move forward <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span> the windows link error is super weird</p>



<a name="222511884"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222511884" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222511884">(Jan 12 2021 at 23:39)</a>:</h4>
<p>tbh I really want this to work because waiting for LLVM rebuild was _painful_.</p>



<a name="222512007"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222512007" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Halkcyon <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222512007">(Jan 12 2021 at 23:40)</a>:</h4>
<p>I should probably mark this directory as safe...<br>
<a href="/user_uploads/4715/zmwNYMg36SZUEWE4BkKSkHqX/image.png">!image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/zmwNYMg36SZUEWE4BkKSkHqX/image.png" title="!image.png"><img src="/user_uploads/4715/zmwNYMg36SZUEWE4BkKSkHqX/image.png"></a></div>



<a name="222512056"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222512056" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222512056">(Jan 12 2021 at 23:41)</a>:</h4>
<p>oh yeah Antimalware Service Executable is the worst.</p>



<a name="222512123"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222512123" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222512123">(Jan 12 2021 at 23:42)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/Downloading.20static.20LLVM.20on.20windows/near/222511810">said</a>:</p>
<blockquote>
<p>so I guess the thing to do in the meantime is see if this works on mac, let me start a try run</p>
</blockquote>
<p>done, will be another 45 minutes unfortunately</p>



<a name="222512127"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222512127" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Poliorcetics <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222512127">(Jan 12 2021 at 23:42)</a>:</h4>
<p>I cannot test right now on macOS but after sleep I’ll be able too, what should I do ?</p>



<a name="222512186"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222512186" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222512186">(Jan 12 2021 at 23:43)</a>:</h4>
<p>hard-coding hashes shouldn't be necessary now that I updated the stamp file, so:</p>
<ul>
<li><code>git fetch origin pull/80932/head &amp;&amp; git checkout FETCH_HEAD</code></li>
<li>add <code>[llvm] download-ci-llvm = true</code> to config.toml</li>
<li>see if <code>x.py build</code> works</li>
</ul>



<a name="222512238"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222512238" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222512238">(Jan 12 2021 at 23:44)</a>:</h4>
<p>err actually I think the hash will still be wrong because I modified it in a separate commit and that one didn't have a try run?</p>



<a name="222512258"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222512258" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222512258">(Jan 12 2021 at 23:44)</a>:</h4>
<p>so use <a href="https://github.com/rust-lang/rust/commit/ef893ae3c016152f7efd5f5fbc14ce527d7146f3">ef893ae3c016152f7efd5f5fbc14ce527d7146f3</a> as the hash instead (once it finishes building in half an hour)</p>



<a name="222512296"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222512296" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Poliorcetics <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222512296">(Jan 12 2021 at 23:45)</a>:</h4>
<p>Starred the message, I’ll come back to it tomorrow <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="222512536"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222512536" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222512536">(Jan 12 2021 at 23:48)</a>:</h4>
<p>lol <code>"__imp___std_init_once_complete"</code> only has 3 hits on all of google<br>
<a href="/user_uploads/4715/JD-vQ6FTHYke4Rpg99FWewnM/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/JD-vQ6FTHYke4Rpg99FWewnM/image.png" title="image.png"><img src="/user_uploads/4715/JD-vQ6FTHYke4Rpg99FWewnM/image.png"></a></div>



<a name="222512578"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222512578" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oliver <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222512578">(Jan 12 2021 at 23:49)</a>:</h4>
<p>try GH?</p>



<a name="222512595"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222512595" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222512595">(Jan 12 2021 at 23:49)</a>:</h4>
<p>only hits are in the windows c++ template library <a href="https://github.com/microsoft/STL/search?q=__imp___std_init_once_complete">https://github.com/microsoft/STL/search?q=__imp___std_init_once_complete</a></p>



<a name="222512670"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222512670" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222512670">(Jan 12 2021 at 23:50)</a>:</h4>
<p><a href="https://github.com/rust-skia/rust-skia/issues/431">https://github.com/rust-skia/rust-skia/issues/431</a></p>
<blockquote>
<p>Thanks, updating VS build tools fixed it!</p>
</blockquote>
<p><span class="user-mention" data-user-id="123586">@nagisa</span> <span aria-label="eyes" class="emoji emoji-1f440" role="img" title="eyes">:eyes:</span> maybe try that?</p>



<a name="222512713"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222512713" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oliver <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222512713">(Jan 12 2021 at 23:51)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/Downloading.20static.20LLVM.20on.20windows/near/222510495">said</a>:</p>
<blockquote>
<p>well, if you want a problem to ponder, it baffles me why I needed to take out <code>LLVM_INCLUDE_TESTS=OFF</code> from the cmake config: <a href="https://github.com/rust-lang/rust/pull/80932/files#diff-ca6526d91d41c31fad645c46417e0f1ce61e324542994e8c8b72b1f7a08c91bdL174">https://github.com/rust-lang/rust/pull/80932/files#diff-ca6526d91d41c31fad645c46417e0f1ce61e324542994e8c8b72b1f7a08c91bdL174</a></p>
</blockquote>
<p>usually passing these flags to cmake during build would cause an llvm build to fail</p>



<a name="222512741"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222512741" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222512741">(Jan 12 2021 at 23:51)</a>:</h4>
<p>I am unsure why you say that. <code>LLVM_INCLUDE_TESTS=OFF</code> is hard-coded on in compiler/rustc_llvm and has been working fine since it was added several years ago.</p>



<a name="222512836"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222512836" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oliver <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222512836">(Jan 12 2021 at 23:52)</a>:</h4>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>~/Library/llvm-project/build on 🌱 main via ℂ v3.13.4
ϐ cmake -DLLVM_INCLUDE_TESTS<span class="o">=</span>OFF --build .
-- Could NOT find LibXml2 <span class="o">(</span>missing: LIBXML2_LIBRARY LIBXML2_INCLUDE_DIR<span class="o">)</span>
</code></pre></div>
<p>^ this is not how it works</p>



<a name="222512852"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222512852" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222512852">(Jan 12 2021 at 23:53)</a>:</h4>
<p>that just looks like you don't have libxml installed</p>



<a name="222512857"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222512857" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222512857">(Jan 12 2021 at 23:53)</a>:</h4>
<p>which is not related to this issue</p>



<a name="222512898"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222512898" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oliver <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222512898">(Jan 12 2021 at 23:54)</a>:</h4>
<p>no it works like this</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>ϐ cmake --build .
<span class="o">[</span><span class="m">10</span>/2972<span class="o">]</span> Building CXX object lib/Support/CMakeFiles/LLVMSupport.dir/Allocator.cpp.o
</code></pre></div>



<a name="222513026"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222513026" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222513026">(Jan 12 2021 at 23:55)</a>:</h4>
<p>I can try re updating VS build tools</p>



<a name="222513152"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222513152" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222513152">(Jan 12 2021 at 23:56)</a>:</h4>
<p><span class="user-mention" data-user-id="281739">@oliver</span> I don't know why it doesn't work for you locally, but INCLUDE_TESTS=OFF has been present since bootstrap was written in 2015: <a href="https://github.com/rust-lang/rust/commit/046e6874c47ec55e23b7a566bca51d2920562485">046e6874c47ec55e23b7a566bca51d2920562485</a>. The errors you're getting don't look at all related to the errors llvm-config gave.</p>



<a name="222513321"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222513321" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oliver <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222513321">(Jan 12 2021 at 23:58)</a>:</h4>
<p>I'm on a completely different system and am building llvm from source</p>



<a name="222513355"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222513355" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oliver <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222513355">(Jan 12 2021 at 23:58)</a>:</h4>
<p>but I still run into problems passing these flags to cmake during build</p>



<a name="222513373"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222513373" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oliver <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222513373">(Jan 12 2021 at 23:59)</a>:</h4>
<p>and I have <code>libxml2</code> fwiw</p>



<a name="222513741"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222513741" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Halkcyon <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222513741">(Jan 13 2021 at 00:02)</a>:</h4>
<p>steps taken:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>$ git clone git@github.com:rust-lang/rust.git <span class="o">&amp;&amp;</span> <span class="nb">cd</span> rust
$ git fetch origin pull/80932/head <span class="o">&amp;&amp;</span> git checkout FETCH_HEAD
<span class="c1"># modify `src/bootstrap/bootstrap.py` line 446 to `llvm_sha='f092cb6bc7133a66e68327189cb1cb39af7cc38e'`</span>
$ cp config.toml.example config.toml
<span class="c1"># modify `config.toml` line 46 to `download-ci-llvm = true`</span>
$ py.exe -3.8 x.py build
</code></pre></div>
<p>results:</p>
<div class="codehilite"><pre><span></span><code>   Compiling rustdoc-tool v0.0.0 (R:\rust\src\tools\rustdoc)
    Finished release [optimized] target(s) in 1m 49s
Build completed successfully in 0:23:44
</code></pre></div>



<a name="222514289"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222514289" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222514289">(Jan 13 2021 at 00:09)</a>:</h4>
<p>Oh no way</p>



<a name="222514309"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222514309" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222514309">(Jan 13 2021 at 00:10)</a>:</h4>
<p>And it said "downloading llvm" at the very start? You have a build/$TARGET/ci-llvm folder but no llvm/ folder?</p>



<a name="222514488"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222514488" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Halkcyon <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222514488">(Jan 13 2021 at 00:11)</a>:</h4>
<p><a href="/user_uploads/4715/bFUGNA0R40PFe6kM_z40r4es/build.log">build.log</a> </p>
<p>Console output from <code>x.py build</code> ^</p>
<p>I don't see a <code>"downloading llvm"</code>, but I do see this:</p>
<div class="codehilite"><pre><span></span><code>extracting R:\rust\build\cache\llvm-f092cb6bc7133a66e68327189cb1cb39af7cc38e-False\rust-dev-nightly-x86_64-pc-windows-msvc.tar.xz
</code></pre></div>



<a name="222514588"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222514588" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222514588">(Jan 13 2021 at 00:13)</a>:</h4>
<p>Yes, that looks right</p>



<a name="222514594"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222514594" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222514594">(Jan 13 2021 at 00:13)</a>:</h4>
<p>Oh man this is incredible <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="222514598"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222514598" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222514598">(Jan 13 2021 at 00:13)</a>:</h4>
<p>Thank you!</p>



<a name="222514607"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222514607" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Halkcyon <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222514607">(Jan 13 2021 at 00:13)</a>:</h4>
<p>Also correct, I do not have a <code>llvm/</code> folder, just the <code>build/${TARGET}/ci-llvm/</code></p>
<p><a href="user_uploads/4715/F1daDS4DdktXHcEZPAapquDu/image.png">image.png</a></p>
<div class="message_inline_image"><a href="user_uploads/4715/F1daDS4DdktXHcEZPAapquDu/image.png" title="image.png"><img src="user_uploads/4715/F1daDS4DdktXHcEZPAapquDu/image.png"></a></div>



<a name="222514973"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222514973" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222514973">(Jan 13 2021 at 00:19)</a>:</h4>
<p><span class="user-mention" data-user-id="232545">@Joshua Nelson</span> Ok I guess I can see why the symbol problem could arise</p>



<a name="222515048"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222515048" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222515048">(Jan 13 2021 at 00:20)</a>:</h4>
<p>if LLVM on CI was built with a newer VC libraries, then linking to them with older VC build tools is prone to fail as we've seen</p>



<a name="222515080"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222515080" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222515080">(Jan 13 2021 at 00:20)</a>:</h4>
<p>Because the newer libraries could've gained… new dependencies as a result of fixes, etc.</p>



<a name="222515295"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222515295" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222515295">(Jan 13 2021 at 00:23)</a>:</h4>
<p>That makes sense. I'm fine with just asking people to upgrade</p>



<a name="222515399"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222515399" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Halkcyon <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222515399">(Jan 13 2021 at 00:25)</a>:</h4>
<p><a href="/user_uploads/4715/bYrN5e50m2BMNdt6CbYXHqi5/image.png">image.png</a> <br>
<a href="/user_uploads/4715/qBW9Ic-vVDvq2CfIuVc8HaZ7/image.png">image.png</a> </p>
<div class="message_inline_image"><a href="/user_uploads/4715/bYrN5e50m2BMNdt6CbYXHqi5/image.png" title="image.png"><img src="/user_uploads/4715/bYrN5e50m2BMNdt6CbYXHqi5/image.png"></a></div><div class="message_inline_image"><a href="/user_uploads/4715/qBW9Ic-vVDvq2CfIuVc8HaZ7/image.png" title="image.png"><img src="/user_uploads/4715/qBW9Ic-vVDvq2CfIuVc8HaZ7/image.png"></a></div><p>some environment details ^</p>



<a name="222515664"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222515664" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222515664">(Jan 13 2021 at 00:28)</a>:</h4>
<p><span class="user-mention" data-user-id="379356">@Halkcyon</span> actually only the msvc version matters haha</p>



<a name="222515686"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222515686" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222515686">(Jan 13 2021 at 00:28)</a>:</h4>
<p>Ok cool, so we can say vs 2019 14.28 and later are supported</p>



<a name="222515692"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222515692" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Halkcyon <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222515692">(Jan 13 2021 at 00:28)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/Downloading.20static.20LLVM.20on.20windows/near/222515664">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="379356">Halkcyon</span> actually only the msvc version matters haha</p>
</blockquote>
<p>just being thorough <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="222519324"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222519324" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222519324">(Jan 13 2021 at 01:14)</a>:</h4>
<p>(the Mac try run is <em>almost</em> done, needs maybe another 10 minutes)</p>



<a name="222520283"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222520283" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222520283">(Jan 13 2021 at 01:26)</a>:</h4>
<p>anddd it failed :( no mac builds for now</p>



<a name="222520755"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222520755" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222520755">(Jan 13 2021 at 01:32)</a>:</h4>
<p><span class="user-mention" data-user-id="232545">@Joshua Nelson</span> <a href="/user_uploads/4715/KowQNR0pUHKrTTfQdeg8EQnN/help-me-i-am-dying.png">help-me-i-am-dying.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/KowQNR0pUHKrTTfQdeg8EQnN/help-me-i-am-dying.png" title="help-me-i-am-dying.png"><img src="/user_uploads/4715/KowQNR0pUHKrTTfQdeg8EQnN/help-me-i-am-dying.png"></a></div>



<a name="222520784"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222520784" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222520784">(Jan 13 2021 at 01:33)</a>:</h4>
<p><span class="user-mention" data-user-id="276242">@Riccardo D'Ambrosio</span> that was really some amazing timing <span aria-label="joy" class="emoji emoji-1f602" role="img" title="joy">:joy:</span></p>



<a name="222520801"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222520801" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222520801">(Jan 13 2021 at 01:33)</a>:</h4>
<p>right when I thought everything was working</p>



<a name="222520811"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222520811" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222520811">(Jan 13 2021 at 01:33)</a>:</h4>
<p>just try it again, im sure it will work this time <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span></p>



<a name="222520878"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222520878" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222520878">(Jan 13 2021 at 01:34)</a>:</h4>
<p>you even did it at the exact same time as bors <a href="https://github.com/rust-lang/rust/pull/80932/files#issuecomment-759144296">https://github.com/rust-lang/rust/pull/80932/files#issuecomment-759144296</a></p>



<a name="222521110"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222521110" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222521110">(Jan 13 2021 at 01:37)</a>:</h4>
<p><span class="user-mention" data-user-id="116122">@simulacrum</span> is there a way to download the artifacts from a failed build? <code>build/tmp/tarball/rust-dev/x86_64-apple-darwin/image/lib</code> is missing for some reason and I don't know why.</p>



<a name="222521283"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222521283" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222521283">(Jan 13 2021 at 01:39)</a>:</h4>
<p>Uh, if it's not in the standard place (ci-artifacts) then no</p>



<a name="222521306"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222521306" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222521306">(Jan 13 2021 at 01:39)</a>:</h4>
<p>time for the tried and true debug method, "stare really hard at the code"</p>



<a name="222521373"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222521373" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222521373">(Jan 13 2021 at 01:40)</a>:</h4>
<p>oh well that actually helped this time</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">    </span><span class="c1">// On macOS, rustc (and LLVM tools) link to an unversioned libLLVM.dylib</span>
<span class="w">    </span><span class="c1">// instead of libLLVM-11-rust-....dylib, as on linux. It's not entirely</span>
<span class="w">    </span><span class="c1">// clear why this is the case, though. llvm-config will emit the versioned</span>
<span class="w">    </span><span class="c1">// paths and we don't want those in the sysroot (as we're expecting</span>
<span class="w">    </span><span class="c1">// unversioned paths).</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">target</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="s">"apple-darwin"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">src_libdir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">builder</span><span class="p">.</span><span class="n">llvm_out</span><span class="p">(</span><span class="n">target</span><span class="p">).</span><span class="n">join</span><span class="p">(</span><span class="s">"lib"</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">llvm_dylib_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">src_libdir</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="s">"libLLVM.dylib"</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">llvm_dylib_path</span><span class="p">.</span><span class="n">exists</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">builder</span><span class="p">.</span><span class="n">install</span><span class="p">(</span><span class="o">&amp;</span><span class="n">llvm_dylib_path</span><span class="p">,</span><span class="w"> </span><span class="n">dst_libdir</span><span class="p">,</span><span class="w"> </span><span class="mo">0o644</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="o">!</span><span class="n">builder</span><span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="n">dry_run</span><span class="w"></span>
</code></pre></div>



<a name="222525820"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222525820" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222525820">(Jan 13 2021 at 02:44)</a>:</h4>
<p>heh, I had similar code at one point that I gave up on</p>



<a name="222525965"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222525965" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222525965">(Jan 13 2021 at 02:47)</a>:</h4>
<p>this issue in this case was that it assumed that LLVM would always be linked dynamically, so it wouldn't even try to copy the static files</p>



<a name="222526015"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222526015" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222526015">(Jan 13 2021 at 02:48)</a>:</h4>
<p>I <em>think</em> I fixed it but <code>dist-x86_64-apple</code> takes 90 minutes to run so I'm not sure :(</p>



<a name="222531580"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222531580" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222531580">(Jan 13 2021 at 04:21)</a>:</h4>
<p>yay it worked <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span> <a href="https://github.com/rust-lang/rust/pull/80932#issuecomment-759189299">https://github.com/rust-lang/rust/pull/80932#issuecomment-759189299</a></p>



<a name="222531676"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222531676" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222531676">(Jan 13 2021 at 04:22)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/Downloading.20static.20LLVM.20on.20windows/near/222510634">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="220326">J. Ryan Stinnett</span> <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/Downloading.20static.20LLVM.20on.20windows/near/222510509">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/Downloading.20static.20LLVM.20on.20windows/near/222508892">said</a>:</p>
<blockquote>
<p>I'm already wondering if it will work on MacOS <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>
</blockquote>
<p>I am happy to test on macOS (and Windows as well) if it would help <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>
</blockquote>
<p>that would be great! you can test with <code>git fetch origin pull/80932/head &amp;&amp; git checkout FETCH_HEAD</code>, then edit bootstrap.py like in <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/Downloading.20static.20LLVM.20on.20windows/near/222506123">https://rust-lang.zulipchat.com/#narrow/stream/182449-t-compiler.2Fhelp/topic/Downloading.20static.20LLVM.20on.20windows/near/222506123</a>, but with the hash <code>f092cb6bc7133a66e68327189cb1cb39af7cc38e</code>. Then add <code>[llvm] download-ci-llvm = true</code> to config.toml and see if x.py build works.</p>
</blockquote>
<p><span class="user-mention" data-user-id="220326">@J. Ryan Stinnett</span> <span class="user-mention" data-user-id="307289">@Poliorcetics</span> if you want to help, those instructions still work, but the hash is now <code>dcd936b712817bb219ed8edbddb8e630353ef23d</code>.</p>



<a name="222555023"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222555023" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> J. Ryan Stinnett <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222555023">(Jan 13 2021 at 09:34)</a>:</h4>
<p>There's indeed something to download this time, let's see if it builds...</p>



<a name="222559140"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222559140" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> J. Ryan Stinnett <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222559140">(Jan 13 2021 at 10:14)</a>:</h4>
<p><span class="user-mention" data-user-id="232545">@Joshua Nelson</span> Seems to work here! 🥳</p>
<div class="codehilite"><pre><span></span><code>$ python3 x.py build library/std
extracting /Users/jryans/Projects/Rust/rust/build/cache/llvm-dcd936b712817bb219ed8edbddb8e630353ef23d-False/rust-dev-nightly-x86_64-apple-darwin.tar.xz
...
Build completed successfully in 0:17:14
</code></pre></div>



<a name="222586788"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222586788" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222586788">(Jan 13 2021 at 14:29)</a>:</h4>
<p>I think this is ready to go then :)</p>



<a name="222622702"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222622702" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Poliorcetics <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222622702">(Jan 13 2021 at 18:15)</a>:</h4>
<p>Currently running <code>python3 x.py clean &amp;&amp; python3 x.py test --stage 1</code>, it correctly downloaded LLVM and did not compile it</p>



<a name="222622763"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222622763" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Poliorcetics <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222622763">(Jan 13 2021 at 18:15)</a>:</h4>
<p><code>rustc_middle</code> is taking its time as usual, but everything seems to work just fine for now</p>



<a name="222623524"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222623524" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Poliorcetics <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222623524">(Jan 13 2021 at 18:21)</a>:</h4>
<p>tests started, see you in 30 minutes</p>



<a name="222624228"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222624228" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222624228">(Jan 13 2021 at 18:26)</a>:</h4>
<p>if it gets that far I would expect it to work fine :) thank you for testing!</p>



<a name="222624245"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222624245" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222624245">(Jan 13 2021 at 18:26)</a>:</h4>
<p>this is just waiting for review then :)</p>



<a name="222630242"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Downloading%20static%20LLVM%20on%20windows/near/222630242" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Poliorcetics <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Downloading.20static.20LLVM.20on.20windows.html#222630242">(Jan 13 2021 at 19:10)</a>:</h4>
<p>all clear <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>