<html>
<head><meta charset="utf-8"><title>rustup link rustc + cargo both · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/rustup.20link.20rustc.20.2B.20cargo.20both.html">rustup link rustc + cargo both</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="264110107"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustup%20link%20rustc%20%2B%20cargo%20both/near/264110107" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Dona-Couch <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/rustup.20link.20rustc.20.2B.20cargo.20both.html#264110107">(Dec 08 2021 at 04:16)</a>:</h4>
<p>I'm hacking on rustc, and used rustup link to use the stage1 toolchain in my test projects.  It seems that cargo by default isn't the one matching my stage1 toolchain, which makes sense (it doesn't even build by default...).  So I build cargo (./x.py build cargo), but the rustup linked toolchain still doesn't have it.  That also makes sense, the cargo binary is in a different directory under the build.</p>
<p>What do I do now?  To keep making progress I've been just manually copying cargo into the stage1 directory, but I'm sure there must be a smarter way to do this, right?</p>
<p>I suppose I don't really need the matching cargo, all I really need is a cargo that will let me pass -Z flags.  It seems like rustup is falling back to stable cargo.  Is there some way for me to update my toolchain link to fall back to nightly cargo?</p>



<a name="264110318"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustup%20link%20rustc%20%2B%20cargo%20both/near/264110318" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/rustup.20link.20rustc.20.2B.20cargo.20both.html#264110318">(Dec 08 2021 at 04:21)</a>:</h4>
<p><span class="user-mention" data-user-id="462913">@Andrew Dona-Couch</span> yes, <code>rustup override set nightly</code> should change the default for just the current repo</p>



<a name="264110321"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustup%20link%20rustc%20%2B%20cargo%20both/near/264110321" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/rustup.20link.20rustc.20.2B.20cargo.20both.html#264110321">(Dec 08 2021 at 04:21)</a>:</h4>
<p>Rustup automatically falls back to nightly, beta, or stable (in that order, whichever is the first one it finds that is installed).</p>



<a name="264110344"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustup%20link%20rustc%20%2B%20cargo%20both/near/264110344" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/rustup.20link.20rustc.20.2B.20cargo.20both.html#264110344">(Dec 08 2021 at 04:21)</a>:</h4>
<p><span class="user-mention" data-user-id="120518">@Eric Huss</span> that doesn't sound right, you can <code>rustup set default</code> to any toolchain. Do you mean x.py?</p>



<a name="264110424"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustup%20link%20rustc%20%2B%20cargo%20both/near/264110424" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/rustup.20link.20rustc.20.2B.20cargo.20both.html#264110424">(Dec 08 2021 at 04:23)</a>:</h4>
<p>For a toolchain that doesn't have a <code>cargo</code> executable in the <code>bin</code> directory, rustup will search for one in nightly/beta/stable toolchains.</p>



<a name="264110491"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustup%20link%20rustc%20%2B%20cargo%20both/near/264110491" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/rustup.20link.20rustc.20.2B.20cargo.20both.html#264110491">(Dec 08 2021 at 04:24)</a>:</h4>
<p>So when you run <code>cargo +stage1</code> or you have a <code>stage1</code> override, that's how things usually work without building cargo.</p>



<a name="264111188"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustup%20link%20rustc%20%2B%20cargo%20both/near/264111188" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Dona-Couch <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/rustup.20link.20rustc.20.2B.20cargo.20both.html#264111188">(Dec 08 2021 at 04:36)</a>:</h4>
<p>Oh I see, so the issue is that I didn't have nightly installed at all, I didn't have beta installed through rustup, and stable was installed because rustup automatically installs it.  So <code>rustup install nightly</code> is all I need for it to work right.</p>



<a name="264111339"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustup%20link%20rustc%20%2B%20cargo%20both/near/264111339" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Dona-Couch <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/rustup.20link.20rustc.20.2B.20cargo.20both.html#264111339">(Dec 08 2021 at 04:39)</a>:</h4>
<p>I think this warrants a mention in the docs, but I'm not sure what docs.  Maybe the rustc-dev-guide section about rustup link?</p>



<a name="264111969"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustup%20link%20rustc%20%2B%20cargo%20both/near/264111969" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/rustup.20link.20rustc.20.2B.20cargo.20both.html#264111969">(Dec 08 2021 at 04:51)</a>:</h4>
<p>Yeah, that sounds like a good place :)</p>



<a name="264112808"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustup%20link%20rustc%20%2B%20cargo%20both/near/264112808" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/rustup.20link.20rustc.20.2B.20cargo.20both.html#264112808">(Dec 08 2021 at 05:05)</a>:</h4>
<p>It is mentioned <a href="https://rust-lang.github.io/rustup/concepts/toolchains.html#custom-toolchains">here</a>, but I think adding it to the rustc-dev-guide would be a good idea.</p>



<a name="264112962"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustup%20link%20rustc%20%2B%20cargo%20both/near/264112962" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Dona-Couch <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/rustup.20link.20rustc.20.2B.20cargo.20both.html#264112962">(Dec 08 2021 at 05:09)</a>:</h4>
<p>Indeed it is mentioned in the rustup docs!  I've opened a PR to the rustc-dev-guide.  Thanks all.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>