<html>
<head><meta charset="utf-8"><title>TyEncodable for indexmap? · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/TyEncodable.20for.20indexmap.3F.html">TyEncodable for indexmap?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="267084106"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/TyEncodable%20for%20indexmap%3F/near/267084106" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/TyEncodable.20for.20indexmap.3F.html#267084106">(Jan 06 2022 at 16:50)</a>:</h4>
<p>I'm getting the following error in <a href="https://github.com/rust-lang/rust/pull/90842">https://github.com/rust-lang/rust/pull/90842</a>:</p>
<div class="codehilite"><pre><span></span><code>error[E0277]: the trait bound `indexmap::map::IndexMap&lt;SimplifiedTypeGen&lt;rustc_span::def_id::DefId&gt;, Vec&lt;rustc_span::def_id::DefId&gt;, BuildHasherDefault&lt;FxHasher&gt;&gt;: Encodable&lt;__E&gt;` is not satisfied
  --&gt; compiler/rustc_middle/src/traits/specialization_graph.rs:51:19
   |
51 |   #[derive(Default, TyEncodable, TyDecodable, Debug, HashStable)]
   |                     ^^^^^^^^^^^
   |                     |
   |                     the trait `Encodable&lt;__E&gt;` is not implemented for `indexmap::map::IndexMap&lt;SimplifiedTypeGen&lt;rustc_span::def_id::DefId&gt;, Vec&lt;rustc_span::def_id::DefId&gt;, BuildHasherDefault&lt;FxHasher&gt;&gt;`
   |                     in this derive macro expansion
   |
  ::: /Users/wpierce/.cargo/registry/src/github.com-1ecc6299db9ec823/synstructure-0.12.6/src/macros.rs:94:9
   |
94 | /         pub fn $derives(
95 | |             i: $crate::macros::TokenStream
96 | |         ) -&gt; $crate::macros::TokenStream {
   | |________________________________________- in this expansion of `#[derive(TyEncodable)]`
</code></pre></div>
<p>(I'm using a temporary git dependency that's blocked by tidy in CI, so this error only shows up locally right now.)</p>
<p>Is there a way to get this trait where I need it? Will I need some kind of wrapping type?</p>



<a name="267084216"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/TyEncodable%20for%20indexmap%3F/near/267084216" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/TyEncodable.20for.20indexmap.3F.html#267084216">(Jan 06 2022 at 16:51)</a>:</h4>
<p>Then again, maybe the indexmap isn't the problem? <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="267084455"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/TyEncodable%20for%20indexmap%3F/near/267084455" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/TyEncodable.20for.20indexmap.3F.html#267084455">(Jan 06 2022 at 16:53)</a>:</h4>
<p>Or maybe I need to manually implement something? I also don't even know what TyEncodable is for <span aria-label="innocent" class="emoji emoji-1f607" role="img" title="innocent">:innocent:</span></p>



<a name="267084736"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/TyEncodable%20for%20indexmap%3F/near/267084736" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/TyEncodable.20for.20indexmap.3F.html#267084736">(Jan 06 2022 at 16:55)</a>:</h4>
<p>You will need to add an implementation of <code>Encodable</code> and <code>Decodable</code> for <code>IndexMap</code> to rustc_serialize. <code>(Ty)Encodable</code> and <code>(Ty)Decodable</code> are used to serialize and deserialize crate metadata and incremental caches.</p>



<a name="267084900"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/TyEncodable%20for%20indexmap%3F/near/267084900" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/TyEncodable.20for.20indexmap.3F.html#267084900">(Jan 06 2022 at 16:57)</a>:</h4>
<p>Ah! So somewhere in here, maybe? <a href="https://github.com/rust-lang/rust/blob/03c49e62dbf5071e9c6f62fb25d8014f90243dca/compiler/rustc_serialize/src/serialize.rs#L589">https://github.com/rust-lang/rust/blob/03c49e62dbf5071e9c6f62fb25d8014f90243dca/compiler/rustc_serialize/src/serialize.rs#L589</a></p>



<a name="267085017"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/TyEncodable%20for%20indexmap%3F/near/267085017" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/TyEncodable.20for.20indexmap.3F.html#267085017">(Jan 06 2022 at 16:58)</a>:</h4>
<p>Here I think: <a href="https://github.com/rust-lang/rust/blob/03c49e62dbf5071e9c6f62fb25d8014f90243dca/compiler/rustc_serialize/src/collection_impls.rs">https://github.com/rust-lang/rust/blob/03c49e62dbf5071e9c6f62fb25d8014f90243dca/compiler/rustc_serialize/src/collection_impls.rs</a></p>



<a name="267085039"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/TyEncodable%20for%20indexmap%3F/near/267085039" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/TyEncodable.20for.20indexmap.3F.html#267085039">(Jan 06 2022 at 16:58)</a>:</h4>
<p>Looks like IndexMap already has an implementation...</p>



<a name="267085069"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/TyEncodable%20for%20indexmap%3F/near/267085069" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/TyEncodable.20for.20indexmap.3F.html#267085069">(Jan 06 2022 at 16:58)</a>:</h4>
<p>hmmmm</p>



<a name="267085074"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/TyEncodable%20for%20indexmap%3F/near/267085074" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/TyEncodable.20for.20indexmap.3F.html#267085074">(Jan 06 2022 at 16:59)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/blob/03c49e62dbf5071e9c6f62fb25d8014f90243dca/compiler/rustc_serialize/src/collection_impls.rs#L220-L225">https://github.com/rust-lang/rust/blob/03c49e62dbf5071e9c6f62fb25d8014f90243dca/compiler/rustc_serialize/src/collection_impls.rs#L220-L225</a> is the <code>Eq</code> bound satisfied?</p>



<a name="267085172"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/TyEncodable%20for%20indexmap%3F/near/267085172" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/TyEncodable.20for.20indexmap.3F.html#267085172">(Jan 06 2022 at 16:59)</a>:</h4>
<p>checking now</p>



<a name="267085483"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/TyEncodable%20for%20indexmap%3F/near/267085483" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/TyEncodable.20for.20indexmap.3F.html#267085483">(Jan 06 2022 at 17:01)</a>:</h4>
<p>I think the issue is that you are now using two versions of indexmap. The impl applies only to one of the versions. You should probably patch it using <code>[patch.crates-io]</code> instead of replacing the dependency specification.</p>



<a name="267085487"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/TyEncodable%20for%20indexmap%3F/near/267085487" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/TyEncodable.20for.20indexmap.3F.html#267085487">(Jan 06 2022 at 17:01)</a>:</h4>
<p>looks to me like all the types in <code>indexmap::map::IndexMap&lt;SimplifiedTypeGen&lt;rustc_span::def_id::DefId&gt;, Vec&lt;rustc_span::def_id::DefId&gt;, BuildHasherDefault&lt;FxHasher&gt;&gt;</code> are Eq, but I could be wrong.</p>



<a name="267085572"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/TyEncodable%20for%20indexmap%3F/near/267085572" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/TyEncodable.20for.20indexmap.3F.html#267085572">(Jan 06 2022 at 17:02)</a>:</h4>
<p>That would be here: <a href="https://github.com/rust-lang/rust/blob/a77cc64af491a31db224109a76b9b81cd26cd07c/Cargo.toml#L123">https://github.com/rust-lang/rust/blob/a77cc64af491a31db224109a76b9b81cd26cd07c/Cargo.toml#L123</a></p>



<a name="267085641"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/TyEncodable%20for%20indexmap%3F/near/267085641" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/TyEncodable.20for.20indexmap.3F.html#267085641">(Jan 06 2022 at 17:02)</a>:</h4>
<p>ah, so use that for now, then when the version of indexmap with the fix is released, put it in the cargo.toml/lock?</p>



<a name="267085671"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/TyEncodable%20for%20indexmap%3F/near/267085671" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/TyEncodable.20for.20indexmap.3F.html#267085671">(Jan 06 2022 at 17:03)</a>:</h4>
<p>Yes</p>



<a name="267085698"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/TyEncodable%20for%20indexmap%3F/near/267085698" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/TyEncodable.20for.20indexmap.3F.html#267085698">(Jan 06 2022 at 17:03)</a>:</h4>
<p>okay, I'll try that, thanks!</p>



<a name="267086757"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/TyEncodable%20for%20indexmap%3F/near/267086757" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/TyEncodable.20for.20indexmap.3F.html#267086757">(Jan 06 2022 at 17:10)</a>:</h4>
<p>With this line in the main Cargo.toml <code>indexmap = { git = 'https://github.com/cuviper/indexmap.git', branch='rustc-rayon' }</code> and nothing else, I'm not getting the right dependency, because we're back to the error this branch is supposed to fix: </p>
<div class="codehilite"><pre><span></span><code>error[E0277]: the trait bound `&amp;indexmap::set::IndexSet&lt;LocalDefId, BuildHasherDefault&lt;FxHasher&gt;&gt;: ParallelIterator` is not satisfied
    --&gt; compiler/rustc_metadata/src/rmeta/encoder.rs:2098:14
     |
2098 |     par_iter(tcx.mir_keys(())).for_each(|&amp;def_id| {
     |     -------- ^^^^^^^^^^^^^^^^ the trait `ParallelIterator` is not implemented for `&amp;indexmap::set::IndexSet&lt;LocalDefId, BuildHasherDefault&lt;FxHasher&gt;&gt;`
     |     |
     |     required by a bound introduced by this call
     |
     = note: required because of the requirements on the impl of `rustc_rayon::iter::IntoParallelIterator` for `&amp;indexmap::set::IndexSet&lt;LocalDefId, BuildHasherDefault&lt;FxHasher&gt;&gt;`
note: required by a bound in `par_iter`
    --&gt; /Users/wpierce/repos/rust/compiler/rustc_data_structures/src/sync.rs:334:28
     |
334  |         pub fn par_iter&lt;T: IntoParallelIterator&gt;(t: T) -&gt; T::Iter {
     |                            ^^^^^^^^^^^^^^^^^^^^ required by this bound in `par_iter`
</code></pre></div>



<a name="267086780"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/TyEncodable%20for%20indexmap%3F/near/267086780" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/TyEncodable.20for.20indexmap.3F.html#267086780">(Jan 06 2022 at 17:11)</a>:</h4>
<p>Does it need to be in the crate Cargo.toml as well?</p>



<a name="267086833"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/TyEncodable%20for%20indexmap%3F/near/267086833" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/TyEncodable.20for.20indexmap.3F.html#267086833">(Jan 06 2022 at 17:11)</a>:</h4>
<p>Does it give a warning along the lines of unused patch?</p>



<a name="267086911"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/TyEncodable%20for%20indexmap%3F/near/267086911" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/TyEncodable.20for.20indexmap.3F.html#267086911">(Jan 06 2022 at 17:12)</a>:</h4>
<p>I don't think so...</p>
<div class="codehilite"><pre><span></span><code>error: unused import: `FxIndexMap`
 --&gt; compiler/rustc_metadata/src/rmeta/encoder.rs:5:44
  |
5 | use rustc_data_structures::fx::{FxHashMap, FxIndexMap, FxIndexSet};
  |                                            ^^^^^^^^^^
  |
  = note: `-D unused-imports` implied by `-D warnings`
</code></pre></div>



<a name="267086949"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/TyEncodable%20for%20indexmap%3F/near/267086949" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/TyEncodable.20for.20indexmap.3F.html#267086949">(Jan 06 2022 at 17:12)</a>:</h4>
<p>And what does cargo list when compiling indexmap? Does it show the git path or just the version?</p>



<a name="267086990"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/TyEncodable%20for%20indexmap%3F/near/267086990" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/TyEncodable.20for.20indexmap.3F.html#267086990">(Jan 06 2022 at 17:12)</a>:</h4>
<p>git path</p>



<a name="267087046"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/TyEncodable%20for%20indexmap%3F/near/267087046" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/TyEncodable.20for.20indexmap.3F.html#267087046">(Jan 06 2022 at 17:13)</a>:</h4>
<p>ah the error might be related to a change from rebasing on master</p>



<a name="267087061"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/TyEncodable%20for%20indexmap%3F/near/267087061" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/TyEncodable.20for.20indexmap.3F.html#267087061">(Jan 06 2022 at 17:13)</a>:</h4>
<p>i'll look into that and come back if i'm still stuck :)</p>



<a name="267087110"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/TyEncodable%20for%20indexmap%3F/near/267087110" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/TyEncodable.20for.20indexmap.3F.html#267087110">(Jan 06 2022 at 17:14)</a>:</h4>
<p>wait... maybe not... i'm still stuck lol</p>



<a name="267087153"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/TyEncodable%20for%20indexmap%3F/near/267087153" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/TyEncodable.20for.20indexmap.3F.html#267087153">(Jan 06 2022 at 17:14)</a>:</h4>
<p>i'll push my current code</p>



<a name="267087315"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/TyEncodable%20for%20indexmap%3F/near/267087315" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/TyEncodable.20for.20indexmap.3F.html#267087315">(Jan 06 2022 at 17:15)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/pull/90842/files">https://github.com/rust-lang/rust/pull/90842/files</a></p>



<a name="267087538"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/TyEncodable%20for%20indexmap%3F/near/267087538" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/TyEncodable.20for.20indexmap.3F.html#267087538">(Jan 06 2022 at 17:17)</a>:</h4>
<p>(actually some of my changes may have fallen out ....)</p>



<a name="267087946"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/TyEncodable%20for%20indexmap%3F/near/267087946" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/TyEncodable.20for.20indexmap.3F.html#267087946">(Jan 06 2022 at 17:20)</a>:</h4>
<p>Weird. No idea what the problem is.</p>



<a name="267089236"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/TyEncodable%20for%20indexmap%3F/near/267089236" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/TyEncodable.20for.20indexmap.3F.html#267089236">(Jan 06 2022 at 17:30)</a>:</h4>
<p>Ah!</p>



<a name="267089405"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/TyEncodable%20for%20indexmap%3F/near/267089405" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/TyEncodable.20for.20indexmap.3F.html#267089405">(Jan 06 2022 at 17:32)</a>:</h4>
<p>Maybe the upstream patch only added <code>ParallelIterator</code> for IndexMap, not IndexSet. Lemme check that..</p>



<a name="267089915"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/TyEncodable%20for%20indexmap%3F/near/267089915" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/TyEncodable.20for.20indexmap.3F.html#267089915">(Jan 06 2022 at 17:37)</a>:</h4>
<p>Nope, that's not it.</p>



<a name="267090452"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/TyEncodable%20for%20indexmap%3F/near/267090452" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/TyEncodable.20for.20indexmap.3F.html#267090452">(Jan 06 2022 at 17:41)</a>:</h4>
<p>yeah, it should work for both maps and sets</p>



<a name="267090494"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/TyEncodable%20for%20indexmap%3F/near/267090494" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/TyEncodable.20for.20indexmap.3F.html#267090494">(Jan 06 2022 at 17:41)</a>:</h4>
<p>we should merge and publish that already -- but now I want to be sure that it's actually working first... :)</p>



<a name="267090592"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/TyEncodable%20for%20indexmap%3F/near/267090592" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/TyEncodable.20for.20indexmap.3F.html#267090592">(Jan 06 2022 at 17:42)</a>:</h4>
<p>oh, <span class="user-mention" data-user-id="316352">@pierwill</span> it doesn't look like you're enabling the "rustc-rayon" feature</p>



<a name="267091394"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/TyEncodable%20for%20indexmap%3F/near/267091394" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/TyEncodable.20for.20indexmap.3F.html#267091394">(Jan 06 2022 at 17:49)</a>:</h4>
<p>Looks like that was it, <span class="user-mention" data-user-id="138448">@cuviper</span> ! <code>x.py check</code> is passing now</p>



<a name="267091797"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/TyEncodable%20for%20indexmap%3F/near/267091797" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/TyEncodable.20for.20indexmap.3F.html#267091797">(Jan 06 2022 at 17:53)</a>:</h4>
<p>Thank you :)</p>



<a name="267093136"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/TyEncodable%20for%20indexmap%3F/near/267093136" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/TyEncodable.20for.20indexmap.3F.html#267093136">(Jan 06 2022 at 18:02)</a>:</h4>
<p><span class="user-mention silent" data-user-id="316352">pierwill</span> <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/TyEncodable.20for.20indexmap.3F/near/267091394">said</a>:</p>
<blockquote>
<p><code>x.py check</code> is passing now</p>
</blockquote>
<p>It's working locally, not in CI because of git dependency</p>



<a name="267094062"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/TyEncodable%20for%20indexmap%3F/near/267094062" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/TyEncodable.20for.20indexmap.3F.html#267094062">(Jan 06 2022 at 18:09)</a>:</h4>
<p>You can edit <code>src/tools/tidy/src/extdeps.rs</code> to fix CI for now.</p>



<a name="267095428"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/TyEncodable%20for%20indexmap%3F/near/267095428" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/TyEncodable.20for.20indexmap.3F.html#267095428">(Jan 06 2022 at 18:21)</a>:</h4>
<p><span class="user-mention silent" data-user-id="133247">bjorn3</span> <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/TyEncodable.20for.20indexmap.3F/near/267094062">said</a>:</p>
<blockquote>
<p>You can edit <code>src/tools/tidy/src/extdeps.rs</code> to fix CI for now.</p>
</blockquote>
<p>Getting this error still. <a href="https://github.com/rust-lang/rust/runs/4730453134?check_suite_focus=true#step:25:137">https://github.com/rust-lang/rust/runs/4730453134?check_suite_focus=true#step:25:137</a></p>



<a name="267096270"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/TyEncodable%20for%20indexmap%3F/near/267096270" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/TyEncodable.20for.20indexmap.3F.html#267096270">(Jan 06 2022 at 18:29)</a>:</h4>
<p>I think you accidentally reverted the <code>[patch.crates-io]</code> change.</p>



<a name="267096779"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/TyEncodable%20for%20indexmap%3F/near/267096779" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/TyEncodable.20for.20indexmap.3F.html#267096779">(Jan 06 2022 at 18:33)</a>:</h4>
<p>I did. It gave a warning that said the patch mechanism won't work with features</p>



<a name="267096897"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/TyEncodable%20for%20indexmap%3F/near/267096897" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/TyEncodable.20for.20indexmap.3F.html#267096897">(Jan 06 2022 at 18:34)</a>:</h4>
<p><code>warning: patch for </code>indexmap<code> uses the features mechanism. default-features and features will not take effect because the patch dependency does not support this mechanism</code></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>