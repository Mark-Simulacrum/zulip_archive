<html>
<head><meta charset="utf-8"><title>impl Serialize for Symbol · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/impl.20Serialize.20for.20Symbol.html">impl Serialize for Symbol</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="264776494"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/impl%20Serialize%20for%20Symbol/near/264776494" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/impl.20Serialize.20for.20Symbol.html#264776494">(Dec 13 2021 at 22:01)</a>:</h4>
<p>Is there a reason that Symbol doesn't implement <code>serde::Serialize</code>? I understand why it doesn't implement <code>Deserialize</code>, but it seems like it should be able to implement <code>Serialize</code>.</p>



<a name="264777614"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/impl%20Serialize%20for%20Symbol/near/264777614" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/impl.20Serialize.20for.20Symbol.html#264777614">(Dec 13 2021 at 22:09)</a>:</h4>
<p>Rustc doesn't use serde, but the internal rustc_serialize crate (not to be confused with rustc_serialize on <a href="http://crates.io">crates.io</a>)</p>



<a name="264777766"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/impl%20Serialize%20for%20Symbol/near/264777766" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/impl.20Serialize.20for.20Symbol.html#264777766">(Dec 13 2021 at 22:10)</a>:</h4>
<p><code>Symbol</code> implements both <code>Encodable</code> and <code>Decodable</code>.</p>



<a name="264786292"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/impl%20Serialize%20for%20Symbol/near/264786292" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/impl.20Serialize.20for.20Symbol.html#264786292">(Dec 13 2021 at 23:33)</a>:</h4>
<p>The reason I ask is that rustdoc uses serde, and it also uses <code>Symbol</code>s</p>



<a name="264788780"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/impl%20Serialize%20for%20Symbol/near/264788780" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/impl.20Serialize.20for.20Symbol.html#264788780">(Dec 14 2021 at 00:01)</a>:</h4>
<p><span class="user-mention" data-user-id="307537">@Noah Lev</span> why do you want to serialize spans? If it's for scrape-examples it's not possible, see the original PR which discusses that the complication session is missing info</p>



<a name="264818774"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/impl%20Serialize%20for%20Symbol/near/264818774" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/impl.20Serialize.20for.20Symbol.html#264818774">(Dec 14 2021 at 06:52)</a>:</h4>
<p>It isn't possible to serialize spans usimg serde and by extension symbols. Serde doesn't allow specialization on the serializer to allow access to a context to access the source map or cstore.</p>



<a name="264824163"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/impl%20Serialize%20for%20Symbol/near/264824163" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/impl.20Serialize.20for.20Symbol.html#264824163">(Dec 14 2021 at 08:19)</a>:</h4>
<p><span class="user-mention" data-user-id="307537">@Noah Lev</span> started talking about symbols, then the conversation switched to spans?</p>



<a name="264824260"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/impl%20Serialize%20for%20Symbol/near/264824260" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/impl.20Serialize.20for.20Symbol.html#264824260">(Dec 14 2021 at 08:20)</a>:</h4>
<p>Serializing symbols is definitely possible (with a newtype), I'm mucking around with rustdoc and I just wrote this:</p>
<div class="codehilite"><pre><span></span><code>struct SerSymbol(Symbol);

impl Serialize for SerSymbol {
    fn serialize&lt;S&gt;(&amp;self, serializer: S) -&gt; Result&lt;S::Ok, S::Error&gt;
    where
        S: Serializer,
    {
        serializer.serialize_str(&amp;self.0.as_str())
    }
}
</code></pre></div>



<a name="264836904"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/impl%20Serialize%20for%20Symbol/near/264836904" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/impl.20Serialize.20for.20Symbol.html#264836904">(Dec 14 2021 at 10:28)</a>:</h4>
<p>Right, spans are part of <code>Ident</code> and not <code>SymbolStr</code>.</p>



<a name="264871424"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/impl%20Serialize%20for%20Symbol/near/264871424" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/impl.20Serialize.20for.20Symbol.html#264871424">(Dec 14 2021 at 15:09)</a>:</h4>
<p>Oh oops, I was pattern matching too quickly lol</p>



<a name="264907477"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/impl%20Serialize%20for%20Symbol/near/264907477" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/impl.20Serialize.20for.20Symbol.html#264907477">(Dec 14 2021 at 18:54)</a>:</h4>
<p>Yeah, the reason is that I want to use Symbols in a type that is serialized for tera.</p>



<a name="264907539"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/impl%20Serialize%20for%20Symbol/near/264907539" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/impl.20Serialize.20for.20Symbol.html#264907539">(Dec 14 2021 at 18:54)</a>:</h4>
<blockquote>
<p>Serializing symbols is definitely possible (with a newtype), I'm mucking around with rustdoc and I just wrote this:</p>
</blockquote>
<p>Would it be reasonable to add a Serialize impl on Symbol directly?</p>



<a name="264912236"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/impl%20Serialize%20for%20Symbol/near/264912236" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/impl.20Serialize.20for.20Symbol.html#264912236">(Dec 14 2021 at 19:22)</a>:</h4>
<p>That would require making <code>rustc_span</code> depend on <code>serde</code>, which felt wrong. The compiler currently doesn't depend on <code>serde</code> at all, though a bunch of the other tools do (cargo, rustfmt, rustdoc, clippy, rust-analyzer)</p>



<a name="264912643"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/impl%20Serialize%20for%20Symbol/near/264912643" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/impl.20Serialize.20for.20Symbol.html#264912643">(Dec 14 2021 at 19:26)</a>:</h4>
<p>Hmm, I guess we could put the dependency behind a Cargo feature, but I guess Cargo would still always compile it with the flag enabled? And it might add too much complexity.</p>



<a name="264912653"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/impl%20Serialize%20for%20Symbol/near/264912653" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/impl.20Serialize.20for.20Symbol.html#264912653">(Dec 14 2021 at 19:26)</a>:</h4>
<p>This is one of the annoying things about rustdoc using tera...</p>



<a name="264914303"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/impl%20Serialize%20for%20Symbol/near/264914303" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/impl.20Serialize.20for.20Symbol.html#264914303">(Dec 14 2021 at 19:39)</a>:</h4>
<p>cargo features don't seem like the right fit, rustc is used as a dynamic library which can only have one combination of feature flags enabled</p>



<a name="264914399"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/impl%20Serialize%20for%20Symbol/near/264914399" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/impl.20Serialize.20for.20Symbol.html#264914399">(Dec 14 2021 at 19:40)</a>:</h4>
<p>personally I think we should reconsider Tera ... it doesn't seem to be working out very well (in particular it's been hurting performance)</p>



<a name="264914408"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/impl%20Serialize%20for%20Symbol/near/264914408" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/impl.20Serialize.20for.20Symbol.html#264914408">(Dec 14 2021 at 19:40)</a>:</h4>
<p>cc <span class="user-mention" data-user-id="315412">@jsha</span></p>



<a name="264915757"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/impl%20Serialize%20for%20Symbol/near/264915757" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/impl.20Serialize.20for.20Symbol.html#264915757">(Dec 14 2021 at 19:52)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/impl.20Serialize.20for.20Symbol/near/264914303">said</a>:</p>
<blockquote>
<p>cargo features don't seem like the right fit, rustc is used as a dynamic library which can only have one combination of feature flags enabled</p>
</blockquote>
<p>Hmm, why <em>does</em> rustdoc load rustc as a dylib from the sysroot? Wouldn't it be faster if we used static linking?</p>



<a name="264915787"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/impl%20Serialize%20for%20Symbol/near/264915787" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/impl.20Serialize.20for.20Symbol.html#264915787">(Dec 14 2021 at 19:52)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/impl.20Serialize.20for.20Symbol/near/264914399">said</a>:</p>
<blockquote>
<p>personally I think we should reconsider Tera ... it doesn't seem to be working out very well (in particular it's been hurting performance)</p>
</blockquote>
<p>I agree. Let's move this part of the discussion to <a class="stream" data-stream-id="266220" href="/#narrow/stream/266220-rustdoc">#rustdoc</a>.</p>



<a name="264916084"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/impl%20Serialize%20for%20Symbol/near/264916084" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/impl.20Serialize.20for.20Symbol.html#264916084">(Dec 14 2021 at 19:55)</a>:</h4>
<p><span class="user-mention silent" data-user-id="307537">Noah Lev</span> <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/impl.20Serialize.20for.20Symbol/near/264915757">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/impl.20Serialize.20for.20Symbol/near/264914303">said</a>:</p>
<blockquote>
<p>cargo features don't seem like the right fit, rustc is used as a dynamic library which can only have one combination of feature flags enabled</p>
</blockquote>
<p>Hmm, why <em>does</em> rustdoc load rustc as a dylib from the sysroot? Wouldn't it be faster if we used static linking?</p>
</blockquote>
<p>it uses a lot more binary size, and it means that <code>download-rustc</code> stops working</p>



<a name="264916114"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/impl%20Serialize%20for%20Symbol/near/264916114" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/impl.20Serialize.20for.20Symbol.html#264916114">(Dec 14 2021 at 19:55)</a>:</h4>
<p>also it would make rustdoc inconsistent with external tools</p>



<a name="264916424"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/impl%20Serialize%20for%20Symbol/near/264916424" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/impl.20Serialize.20for.20Symbol.html#264916424">(Dec 14 2021 at 19:57)</a>:</h4>
<p>Ah, I see. Oh well :)</p>



<a name="264916504"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/impl%20Serialize%20for%20Symbol/near/264916504" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/impl.20Serialize.20for.20Symbol.html#264916504">(Dec 14 2021 at 19:58)</a>:</h4>
<p>Hmm, actually why would it break download-rustc? Couldn't download-rustc just download an rlib?</p>



<a name="264916640"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/impl%20Serialize%20for%20Symbol/near/264916640" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/impl.20Serialize.20for.20Symbol.html#264916640">(Dec 14 2021 at 19:59)</a>:</h4>
<p>It will need to download all rustc rlibs then for a total of like 100MB.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>