<html>
<head><meta charset="utf-8"><title>✔ How does rustc specify the entry point on each platform? · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20How.20does.20rustc.20specify.20the.20entry.20point.20on.20each.20platform.3F.html">✔ How does rustc specify the entry point on each platform?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="272835037"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20How%20does%20rustc%20specify%20the%20entry%20point%20on%20each%20platform%3F/near/272835037" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nasso <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20How.20does.20rustc.20specify.20the.20entry.20point.20on.20each.20platform.3F.html#272835037">(Feb 22 2022 at 17:11)</a>:</h4>
<p>I'm implementing my own programming language as a toy project using LLVM to get familiar with it. I can produce object files <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span>!<br>
But now I'd like to produce executable binaries, and I realised LLVM does not know anything about "entry points" (which makes sense to me). My first "hack" (not really?) was to write a small "runtime" in assembly that I link with my object files, and it works! However I don't think that's how real-world compilers/linkers like <code>rustc</code> do things.</p>
<p>Where and how does <code>rustc</code> add the entry point of the program being compiled (e.g. <code>_start</code> on Linux) before calling the linker?</p>



<a name="272835352"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20How%20does%20rustc%20specify%20the%20entry%20point%20on%20each%20platform%3F/near/272835352" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20How.20does.20rustc.20specify.20the.20entry.20point.20on.20each.20platform.3F.html#272835352">(Feb 22 2022 at 17:13)</a>:</h4>
<p>that's <code>cc</code>'s job AFAIK, and <code>rustc</code> will emit a C-typical unmangled <code>main</code> that leads to <code>std::rt</code> startup code</p>



<a name="272835635"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20How%20does%20rustc%20specify%20the%20entry%20point%20on%20each%20platform%3F/near/272835635" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nasso <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20How.20does.20rustc.20specify.20the.20entry.20point.20on.20each.20platform.3F.html#272835635">(Feb 22 2022 at 17:15)</a>:</h4>
<p>ah so <code>rustc</code> actually calls <code>cc</code> and not just <code>ld</code>?</p>



<a name="272835870"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20How%20does%20rustc%20specify%20the%20entry%20point%20on%20each%20platform%3F/near/272835870" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20How.20does.20rustc.20specify.20the.20entry.20point.20on.20each.20platform.3F.html#272835870">(Feb 22 2022 at 17:16)</a>:</h4>
<p>normally, yes. you can also use <code>lld</code> directly, and maybe others, but then I think <code>rustc</code> adds normal <code>crt*.o</code> objects itself to get <code>_start</code> etc.</p>



<a name="272836516"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20How%20does%20rustc%20specify%20the%20entry%20point%20on%20each%20platform%3F/near/272836516" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nasso <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20How.20does.20rustc.20specify.20the.20entry.20point.20on.20each.20platform.3F.html#272836516">(Feb 22 2022 at 17:20)</a>:</h4>
<p>am i correct in assuming the resulting binary then depends on <code>libc</code> (or anything extra <code>cc</code> might specify to the linker)?</p>



<a name="272836815"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20How%20does%20rustc%20specify%20the%20entry%20point%20on%20each%20platform%3F/near/272836815" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20How.20does.20rustc.20specify.20the.20entry.20point.20on.20each.20platform.3F.html#272836815">(Feb 22 2022 at 17:22)</a>:</h4>
<p>yes. often <code>libgcc_s</code> too</p>



<a name="272836838"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20How%20does%20rustc%20specify%20the%20entry%20point%20on%20each%20platform%3F/near/272836838" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20How.20does.20rustc.20specify.20the.20entry.20point.20on.20each.20platform.3F.html#272836838">(Feb 22 2022 at 17:22)</a>:</h4>
<p>unless you use a target like <code>linux-musl</code> that links those statically</p>



<a name="272836931"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20How%20does%20rustc%20specify%20the%20entry%20point%20on%20each%20platform%3F/near/272836931" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nasso <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20How.20does.20rustc.20specify.20the.20entry.20point.20on.20each.20platform.3F.html#272836931">(Feb 22 2022 at 17:23)</a>:</h4>
<p>that explains so much! i suppose this is why we have both msvc and gnu "runtimes" on windows?</p>



<a name="272837038"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20How%20does%20rustc%20specify%20the%20entry%20point%20on%20each%20platform%3F/near/272837038" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nasso <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20How.20does.20rustc.20specify.20the.20entry.20point.20on.20each.20platform.3F.html#272837038">(Feb 22 2022 at 17:23)</a>:</h4>
<p>depending on whether we're linking with <code>cl.exe</code> or <code>gcc.exe</code></p>



<a name="272837151"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20How%20does%20rustc%20specify%20the%20entry%20point%20on%20each%20platform%3F/near/272837151" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20How.20does.20rustc.20specify.20the.20entry.20point.20on.20each.20platform.3F.html#272837151">(Feb 22 2022 at 17:24)</a>:</h4>
<p>yeah, and it's not just startup code, but also a lot of support code uses system C APIs too, for threading and such</p>



<a name="272837232"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20How%20does%20rustc%20specify%20the%20entry%20point%20on%20each%20platform%3F/near/272837232" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nasso <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20How.20does.20rustc.20specify.20the.20entry.20point.20on.20each.20platform.3F.html#272837232">(Feb 22 2022 at 17:25)</a>:</h4>
<p>does that mean i have to have a C compiler available when i call <code>rustc</code>?</p>



<a name="272837326"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20How%20does%20rustc%20specify%20the%20entry%20point%20on%20each%20platform%3F/near/272837326" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20How.20does.20rustc.20specify.20the.20entry.20point.20on.20each.20platform.3F.html#272837326">(Feb 22 2022 at 17:25)</a>:</h4>
<p>well, at least enough to link C code, but that's not usually separable</p>



<a name="272837494"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20How%20does%20rustc%20specify%20the%20entry%20point%20on%20each%20platform%3F/near/272837494" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nasso <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20How.20does.20rustc.20specify.20the.20entry.20point.20on.20each.20platform.3F.html#272837494">(Feb 22 2022 at 17:26)</a>:</h4>
<p>thank you so much, everything's clear now :)<br>
ill try to do the same thing!<br>
have a nice rest of your day!</p>



<a name="272837511"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20How%20does%20rustc%20specify%20the%20entry%20point%20on%20each%20platform%3F/near/272837511" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20How.20does.20rustc.20specify.20the.20entry.20point.20on.20each.20platform.3F.html#272837511">(Feb 22 2022 at 17:27)</a>:</h4>
<p><span class="user-mention silent" data-user-id="478591">nasso</span> has marked this topic as resolved.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>