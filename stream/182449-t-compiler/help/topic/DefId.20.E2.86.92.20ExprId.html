<html>
<head><meta charset="utf-8"><title>DefId → ExprId · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/DefId.20.E2.86.92.20ExprId.html">DefId → ExprId</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="277207394"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/DefId%20%E2%86%92%20ExprId/near/277207394" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/DefId.20.E2.86.92.20ExprId.html#277207394">(Mar 30 2022 at 21:38)</a>:</h4>
<p>If I have a <code>rustc_span::def_id::DefId</code>, how can I obtain a <code>rustc_middle::thir::ExprId</code>? I am obtaining the <code>DefId</code> from a lang item. I'm trying to construct an <code>ExprKind::Call</code>, where the method being called is the lang item.</p>



<a name="277207618"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/DefId%20%E2%86%92%20ExprId/near/277207618" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/DefId.20.E2.86.92.20ExprId.html#277207618">(Mar 30 2022 at 21:41)</a>:</h4>
<p>I see <code>thir::Cx::mirror_expr</code> which goes from a <code>hir::Expr</code> to an <code>ExprId</code></p>



<a name="277207628"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/DefId%20%E2%86%92%20ExprId/near/277207628" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/DefId.20.E2.86.92.20ExprId.html#277207628">(Mar 30 2022 at 21:41)</a>:</h4>
<p><a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_mir_build/thir/cx/struct.Cx.html#method.mirror_expr">https://doc.rust-lang.org/nightly/nightly-rustc/rustc_mir_build/thir/cx/struct.Cx.html#method.mirror_expr</a></p>



<a name="277207686"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/DefId%20%E2%86%92%20ExprId/near/277207686" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/DefId.20.E2.86.92.20ExprId.html#277207686">(Mar 30 2022 at 21:42)</a>:</h4>
<p>don't know if there's a way to synthesize a <code>hir::Expr</code> from whole cloth that late in compilation</p>



<a name="277207735"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/DefId%20%E2%86%92%20ExprId/near/277207735" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Goulet (compiler-errors) <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/DefId.20.E2.86.92.20ExprId.html#277207735">(Mar 30 2022 at 21:43)</a>:</h4>
<p><span class="user-mention silent" data-user-id="245610">Jacob Pratt</span> <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/DefId.20.E2.86.92.20ExprId/near/277207394">said</a>:</p>
<blockquote>
<p>If I have a <code>rustc_span::def_id::DefId</code>, how can I obtain a <code>rustc_middle::thir::ExprId</code>? I am obtaining the <code>DefId</code> from a lang item. I'm trying to construct an <code>ExprKind::Call</code>, where the method being called is the lang item.</p>
</blockquote>
<p>Where are you in the compiler, specifically?</p>



<a name="277207740"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/DefId%20%E2%86%92%20ExprId/near/277207740" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/DefId.20.E2.86.92.20ExprId.html#277207740">(Mar 30 2022 at 21:43)</a>:</h4>
<p>Yeah, ultimately this is in the "adjustment" part of <code>rustc_mir_build</code>. I've no idea what's possible there.</p>



<a name="277207752"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/DefId%20%E2%86%92%20ExprId/near/277207752" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Goulet (compiler-errors) <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/DefId.20.E2.86.92.20ExprId.html#277207752">(Mar 30 2022 at 21:43)</a>:</h4>
<p>ah you answered my question as soon as I sent it, hehe</p>



<a name="277207755"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/DefId%20%E2%86%92%20ExprId/near/277207755" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/DefId.20.E2.86.92.20ExprId.html#277207755">(Mar 30 2022 at 21:43)</a>:</h4>
<p><code>rustc_mir_build/src/thir/cx/expr.rs</code> is the file I'm in.</p>



<a name="277207818"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/DefId%20%E2%86%92%20ExprId/near/277207818" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Goulet (compiler-errors) <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/DefId.20.E2.86.92.20ExprId.html#277207818">(Mar 30 2022 at 21:44)</a>:</h4>
<p>Oh you're in thir? I think you can just build a call expr</p>



<a name="277207848"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/DefId%20%E2%86%92%20ExprId/near/277207848" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/DefId.20.E2.86.92.20ExprId.html#277207848">(Mar 30 2022 at 21:44)</a>:</h4>
<p>That's what I'm trying to do, actually. It's the <code>fun</code> field that I can't get.</p>



<a name="277207866"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/DefId%20%E2%86%92%20ExprId/near/277207866" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/DefId.20.E2.86.92.20ExprId.html#277207866">(Mar 30 2022 at 21:44)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">ExprKind</span>::<span class="n">Call</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">ty</span>: <span class="nc">self</span><span class="p">.</span><span class="n">tcx</span><span class="p">.</span><span class="n">type_of</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="n">tcx</span><span class="p">.</span><span class="n">require_lang_item</span><span class="p">(</span><span class="n">hir</span>::<span class="n">LangItem</span>::<span class="n">NonZeroU8New</span><span class="p">,</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="o">*</span><span class="n">span</span><span class="p">)),</span><span class="w"></span>
<span class="w">    </span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="n">fun</span>: <span class="nc">todo</span><span class="o">!</span><span class="p">(),</span><span class="w"></span>
<span class="w">    </span><span class="n">args</span>: <span class="nb">Box</span>::<span class="n">new</span><span class="p">([</span><span class="bp">self</span><span class="p">.</span><span class="n">thir</span><span class="p">.</span><span class="n">exprs</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">expr</span><span class="p">)]),</span><span class="w"></span>
<span class="w">    </span><span class="n">from_hir_call</span>: <span class="nc">false</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">fn_span</span>: <span class="o">*</span><span class="n">span</span><span class="p">,</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="277207893"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/DefId%20%E2%86%92%20ExprId/near/277207893" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/DefId.20.E2.86.92.20ExprId.html#277207893">(Mar 30 2022 at 21:45)</a>:</h4>
<p>(ignore the <code>ty</code> — I know it'll need to change eventually)</p>



<a name="277207999"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/DefId%20%E2%86%92%20ExprId/near/277207999" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Goulet (compiler-errors) <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/DefId.20.E2.86.92.20ExprId.html#277207999">(Mar 30 2022 at 21:46)</a>:</h4>
<p>I think that's the type of the thing you're calling? I think you need to construct that too..</p>



<a name="277208031"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/DefId%20%E2%86%92%20ExprId/near/277208031" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/DefId.20.E2.86.92.20ExprId.html#277208031">(Mar 30 2022 at 21:46)</a>:</h4>
<p><code>fun</code> is <code>ExprId</code></p>



<a name="277208086"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/DefId%20%E2%86%92%20ExprId/near/277208086" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/DefId.20.E2.86.92.20ExprId.html#277208086">(Mar 30 2022 at 21:47)</a>:</h4>
<p><a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/thir/enum.ExprKind.html#variant.VarRef">https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/thir/enum.ExprKind.html#variant.VarRef</a> maybe</p>



<a name="277208385"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/DefId%20%E2%86%92%20ExprId/near/277208385" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Goulet (compiler-errors) <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/DefId.20.E2.86.92.20ExprId.html#277208385">(Mar 30 2022 at 21:50)</a>:</h4>
<p>I think you need to do something like what <a href="https://doc.rust-lang.org/stable/nightly-rustc/rustc_mir_build/thir/cx/struct.Cx.html#method.method_callee"><code>method_callee</code></a> is doing</p>



<a name="277208404"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/DefId%20%E2%86%92%20ExprId/near/277208404" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Goulet (compiler-errors) <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/DefId.20.E2.86.92.20ExprId.html#277208404">(Mar 30 2022 at 21:51)</a>:</h4>
<p>that is, turn the DefId into a callable expression</p>



<a name="277208446"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/DefId%20%E2%86%92%20ExprId/near/277208446" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Goulet (compiler-errors) <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/DefId.20.E2.86.92.20ExprId.html#277208446">(Mar 30 2022 at 21:51)</a>:</h4>
<p>specifically the overloaded_callee = Some branch</p>



<a name="277208522"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/DefId%20%E2%86%92%20ExprId/near/277208522" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Goulet (compiler-errors) <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/DefId.20.E2.86.92.20ExprId.html#277208522">(Mar 30 2022 at 21:52)</a>:</h4>
<p>then take that ExprKind::Literal (well, the expr that you build from it) and pass it into the <code>fun</code> field of the call.</p>



<a name="277208859"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/DefId%20%E2%86%92%20ExprId/near/277208859" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/DefId.20.E2.86.92.20ExprId.html#277208859">(Mar 30 2022 at 21:56)</a>:</h4>
<p>I'll take a look into that. Not entirely sure what I'm doing, but we'll see <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>