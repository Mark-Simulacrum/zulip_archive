<html>
<head><meta charset="utf-8"><title>Difficulties adding a custom stdlib target · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Difficulties.20adding.20a.20custom.20stdlib.20target.html">Difficulties adding a custom stdlib target</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="274985121"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Difficulties%20adding%20a%20custom%20stdlib%20target/near/274985121" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pjht <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Difficulties.20adding.20a.20custom.20stdlib.20target.html#274985121">(Mar 11 2022 at 14:52)</a>:</h4>
<p>I'm trying to add a custom stdlib target for a kernel i'm writing to a private fork of rust, and I've got it building both the compiler and the stdlib, but the custom compiler complains that it can't find the crate for std, even though it's built and in the lib directory. This is the code, if it helps: <a href="https://github.com/pjht/rust">https://github.com/pjht/rust</a></p>



<a name="275008371"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Difficulties%20adding%20a%20custom%20stdlib%20target/near/275008371" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Difficulties.20adding.20a.20custom.20stdlib.20target.html#275008371">(Mar 11 2022 at 17:47)</a>:</h4>
<p>What <code>config.toml</code> and <code>x.py</code> command did you use?</p>



<a name="275008706"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Difficulties%20adding%20a%20custom%20stdlib%20target/near/275008706" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pjht <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Difficulties.20adding.20a.20custom.20stdlib.20target.html#275008706">(Mar 11 2022 at 17:49)</a>:</h4>
<p>./x.py build -i library/std, and this is the only line I set in config.toml: target = ["x86_64-unknown-mikros"]</p>



<a name="275009554"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Difficulties%20adding%20a%20custom%20stdlib%20target/near/275009554" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Difficulties.20adding.20a.20custom.20stdlib.20target.html#275009554">(Mar 11 2022 at 17:56)</a>:</h4>
<p>The target list needs to include the host triple to be able to compile build scripts and proc macros.</p>



<a name="275010004"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Difficulties%20adding%20a%20custom%20stdlib%20target/near/275010004" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pjht <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Difficulties.20adding.20a.20custom.20stdlib.20target.html#275010004">(Mar 11 2022 at 17:59)</a>:</h4>
<p>Ah, that would explain an error that I was getting about can't build proc macros for crate chalk-drive. I'm building it now, i'll see if that fixed it.</p>



<a name="275010477"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Difficulties%20adding%20a%20custom%20stdlib%20target/near/275010477" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pjht <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Difficulties.20adding.20a.20custom.20stdlib.20target.html#275010477">(Mar 11 2022 at 18:02)</a>:</h4>
<p>Yup, that fixed it. Now I can do the full build too. I <em>thought</em> that note didn't apply to me, as I wasn't using it to compile for that target. but looks like I was wrong. <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span>  Thanks!</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>