<html>
<head><meta charset="utf-8"><title>download-ci-llvm is broken again · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/download-ci-llvm.20is.20broken.20again.html">download-ci-llvm is broken again</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="221354821"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/download-ci-llvm%20is%20broken%20again/near/221354821" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/download-ci-llvm.20is.20broken.20again.html#221354821">(Jan 01 2021 at 14:56)</a>:</h4>
<div class="codehilite"><pre><span></span><code>$ x.py check
curl: (22) The requested URL returned error: 404
failed to run: curl -# -y 30 -Y 10 --connect-timeout 30 --retry 3 -Sf -o /tmp/tmp6ptXJV https://ci-artifacts.rust-lang.org/rustc-builds/99ad5a1a2824fea1ecf60068fd3636beae7ea2da/rust-dev-nightly-x86_64-unknown-linux-gnu.tar.gz
</code></pre></div>



<a name="221354835"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/download-ci-llvm%20is%20broken%20again/near/221354835" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/download-ci-llvm.20is.20broken.20again.html#221354835">(Jan 01 2021 at 14:57)</a>:</h4>
<p>this is related to the version of bootstrap somehow, on <a href="https://github.com/rust-lang/rust/commit/18d27b2c94cff9a5f6d8e4d2ea45f6f2e434e5f6">18d27b2c94cff9a5f6d8e4d2ea45f6f2e434e5f6</a> it's broken but on <a href="https://github.com/rust-lang/rust/commit/e2267046859c9ceb932abc983561d53a117089f6">e2267046859c9ceb932abc983561d53a117089f6</a> it works</p>



<a name="221354843"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/download-ci-llvm%20is%20broken%20again/near/221354843" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/download-ci-llvm.20is.20broken.20again.html#221354843">(Jan 01 2021 at 14:57)</a>:</h4>
<p>the most annoying thing is I don't even need LLVM, I'm just running x.py check but it tries to download it anyway</p>



<a name="221355489"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/download-ci-llvm%20is%20broken%20again/near/221355489" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/download-ci-llvm.20is.20broken.20again.html#221355489">(Jan 01 2021 at 15:15)</a>:</h4>
<p>Hm not sure</p>



<a name="221355495"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/download-ci-llvm%20is%20broken%20again/near/221355495" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/download-ci-llvm.20is.20broken.20again.html#221355495">(Jan 01 2021 at 15:15)</a>:</h4>
<p>Oh</p>



<a name="221355497"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/download-ci-llvm%20is%20broken%20again/near/221355497" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/download-ci-llvm.20is.20broken.20again.html#221355497">(Jan 01 2021 at 15:15)</a>:</h4>
<p>We removed gzip from ci artifacts</p>



<a name="221355499"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/download-ci-llvm%20is%20broken%20again/near/221355499" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/download-ci-llvm.20is.20broken.20again.html#221355499">(Jan 01 2021 at 15:15)</a>:</h4>
<p>We'll need to switch to gz</p>



<a name="221355500"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/download-ci-llvm%20is%20broken%20again/near/221355500" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/download-ci-llvm.20is.20broken.20again.html#221355500">(Jan 01 2021 at 15:15)</a>:</h4>
<p>Er, xz</p>



<a name="221355502"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/download-ci-llvm%20is%20broken%20again/near/221355502" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/download-ci-llvm.20is.20broken.20again.html#221355502">(Jan 01 2021 at 15:16)</a>:</h4>
<p>that would do it <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="221355541"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/download-ci-llvm%20is%20broken%20again/near/221355541" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/download-ci-llvm.20is.20broken.20again.html#221355541">(Jan 01 2021 at 15:16)</a>:</h4>
<p>I can make a PR for that if you like?</p>



<a name="221355566"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/download-ci-llvm%20is%20broken%20again/near/221355566" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/download-ci-llvm.20is.20broken.20again.html#221355566">(Jan 01 2021 at 15:17)</a>:</h4>
<p>hmm actually it does default to xz, I guess the issue is my python install doesn't support it?</p>



<a name="221355580"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/download-ci-llvm%20is%20broken%20again/near/221355580" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/download-ci-llvm.20is.20broken.20again.html#221355580">(Jan 01 2021 at 15:18)</a>:</h4>
<p>I can change it to give a more friendly error at least</p>



<a name="221355721"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/download-ci-llvm%20is%20broken%20again/near/221355721" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/download-ci-llvm.20is.20broken.20again.html#221355721">(Jan 01 2021 at 15:21)</a>:</h4>
<p>this is a good reason to use python3 in the hashbang though ;)</p>



<a name="221355846"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/download-ci-llvm%20is%20broken%20again/near/221355846" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/download-ci-llvm.20is.20broken.20again.html#221355846">(Jan 01 2021 at 15:24)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/pull/80581">https://github.com/rust-lang/rust/pull/80581</a></p>



<a name="221358190"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/download-ci-llvm%20is%20broken%20again/near/221358190" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/download-ci-llvm.20is.20broken.20again.html#221358190">(Jan 01 2021 at 16:29)</a>:</h4>
<p>I wonder if x.py could detect it's running 2.7 and try to start itself under python3 automatically, maybe via that shell script "hack" you mentioned somewhere</p>



<a name="221358727"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/download-ci-llvm%20is%20broken%20again/near/221358727" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/download-ci-llvm.20is.20broken.20again.html#221358727">(Jan 01 2021 at 16:43)</a>:</h4>
<p>well, we still have the issue that python3 isn't always available on windows :/</p>



<a name="221358772"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/download-ci-llvm%20is%20broken%20again/near/221358772" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/download-ci-llvm.20is.20broken.20again.html#221358772">(Jan 01 2021 at 16:44)</a>:</h4>
<p>but we could use the shell script hack to try python3 and fall back to other names maybe</p>



<a name="221358774"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/download-ci-llvm%20is%20broken%20again/near/221358774" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/download-ci-llvm.20is.20broken.20again.html#221358774">(Jan 01 2021 at 16:44)</a>:</h4>
<p>well, I think on windows mostly we'll see python already being version 3</p>



<a name="221358778"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/download-ci-llvm%20is%20broken%20again/near/221358778" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/download-ci-llvm.20is.20broken.20again.html#221358778">(Jan 01 2021 at 16:44)</a>:</h4>
<p>whereas on linux python is often python2.7</p>



<a name="221358804"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/download-ci-llvm%20is%20broken%20again/near/221358804" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/download-ci-llvm.20is.20broken.20again.html#221358804">(Jan 01 2021 at 16:45)</a>:</h4>
<p>this is the hack btw: <a href="#narrow/stream/233931-t-compiler.2Fmajor-changes/topic/Make.20it.20easier.20to.20build.20the.20standard.20libr.E2.80.A6.20compiler-team.23394/near/221154191">https://rust-lang.zulipchat.com/#narrow/stream/233931-t-compiler.2Fmajor-changes/topic/Make.20it.20easier.20to.20build.20the.20standard.20libr.E2.80.A6.20compiler-team.23394/near/221154191</a></p>



<a name="221358877"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/download-ci-llvm%20is%20broken%20again/near/221358877" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/download-ci-llvm.20is.20broken.20again.html#221358877">(Jan 01 2021 at 16:47)</a>:</h4>
<p>so maybe something like this:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code><span class="c1"># The beginning of this script is both valid shell and valid python,</span>
<span class="c1"># such that the script starts with the shell and is reexecuted with</span>
<span class="c1"># the right python.</span>
<span class="s1">''':'</span> <span class="o">&amp;&amp;</span> <span class="k">if</span> which python3 &gt;/dev/null <span class="p">;</span> <span class="k">then</span> <span class="nb">exec</span> python3 <span class="s2">"</span><span class="nv">$0</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span> <span class="p">;</span> <span class="k">elif</span> which python &gt; /dev/null<span class="p">;</span> <span class="k">then</span> <span class="nb">exec</span> python <span class="s2">"</span><span class="nv">$0</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span><span class="p">;</span> <span class="k">else</span> <span class="nb">exec</span> python2 <span class="s2">"</span><span class="nv">$0</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span> <span class="p">;</span> <span class="k">fi</span>
<span class="s1">''</span><span class="err">'</span>
</code></pre></div>



<a name="221359000"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/download-ci-llvm%20is%20broken%20again/near/221359000" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/download-ci-llvm.20is.20broken.20again.html#221359000">(Jan 01 2021 at 16:50)</a>:</h4>
<p>omg it works</p>
<div class="codehilite"><pre><span></span><code>./x.py  -h
sys.version_info(major=3, minor=7, micro=3, releaselevel=&#39;final&#39;, serial=0)
</code></pre></div>



<a name="221359005"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/download-ci-llvm%20is%20broken%20again/near/221359005" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/download-ci-llvm.20is.20broken.20again.html#221359005">(Jan 01 2021 at 16:50)</a>:</h4>
<p>I feel like a mad genius <span aria-label="joy" class="emoji emoji-1f602" role="img" title="joy">:joy:</span></p>



<a name="221359089"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/download-ci-llvm%20is%20broken%20again/near/221359089" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/download-ci-llvm.20is.20broken.20again.html#221359089">(Jan 01 2021 at 16:53)</a>:</h4>
<p>probably we should get someone on windows to test this, but since it's valid python I'd expect all the existing scripts to work</p>



<a name="221359285"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/download-ci-llvm%20is%20broken%20again/near/221359285" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/download-ci-llvm.20is.20broken.20again.html#221359285">(Jan 01 2021 at 16:59)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/pull/80585">https://github.com/rust-lang/rust/pull/80585</a></p>



<a name="221359288"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/download-ci-llvm%20is%20broken%20again/near/221359288" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/download-ci-llvm.20is.20broken.20again.html#221359288">(Jan 01 2021 at 16:59)</a>:</h4>
<p><span class="user-mention" data-user-id="133169">@matklad</span> I stole your mad genius image, I hope you don't mind <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="221440452"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/download-ci-llvm%20is%20broken%20again/near/221440452" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/download-ci-llvm.20is.20broken.20again.html#221440452">(Jan 03 2021 at 08:16)</a>:</h4>
<p><span class="user-mention" data-user-id="232545">@Joshua Nelson</span> dr. strangerust is originally from <a href="https://docs.google.com/presentation/d/1TjWba0CR9RHFm47rvW1nFUlmouaR55Xt235aHyLPf9U/htmlpresent">https://docs.google.com/presentation/d/1TjWba0CR9RHFm47rvW1nFUlmouaR55Xt235aHyLPf9U/htmlpresent</a></p>



<a name="221451962"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/download-ci-llvm%20is%20broken%20again/near/221451962" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/download-ci-llvm.20is.20broken.20again.html#221451962">(Jan 03 2021 at 13:54)</a>:</h4>
<blockquote>
<p>how I learned to stop worrying and love OpenGL</p>
</blockquote>
<p>NOPE NOPE NOPE I'M OUT</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>