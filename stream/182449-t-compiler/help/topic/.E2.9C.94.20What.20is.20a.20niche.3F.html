<html>
<head><meta charset="utf-8"><title>✔ What is a niche? · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/.E2.9C.94.20What.20is.20a.20niche.3F.html">✔ What is a niche?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://rust-lang.github.io/zulip_archive/style.css" rel="stylesheet"></head>

<a name="245474194"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20What%20is%20a%20niche%3F/near/245474194" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kjetil Kjeka <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/.E2.9C.94.20What.20is.20a.20niche.3F.html#245474194">(Jul 09 2021 at 17:42)</a>:</h4>
<p>Would anyone mind give me a quick explanation of what a "Niche" (In a Layout) is?</p>
<p><a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_target/abi/struct.Layout.html">https://doc.rust-lang.org/nightly/nightly-rustc/rustc_target/abi/struct.Layout.html</a><br>
<a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_target/abi/struct.Niche.html">https://doc.rust-lang.org/nightly/nightly-rustc/rustc_target/abi/struct.Niche.html</a></p>
<p>I'm completely new to rustc and trying to investigate how hard it would be to implement a new custom DST (<a href="https://internals.rust-lang.org/t/should-array-view-be-an-internal-type/14983/10">https://internals.rust-lang.org/t/should-array-view-be-an-internal-type/14983/10</a>)</p>



<a name="245474381"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20What%20is%20a%20niche%3F/near/245474381" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Léo Lanteri Thauvin <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/.E2.9C.94.20What.20is.20a.20niche.3F.html#245474381">(Jul 09 2021 at 17:44)</a>:</h4>
<p>There is a glossary entry in the dev-guide: <a href="https://rustc-dev-guide.rust-lang.org/appendix/glossary.html#niche">https://rustc-dev-guide.rust-lang.org/appendix/glossary.html#niche</a></p>



<a name="245474620"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20What%20is%20a%20niche%3F/near/245474620" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Léo Lanteri Thauvin <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/.E2.9C.94.20What.20is.20a.20niche.3F.html#245474620">(Jul 09 2021 at 17:45)</a>:</h4>
<p>My understanding is that a niche is a set of invalid values that can be used for layout optimisation</p>



<a name="245474774"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20What%20is%20a%20niche%3F/near/245474774" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Léo Lanteri Thauvin <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/.E2.9C.94.20What.20is.20a.20niche.3F.html#245474774">(Jul 09 2021 at 17:46)</a>:</h4>
<p>E.g. a reference can never be <code>null</code>, so we can use the value <code>0</code> to mean other things</p>



<a name="245474977"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20What%20is%20a%20niche%3F/near/245474977" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kjetil Kjeka <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/.E2.9C.94.20What.20is.20a.20niche.3F.html#245474977">(Jul 09 2021 at 17:47)</a>:</h4>
<p>Thank you! Not only did I find a reference for what niche means, now I'm also aware of the glossary that will surely be very helpful going forward.</p>



<a name="245475362"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20What%20is%20a%20niche%3F/near/245475362" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Léo Lanteri Thauvin <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/.E2.9C.94.20What.20is.20a.20niche.3F.html#245475362">(Jul 09 2021 at 17:50)</a>:</h4>
<p>Here's an example/illustration:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="c1">// WARNING: this is UB</span>
<span class="fm">println!</span><span class="p">(</span><span class="s">"{:?}"</span><span class="p">,</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="k">unsafe</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span>::<span class="n">num</span>::<span class="n">NonZeroI32</span>::<span class="n">new_unchecked</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">}))</span><span class="w"></span>
</code></pre></div>
<p>prints <code>None</code> because the compiler knows that <code>NonZeroI32</code> can never hold the value <code>0</code>, so it can use the value <code>0</code> to represent <code>None</code></p>



<a name="245557985"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20What%20is%20a%20niche%3F/near/245557985" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/.E2.9C.94.20What.20is.20a.20niche.3F.html#245557985">(Jul 10 2021 at 15:53)</a>:</h4>
<p><span class="user-mention silent" data-user-id="425116">Kjetil Kjeka</span> has marked this topic as resolved.</p>



<hr><p>Last updated: Aug 07 2021 at 22:04 UTC</p>
</html>