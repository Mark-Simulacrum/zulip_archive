<html>
<head><meta charset="utf-8"><title>Perf run for #90440 · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Perf.20run.20for.20.2390440.html">Perf run for #90440</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="259794478"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Perf%20run%20for%20%2390440/near/259794478" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hans Kratz <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Perf.20run.20for.20.2390440.html#259794478">(Oct 31 2021 at 15:58)</a>:</h4>
<p>Can I get a perf run for my experimental draft PR?</p>



<a name="259794671"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Perf%20run%20for%20%2390440/near/259794671" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Perf.20run.20for.20.2390440.html#259794671">(Oct 31 2021 at 16:01)</a>:</h4>
<p>See <a href="https://github.com/rust-lang/rust/issues/79043">#79043</a> for the last time this was tested. Do you want to retest or just missed that PR?</p>



<a name="259794947"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Perf%20run%20for%20%2390440/near/259794947" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hans Kratz <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Perf.20run.20for.20.2390440.html#259794947">(Oct 31 2021 at 16:06)</a>:</h4>
<p>Ahh, I didn't see that v3 was tested as well in this PR. It might make sense to retest now with LLVM 13 and the new pass manager.</p>



<a name="259794980"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Perf%20run%20for%20%2390440/near/259794980" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Perf.20run.20for.20.2390440.html#259794980">(Oct 31 2021 at 16:06)</a>:</h4>
<p>Also note that perf.rlo runs on intel processors that have the nasty habit of throttling momentarily when switching on AVX to ramp up power, even for "lightweight" AVX instructions (bit-twiddling, comparison, some integer stuff). So compiling with AVX enabled but intermittent SIMD usage might lead to the CPU transitioning in and out of those high power regimes which can increase latency.<br>
AMDs don't have that issue so might yield different results.</p>
<p>That said... i think some linux distro switched to v2 by default when building their C/C++ packages and it worked for them...</p>



<a name="259795190"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Perf%20run%20for%20%2390440/near/259795190" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Perf.20run.20for.20.2390440.html#259795190">(Oct 31 2021 at 16:10)</a>:</h4>
<p>Anyway, queued a perf run.</p>



<a name="259795582"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Perf%20run%20for%20%2390440/near/259795582" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Perf.20run.20for.20.2390440.html#259795582">(Oct 31 2021 at 16:19)</a>:</h4>
<p>Wait, I misunderstood that comment. It's intel on CI and amd on perf.rlo. Good.</p>



<a name="259795748"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Perf%20run%20for%20%2390440/near/259795748" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hans Kratz <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Perf.20run.20for.20.2390440.html#259795748">(Oct 31 2021 at 16:22)</a>:</h4>
<p>v2 is only SSE4.2 so they would not have run into any problems there. For AVX2 throttling it not so bad and for AVX512 it is only really bad if 512-bit vectors are used. That is why  <a href="https://reviews.llvm.org/D67259">LLVM autovectorizes to 256-bit vectors by default if compiled for AVX512</a>. There are extensive blog posts on this matter by Daniel Lemire and Travis Downs.</p>



<a name="259797910"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Perf%20run%20for%20%2390440/near/259797910" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hans Kratz <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Perf.20run.20for.20.2390440.html#259797910">(Oct 31 2021 at 17:09)</a>:</h4>
<p>Docker build is broken again. Looking into it.</p>



<a name="259953505"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Perf%20run%20for%20%2390440/near/259953505" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hans Kratz <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Perf.20run.20for.20.2390440.html#259953505">(Nov 02 2021 at 04:59)</a>:</h4>
<p>Fixed the docker problem (in <a href="https://github.com/rust-lang/rust/issues/90457">#90457</a>). <span class="user-mention" data-user-id="330154">@The 8472</span>  Can we try again?</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>