<html>
<head><meta charset="utf-8"><title>Running crater locally · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Running.20crater.20locally.html">Running crater locally</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="259886525"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Running%20crater%20locally/near/259886525" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Karl Meakin <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Running.20crater.20locally.html#259886525">(Nov 01 2021 at 16:33)</a>:</h4>
<p>I'm trying to run crater locally, but it eventually fails, complaining that it is out of disk space. I'm running on an AWS instance with 2TB of disk space, and as far as I could tell the max disk space consumed was 1.1TB. Am I doing something wrong? </p>
<p>This is my invocation:</p>
<div class="codehilite"><pre><span></span><code>cargo run --release -- define-ex  --ex experiment  --crate-select=full nightly nightly+rustflags=-Clink-args=-fuse-ld=lld
cargo run --release -- run-graph  --ex experiment --docker-env=crates-build-env-local:latest
</code></pre></div>



<a name="259887402"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Running%20crater%20locally/near/259887402" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Running.20crater.20locally.html#259887402">(Nov 01 2021 at 16:40)</a>:</h4>
<p>Can you provide a more detailed failure description? In particular, is crater itself complaining? Maybe your docker mount is on a smaller partition?</p>



<a name="259890502"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Running%20crater%20locally/near/259890502" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Karl Meakin <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Running.20crater.20locally.html#259890502">(Nov 01 2021 at 17:01)</a>:</h4>
<p>I don't have the exact message to hand, because I'm trying to rerun it with fewer threads atm. I recall that after a certain point, all attempts at building a new crate from github would fail: it would attempt to <code>git clone</code> the repo, git would return a <code>no space left on device</code> error, so crater would mark the crate as failed and move on to the next one, which would fail in the same way</p>



<a name="259890976"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Running%20crater%20locally/near/259890976" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Running.20crater.20locally.html#259890976">(Nov 01 2021 at 17:04)</a>:</h4>
<p>I don't recall similar problems with our production deployment (at least one runner there uses a 700 GB disk, iirc), so probably not much help without more debugging on your end unfortunately.</p>



<a name="259891049"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Running%20crater%20locally/near/259891049" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Running.20crater.20locally.html#259891049">(Nov 01 2021 at 17:05)</a>:</h4>
<p>you can look at our ansible configs here <a href="https://github.com/rust-lang/simpleinfra/blob/master/ansible/">https://github.com/rust-lang/simpleinfra/blob/master/ansible/</a> for how we set up crater agents</p>



<a name="259902671"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Running%20crater%20locally/near/259902671" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Running.20crater.20locally.html#259902671">(Nov 01 2021 at 18:37)</a>:</h4>
<p>Which filesystem? Small btrfs partitions can have issues with too much metadata that would manifest as enospc even though there's still space left on the device. Other filesystems can run out of inodes. Some of the docker storage drivers might have their own limitations.</p>



<a name="260031586"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Running%20crater%20locally/near/260031586" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Karl Meakin <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Running.20crater.20locally.html#260031586">(Nov 02 2021 at 17:39)</a>:</h4>
<p><span class="user-mention silent" data-user-id="330154">The 8472</span> <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/Running.20crater.20locally/near/259902671">said</a>:</p>
<blockquote>
<p>Which filesystem? Small btrfs partitions can have issues with too much metadata that would manifest as enospc even though there's still space left on the device. Other filesystems can run out of inodes. Some of the docker storage drivers might have their own limitations.</p>
</blockquote>
<p>It's running on ext4. I will investigate inodes or docker limitations</p>



<a name="260033394"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Running%20crater%20locally/near/260033394" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Karl Meakin <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Running.20crater.20locally.html#260033394">(Nov 02 2021 at 17:53)</a>:</h4>
<p><code>df -i</code> says only 2% of inodes have been used up, so its probably not that</p>



<a name="260033413"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Running%20crater%20locally/near/260033413" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Running.20crater.20locally.html#260033413">(Nov 02 2021 at 17:53)</a>:</h4>
<p>If you created that ext4 partition on a system with a kernel older than 4.13 it might be lacking the large_dir feature.<br>
<a href="https://github.com/torvalds/linux/commit/e08ac99fa2a25626f573cfa377ef3ddedf2cfe8f">https://github.com/torvalds/linux/commit/e08ac99fa2a25626f573cfa377ef3ddedf2cfe8f</a></p>
<p>That can also manifest in ENOSPC</p>



<a name="260036806"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Running%20crater%20locally/near/260036806" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Karl Meakin <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Running.20crater.20locally.html#260036806">(Nov 02 2021 at 18:19)</a>:</h4>
<p>nope, im running <code>5.11.0-1020-aws</code></p>



<a name="260040582"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Running%20crater%20locally/near/260040582" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Running.20crater.20locally.html#260040582">(Nov 02 2021 at 18:49)</a>:</h4>
<p>idk then, tons of things can cause enospc. maybe run it under strace and see which syscall fails, that might provide a hint.</p>



<a name="260289039"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Running%20crater%20locally/near/260289039" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Karl Meakin <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Running.20crater.20locally.html#260289039">(Nov 04 2021 at 15:44)</a>:</h4>
<p>2nd crater run finished. This time I logged the disk space used every minute. The disk usage just climbs continuously, until it reaches 100%. Then crater crashes and cleans up after itself. Isn't crater supposed to clean up the cargo cache periodically?</p>



<a name="260290090"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Running%20crater%20locally/near/260290090" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Running.20crater.20locally.html#260290090">(Nov 04 2021 at 15:50)</a>:</h4>
<p>Yes, I think so. Maybe that detection code isn't working? IIRC, the limit is 80% or so.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>