<html>
<head><meta charset="utf-8"><title>cant compile older PR fetch · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/cant.20compile.20older.20PR.20fetch.html">cant compile older PR fetch</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="259858413"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/cant%20compile%20older%20PR%20fetch/near/259858413" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> BN <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/cant.20compile.20older.20PR.20fetch.html#259858413">(Nov 01 2021 at 12:38)</a>:</h4>
<p>I'm trying to continue working on an older PR (Jan. 21). I fetched that PR, rebased and then tried to compile, but the repo now doesn't have a cargo-util directory anymore?! I get the following error while trying to build:</p>
<div class="codehilite"><pre><span></span><code>Updating only changed submodules
Submodules updated in 0.06 seconds
downloading https://static.rust-lang.org/dist/2021-10-22/rust-std-beta-x86_64-apple-darwin.tar.xz
######################################################################## 100.0%
extracting /Users/bn/Documents/rust-local-fork/temp/build/cache/2021-10-22/rust-std-beta-x86_64-apple-darwin.tar.xz
downloading https://static.rust-lang.org/dist/2021-10-22/rustc-beta-x86_64-apple-darwin.tar.xz
######################################################################## 100.0%
extracting /Users/bn/Documents/rust-local-fork/temp/build/cache/2021-10-22/rustc-beta-x86_64-apple-darwin.tar.xz
downloading https://static.rust-lang.org/dist/2021-10-22/cargo-beta-x86_64-apple-darwin.tar.xz
######################################################################## 100.0%
extracting /Users/bn/Documents/rust-local-fork/temp/build/cache/2021-10-22/cargo-beta-x86_64-apple-darwin.tar.xz
downloading https://static.rust-lang.org/dist/2021-10-23/rustfmt-nightly-x86_64-apple-darwin.tar.xz
######################################################################## 100.0%
extracting /Users/bn/Documents/rust-local-fork/temp/build/cache/2021-10-23/rustfmt-nightly-x86_64-apple-darwin.tar.xz
error: failed to resolve patches for `https://github.com/rust-lang/cargo`

Caused by:
  failed to load source for dependency `cargo-util`

Caused by:
  Unable to update /Users/bn/Documents/rust-local-fork/temp/src/tools/cargo/crates/cargo-util

Caused by:
  failed to read `/Users/bn/Documents/rust-local-fork/temp/src/tools/cargo/crates/cargo-util/Cargo.toml`

Caused by:
  No such file or directory (os error 2)
failed to run: /Users/bn/Documents/rust-local-fork/temp/build/x86_64-apple-darwin/stage0/bin/cargo build --manifest-path /Users/bn/Documents/rust-local-fork/temp/src/bootstrap/Cargo.toml
Build completed unsuccessfully in 0:00:45
</code></pre></div>
<p>Does anybody know how to fix this?</p>



<a name="259859876"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/cant%20compile%20older%20PR%20fetch/near/259859876" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hans Kratz <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/cant.20compile.20older.20PR.20fetch.html#259859876">(Nov 01 2021 at 12:56)</a>:</h4>
<p>Does a manual <code>git submodule update</code> help?</p>



<a name="259860195"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/cant%20compile%20older%20PR%20fetch/near/259860195" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> BN <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/cant.20compile.20older.20PR.20fetch.html#259860195">(Nov 01 2021 at 12:59)</a>:</h4>
<p>No it doesnt, unfortunately</p>



<a name="259861123"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/cant%20compile%20older%20PR%20fetch/near/259861123" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hans Kratz <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/cant.20compile.20older.20PR.20fetch.html#259861123">(Nov 01 2021 at 13:08)</a>:</h4>
<p>Weird, did this PR touch submodules? What is the output of <code>git status; git submodule status; (cd src/tools/cargo; git status)</code> (in git bash)</p>



<a name="259861281"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/cant%20compile%20older%20PR%20fetch/near/259861281" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/cant.20compile.20older.20PR.20fetch.html#259861281">(Nov 01 2021 at 13:10)</a>:</h4>
<p>I'd recommend rebasing on latest master and a git submodule update --init</p>



<a name="259863357"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/cant%20compile%20older%20PR%20fetch/near/259863357" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> BN <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/cant.20compile.20older.20PR.20fetch.html#259863357">(Nov 01 2021 at 13:30)</a>:</h4>
<p><span class="user-mention silent" data-user-id="407656">Hans Kratz</span> <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/cant.20compile.20older.20PR.20fetch/near/259861123">said</a>:</p>
<blockquote>
<p>Weird, did this PR touch submodules? What is the output of <code>git status; git submodule status; (cd src/tools/cargo; git status)</code> (in git bash)</p>
</blockquote>
<p><code>git status</code> yields nothing to commit, <code>git submodule status</code> output is:</p>
<div class="codehilite"><pre><span></span><code> 9c732a56f67f54d12a0b4fd99993154906c95ea6 library/stdarch (0.0.3-872-g9c732a56)
 ac57a0ddd23d173b26731ccf939f3ba729753275 src/doc/book (one-book-to-rule-them-all-818-gac57a0dd)
 b91a9a881ee007c12e74e844460ec407cf07a50f src/doc/edition-guide (b91a9a8)
 ceec19e873be87c6ee5666b030c6bb612f889a96 src/doc/embedded-book (remotes/origin/patches/#98-204-gceec19e)
 a8584998eacdea7106a1dfafcbf6c1c06fcdf925 src/doc/nomicon (a858499)
 50af691f838937c300b47812d0507c6d88c14f97 src/doc/reference (remotes/origin/update-recursion_limit-461-g50af691)
 03e23af01f0b4f83a3a513da280e1ca92587f2ec src/doc/rust-by-example (03e23af)
 7adfab42bab045a848126895c2f1e09927c1331a src/doc/rustc-dev-guide (7adfab4)
 f9a8d70b6e0365ac2172ca6b7f1de0341297458d src/llvm-project  (rustc-1.51.0~4)
 783bc43c660bf39c1e562c8c429b32078ad3099b src/tools/cargo (0.43.0-1344-g783bc43c6)
 1cf1a2e40a6867948db84f806085a875fbefce3c src/tools/miri (1cf1a2e4)
 88a58d1f484af31d87b75e1d17655b59910f41fe src/tools/rls (1.31.6-732-g88a58d1)
 0d03fe6ef57d3956e92382e0e1f1a916015191cb src/tools/rust-analyzer (2020-09-07-58-g0d03fe6ef)
 5254dbfd25d5284728ab624dca1969d61427a0db src/tools/rust-installer (heads/master)
</code></pre></div>
<p><code>git status</code> output inside <code>src/tools/cargo</code> is: </p>
<div class="codehilite"><pre><span></span><code>HEAD detached at 783bc43c6
nothing to commit, working tree clean
</code></pre></div>
<p>which looks like it might be the root of this problem.</p>
<p>This is detached at the first rebase I did, which wasn't the current master, but close to current (maybe a week old). After I updated to the current master and ran <code>git submodule update --init</code> I also got:</p>
<div class="codehilite"><pre><span></span><code>git submodule update --init
Submodule path &#39;src/tools/cargo&#39;: checked out &#39;783bc43c660bf39c1e562c8c429b32078ad3099b&#39;
</code></pre></div>
<p>I guess the question is how do I re-attach HEAD of  <code>src/tools/cargo</code>?</p>



<a name="259865470"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/cant%20compile%20older%20PR%20fetch/near/259865470" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hans Kratz <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/cant.20compile.20older.20PR.20fetch.html#259865470">(Nov 01 2021 at 13:49)</a>:</h4>
<p>The HEAD being detached is normal for submodules, they are pinned to a specific revision and can only be updated with a main repo commit. It seems you have not rebased on the latest master. I suggest rebasing on the very latest master as Marc said.</p>



<a name="259865980"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/cant%20compile%20older%20PR%20fetch/near/259865980" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hans Kratz <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/cant.20compile.20older.20PR.20fetch.html#259865980">(Nov 01 2021 at 13:54)</a>:</h4>
<p>Afterwards you might need to run <code>git submodule update --init</code> again.</p>



<a name="259889394"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/cant%20compile%20older%20PR%20fetch/near/259889394" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> BN <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/cant.20compile.20older.20PR.20fetch.html#259889394">(Nov 01 2021 at 16:55)</a>:</h4>
<p>I must have messed something up during the previous rebase. I fetched the branch again and rebased it and now it works. Thanks for your help <span class="user-mention" data-user-id="407656">@Hans Kratz</span> and <span class="user-mention" data-user-id="116122">@simulacrum</span></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>