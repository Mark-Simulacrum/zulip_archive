<html>
<head><meta charset="utf-8"><title>✔ `#[feature(rustc_private)]` with local Rust build · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20.60.23.5Bfeature(rustc_private).5D.60.20with.20local.20Rust.20build.html">✔ `#[feature(rustc_private)]` with local Rust build</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="256307238"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20%60%23%5Bfeature%28rustc_private%29%5D%60%20with%20local%20Rust%20build/near/256307238" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20.60.23.5Bfeature(rustc_private).5D.60.20with.20local.20Rust.20build.html#256307238">(Oct 05 2021 at 19:47)</a>:</h4>
<p>I'm trying to use <code>rustc_*</code> crates with <code>#![feature(rustc_private)]</code> in a local project. If use the nightly toolchain and install the appropriate components that works. However, if I try to use a local build of rustc I have, I then get</p>
<div class="codehilite"><pre><span></span><code>error[E0463]: can&#39;t find crate for `rustc_ast`
 --&gt; src\lib.rs:3:1
  |
3 | extern crate rustc_ast;
  | ^^^^^^^^^^^^^^^^^^^^^^^ can&#39;t find crate
  |
  = help: maybe you need to install the missing components with: `rustup component add rust-src rustc-dev llvm-tools-preview`

For more information about this error, try `rustc --explain E0463`.
error: could not compile `foo` due to previous error
</code></pre></div>
<p>My local build is a stage 2 build compiled from <code>python x.py build --stage 2</code> so it should have all the appropriate libraries. What am I missing?</p>



<a name="256307414"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20%60%23%5Bfeature%28rustc_private%29%5D%60%20with%20local%20Rust%20build/near/256307414" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20.60.23.5Bfeature(rustc_private).5D.60.20with.20local.20Rust.20build.html#256307414">(Oct 05 2021 at 19:48)</a>:</h4>
<p>I suspect you've built everything but not assembled</p>



<a name="256307452"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20%60%23%5Bfeature%28rustc_private%29%5D%60%20with%20local%20Rust%20build/near/256307452" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20.60.23.5Bfeature(rustc_private).5D.60.20with.20local.20Rust.20build.html#256307452">(Oct 05 2021 at 19:49)</a>:</h4>
<p>you should be able to trigger that by attempting to run run-make-fulldeps or similar in stage 2</p>



<a name="256307464"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20%60%23%5Bfeature%28rustc_private%29%5D%60%20with%20local%20Rust%20build/near/256307464" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20.60.23.5Bfeature(rustc_private).5D.60.20with.20local.20Rust.20build.html#256307464">(Oct 05 2021 at 19:49)</a>:</h4>
<p>it's a bit of a pain point right now</p>



<a name="256307652"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20%60%23%5Bfeature%28rustc_private%29%5D%60%20with%20local%20Rust%20build/near/256307652" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20.60.23.5Bfeature(rustc_private).5D.60.20with.20local.20Rust.20build.html#256307652">(Oct 05 2021 at 19:50)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116122">simulacrum</span> <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/.60.23.5Bfeature.28rustc_private.29.5D.60.20with.20local.20Rust.20build/near/256307452">said</a>:</p>
<blockquote>
<p>you should be able to trigger that by attempting to run run-make-fulldeps or similar in stage 2</p>
</blockquote>
<p>I'm not sure I know what that is <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="256307693"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20%60%23%5Bfeature%28rustc_private%29%5D%60%20with%20local%20Rust%20build/near/256307693" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20.60.23.5Bfeature(rustc_private).5D.60.20with.20local.20Rust.20build.html#256307693">(Oct 05 2021 at 19:50)</a>:</h4>
<p>./x.py test --stage 2 src/test/run-make-fulldeps</p>



<a name="256307698"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20%60%23%5Bfeature%28rustc_private%29%5D%60%20with%20local%20Rust%20build/near/256307698" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20.60.23.5Bfeature(rustc_private).5D.60.20with.20local.20Rust.20build.html#256307698">(Oct 05 2021 at 19:50)</a>:</h4>
<p>I know we have a <code>run-make-fulldeps</code> test suite.</p>



<a name="256307784"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20%60%23%5Bfeature%28rustc_private%29%5D%60%20with%20local%20Rust%20build/near/256307784" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20.60.23.5Bfeature(rustc_private).5D.60.20with.20local.20Rust.20build.html#256307784">(Oct 05 2021 at 19:51)</a>:</h4>
<p>(running)</p>



<a name="256307808"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20%60%23%5Bfeature%28rustc_private%29%5D%60%20with%20local%20Rust%20build/near/256307808" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20.60.23.5Bfeature(rustc_private).5D.60.20with.20local.20Rust.20build.html#256307808">(Oct 05 2021 at 19:51)</a>:</h4>
<p>I presume you're trying to run ./build/$TRIPLE/stage2/bin/rustc?</p>



<a name="256307846"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20%60%23%5Bfeature%28rustc_private%29%5D%60%20with%20local%20Rust%20build/near/256307846" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20.60.23.5Bfeature(rustc_private).5D.60.20with.20local.20Rust.20build.html#256307846">(Oct 05 2021 at 19:51)</a>:</h4>
<p>I'm going through rustup with a linked toolchain but yeah, that's where it points to.</p>



<a name="256307867"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20%60%23%5Bfeature%28rustc_private%29%5D%60%20with%20local%20Rust%20build/near/256307867" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20.60.23.5Bfeature(rustc_private).5D.60.20with.20local.20Rust.20build.html#256307867">(Oct 05 2021 at 19:51)</a>:</h4>
<p>the libraries should be in /build/$TRIPLE/stage2/lib/rustlib/$TRIPLE/lib, I think</p>



<a name="256307885"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20%60%23%5Bfeature%28rustc_private%29%5D%60%20with%20local%20Rust%20build/near/256307885" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20.60.23.5Bfeature(rustc_private).5D.60.20with.20local.20Rust.20build.html#256307885">(Oct 05 2021 at 19:51)</a>:</h4>
<p>(what is in that directory for you?)</p>



<a name="256308022"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20%60%23%5Bfeature%28rustc_private%29%5D%60%20with%20local%20Rust%20build/near/256308022" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20.60.23.5Bfeature(rustc_private).5D.60.20with.20local.20Rust.20build.html#256308022">(Oct 05 2021 at 19:52)</a>:</h4>
<p>Seems like the appropriate things <a href="/user_uploads/4715/9n1yYWlnE8erPH5oTQ-P5S2Q/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/9n1yYWlnE8erPH5oTQ-P5S2Q/image.png" title="image.png"><img src="/user_uploads/4715/9n1yYWlnE8erPH5oTQ-P5S2Q/image.png"></a></div>



<a name="256308169"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20%60%23%5Bfeature%28rustc_private%29%5D%60%20with%20local%20Rust%20build/near/256308169" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20.60.23.5Bfeature(rustc_private).5D.60.20with.20local.20Rust.20build.html#256308169">(Oct 05 2021 at 19:53)</a>:</h4>
<p>yeah looks right</p>



<a name="256308186"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20%60%23%5Bfeature%28rustc_private%29%5D%60%20with%20local%20Rust%20build/near/256308186" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20.60.23.5Bfeature(rustc_private).5D.60.20with.20local.20Rust.20build.html#256308186">(Oct 05 2021 at 19:53)</a>:</h4>
<p>are you still getting the error?</p>



<a name="256308188"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20%60%23%5Bfeature%28rustc_private%29%5D%60%20with%20local%20Rust%20build/near/256308188" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20.60.23.5Bfeature(rustc_private).5D.60.20with.20local.20Rust.20build.html#256308188">(Oct 05 2021 at 19:53)</a>:</h4>
<p>Do I need the <code>make</code> file to run? </p>
<div class="codehilite"><pre><span></span><code>---- [run-make] run-make-fulldeps\windows-subsystem stdout ----
thread &#39;[run-make] run-make-fulldeps\windows-subsystem&#39; panicked at &#39;failed to spawn `make`: Os { code: 2, kind: NotFound, message: &quot;The system cannot find the file specified.&quot; }&#39;, src\tools\compiletest\src\runtest.rs:3130:62
</code></pre></div>



<a name="256308246"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20%60%23%5Bfeature%28rustc_private%29%5D%60%20with%20local%20Rust%20build/near/256308246" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20.60.23.5Bfeature(rustc_private).5D.60.20with.20local.20Rust.20build.html#256308246">(Oct 05 2021 at 19:54)</a>:</h4>
<p>no</p>



<a name="256308267"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20%60%23%5Bfeature%28rustc_private%29%5D%60%20with%20local%20Rust%20build/near/256308267" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20.60.23.5Bfeature(rustc_private).5D.60.20with.20local.20Rust.20build.html#256308267">(Oct 05 2021 at 19:54)</a>:</h4>
<p>Oh, I think that did it</p>



<a name="256308288"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20%60%23%5Bfeature%28rustc_private%29%5D%60%20with%20local%20Rust%20build/near/256308288" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20.60.23.5Bfeature(rustc_private).5D.60.20with.20local.20Rust.20build.html#256308288">(Oct 05 2021 at 19:54)</a>:</h4>
<p>it should have ~immediately printed "Assemble stage 2 compiler" or something like that</p>



<a name="256308289"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20%60%23%5Bfeature%28rustc_private%29%5D%60%20with%20local%20Rust%20build/near/256308289" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20.60.23.5Bfeature(rustc_private).5D.60.20with.20local.20Rust.20build.html#256308289">(Oct 05 2021 at 19:54)</a>:</h4>
<p>Yep, that was it!</p>



<a name="256308314"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20%60%23%5Bfeature%28rustc_private%29%5D%60%20with%20local%20Rust%20build/near/256308314" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20.60.23.5Bfeature(rustc_private).5D.60.20with.20local.20Rust.20build.html#256308314">(Oct 05 2021 at 19:54)</a>:</h4>
<p>Thank you!!</p>



<a name="256308322"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20%60%23%5Bfeature%28rustc_private%29%5D%60%20with%20local%20Rust%20build/near/256308322" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20.60.23.5Bfeature(rustc_private).5D.60.20with.20local.20Rust.20build.html#256308322">(Oct 05 2021 at 19:54)</a>:</h4>
<p>we just don't do that final step (which copies everything into the actual sysroot) unless something asks for it</p>



<a name="256308336"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20%60%23%5Bfeature%28rustc_private%29%5D%60%20with%20local%20Rust%20build/near/256308336" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20.60.23.5Bfeature(rustc_private).5D.60.20with.20local.20Rust.20build.html#256308336">(Oct 05 2021 at 19:54)</a>:</h4>
<p><span class="user-mention silent" data-user-id="125250">Wesley Wiser</span> has marked this topic as resolved.</p>



<a name="256308363"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20%60%23%5Bfeature%28rustc_private%29%5D%60%20with%20local%20Rust%20build/near/256308363" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20.60.23.5Bfeature(rustc_private).5D.60.20with.20local.20Rust.20build.html#256308363">(Oct 05 2021 at 19:55)</a>:</h4>
<p>Ok, that makes sense.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>