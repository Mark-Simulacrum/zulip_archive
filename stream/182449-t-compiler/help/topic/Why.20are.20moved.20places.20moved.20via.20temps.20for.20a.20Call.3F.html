<html>
<head><meta charset="utf-8"><title>Why are moved places moved via temps for a Call? · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Why.20are.20moved.20places.20moved.20via.20temps.20for.20a.20Call.3F.html">Why are moved places moved via temps for a Call?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="263734598"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Why%20are%20moved%20places%20moved%20via%20temps%20for%20a%20Call%3F/near/263734598" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Why.20are.20moved.20places.20moved.20via.20temps.20for.20a.20Call.3F.html#263734598">(Dec 04 2021 at 22:12)</a>:</h4>
<p>This is clearly intentional, as <a href="https://github.com/rust-lang/rust/blob/efec545293b9263be9edfb283a7aa66350b3acbf/compiler/rustc_mir_build/src/build/expr/as_operand.rs#L83-L86">it's documented on <code>as_operand</code></a>, but it's unclear to me why it's needed.</p>
<p>I <a href="https://github.com/rust-lang/rust/issues/91521">stare</a> at the MIR that's generated like</p>
<div class="codehilite"><pre><span></span><code>    _2 = move _1;
    _0 = call foo(move _2)
</code></pre></div>
<p>and it just doesn't seem like that move-through-a-temporary is useful.</p>
<p>Is it maybe guarding against ending up with <code>_1 = call foo(move _1)</code>?  Or maybe it's only needed for copy parameters, but wasn't changed after the <code>Operand::{Copy, Move}</code> split in MIR?</p>
<p>EDIT: Oh, wow, according to blame that comment dates all the way back to <a href="https://github.com/rust-lang/rust/issues/27893">#27893</a> in 2015.</p>



<a name="263736353"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Why%20are%20moved%20places%20moved%20via%20temps%20for%20a%20Call%3F/near/263736353" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Why.20are.20moved.20places.20moved.20via.20temps.20for.20a.20Call.3F.html#263736353">(Dec 04 2021 at 22:54)</a>:</h4>
<p>it treats all kinds of places and rvalues the same, no?</p>



<a name="263736374"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Why%20are%20moved%20places%20moved%20via%20temps%20for%20a%20Call%3F/near/263736374" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Why.20are.20moved.20places.20moved.20via.20temps.20for.20a.20Call.3F.html#263736374">(Dec 04 2021 at 22:55)</a>:</h4>
<p>I see nothing about whether the source is already a <code>move</code></p>



<a name="263739213"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Why%20are%20moved%20places%20moved%20via%20temps%20for%20a%20Call%3F/near/263739213" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Why.20are.20moved.20places.20moved.20via.20temps.20for.20a.20Call.3F.html#263739213">(Dec 05 2021 at 00:03)</a>:</h4>
<p>Yeah, the question is more "would it break assumptions elsewhere to use the place directly for call-by-move?"</p>
<p>For Copy types it makes sense that the temporary is needed, since things like <code>foo(x, {x *= 2; x})</code> could exist.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>