<html>
<head><meta charset="utf-8"><title>✔ Where is this code trying to build core as 2018? · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Where.20is.20this.20code.20trying.20to.20build.20core.20as.202018.3F.html">✔ Where is this code trying to build core as 2018?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="270917378"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Where%20is%20this%20code%20trying%20to%20build%20core%20as%202018%3F/near/270917378" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Where.20is.20this.20code.20trying.20to.20build.20core.20as.202018.3F.html#270917378">(Feb 06 2022 at 23:13)</a>:</h4>
<p>I got an error here in <a href="https://github.com/rust-lang/rust/issues/93702">#93702</a> <a href="https://github.com/rust-lang-ci/rust/commit/0da55b19befceb81ac009b20d95af217a53919c7/checks/5084552999/logs">CI Logs</a></p>
<div class="codehilite"><pre><span></span><code>2022-02-06T17:14:38.1668835Z Copying stage2 std from stage1 (x86_64-unknown-linux-gnu -&gt; x86_64-unknown-linux-gnu / x86_64-unknown-linux-gnu)
2022-02-06T17:14:38.1683071Z [TIMING] StdLink { compiler: Compiler { stage: 1, host: TargetSelection { triple: &quot;x86_64-unknown-linux-gnu&quot;, file: None } }, target_compiler: Compiler { stage: 2, host: TargetSelection { triple: &quot;x86_64-unknown-linux-gnu&quot;, file: None } }, target: TargetSelection { triple: &quot;x86_64-unknown-linux-gnu&quot;, file: None } } -- 0.001
2022-02-06T17:14:38.1684225Z [TIMING] Std { target: TargetSelection { triple: &quot;x86_64-unknown-linux-gnu&quot;, file: None }, compiler: Compiler { stage: 2, host: TargetSelection { triple: &quot;x86_64-unknown-linux-gnu&quot;, file: None } } } -- 0.000
2022-02-06T17:14:38.1697949Z Build completed successfully in 0:20:46
2022-02-06T17:14:38.1782971Z + RUSTC_BOOTSTRAP=1
2022-02-06T17:14:38.1784331Z + ./build/x86_64-unknown-linux-gnu/stage2/bin/rustc --edition=2018 --crate-type=lib ../library/core/src/lib.rs
2022-02-06T17:14:47.7982174Z **** ERROR HERE; DETAILS UNIMPORTANT ****
2022-02-06T17:14:51.1892932Z == clock drift check ==
2022-02-06T17:14:51.1903530Z   local time: Sun Feb  6 17:14:51 UTC 2022
2022-02-06T17:14:51.2563181Z   network time: Sun, 06 Feb 2022 17:14:51 GMT
2022-02-06T17:14:51.2564019Z == end clock drift check ==
</code></pre></div>
<p>I don't seem to hit that in a full <code>x build --stage 2</code>.  And <a href="https://github.com/rust-lang/rust/blob/4e8fb743ccbec27344b2dd42de7057f41d4ebfdd/library/core/Cargo.toml#L9"><code>libcore</code>'s toml already has it on 2021</a>, so I'm not sure why it's building on 2018.</p>
<p>The only spot I'd found building core in 2018 in a test I found in <a href="https://github.com/rust-lang/rust/pull/93572/files#diff-82280a8117767a3b8897d28688cc16b42c345dd995eb266fddc93683bb10810dR4">https://github.com/rust-lang/rust/pull/93572/files#diff-82280a8117767a3b8897d28688cc16b42c345dd995eb266fddc93683bb10810dR4</a> and fixed.</p>
<p>Can anyone point out to me what's running then, so I can fix it to be 2021 too?</p>



<a name="270917518"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Where%20is%20this%20code%20trying%20to%20build%20core%20as%202018%3F/near/270917518" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Where.20is.20this.20code.20trying.20to.20build.20core.20as.202018.3F.html#270917518">(Feb 06 2022 at 23:16)</a>:</h4>
<p><span class="user-mention" data-user-id="125270">@scottmcm</span> That is part of the PGO script.</p>



<a name="270917524"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Where%20is%20this%20code%20trying%20to%20build%20core%20as%202018%3F/near/270917524" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Where.20is.20this.20code.20trying.20to.20build.20core.20as.202018.3F.html#270917524">(Feb 06 2022 at 23:17)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/blob/master/src/ci/pgo.sh#L17">https://github.com/rust-lang/rust/blob/master/src/ci/pgo.sh#L17</a></p>



<a name="270917535"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Where%20is%20this%20code%20trying%20to%20build%20core%20as%202018%3F/near/270917535" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Where.20is.20this.20code.20trying.20to.20build.20core.20as.202018.3F.html#270917535">(Feb 06 2022 at 23:17)</a>:</h4>
<p>Thank you!</p>



<a name="270917539"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Where%20is%20this%20code%20trying%20to%20build%20core%20as%202018%3F/near/270917539" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Where.20is.20this.20code.20trying.20to.20build.20core.20as.202018.3F.html#270917539">(Feb 06 2022 at 23:17)</a>:</h4>
<p><span class="user-mention silent" data-user-id="125270">scottmcm</span> has marked this topic as resolved.</p>



<a name="270917665"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Where%20is%20this%20code%20trying%20to%20build%20core%20as%202018%3F/near/270917665" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Where.20is.20this.20code.20trying.20to.20build.20core.20as.202018.3F.html#270917665">(Feb 06 2022 at 23:20)</a>:</h4>
<p><span class="user-mention" data-user-id="125270">@scottmcm</span> I'd also grep for library/core -- there's a few more places, e.g. src/test/run-make-fulldeps/core-no-fp-fmt-parse/Makefile</p>



<a name="270917672"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Where%20is%20this%20code%20trying%20to%20build%20core%20as%202018%3F/near/270917672" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Where.20is.20this.20code.20trying.20to.20build.20core.20as.202018.3F.html#270917672">(Feb 06 2022 at 23:20)</a>:</h4>
<p>that's the only one I immediately found</p>



<a name="270917674"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Where%20is%20this%20code%20trying%20to%20build%20core%20as%202018%3F/near/270917674" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Where.20is.20this.20code.20trying.20to.20build.20core.20as.202018.3F.html#270917674">(Feb 06 2022 at 23:20)</a>:</h4>
<p>Ah, and it's using a line continuation to wrap, which is why my <code>edition.*core</code> regex didn't find the script</p>



<a name="270917691"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Where%20is%20this%20code%20trying%20to%20build%20core%20as%202018%3F/near/270917691" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Where.20is.20this.20code.20trying.20to.20build.20core.20as.202018.3F.html#270917691">(Feb 06 2022 at 23:21)</a>:</h4>
<p>Thanks, <span class="user-mention" data-user-id="116122">@simulacrum</span> -- that one I'd already fixed since the PR build caught it.</p>



<a name="270918888"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Where%20is%20this%20code%20trying%20to%20build%20core%20as%202018%3F/near/270918888" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Where.20is.20this.20code.20trying.20to.20build.20core.20as.202018.3F.html#270918888">(Feb 06 2022 at 23:53)</a>:</h4>
<p>(If anyone is curious, new PR for this is <a href="https://github.com/rust-lang/rust/issues/93719">#93719</a>)</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>