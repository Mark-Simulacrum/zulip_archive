<html>
<head><meta charset="utf-8"><title>Test errors on master branch with parallel = true · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/Test.20errors.20on.20master.20branch.20with.20parallel.20.3D.20true.html">Test errors on master branch with parallel = true</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://rust-lang.github.io/zulip_archive/style.css" rel="stylesheet"></head>

<a name="204791463"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Test%20errors%20on%20master%20branch%20with%20parallel%20%3D%20true/near/204791463" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bram van den Heuvel <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/Test.20errors.20on.20master.20branch.20with.20parallel.20.3D.20true.html#204791463">(Jul 23 2020 at 12:46)</a>:</h4>
<p>Wannabe contributor here. I'm trying to run tests on current master (<code>2bbfa02b1b15974d5772b520aa027bf79f8c248e</code>, <code>./x.py test --stage 1</code>) but I get 5 failures. Are these supposed to fail, or did I make a mistake in my setup (e.g. using my own llvm as described in the book)? <a href="/user_uploads/4715/AN1eJ5la5UZnAv29J5u8PFI7/Screenshot-from-2020-07-23-14-45-06.png">The errors</a> </p>
<div class="message_inline_image"><a href="/user_uploads/4715/AN1eJ5la5UZnAv29J5u8PFI7/Screenshot-from-2020-07-23-14-45-06.png" title="The errors"><img src="/user_uploads/4715/AN1eJ5la5UZnAv29J5u8PFI7/Screenshot-from-2020-07-23-14-45-06.png"></a></div><p>If this is not the right place to ask, please let me know.</p>



<a name="204791624"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Test%20errors%20on%20master%20branch%20with%20parallel%20%3D%20true/near/204791624" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lzutao <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/Test.20errors.20on.20master.20branch.20with.20parallel.20.3D.20true.html#204791624">(Jul 23 2020 at 12:48)</a>:</h4>
<p>Should have the error message before this summary. Can you post them?</p>



<a name="204791769"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Test%20errors%20on%20master%20branch%20with%20parallel%20%3D%20true/near/204791769" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bram van den Heuvel <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/Test.20errors.20on.20master.20branch.20with.20parallel.20.3D.20true.html#204791769">(Jul 23 2020 at 12:49)</a>:</h4>
<p><a href="https://gist.github.com/vandenheuvel/543804266f1f1924f0b834c9b1dd963b">https://gist.github.com/vandenheuvel/543804266f1f1924f0b834c9b1dd963b</a></p>



<a name="204792341"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Test%20errors%20on%20master%20branch%20with%20parallel%20%3D%20true/near/204792341" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lzutao <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/Test.20errors.20on.20master.20branch.20with.20parallel.20.3D.20true.html#204792341">(Jul 23 2020 at 12:54)</a>:</h4>
<p>trying to run the fail tests ...</p>



<a name="204792420"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Test%20errors%20on%20master%20branch%20with%20parallel%20%3D%20true/near/204792420" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bram van den Heuvel <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/Test.20errors.20on.20master.20branch.20with.20parallel.20.3D.20true.html#204792420">(Jul 23 2020 at 12:55)</a>:</h4>
<p>Thanks for taking a look. Updating all submodules didn't help.</p>



<a name="204792577"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Test%20errors%20on%20master%20branch%20with%20parallel%20%3D%20true/near/204792577" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bram van den Heuvel <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/Test.20errors.20on.20master.20branch.20with.20parallel.20.3D.20true.html#204792577">(Jul 23 2020 at 12:56)</a>:</h4>
<p>Looks like they're all ui errors. It looks like someone forgot to <code>--bless</code>, but that couldn't get past CI, I assume?</p>



<a name="204793703"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Test%20errors%20on%20master%20branch%20with%20parallel%20%3D%20true/near/204793703" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lzutao <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/Test.20errors.20on.20master.20branch.20with.20parallel.20.3D.20true.html#204793703">(Jul 23 2020 at 13:04)</a>:</h4>
<p>All failing tests  passes on my machine.<br>
Did you change Rust source somewhere?</p>



<a name="204793747"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Test%20errors%20on%20master%20branch%20with%20parallel%20%3D%20true/near/204793747" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bram van den Heuvel <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/Test.20errors.20on.20master.20branch.20with.20parallel.20.3D.20true.html#204793747">(Jul 23 2020 at 13:04)</a>:</h4>
<p>No, it's clean</p>



<a name="204793783"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Test%20errors%20on%20master%20branch%20with%20parallel%20%3D%20true/near/204793783" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bram van den Heuvel <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/Test.20errors.20on.20master.20branch.20with.20parallel.20.3D.20true.html#204793783">(Jul 23 2020 at 13:04)</a>:</h4>
<p>I only edited the configuration file, following the book</p>



<a name="204793835"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Test%20errors%20on%20master%20branch%20with%20parallel%20%3D%20true/near/204793835" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bram van den Heuvel <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/Test.20errors.20on.20master.20branch.20with.20parallel.20.3D.20true.html#204793835">(Jul 23 2020 at 13:05)</a>:</h4>
<p>Any other tips on how I could diagnose this?</p>



<a name="204794021"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Test%20errors%20on%20master%20branch%20with%20parallel%20%3D%20true/near/204794021" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/Test.20errors.20on.20master.20branch.20with.20parallel.20.3D.20true.html#204794021">(Jul 23 2020 at 13:06)</a>:</h4>
<p>do you by chance have parallel-compiler = true on?</p>



<a name="204794174"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Test%20errors%20on%20master%20branch%20with%20parallel%20%3D%20true/near/204794174" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lzutao <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/Test.20errors.20on.20master.20branch.20with.20parallel.20.3D.20true.html#204794174">(Jul 23 2020 at 13:07)</a>:</h4>
<p>Can you post a <code>diff config.toml.example config.toml</code>?</p>



<a name="204794270"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Test%20errors%20on%20master%20branch%20with%20parallel%20%3D%20true/near/204794270" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bram van den Heuvel <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/Test.20errors.20on.20master.20branch.20with.20parallel.20.3D.20true.html#204794270">(Jul 23 2020 at 13:08)</a>:</h4>
<p><span class="user-mention" data-user-id="116122">@simulacrum</span> I do, that's probably it then. If I don't write in this thread in a couple of minutes, consider this fixed.</p>



<a name="204794327"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Test%20errors%20on%20master%20branch%20with%20parallel%20%3D%20true/near/204794327" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/Test.20errors.20on.20master.20branch.20with.20parallel.20.3D.20true.html#204794327">(Jul 23 2020 at 13:08)</a>:</h4>
<p>yeah I would leave it off, it's not tested in CI beyond x.py check working and isn't likely to bring too many wins at this point if any</p>



<a name="204794506"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Test%20errors%20on%20master%20branch%20with%20parallel%20%3D%20true/near/204794506" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bram van den Heuvel <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/Test.20errors.20on.20master.20branch.20with.20parallel.20.3D.20true.html#204794506">(Jul 23 2020 at 13:10)</a>:</h4>
<p>I hate to be cynical, but isn't rust supposed to make writing parallel code easier? Minimal gains I can understand, but different compilation results without any notification... Hm.</p>



<a name="204794558"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Test%20errors%20on%20master%20branch%20with%20parallel%20%3D%20true/near/204794558" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/Test.20errors.20on.20master.20branch.20with.20parallel.20.3D.20true.html#204794558">(Jul 23 2020 at 13:10)</a>:</h4>
<p>we haven't spent a lot of time on it</p>



<a name="204794579"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Test%20errors%20on%20master%20branch%20with%20parallel%20%3D%20true/near/204794579" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/Test.20errors.20on.20master.20branch.20with.20parallel.20.3D.20true.html#204794579">(Jul 23 2020 at 13:11)</a>:</h4>
<p>well, those tests are "known to have different results"</p>



<a name="204794588"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Test%20errors%20on%20master%20branch%20with%20parallel%20%3D%20true/near/204794588" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/Test.20errors.20on.20master.20branch.20with.20parallel.20.3D.20true.html#204794588">(Jul 23 2020 at 13:11)</a>:</h4>
<p>because all of them are cycle errors</p>



<a name="204794615"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Test%20errors%20on%20master%20branch%20with%20parallel%20%3D%20true/near/204794615" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/Test.20errors.20on.20master.20branch.20with.20parallel.20.3D.20true.html#204794615">(Jul 23 2020 at 13:11)</a>:</h4>
<p>so it's somewhat expected that parallel execution will lead to slightly different evaluation order and such</p>



<a name="204794721"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Test%20errors%20on%20master%20branch%20with%20parallel%20%3D%20true/near/204794721" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bram van den Heuvel <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/Test.20errors.20on.20master.20branch.20with.20parallel.20.3D.20true.html#204794721">(Jul 23 2020 at 13:12)</a>:</h4>
<p>Okay, thanks for clarifying a bit what's at play!</p>



<a name="204795107"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Test%20errors%20on%20master%20branch%20with%20parallel%20%3D%20true/near/204795107" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/Test.20errors.20on.20master.20branch.20with.20parallel.20.3D.20true.html#204795107">(Jul 23 2020 at 13:15)</a>:</h4>
<p><span class="user-mention" data-user-id="323979">@Bram van den Heuvel</span> what Rust (uniquely, in some sense) brings to the table in terms of paralell here is that the locks and such were introduced to the compiler with nearly zero coordination and, notably, we're currently in a position where a single flag can switch between both states and have fairly high confidence in the safety of such a move.</p>



<a name="204795512"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Test%20errors%20on%20master%20branch%20with%20parallel%20%3D%20true/near/204795512" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/Test.20errors.20on.20master.20branch.20with.20parallel.20.3D.20true.html#204795512">(Jul 23 2020 at 13:18)</a>:</h4>
<p>(you can see from the test failures that the compiler is still working just fine, just its output is now non-deterministic – and non-determinism is inherent when using threads, there is nothing Rust can do to prevent that)</p>



<a name="205042526"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Test%20errors%20on%20master%20branch%20with%20parallel%20%3D%20true/near/205042526" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/Test.20errors.20on.20master.20branch.20with.20parallel.20.3D.20true.html#205042526">(Jul 26 2020 at 08:32)</a>:</h4>
<p>It's possible to maintain deterministic output with threads, it's just harder.</p>



<hr><p>Last updated: Aug 07 2021 at 22:04 UTC</p>
</html>