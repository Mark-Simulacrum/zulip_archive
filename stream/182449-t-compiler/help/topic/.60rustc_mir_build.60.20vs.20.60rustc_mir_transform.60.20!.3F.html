<html>
<head><meta charset="utf-8"><title>`rustc_mir_build` vs `rustc_mir_transform` !? · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.60rustc_mir_build.60.20vs.20.60rustc_mir_transform.60.20!.3F.html">`rustc_mir_build` vs `rustc_mir_transform` !?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="269132773"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%60rustc_mir_build%60%20vs%20%60rustc_mir_transform%60%20%21%3F/near/269132773" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Frank Steffahn <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.60rustc_mir_build.60.20vs.20.60rustc_mir_transform.60.20!.3F.html#269132773">(Jan 24 2022 at 16:39)</a>:</h4>
<p>My first time trying to change something in the compiler. After looking around in the AST definition, and out of curiosity following the handling of unsafe blocks a bit through the compiler with rust-analyzer, I’ve ended up in <code>…/compiler/rustc_mir_build/src/check_unsafety.rs</code>. I wanted to change something to see if I could improve lints, but was quite confused when changes didn’t seem to make a difference. Grepping for an error message lead me to another occurrence in a different file, <code>…/compiler/rustc_mir_transform/src/check_unsafety.rs</code>; there seems to be quite a bit of duplication. What’s going on here? Where is this documented?</p>



<a name="269133158"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%60rustc_mir_build%60%20vs%20%60rustc_mir_transform%60%20%21%3F/near/269133158" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.60rustc_mir_build.60.20vs.20.60rustc_mir_transform.60.20!.3F.html#269133158">(Jan 24 2022 at 16:42)</a>:</h4>
<p>you might have encountered <a href="https://github.com/rust-lang/project-thir-unsafeck">https://github.com/rust-lang/project-thir-unsafeck</a> / <a class="stream" data-stream-id="278509" href="/#narrow/stream/278509-project-thir-unsafeck">#project-thir-unsafeck</a></p>



<a name="269133549"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%60rustc_mir_build%60%20vs%20%60rustc_mir_transform%60%20%21%3F/near/269133549" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.60rustc_mir_build.60.20vs.20.60rustc_mir_transform.60.20!.3F.html#269133549">(Jan 24 2022 at 16:44)</a>:</h4>
<p>the unsafety check in <code>mir_build</code> only runs with <code>-Zthir-unsafeck</code> which is supposed to replace the mir checker in <code>mir_transform</code> in the future but is not yet ready</p>



<a name="269133679"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%60rustc_mir_build%60%20vs%20%60rustc_mir_transform%60%20%21%3F/near/269133679" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.60rustc_mir_build.60.20vs.20.60rustc_mir_transform.60.20!.3F.html#269133679">(Jan 24 2022 at 16:45)</a>:</h4>
<p>i don't know how far away we are from only using the thir check, but afaict that project group is currently mostly inactive</p>



<a name="269134363"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%60rustc_mir_build%60%20vs%20%60rustc_mir_transform%60%20%21%3F/near/269134363" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Frank Steffahn <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.60rustc_mir_build.60.20vs.20.60rustc_mir_transform.60.20!.3F.html#269134363">(Jan 24 2022 at 16:50)</a>:</h4>
<p>Follow-up question; so if I were to open a PR to change a lint (this is about <code>unused_unsafe</code> for which I think I have an idea for a small, reasonable improvement), should I just ignore the stuff in <code>rustc_mir_build</code>? Or should the two implementations be kept “in sync”?</p>



<a name="269134554"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%60rustc_mir_build%60%20vs%20%60rustc_mir_transform%60%20%21%3F/near/269134554" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Frank Steffahn <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.60rustc_mir_build.60.20vs.20.60rustc_mir_transform.60.20!.3F.html#269134554">(Jan 24 2022 at 16:51)</a>:</h4>
<p>Also, unrelated question, but I haven’t found a good source on this: How would I do “printf-debugging” in the compiler?</p>



<a name="269137768"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%60rustc_mir_build%60%20vs%20%60rustc_mir_transform%60%20%21%3F/near/269137768" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.60rustc_mir_build.60.20vs.20.60rustc_mir_transform.60.20!.3F.html#269137768">(Jan 24 2022 at 17:12)</a>:</h4>
<p><a href="https://rustc-dev-guide.rust-lang.org/tracing.html">https://rustc-dev-guide.rust-lang.org/tracing.html</a></p>



<a name="269217072"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%60rustc_mir_build%60%20vs%20%60rustc_mir_transform%60%20%21%3F/near/269217072" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.60rustc_mir_build.60.20vs.20.60rustc_mir_transform.60.20!.3F.html#269217072">(Jan 25 2022 at 07:12)</a>:</h4>
<p>i think it's fine to ignore <code>rustc_mir_build</code> when changing stuff <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="269236118"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%60rustc_mir_build%60%20vs%20%60rustc_mir_transform%60%20%21%3F/near/269236118" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Frank Steffahn <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.60rustc_mir_build.60.20vs.20.60rustc_mir_transform.60.20!.3F.html#269236118">(Jan 25 2022 at 10:22)</a>:</h4>
<p>alright ^^</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>