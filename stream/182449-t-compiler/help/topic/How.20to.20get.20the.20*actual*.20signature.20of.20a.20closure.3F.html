<html>
<head><meta charset="utf-8"><title>How to get the *actual* signature of a closure? · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/How.20to.20get.20the.20*actual*.20signature.20of.20a.20closure.3F.html">How to get the *actual* signature of a closure?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="269417392"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/How%20to%20get%20the%20%2Aactual%2A%20signature%20of%20a%20closure%3F/near/269417392" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Xavier Denis <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/How.20to.20get.20the.20*actual*.20signature.20of.20a.20closure.3F.html#269417392">(Jan 26 2022 at 14:15)</a>:</h4>
<p>As it stands, closures are rather special within the rustc api: we can't use methods like <code>fn_sig</code> to get their signatures, instead we have to obtain their <em>substitution</em> (which seems to be unique), convert it into a <code>ClosureSubst</code> and then get a signature, but this is still wrong! If we look at the MIR for a closure body, the signature will be different as it is preceded by an argument of the closure's type. </p>
<p>So while <code>substs.as_closure().sig()</code> will give us the signature seen from 'outside', is there any way to obtain the signature of the closure's MIR body?</p>



<a name="269417659"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/How%20to%20get%20the%20%2Aactual%2A%20signature%20of%20a%20closure%3F/near/269417659" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Xavier Denis <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/How.20to.20get.20the.20*actual*.20signature.20of.20a.20closure.3F.html#269417659">(Jan 26 2022 at 14:16)</a>:</h4>
<p>As a follow up, it seems like the <code>DefId</code> of a closure is rather special within the compiler, referring to both the <em>body</em> (code) and type (struct), is there any other kind of item which does a similar overloading?</p>



<a name="269418305"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/How%20to%20get%20the%20%2Aactual%2A%20signature%20of%20a%20closure%3F/near/269418305" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/How.20to.20get.20the.20*actual*.20signature.20of.20a.20closure.3F.html#269418305">(Jan 26 2022 at 14:20)</a>:</h4>
<p>This is what rustc internally uses: <a href="https://github.com/rust-lang/rust/blob/788b1fe5b79a8b74215022f9df49b0eae68a50b9/compiler/rustc_middle/src/ty/layout.rs#L2575-L2678">https://github.com/rust-lang/rust/blob/788b1fe5b79a8b74215022f9df49b0eae68a50b9/compiler/rustc_middle/src/ty/layout.rs#L2575-L2678</a></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>