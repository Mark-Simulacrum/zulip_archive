<html>
<head><meta charset="utf-8"><title>does const_str imply readonly? · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/does.20const_str.20imply.20readonly.3F.html">does const_str imply readonly?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="261749889"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/does%20const_str%20imply%20readonly%3F/near/261749889" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/does.20const_str.20imply.20readonly.3F.html#261749889">(Nov 17 2021 at 07:07)</a>:</h4>
<p>does cg_ssa's <code>const_str(Symbol) -&gt; (Value, Value)</code> imply that the str is readonly? Im wondering if i should place it in the <code>__constant__</code> address space in CUDA</p>



<a name="261764187"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/does%20const_str%20imply%20readonly%3F/near/261764187" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/does.20const_str.20imply.20readonly.3F.html#261764187">(Nov 17 2021 at 10:07)</a>:</h4>
<p>I am pretty sure cg_llvm places it in a readonly section, so go ahead and place it in the <code>__constant__</code> address space.</p>



<a name="261830706"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/does%20const_str%20imply%20readonly%3F/near/261830706" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/does.20const_str.20imply.20readonly.3F.html#261830706">(Nov 17 2021 at 18:52)</a>:</h4>
<p><span class="user-mention" data-user-id="133247">@bjorn3</span> it only places statics in readonly in <code>get_static</code> if they can be, if it uses <code>get_static</code> to also get things like defined symbols then yeah that makes sense. Although i only thought get_static was for <code>static FOO</code> type of things. Now that i think about it, it's probably for all symbols</p>



<a name="261830772"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/does%20const_str%20imply%20readonly%3F/near/261830772" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/does.20const_str.20imply.20readonly.3F.html#261830772">(Nov 17 2021 at 18:52)</a>:</h4>
<p>It is very confusing because rustc requires you to define globals in like 7 different places <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="261830938"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/does%20const_str%20imply%20readonly%3F/near/261830938" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/does.20const_str.20imply.20readonly.3F.html#261830938">(Nov 17 2021 at 18:54)</a>:</h4>
<p>And LLVM doesnt make it any easier, i had to rewrite <code>LLVMRustGetOrInsertGlobal</code> because it did not allow you to specify an address space <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span></p>



<a name="261831629"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/does%20const_str%20imply%20readonly%3F/near/261831629" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/does.20const_str.20imply.20readonly.3F.html#261831629">(Nov 17 2021 at 18:59)</a>:</h4>
<p>the distinction between globals and statics is kind of confusing, im not sure if rustc always means <code>static FOO</code> type of things by "static", while globals is anything that rustc needs, like private or alloc globals</p>



<a name="261832859"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/does%20const_str%20imply%20readonly%3F/near/261832859" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/does.20const_str.20imply.20readonly.3F.html#261832859">(Nov 17 2021 at 19:08)</a>:</h4>
<p>yeah it seems like get_static is for more than just <code>static</code>s, its called for thread locals as well as for GlobalAlloc things in scalar_to_backend</p>



<a name="261833187"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/does%20const_str%20imply%20readonly%3F/near/261833187" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/does.20const_str.20imply.20readonly.3F.html#261833187">(Nov 17 2021 at 19:11)</a>:</h4>
<p>but i dont think llvm has a way to set a global's addrspace... ugh</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>