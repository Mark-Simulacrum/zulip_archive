<html>
<head><meta charset="utf-8"><title>Fixing a bug related to specialization · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Fixing.20a.20bug.20related.20to.20specialization.html">Fixing a bug related to specialization</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="264657467"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Fixing%20a%20bug%20related%20to%20specialization/near/264657467" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Fixing.20a.20bug.20related.20to.20specialization.html#264657467">(Dec 13 2021 at 02:27)</a>:</h4>
<p>Hello! First, thank you all for your work on the Rust compiler. I've been trying to fix this issue: <a href="https://github.com/rust-lang/rust/issues/90817">https://github.com/rust-lang/rust/issues/90817</a>, which seems to be related to specialization, although the code itself does not use specialization. I've commented here <a href="https://github.com/rust-lang/rust/issues/90817#issuecomment-992008088">https://github.com/rust-lang/rust/issues/90817#issuecomment-992008088</a> what I think is the cause of the problem, but I'm not sure of how to resolve it.</p>
<p>I think that the problem could be solved by changing <a href="https://github.com/rust-lang/rust/blob/6bda5b331cfe7e04e1fe348c58a928fc2b650f4f/compiler/rustc_trait_selection/src/traits/specialize/mod.rs#L123-L129">https://github.com/rust-lang/rust/blob/6bda5b331cfe7e04e1fe348c58a928fc2b650f4f/compiler/rustc_trait_selection/src/traits/specialize/mod.rs#L123-L129</a> to return false whenever specialization is enabled in neither of the crates where the impls are found. However, I'm not sure how to determine the features enabled in the crates using the <code>TyCtxt&lt;'_&gt;</code> and the <code>DefId</code> of  the impls.</p>
<p>Alternatively, this could be resolved by avoiding the loop while evaluating the candidate impls, but I don't know if or how this could be done.</p>
<p>I would appreciate any advice you have about this issue. Thank you!</p>



<a name="264677996"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Fixing%20a%20bug%20related%20to%20specialization/near/264677996" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Fixing.20a.20bug.20related.20to.20specialization.html#264677996">(Dec 13 2021 at 09:02)</a>:</h4>
<p>There's no way to determine what features were active in a dependency without reparsing the attributes, which is usually discouraged because erroring on missing feature gates in dependencies is a really bad idea</p>



<a name="264952446"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Fixing%20a%20bug%20related%20to%20specialization/near/264952446" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Fixing.20a.20bug.20related.20to.20specialization.html#264952446">(Dec 15 2021 at 01:08)</a>:</h4>
<p>That makes sense, thanks</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>