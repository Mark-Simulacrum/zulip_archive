<html>
<head><meta charset="utf-8"><title>undefined reference to DisableABIBreakingChecks@LLVM_12 · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/undefined.20reference.20to.20DisableABIBreakingChecks.40LLVM_12.html">undefined reference to DisableABIBreakingChecks@LLVM_12</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="236838740"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/undefined%20reference%20to%20DisableABIBreakingChecks%40LLVM_12/near/236838740" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/undefined.20reference.20to.20DisableABIBreakingChecks.40LLVM_12.html#236838740">(Apr 30 2021 at 14:02)</a>:</h4>
<p>does this error look familiar?</p>
<blockquote>
<p>= note: /nix/store/nfs9wf6ipffr9g9ylzb4i9c1i607nxvq-binutils-2.31.1/bin/ld: /home/joshua/rust/build/x86_64-unknown-linux-gnu/stage1/lib/rustlib/x86_64-unknown-linux-gnu/lib/librustc_driver-bcac88c1fda1187d.so: undefined reference to `llvm::DisableABIBreakingChecks@LLVM_12'</p>
</blockquote>



<a name="236838839"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/undefined%20reference%20to%20DisableABIBreakingChecks%40LLVM_12/near/236838839" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/undefined.20reference.20to.20DisableABIBreakingChecks.40LLVM_12.html#236838839">(Apr 30 2021 at 14:03)</a>:</h4>
<p>this is when linking <code>rustdoc_tool_binary</code></p>



<a name="236838853"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/undefined%20reference%20to%20DisableABIBreakingChecks%40LLVM_12/near/236838853" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/undefined.20reference.20to.20DisableABIBreakingChecks.40LLVM_12.html#236838853">(Apr 30 2021 at 14:03)</a>:</h4>
<p>(i.e. src/tools/rustdoc)</p>



<a name="236838913"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/undefined%20reference%20to%20DisableABIBreakingChecks%40LLVM_12/near/236838913" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/undefined.20reference.20to.20DisableABIBreakingChecks.40LLVM_12.html#236838913">(Apr 30 2021 at 14:03)</a>:</h4>
<p>clearing stage1-tools doesn't help</p>



<a name="236839008"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/undefined%20reference%20to%20DisableABIBreakingChecks%40LLVM_12/near/236839008" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/undefined.20reference.20to.20DisableABIBreakingChecks.40LLVM_12.html#236839008">(Apr 30 2021 at 14:04)</a>:</h4>
<p>I do have download-ci-llvm on in case that matters</p>



<a name="236839077"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/undefined%20reference%20to%20DisableABIBreakingChecks%40LLVM_12/near/236839077" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/undefined.20reference.20to.20DisableABIBreakingChecks.40LLVM_12.html#236839077">(Apr 30 2021 at 14:04)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/undefined.20reference.20to.20DisableABIBreakingChecks.40LLVM_12/near/236838913">said</a>:</p>
<blockquote>
<p>clearing stage1-tools doesn't help</p>
</blockquote>
<p>nor does clearing ci-llvm</p>



<a name="236839093"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/undefined%20reference%20to%20DisableABIBreakingChecks%40LLVM_12/near/236839093" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/undefined.20reference.20to.20DisableABIBreakingChecks.40LLVM_12.html#236839093">(Apr 30 2021 at 14:04)</a>:</h4>
<p>I guess I'll try rebuilding from scratch :/</p>



<a name="236843223"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/undefined%20reference%20to%20DisableABIBreakingChecks%40LLVM_12/near/236843223" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/undefined.20reference.20to.20DisableABIBreakingChecks.40LLVM_12.html#236843223">(Apr 30 2021 at 14:31)</a>:</h4>
<p>wow this broke even with a completely clean build cache :/</p>



<a name="236843272"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/undefined%20reference%20to%20DisableABIBreakingChecks%40LLVM_12/near/236843272" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/undefined.20reference.20to.20DisableABIBreakingChecks.40LLVM_12.html#236843272">(Apr 30 2021 at 14:32)</a>:</h4>
<p><span class="user-mention" data-user-id="123586">@nagisa</span> <span class="user-mention" data-user-id="138448">@cuviper</span> do either of you recognize this error?</p>



<a name="236843420"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/undefined%20reference%20to%20DisableABIBreakingChecks%40LLVM_12/near/236843420" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/undefined.20reference.20to.20DisableABIBreakingChecks.40LLVM_12.html#236843420">(Apr 30 2021 at 14:33)</a>:</h4>
<p>nope.</p>



<a name="236843915"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/undefined%20reference%20to%20DisableABIBreakingChecks%40LLVM_12/near/236843915" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/undefined.20reference.20to.20DisableABIBreakingChecks.40LLVM_12.html#236843915">(Apr 30 2021 at 14:36)</a>:</h4>
<p>me neither</p>



<a name="236844021"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/undefined%20reference%20to%20DisableABIBreakingChecks%40LLVM_12/near/236844021" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/undefined.20reference.20to.20DisableABIBreakingChecks.40LLVM_12.html#236844021">(Apr 30 2021 at 14:37)</a>:</h4>
<p>hmm ok</p>



<a name="236844038"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/undefined%20reference%20to%20DisableABIBreakingChecks%40LLVM_12/near/236844038" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/undefined.20reference.20to.20DisableABIBreakingChecks.40LLVM_12.html#236844038">(Apr 30 2021 at 14:37)</a>:</h4>
<p>this is probably related to download-rustc somehow then</p>



<a name="236844045"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/undefined%20reference%20to%20DisableABIBreakingChecks%40LLVM_12/near/236844045" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/undefined.20reference.20to.20DisableABIBreakingChecks.40LLVM_12.html#236844045">(Apr 30 2021 at 14:37)</a>:</h4>
<p>weird that it only broke now</p>



<a name="236845682"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/undefined%20reference%20to%20DisableABIBreakingChecks%40LLVM_12/near/236845682" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Kądziołka <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/undefined.20reference.20to.20DisableABIBreakingChecks.40LLVM_12.html#236845682">(Apr 30 2021 at 14:48)</a>:</h4>
<p>IIRC LLVM has two ABIs; which gets used depends on compile time options. Somehow your configuration has caused a mismatch</p>



<a name="236849279"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/undefined%20reference%20to%20DisableABIBreakingChecks%40LLVM_12/near/236849279" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/undefined.20reference.20to.20DisableABIBreakingChecks.40LLVM_12.html#236849279">(Apr 30 2021 at 15:06)</a>:</h4>
<p>glibc's cxx11 ABI isn't backwards compatible with pre-cxx11. That's the only C++ specific incompat I know of.</p>



<a name="236849341"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/undefined%20reference%20to%20DisableABIBreakingChecks%40LLVM_12/near/236849341" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/undefined.20reference.20to.20DisableABIBreakingChecks.40LLVM_12.html#236849341">(Apr 30 2021 at 15:06)</a>:</h4>
<p>and LLVM requires c++11 or later, so that shouldn't be a concern?</p>



<a name="236849349"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/undefined%20reference%20to%20DisableABIBreakingChecks%40LLVM_12/near/236849349" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/undefined.20reference.20to.20DisableABIBreakingChecks.40LLVM_12.html#236849349">(Apr 30 2021 at 15:07)</a>:</h4>
<p><span aria-label="shrug" class="emoji emoji-1f937" role="img" title="shrug">:shrug:</span></p>



<a name="236850360"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/undefined%20reference%20to%20DisableABIBreakingChecks%40LLVM_12/near/236850360" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Kądziołka <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/undefined.20reference.20to.20DisableABIBreakingChecks.40LLVM_12.html#236850360">(Apr 30 2021 at 15:11)</a>:</h4>
<p>it's not just c++ specific, llvm created this difference themselves</p>



<a name="236850373"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/undefined%20reference%20to%20DisableABIBreakingChecks%40LLVM_12/near/236850373" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hyd-dev <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/undefined.20reference.20to.20DisableABIBreakingChecks.40LLVM_12.html#236850373">(Apr 30 2021 at 15:11)</a>:</h4>
<p>LLVM has this: <a href="https://github.com/llvm/llvm-project/blob/d480f968ad8b56d3ee4a6b6df5532d485b0ad01e/llvm/include/llvm/Support/Error.h#L685-L687">https://github.com/llvm/llvm-project/blob/d480f968ad8b56d3ee4a6b6df5532d485b0ad01e/llvm/include/llvm/Support/Error.h#L685-L687</a></p>



<a name="236850887"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/undefined%20reference%20to%20DisableABIBreakingChecks%40LLVM_12/near/236850887" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/undefined.20reference.20to.20DisableABIBreakingChecks.40LLVM_12.html#236850887">(Apr 30 2021 at 15:13)</a>:</h4>
<p>seems something like we'd want to disable regardless as we don't depend on LLVM having a stable ABI</p>



<a name="236850955"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/undefined%20reference%20to%20DisableABIBreakingChecks%40LLVM_12/near/236850955" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/undefined.20reference.20to.20DisableABIBreakingChecks.40LLVM_12.html#236850955">(Apr 30 2021 at 15:13)</a>:</h4>
<p>or at least try not to.</p>



<a name="236851758"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/undefined%20reference%20to%20DisableABIBreakingChecks%40LLVM_12/near/236851758" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tm <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/undefined.20reference.20to.20DisableABIBreakingChecks.40LLVM_12.html#236851758">(Apr 30 2021 at 15:16)</a>:</h4>
<p>There are assertions that when enabled change the LLVM ABI. As far as I can see the purpose of this symbol is to check that this matches between client of the API and the implementation.</p>



<a name="249938993"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/undefined%20reference%20to%20DisableABIBreakingChecks%40LLVM_12/near/249938993" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/undefined.20reference.20to.20DisableABIBreakingChecks.40LLVM_12.html#249938993">(Aug 19 2021 at 03:55)</a>:</h4>
<p>I am still hitting this :(</p>



<a name="249939731"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/undefined%20reference%20to%20DisableABIBreakingChecks%40LLVM_12/near/249939731" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/undefined.20reference.20to.20DisableABIBreakingChecks.40LLVM_12.html#249939731">(Aug 19 2021 at 04:09)</a>:</h4>
<p>it turns out this is because I had <code>assertions = true</code> in config.toml - I guess the combination of that and download-ci-llvm broke things?</p>



<a name="249988778"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/undefined%20reference%20to%20DisableABIBreakingChecks%40LLVM_12/near/249988778" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/undefined.20reference.20to.20DisableABIBreakingChecks.40LLVM_12.html#249988778">(Aug 19 2021 at 13:48)</a>:</h4>
<p>It.. shouldn't, no. It might be we didn't rebuild something else when we downloaded a fresh LLVM (e.g., lld or compiler-rt or something...?)</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>