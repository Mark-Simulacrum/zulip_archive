<html>
<head><meta charset="utf-8"><title>Runtool-based rustdoc test sample? · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Runtool-based.20rustdoc.20test.20sample.3F.html">Runtool-based rustdoc test sample?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="278618226"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Runtool-based%20rustdoc%20test%20sample%3F/near/278618226" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Runtool-based.20rustdoc.20test.20sample.3F.html#278618226">(Apr 11 2022 at 21:18)</a>:</h4>
<p>Hi, I am iterating on this PR here. <a href="https://github.com/rust-lang/rust/pull/95836#discussion_r847287370">https://github.com/rust-lang/rust/pull/95836#discussion_r847287370</a> I am wondering if anyone has an example of the <code>--runtool</code> based workflow that bjorn3 mentioned? It might be nice to get something like that going as a run-make test (or maybe a simpler form if possible).</p>



<a name="278620902"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Runtool-based%20rustdoc%20test%20sample%3F/near/278620902" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Runtool-based.20rustdoc.20test.20sample.3F.html#278620902">(Apr 11 2022 at 21:40)</a>:</h4>
<p><span class="user-mention" data-user-id="281757">@Jubilee</span> I think there are already some tests for this in rustdoc-ui. If not, there's a comment by <span class="user-mention" data-user-id="210267">@Nemo157</span> somewhere about using --runtool clippy-driver, I'll try to dig that up.</p>



<a name="278621245"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Runtool-based%20rustdoc%20test%20sample%3F/near/278621245" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Runtool-based.20rustdoc.20test.20sample.3F.html#278621245">(Apr 11 2022 at 21:44)</a>:</h4>
<p>Ah never mind, j was thinking of --test-builder. I don't know anything about --runtool. (I think it's still unstable? You may want to check with the rustdoc team whether they ever plan to stabilize it ...)</p>



<a name="278621255"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Runtool-based%20rustdoc%20test%20sample%3F/near/278621255" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Runtool-based.20rustdoc.20test.20sample.3F.html#278621255">(Apr 11 2022 at 21:44)</a>:</h4>
<p>I rg'd for runtool but it didn't get any hits in <code>src/test/</code></p>



<a name="278621259"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Runtool-based%20rustdoc%20test%20sample%3F/near/278621259" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Runtool-based.20rustdoc.20test.20sample.3F.html#278621259">(Apr 11 2022 at 21:44)</a>:</h4>
<p>yeah.</p>



<a name="278621359"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Runtool-based%20rustdoc%20test%20sample%3F/near/278621359" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Runtool-based.20rustdoc.20test.20sample.3F.html#278621359">(Apr 11 2022 at 21:45)</a>:</h4>
<p>(imo runtool is a misfeature, and the original author has long since disappeared ... but I'm no longer on the team)</p>



<a name="278622456"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Runtool-based%20rustdoc%20test%20sample%3F/near/278622456" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Runtool-based.20rustdoc.20test.20sample.3F.html#278622456">(Apr 11 2022 at 21:57)</a>:</h4>
<p>How would you suggest doing wasm doctests if not with <code>--runtool</code>?</p>



<a name="278623216"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Runtool-based%20rustdoc%20test%20sample%3F/near/278623216" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Runtool-based.20rustdoc.20test.20sample.3F.html#278623216">(Apr 11 2022 at 22:04)</a>:</h4>
<p>It is quite reasonable, IMO, to want to separate the responsibilities of the test builder and the test runner. It is questionable whether rustdoc should be responsible for running tests at all.</p>



<a name="278623342"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Runtool-based%20rustdoc%20test%20sample%3F/near/278623342" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Runtool-based.20rustdoc.20test.20sample.3F.html#278623342">(Apr 11 2022 at 22:05)</a>:</h4>
<p>I have no dog in this fight aside from that observation.</p>



<a name="278623667"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Runtool-based%20rustdoc%20test%20sample%3F/near/278623667" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Runtool-based.20rustdoc.20test.20sample.3F.html#278623667">(Apr 11 2022 at 22:08)</a>:</h4>
<p>Different question, if either of you can answer this one:<br>
what the hell is going on with "<code>maybe_sysroot</code>"?</p>



<a name="278623686"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Runtool-based%20rustdoc%20test%20sample%3F/near/278623686" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Runtool-based.20rustdoc.20test.20sample.3F.html#278623686">(Apr 11 2022 at 22:08)</a>:</h4>
<p>Can I assume that will always be <code>Some</code> if we're bothering with doctests?</p>



<a name="278624446"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Runtool-based%20rustdoc%20test%20sample%3F/near/278624446" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Runtool-based.20rustdoc.20test.20sample.3F.html#278624446">(Apr 11 2022 at 22:17)</a>:</h4>
<p><code>maybe_sysroot</code> is the <code>--sysroot</code> argument. It is None if you don't pass <code>--sysroot</code>.</p>



<a name="278625288"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Runtool-based%20rustdoc%20test%20sample%3F/near/278625288" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Runtool-based.20rustdoc.20test.20sample.3F.html#278625288">(Apr 11 2022 at 22:26)</a>:</h4>
<p>ah I want the sysroot from<br>
session...</p>



<a name="278625710"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Runtool-based%20rustdoc%20test%20sample%3F/near/278625710" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Runtool-based.20rustdoc.20test.20sample.3F.html#278625710">(Apr 11 2022 at 22:31)</a>:</h4>
<blockquote>
<p>How would you suggest doing wasm doctests if not with <code>--runtool</code>?</p>
</blockquote>
<p>Running tests for non-native platforms seems inherently cursed and I don't see why it needs to be a doctest instead of an integration test</p>



<a name="278626476"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Runtool-based%20rustdoc%20test%20sample%3F/near/278626476" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Runtool-based.20rustdoc.20test.20sample.3F.html#278626476">(Apr 11 2022 at 22:40)</a>:</h4>
<p>gggguh, this function isn't from the perspective of "inside" the compiler but rather constructing one to run, so I can't introspect on the compiler's sysroot.</p>



<a name="278626752"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Runtool-based%20rustdoc%20test%20sample%3F/near/278626752" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Runtool-based.20rustdoc.20test.20sample.3F.html#278626752">(Apr 11 2022 at 22:44)</a>:</h4>
<p><span class="user-mention" data-user-id="281757">@Jubilee</span> why do you need to know the sysroot?</p>



<a name="278626796"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Runtool-based%20rustdoc%20test%20sample%3F/near/278626796" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Runtool-based.20rustdoc.20test.20sample.3F.html#278626796">(Apr 11 2022 at 22:44)</a>:</h4>
<p>Because I wanted to use <code>Target::search</code> to construct a target.</p>



<a name="278626848"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Runtool-based%20rustdoc%20test%20sample%3F/near/278626848" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Runtool-based.20rustdoc.20test.20sample.3F.html#278626848">(Apr 11 2022 at 22:45)</a>:</h4>
<p>I could cut straight to the target json path and load it and then create the target from JSON, I guess.</p>



<a name="278626948"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Runtool-based%20rustdoc%20test%20sample%3F/near/278626948" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Runtool-based.20rustdoc.20test.20sample.3F.html#278626948">(Apr 11 2022 at 22:46)</a>:</h4>
<p>(deleted)</p>



<a name="278627499"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Runtool-based%20rustdoc%20test%20sample%3F/near/278627499" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Runtool-based.20rustdoc.20test.20sample.3F.html#278627499">(Apr 11 2022 at 22:53)</a>:</h4>
<p>the secret is I am actually trying to figure out what code from the compiler rustdoc should be using.</p>



<a name="278627554"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Runtool-based%20rustdoc%20test%20sample%3F/near/278627554" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Runtool-based.20rustdoc.20test.20sample.3F.html#278627554">(Apr 11 2022 at 22:54)</a>:</h4>
<p>so that there is in fact a unified interface.</p>



<a name="278627963"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Runtool-based%20rustdoc%20test%20sample%3F/near/278627963" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Runtool-based.20rustdoc.20test.20sample.3F.html#278627963">(Apr 11 2022 at 22:59)</a>:</h4>
<p>Mmm, so this code spawns a compiler, but <code>rustc_session::output::out_filename</code> depends on having <code>&amp;Session</code>, which is incorrect if we reference our session and then spawn another one...</p>



<a name="278628184"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Runtool-based%20rustdoc%20test%20sample%3F/near/278628184" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Runtool-based.20rustdoc.20test.20sample.3F.html#278628184">(Apr 11 2022 at 23:00)</a>:</h4>
<p>This code should probably not be spawning a compiler like this, am I correct?</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>