<html>
<head><meta charset="utf-8"><title>internal compiler error[E0391]; causes delay_span_bug · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html">internal compiler error[E0391]; causes delay_span_bug</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://rust-lang.github.io/zulip_archive/style.css" rel="stylesheet"></head>

<a name="203573699"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203573699" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203573699">(Jul 11 2020 at 01:18)</a>:</h4>
<p>In <a href="https://github.com/rust-lang/rust/pull/73566">https://github.com/rust-lang/rust/pull/73566</a>, the following code causes an ICE in rustdoc:</p>
<div class="codehilite"><pre><span></span><code><span class="k">enum</span> <span class="nc">E</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">V</span><span class="p">(</span><span class="n">E</span><span class="p">),</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code>error: internal compiler error[E0391]: cycle detected when computing `Sized` constraints for `E`
 --&gt; src/lib.rs:1:1
  |
1 | enum E {
  | ^^^^^^
  |
  = note: ...which again requires computing `Sized` constraints for `E`, completing the cycle
  = note: cycle used when evaluating trait selection obligation `E: std::convert::From&lt;E&gt;`

error: internal compiler error: TyKind::Error constructed but no error reported
</code></pre></div>


<p>I have two questions.</p>
<ol>
<li>Why is this an ICE instead of a normal error? When I use <code>cargo check</code> instead of <code>cargo doc</code> this instead gives <code>error[E0072]: recursive type 'E' has infinite size</code>, without the ICE.</li>
<li>Why does this give a secondary delay_span_bug?</li>
</ol>
<p>I don't see how this is related to my changes :/ The only thing I can think of that's related is I removed a call to <code>tcx.analysis()</code>.</p>



<a name="203574368"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203574368" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203574368">(Jul 11 2020 at 01:37)</a>:</h4>
<p><span class="user-mention" data-user-id="232545">@Joshua Nelson</span> did you get query stacks for each of those?</p>



<a name="203574413"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203574413" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203574413">(Jul 11 2020 at 01:38)</a>:</h4>
<p>(i.e. <code>-Z treat-err-as-bug=0</code> and <code>-Z treat-err-as-bug=1</code>, separately. or maybe 1 and 2, I forget how we count that)</p>



<a name="203574416"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203574416" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203574416">(Jul 11 2020 at 01:38)</a>:</h4>
<p>I suspect it is because you're not running some parts of type-checking</p>



<a name="203574425"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203574425" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203574425">(Jul 11 2020 at 01:39)</a>:</h4>
<p>the cycle error is weird but may be due to one of the cycle-"catching" situations where it's only allowed through requiring that compilation does not succeed</p>



<a name="203574484"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203574484" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203574484">(Jul 11 2020 at 01:40)</a>:</h4>
<p>(since successful cycles can have their results depend on which query in the cycle was the first one queried, and is generally unsound, especially wrt incremental or parallel compilation)</p>



<a name="203574522"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203574522" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203574522">(Jul 11 2020 at 01:41)</a>:</h4>
<p><span class="user-mention" data-user-id="232545">@Joshua Nelson</span> what I'm thinking about is that <code>rustc_typeck::check</code> calls a few things, and you want some, or even all, of them other than the "item bodies" one (the one calling <code>typeck_tables_of</code> on everything)</p>



<a name="203574567"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203574567" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203574567">(Jul 11 2020 at 01:42)</a>:</h4>
<p><code>-Z treat-err-as-bug</code> doesn't work - passing =1 panics on the call to delay_span bug, and passing =2 panics when the delay span bug is reported</p>



<a name="203574574"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203574574" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203574574">(Jul 11 2020 at 01:43)</a>:</h4>
<div class="codehilite"><pre><span></span><code>$ rustdoc +stage1 lib.rs -Z treat-err-as-bug
error: internal compiler error: TyKind::Error constructed but no error reported

thread &#39;rustc&#39; panicked at &#39;aborting due to `-Z treat-err-as-bug=1`&#39;, src/librustc_errors/lib.rs:942:13
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
</code></pre></div>



<a name="203574577"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203574577" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203574577">(Jul 11 2020 at 01:43)</a>:</h4>
<div class="codehilite"><pre><span></span><code>rustdoc +stage1 lib.rs -Z treat-err-as-bug=2
error: internal compiler error[E0391]: cycle detected when computing `Sized` constraints for `E`
 --&gt; lib.rs:1:1
  |
1 | enum E {
  | ^^^^^^
  |
  = note: ...which again requires computing `Sized` constraints for `E`, completing the cycle
  = note: cycle used when evaluating trait selection obligation `E: std::convert::From&lt;E&gt;`

error: internal compiler error: TyKind::Error constructed but no error reported
  |
  = note: delayed at /home/joshua/src/rust/src/librustc_session/session.rs:436:9

thread &#39;rustc&#39; panicked at &#39;aborting after 2 errors due to `-Z treat-err-as-bug=2`&#39;, src/librustc_errors/lib.rs:942:13
</code></pre></div>



<a name="203574587"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203574587" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203574587">(Jul 11 2020 at 01:44)</a>:</h4>
<blockquote>
<p>what I'm thinking about is that rustc_typeck::check calls a few things, and you want some, or even all, of them other than the "item bodies" one (the one calling typeck_tables_of on everything)</p>
</blockquote>
<p>hmm, I can see if I can run everything except item-bodies checking</p>



<a name="203574627"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203574627" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203574627">(Jul 11 2020 at 01:44)</a>:</h4>
<blockquote>
<p>panics on the call to delay_span bug</p>
</blockquote>
<p>that's what you want, yes</p>



<a name="203574628"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203574628" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203574628">(Jul 11 2020 at 01:44)</a>:</h4>
<p>ideally of course it wouldn't matter which order queries are called in but I've spent enough time on this I just want it to work lol</p>



<a name="203574639"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203574639" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203574639">(Jul 11 2020 at 01:45)</a>:</h4>
<p>ok, with =1 the query stack is</p>
<div class="codehilite"><pre><span></span><code>query stack during panic:
#0 [adt_sized_constraint] computing `Sized` constraints for `E`
#1 [evaluate_obligation] evaluating trait selection obligation `E: std::convert::From&lt;E&gt;`
end of query stack
</code></pre></div>



<a name="203574643"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203574643" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203574643">(Jul 11 2020 at 01:45)</a>:</h4>
<p>that checks out</p>



<a name="203574648"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203574648" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203574648">(Jul 11 2020 at 01:45)</a>:</h4>
<p>so anything that could possibly end up checking if <code>E: Sized</code> will hit this</p>



<a name="203574695"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203574695" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203574695">(Jul 11 2020 at 01:46)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug/near/203574587">said</a>:</p>
<blockquote>
<blockquote>
<p>what I'm thinking about is that rustc_typeck::check calls a few things, and you want some, or even all, of them other than the "item bodies" one (the one calling typeck_tables_of on everything)</p>
</blockquote>
<p>hmm, I can see if I can run everything except item-bodies checking</p>
</blockquote>
<p>oh wait I already figured out how to do this nonintrusively</p>



<a name="203574701"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203574701" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203574701">(Jul 11 2020 at 01:46)</a>:</h4>
<p>you just ended up removing <code>tcx.analysis()</code> instead</p>



<a name="203574704"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203574704" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203574704">(Jul 11 2020 at 01:47)</a>:</h4>
<p>so you didn't need the other thing</p>



<a name="203574709"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203574709" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203574709">(Jul 11 2020 at 01:47)</a>:</h4>
<p><span class="user-mention" data-user-id="232545">@Joshua Nelson</span> okay so you can do to <code>typeck_item_bodies</code> the same thing you did to <code>lint_mod</code></p>



<a name="203574712"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203574712" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203574712">(Jul 11 2020 at 01:47)</a>:</h4>
<p>meaning it becomes a noop</p>



<a name="203574714"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203574714" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203574714">(Jul 11 2020 at 01:47)</a>:</h4>
<p>ok, and all other checks will still run</p>



<a name="203574719"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203574719" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203574719">(Jul 11 2020 at 01:47)</a>:</h4>
<p>and then you can call <a href="https://github.com/rust-lang/rust/blob/master/src/librustc_typeck/lib.rs#L321">https://github.com/rust-lang/rust/blob/master/src/librustc_typeck/lib.rs#L321</a></p>



<a name="203574760"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203574760" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203574760">(Jul 11 2020 at 01:48)</a>:</h4>
<p>why am I calling <code>check_crate()</code> instead of <code>analysis()</code>?</p>



<a name="203574762"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203574762" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203574762">(Jul 11 2020 at 01:48)</a>:</h4>
<p>doesn't <code>analysis</code> include lints?</p>



<a name="203574771"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203574771" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203574771">(Jul 11 2020 at 01:49)</a>:</h4>
<p>I mean you could, but there's a risk you might need another full crater run :P</p>



<a name="203574772"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203574772" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203574772">(Jul 11 2020 at 01:49)</a>:</h4>
<p>ugh</p>



<a name="203574775"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203574775" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203574775">(Jul 11 2020 at 01:49)</a>:</h4>
<p>ok let me rephrase - why does check_crate do less work than analysis?</p>



<a name="203574780"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203574780" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203574780">(Jul 11 2020 at 01:49)</a>:</h4>
<p>because it's this line <a href="https://github.com/rust-lang/rust/blob/master/src/librustc_interface/passes.rs#L857">https://github.com/rust-lang/rust/blob/master/src/librustc_interface/passes.rs#L857</a></p>



<a name="203574823"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203574823" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203574823">(Jul 11 2020 at 01:50)</a>:</h4>
<p>got it</p>



<a name="203574824"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203574824" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203574824">(Jul 11 2020 at 01:50)</a>:</h4>
<p>of a 123-line function :P</p>



<a name="203574829"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203574829" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203574829">(Jul 11 2020 at 01:50)</a>:</h4>
<p>oh it'd also try to do MIR borrowck and other fun stuff, lol</p>



<a name="203574835"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203574835" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203574835">(Jul 11 2020 at 01:50)</a>:</h4>
<p>even generating MIR at all would result in type-checking the body</p>



<a name="203575233"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203575233" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203575233">(Jul 11 2020 at 02:02)</a>:</h4>
<p>yay that worked <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span></p>



<a name="203575240"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203575240" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203575240">(Jul 11 2020 at 02:03)</a>:</h4>
<p>sweet!</p>



<a name="203575241"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203575241" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203575241">(Jul 11 2020 at 02:03)</a>:</h4>
<p>let me make sure it still doesn't look at function bodies</p>



<a name="203575324"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203575324" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203575324">(Jul 11 2020 at 02:05)</a>:</h4>
<p>ugh</p>
<div class="codehilite"><pre><span></span><code>error[E0433]: failed to resolve: could not resolve path `content::should::be::irrelevant`
  --&gt; /home/joshua/src/rust/src/test/rustdoc/doc-cfg.rs:23:9
   |
23 |         content::should::be::irrelevant();
   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ could not resolve path `content::should::be::irrelevant`
   |
   = note: this error was originally ignored because you are running `rustdoc`
   = note: try running again with `rustc` or `cargo check` and you may get a more detailed error
</code></pre></div>



<a name="203575374"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203575374" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203575374">(Jul 11 2020 at 02:06)</a>:</h4>
<p>oh wait I forgot to override typeck_item_bodies lol</p>



<a name="203575443"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203575443" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203575443">(Jul 11 2020 at 02:08)</a>:</h4>
<p>nope, still gives errors</p>



<a name="203575596"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203575596" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203575596">(Jul 11 2020 at 02:13)</a>:</h4>
<p>I guess I can do this the hard way and make the <code>evaluate_obligation</code> query call typeck first?</p>



<a name="203575599"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203575599" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203575599">(Jul 11 2020 at 02:13)</a>:</h4>
<p>not even sure if that would do what I want</p>



<a name="203579346"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203579346" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203579346">(Jul 11 2020 at 04:06)</a>:</h4>
<p>uhhhh</p>



<a name="203579348"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203579348" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203579348">(Jul 11 2020 at 04:06)</a>:</h4>
<p><span class="user-mention" data-user-id="232545">@Joshua Nelson</span> what's happening?</p>



<a name="203579350"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203579350" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203579350">(Jul 11 2020 at 04:06)</a>:</h4>
<p>when I ran typeck again it looked at function bodies :(</p>



<a name="203579355"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203579355" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203579355">(Jul 11 2020 at 04:06)</a>:</h4>
<p>if you overrode <code>typeck_item_bodies</code> you shouldn't have problems I don't think. but you can always use <code>-Z treat-err-as-bug</code> to see what queried typeck</p>



<a name="203579361"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203579361" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203579361">(Jul 11 2020 at 04:07)</a>:</h4>
<p>I don't think you can assume anything before checking that, who knows what it might be</p>



<a name="203579365"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203579365" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203579365">(Jul 11 2020 at 04:07)</a>:</h4>
<p>ok, let me check</p>



<a name="203579411"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203579411" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203579411">(Jul 11 2020 at 04:09)</a>:</h4>
<div class="codehilite"><pre><span></span><code>query stack during panic:
#0 [typeck_tables_of] type-checking `unix_only::unix_only_function`
#1 [used_trait_imports] used_trait_imports `unix_only::unix_only_function`
end of query stack
</code></pre></div>



<a name="203579414"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203579414" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203579414">(Jul 11 2020 at 04:09)</a>:</h4>
<p>hehehe, nice</p>



<a name="203579416"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203579416" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203579416">(Jul 11 2020 at 04:09)</a>:</h4>
<p>so it looks like it's running lints even though I told it not to?</p>



<a name="203579417"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203579417" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203579417">(Jul 11 2020 at 04:09)</a>:</h4>
<p>doubtful</p>



<a name="203579458"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203579458" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203579458">(Jul 11 2020 at 04:10)</a>:</h4>
<p>it's <a href="https://github.com/rust-lang/rust/blob/master/src/librustc_typeck/check_unused.rs">https://github.com/rust-lang/rust/blob/master/src/librustc_typeck/check_unused.rs</a></p>



<a name="203579467"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203579467" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203579467">(Jul 11 2020 at 04:11)</a>:</h4>
<p>you have two options</p>



<a name="203579471"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203579471" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203579471">(Jul 11 2020 at 04:11)</a>:</h4>
<p>you either override <code>used_trait_imports</code> to return an empty set and hope the lint does nothing</p>



<a name="203579476"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203579476" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203579476">(Jul 11 2020 at 04:11)</a>:</h4>
<p>or you querify <code>check_unused</code></p>



<a name="203579514"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203579514" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203579514">(Jul 11 2020 at 04:12)</a>:</h4>
<p>wait, it's not currently a query?</p>



<a name="203579516"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203579516" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203579516">(Jul 11 2020 at 04:12)</a>:</h4>
<p>I mean this <a href="https://github.com/rust-lang/rust/blob/master/src/librustc_typeck/lib.rs#L367">https://github.com/rust-lang/rust/blob/master/src/librustc_typeck/lib.rs#L367</a></p>



<a name="203579517"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203579517" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203579517">(Jul 11 2020 at 04:12)</a>:</h4>
<p>I'd call it <code>check_unused_post_typeck</code></p>



<a name="203579519"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203579519" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203579519">(Jul 11 2020 at 04:13)</a>:</h4>
<p>or <code>check_unused_traits_and_crates</code></p>



<a name="203579522"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203579522" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203579522">(Jul 11 2020 at 04:13)</a>:</h4>
<p>(for the lint name)</p>



<a name="203579525"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203579525" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203579525">(Jul 11 2020 at 04:13)</a>:</h4>
<p>not actually sure it's worth it tbh</p>



<a name="203579527"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203579527" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203579527">(Jul 11 2020 at 04:13)</a>:</h4>
<p>it might be easier to just try overriding <code>used_trait_imports</code> to return <code>Default::default()</code> or w/e</p>



<a name="203579528"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203579528" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203579528">(Jul 11 2020 at 04:13)</a>:</h4>
<p>let me try the empty set thing first, yeah</p>



<a name="203579567"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203579567" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203579567">(Jul 11 2020 at 04:14)</a>:</h4>
<p>I feel like I keep shaving more yaks :/</p>



<a name="203579568"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203579568" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203579568">(Jul 11 2020 at 04:14)</a>:</h4>
<p>lol <a href="https://github.com/rust-lang/rust/blob/master/src/librustc_typeck/check/mod.rs#L843-L845">https://github.com/rust-lang/rust/blob/master/src/librustc_typeck/check/mod.rs#L843-L845</a></p>



<a name="203579608"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203579608" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203579608">(Jul 11 2020 at 04:16)</a>:</h4>
<p>uhhhhhh</p>



<a name="203579624"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203579624" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203579624">(Jul 11 2020 at 04:16)</a>:</h4>
<p>someone did a clever thing that actually makes this worse</p>



<a name="203579633"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203579633" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203579633">(Jul 11 2020 at 04:17)</a>:</h4>
<p>oh noes it's not actually possible to allocate it globally</p>



<a name="203579691"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203579691" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203579691">(Jul 11 2020 at 04:18)</a>:</h4>
<p><span class="user-mention" data-user-id="232545">@Joshua Nelson</span> so you'll uhh need a <code>lazy_static!</code> that uses <code>Box::leak</code> to create a <code>&amp;'static FxHashSet&lt;LocalDefId&gt;</code></p>



<a name="203579692"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203579692" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203579692">(Jul 11 2020 at 04:18)</a>:</h4>
<p>it's not that bad just weird</p>



<a name="203579697"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203579697" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203579697">(Jul 11 2020 at 04:19)</a>:</h4>
<p>why can't I use <code>static map: HashMap</code>?</p>



<a name="203579723"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203579723" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203579723">(Jul 11 2020 at 04:19)</a>:</h4>
<p>oh ugh default() isn't a const fn</p>



<a name="203579784"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203579784" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203579784">(Jul 11 2020 at 04:21)</a>:</h4>
<p>do you know why <code>new()</code> isn't being found?</p>
<div class="codehilite"><pre><span></span><code><span class="n">error</span><span class="p">[</span><span class="n">E0599</span><span class="p">]</span>: <span class="nc">no</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">associated</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="n">named</span><span class="w"> </span><span class="err">`</span><span class="n">new</span><span class="err">`</span><span class="w"> </span><span class="n">found</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="k">struct</span> <span class="err">`</span><span class="n">std</span>::<span class="n">collections</span>::<span class="n">HashSet</span><span class="o">&lt;</span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="n">std</span>::<span class="n">hash</span>::<span class="n">BuildHasherDefault</span><span class="o">&lt;</span><span class="n">rustc_data_structures</span>::<span class="n">fx</span>::<span class="n">FxHasher</span><span class="o">&gt;&gt;</span><span class="err">`</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">current</span><span class="w"> </span><span class="n">scope</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">librustdoc</span><span class="o">/</span><span class="n">core</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">367</span>:<span class="mi">52</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">367</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="k">static</span><span class="w"> </span><span class="n">map</span>: <span class="nc">FxHashSet</span><span class="o">&lt;</span><span class="n">LocalDefId</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FxHashSet</span>::<span class="n">new</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">                                                    </span><span class="o">^^^</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">associated</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">found</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="err">`</span><span class="n">std</span>::<span class="n">collections</span>::<span class="n">HashSet</span><span class="o">&lt;</span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="n">std</span>::<span class="n">hash</span>::<span class="n">BuildHasherDefault</span><span class="o">&lt;</span><span class="n">rustc_data_structures</span>::<span class="n">fx</span>::<span class="n">FxHasher</span><span class="o">&gt;&gt;</span><span class="err">`</span><span class="w"></span>
</code></pre></div>



<a name="203579792"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203579792" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203579792">(Jul 11 2020 at 04:22)</a>:</h4>
<p>oh ugh _every_ method in std is only implemented for <code>RandomState</code> hashers</p>



<a name="203579829"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203579829" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203579829">(Jul 11 2020 at 04:22)</a>:</h4>
<p>whyy</p>



<a name="203579838"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203579838" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203579838">(Jul 11 2020 at 04:22)</a>:</h4>
<p>rustdoc doesn't even have a lazy static dependency yet</p>



<a name="203579921"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203579921" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203579921">(Jul 11 2020 at 04:24)</a>:</h4>
<p>I didn't need the Box::leak though</p>



<a name="203579987"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203579987" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203579987">(Jul 11 2020 at 04:26)</a>:</h4>
<p>ok, that finally did it</p>



<a name="203579988"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203579988" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203579988">(Jul 11 2020 at 04:26)</a>:</h4>
<p>it's not <code>new</code>, it's <code>default</code></p>



<a name="203579989"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203579989" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203579989">(Jul 11 2020 at 04:26)</a>:</h4>
<p>default goes through the trait</p>



<a name="203579992"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203579992" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203579992">(Jul 11 2020 at 04:26)</a>:</h4>
<p>what did you write?</p>



<a name="203579993"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203579993" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203579993">(Jul 11 2020 at 04:26)</a>:</h4>
<p>so you can't use it in <code>static</code></p>



<a name="203579994"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203579994" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203579994">(Jul 11 2020 at 04:27)</a>:</h4>
<p>surely you can't allocate <em>a hash table</em> in a <code>static</code>??</p>



<a name="203580001"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580001" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580001">(Jul 11 2020 at 04:27)</a>:</h4>
<p>I don't see why you can't allocate an empty one</p>



<a name="203580005"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580005" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580005">(Jul 11 2020 at 04:27)</a>:</h4>
<p>but in any case I ended up with</p>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">lazy_static</span><span class="o">!</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="n">EMPTY_MAP</span>: <span class="nc">FxHashSet</span><span class="o">&lt;</span><span class="n">LocalDefId</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FxHashSet</span>::<span class="n">default</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="203580006"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580006" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580006">(Jul 11 2020 at 04:27)</a>:</h4>
<p>oh did we make them free to do so? but then....</p>



<a name="203580011"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580011" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580011">(Jul 11 2020 at 04:27)</a>:</h4>
<p>yeah that's what I'd expect</p>



<a name="203580012"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580012" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580012">(Jul 11 2020 at 04:27)</a>:</h4>
<p>but that's not <code>&amp;'static</code></p>



<a name="203580013"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580013" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580013">(Jul 11 2020 at 04:27)</a>:</h4>
<p>... isn't it?</p>



<a name="203580050"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580050" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580050">(Jul 11 2020 at 04:28)</a>:</h4>
<p>this compiled at least</p>
<div class="codehilite"><pre><span></span><code><span class="w">            </span><span class="n">local_providers</span><span class="p">.</span><span class="n">used_trait_imports</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">|</span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="o">|</span><span class="w"> </span><span class="o">&amp;</span><span class="n">EMPTY_MAP</span><span class="p">;</span><span class="w"></span>
</code></pre></div>



<a name="203580051"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580051" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580051">(Jul 11 2020 at 04:28)</a>:</h4>
<p>I mean... hmm</p>



<a name="203580057"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580057" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580057">(Jul 11 2020 at 04:28)</a>:</h4>
<p>that's kind of weird</p>



<a name="203580058"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580058" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580058">(Jul 11 2020 at 04:28)</a>:</h4>
<p>(based on how <code>lazy-static</code> works, I mean)</p>



<a name="203580066"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580066" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580066">(Jul 11 2020 at 04:28)</a>:</h4>
<p>I guess <code>&amp;EMPTY_MAP</code> is <code>&amp;'static TheLazyStaticWrapper</code> before getting deref-coerced huh</p>



<a name="203580071"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580071" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580071">(Jul 11 2020 at 04:29)</a>:</h4>
<p>that's a new trick for me I guess</p>



<a name="203580189"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580189" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580189">(Jul 11 2020 at 04:32)</a>:</h4>
<p>ok I <em>think</em> this should have fixed these issues <a href="https://github.com/rust-lang/rust/pull/73566/commits/a0086bee32de2b5c56a4e335a6e77323779fc83b">https://github.com/rust-lang/rust/pull/73566/commits/a0086bee32de2b5c56a4e335a6e77323779fc83b</a></p>



<a name="203580197"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580197" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580197">(Jul 11 2020 at 04:33)</a>:</h4>
<p>oh oops I forgot to commit comments</p>



<a name="203580202"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580202" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580202">(Jul 11 2020 at 04:33)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/pull/73566/commits/8008607fdce30d4cdd96e7871b65cb1c432a5fcb">https://github.com/rust-lang/rust/pull/73566/commits/8008607fdce30d4cdd96e7871b65cb1c432a5fcb</a></p>



<a name="203580257"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580257" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580257">(Jul 11 2020 at 04:34)</a>:</h4>
<blockquote>
<p>Some queries are buggy and require that they only run on valid types:</p>
</blockquote>
<p>this doesn't sound right?</p>



<a name="203580266"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580266" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580266">(Jul 11 2020 at 04:35)</a>:</h4>
<p>well, maybe buggy is the wrong word</p>



<a name="203580267"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580267" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580267">(Jul 11 2020 at 04:35)</a>:</h4>
<p>there's nothing buggy about the query, you're just not emitting errors</p>



<a name="203580269"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580269" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580269">(Jul 11 2020 at 04:35)</a>:</h4>
<blockquote>
<p>you're just not emitting errors</p>
</blockquote>
<p>I don't think that's related? This happened in code without resolution errors</p>



<a name="203580270"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580270" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580270">(Jul 11 2020 at 04:35)</a>:</h4>
<p>there's a lot of code in rustc that uses <code>delay_span_bug</code> and expecting something else produced an error</p>



<a name="203580272"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580272" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580272">(Jul 11 2020 at 04:36)</a>:</h4>
<p>resolution errors are just the case that you're injecting directly by ignoring them in <code>rustc_resolve</code></p>



<a name="203580309"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580309" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580309">(Jul 11 2020 at 04:36)</a>:</h4>
<p>there's a lot more stuff using <code>delay_span_bug</code></p>



<a name="203580313"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580313" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580313">(Jul 11 2020 at 04:36)</a>:</h4>
<p>I don't think I touched the other stuff though ...</p>



<a name="203580316"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580316" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580316">(Jul 11 2020 at 04:36)</a>:</h4>
<p>you did by not running any typeck</p>



<a name="203580322"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580322" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580322">(Jul 11 2020 at 04:37)</a>:</h4>
<p>like, when you removed <code>tcx.analysis()</code>, that prevented critical checks from running</p>



<a name="203580325"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580325" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580325">(Jul 11 2020 at 04:37)</a>:</h4>
<p>which other parts of the compiler safeguard against missing errors with <code>delay_span_bug</code></p>



<a name="203580329"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580329" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580329">(Jul 11 2020 at 04:37)</a>:</h4>
<p>maybe I should explain this less abstractly</p>



<a name="203580369"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580369" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580369">(Jul 11 2020 at 04:38)</a>:</h4>
<p>the reason I'm calling this buggy is because the other query should have called <code>typeck::check_crate</code> if it depends on that being run</p>



<a name="203580372"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580372" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580372">(Jul 11 2020 at 04:38)</a>:</h4>
<p>it doesn't depend on it in a stateful sense</p>



<a name="203580373"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580373" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580373">(Jul 11 2020 at 04:38)</a>:</h4>
<p>or in a dataflow sense</p>



<a name="203580374"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580374" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580374">(Jul 11 2020 at 04:38)</a>:</h4>
<p>it depends on it in a contracts sense</p>



<a name="203580375"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580375" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580375">(Jul 11 2020 at 04:38)</a>:</h4>
<p>"this query can only be called on types that are valid"</p>



<a name="203580376"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580376" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580376">(Jul 11 2020 at 04:38)</a>:</h4>
<p>there's a lot of stuff like this:</p>
<div class="codehilite"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="n">impossible_state</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">delay_span_bug</span><span class="p">(</span><span class="s">&quot;uh oh we didn&#39;t catch some error somewhere else&quot;</span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="203580379"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580379" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580379">(Jul 11 2020 at 04:39)</a>:</h4>
<p>hmm</p>



<a name="203580380"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580380" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580380">(Jul 11 2020 at 04:39)</a>:</h4>
<p>it may not even know what would be supposed to emit the error or what error</p>



<a name="203580381"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580381" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580381">(Jul 11 2020 at 04:39)</a>:</h4>
<p>just that it saw something that should never happen <em>unless</em> there is an error <em>somewhere</em></p>



<a name="203580384"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580384" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580384">(Jul 11 2020 at 04:39)</a>:</h4>
<p>and it's not like depending on <code>tcx.analysis()</code> or a subset of it would even make sense: it would trivially lead to cycle errors</p>



<a name="203580423"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580423" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580423">(Jul 11 2020 at 04:40)</a>:</h4>
<p>and analysis always runs so it doesn't even make sense</p>



<a name="203580428"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580428" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580428">(Jul 11 2020 at 04:40)</a>:</h4>
<blockquote>
<p>analysis always runs</p>
</blockquote>
<p>ah this is the bit I was missing</p>



<a name="203580433"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580433" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580433">(Jul 11 2020 at 04:40)</a>:</h4>
<p>I mean, you literally had to take it out of <code>rustdoc</code>?</p>



<a name="203580436"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580436" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580436">(Jul 11 2020 at 04:40)</a>:</h4>
<p>normally it's always there</p>



<a name="203580438"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580438" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580438">(Jul 11 2020 at 04:40)</a>:</h4>
<p>right, I didn't realize it was an invariant that it runs</p>



<a name="203580439"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580439" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580439">(Jul 11 2020 at 04:40)</a>:</h4>
<p>anyway, the "delay" in <code>delay_span_bug</code> refers to the fact that it handles the error being emitted in the future of the detection</p>



<a name="203580454"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580454" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580454">(Jul 11 2020 at 04:41)</a>:</h4>
<p>I don't follow, sorry</p>



<a name="203580455"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580455" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580455">(Jul 11 2020 at 04:41)</a>:</h4>
<p>it "poisons" the current compilation session in a sense</p>



<a name="203580495"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580495" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580495">(Jul 11 2020 at 04:42)</a>:</h4>
<p>my understanding was that it's like a drop bomb, if you continue without saying "no I checked this is valid" then it panics</p>



<a name="203580496"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580496" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580496">(Jul 11 2020 at 04:42)</a>:</h4>
<p>ah no it's not in the same sense</p>



<a name="203580499"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580499" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580499">(Jul 11 2020 at 04:42)</a>:</h4>
<p>the only requirement for <code>delay_span_bug</code> to not cause an ICE is <em>any</em> error to be emitted <em>by anything</em></p>



<a name="203580500"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580500" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580500">(Jul 11 2020 at 04:42)</a>:</h4>
<p>at <em>any point</em> in time</p>



<a name="203580501"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580501" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580501">(Jul 11 2020 at 04:42)</a>:</h4>
<p>during the same compilation session</p>



<a name="203580503"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580503" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580503">(Jul 11 2020 at 04:42)</a>:</h4>
<p>ahhh</p>



<a name="203580508"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580508" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580508">(Jul 11 2020 at 04:43)</a>:</h4>
<p>this is why it was so important that my error test cases be in separate files</p>



<a name="203580513"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580513" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580513">(Jul 11 2020 at 04:43)</a>:</h4>
<p>okay yeah sorry for not explaining this properly before</p>



<a name="203580517"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580517" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580517">(Jul 11 2020 at 04:43)</a>:</h4>
<p>the name could maybe use some workshopping lol</p>



<a name="203580518"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580518" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580518">(Jul 11 2020 at 04:43)</a>:</h4>
<p>I thought it was per-error, not per-session</p>



<a name="203580521"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580521" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580521">(Jul 11 2020 at 04:43)</a>:</h4>
<p>since I doubt it has changed since it was added and it was probably added as a hack</p>



<a name="203580524"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580524" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580524">(Jul 11 2020 at 04:43)</a>:</h4>
<p>ah no, there doesn't have to be any correlation for it to be silenced, just any error at all</p>



<a name="203580561"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580561" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580561">(Jul 11 2020 at 04:44)</a>:</h4>
<p>this allows us to use it aggressively as a safeguard against broken invariants</p>



<a name="203580566"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580566" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580566">(Jul 11 2020 at 04:44)</a>:</h4>
<p>and it's free if any error has already been emitted, since it's eagerly ignored, and not buffered at all (which is arguably not useful to optimize for)</p>



<a name="203580574"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580574" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580574">(Jul 11 2020 at 04:45)</a>:</h4>
<p>I see, so any time you call delay_span_bug() you're saying "there's a broken invariant here" and compilation can't continue much further</p>



<a name="203580583"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580583" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580583">(Jul 11 2020 at 04:45)</a>:</h4>
<p>so for example <span class="user-mention" data-user-id="198054">@mark-i-m</span> put a lot of effort into switching our <code>Ty::Error</code> case to trigger a <code>delay_span_bug</code>, making it a strong indicator of "this compilation will fail"</p>



<a name="203580587"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580587" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580587">(Jul 11 2020 at 04:45)</a>:</h4>
<p>ok this makes sense why the query expected the type to be valid</p>



<a name="203580589"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580589" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580589">(Jul 11 2020 at 04:45)</a>:</h4>
<p><span class="user-mention" data-user-id="232545">@Joshua Nelson</span> it can continue pretty far, just not exit successfully :P</p>



<a name="203580631"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580631" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580631">(Jul 11 2020 at 04:46)</a>:</h4>
<p>and presumably not emit link artifacts</p>



<a name="203580634"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580634" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580634">(Jul 11 2020 at 04:46)</a>:</h4>
<p>(since they might contain UB etc.)</p>



<a name="203580696"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580696" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580696">(Jul 11 2020 at 04:49)</a>:</h4>
<p>I'm a little concerned by how fragile this makes rustdoc</p>



<a name="203580698"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580698" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580698">(Jul 11 2020 at 04:49)</a>:</h4>
<p>unrelated changes in other parts of the compiler could now cause tests to fail</p>



<a name="203580701"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203580701" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203580701">(Jul 11 2020 at 04:49)</a>:</h4>
<p>e.g. if a new lint adds typechecking</p>



<a name="203581857"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203581857" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203581857">(Jul 11 2020 at 05:29)</a>:</h4>
<p>eeeeeh</p>



<a name="203623079"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203623079" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203623079">(Jul 12 2020 at 02:03)</a>:</h4>
<p><span class="user-mention" data-user-id="232545">@Joshua Nelson</span> btw I was able to get the non-cached version to optimize :P</p>
<div class="codehilite"><pre><span></span><code><span class="k">ret</span> <span class="nv">%&quot;rustc_middle::ty::TyS&quot;</span><span class="p">*</span> <span class="p">(</span><span class="k">i64</span><span class="p">*,</span> <span class="k">i32</span><span class="p">,</span> <span class="k">i32</span><span class="p">)*</span> <span class="vg">@_ZN12rustc_typeck7collect7type_of7type_of17h576de94756ddadc8E</span>
</code></pre></div>



<a name="203623083"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203623083" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203623083">(Jul 12 2020 at 02:03)</a>:</h4>
<p>it's still calling <code>Providers::default()</code> because I forgot to make that <code>#[inline(always)]</code> as well =))</p>



<a name="203623425"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/internal%20compiler%20error%5BE0391%5D%3B%20causes%20delay_span_bug/near/203623425" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/internal.20compiler.20error.5BE0391.5D.3B.20causes.20delay_span_bug.html#203623425">(Jul 12 2020 at 02:14)</a>:</h4>
<p>oh oops I made a topic for that</p>



<hr><p>Last updated: Aug 07 2021 at 22:04 UTC</p>
</html>