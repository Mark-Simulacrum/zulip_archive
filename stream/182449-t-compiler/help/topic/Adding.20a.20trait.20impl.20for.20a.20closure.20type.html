<html>
<head><meta charset="utf-8"><title>Adding a trait impl for a closure type · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Adding.20a.20trait.20impl.20for.20a.20closure.20type.html">Adding a trait impl for a closure type</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="271246437"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Adding%20a%20trait%20impl%20for%20a%20closure%20type/near/271246437" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Xavier Denis <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Adding.20a.20trait.20impl.20for.20a.20closure.20type.html#271246437">(Feb 09 2022 at 08:56)</a>:</h4>
<p>Is there any way to add a <em>synthetic</em> (not in source) trait impl for a closure type through the apis? I can't do it at source level as closures have opaque types, but it would <em>really</em> simplify my life if it were possible to do it through the rustc apis at least</p>



<a name="271246637"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Adding%20a%20trait%20impl%20for%20a%20closure%20type/near/271246637" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Xavier Denis <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Adding.20a.20trait.20impl.20for.20a.20closure.20type.html#271246637">(Feb 09 2022 at 08:59)</a>:</h4>
<p>I  get the impression its not easily possible as it would require at the very least generating a fresh <code>DefId</code></p>



<a name="271323896"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Adding%20a%20trait%20impl%20for%20a%20closure%20type/near/271323896" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Adding.20a.20trait.20impl.20for.20a.20closure.20type.html#271323896">(Feb 09 2022 at 18:16)</a>:</h4>
<p>That kind of thing exists for closure <code>Clone</code> and <code>Copy</code>, at least</p>



<a name="271363622"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Adding%20a%20trait%20impl%20for%20a%20closure%20type/near/271363622" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Goulet (compiler-errors) <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Adding.20a.20trait.20impl.20for.20a.20closure.20type.html#271363622">(Feb 09 2022 at 23:31)</a>:</h4>
<p>any "impl" that doesn't correspond to a real impl in the source is special-cased in the candidate assembly/confirmation logic in rustc_trait_selection. i don't think there's any way of doing this for non-builtin traits...</p>



<a name="271363674"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Adding%20a%20trait%20impl%20for%20a%20closure%20type/near/271363674" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Goulet (compiler-errors) <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Adding.20a.20trait.20impl.20for.20a.20closure.20type.html#271363674">(Feb 09 2022 at 23:31)</a>:</h4>
<p>what are you trying to do, if you can give an example?</p>



<a name="271409523"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Adding%20a%20trait%20impl%20for%20a%20closure%20type/near/271409523" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Xavier Denis <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Adding.20a.20trait.20impl.20for.20a.20closure.20type.html#271409523">(Feb 10 2022 at 10:06)</a>:</h4>
<p>yea, I'm tryign to associate a <code>precondition</code> and <code>postcondition</code> function to every closure</p>



<a name="271409533"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Adding%20a%20trait%20impl%20for%20a%20closure%20type/near/271409533" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Xavier Denis <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Adding.20a.20trait.20impl.20for.20a.20closure.20type.html#271409533">(Feb 10 2022 at 10:06)</a>:</h4>
<p>through a trait</p>



<a name="271409594"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Adding%20a%20trait%20impl%20for%20a%20closure%20type/near/271409594" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Xavier Denis <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Adding.20a.20trait.20impl.20for.20a.20closure.20type.html#271409594">(Feb 10 2022 at 10:06)</a>:</h4>
<p>in the 'ideal world' it would look something like this:</p>
<div class="codehilite"><pre><span></span><code>trait FnOnceSpec : FnOnce {
  fn precondition(self) -&gt; bool;
  fn postcondition(self) -&gt; bool;
}
</code></pre></div>



<a name="271409684"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Adding%20a%20trait%20impl%20for%20a%20closure%20type/near/271409684" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Xavier Denis <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Adding.20a.20trait.20impl.20for.20a.20closure.20type.html#271409684">(Feb 10 2022 at 10:07)</a>:</h4>
<p>and I can provide an impl for every closure (unique to each closure ofc)</p>



<a name="271409767"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Adding%20a%20trait%20impl%20for%20a%20closure%20type/near/271409767" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Xavier Denis <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Adding.20a.20trait.20impl.20for.20a.20closure.20type.html#271409767">(Feb 10 2022 at 10:08)</a>:</h4>
<p>I could even write the rust syntax for the impl if we were allowed to refer to closure types</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>