<html>
<head><meta charset="utf-8"><title>position-independent-executables · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/position-independent-executables.html">position-independent-executables</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="263375059"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/position-independent-executables/near/263375059" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> joey <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/position-independent-executables.html#263375059">(Dec 01 2021 at 23:57)</a>:</h4>
<p>Hi,<br>
It seems I can't get position-independent-executables unless I make a target.json and have position-independent-executables: true in it, is there a way to do this at the command line? I have -C relocation-model=pic, but it doesn't seem like it's enough.</p>



<a name="263417060"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/position-independent-executables/near/263417060" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/position-independent-executables.html#263417060">(Dec 02 2021 at 10:24)</a>:</h4>
<p>You need <code>-Crelocation-model=pie</code>. See <a href="https://github.com/rust-lang/rust/issues/88820">#88820</a>.</p>



<a name="263489234"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/position-independent-executables/near/263489234" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> joey <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/position-independent-executables.html#263489234">(Dec 02 2021 at 19:30)</a>:</h4>
<p><span class="user-mention" data-user-id="133247">@bjorn3</span> problem is that 'aarch64-unknown-none-softfloat' doesn't have position-indepdendent-executables: true, so <a href="https://github.com/rust-lang/rust/blob/02063124f96aac10f8c5c70653242b0704d397e0/compiler/rustc_codegen_ssa/src/back/link.rs#L1530">https://github.com/rust-lang/rust/blob/02063124f96aac10f8c5c70653242b0704d397e0/compiler/rustc_codegen_ssa/src/back/link.rs#L1530</a> fails. and there' doesn't seem to be a way to pass that in</p>



<a name="263490917"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/position-independent-executables/near/263490917" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/position-independent-executables.html#263490917">(Dec 02 2021 at 19:45)</a>:</h4>
<p>Yeah, position-independent-executable:false indicates that the target doesn't support PIE executables, so rustc will refuse to make them. Why do you want a PIE executable for a bare-metal target? Executables with a DYN elf type (that includes PIE executables) need a crt object to perform relocations AFAIK.</p>



<a name="263491555"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/position-independent-executables/near/263491555" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> joey <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/position-independent-executables.html#263491555">(Dec 02 2021 at 19:50)</a>:</h4>
<p>well I don't mind if it's a static pie either, but I want to be able to be loaded at any address</p>



<a name="263491574"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/position-independent-executables/near/263491574" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> joey <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/position-independent-executables.html#263491574">(Dec 02 2021 at 19:50)</a>:</h4>
<p>the code can relocate itself</p>



<a name="263494077"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/position-independent-executables/near/263494077" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/position-independent-executables.html#263494077">(Dec 02 2021 at 20:09)</a>:</h4>
<p>I think you will need to make your own target.</p>



<a name="263494156"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/position-independent-executables/near/263494156" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> joey <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/position-independent-executables.html#263494156">(Dec 02 2021 at 20:10)</a>:</h4>
<p>Ok, fair enough, I was wondering if I could go without thats all!</p>



<a name="263494282"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/position-independent-executables/near/263494282" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> joey <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/position-independent-executables.html#263494282">(Dec 02 2021 at 20:11)</a>:</h4>
<p>it probably makes sense to be more specific about it anyway</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>