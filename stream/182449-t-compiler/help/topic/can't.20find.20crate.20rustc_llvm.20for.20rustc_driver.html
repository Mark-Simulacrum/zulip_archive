<html>
<head><meta charset="utf-8"><title>can&#x27;t find crate rustc_llvm for rustc_driver · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/can&#x27;t.20find.20crate.20rustc_llvm.20for.20rustc_driver.html">can&#x27;t find crate rustc_llvm for rustc_driver</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="250238056"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/can%27t%20find%20crate%20rustc_llvm%20for%20rustc_driver/near/250238056" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hannahE2 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/can&#x27;t.20find.20crate.20rustc_llvm.20for.20rustc_driver.html#250238056">(Aug 21 2021 at 21:30)</a>:</h4>
<p>So why can it be that the rustc_llvm crate cannot be found ?</p>



<a name="250238070"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/can%27t%20find%20crate%20rustc_llvm%20for%20rustc_driver/near/250238070" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hannahE2 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/can&#x27;t.20find.20crate.20rustc_llvm.20for.20rustc_driver.html#250238070">(Aug 21 2021 at 21:31)</a>:</h4>
<p>rustc_codegen_llvm was compiled</p>



<a name="250238079"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/can%27t%20find%20crate%20rustc_llvm%20for%20rustc_driver/near/250238079" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hannahE2 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/can&#x27;t.20find.20crate.20rustc_llvm.20for.20rustc_driver.html#250238079">(Aug 21 2021 at 21:31)</a>:</h4>
<p>llvm is succesfully compiled in rust/build/x86_64-unknown-linux-gnu/llvm</p>



<a name="250238123"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/can%27t%20find%20crate%20rustc_llvm%20for%20rustc_driver/near/250238123" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/can&#x27;t.20find.20crate.20rustc_llvm.20for.20rustc_driver.html#250238123">(Aug 21 2021 at 21:32)</a>:</h4>
<p>I don't know, sorry</p>



<a name="250238125"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/can%27t%20find%20crate%20rustc_llvm%20for%20rustc_driver/near/250238125" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/can&#x27;t.20find.20crate.20rustc_llvm.20for.20rustc_driver.html#250238125">(Aug 21 2021 at 21:32)</a>:</h4>
<p>note that rustc_codegen_llvm and rustc_llvm are different</p>



<a name="250238126"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/can%27t%20find%20crate%20rustc_llvm%20for%20rustc_driver/near/250238126" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hannahE2 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/can&#x27;t.20find.20crate.20rustc_llvm.20for.20rustc_driver.html#250238126">(Aug 21 2021 at 21:32)</a>:</h4>
<p>but indeed the rustc_llvm crate is not compiled anywhere</p>



<a name="250238130"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/can%27t%20find%20crate%20rustc_llvm%20for%20rustc_driver/near/250238130" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/can&#x27;t.20find.20crate.20rustc_llvm.20for.20rustc_driver.html#250238130">(Aug 21 2021 at 21:32)</a>:</h4>
<p>rustc_llvm is basically the <code>-sys</code> version</p>



<a name="250238131"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/can%27t%20find%20crate%20rustc_llvm%20for%20rustc_driver/near/250238131" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hannahE2 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/can&#x27;t.20find.20crate.20rustc_llvm.20for.20rustc_driver.html#250238131">(Aug 21 2021 at 21:32)</a>:</h4>
<p>yep, that's missing</p>



<a name="250238132"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/can%27t%20find%20crate%20rustc_llvm%20for%20rustc_driver/near/250238132" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/can&#x27;t.20find.20crate.20rustc_llvm.20for.20rustc_driver.html#250238132">(Aug 21 2021 at 21:32)</a>:</h4>
<p>you could try touching the <a href="http://build.rs">build.rs</a> maybe? <span aria-label="shrug" class="emoji emoji-1f937" role="img" title="shrug">:shrug:</span></p>



<a name="250238184"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/can%27t%20find%20crate%20rustc_llvm%20for%20rustc_driver/near/250238184" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hannahE2 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/can&#x27;t.20find.20crate.20rustc_llvm.20for.20rustc_driver.html#250238184">(Aug 21 2021 at 21:34)</a>:</h4>
<p>ok so rustc_llvm is built as part of stage0</p>



<a name="250238208"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/can%27t%20find%20crate%20rustc_llvm%20for%20rustc_driver/near/250238208" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hannahE2 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/can&#x27;t.20find.20crate.20rustc_llvm.20for.20rustc_driver.html#250238208">(Aug 21 2021 at 21:35)</a>:</h4>
<p>should rustdoc pick the stage0 version ?</p>



<a name="250238210"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/can%27t%20find%20crate%20rustc_llvm%20for%20rustc_driver/near/250238210" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/can&#x27;t.20find.20crate.20rustc_llvm.20for.20rustc_driver.html#250238210">(Aug 21 2021 at 21:35)</a>:</h4>
<p>yes, it does normally</p>



<a name="250238223"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/can%27t%20find%20crate%20rustc_llvm%20for%20rustc_driver/near/250238223" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/can&#x27;t.20find.20crate.20rustc_llvm.20for.20rustc_driver.html#250238223">(Aug 21 2021 at 21:35)</a>:</h4>
<p>actually, just to make sure your build environment isn't cursed - if you remove absolutely all those configs from your config.toml, do you get the same error?</p>



<a name="250238266"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/can%27t%20find%20crate%20rustc_llvm%20for%20rustc_driver/near/250238266" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hannahE2 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/can&#x27;t.20find.20crate.20rustc_llvm.20for.20rustc_driver.html#250238266">(Aug 21 2021 at 21:36)</a>:</h4>
<p>its a dependency of rustc_driver, and touching the rustc_llvm/build.rs also rebuilds rustc_driver</p>



<a name="250238287"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/can%27t%20find%20crate%20rustc_llvm%20for%20rustc_driver/near/250238287" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/can&#x27;t.20find.20crate.20rustc_llvm.20for.20rustc_driver.html#250238287">(Aug 21 2021 at 21:36)</a>:</h4>
<p>yup that sounds right</p>



<a name="251556031"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/can%27t%20find%20crate%20rustc_llvm%20for%20rustc_driver/near/251556031" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Adam Gemmell <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/can&#x27;t.20find.20crate.20rustc_llvm.20for.20rustc_driver.html#251556031">(Sep 01 2021 at 13:18)</a>:</h4>
<p>I hit this recently - setting llvm.optimize to false is enough to reproduce it I think. other stages use this LLVM build fine, but rustdoc doesn't like it (<code>x.py build</code>, so with stage 1)</p>



<a name="251556114"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/can%27t%20find%20crate%20rustc_llvm%20for%20rustc_driver/near/251556114" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Adam Gemmell <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/can&#x27;t.20find.20crate.20rustc_llvm.20for.20rustc_driver.html#251556114">(Sep 01 2021 at 13:19)</a>:</h4>
<p>Not sure there's a much of a reason to build rustdoc with a debug llvm so something like <code>x.py build library/std</code> works around this fine of course</p>



<a name="251557981"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/can%27t%20find%20crate%20rustc_llvm%20for%20rustc_driver/near/251557981" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Adam Gemmell <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/can&#x27;t.20find.20crate.20rustc_llvm.20for.20rustc_driver.html#251557981">(Sep 01 2021 at 13:30)</a>:</h4>
<p>Actually, <span class="user-mention" data-user-id="409057">@hannahE2</span>'s config just turns on debuginfo for the release build instead.<br>
llvm assertions and rust debug alone don't cause a problem.</p>



<a name="251730905"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/can%27t%20find%20crate%20rustc_llvm%20for%20rustc_driver/near/251730905" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hannahE2 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/can&#x27;t.20find.20crate.20rustc_llvm.20for.20rustc_driver.html#251730905">(Sep 02 2021 at 15:09)</a>:</h4>
<p>thanks! <code>llvm.optimize</code> was it!</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>