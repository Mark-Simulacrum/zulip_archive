<html>
<head><meta charset="utf-8"><title>custom rust compiler no std found · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/custom.20rust.20compiler.20no.20std.20found.html">custom rust compiler no std found</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="259756492"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/custom%20rust%20compiler%20no%20std%20found/near/259756492" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shihao Xia <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/custom.20rust.20compiler.20no.20std.20found.html#259756492">(Oct 30 2021 at 23:00)</a>:</h4>
<p>I would like to create a custom rust compiler by using rustc_private feature like:</p>
<p>..<br>
// <a href="http://main.rs">main.rs</a><br>
...<br>
let run_compiler = rustc_driver::RunCompiler::new(&amp;rustc_args, &amp;mut callbacks);<br>
run_compiler.run()<br>
...<br>
toolchain is 1.58</p>
<p>In order to run this binary properly, I have to run <code>export LD_LIBRARY_PATH=$(rustc --print sysroot)/lib:$LD_LIBRARY_PATH</code> in my ubuntu environment.</p>
<p>After I successfully built this, I setup the <code>export RUSTC=&lt;this binary built from this main.rs&gt;</code> and tries to run cargo build on the other cargo project. however I got error[E0463]: can't find crate for <code>std</code>. </p>
<p>Below is the rustc_args:</p>
<p>NFO  rustc &gt; ["/home/sxia/code/myrustc/target/debug/rustc", "--crate-name", "algorithmica", "--edition=2018", "/home/sxia/.cargo/registry/src/github.com-1ecc6299db9ec823/algorithmica-0.1.9/src/lib.rs", "--error-format=json", "--json=diagnostic-rendered-ansi", "--crate-type", "lib", "--emit=dep-info,metadata,link", "-C", "embed-bitcode=no", "-C", "debuginfo=2", "-C", "metadata=30ce0cd588d2db90", "-C", "extra-filename=-30ce0cd588d2db90", "--out-dir", "/home/sxia/code/myrustc/examples/rustsec20210053/target/debug/deps", "-L", "dependency=/home/sxia/code/myrustc/examples/rustsec20210053/target/debug/deps", "--cap-lints", "allow"]</p>
<p>Could I get a hint where I am missing?</p>



<a name="259758463"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/custom%20rust%20compiler%20no%20std%20found/near/259758463" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/custom.20rust.20compiler.20no.20std.20found.html#259758463">(Oct 30 2021 at 23:50)</a>:</h4>
<p><span class="user-mention" data-user-id="382085">@Shihao Xia</span> try <code>--sysroot $(rustc --print sysroot)</code> maybe?</p>



<a name="259758471"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/custom%20rust%20compiler%20no%20std%20found/near/259758471" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/custom.20rust.20compiler.20no.20std.20found.html#259758471">(Oct 30 2021 at 23:50)</a>:</h4>
<p>by default I think it uses a path relative to the binary, which for you is <code>target/</code> something and doesn'et have the standard library</p>



<a name="259778532"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/custom%20rust%20compiler%20no%20std%20found/near/259778532" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Xavier Denis <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/custom.20rust.20compiler.20no.20std.20found.html#259778532">(Oct 31 2021 at 09:14)</a>:</h4>
<p>You need to ensure the other project you’re building has the same sysroot as your driver</p>



<a name="259778538"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/custom%20rust%20compiler%20no%20std%20found/near/259778538" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Xavier Denis <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/custom.20rust.20compiler.20no.20std.20found.html#259778538">(Oct 31 2021 at 09:15)</a>:</h4>
<p>Do that by placing à <code>rust-toolchain</code> file with the same nightly version as your driver</p>



<a name="259804032"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/custom%20rust%20compiler%20no%20std%20found/near/259804032" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shihao Xia <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/custom.20rust.20compiler.20no.20std.20found.html#259804032">(Oct 31 2021 at 19:33)</a>:</h4>
<p>thank you! <span class="user-mention" data-user-id="232545">@Joshua Nelson</span> <span class="user-mention" data-user-id="312719">@Xavier Denis</span></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>