<html>
<head><meta charset="utf-8"><title>✔ llvm-args for llc · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20llvm-args.20for.20llc.html">✔ llvm-args for llc</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="257711309"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20llvm-args%20for%20llc/near/257711309" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Adam Gemmell <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20llvm-args.20for.20llc.html#257711309">(Oct 15 2021 at 14:58)</a>:</h4>
<p>Hi, the docs <a href="https://rustc-dev-guide.rust-lang.org/backend/debugging.html#compiler-options-to-know-and-love">here</a> suggest that "passing -C llvm-args=&lt;foo&gt; allows passing pretty much all the options that tools like llc and opt would accept".</p>
<p>So why won't this work?</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="o">+</span><span class="n">nightly</span><span class="w"> </span><span class="n">rustc</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="o">-</span><span class="n">Cllvm</span><span class="o">-</span><span class="n">args</span><span class="o">=</span><span class="s">"--code-model=tiny --tls-size=12"</span><span class="w"></span>
<span class="w">   </span><span class="n">Compiling</span><span class="w"> </span><span class="n">rust</span><span class="o">-</span><span class="n">test</span><span class="w"> </span><span class="n">v0</span><span class="p">.</span><span class="mf">1.0</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">adagem01</span><span class="o">/</span><span class="n">rust</span><span class="o">-</span><span class="n">test</span><span class="p">)</span><span class="w"></span>
<span class="n">rustc</span><span class="w"> </span><span class="o">-</span><span class="n">Cllvm</span><span class="o">-</span><span class="n">args</span><span class="o">=</span><span class="s">"..."</span><span class="w"> </span><span class="n">with</span>: <span class="nc">Unknown</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="n">argument</span><span class="w"> </span><span class="o">'--</span><span class="n">code</span><span class="o">-</span><span class="n">model</span><span class="o">=</span><span class="n">tiny</span><span class="o">'</span><span class="p">.</span><span class="w">  </span><span class="n">Try</span>: <span class="o">'</span><span class="na">rustc</span> <span class="o">-</span><span class="n">Cllvm</span><span class="o">-</span><span class="n">args</span><span class="o">=</span><span class="s">"..."</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="o">--</span><span class="n">help</span><span class="o">'</span><span class="w"></span>
<span class="n">rustc</span><span class="w"> </span><span class="o">-</span><span class="n">Cllvm</span><span class="o">-</span><span class="n">args</span><span class="o">=</span><span class="s">"..."</span><span class="w"> </span><span class="n">with</span>: <span class="nc">Did</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">mean</span><span class="w"> </span><span class="o">'--</span><span class="n">schedmodel</span><span class="o">=</span><span class="n">tiny</span><span class="o">'?</span><span class="w"></span>
<span class="n">rustc</span><span class="w"> </span><span class="o">-</span><span class="n">Cllvm</span><span class="o">-</span><span class="n">args</span><span class="o">=</span><span class="s">"..."</span><span class="w"> </span><span class="n">with</span>: <span class="nc">Unknown</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="n">argument</span><span class="w"> </span><span class="o">'--</span><span class="n">tls</span><span class="o">-</span><span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="o">'</span><span class="p">.</span><span class="w">  </span><span class="n">Try</span>: <span class="o">'</span><span class="na">rustc</span> <span class="o">-</span><span class="n">Cllvm</span><span class="o">-</span><span class="n">args</span><span class="o">=</span><span class="s">"..."</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="o">--</span><span class="n">help</span><span class="o">'</span><span class="w"></span>
<span class="n">rustc</span><span class="w"> </span><span class="o">-</span><span class="n">Cllvm</span><span class="o">-</span><span class="n">args</span><span class="o">=</span><span class="s">"..."</span><span class="w"> </span><span class="n">with</span>: <span class="nc">Did</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">mean</span><span class="w"> </span><span class="o">'--</span><span class="n">gpsize</span><span class="o">=</span><span class="mi">12</span><span class="o">'?</span><span class="w"></span>
<span class="n">error</span>: <span class="nc">could</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">compile</span><span class="w"> </span><span class="err">`</span><span class="n">rust</span><span class="o">-</span><span class="n">test</span><span class="err">`</span><span class="w"></span>
</code></pre></div>
<p>These args aren't shown as options when using <code>llvm-args=--help</code>, or --help-list-hidden, but they're valid options to the <code>llc</code> built as part of a rustc build</p>



<a name="257711662"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20llvm-args%20for%20llc/near/257711662" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Adam Gemmell <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20llvm-args.20for.20llc.html#257711662">(Oct 15 2021 at 15:00)</a>:</h4>
<p>I found this old bug <a href="https://github.com/rust-lang/rust/issues/26338">https://github.com/rust-lang/rust/issues/26338</a> but seems somewhat out of date as <code>llvm-args=--list</code> is no longer accepted</p>



<a name="257715091"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20llvm-args%20for%20llc/near/257715091" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20llvm-args.20for.20llc.html#257715091">(Oct 15 2021 at 15:19)</a>:</h4>
<p>"pretty much all" is quite incorrect depending on what options you're looking for. More like all of the options you can pass here will be accepted by either opt, or LLC or both</p>



<a name="257715209"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20llvm-args%20for%20llc/near/257715209" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20llvm-args.20for.20llc.html#257715209">(Oct 15 2021 at 15:20)</a>:</h4>
<p>These tools then may implement additional options on top of those handled by llvm</p>



<a name="257717188"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20llvm-args%20for%20llc/near/257717188" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20llvm-args.20for.20llc.html#257717188">(Oct 15 2021 at 15:32)</a>:</h4>
<p>fwiw, rustc supports <code>-C code-model</code></p>



<a name="257718938"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20llvm-args%20for%20llc/near/257718938" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Adam Gemmell <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20llvm-args.20for.20llc.html#257718938">(Oct 15 2021 at 15:44)</a>:</h4>
<p>interesting - so it's only ones handled by top-level llvm?</p>



<a name="257719024"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20llvm-args%20for%20llc/near/257719024" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Adam Gemmell <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20llvm-args.20for.20llc.html#257719024">(Oct 15 2021 at 15:44)</a>:</h4>
<p>code-model isn't actually the interesting one for me, but if it's not actually possible to set <code>tls-size</code> then that answers my investigation :)</p>



<a name="257996507"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20llvm-args%20for%20llc/near/257996507" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20llvm-args.20for.20llc.html#257996507">(Oct 18 2021 at 08:55)</a>:</h4>
<p><span class="user-mention silent" data-user-id="382356">Adam Gemmell</span> has marked this topic as resolved.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>