<html>
<head><meta charset="utf-8"><title>✔ Inheriting impl attributes in late lints · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html">✔ Inheriting impl attributes in late lints</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="257845721"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257845721" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257845721">(Oct 16 2021 at 17:02)</a>:</h4>
<p>I'm working on <a href="https://github.com/rust-lang/rust/issues/85526">https://github.com/rust-lang/rust/issues/85526</a>.</p>
<p>In this commit <a href="https://github.com/pierwill/rust/commit/75023d19d3247d7619f138ff9780bcf5dc152a3a">https://github.com/pierwill/rust/commit/75023d19d3247d7619f138ff9780bcf5dc152a3a</a>, I've successfully hidden the docs for all associated functions <span aria-label="laughter tears" class="emoji emoji-1f602" role="img" title="laughter tears">:laughter_tears:</span>. Now I need to narrow to only the case where the "parent" type has <code>#[docs(hidden)]</code>. Is there any way to get from any of <a href="https://github.com/rust-lang/rust/blob/75023d19d3247d7619f138ff9780bcf5dc152a3a/compiler/rustc_lint/src/builtin.rs#L654">this data</a> to the attributes of the "parent" item?</p>



<a name="257846142"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257846142" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257846142">(Oct 16 2021 at 17:09)</a>:</h4>
<p>Seems like this might require information from the AST?</p>



<a name="257847033"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257847033" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257847033">(Oct 16 2021 at 17:23)</a>:</h4>
<p>Maybe I can use <a href="https://doc.rust-lang.org/beta/nightly-rustc/rustc_middle/ty/context/struct.TypeckResults.html">https://doc.rust-lang.org/beta/nightly-rustc/rustc_middle/ty/context/struct.TypeckResults.html</a> ?</p>



<a name="257847830"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257847830" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257847830">(Oct 16 2021 at 17:36)</a>:</h4>
<p>This is what I wish could happen:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">        </span><span class="c1">// If the method is an impl for an item with docs_hidden, don't doc.</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">method_context</span><span class="p">(</span><span class="n">cx</span><span class="p">,</span><span class="w"> </span><span class="n">impl_item</span><span class="p">.</span><span class="n">hir_id</span><span class="p">())</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">MethodLateContext</span>::<span class="n">PlainImpl</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">typeinfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cx</span><span class="p">.</span><span class="n">maybe_typeck_results</span><span class="p">().</span><span class="n">unwrap</span><span class="p">();</span><span class="w"></span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">parentdef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">typeinfo</span><span class="p">.</span><span class="n">type_dependent_def</span><span class="p">(</span><span class="n">impl_item</span><span class="p">.</span><span class="n">hir_id</span><span class="p">());</span><span class="w"></span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parentdef</span><span class="p">.</span><span class="n">unwrap</span><span class="p">();</span><span class="w"></span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">attr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">id</span><span class="p">.</span><span class="n">attr</span><span class="p">();</span><span class="w"></span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">attr</span><span class="p">.</span><span class="n">docs_hidden</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="257853707"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257853707" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257853707">(Oct 16 2021 at 19:07)</a>:</h4>
<p>Ah.. I'm at the point in learning that I actually see how  <code>-Z unpretty=hir-tree</code> is helpful!</p>



<a name="257856999"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257856999" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cjgillot <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257856999">(Oct 16 2021 at 20:00)</a>:</h4>
<p><span class="user-mention" data-user-id="316352">@pierwill</span>: I don't think you need to use typeck results.<br>
Starting from the wrongly-flagged impl-item, you could:</p>
<ul>
<li>fetch the enclosing impl block using <code>tcx.hir().parent</code>;</li>
<li>deconstruct it to see which type it implements using <code>self_ty</code>;</li>
<li>destructure <code>self_ty</code> to find the outermost definition's <code>DefId</code>;</li>
<li>check its attributes using <code>tcx.get_attrs</code>.</li>
</ul>
<p>Does that seem reasonable?</p>



<a name="257857036"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257857036" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257857036">(Oct 16 2021 at 20:01)</a>:</h4>
<p>Thanks! I was just stumbling into something like that!</p>



<a name="257857066"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257857066" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257857066">(Oct 16 2021 at 20:01)</a>:</h4>
<p><code>self_ty</code> was was I couldn't figure out :)</p>



<a name="257857169"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257857169" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257857169">(Oct 16 2021 at 20:02)</a>:</h4>
<p>Hm. Where's <code>self_ty</code>? Is that a meth on HirId?</p>



<a name="257857415"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257857415" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257857415">(Oct 16 2021 at 20:06)</a>:</h4>
<p>ah, need a <a href="https://doc.rust-lang.org/beta/nightly-rustc/rustc_middle/hir/map/struct.Map.html#method.def_kind">https://doc.rust-lang.org/beta/nightly-rustc/rustc_middle/hir/map/struct.Map.html#method.def_kind</a></p>



<a name="257857462"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257857462" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cjgillot <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257857462">(Oct 16 2021 at 20:07)</a>:</h4>
<p><code>self_ty</code> is on <code>hir::Impl</code>, which is a variant of <code>hir::ItemKind</code>.</p>



<a name="257857632"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257857632" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257857632">(Oct 16 2021 at 20:09)</a>:</h4>
<p>still trying to connect the dots, but with your outline I think i'll get there. Thanks <span class="user-mention" data-user-id="248906">@cjgillot</span> !</p>



<a name="257857920"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257857920" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257857920">(Oct 16 2021 at 20:13)</a>:</h4>
<p>Can't figure out how to get the <code>parent</code>'s ItemKind...</p>



<a name="257858510"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257858510" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257858510">(Oct 16 2021 at 20:21)</a>:</h4>
<p>Ah! <code>hir::map</code> <code>expect_item()</code></p>



<a name="257884792"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257884792" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257884792">(Oct 17 2021 at 03:51)</a>:</h4>
<p>I thought this might work, but sadly no. <a href="https://github.com/rust-lang/rust/blob/d6c8cb6b6d442fe8f25820307475961b199a8bde/compiler/rustc_lint/src/builtin.rs#L660-L682">https://github.com/rust-lang/rust/blob/d6c8cb6b6d442fe8f25820307475961b199a8bde/compiler/rustc_lint/src/builtin.rs#L660-L682</a></p>
<p>I think I'm not targeting the right <code>DefId</code>... <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="257906807"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257906807" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cjgillot <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257906807">(Oct 17 2021 at 10:11)</a>:</h4>
<p><code>sty.hir_id.owner</code> is not the type definition's DefId, it's equal to <code>parent.owner</code>. You need to match on <code>sty.kind</code> to access the referred type.</p>



<a name="257936984"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257936984" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257936984">(Oct 17 2021 at 18:02)</a>:</h4>
<p>How would I get from a <code>rustc_hir::TyKind</code> (and which variant?) back to a <code>DefId</code>?</p>



<a name="257937505"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257937505" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257937505">(Oct 17 2021 at 18:11)</a>:</h4>
<p>Latest attempt: <a href="https://github.com/rust-lang/rust/blob/1dcb4744f54e1ea55cf540bd9142e3909cb01e15/compiler/rustc_lint/src/builtin.rs#L660-L685">https://github.com/rust-lang/rust/blob/1dcb4744f54e1ea55cf540bd9142e3909cb01e15/compiler/rustc_lint/src/builtin.rs#L660-L685</a></p>



<a name="257938229"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257938229" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cjgillot <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257938229">(Oct 17 2021 at 18:23)</a>:</h4>
<p>The case of the issue, <code>sty.kind</code> would look like <code>TyKind::Path(QPath::Resolved(None, path)</code>, and you need to path.res`.</p>



<a name="257938286"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257938286" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257938286">(Oct 17 2021 at 18:24)</a>:</h4>
<p>Thank you! I'll try that</p>



<a name="257938384"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257938384" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257938384">(Oct 17 2021 at 18:26)</a>:</h4>
<p>I think you want</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">item_def_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">map</span><span class="p">.</span><span class="n">opt_hir_id_to_local_def_id</span><span class="p">(</span><span class="n">impl_item</span><span class="p">.</span><span class="n">hir_id</span><span class="p">());</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">impl_ty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cx</span><span class="p">.</span><span class="n">tcx</span><span class="p">.</span><span class="n">type_of</span><span class="p">(</span><span class="n">item_def_id</span><span class="p">);</span><span class="w"></span>

<span class="k">match</span><span class="w"> </span><span class="n">impl_ty</span><span class="p">.</span><span class="n">kind</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">     </span><span class="n">ty</span>::<span class="n">Adt</span><span class="p">(</span><span class="n">def</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">def</span><span class="p">.</span><span class="n">did</span><span class="p">,</span><span class="w"></span>
<span class="w">     </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* skip */</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="257938647"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257938647" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257938647">(Oct 17 2021 at 18:30)</a>:</h4>
<p>Is that a totally different and better way to solve the problem? That's so crazy. This must happen a lot in rustc world...</p>



<a name="257938772"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257938772" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257938772">(Oct 17 2021 at 18:33)</a>:</h4>
<p>It should be. Knowing if/when/how you can make use of queries that already do most of what you need is definitely quite a learning curve, especially when they have generic names like <code>type_of</code>.</p>



<a name="257938794"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257938794" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257938794">(Oct 17 2021 at 18:33)</a>:</h4>
<p>I'm getting "method not found in <code>rustc_middle::hir::map::Map&lt;'_&gt;</code>"</p>



<a name="257938803"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257938803" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257938803">(Oct 17 2021 at 18:33)</a>:</h4>
<p>for map.opt_hir_id_to_local_def_id</p>



<a name="257938854"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257938854" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257938854">(Oct 17 2021 at 18:34)</a>:</h4>
<p>Sorry, it's <code>opt_local_def_id</code></p>



<a name="257938992"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257938992" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257938992">(Oct 17 2021 at 18:37)</a>:</h4>
<p>this has been easily the craziest coding adventure i've done</p>



<a name="257939002"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257939002" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257939002">(Oct 17 2021 at 18:37)</a>:</h4>
<p>and it's not over yet</p>



<a name="257939127"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257939127" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257939127">(Oct 17 2021 at 18:39)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">outerdef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="n">impl_ty</span><span class="p">.</span><span class="n">kind</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">ty</span>::<span class="n">Adt</span><span class="p">(</span><span class="n">def</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">def</span><span class="p">.</span><span class="n">did</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">panic!</span><span class="p">(</span><span class="s">"unexpected type"</span><span class="p">),</span><span class="w"></span>
<span class="w">            </span><span class="p">};</span><span class="w"></span>
</code></pre></div>
<p>This match isn't working. (I put in a panic...)</p>



<a name="257939209"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257939209" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257939209">(Oct 17 2021 at 18:40)</a>:</h4>
<p>yes, impls can also be on built in types (in core/alloc/std) and trait objects.</p>



<a name="257939240"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257939240" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257939240">(Oct 17 2021 at 18:40)</a>:</h4>
<p>Ah so we need to actually handle <code>_</code></p>



<a name="257939247"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257939247" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257939247">(Oct 17 2021 at 18:40)</a>:</h4>
<p>What's the best way to do that?</p>



<a name="257939361"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257939361" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257939361">(Oct 17 2021 at 18:42)</a>:</h4>
<p>Maybe just <code>return</code> here? <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="257939491"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257939491" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257939491">(Oct 17 2021 at 18:45)</a>:</h4>
<p>I guess it depends on what you want to do in those cases.</p>



<a name="257939580"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257939580" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257939580">(Oct 17 2021 at 18:46)</a>:</h4>
<p>Hm. Maybe we don't need to worry about this docs attr in core/alloc/std? And I think the trait object case might be covered just before this....</p>



<a name="257939601"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257939601" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257939601">(Oct 17 2021 at 18:47)</a>:</h4>
<p>Or we could just... get those types and their defids as well?</p>



<a name="257939721"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257939721" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257939721">(Oct 17 2021 at 18:49)</a>:</h4>
<p>Hm... might have to let reviewers help decide</p>



<a name="257939801"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257939801" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257939801">(Oct 17 2021 at 18:50)</a>:</h4>
<p>I think that you should probably treat all of the built-in types as if they don't have a <code>doc(hidden)</code> attribute.</p>



<a name="257939818"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257939818" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257939818">(Oct 17 2021 at 18:50)</a>:</h4>
<p>that makes sense</p>



<a name="257939832"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257939832" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257939832">(Oct 17 2021 at 18:50)</a>:</h4>
<p>You can add an arm for <code>ty::Foreign(def_id) =&gt; /* check def_id */</code></p>



<a name="257939889"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257939889" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257939889">(Oct 17 2021 at 18:52)</a>:</h4>
<p>and the others? is there such thing as returning a dummy defid?</p>



<a name="257939936"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257939936" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257939936">(Oct 17 2021 at 18:52)</a>:</h4>
<p>Because all the arms need to return a defid, right?</p>



<a name="257939999"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257939999" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257939999">(Oct 17 2021 at 18:53)</a>:</h4>
<p>Hmm, not really. You could make the match arms all return an <code>Option</code> and then use <code>map_or</code> (or match again)</p>



<a name="257940043"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257940043" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257940043">(Oct 17 2021 at 18:54)</a>:</h4>
<p>ahh</p>



<a name="257940445"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257940445" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257940445">(Oct 17 2021 at 19:00)</a>:</h4>
<p>But then what do we do on the <code>None</code> branch <span aria-label="laughter tears" class="emoji emoji-1f602" role="img" title="laughter tears">:laughter_tears:</span> ?</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">outerdef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="n">impl_ty</span><span class="p">.</span><span class="n">kind</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">ty</span>::<span class="n">Adt</span><span class="p">(</span><span class="n">def</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">def</span><span class="p">.</span><span class="n">did</span><span class="p">),</span><span class="w"></span>
<span class="w">                </span><span class="n">ty</span>::<span class="n">Foreign</span><span class="p">(</span><span class="n">def_id</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="o">*</span><span class="n">def_id</span><span class="p">),</span><span class="w"></span>
<span class="w">                </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">None</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="p">};</span><span class="w"></span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">attrs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cx</span><span class="p">.</span><span class="n">tcx</span><span class="p">.</span><span class="n">get_attrs</span><span class="p">(</span><span class="k">match</span><span class="w"> </span><span class="n">outerdef</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="nb">Some</span><span class="p">(</span><span class="n">def</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">def</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="nb">None</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">panic!</span><span class="p">(),</span><span class="w"></span>
<span class="w">            </span><span class="p">});</span><span class="w"></span>
</code></pre></div>



<a name="257940492"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257940492" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257940492">(Oct 17 2021 at 19:01)</a>:</h4>
<p>i think i might be losing track of the high-level here...</p>



<a name="257940745"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257940745" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257940745">(Oct 17 2021 at 19:05)</a>:</h4>
<p>maybe I need to call <code>self.check_missing_docs_attrs</code> somewhere, but need to avoid a recursive loop...</p>



<a name="257940834"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257940834" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257940834">(Oct 17 2021 at 19:06)</a>:</h4>
<p>I was thinking of something like this</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">is_hidden</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="n">opt_def_id</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nb">Some</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">tcx</span><span class="p">.</span><span class="n">is_doc_hidden</span><span class="p">(</span><span class="n">id</span><span class="p">),</span><span class="w"></span>
<span class="w">      </span><span class="nb">None</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
</code></pre></div>



<a name="257940846"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257940846" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257940846">(Oct 17 2021 at 19:07)</a>:</h4>
<p>ooooh beautiful</p>



<a name="257940867"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257940867" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257940867">(Oct 17 2021 at 19:07)</a>:</h4>
<p>i'll try it out</p>



<a name="257941441"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257941441" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257941441">(Oct 17 2021 at 19:16)</a>:</h4>
<p>latest attempt: <a href="https://github.com/rust-lang/rust/blob/043ad243332fc4d4f9f597ae1e58e125f4defb3e/compiler/rustc_lint/src/builtin.rs#L643-L678">https://github.com/rust-lang/rust/blob/043ad243332fc4d4f9f597ae1e58e125f4defb3e/compiler/rustc_lint/src/builtin.rs#L643-L678</a></p>
<p>Compiler built, but didn't give desired behavior on the test case in the issue:</p>
<div class="codehilite"><pre><span></span><code>$ rustc +stage1 ~/test.rs
warning: missing documentation for an associated function
 --&gt; /Users/wpierce/test.rs:9:5
  |
9 |     pub fn bar() {}
  |     ^^^^^^^^^^^^
  |
note: the lint level is defined here
 --&gt; /Users/wpierce/test.rs:1:9
  |
1 | #![warn(missing_docs)]
  |         ^^^^^^^^^^^^

warning: 1 warning emitted
</code></pre></div>



<a name="257941682"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257941682" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257941682">(Oct 17 2021 at 19:20)</a>:</h4>
<p>maybe i wasn't getting the "parent" after all?</p>



<a name="257941692"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257941692" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257941692">(Oct 17 2021 at 19:20)</a>:</h4>
<p>the parent of <code>impl_item</code>...</p>



<a name="257941874"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257941874" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257941874">(Oct 17 2021 at 19:23)</a>:</h4>
<p>oh, I see <code>ImplItem</code> is the associated item in the impl.</p>



<a name="257941920"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257941920" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257941920">(Oct 17 2021 at 19:24)</a>:</h4>
<p>Maybe</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">        </span><span class="c1">// If the method is an impl for an item with docs_hidden,</span>
<span class="w">        </span><span class="c1">// check the parent instead.</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">method_context</span><span class="p">(</span><span class="n">cx</span><span class="p">,</span><span class="w"> </span><span class="n">impl_item</span><span class="p">.</span><span class="n">hir_id</span><span class="p">())</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">MethodLateContext</span>::<span class="n">PlainImpl</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cx</span><span class="p">.</span><span class="n">tcx</span><span class="p">.</span><span class="n">hir</span><span class="p">();</span><span class="w"></span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">map</span><span class="p">.</span><span class="n">get_parent_did</span><span class="p">(</span><span class="n">impl_item</span><span class="p">.</span><span class="n">hir_id</span><span class="p">());</span><span class="w"></span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">impl_ty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cx</span><span class="p">.</span><span class="n">tcx</span><span class="p">.</span><span class="n">type_of</span><span class="p">(</span><span class="n">parent</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">outerdef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="n">impl_ty</span><span class="p">.</span><span class="n">kind</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">ty</span>::<span class="n">Adt</span><span class="p">(</span><span class="n">def</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">def</span><span class="p">.</span><span class="n">did</span><span class="p">),</span><span class="w"></span>
<span class="w">                </span><span class="n">ty</span>::<span class="n">Foreign</span><span class="p">(</span><span class="n">def_id</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="o">*</span><span class="n">def_id</span><span class="p">),</span><span class="w"></span>
<span class="w">                </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">None</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="p">};</span><span class="w"></span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">is_hidden</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="n">outerdef</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="nb">Some</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">cx</span><span class="p">.</span><span class="n">tcx</span><span class="p">.</span><span class="n">is_doc_hidden</span><span class="p">(</span><span class="n">id</span><span class="p">),</span><span class="w"></span>
<span class="w">                </span><span class="nb">None</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="p">};</span><span class="w"></span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">is_hidden</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="257941951"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257941951" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257941951">(Oct 17 2021 at 19:24)</a>:</h4>
<p>(By the way, thank you so much for your help!)</p>



<a name="257941957"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257941957" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257941957">(Oct 17 2021 at 19:25)</a>:</h4>
<p>Yes, that looks better</p>



<a name="257942071"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257942071" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257942071">(Oct 17 2021 at 19:26)</a>:</h4>
<p>it works!!!!!!!!!!!!!!</p>



<a name="257942261"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257942261" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257942261">(Oct 17 2021 at 19:29)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/pull/89987">https://github.com/rust-lang/rust/pull/89987</a></p>



<a name="257942272"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257942272" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257942272">(Oct 17 2021 at 19:30)</a>:</h4>
<p>Think this will want a test case?</p>



<a name="257942373"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257942373" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257942373">(Oct 17 2021 at 19:31)</a>:</h4>
<p>yes</p>



<a name="257942521"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257942521" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257942521">(Oct 17 2021 at 19:34)</a>:</h4>
<p>This would be a <code>ui</code> test, yes?</p>



<a name="257942564"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257942564" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257942564">(Oct 17 2021 at 19:34)</a>:</h4>
<p>yes</p>



<a name="257944012"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257944012" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257944012">(Oct 17 2021 at 19:57)</a>:</h4>
<p>Does this look like a correct test? <a href="https://github.com/rust-lang/rust/pull/89987/files#diff-f299c24548c480fc203c74376a342ad898ce85a286edc89a7c8214c932f8b5a5">https://github.com/rust-lang/rust/pull/89987/files#diff-f299c24548c480fc203c74376a342ad898ce85a286edc89a7c8214c932f8b5a5</a></p>



<a name="257944096"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257944096" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257944096">(Oct 17 2021 at 19:58)</a>:</h4>
<p>Using <code>deny(hidden_docs)</code> instead might be better. Also the test can be <code>check-pass</code></p>



<a name="257998397"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257998397" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257998397">(Oct 18 2021 at 09:11)</a>:</h4>
<p><span class="user-mention silent" data-user-id="312719">Xavier Denis</span> has marked this topic as resolved.</p>



<a name="257998413"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257998413" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257998413">(Oct 18 2021 at 09:11)</a>:</h4>
<p><span class="user-mention silent" data-user-id="312719">Xavier Denis</span> has marked this topic as unresolved.</p>



<a name="257998468"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/257998468" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Xavier Denis <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#257998468">(Oct 18 2021 at 09:12)</a>:</h4>
<p>sorry about that, I meant to mark the thread as read :P</p>



<a name="258028944"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/258028944" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#258028944">(Oct 18 2021 at 13:30)</a>:</h4>
<p>The fix just merged! :)</p>



<a name="258028986"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/%E2%9C%94%20Inheriting%20impl%20attributes%20in%20late%20lints/near/258028986" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/.E2.9C.94.20Inheriting.20impl.20attributes.20in.20late.20lints.html#258028986">(Oct 18 2021 at 13:31)</a>:</h4>
<p><span class="user-mention silent" data-user-id="316352">pierwill</span> has marked this topic as resolved.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>