<html>
<head><meta charset="utf-8"><title>Thoughts on `&#x27;_` in the compiler? · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Thoughts.20on.20.60&#x27;_.60.20in.20the.20compiler.3F.html">Thoughts on `&#x27;_` in the compiler?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="263816842"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Thoughts%20on%20%60%27_%60%20in%20the%20compiler%3F/near/263816842" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Thoughts.20on.20.60&#x27;_.60.20in.20the.20compiler.3F.html#263816842">(Dec 06 2021 at 07:47)</a>:</h4>
<p>How do people feel about <code>'_</code> in compiler code for things that are <code>'tcx</code> but don't need it named?</p>
<p>Vote <span aria-label="minus" class="emoji emoji-2796" role="img" title="minus">:minus:</span> if you like </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">visit_lhs</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">place</span>: <span class="kp">&amp;</span><span class="nc">Place</span><span class="o">&lt;'</span><span class="nb">_</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">location</span>: <span class="nc">Location</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</code></pre></div>
<p>Vote <span aria-label="tm" class="emoji emoji-2122" role="img" title="tm">:tm:</span> if you prefer </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">visit_lhs</span><span class="o">&lt;'</span><span class="na">tcx</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">place</span>: <span class="kp">&amp;</span><span class="nc">Place</span><span class="o">&lt;'</span><span class="na">tcx</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">location</span>: <span class="nc">Location</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</code></pre></div>
<p>(This is assuming no <code>in_band_lifetimes</code> for the conversation in <a href="https://github.com/rust-lang/rust/issues/44524#issuecomment-986396571">https://github.com/rust-lang/rust/issues/44524#issuecomment-986396571</a>)</p>



<a name="263817155"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Thoughts%20on%20%60%27_%60%20in%20the%20compiler%3F/near/263817155" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vadim Petrochenkov <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Thoughts.20on.20.60&#x27;_.60.20in.20the.20compiler.3F.html#263817155">(Dec 06 2021 at 07:52)</a>:</h4>
<p>If it doesn't need to be named, then it isn't required to be <code>'tcx</code> specifically too?<br>
(It just happens to usually be allocated on the <code>'tcx</code> arena or something.)</p>



<a name="263855983"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Thoughts%20on%20%60%27_%60%20in%20the%20compiler%3F/near/263855983" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Thoughts.20on.20.60&#x27;_.60.20in.20the.20compiler.3F.html#263855983">(Dec 06 2021 at 14:20)</a>:</h4>
<p><span class="user-mention" data-user-id="125270">@scottmcm</span> I dislike the second one a lot because people tend to get it wrong; they'll write <code>&amp;'tcx Place&lt;'tcx&gt;</code> and then run into borrow errors they don't understand</p>



<a name="264505195"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Thoughts%20on%20%60%27_%60%20in%20the%20compiler%3F/near/264505195" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Thoughts.20on.20.60&#x27;_.60.20in.20the.20compiler.3F.html#264505195">(Dec 10 2021 at 20:42)</a>:</h4>
<p>Note that there are instances (not necessarily in compiler code), where having a nameable lifetime parameter can be useful for the body of the function, especially when writing <code>unsafe</code> code and wanting to type-annotate stuff for extra safety.</p>



<a name="264507363"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Thoughts%20on%20%60%27_%60%20in%20the%20compiler%3F/near/264507363" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Thoughts.20on.20.60&#x27;_.60.20in.20the.20compiler.3F.html#264507363">(Dec 10 2021 at 21:00)</a>:</h4>
<p>Seems like that'd be a vote for using <code>'_</code>, as having a nameable lifetime would be less common and if you see it then it's a flag that "hey something interesting is happening here!"</p>



<a name="264644933"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Thoughts%20on%20%60%27_%60%20in%20the%20compiler%3F/near/264644933" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Thoughts.20on.20.60&#x27;_.60.20in.20the.20compiler.3F.html#264644933">(Dec 12 2021 at 21:37)</a>:</h4>
<p>Sure! But only provided the linter is able to detect all the "interesting things" <span aria-label="warning" class="emoji emoji-26a0" role="img" title="warning">:warning:</span> if one has to add an <code>#[allow(…)]</code> just to add an extra compiler check in <code>unsafe</code> code, then chances are it will deter some people from writing that extra type annotation altogether.</p>



<a name="264649132"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Thoughts%20on%20%60%27_%60%20in%20the%20compiler%3F/near/264649132" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Thoughts.20on.20.60&#x27;_.60.20in.20the.20compiler.3F.html#264649132">(Dec 12 2021 at 23:11)</a>:</h4>
<p>Is there a lint that warns when <code>'foo</code> could be <code>'_</code>? I wasn't aware of one, but I might try it out myself in some code.</p>



<a name="264650225"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Thoughts%20on%20%60%27_%60%20in%20the%20compiler%3F/near/264650225" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Thoughts.20on.20.60&#x27;_.60.20in.20the.20compiler.3F.html#264650225">(Dec 12 2021 at 23:38)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/issues/44752">https://github.com/rust-lang/rust/issues/44752</a></p>



<a name="264650563"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Thoughts%20on%20%60%27_%60%20in%20the%20compiler%3F/near/264650563" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Thoughts.20on.20.60&#x27;_.60.20in.20the.20compiler.3F.html#264650563">(Dec 12 2021 at 23:46)</a>:</h4>
<p>Doesn't the compiler already do this? I swear it's told me to use <code>'_</code> plenty of times...</p>



<a name="264650734"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Thoughts%20on%20%60%27_%60%20in%20the%20compiler%3F/near/264650734" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Thoughts.20on.20.60&#x27;_.60.20in.20the.20compiler.3F.html#264650734">(Dec 12 2021 at 23:50)</a>:</h4>
<p>Maybe that's part of clippy?</p>



<a name="264650801"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Thoughts%20on%20%60%27_%60%20in%20the%20compiler%3F/near/264650801" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Thoughts.20on.20.60&#x27;_.60.20in.20the.20compiler.3F.html#264650801">(Dec 12 2021 at 23:52)</a>:</h4>
<p>There's a lint for missing lifetimes, I believe</p>



<a name="264650811"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Thoughts%20on%20%60%27_%60%20in%20the%20compiler%3F/near/264650811" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Thoughts.20on.20.60&#x27;_.60.20in.20the.20compiler.3F.html#264650811">(Dec 12 2021 at 23:52)</a>:</h4>
<p>Just not needlessly named lifetimes</p>



<a name="264651341"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Thoughts%20on%20%60%27_%60%20in%20the%20compiler%3F/near/264651341" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Thoughts.20on.20.60&#x27;_.60.20in.20the.20compiler.3F.html#264651341">(Dec 13 2021 at 00:03)</a>:</h4>
<p><a href="https://rust-lang.github.io/rust-clippy/master/index.html#needless_lifetimes">https://rust-lang.github.io/rust-clippy/master/index.html#needless_lifetimes</a></p>



<a name="264653402"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Thoughts%20on%20%60%27_%60%20in%20the%20compiler%3F/near/264653402" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Thoughts.20on.20.60&#x27;_.60.20in.20the.20compiler.3F.html#264653402">(Dec 13 2021 at 00:53)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#![deny(rust_2018_idioms)]</span><span class="w"></span>

<span class="k">type</span> <span class="nc">Foo</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;'</span><span class="na">a</span><span class="w"> </span><span class="kt">str</span><span class="p">;</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">test</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="p">(</span><span class="n">a</span>: <span class="nc">Foo</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="o">'</span><span class="na">a</span> <span class="kt">str</span> <span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">_</span>: <span class="kp">&amp;</span><span class="o">'</span><span class="na">a</span> <span class="kt">str</span> <span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">a</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>Clippy doesn't complain about this code, so I'd expect using the <code>'a</code> in an unsafe block would be similar. Commenting out the <code>let</code> does give <code>clippy::needless_lifetimes</code>.</p>



<a name="264653487"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Thoughts%20on%20%60%27_%60%20in%20the%20compiler%3F/near/264653487" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Thoughts.20on.20.60&#x27;_.60.20in.20the.20compiler.3F.html#264653487">(Dec 13 2021 at 00:55)</a>:</h4>
<p><span class="user-mention silent" data-user-id="120989">nnethercote</span> <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/Thoughts.20on.20.60'_.60.20in.20the.20compiler.3F/near/264650563">said</a>:</p>
<blockquote>
<p>Doesn't the compiler already do this? I swear it's told me to use <code>'_</code> plenty of times...</p>
</blockquote>
<p>I'd guess that's <a href="https://doc.rust-lang.org/rustc/lints/listing/allowed-by-default.html#elided-lifetimes-in-paths"><code>elided_lifetimes_in_path</code></a> (enabled by <code>rust_2018_idioms</code> in my example above)</p>



<a name="264671835"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Thoughts%20on%20%60%27_%60%20in%20the%20compiler%3F/near/264671835" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cjgillot <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Thoughts.20on.20.60&#x27;_.60.20in.20the.20compiler.3F.html#264671835">(Dec 13 2021 at 07:38)</a>:</h4>
<p><code>elided_lifetimes_in_path</code> is about eliding lifetimes when writing <code>Ref&lt;T&gt;</code> instead of <code>Ref&lt;'_, T&gt;</code>. The compiler also warns against single use lifetimes and suggests using a <code>'_</code> instead.</p>



<a name="264709570"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Thoughts%20on%20%60%27_%60%20in%20the%20compiler%3F/near/264709570" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Thoughts.20on.20.60&#x27;_.60.20in.20the.20compiler.3F.html#264709570">(Dec 13 2021 at 14:03)</a>:</h4>
<blockquote>
<p>Clippy doesn't complain about this code,</p>
</blockquote>
<p><span class="user-mention" data-user-id="116155">@Jake Goulding</span> that's awesome news; in that case I see no drawbacks anymore <span aria-label="ok" class="emoji emoji-1f44c" role="img" title="ok">:ok:</span></p>



<a name="264709977"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Thoughts%20on%20%60%27_%60%20in%20the%20compiler%3F/near/264709977" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Thoughts.20on.20.60&#x27;_.60.20in.20the.20compiler.3F.html#264709977">(Dec 13 2021 at 14:05)</a>:</h4>
<p>Ok, maybe a super tiny nit: if the lifetime is underscore-prefixed, then it can be "needlessly used" (or not used at all) without being linted: <code>&lt;'_tcx&gt;</code>. This could be useful for teaching or whatnot, as well as consistent with <code>_…</code> items and bindings (but for macros, for some reason)</p>



<a name="264754752"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Thoughts%20on%20%60%27_%60%20in%20the%20compiler%3F/near/264754752" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Thoughts.20on.20.60&#x27;_.60.20in.20the.20compiler.3F.html#264754752">(Dec 13 2021 at 19:06)</a>:</h4>
<p>There's also <a href="https://doc.rust-lang.org/rustc/lints/listing/allowed-by-default.html#single-use-lifetimes">https://doc.rust-lang.org/rustc/lints/listing/allowed-by-default.html#single-use-lifetimes</a>, but it still has a bunch of bugs (based on when I tried it last week).  For example, it complains about <code>impl Iterator&lt;Item = &amp;'a Foo&gt;</code>, but if you remove that you get an error because <a href="https://github.com/rust-lang/rust/issues/45667">#45667</a> hasn't been done yet.</p>



<a name="264759708"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Thoughts%20on%20%60%27_%60%20in%20the%20compiler%3F/near/264759708" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Thoughts.20on.20.60&#x27;_.60.20in.20the.20compiler.3F.html#264759708">(Dec 13 2021 at 19:46)</a>:</h4>
<p>Seems weird there's two lints for the same thing - can we uplift the clippy lint and rename it to <code>single_use_lifetimes</code>?</p>



<a name="264763543"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Thoughts%20on%20%60%27_%60%20in%20the%20compiler%3F/near/264763543" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Thoughts.20on.20.60&#x27;_.60.20in.20the.20compiler.3F.html#264763543">(Dec 13 2021 at 20:14)</a>:</h4>
<p>They look different to me -- the clippy one is that you don't need <code>fn foo&lt;'a&gt;(x: &amp;'a T) -&gt; &amp;'a T</code> because that's what elision would do, whereas <strong>single</strong> use is about <code>fn foo&lt;'a&gt;(x: &amp;'a T) -&gt; T</code> where the lifetime is used only once can just be <code>'_</code> (and there's no tie-lifetimes-together elision going on there).</p>



<a name="264763608"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Thoughts%20on%20%60%27_%60%20in%20the%20compiler%3F/near/264763608" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Thoughts.20on.20.60&#x27;_.60.20in.20the.20compiler.3F.html#264763608">(Dec 13 2021 at 20:15)</a>:</h4>
<p>ah hmm</p>



<a name="264763625"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Thoughts%20on%20%60%27_%60%20in%20the%20compiler%3F/near/264763625" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Thoughts.20on.20.60&#x27;_.60.20in.20the.20compiler.3F.html#264763625">(Dec 13 2021 at 20:15)</a>:</h4>
<p>do you think there's a scenario where you'd want one lint but not the other?</p>



<a name="264763675"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Thoughts%20on%20%60%27_%60%20in%20the%20compiler%3F/near/264763675" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Thoughts.20on.20.60&#x27;_.60.20in.20the.20compiler.3F.html#264763675">(Dec 13 2021 at 20:15)</a>:</h4>
<div class="codehilite"><pre><span></span><code>warning: explicit lifetimes given in parameter types where they could be elided (or replaced with `&#39;_` if needed by type declaration)
 --&gt; src/lib.rs:2:1
  |
2 | fn foo&lt;&#39;a&gt;(x: &amp;&#39;a T) -&gt; T { todo!() }
  | ^^^^^^^^^^^^^^^^^^^^^^^^^
  |
  = note: `#[warn(clippy::needless_lifetimes)]` on by default
</code></pre></div>



<a name="264763725"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Thoughts%20on%20%60%27_%60%20in%20the%20compiler%3F/near/264763725" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Thoughts.20on.20.60&#x27;_.60.20in.20the.20compiler.3F.html#264763725">(Dec 13 2021 at 20:16)</a>:</h4>
<p>Thanks, Jake, I was just trying that <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span></p>



<a name="264763828"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Thoughts%20on%20%60%27_%60%20in%20the%20compiler%3F/near/264763828" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Thoughts.20on.20.60&#x27;_.60.20in.20the.20compiler.3F.html#264763828">(Dec 13 2021 at 20:16)</a>:</h4>
<p>The description of the lint doesn't mention that case.  (Or maybe it does?  I guess it depends exactly how you define the word "elision"...)</p>



<a name="264764107"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Thoughts%20on%20%60%27_%60%20in%20the%20compiler%3F/near/264764107" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Thoughts.20on.20.60&#x27;_.60.20in.20the.20compiler.3F.html#264764107">(Dec 13 2021 at 20:18)</a>:</h4>
<p>OT: there's a difference between "elide" and "infer", but man is it hard for me to say the right thing when talking/typing quickly.</p>



<a name="264764109"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Thoughts%20on%20%60%27_%60%20in%20the%20compiler%3F/near/264764109" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Thoughts.20on.20.60&#x27;_.60.20in.20the.20compiler.3F.html#264764109">(Dec 13 2021 at 20:18)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/Thoughts.20on.20.60'_.60.20in.20the.20compiler.3F/near/264763625">said</a>:</p>
<blockquote>
<p>do you think there's a scenario where you'd want one lint but not the other?</p>
</blockquote>
<p>Maybe?  To me the "single use" lint is like the "unused variable" lint, and thus more obviously "yes, I want that on".</p>
<p>I could imagine deciding that I want to be explicit about my lifetimes around unsafe code if there are a bunch of different parameters, even if elision would work because only one of them has a lifetime.</p>



<a name="264899051"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Thoughts%20on%20%60%27_%60%20in%20the%20compiler%3F/near/264899051" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Thoughts.20on.20.60&#x27;_.60.20in.20the.20compiler.3F.html#264899051">(Dec 14 2021 at 17:58)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232018">Daniel Henry-Mantilla</span> <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/Thoughts.20on.20.60'_.60.20in.20the.20compiler.3F/near/264644933">said</a>:</p>
<blockquote>
<p>Sure! But only provided the linter is able to detect all the "interesting things" <span aria-label="warning" class="emoji emoji-26a0" role="img" title="warning">:warning:</span> if one has to add an <code>#[allow(…)]</code> just to add an extra compiler check in <code>unsafe</code> code, then chances are it will deter some people from writing that extra type annotation altogether.</p>
</blockquote>
<p><span class="user-mention" data-user-id="232018">@Daniel Henry-Mantilla</span> do you think <code>clippy::needless_lifetimes</code> is smart enough it's worth enabling in the compiler?</p>



<a name="264899137"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Thoughts%20on%20%60%27_%60%20in%20the%20compiler%3F/near/264899137" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Thoughts.20on.20.60&#x27;_.60.20in.20the.20compiler.3F.html#264899137">(Dec 14 2021 at 17:59)</a>:</h4>
<p>also, <span class="user-mention" data-user-id="120989">@nnethercote</span> <span class="user-mention" data-user-id="303710">@Gary Guo</span>  would you mind discussing why you think <code>'_</code> would be worse than using <code>'tcx</code> everywhere?</p>



<a name="264899191"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Thoughts%20on%20%60%27_%60%20in%20the%20compiler%3F/near/264899191" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Thoughts.20on.20.60&#x27;_.60.20in.20the.20compiler.3F.html#264899191">(Dec 14 2021 at 17:59)</a>:</h4>
<p>/me is considering making an E-easy issue to get new contributors to fix <code>needless_lifetimes</code> warnings in the compiler</p>



<a name="264899554"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Thoughts%20on%20%60%27_%60%20in%20the%20compiler%3F/near/264899554" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Thoughts.20on.20.60&#x27;_.60.20in.20the.20compiler.3F.html#264899554">(Dec 14 2021 at 18:01)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/Thoughts.20on.20.60'_.60.20in.20the.20compiler.3F/near/264899051">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="232018">Daniel Henry-Mantilla</span> do you think <code>clippy::needless_lifetimes</code> is smart enough it's worth enabling in the compiler?</p>
</blockquote>
<p>oh oops, I missed earlier that you said it was :)<br>
<span class="user-mention silent" data-user-id="232018">Daniel Henry-Mantilla</span> <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/Thoughts.20on.20.60'_.60.20in.20the.20compiler.3F/near/264709570">said</a>:</p>
<blockquote>
<blockquote>
<p>Clippy doesn't complain about this code,</p>
</blockquote>
<p><span class="user-mention silent" data-user-id="116155">Jake Goulding</span> that's awesome news; in that case I see no drawbacks anymore <span aria-label="ok" class="emoji emoji-1f44c" role="img" title="ok">:ok:</span></p>
</blockquote>



<a name="264905159"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Thoughts%20on%20%60%27_%60%20in%20the%20compiler%3F/near/264905159" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Thoughts.20on.20.60&#x27;_.60.20in.20the.20compiler.3F.html#264905159">(Dec 14 2021 at 18:41)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/Thoughts.20on.20.60'_.60.20in.20the.20compiler.3F/near/264899137">said</a>:</p>
<blockquote>
<p>also, <span class="user-mention silent" data-user-id="120989">nnethercote</span> <span class="user-mention silent" data-user-id="303710">Gary Guo</span>  would you mind discussing why you think <code>'_</code> would be worse than using <code>'tcx</code> everywhere?</p>
</blockquote>
<p>I've ran into situations where I have to change <code>'_</code> to <code>'tcx</code> in a few places to get things to borrowck, e.g. when you need to store things into <code>self</code>.</p>



<a name="264905387"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Thoughts%20on%20%60%27_%60%20in%20the%20compiler%3F/near/264905387" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Thoughts.20on.20.60&#x27;_.60.20in.20the.20compiler.3F.html#264905387">(Dec 14 2021 at 18:42)</a>:</h4>
<p>Most cases when a struct has a lifetime in rustc, it's interned and has lifetime <code>'tcx</code>. I don't see the issue of being explicit.</p>



<a name="264905755"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Thoughts%20on%20%60%27_%60%20in%20the%20compiler%3F/near/264905755" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Thoughts.20on.20.60&#x27;_.60.20in.20the.20compiler.3F.html#264905755">(Dec 14 2021 at 18:44)</a>:</h4>
<p>Of course  <code>&amp;'tcx Place&lt;'tcx&gt;</code> etc is still bad. I am just talking about struct lifetime param.</p>



<a name="264906924"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Thoughts%20on%20%60%27_%60%20in%20the%20compiler%3F/near/264906924" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Thoughts.20on.20.60&#x27;_.60.20in.20the.20compiler.3F.html#264906924">(Dec 14 2021 at 18:51)</a>:</h4>
<blockquote>
<p>where I have to change <code>'_</code> to <code>'tcx</code></p>
</blockquote>
<p>Presumably you were also changing the body of the function at the same time?</p>
<p>Would it be valid to say that <code>'tcx</code> may provide a more strict API than <code>'_</code>?</p>



<a name="264911531"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Thoughts%20on%20%60%27_%60%20in%20the%20compiler%3F/near/264911531" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Thoughts.20on.20.60&#x27;_.60.20in.20the.20compiler.3F.html#264911531">(Dec 14 2021 at 19:17)</a>:</h4>
<p>My preference is weak, feel free to ignore it</p>



<a name="264913661"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Thoughts%20on%20%60%27_%60%20in%20the%20compiler%3F/near/264913661" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Thoughts.20on.20.60&#x27;_.60.20in.20the.20compiler.3F.html#264913661">(Dec 14 2021 at 19:34)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116155">Jake Goulding</span> <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/Thoughts.20on.20.60'_.60.20in.20the.20compiler.3F/near/264906924">said</a>:</p>
<blockquote>
<blockquote>
<p>where I have to change <code>'_</code> to <code>'tcx</code></p>
</blockquote>
<p>Presumably you were also changing the body of the function at the same time?</p>
</blockquote>
<p>Yes, but I also need to change the caller. (In this case the <code>'tcx</code> is defined on struct rather than on fn)</p>



<a name="264934278"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Thoughts%20on%20%60%27_%60%20in%20the%20compiler%3F/near/264934278" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Thoughts.20on.20.60&#x27;_.60.20in.20the.20compiler.3F.html#264934278">(Dec 14 2021 at 22:13)</a>:</h4>
<p>When it's <code>TyCtxt&lt;'tcx&gt;</code> the lifetime is not really additional useful data.<br>
I found an example in this PR that makes more sense, at least to me, with the lifetime annotation than without, even though it's strictly speaking possible to omit using <code>'_</code> instead: <a href="https://github.com/rust-lang/rust/pull/91885">https://github.com/rust-lang/rust/pull/91885</a></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>