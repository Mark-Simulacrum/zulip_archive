<html>
<head><meta charset="utf-8"><title>implementing a suggestion (#89856) · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/implementing.20a.20suggestion.20(.2389856).html">implementing a suggestion (#89856)</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="257847625"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/implementing%20a%20suggestion%20%28%2389856%29/near/257847625" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Winter <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/implementing.20a.20suggestion.20(.2389856).html#257847625">(Oct 16 2021 at 17:33)</a>:</h4>
<p>I’ve been thinking about getting into some rustc development, and <a href="https://github.com/rust-lang/rust/issues/89856">https://github.com/rust-lang/rust/issues/89856</a> looks like a not terribly complicated issue to solve.</p>
<p>Just making sure: is <a href="https://rustc-dev-guide.rust-lang.org/diagnostics/sessiondiagnostic.html#optional-diagnostic-attributes">https://rustc-dev-guide.rust-lang.org/diagnostics/sessiondiagnostic.html#optional-diagnostic-attributes</a> the right documentation to be looking at?</p>



<a name="257858853"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/implementing%20a%20suggestion%20%28%2389856%29/near/257858853" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Winter <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/implementing.20a.20suggestion.20(.2389856).html#257858853">(Oct 16 2021 at 20:26)</a>:</h4>
<p><span class="user-mention" data-user-id="119031">@Esteban Küber</span>: Hi, I have a question: where exactly is the error talked about in the issue (E0308) emitted? Is it not in <code>typeck</code>? I ask since I'm trying to find the <code>#[error = "E0308"]</code> attribute, but can't. Or am I going about this the wrong way? Thanks!</p>



<a name="257903843"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/implementing%20a%20suggestion%20%28%2389856%29/near/257903843" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Esteban Küber <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/implementing.20a.20suggestion.20(.2389856).html#257903843">(Oct 17 2021 at 09:22)</a>:</h4>
<p><span class="user-mention" data-user-id="450762">@Winter</span> it is in typeck, but you won't find it with that attribute, because it doesn't use it yet. You can use -Ztreat-err-as-bug to find where it is. I'll try to remember to follow up with you once I'm in my computer to give you the exact link.</p>



<a name="257918697"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/implementing%20a%20suggestion%20%28%2389856%29/near/257918697" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Winter <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/implementing.20a.20suggestion.20(.2389856).html#257918697">(Oct 17 2021 at 13:23)</a>:</h4>
<p>Ah, got it, will give that a try. Thanks :)</p>



<a name="257966110"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/implementing%20a%20suggestion%20%28%2389856%29/near/257966110" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Winter <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/implementing.20a.20suggestion.20(.2389856).html#257966110">(Oct 18 2021 at 01:57)</a>:</h4>
<p><span class="user-mention" data-user-id="119031">@Esteban Küber</span> So it seems that I should add this in <code>typeck::check::expr::FnCtxt::check_expr_with_expectation_and_args</code>, but I'm admittedly a bit lost on how to actually:</p>
<ul>
<li>check if <code>ty</code> and <code>expected</code> are <code>Option</code>s</li>
<li>how to check if the expected <code>Deref</code> impl exists to be able to emit this suggestion</li>
</ul>
<p>Do you have any pointers on where to look for similar code or the module that those kind of things would exist in, or something like that? Thanks!</p>



<a name="258003763"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/implementing%20a%20suggestion%20%28%2389856%29/near/258003763" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Esteban Küber <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/implementing.20a.20suggestion.20(.2389856).html#258003763">(Oct 18 2021 at 09:59)</a>:</h4>
<p>For the first part, you can look at the <code>ty.kind()</code> of both to see if it is an <code>Adt</code>, from which you can take the <code>DefId</code> to check if they are <code>Option</code> types (you might also want to "peel" out the references in case you have something like <code>&amp;Option&lt;T&gt;</code>.</p>



<a name="258003780"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/implementing%20a%20suggestion%20%28%2389856%29/near/258003780" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Esteban Küber <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/implementing.20a.20suggestion.20(.2389856).html#258003780">(Oct 18 2021 at 09:59)</a>:</h4>
<p>for the second it's a bit trickier, but there's code doing that already</p>



<a name="258008731"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/implementing%20a%20suggestion%20%28%2389856%29/near/258008731" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Winter <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/implementing.20a.20suggestion.20(.2389856).html#258008731">(Oct 18 2021 at 10:43)</a>:</h4>
<blockquote>
<p>there’s code doing that already</p>
</blockquote>
<p>in that method you mean?</p>



<a name="258105187"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/implementing%20a%20suggestion%20%28%2389856%29/near/258105187" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Winter <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/implementing.20a.20suggestion.20(.2389856).html#258105187">(Oct 18 2021 at 21:41)</a>:</h4>
<p>My apologies for all of the questions <span class="user-mention" data-user-id="119031">@Esteban Küber</span>, but I can't figure out how I'd create the <code>DefId</code> for <code>Option&lt;T&gt;</code> to compare against, and I've been looking in various crates to find where something similar is done, but I can't. :/</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>