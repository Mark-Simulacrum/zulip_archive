<html>
<head><meta charset="utf-8"><title>debuginfo tests fail because gdb is too helpful? · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/debuginfo.20tests.20fail.20because.20gdb.20is.20too.20helpful.3F.html">debuginfo tests fail because gdb is too helpful?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="273173955"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/debuginfo%20tests%20fail%20because%20gdb%20is%20too%20helpful%3F/near/273173955" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Kimock (Saethlin) <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/debuginfo.20tests.20fail.20because.20gdb.20is.20too.20helpful.3F.html#273173955">(Feb 25 2022 at 01:34)</a>:</h4>
<p>Two of the debuginfo tests are failing locally, I just force-pushed and I'm honestly just praying the test suite passes in CI. Is there anything I can do to fix them? This is what I'm seeing:</p>
<div class="codehilite"><pre><span></span><code>---- [debuginfo-gdb] debuginfo/borrowed-basic.rs stdout ----
NOTE: compiletest thinks it is using GDB with native rust support
NOTE: compiletest thinks it is using GDB version 11002000

error: line not found in debugger output: $3 = 97
status: exit status: 0
command: &quot;/usr/bin/gdb&quot; &quot;-quiet&quot; &quot;-batch&quot; &quot;-nx&quot; &quot;-command=/home/ben/rust/build/x86_64-unknown-linux-gnu/test/debuginfo/borrowed-basic.gdb/borrowed-basic.debugger.script&quot;
--- stdout -------------------------------
GNU gdb (GDB) 11.2
Copyright (C) 2022 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.
Type &quot;show copying&quot; and &quot;show warranty&quot; for details.
This GDB was configured as &quot;x86_64-pc-linux-gnu&quot;.
Type &quot;show configuration&quot; for configuration details.
For bug reporting instructions, please see:
&lt;https://www.gnu.org/software/gdb/bugs/&gt;.
Find the GDB manual and other documentation resources online at:
    &lt;http://www.gnu.org/software/gdb/documentation/&gt;.

For help, type &quot;help&quot;.
Type &quot;apropos word&quot; to search for commands related to &quot;word&quot;.
Breakpoint 1 at 0x1423: file /home/ben/rust/src/test/debuginfo/borrowed-basic.rs, line 161.
[Thread debugging using libthread_db enabled]
Using host libthread_db library &quot;/usr/lib/libthread_db.so.1&quot;.

Breakpoint 1, borrowed_basic::main () at /home/ben/rust/src/test/debuginfo/borrowed-basic.rs:161
161    zzz(); // #break
$1 = true
$2 = -1
$3 = 97 &#39;a&#39;
$4 = 68
$5 = -16
$6 = -32
$7 = -64
$8 = 1
$9 = 100
$10 = 16
$11 = 32
$12 = 64
$13 = 2.5
$14 = 3.5
A debugging session is active.

    Inferior 1 [process 172453] will be killed.

Quit anyway? (y or n) [answered Y; input not from terminal]
</code></pre></div>



<a name="273174377"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/debuginfo%20tests%20fail%20because%20gdb%20is%20too%20helpful%3F/near/273174377" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/debuginfo.20tests.20fail.20because.20gdb.20is.20too.20helpful.3F.html#273174377">(Feb 25 2022 at 01:40)</a>:</h4>
<p>If you aren't making changes to debuginfo related things and those tests are failing locally then it's pretty likely that they'll pass in CI and won't be a problem.</p>



<a name="273174460"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/debuginfo%20tests%20fail%20because%20gdb%20is%20too%20helpful%3F/near/273174460" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/debuginfo.20tests.20fail.20because.20gdb.20is.20too.20helpful.3F.html#273174460">(Feb 25 2022 at 01:42)</a>:</h4>
<p>It's probably a difference in your local gdb version and what CI uses/the tests were written against, I wouldn't worry about fixing them, but if you can confirm that it's the gdb version causing the difference then you could file an issue about it.</p>



<a name="273555219"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/debuginfo%20tests%20fail%20because%20gdb%20is%20too%20helpful%3F/near/273555219" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Kletzander <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/debuginfo.20tests.20fail.20because.20gdb.20is.20too.20helpful.3F.html#273555219">(Feb 28 2022 at 21:16)</a>:</h4>
<p>I could not find an issue filed about it, so I did here: <a href="https://github.com/rust-lang/rust/issues/94458">https://github.com/rust-lang/rust/issues/94458</a><br>
I also added an explanation why that happens, but I'd love to get some hints on how to solve it (apart from what I said there).</p>



<a name="273557365"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/debuginfo%20tests%20fail%20because%20gdb%20is%20too%20helpful%3F/near/273557365" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/debuginfo.20tests.20fail.20because.20gdb.20is.20too.20helpful.3F.html#273557365">(Feb 28 2022 at 21:33)</a>:</h4>
<p>Thanks for filing an issue! The main problem I see is that the version of gdb tested in CI is not 11.2 so the updated tests won't pass CI (as-is). You can have the test runner ignore the tests if the gdb version is less than 11.2 with the <code>// min-gdb-version: 11.2</code> directive (see for example <a href="https://github.com/rust-lang/rust/blob/c651ba8a542c7d89b271efbf024a31091c824f4b/src/test/debuginfo/issue-57822.rs#L5">https://github.com/rust-lang/rust/blob/c651ba8a542c7d89b271efbf024a31091c824f4b/src/test/debuginfo/issue-57822.rs#L5</a>).</p>



<a name="273557487"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/debuginfo%20tests%20fail%20because%20gdb%20is%20too%20helpful%3F/near/273557487" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/debuginfo.20tests.20fail.20because.20gdb.20is.20too.20helpful.3F.html#273557487">(Feb 28 2022 at 21:34)</a>:</h4>
<p>I would be a little concerned to use that lots of places right now since the entire test will be skipped, not just that one assertion but if it's just the two tests you have in your linked commit, that seems ok.</p>



<a name="273559632"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/debuginfo%20tests%20fail%20because%20gdb%20is%20too%20helpful%3F/near/273559632" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Kletzander <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/debuginfo.20tests.20fail.20because.20gdb.20is.20too.20helpful.3F.html#273559632">(Feb 28 2022 at 21:54)</a>:</h4>
<p>I was trying to figure out if there was a way to look for different lines in the output based on gdb version, but I guess that would be an overkill, right?</p>



<a name="273562383"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/debuginfo%20tests%20fail%20because%20gdb%20is%20too%20helpful%3F/near/273562383" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/debuginfo.20tests.20fail.20because.20gdb.20is.20too.20helpful.3F.html#273562383">(Feb 28 2022 at 22:18)</a>:</h4>
<p>The closest thing I can think of would be to use "revisions" <a href="https://rustc-dev-guide.rust-lang.org/tests/compiletest.html#revisions">https://rustc-dev-guide.rust-lang.org/tests/compiletest.html#revisions</a> but I don't think the test runner allows revisions to interact with the test directives (I could be wrong though <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span>)</p>



<a name="273562448"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/debuginfo%20tests%20fail%20because%20gdb%20is%20too%20helpful%3F/near/273562448" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/debuginfo.20tests.20fail.20because.20gdb.20is.20too.20helpful.3F.html#273562448">(Feb 28 2022 at 22:18)</a>:</h4>
<p>The other option would be to use a wildcard (<code>*</code>) at the end of the expression but then we would lose the assertion that it actually shows the character.</p>



<a name="274201878"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/debuginfo%20tests%20fail%20because%20gdb%20is%20too%20helpful%3F/near/274201878" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Kletzander <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/debuginfo.20tests.20fail.20because.20gdb.20is.20too.20helpful.3F.html#274201878">(Mar 04 2022 at 23:15)</a>:</h4>
<p>I found out that using gdbr-check (with the character) and grbg-check (without the character) works in both new and old versions of gdb, but I do not know whether at that point the test is equivalent or not. I guess I'll try to send a PR and will see.</p>



<a name="276915540"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/debuginfo%20tests%20fail%20because%20gdb%20is%20too%20helpful%3F/near/276915540" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Kletzander <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/debuginfo.20tests.20fail.20because.20gdb.20is.20too.20helpful.3F.html#276915540">(Mar 28 2022 at 18:46)</a>:</h4>
<p>Looks like this is solved: <a href="https://github.com/rust-lang/rust/issues/94458">https://github.com/rust-lang/rust/issues/94458</a></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>