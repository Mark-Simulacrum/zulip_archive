<html>
<head><meta charset="utf-8"><title>Help #89374 - Suggestion for typoed crate or module · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Help.20.2389374.20-.20Suggestion.20for.20typoed.20crate.20or.20module.html">Help #89374 - Suggestion for typoed crate or module</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="255387835"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Help%20%2389374%20-%20Suggestion%20for%20typoed%20crate%20or%20module/near/255387835" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Help.20.2389374.20-.20Suggestion.20for.20typoed.20crate.20or.20module.html#255387835">(Sep 29 2021 at 12:15)</a>:</h4>
<p><span class="user-mention" data-user-id="343125">@Takayuki Maeda</span> just running <code>x.py test --bless src/test/ui/hygiene</code> is probably enough, but you may want to fix the bug where the same error is emitted twice since it doesn't look like it's being deduplicated</p>



<a name="255397102"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Help%20%2389374%20-%20Suggestion%20for%20typoed%20crate%20or%20module/near/255397102" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Help.20.2389374.20-.20Suggestion.20for.20typoed.20crate.20or.20module.html#255397102">(Sep 29 2021 at 13:20)</a>:</h4>
<p>Error deduplication is disabled for tests AFAIK.</p>



<a name="255408251"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Help%20%2389374%20-%20Suggestion%20for%20typoed%20crate%20or%20module/near/255408251" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Takayuki Maeda <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Help.20.2389374.20-.20Suggestion.20for.20typoed.20crate.20or.20module.html#255408251">(Sep 29 2021 at 14:26)</a>:</h4>
<p><span class="user-mention" data-user-id="232545">@Joshua Nelson</span> <br>
I'm sorry.  I didn't add enough information. What I want to solve is that the compiler suggests like the following. This suggestion causes compilation errors. I think this is due to the decl_macro feature, but I have no idea in solving the problem.</p>
<div class="codehilite"><pre><span></span><code>error[E0432]: unresolved import `my_core`
  --&gt; $DIR/extern-prelude-from-opaque-fail.rs:20:9
   |
LL |     use my_core;
   |         ^^^^^^^
   |         |
   |         no `my_core` in the root
   |         help: a similar name exists in the module: `my_core`

error[E0432]: unresolved import `my_core`
  --&gt; $DIR/extern-prelude-from-opaque-fail.rs:7:13
   |
LL |         use my_core;
   |             ^^^^^^^ no `my_core` in the root
...
LL | a!();
   | ----- in this macro invocation
   |
   = note: this error originates in the macro `a` (in Nightly builds, run with -Z macro-backtrace for more info)

error[E0433]: failed to resolve: use of undeclared crate or module `my_core`
  --&gt; $DIR/extern-prelude-from-opaque-fail.rs:11:18
   |
LL |         fn f() { my_core::mem::drop(0); }
   |                  ^^^^^^^
   |                  |
   |                  use of undeclared crate or module `my_core`
   |                  help: a similar crate or module exists: `my_core`
...
LL | a!();
   | ----- in this macro invocation
   |
   = note: this error originates in the macro `a` (in Nightly builds, run with -Z macro-backtrace for more info)

error[E0433]: failed to resolve: use of undeclared crate or module `my_core`
  --&gt; $DIR/extern-prelude-from-opaque-fail.rs:24:14
   |
LL |     fn f() { my_core::mem::drop(0); }
   |              ^^^^^^^
   |              |
   |              use of undeclared crate or module `my_core`
   |              help: a similar crate or module exists: `my_core`

error: aborting due to 4 previous errors

Some errors have detailed explanations: E0432, E0433.
For more information about an error, try `rustc --explain E0432`.
</code></pre></div>



<a name="255408537"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Help%20%2389374%20-%20Suggestion%20for%20typoed%20crate%20or%20module/near/255408537" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Help.20.2389374.20-.20Suggestion.20for.20typoed.20crate.20or.20module.html#255408537">(Sep 29 2021 at 14:27)</a>:</h4>
<p><span class="user-mention" data-user-id="343125">@Takayuki Maeda</span> I don't know what's going on with that error, but a simple fix is not to give the suggestion if the new module name is the same as the one being replaced</p>



<a name="255410825"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Help%20%2389374%20-%20Suggestion%20for%20typoed%20crate%20or%20module/near/255410825" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Takayuki Maeda <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Help.20.2389374.20-.20Suggestion.20for.20typoed.20crate.20or.20module.html#255410825">(Sep 29 2021 at 14:40)</a>:</h4>
<p><span class="user-mention" data-user-id="232545">@Joshua Nelson</span> </p>
<p>Thank you! In this file a decl_macro <code>a</code> declares <code>extern crate core as my_core</code> internally and <code>my_core::mem::drop(0)</code> is called in a <code>f()</code> function outside the decl_macro.  So <code>my_core::mem::drop(0)</code> causes a <code>failed to resolve</code> error, but the compiler suggests a similar crate name which the function cannot use.</p>



<a name="255411337"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Help%20%2389374%20-%20Suggestion%20for%20typoed%20crate%20or%20module/near/255411337" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Takayuki Maeda <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Help.20.2389374.20-.20Suggestion.20for.20typoed.20crate.20or.20module.html#255411337">(Sep 29 2021 at 14:43)</a>:</h4>
<p>So if I apply your simple fix, the compiler suggests a similar crate name like the following when I use a typoed crate name.</p>
<div class="codehilite"><pre><span></span><code>error[E0433]: failed to resolve: use of undeclared crate or module `my_cor`
  --&gt; /Users/tako8ki/GitHub/rust/rust/src/test/ui/hygiene/extern-prelude-from-opaque-fail.rs:24:14
   |
LL |     fn f() { my_cor::mem::drop(0); }
   |              ^^^^^^
   |              |
   |              use of undeclared crate or module `my_cor`
   |              help: a similar crate or module exists: `my_core`
</code></pre></div>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>