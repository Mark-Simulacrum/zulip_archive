<html>
<head><meta charset="utf-8"><title>Getting into solving ICEs · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html">Getting into solving ICEs</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="274597398"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274597398" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274597398">(Mar 08 2022 at 19:56)</a>:</h4>
<p>Hey everyone! I wanted to start contributing to Rust more and thought I'd love to try and solve an ICE. Can anyone help mentor me?</p>



<a name="274597680"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274597680" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274597680">(Mar 08 2022 at 19:58)</a>:</h4>
<p>Ah, maybe, but it depends on the ICE. Pick one that interests you!</p>



<a name="274598014"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274598014" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274598014">(Mar 08 2022 at 20:00)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/issues/94710">https://github.com/rust-lang/rust/issues/94710</a> this one looks cool! I think I'll try to tackle this</p>



<a name="274598764"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274598764" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Urgau <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274598764">(Mar 08 2022 at 20:05)</a>:</h4>
<p>There is no MCVE and the issue here looks like it's related to incremental compilation. I would recommend starting with something easier.</p>



<a name="274600280"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274600280" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274600280">(Mar 08 2022 at 20:16)</a>:</h4>
<p>Hmm, opening this, we see the last call before panic was this:</p>
<blockquote>
<p><code>3: &lt;rustc_metadata::creader::CStore as rustc_session::cstore::CrateStore&gt;::def_path_hash_to_def_id</code></p>
</blockquote>
<p>So I searched the repo for that function: <a href="https://github.com/rust-lang/rust/search?q=def_path_hash_to_def_id">https://github.com/rust-lang/rust/search?q=def_path_hash_to_def_id</a><br>
And found the implementation here: <a href="https://github.com/rust-lang/rust/blob/7ccfe2ff1d59666dc0188dfd5847304fec257565/compiler/rustc_metadata/src/rmeta/decoder/cstore_impl.rs">https://github.com/rust-lang/rust/blob/7ccfe2ff1d59666dc0188dfd5847304fec257565/compiler/rustc_metadata/src/rmeta/decoder/cstore_impl.rs</a></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">    </span><span class="k">fn</span> <span class="nf">def_path_hash_to_def_id</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">cnum</span>: <span class="nc">CrateNum</span><span class="p">,</span><span class="w"> </span><span class="n">hash</span>: <span class="nc">DefPathHash</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">DefId</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">def_index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">get_crate_data</span><span class="p">(</span><span class="n">cnum</span><span class="p">).</span><span class="n">def_path_hash_to_def_index</span><span class="p">(</span><span class="n">hash</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">DefId</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">krate</span>: <span class="nc">cnum</span><span class="p">,</span><span class="w"> </span><span class="n">index</span>: <span class="nc">def_index</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>There's no panic in that function, so it must be one of the functions called internally panicking, and indeed I recheck the panic message because I was a fool not to check it first:</p>
<blockquote>
<p>thread 'rustc' panicked at 'called <code>Option::unwrap()</code> on a <code>None</code> value', compiler/rustc_metadata/src/rmeta/def_path_hash_map.rs:18:85<br>
And yes, it's <code>def_path_hash_to_def_index</code> which will be at that path.</p>
</blockquote>
<p>So yep.<br>
It's almost certainly incr comp.</p>



<a name="274600403"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274600403" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274600403">(Mar 08 2022 at 20:17)</a>:</h4>
<p>Yeah, I should find something easier.</p>



<a name="274600528"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274600528" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274600528">(Mar 08 2022 at 20:18)</a>:</h4>
<p>tbh, it's almost not because of "finding something easier", as it is very hard to tell when incr comp issues can be <strong>closed</strong>.</p>



<a name="274600543"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274600543" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274600543">(Mar 08 2022 at 20:18)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/issues/94654">https://github.com/rust-lang/rust/issues/94654</a> This looks good?</p>



<a name="274600627"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274600627" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274600627">(Mar 08 2022 at 20:19)</a>:</h4>
<p>Also, what does MCVE stand for?</p>



<a name="274600663"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274600663" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274600663">(Mar 08 2022 at 20:19)</a>:</h4>
<p>yes.<br>
Minimum Complete Verifiable Example</p>



<a name="274600733"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274600733" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274600733">(Mar 08 2022 at 20:19)</a>:</h4>
<p>Ah, fantastic</p>



<a name="274600823"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274600823" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Urgau <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274600823">(Mar 08 2022 at 20:20)</a>:</h4>
<p><a href="https://stackoverflow.com/help/minimal-reproducible-example">https://stackoverflow.com/help/minimal-reproducible-example</a></p>



<a name="274600829"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274600829" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274600829">(Mar 08 2022 at 20:20)</a>:</h4>
<p><a href="https://github.com/rust-lang/cargo-bisect-rustc">https://github.com/rust-lang/cargo-bisect-rustc</a> I found this tool, was wondering if this should be used for solving ICEs?</p>



<a name="274600969"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274600969" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274600969">(Mar 08 2022 at 20:21)</a>:</h4>
<p>Possibly.<br>
For this one, it might not be as helpful, because it looks like this is a parallel-compiler-only version, one of the many tiny issues blocking enabling a parallel compiler.</p>



<a name="274601003"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274601003" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274601003">(Mar 08 2022 at 20:21)</a>:</h4>
<blockquote>
<p>NOTE this is the alt master rustc, installed via rustup-toolchain-install-master -f -n master -c rustc-dev llvm-tools rust-src clippy rust-analyzer --alt</p>
</blockquote>



<a name="274601086"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274601086" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274601086">(Mar 08 2022 at 20:22)</a>:</h4>
<p>Oh yeah, good point.<br>
And a parallel compiler? Dreams coming true!</p>



<a name="274601224"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274601224" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274601224">(Mar 08 2022 at 20:23)</a>:</h4>
<p>Unfortunately it's been stuck for a while now due to many tiny little problems.</p>



<a name="274601460"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274601460" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274601460">(Mar 08 2022 at 20:25)</a>:</h4>
<p>Well, solving this is a step in the right direction I suppose!<br>
Anyway, how should I go about fixing this? Is there a specific place you look for this kind of error?</p>



<a name="274601529"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274601529" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274601529">(Mar 08 2022 at 20:26)</a>:</h4>
<p>Ah, well, first we would visit the traceback:</p>
<blockquote>
<p>thread '&lt;unnamed&gt;' panicked at 'WorkerLocal can only be used on the thread pool it was created on', /cargo/registry/src/github.com-1ecc6299db9ec823/rustc-rayon-core-0.3.2/src/worker_local.rs:49:17</p>
</blockquote>



<a name="274601667"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274601667" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274601667">(Mar 08 2022 at 20:26)</a>:</h4>
<p>Yeah, looked there, noticed that rustc-rayon-core was well.. not in rustc?</p>



<a name="274601795"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274601795" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274601795">(Mar 08 2022 at 20:27)</a>:</h4>
<p>Because of that, I'm not exactly sure where to look? Surely this shouldn't require making a crate change their code.</p>



<a name="274601800"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274601800" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274601800">(Mar 08 2022 at 20:28)</a>:</h4>
<p>Yep!<br>
rustc is actually mostly built using cargo!</p>



<a name="274601890"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274601890" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274601890">(Mar 08 2022 at 20:28)</a>:</h4>
<p>Ah, I see. So I presume that rustc-rayon-core is being used somewhere in rustc?</p>



<a name="274601904"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274601904" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274601904">(Mar 08 2022 at 20:28)</a>:</h4>
<p>Yep!</p>



<a name="274601946"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274601946" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274601946">(Mar 08 2022 at 20:29)</a>:</h4>
<p>rustc has a somewhat esoteric bootstrap system so that it can do a run-around the normal stability path for cargo and rustc and std features.</p>



<a name="274602089"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274602089" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274602089">(Mar 08 2022 at 20:30)</a>:</h4>
<p>Yeah, the repo and bootstrap stuff is honestly amazing</p>
<p>So, where is rustc-rayon-core "being defined"? Where is the code for the crate in the repo?<br>
I just ran a quick search and didn't find anything.</p>



<a name="274602242"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274602242" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274602242">(Mar 08 2022 at 20:31)</a>:</h4>
<p>But that bootstrap process essentially amounts to "pulling in and building a few things and then getting cargo up and running and driving it through the rest of the build with custom commands."</p>
<p>Hmm.</p>



<a name="274602352"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274602352" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274602352">(Mar 08 2022 at 20:32)</a>:</h4>
<p>These are the crates which depend on rustc-rayon:<br>
<a href="https://github.com/rust-lang/rust/search?q=rustc-rayon">https://github.com/rust-lang/rust/search?q=rustc-rayon</a></p>



<a name="274602420"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274602420" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274602420">(Mar 08 2022 at 20:32)</a>:</h4>
<p>Yeah, saw them depending on it but couldn't actually find where the crate was being defined. Like, where the file is?</p>



<a name="274602441"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274602441" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274602441">(Mar 08 2022 at 20:33)</a>:</h4>
<p>oh.</p>



<a name="274602454"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274602454" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274602454">(Mar 08 2022 at 20:33)</a>:</h4>
<p><a href="https://github.com/rust-lang/rustc-rayon/blob/rustc/rayon-core/src/worker_local.rs#L43-L54">https://github.com/rust-lang/rustc-rayon/blob/rustc/rayon-core/src/worker_local.rs#L43-L54</a></p>



<a name="274602629"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274602629" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274602629">(Mar 08 2022 at 20:34)</a>:</h4>
<p>Thanks!<br>
So the ICE is coming from that panic. Does that mean that the more or less usage of rustc-rayon is at fault? Or that function?</p>



<a name="274603024"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274603024" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274603024">(Mar 08 2022 at 20:37)</a>:</h4>
<p>That's a philosophical question I cannot answer.</p>



<a name="274603182"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274603182" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274603182">(Mar 08 2022 at 20:38)</a>:</h4>
<p>Ah, alright.<br>
If you don't mind me asking, how am I supposed to fix this? Like, the code.</p>



<a name="274603352"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274603352" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274603352">(Mar 08 2022 at 20:39)</a>:</h4>
<p>The ICE will stop when the caller of the function no longer calls the function in a way that leads to the ICE.</p>



<a name="274603358"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274603358" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274603358">(Mar 08 2022 at 20:39)</a>:</h4>
<p><em>nods sagely</em></p>



<a name="274603528"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274603528" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274603528">(Mar 08 2022 at 20:40)</a>:</h4>
<p>Either because the function is not called, or the function no longer causes a panic when it is called... which happens does not matter.</p>



<a name="274603568"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274603568" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274603568">(Mar 08 2022 at 20:41)</a>:</h4>
<p>Ah</p>



<a name="274603717"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274603717" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274603717">(Mar 08 2022 at 20:42)</a>:</h4>
<p>So, now I need to find where the function is being called</p>



<a name="274603763"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274603763" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274603763">(Mar 08 2022 at 20:42)</a>:</h4>
<p>Specifically the invocation causing this ICE</p>



<a name="274603864"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274603864" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274603864">(Mar 08 2022 at 20:44)</a>:</h4>
<p>Indeed.<br>
The backtrace in that issue may continue to be informative (it is behind a click-to-expand widget)</p>



<a name="274604022"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274604022" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274604022">(Mar 08 2022 at 20:45)</a>:</h4>
<p>Found it!</p>



<a name="274604217"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274604217" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274604217">(Mar 08 2022 at 20:46)</a>:</h4>
<p>Seems to be libunwind.rs:95</p>



<a name="274604290"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274604290" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274604290">(Mar 08 2022 at 20:47)</a>:</h4>
<p>Oh. I think that might be the backtrace stuff..</p>



<a name="274604415"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274604415" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274604415">(Mar 08 2022 at 20:48)</a>:</h4>
<p>/std/src/sys/unix/thread.rs:108:17 seems more like it.</p>



<a name="274604625"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274604625" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274604625">(Mar 08 2022 at 20:49)</a>:</h4>
<p>yeah at the end it says:</p>
<blockquote>
<p>deadlock handler panicked, aborting process<br>
[1]    859470 IOT instruction (core dumped)  ~/.rustup/toolchains/master/bin/rustc ./72554.rs</p>
</blockquote>



<a name="274604746"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274604746" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274604746">(Mar 08 2022 at 20:50)</a>:</h4>
<p>So something is deadlocking?<br>
<a href="https://github.com/Milo123459/rust/blob/64187b837486be90b897c7014572aa3537dc9b27/library/std/src/sys/unix/thread.rs#L102-L111">https://github.com/Milo123459/rust/blob/64187b837486be90b897c7014572aa3537dc9b27/library/std/src/sys/unix/thread.rs#L102-L111</a> This is the relevant code (I think)</p>



<a name="274604811"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274604811" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274604811">(Mar 08 2022 at 20:51)</a>:</h4>
<p>and we can see here where <code>begin_panic</code> is called, and the call right before it:</p>
<blockquote>
<p>14:     0x7f84683d2fe9 - std[54a224735ab911a]::panicking::begin_panic::&lt;&amp;str&gt;<br>
 15:     0x7f84694a43d0 - rustc_query_system[1506d2c0f1ca8e4e]::query::plumbing::get_query::&lt;rustc_query_impl[5f52c835d70aa024]::queries::generics_of, rustc_query_impl[5f52c835d70aa024]::plumbing::QueryCtxt&gt;</p>
</blockquote>



<a name="274604868"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274604868" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274604868">(Mar 08 2022 at 20:51)</a>:</h4>
<p>Oh, so it's not in the file I sent?</p>



<a name="274605107"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274605107" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274605107">(Mar 08 2022 at 20:53)</a>:</h4>
<p>That seems to make me think that it's coming from query::plumbing::get_query?</p>



<a name="274605147"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274605147" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274605147">(Mar 08 2022 at 20:53)</a>:</h4>
<p>ooh, and then there's this... Hmmm... tricky.</p>
<div class="spoiler-block"><div class="spoiler-header">
</div><div class="spoiler-content" aria-hidden="true">
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">  </span><span class="mi">28</span>:     <span class="mh">0x7f84683f5a78</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">rustc_query_impl</span><span class="p">[</span><span class="mi">5</span><span class="n">f52c835d70aa024</span><span class="p">]</span>::<span class="n">Queries</span><span class="o">&gt;</span>::<span class="n">try_collect_active_jobs</span><span class="w"></span>
<span class="w">  </span><span class="mi">29</span>:     <span class="mh">0x7f84683d33a3</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">rustc_query_system</span><span class="p">[</span><span class="mi">1506</span><span class="n">d2c0f1ca8e4e</span><span class="p">]</span>::<span class="n">query</span>::<span class="n">job</span>::<span class="n">deadlock</span>::<span class="o">&lt;</span><span class="n">rustc_query_impl</span><span class="p">[</span><span class="mi">5</span><span class="n">f52c835d70aa024</span><span class="p">]</span>::<span class="n">plumbing</span>::<span class="n">QueryCtxt</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">30</span>:     <span class="mh">0x7f8467b81f76</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">scoped_tls</span><span class="p">[</span><span class="n">a76d38c46f15ed9e</span><span class="p">]</span>::<span class="n">ScopedKey</span><span class="o">&lt;</span><span class="n">rustc_span</span><span class="p">[</span><span class="mi">1</span><span class="n">b916fa4cb305af0</span><span class="p">]</span>::<span class="n">SessionGlobals</span><span class="o">&gt;&gt;</span>::<span class="n">set</span>::<span class="o">&lt;</span><span class="n">rustc_interface</span><span class="p">[</span><span class="n">ee304f5e577cf6b9</span><span class="p">]</span>::<span class="n">util</span>::<span class="n">handle_deadlock</span>::<span class="p">{</span><span class="n">closure</span>#<span class="mi">1</span><span class="p">}</span>::<span class="p">{</span><span class="n">closure</span>#<span class="mi">0</span><span class="p">}</span>::<span class="p">{</span><span class="n">closure</span>#<span class="mi">0</span><span class="p">},</span><span class="w"> </span><span class="p">()</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">31</span>:     <span class="mh">0x7f8467bcded6</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">rustc_rayon_core</span><span class="p">[</span><span class="n">dda15808133c3082</span><span class="p">]</span>::<span class="n">tlv</span>::<span class="n">with</span>::<span class="o">&lt;</span><span class="n">rustc_middle</span><span class="p">[</span><span class="mi">101</span><span class="n">c9dc362f50b21</span><span class="p">]</span>::<span class="n">ty</span>::<span class="n">context</span>::<span class="n">tls</span>::<span class="n">enter_context</span><span class="o">&lt;</span><span class="n">rustc_interface</span><span class="p">[</span><span class="n">ee304f5e577cf6b9</span><span class="p">]</span>::<span class="n">util</span>::<span class="n">handle_deadlock</span>::<span class="p">{</span><span class="n">closure</span>#<span class="mi">1</span><span class="p">}</span>::<span class="p">{</span><span class="n">closure</span>#<span class="mi">0</span><span class="p">},</span><span class="w"> </span><span class="p">()</span><span class="o">&gt;</span>::<span class="p">{</span><span class="n">closure</span>#<span class="mi">0</span><span class="p">},</span><span class="w"> </span><span class="p">()</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">32</span>:     <span class="mh">0x7f8467b8401d</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span><span class="p">[</span><span class="mi">54</span><span class="n">a224735ab911a</span><span class="p">]</span>::<span class="n">sys_common</span>::<span class="n">backtrace</span>::<span class="n">__rust_begin_short_backtrace</span>::<span class="o">&lt;</span><span class="n">rustc_interface</span><span class="p">[</span><span class="n">ee304f5e577cf6b9</span><span class="p">]</span>::<span class="n">util</span>::<span class="n">handle_deadlock</span>::<span class="p">{</span><span class="n">closure</span>#<span class="mi">1</span><span class="p">},</span><span class="w"> </span><span class="p">()</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">33</span>:     <span class="mh">0x7f8467b7bc5a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span><span class="p">[</span><span class="mi">54</span><span class="n">a224735ab911a</span><span class="p">]</span>::<span class="n">panicking</span>::<span class="kr">try</span>::<span class="o">&lt;</span><span class="p">(),</span><span class="w"> </span><span class="n">core</span><span class="p">[</span><span class="n">f66f8263def5172a</span><span class="p">]</span>::<span class="n">panic</span>::<span class="n">unwind_safe</span>::<span class="n">AssertUnwindSafe</span><span class="o">&lt;&lt;</span><span class="n">std</span><span class="p">[</span><span class="mi">54</span><span class="n">a224735ab911a</span><span class="p">]</span>::<span class="n">thread</span>::<span class="n">Builder</span><span class="o">&gt;</span>::<span class="n">spawn_unchecked_</span><span class="o">&lt;</span><span class="n">rustc_interface</span><span class="p">[</span><span class="n">ee304f5e577cf6b9</span><span class="p">]</span>::<span class="n">util</span>::<span class="n">handle_deadlock</span>::<span class="p">{</span><span class="n">closure</span>#<span class="mi">1</span><span class="p">},</span><span class="w"> </span><span class="p">()</span><span class="o">&gt;</span>::<span class="p">{</span><span class="n">closure</span>#<span class="mi">1</span><span class="p">}</span>::<span class="p">{</span><span class="n">closure</span>#<span class="mi">0</span><span class="p">}</span><span class="o">&gt;&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">34</span>:     <span class="mh">0x7f8467b77dec</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="n">std</span><span class="p">[</span><span class="mi">54</span><span class="n">a224735ab911a</span><span class="p">]</span>::<span class="n">thread</span>::<span class="n">Builder</span><span class="o">&gt;</span>::<span class="n">spawn_unchecked_</span><span class="o">&lt;</span><span class="n">rustc_interface</span><span class="p">[</span><span class="n">ee304f5e577cf6b9</span><span class="p">]</span>::<span class="n">util</span>::<span class="n">handle_deadlock</span>::<span class="p">{</span><span class="n">closure</span>#<span class="mi">1</span><span class="p">},</span><span class="w"> </span><span class="p">()</span><span class="o">&gt;</span>::<span class="p">{</span><span class="n">closure</span>#<span class="mi">1</span><span class="p">}</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">core</span><span class="p">[</span><span class="n">f66f8263def5172a</span><span class="p">]</span>::<span class="n">ops</span>::<span class="n">function</span>::<span class="nb">FnOnce</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;&gt;</span>::<span class="n">call_once</span>::<span class="p">{</span><span class="n">shim</span>:<span class="nc">vtable</span>#<span class="mi">0</span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="mi">35</span>:     <span class="mh">0x7f84672ab8c3</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">alloc</span>::<span class="n">boxed</span>::<span class="nb">Box</span><span class="o">&lt;</span><span class="n">F</span><span class="p">,</span><span class="n">A</span><span class="o">&gt;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">core</span>::<span class="n">ops</span>::<span class="n">function</span>::<span class="nb">FnOnce</span><span class="o">&lt;</span><span class="n">Args</span><span class="o">&gt;&gt;</span>::<span class="n">call_once</span>::<span class="n">hb7ce1f9a74daab59</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">c274e4969f058b1c644243181ece9f829efa7594</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">alloc</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">boxed</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1854</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">  </span><span class="mi">36</span>:     <span class="mh">0x7f84672ab8c3</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">alloc</span>::<span class="n">boxed</span>::<span class="nb">Box</span><span class="o">&lt;</span><span class="n">F</span><span class="p">,</span><span class="n">A</span><span class="o">&gt;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">core</span>::<span class="n">ops</span>::<span class="n">function</span>::<span class="nb">FnOnce</span><span class="o">&lt;</span><span class="n">Args</span><span class="o">&gt;&gt;</span>::<span class="n">call_once</span>::<span class="n">hc28d1f774d95b80d</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">c274e4969f058b1c644243181ece9f829efa7594</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">alloc</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">boxed</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1854</span>:<span class="mi">9</span><span class="w"></span>
</code></pre></div>
</div></div>



<a name="274605291"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274605291" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274605291">(Mar 08 2022 at 20:54)</a>:</h4>
<p>This backtrace stuff is crazy confusing</p>



<a name="274605526"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274605526" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274605526">(Mar 08 2022 at 20:56)</a>:</h4>
<p>Yeah I'm completely lost</p>



<a name="274605564"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274605564" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274605564">(Mar 08 2022 at 20:56)</a>:</h4>
<p>Well this is the full backtrace, so it has some mostly-irrelevant noise to sift.<br>
If memory serves, 39 is where the thread begins life, and 0 is where the backtrace finishes.</p>



<a name="274605704"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274605704" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274605704">(Mar 08 2022 at 20:57)</a>:</h4>
<p>Right..</p>



<a name="274605876"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274605876" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274605876">(Mar 08 2022 at 20:59)</a>:</h4>
<p>God, I'm lost completely again. Closest thing I found was the link I sent earlier and this backtrace  is only confusing me more lol</p>



<a name="274606434"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274606434" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274606434">(Mar 08 2022 at 21:02)</a>:</h4>
<p>Alright, if memory serves, 35 and 36 are the Rust runtime starting up which happens to flow through a couple closures.<br>
What really matters is that we then enter the compiler via <code>handle_deadlock</code> here:<br>
<a href="https://github.com/rust-lang/rust/blob/8fa5d74a7cb01ceaf1a07aa6fcaf42137d8bda58/compiler/rustc_interface/src/util.rs#L148-L169">https://github.com/rust-lang/rust/blob/8fa5d74a7cb01ceaf1a07aa6fcaf42137d8bda58/compiler/rustc_interface/src/util.rs#L148-L169</a></p>



<a name="274606601"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274606601" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274606601">(Mar 08 2022 at 21:03)</a>:</h4>
<p>And then we get all the way up to the query call at 15, and then inside call <code>WorkerLocal::current</code> in a way that causes us to panic.</p>



<a name="274606770"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274606770" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274606770">(Mar 08 2022 at 21:04)</a>:</h4>
<p>So the problem is in <code>backtrace[15..=34]</code></p>



<a name="274607029"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274607029" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274607029">(Mar 08 2022 at 21:06)</a>:</h4>
<p>Right! Thanks for the information. I'll take another look at the backtrace and see what I can find</p>



<a name="274607377"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274607377" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274607377">(Mar 08 2022 at 21:09)</a>:</h4>
<p>I think it's coming from a spawn_unchecked function</p>



<a name="274607829"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274607829" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274607829">(Mar 08 2022 at 21:13)</a>:</h4>
<p>plubming::get_query I guess</p>



<a name="274608334"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274608334" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274608334">(Mar 08 2022 at 21:17)</a>:</h4>
<p>This may not be a good ICE to work on, in that the parallel compiler is not being actively maintained and the fix here is likely to be pretty difficult, I suspect, to identify and work out some patch for</p>



<a name="274608368"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274608368" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274608368">(Mar 08 2022 at 21:17)</a>:</h4>
<p>(particularly for a first-ish issue, it's likely biting off a lot :)</p>



<a name="274608474"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274608474" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274608474">(Mar 08 2022 at 21:18)</a>:</h4>
<p>Ah, let me find another issue.</p>



<a name="274608502"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274608502" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274608502">(Mar 08 2022 at 21:18)</a>:</h4>
<p>Hey, we've made some progress.<br>
We now know what a difficult-to-solve problem looks like. :^)</p>



<a name="274608537"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274608537" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274608537">(Mar 08 2022 at 21:19)</a>:</h4>
<p>I also learnt that backtraces are a living hell hole to read!</p>



<a name="274608595"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274608595" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274608595">(Mar 08 2022 at 21:19)</a>:</h4>
<p>haha.</p>



<a name="274608620"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274608620" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274608620">(Mar 08 2022 at 21:19)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/issues/94680">https://github.com/rust-lang/rust/issues/94680</a> this looks like a good one</p>



<a name="274608716"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274608716" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274608716">(Mar 08 2022 at 21:20)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116122">simulacrum</span> <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/Getting.20into.20solving.20ICEs/near/274608334">said</a>:</p>
<blockquote>
<p>This may not be a good ICE to work on, in that the parallel compiler is not being actively maintained and the fix here is likely to be pretty difficult, I suspect, to identify and work out some patch for</p>
</blockquote>
<p>Should there be something like a label for the parallel compiler?</p>



<a name="274608836"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274608836" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274608836">(Mar 08 2022 at 21:21)</a>:</h4>
<p>I just applied some labels.</p>



<a name="274609090"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274609090" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274609090">(Mar 08 2022 at 21:23)</a>:</h4>
<p>Hold on, this issue <a href="https://github.com/rust-lang/rust/issues/94680">https://github.com/rust-lang/rust/issues/94680</a> don't have a backtrace? It seems to be compressed into the error output?</p>



<a name="274609762"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274609762" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274609762">(Mar 08 2022 at 21:28)</a>:</h4>
<p>yeah. Sometimes people report bugs in a different way!</p>



<a name="274652044"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274652044" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274652044">(Mar 09 2022 at 07:37)</a>:</h4>
<p>Ok, so after looking at the backtrace, I think that it is coming from here:<br>
<code>  13:     0x7fce64e2dea6 - std[54a224735ab911a]::sys_common::backtrace::__rust_end_short_backtrace::&lt;std[54a224735ab911a]::panicking::begin_panic&lt;rustc_errors[e9d593471e7e5a86]::ExplicitBug&gt;::{closure#0}, !&gt;</code> (backtrace line 13)</p>



<a name="274652047"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274652047" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274652047">(Mar 09 2022 at 07:37)</a>:</h4>
<p>Though, I'm not sure</p>



<a name="274654383"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274654383" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cjgillot <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274654383">(Mar 09 2022 at 08:10)</a>:</h4>
<p>IIRC, this ICE comes from attempting to allocate on an arena while being in the deadlock handler.  The arena is in a WorkerLocal object, and the deadlock is in a separate thread unknown to the WorkerLocal.  Getting rid of it requires to drop a call to store_nocache somewhere in the query system.</p>



<a name="274745406"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274745406" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eignnx <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274745406">(Mar 09 2022 at 20:11)</a>:</h4>
<p><span class="user-mention silent" data-user-id="248906">cjgillot</span>, is this in reference to issue <a href="https://github.com/rust-lang/rust/issues/94654">#94654</a>? I believe <span class="user-mention silent" data-user-id="448200">Milo123459</span> is working on a different issue now, though this seems like good info to comment in <a href="https://github.com/rust-lang/rust/issues/94654">#94654</a></p>



<a name="274745997"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274745997" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cjgillot <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274745997">(Mar 09 2022 at 20:15)</a>:</h4>
<p>Indeed.</p>



<a name="274747208"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274747208" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274747208">(Mar 09 2022 at 20:23)</a>:</h4>
<p>I am working on a different issue: <a href="https://github.com/rust-lang/rust/issues/94680">https://github.com/rust-lang/rust/issues/94680</a></p>



<a name="274755568"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274755568" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Goulet (compiler-errors) <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274755568">(Mar 09 2022 at 21:34)</a>:</h4>
<p><span class="user-mention" data-user-id="448200">@Milo123459</span> I’m not sure if <a href="https://github.com/rust-lang/rust/issues/94680">#94680</a> is a particularly good first ICE to fix. It’s a class of issues I’ve been brainstorming the best way to fix for a while now, and I don’t think it has a particularly good fix without making some changes to how we verify trivially known-false bounds in codegen.</p>



<a name="274756277"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274756277" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274756277">(Mar 09 2022 at 21:40)</a>:</h4>
<p>Haha, of course. I'll find another one.</p>



<a name="274756843"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274756843" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Goulet (compiler-errors) <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274756843">(Mar 09 2022 at 21:46)</a>:</h4>
<p>if you’re not looking for ICEs in particular, Mara put up <a href="https://github.com/rust-lang/rust/issues/94770">#94770</a> today. It looks like a pretty cool issue.</p>



<a name="274758863"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274758863" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274758863">(Mar 09 2022 at 22:03)</a>:</h4>
<p>I do want to do an ice</p>



<a name="274879137"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/274879137" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#274879137">(Mar 10 2022 at 18:54)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/issues/92004">https://github.com/rust-lang/rust/issues/92004</a> This a good issue?</p>



<a name="275047501"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/275047501" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#275047501">(Mar 11 2022 at 23:16)</a>:</h4>
<p><span class="user-mention" data-user-id="281757">@Jubilee</span> any thoughts?</p>



<a name="275047553"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/275047553" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#275047553">(Mar 11 2022 at 23:16)</a>:</h4>
<p>Hello!</p>



<a name="275047568"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/275047568" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#275047568">(Mar 11 2022 at 23:17)</a>:</h4>
<p>Hey!</p>



<a name="275047635"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/275047635" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#275047635">(Mar 11 2022 at 23:17)</a>:</h4>
<p>Yeah it seems to have mentorship instructions which at least makes it a decent candidate for taking a look at. <a href="https://github.com/rust-lang/rust/issues/92004#issuecomment-996117829">https://github.com/rust-lang/rust/issues/92004#issuecomment-996117829</a></p>



<a name="275047742"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/275047742" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#275047742">(Mar 11 2022 at 23:18)</a>:</h4>
<p>Might be good to try to work on minimizing the solution further.</p>



<a name="275047778"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/275047778" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#275047778">(Mar 11 2022 at 23:18)</a>:</h4>
<p>Alright, cool! Thanks for the info</p>



<a name="275047929"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/275047929" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#275047929">(Mar 11 2022 at 23:20)</a>:</h4>
<p>This is a very minimal one that sshhhhhould be easy to fix. <a href="https://github.com/rust-lang/rust/issues/94822">https://github.com/rust-lang/rust/issues/94822</a></p>



<a name="275048169"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/275048169" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#275048169">(Mar 11 2022 at 23:22)</a>:</h4>
<p>because as you may have noticed, this has a fairly straight line into the error:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="mi">16</span>:     <span class="mh">0x7fb1f1ac39d2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">core</span>::<span class="n">panicking</span>::<span class="n">panic_bounds_check</span>::<span class="n">h3395e3e30f1cf171</span><span class="w"></span>
<span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">1</span><span class="n">eb72580d076935a3e590deb6e5813a5aef3eca4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">84</span>:<span class="mi">5</span><span class="w"></span>
<span class="mi">17</span>:     <span class="mh">0x7fb1f306383a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">rustc_infer</span><span class="p">[</span><span class="mi">51</span><span class="n">c380136aeb3624</span><span class="p">]</span>::<span class="n">infer</span>::<span class="n">InferCtxt</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">rustc_trait_selection</span><span class="p">[</span><span class="mi">5</span><span class="n">f3069b2459f8e16</span><span class="p">]</span>::<span class="n">traits</span>::<span class="n">error_reporting</span>::<span class="n">suggestions</span>::<span class="n">InferCtxtExt</span><span class="o">&gt;</span>::<span class="n">suggest_floating_point_literal</span><span class="w"></span>
<span class="mi">18</span>:     <span class="mh">0x7fb1f30678d3</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">rustc_infer</span><span class="p">[</span><span class="mi">51</span><span class="n">c380136aeb3624</span><span class="p">]</span>::<span class="n">infer</span>::<span class="n">InferCtxt</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">rustc_trait_selection</span><span class="p">[</span><span class="mi">5</span><span class="n">f3069b2459f8e16</span><span class="p">]</span>::<span class="n">traits</span>::<span class="n">error_reporting</span>::<span class="n">InferCtxtExt</span><span class="o">&gt;</span>::<span class="n">report_selection_error</span><span class="w"></span>
<span class="mi">19</span>:     <span class="mh">0x7fb1f306e99b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">rustc_infer</span><span class="p">[</span><span class="mi">51</span><span class="n">c380136aeb3624</span><span class="p">]</span>::<span class="n">infer</span>::<span class="n">InferCtxt</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">rustc_trait_selection</span><span class="p">[</span><span class="mi">5</span><span class="n">f3069b2459f8e16</span><span class="p">]</span>::<span class="n">traits</span>::<span class="n">error_reporting</span>::<span class="n">InferCtxtPrivExt</span><span class="o">&gt;</span>::<span class="n">report_fulfillment_error</span><span class="w"></span>
<span class="mi">20</span>:     <span class="mh">0x7fb1f3063fed</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">rustc_infer</span><span class="p">[</span><span class="mi">51</span><span class="n">c380136aeb3624</span><span class="p">]</span>::<span class="n">infer</span>::<span class="n">InferCtxt</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">rustc_trait_selection</span><span class="p">[</span><span class="mi">5</span><span class="n">f3069b2459f8e16</span><span class="p">]</span>::<span class="n">traits</span>::<span class="n">error_reporting</span>::<span class="n">InferCtxtExt</span><span class="o">&gt;</span>::<span class="n">report_fulfillment_errors</span><span class="w"></span>
<span class="mi">21</span>:     <span class="mh">0x7fb1f3631109</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">rustc_typeck</span><span class="p">[</span><span class="n">db10f2c3c7942d60</span><span class="p">]</span>::<span class="n">check</span>::<span class="n">fn_ctxt</span>::<span class="n">FnCtxt</span><span class="o">&gt;</span>::<span class="n">check_overloaded_binop</span><span class="w"></span>
<span class="mi">22</span>:     <span class="mh">0x7fb1f3630573</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">rustc_typeck</span><span class="p">[</span><span class="n">db10f2c3c7942d60</span><span class="p">]</span>::<span class="n">check</span>::<span class="n">fn_ctxt</span>::<span class="n">FnCtxt</span><span class="o">&gt;</span>::<span class="n">check_binop</span><span class="w"></span>
</code></pre></div>



<a name="275048498"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/275048498" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#275048498">(Mar 11 2022 at 23:27)</a>:</h4>
<p>Yeah, making it good to start with.</p>



<a name="275048505"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/275048505" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#275048505">(Mar 11 2022 at 23:27)</a>:</h4>
<p>Yeah I'm doing that one lmao</p>



<a name="275062292"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/275062292" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#275062292">(Mar 11 2022 at 23:33)</a>:</h4>
<p>It requires a redefinition of a lang item to happen but tbh I am not sure it isn't showing a more fundamental problem:<br>
<a href="https://github.com/rust-lang/rust/blob/335ffbfa547df94ac236f5c56130cecf99c8d82b/compiler/rustc_middle/src/ty/subst.rs#L362-L369">https://github.com/rust-lang/rust/blob/335ffbfa547df94ac236f5c56130cecf99c8d82b/compiler/rustc_middle/src/ty/subst.rs#L362-L369</a></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">    </span><span class="cp">#[inline]</span><span class="w"></span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">type_at</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">i</span>: <span class="kt">usize</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Ty</span><span class="o">&lt;'</span><span class="na">tcx</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="n">GenericArgKind</span>::<span class="n">Type</span><span class="p">(</span><span class="n">ty</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">unpack</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">ty</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">bug</span><span class="o">!</span><span class="p">(</span><span class="s">"expected type for param #{} in {:?}"</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="bp">self</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="275062371"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/275062371" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#275062371">(Mar 11 2022 at 23:34)</a>:</h4>
<p>Yeah, found that.</p>



<a name="275062395"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/275062395" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#275062395">(Mar 11 2022 at 23:34)</a>:</h4>
<p>I hate to ask, but genuinely: how do I fix this? I don't want to write some shitty half-arsed implementation that'll just get me laughed at lol</p>



<a name="275062466"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/275062466" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#275062466">(Mar 11 2022 at 23:35)</a>:</h4>
<p>Well, when we invoke <code>type_at</code>, we do so with a usize, and then we just index right into the array.</p>



<a name="275062513"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/275062513" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#275062513">(Mar 11 2022 at 23:36)</a>:</h4>
<p>Yup.</p>



<a name="275062537"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/275062537" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#275062537">(Mar 11 2022 at 23:36)</a>:</h4>
<p>So are you suggesting if len = 1 and index =1 make index 0?</p>



<a name="275062546"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/275062546" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#275062546">(Mar 11 2022 at 23:36)</a>:</h4>
<p>Nah.</p>



<a name="275062561"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/275062561" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#275062561">(Mar 11 2022 at 23:37)</a>:</h4>
<p>This has a failure condition already written for it, right? We're just managing to <strong>not</strong> hit the failure condition.</p>



<a name="275062568"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/275062568" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#275062568">(Mar 11 2022 at 23:37)</a>:</h4>
<p>Yeah it's in glacier</p>



<a name="275062574"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/275062574" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#275062574">(Mar 11 2022 at 23:37)</a>:</h4>
<p>Ah I mean the function.</p>



<a name="275062674"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/275062674" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#275062674">(Mar 11 2022 at 23:38)</a>:</h4>
<p>Oh</p>



<a name="275062700"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/275062700" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#275062700">(Mar 11 2022 at 23:38)</a>:</h4>
<p>I mean the function is really simple. I just have no idea what the correct implementation is to fix the ICE</p>



<a name="275062786"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/275062786" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#275062786">(Mar 11 2022 at 23:39)</a>:</h4>
<p>I think <code>bug!</code> actually does throw an ICE, if memory serves, if we hit it.<br>
The problem is we aren't hitting the right iCE, we're hitting a boring "index OoB" error, making it harder to diagnose.</p>



<a name="275062849"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/275062849" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#275062849">(Mar 11 2022 at 23:40)</a>:</h4>
<p>So this one is slightly meta.</p>



<a name="275062885"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/275062885" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#275062885">(Mar 11 2022 at 23:40)</a>:</h4>
<p>Yeah, that would make sense.</p>



<a name="275062900"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/275062900" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#275062900">(Mar 11 2022 at 23:41)</a>:</h4>
<p>So I presume where that function is being called (more specifically the parameter being passed) is the issue</p>



<a name="275062933"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/275062933" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#275062933">(Mar 11 2022 at 23:41)</a>:</h4>
<p>Yeah, probably.</p>



<a name="275063012"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/275063012" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#275063012">(Mar 11 2022 at 23:42)</a>:</h4>
<p>Let me take a look at where it is being called</p>



<a name="275063053"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/275063053" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#275063053">(Mar 11 2022 at 23:43)</a>:</h4>
<div class="codehilite"><pre><span></span><code>  21:     0x7f264fa614d9 - &lt;rustc_typeck[7ae584030a131cc9]::check::fn_ctxt::FnCtxt&gt;::check_overloaded_binop
</code></pre></div>
<p>I think that's it</p>



<a name="275063416"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/275063416" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#275063416">(Mar 11 2022 at 23:48)</a>:</h4>
<p>God I still don't understand these bloody backtraces</p>



<a name="275063572"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/275063572" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#275063572">(Mar 11 2022 at 23:50)</a>:</h4>
<p>I personally would try starting with</p>
<div class="codehilite" data-code-language="Diff"><pre><span></span><code><span class="w"> </span>   #[inline]<span class="w"></span>
<span class="w"> </span>   pub fn type_at(&amp;self, i: usize) -&gt; Ty&lt;'tcx&gt; {<span class="w"></span>
<span class="gd">-       if let GenericArgKind::Type(ty) = self[i].unpack() {</span><span class="w"></span>
<span class="gi">+       if let Some(GenericArgKind::Type(ty)) = self.get(i).map(|ty| ty.unpack()) {</span><span class="w"></span>
<span class="w"> </span>           ty<span class="w"></span>
<span class="w"> </span>       } else {<span class="w"></span>
<span class="w"> </span>           bug!("expected type for param #{} in {:?}", i, self);<span class="w"></span>
<span class="w"> </span>       }<span class="w"></span>
<span class="w"> </span>   }<span class="w"></span>
</code></pre></div>
<p>to push the indexing error back into the normal failure path and then run the compiler with that rebuilt function on the code in question.</p>



<a name="275063602"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/275063602" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#275063602">(Mar 11 2022 at 23:50)</a>:</h4>
<p>Oh yeah, that's pretty smart.</p>



<a name="275063650"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/275063650" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milo123459 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#275063650">(Mar 11 2022 at 23:51)</a>:</h4>
<p>Well, how should I run a test on this?<br>
I need to test the MCVE but how?</p>



<a name="275063753"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/275063753" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#275063753">(Mar 11 2022 at 23:52)</a>:</h4>
<p>You rebuild the compiler per <a href="https://rustc-dev-guide.rust-lang.org/getting-started.html">https://rustc-dev-guide.rust-lang.org/getting-started.html</a><br>
and then you invoke <code>${dev_rustc} mcve.rs</code></p>



<a name="275063891"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/275063891" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#275063891">(Mar 11 2022 at 23:54)</a>:</h4>
<p>with <code>${dev_rustc}</code> probably being the direct path to the local compiler you just built.</p>



<a name="275064660"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Getting%20into%20solving%20ICEs/near/275064660" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Getting.20into.20solving.20ICEs.html#275064660">(Mar 12 2022 at 00:05)</a>:</h4>
<p>I should note that I don't necessarily expect this to make it no longer ICE, I just think it should be driven back onto the normal error path.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>