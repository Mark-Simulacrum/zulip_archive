<html>
<head><meta charset="utf-8"><title>register attr or read AST attr · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/register.20attr.20or.20read.20AST.20attr.html">register attr or read AST attr</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="252871955"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/register%20attr%20or%20read%20AST%20attr/near/252871955" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/register.20attr.20or.20read.20AST.20attr.html#252871955">(Sep 11 2021 at 01:22)</a>:</h4>
<p>Is there a way to either:</p>
<ul>
<li>See if an <code>Instance</code> contains an attr that has been expanded away because it is a proc macro? if i use <code>tcx.get_attrs(def)</code> the attr isnt there because it was expanded, and i dont think i can go back to the raw ast node.</li>
<li>Register an internal attribute without forcing the user to use register_attr, because it is a bit clunky and kind of a hack.</li>
</ul>



<a name="252923371"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/register%20attr%20or%20read%20AST%20attr/near/252923371" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/register.20attr.20or.20read.20AST.20attr.html#252923371">(Sep 11 2021 at 17:23)</a>:</h4>
<ol>
<li>I don't think expanded attributes persist in any form.</li>
<li>No, register_attr was introduced specifically for this purpose. It has the advantage over letting custom drivers register attributes in that the custom attributes don't cause an error when you don't run your tool.</li>
</ol>



<a name="252924295"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/register%20attr%20or%20read%20AST%20attr/near/252924295" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/register.20attr.20or.20read.20AST.20attr.html#252924295">(Sep 11 2021 at 17:40)</a>:</h4>
<p><span class="user-mention" data-user-id="133247">@bjorn3</span> im just not sure why register_attr is required to be put in the user's crate even if it is only for internal usage, it just causes unneeded clunkyness IMO.</p>



<a name="252924414"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/register%20attr%20or%20read%20AST%20attr/near/252924414" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/register.20attr.20or.20read.20AST.20attr.html#252924414">(Sep 11 2021 at 17:43)</a>:</h4>
<p>Yeah, it did be nice if it could also be put in a dependent crate, but IMHO in that case it should be namespaced to said crate.</p>



<a name="252924526"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/register%20attr%20or%20read%20AST%20attr/near/252924526" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/register.20attr.20or.20read.20AST.20attr.html#252924526">(Sep 11 2021 at 17:45)</a>:</h4>
<p>Yeah, i have a <code>#[kernel]</code> attr that does actual things as a proc macro, but i need to keep an attribute that the codegen can see</p>



<a name="252924626"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/register%20attr%20or%20read%20AST%20attr/near/252924626" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/register.20attr.20or.20read.20AST.20attr.html#252924626">(Sep 11 2021 at 17:46)</a>:</h4>
<p>So for now, users would need to add cfg'd attrs to the top level manually to register an <code>nvvm_internal</code> attr, but i think its very clunky and ugly for something that should be handled by rustc or another crate</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>