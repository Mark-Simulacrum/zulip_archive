<html>
<head><meta charset="utf-8"><title>Not respecting noinline causing infinite loop · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Not.20respecting.20noinline.20causing.20infinite.20loop.html">Not respecting noinline causing infinite loop</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="272759705"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Not%20respecting%20noinline%20causing%20infinite%20loop/near/272759705" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Not.20respecting.20noinline.20causing.20infinite.20loop.html#272759705">(Feb 22 2022 at 04:35)</a>:</h4>
<p>Kind of a long story, but i recently found an insanely specific bug in CUDA that causes a segfault only with very specific control flow which is created by panic machinery. I thought i could maybe temp-fix this by not respecting <code>InlineAttr::Never</code>, however that seems to cause compilation to just loop forever (or it takes so absurdly long that its funny). Is there a potential reason for this? Does not respecting inline(never) make rustc sad?</p>



<a name="272761969"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Not%20respecting%20noinline%20causing%20infinite%20loop/near/272761969" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Not.20respecting.20noinline.20causing.20infinite.20loop.html#272761969">(Feb 22 2022 at 05:28)</a>:</h4>
<p>Oh it finished eventually... in 16 minutes on an i9 10850k, and it made a 56mb ptx file... huh</p>



<a name="272761999"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Not%20respecting%20noinline%20causing%20infinite%20loop/near/272761999" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Not.20respecting.20noinline.20causing.20infinite.20loop.html#272761999">(Feb 22 2022 at 05:29)</a>:</h4>
<p>Not respecting inline(never) would posibly inline the entire panic machinery into every panic call site.</p>



<a name="272762040"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Not%20respecting%20noinline%20causing%20infinite%20loop/near/272762040" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Not.20respecting.20noinline.20causing.20infinite.20loop.html#272762040">(Feb 22 2022 at 05:30)</a>:</h4>
<p>yeah thats what im thinking</p>



<a name="272762045"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Not%20respecting%20noinline%20causing%20infinite%20loop/near/272762045" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Not.20respecting.20noinline.20causing.20infinite.20loop.html#272762045">(Feb 22 2022 at 05:30)</a>:</h4>
<p>i think its also runaway inlining</p>



<a name="272762049"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Not%20respecting%20noinline%20causing%20infinite%20loop/near/272762049" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Not.20respecting.20noinline.20causing.20infinite.20loop.html#272762049">(Feb 22 2022 at 05:30)</a>:</h4>
<p>im using a very old version of LLVM so that seems likely</p>



<a name="272762426"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Not%20respecting%20noinline%20causing%20infinite%20loop/near/272762426" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Not.20respecting.20noinline.20causing.20infinite.20loop.html#272762426">(Feb 22 2022 at 05:40)</a>:</h4>
<p><span class="user-mention silent" data-user-id="276242">Riccardo D'Ambrosio</span> <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/Not.20respecting.20noinline.20causing.20infinite.20loop/near/272762049">said</a>:</p>
<blockquote>
<p>im using a very old version of LLVM so that seems likely</p>
</blockquote>
<p>how old is very old</p>



<a name="272762437"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Not%20respecting%20noinline%20causing%20infinite%20loop/near/272762437" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Not.20respecting.20noinline.20causing.20infinite.20loop.html#272762437">(Feb 22 2022 at 05:40)</a>:</h4>
<p>LLVM 7 :pain:</p>



<a name="272762473"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Not%20respecting%20noinline%20causing%20infinite%20loop/near/272762473" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Not.20respecting.20noinline.20causing.20infinite.20loop.html#272762473">(Feb 22 2022 at 05:41)</a>:</h4>
<p>...uh.</p>



<a name="272762477"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Not%20respecting%20noinline%20causing%20infinite%20loop/near/272762477" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Not.20respecting.20noinline.20causing.20infinite.20loop.html#272762477">(Feb 22 2022 at 05:41)</a>:</h4>
<p>...We don't support that one.</p>



<a name="272762479"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Not%20respecting%20noinline%20causing%20infinite%20loop/near/272762479" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Not.20respecting.20noinline.20causing.20infinite.20loop.html#272762479">(Feb 22 2022 at 05:41)</a>:</h4>
<p>yeahhhhh... blame cuda</p>



<a name="272762529"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Not%20respecting%20noinline%20causing%20infinite%20loop/near/272762529" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Not.20respecting.20noinline.20causing.20infinite.20loop.html#272762529">(Feb 22 2022 at 05:42)</a>:</h4>
<p>You are going to have a slight problem if your backend depends on versions of LLVM we don't support.</p>



<a name="272762533"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Not%20respecting%20noinline%20causing%20infinite%20loop/near/272762533" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Not.20respecting.20noinline.20causing.20infinite.20loop.html#272762533">(Feb 22 2022 at 05:42)</a>:</h4>
<p>It has worked so far<span aria-label="tm" class="emoji emoji-2122" role="img" title="tm">:tm:</span></p>



<a name="272762548"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Not%20respecting%20noinline%20causing%20infinite%20loop/near/272762548" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Not.20respecting.20noinline.20causing.20infinite.20loop.html#272762548">(Feb 22 2022 at 05:43)</a>:</h4>
<p>i will eventually switch to modern llvm if the LLVM PTX backend works, but its a bit of work</p>



<a name="272762609"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Not%20respecting%20noinline%20causing%20infinite%20loop/near/272762609" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Not.20respecting.20noinline.20causing.20infinite.20loop.html#272762609">(Feb 22 2022 at 05:44)</a>:</h4>
<p>speaking of, i should probably see if there is a way to directly hook into rustc's LLVM</p>



<a name="272762627"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Not%20respecting%20noinline%20causing%20infinite%20loop/near/272762627" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Not.20respecting.20noinline.20causing.20infinite.20loop.html#272762627">(Feb 22 2022 at 05:45)</a>:</h4>
<p>if not i can probably just <del>steal</del> borrow it from <code>download-ci-llvm</code></p>



<a name="272762724"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Not%20respecting%20noinline%20causing%20infinite%20loop/near/272762724" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Not.20respecting.20noinline.20causing.20infinite.20loop.html#272762724">(Feb 22 2022 at 05:47)</a>:</h4>
<p>But then i don't get rustc's LLVM shim which is kind of the point of this</p>



<a name="272766197"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Not%20respecting%20noinline%20causing%20infinite%20loop/near/272766197" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Not.20respecting.20noinline.20causing.20infinite.20loop.html#272766197">(Feb 22 2022 at 06:53)</a>:</h4>
<p><span class="user-mention silent" data-user-id="276242">Riccardo D'Ambrosio</span> <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/Not.20respecting.20noinline.20causing.20infinite.20loop/near/272762533">said</a>:</p>
<blockquote>
<p>It has worked so far™</p>
</blockquote>
<p>Note that, for example, &lt;<a href="https://llvm.org/docs/OpaquePointers.html">https://llvm.org/docs/OpaquePointers.html</a>&gt; is coming soon™ which will be a major change that will probably pervasively break compat with old LLVM, in a few releases.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>