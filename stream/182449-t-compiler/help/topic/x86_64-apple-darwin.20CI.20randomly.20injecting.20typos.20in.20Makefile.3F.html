<html>
<head><meta charset="utf-8"><title>x86_64-apple-darwin CI randomly injecting typos in Makefile? Â· t-compiler/help Â· Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html">x86_64-apple-darwin CI randomly injecting typos in Makefile?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://rust-lang.github.io/zulip_archive/style.css" rel="stylesheet"></head>

<a name="218714581"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218714581" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218714581">(Dec 03 2020 at 16:03)</a>:</h4>
<p>In the final stages of bors CI build (all other platforms completed successfully), PR <a href="https://github.com/rust-lang/rust/issues/79109">#79109</a> failed on apple with:</p>
<div class="codehilite"><pre><span></span><code>DYLD_LIBRARY_PATH=&quot;/Users/runner/work/rust/rust/build/x86_64-apple-darwin/test/run-make-fulldeps/coverage-reports/coverage-reports:/Users/runner/work/rust/rust/build/x86_64-apple-darwin/stage2/lib:&quot; &#39;/Users/runner/work/rust/rust/build/x86_64-apple-darwin/stage2/bin/rustc&#39; --out-dir /Users/runner/work/rust/rust/build/x86_64-apple-darwin/test/run-make-fulldeps/coverage-reports/coverage-reports -L /Users/runner/work/rust/rust/build/x86_64-apple-darwin/test/run-make-fulldeps/coverage-reports/coverage-reports  ../coverage/lib/used_crate.rs \
            $( grep -q &#39;^\/\/ require-rust-edition-2018&#39; ../coverage/lib/used_crate.rs &amp;&amp; echo &quot;--edition=2018&quot; ) \
            --crate-type rlib \
            -Zinstrament-coverage

------------------------------------------
stderr:
------------------------------------------
error: unknown debugging option: `instrament-coverage`

make: *** [used_crate] Error 1
</code></pre></div>
<p>The rustc error is correct. There is no <code>instrament-coverage</code> (instr_a_ment?) debugging option.</p>
<p>But that word, "instrament", is not in my commit or anywhere in the codebase, AFAICT. And if it was really there, none of the other platforms would have succeeded.</p>
<p>Has this kind of issue occurred before?</p>
<p>(Kind of coincidental that a random bit error happened on the actual option this PR is testing.)</p>



<a name="218739582"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218739582" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218739582">(Dec 03 2020 at 19:04)</a>:</h4>
<p>After a @bors retry, I got the same error! What is happening?</p>



<a name="218739669"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218739669" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218739669">(Dec 03 2020 at 19:05)</a>:</h4>
<p><span class="user-mention" data-user-id="116122">@simulacrum</span> - Sorry, not sure who else to reach out to. Have you seen this kind of issue. Is there anyone else I should ask about it?</p>



<a name="218739722"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218739722" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218739722">(Dec 03 2020 at 19:05)</a>:</h4>
<p>I guess I can push a mod to that Makefile that moves commands around, to hopefully force some sort of refresh?</p>



<a name="218739798"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218739798" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218739798">(Dec 03 2020 at 19:06)</a>:</h4>
<p>hm</p>



<a name="218739813"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218739813" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218739813">(Dec 03 2020 at 19:06)</a>:</h4>
<p>I failed to look at that PR because it's so big</p>



<a name="218739833"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218739833" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218739833">(Dec 03 2020 at 19:06)</a>:</h4>
<p>I guess I can look at that test in individual</p>



<a name="218739878"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218739878" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218739878">(Dec 03 2020 at 19:06)</a>:</h4>
<p>I know <span aria-label="oh no" class="emoji emoji-1f615" role="img" title="oh no">:oh_no:</span></p>



<a name="218739974"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218739974" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218739974">(Dec 03 2020 at 19:08)</a>:</h4>
<p>have you checked some other builders to verify the test is running there?</p>



<a name="218740060"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218740060" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218740060">(Dec 03 2020 at 19:08)</a>:</h4>
<p>I know it does, but I'll open them up and verify the typo doesn't exist there.</p>



<a name="218740098"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218740098" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218740098">(Dec 03 2020 at 19:08)</a>:</h4>
<p>seems to (2020-12-03T17:33:41.1981678Z test [run-make] run-make-fulldeps/coverage-reports ... [32mok(B[m)</p>



<a name="218740189"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218740189" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218740189">(Dec 03 2020 at 19:09)</a>:</h4>
<p>(from x86_64-gnu)</p>



<a name="218740772"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218740772" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218740772">(Dec 03 2020 at 19:14)</a>:</h4>
<p>yeah, found it in msvc as well:<br>
test [run-make] run-make-fulldeps\coverage-reports ... ok<br>
<a href="https://github.com/rust-lang-ci/rust/runs/1493975407">https://github.com/rust-lang-ci/rust/runs/1493975407</a></p>



<a name="218740821"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218740821" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218740821">(Dec 03 2020 at 19:14)</a>:</h4>
<p>(It's my test and I just debugged an issue with MSVC last night. Working now.)</p>



<a name="218740906"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218740906" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218740906">(Dec 03 2020 at 19:15)</a>:</h4>
<p>It would fail if the flag was <code>-Zinstrament-coverage</code> (with "typo")</p>



<a name="218741094"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218741094" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218741094">(Dec 03 2020 at 19:16)</a>:</h4>
<p>seems like a git download or patching error when the Mac infra merges my commit?</p>



<a name="218741513"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218741513" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218741513">(Dec 03 2020 at 19:19)</a>:</h4>
<p>that would be ... crazy</p>



<a name="218741574"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218741574" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218741574">(Dec 03 2020 at 19:20)</a>:</h4>
<p>I checked already and it's more than one bit</p>



<a name="218741607"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218741607" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218741607">(Dec 03 2020 at 19:20)</a>:</h4>
<p>crazy ... agreed!</p>



<a name="218741612"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218741612" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218741612">(Dec 03 2020 at 19:20)</a>:</h4>
<p>(at first I was like "maybe I've finally encountered a bit flip!)</p>



<a name="218741658"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218741658" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218741658">(Dec 03 2020 at 19:20)</a>:</h4>
<p>I've never seen one in my career either</p>



<a name="218741679"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218741679" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218741679">(Dec 03 2020 at 19:21)</a>:</h4>
<p>I checked on a local checkout and I'm not seeing any instraments, including on macOS</p>



<a name="218741704"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218741704" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218741704">(Dec 03 2020 at 19:21)</a>:</h4>
<p>trying to run the test on macOS now</p>



<a name="218741829"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218741829" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218741829">(Dec 03 2020 at 19:22)</a>:</h4>
<p>I don't know how to do that in less than a couple of hours (to build enough to run the test)</p>



<a name="218742003"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218742003" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218742003">(Dec 03 2020 at 19:23)</a>:</h4>
<p>question, when you said, "more than one bit", you mean the 'a' character? Or did you see other changes in the output that don't match the file?</p>



<a name="218742136"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218742136" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218742136">(Dec 03 2020 at 19:24)</a>:</h4>
<p>I'm guessing you mean ascii u -&gt; a is more than one bit diff</p>



<a name="218742254"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218742254" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218742254">(Dec 03 2020 at 19:25)</a>:</h4>
<p>yeah that's what I meant</p>



<a name="218742349"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218742349" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218742349">(Dec 03 2020 at 19:26)</a>:</h4>
<p>hm I can usually pull off a build on my mac in roughly 30-40 minutes from a clean slate</p>



<a name="218742613"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218742613" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218742613">(Dec 03 2020 at 19:28)</a>:</h4>
<p>Maybe it's different config options. I may not have the most optimal config.toml settings for mac. But the build command I'm using is: <code>./x.py test src/test/run-make-fulldeps/coverage</code> ... Anything I should do differently?</p>



<a name="218742632"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218742632" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218742632">(Dec 03 2020 at 19:28)</a>:</h4>
<p>Stupid thought but since we're testing the _merge_ of the branch into <code>master</code>, perhaps there was a mention of <code>instrament</code> in a different PR which has since merged into <code>master</code>?</p>



<a name="218742773"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218742773" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218742773">(Dec 03 2020 at 19:29)</a>:</h4>
<p>It's hard to imagine anyone else changing that in this test. Plus, my commit didn't just apply a change within that line. (not out of the realm of possibility for a diff/patch, but unlikely)</p>



<a name="218742796"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218742796" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218742796">(Dec 03 2020 at 19:29)</a>:</h4>
<p>I can check the merge commit but it passed on linux</p>



<a name="218742828"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218742828" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218742828">(Dec 03 2020 at 19:30)</a>:</h4>
<p>right, that too</p>



<a name="218742867"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218742867" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218742867">(Dec 03 2020 at 19:30)</a>:</h4>
<p>Ah yeah</p>



<a name="218742897"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218742897" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218742897">(Dec 03 2020 at 19:30)</a>:</h4>
<p>I suppose it could be something that is only enabled on mac but that seems exceedingly unlikely</p>



<a name="218743036"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218743036" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218743036">(Dec 03 2020 at 19:31)</a>:</h4>
<p>confirmed that instrament is not a string (git grep) on the merge commit</p>



<a name="218743040"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218743040" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218743040">(Dec 03 2020 at 19:31)</a>:</h4>
<p>I'm guessing a memory bug in some utility that overwrites the wrong byte somewhere. (They shoulda used Rust!)</p>



<a name="218743270"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218743270" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218743270">(Dec 03 2020 at 19:33)</a>:</h4>
<p>My LLVM build is 1/2 done :)</p>



<a name="218743712"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218743712" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218743712">(Dec 03 2020 at 19:37)</a>:</h4>
<p>I can reproduce this locally myself.</p>



<a name="218743804"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218743804" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218743804">(Dec 03 2020 at 19:38)</a>:</h4>
<p>I was playing around, and I made a minimal Makefile that reproduces it.  My best guess is that it is a bug in GNU make 3.81.  Newer versions of make don't seem to be affected.</p>



<a name="218743922"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218743922" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218743922">(Dec 03 2020 at 19:39)</a>:</h4>
<p>wow. thanks!</p>



<a name="218743955"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218743955" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218743955">(Dec 03 2020 at 19:39)</a>:</h4>
<p>Rearranging the recipe a little (removing some of the backslashes) makes it go away.  So that is an option, or installing gmake from homebrew is another option.</p>



<a name="218743965"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218743965" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218743965">(Dec 03 2020 at 19:39)</a>:</h4>
<p>It's really strange, though!</p>



<a name="218743974"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218743974" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218743974">(Dec 03 2020 at 19:40)</a>:</h4>
<p>Is there any way we can update make in Mac CI</p>



<a name="218744063"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218744063" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218744063">(Dec 03 2020 at 19:40)</a>:</h4>
<p>hm I wouldn't</p>



<a name="218744065"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218744065" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218744065">(Dec 03 2020 at 19:40)</a>:</h4>
<p>Yea, <code>brew install make</code> and then using <code>gmake</code> (homebrew avoids replacing the system make by default)</p>



<a name="218744073"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218744073" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218744073">(Dec 03 2020 at 19:40)</a>:</h4>
<p>since it'll affect local contributors too</p>



<a name="218744083"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218744083" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218744083">(Dec 03 2020 at 19:40)</a>:</h4>
<p>Yea, ^^</p>



<a name="218744104"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218744104" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218744104">(Dec 03 2020 at 19:41)</a>:</h4>
<p><span class="user-mention" data-user-id="120518">@Eric Huss</span> could you share the simple make file?</p>



<a name="218744272"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218744272" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218744272">(Dec 03 2020 at 19:42)</a>:</h4>
<div class="codehilite"><pre><span></span><code>SOURCEDIR=coverage

all: used_crate

%: $(SOURCEDIR)/lib/%.rs
    # Compile the test library with coverage instrumentation
    $(RUSTC) $(SOURCEDIR)/lib/$@.rs \
            $$( grep -q &#39;^\/\/ require-rust-edition-2018&#39; $(SOURCEDIR)/lib/$@.rs &amp;&amp; \
                echo &quot;--edition=2018&quot; \
            ) \
            --crate-type rlib \
            -Zinstrument-coverage
</code></pre></div>



<a name="218744299"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218744299" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218744299">(Dec 03 2020 at 19:42)</a>:</h4>
<p>Put that in a Makefile</p>



<a name="218744332"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218744332" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218744332">(Dec 03 2020 at 19:42)</a>:</h4>
<p><code>mkdir -p coverage/lib &amp;&amp; touch coverage/lib/used_crate.rs</code></p>



<a name="218744355"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218744355" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218744355">(Dec 03 2020 at 19:42)</a>:</h4>
<p>run <code>make -p</code> to see how it gets expanded</p>



<a name="218744568"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218744568" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218744568">(Dec 03 2020 at 19:44)</a>:</h4>
<p>Small adjustments in the syntax will affect it.  For example, swapping the last two lines results in <code>--rlate-type rlib</code></p>



<a name="218744599"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218744599" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218744599">(Dec 03 2020 at 19:44)</a>:</h4>
<p>hm still trying to get a repro locally on 3.81</p>



<a name="218744704"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218744704" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218744704">(Dec 03 2020 at 19:45)</a>:</h4>
<div class="codehilite"><pre><span></span><code>GNU Make 3.81
Copyright (C) 2006  Free Software Foundation, Inc.
This is free software; see the source for copying conditions.
There is NO warranty; not even for MERCHANTABILITY or FITNESS FOR A
PARTICULAR PURPOSE.

This program built for i386-apple-darwin11.3.0
</code></pre></div>



<a name="218744708"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218744708" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218744708">(Dec 03 2020 at 19:45)</a>:</h4>
<p>It's not failing for me with:</p>
<div class="codehilite"><pre><span></span><code>$ make -v
GNU Make 3.81
Copyright (C) 2006  Free Software Foundation, Inc.
This is free software; see the source for copying conditions.
There is NO warranty; not even for MERCHANTABILITY or FITNESS FOR A
PARTICULAR PURPOSE.
</code></pre></div>
<p>I only see -Zinstrument-coverage</p>



<a name="218744798"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218744798" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218744798">(Dec 03 2020 at 19:46)</a>:</h4>
<p>Which xcode do you have?</p>



<a name="218744855"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218744855" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218744855">(Dec 03 2020 at 19:46)</a>:</h4>
<p>11.4.1, 11E503a</p>



<a name="218744912"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218744912" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218744912">(Dec 03 2020 at 19:47)</a>:</h4>
<div class="codehilite"><pre><span></span><code>$ md5sum `which make`
5dbcb5abac57e46752e5380f5190ae2c  /usr/bin/make
</code></pre></div>



<a name="218744984"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218744984" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218744984">(Dec 03 2020 at 19:47)</a>:</h4>
<div class="codehilite"><pre><span></span><code>$ xcodebuild -version
Xcode 11.6
Build version 11E708
</code></pre></div>



<a name="218744985"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218744985" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218744985">(Dec 03 2020 at 19:47)</a>:</h4>
<p>I am using a more recent bash, though, 5.0.16 from homebrew</p>



<a name="218745003"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218745003" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218745003">(Dec 03 2020 at 19:47)</a>:</h4>
<p><code>/usr/bin/make</code> is a wrapper that uses <code>xcode-select</code> to use the "current" xcode version.</p>



<a name="218745101"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218745101" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218745101">(Dec 03 2020 at 19:48)</a>:</h4>
<p>I have xcode 12.  I'm trying to see if I have 11 anywhere.</p>



<a name="218745120"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218745120" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218745120">(Dec 03 2020 at 19:48)</a>:</h4>
<p>pretty sure CI is on 12 these days</p>



<a name="218745334"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218745334" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218745334">(Dec 03 2020 at 19:50)</a>:</h4>
<p>reminds me of <a href="https://github.com/rust-lang/rust/issues/78665#issuecomment-727250640">https://github.com/rust-lang/rust/issues/78665#issuecomment-727250640</a> where xcode 12 introduced the <code>pretty-std-collections</code> error</p>



<a name="218745340"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218745340" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218745340">(Dec 03 2020 at 19:50)</a>:</h4>
<p>Well, if this is the only place this is happening, I'll make some tweaks (removing backslashes as Eric suggests); and now we know this <em>has</em> happened, so we can watch for it in the future.</p>



<a name="218745611"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218745611" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218745611">(Dec 03 2020 at 19:53)</a>:</h4>
<p>honestly seems like it could be the "same" bug or so</p>



<a name="218746201"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218746201" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218746201">(Dec 03 2020 at 19:57)</a>:</h4>
<p>Hm, I tried xcode 11.7 on GitHub Actions, and it still corrupted it: <a href="https://github.com/ehuss/test/runs/1494932036?check_suite_focus=true">https://github.com/ehuss/test/runs/1494932036?check_suite_focus=true</a>   Notice at the top it says <code>--rlate-type rlib</code></p>



<a name="218746332"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218746332" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218746332">(Dec 03 2020 at 19:58)</a>:</h4>
<p>ick</p>



<a name="218746382"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218746382" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218746382">(Dec 03 2020 at 19:58)</a>:</h4>
<p>i'm concerned this will be trial and error</p>



<a name="218746444"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218746444" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218746444">(Dec 03 2020 at 19:59)</a>:</h4>
<p>I mean, we can just stop using makefiles perhaps?</p>



<a name="218746459"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218746459" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218746459">(Dec 03 2020 at 19:59)</a>:</h4>
<p>i.e., shell out to a shell script</p>



<a name="218746912"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218746912" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218746912">(Dec 03 2020 at 20:02)</a>:</h4>
<p>Eric - would you mind trying this?</p>
<div class="codehilite"><pre><span></span><code>%: $(SOURCEDIR)/lib/%.rs
    # Compile the test library with coverage instrumentation
    $(RUSTC) $(SOURCEDIR)/lib/$@.rs \
            $$( grep -q &#39;^\/\/ require-rust-edition-2018&#39; $(SOURCEDIR)/lib/$@.rs &amp;&amp; echo &quot;--edition=2018&quot; ) \
            --crate-type rlib -Zinstrument-coverage

%: $(SOURCEDIR)/%.rs
    # Compile the test program with coverage instrumentation
    $(RUSTC) $(SOURCEDIR)/$@.rs \
            $$( grep -q &#39;^\/\/ require-rust-edition-2018&#39; $(SOURCEDIR)/$@.rs &amp;&amp; echo &quot;--edition=2018&quot; ) \
            -L &quot;$(TMPDIR)&quot; -Zinstrument-coverage
</code></pre></div>



<a name="218747283"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218747283" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218747283">(Dec 03 2020 at 20:05)</a>:</h4>
<p>Yea, that looks like it should work.  Putting the <code>grep</code> on one line seems to help.</p>



<a name="218747305"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218747305" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218747305">(Dec 03 2020 at 20:05)</a>:</h4>
<p>Thank you! Retrying on bors</p>



<a name="218747306"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218747306" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218747306">(Dec 03 2020 at 20:05)</a>:</h4>
<p>It would be nice to know exactly what the bug is, so there would be some confidence we are avoiding it.</p>



<a name="218747377"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218747377" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218747377">(Dec 03 2020 at 20:06)</a>:</h4>
<p>Interestingly, GNU make 3.82 switched to GPL v3, so that's why they are stuck on 3.81</p>



<a name="218748105"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218748105" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218748105">(Dec 03 2020 at 20:12)</a>:</h4>
<p>of course <span aria-label="stuck out tongue wink" class="emoji emoji-1f61c" role="img" title="stuck out tongue wink">:stuck_out_tongue_wink:</span></p>



<a name="218748159"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218748159" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218748159">(Dec 03 2020 at 20:13)</a>:</h4>
<p>I googled for "xcode 12" "makefile" "bug" and variants, and don't see this mentioned</p>



<a name="218748256"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218748256" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218748256">(Dec 03 2020 at 20:14)</a>:</h4>
<p>Eric - since you can repro this easily, it might be good to file a bug report against XCode (?)</p>



<a name="218748296"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218748296" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218748296">(Dec 03 2020 at 20:14)</a>:</h4>
<p>(if you have the time)</p>



<a name="218748310"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218748310" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218748310">(Dec 03 2020 at 20:14)</a>:</h4>
<p>I'll upvote it!</p>



<a name="218749048"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/x86_64-apple-darwin%20CI%20randomly%20injecting%20typos%20in%20Makefile%3F/near/218749048" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/x86_64-apple-darwin.20CI.20randomly.20injecting.20typos.20in.20Makefile.3F.html#218749048">(Dec 03 2020 at 20:20)</a>:</h4>
<p>Thank you so much for helping me debug this!!</p>



<hr><p>Last updated: Aug 07 2021 at 22:04 UTC</p>
</html>