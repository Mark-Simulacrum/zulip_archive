<html>
<head><meta charset="utf-8"><title>Generating enum impls (PR 81642) · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Generating.20enum.20impls.20(PR.2081642).html">Generating enum impls (PR 81642)</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="252854405"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Generating%20enum%20impls%20%28PR%2081642%29/near/252854405" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Wagner-Hall <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Generating.20enum.20impls.20(PR.2081642).html#252854405">(Sep 10 2021 at 21:38)</a>:</h4>
<p>I'm working on <a href="https://github.com/rust-lang/rust/pull/81642">https://github.com/rust-lang/rust/pull/81642</a> which looks to implement a trait for all enums, and some feedback was to either implement this as an AST pass, or as part of HIR lowering - I agree that these are probably better places to do this, but I'm not sure which one makes more sense.</p>
<p>From reading around a bit, it looks like AST passes currently seem to be readonly, and not modify the structure itself, which pushes me towards lowering, but it seems like at lowering-time I'd be looking at much lower-level constructs (which is fine, but feels like it will be quite verbose)... Any thoughts? <span class="user-mention" data-user-id="133247">@bjorn3</span>?</p>



<a name="252854645"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Generating%20enum%20impls%20%28PR%2081642%29/near/252854645" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Generating.20enum.20impls.20(PR.2081642).html#252854645">(Sep 10 2021 at 21:41)</a>:</h4>
<p>Not sure what the best way would be. My expertise is more around the backend rather than the frontend.</p>



<a name="252858478"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Generating%20enum%20impls%20%28PR%2081642%29/near/252858478" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Generating.20enum.20impls.20(PR.2081642).html#252858478">(Sep 10 2021 at 22:20)</a>:</h4>
<p>You can mimic other magically implemented traits, e.g. Pointee, DiscriminantKind, Unsize, etc.</p>



<a name="252858595"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Generating%20enum%20impls%20%28PR%2081642%29/near/252858595" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Generating.20enum.20impls.20(PR.2081642).html#252858595">(Sep 10 2021 at 22:21)</a>:</h4>
<p>They are magically implemented in rustc_trait_selection/src/traits/select/candidate_assembly.rs</p>



<a name="252860229"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Generating%20enum%20impls%20%28PR%2081642%29/near/252860229" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Wagner-Hall <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Generating.20enum.20impls.20(PR.2081642).html#252860229">(Sep 10 2021 at 22:40)</a>:</h4>
<p>Ooh fabulous, I will do some reading - thanks!</p>



<a name="252899439"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Generating%20enum%20impls%20%28PR%2081642%29/near/252899439" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Wagner-Hall <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Generating.20enum.20impls.20(PR.2081642).html#252899439">(Sep 11 2021 at 10:23)</a>:</h4>
<p>I've successfully got the trait solver seeing that the trait is implemented for the correct types, but I'm struggling to see how an actual implementation gets put in place... I see <code>ImplSource</code>, some of the variants of which contain actual vtables/similar, but all of the uses of it I can see are just used to translate <code>Obligation</code>s into other <code>Obligation</code>s via indirections... Any pointers to where an <code>ImplSource</code> gets resolved into "Here is the actual code to invoke"?</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>