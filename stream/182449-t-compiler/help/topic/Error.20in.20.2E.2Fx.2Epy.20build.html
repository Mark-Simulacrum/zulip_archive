<html>
<head><meta charset="utf-8"><title>Error in ./x.py build · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Error.20in.20.2E.2Fx.2Epy.20build.html">Error in ./x.py build</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="251353686"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Error%20in%20./x.py%20build/near/251353686" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bram van den Heuvel <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Error.20in.20.2E.2Fx.2Epy.20build.html#251353686">(Aug 31 2021 at 09:09)</a>:</h4>
<p>When running <code>./x.py build</code> on master I get the following error:</p>
<div class="codehilite"><pre><span></span><code>Updating only changed submodules
Submodules updated in 0.04 seconds
    Finished dev [unoptimized + debuginfo] target(s) in 0.17s
warning: x.py has made several changes recently you may want to look at
help: consider looking at the changes in `src/bootstrap/CHANGELOG.md`
note: to silence this warning, add `changelog-seen = 2` at the top of `config.toml`
Building stage0 std artifacts (x86_64-unknown-linux-gnu -&gt; x86_64-unknown-linux-gnu)
    Finished release [optimized] target(s) in 0.15s
Copying stage0 std from stage0 (x86_64-unknown-linux-gnu -&gt; x86_64-unknown-linux-gnu / x86_64-unknown-linux-gnu)
Building stage0 compiler artifacts (x86_64-unknown-linux-gnu -&gt; x86_64-unknown-linux-gnu)
   Compiling rustc_llvm v0.0.0 (/home/bram/git/rust/compiler/rustc_llvm)
   Compiling rustc_attr v0.0.0 (/home/bram/git/rust/compiler/rustc_attr)
   Compiling rustc_parse v0.0.0 (/home/bram/git/rust/compiler/rustc_parse)
   Compiling rustc_ast_lowering v0.0.0 (/home/bram/git/rust/compiler/rustc_ast_lowering)
   Compiling rustc_middle v0.0.0 (/home/bram/git/rust/compiler/rustc_middle)
   Compiling rustc_ast_passes v0.0.0 (/home/bram/git/rust/compiler/rustc_ast_passes)
The following warnings were emitted during compilation:

warning: llvm-wrapper/PassWrapper.cpp: In function ‘void LLVMSelfProfileInitializeCallbacks(llvm::PassInstrumentationCallbacks&amp;, void*, LLVMRustSelfProfileBeforePassCallback, LLVMRustSelfProfileAfterPassCallback)’:
warning: llvm-wrapper/PassWrapper.cpp:679:7: error: ‘class llvm::PassInstrumentationCallbacks’ has no member named ‘registerBeforePassCallback’; did you mean ‘registerAfterPassCallback’?
warning:   679 |   PIC.registerBeforePassCallback([LlvmSelfProfiler, BeforePassCallback](
warning:       |       ^~~~~~~~~~~~~~~~~~~~~~~~~~
warning:       |       registerAfterPassCallback
warning: llvm-wrapper/PassWrapper.cpp: In function ‘void LLVMRustOptimizeWithNewPassManager(LLVMModuleRef, ...
LLVMRustSelfProfileBeforePassCallback, LLVMRustSelfProfileAfterPassCallback)::&lt;lambda(llvm::StringRef)&gt;]’
warning: llvm-wrapper/PassWrapper.cpp:692:43:   required from here
warning: /usr/include/llvm/ADT/FunctionExtras.h:195:16: error: no match for call to ‘(LLVMSelfProfileInitializeCallbacks(llvm::PassInstrumentationCallbacks&amp;, void*, LLVMRustSelfProfileBeforePassCallback, LLVMRustSelfProfileAfterPassCallback)::&lt;lambda(llvm::StringRef)&gt;) (llvm::StringRef, const llvm::PreservedAnalyses&amp;)’
warning:   195 |     return Func(std::forward&lt;ParamTs&gt;(Params)...);
warning:       |            ~~~~^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
warning: llvm-wrapper/PassWrapper.cpp:693:7: note: candidate: ‘LLVMSelfProfileInitializeCallbacks(llvm::PassInstrumentationCallbacks&amp;, void*, LLVMRustSelfProfileBeforePassCallback, LLVMRustSelfProfileAfterPassCallback)::&lt;lambda(llvm::StringRef)&gt;’
warning:   693 |       [LlvmSelfProfiler, AfterPassCallback](StringRef Pass) {
warning:       |       ^
warning: llvm-wrapper/PassWrapper.cpp:693:7: note:   candidate expects 1 argument, 2 provided

error: failed to run custom build command for `rustc_llvm v0.0.0 (/home/bram/git/rust/compiler/rustc_llvm)`

Caused by:
  process didn&#39;t exit successfully: `/home/bram/git/rust/build/x86_64-unknown-linux-gnu/stage0-rustc/release/build/rustc_llvm-c0888cab6cee53aa/build-script-build` (exit code: 1)
  --- stdout
  cargo:rerun-if-env-changed=RUST_CHECK
...
  cargo:warning=  195 |     return Func(std::forward&lt;ParamTs&gt;(Params)...);
  cargo:warning=      |            ~~~~^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
  cargo:warning=llvm-wrapper/PassWrapper.cpp:693:7: note: candidate: ‘LLVMSelfProfileInitializeCallbacks(llvm::PassInstrumentationCallbacks&amp;, void*, LLVMRustSelfProfileBeforePassCallback, LLVMRustSelfProfileAfterPassCallback)::&lt;lambda(llvm::StringRef)&gt;’
  cargo:warning=  693 |       [LlvmSelfProfiler, AfterPassCallback](StringRef Pass) {
  cargo:warning=      |       ^
  cargo:warning=llvm-wrapper/PassWrapper.cpp:693:7: note:   candidate expects 1 argument, 2 provided
  exit code: 1

  --- stderr


  error occurred: Command &quot;c++&quot; &quot;-O3&quot; &quot;-ffunction-sections&quot; &quot;-fdata-sections&quot; &quot;-fPIC&quot; &quot;-m64&quot; &quot;-ffunction-sections&quot; &quot;-fdata-sections&quot; &quot;-fPIC&quot; &quot;-m64&quot; &quot;-I/usr/include&quot; &quot;-std=c++14&quot; &quot;-fno-exceptions&quot; &quot;-D_GNU_SOURCE&quot; &quot;-D__STDC_CONSTANT_MACROS&quot; &quot;-D__STDC_FORMAT_MACROS&quot; &quot;-D__STDC_LIMIT_MACROS&quot; &quot;-DLLVM_COMPONENT_AARCH64&quot; &quot;-DLLVM_COMPONENT_AMDGPU&quot; &quot;-DLLVM_COMPONENT_ARM&quot; &quot;-DLLVM_COMPONENT_ASMPARSER&quot; &quot;-DLLVM_COMPONENT_AVR&quot; &quot;-DLLVM_COMPONENT_BITREADER&quot; &quot;-DLLVM_COMPONENT_BITWRITER&quot; &quot;-DLLVM_COMPONENT_COVERAGE&quot; &quot;-DLLVM_COMPONENT_HEXAGON&quot; &quot;-DLLVM_COMPONENT_INSTRUMENTATION&quot; &quot;-DLLVM_COMPONENT_IPO&quot; &quot;-DLLVM_COMPONENT_LINKER&quot; &quot;-DLLVM_COMPONENT_LTO&quot; &quot;-DLLVM_COMPONENT_MIPS&quot; &quot;-DLLVM_COMPONENT_MSP430&quot; &quot;-DLLVM_COMPONENT_NVPTX&quot; &quot;-DLLVM_COMPONENT_POWERPC&quot; &quot;-DLLVM_COMPONENT_RISCV&quot; &quot;-DLLVM_COMPONENT_SPARC&quot; &quot;-DLLVM_COMPONENT_SYSTEMZ&quot; &quot;-DLLVM_COMPONENT_WEBASSEMBLY&quot; &quot;-DLLVM_COMPONENT_X86&quot; &quot;-DNDEBUG&quot; &quot;-o&quot; &quot;/home/bram/git/rust/build/x86_64-unknown-linux-gnu/stage0-rustc/x86_64-unknown-linux-gnu/release/build/rustc_llvm-e7ac7d054fce0b79/out/llvm-wrapper/PassWrapper.o&quot; &quot;-c&quot; &quot;llvm-wrapper/PassWrapper.cpp&quot; with args &quot;c++&quot; did not execute successfully (status code exit code: 1).
</code></pre></div>
<p>I've build rustc successfully a few months ago still. Could this have to do with a recent LLVM version change? <a href="/user_uploads/4715/ZA-Q66cjxqq7Bxv5rE5vlX7L/output.txt">output.txt</a></p>



<a name="251354253"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Error%20in%20./x.py%20build/near/251354253" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Error.20in.20.2E.2Fx.2Epy.20build.html#251354253">(Aug 31 2021 at 09:14)</a>:</h4>
<p>Are you using the rust LLVM fork or the system installation? If the system installation which LLVM version are you using?</p>



<a name="251356912"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Error%20in%20./x.py%20build/near/251356912" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bram van den Heuvel <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Error.20in.20.2E.2Fx.2Epy.20build.html#251356912">(Aug 31 2021 at 09:37)</a>:</h4>
<p>That was of course it, thank you for pointing me in the right direction.</p>



<a name="257745481"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Error%20in%20./x.py%20build/near/257745481" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fab.alchemy <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Error.20in.20.2E.2Fx.2Epy.20build.html#257745481">(Oct 15 2021 at 18:43)</a>:</h4>
<p>Hi,<br>
I'm trying to compile an experimental OS (<a href="https://github.com/twizzler-operating-system/twizzler">https://github.com/twizzler-operating-system/twizzler</a>) and I'm having the same issue. I use clang v12, is it too recent or something?</p>
<div class="codehilite"><pre><span></span><code>warning: llvm-wrapper/PassWrapper.cpp:679:7: error: no member named &#39;registerBeforePassCallback&#39; in &#39;llvm::PassInstrumentationCallbacks&#39;
warning:   PIC.registerBeforePassCallback([LlvmSelfProfiler, BeforePassCallback](
warning:   ~~~ ^
</code></pre></div>



<a name="257772129"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Error%20in%20./x.py%20build/near/257772129" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Error.20in.20.2E.2Fx.2Epy.20build.html#257772129">(Oct 15 2021 at 22:05)</a>:</h4>
<p>the <code>#if LLVM_VERSION_GE(12, 0)</code> should have taken you to the other block</p>



<a name="257772322"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Error%20in%20./x.py%20build/near/257772322" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Error.20in.20.2E.2Fx.2Epy.20build.html#257772322">(Oct 15 2021 at 22:06)</a>:</h4>
<p>unless you're building an older rustc, before we even had LLVM 12 support -- your line numbers don't match the current file</p>



<a name="257773368"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Error%20in%20./x.py%20build/near/257773368" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fab.alchemy <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Error.20in.20.2E.2Fx.2Epy.20build.html#257773368">(Oct 15 2021 at 22:15)</a>:</h4>
<p>Thank you. Visibly, we are compiling LLVM 12 for our platform and using it to build <code>rustc</code>, which can't work because the Rust submodule does not contain the LLVM 12 support.</p>



<a name="257778234"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Error%20in%20./x.py%20build/near/257778234" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Error.20in.20.2E.2Fx.2Epy.20build.html#257778234">(Oct 15 2021 at 23:01)</a>:</h4>
<p>What version of Rust are you using?</p>



<a name="257778264"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Error%20in%20./x.py%20build/near/257778264" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Error.20in.20.2E.2Fx.2Epy.20build.html#257778264">(Oct 15 2021 at 23:02)</a>:</h4>
<p>support for LLVM 12 was added in <a href="https://github.com/rust-lang/rust/issues/81451">#81451</a> for Rust 1.52</p>



<a name="257779578"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Error%20in%20./x.py%20build/near/257779578" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fab.alchemy <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Error.20in.20.2E.2Fx.2Epy.20build.html#257779578">(Oct 15 2021 at 23:15)</a>:</h4>
<p>Yeah, the project is using 1.51 - which gets me wondering how people are able to build...<br>
The team is small so I might be the first trying this in a long time. I will try bumping the version. Thank you for your time!</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>