<html>
<head><meta charset="utf-8"><title>Target release channel for Clippy · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Target.20release.20channel.20for.20Clippy.html">Target release channel for Clippy</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="266566608"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Target%20release%20channel%20for%20Clippy/near/266566608" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> xFrednet <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Target.20release.20channel.20for.20Clippy.html#266566608">(Jan 01 2022 at 17:26)</a>:</h4>
<p>Is there a simple way to determine for what release channel Clippy or tools in general are being built during the compilation? I want to implement a functionality in Clippy that should only be available in the Nightly version. The targeted channel should ideally be usable with a <code>#[cfg()]</code> attribute.</p>
<p>I've looked into the <code>CARGO_*</code> environment values, but I believe that they are not set during the complication with <code>x.py</code> (I can be wrong on this one)</p>



<a name="266567577"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Target%20release%20channel%20for%20Clippy/near/266567577" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> xFrednet <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Target.20release.20channel.20for.20Clippy.html#266567577">(Jan 01 2022 at 17:52)</a>:</h4>
<p>I now found <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_feature/enum.UnstableFeatures.html"><code>UnstableFeatures</code></a> which seem to indicate what the build is currently targeting, but that information is sadly unavailable at compile time, from what I can tell</p>



<a name="266568379"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Target%20release%20channel%20for%20Clippy/near/266568379" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Target.20release.20channel.20for.20Clippy.html#266568379">(Jan 01 2022 at 18:12)</a>:</h4>
<p>I don't think that can be directly done. Can you say more about why you are trying to do that?</p>



<a name="266568549"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Target%20release%20channel%20for%20Clippy/near/266568549" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> xFrednet <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Target.20release.20channel.20for.20Clippy.html#266568549">(Jan 01 2022 at 18:17)</a>:</h4>
<p>In <a href="https://github.com/rust-lang/rust-clippy/issues/6623">clippy#6623</a> it was suggested to introduce new lints only in the nightly version of Clippy and then enable them afterwards to have less false positives on the stable version. Similar to how rustc uses features that users can opt in while the stable channel remains stable. I'm trying to implement this without adding a new feature (which would be a possibility) and little to no overhead.  I have a pretty good idea how I can implement this behavior if the target channel is known at the compile time.</p>



<a name="266568600"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Target%20release%20channel%20for%20Clippy/near/266568600" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> xFrednet <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Target.20release.20channel.20for.20Clippy.html#266568600">(Jan 01 2022 at 18:18)</a>:</h4>
<p>Now I'm looking a bit at the bootstrapping process to figure out if we can potentially enable/disable a feature based on the channel <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="266568675"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Target%20release%20channel%20for%20Clippy/near/266568675" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Target.20release.20channel.20for.20Clippy.html#266568675">(Jan 01 2022 at 18:20)</a>:</h4>
<p>The <code>CFG_RELEASE_CHANNEL</code> env var is set by the rust build system while compiling. <code>dev</code> and <code>nightly</code> should both result in enabling nightly features.</p>



<a name="266568968"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Target%20release%20channel%20for%20Clippy/near/266568968" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> xFrednet <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Target.20release.20channel.20for.20Clippy.html#266568968">(Jan 01 2022 at 18:28)</a>:</h4>
<p>Having an environment value during compilation should work, thank you for the hint! Now I've also found the corresponding code in src/bootstrap. I'll try to work with this. Thank you very much!</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>