<html>
<head><meta charset="utf-8"><title>Using GDB to Debug Rustc · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Using.20GDB.20to.20Debug.20Rustc.html">Using GDB to Debug Rustc</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="254304252"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Using%20GDB%20to%20Debug%20Rustc/near/254304252" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noble Mushtak (he/him) <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Using.20GDB.20to.20Debug.20Rustc.html#254304252">(Sep 22 2021 at 01:56)</a>:</h4>
<p>Hi, everyone. I saw in the dev guide that Rust has support for GDB (<a href="https://rustc-dev-guide.rust-lang.org/debugging-support-in-rustc.html">https://rustc-dev-guide.rust-lang.org/debugging-support-in-rustc.html</a>) so I try it out with the compiler. In order to debug the stage1 compiler, I ran <code>gdb build/x86_64-unknown-linux-gnu/stage1/bin/rustc</code> and then in GDB, I ran the following commands:</p>
<div class="codehilite"><pre><span></span><code>break compiler/rustc_borrowck/src/type_check/mod.rs:2610 # Line number I am trying to debug
run src/test/ui/borrowck/issue-88884-lifetime-does-not-live-long-enough.rs # Unit test I created
</code></pre></div>
<p>As expected, GDB hits the breakpoint and then shows me this:</p>
<div class="codehilite"><pre><span></span><code>Thread 2 &quot;rustc&quot; hit Breakpoint 1, rustc_borrowck::type_check::TypeChecker::prove_closure_bounds ()
    at compiler/rustc_borrowck/src/type_check/mod.rs:2610
2610            if let Some(ref closure_region_requirements) = tcx.mir_borrowck(def_id).closure_requirements
</code></pre></div>
<p>which is correct based on the line number I gave it. However, when I run <code>info local</code> or <code>info arg</code>, it just says "No locals" and "No arguments," which is definitely not true. Is there something I have to install in order to get GDB to figure out the current locals/arguments in the stack frame? The dev guide says Rust has its own fork of GDB, but I wasn't sure if I had to install that fork of GDB and right now, I am just using my normal GDB that I installed from apt (version/OS info: <code>GNU gdb (Ubuntu 9.2-0ubuntu1~20.04) 9.2</code>). Thank you for the help, this is my first time using GDB with Rust and I might be missing something very obvious so I appreciate any tips.</p>



<a name="254304808"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Using%20GDB%20to%20Debug%20Rustc/near/254304808" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Using.20GDB.20to.20Debug.20Rustc.html#254304808">(Sep 22 2021 at 02:03)</a>:</h4>
<p>That information about the gdb fork is a little out of date, that fork is not maintained anymore.  </p>
<p>It could be the locals are optimized away enough that there isn't enough information anymore.</p>



<a name="254305765"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Using%20GDB%20to%20Debug%20Rustc/near/254305765" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Using.20GDB.20to.20Debug.20Rustc.html#254305765">(Sep 22 2021 at 02:17)</a>:</h4>
<p>Which debuginfo-level did you build with?  If it was 1, you may want to try 2. (I'm not certain if that will help, but I think it will.)</p>



<a name="254308350"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Using%20GDB%20to%20Debug%20Rustc/near/254308350" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Using.20GDB.20to.20Debug.20Rustc.html#254308350">(Sep 22 2021 at 02:56)</a>:</h4>
<p>Yeah, debuginfo-level = 1 only has line numbers, not locals</p>



<a name="254308371"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Using%20GDB%20to%20Debug%20Rustc/near/254308371" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Using.20GDB.20to.20Debug.20Rustc.html#254308371">(Sep 22 2021 at 02:57)</a>:</h4>
<p>Level 2 takes like an extra 5-10 minutes to build for me (on top of a ~20 minute build)</p>



<a name="254617892"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Using%20GDB%20to%20Debug%20Rustc/near/254617892" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noble Mushtak (he/him) <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Using.20GDB.20to.20Debug.20Rustc.html#254617892">(Sep 23 2021 at 22:51)</a>:</h4>
<p>Unfortunately, using debuginfo-level=2 didn't work for me, it took up more than 50 GB of space before failing because I didn't have enough disk space. Is it usual for debuginfo-level=2 to take up this much disk space? If so, I can just debug locals using print statements and then use GDB to step through the program.</p>



<a name="254619181"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Using%20GDB%20to%20Debug%20Rustc/near/254619181" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Using.20GDB.20to.20Debug.20Rustc.html#254619181">(Sep 23 2021 at 23:03)</a>:</h4>
<p>Yeah, it's normal; the resources it uses in general are pretty awful</p>



<a name="254627109"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Using%20GDB%20to%20Debug%20Rustc/near/254627109" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Using.20GDB.20to.20Debug.20Rustc.html#254627109">(Sep 24 2021 at 00:30)</a>:</h4>
<p>Do you know about <code>RUSTC_LOG=...</code>? I always use (often pre-existing) logging code to debug rustc. You can read more <a href="https://rustc-dev-guide.rust-lang.org/compiler-debugging.html#getting-logging-output">here</a>.</p>



<a name="254661875"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Using%20GDB%20to%20Debug%20Rustc/near/254661875" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Beránek <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Using.20GDB.20to.20Debug.20Rustc.html#254661875">(Sep 24 2021 at 07:18)</a>:</h4>
<p>It takes about ~100 GiB to compile <code>rustc</code> with <code>debuginfo-level=2</code> on my machine. It's then possible to step through it quite well, although the code is still compiled with optimizations, so a lot of variables are optimized out. Even though I'm a big fan of interactive debugging, because of the high disk usage, slow recompile times and compiled-out variables I usually end up just using logging.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>