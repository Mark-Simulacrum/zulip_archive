<html>
<head><meta charset="utf-8"><title>What does check_bound_universal_region do? · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/What.20does.20check_bound_universal_region.20do.3F.html">What does check_bound_universal_region do?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="251153416"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/What%20does%20check_bound_universal_region%20do%3F/near/251153416" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noble Mushtak (he/him) <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/What.20does.20check_bound_universal_region.20do.3F.html#251153416">(Aug 29 2021 at 19:41)</a>:</h4>
<p>Hello, everyone. I am someone who is trying to contribute to Rust and I decided to start seriously looking into an issue today just to get familiar with some of the code. I chose issue 88434 (<a href="https://github.com/rust-lang/rust/issues/88434">https://github.com/rust-lang/rust/issues/88434</a>) and after some debugging, I found the ICE occurs while trying to report some error that happened during region inference. The following came up in the logs:</p>
<div class="codehilite"><pre><span></span><code>DEBUG rustc_mir::borrow_check::region_infer check_universal_region(fr=&#39;_#0r)
DEBUG rustc_mir::borrow_check::region_infer check_universal_region(fr=&#39;_#1r)
DEBUG rustc_mir::borrow_check::region_infer check_bound_universal_region(fr=&#39;_#30r, placeholder=Placeholder { universe: U1, name: BrAnon(0) })
DEBUG rustc_mir::borrow_check::region_infer check_bound_universal_region: longer_fr_scc=ConstraintSccIndex(14)
DEBUG rustc_mir::borrow_check::region_infer check_bound_universal_region: error_element = Location(bb0[1])
DEBUG rustc_mir::borrow_check::region_infer check_bound_universal_region(fr=&#39;_#33r, placeholder=Placeholder { universe: U2, name: BrAnon(0) })
DEBUG rustc_mir::borrow_check::region_infer check_bound_universal_region: longer_fr_scc=ConstraintSccIndex(15)
DEBUG rustc_mir::borrow_check::region_infer check_bound_universal_region: error_element = Location(bb0[1])
</code></pre></div>
<p>Here, check_bound_universal_region generates a BoundUniversalRegionError saying that the region '#_30r does not outlive the error_element=Location(bb0[1]). However, there was also another debug statement below which I think shows that '#_30r is actually live at the location bb0[1]:</p>
<div class="codehilite"><pre><span></span><code>DEBUG rustc_mir::borrow_check::region_infer find_sub_region_live_at: liveness_constraints for &#39;_#30r are &quot;{bb0[1]}&quot;
</code></pre></div>
<p>This ultimately leads to the ICE reported in the issue because when report_region_errors tries to report this error, it calls find_outlives_blame_span, which calls best_blame_constraint, which tries to find a path from the region '#_30r to the region live at Location(bb0[1]), which is just '#_30r, which results in an empty path, which means that calling <code>.remove(0)</code> on that path is an out of bounds error.</p>
<p>I suspect the cause of this issue is that check_bound_universal_region is generating a bad error: It is reporting that '#_30r does not outlive Location(bb0[1]) even though the region is indeed live at that location. However, I am not sure where to go from here because I do not understand how check_bound_universal_region works. Specifically, I don't understand this comment:</p>
<div class="codehilite"><pre><span></span><code>        // If we have some bound universal region `&#39;a`, then the only
        // elements it can contain is itself -- we don&#39;t know anything
        // else about it!
</code></pre></div>
<p>Could someone explain what it means for a universal region to be "bound," and why such universal regions can never contain anything other than themselves? Thank you for helping me with solving my first issue!</p>



<a name="251160981"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/What%20does%20check_bound_universal_region%20do%3F/near/251160981" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/What.20does.20check_bound_universal_region.20do.3F.html#251160981">(Aug 29 2021 at 22:01)</a>:</h4>
<p>I'm not very knowledgeable about this code, but these docs may be useful: <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_mir/borrow_check/region_infer/struct.RegionInferenceContext.html#method.check_universal_regions">https://doc.rust-lang.org/nightly/nightly-rustc/rustc_mir/borrow_check/region_infer/struct.RegionInferenceContext.html#method.check_universal_regions</a></p>



<a name="251161062"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/What%20does%20check_bound_universal_region%20do%3F/near/251161062" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/What.20does.20check_bound_universal_region.20do.3F.html#251161062">(Aug 29 2021 at 22:02)</a>:</h4>
<p>A "universal region" is a lifetime parameter:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">foo</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="c1">// 'a is a "universal region"</span>
</code></pre></div>



<a name="251161118"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/What%20does%20check_bound_universal_region%20do%3F/near/251161118" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/What.20does.20check_bound_universal_region.20do.3F.html#251161118">(Aug 29 2021 at 22:02)</a>:</h4>
<p>The <code>&lt;'a&gt;</code> is the "binding site" of <code>'a</code>.</p>



<a name="251161248"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/What%20does%20check_bound_universal_region%20do%3F/near/251161248" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/What.20does.20check_bound_universal_region.20do.3F.html#251161248">(Aug 29 2021 at 22:04)</a>:</h4>
<p>This section of the rustc-dev-guide may be useful: <a href="https://rustc-dev-guide.rust-lang.org/borrow_check/region_inference.html">https://rustc-dev-guide.rust-lang.org/borrow_check/region_inference.html</a></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>