<html>
<head><meta charset="utf-8"><title>Optimisations enabled in shipping nightly compiler · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Optimisations.20enabled.20in.20shipping.20nightly.20compiler.html">Optimisations enabled in shipping nightly compiler</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="267313406"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Optimisations%20enabled%20in%20shipping%20nightly%20compiler/near/267313406" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Simmons <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Optimisations.20enabled.20in.20shipping.20nightly.20compiler.html#267313406">(Jan 08 2022 at 20:17)</a>:</h4>
<p>Hello,</p>
<p>When building a local stage2 compiler, the results are noticeably slower than the shipped nightly compiler. I was wondering if there's a place where I can find what <code>config.toml</code> or other parameters are used for building Real rust builds? From looking at the code it seems like there's a bunch of stuff that isn't being inlined that should be, so I was kind of thinking that there might be LTO enabled for the real builds?</p>



<a name="267315124"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Optimisations%20enabled%20in%20shipping%20nightly%20compiler/near/267315124" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick12 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Optimisations.20enabled.20in.20shipping.20nightly.20compiler.html#267315124">(Jan 08 2022 at 20:58)</a>:</h4>
<p>Maybe it's PGO</p>



<a name="267316344"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Optimisations%20enabled%20in%20shipping%20nightly%20compiler/near/267316344" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hans Kratz <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Optimisations.20enabled.20in.20shipping.20nightly.20compiler.html#267316344">(Jan 08 2022 at 21:14)</a>:</h4>
<p>Dist CI builds created for each accepted PR notably use jemalloc and, on x86-64, use profile-guided optimization, see <a href="https://github.com/rust-lang/rust/blob/488acf86a75c56d30b16822e953c505a9e4901a7/src/ci/docker/host-x86_64/dist-x86_64-linux/Dockerfile#L114">Dockerfile</a> and <a href="https://github.com/rust-lang/rust/blob/488acf86a75c56d30b16822e953c505a9e4901a7/src/ci/pgo.sh">pgo.sh</a>.  Each day one of the successful ones is promoted to nightly. The easiest (but also quite time-consuming) way to produce one with similar performance characteristics is to use the same build process via <code>DEPLOY=1 ./src/ci/docker/run.sh dist-x86_64-linux</code>.</p>



<a name="267316613"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Optimisations%20enabled%20in%20shipping%20nightly%20compiler/near/267316613" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Optimisations.20enabled.20in.20shipping.20nightly.20compiler.html#267316613">(Jan 08 2022 at 21:21)</a>:</h4>
<p>Another notable difference is that <code>codegen-units-std=1</code> is set.  If you want to see what the configure arguments are, you can look at the build logs. For example:</p>
<ol>
<li>Go to <a href="https://github.com/rust-lang-ci/rust/actions?query=branch%3Aauto">https://github.com/rust-lang-ci/rust/actions?query=branch%3Aauto</a></li>
<li>Click on a recently finished build</li>
<li>Click on the build target you are interested in. For example, dist-x86_64-linux.</li>
<li>Click the wheel and then "View raw logs"</li>
<li>Look for the lines near the top that say <code>configure:</code></li>
</ol>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>