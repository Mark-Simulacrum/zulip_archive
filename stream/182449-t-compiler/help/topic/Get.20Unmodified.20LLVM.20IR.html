<html>
<head><meta charset="utf-8"><title>Get Unmodified LLVM IR · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Get.20Unmodified.20LLVM.20IR.html">Get Unmodified LLVM IR</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="264580332"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Get%20Unmodified%20LLVM%20IR/near/264580332" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Get.20Unmodified.20LLVM.20IR.html#264580332">(Dec 11 2021 at 19:38)</a>:</h4>
<p>Say I have some rust code and the asm it compiles to, which has missed optimizations on <code>-C opt-level=3</code>, and I would like to see if this is rustc's fault or LLVM's fault.</p>
<p>If I understand correctly, then <code>--emit llvm-ir -C opt-level=3</code>will emit the residual LLVM-IR after both rustc and llvm optimization passes run; if the optimization is illegal for this LLVM-IR,  then it is not necessarily rustc's fault, because the LLVM optimizations may have defined some behavior that was undefined before the optimizations.</p>
<p>On the other hand, if the optimization is illegal with <code>--emit llvm-ir -C opt-level=0</code> this is also not conclusive, since possibly rustc optimizations being on would have emitted different LLVM-IR for which the optimization would then have been legal. What is the correct way to check this? Is there some kind of "rustc optimizations yes, LLVM optimizations no" flag? I have tried checking <code>-C llvm-args</code> but did not find anything (probably I'm missing things)</p>



<a name="264580488"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Get%20Unmodified%20LLVM%20IR/near/264580488" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Get.20Unmodified.20LLVM.20IR.html#264580488">(Dec 11 2021 at 19:41)</a>:</h4>
<p>Try <code>-Cno-prepopulate-passes</code>. This will disable all LLVM optimizations and transformations.</p>



<a name="264580553"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Get%20Unmodified%20LLVM%20IR/near/264580553" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Get.20Unmodified.20LLVM.20IR.html#264580553">(Dec 11 2021 at 19:42)</a>:</h4>
<p>Thank you!</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>