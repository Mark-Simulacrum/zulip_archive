<html>
<head><meta charset="utf-8"><title>How to properly set Self::Something as return type in HIR · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/How.20to.20properly.20set.20Self.3A.3ASomething.20as.20return.20type.20in.20HIR.html">How to properly set Self::Something as return type in HIR</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="260664113"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/How%20to%20properly%20set%20Self%3A%3ASomething%20as%20return%20type%20in%20HIR/near/260664113" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/How.20to.20properly.20set.20Self.3A.3ASomething.20as.20return.20type.20in.20HIR.html#260664113">(Nov 08 2021 at 14:32)</a>:</h4>
<p>I'm currently creating an associated type on a trait, most of stuff a bit hardcoded in order to try things out</p>



<a name="260664178"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/How%20to%20properly%20set%20Self%3A%3ASomething%20as%20return%20type%20in%20HIR/near/260664178" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/How.20to.20properly.20set.20Self.3A.3ASomething.20as.20return.20type.20in.20HIR.html#260664178">(Nov 08 2021 at 14:33)</a>:</h4>
<p>I want to use the created associated type <code>__Assoc</code> as the return type of a function on that trait</p>



<a name="260664202"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/How%20to%20properly%20set%20Self%3A%3ASomething%20as%20return%20type%20in%20HIR/near/260664202" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/How.20to.20properly.20set.20Self.3A.3ASomething.20as.20return.20type.20in.20HIR.html#260664202">(Nov 08 2021 at 14:33)</a>:</h4>
<p>I'm doing ...</p>



<a name="260664259"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/How%20to%20properly%20set%20Self%3A%3ASomething%20as%20return%20type%20in%20HIR/near/260664259" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/How.20to.20properly.20set.20Self.3A.3ASomething.20as.20return.20type.20in.20HIR.html#260664259">(Nov 08 2021 at 14:34)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">ret_ty_ref</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hir</span>::<span class="n">TyKind</span>::<span class="n">Path</span><span class="p">(</span><span class="n">hir</span>::<span class="n">QPath</span>::<span class="n">Resolved</span><span class="p">(</span><span class="w"></span>
<span class="w">            </span><span class="nb">None</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="bp">self</span><span class="p">.</span><span class="n">arena</span><span class="p">.</span><span class="n">alloc</span><span class="p">(</span><span class="n">hir</span>::<span class="n">Path</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">span</span>: <span class="nc">self</span><span class="p">.</span><span class="n">lower_span</span><span class="p">(</span><span class="n">span</span><span class="p">),</span><span class="w"></span>
<span class="w">                </span><span class="n">res</span>: <span class="nc">self</span><span class="p">.</span><span class="n">lower_res</span><span class="p">(</span><span class="n">Res</span>::<span class="n">Def</span><span class="p">(</span><span class="n">DefKind</span>::<span class="n">AssocTy</span><span class="p">,</span><span class="w"> </span><span class="n">return_def_id</span><span class="p">.</span><span class="n">to_def_id</span><span class="p">())),</span><span class="w"></span>
<span class="w">                </span><span class="n">segments</span>: <span class="nc">arena_vec</span><span class="o">!</span><span class="p">[</span><span class="w"></span>
<span class="w">                    </span><span class="bp">self</span><span class="p">;</span><span class="w"></span>
<span class="w">                    </span><span class="n">hir</span>::<span class="n">PathSegment</span>::<span class="n">from_ident</span><span class="p">(</span><span class="n">Ident</span>::<span class="n">from_str</span><span class="p">(</span><span class="s">"Self"</span><span class="p">)),</span><span class="w"></span>
<span class="w">                    </span><span class="n">hir</span>::<span class="n">PathSegment</span>::<span class="n">from_ident</span><span class="p">(</span><span class="n">Ident</span>::<span class="n">from_str</span><span class="p">(</span><span class="s">"__Assoc"</span><span class="p">))</span><span class="w"></span>
<span class="w">                </span><span class="p">],</span><span class="w"></span>
<span class="w">            </span><span class="p">}),</span><span class="w"></span>
<span class="w">        </span><span class="p">));</span><span class="w"></span>

<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">ret_ty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">ty</span><span class="p">(</span><span class="n">ty_span</span><span class="p">,</span><span class="w"> </span><span class="n">ret_ty_ref</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">hir</span>::<span class="n">FnRetTy</span>::<span class="n">Return</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">arena</span><span class="p">.</span><span class="n">alloc</span><span class="p">(</span><span class="n">ret_ty</span><span class="p">))</span><span class="w"></span>
</code></pre></div>



<a name="260664296"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/How%20to%20properly%20set%20Self%3A%3ASomething%20as%20return%20type%20in%20HIR/near/260664296" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/How.20to.20properly.20set.20Self.3A.3ASomething.20as.20return.20type.20in.20HIR.html#260664296">(Nov 08 2021 at 14:34)</a>:</h4>
<p>note the <code>Self</code> in the <code>PathSegment</code></p>



<a name="260664305"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/How%20to%20properly%20set%20Self%3A%3ASomething%20as%20return%20type%20in%20HIR/near/260664305" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/How.20to.20properly.20set.20Self.3A.3ASomething.20as.20return.20type.20in.20HIR.html#260664305">(Nov 08 2021 at 14:34)</a>:</h4>
<p>that's clearly wrong</p>



<a name="260664358"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/How%20to%20properly%20set%20Self%3A%3ASomething%20as%20return%20type%20in%20HIR/near/260664358" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/How.20to.20properly.20set.20Self.3A.3ASomething.20as.20return.20type.20in.20HIR.html#260664358">(Nov 08 2021 at 14:34)</a>:</h4>
<p>when I try to compile my code I'm getting</p>



<a name="260664365"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/How%20to%20properly%20set%20Self%3A%3ASomething%20as%20return%20type%20in%20HIR/near/260664365" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/How.20to.20properly.20set.20Self.3A.3ASomething.20as.20return.20type.20in.20HIR.html#260664365">(Nov 08 2021 at 14:34)</a>:</h4>
<div class="codehilite"><pre><span></span><code>error[E0223]: ambiguous associated type
 --&gt; src/test/ui/async-await/async-fns-in-triats/simple-trait-definition.rs:5:28
  |
5 |     async fn foo(&amp;self) -&gt; i32;
  |                            ^^^ help: use fully-qualified syntax: `&lt;Self as MyTrait&gt;::__Assoc`

error: aborting due to previous error

For more information about this error, try `rustc --explain E0223`.
</code></pre></div>



<a name="260664418"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/How%20to%20properly%20set%20Self%3A%3ASomething%20as%20return%20type%20in%20HIR/near/260664418" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/How.20to.20properly.20set.20Self.3A.3ASomething.20as.20return.20type.20in.20HIR.html#260664418">(Nov 08 2021 at 14:35)</a>:</h4>
<p>how does one properly set up that Self?</p>



<a name="260664427"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/How%20to%20properly%20set%20Self%3A%3ASomething%20as%20return%20type%20in%20HIR/near/260664427" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/How.20to.20properly.20set.20Self.3A.3ASomething.20as.20return.20type.20in.20HIR.html#260664427">(Nov 08 2021 at 14:35)</a>:</h4>
<p>I was thinking about <code>SelfTy</code></p>



<a name="260664585"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/How%20to%20properly%20set%20Self%3A%3ASomething%20as%20return%20type%20in%20HIR/near/260664585" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/How.20to.20properly.20set.20Self.3A.3ASomething.20as.20return.20type.20in.20HIR.html#260664585">(Nov 08 2021 at 14:36)</a>:</h4>
<p>but the resolution of that path is not a <code>Self</code> thing</p>



<a name="260664713"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/How%20to%20properly%20set%20Self%3A%3ASomething%20as%20return%20type%20in%20HIR/near/260664713" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/How.20to.20properly.20set.20Self.3A.3ASomething.20as.20return.20type.20in.20HIR.html#260664713">(Nov 08 2021 at 14:37)</a>:</h4>
<p>ideas/tips/etc are more than welcome :)</p>



<a name="260669381"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/How%20to%20properly%20set%20Self%3A%3ASomething%20as%20return%20type%20in%20HIR/near/260669381" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/How.20to.20properly.20set.20Self.3A.3ASomething.20as.20return.20type.20in.20HIR.html#260669381">(Nov 08 2021 at 15:09)</a>:</h4>
<p>Right, there's a different variant to use</p>



<a name="260669429"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/How%20to%20properly%20set%20Self%3A%3ASomething%20as%20return%20type%20in%20HIR/near/260669429" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/How.20to.20properly.20set.20Self.3A.3ASomething.20as.20return.20type.20in.20HIR.html#260669429">(Nov 08 2021 at 15:09)</a>:</h4>
<p>What you're lowering is equivalent to <code>Self::__Assoc</code> and you want <code>&lt;Self as MyTrait&gt;::__Assoc</code></p>



<a name="260669596"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/How%20to%20properly%20set%20Self%3A%3ASomething%20as%20return%20type%20in%20HIR/near/260669596" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/How.20to.20properly.20set.20Self.3A.3ASomething.20as.20return.20type.20in.20HIR.html#260669596">(Nov 08 2021 at 15:10)</a>:</h4>
<p>It's that <code>None</code> in <code>Resolved</code></p>



<a name="260670013"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/How%20to%20properly%20set%20Self%3A%3ASomething%20as%20return%20type%20in%20HIR/near/260670013" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/How.20to.20properly.20set.20Self.3A.3ASomething.20as.20return.20type.20in.20HIR.html#260670013">(Nov 08 2021 at 15:13)</a>:</h4>
<p>I would maybe write what you expect to see the lowered ast to look like in the playground, and then view hir</p>



<a name="260670136"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/How%20to%20properly%20set%20Self%3A%3ASomething%20as%20return%20type%20in%20HIR/near/260670136" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/How.20to.20properly.20set.20Self.3A.3ASomething.20as.20return.20type.20in.20HIR.html#260670136">(Nov 08 2021 at 15:14)</a>:</h4>
<p><span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="260670382"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/How%20to%20properly%20set%20Self%3A%3ASomething%20as%20return%20type%20in%20HIR/near/260670382" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/How.20to.20properly.20set.20Self.3A.3ASomething.20as.20return.20type.20in.20HIR.html#260670382">(Nov 08 2021 at 15:16)</a>:</h4>
<p>err, nevermind, that doesn't show what you want</p>



<a name="260670451"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/How%20to%20properly%20set%20Self%3A%3ASomething%20as%20return%20type%20in%20HIR/near/260670451" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/How.20to.20properly.20set.20Self.3A.3ASomething.20as.20return.20type.20in.20HIR.html#260670451">(Nov 08 2021 at 15:16)</a>:</h4>
<p>But do look at <code>Resolved</code></p>



<a name="260670468"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/How%20to%20properly%20set%20Self%3A%3ASomething%20as%20return%20type%20in%20HIR/near/260670468" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/How.20to.20properly.20set.20Self.3A.3ASomething.20as.20return.20type.20in.20HIR.html#260670468">(Nov 08 2021 at 15:16)</a>:</h4>
<p>the doc comment explains a bit</p>



<a name="260674578"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/How%20to%20properly%20set%20Self%3A%3ASomething%20as%20return%20type%20in%20HIR/near/260674578" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/How.20to.20properly.20set.20Self.3A.3ASomething.20as.20return.20type.20in.20HIR.html#260674578">(Nov 08 2021 at 15:45)</a>:</h4>
<p>gonna check this out in a bit, thanks</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>