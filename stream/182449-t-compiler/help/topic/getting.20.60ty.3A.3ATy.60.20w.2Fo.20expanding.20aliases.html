<html>
<head><meta charset="utf-8"><title>getting `ty::Ty` w/o expanding aliases · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/getting.20.60ty.3A.3ATy.60.20w.2Fo.20expanding.20aliases.html">getting `ty::Ty` w/o expanding aliases</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="264110878"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/getting%20%60ty%3A%3ATy%60%20w/o%20expanding%20aliases/near/264110878" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/getting.20.60ty.3A.3ATy.60.20w.2Fo.20expanding.20aliases.html#264110878">(Dec 08 2021 at 04:31)</a>:</h4>
<p>Is there a way to get the <code>ty::Ty</code> of, e.g., a <code>DefId</code> without expanding type aliases? (Actually, I would probably need to have selective expansion of aliases...)</p>
<p>My use case is for rustdoc; see <a href="#narrow/stream/266220-rustdoc/topic/reducing.20duplication">https://rust-lang.zulipchat.com/#narrow/stream/266220-rustdoc/topic/reducing.20duplication</a>.</p>



<a name="264118170"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/getting%20%60ty%3A%3ATy%60%20w/o%20expanding%20aliases/near/264118170" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/getting.20.60ty.3A.3ATy.60.20w.2Fo.20expanding.20aliases.html#264118170">(Dec 08 2021 at 06:52)</a>:</h4>
<p><code>TyKind</code> doesn't have a variant for type aliases, so how should type aliases be represented by such method?</p>



<a name="264212490"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/getting%20%60ty%3A%3ATy%60%20w/o%20expanding%20aliases/near/264212490" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/getting.20.60ty.3A.3ATy.60.20w.2Fo.20expanding.20aliases.html#264212490">(Dec 08 2021 at 20:05)</a>:</h4>
<p>I didn't expect it to be possible, but I thought it was worth asking. Having some way to recover type alias information from a type might be useful for diagnostics too.</p>



<a name="264212514"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/getting%20%60ty%3A%3ATy%60%20w/o%20expanding%20aliases/near/264212514" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/getting.20.60ty.3A.3ATy.60.20w.2Fo.20expanding.20aliases.html#264212514">(Dec 08 2021 at 20:05)</a>:</h4>
<p>I'm not sure if there's really a good way to do it though...</p>



<a name="264212731"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/getting%20%60ty%3A%3ATy%60%20w/o%20expanding%20aliases/near/264212731" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/getting.20.60ty.3A.3ATy.60.20w.2Fo.20expanding.20aliases.html#264212731">(Dec 08 2021 at 20:06)</a>:</h4>
<p>I'm open to other ideas about how to solve my rustdoc conundrum too ;)</p>



<a name="264215325"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/getting%20%60ty%3A%3ATy%60%20w/o%20expanding%20aliases/near/264215325" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/getting.20.60ty.3A.3ATy.60.20w.2Fo.20expanding.20aliases.html#264215325">(Dec 08 2021 at 20:27)</a>:</h4>
<p>Rust-analyzer has the same problem. There is an open issue for ra about this.</p>



<a name="264218305"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/getting%20%60ty%3A%3ATy%60%20w/o%20expanding%20aliases/near/264218305" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/getting.20.60ty.3A.3ATy.60.20w.2Fo.20expanding.20aliases.html#264218305">(Dec 08 2021 at 20:50)</a>:</h4>
<p>Looks like there's <a href="https://github.com/rust-lang/r-a/issues/1666">r-a#1666</a>, and potentially several duplicates.</p>



<a name="264218412"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/getting%20%60ty%3A%3ATy%60%20w/o%20expanding%20aliases/near/264218412" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/getting.20.60ty.3A.3ATy.60.20w.2Fo.20expanding.20aliases.html#264218412">(Dec 08 2021 at 20:51)</a>:</h4>
<p>So do you think it'd be reasonable to add an <code>Alias</code> (or similar) variant to <code>ty::TyKind</code>, and add a way to normalize type aliases lazily, or only normalize some?</p>



<a name="264218539"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/getting%20%60ty%3A%3ATy%60%20w/o%20expanding%20aliases/near/264218539" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/getting.20.60ty.3A.3ATy.60.20w.2Fo.20expanding.20aliases.html#264218539">(Dec 08 2021 at 20:52)</a>:</h4>
<p>I'm not very familiar with the existing way that type alias normalization is handled. I think I'll try to look through the type-checker sources a bit.</p>



<a name="264222231"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/getting%20%60ty%3A%3ATy%60%20w/o%20expanding%20aliases/near/264222231" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/getting.20.60ty.3A.3ATy.60.20w.2Fo.20expanding.20aliases.html#264222231">(Dec 08 2021 at 21:22)</a>:</h4>
<p><span class="user-mention" data-user-id="307537">@Noah Lev</span> I don't see how lazy normalization would help here - this is in metadata, so it has to be normalized at some point anyway</p>



<a name="264222248"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/getting%20%60ty%3A%3ATy%60%20w/o%20expanding%20aliases/near/264222248" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/getting.20.60ty.3A.3ATy.60.20w.2Fo.20expanding.20aliases.html#264222248">(Dec 08 2021 at 21:22)</a>:</h4>
<p>(also, people have been trying to do lazy normalization for years and I don't think we should block on that)</p>



<a name="264222431"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/getting%20%60ty%3A%3ATy%60%20w/o%20expanding%20aliases/near/264222431" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/getting.20.60ty.3A.3ATy.60.20w.2Fo.20expanding.20aliases.html#264222431">(Dec 08 2021 at 21:24)</a>:</h4>
<p>I'm open to suggestions of how to accomplish the rustdoc cleanup without lazy normalization :P</p>



<a name="264223945"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/getting%20%60ty%3A%3ATy%60%20w/o%20expanding%20aliases/near/264223945" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/getting.20.60ty.3A.3ATy.60.20w.2Fo.20expanding.20aliases.html#264223945">(Dec 08 2021 at 21:34)</a>:</h4>
<p>Actually, I'm pretty sure lazy normalization of type aliases ≠ <a href="https://github.com/rust-lang/rust/issues/60471">"lazy normalization"</a>.</p>



<a name="264224348"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/getting%20%60ty%3A%3ATy%60%20w/o%20expanding%20aliases/near/264224348" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/getting.20.60ty.3A.3ATy.60.20w.2Fo.20expanding.20aliases.html#264224348">(Dec 08 2021 at 21:37)</a>:</h4>
<p>So maybe it wouldn't be as hard?</p>



<a name="264224483"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/getting%20%60ty%3A%3ATy%60%20w/o%20expanding%20aliases/near/264224483" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/getting.20.60ty.3A.3ATy.60.20w.2Fo.20expanding.20aliases.html#264224483">(Dec 08 2021 at 21:38)</a>:</h4>
<blockquote>
<p>this is in metadata, so it has to be normalized at some point anyway</p>
</blockquote>
<p>My idea is that <code>tcx.type_of(a_type_alias)</code> would return <code>TyKind::TyAlias(def_id, ty_value)</code>, which would then be normalized on-demand. I.e., it wouldn't be normalized in metadata.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>