<html>
<head><meta charset="utf-8"><title>help understanding the spike-neg incremental tests · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/help.20understanding.20the.20spike-neg.20incremental.20tests.html">help understanding the spike-neg incremental tests</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="275913766"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/help%20understanding%20the%20spike-neg%20incremental%20tests/near/275913766" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/help.20understanding.20the.20spike-neg.20incremental.20tests.html#275913766">(Mar 19 2022 at 14:46)</a>:</h4>
<p><code>incremental/spike-neg1.rs</code> and <code>incremental/spike-neg2.rs</code> both fail with cg_clif. They are missing <code>// compile-flags: -Z query-dep-graph</code> which results in <code>error: found CGU-reuse attribute but </code>-Zquery-dep-graph<code> was not specified</code> with cg_clif. They are marked as <code>should-fail</code> so this should be fine, but compiletest doesn't accept them. A comment however indicates that one of the <code>#![rustc_partition_reused]</code> attributes should instead fail. If I add <code>-Zquery-dep-graph</code> this doesn't happen. What exactly are those tests meant to test and why do they fail with cg_clif?</p>



<a name="275926207"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/help%20understanding%20the%20spike-neg%20incremental%20tests/near/275926207" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/help.20understanding.20the.20spike-neg.20incremental.20tests.html#275926207">(Mar 19 2022 at 19:46)</a>:</h4>
<p>cc <span class="user-mention" data-user-id="116009">@nikomatsakis</span> as you introduced this test.</p>



<a name="276104110"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/help%20understanding%20the%20spike-neg%20incremental%20tests/near/276104110" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/help.20understanding.20the.20spike-neg.20incremental.20tests.html#276104110">(Mar 21 2022 at 19:46)</a>:</h4>
<p>uh :)</p>



<a name="276725253"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/help%20understanding%20the%20spike-neg%20incremental%20tests/near/276725253" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cjgillot <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/help.20understanding.20the.20spike-neg.20incremental.20tests.html#276725253">(Mar 26 2022 at 13:06)</a>:</h4>
<p><span class="user-mention" data-user-id="133247">@bjorn3</span> the absence of -Zquery-dep-graph is probably an oversight. The point of these tests is to ensure that the <code>rustc_partition_reused</code>/<code>rustc_partition_codegened</code> attributes work as designed. How does cg_clif plug itself into the incremental CGU recompilation?</p>



<a name="276725431"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/help%20understanding%20the%20spike-neg%20incremental%20tests/near/276725431" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/help.20understanding.20the.20spike-neg.20incremental.20tests.html#276725431">(Mar 26 2022 at 13:10)</a>:</h4>
<blockquote>
<p>How does cg_clif plug itself into the incremental CGU recompilation?</p>
</blockquote>
<p>AFAIK the exact same way as cg_ssa does. It may have diverged a bit though. This specific error originates from inside rustc_interface though which does the check.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>