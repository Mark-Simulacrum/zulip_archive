<html>
<head><meta charset="utf-8"><title>Help with queries for Clippy · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Help.20with.20queries.20for.20Clippy.html">Help with queries for Clippy</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="249200642"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Help%20with%20queries%20for%20Clippy/near/249200642" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Help.20with.20queries.20for.20Clippy.html#249200642">(Aug 12 2021 at 06:03)</a>:</h4>
<p>I am eagerly trying to fix this bug for clippy <a href="https://github.com/rust-lang/rust-clippy/issues/4002">https://github.com/rust-lang/rust-clippy/issues/4002</a> using queries. What I've done so far:</p>
<ol>
<li>Get <code>predicates_of</code> for the method accepting the closure</li>
<li>Create a new <code>Substs</code>, replacing the closure type with the type of the method inside the closure</li>
<li>Create new predicates from the above</li>
<li>Run <code>FulfillCtxt::register_predicate_obligation</code> with those predicates, then <code>select_all_or_error</code></li>
<li>Run <code>infcx.process_registered_region_obligations</code></li>
<li>Observe interesting data in <code>take_and_reset_region_constraints</code></li>
</ol>
<p>I think the next step is to create and run a canonical query - from the region constraints? Can anyone help with that?</p>



<a name="249200881"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Help%20with%20queries%20for%20Clippy/near/249200881" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Help.20with.20queries.20for.20Clippy.html#249200881">(Aug 12 2021 at 06:09)</a>:</h4>
<p><span class="user-mention" data-user-id="119235">@David Tolnay</span> perhaps you'd be interested in helping since you reported the bug :)</p>



<a name="249250081"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Help%20with%20queries%20for%20Clippy/near/249250081" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Help.20with.20queries.20for.20Clippy.html#249250081">(Aug 12 2021 at 15:27)</a>:</h4>
<p>Okay I am really close now - I can call <code>resolve_regions_and_report_errors</code> and it gives me the result I'm looking for. But of course I don't want to report errors. In order to not report error, it looks like I need <code>lexical_region_resolve::resolve</code> which is private. Can this be made public for Clippy?</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>