<html>
<head><meta charset="utf-8"><title>Long compile time on stable · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Long.20compile.20time.20on.20stable.html">Long compile time on stable</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="272783202"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Long%20compile%20time%20on%20stable/near/272783202" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vilda <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Long.20compile.20time.20on.20stable.html#272783202">(Feb 22 2022 at 10:16)</a>:</h4>
<p>Hello!<br>
I've ran into issue where compile times take over hour for stable rust (<code>cargo b</code>) but on nightly it takes few minutes (<code>cargo +nightly b</code>). What can I do to troubleshoot this? I've tried using  <code> -C linker=rust-lld.exe</code> and  <code>lto=off</code> but it didn't help. I'm running on Windows. My colleague  doesn't have this problem since he switched to zld linker on Mac.</p>



<a name="272845078"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Long%20compile%20time%20on%20stable/near/272845078" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Long.20compile.20time.20on.20stable.html#272845078">(Feb 22 2022 at 18:19)</a>:</h4>
<p>You could try bisecting nightlies. <a href="https://blog.rust-lang.org/inside-rust/2019/12/18/bisecting-rust-compiler.html">https://blog.rust-lang.org/inside-rust/2019/12/18/bisecting-rust-compiler.html</a><br>
Alternatively there are some options that can be used to look at how long various passes take, but if it takes an hour and stuff only gets printed when the pass finishes it can be tedious.</p>



<a name="272849692"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Long%20compile%20time%20on%20stable/near/272849692" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Long.20compile.20time.20on.20stable.html#272849692">(Feb 22 2022 at 18:53)</a>:</h4>
<p>cargo-bisect-rustc has a <code>--timeout</code> option for this situation.</p>



<a name="272850109"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Long%20compile%20time%20on%20stable/near/272850109" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Long.20compile.20time.20on.20stable.html#272850109">(Feb 22 2022 at 18:56)</a>:</h4>
<p>Does beta have the issue?</p>



<a name="272912961"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Long%20compile%20time%20on%20stable/near/272912961" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vilda <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Long.20compile.20time.20on.20stable.html#272912961">(Feb 23 2022 at 07:28)</a>:</h4>
<p>There's no issue with nightly  and cargo-bisect-rustc seems to work only for nightly.<br>
My issue is this:</p>
<div class="codehilite"><pre><span></span><code>cargo clean
cargo build
Finished dev [unoptimized + debuginfo] target(s) in 68m 40s
</code></pre></div>
<p>As you can see the stable build takes 68m and that's too much.<br>
When I run it on nightly</p>
<div class="codehilite"><pre><span></span><code>cargo clean
cargo +nightly build
Finished dev [unoptimized + debuginfo] target(s) in 2m 43s
</code></pre></div>
<p>That's too big of difference. These are the toolchains:</p>
<div class="codehilite"><pre><span></span><code> rustup toolchain list
stable-x86_64-pc-windows-msvc (default)
nightly-x86_64-pc-windows-msvc
</code></pre></div>
<p>and rustc version:<br>
<code>rustc 1.58.1 (db9d1b20b 2022-01-20)</code></p>
<p>I'll try to reinstall both of rustc, rustup and toolchains and see if that helps.</p>



<a name="272956226"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Long%20compile%20time%20on%20stable/near/272956226" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Long.20compile.20time.20on.20stable.html#272956226">(Feb 23 2022 at 14:33)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="480514">@Vilda</span>. </p>
<blockquote>
<p>There's no issue with nightly and cargo-bisect-rustc seems to work only for nightly.</p>
</blockquote>
<p>What you'll want to do is use a nightly build from around 12 weeks ago (which is when the current stable release branched off from nightly). That would be about <code>2021-12-01</code>.</p>



<a name="272957035"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Long%20compile%20time%20on%20stable/near/272957035" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Long.20compile.20time.20on.20stable.html#272957035">(Feb 23 2022 at 14:41)</a>:</h4>
<p>Just as a shot in the dark, you may want to see if you're hitting the "projection caching" issue fixed in <a href="https://github.com/rust-lang/rust/pull/89831">https://github.com/rust-lang/rust/pull/89831</a>. You can test some nightlies around that PR to see if the performance improves (test say, nightly <code>2021-12-18</code> as the before and <code>2021-12-22</code> as the after.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>