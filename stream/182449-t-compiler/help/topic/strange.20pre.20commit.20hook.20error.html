<html>
<head><meta charset="utf-8"><title>strange pre commit hook error · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/strange.20pre.20commit.20hook.20error.html">strange pre commit hook error</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="257963164"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/strange%20pre%20commit%20hook%20error/near/257963164" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Winter <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/strange.20pre.20commit.20hook.20error.html#257963164">(Oct 18 2021 at 01:05)</a>:</h4>
<div class="codehilite"><pre><span></span><code>Running pre-commit script &#39;/Users/winter/src/rust/x.py test tidy --bless&#39;
Updating only changed submodules
Updating submodule library/backtrace
fatal: .git/index: index file open failed: Not a directory
failed to run: git reset -q --hard
Build completed unsuccessfully in 0:00:00
</code></pre></div>
<p>This error occurred after <code>git submodule update --remote library/backtrace; git add library/backtrace</code>, should I just remove the pre commit hook? Or did I do something wrong?</p>



<a name="257963348"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/strange%20pre%20commit%20hook%20error/near/257963348" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Winter <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/strange.20pre.20commit.20hook.20error.html#257963348">(Oct 18 2021 at 01:08)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/blob/1f12ac87296ac61ec002e0243e7ad5a50364da35/src/bootstrap/bootstrap.py#L1031">https://github.com/rust-lang/rust/blob/1f12ac87296ac61ec002e0243e7ad5a50364da35/src/bootstrap/bootstrap.py#L1031</a></p>



<a name="257963353"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/strange%20pre%20commit%20hook%20error/near/257963353" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Winter <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/strange.20pre.20commit.20hook.20error.html#257963353">(Oct 18 2021 at 01:08)</a>:</h4>
<div class="codehilite"><pre><span></span><code>$ cat library/backtrace/.git
gitdir: ../../.git/modules/library/backtrace
</code></pre></div>



<a name="257963357"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/strange%20pre%20commit%20hook%20error/near/257963357" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Winter <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/strange.20pre.20commit.20hook.20error.html#257963357">(Oct 18 2021 at 01:08)</a>:</h4>
<p>hmm</p>



<a name="257963372"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/strange%20pre%20commit%20hook%20error/near/257963372" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Winter <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/strange.20pre.20commit.20hook.20error.html#257963372">(Oct 18 2021 at 01:09)</a>:</h4>
<p>running <code>git reset -q --hard</code> from <code>library/backtrace</code> works fine</p>



<a name="257963493"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/strange%20pre%20commit%20hook%20error/near/257963493" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Winter <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/strange.20pre.20commit.20hook.20error.html#257963493">(Oct 18 2021 at 01:11)</a>:</h4>
<p><code>module_path</code> is <code>/Users/winter/src/rust/library/backtrace</code>, and running that manually from there works fine...</p>



<a name="257963586"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/strange%20pre%20commit%20hook%20error/near/257963586" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Winter <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/strange.20pre.20commit.20hook.20error.html#257963586">(Oct 18 2021 at 01:12)</a>:</h4>
<p>and running <code>x.py tidy test --bless</code> myself works completely fine</p>



<a name="257963590"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/strange%20pre%20commit%20hook%20error/near/257963590" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Winter <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/strange.20pre.20commit.20hook.20error.html#257963590">(Oct 18 2021 at 01:12)</a>:</h4>
<p>doesn't error at all</p>



<a name="257963601"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/strange%20pre%20commit%20hook%20error/near/257963601" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Winter <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/strange.20pre.20commit.20hook.20error.html#257963601">(Oct 18 2021 at 01:12)</a>:</h4>
<p>seems to just be in the pre-commit hook</p>



<a name="257963622"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/strange%20pre%20commit%20hook%20error/near/257963622" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Winter <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/strange.20pre.20commit.20hook.20error.html#257963622">(Oct 18 2021 at 01:13)</a>:</h4>
<div class="codehilite"><pre><span></span><code># https://github.com/rust-lang/rust/issues/77620#issuecomment-705144570
unset GIT_DIR
</code></pre></div>



<a name="257963634"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/strange%20pre%20commit%20hook%20error/near/257963634" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Winter <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/strange.20pre.20commit.20hook.20error.html#257963634">(Oct 18 2021 at 01:13)</a>:</h4>
<p>that seems like it may screw something up</p>



<a name="257963652"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/strange%20pre%20commit%20hook%20error/near/257963652" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/strange.20pre.20commit.20hook.20error.html#257963652">(Oct 18 2021 at 01:13)</a>:</h4>
<p><span class="user-mention" data-user-id="450762">@Winter</span>  Set <code>submodules = false</code> in <code>config.toml</code>.</p>



<a name="257963699"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/strange%20pre%20commit%20hook%20error/near/257963699" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/strange.20pre.20commit.20hook.20error.html#257963699">(Oct 18 2021 at 01:14)</a>:</h4>
<p>I suspect that there are some oddities of running git commands within a git hook.</p>



<a name="257963748"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/strange%20pre%20commit%20hook%20error/near/257963748" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Winter <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/strange.20pre.20commit.20hook.20error.html#257963748">(Oct 18 2021 at 01:15)</a>:</h4>
<p>I suspect the <code>unset GIT_DIR</code> in the <code>pre-commit</code> hook may be screwing things up.</p>



<a name="257963769"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/strange%20pre%20commit%20hook%20error/near/257963769" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Winter <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/strange.20pre.20commit.20hook.20error.html#257963769">(Oct 18 2021 at 01:15)</a>:</h4>
<p>I've removed the hook for now, and will look into it when I can. Thanks <span class="user-mention" data-user-id="120518">@Eric Huss</span>.</p>



<a name="257964569"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/strange%20pre%20commit%20hook%20error/near/257964569" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/strange.20pre.20commit.20hook.20error.html#257964569">(Oct 18 2021 at 01:29)</a>:</h4>
<p><span class="user-mention" data-user-id="450762">@Winter</span> <a href="https://github.com/rust-lang/rust/issues/77620">https://github.com/rust-lang/rust/issues/77620</a></p>



<a name="257964630"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/strange%20pre%20commit%20hook%20error/near/257964630" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/strange.20pre.20commit.20hook.20error.html#257964630">(Oct 18 2021 at 01:30)</a>:</h4>
<p>Not sure why it's breaking specifically for you but I'm also not sure why GIT_DIR helped in the first place <span aria-label="shrug" class="emoji emoji-1f937" role="img" title="shrug">:shrug:</span></p>



<a name="257964645"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/strange%20pre%20commit%20hook%20error/near/257964645" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Winter <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/strange.20pre.20commit.20hook.20error.html#257964645">(Oct 18 2021 at 01:30)</a>:</h4>
<p>The workaround in <a href="https://github.com/rust-lang/rust/pull/77683">https://github.com/rust-lang/rust/pull/77683</a> doesn't seem to work</p>



<a name="257964650"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/strange%20pre%20commit%20hook%20error/near/257964650" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Winter <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/strange.20pre.20commit.20hook.20error.html#257964650">(Oct 18 2021 at 01:30)</a>:</h4>
<p>yeah</p>



<a name="257964669"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/strange%20pre%20commit%20hook%20error/near/257964669" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Winter <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/strange.20pre.20commit.20hook.20error.html#257964669">(Oct 18 2021 at 01:31)</a>:</h4>
<p><span class="user-mention silent" data-user-id="120518">Eric Huss</span> <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/strange.20pre.20commit.20hook.20error/near/257963652">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="450762">Winter</span>  Set <code>submodules = false</code> in <code>config.toml</code>.</p>
</blockquote>
<p>Would this stop <code>x.py build</code> from discarding my uncommitted submodule updates by chance?</p>



<a name="257964822"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/strange%20pre%20commit%20hook%20error/near/257964822" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Winter <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/strange.20pre.20commit.20hook.20error.html#257964822">(Oct 18 2021 at 01:34)</a>:</h4>
<div class="codehilite" data-code-language="TOML"><pre><span></span><code><span class="c1"># Indicate whether git submodules are managed and updated automatically.</span>
<span class="c1">#submodules = true</span>
</code></pre></div>
<p>Cool, it does. Sorry for the ping.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>