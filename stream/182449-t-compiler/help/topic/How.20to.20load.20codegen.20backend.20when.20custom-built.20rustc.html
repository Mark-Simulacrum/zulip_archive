<html>
<head><meta charset="utf-8"><title>How to load codegen backend when custom-built rustc · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/How.20to.20load.20codegen.20backend.20when.20custom-built.20rustc.html">How to load codegen backend when custom-built rustc</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="250399857"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/How%20to%20load%20codegen%20backend%20when%20custom-built%20rustc/near/250399857" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> antoyo <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/How.20to.20load.20codegen.20backend.20when.20custom-built.20rustc.html#250399857">(Aug 23 2021 at 19:28)</a>:</h4>
<p>Hi.<br>
To debug <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/'rustc'.20panicked.20at.20'called.20Option.3A.3Aunwrap.28.29.20on.20a.20None.20value">an issue</a>, I want to use a rustc built with debug symbols.<br>
I use to be able to do that, by creating a rustup toolchain link (named debug-current) and specifying that name in <code>rust-toolchain</code>, but it doesn't work anymore.<br>
I get the error:</p>
<div class="codehilite"><pre><span></span><code>error: couldn&#39;t load codegen backend &quot;/projects/rustc_codegen_gccjit/target/debug/librustc_codegen_gcc.so&quot;: &quot;librustc_driver-d417e018100dedfd.so: cannot open shared object file: No such file or directory&quot;
</code></pre></div>
<p>My notes mention that I should add <code>~/.rustup/toolchains/debug-current/lib/rustlib/x86_64-unknown-linux-gnu/lib</code> to <code>LD_LIBRARY_PATH</code>, but that doesn't work either. In this case, I get the following error at run-time:</p>
<div class="codehilite"><pre><span></span><code>thread &#39;&lt;unnamed&gt;&#39; panicked at &#39;cannot access a scoped thread local variable without calling `set` first&#39;, /home/bouanto/.cargo/registry/src/github.com-1ecc6299db9ec823/scoped-tls-1.0.0/src/lib.rs:168:9
</code></pre></div>
<p>What can I do to be able to load a codegen backend in a custom-built rustc?<br>
Thanks.</p>



<a name="250400427"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/How%20to%20load%20codegen%20backend%20when%20custom-built%20rustc/near/250400427" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/How.20to.20load.20codegen.20backend.20when.20custom-built.20rustc.html#250400427">(Aug 23 2021 at 19:33)</a>:</h4>
<p>the second error looks unrelated to the first - what's the backtrace on that? parts of the compiler you just can't use without being in the context of <code>with_default_session_globals()</code></p>



<a name="250401282"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/How%20to%20load%20codegen%20backend%20when%20custom-built%20rustc/near/250401282" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> antoyo <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/How.20to.20load.20codegen.20backend.20when.20custom-built.20rustc.html#250401282">(Aug 23 2021 at 19:40)</a>:</h4>
<p>Here's the full backtrace:</p>
<div class="codehilite"><pre><span></span><code>thread &#39;&lt;unnamed&gt;&#39; panicked at &#39;cannot access a scoped thread local variable without calling `set` first&#39;, /home/bouanto/.cargo/registry/src/github.com-1ecc6299db9ec823/scoped-tls-1.0.0/src/lib.rs:168:9
stack backtrace:
   0: std::panicking::begin_panic
             at /home/bouanto/Ordinateur/Programmation/Rust/Projets/rust/library/std/src/panicking.rs:543:12
   1: scoped_tls::ScopedKey&lt;T&gt;::with
             at /home/bouanto/.cargo/registry/src/github.com-1ecc6299db9ec823/scoped-tls-1.0.0/src/lib.rs:168:9
   2: rustc_span::with_session_globals
             at /home/bouanto/Ordinateur/Programmation/Rust/Projets/rust/compiler/rustc_span/src/lib.rs:144:5
   3: rustc_span::symbol::with_interner
             at /home/bouanto/Ordinateur/Programmation/Rust/Projets/rust/compiler/rustc_span/src/symbol.rs:1838:5
   4: rustc_span::symbol::Symbol::as_str
             at /home/bouanto/Ordinateur/Programmation/Rust/Projets/rust/compiler/rustc_span/src/symbol.rs:1594:9
   5: &lt;rustc_span::symbol::Symbol as core::fmt::Display&gt;::fmt
             at /home/bouanto/Ordinateur/Programmation/Rust/Projets/rust/compiler/rustc_span/src/symbol.rs:1628:28
   6: core::fmt::run
             at /home/bouanto/Ordinateur/Programmation/Rust/Projets/rust/library/core/src/fmt/mod.rs:1162:5
   7: core::fmt::write
             at /home/bouanto/Ordinateur/Programmation/Rust/Projets/rust/library/core/src/fmt/mod.rs:1130:26
   8: core::fmt::Write::write_fmt
             at /home/bouanto/Ordinateur/Programmation/Rust/Projets/rust/library/core/src/fmt/mod.rs:187:9
   9: alloc::fmt::format
             at /home/bouanto/Ordinateur/Programmation/Rust/Projets/rust/library/alloc/src/fmt.rs:583:5
  10: rustc_middle::mir::mono::CodegenUnitNameBuilder::build_cgu_name_no_mangle::{{closure}}
             at /home/bouanto/Ordinateur/Programmation/Rust/Projets/rust/compiler/rustc_middle/src/mir/mono.rs:504:13
  11: std::collections::hash::map::Entry&lt;K,V&gt;::or_insert_with
             at /home/bouanto/Ordinateur/Programmation/Rust/Projets/rust/library/std/src/collections/hash/map.rs:2336:43
  12: rustc_middle::mir::mono::CodegenUnitNameBuilder::build_cgu_name_no_mangle
             at /home/bouanto/Ordinateur/Programmation/Rust/Projets/rust/compiler/rustc_middle/src/mir/mono.rs:488:28
  13: rustc_middle::mir::mono::CodegenUnitNameBuilder::build_cgu_name
             at /home/bouanto/Ordinateur/Programmation/Rust/Projets/rust/compiler/rustc_middle/src/mir/mono.rs:460:24
  14: rustc_codegen_ssa::base::codegen_crate
             at /home/bouanto/Ordinateur/Programmation/Rust/Projets/rust/compiler/rustc_codegen_ssa/src/base.rs:569:13
  15: &lt;rustc_codegen_gcc::GccCodegenBackend as rustc_codegen_ssa::traits::backend::CodegenBackend&gt;::codegen_crate
             at ./src/lib.rs:97:19
  16: rustc_interface::passes::start_codegen::{{closure}}
             at /home/bouanto/Ordinateur/Programmation/Rust/Projets/rust/compiler/rustc_interface/src/passes.rs:1056:9
  17: rustc_data_structures::profiling::VerboseTimingGuard::run
             at /home/bouanto/Ordinateur/Programmation/Rust/Projets/rust/compiler/rustc_data_structures/src/profiling.rs:611:9
  18: rustc_session::utils::&lt;impl rustc_session::session::Session&gt;::time
             at /home/bouanto/Ordinateur/Programmation/Rust/Projets/rust/compiler/rustc_session/src/utils.rs:16:9
  19: rustc_interface::passes::start_codegen
             at /home/bouanto/Ordinateur/Programmation/Rust/Projets/rust/compiler/rustc_interface/src/passes.rs:1055:19
  20: rustc_interface::queries::Queries::ongoing_codegen::{{closure}}::{{closure}}
             at /home/bouanto/Ordinateur/Programmation/Rust/Projets/rust/compiler/rustc_interface/src/queries.rs:254:20
  21: rustc_interface::passes::QueryContext::enter::{{closure}}
             at /home/bouanto/Ordinateur/Programmation/Rust/Projets/rust/compiler/rustc_interface/src/passes.rs:780:42
  22: rustc_middle::ty::context::tls::enter_context::{{closure}}
             at /home/bouanto/Ordinateur/Programmation/Rust/Projets/rust/compiler/rustc_middle/src/ty/context.rs:1784:50
  23: rustc_middle::ty::context::tls::set_tlv
             at /home/bouanto/Ordinateur/Programmation/Rust/Projets/rust/compiler/rustc_middle/src/ty/context.rs:1768:9
  24: rustc_middle::ty::context::tls::enter_context
             at /home/bouanto/Ordinateur/Programmation/Rust/Projets/rust/compiler/rustc_middle/src/ty/context.rs:1784:9
  25: rustc_interface::passes::QueryContext::enter
             at /home/bouanto/Ordinateur/Programmation/Rust/Projets/rust/compiler/rustc_interface/src/passes.rs:780:9
  26: rustc_interface::queries::Queries::ongoing_codegen::{{closure}}
             at /home/bouanto/Ordinateur/Programmation/Rust/Projets/rust/compiler/rustc_interface/src/queries.rs:245:13
  27: rustc_interface::queries::Query&lt;T&gt;::compute
             at /home/bouanto/Ordinateur/Programmation/Rust/Projets/rust/compiler/rustc_interface/src/queries.rs:38:28
  28: rustc_interface::queries::Queries::ongoing_codegen
             at /home/bouanto/Ordinateur/Programmation/Rust/Projets/rust/compiler/rustc_interface/src/queries.rs:243:9
  29: rustc_driver::run_compiler::{{closure}}::{{closure}}
             at /home/bouanto/Ordinateur/Programmation/Rust/Projets/rust/compiler/rustc_driver/src/lib.rs:407:13
  30: rustc_interface::queries::&lt;impl rustc_interface::interface::Compiler&gt;::enter
             at /home/bouanto/Ordinateur/Programmation/Rust/Projets/rust/compiler/rustc_interface/src/queries.rs:390:19
  31: rustc_driver::run_compiler::{{closure}}
             at /home/bouanto/Ordinateur/Programmation/Rust/Projets/rust/compiler/rustc_driver/src/lib.rs:312:22
  32: rustc_interface::interface::create_compiler_and_run::{{closure}}
             at /home/bouanto/Ordinateur/Programmation/Rust/Projets/rust/compiler/rustc_interface/src/interface.rs:209:13
  33: rustc_span::with_source_map
             at /home/bouanto/Ordinateur/Programmation/Rust/Projets/rust/compiler/rustc_span/src/lib.rs:911:5
  34: rustc_interface::interface::create_compiler_and_run
             at /home/bouanto/Ordinateur/Programmation/Rust/Projets/rust/compiler/rustc_interface/src/interface.rs:203:5
  35: rustc_interface::interface::run_compiler::{{closure}}
             at /home/bouanto/Ordinateur/Programmation/Rust/Projets/rust/compiler/rustc_interface/src/interface.rs:225:12
  36: rustc_interface::util::setup_callbacks_and_run_in_thread_pool_with_globals::{{closure}}::{{closure}}
             at /home/bouanto/Ordinateur/Programmation/Rust/Projets/rust/compiler/rustc_interface/src/util.rs:157:13
  37: scoped_tls::ScopedKey&lt;T&gt;::set
             at /home/bouanto/.cargo/registry/src/github.com-1ecc6299db9ec823/scoped-tls-1.0.0/src/lib.rs:137:9
  38: rustc_span::create_session_globals_then
             at /home/bouanto/Ordinateur/Programmation/Rust/Projets/rust/compiler/rustc_span/src/lib.rs:105:5
  39: rustc_interface::util::setup_callbacks_and_run_in_thread_pool_with_globals::{{closure}}
             at /home/bouanto/Ordinateur/Programmation/Rust/Projets/rust/compiler/rustc_interface/src/util.rs:155:9
  40: rustc_interface::util::scoped_thread::{{closure}}
             at /home/bouanto/Ordinateur/Programmation/Rust/Projets/rust/compiler/rustc_interface/src/util.rs:130:24
</code></pre></div>



<a name="250401495"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/How%20to%20load%20codegen%20backend%20when%20custom-built%20rustc/near/250401495" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/How.20to.20load.20codegen.20backend.20when.20custom-built.20rustc.html#250401495">(Aug 23 2021 at 19:42)</a>:</h4>
<p>hmm, that's weird, the globals should be set in that very first frame:</p>
<blockquote>
<p>39: rustc_interface::util::setup_callbacks_and_run_in_thread_pool_with_globals::{{closure}}</p>
</blockquote>



<a name="250401500"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/How%20to%20load%20codegen%20backend%20when%20custom-built%20rustc/near/250401500" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/How.20to.20load.20codegen.20backend.20when.20custom-built.20rustc.html#250401500">(Aug 23 2021 at 19:42)</a>:</h4>
<p>not sure, sorry</p>



<a name="250401644"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/How%20to%20load%20codegen%20backend%20when%20custom-built%20rustc/near/250401644" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/How.20to.20load.20codegen.20backend.20when.20custom-built.20rustc.html#250401644">(Aug 23 2021 at 19:43)</a>:</h4>
<p>did you compile cg_gcc using the debug mode rustc? of not it is linked to the rustc_driver from your nightly, which means it is abi incompatible.</p>



<a name="250402278"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/How%20to%20load%20codegen%20backend%20when%20custom-built%20rustc/near/250402278" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> antoyo <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/How.20to.20load.20codegen.20backend.20when.20custom-built.20rustc.html#250402278">(Aug 23 2021 at 19:49)</a>:</h4>
<p>Yes, I did. Otherwise, it would probably be linked to a different librustc_driver and would not find it. (Though, I'm still surprised I have to set LD_LIBRARY_PATH.) Is there a way to check that for sure? Running <code>rustc -Vv</code> with the rust-toolchain containing <code>debug-current</code> and the nightly both give the same output. Is this normal?</p>



<a name="250402452"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/How%20to%20load%20codegen%20backend%20when%20custom-built%20rustc/near/250402452" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/How.20to.20load.20codegen.20backend.20when.20custom-built.20rustc.html#250402452">(Aug 23 2021 at 19:50)</a>:</h4>
<p>rustc -vV for a locally built rustc should report -dev instead of -nightly.</p>



<a name="250402471"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/How%20to%20load%20codegen%20backend%20when%20custom-built%20rustc/near/250402471" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/How.20to.20load.20codegen.20backend.20when.20custom-built.20rustc.html#250402471">(Aug 23 2021 at 19:50)</a>:</h4>
<p>what does <code>rustup show</code> say?</p>



<a name="250402915"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/How%20to%20load%20codegen%20backend%20when%20custom-built%20rustc/near/250402915" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> antoyo <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/How.20to.20load.20codegen.20backend.20when.20custom-built.20rustc.html#250402915">(Aug 23 2021 at 19:55)</a>:</h4>
<p>I compiled with <code>channel = "nightly"</code>, so there's no <code>-dev</code>. I can't remember why I did this, but I did this when I was trying to make it work the previous time. Should I set it back to <code>dev</code>?</p>
<p>The result of this command is (<strong>edit:</strong> I posted the wrong output the first time, so here is the good one):</p>
<div class="codehilite"><pre><span></span><code>Default host: x86_64-unknown-linux-gnu
rustup home:  /home/bouanto/.rustup

installed toolchains
--------------------

stable-x86_64-unknown-linux-gnu
nightly-2021-05-18-x86_64-unknown-linux-gnu
nightly-2021-06-08-x86_64-unknown-linux-gnu
nightly-2021-06-14-x86_64-unknown-linux-gnu
nightly-2021-06-17-x86_64-unknown-linux-gnu
nightly-2021-06-30-x86_64-unknown-linux-gnu
nightly-2021-07-21-x86_64-unknown-linux-gnu
nightly-2021-08-12-x86_64-unknown-linux-gnu
nightly-x86_64-unknown-linux-gnu (default)
debug-current

active toolchain
----------------

debug-current (overridden by &#39;/home/bouanto/Ordinateur/Programmation/Rust/Projets/rustc_codegen_gccjit/rust-toolchain&#39;)
(rustc does not exist)
</code></pre></div>



<a name="250406062"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/How%20to%20load%20codegen%20backend%20when%20custom-built%20rustc/near/250406062" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> antoyo <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/How.20to.20load.20codegen.20backend.20when.20custom-built.20rustc.html#250406062">(Aug 23 2021 at 20:20)</a>:</h4>
<p>I tried with <code>channel = "dev"</code> and I get the same problem.</p>



<a name="250470967"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/How%20to%20load%20codegen%20backend%20when%20custom-built%20rustc/near/250470967" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/How.20to.20load.20codegen.20backend.20when.20custom-built.20rustc.html#250470967">(Aug 24 2021 at 11:28)</a>:</h4>
<blockquote>
<p>(rustc does not exist)</p>
</blockquote>
<p>Which path did you link the debug-current toolchain to?</p>



<a name="250535429"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/How%20to%20load%20codegen%20backend%20when%20custom-built%20rustc/near/250535429" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> antoyo <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/How.20to.20load.20codegen.20backend.20when.20custom-built.20rustc.html#250535429">(Aug 24 2021 at 19:24)</a>:</h4>
<p>I created the link with <code>rustup toolchain link debug-current build/x86_64-unknown-linux-gnu/stage1</code>.</p>



<a name="250535919"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/How%20to%20load%20codegen%20backend%20when%20custom-built%20rustc/near/250535919" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/How.20to.20load.20codegen.20backend.20when.20custom-built.20rustc.html#250535919">(Aug 24 2021 at 19:28)</a>:</h4>
<p>that should be fine.</p>



<a name="250536039"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/How%20to%20load%20codegen%20backend%20when%20custom-built%20rustc/near/250536039" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/How.20to.20load.20codegen.20backend.20when.20custom-built.20rustc.html#250536039">(Aug 24 2021 at 19:29)</a>:</h4>
<p>can you look at which rustc_driver file is required by rustc and <a href="http://cg_gcc.so">cg_gcc.so</a>?</p>



<a name="250536319"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/How%20to%20load%20codegen%20backend%20when%20custom-built%20rustc/near/250536319" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/How.20to.20load.20codegen.20backend.20when.20custom-built.20rustc.html#250536319">(Aug 24 2021 at 19:31)</a>:</h4>
<p><code>readelf -d</code> shows NEEDED entries. one for each shared library dependency.</p>



<a name="250609974"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/How%20to%20load%20codegen%20backend%20when%20custom-built%20rustc/near/250609974" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> antoyo <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/How.20to.20load.20codegen.20backend.20when.20custom-built.20rustc.html#250609974">(Aug 25 2021 at 12:03)</a>:</h4>
<p>This command returns:</p>
<div class="codehilite"><pre><span></span><code>  Étiquettes Type                         Nom/Valeur
 0x0000000000000001 (NEEDED)             Bibliothèque partagée: [librustc_driver-e5d2002997a86d0d.so]
 0x0000000000000001 (NEEDED)             Bibliothèque partagée: [libstd-22d5f57fa309c135.so]
 0x0000000000000001 (NEEDED)             Bibliothèque partagée: [libgccjit.so.0]
 0x0000000000000001 (NEEDED)             Bibliothèque partagée: [libc.so.6]
 0x0000000000000001 (NEEDED)             Bibliothèque partagée: [ld-linux-x86-64.so.2]
 0x0000000000000001 (NEEDED)             Bibliothèque partagée: [libgcc_s.so.1]
 0x000000000000000c (INIT)               0x391000
 0x000000000000000d (FINI)               0x732f08
 0x0000000000000019 (INIT_ARRAY)         0x822448
 0x000000000000001b (INIT_ARRAYSZ)       8 (octets)
 0x000000000000001a (FINI_ARRAY)         0x822450
 0x000000000000001c (FINI_ARRAYSZ)       8 (octets)
 0x0000000000000004 (HASH)               0x200
 0x000000006ffffef5 (GNU_HASH)           0x26280
 0x0000000000000005 (STRTAB)             0xd3578
 0x0000000000000006 (SYMTAB)             0x4f548
 0x000000000000000a (STRSZ)              2227061 (octets)
 0x000000000000000b (SYMENT)             24 (octets)
 0x0000000000000003 (PLTGOT)             0x82f568
 0x0000000000000002 (PLTRELSZ)           72 (octets)
 0x0000000000000014 (PLTREL)             RELA
 0x0000000000000017 (JMPREL)             0x390340
 0x0000000000000007 (RELA)               0x2fe258
 0x0000000000000008 (RELASZ)             598248 (octets)
 0x0000000000000009 (RELAENT)            24 (octets)
 0x0000000000000018 (BIND_NOW)
 0x000000006ffffffb (FLAGS_1)            Fanions: NOW
 0x000000006ffffffe (VERNEED)            0x2fe0f8
 0x000000006fffffff (VERNEEDNUM)         4
 0x000000006ffffff0 (VERSYM)             0x2f30ee
 0x000000006ffffff9 (RELACOUNT)          2368
 0x0000000000000000 (NULL)               0x0
</code></pre></div>
<p>The hash changed because I compiled it with a different rustc when I changed the config, but this is the same hash I get in the error message.</p>



<a name="250610586"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/How%20to%20load%20codegen%20backend%20when%20custom-built%20rustc/near/250610586" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/How.20to.20load.20codegen.20backend.20when.20custom-built.20rustc.html#250610586">(Aug 25 2021 at 12:08)</a>:</h4>
<p>is this for rustc or cg_gcc?</p>



<a name="250610606"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/How%20to%20load%20codegen%20backend%20when%20custom-built%20rustc/near/250610606" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/How.20to.20load.20codegen.20backend.20when.20custom-built.20rustc.html#250610606">(Aug 25 2021 at 12:08)</a>:</h4>
<p>i see it is for cg_gcc</p>



<a name="250610613"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/How%20to%20load%20codegen%20backend%20when%20custom-built%20rustc/near/250610613" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/How.20to.20load.20codegen.20backend.20when.20custom-built.20rustc.html#250610613">(Aug 25 2021 at 12:08)</a>:</h4>
<p>what is it for rustc?</p>



<a name="250611055"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/How%20to%20load%20codegen%20backend%20when%20custom-built%20rustc/near/250611055" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> antoyo <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/How.20to.20load.20codegen.20backend.20when.20custom-built.20rustc.html#250611055">(Aug 25 2021 at 12:13)</a>:</h4>
<p>Yes, it is for <code>cg_gcc</code>.<br>
For rustc, it is:</p>
<div class="codehilite"><pre><span></span><code>$ readelf -d (which ~/.rustup/toolchains/debug-current/bin/rustc)

La section dynamique à l&#39;offset 0x2dc8 contient 26 entrées :
  Étiquettes Type                         Nom/Valeur
 0x0000000000000001 (NEEDED)             Bibliothèque partagée: [librustc_driver-8f66983fa0148029.so]
 0x0000000000000001 (NEEDED)             Bibliothèque partagée: [libstd-8e2976c77ad7560d.so]
 0x0000000000000001 (NEEDED)             Bibliothèque partagée: [libc.so.6]
 0x000000000000000f (RPATH)              Bibliothèque rpath: [$ORIGIN/../lib]
 0x000000000000000c (INIT)               0x1000
 0x000000000000000d (FINI)               0x1218
 0x0000000000000019 (INIT_ARRAY)         0x3d88
 0x000000000000001b (INIT_ARRAYSZ)       8 (octets)
 0x000000000000001a (FINI_ARRAY)         0x3d90
 0x000000000000001c (FINI_ARRAYSZ)       8 (octets)
 0x000000006ffffef5 (GNU_HASH)           0x3a0
 0x0000000000000005 (STRTAB)             0x498
 0x0000000000000006 (SYMTAB)             0x3c0
 0x000000000000000a (STRSZ)              357 (octets)
 0x000000000000000b (SYMENT)             24 (octets)
 0x0000000000000015 (DEBUG)              0x0
 0x0000000000000007 (RELA)               0x630
 0x0000000000000008 (RELASZ)             360 (octets)
 0x0000000000000009 (RELAENT)            24 (octets)
 0x0000000000000018 (BIND_NOW)
 0x000000006ffffffb (FLAGS_1)            Fanions: NOW PIE
 0x000000006ffffffe (VERNEED)            0x610
 0x000000006fffffff (VERNEEDNUM)         1
 0x000000006ffffff0 (VERSYM)             0x5fe
 0x000000006ffffff9 (RELACOUNT)          7
 0x0000000000000000 (NULL)               0x0
</code></pre></div>
<p>Seems like it has a different hash.</p>
<p>I'm guessing this is the issue. What could make it link to a different librustc_driver?</p>



<a name="250611816"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/How%20to%20load%20codegen%20backend%20when%20custom-built%20rustc/near/250611816" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/How.20to.20load.20codegen.20backend.20when.20custom-built.20rustc.html#250611816">(Aug 25 2021 at 12:22)</a>:</h4>
<p>in build/x86_64-unknown-linux-gnu/stage1/lib/rustlib/x86_64-unknown-linux-gnu which hash does rustc_driver have?</p>



<a name="250612226"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/How%20to%20load%20codegen%20backend%20when%20custom-built%20rustc/near/250612226" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> antoyo <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/How.20to.20load.20codegen.20backend.20when.20custom-built.20rustc.html#250612226">(Aug 25 2021 at 12:26)</a>:</h4>
<p><code>librustc_driver-e5d2002997a86d0d.so</code></p>



<a name="250612700"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/How%20to%20load%20codegen%20backend%20when%20custom-built%20rustc/near/250612700" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/How.20to.20load.20codegen.20backend.20when.20custom-built.20rustc.html#250612700">(Aug 25 2021 at 12:31)</a>:</h4>
<p>Then that is the problem. I think you need to use a stage2 compiler to be able to compile things using rustc to be linked against the same rustc.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>