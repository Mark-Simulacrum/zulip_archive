<html>
<head><meta charset="utf-8"><title>Creating child obligation · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Creating.20child.20obligation.html">Creating child obligation</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="277703749"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Creating%20child%20obligation/near/277703749" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yutaro Ohno <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Creating.20child.20obligation.html#277703749">(Apr 04 2022 at 09:17)</a>:</h4>
<p><span class="user-mention" data-user-id="426609">@Michael Goulet (compiler-errors)</span> <br>
Thank you for the review! That really helps me.</p>
<p>But I'm getting a bit confusing. Can you let me know about the <code>substs</code> part of your comment? (<a href="https://github.com/rust-lang/rust/pull/95525#discussion_r841285530">https://github.com/rust-lang/rust/pull/95525#discussion_r841285530</a>)</p>
<hr>
<p>What I understand for now is that I have to create a new TraitRef with substs like <code>[String, String]</code> (not <code>[String, Foo]</code>) for PartialEq and PartialOrd.</p>
<p>So, do you mean like the following code?</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">field_ty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">field</span><span class="p">.</span><span class="n">ty</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">tcx</span><span class="p">,</span><span class="w"> </span><span class="n">substs</span><span class="p">);</span><span class="w"> </span><span class="c1">// This `substs` is from `ty::Adt(_, substs)`.</span>
<span class="kd">let</span><span class="w"> </span><span class="n">substs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="n">diagnostic_name</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">sym</span>::<span class="nb">PartialEq</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">sym</span>::<span class="nb">PartialOrd</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="n">tcx</span><span class="p">.</span><span class="n">mk_substs_trait</span><span class="p">(</span><span class="n">field_ty</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="n">field_ty</span><span class="p">.</span><span class="n">into</span><span class="p">()])</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">tcx</span><span class="p">.</span><span class="n">mk_substs_trait</span><span class="p">(</span><span class="n">field_ty</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[]),</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">new_trait</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ty</span>::<span class="n">TraitRef</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">substs</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="o">..</span><span class="n">trait_pred</span><span class="p">.</span><span class="n">skip_binder</span><span class="p">().</span><span class="n">trait_ref</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>

<span class="c1">// Create a new child obligation from the new_trait.</span>
<span class="o">..</span><span class="p">.</span><span class="w"></span>
</code></pre></div>



<a name="277708659"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Creating%20child%20obligation/near/277708659" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Goulet (compiler-errors) <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Creating.20child.20obligation.html#277708659">(Apr 04 2022 at 10:04)</a>:</h4>
<p>Yeah, I think that’s correct. Does that code work?</p>



<a name="277715257"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Creating%20child%20obligation/near/277715257" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yutaro Ohno <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Creating.20child.20obligation.html#277715257">(Apr 04 2022 at 11:13)</a>:</h4>
<p>Yes, this is working for now. I'll change my PR this way.<br>
Thanks!</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>