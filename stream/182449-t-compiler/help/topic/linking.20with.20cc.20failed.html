<html>
<head><meta charset="utf-8"><title>linking with cc failed · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/linking.20with.20cc.20failed.html">linking with cc failed</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="267328433"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/linking%20with%20cc%20failed/near/267328433" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/linking.20with.20cc.20failed.html#267328433">(Jan 09 2022 at 01:48)</a>:</h4>
<p>Okay, any idea why I might be getting this error when building rustc? <a href="https://gist.github.com/jackh726/63cc23aeaf66785f73f1cada39a0d2bc">https://gist.github.com/jackh726/63cc23aeaf66785f73f1cada39a0d2bc</a></p>
<p>This doesn't happen every build. But it does happen fairly frequently. Doing <code>./x.py clean</code> fixes it (but of course I have to rebuild everything)</p>



<a name="267328478"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/linking%20with%20cc%20failed/near/267328478" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/linking.20with.20cc.20failed.html#267328478">(Jan 09 2022 at 01:48)</a>:</h4>
<p>If it matters, I'm using WSL2</p>



<a name="267328803"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/linking%20with%20cc%20failed/near/267328803" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/linking.20with.20cc.20failed.html#267328803">(Jan 09 2022 at 01:53)</a>:</h4>
<p>Could this be <a href="https://github.com/rust-lang/rust/issues/43587">#43587</a></p>



<a name="267328906"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/linking%20with%20cc%20failed/near/267328906" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/linking.20with.20cc.20failed.html#267328906">(Jan 09 2022 at 01:55)</a>:</h4>
<p>Adding a data point: I've never encountered this, though I'm on macOS.</p>



<a name="267329061"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/linking%20with%20cc%20failed/near/267329061" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/linking.20with.20cc.20failed.html#267329061">(Jan 09 2022 at 01:59)</a>:</h4>
<p>It's honestly getting pretty annoying; I can usually tolerate it. I've literally had to clean and rebuild like 4 times tonight</p>



<a name="267329187"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/linking%20with%20cc%20failed/near/267329187" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/linking.20with.20cc.20failed.html#267329187">(Jan 09 2022 at 02:00)</a>:</h4>
<p>Hmm, sounds like something in rust-lang/rust or something in your system changed then</p>



<a name="267329296"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/linking%20with%20cc%20failed/near/267329296" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/linking.20with.20cc.20failed.html#267329296">(Jan 09 2022 at 02:02)</a>:</h4>
<p>I see some stuff in the error about relocations; maybe something changed with that?</p>



<a name="267329304"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/linking%20with%20cc%20failed/near/267329304" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/linking.20with.20cc.20failed.html#267329304">(Jan 09 2022 at 02:02)</a>:</h4>
<p>Ah, I wonder if it could be <a href="https://github.com/rust-lang/rust/issues/92153">#92153</a> (because your error also mentions <code>extern</code> blocks)?</p>



<a name="267329331"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/linking%20with%20cc%20failed/near/267329331" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/linking.20with.20cc.20failed.html#267329331">(Jan 09 2022 at 02:03)</a>:</h4>
<p>I mean, this has been happening for a while now - months.</p>



<a name="267329370"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/linking%20with%20cc%20failed/near/267329370" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/linking.20with.20cc.20failed.html#267329370">(Jan 09 2022 at 02:04)</a>:</h4>
<p>It's just particularly bad tonight, for whatever reason.</p>



<a name="267329377"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/linking%20with%20cc%20failed/near/267329377" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/linking.20with.20cc.20failed.html#267329377">(Jan 09 2022 at 02:04)</a>:</h4>
<p>Hmm, weird</p>



<a name="267329380"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/linking%20with%20cc%20failed/near/267329380" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/linking.20with.20cc.20failed.html#267329380">(Jan 09 2022 at 02:04)</a>:</h4>
<p>Yeah, I have no clue <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span></p>



<a name="267329433"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/linking%20with%20cc%20failed/near/267329433" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/linking.20with.20cc.20failed.html#267329433">(Jan 09 2022 at 02:05)</a>:</h4>
<p>Thanks anyways <span aria-label="hearts" class="emoji emoji-2665" role="img" title="hearts">:hearts:</span></p>



<a name="267330969"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/linking%20with%20cc%20failed/near/267330969" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/linking.20with.20cc.20failed.html#267330969">(Jan 09 2022 at 02:41)</a>:</h4>
<p><span class="user-mention" data-user-id="232957">@Jack Huey</span> Are you maybe using check-on-save or any sort of editor integration that might cause frequent interrupts of the build process?</p>
<p>I've seen lots of issues opened for this problem, but I don't think anyone has found a specific cause.</p>



<a name="267331411"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/linking%20with%20cc%20failed/near/267331411" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/linking.20with.20cc.20failed.html#267331411">(Jan 09 2022 at 02:51)</a>:</h4>
<p>I'm using rust-analyzer, but I have check-on-save disabled</p>



<a name="267332809"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/linking%20with%20cc%20failed/near/267332809" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/linking.20with.20cc.20failed.html#267332809">(Jan 09 2022 at 03:25)</a>:</h4>
<p>I also get a maybe related error sometimes: <a href="https://gist.github.com/jackh726/f4531e1d387ecd7ce86467d18b9aa209">https://gist.github.com/jackh726/f4531e1d387ecd7ce86467d18b9aa209</a></p>



<a name="267332820"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/linking%20with%20cc%20failed/near/267332820" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/linking.20with.20cc.20failed.html#267332820">(Jan 09 2022 at 03:25)</a>:</h4>
<p>This just stops the build process</p>



<a name="267332858"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/linking%20with%20cc%20failed/near/267332858" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/linking.20with.20cc.20failed.html#267332858">(Jan 09 2022 at 03:26)</a>:</h4>
<p>but doesn't require a clean to continue</p>



<a name="267481654"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/linking%20with%20cc%20failed/near/267481654" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/linking.20with.20cc.20failed.html#267481654">(Jan 10 2022 at 18:43)</a>:</h4>
<p>Would you look at that!</p>
<div class="codehilite"><pre><span></span><code>error: linking with `cc` failed: exit status: 1
[...]
          ld: symbol(s) not found for architecture arm64
          clang: error: linker command failed with exit code 1 (use -v to see invocation)
error: could not compile `rustc_driver` due to previous error
Build completed unsuccessfully in 0:00:07
</code></pre></div>



<a name="267481943"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/linking%20with%20cc%20failed/near/267481943" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/linking.20with.20cc.20failed.html#267481943">(Jan 10 2022 at 18:45)</a>:</h4>
<p>Maybe I spoke too soon before ;)</p>



<a name="267485335"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/linking%20with%20cc%20failed/near/267485335" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/linking.20with.20cc.20failed.html#267485335">(Jan 10 2022 at 19:10)</a>:</h4>
<p>I've gotten those repeatedly as well</p>



<a name="267485353"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/linking%20with%20cc%20failed/near/267485353" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/linking.20with.20cc.20failed.html#267485353">(Jan 10 2022 at 19:10)</a>:</h4>
<p>It's some kind of incremental compilation problem</p>



<a name="267485381"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/linking%20with%20cc%20failed/near/267485381" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/linking.20with.20cc.20failed.html#267485381">(Jan 10 2022 at 19:10)</a>:</h4>
<p>However, I've never managed to reproduce it by replaying my commit history</p>



<a name="267485403"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/linking%20with%20cc%20failed/near/267485403" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/linking.20with.20cc.20failed.html#267485403">(Jan 10 2022 at 19:11)</a>:</h4>
<p>I suspect that there's some kind of non-dererminism in llvm</p>



<a name="267485441"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/linking%20with%20cc%20failed/near/267485441" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/linking.20with.20cc.20failed.html#267485441">(Jan 10 2022 at 19:11)</a>:</h4>
<p>or we're not tracking some information properly when determining post-lto cgu reuse</p>



<a name="267486089"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/linking%20with%20cc%20failed/near/267486089" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/linking.20with.20cc.20failed.html#267486089">(Jan 10 2022 at 19:16)</a>:</h4>
<p>Yeah, <code>x clean</code> fixes it (thankfully!)</p>



<a name="267487420"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/linking%20with%20cc%20failed/near/267487420" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/linking.20with.20cc.20failed.html#267487420">(Jan 10 2022 at 19:25)</a>:</h4>
<p>For a while, I've been hoping that this will just disappear as I make more fixes to the incr comp system</p>



<a name="267487479"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/linking%20with%20cc%20failed/near/267487479" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/linking.20with.20cc.20failed.html#267487479">(Jan 10 2022 at 19:26)</a>:</h4>
<p>However, that's starting to seem increasingly unlikely</p>



<a name="267487544"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/linking%20with%20cc%20failed/near/267487544" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/linking.20with.20cc.20failed.html#267487544">(Jan 10 2022 at 19:26)</a>:</h4>
<p>at least after my latest round of incr comp PRs is merged, we'll have a better idea of what's <em>not</em> causing this</p>



<a name="268476499"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/linking%20with%20cc%20failed/near/268476499" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/linking.20with.20cc.20failed.html#268476499">(Jan 19 2022 at 00:28)</a>:</h4>
<p>FWIW, just ran into this again</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>