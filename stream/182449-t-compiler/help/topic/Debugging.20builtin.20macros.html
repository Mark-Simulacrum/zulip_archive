<html>
<head><meta charset="utf-8"><title>Debugging builtin macros · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Debugging.20builtin.20macros.html">Debugging builtin macros</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="254741430"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Debugging%20builtin%20macros/near/254741430" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Audun Halland <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Debugging.20builtin.20macros.html#254741430">(Sep 24 2021 at 17:27)</a>:</h4>
<p>Hi all, I'm trying to debug what's happening in my own bug report,  <a href="https://github.com/rust-lang/rust/issues/89188">#89188</a>. I suspect there's a problem with the <code>derive</code> macro, so what I want to do is to look at the code it actually expands to. The <code>ast</code> debugging options I've found are <code>-Z ast-json=yes</code> and <code>-Z unpretty=ast-tree,expanded</code>. Both these outputs are very verbose. Is there anything I can do to serialize any of these formats back into source code?</p>



<a name="254742086"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Debugging%20builtin%20macros/near/254742086" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Debugging.20builtin.20macros.html#254742086">(Sep 24 2021 at 17:31)</a>:</h4>
<p><span class="user-mention" data-user-id="294358">@Audun Halland</span> Have you tried <code>cargo expand</code>?</p>



<a name="254742354"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Debugging%20builtin%20macros/near/254742354" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Audun Halland <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Debugging.20builtin.20macros.html#254742354">(Sep 24 2021 at 17:33)</a>:</h4>
<p>Hmm, I've heard about it.. Somehow I assumed it was for "user-space" macros.. If it works for builtins as well, then perfect. Thanks for the tip, I'll try it out :)</p>



<a name="254743102"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Debugging%20builtin%20macros/near/254743102" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Audun Halland <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Debugging.20builtin.20macros.html#254743102">(Sep 24 2021 at 17:38)</a>:</h4>
<p><code>cargo expand</code> (on recent nightly) gives <code>error: Unrecognized option: 'pretty'</code> <span aria-label="oh no" class="emoji emoji-1f615" role="img" title="oh no">:oh_no:</span></p>



<a name="254743233"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Debugging%20builtin%20macros/near/254743233" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Debugging.20builtin.20macros.html#254743233">(Sep 24 2021 at 17:39)</a>:</h4>
<p>Which version of <code>cargo expand</code> are you using and which nightly?</p>



<a name="254743283"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Debugging%20builtin%20macros/near/254743283" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Audun Halland <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Debugging.20builtin.20macros.html#254743283">(Sep 24 2021 at 17:39)</a>:</h4>
<p>answering my own question, yes, it's probably way outdated..</p>



<a name="254743344"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Debugging%20builtin%20macros/near/254743344" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Giacomo Stevanato <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Debugging.20builtin.20macros.html#254743344">(Sep 24 2021 at 17:40)</a>:</h4>
<p>You can use cargo expand on the playground</p>



<a name="254743406"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Debugging%20builtin%20macros/near/254743406" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Audun Halland <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Debugging.20builtin.20macros.html#254743406">(Sep 24 2021 at 17:40)</a>:</h4>
<p>I updated it, now it's working <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span></p>



<a name="254743514"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Debugging%20builtin%20macros/near/254743514" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Giacomo Stevanato <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Debugging.20builtin.20macros.html#254743514">(Sep 24 2021 at 17:41)</a>:</h4>
<p>Anyway, looks like the reason is that the macro tries to bound the <code>T::Shim&lt;'s&gt;</code> by <code>Clone</code>, however this introduces an unused <code>'s</code> parameter. It should probably be <code>for&lt;'s&gt; T::Shim&lt;'s&gt;: Clone</code></p>



<a name="254743778"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/Debugging%20builtin%20macros/near/254743778" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Audun Halland <a href="https://zulip-archive.rust-lang.org/stream/182449-t-compiler/help/topic/Debugging.20builtin.20macros.html#254743778">(Sep 24 2021 at 17:43)</a>:</h4>
<p>yes, exactly, that fixes it</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>