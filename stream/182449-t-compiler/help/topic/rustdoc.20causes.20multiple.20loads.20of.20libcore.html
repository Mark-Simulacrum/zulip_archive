<html>
<head><meta charset="utf-8"><title>rustdoc causes multiple loads of libcore · t-compiler/help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/index.html">t-compiler/help</a></h2>
<h3>Topic: <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html">rustdoc causes multiple loads of libcore</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://rust-lang.github.io/zulip_archive/style.css" rel="stylesheet"></head>

<a name="208414675"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208414675" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208414675">(Aug 29 2020 at 03:29)</a>:</h4>
<p>it explicitly doesn't do that because the pathkinds are different</p>



<a name="208414676"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208414676" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208414676">(Aug 29 2020 at 03:29)</a>:</h4>
<p>if it produces a different <code>CrateNum</code>, something is deeply broken</p>



<a name="208414682"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208414682" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208414682">(Aug 29 2020 at 03:29)</a>:</h4>
<p><span class="user-mention" data-user-id="232545">@Joshua Nelson</span> doesn't matter</p>



<a name="208414684"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208414684" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208414684">(Aug 29 2020 at 03:29)</a>:</h4>
<p>yeah, it has both cratenum 2 and 18</p>



<a name="208414690"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208414690" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208414690">(Aug 29 2020 at 03:29)</a>:</h4>
<p>if <code>std</code> depends on <code>alloc</code> and I go add <code>extern crate alloc;</code>, it doesn't duplicate <code>alloc</code></p>



<a name="208414736"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208414736" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208414736">(Aug 29 2020 at 03:30)</a>:</h4>
<p>none of the types would match with <code>std</code> reexports, for example</p>



<a name="208414739"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208414739" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208414739">(Aug 29 2020 at 03:30)</a>:</h4>
<p><span class="user-mention" data-user-id="232545">@Joshua Nelson</span> what are the <code>rlib</code> paths?</p>



<a name="208414740"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208414740" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208414740">(Aug 29 2020 at 03:30)</a>:</h4>
<p>makes sense</p>



<a name="208414742"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208414742" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208414742">(Aug 29 2020 at 03:30)</a>:</h4>
<p>maybe it loads a different file</p>



<a name="208414745"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208414745" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208414745">(Aug 29 2020 at 03:30)</a>:</h4>
<p><span class="user-mention silent" data-user-id="119009">eddyb</span> <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/Difference.20between.20.60PathKind.3A.3ADependency.60.20and.20.60Crate.60/near/208414739">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> what are the <code>rlib</code> paths?</p>
</blockquote>
<p>how would I find that out?</p>



<a name="208414748"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208414748" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208414748">(Aug 29 2020 at 03:31)</a>:</h4>
<p>debug logging? wherever you could see the <code>CrateNum</code>s should be close enough</p>



<a name="208414752"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208414752" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208414752">(Aug 29 2020 at 03:31)</a>:</h4>
<p>in fact it might even be an <code>info!</code></p>



<a name="208414756"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208414756" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208414756">(Aug 29 2020 at 03:31)</a>:</h4>
<p>this is the bit that doesn't load the existing CrateNum: <a href="https://github.com/rust-lang/rust/blob/d77eff21b97886a0829b784100846daf59df2f39/src/librustc_metadata/creader.rs#L274">https://github.com/rust-lang/rust/blob/d77eff21b97886a0829b784100846daf59df2f39/src/librustc_metadata/creader.rs#L274</a></p>



<a name="208414761"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208414761" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208414761">(Aug 29 2020 at 03:31)</a>:</h4>
<p><code>echo 'fn main() {}' | env RUSTC_LOG=rustc_metadata=info rustc -</code> works for me</p>



<a name="208414802"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208414802" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208414802">(Aug 29 2020 at 03:32)</a>:</h4>
<div class="codehilite"><pre><span></span><code>  name: core
  cnum: 2
  hash: 26a8010bdbcd676f
  reqd: Explicit
   rlib: /home/joshua/rustc/build/x86_64-unknown-linux-gnu/stage1/lib/rustlib/x86_64-unknown-linux-gnu/lib/libcore-ceeab66e7ca607ac.rlib
  name: rustc_std_workspace_core
   rlib: /home/joshua/rustc/build/x86_64-unknown-linux-gnu/stage1/lib/rustlib/x86_64-unknown-linux-gnu/lib/librustc_std_workspace_core-b51f543946894ff4.rlib
</code></pre></div>



<a name="208414810"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208414810" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208414810">(Aug 29 2020 at 03:33)</a>:</h4>
<p>wait what that second one... isn't that second one a dummy dependency node?</p>



<a name="208414814"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208414814" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208414814">(Aug 29 2020 at 03:33)</a>:</h4>
<p>I just did <code>grep core</code>, not sure if it's relevant</p>



<a name="208414819"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208414819" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208414819">(Aug 29 2020 at 03:33)</a>:</h4>
<p>find the cnum: 18</p>



<a name="208414823"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208414823" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208414823">(Aug 29 2020 at 03:33)</a>:</h4>
<p>I don't know how</p>



<a name="208414825"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208414825" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208414825">(Aug 29 2020 at 03:33)</a>:</h4>
<p>I can't replicate this outside of libproc_macro</p>



<a name="208414826"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208414826" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208414826">(Aug 29 2020 at 03:33)</a>:</h4>
<p>how did you find <code>cnum: 2</code>?</p>



<a name="208414828"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208414828" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208414828">(Aug 29 2020 at 03:33)</a>:</h4>
<p>the command you gave, but that only prints out cnum up to 5</p>



<a name="208414867"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208414867" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208414867">(Aug 29 2020 at 03:34)</a>:</h4>
<p>(which is <code>alloc</code>)</p>



<a name="208414868"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208414868" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208414868">(Aug 29 2020 at 03:34)</a>:</h4>
<p>the command I gave is proof that it works</p>



<a name="208414872"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208414872" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208414872">(Aug 29 2020 at 03:34)</a>:</h4>
<p>the <code>RUSTC_LOG=...</code> part is the relevant one</p>



<a name="208414878"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208414878" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208414878">(Aug 29 2020 at 03:34)</a>:</h4>
<p>let me try adding that when documenting</p>



<a name="208414880"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208414880" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208414880">(Aug 29 2020 at 03:34)</a>:</h4>
<p>I'm just giving it a minimal Rust program to test it</p>



<a name="208414895"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208414895" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208414895">(Aug 29 2020 at 03:35)</a>:</h4>
<p>oh lol I added an explicit panic just before it prints that</p>



<a name="208414896"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208414896" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208414896">(Aug 29 2020 at 03:35)</a>:</h4>
<p>one sec, need to rebuild</p>



<a name="208414940"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208414940" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208414940">(Aug 29 2020 at 03:36)</a>:</h4>
<p>hah <a href="https://github.com/rust-lang/rust/tree/master/library/rustc-std-workspace-core">https://github.com/rust-lang/rust/tree/master/library/rustc-std-workspace-core</a></p>



<a name="208414945"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208414945" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208414945">(Aug 29 2020 at 03:36)</a>:</h4>
<p>I didn't realized it was a full reexport</p>



<a name="208414956"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208414956" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208414956">(Aug 29 2020 at 03:37)</a>:</h4>
<p>it doesn't print it O_o</p>



<a name="208414957"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208414957" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208414957">(Aug 29 2020 at 03:37)</a>:</h4>
<p>it goes exactly up to 17</p>



<a name="208414963"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208414963" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208414963">(Aug 29 2020 at 03:37)</a>:</h4>
<p>here this might be helpful though</p>
<div class="codehilite"><pre><span></span><code>2020-08-29T03:36:59.362904Z  INFO rustc_metadata::creader: resolving crate `core`
2020-08-29T03:36:59.362940Z  INFO rustc_metadata::creader: falling back to a load
2020-08-29T03:36:59.362951Z  INFO rustc_metadata::locator: lib candidate: /home/joshua/rustc/build/x86_64-unknown-linux-gnu/stage1/lib/rustlib/x86_64-unknown-linux-gnu/lib/libcore-ceeab66e7ca607ac.rlib
2020-08-29T03:36:59.363001Z  INFO rustc_metadata::locator: rlib reading metadata from: /home/joshua/rustc/build/x86_64-unknown-linux-gnu/stage1/lib/rustlib/x86_64-unknown-linux-gnu/lib/libcore-ceeab66e7ca607ac.rlib
2020-08-29T03:36:59.363135Z  INFO rustc_metadata::creader: register crate `core` (cnum = 18. private_dep = false)
</code></pre></div>



<a name="208415001"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415001" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415001">(Aug 29 2020 at 03:38)</a>:</h4>
<p>same rlib as cnum 2</p>



<a name="208415003"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415003" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415003">(Aug 29 2020 at 03:38)</a>:</h4>
<p>that should be it</p>



<a name="208415006"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415006" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415006">(Aug 29 2020 at 03:38)</a>:</h4>
<p>"falling back to a load" is the problem, I guess</p>



<a name="208415009"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415009" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415009">(Aug 29 2020 at 03:38)</a>:</h4>
<p>yeah</p>



<a name="208415011"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415011" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415011">(Aug 29 2020 at 03:38)</a>:</h4>
<p>it's the exact same file path?</p>



<a name="208415018"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415018" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415018">(Aug 29 2020 at 03:39)</a>:</h4>
<p>I didn't realize we duplicated dependencies like that sometimes. it doesn't feel right</p>



<a name="208415022"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415022" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415022">(Aug 29 2020 at 03:39)</a>:</h4>
<p><code>/home/joshua/rustc/build/x86_64-unknown-linux-gnu/stage1/lib/rustlib/x86_64-unknown-linux-gnu/lib/libcore-ceeab66e7ca607ac.rlib</code> just now and<br>
<code>/home/joshua/rustc/build/x86_64-unknown-linux-gnu/stage1/lib/rustlib/x86_64-unknown-linux-gnu/lib/libcore-ceeab66e7ca607ac.rlib</code> for your sample program before</p>



<a name="208415024"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415024" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415024">(Aug 29 2020 at 03:39)</a>:</h4>
<p>so yeah exactly the same</p>



<a name="208415026"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415026" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415026">(Aug 29 2020 at 03:39)</a>:</h4>
<p>use multiple lines so they line up</p>



<a name="208415071"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415071" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415071">(Aug 29 2020 at 03:40)</a>:</h4>
<p><span class="user-mention" data-user-id="232545">@Joshua Nelson</span> wait no, ignore the sample program, it has nothing to do with this</p>



<a name="208415073"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415073" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415073">(Aug 29 2020 at 03:40)</a>:</h4>
<p>you need to compare <code>cnum = 2</code> <em>in your thing</em> with <code>cnum = 18</code></p>



<a name="208415081"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415081" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415081">(Aug 29 2020 at 03:40)</a>:</h4>
<p>oh you're right it's different<br>
<code>/home/joshua/rustc/build/x86_64-unknown-linux-gnu/stage1-std/x86_64-unknown-linux-gnu/release/deps/libcore-622c4373f195cbb7.rmeta</code></p>



<a name="208415082"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415082" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415082">(Aug 29 2020 at 03:40)</a>:</h4>
<p>this is when documenting libproc_macro</p>
<div class="codehilite"><pre><span></span><code>  name: core
  cnum: 2
  hash: 335b86a5165f5805
  reqd: Explicit
   rmeta: /home/joshua/rustc/build/x86_64-unknown-linux-gnu/stage1-std/x86_64-unknown-linux-gnu/release/deps/libcore-622c4373f195cbb7.rmeta
</code></pre></div>



<a name="208415086"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415086" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415086">(Aug 29 2020 at 03:41)</a>:</h4>
<p>why are they different <span aria-label="confused" class="emoji emoji-1f615" role="img" title="confused">:confused:</span></p>



<a name="208415087"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415087" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415087">(Aug 29 2020 at 03:41)</a>:</h4>
<p><span class="user-mention" data-user-id="232545">@Joshua Nelson</span> anyway you probably need <span class="user-mention" data-user-id="123856">@Vadim Petrochenkov</span>, I just wanted to see how far I could get before I got beyond my limited knowledge of this area <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="208415089"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415089" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415089">(Aug 29 2020 at 03:41)</a>:</h4>
<p><span class="user-mention" data-user-id="232545">@Joshua Nelson</span> probably because you do have a sysroot heh</p>



<a name="208415094"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415094" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415094">(Aug 29 2020 at 03:41)</a>:</h4>
<p>wait <em>the hash is different</em>?!</p>



<a name="208415138"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415138" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415138">(Aug 29 2020 at 03:42)</a>:</h4>
<p><span class="user-mention" data-user-id="232545">@Joshua Nelson</span> can you <code>rm -rf build/*/stage1*</code> and try again the thing that fails?</p>



<a name="208415143"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415143" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415143">(Aug 29 2020 at 03:42)</a>:</h4>
<p>you shouldn't have the same crate with different hashes at the same time</p>



<a name="208415145"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415145" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415145">(Aug 29 2020 at 03:42)</a>:</h4>
<p>will take a while but sure</p>



<a name="208415147"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415147" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415147">(Aug 29 2020 at 03:42)</a>:</h4>
<p>no, it's stage1, should be almost instant</p>



<a name="208415152"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415152" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415152">(Aug 29 2020 at 03:43)</a>:</h4>
<p>ah ok it just rebuilds libstd</p>



<a name="208415160"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415160" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415160">(Aug 29 2020 at 03:43)</a>:</h4>
<p>maybe this is that x.py bug I keep seeing where it's not rebuilding things build by a compiler, even if said compiler changes</p>



<a name="208415202"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415202" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415202">(Aug 29 2020 at 03:44)</a>:</h4>
<p>but I wouldn't expect it to keep stale hashes around</p>



<a name="208415204"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415204" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415204">(Aug 29 2020 at 03:44)</a>:</h4>
<p>(this is a bad time to mention I've been using <code>--keep-stage 1</code> <span aria-label="cry" class="emoji emoji-1f622" role="img" title="cry">:cry:</span> )</p>



<a name="208415207"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415207" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415207">(Aug 29 2020 at 03:44)</a>:</h4>
<p>but it was broken before that</p>



<a name="208415210"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415210" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415210">(Aug 29 2020 at 03:44)</a>:</h4>
<p>please do yourself a favor and don't introduce extreme failure modes into your setup like that</p>



<a name="208415212"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415212" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415212">(Aug 29 2020 at 03:44)</a>:</h4>
<p>it takes like a minute to build libstd</p>



<a name="208415220"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415220" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415220">(Aug 29 2020 at 03:45)</a>:</h4>
<p>not worth it</p>



<a name="208415222"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415222" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415222">(Aug 29 2020 at 03:45)</a>:</h4>
<p>ok I wiped stage1/ and this is the new output for cnum 18:</p>
<div class="codehilite"><pre><span></span><code>2020-08-29T03:44:33.049855Z  INFO rustc_metadata::creader: resolving crate `core`
2020-08-29T03:44:33.049891Z  INFO rustc_metadata::creader: falling back to a load
2020-08-29T03:44:33.049901Z  INFO rustc_metadata::locator: lib candidate: /home/joshua/rustc/build/x86_64-unknown-linux-gnu/stage1/lib/rustlib/x86_64-unknown-linux-gnu/lib/libcore-ceeab66e7ca607ac.rlib
2020-08-29T03:44:33.049963Z  INFO rustc_metadata::locator: rlib reading metadata from: /home/joshua/rustc/build/x86_64-unknown-linux-gnu/stage1/lib/rustlib/x86_64-unknown-linux-gnu/lib/libcore-ceeab66e7ca607ac.rlib
</code></pre></div>


<p>and this is for cnum 2:</p>
<div class="codehilite"><pre><span></span><code>  name: core
  cnum: 2
  hash: 335b86a5165f5805
  reqd: Explicit
   rmeta: /home/joshua/rustc/build/x86_64-unknown-linux-gnu/stage1-std/x86_64-unknown-linux-gnu/release/deps/libcore-622c4373f195cbb7.rmeta
</code></pre></div>



<a name="208415226"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415226" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415226">(Aug 29 2020 at 03:45)</a>:</h4>
<p>so still different hashes</p>



<a name="208415227"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415227" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415227">(Aug 29 2020 at 03:45)</a>:</h4>
<p>okay gist the <code>ls -l</code> output for each of those directories they're in</p>



<a name="208415267"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415267" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415267">(Aug 29 2020 at 03:46)</a>:</h4>
<p><span class="user-mention" data-user-id="232545">@Joshua Nelson</span> wait, <code>stage1</code> or <code>stage1*</code>?</p>



<a name="208415270"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415270" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415270">(Aug 29 2020 at 03:46)</a>:</h4>
<p>also, did you remove <code>--keep-stage</code>?</p>



<a name="208415274"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415274" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415274">(Aug 29 2020 at 03:46)</a>:</h4>
<p>there's no point looking without having done this cleanly first</p>



<a name="208415275"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415275" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415275">(Aug 29 2020 at 03:46)</a>:</h4>
<p>I did remove it</p>



<a name="208415277"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415277" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415277">(Aug 29 2020 at 03:46)</a>:</h4>
<p>umm I wiped <code>stage1*</code></p>



<a name="208415279"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415279" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415279">(Aug 29 2020 at 03:47)</a>:</h4>
<p>okay good</p>



<a name="208415282"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415282" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415282">(Aug 29 2020 at 03:47)</a>:</h4>
<p><code>ls -l</code> time then <em>sigh</em></p>



<a name="208415286"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415286" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415286">(Aug 29 2020 at 03:47)</a>:</h4>
<p>maybe we're doing some weird renaming when copying, but, ugh</p>



<a name="208415291"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415291" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415291">(Aug 29 2020 at 03:47)</a>:</h4>
<p>cnum 18 comes first in the gist: <a href="https://gist.github.com/jyn514/38d8ad6910af01cfe7e242ac9ce239d5">https://gist.github.com/jyn514/38d8ad6910af01cfe7e242ac9ce239d5</a></p>



<a name="208415335"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415335" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415335">(Aug 29 2020 at 03:48)</a>:</h4>
<p>wait why are there 3 directories?</p>



<a name="208415337"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415337" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415337">(Aug 29 2020 at 03:48)</a>:</h4>
<p>(I'd also use separate files in the gist to make it easier to stare at)</p>



<a name="208415338"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415338" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415338">(Aug 29 2020 at 03:48)</a>:</h4>
<p>oh oops I copy pasted too much</p>



<a name="208415339"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415339" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415339">(Aug 29 2020 at 03:48)</a>:</h4>
<p>let me just redo it</p>



<a name="208415342"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415342" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415342">(Aug 29 2020 at 03:49)</a>:</h4>
<p>(you can edit it fwiw)</p>



<a name="208415347"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415347" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415347">(Aug 29 2020 at 03:49)</a>:</h4>
<p>okay, <code>622c4373f195cbb7</code> looks like... a <code>cargo check</code> dependency??</p>



<a name="208415352"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415352" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415352">(Aug 29 2020 at 03:49)</a>:</h4>
<p>the other one seems to be the real one</p>



<a name="208415392"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415392" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415392">(Aug 29 2020 at 03:50)</a>:</h4>
<p>updated</p>



<a name="208415393"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415393" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415393">(Aug 29 2020 at 03:50)</a>:</h4>
<p>there's two copies of each crate, that's weird</p>



<a name="208415397"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415397" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415397">(Aug 29 2020 at 03:50)</a>:</h4>
<p>I can wipe it again if it helps</p>



<a name="208415398"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415398" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415398">(Aug 29 2020 at 03:50)</a>:</h4>
<p><a href="https://gist.github.com/jyn514/38d8ad6910af01cfe7e242ac9ce239d5#file-stage1-std-txt-L3-L19">https://gist.github.com/jyn514/38d8ad6910af01cfe7e242ac9ce239d5#file-stage1-std-txt-L3-L19</a></p>
<p><a href="https://gist.github.com/jyn514/38d8ad6910af01cfe7e242ac9ce239d5#file-stage1-std-txt-L88-L110">https://gist.github.com/jyn514/38d8ad6910af01cfe7e242ac9ce239d5#file-stage1-std-txt-L88-L110</a></p>



<a name="208415403"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415403" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415403">(Aug 29 2020 at 03:51)</a>:</h4>
<p><span class="user-mention" data-user-id="232545">@Joshua Nelson</span> this might be <code>cargo doc</code> doing something weird?</p>



<a name="208415404"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415404" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415404">(Aug 29 2020 at 03:51)</a>:</h4>
<p>ugh</p>



<a name="208415405"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415405" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415405">(Aug 29 2020 at 03:51)</a>:</h4>
<p>well we are resolving all crates at startup</p>



<a name="208415407"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415407" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415407">(Aug 29 2020 at 03:51)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/blob/master/src/librustdoc/core.rs#L436">https://github.com/rust-lang/rust/blob/master/src/librustdoc/core.rs#L436</a></p>



<a name="208415408"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415408" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415408">(Aug 29 2020 at 03:51)</a>:</h4>
<p>note how some are <code>:44</code> and <code>:43</code> (the minute)</p>



<a name="208415446"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415446" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415446">(Aug 29 2020 at 03:52)</a>:</h4>
<p>ah interesting</p>



<a name="208415449"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415449" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415449">(Aug 29 2020 at 03:52)</a>:</h4>
<p>so the more <code>cargo check</code>-like ones are later</p>



<a name="208415450"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415450" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415450">(Aug 29 2020 at 03:52)</a>:</h4>
<p>:44 would be <code>doc</code> then maybe?</p>



<a name="208415453"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415453" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415453">(Aug 29 2020 at 03:52)</a>:</h4>
<p>yeah</p>



<a name="208415465"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415465" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415465">(Aug 29 2020 at 03:52)</a>:</h4>
<p>that means <code>622c4373f195cbb7</code> is the doc hash for core</p>



<a name="208415474"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415474" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415474">(Aug 29 2020 at 03:53)</a>:</h4>
<p>can you wipe again then do <code>./x.py build --stage 1</code>, take the <code>ls -l</code> of the <code>.../deps</code> dir, then do the doc thing, then take another <code>ls -l</code>?</p>



<a name="208415477"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415477" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415477">(Aug 29 2020 at 03:53)</a>:</h4>
<p>sure</p>



<a name="208415481"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415481" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415481">(Aug 29 2020 at 03:53)</a>:</h4>
<p>also, dump the <code>--extern</code> paths <code>rustdoc</code> receives, I bet it will have some of the <code>cargo check</code>-like crates in it</p>



<a name="208415551"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415551" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415551">(Aug 29 2020 at 03:55)</a>:</h4>
<p><span class="user-mention" data-user-id="232545">@Joshua Nelson</span> on the bright side, I don't think anything outside libstd can hit this <code>cargo doc</code> situation</p>



<a name="208415556"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415556" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415556">(Aug 29 2020 at 03:55)</a>:</h4>
<p>except maybe with <code>-Z build-std</code> lol</p>



<a name="208415600"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415600" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415600">(Aug 29 2020 at 03:56)</a>:</h4>
<p>(you can play around with <code>cargo doc -Z build-std -v</code> if you want, on some empty Cargo package, and see what it's trying to do)</p>



<a name="208415608"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415608" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415608">(Aug 29 2020 at 03:56)</a>:</h4>
<p>it would be amazing to replicate on something smaller than 'all of the standard library' haha</p>



<a name="208415625"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415625" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415625">(Aug 29 2020 at 03:57)</a>:</h4>
<blockquote>
<p>take another ls -l</p>
</blockquote>
<p>of <code>.../deps</code>?</p>



<a name="208415626"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415626" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415626">(Aug 29 2020 at 03:57)</a>:</h4>
<p>yeah</p>



<a name="208415667"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415667" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415667">(Aug 29 2020 at 03:58)</a>:</h4>
<p><a href="https://gist.github.com/jyn514/6773f462350fe0fbad004a7af1b3ffd7">https://gist.github.com/jyn514/6773f462350fe0fbad004a7af1b3ffd7</a></p>



<a name="208415670"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415670" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415670">(Aug 29 2020 at 03:58)</a>:</h4>
<p>oh let me get htat --extern</p>



<a name="208415671"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415671" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415671">(Aug 29 2020 at 03:58)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/Difference.20between.20.60PathKind.3A.3ADependency.60.20and.20.60Crate.60/near/208415608">said</a>:</p>
<blockquote>
<p>it would be amazing to replicate on something smaller than 'all of the standard library' haha</p>
</blockquote>
<p>it's picking up the true libcore from the sysroot while <code>cargo doc</code> injects a different one, so I don't think it's possible. well, other than passing <code>--sysroot</code> explicitly in <code>RUSTDOCFLAGS</code> or w/e</p>



<a name="208415676"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415676" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415676">(Aug 29 2020 at 03:58)</a>:</h4>
<p>ok :/</p>



<a name="208415684"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415684" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415684">(Aug 29 2020 at 03:59)</a>:</h4>
<p>I guess you could have a <code>run-make</code> test that replicates it at a small scale</p>



<a name="208415685"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415685" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415685">(Aug 29 2020 at 03:59)</a>:</h4>
<div class="codehilite"><pre><span></span><code>  process didn&#39;t exit successfully: `/home/joshua/rustc/build/bootstrap/debug/rustdoc --edition=2018 --crate-type lib --crate-name proc_macro library/proc_macro/src/lib.rs --target x86_64-unknown-linux-gnu -o /home/joshua/rustc/build/x86_64-unknown-linux-gnu/stage1-std/x86_64-unknown-linux-gnu/doc --error-format=json --json=diagnostic-rendered-ansi --markdown-css rust.css --markdown-no-toc -Z unstable-options --resource-suffix 1.47.0 --index-page /home/joshua/rustc/src/doc/index.md -L dependency=/home/joshua/rustc/build/x86_64-unknown-linux-gnu/stage1-std/x86_64-unknown-linux-gnu/release/deps -L dependency=/home/joshua/rustc/build/x86_64-unknown-linux-gnu/stage1-std/release/deps --extern std=/home/joshua/rustc/build/x86_64-unknown-linux-gnu/stage1-std/x86_64-unknown-linux-gnu/release/deps/libstd-3fa6ff265549ac26.rmeta -Z treat-err-as-bug -Dwarnings -Winvalid_codeblock_attributes --crate-version 1.47.0-dev` (exit code: 1)
</code></pre></div>



<a name="208415691"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415691" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415691">(Aug 29 2020 at 03:59)</a>:</h4>
<p>I think the relevant bits are</p>
<div class="codehilite"><pre><span></span><code>-L dependency=/home/joshua/rustc/build/x86_64-unknown-linux-gnu/stage1-std/x86_64-unknown-linux-gnu/release/deps
-L dependency=/home/joshua/rustc/build/x86_64-unknown-linux-gnu/stage1-std/release/deps
--extern std=/home/joshua/rustc/build/x86_64-unknown-linux-gnu/stage1-std/x86_64-unknown-linux-gnu/release/deps/libstd-3fa6ff265549ac26.rmeta
</code></pre></div>



<a name="208415693"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415693" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415693">(Aug 29 2020 at 03:59)</a>:</h4>
<p>yeaaaaaaah</p>



<a name="208415735"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415735" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415735">(Aug 29 2020 at 04:00)</a>:</h4>
<p>it's <code>cargo check</code>-ing it up</p>



<a name="208415752"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415752" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415752">(Aug 29 2020 at 04:00)</a>:</h4>
<p>which is normally fine because that would still depend on the sysroot libstd</p>



<a name="208415754"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415754" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415754">(Aug 29 2020 at 04:00)</a>:</h4>
<p>but we're building libstd lol</p>



<a name="208415766"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415766" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415766">(Aug 29 2020 at 04:01)</a>:</h4>
<p>does rustdoc <em>need</em> those <code>cargo check</code> outputs?</p>



<a name="208415767"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415767" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415767">(Aug 29 2020 at 04:01)</a>:</h4>
<p>it's the only things it sees</p>



<a name="208415771"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415771" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415771">(Aug 29 2020 at 04:01)</a>:</h4>
<p>what triggers loading the sysroot <code>libcore-ceeab66e7ca607ac.rlib</code>?</p>



<a name="208415779"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415779" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415779">(Aug 29 2020 at 04:01)</a>:</h4>
<p>because that's what shouldn't happen</p>



<a name="208415780"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415780" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415780">(Aug 29 2020 at 04:01)</a>:</h4>
<p>is that cnum 18? resolving <code>crate::usize::MAX</code> from a re-export of <code>core</code> from within proc-macro</p>



<a name="208415822"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415822" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415822">(Aug 29 2020 at 04:02)</a>:</h4>
<p>are you replacing <code>crate</code> with <code>core</code>?</p>



<a name="208415823"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415823" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415823">(Aug 29 2020 at 04:02)</a>:</h4>
<p>hold on getting the debug logs</p>



<a name="208415826"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415826" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415826">(Aug 29 2020 at 04:02)</a>:</h4>
<p>inside <code>rustdoc</code>, I mean</p>



<a name="208415828"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415828" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415828">(Aug 29 2020 at 04:02)</a>:</h4>
<p>no, rustdoc leaves <code>crate</code> as is</p>



<a name="208415831"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415831" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415831">(Aug 29 2020 at 04:03)</a>:</h4>
<p>or are you passing the right contextual information for <code>rustc_resolve</code> to know where to look?</p>



<a name="208415832"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415832" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415832">(Aug 29 2020 at 04:03)</a>:</h4>
<p>because it's different depending on which crate it came from</p>



<a name="208415833"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415833" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415833">(Aug 29 2020 at 04:03)</a>:</h4>
<p>the second, we tell it where the original module was</p>



<a name="208415835"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415835" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415835">(Aug 29 2020 at 04:03)</a>:</h4>
<p>okay so that shouldn't try to load a crate named <code>core</code> again</p>



<a name="208415837"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415837" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415837">(Aug 29 2020 at 04:03)</a>:</h4>
<div class="codehilite"><pre><span></span><code>2020-08-29T04:03:12.556282Z DEBUG rustdoc::passes::collect_intra_doc_links: resolving crate::usize::MAX as a macro in the module DefId(2:5001 ~ core[8913]::iter[0]::traits[0]::iterator[0])
2020-08-29T04:03:12.565204Z DEBUG rustc_resolve::diagnostics: looking up 2018 suggestions for usize#0 with span library/proc_macro/src/lib.rs:1:1: 1:1 (#0)
</code></pre></div>



<a name="208415838"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415838" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415838">(Aug 29 2020 at 04:03)</a>:</h4>
<p>lmao</p>



<a name="208415843"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415843" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415843">(Aug 29 2020 at 04:03)</a>:</h4>
<p>suggestions strike again</p>



<a name="208415879"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415879" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415879">(Aug 29 2020 at 04:04)</a>:</h4>
<p>yeah it's insult to injury lol</p>



<a name="208415881"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415881" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415881">(Aug 29 2020 at 04:04)</a>:</h4>
<p>no</p>



<a name="208415882"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415882" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415882">(Aug 29 2020 at 04:04)</a>:</h4>
<p>we literally don't use the suggestions</p>



<a name="208415885"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415885" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415885">(Aug 29 2020 at 04:04)</a>:</h4>
<p>it's how the bad thing happens</p>



<a name="208415888"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415888" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415888">(Aug 29 2020 at 04:04)</a>:</h4>
<p>that's why it can load the sysroot core</p>



<a name="208415894"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415894" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415894">(Aug 29 2020 at 04:04)</a>:</h4>
<p>you need to turn it off or something</p>



<a name="208415895"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415895" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415895">(Aug 29 2020 at 04:04)</a>:</h4>
<p>also why is it resolving that as a macro?</p>



<a name="208415896"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415896" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415896">(Aug 29 2020 at 04:05)</a>:</h4>
<p>rustdoc tries all namespaces</p>



<a name="208415901"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415901" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415901">(Aug 29 2020 at 04:05)</a>:</h4>
<p>it doesn't have any context to know which to look in</p>



<a name="208415904"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415904" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415904">(Aug 29 2020 at 04:05)</a>:</h4>
<p>okay yeah disable suggestion logic, you'll be fine</p>



<a name="208415907"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415907" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415907">(Aug 29 2020 at 04:05)</a>:</h4>
<p>how do I do that haha</p>



<a name="208415909"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415909" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415909">(Aug 29 2020 at 04:05)</a>:</h4>
<p>special case rustdoc in resolve some more?</p>



<a name="208415951"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415951" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415951">(Aug 29 2020 at 04:06)</a>:</h4>
<p><em>shrug</em> I don't know more than you, look at the code? and/or wait for <span class="user-mention" data-user-id="123856">@Vadim Petrochenkov</span>  to see this thread</p>



<a name="208415957"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415957" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415957">(Aug 29 2020 at 04:06)</a>:</h4>
<p>there might already be a way to make it not load new crates</p>



<a name="208415967"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415967" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415967">(Aug 29 2020 at 04:06)</a>:</h4>
<p>the current code looks like it unconditionally loads suggestions</p>



<a name="208415979"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415979" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415979">(Aug 29 2020 at 04:07)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/blob/d77eff21b97886a0829b784100846daf59df2f39/src/librustc_resolve/lib.rs#L2389">https://github.com/rust-lang/rust/blob/d77eff21b97886a0829b784100846daf59df2f39/src/librustc_resolve/lib.rs#L2389</a></p>



<a name="208415987"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208415987" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208415987">(Aug 29 2020 at 04:07)</a>:</h4>
<p>where is the <code>debug!</code>? I can't find it in the source</p>



<a name="208416024"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208416024" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208416024">(Aug 29 2020 at 04:08)</a>:</h4>
<p>I added it locally</p>



<a name="208416027"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208416027" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208416027">(Aug 29 2020 at 04:08)</a>:</h4>
<p>let me gist the diff</p>



<a name="208416039"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208416039" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208416039">(Aug 29 2020 at 04:08)</a>:</h4>
<p><a href="https://gist.github.com/jyn514/703ad7690c287a2680c71be1931c9276">https://gist.github.com/jyn514/703ad7690c287a2680c71be1931c9276</a></p>



<a name="208416040"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208416040" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208416040">(Aug 29 2020 at 04:09)</a>:</h4>
<p>I think the reason this involves an <code>Option</code> is so it can fail gracefully <a href="https://github.com/rust-lang/rust/blob/master/src/librustc_resolve/diagnostics.rs#L890">https://github.com/rust-lang/rust/blob/master/src/librustc_resolve/diagnostics.rs#L890</a></p>



<a name="208416103"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208416103" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208416103">(Aug 29 2020 at 04:10)</a>:</h4>
<p><code>self.maybe_resolve_crate(name, CrateDepKind::Explicit, None).ok()</code></p>
<p>this is what makes it load a different sysroot I think, the <code>None</code></p>



<a name="208416112"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208416112" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208416112">(Aug 29 2020 at 04:11)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/blob/master/src/librustc_metadata/creader.rs#L468">https://github.com/rust-lang/rust/blob/master/src/librustc_metadata/creader.rs#L468</a></p>



<a name="208416118"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208416118" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208416118">(Aug 29 2020 at 04:11)</a>:</h4>
<p>that's fine, <code>dep</code> would indicate it's a dependency of a different crate</p>



<a name="208416119"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208416119" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208416119">(Aug 29 2020 at 04:11)</a>:</h4>
<p>hmm, so</p>



<a name="208416156"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208416156" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208416156">(Aug 29 2020 at 04:12)</a>:</h4>
<p>it does actually succeed, why does that break anything?</p>



<a name="208416157"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208416157" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208416157">(Aug 29 2020 at 04:12)</a>:</h4>
<p>because the resolver was cloned</p>



<a name="208416158"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208416158" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208416158">(Aug 29 2020 at 04:12)</a>:</h4>
<p><span class="user-mention" data-user-id="232545">@Joshua Nelson</span> does this work if you put the macro namespace last?</p>



<a name="208416162"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208416162" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208416162">(Aug 29 2020 at 04:12)</a>:</h4>
<p>this might be some weirdness about macro name resolution</p>



<a name="208416176"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208416176" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208416176">(Aug 29 2020 at 04:13)</a>:</h4>
<p>trying now</p>



<a name="208416180"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208416180" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208416180">(Aug 29 2020 at 04:13)</a>:</h4>
<p>oh ugh borrow errors</p>



<a name="208416222"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208416222" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208416222">(Aug 29 2020 at 04:14)</a>:</h4>
<p>aaaah I didn't scroll around enough</p>



<a name="208416224"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208416224" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208416224">(Aug 29 2020 at 04:14)</a>:</h4>
<p>I missed the <code>#[rustc_builtin_macro]</code></p>



<a name="208416227"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208416227" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208416227">(Aug 29 2020 at 04:14)</a>:</h4>
<p>it's not that it was cloned or anything like that. this is like lang items</p>



<a name="208416230"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208416230" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208416230">(Aug 29 2020 at 04:14)</a>:</h4>
<p>you're loading two crates that each claim a builtin</p>



<a name="208416237"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208416237" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208416237">(Aug 29 2020 at 04:15)</a>:</h4>
<p>yes</p>



<a name="208416246"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208416246" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208416246">(Aug 29 2020 at 04:15)</a>:</h4>
<p>also <em>wow</em> <code>RUSTDOC_LOG=rustdoc::core</code> is spammy</p>



<a name="208416252"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208416252" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208416252">(Aug 29 2020 at 04:15)</a>:</h4>
<p>resolving macros last did not help</p>



<a name="208416365"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208416365" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208416365">(Aug 29 2020 at 04:18)</a>:</h4>
<p>okay I finally understand now, this is the sequence of events:</p>
<ol start="0">
<li><code>x.py build --stage 1</code> builds the standard library and crates a sysroot</li>
<li><code>cargo doc</code> does something like <code>cargo check</code> to create <code>rmeta</code>s for all the crates (unrelated to what was built above)</li>
<li>the <code>cargo check</code>-like <code>libcore-*.rmeta</code> is loaded as a transitive dependency <em>and claims ownership</em> of builtin macros</li>
<li><code>rustdoc</code> later tries to resolve some path in a doc link</li>
<li>suggestion logic fires and loads extern prelude crates by name</li>
<li>the sysroot <code>libcore-*.rlib</code> is loaded and <em>fails to claim ownership</em> of builtin macros</li>
</ol>



<a name="208416399"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208416399" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208416399">(Aug 29 2020 at 04:20)</a>:</h4>
<p>IMO the problem is either 4 or 5</p>



<a name="208416443"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208416443" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208416443">(Aug 29 2020 at 04:20)</a>:</h4>
<p>not one or two, it's fine to use the <code>cargo check</code>-like rmetas?</p>



<a name="208416448"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208416448" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208416448">(Aug 29 2020 at 04:21)</a>:</h4>
<p>yes, it's just like when you run <code>x.py check</code></p>



<a name="208416461"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208416461" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208416461">(Aug 29 2020 at 04:21)</a>:</h4>
<blockquote>
<p>loads extern prelude crates by name</p>
</blockquote>
<p>maybe this is the issue? it should use the DefId instead? since the link starts with <code>crate</code> it has to be getting the name from the def id in the first place</p>



<a name="208416498"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208416498" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208416498">(Aug 29 2020 at 04:22)</a>:</h4>
<p>nah it's a suggestion</p>



<a name="208416500"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208416500" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208416500">(Aug 29 2020 at 04:22)</a>:</h4>
<p>it's just looking for stuff</p>



<a name="208416510"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208416510" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208416510">(Aug 29 2020 at 04:23)</a>:</h4>
<p><span class="user-mention" data-user-id="232545">@Joshua Nelson</span> if you want you could make the error about <code>#[rustc_builtin_macro]</code> say which crate first took ownership of it, or at least use <code>Option</code> around the value, and <code>take</code>, instead of using <code>remove</code> around the whole entry, so you can have a different "builtin macro registered twice" error or something</p>



<a name="208416512"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208416512" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208416512">(Aug 29 2020 at 04:23)</a>:</h4>
<p>why does this only break rustdoc? why not <code>cargo check</code>?</p>



<a name="208416515"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208416515" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208416515">(Aug 29 2020 at 04:23)</a>:</h4>
<p><span class="user-mention silent" data-user-id="119009">eddyb</span> <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/Difference.20between.20.60PathKind.3A.3ADependency.60.20and.20.60Crate.60/near/208416510">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> if you want you could make the error about <code>#[rustc_builtin_macro]</code> say which crate first took ownership of it, or at least use <code>Option</code> around the value, and <code>take</code>, instead of using <code>remove</code> around the whole entry, so you can have a different "builtin macro registered twice" error or something</p>
</blockquote>
<p>yeah it would be very helpful to have a better error message</p>



<a name="208416556"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208416556" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208416556">(Aug 29 2020 at 04:24)</a>:</h4>
<p>or <em>would</em> this break cargo check if there were an unresolved import? let me try that</p>



<a name="208416563"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208416563" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208416563">(Aug 29 2020 at 04:25)</a>:</h4>
<p>nope, works fine</p>
<div class="codehilite"><pre><span></span><code>error[E0432]: unresolved import `std::u8::x`
  --&gt; library/proc_macro/src/lib.rs:48:5
   |
48 | use std::u8::x;
   |     ^^^^^^^^^^ no `x` in `u8`
</code></pre></div>



<a name="208416608"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208416608" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208416608">(Aug 29 2020 at 04:26)</a>:</h4>
<p>is that with a dependency <code>libcore-*.rmeta</code> from the <code>cargo check</code>, and a sysroot in place?</p>



<a name="208416613"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208416613" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208416613">(Aug 29 2020 at 04:27)</a>:</h4>
<p>keep in mind <code>x.py check</code> runs at stage 0</p>



<a name="208416615"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208416615" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208416615">(Aug 29 2020 at 04:27)</a>:</h4>
<p>ahhh</p>



<a name="208416619"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208416619" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208416619">(Aug 29 2020 at 04:27)</a>:</h4>
<p>ok, it's not possible to replicate this with <code>build</code></p>



<a name="208416624"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208416624" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208416624">(Aug 29 2020 at 04:27)</a>:</h4>
<p><span class="user-mention" data-user-id="232545">@Joshua Nelson</span> hopefully this helps <a href="https://github.com/rust-lang/rust/pull/75176#issuecomment-683234468">https://github.com/rust-lang/rust/pull/75176#issuecomment-683234468</a></p>



<a name="208416625"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208416625" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208416625">(Aug 29 2020 at 04:27)</a>:</h4>
<p>it will build the stage 0 artifacts before it can build stage 1</p>



<a name="208416626"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208416626" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208416626">(Aug 29 2020 at 04:28)</a>:</h4>
<p>and give the error there</p>



<a name="208416664"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208416664" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208416664">(Aug 29 2020 at 04:28)</a>:</h4>
<p>not sure how you would run <code>x.py check --stage 1</code> anyway lol</p>



<a name="208416666"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208416666" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208416666">(Aug 29 2020 at 04:28)</a>:</h4>
<p>it might be possible to trigger this at stage 0</p>



<a name="208416668"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208416668" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208416668">(Aug 29 2020 at 04:28)</a>:</h4>
<p>but you have to have the right sysroot and idk if we set it</p>



<a name="208416677"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208416677" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208416677">(Aug 29 2020 at 04:29)</a>:</h4>
<p>anyway I found the thing that was broken for a while due to speculative crate loading for suggestions</p>



<a name="208416724"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208416724" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208416724">(Aug 29 2020 at 04:30)</a>:</h4>
<p>(i.e. I linked <a href="https://github.com/rust-lang/rust/issues/74071">#74071</a> which fixed <a href="https://github.com/rust-lang/rust/issues/55103">#55103</a> and <a href="https://github.com/rust-lang/rust/issues/56590">#56590</a>)</p>



<a name="208416739"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208416739" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208416739">(Aug 29 2020 at 04:31)</a>:</h4>
<p>if you look at that PR, it made various sanity checks into <code>return Err(...)</code> instead of directly erroring</p>



<a name="208416779"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208416779" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208416779">(Aug 29 2020 at 04:32)</a>:</h4>
<p>that sounds like it could work</p>



<a name="208416780"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208416780" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208416780">(Aug 29 2020 at 04:32)</a>:</h4>
<p>rustdoc has no problem just skipping <code>Res::Err</code></p>



<a name="208416784"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208416784" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208416784">(Aug 29 2020 at 04:32)</a>:</h4>
<p>problem is the "acquire builtin macro" logic might not know if the crate is loaded only for suggestions</p>



<a name="208416795"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208416795" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208416795">(Aug 29 2020 at 04:33)</a>:</h4>
<p>anyway simplest thing is just avoid the <code>rust_2018</code>-specific suggestion path if you're in rustdoc</p>



<a name="208416797"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208416797" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208416797">(Aug 29 2020 at 04:33)</a>:</h4>
<p>like stick an <code>if</code> around it</p>



<a name="208416800"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208416800" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208416800">(Aug 29 2020 at 04:33)</a>:</h4>
<p>and see if that fixes things</p>



<a name="208416887"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208416887" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208416887">(Aug 29 2020 at 04:36)</a>:</h4>
<p><span class="user-mention" data-user-id="232545">@Joshua Nelson</span> hope you don't mind me renaming this thread <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="208416899"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208416899" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208416899">(Aug 29 2020 at 04:36)</a>:</h4>
<p>yeah that's fine :)</p>



<a name="208416902"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208416902" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208416902">(Aug 29 2020 at 04:36)</a>:</h4>
<p>also I should've waited to ping petrochenkov until we ran out of deductions because threads like this can waste other ppl's time with the back &amp; forth</p>



<a name="208416903"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208416903" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208416903">(Aug 29 2020 at 04:36)</a>:</h4>
<p>special casing rustdoc now and if that works I can clean it up into the more principled fix</p>



<a name="208417036"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208417036" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208417036">(Aug 29 2020 at 04:41)</a>:</h4>
<p>it worked !!! <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span> <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span> <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span></p>



<a name="208425928"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/182449-t-compiler/help/topic/rustdoc%20causes%20multiple%20loads%20of%20libcore/near/208425928" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vadim Petrochenkov <a href="https://rust-lang.github.io/zulip_archive/stream/182449-t-compiler/help/topic/rustdoc.20causes.20multiple.20loads.20of.20libcore.html#208425928">(Aug 29 2020 at 09:40)</a>:</h4>
<p>Too long, didn't read, but eagerly reporting errors from anything speculative is bad.<br>
<a href="https://github.com/rust-lang/rust/pull/75176#issuecomment-683264508">https://github.com/rust-lang/rust/pull/75176#issuecomment-683264508</a></p>



<hr><p>Last updated: Aug 07 2021 at 22:04 UTC</p>
</html>