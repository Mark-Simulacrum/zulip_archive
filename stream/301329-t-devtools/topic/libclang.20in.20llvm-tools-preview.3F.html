<html>
<head><meta charset="utf-8"><title>libclang in llvm-tools-preview? · t-devtools · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/301329-t-devtools/index.html">t-devtools</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/301329-t-devtools/topic/libclang.20in.20llvm-tools-preview.3F.html">libclang in llvm-tools-preview?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="263783063"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/301329-t-devtools/topic/libclang%20in%20llvm-tools-preview%3F/near/263783063" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steven Fackler <a href="https://zulip-archive.rust-lang.org/stream/301329-t-devtools/topic/libclang.20in.20llvm-tools-preview.3F.html#263783063">(Dec 05 2021 at 18:53)</a>:</h4>
<p>Has there been any discussion of including libclang in the llvm-tools-preview rustup component? If possible, it seems like it'd help make bindgen usage a lot more user-friendly when building in environments that don't have easy access to a modern clang.</p>



<a name="263784469"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/301329-t-devtools/topic/libclang%20in%20llvm-tools-preview%3F/near/263784469" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/301329-t-devtools/topic/libclang.20in.20llvm-tools-preview.3F.html#263784469">(Dec 05 2021 at 19:23)</a>:</h4>
<p>I think there is some discussion here: <a href="https://github.com/rust-lang/rust/issues/56371">https://github.com/rust-lang/rust/issues/56371</a></p>



<a name="263786889"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/301329-t-devtools/topic/libclang%20in%20llvm-tools-preview%3F/near/263786889" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/301329-t-devtools/topic/libclang.20in.20llvm-tools-preview.3F.html#263786889">(Dec 05 2021 at 20:19)</a>:</h4>
<p>That is for clang, not libclang. Libclang is what is necessary for rust-bindgen.</p>



<a name="263787229"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/301329-t-devtools/topic/libclang%20in%20llvm-tools-preview%3F/near/263787229" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/301329-t-devtools/topic/libclang.20in.20llvm-tools-preview.3F.html#263787229">(Dec 05 2021 at 20:26)</a>:</h4>
<p>Libclang depends on libllvm afaik. I think having the same libllvm used by a proc-macro and by rustc itself may cause issues as the proc-macro may for example forget to initialize llvm (which would silently work for as long as rustc depends on the same libllvm, but may break if it changes to a different libllvm or a non-llvm based codegen backend), or it may try to configure llvm with different settings from rustc which could cause arbitrary bad things to happen. If the proc macro doesn't configure llvm with some settings, that would break if rustc doesn't use the same libllvm, but if it does, that may break rustc. While rust-bindgen doesn't use a proc macro, there is nothing preventing this from being done, and in fact I would expect some people to already do this.</p>



<a name="263790399"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/301329-t-devtools/topic/libclang%20in%20llvm-tools-preview%3F/near/263790399" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steven Fackler <a href="https://zulip-archive.rust-lang.org/stream/301329-t-devtools/topic/libclang.20in.20llvm-tools-preview.3F.html#263790399">(Dec 05 2021 at 21:35)</a>:</h4>
<p>Wouldn't you be in even worse shape if the program ended up linking to two distinct llvms with overlapping symbol names? Or can the dynamic linker handle that</p>



<a name="263790958"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/301329-t-devtools/topic/libclang%20in%20llvm-tools-preview%3F/near/263790958" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/301329-t-devtools/topic/libclang.20in.20llvm-tools-preview.3F.html#263790958">(Dec 05 2021 at 21:49)</a>:</h4>
<p>Rustc uses RTLD_LOCAL when calling dlopen which prevents symbols from leaking out of the proc macro. I think within the proc macro explicit dependencies will have priority over rustc exported symbols, though I am less certain of this. At least on macOS I am sure it isn't a problem due to two level namespaces, which basically record for each symbol in which dylib they need to be looked up.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>