<html>
<head><meta charset="utf-8"><title>Unstable Book Documentation · project-inline-asm · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/index.html">project-inline-asm</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/Unstable.20Book.20Documentation.html">Unstable Book Documentation</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="250191350"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/Unstable%20Book%20Documentation/near/250191350" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> asquared31415 <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/Unstable.20Book.20Documentation.html#250191350">(Aug 21 2021 at 02:29)</a>:</h4>
<p>Related to my <code>named_asm_labels</code> lint, should the <a href="https://doc.rust-lang.org/nightly/unstable-book/library-features/asm.html#labels">linked section</a> of the unstable book be edited to more specifically say that any duplication, compiler caused or otherwise, of named labels, including non-numeric local labels, can be problematic, including within and across crates, even in unrelated code?</p>



<a name="250221138"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/Unstable%20Book%20Documentation/near/250221138" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amanieu <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/Unstable.20Book.20Documentation.html#250221138">(Aug 21 2021 at 14:49)</a>:</h4>
<p>Sure, that sounds like a good idea.</p>



<a name="250250188"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/Unstable%20Book%20Documentation/near/250250188" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> asquared31415 <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/Unstable.20Book.20Documentation.html#250250188">(Aug 22 2021 at 02:38)</a>:</h4>
<p>Initial draft, any major feedback on this?<br>
<a href="/user_uploads/4715/QfDC9YnPH4fY59sC-q5Fxphs/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/QfDC9YnPH4fY59sC-q5Fxphs/image.png" title="image.png"><img src="/user_uploads/4715/QfDC9YnPH4fY59sC-q5Fxphs/image.png"></a></div>



<a name="250250197"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/Unstable%20Book%20Documentation/near/250250197" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> asquared31415 <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/Unstable.20Book.20Documentation.html#250250197">(Aug 22 2021 at 02:38)</a>:</h4>
<p>I considered italicizing <code>any</code> at the start of the sentence for emphasis</p>



<a name="250254496"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/Unstable%20Book%20Documentation/near/250254496" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/Unstable.20Book.20Documentation.html#250254496">(Aug 22 2021 at 04:40)</a>:</h4>
<p>Wow, that's a hell of a gotcha. Is there any possibility of catching these issues and issuing warnings?</p>



<a name="250256917"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/Unstable%20Book%20Documentation/near/250256917" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/Unstable.20Book.20Documentation.html#250256917">(Aug 22 2021 at 05:48)</a>:</h4>
<p>There are already lints against named labels</p>



<a name="250256927"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/Unstable%20Book%20Documentation/near/250256927" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/Unstable.20Book.20Documentation.html#250256927">(Aug 22 2021 at 05:49)</a>:</h4>
<p>But not for 0b and 1b. That only applies when you use LLVM assembler and use Intel syntax on x86/64. For AT&amp;T syntax, other architectures or other non-LLVM backends it'll be fine.</p>



<a name="250256993"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/Unstable%20Book%20Documentation/near/250256993" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/Unstable.20Book.20Documentation.html#250256993">(Aug 22 2021 at 05:51)</a>:</h4>
<p>0b and 1b issue is really just LLVM trying to support MASM-style literals (0b, 0Ah, etc). It could be very easily disabled (just flip a bool) from LLVM but it doesn't expose the way to get it disabled if Intel syntax is used.</p>



<a name="250257966"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/Unstable%20Book%20Documentation/near/250257966" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/Unstable.20Book.20Documentation.html#250257966">(Aug 22 2021 at 06:19)</a>:</h4>
<p>i almost wonder if this issue is bad enough to switch the default to att syntax...</p>



<a name="250260164"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/Unstable%20Book%20Documentation/near/250260164" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/Unstable.20Book.20Documentation.html#250260164">(Aug 22 2021 at 07:19)</a>:</h4>
<p>Actually I searched through LLVM/clang codebase and it seems that the intel dialect attribute that rustc used is only used by clang for MS-style assemblies (for MSVC compat)</p>



<a name="250260212"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/Unstable%20Book%20Documentation/near/250260212" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/Unstable.20Book.20Documentation.html#250260212">(Aug 22 2021 at 07:20)</a>:</h4>
<p>We should actually use <code>.intel_syntax</code> instead <span aria-label="joy" class="emoji emoji-1f602" role="img" title="joy">:joy:</span></p>



<a name="250260214"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/Unstable%20Book%20Documentation/near/250260214" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/Unstable.20Book.20Documentation.html#250260214">(Aug 22 2021 at 07:20)</a>:</h4>
<p>drafting a PR now</p>



<a name="250261322"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/Unstable%20Book%20Documentation/near/250261322" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/Unstable.20Book.20Documentation.html#250261322">(Aug 22 2021 at 07:49)</a>:</h4>
<p>Oh no that doesn't work because LLVM will insert AT&amp;T style register names <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="250261456"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/Unstable%20Book%20Documentation/near/250261456" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/Unstable.20Book.20Documentation.html#250261456">(Aug 22 2021 at 07:53)</a>:</h4>
<p><span class="user-mention silent" data-user-id="209168">Thom Chiovoloni</span> <a href="#narrow/stream/216763-project-inline-asm/topic/Unstable.20Book.20Documentation/near/250257966">said</a>:</p>
<blockquote>
<p>i almost wonder if this issue is bad enough to switch the default to att syntax...</p>
</blockquote>
<p>I am thinking about the same now</p>



<a name="250267718"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/Unstable%20Book%20Documentation/near/250267718" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amanieu <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/Unstable.20Book.20Documentation.html#250267718">(Aug 22 2021 at 10:41)</a>:</h4>
<p><span class="user-mention" data-user-id="384759">@asquared31415</span> I'd specify that the binary literal thing only applies to x86 and that it can be worked around by using AT&amp;T syntax.</p>



<a name="250279429"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/Unstable%20Book%20Documentation/near/250279429" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> asquared31415 <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/Unstable.20Book.20Documentation.html#250279429">(Aug 22 2021 at 15:25)</a>:</h4>
<p>Okay, I didn't write that part, just kept it in the screenshot for context, but I will do a pass through the whole page and try to update things.</p>



<a name="250282512"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/Unstable%20Book%20Documentation/near/250282512" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> asquared31415 <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/Unstable.20Book.20Documentation.html#250282512">(Aug 22 2021 at 16:38)</a>:</h4>
<p><a href="/user_uploads/4715/ADgSW7A3sf-c39L2YeNan2ml/image.png">image.png</a> <br>
Is this example of a migration from llvm_asm to asm still necessary?  In my opinion it only serves to add confusion to someone who didn't previously use it and I would assume very few people are still migrating from llvm_asm to asm.</p>
<div class="message_inline_image"><a href="/user_uploads/4715/ADgSW7A3sf-c39L2YeNan2ml/image.png" title="image.png"><img src="/user_uploads/4715/ADgSW7A3sf-c39L2YeNan2ml/image.png"></a></div>



<a name="250287309"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/Unstable%20Book%20Documentation/near/250287309" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amanieu <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/Unstable.20Book.20Documentation.html#250287309">(Aug 22 2021 at 18:38)</a>:</h4>
<p>Yea it's fine to remove it at this point: llvm_asm now triggers a deprecation warning and will be removed from the compiler soon.</p>



<a name="250289257"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/Unstable%20Book%20Documentation/near/250289257" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/Unstable.20Book.20Documentation.html#250289257">(Aug 22 2021 at 19:26)</a>:</h4>
<p>Maybe it should actually be kept for a bit as the last people will now have to start migrating away from <code>llvm_asm!</code>?</p>



<a name="250292625"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/Unstable%20Book%20Documentation/near/250292625" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> asquared31415 <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/Unstable.20Book.20Documentation.html#250292625">(Aug 22 2021 at 20:52)</a>:</h4>
<p>Ah that's fair, shortly after that feature is removed this can be removed</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>