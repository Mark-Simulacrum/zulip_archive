<html>
<head><meta charset="utf-8"><title>forbidding asm · project-inline-asm · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/index.html">project-inline-asm</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/forbidding.20asm.html">forbidding asm</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="264655666"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/forbidding%20asm/near/264655666" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/forbidding.20asm.html#264655666">(Dec 13 2021 at 01:47)</a>:</h4>
<p><span class="user-mention" data-user-id="420380">@Bot+</span> That's the point you're getting substantial disagreement on. <code>asm!</code> is not worse than any other unsafe code.</p>



<a name="264655725"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/forbidding%20asm/near/264655725" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/forbidding.20asm.html#264655725">(Dec 13 2021 at 01:48)</a>:</h4>
<p>(I've moved this to a separate topic.)</p>



<a name="264660023"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/forbidding%20asm/near/264660023" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/forbidding.20asm.html#264660023">(Dec 13 2021 at 03:22)</a>:</h4>
<p>Perhaps Clippy would accept a restriction lint, but there's no reason to add such a lint to the compiler. To add such a lint to the compiler implies too strongly that it is in fact a special defense that <code>#![forbid(unsafe_code)]</code> is not.</p>



<a name="264660206"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/forbidding%20asm/near/264660206" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/forbidding.20asm.html#264660206">(Dec 13 2021 at 03:26)</a>:</h4>
<p>It is essentially moot whether it is C's <code>__asm__</code> or Rust's <code>asm!</code>.  It is still a wad of instructions from an external language, in actuality, in spite of its in-language embedding. So I could only entertain such a categorical forbiddance if it applied against "language external" code in general.</p>
<p>That you can still probably use... <strong>cute</strong> approaches like loading in a JIT and running some spontaneously generated code is hilarious and just Very Turing Machine. Also something that OS can shut down with some success.</p>



<a name="264723969"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/forbidding%20asm/near/264723969" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bot+ <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/forbidding.20asm.html#264723969">(Dec 13 2021 at 15:39)</a>:</h4>
<blockquote>
<p>asm! is not worse than any other unsafe code.</p>
</blockquote>
<p>"Can UB do anything asm can?" Yes.</p>
<p>asm just needs less extra steps to get to the same result, so "worse" is subjective. </p>
<blockquote>
<p>So I could only entertain such a categorical forbiddance if it applied against "language external" code in general.</p>
</blockquote>
<p>My current thought is every embedded language should have its own optional off switch on Rust side. While Rust should not be blamed for what other languages do, Rust/cargo should have a permission before launching external tool(s).</p>



<a name="264749183"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/forbidding%20asm/near/264749183" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/forbidding.20asm.html#264749183">(Dec 13 2021 at 18:22)</a>:</h4>
<blockquote>
<p>Rust/cargo should have a permission before launching external tool(s).</p>
</blockquote>
<p>Cargo doesn't launch any external tools other than rustc. The build scripts are reponsible for calling into for example a C compiler. There is no way to prevent a build script from invoking a C compiler other than sandboxing, which is non-portable and will directly or through a dependency break a large portion of the ecosystem.</p>



<a name="264790186"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/forbidding%20asm/near/264790186" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/forbidding.20asm.html#264790186">(Dec 14 2021 at 00:20)</a>:</h4>
<p>Yes, I was only thinking about binding against language-external symbols as something that is legible (ish) to the compiler, I think?</p>



<a name="266131995"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/forbidding%20asm/near/266131995" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Weimer <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/forbidding.20asm.html#266131995">(Dec 26 2021 at 22:58)</a>:</h4>
<p><span class="user-mention silent" data-user-id="143274">Amanieu</span> <a href="#narrow/stream/216763-project-inline-asm/topic/forbidding.20asm/near/264635133">said</a>:</p>
<blockquote>
<p>I really don't think asm should be treated any differently from other unsafe code</p>
</blockquote>
<p>A lot of unsafe code can be very portable across many architecture. This is very different for inline assembly, which needs some porting effort as soon real machine instructions are used. That might be a reason to flag inline assembly differently: as a very likely (not just potential) portability hazard.</p>



<a name="266132271"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/forbidding%20asm/near/266132271" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/forbidding.20asm.html#266132271">(Dec 26 2021 at 23:05)</a>:</h4>
<p>You could use clippy to restrict all uses of <code>core::arch</code>. This will catch inline asm and all vendor intrinsics.</p>



<a name="266193605"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/forbidding%20asm/near/266193605" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/forbidding.20asm.html#266193605">(Dec 27 2021 at 18:19)</a>:</h4>
<p>Relevant: <a href="https://rust-lang.github.io/rfcs/1868-portability-lint.html">https://rust-lang.github.io/rfcs/1868-portability-lint.html</a></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>