<html>
<head><meta charset="utf-8"><title>How does one tell arm targets from thumb targets? · project-inline-asm · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/index.html">project-inline-asm</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/How.20does.20one.20tell.20arm.20targets.20from.20thumb.20targets.3F.html">How does one tell arm targets from thumb targets?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="249898360"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/How%20does%20one%20tell%20arm%20targets%20from%20thumb%20targets%3F/near/249898360" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/How.20does.20one.20tell.20arm.20targets.20from.20thumb.20targets.3F.html#249898360">(Aug 18 2021 at 19:12)</a>:</h4>
<p>I'm not clear on how code is supposed to be able to tell that it is being compiled for arm targets or thumb targets. Since this affects nearly nothing in normal rust that's understandable. However, this affects the inline asm you write, so there should be some way to detect.</p>



<a name="249930828"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/How%20does%20one%20tell%20arm%20targets%20from%20thumb%20targets%3F/near/249930828" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amanieu <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/How.20does.20one.20tell.20arm.20targets.20from.20thumb.20targets.3F.html#249930828">(Aug 19 2021 at 01:17)</a>:</h4>
<p>I think <code>cfg(target_feature = "thumb")</code> works, but I'm not 100% sure.</p>



<a name="249947622"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/How%20does%20one%20tell%20arm%20targets%20from%20thumb%20targets%3F/near/249947622" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/How.20does.20one.20tell.20arm.20targets.20from.20thumb.20targets.3F.html#249947622">(Aug 19 2021 at 06:48)</a>:</h4>
<p>I'll check that next time i sit down for rust</p>



<a name="249958663"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/How%20does%20one%20tell%20arm%20targets%20from%20thumb%20targets%3F/near/249958663" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/How.20does.20one.20tell.20arm.20targets.20from.20thumb.20targets.3F.html#249958663">(Aug 19 2021 at 08:50)</a>:</h4>
<p>--print cfg can help</p>



<a name="250315563"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/How%20does%20one%20tell%20arm%20targets%20from%20thumb%20targets%3F/near/250315563" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/How.20does.20one.20tell.20arm.20targets.20from.20thumb.20targets.3F.html#250315563">(Aug 23 2021 at 06:36)</a>:</h4>
<p><code>#[cfg(target_feature = "thumb")]</code> apparently does not work</p>
<p>Also, <code>cargo --print cfg</code> wasn't recognized, is there another command I'm supposed to use --print with?</p>



<a name="250316295"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/How%20does%20one%20tell%20arm%20targets%20from%20thumb%20targets%3F/near/250316295" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/How.20does.20one.20tell.20arm.20targets.20from.20thumb.20targets.3F.html#250316295">(Aug 23 2021 at 06:52)</a>:</h4>
<p>rustc --print cfg</p>



<a name="250319376"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/How%20does%20one%20tell%20arm%20targets%20from%20thumb%20targets%3F/near/250319376" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/How.20does.20one.20tell.20arm.20targets.20from.20thumb.20targets.3F.html#250319376">(Aug 23 2021 at 07:35)</a>:</h4>
<div class="codehilite"><pre><span></span><code>D:\dev\gba-from-scratch&gt;rustc --print cfg --target thumbv4t-none-eabi
debug_assertions
panic=&quot;abort&quot;
target_abi=&quot;eabi&quot;
target_arch=&quot;arm&quot;
target_endian=&quot;little&quot;
target_env=&quot;&quot;
target_feature=&quot;thumb-mode&quot;
target_has_atomic_equal_alignment=&quot;16&quot;
target_has_atomic_equal_alignment=&quot;32&quot;
target_has_atomic_equal_alignment=&quot;8&quot;
target_has_atomic_equal_alignment=&quot;ptr&quot;
target_has_atomic_load_store=&quot;16&quot;
target_has_atomic_load_store=&quot;32&quot;
target_has_atomic_load_store=&quot;8&quot;
target_has_atomic_load_store=&quot;ptr&quot;
target_os=&quot;none&quot;
target_pointer_width=&quot;32&quot;
target_vendor=&quot;unknown&quot;
</code></pre></div>
<p>Seems that <code>thumb-mode</code> is the rustc name</p>



<a name="250319407"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/How%20does%20one%20tell%20arm%20targets%20from%20thumb%20targets%3F/near/250319407" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/How.20does.20one.20tell.20arm.20targets.20from.20thumb.20targets.3F.html#250319407">(Aug 23 2021 at 07:35)</a>:</h4>
<p>but all that atomic info is very wrong I think so dunno about that</p>



<a name="250320691"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/How%20does%20one%20tell%20arm%20targets%20from%20thumb%20targets%3F/near/250320691" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/How.20does.20one.20tell.20arm.20targets.20from.20thumb.20targets.3F.html#250320691">(Aug 23 2021 at 07:53)</a>:</h4>
<p>you should file a bug about that?</p>



<a name="250338903"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/How%20does%20one%20tell%20arm%20targets%20from%20thumb%20targets%3F/near/250338903" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/How.20does.20one.20tell.20arm.20targets.20from.20thumb.20targets.3F.html#250338903">(Aug 23 2021 at 11:36)</a>:</h4>
<p>ARM7 has atomic load/store though?</p>



<a name="250366265"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/How%20does%20one%20tell%20arm%20targets%20from%20thumb%20targets%3F/near/250366265" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/How.20does.20one.20tell.20arm.20targets.20from.20thumb.20targets.3F.html#250366265">(Aug 23 2021 at 15:16)</a>:</h4>
<p>but this is v4T</p>



<a name="250366399"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/How%20does%20one%20tell%20arm%20targets%20from%20thumb%20targets%3F/near/250366399" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/How.20does.20one.20tell.20arm.20targets.20from.20thumb.20targets.3F.html#250366399">(Aug 23 2021 at 15:17)</a>:</h4>
<p>does atomic_load_store just mean that a load or store of that size happens in one cycle? Because that much is true</p>



<a name="250366513"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/How%20does%20one%20tell%20arm%20targets%20from%20thumb%20targets%3F/near/250366513" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/How.20does.20one.20tell.20arm.20targets.20from.20thumb.20targets.3F.html#250366513">(Aug 23 2021 at 15:18)</a>:</h4>
<p>rather, i should say it happens uninterruptably, regardless of cycles taken</p>



<a name="250366644"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/How%20does%20one%20tell%20arm%20targets%20from%20thumb%20targets%3F/near/250366644" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amanieu <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/How.20does.20one.20tell.20arm.20targets.20from.20thumb.20targets.3F.html#250366644">(Aug 23 2021 at 15:19)</a>:</h4>
<p>It means that can never observe (e.g. through another CPU or an interrupt handler) a split write.</p>



<a name="250366697"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/How%20does%20one%20tell%20arm%20targets%20from%20thumb%20targets%3F/near/250366697" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amanieu <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/How.20does.20one.20tell.20arm.20targets.20from.20thumb.20targets.3F.html#250366697">(Aug 23 2021 at 15:19)</a>:</h4>
<p>Split write means only some of the bytes were updated by the store, but not all.</p>



<a name="250366762"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/How%20does%20one%20tell%20arm%20targets%20from%20thumb%20targets%3F/near/250366762" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amanieu <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/How.20does.20one.20tell.20arm.20targets.20from.20thumb.20targets.3F.html#250366762">(Aug 23 2021 at 15:20)</a>:</h4>
<p>(This all assuming full alignment)</p>



<a name="250366915"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/How%20does%20one%20tell%20arm%20targets%20from%20thumb%20targets%3F/near/250366915" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/How.20does.20one.20tell.20arm.20targets.20from.20thumb.20targets.3F.html#250366915">(Aug 23 2021 at 15:21)</a>:</h4>
<p>ah, well that's accurate then</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>