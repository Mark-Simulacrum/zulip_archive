<html>
<head><meta charset="utf-8"><title>Stabilization PR · project-inline-asm · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/index.html">project-inline-asm</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/Stabilization.20PR.html">Stabilization PR</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="264389487"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/Stabilization%20PR/near/264389487" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amanieu <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/Stabilization.20PR.html#264389487">(Dec 10 2021 at 00:53)</a>:</h4>
<p>The stabilization PR is up! <a href="https://github.com/rust-lang/rust/pull/91728">https://github.com/rust-lang/rust/pull/91728</a></p>



<a name="264631562"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/Stabilization%20PR/near/264631562" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bot+ <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/Stabilization.20PR.html#264631562">(Dec 12 2021 at 16:41)</a>:</h4>
<p>As majority of crates should not contain any asm!() at all, should there be some way to restrict usage of asm to harden against smuggling attacks? (RCE is possible already but asm has potential to give direct access to cpu internals)<br>
Maybe:</p>
<ol>
<li>Require a flag in cargo.toml to enable asm</li>
<li>Introduce forbid(asm) similar to forbid(unsafe_code)</li>
<li>Include a [Contains asm] warning to crates with asm.</li>
<li>Do nothing</li>
</ol>



<a name="264631632"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/Stabilization%20PR/near/264631632" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amanieu <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/Stabilization.20PR.html#264631632">(Dec 12 2021 at 16:42)</a>:</h4>
<p><code>asm!</code> is always unsafe, so it should be covered by <code>forbid(unsafe_code)</code>. I don't think a separate mechanism is needed just for inline assembly since it doesn't give any more power than any other unsafe code.</p>



<a name="264633565"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/Stabilization%20PR/near/264633565" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bot+ <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/Stabilization.20PR.html#264633565">(Dec 12 2021 at 17:24)</a>:</h4>
<blockquote>
<p>it doesn't give any more power than any other unsafe code.</p>
</blockquote>
<p>yeah, asm just makes it easier to do bad stuff</p>



<a name="264633580"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/Stabilization%20PR/near/264633580" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bot+ <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/Stabilization.20PR.html#264633580">(Dec 12 2021 at 17:24)</a>:</h4>
<p>I expect legitimate usage of asm will be a small fraction of crates with unsafe, so having a standardized way for CI/cargo to deny asm but allow unsafe should prove to be useful.</p>



<a name="264633609"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/Stabilization%20PR/near/264633609" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amanieu <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/Stabilization.20PR.html#264633609">(Dec 12 2021 at 17:25)</a>:</h4>
<p>I disagree, it's a lot easier to do "bad stuff" by messing around with raw pointers. Most inline assembly tends to be small and self-contained, especially since you need to be very explicit about the operands and options.</p>



<a name="264634276"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/Stabilization%20PR/near/264634276" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/Stabilization.20PR.html#264634276">(Dec 12 2021 at 17:40)</a>:</h4>
<p>besides, on most computers, you can write to a block of memory, flush the instruction-cache/set as executable, and execute the instructions you wrote, giving you even more power than inline asm without needing inline asm at all.</p>



<a name="264634879"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/Stabilization%20PR/near/264634879" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bot+ <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/Stabilization.20PR.html#264634879">(Dec 12 2021 at 17:53)</a>:</h4>
<blockquote>
<p>small and self-contained</p>
</blockquote>
<p>This is about idiot-proofing like when devs don't properly review their dependencies.</p>
<blockquote>
<p>write to a block of memory, flush the instruction-cache/set as executable, and execute</p>
</blockquote>
<p>or on some older machines you can exploit a known hardware vulnerability to brick it.</p>



<a name="264635115"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/Stabilization%20PR/near/264635115" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amanieu <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/Stabilization.20PR.html#264635115">(Dec 12 2021 at 17:58)</a>:</h4>
<p>All of which you can already do today by calling C code.</p>



<a name="264635133"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/Stabilization%20PR/near/264635133" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amanieu <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/Stabilization.20PR.html#264635133">(Dec 12 2021 at 17:58)</a>:</h4>
<p>I really don't think asm should be treated any differently from other unsafe code</p>



<a name="264635667"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/Stabilization%20PR/near/264635667" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bot+ <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/Stabilization.20PR.html#264635667">(Dec 12 2021 at 18:11)</a>:</h4>
<blockquote>
<p>All of which you can already do today by calling C code.</p>
</blockquote>
<p>Yes</p>
<blockquote>
<p>I really don't think asm should be treated any differently from other unsafe code</p>
</blockquote>
<p>I think asm has potential (=hardware vulnerabilities) to be worse than unsafe, so the decision should be left to user.</p>



<a name="264641842"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/Stabilization%20PR/near/264641842" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/Stabilization.20PR.html#264641842">(Dec 12 2021 at 20:23)</a>:</h4>
<p>But the C code can also call inline assembly, or the C code can just <em>be</em> an object file made directly from assembly.</p>



<a name="264642821"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/Stabilization%20PR/near/264642821" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bot+ <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/Stabilization.20PR.html#264642821">(Dec 12 2021 at 20:49)</a>:</h4>
<p>If C source is buggy/compromised/garbage that is not Rust's fault. "No asm found in .rs will be compiled" on other hand is a promise the compiler could make. I agree it's not much given current state of Rust but it's something.</p>



<a name="264647278"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/Stabilization%20PR/near/264647278" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/Stabilization.20PR.html#264647278">(Dec 12 2021 at 22:27)</a>:</h4>
<p>I don't think that would add any value compared to just <code>forbid(unsafe_code)</code>.</p>



<a name="264647328"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/Stabilization%20PR/near/264647328" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/Stabilization.20PR.html#264647328">(Dec 12 2021 at 22:28)</a>:</h4>
<p>If you don't trust the crate, it has plenty of ways of doing malicious things, with unsafe code or even without. If you do trust the crate and just want a cross-check, unsafe code seems like the right boundary, and even then linking to C still bypasses that.</p>



<a name="264648552"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/Stabilization%20PR/near/264648552" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bot+ <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/Stabilization.20PR.html#264648552">(Dec 12 2021 at 22:59)</a>:</h4>
<blockquote>
<p>it has plenty of ways of doing malicious things</p>
</blockquote>
<p>And general availability of asm will lower the bar even further, crates with forbid(unsafe_code) excluded.</p>
<p>forbid(asm) won't save the world but I think it would be handy as codestyle enforcement or defense in depth.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>