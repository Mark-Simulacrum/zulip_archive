<html>
<head><meta charset="utf-8"><title>repr(transparent) values as inputs · project-inline-asm · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/index.html">project-inline-asm</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/repr(transparent).20values.20as.20inputs.html">repr(transparent) values as inputs</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="251159363"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/repr%28transparent%29%20values%20as%20inputs/near/251159363" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/repr(transparent).20values.20as.20inputs.html#251159363">(Aug 29 2021 at 21:31)</a>:</h4>
<p>If a type is <code>repr(transparent)</code> over a type that's allowed as an input/output type to an inline assembly block, can we be allowed to specify it directly as an input or output?</p>



<a name="251159412"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/repr%28transparent%29%20values%20as%20inputs/near/251159412" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/repr(transparent).20values.20as.20inputs.html#251159412">(Aug 29 2021 at 21:32)</a>:</h4>
<p>That is: i'm aware that it does not currently work, and I'm suggesting that it be allowed.</p>



<a name="251160933"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/repr%28transparent%29%20values%20as%20inputs/near/251160933" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/repr(transparent).20values.20as.20inputs.html#251160933">(Aug 29 2021 at 22:01)</a>:</h4>
<p>If we allow transparent types then how about <code>Option&lt;NonZeroI32&gt;</code>? Maybe define the rule as "any type that is FFI safe and have an ABI of scalar or vector"?</p>
<p>While I do see it being potentially useful but I am worried about complicating the rules.</p>



<a name="251163637"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/repr%28transparent%29%20values%20as%20inputs/near/251163637" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> asquared31415 <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/repr(transparent).20values.20as.20inputs.html#251163637">(Aug 29 2021 at 22:47)</a>:</h4>
<p>"any type with the same ABI as &lt;insert what we allow&gt;" would be nice, I can imagine a world where being able to use newtyped scalars directly is a lot nicer</p>



<a name="251165364"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/repr%28transparent%29%20values%20as%20inputs/near/251165364" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/repr(transparent).20values.20as.20inputs.html#251165364">(Aug 29 2021 at 23:19)</a>:</h4>
<p>Some restrictions would be needed. Otherwise abi layout of a type in a library could be unintentionally exposed to its user, and user might depend on that.</p>



<a name="251168615"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/repr%28transparent%29%20values%20as%20inputs/near/251168615" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amanieu <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/repr(transparent).20values.20as.20inputs.html#251168615">(Aug 30 2021 at 00:11)</a>:</h4>
<p>We could probably support this, but I don't feel that the added complexity is justified. We currently have error messages that clearly give the list of supported types for a register class already.</p>



<a name="251168668"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/repr%28transparent%29%20values%20as%20inputs/near/251168668" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amanieu <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/repr(transparent).20values.20as.20inputs.html#251168668">(Aug 30 2021 at 00:12)</a>:</h4>
<p>And in any case <code>asm!</code> is always unsafe so you can always transmute if needed.</p>



<a name="251168693"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/repr%28transparent%29%20values%20as%20inputs/near/251168693" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amanieu <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/repr(transparent).20values.20as.20inputs.html#251168693">(Aug 30 2021 at 00:13)</a>:</h4>
<p>Not that you'd need to since most <code>#[repr(transparent)]</code> types have a way of getting at the inner value (usually it's just <code>pub</code>).</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>