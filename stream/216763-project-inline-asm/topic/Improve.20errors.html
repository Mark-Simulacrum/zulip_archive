<html>
<head><meta charset="utf-8"><title>Improve errors · project-inline-asm · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/index.html">project-inline-asm</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/Improve.20errors.html">Improve errors</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="249970548"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/Improve%20errors/near/249970548" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bot+ <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/Improve.20errors.html#249970548">(Aug 19 2021 at 11:15)</a>:</h4>
<p>Today I forgot "and" instruction does not support 64-bit immediate values on x64.</p>
<p>The error message could be more helpful</p>
<div class="codehilite"><pre><span></span><code>error: invalid operand for instruction
*snip*
note: instantiated into assembly here
    --&gt; &lt;inline asm&gt;:4:1
     |
4    | and rax, 9259542123273814144
</code></pre></div>
<p>Instead of saying "invalid operand", could it specify whether the instruction expects register, memory or immediate value?</p>
<p><a href="https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2018&amp;gist=cfdfd99b59954681b47c35e1fb30b0ee">https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2018&amp;gist=cfdfd99b59954681b47c35e1fb30b0ee</a></p>



<a name="249970639"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/Improve%20errors/near/249970639" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amanieu <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/Improve.20errors.html#249970639">(Aug 19 2021 at 11:16)</a>:</h4>
<p>Assembly parsing is in LLVM, not rustc.</p>



<a name="249970808"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/Improve%20errors/near/249970808" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amanieu <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/Improve.20errors.html#249970808">(Aug 19 2021 at 11:17)</a>:</h4>
<p>So it's possible to improve the error messages, but it will have to be done upstream in LLVM.</p>



<a name="249970960"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/Improve%20errors/near/249970960" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bot+ <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/Improve.20errors.html#249970960">(Aug 19 2021 at 11:18)</a>:</h4>
<p>Ah, I hoped LLVM would pass something useful to rustc that could passed to user.</p>



<a name="250001166"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/Improve%20errors/near/250001166" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/Improve.20errors.html#250001166">(Aug 19 2021 at 15:14)</a>:</h4>
<p>I think llvm doesn't even always do the assembly itself, so you're at the mercy of the assembler for your target (which might or might not be an llvm-project assembler).</p>



<a name="250021785"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/Improve%20errors/near/250021785" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> asquared31415 <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/Improve.20errors.html#250021785">(Aug 19 2021 at 17:52)</a>:</h4>
<p>LLVM claims that inline asm uses its built-in assembler, but that might not actually be a thing all the time</p>



<a name="250022151"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/Improve%20errors/near/250022151" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> asquared31415 <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/Improve.20errors.html#250022151">(Aug 19 2021 at 17:54)</a>:</h4>
<blockquote>
<p>the resulting assembly string is parsed by LLVM’s integrated assembler unless it is disabled – even when emitting a .s file – and thus must contain assembly syntax known to LLVM.</p>
</blockquote>
<p>hmmm do we ever disable it?</p>



<a name="250037286"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/Improve%20errors/near/250037286" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/Improve.20errors.html#250037286">(Aug 19 2021 at 19:32)</a>:</h4>
<p>We have removed no-integrated-as codegen option, so we won't disable it.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>