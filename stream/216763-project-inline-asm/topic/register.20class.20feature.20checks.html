<html>
<head><meta charset="utf-8"><title>register class feature checks · project-inline-asm · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/index.html">project-inline-asm</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/register.20class.20feature.20checks.html">register class feature checks</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="254717857"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/register%20class%20feature%20checks/near/254717857" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/register.20class.20feature.20checks.html#254717857">(Sep 24 2021 at 14:59)</a>:</h4>
<p>Is my understanding correct that <code>asm!("", out("ymm0") _)</code> should error out if <code>avx</code> feature is not enabled?</p>



<a name="254719503"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/register%20class%20feature%20checks/near/254719503" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/register.20class.20feature.20checks.html#254719503">(Sep 24 2021 at 15:08)</a>:</h4>
<p>The reason I ask is because in <a href="https://github.com/rust-lang/rust/pull/87402">https://github.com/rust-lang/rust/pull/87402</a> I ended up seeing a diagnostics change after changing unrelated code in rustc... in particular see the <code>bad-reg.rs</code> test</p>



<a name="254723433"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/register%20class%20feature%20checks/near/254723433" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/register.20class.20feature.20checks.html#254723433">(Sep 24 2021 at 15:34)</a>:</h4>
<p>I thnk I know why...</p>



<a name="254729661"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/register%20class%20feature%20checks/near/254729661" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/register.20class.20feature.20checks.html#254729661">(Sep 24 2021 at 16:12)</a>:</h4>
<p>It shouldn't error. Clobbering a register is allowed even if target feature is not enabled.</p>



<a name="254729891"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/register%20class%20feature%20checks/near/254729891" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/register.20class.20feature.20checks.html#254729891">(Sep 24 2021 at 16:13)</a>:</h4>
<p>This is documented in the <a href="https://doc.rust-lang.org/stable/unstable-book/library-features/asm.html">stable unstable book</a>, under "symbol operands". But appearantly the latest unstable book update the code uses clobber_abi this comment it's gone...</p>



<a name="254740310"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/register%20class%20feature%20checks/near/254740310" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amanieu <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/register.20class.20feature.20checks.html#254740310">(Sep 24 2021 at 17:20)</a>:</h4>
<p>Yes this is intentional, it makes it easier to write portable clobber lists that work no matter what target features are enabled.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>