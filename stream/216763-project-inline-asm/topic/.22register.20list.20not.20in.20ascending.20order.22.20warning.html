<html>
<head><meta charset="utf-8"><title>&quot;register list not in ascending order&quot; warning · project-inline-asm · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/index.html">project-inline-asm</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/.22register.20list.20not.20in.20ascending.20order.22.20warning.html">&quot;register list not in ascending order&quot; warning</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="255970287"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/%22register%20list%20not%20in%20ascending%20order%22%20warning/near/255970287" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/.22register.20list.20not.20in.20ascending.20order.22.20warning.html#255970287">(Oct 03 2021 at 18:37)</a>:</h4>
<p>When using the following assembly:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">  </span><span class="k">unsafe</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="fm">asm!</span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="s">"ldr {dma3_base}, =0x040000D4"</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="s">"stmia {dma3_base}!, {{ {s_addr}, {d_addr}, {count_config} }}"</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="n">dma3_base</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">out</span><span class="p">(</span><span class="n">reg</span><span class="p">)</span><span class="w"> </span><span class="n">_</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="n">s_addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">in</span><span class="p">(</span><span class="n">reg</span><span class="p">)</span><span class="w"> </span><span class="n">src</span><span class="p">.</span><span class="n">as_ptr</span><span class="p">(),</span><span class="w"></span>
<span class="w">      </span><span class="n">d_addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">in</span><span class="p">(</span><span class="n">reg</span><span class="p">)</span><span class="w"> </span><span class="n">dest</span><span class="p">.</span><span class="n">as_ptr</span><span class="p">(),</span><span class="w"></span>
<span class="w">      </span><span class="n">count_config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">in</span><span class="p">(</span><span class="n">reg</span><span class="p">)</span><span class="w"> </span><span class="n">count_config</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="n">options</span><span class="p">(</span><span class="n">nostack</span><span class="p">,</span><span class="w"> </span><span class="n">preserves_flags</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>I get an error from... someone? I guess LLVM is feeding an error back to cargo?</p>
<div class="codehilite"><pre><span></span><code>D:\dev\gba-from-scratch&gt;cargo build
warning: register list not in ascending order
   --&gt; d:\dev\gba-from-scratch\src\dma.rs:163:8
    |
163 |       &quot;stmia {dma3_base}!, {{ {s_addr}, {d_addr}, {count_config} }}&quot;,
    |        ^
    |
note: instantiated into assembly here
   --&gt; &lt;inline asm&gt;:2:22
    |
2   | stmia r2!, { r0, r4, r1 }
    |                      ^

warning: `gba-from-scratch` (bin &quot;main&quot;) generated 1 warning
    Finished dev [optimized + debuginfo] target(s) in 0.07s
</code></pre></div>
<p>and basically, since I don't have any control at all over the register ordering, this should not be my problem.</p>
<p>Either the warning should be suppressed automatically (since I didn't pick the ordering) or perhaps better the registers should be sorted automatically somewhere along the line.</p>



<a name="255970830"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/%22register%20list%20not%20in%20ascending%20order%22%20warning/near/255970830" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/.22register.20list.20not.20in.20ascending.20order.22.20warning.html#255970830">(Oct 03 2021 at 18:45)</a>:</h4>
<p>The warning shouldn't be suppressed. It warns you that when storing it store the registers in ascending order, even if you didn't write it that way. <a href="https://stackoverflow.com/questions/47109767/push-and-pop-order-in-arm#47109995">https://stackoverflow.com/questions/47109767/push-and-pop-order-in-arm#47109995</a></p>



<a name="255970840"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/%22register%20list%20not%20in%20ascending%20order%22%20warning/near/255970840" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/.22register.20list.20not.20in.20ascending.20order.22.20warning.html#255970840">(Oct 03 2021 at 18:45)</a>:</h4>
<p>This is probably not what you intended.</p>



<a name="255970927"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/%22register%20list%20not%20in%20ascending%20order%22%20warning/near/255970927" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/.22register.20list.20not.20in.20ascending.20order.22.20warning.html#255970927">(Oct 03 2021 at 18:47)</a>:</h4>
<p>As for LLVM picking registers such that they are in ascending order, there is no register constraint that does that I would expect. And LLVM will never look at the actual inline asm during register allocation.</p>



<a name="255970936"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/%22register%20list%20not%20in%20ascending%20order%22%20warning/near/255970936" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/.22register.20list.20not.20in.20ascending.20order.22.20warning.html#255970936">(Oct 03 2021 at 18:47)</a>:</h4>
<p>I think you should explicitly pick some registers.</p>



<a name="255978559"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/%22register%20list%20not%20in%20ascending%20order%22%20warning/near/255978559" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/.22register.20list.20not.20in.20ascending.20order.22.20warning.html#255978559">(Oct 03 2021 at 20:46)</a>:</h4>
<p>well if i must, but i still think that this should be handled automatically somehow by the system</p>



<a name="255978563"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/%22register%20list%20not%20in%20ascending%20order%22%20warning/near/255978563" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/.22register.20list.20not.20in.20ascending.20order.22.20warning.html#255978563">(Oct 03 2021 at 20:46)</a>:</h4>
<p>call it a future extension</p>



<a name="255978712"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/%22register%20list%20not%20in%20ascending%20order%22%20warning/near/255978712" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/.22register.20list.20not.20in.20ascending.20order.22.20warning.html#255978712">(Oct 03 2021 at 20:49)</a>:</h4>
<p>Though this bring up the fact that an explicit register selection can't have a substitution name, which seems poor</p>



<a name="255979535"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/%22register%20list%20not%20in%20ascending%20order%22%20warning/near/255979535" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/.22register.20list.20not.20in.20ascending.20order.22.20warning.html#255979535">(Oct 03 2021 at 21:02)</a>:</h4>
<p>FWIW using specific registers here is not necessarily too terrible as long as you avoid the ones that are caller saved/not used for ABI purposes/etc.</p>



<a name="255979767"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/%22register%20list%20not%20in%20ascending%20order%22%20warning/near/255979767" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/.22register.20list.20not.20in.20ascending.20order.22.20warning.html#255979767">(Oct 03 2021 at 21:05)</a>:</h4>
<div class="codehilite"><pre><span></span><code>8000584:    0011        movs    r1, r2
 8000586:   0002        movs    r2, r0
 8000588:   0023        movs    r3, r4
 800058a:   4806        ldr r0, [pc, #24]   ; (80005a4 &lt;gba_from_scratch::dma::dma3_copy_from_u32_slice+0x34&gt;)
 800058c:   c00e        stmia   r0!, {r1, r2, r3}
</code></pre></div>
<p>LLVM is sure giving me a rough time here.</p>



<a name="255980439"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/%22register%20list%20not%20in%20ascending%20order%22%20warning/near/255980439" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/.22register.20list.20not.20in.20ascending.20order.22.20warning.html#255980439">(Oct 03 2021 at 21:16)</a>:</h4>
<p>(or in case you're using arguments, specifying register names that are used for the arguments...)</p>



<a name="255980833"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/%22register%20list%20not%20in%20ascending%20order%22%20warning/near/255980833" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/.22register.20list.20not.20in.20ascending.20order.22.20warning.html#255980833">(Oct 03 2021 at 21:22)</a>:</h4>
<p>So the unchecked version of the function is basically this:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#[inline(never)]</span><span class="w"></span>
<span class="k">pub</span><span class="w"> </span><span class="k">unsafe</span><span class="w"> </span><span class="k">fn</span> <span class="nf">dma3_u32_copy_from_to_unchecked</span><span class="p">(</span><span class="w"></span>
<span class="w">  </span><span class="n">src</span>: <span class="o">*</span><span class="k">const</span><span class="w"> </span><span class="kt">u32</span><span class="p">,</span><span class="w"> </span><span class="n">dest</span>: <span class="o">*</span><span class="k">mut</span><span class="w"> </span><span class="kt">u32</span><span class="p">,</span><span class="w"> </span><span class="n">count</span>: <span class="kt">u16</span><span class="p">,</span><span class="w"></span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">CONFIG</span>: <span class="nc">DmaConfig</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">    </span><span class="n">DmaConfig</span>::<span class="n">new</span><span class="p">().</span><span class="n">with_transfer_32bit</span><span class="p">(</span><span class="kc">true</span><span class="p">).</span><span class="n">with_enabled</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">CONFIG_U32</span>: <span class="kt">u32</span> <span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">CONFIG</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">u32</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">16</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="c1">//</span>
<span class="w">  </span><span class="fm">asm!</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="s">"ldr {dma3_base}, =0x040000D4"</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="s">"stmia {dma3_base}!, {{ r1, r2, r3 }}"</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">dma3_base</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">out</span><span class="p">(</span><span class="n">reg</span><span class="p">)</span><span class="w"> </span><span class="n">_</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="k">in</span><span class="p">(</span><span class="s">"r1"</span><span class="p">)</span><span class="w"> </span><span class="n">src</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="k">in</span><span class="p">(</span><span class="s">"r2"</span><span class="p">)</span><span class="w"> </span><span class="n">dest</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="k">in</span><span class="p">(</span><span class="s">"r3"</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">count</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">u32</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">CONFIG_U32</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">options</span><span class="p">(</span><span class="n">nostack</span><span class="p">,</span><span class="w"> </span><span class="n">preserves_flags</span><span class="p">),</span><span class="w"></span>
<span class="w">  </span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>which generates assembly that looks like this:</p>
<div class="codehilite"><pre><span></span><code>0800059c &lt;gba_from_scratch::dma::dma3_u32_copy_from_to_unchecked&gt;:
 800059c:   b5d0        push    {r4, r6, r7, lr}
 800059e:   af02        add r7, sp, #8
 80005a0:   000c        movs    r4, r1
 80005a2:   4906        ldr r1, [pc, #24]   ; (80005bc &lt;gba_from_scratch::dma::dma3_u32_copy_from_to_unchecked+0x20&gt;)
 80005a4:   4011        ands    r1, r2
 80005a6:   2221        movs    r2, #33 ; 0x21
 80005a8:   0692        lsls    r2, r2, #26
 80005aa:   188b        adds    r3, r1, r2
 80005ac:   0001        movs    r1, r0
 80005ae:   0022        movs    r2, r4
 80005b0:   4803        ldr r0, [pc, #12]   ; (80005c0 &lt;gba_from_scratch::dma::dma3_u32_copy_from_to_unchecked+0x24&gt;)
 80005b2:   c00e        stmia   r0!, {r1, r2, r3}
 80005b4:   bcd0        pop {r4, r6, r7}
 80005b6:   bc01        pop {r0}
 80005b8:   4700        bx  r0
 80005ba:   46c0        nop         ; (mov r8, r8)
 80005bc:   0000ffff    .word   0x0000ffff
 80005c0:   040000d4    .word   0x040000d4
</code></pre></div>
<p>and like... what... the heck... is happening here.</p>



<a name="255981051"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/%22register%20list%20not%20in%20ascending%20order%22%20warning/near/255981051" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/.22register.20list.20not.20in.20ascending.20order.22.20warning.html#255981051">(Oct 03 2021 at 21:26)</a>:</h4>
<p>So the calling convention AFAICT is <code>r0</code> contains <code>src</code> and <code>r1</code> contains <code>dest</code> and <code>r2</code> contains <code>count</code>.</p>



<a name="255981097"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/%22register%20list%20not%20in%20ascending%20order%22%20warning/near/255981097" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/.22register.20list.20not.20in.20ascending.20order.22.20warning.html#255981097">(Oct 03 2021 at 21:27)</a>:</h4>
<p>and the assembly shifts everything by 1 register, does it look any better if you ask the registers to be r0-r2?</p>



<a name="255981145"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/%22register%20list%20not%20in%20ascending%20order%22%20warning/near/255981145" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/.22register.20list.20not.20in.20ascending.20order.22.20warning.html#255981145">(Oct 03 2021 at 21:28)</a>:</h4>
<p>okay fair enough, that helps significantly:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">  </span><span class="fm">asm!</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="s">"ldr {dma3_base}, =0x040000D4"</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="s">"stmia {dma3_base}!, {{ r0, r1, r2 }}"</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">dma3_base</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">out</span><span class="p">(</span><span class="n">reg</span><span class="p">)</span><span class="w"> </span><span class="n">_</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="k">in</span><span class="p">(</span><span class="s">"r0"</span><span class="p">)</span><span class="w"> </span><span class="n">src</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="k">in</span><span class="p">(</span><span class="s">"r1"</span><span class="p">)</span><span class="w"> </span><span class="n">dest</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="k">in</span><span class="p">(</span><span class="s">"r2"</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">count</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">u32</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">CONFIG_U32</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">options</span><span class="p">(</span><span class="n">nostack</span><span class="p">,</span><span class="w"> </span><span class="n">preserves_flags</span><span class="p">),</span><span class="w"></span>
<span class="w">  </span><span class="p">);</span><span class="w"></span>
</code></pre></div>
<p>gives</p>
<div class="codehilite"><pre><span></span><code>0800059c &lt;gba_from_scratch::dma::dma3_u32_copy_from_to_unchecked&gt;:
 800059c:   4b03        ldr r3, [pc, #12]   ; (80005ac &lt;gba_from_scratch::dma::dma3_u32_copy_from_to_unchecked+0x10&gt;)
 800059e:   4013        ands    r3, r2
 80005a0:   2221        movs    r2, #33 ; 0x21
 80005a2:   0692        lsls    r2, r2, #26
 80005a4:   189a        adds    r2, r3, r2
 80005a6:   4b02        ldr r3, [pc, #8]    ; (80005b0 &lt;gba_from_scratch::dma::dma3_u32_copy_from_to_unchecked+0x14&gt;)
 80005a8:   c307        stmia   r3!, {r0, r1, r2}
 80005aa:   4770        bx  lr
 80005ac:   0000ffff    .word   0x0000ffff
 80005b0:   040000d4    .word   0x040000d4
</code></pre></div>
<p>so at least we're not doing a whole push-pop dance</p>



<a name="255981192"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/%22register%20list%20not%20in%20ascending%20order%22%20warning/near/255981192" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/.22register.20list.20not.20in.20ascending.20order.22.20warning.html#255981192">(Oct 03 2021 at 21:29)</a>:</h4>
<p>Right, now everything that's here is doing the <code>| CONFIG_U32</code> thing, executing your asm and returning.</p>



<a name="255981283"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/%22register%20list%20not%20in%20ascending%20order%22%20warning/near/255981283" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/.22register.20list.20not.20in.20ascending.20order.22.20warning.html#255981283">(Oct 03 2021 at 21:30)</a>:</h4>
<p>i think i can fix that too probably... one moment</p>



<a name="255981296"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/%22register%20list%20not%20in%20ascending%20order%22%20warning/near/255981296" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/.22register.20list.20not.20in.20ascending.20order.22.20warning.html#255981296">(Oct 03 2021 at 21:30)</a>:</h4>
<p>you could replace <code>const</code> with <code>static</code> perhaps for the <code>CONFIG_U32</code></p>



<a name="255981731"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/%22register%20list%20not%20in%20ascending%20order%22%20warning/near/255981731" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/.22register.20list.20not.20in.20ascending.20order.22.20warning.html#255981731">(Oct 03 2021 at 21:38)</a>:</h4>
<p>so one way is to give up on <code>preserves_flags</code></p>



<a name="255981765"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/216763-project-inline-asm/topic/%22register%20list%20not%20in%20ascending%20order%22%20warning/near/255981765" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/216763-project-inline-asm/topic/.22register.20list.20not.20in.20ascending.20order.22.20warning.html#255981765">(Oct 03 2021 at 21:39)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">  </span><span class="fm">asm!</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="s">"ldr {scratch}, ={config_pattern}"</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="s">"orrs r2, {scratch}"</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="s">"ldr {scratch}, =0x040000D4"</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="s">"stmia {scratch}!, {{ r0, r1, r2 }}"</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">config_pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">CONFIG_U32</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">scratch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">out</span><span class="p">(</span><span class="n">reg</span><span class="p">)</span><span class="w"> </span><span class="n">_</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="k">in</span><span class="p">(</span><span class="s">"r0"</span><span class="p">)</span><span class="w"> </span><span class="n">src</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="k">in</span><span class="p">(</span><span class="s">"r1"</span><span class="p">)</span><span class="w"> </span><span class="n">dest</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">inout</span><span class="p">(</span><span class="s">"r2"</span><span class="p">)</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">_</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">options</span><span class="p">(</span><span class="n">nostack</span><span class="p">),</span><span class="w"></span>
<span class="w">  </span><span class="p">);</span><span class="w"></span>
</code></pre></div>
<p>gives</p>
<div class="codehilite"><pre><span></span><code>0800059c &lt;gba_from_scratch::dma::dma3_u32_copy_from_to_unchecked&gt;:
 800059c:   4b02        ldr r3, [pc, #8]    ; (80005a8 &lt;gba_from_scratch::dma::dma3_u32_copy_from_to_unchecked+0xc&gt;)
 800059e:   431a        orrs    r2, r3
 80005a0:   4b02        ldr r3, [pc, #8]    ; (80005ac &lt;gba_from_scratch::dma::dma3_u32_copy_from_to_unchecked+0x10&gt;)
 80005a2:   c307        stmia   r3!, {r0, r1, r2}
 80005a4:   4770        bx  lr
 80005a6:   46c0        nop         ; (mov r8, r8)
 80005a8:   84000000    .word   0x84000000
 80005ac:   040000d4    .word   0x040000d4
</code></pre></div>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>