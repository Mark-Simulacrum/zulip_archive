<html>
<head><meta charset="utf-8"><title>Why isn&#x27;t [u8] Copy? · new members · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/Why.20isn&#x27;t.20.5Bu8.5D.20Copy.3F.html">Why isn&#x27;t [u8] Copy?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="261313307"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/Why%20isn%27t%20%5Bu8%5D%20Copy%3F/near/261313307" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aatif Syed <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/Why.20isn&#x27;t.20.5Bu8.5D.20Copy.3F.html#261313307">(Nov 12 2021 at 21:30)</a>:</h4>
<p>Hi everyone!</p>
<p>I'm experimenting with representing network packets as rust structs.</p>
<p>Here's an example packet</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#[repr(packed)]</span><span class="w"></span>
<span class="k">struct</span> <span class="nc">Ethernet</span><span class="o">&lt;</span><span class="n">T</span>: <span class="o">?</span><span class="nb">Sized</span><span class="o">&gt;</span><span class="w">  </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">header</span>: <span class="p">[</span><span class="kt">u8</span><span class="p">;</span><span class="w"> </span><span class="mi">14</span><span class="p">],</span><span class="w"></span>
<span class="w">    </span><span class="n">body</span>: <span class="nc">T</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>I'd like <code>T: ?Sized</code> so that I can represent packets that we don't know the type of as <code>[u8]</code>.<br>
That means that <code>T: Copy</code>, because packed fields must not implement <code>Drop</code>, which I think is probably due to creating an unaligned reference?</p>
<blockquote>
<p>the last field of a packed struct may only have a dynamically sized type if it does not need drop to be run</p>
</blockquote>
<p>But <code>[u8]: !Copy</code>, and I'm not sure why - it seems to fit the semantics! I'd love to find out :)</p>



<a name="261314397"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/Why%20isn%27t%20%5Bu8%5D%20Copy%3F/near/261314397" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/Why.20isn&#x27;t.20.5Bu8.5D.20Copy.3F.html#261314397">(Nov 12 2021 at 21:40)</a>:</h4>
<p><code>[u8]</code> is not the same as <code>[u8; 14]</code>. <code>[u8; 14]</code> is copy. <a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2021&amp;gist=a1df3b84b5f925915d74fad3e2eb1f4f">https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2021&amp;gist=a1df3b84b5f925915d74fad3e2eb1f4f</a></p>



<a name="261314421"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/Why%20isn%27t%20%5Bu8%5D%20Copy%3F/near/261314421" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/Why.20isn&#x27;t.20.5Bu8.5D.20Copy.3F.html#261314421">(Nov 12 2021 at 21:40)</a>:</h4>
<p>[u8] is "an unsized region of memory aligned on a byte boundary"</p>



<a name="261314517"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/Why%20isn%27t%20%5Bu8%5D%20Copy%3F/near/261314517" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/Why.20isn&#x27;t.20.5Bu8.5D.20Copy.3F.html#261314517">(Nov 12 2021 at 21:41)</a>:</h4>
<p>oh hmm I misunderstood your question</p>



<a name="261314531"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/Why%20isn%27t%20%5Bu8%5D%20Copy%3F/near/261314531" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/Why.20isn&#x27;t.20.5Bu8.5D.20Copy.3F.html#261314531">(Nov 12 2021 at 21:41)</a>:</h4>
<p>yeah I'm not sure why it's not copy</p>



<a name="261314875"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/Why%20isn%27t%20%5Bu8%5D%20Copy%3F/near/261314875" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/Why.20isn&#x27;t.20.5Bu8.5D.20Copy.3F.html#261314875">(Nov 12 2021 at 21:44)</a>:</h4>
<p>It's not clone because you can't return an unsized value from a function by value</p>



<a name="261314919"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/Why%20isn%27t%20%5Bu8%5D%20Copy%3F/near/261314919" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/Why.20isn&#x27;t.20.5Bu8.5D.20Copy.3F.html#261314919">(Nov 12 2021 at 21:45)</a>:</h4>
<p>And copy: clone</p>



<a name="261315548"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/Why%20isn%27t%20%5Bu8%5D%20Copy%3F/near/261315548" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/Why.20isn&#x27;t.20.5Bu8.5D.20Copy.3F.html#261315548">(Nov 12 2021 at 21:49)</a>:</h4>
<p>The higher-level question would be: how can you have a packed struct with a generic last field that allows for a DST?</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>