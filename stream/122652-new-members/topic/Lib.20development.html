<html>
<head><meta charset="utf-8"><title>Lib development · new members · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/Lib.20development.html">Lib development</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="260049140"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/Lib%20development/near/260049140" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> operamint <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/Lib.20development.html#260049140">(Nov 02 2021 at 19:57)</a>:</h4>
<p>Hi! New around here. I am considering learning Rust in depth by implementing my templated hashmap written in C. The implementation is  currently about <em>the fastest hashmap</em> among the top c/c++ implementations out there, including <a href="https://bestofcpp.com/repo/greg7mdp-parallel-hashmap-cpp-data-structures">https://bestofcpp.com/repo/greg7mdp-parallel-hashmap-cpp-data-structures</a> , <a href="https://bestofcpp.com/repo/martinus-robin-hood-hashing-cpp-containers">https://bestofcpp.com/repo/martinus-robin-hood-hashing-cpp-containers</a> and <a href="https://medium.com/applied/gist-better-than-unordered-map-1ad07b0a81b7">https://medium.com/applied/gist-better-than-unordered-map-1ad07b0a81b7</a>  It is also 4X faster than the current Rust HashMap in my simple benchmark. See <a href="http://rust_hashmap.rs">rust_hashmap.rs</a>, rust_cmap.c and shootout2_cmap.cpp at <a href="https://github.com/tylov/STC">https://github.com/tylov/STC</a>  The implementation is just 300 lines , and quite simple, so transforming it to Rust should be doable. My question is whether it is still interesting to try to push another alternative HashMap, or would I just be beating a dead horse here?</p>



<a name="260050695"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/Lib%20development/near/260050695" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/Lib.20development.html#260050695">(Nov 02 2021 at 20:08)</a>:</h4>
<p><span class="user-mention" data-user-id="454812">@operamint</span> A faster HashMap would <em>absolutely</em> be welcome. We'd have to be completely confident that the implementation was sound, though.</p>



<a name="260050768"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/Lib%20development/near/260050768" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/Lib.20development.html#260050768">(Nov 02 2021 at 20:08)</a>:</h4>
<p>It'd also need to be capable of supporting the full API that we currently have.</p>



<a name="260051097"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/Lib%20development/near/260051097" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/Lib.20development.html#260051097">(Nov 02 2021 at 20:11)</a>:</h4>
<p>Also, in the interests of a fair comparison, does the performance of your hash table depend on the hasher? You need to compare collision-resistant hashes to collision-resistant hashes, and non-collision-resistant hashes to non-collision-resistant hashes.</p>



<a name="260051121"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/Lib%20development/near/260051121" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/Lib.20development.html#260051121">(Nov 02 2021 at 20:11)</a>:</h4>
<p>A non-collision-resistant hash will be faster than a collision-resistant hash.</p>



<a name="260051253"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/Lib%20development/near/260051253" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/Lib.20development.html#260051253">(Nov 02 2021 at 20:12)</a>:</h4>
<p>Keeping all those things in mind, though, if you can make a substantially faster HashMap, that would make many, many things faster.</p>



<a name="260051378"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/Lib%20development/near/260051378" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/Lib.20development.html#260051378">(Nov 02 2021 at 20:13)</a>:</h4>
<p>I'd start by translating it to Rust and comparing the result to hashbrown. If you compare very favorably to hashbrown given all the above considerations, that'd be incredible.</p>



<a name="260051719"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/Lib%20development/near/260051719" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Forest Anderson [he/him] <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/Lib.20development.html#260051719">(Nov 02 2021 at 20:15)</a>:</h4>
<p>It may also be worth talking to <span class="user-mention" data-user-id="248590">@Acrimon</span> , who has done a lot of similar work (I believe) on Dashmap: <a href="https://github.com/xacrimon/dashmap">https://github.com/xacrimon/dashmap</a></p>



<a name="260052397"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/Lib%20development/near/260052397" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Acrimon <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/Lib.20development.html#260052397">(Nov 02 2021 at 20:20)</a>:</h4>
<p>Oh hey!</p>



<a name="260052434"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/Lib%20development/near/260052434" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Acrimon <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/Lib.20development.html#260052434">(Nov 02 2021 at 20:20)</a>:</h4>
<p>That said dashmap is concurrent, this isn't.</p>



<a name="260052517"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/Lib%20development/near/260052517" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Acrimon <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/Lib.20development.html#260052517">(Nov 02 2021 at 20:21)</a>:</h4>
<p>If I understand correctly anyway.</p>



<a name="260054606"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/Lib%20development/near/260054606" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/Lib.20development.html#260054606">(Nov 02 2021 at 20:36)</a>:</h4>
<p>Right. It might be possible to build a concurrent algorithm based on this, but a fast non-concurrent hash table is hugely valuable regardless.</p>



<a name="260065190"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/Lib%20development/near/260065190" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/Lib.20development.html#260065190">(Nov 02 2021 at 22:12)</a>:</h4>
<p>Absolutely good to get more -- the one the standard library is currently using started as a normal crate (and still is, &lt;<a href="https://lib.rs/crates/hashbrown">https://lib.rs/crates/hashbrown</a>&gt;), so you probably want to do the same, and if the new one turns out better it could absolutely become the default in <code>std</code>.</p>
<p>(Obligatory warning that starting with complex datastructures is one of the harder ways to learn Rust, as its lifetime checks are the least helpful there.  You might want to start with a few simpler toy programs first to get a feel for how using hashmaps in safe code goes with those checks.)</p>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/122652-new-members/topic/Lib.20development/near/260051097">said</a>:</p>
<blockquote>
<p>Also, in the interests of a fair comparison, does the performance of your hash table depend on the hasher? You need to compare collision-resistant hashes to collision-resistant hashes, and non-collision-resistant hashes to non-collision-resistant hashes.</p>
</blockquote>
<p>+1 to this.  It looks like &lt;<a href="https://github.com/tylov/STC/blob/master/benchmarks/rust_hashmap.rs#L17">https://github.com/tylov/STC/blob/master/benchmarks/rust_hashmap.rs#L17</a>&gt; is using the default hasher, which I suspect doesn't match what the C++ is using.</p>



<a name="260070470"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/Lib%20development/near/260070470" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/Lib.20development.html#260070470">(Nov 02 2021 at 23:11)</a>:</h4>
<p>FWIW, I agree that complex structures are a harsh way to learn rust, but also, with the performance you're talking about it would be fine if this data structure was built entirely on raw pointers and unsafe if necessary.</p>



<a name="260097987"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/Lib%20development/near/260097987" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/Lib.20development.html#260097987">(Nov 03 2021 at 07:40)</a>:</h4>
<p>Oh, I'd definitely expect it would have a bunch of raw pointers and <code>unsafe</code> internally.  But it'll still need to have a safe external API, so it'll be important to learn about how those look from the outside too, in order to provide it.</p>



<a name="260267153"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/Lib%20development/near/260267153" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/Lib.20development.html#260267153">(Nov 04 2021 at 13:12)</a>:</h4>
<p><span class="user-mention" data-user-id="454812">@operamint</span> If you do end up working on this, please follow up here; I'd love to amplify it on Reddit and Twitter.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>