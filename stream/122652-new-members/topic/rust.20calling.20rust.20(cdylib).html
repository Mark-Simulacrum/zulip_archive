<html>
<head><meta charset="utf-8"><title>rust calling rust (cdylib) · new members · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/rust.20calling.20rust.20(cdylib).html">rust calling rust (cdylib)</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="278637031"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/rust%20calling%20rust%20%28cdylib%29/near/278637031" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bonts <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/rust.20calling.20rust.20(cdylib).html#278637031">(Apr 12 2022 at 01:16)</a>:</h4>
<p>I have both a new bin, and an existing lib in the one project/Cargo.toml. The lib is cdylib and <a href="http://libname.so">libname.so</a> for... reasons. How do I get the bin to call the lib using dynamic linking?</p>



<a name="278645113"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/rust%20calling%20rust%20%28cdylib%29/near/278645113" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/rust.20calling.20rust.20(cdylib).html#278645113">(Apr 12 2022 at 03:49)</a>:</h4>
<p>Cargo is not capable of building cdylibs as a dependency directly.  </p>
<p>(It would be possible to do some gymnastics from a build script recursively building another project, but recursive cargo doesn't work terribly well.)</p>
<p>It is kinda possible with the unstable artifact-dependencies (make the cdylib a separate project and as a build-dependency, and then pass the appropriate -l/-L flags), but then you'd need to fish the cdylib out whenever you need it.</p>
<p>Another option is is to use libloading to load the library manually, depending on what your needs are.</p>



<a name="278647923"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/rust%20calling%20rust%20%28cdylib%29/near/278647923" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bonts <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/rust.20calling.20rust.20(cdylib).html#278647923">(Apr 12 2022 at 04:44)</a>:</h4>
<p>Thanks for that info. Looks like I need my bin in a seperate project. So how do I get a Rust bin to link to a Rust cdylib .so? ( Googling usually tells me how to get my Rust bin to link to a C lang .so. )</p>



<a name="278648449"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/rust%20calling%20rust%20%28cdylib%29/near/278648449" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/rust.20calling.20rust.20(cdylib).html#278648449">(Apr 12 2022 at 04:58)</a>:</h4>
<p>Maybe I'm not understanding the question.  You can pass <code>-lfoo</code> to <code>rustc</code> to link to a <a href="http://libfoo.so">libfoo.so</a> dylib. I outlined a few different approaches above on how to do that, but none of them are easy with cargo. Cargo is not designed to do that.</p>



<a name="278665885"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/rust%20calling%20rust%20%28cdylib%29/near/278665885" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bonts <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/rust.20calling.20rust.20(cdylib).html#278665885">(Apr 12 2022 at 09:05)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="120518">@Eric Huss</span>  I did not comepletely understand your first answer. Seems like cargo needs more completeness.</p>



<a name="278666306"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/rust%20calling%20rust%20%28cdylib%29/near/278666306" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/rust.20calling.20rust.20(cdylib).html#278666306">(Apr 12 2022 at 09:08)</a>:</h4>
<p>Why do you exactly want this? You will get an extra copy of libstd and you won't have a safe interface.</p>



<a name="278666469"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/rust%20calling%20rust%20%28cdylib%29/near/278666469" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/rust.20calling.20rust.20(cdylib).html#278666469">(Apr 12 2022 at 09:10)</a>:</h4>
<p>By the way you can compile a single crate as both rlib and cdylib at the same time by specifying both in the crate-types array of <code>Cargo.toml</code>.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>