<html>
<head><meta charset="utf-8"><title>serde: deserialize from bincode and JSON with different code · new members · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/serde.3A.20deserialize.20from.20bincode.20and.20JSON.20with.20different.20code.html">serde: deserialize from bincode and JSON with different code</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="264766308"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/serde%3A%20deserialize%20from%20bincode%20and%20JSON%20with%20different%20code/near/264766308" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Clark <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/serde.3A.20deserialize.20from.20bincode.20and.20JSON.20with.20different.20code.html#264766308">(Dec 13 2021 at 20:34)</a>:</h4>
<p>I have a JSON response from an API which I want to only partially deserialize (only deserializing one of the subfields if another is a certain value), then cache the result locally (building the dataset requires 306 api calls - so, both speed and courtesy are involved) using bincode.</p>
<p>The default deserializer works great with bincode, and I got help with a custom deserializer here which works for the JSON (see <a href="#narrow/stream/122652-new-members/topic/serde.3A.20JSON.20w.2Fsubfield.20type.20determined.20by.20parent.20field.20flag">https://rust-lang.zulipchat.com/#narrow/stream/122652-new-members/topic/serde.3A.20JSON.20w.2Fsubfield.20type.20determined.20by.20parent.20field.20flag</a>).</p>
<p>How can I make sure to run the correct deserializer for each data source? I'm in over my head - I couldn't write the JSON deserializer (why doesn't it need to use a Visitor? The docs make it very clear I need a Visitor, but not _why_ - and obviously I _don't_...), so this is probably something simple with type hints or something.</p>



<a name="264985022"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/serde%3A%20deserialize%20from%20bincode%20and%20JSON%20with%20different%20code/near/264985022" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Félix Saparelli <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/serde.3A.20deserialize.20from.20bincode.20and.20JSON.20with.20different.20code.html#264985022">(Dec 15 2021 at 09:45)</a>:</h4>
<p>(For reference, this is the code example I wrote in the previous thread: <a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2021&amp;gist=eed35aa937bf9c5dc50bb0eba0322819">https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2021&amp;gist=eed35aa937bf9c5dc50bb0eba0322819</a>)</p>
<p>In that example, I implement Deserialize by passing down to another, <code>#[derive(Deserialize)]</code>'d, implementation which does the partial deser, then handling logic on that. The derive is using Visitor internally. Serde requires you to use a Visitor, but store-bought is fine. I find that pattern easier and clearer rather than writing a visitor-driven implementation; ymmv. This pattern is most useful with a single hard-coded data format; in your case you likely want to go for a hand-written Visitor so it's generic on the input.</p>



<a name="265092446"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/serde%3A%20deserialize%20from%20bincode%20and%20JSON%20with%20different%20code/near/265092446" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Clark <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/serde.3A.20deserialize.20from.20bincode.20and.20JSON.20with.20different.20code.html#265092446">(Dec 15 2021 at 23:37)</a>:</h4>
<p>The visitor is one of the reasons I'm not comfortable writing a deserializer :/. I really don't understand the documentation that well yet. Hopefully some day :). I really liked your implementation - so, it won't work for my usecase?</p>



<a name="265113114"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/serde%3A%20deserialize%20from%20bincode%20and%20JSON%20with%20different%20code/near/265113114" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Félix Saparelli <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/serde.3A.20deserialize.20from.20bincode.20and.20JSON.20with.20different.20code.html#265113114">(Dec 16 2021 at 05:09)</a>:</h4>
<p>Not that I know of. You could work around it by having a wrapped version of the struct that you use for decoding from JSON.</p>



<a name="265113401"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/serde%3A%20deserialize%20from%20bincode%20and%20JSON%20with%20different%20code/near/265113401" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Félix Saparelli <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/serde.3A.20deserialize.20from.20bincode.20and.20JSON.20with.20different.20code.html#265113401">(Dec 16 2021 at 05:15)</a>:</h4>
<p>Here: <a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2021&amp;gist=7cf860396308c525358fc0176435d858">https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2021&amp;gist=7cf860396308c525358fc0176435d858</a></p>
<p>I use toml for the tests because bincode isn't available in the playground, but it will work with every serde data format.</p>



<a name="265114187"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/serde%3A%20deserialize%20from%20bincode%20and%20JSON%20with%20different%20code/near/265114187" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Félix Saparelli <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/serde.3A.20deserialize.20from.20bincode.20and.20JSON.20with.20different.20code.html#265114187">(Dec 16 2021 at 05:32)</a>:</h4>
<p>You also don't need to have Serialize derived on the wrapper struct, now that I think about it</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>