<html>
<head><meta charset="utf-8"><title>AdamH · new members · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/AdamH.html">AdamH</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="256110538"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/AdamH/near/256110538" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> AdamH <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/AdamH.html#256110538">(Oct 04 2021 at 18:42)</a>:</h4>
<p>Hi all! </p>
<p>Just posting a little thread to introduce myself, as I'll probably be around a fair bit over the coming few days!  </p>
<p>I'm a compiler dev, based in Scotland, working for a hardware/chip company. One of my projects in the near future is to try and get Rust working with our architecture, which means lots of compiler hacking on rustc, and probably some library hacking too. We already have a fairly mature C compiler based on llvm, so I'm hoping to be able to sort-of slot our llvm branch into the rust compiler and run from there.</p>
<p>Apologies if I ask questions in the wrong places while I get my bearings.</p>
<p>Cheers!</p>



<a name="256111091"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/AdamH/near/256111091" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> AdamH <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/AdamH.html#256111091">(Oct 04 2021 at 18:45)</a>:</h4>
<p>As an aside, while I'm primarily going to be concerned with the compiler side, I'm also interested in talking with people about how designing APIs that support single(ish)-source rust running on a host+coprocessor. At present our C API takes a hard-coded string that points to a compiled kernel, which is rather delicate. One of our strategic hopes with Rust is to be able to provide a nicer API, and hopefully provide well-typed APIs between our host and kernel code.</p>



<a name="256148075"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/AdamH/near/256148075" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/AdamH.html#256148075">(Oct 04 2021 at 23:09)</a>:</h4>
<p>I would love to talk more about that! I'm quite interested in common codebases that span multiple systems communicating via shared memory.</p>



<a name="256148083"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/AdamH/near/256148083" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/AdamH.html#256148083">(Oct 04 2021 at 23:09)</a>:</h4>
<p>You may be interested in the artifact dependencies RFC.</p>



<a name="256148096"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/AdamH/near/256148096" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/AdamH.html#256148096">(Oct 04 2021 at 23:09)</a>:</h4>
<p>Which chip company?</p>



<a name="256148109"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/AdamH/near/256148109" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/AdamH.html#256148109">(Oct 04 2021 at 23:09)</a>:</h4>
<p>And what is the status of getting your LLVM changes upstream?</p>



<a name="256190613"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/AdamH/near/256190613" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> AdamH <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/AdamH.html#256190613">(Oct 05 2021 at 07:33)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/122652-new-members/topic/AdamH/near/256148083">said</a>:</p>
<blockquote>
<p>You may be interested in the artifact dependencies RFC.</p>
</blockquote>
<p>I shall look into it! Would you be able to send me a link to it?</p>



<a name="256190816"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/AdamH/near/256190816" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> AdamH <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/AdamH.html#256190816">(Oct 05 2021 at 07:35)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/122652-new-members/topic/AdamH/near/256148096">said</a>:</p>
<blockquote>
<p>Which chip company?</p>
</blockquote>
<p>I work for "UPMEM" - we're quite a small-ish startup, working on in-memory computing. We're not planning on upstreaming any of our LLVM changes in the near future, as they're almost entirely in our target, and we have some dependencies on closed-source/in house libraries that would be difficult to make public.</p>



<a name="256203839"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/AdamH/near/256203839" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/AdamH.html#256203839">(Oct 05 2021 at 09:33)</a>:</h4>
<p>Have you seen <a href="https://github.com/geobacter-rs/geobacter">https://github.com/geobacter-rs/geobacter</a>? It does single source for gpu compute. It does need some changes to rustc itself though to achieve this.</p>



<a name="256249245"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/AdamH/near/256249245" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/AdamH.html#256249245">(Oct 05 2021 at 13:55)</a>:</h4>
<p><span class="user-mention" data-user-id="209804">@AdamH</span> Note that that means you won't be able to get your target upstream, either.</p>



<a name="256255954"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/AdamH/near/256255954" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> AdamH <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/AdamH.html#256255954">(Oct 05 2021 at 14:33)</a>:</h4>
<p>From what I understood, we should be able to get in as a tier 3 target, as we don't mind failing in upstream, but would like to avoid major code churn. That said, I'm not at the stage where I'm thinking about upstreaming any of our code as a) it doesn't work yet, and b) we need to work out our upstreaming policy for LLVM first. Once that's all in place though, I'm going to be talking to <span class="user-mention" data-user-id="116107">@davidtwco</span> about what the steps for upstreaming are, what we'll specifically need to do, and where we will be able to slot in. Thanks for your concern though!</p>



<a name="256256047"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/AdamH/near/256256047" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> AdamH <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/AdamH.html#256256047">(Oct 05 2021 at 14:34)</a>:</h4>
<p><span class="user-mention silent" data-user-id="133247">bjorn3</span> <a href="#narrow/stream/122652-new-members/topic/AdamH/near/256203839">said</a>:</p>
<blockquote>
<p>Have you seen <a href="https://github.com/geobacter-rs/geobacter">https://github.com/geobacter-rs/geobacter</a>? It does single source for gpu compute. It does need some changes to rustc itself though to achieve this.</p>
</blockquote>
<p>I have not, which I'm somewhat surprised by as I used to live in the single-source-gpu-computing world. I'll check it out, thanks!</p>



<a name="256256507"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/AdamH/near/256256507" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/AdamH.html#256256507">(Oct 05 2021 at 14:36)</a>:</h4>
<p><span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span> was super confused for a moment until I recognized the name</p>



<a name="256256634"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/AdamH/near/256256634" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> AdamH <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/AdamH.html#256256634">(Oct 05 2021 at 14:37)</a>:</h4>
<p>The day of reckoning that we spoke of is almost upon us!</p>



<a name="256260261"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/AdamH/near/256260261" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/AdamH.html#256260261">(Oct 05 2021 at 14:55)</a>:</h4>
<p><span class="user-mention" data-user-id="209804">@AdamH</span> A proprietary codegen backend would be an issue even for a tier 3 target.</p>



<a name="256260316"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/AdamH/near/256260316" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/AdamH.html#256260316">(Oct 05 2021 at 14:55)</a>:</h4>
<p>(I wrote the policy in question, and that was very much the intent.)</p>



<a name="256260341"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/AdamH/near/256260341" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> AdamH <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/AdamH.html#256260341">(Oct 05 2021 at 14:55)</a>:</h4>
<p>Ah, my apologies, it does appear that I misunderstood!</p>



<a name="256260463"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/AdamH/near/256260463" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/AdamH.html#256260463">(Oct 05 2021 at 14:56)</a>:</h4>
<p>But if you're interested in working towards an open source codegen backend, I have a lot of experience helping codebases get in shape to become open, and I would be happy to help with that.</p>



<a name="256260539"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/AdamH/near/256260539" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> AdamH <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/AdamH.html#256260539">(Oct 05 2021 at 14:56)</a>:</h4>
<p>I would note, however, that our LLVM fork is "open" (<a href="https://github.com/upmem/llvm-project/">https://github.com/upmem/llvm-project/</a>). The issue is that compiling it (at present) relies on some runtime libraries that are currently closed source.</p>



<a name="256260665"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/AdamH/near/256260665" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/AdamH.html#256260665">(Oct 05 2021 at 14:57)</a>:</h4>
<p>That's effectively equivalent, from a policy perspective.</p>



<a name="256260745"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/AdamH/near/256260745" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> AdamH <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/AdamH.html#256260745">(Oct 05 2021 at 14:57)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/122652-new-members/topic/AdamH/near/256260463">said</a>:</p>
<blockquote>
<p>But if you're interested in working towards an open source codegen backend, I have a lot of experience helping codebases get in shape to become open, and I would be happy to help with that.</p>
</blockquote>
<p>That's a very kind offer, thank you! At present the issue is mostly political (working out how we can open-source our proprietary code, and also <em>whether</em> we can), rather than code based, so it may be a while until we can open that.</p>



<a name="256262463"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/AdamH/near/256262463" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/AdamH.html#256262463">(Oct 05 2021 at 15:07)</a>:</h4>
<p>FWIW, "how" and "whether" are things I can help with, professionally; I've done that exact work for a company of 100k people. :)</p>



<a name="256301379"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/AdamH/near/256301379" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/AdamH.html#256301379">(Oct 05 2021 at 19:07)</a>:</h4>
<p><span class="user-mention" data-user-id="209804">@Adam Brouwers-Harries</span> Interesting, If you are used to using CUDA, i am currently working on a codegen backend which targets the libnvvm CUDA library, currently (in my limited tests) it works and builds all the kernels ive thrown at it, with speed matching cuda c/c++ (because libnvvm is the same thing nvcc uses). So if you are interested in using rust for everything this may be an option for you once i release it. Obviously it only works on nvidia gpus, but it has a really nice API for launching and building kernels. And most of CUDA's features are available in it, like unified memory, graphs, etc.</p>



<a name="256301613"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/AdamH/near/256301613" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/AdamH.html#256301613">(Oct 05 2021 at 19:09)</a>:</h4>
<p>If you'd like to see an example of the API, there is an example here: <a href="https://gist.github.com/RDambrosio016/40676d9414c4e8092eb406c020dc410c">https://gist.github.com/RDambrosio016/40676d9414c4e8092eb406c020dc410c</a></p>



<a name="256302793"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/AdamH/near/256302793" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/AdamH.html#256302793">(Oct 05 2021 at 19:17)</a>:</h4>
<p>You <em>can</em> use a single crate because cuda_std builds on non-nvptx and kernel cfg-gates the function for nvptx, but its usually easier to use a separate gpu-kernels crate. Since the codegen will compile the crate and then emit a ptx file which can then be loaded and ran with <code>cust</code></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>