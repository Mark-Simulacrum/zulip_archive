<html>
<head><meta charset="utf-8"><title>use where instead of impl · new members · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/use.20where.20instead.20of.20impl.html">use where instead of impl</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="264207461"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/use%20where%20instead%20of%20impl/near/264207461" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Siegel <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/use.20where.20instead.20of.20impl.html#264207461">(Dec 08 2021 at 19:29)</a>:</h4>
<p>This function works; it adapts any iterator into another one that yields every other element:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">evens</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">iter</span>: <span class="nc">impl</span><span class="w"> </span><span class="nb">Iterator</span><span class="o">&lt;</span><span class="n">Item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">impl</span><span class="w"> </span><span class="nb">Iterator</span><span class="o">&lt;</span><span class="n">Item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">iter</span><span class="p">.</span><span class="n">enumerate</span><span class="p">().</span><span class="n">filter</span><span class="p">(</span><span class="o">|</span><span class="n">i</span><span class="o">|</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">).</span><span class="n">map</span><span class="p">(</span><span class="o">|</span><span class="n">i</span><span class="o">|</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>It bothers me slightly that <code>impl Iterator&lt;Item = T&gt;</code> is duplicated. I thought I could just rewrite it as:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">evens</span><span class="o">&lt;</span><span class="n">I</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">iter</span>: <span class="nc">T</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">T</span><span class="w"></span>
<span class="k">where</span><span class="w"></span>
<span class="w">    </span><span class="n">T</span>: <span class="nb">Iterator</span><span class="o">&lt;</span><span class="n">Item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">I</span><span class="o">&gt;</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">iter</span><span class="p">.</span><span class="n">enumerate</span><span class="p">().</span><span class="n">filter</span><span class="p">(</span><span class="o">|</span><span class="n">i</span><span class="o">|</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">).</span><span class="n">map</span><span class="p">(</span><span class="o">|</span><span class="n">i</span><span class="o">|</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>But that fails with <code>expected type parameter `T`, found struct `std::iter::Map`.</code> Is there a way to factor out the trait specification?</p>



<a name="264208463"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/use%20where%20instead%20of%20impl/near/264208463" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/use.20where.20instead.20of.20impl.html#264208463">(Dec 08 2021 at 19:36)</a>:</h4>
<p>I don't think so, no - the iterator you're accepting and returning have different types</p>



<a name="264208511"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/use%20where%20instead%20of%20impl/near/264208511" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/use.20where.20instead.20of.20impl.html#264208511">(Dec 08 2021 at 19:37)</a>:</h4>
<p>(this would work fine if the function body were just <code>iter</code>)</p>



<a name="264208611"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/use%20where%20instead%20of%20impl/near/264208611" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Khionu Sybiern <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/use.20where.20instead.20of.20impl.html#264208611">(Dec 08 2021 at 19:37)</a>:</h4>
<p>It might help to understand how functions like filter and map work</p>



<a name="264208681"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/use%20where%20instead%20of%20impl/near/264208681" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/use.20where.20instead.20of.20impl.html#264208681">(Dec 08 2021 at 19:38)</a>:</h4>
<p>Also, this function could just be <code>iter.step_by(2)</code><br>
<a href="https://doc.rust-lang.org/std/iter/trait.Iterator.html#method.step_by">https://doc.rust-lang.org/std/iter/trait.Iterator.html#method.step_by</a></p>



<a name="264208719"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/use%20where%20instead%20of%20impl/near/264208719" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Khionu Sybiern <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/use.20where.20instead.20of.20impl.html#264208719">(Dec 08 2021 at 19:38)</a>:</h4>
<p>They're lazily evaluated, so they have to encapsulate the logic in a new object that wraps the former iterator</p>



<a name="264208787"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/use%20where%20instead%20of%20impl/near/264208787" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Khionu Sybiern <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/use.20where.20instead.20of.20impl.html#264208787">(Dec 08 2021 at 19:39)</a>:</h4>
<p>So, <code>iter.filter(...).map(...)</code> returns a <code>Map&lt;Filter&lt;...&gt;&gt;</code> roughly speaking</p>



<a name="264208879"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/use%20where%20instead%20of%20impl/near/264208879" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Siegel <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/use.20where.20instead.20of.20impl.html#264208879">(Dec 08 2021 at 19:40)</a>:</h4>
<p>I think my confusion is between trait and type, and so the duplication I was seeing is illusory. They're the same trait, but two different types so two different impl.</p>



<a name="264208937"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/use%20where%20instead%20of%20impl/near/264208937" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Khionu Sybiern <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/use.20where.20instead.20of.20impl.html#264208937">(Dec 08 2021 at 19:40)</a>:</h4>
<p>Exactly</p>



<a name="264209236"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/use%20where%20instead%20of%20impl/near/264209236" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Siegel <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/use.20where.20instead.20of.20impl.html#264209236">(Dec 08 2021 at 19:42)</a>:</h4>
<p>Hmm, I still can't translate it into a where, though? <a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=3b59ae3b1a9dd15908ce989d72553055">https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=3b59ae3b1a9dd15908ce989d72553055</a></p>



<a name="264209348"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/use%20where%20instead%20of%20impl/near/264209348" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Siegel <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/use.20where.20instead.20of.20impl.html#264209348">(Dec 08 2021 at 19:43)</a>:</h4>
<p><code>expected type parameter `T`, found struct `Map` </code></p>



<a name="264209403"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/use%20where%20instead%20of%20impl/near/264209403" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Parth Nobel <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/use.20where.20instead.20of.20impl.html#264209403">(Dec 08 2021 at 19:43)</a>:</h4>
<p>Your code is not generic over the return type. There is a specific type it always returns,  <code>Map</code>.</p>



<a name="264209577"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/use%20where%20instead%20of%20impl/near/264209577" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Parth Nobel <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/use.20where.20instead.20of.20impl.html#264209577">(Dec 08 2021 at 19:45)</a>:</h4>
<p>Return position impl traits aren't generics, they're automatically filled in opaque type aliases. i.e. they have a concrete fixed value at compilation, but the caller can't name that type.</p>



<a name="264209735"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/use%20where%20instead%20of%20impl/near/264209735" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Siegel <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/use.20where.20instead.20of.20impl.html#264209735">(Dec 08 2021 at 19:46)</a>:</h4>
<p>OK. Very good explanations, thank you!</p>



<a name="264209747"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/use%20where%20instead%20of%20impl/near/264209747" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Parth Nobel <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/use.20where.20instead.20of.20impl.html#264209747">(Dec 08 2021 at 19:46)</a>:</h4>
<p>This gives you API flexibility to change the return type without breaking dependent code, but you still need to have a concrete return type not a generic one.</p>



<a name="264209787"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122652-new%20members/topic/use%20where%20instead%20of%20impl/near/264209787" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122652-new-members/topic/use.20where.20instead.20of.20impl.html#264209787">(Dec 08 2021 at 19:46)</a>:</h4>
<p>(here's the version with step_by: <a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=2cd12c7bedba3b201f5d04e976fdce3d">https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=2cd12c7bedba3b201f5d04e976fdce3d</a>)</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>