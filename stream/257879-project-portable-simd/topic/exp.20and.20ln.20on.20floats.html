<html>
<head><meta charset="utf-8"><title>exp and ln on floats · project-portable-simd · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/index.html">project-portable-simd</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/exp.20and.20ln.20on.20floats.html">exp and ln on floats</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="266757475"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/exp%20and%20ln%20on%20floats/near/266757475" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Fredemus <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/exp.20and.20ln.20on.20floats.html#266757475">(Jan 04 2022 at 01:01)</a>:</h4>
<p>Hey, I'm trying to move my project from using packed_simd to portable_simd and it was mostly painless, but I need to call exp() and ln() on a <code>f32x4</code>, which doesn't seem possible. Is it just not implemented yet? I could find something that looked sorta right under <code>core_arch::simd_llvm</code> but I have no idea how to use it lol</p>
<p>Apologies if this isn't the right place to ask questions</p>



<a name="266757625"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/exp%20and%20ln%20on%20floats/near/266757625" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/exp.20and.20ln.20on.20floats.html#266757625">(Jan 04 2022 at 01:03)</a>:</h4>
<p>the plan is to eventually have those, but the implementation isn't finished yet, see <a href="https://github.com/rust-lang/portable-simd/issues/109">https://github.com/rust-lang/portable-simd/issues/109</a></p>



<a name="266758222"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/exp%20and%20ln%20on%20floats/near/266758222" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Fredemus <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/exp.20and.20ln.20on.20floats.html#266758222">(Jan 04 2022 at 01:11)</a>:</h4>
<p>Oh okay thanks. Should I just stick to packed_simd for now then?</p>



<a name="266758445"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/exp%20and%20ln%20on%20floats/near/266758445" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/exp.20and.20ln.20on.20floats.html#266758445">(Jan 04 2022 at 01:14)</a>:</h4>
<p>probably... sorry.</p>



<a name="266758655"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/exp%20and%20ln%20on%20floats/near/266758655" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Fredemus <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/exp.20and.20ln.20on.20floats.html#266758655">(Jan 04 2022 at 01:18)</a>:</h4>
<p>No worries!</p>



<a name="266758697"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/exp%20and%20ln%20on%20floats/near/266758697" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/exp.20and.20ln.20on.20floats.html#266758697">(Jan 04 2022 at 01:18)</a>:</h4>
<p>tho another way you could do it if you don't mind a scalar implementation is <code>f32x4::from_array(x.to_array().map(f32::exp))</code></p>



<a name="266758823"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/exp%20and%20ln%20on%20floats/near/266758823" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Fredemus <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/exp.20and.20ln.20on.20floats.html#266758823">(Jan 04 2022 at 01:20)</a>:</h4>
<p>That'll be very nice as a placeholder, thank you!</p>



<a name="266853537"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/exp%20and%20ln%20on%20floats/near/266853537" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Denis Golovan <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/exp.20and.20ln.20on.20floats.html#266853537">(Jan 04 2022 at 19:43)</a>:</h4>
<p>Hi all.<br>
Perhaps I am doing something wrong, but I cannot cast Mask&lt;i32, 4&gt; into Mask&lt;isize, 4&gt;</p>



<a name="266853569"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/exp%20and%20ln%20on%20floats/near/266853569" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Denis Golovan <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/exp.20and.20ln.20on.20floats.html#266853569">(Jan 04 2022 at 19:43)</a>:</h4>
<div class="codehilite"><pre><span></span><code>use core_simd::*;

#[target_feature(enable = &quot;avx&quot;)]
#[target_feature(enable = &quot;avx2&quot;)]
#[inline(never)]
fn test(input: &amp;[i32], ginput: &amp;[usize], grp_sum: &amp;mut [f64], cnt: &amp;mut [i64]) {
    const S: usize = 4;
    let null = Simd::&lt;i32, S&gt;::splat(999);
    let zero = Simd::&lt;f64, S&gt;::splat(0.0);
    //let enable: Mask&lt;isize, _&gt; = Mask::from_array([true, true, true, true]);

    let i = 0;

    let gix_chunk = Simd::&lt;usize, S&gt;::from_slice(&amp;ginput[i..i + S]);
    let val_chunk = Simd::&lt;i32, S&gt;::from_slice(&amp;input[i..i + S]);

    let nnulllx = Mask::&lt;isize, S&gt;::from(val_chunk.lanes_ne(null));   // &lt;- this line causes ICE on latest nightly
...
}
</code></pre></div>



<a name="266853724"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/exp%20and%20ln%20on%20floats/near/266853724" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Denis Golovan <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/exp.20and.20ln.20on.20floats.html#266853724">(Jan 04 2022 at 19:44)</a>:</h4>
<p>Compiler just crashes. Is there any walk-around ?</p>



<a name="266853752"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/exp%20and%20ln%20on%20floats/near/266853752" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/exp.20and.20ln.20on.20floats.html#266853752">(Jan 04 2022 at 19:45)</a>:</h4>
<p>It definitely shouldn't crash!</p>



<a name="266853773"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/exp%20and%20ln%20on%20floats/near/266853773" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Denis Golovan <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/exp.20and.20ln.20on.20floats.html#266853773">(Jan 04 2022 at 19:45)</a>:</h4>
<div class="codehilite"><pre><span></span><code>thread &#39;rustc&#39; panicked at &#39;called `Option::unwrap()` on a `None` value&#39;, compiler/rustc_codegen_llvm/src/intrinsic.rs:1724:60
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace

error: internal compiler error: unexpected panic

note: the compiler unexpectedly panicked. this is a bug.

note: we would appreciate a bug report: https://github.com/rust-lang/rust/issues/new?labels=C-bug%2C+I-ICE%2C+T-compiler&amp;template=ice.md

note: rustc 1.59.0-nightly (399ba6bb3 2022-01-03) running on x86_64-unknown-linux-gnu

note: compiler flags: -Z share-generics=y -C embed-bitcode=no -C debuginfo=2 -C link-args=-fuse-ld=lld --crate-type bin

note: some of the compiler flags provided by cargo are hidden
</code></pre></div>



<a name="266853828"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/exp%20and%20ln%20on%20floats/near/266853828" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/exp.20and.20ln.20on.20floats.html#266853828">(Jan 04 2022 at 19:45)</a>:</h4>
<p>I believe it's because it's an isize, I have a PR open that should fix it</p>



<a name="266853945"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/exp%20and%20ln%20on%20floats/near/266853945" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Denis Golovan <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/exp.20and.20ln.20on.20floats.html#266853945">(Jan 04 2022 at 19:46)</a>:</h4>
<p>Which one? I'd like to subscribe to it</p>



<a name="266854040"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/exp%20and%20ln%20on%20floats/near/266854040" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/exp.20and.20ln.20on.20floats.html#266854040">(Jan 04 2022 at 19:47)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/issues/92425">#92425</a></p>



<a name="266854164"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/exp%20and%20ln%20on%20floats/near/266854164" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Denis Golovan <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/exp.20and.20ln.20on.20floats.html#266854164">(Jan 04 2022 at 19:48)</a>:</h4>
<p>Ok. Thanks</p>



<a name="266874564"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/exp%20and%20ln%20on%20floats/near/266874564" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/exp.20and.20ln.20on.20floats.html#266874564">(Jan 04 2022 at 22:42)</a>:</h4>
<p><strong>amazing</strong>, how isn't that monomorphized?</p>



<a name="266874591"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/exp%20and%20ln%20on%20floats/near/266874591" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/exp.20and.20ln.20on.20floats.html#266874591">(Jan 04 2022 at 22:43)</a>:</h4>
<p>Oh it crashes <strong>in mono</strong> got it.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>