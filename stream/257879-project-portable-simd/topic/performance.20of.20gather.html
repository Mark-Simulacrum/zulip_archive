<html>
<head><meta charset="utf-8"><title>performance of gather · project-portable-simd · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/index.html">project-portable-simd</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/performance.20of.20gather.html">performance of gather</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="262639719"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/performance%20of%20gather/near/262639719" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jorge Leitao <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/performance.20of.20gather.html#262639719">(Nov 24 2021 at 20:59)</a>:</h4>
<p>Hi, I am continuing my investigation activities over performance, and I am trying to understand why core_simd is only marginally better:</p>
<p>The following code <a href="https://github.com/DataEngineeringLabs/simd-benches/pull/1/files">https://github.com/DataEngineeringLabs/simd-benches/pull/1/files</a> using </p>
<p><code>RUSTFLAGS="-C target-cpu=native" cargo bench --bench take -- "2\^20"</code></p>
<p>yields</p>
<div class="codehilite"><pre><span></span><code>core_simd_take 2^20 f32 time:   [1.9402 ms 1.9508 ms 1.9672 ms]
naive_take 2^20 f32     time:   [2.2779 ms 2.2856 ms 2.2938 ms]
</code></pre></div>
<p>which is a 10% improvement. Any ideas on how I am using the API incorrectly?</p>



<a name="262640121"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/performance%20of%20gather/near/262640121" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jorge Leitao <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/performance.20of.20gather.html#262640121">(Nov 24 2021 at 21:02)</a>:</h4>
<p>on compiler explorer: <a href="https://rust.godbolt.org/z/KbTs7ahPz">https://rust.godbolt.org/z/KbTs7ahPz</a></p>



<a name="262640143"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/performance%20of%20gather/near/262640143" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/performance.20of.20gather.html#262640143">(Nov 24 2021 at 21:03)</a>:</h4>
<p>i'd expect that level of performance, cuz simd gather on x86 is basically not any faster than repeated scalar loads</p>



<a name="262640551"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/performance%20of%20gather/near/262640551" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/performance.20of.20gather.html#262640551">(Nov 24 2021 at 21:07)</a>:</h4>
<p>so, unless you target the right cpu, llvm won't generate gather instructions cuz they aren't faster</p>



<a name="262640745"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/performance%20of%20gather/near/262640745" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jorge Leitao <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/performance.20of.20gather.html#262640745">(Nov 24 2021 at 21:09)</a>:</h4>
<p>could you clarify what do you mean with the right cpu? Isn't native aimed at that? (sorry if is a silly question, this whole part is a bit new to me)</p>



<a name="262640807"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/performance%20of%20gather/near/262640807" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/performance.20of.20gather.html#262640807">(Nov 24 2021 at 21:09)</a>:</h4>
<p>pick a cpu where gather instructions are actually faster, so llvm will generate them rather than just a sequence of scalar loads</p>



<a name="262640871"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/performance%20of%20gather/near/262640871" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/performance.20of.20gather.html#262640871">(Nov 24 2021 at 21:10)</a>:</h4>
<p>example: <a href="https://rust.godbolt.org/z/87fvPYdx1">https://rust.godbolt.org/z/87fvPYdx1</a></p>



<a name="262640938"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/performance%20of%20gather/near/262640938" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/performance.20of.20gather.html#262640938">(Nov 24 2021 at 21:11)</a>:</h4>
<p>if your running on zen3, gather isn't all that likely to give you extra performance</p>



<a name="262641126"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/performance%20of%20gather/near/262641126" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/performance.20of.20gather.html#262641126">(Nov 24 2021 at 21:13)</a>:</h4>
<p>native just gives you whatever cpu you ran the compiler on</p>



<a name="262641388"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/performance%20of%20gather/near/262641388" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/performance.20of.20gather.html#262641388">(Nov 24 2021 at 21:17)</a>:</h4>
<p><span class="user-mention silent" data-user-id="399416">Jorge Leitao</span> <a href="#narrow/stream/257879-project-portable-simd/topic/performance.20of.20gather/near/262639719">said</a>:</p>
<blockquote>
<p>Hi, I am continuing my investigation activities over performance, and I am trying to understand why core_simd is only marginally better:</p>
<p>The following code <a href="https://github.com/DataEngineeringLabs/simd-benches/pull/1/files">https://github.com/DataEngineeringLabs/simd-benches/pull/1/files</a> using </p>
<p><code>RUSTFLAGS="-C target-cpu=native" cargo bench --bench take -- "2\^20"</code></p>
<p>yields</p>
<div class="codehilite"><pre><span></span><code>core_simd_take 2^20 f32 time:   [1.9402 ms 1.9508 ms 1.9672 ms]
naive_take 2^20 f32     time:   [2.2779 ms 2.2856 ms 2.2938 ms]
</code></pre></div>
<p>which is a 10% improvement. Any ideas on how I am using the API incorrectly?</p>
</blockquote>
<p>Gather is in fact that marginal of an improvement on some CPUs.</p>



<a name="262641519"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/performance%20of%20gather/near/262641519" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jorge Leitao <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/performance.20of.20gather.html#262641519">(Nov 24 2021 at 21:19)</a>:</h4>
<p><code>rustc --print target-cpus</code> -&gt; <code>native         - Select the CPU of the current host (currently skylake-avx512).</code> so I am already using skylake-avx512</p>



<a name="262641525"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/performance%20of%20gather/near/262641525" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/performance.20of.20gather.html#262641525">(Nov 24 2021 at 21:19)</a>:</h4>
<p>on zen3, from what I can tell, llvm decides gather instructions are slow enough that itjust generates scalar loads instead</p>



<a name="262642359"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/performance%20of%20gather/near/262642359" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jorge Leitao <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/performance.20of.20gather.html#262642359">(Nov 24 2021 at 21:29)</a>:</h4>
<p>is there an <code>unsafe</code>-free way of performing the operation without allocating zeros? I.e. something like </p>
<div class="codehilite"><pre><span></span><code>    let mut result = Vec::&lt;f32&gt;::with_capacity(indices.len());
    unsafe { result.set_len(indices.len()) }; // not safe; need MaybeUninit
    let result_chunks = result.chunks_exact_mut(8);
    chunks.zip(result_chunks).for_each(|(chunk, r_chunk)| {
        let idxs: [usize; 8] = chunk.try_into().unwrap();
        let idxs: usizex8 = usizex8::from_array(idxs);

        let r = Simd::gather_or_default(&amp;values, idxs);
        let r: [f32; 8] = r.to_array();

        let r_chunk: &amp;mut [f32; 8] = r_chunk.try_into().unwrap();
        *r_chunk = r;
    });
</code></pre></div>
<p>we need to collect multiple lanes to the same vector and we know the op is infallible. (the above saves an extra 10%, but is likely unsound)</p>



<a name="262643234"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/performance%20of%20gather/near/262643234" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/performance.20of.20gather.html#262643234">(Nov 24 2021 at 21:39)</a>:</h4>
<p>I also would note that the specific thing you are doing there seems like something that is very easy for LLVM to optimize already, whereas hardware gather instructions can be microarchitecturally optimized to have decent performance under stranger circumstances.</p>
<p>It's an instruction which paradoxically works "against the grain" of what the CPU "wants", by nature (it would rather just load cache lines, you see), so software can be almost as good at it.</p>



<a name="262643341"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/performance%20of%20gather/near/262643341" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/performance.20of.20gather.html#262643341">(Nov 24 2021 at 21:40)</a>:</h4>
<p><span class="user-mention silent" data-user-id="399416">Jorge Leitao</span> <a href="#narrow/stream/257879-project-portable-simd/topic/performance.20of.20gather/near/262642359">said</a>:</p>
<blockquote>
<p>is there an <code>unsafe</code>-free way of performing the operation without allocating zeros? I.e. something like <br>
...<br>
we need to collect multiple lanes to the same vector and we know the op is infallible. (the above saves an extra 10%, but is likely unsound)</p>
</blockquote>
<p>"without allocating zeros"?</p>



<a name="262643602"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/performance%20of%20gather/near/262643602" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jorge Leitao <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/performance.20of.20gather.html#262643602">(Nov 24 2021 at 21:44)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281757">Jubilee</span> <a href="#narrow/stream/257879-project-portable-simd/topic/performance.20of.20gather/near/262643341">said</a>:</p>
<blockquote>
<p>"without allocating zeros"?</p>
</blockquote>
<p>the <code>unsafe</code>-free version is <code>vec![0; indices.len()]</code>, which calls <code>alloc::alloc_zeroed</code>. With <code>.collect</code> it calls <code>alloc::alloc</code> and writes to the region. The code I posted calls <code>alloc</code>, but is unsound because it creates a slice of un-initialized.</p>



<a name="262643753"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/performance%20of%20gather/near/262643753" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/performance.20of.20gather.html#262643753">(Nov 24 2021 at 21:45)</a>:</h4>
<p>I see... does it get better if you just call <code>.extend</code> repeatedly, by any chance?</p>



<a name="262643836"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/performance%20of%20gather/near/262643836" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jorge Leitao <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/performance.20of.20gather.html#262643836">(Nov 24 2021 at 21:46)</a>:</h4>
<p>Thanks. The thing is that the op I wrote here is a major bottleneck in virtually every row-base operation in columnar formats (so major bottleneck in both <a href="https://github.com/pola-rs/polars">https://github.com/pola-rs/polars</a> and <a href="https://github.com/apache/datafusion">https://github.com/apache/datafusion</a>); so it is a high-valuable target ^_^</p>



<a name="262643926"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/performance%20of%20gather/near/262643926" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/performance.20of.20gather.html#262643926">(Nov 24 2021 at 21:47)</a>:</h4>
<p><a href="https://doc.rust-lang.org/std/iter/trait.Extend.html#tymethod.extend">https://doc.rust-lang.org/std/iter/trait.Extend.html#tymethod.extend</a> this little method</p>



<a name="262644009"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/performance%20of%20gather/near/262644009" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jorge Leitao <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/performance.20of.20gather.html#262644009">(Nov 24 2021 at 21:48)</a>:</h4>
<p>using extend: +41.539% xD. Which makes sense because <code>extend</code> requires a <code>reserve</code> call.</p>



<a name="262644055"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/performance%20of%20gather/near/262644055" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/performance.20of.20gather.html#262644055">(Nov 24 2021 at 21:49)</a>:</h4>
<p>Oof, I was hoping the reserve would be elided due to the previous <code>with_capacity</code></p>



<a name="262644484"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/performance%20of%20gather/near/262644484" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jorge Leitao <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/performance.20of.20gather.html#262644484">(Nov 24 2021 at 21:54)</a>:</h4>
<p>good point. The compiler does have all the information to elide it, since the iterator is TrustedLen and the extend is of known size, but for some reason it does not.</p>



<a name="262644536"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/performance%20of%20gather/near/262644536" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/performance.20of.20gather.html#262644536">(Nov 24 2021 at 21:55)</a>:</h4>
<p>does <code>array_chunks</code> improve the <code>unsafe</code> version?</p>



<a name="262644857"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/performance%20of%20gather/near/262644857" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jorge Leitao <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/performance.20of.20gather.html#262644857">(Nov 24 2021 at 21:59)</a>:</h4>
<p>I do not understand: I just re-compiled the same code and now there is a -50% improvement over naive take. <span aria-label="boom" class="emoji emoji-1f4a5" role="img" title="boom">:boom:</span></p>



<a name="262644873"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/performance%20of%20gather/near/262644873" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/performance.20of.20gather.html#262644873">(Nov 24 2021 at 21:59)</a>:</h4>
<p>lmao what</p>



<a name="262644880"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/performance%20of%20gather/near/262644880" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/performance.20of.20gather.html#262644880">(Nov 24 2021 at 21:59)</a>:</h4>
<p>"same" code?</p>



<a name="262645074"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/performance%20of%20gather/near/262645074" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jorge Leitao <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/performance.20of.20gather.html#262645074">(Nov 24 2021 at 22:01)</a>:</h4>
<p>nvmd, I am being dumb. Time to go to bed and look through this tomorrow again. Good thanksgiving for US.</p>



<a name="262645312"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/performance%20of%20gather/near/262645312" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/performance.20of.20gather.html#262645312">(Nov 24 2021 at 22:04)</a>:</h4>
<p>Enjoy!</p>



<a name="262669206"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/performance%20of%20gather/near/262669206" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jorge Leitao <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/performance.20of.20gather.html#262669206">(Nov 25 2021 at 05:42)</a>:</h4>
<p>Ok, I've went through the benches again and I was doing a mistake. The correct values on my skylake-avx512 are:</p>
<div class="codehilite"><pre><span></span><code># take with no &quot;null&quot; indices
core_simd_take 2^20 f32 time:   [911.13 us 912.21 us 913.33 us]
naive_take 2^20 f32     time:   [912.39 us 915.22 us 918.41 us]

# take with 10% of the indices &quot;null&quot; (using a bitmap)
core_simd_take_nulls 2^20 f32   time:   [950.40 us 954.08 us 958.88 us]
naive_take_nulls 2^20 f32       time:   [2.3714 ms 2.3968 ms 2.4296 ms]
</code></pre></div>
<p>i.e. there is a factor of 2 on the latter :)</p>



<a name="262693918"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/performance%20of%20gather/near/262693918" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/performance.20of.20gather.html#262693918">(Nov 25 2021 at 11:21)</a>:</h4>
<p>aha.</p>



<a name="262694060"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/performance%20of%20gather/near/262694060" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/performance.20of.20gather.html#262694060">(Nov 25 2021 at 11:22)</a>:</h4>
<p>And that's with <code>Simd::gather_or_default</code>? Nice.</p>
<p>In a way, this kind of demonstrates the point I was making about how it's not necessarily about having much faster performance than naive sequential loading but about retaining that performance in adverse circumstances.</p>



<a name="262740056"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/performance%20of%20gather/near/262740056" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/performance.20of.20gather.html#262740056">(Nov 25 2021 at 20:49)</a>:</h4>
<p>( I should also note that my understanding is AVX512 perf is <strong>much</strong> better on Ice Lake in general... Skylake is one where it's still kinda marginal on in general. This is of course to be expected since Ice Lake is what was made to replace Skylake and all its revisions. )</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>