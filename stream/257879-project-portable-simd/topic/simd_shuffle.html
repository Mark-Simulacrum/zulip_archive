<html>
<head><meta charset="utf-8"><title>simd_shuffle · project-portable-simd · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/index.html">project-portable-simd</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/simd_shuffle.html">simd_shuffle</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="252909163"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/simd_shuffle/near/252909163" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/simd_shuffle.html#252909163">(Sep 11 2021 at 13:20)</a>:</h4>
<p>I'm finally putting together a PR for a generic <code>simd_shuffle</code> intrinsic that doesn't take the length as part of the name (<code>simd_shuffle4</code>, etc).  It should fix some of our generics, and also allow actual swizzles (like extracting a 4-lane vector from an 8-lane vector, or making an 8-lane vector from a 4-lane vector)</p>



<a name="252913921"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/simd_shuffle/near/252913921" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/simd_shuffle.html#252913921">(Sep 11 2021 at 14:43)</a>:</h4>
<p>neat.</p>



<a name="252914480"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/simd_shuffle/near/252914480" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/simd_shuffle.html#252914480">(Sep 11 2021 at 14:53)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/issues/88855">#88855</a></p>



<a name="252916437"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/simd_shuffle/near/252916437" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/simd_shuffle.html#252916437">(Sep 11 2021 at 15:26)</a>:</h4>
<p><em>glances at the queue</em> ...I am not sure I have enough brain to review that right now but I think I can see about getting it merged sometime this century by orchestrating a rollup or two.</p>



<a name="252918353"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/simd_shuffle/near/252918353" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/simd_shuffle.html#252918353">(Sep 11 2021 at 15:59)</a>:</h4>
<p>I just realized I didn't update (or test) the cranelift backend.  <span class="user-mention" data-user-id="133247">@bjorn3</span> is that something I should be doing and how would I go about doing that?</p>



<a name="252923113"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/simd_shuffle/near/252923113" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/simd_shuffle.html#252923113">(Sep 11 2021 at 17:18)</a>:</h4>
<p><span class="user-mention" data-user-id="312331">@Caleb Zulawski</span>  I think it would be a matter of updating <a href="https://github.com/bjorn3/rustc_codegen_cranelift/blob/7736e0afb86a54ca68c36d96262e902761f02f80/src/intrinsics/simd.rs#L67">https://github.com/bjorn3/rustc_codegen_cranelift/blob/7736e0afb86a54ca68c36d96262e902761f02f80/src/intrinsics/simd.rs#L67</a> and <a href="https://github.com/bjorn3/rustc_codegen_cranelift/blob/7736e0afb86a54ca68c36d96262e902761f02f80/src/intrinsics/simd.rs#L70">https://github.com/bjorn3/rustc_codegen_cranelift/blob/7736e0afb86a54ca68c36d96262e902761f02f80/src/intrinsics/simd.rs#L70</a></p>



<a name="252923144"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/simd_shuffle/near/252923144" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/simd_shuffle.html#252923144">(Sep 11 2021 at 17:19)</a>:</h4>
<p>I can do it later too. The stdsimd test is currently disabled as it didn't compile on more recent nightlies anymore. Was the fix already merged by the way?</p>



<a name="252923223"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/simd_shuffle/near/252923223" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/simd_shuffle.html#252923223">(Sep 11 2021 at 17:20)</a>:</h4>
<p>Hmm, which fix was it waiting on?</p>



<a name="252923279"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/simd_shuffle/near/252923279" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/simd_shuffle.html#252923279">(Sep 11 2021 at 17:21)</a>:</h4>
<p>All relevant fixes either are merged or en route to merging, depending on which you mean.</p>



<a name="252923348"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/simd_shuffle/near/252923348" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/simd_shuffle.html#252923348">(Sep 11 2021 at 17:22)</a>:</h4>
<p>I wonder if we want to move some of this logic into rustc_codegen_ssa rather than duplicating it for cranelift</p>



<a name="252923556"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/simd_shuffle/near/252923556" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/simd_shuffle.html#252923556">(Sep 11 2021 at 17:26)</a>:</h4>
<p>Yeah, I think the type checking code and indices const eval code could be shared.</p>



<a name="252923694"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/simd_shuffle/near/252923694" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/simd_shuffle.html#252923694">(Sep 11 2021 at 17:29)</a>:</h4>
<blockquote>
<p>Hmm, which fix was it waiting on?</p>
</blockquote>
<p>It was waiting on <a href="https://github.com/rust-lang/portable-simd/pull/155">https://github.com/rust-lang/portable-simd/pull/155</a>, which merged 3 days ago I see.</p>



<a name="252925259"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/simd_shuffle/near/252925259" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/simd_shuffle.html#252925259">(Sep 11 2021 at 17:58)</a>:</h4>
<p>Would you rather I take care of it in this PR, or one of us can follow up afterwards?  I also have a similar PR ready to go for <code>simd_bitmask</code></p>



<a name="252930627"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/simd_shuffle/near/252930627" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/simd_shuffle.html#252930627">(Sep 11 2021 at 19:40)</a>:</h4>
<p>I can handle it in the bjorn3/rustc_codegen_cranelift repo after these PRs have landed and I updated rustc.</p>



<a name="252930647"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/simd_shuffle/near/252930647" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/simd_shuffle.html#252930647">(Sep 11 2021 at 19:41)</a>:</h4>
<p>That is also the easiest way to test it. x.py test doesn't yet test cg_clif.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>