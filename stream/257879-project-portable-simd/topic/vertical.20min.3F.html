<html>
<head><meta charset="utf-8"><title>vertical min? · project-portable-simd · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/index.html">project-portable-simd</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/vertical.20min.3F.html">vertical min?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="268743708"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/vertical%20min%3F/near/268743708" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Pedraza <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/vertical.20min.3F.html#268743708">(Jan 20 2022 at 19:20)</a>:</h4>
<p>First, hi. I hope this is the right place for user questions on std::simd. If so I apologize in advance for my lack of general simd knowledge. <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span> </p>
<p>First question, is there a vertical (lane-wise) min? min looks like it's returning a lexicographic min</p>



<a name="268744044"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/vertical%20min%3F/near/268744044" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/vertical.20min.3F.html#268744044">(Jan 20 2022 at 19:22)</a>:</h4>
<p>Is it neither of these?<br>
<a href="https://doc.rust-lang.org/nightly/std/simd/struct.Simd.html#method.min">https://doc.rust-lang.org/nightly/std/simd/struct.Simd.html#method.min</a><br>
<a href="https://doc.rust-lang.org/nightly/std/simd/struct.Simd.html#method.horizontal_min">https://doc.rust-lang.org/nightly/std/simd/struct.Simd.html#method.horizontal_min</a></p>



<a name="268744173"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/vertical%20min%3F/near/268744173" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/vertical.20min.3F.html#268744173">(Jan 20 2022 at 19:23)</a>:</h4>
<p>min and max are already lanewise, if that's what you want</p>



<a name="268744242"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/vertical%20min%3F/near/268744242" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/vertical.20min.3F.html#268744242">(Jan 20 2022 at 19:24)</a>:</h4>
<p>Though I wonder if it should be renamed to <code>lanes_min</code>, to disambiguate from <code>Ord::min</code>, the way it's <code>lanes_eq</code> to distinguish from <code>PartialEq::eq</code>.</p>



<a name="268744405"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/vertical%20min%3F/near/268744405" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/vertical.20min.3F.html#268744405">(Jan 20 2022 at 19:25)</a>:</h4>
<p>i was wondering that myself but honestly all the "lanes" stuff is extremely tedious</p>



<a name="268744785"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/vertical%20min%3F/near/268744785" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Pedraza <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/vertical.20min.3F.html#268744785">(Jan 20 2022 at 19:28)</a>:</h4>
<p>Ah, I'm using <code>Ord::min</code>. Is there no lane min for unsigned int types. Specifically <code>u16x4</code>?</p>



<a name="268744833"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/vertical%20min%3F/near/268744833" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/vertical.20min.3F.html#268744833">(Jan 20 2022 at 19:28)</a>:</h4>
<p>Hmm, I guess at least one of them should be renamed.  Because if using inherents to shadow is fine, then <code>lanes_eq</code> could just be <code>eq</code>.</p>



<a name="268744871"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/vertical%20min%3F/near/268744871" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/vertical.20min.3F.html#268744871">(Jan 20 2022 at 19:29)</a>:</h4>
<p>It's likely going to be moved to a trait which will help disambiguate it, but yeah, it's potentially confusing</p>



<a name="268744934"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/vertical%20min%3F/near/268744934" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/vertical.20min.3F.html#268744934">(Jan 20 2022 at 19:29)</a>:</h4>
<p><span class="user-mention silent" data-user-id="469380">Joel Pedraza</span> <a href="#narrow/stream/257879-project-portable-simd/topic/vertical.20min.3F/near/268744785">said</a>:</p>
<blockquote>
<p>Ah, I'm using <code>Ord::min</code>. Is there no lane min for unsigned int types. Specifically <code>u16x4</code>?</p>
</blockquote>
<p>Oh, I hadn't noticed that the methods are only for floats</p>



<a name="268744984"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/vertical%20min%3F/near/268744984" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/vertical.20min.3F.html#268744984">(Jan 20 2022 at 19:30)</a>:</h4>
<p>I guess for now you'll need <code>lanes_lt</code>+<code>select</code>.  (Well, however you spell <code>select</code> for std::simd.)</p>



<a name="268745070"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/vertical%20min%3F/near/268745070" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/vertical.20min.3F.html#268745070">(Jan 20 2022 at 19:30)</a>:</h4>
<p>Yeah, I'd recommend that for now. I'm working on changes that bring min/max/clamp to all vectors</p>



<a name="268745237"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/vertical%20min%3F/near/268745237" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/vertical.20min.3F.html#268745237">(Jan 20 2022 at 19:31)</a>:</h4>
<p><code>select</code>: <a href="https://doc.rust-lang.org/nightly/std/simd/struct.Mask.html#method.select">https://doc.rust-lang.org/nightly/std/simd/struct.Mask.html#method.select</a></p>



<a name="268753798"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/vertical%20min%3F/near/268753798" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Pedraza <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/vertical.20min.3F.html#268753798">(Jan 20 2022 at 20:36)</a>:</h4>
<p>Trying to write <a href="https://doc.rust-lang.org/stable/core/arch/x86/fn._mm_alignr_epi8.html">https://doc.rust-lang.org/stable/core/arch/x86/fn._mm_alignr_epi8.html</a> in terms of std::simd</p>
<blockquote>
<p>Concatenate 16-byte blocks in a and b into a 32-byte temporary result, shift the result right by n bytes, and returns the low 16 bytes.</p>
</blockquote>
<p>Not sure if I should be implementing as concat a b to u16x16, shift, truncate.  Or shift a left, shift a right, mask them together. Or something else?</p>



<a name="268754531"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/vertical%20min%3F/near/268754531" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Pedraza <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/vertical.20min.3F.html#268754531">(Jan 20 2022 at 20:42)</a>:</h4>
<p>In this case, the const I'm shifting right by is always 2 (so one u16)</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">a</span>: <span class="p">[</span><span class="kt">u16</span><span class="p">;</span><span class="w"> </span><span class="mi">8</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">];</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">b</span>: <span class="p">[</span><span class="kt">u16</span><span class="p">;</span><span class="w"> </span><span class="mi">8</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="mi">13</span><span class="p">,</span><span class="w"> </span><span class="mi">14</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">];</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">expected</span>: <span class="p">[</span><span class="kt">u16</span><span class="p">;</span><span class="w"> </span><span class="mi">8</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="mi">13</span><span class="p">,</span><span class="w"> </span><span class="mi">14</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span><span class="w"></span>
</code></pre></div>



<a name="268755627"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/vertical%20min%3F/near/268755627" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Pedraza <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/vertical.20min.3F.html#268755627">(Jan 20 2022 at 20:51)</a>:</h4>
<p>Oh, I think that's trivially a swizzle</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>