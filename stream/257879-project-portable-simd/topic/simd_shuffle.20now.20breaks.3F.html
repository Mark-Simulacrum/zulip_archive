<html>
<head><meta charset="utf-8"><title>simd_shuffle now breaks? · project-portable-simd · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/index.html">project-portable-simd</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/simd_shuffle.20now.20breaks.3F.html">simd_shuffle now breaks?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="258453803"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/simd_shuffle%20now%20breaks%3F/near/258453803" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/simd_shuffle.20now.20breaks.3F.html#258453803">(Oct 20 2021 at 22:22)</a>:</h4>
<p>For some reason, the version of our crate with <code>simd_shuffle</code> now breaks on the latest master, <span class="user-mention" data-user-id="312331">@Caleb Zulawski</span>, even when it doesn't on our crate. It says it needs a length. Are we deriving this length via type inference?</p>



<a name="258453916"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/simd_shuffle%20now%20breaks%3F/near/258453916" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/simd_shuffle.20now.20breaks.3F.html#258453916">(Oct 20 2021 at 22:22)</a>:</h4>
<p>Sorry, I don't understand what you mean. You mean on the merge into core? vs our crate?</p>



<a name="258453994"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/simd_shuffle%20now%20breaks%3F/near/258453994" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/simd_shuffle.20now.20breaks.3F.html#258453994">(Oct 20 2021 at 22:23)</a>:</h4>
<p>Yeah.</p>



<a name="258454072"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/simd_shuffle%20now%20breaks%3F/near/258454072" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/simd_shuffle.20now.20breaks.3F.html#258454072">(Oct 20 2021 at 22:24)</a>:</h4>
<p>This is absolutely baffling to me tbh.</p>



<a name="258454151"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/simd_shuffle%20now%20breaks%3F/near/258454151" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/simd_shuffle.20now.20breaks.3F.html#258454151">(Oct 20 2021 at 22:25)</a>:</h4>
<p>Is it possible something went bad with the merge?</p>



<a name="258454179"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/simd_shuffle%20now%20breaks%3F/near/258454179" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/simd_shuffle.20now.20breaks.3F.html#258454179">(Oct 20 2021 at 22:25)</a>:</h4>
<p>nope lol<br>
it looks exactly correct.</p>



<a name="258454286"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/simd_shuffle%20now%20breaks%3F/near/258454286" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/simd_shuffle.20now.20breaks.3F.html#258454286">(Oct 20 2021 at 22:26)</a>:</h4>
<p>I suppose there could be a bug with inference or something?  Or did someone maybe revert the code in typeck?</p>



<a name="258454343"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/simd_shuffle%20now%20breaks%3F/near/258454343" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/simd_shuffle.20now.20breaks.3F.html#258454343">(Oct 20 2021 at 22:27)</a>:</h4>
<p>I don't remember exactly but I think I removed that error entirely.</p>



<a name="258454462"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/simd_shuffle%20now%20breaks%3F/near/258454462" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/simd_shuffle.20now.20breaks.3F.html#258454462">(Oct 20 2021 at 22:28)</a>:</h4>
<p>You mean in this PR? <a href="https://github.com/rust-lang/rust/pull/88855">https://github.com/rust-lang/rust/pull/88855</a></p>



<a name="258454572"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/simd_shuffle%20now%20breaks%3F/near/258454572" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/simd_shuffle.20now.20breaks.3F.html#258454572">(Oct 20 2021 at 22:29)</a>:</h4>
<p>Yep. So the error was removed</p>



<a name="258454663"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/simd_shuffle%20now%20breaks%3F/near/258454663" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/simd_shuffle.20now.20breaks.3F.html#258454663">(Oct 20 2021 at 22:30)</a>:</h4>
<p>One way or another it made it back in</p>



<a name="258454706"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/simd_shuffle%20now%20breaks%3F/near/258454706" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/simd_shuffle.20now.20breaks.3F.html#258454706">(Oct 20 2021 at 22:30)</a>:</h4>
<p>wrong master lol</p>



<a name="258455342"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/simd_shuffle%20now%20breaks%3F/near/258455342" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/simd_shuffle.20now.20breaks.3F.html#258455342">(Oct 20 2021 at 22:36)</a>:</h4>
<p>...hm.</p>



<a name="258455353"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/simd_shuffle%20now%20breaks%3F/near/258455353" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/simd_shuffle.20now.20breaks.3F.html#258455353">(Oct 20 2021 at 22:36)</a>:</h4>
<p>what rustc do we use for building nightly...?</p>



<a name="258455425"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/simd_shuffle%20now%20breaks%3F/near/258455425" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/simd_shuffle.20now.20breaks.3F.html#258455425">(Oct 20 2021 at 22:37)</a>:</h4>
<p>Does that matter??</p>



<a name="258455547"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/simd_shuffle%20now%20breaks%3F/near/258455547" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/simd_shuffle.20now.20breaks.3F.html#258455547">(Oct 20 2021 at 22:38)</a>:</h4>
<p>You mean the bootstrap compiler?</p>



<a name="258455780"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/simd_shuffle%20now%20breaks%3F/near/258455780" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/simd_shuffle.20now.20breaks.3F.html#258455780">(Oct 20 2021 at 22:40)</a>:</h4>
<p>yes.</p>



<a name="258455787"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/simd_shuffle%20now%20breaks%3F/near/258455787" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/simd_shuffle.20now.20breaks.3F.html#258455787">(Oct 20 2021 at 22:40)</a>:</h4>
<p>sure it does.</p>



<a name="258455874"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/simd_shuffle%20now%20breaks%3F/near/258455874" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/simd_shuffle.20now.20breaks.3F.html#258455874">(Oct 20 2021 at 22:41)</a>:</h4>
<blockquote>
<p>Complications of bootstrapping</p>
<p>Since the build system uses the current beta compiler to build the stage-1 bootstrapping compiler, the compiler source code can't use some features until they reach beta (because otherwise the beta compiler doesn't support them). On the other hand, for compiler intrinsics and internal features, the features have to be used. Additionally, the compiler makes heavy use of nightly features (#![feature(...)]). How can we resolve this problem?</p>
<p>There are two methods used:</p>
<p>The build system sets --cfg bootstrap when building with stage0, so we can use cfg(not(bootstrap)) to only use features when built with stage1. This is useful for e.g. features that were just stabilized, which require #![feature(...)] when built with stage0, but not for stage1.<br>
    The build system sets RUSTC_BOOTSTRAP=1. This special variable means to break the stability guarantees of rust: Allow using #![feature(...)] with a compiler that's not nightly. This should never be used except when bootstrapping the compiler.</p>
</blockquote>



<a name="258456035"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/simd_shuffle%20now%20breaks%3F/near/258456035" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/simd_shuffle.20now.20breaks.3F.html#258456035">(Oct 20 2021 at 22:42)</a>:</h4>
<p>Soo... When will my code hit beta, lol</p>



<a name="258456077"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/simd_shuffle%20now%20breaks%3F/near/258456077" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/simd_shuffle.20now.20breaks.3F.html#258456077">(Oct 20 2021 at 22:43)</a>:</h4>
<p>Like tomorrow. But really I just gotta add some cfg bootstrap goo.</p>



<a name="258456119"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/simd_shuffle%20now%20breaks%3F/near/258456119" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/simd_shuffle.20now.20breaks.3F.html#258456119">(Oct 20 2021 at 22:43)</a>:</h4>
<p>Yeah, looks like you can probably just wrap the entire simd module in that</p>



<a name="258456860"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/simd_shuffle%20now%20breaks%3F/near/258456860" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/simd_shuffle.20now.20breaks.3F.html#258456860">(Oct 20 2021 at 22:51)</a>:</h4>
<p>We have ignition.</p>



<a name="258457289"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/simd_shuffle%20now%20breaks%3F/near/258457289" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/simd_shuffle.20now.20breaks.3F.html#258457289">(Oct 20 2021 at 22:55)</a>:</h4>
<p>Now hopefully this makes it to the linkchecker...</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>