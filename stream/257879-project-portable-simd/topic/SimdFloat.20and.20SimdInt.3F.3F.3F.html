<html>
<head><meta charset="utf-8"><title>SimdFloat and SimdInt??? · project-portable-simd · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/index.html">project-portable-simd</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html">SimdFloat and SimdInt???</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="272630106"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/272630106" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#272630106">(Feb 21 2022 at 01:24)</a>:</h4>
<p>So vaguely related, but I've been meaning to propose separating our types into SimdFloat, SimdInt, or whatever</p>



<a name="272630114"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/272630114" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#272630114">(Feb 21 2022 at 01:24)</a>:</h4>
<p>With the implication that we don't use any traits at all, everything would be inherent functions</p>



<a name="272630146"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/272630146" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#272630146">(Feb 21 2022 at 01:25)</a>:</h4>
<p>I have been thinking about that idea but I think that removing all traits whatsoever runs into the lack of genericity over vector types.</p>



<a name="272630238"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/272630238" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#272630238">(Feb 21 2022 at 01:27)</a>:</h4>
<p>I have also been thinking about how it would make the current pattern used by <code>to_int_unchecked</code> more annoying to express, and how that would be more annoying for user code as well. So  I think that chucking trait-driven genericity out the door entirely is a bad idea.</p>



<a name="272630333"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/272630333" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#272630333">(Feb 21 2022 at 01:29)</a>:</h4>
<p>Well a little off topic down that rabbit hole, but anything that doesn't just use Self gets really nasty</p>



<a name="272630397"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/272630397" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#272630397">(Feb 21 2022 at 01:30)</a>:</h4>
<p>But the overlap with the function naming is then we wouldn't really have to worry much about disambiguating names of functions</p>



<a name="272630497"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/272630497" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#272630497">(Feb 21 2022 at 01:33)</a>:</h4>
<p>&lt;_&lt;</p>



<a name="272630499"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/272630499" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#272630499">(Feb 21 2022 at 01:33)</a>:</h4>
<p>As far as genericity goes, you would then do something like SimdFloat&lt;T&gt; and make T generic. If you wanted to do something generic over ALL simd types you're really going to be pretty limited with what you can do anyway</p>



<a name="272630548"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/272630548" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#272630548">(Feb 21 2022 at 01:34)</a>:</h4>
<p>(of course we can make traits for those at some point in the future, either in std or a crate)</p>



<a name="272630556"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/272630556" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#272630556">(Feb 21 2022 at 01:34)</a>:</h4>
<p>Well, I am talking about the question of genericity over SimdInt and SimdUInt.</p>



<a name="272630579"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/272630579" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#272630579">(Feb 21 2022 at 01:35)</a>:</h4>
<p>Yeah, I really think we ought to wait until we figure out that story for scalars too. We're not exactly generic over them right now either</p>



<a name="272630589"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/272630589" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#272630589">(Feb 21 2022 at 01:35)</a>:</h4>
<p>er</p>



<a name="272630665"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/272630665" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#272630665">(Feb 21 2022 at 01:37)</a>:</h4>
<p>The problem is that for the current <code>Simd&lt;T, N&gt;</code> pattern, if you want to implement a method that is generic over various kinds of T, then if the T you want implements a trait, then you can bound on that, and <code>Simd</code> is transparent.</p>



<a name="272630728"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/272630728" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#272630728">(Feb 21 2022 at 01:38)</a>:</h4>
<p>The reason that doesn't quite work is if you have functions with the same name but different signatures for different Ts</p>



<a name="272630747"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/272630747" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#272630747">(Feb 21 2022 at 01:38)</a>:</h4>
<p>That doesn't necessarily matter.</p>



<a name="272630756"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/272630756" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#272630756">(Feb 21 2022 at 01:39)</a>:</h4>
<p>I'm not sure what you mean</p>



<a name="272630764"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/272630764" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#272630764">(Feb 21 2022 at 01:39)</a>:</h4>
<p>You can't implement conflicting functions with the same name</p>



<a name="272630832"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/272630832" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#272630832">(Feb 21 2022 at 01:40)</a>:</h4>
<p>Trait bounds are not sufficient to deconflict the functions because rustc has no way of marking two traits as exclusively implemented</p>



<a name="272630951"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/272630951" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#272630951">(Feb 21 2022 at 01:43)</a>:</h4>
<p>I mean negative coherence was actually implemented recently...</p>



<a name="272631014"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/272631014" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#272631014">(Feb 21 2022 at 01:44)</a>:</h4>
<p>But aside from that, I am talking about situations where a single T becomes many U which do not all fit nicely into the SimdFloat or SimdInt or SimdUint categories, but rather are split across them.</p>



<a name="272631027"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/272631027" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#272631027">(Feb 21 2022 at 01:44)</a>:</h4>
<p>What do you mean by that?</p>



<a name="272631043"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/272631043" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#272631043">(Feb 21 2022 at 01:45)</a>:</h4>
<p>My proposal is that f32 and f64 are SimdFloat, u* is SimdUint, etc</p>



<a name="272631138"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/272631138" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#272631138">(Feb 21 2022 at 01:47)</a>:</h4>
<p>maybe have a trait <code>SimdMyOp</code> for <code>fn my_op</code> and the inherent <code>fn my_op</code> forwards to that trait, and the trait is implemented for whatever <code>SimdFloat</code> or other traits are needed. specialization can be used there to force rustc to allow what it thinks are overlapping impls</p>



<a name="272631196"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/272631196" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#272631196">(Feb 21 2022 at 01:48)</a>:</h4>
<p>Currently, <code>Simd&lt;T&gt; -&gt; Simd&lt;U&gt;</code> is easy.<br>
<code>SimdInt&lt;T&gt; -&gt; SimdInt&lt;U&gt; OR SimdUint&lt;U&gt;</code> is not.</p>



<a name="272631225"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/272631225" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#272631225">(Feb 21 2022 at 01:49)</a>:</h4>
<p>Those are pretty trivial if you use a marker trait</p>



<a name="272631307"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/272631307" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#272631307">(Feb 21 2022 at 01:50)</a>:</h4>
<p>Defining an individual trait for each operation becomes ridiculous IMO</p>



<a name="272631422"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/272631422" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#272631422">(Feb 21 2022 at 01:52)</a>:</h4>
<p>We couldn't even come to an agreement on SimdPartialEq and we're looking at tons more functions beyond that, which aren't anywhere near as uniform between types</p>



<a name="272631464"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/272631464" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#272631464">(Feb 21 2022 at 01:53)</a>:</h4>
<p>As a comparison--would it make sense to make f32 and u32 the same generic type?</p>



<a name="272631510"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/272631510" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#272631510">(Feb 21 2022 at 01:54)</a>:</h4>
<p>Bits&lt;32&gt;, let's roll. <span aria-label="sunglasses" class="emoji emoji-1f60e" role="img" title="sunglasses">:sunglasses:</span></p>



<a name="272631731"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/272631731" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#272631731">(Feb 21 2022 at 01:58)</a>:</h4>
<p>The issue for <code>SimdInt&lt;T&gt; -&gt; SimdInt&lt;U&gt; OR SimdUint&lt;U&gt;</code> can be solved by offering <code>V, W: Vector</code> and going from <code>V&lt;T&gt; -&gt; W&lt;U&gt;</code></p>



<a name="272631778"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/272631778" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#272631778">(Feb 21 2022 at 01:59)</a>:</h4>
<p>Well or T: SimdConvert&lt;U&gt; or something</p>



<a name="272632004"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/272632004" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#272632004">(Feb 21 2022 at 02:02)</a>:</h4>
<p>Alternatively, because now the vector is embedded with some type semantics, SimdFloat could have <code>to_int</code>, <code>to_uint</code>, etc</p>



<a name="272632028"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/272632028" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#272632028">(Feb 21 2022 at 02:03)</a>:</h4>
<p>I'm not sure there's necessarily any justification for doing all conversions under one function other than that's what <code>as</code> already does</p>



<a name="272632099"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/272632099" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#272632099">(Feb 21 2022 at 02:04)</a>:</h4>
<p>Mostly I want to be sure that people can still write whatever functions they need to in general, the only sense of conversion I mean per se is the sense that all functions apply conversions, sometimes into booleans.</p>



<a name="272632148"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/272632148" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#272632148">(Feb 21 2022 at 02:05)</a>:</h4>
<p>So to clarify my main objection is against throwing out all traits, rather than against splitting Simd up. A single trait can handle the way Simd manages the concept of genericity.</p>



<a name="272632216"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/272632216" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#272632216">(Feb 21 2022 at 02:06)</a>:</h4>
<p>Oh yeah, I'm not saying "no traits"</p>



<a name="272632265"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/272632265" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#272632265">(Feb 21 2022 at 02:07)</a>:</h4>
<p>I'd also like to coerce rustc into allowing all the functions that we <strong>do</strong> implement over all SIMD types to in fact be on a single trait and not have to be repetitively reimplemented on types.</p>



<a name="272632340"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/272632340" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#272632340">(Feb 21 2022 at 02:08)</a>:</h4>
<p>Like splat etc?</p>



<a name="272632351"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/272632351" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#272632351">(Feb 21 2022 at 02:09)</a>:</h4>
<p>Yeah.</p>



<a name="272632371"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/272632371" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#272632371">(Feb 21 2022 at 02:09)</a>:</h4>
<p>That might work. Though there's some precedent with doing things slightly different with masks vs Simd</p>



<a name="272632385"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/272632385" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#272632385">(Feb 21 2022 at 02:10)</a>:</h4>
<p>Probably would just need to evaluate what makes sense, what doesn't</p>



<a name="272632447"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/272632447" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#272632447">(Feb 21 2022 at 02:10)</a>:</h4>
<p>Yeah, it has been feeling inevitable that Mask will mutate into its own weird thing and not be "just another SIMD type".</p>



<a name="273013390"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/273013390" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#273013390">(Feb 23 2022 at 21:25)</a>:</h4>
<p><span class="user-mention" data-user-id="312331">@Caleb Zulawski</span> Speaking of this, I just discovered we can do something very interesting as of recently:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">use</span><span class="w"> </span><span class="k">crate</span>::<span class="n">simd</span>::<span class="p">{</span><span class="n">LaneCount</span><span class="p">,</span><span class="w"> </span><span class="n">Simd</span><span class="p">,</span><span class="w"> </span><span class="n">SupportedLaneCount</span><span class="p">};</span><span class="w"></span>
<span class="k">trait</span><span class="w"> </span><span class="n">Vectorize</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">Vector</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">N</span>: <span class="kt">usize</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">fn</span> <span class="nf">splat</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">N</span>: <span class="kt">usize</span><span class="o">&gt;</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span>::<span class="n">Vector</span><span class="o">&lt;</span><span class="n">N</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">struct</span> <span class="nc">SimdFloat</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">N</span>: <span class="kt">usize</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Simd</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="o">&gt;</span><span class="p">)</span><span class="w"></span>
<span class="k">where</span><span class="w"></span>
<span class="w">    </span><span class="n">SupportedLaneCount</span>: <span class="nc">LaneCount</span><span class="o">&lt;</span><span class="n">N</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>

<span class="k">impl</span><span class="w"> </span><span class="n">Vectorize</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="kt">f32</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">Vector</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">N</span>: <span class="kt">usize</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SimdFloat</span><span class="o">&lt;</span><span class="kt">f32</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">fn</span> <span class="nf">splat</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">N</span>: <span class="kt">usize</span><span class="o">&gt;</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span>::<span class="n">Vector</span><span class="o">&lt;</span><span class="n">N</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">Simd</span>::<span class="n">splat</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="273014884"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/273014884" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#273014884">(Feb 23 2022 at 21:38)</a>:</h4>
<p>That's... An interesting idea</p>



<a name="273014932"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/273014932" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#273014932">(Feb 23 2022 at 21:39)</a>:</h4>
<p>That's vaguely the direction my PartialEq PR was going in, I really like this</p>



<a name="273015000"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/273015000" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#273015000">(Feb 23 2022 at 21:39)</a>:</h4>
<p>There's no reason splat really needs to be a member of the vector itself at all...</p>



<a name="273016219"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/273016219" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#273016219">(Feb 23 2022 at 21:52)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">use</span><span class="w"> </span><span class="k">crate</span>::<span class="n">simd</span>::<span class="o">*</span><span class="p">;</span><span class="w"></span>
<span class="k">use</span><span class="w"> </span><span class="k">crate</span>::<span class="n">simd</span>::<span class="p">{</span><span class="n">LaneCount</span><span class="p">,</span><span class="w"> </span><span class="n">Simd</span><span class="p">,</span><span class="w"> </span><span class="n">SupportedLaneCount</span><span class="p">};</span><span class="w"></span>
<span class="k">trait</span><span class="w"> </span><span class="n">Vectorize</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">Vector</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">N</span>: <span class="kt">usize</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">    </span><span class="k">where</span><span class="w"></span>
<span class="w">        </span><span class="n">LaneCount</span><span class="o">&lt;</span><span class="n">N</span><span class="o">&gt;</span>: <span class="nc">SupportedLaneCount</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">fn</span> <span class="nf">splat</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">N</span>: <span class="kt">usize</span><span class="o">&gt;</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span>::<span class="n">Vector</span><span class="o">&lt;</span><span class="n">N</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">    </span><span class="k">where</span><span class="w"></span>
<span class="w">        </span><span class="n">LaneCount</span><span class="o">&lt;</span><span class="n">N</span><span class="o">&gt;</span>: <span class="nc">SupportedLaneCount</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="cp">#[derive(Debug, PartialEq)]</span><span class="w"></span>
<span class="k">struct</span> <span class="nc">SimdFloat</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">N</span>: <span class="kt">usize</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Simd</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="o">&gt;</span><span class="p">)</span><span class="w"></span>
<span class="k">where</span><span class="w"></span>
<span class="w">    </span><span class="n">LaneCount</span><span class="o">&lt;</span><span class="n">N</span><span class="o">&gt;</span>: <span class="nc">SupportedLaneCount</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">T</span>: <span class="nc">SimdElement</span><span class="p">;</span><span class="w"></span>

<span class="k">impl</span><span class="w"> </span><span class="n">Vectorize</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="kt">f32</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">Vector</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">N</span>: <span class="kt">usize</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">    </span><span class="k">where</span><span class="w"></span>
<span class="w">        </span><span class="n">LaneCount</span><span class="o">&lt;</span><span class="n">N</span><span class="o">&gt;</span>: <span class="nc">SupportedLaneCount</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">SimdFloat</span><span class="o">&lt;</span><span class="kt">f32</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">splat</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">N</span>: <span class="kt">usize</span><span class="o">&gt;</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span>::<span class="n">Vector</span><span class="o">&lt;</span><span class="n">N</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">    </span><span class="k">where</span><span class="w"></span>
<span class="w">        </span><span class="n">LaneCount</span><span class="o">&lt;</span><span class="n">N</span><span class="o">&gt;</span>: <span class="nc">SupportedLaneCount</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">SimdFloat</span><span class="p">(</span><span class="n">Simd</span>::<span class="n">splat</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="cp">#[cfg(test)]</span><span class="w"></span>
<span class="k">mod</span> <span class="nn">tests</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">use</span><span class="w"> </span><span class="k">super</span>::<span class="o">*</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="cp">#[test]</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">test_gat</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="kt">f32</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Vectorize</span><span class="o">&gt;</span>::<span class="n">splat</span>::<span class="o">&lt;</span><span class="mi">4</span><span class="o">&gt;</span><span class="p">(</span><span class="mf">1.0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SimdFloat</span><span class="p">(</span><span class="n">f32x4</span>::<span class="n">splat</span><span class="p">(</span><span class="mf">1.0</span><span class="p">));</span><span class="w"></span>
<span class="w">        </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>Okay with the current architecture re: bounds and such it gets a bit messier once I actually try to make a test compile, but it <strong>does</strong> compile. :D</p>



<a name="273016372"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/273016372" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#273016372">(Feb 23 2022 at 21:54)</a>:</h4>
<p><span class="user-mention silent" data-user-id="312331">Caleb Zulawski</span> <a href="#narrow/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F/near/273015000">said</a>:</p>
<blockquote>
<p>There's no reason splat really needs to be a member of the vector itself at all...</p>
</blockquote>
<p>Going even further (perhaps too far),</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">struct</span> <span class="nc">Splat</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">T</span><span class="p">);</span><span class="w"></span>

<span class="k">impl</span><span class="w"> </span><span class="n">Add</span><span class="o">&lt;</span><span class="n">Splat</span><span class="o">&lt;</span><span class="kt">f32</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Simd</span><span class="o">&lt;</span><span class="kt">f32</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="k">impl</span><span class="w"> </span><span class="nb">From</span><span class="o">&lt;</span><span class="n">Splat</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Simd</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="273016378"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/273016378" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#273016378">(Feb 23 2022 at 21:54)</a>:</h4>
<p>( I am pretty sure with rearchitecting it this can be made less... <em>vague gesture</em> )</p>



<a name="273016546"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/273016546" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#273016546">(Feb 23 2022 at 21:55)</a>:</h4>
<p><span class="user-mention" data-user-id="125270">@scottmcm</span> interesting...</p>



<a name="273016559"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/273016559" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#273016559">(Feb 23 2022 at 21:55)</a>:</h4>
<p>Yes!</p>



<a name="273016644"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/273016644" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#273016644">(Feb 23 2022 at 21:56)</a>:</h4>
<p>And I might as well add</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">impl</span><span class="w"> </span><span class="nb">From</span><span class="o">&lt;</span><span class="n">Splat</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">[</span><span class="n">T</span><span class="p">;</span><span class="w"> </span><span class="n">N</span><span class="p">]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="273016651"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/273016651" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#273016651">(Feb 23 2022 at 21:56)</a>:</h4>
<p>That kind of "this library should be expressing type relationships" is what I was thinking of, essentially.</p>



<a name="275115091"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/275115091" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#275115091">(Mar 12 2022 at 20:15)</a>:</h4>
<p>So I was thinking more about this and the biggest issue I see are things like select and swizzles becoming much more complicated</p>



<a name="275115141"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/275115141" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#275115141">(Mar 12 2022 at 20:16)</a>:</h4>
<p>Those really make use of <code>Simd</code> being effectively a container</p>



<a name="275115172"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/275115172" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#275115172">(Mar 12 2022 at 20:17)</a>:</h4>
<p>Yeaaaah.</p>



<a name="275115248"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/275115248" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#275115248">(Mar 12 2022 at 20:19)</a>:</h4>
<p>I'm now leaning more towards SimdFloat, SimdInt, etc traits</p>



<a name="275115334"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/275115334" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#275115334">(Mar 12 2022 at 20:21)</a>:</h4>
<p>I think it might be a good idea to not attempt to deduplicate functions across those, e.g. SimdFloat and SimdInt would both have <code>abs</code> which is fine</p>



<a name="275115352"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/275115352" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#275115352">(Mar 12 2022 at 20:22)</a>:</h4>
<p>Which is probably an improvement from what we have now, where the documentation for the behavior of each is lumped together</p>



<a name="275115409"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/275115409" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#275115409">(Mar 12 2022 at 20:23)</a>:</h4>
<p>I'm also considering the possiblity that <code>eq</code> and friends can be in those traits rather than something attempting to generalize across all PartialEq types etc</p>



<a name="275115481"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/275115481" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#275115481">(Mar 12 2022 at 20:24)</a>:</h4>
<p>This is still pretty extensible I think, we can add SimdPointer etc traits in the future for example</p>



<a name="275116741"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/275116741" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#275116741">(Mar 12 2022 at 20:55)</a>:</h4>
<p>The <em>only</em> downside is that if you do this people will ask for a ScalarFloat and ScalarInt deal as well</p>



<a name="275116795"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/275116795" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#275116795">(Mar 12 2022 at 20:56)</a>:</h4>
<p>Maybe, the justification here is different though. The trait is necessary because all vectors share a single container type, which isn't true for scalars</p>



<a name="275116804"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/275116804" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#275116804">(Mar 12 2022 at 20:56)</a>:</h4>
<p>Not to say it wouldn't be nice but you can always use the num crate, here it's a necessity</p>



<a name="275117375"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/275117375" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#275117375">(Mar 12 2022 at 21:09)</a>:</h4>
<p>Yeah, while I would like that symmetry personally and still have plans to make that closer to reality, the reason I proposed a heavily trait-oriented solution is that essentially, no matter what we do, <strong>something</strong> has to be a trait in order to make this make sense.</p>



<a name="275118023"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/275118023" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#275118023">(Mar 12 2022 at 21:27)</a>:</h4>
<p>One thing I just realized is that if <code>eq</code> etc are part of the traits, we can't simply use the same name because it won't have priority (and if our traits aren't in the prelude, they won't be in scope at all by default)</p>



<a name="275118523"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/275118523" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#275118523">(Mar 12 2022 at 21:40)</a>:</h4>
<p><span class="user-mention silent" data-user-id="312331">Caleb Zulawski</span> <a href="#narrow/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F/near/275115334">said</a>:</p>
<blockquote>
<p>I think it might be a good idea to not attempt to deduplicate functions across those, e.g. SimdFloat and SimdInt would both have <code>abs</code> which is fine</p>
</blockquote>
<p>Hmm, is name resolution happy to have two same-name trait methods in scope?</p>



<a name="275118679"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/275118679" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#275118679">(Mar 12 2022 at 21:45)</a>:</h4>
<p>I think it should be fine simply because no vector will implement both SimdFloat and SimdInt</p>



<a name="275118684"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/275118684" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#275118684">(Mar 12 2022 at 21:45)</a>:</h4>
<p>Of course we can't actually embed that in the trait bounds (yet?)</p>



<a name="275118727"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/275118727" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#275118727">(Mar 12 2022 at 21:46)</a>:</h4>
<p>Well, while i agree that the trait is good, it's not <em>necessary</em> because you really can have each method const generic over a lane count and a particular element type (because that's how it is now).</p>
<p>So i still anticipate that being a discussion you have to walk people through.</p>



<a name="275118875"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/275118875" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#275118875">(Mar 12 2022 at 21:50)</a>:</h4>
<p>Negative coherence almost exists.</p>



<a name="275119000"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/275119000" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#275119000">(Mar 12 2022 at 21:54)</a>:</h4>
<p><span class="user-mention silent" data-user-id="224471">Lokathor</span> <a href="#narrow/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F/near/275118727">said</a>:</p>
<blockquote>
<p>Well, while i agree that the trait is good, it's not <em>necessary</em> because you really can have each method const generic over a lane count and a particular element type (because that's how it is now).</p>
<p>So i still anticipate that being a discussion you have to walk people through.</p>
</blockquote>
<p>Yep true, we can always just point someone to an old revision of the docs as justification <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="275119005"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/275119005" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#275119005">(Mar 12 2022 at 21:54)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281757">Jubilee</span> <a href="#narrow/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F/near/275118875">said</a>:</p>
<blockquote>
<p>Negative coherence almost exists.</p>
</blockquote>
<p>Yeah, I was hinting at this, though I really don't think we need it anyway</p>



<a name="275129644"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/275129644" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#275129644">(Mar 13 2022 at 03:03)</a>:</h4>
<p><span class="user-mention silent" data-user-id="312331">Caleb Zulawski</span> <a href="#narrow/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F/near/275118023">said</a>:</p>
<blockquote>
<p>One thing I just realized is that if <code>eq</code> etc are part of the traits, we can't simply use the same name because it won't have priority (and if our traits aren't in the prelude, they won't be in scope at all by default)</p>
</blockquote>
<p>I think we could get around this though.</p>



<a name="275129689"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/275129689" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#275129689">(Mar 13 2022 at 03:04)</a>:</h4>
<p>But it relies on hax.</p>



<a name="275129708"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/275129708" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#275129708">(Mar 13 2022 at 03:05)</a>:</h4>
<p>I guess we could always just duplicate the function on Simd</p>



<a name="275129716"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/275129716" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#275129716">(Mar 13 2022 at 03:05)</a>:</h4>
<p>Oh I meant by Breaking Reality.</p>



<a name="275129724"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/275129724" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#275129724">(Mar 13 2022 at 03:05)</a>:</h4>
<p>Go on</p>



<a name="275129859"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/275129859" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#275129859">(Mar 13 2022 at 03:09)</a>:</h4>
<p>Ah, so it requires someone to crab up and do the thing that I dodged via StdFloat as a workaround, but you have heard me mention "inherent traits" a few times, i.e. traits that are always in scope for a type (and that have overriding priority for name resolution). It turns out the functionality in the compiler already exists to make that happen, if it's a lang item, because it's actually the mechanism used to allow e.g. <code>f32::sin</code> to work at all.</p>



<a name="275129912"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/275129912" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#275129912">(Mar 13 2022 at 03:10)</a>:</h4>
<p>Ah I see</p>



<a name="275129927"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/275129927" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#275129927">(Mar 13 2022 at 03:11)</a>:</h4>
<p>Is it done with a trait?</p>



<a name="275129973"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/275129973" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#275129973">(Mar 13 2022 at 03:12)</a>:</h4>
<p>More specifically it would just be saying name resolution works differently for these types to the compiler, which complicates the compiler slightly with our implementation, but we can make it work kind of arbitrarily.</p>



<a name="275130055"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/275130055" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#275130055">(Mar 13 2022 at 03:14)</a>:</h4>
<p>I should clarify that saying this is possible does not necessarily mean I think it is the best solution, rather, I think it is best to be aware of all of our options.</p>



<a name="275162036"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/275162036" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#275162036">(Mar 13 2022 at 16:10)</a>:</h4>
<p>Do we think there's any harm making a <code>SimdPartialOrd</code> trait that also contains <code>min</code>,<code>max</code>, <code>clamp</code> like <code>Ord</code> but doesn't require <code>Ord</code>'s symmetry, meaning we can implement it on floats too?</p>



<a name="275162106"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/275162106" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#275162106">(Mar 13 2022 at 16:12)</a>:</h4>
<p>SIMD comparisons by definition are going to be a little less strict... no <code>partial_cmp</code> equivalent function</p>



<a name="275173282"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/275173282" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#275173282">(Mar 13 2022 at 20:26)</a>:</h4>
<p>sounds like a good idea, you'd want <code>SimdPartialOrd</code> to also have <code>lt</code>/<code>le</code>/<code>gt</code>/<code>ge</code> members that return <code>Mask</code>. or, you could cram <code>eq</code>/<code>ne</code> in there too and name it <code>SimdCmp</code> instead -- though we may want to not add <code>eq</code>/<code>ne</code> there since we might want <code>Simd&lt;EqOnly, ...&gt;</code> sometime in the future?</p>



<a name="275173396"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/275173396" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#275173396">(Mar 13 2022 at 20:29)</a>:</h4>
<p>For now I opened <a href="https://github.com/rust-lang/portable-simd/issues/265">portable-simd#265</a> which matches scalars exactly, but I think we have the option of condensing it in the future</p>



<a name="275176300"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/275176300" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#275176300">(Mar 13 2022 at 21:38)</a>:</h4>
<p>I kinda feel like Rust should have MinMax as a separate trait that Ord implies.</p>



<a name="275176875"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/275176875" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#275176875">(Mar 13 2022 at 21:53)</a>:</h4>
<p>That would still have the problem of whether <code>max(None, Some(3))</code> is <code>None</code> or <code>Some(3)</code>.</p>
<p>I'd like it as a separate trait, but it can't be implied by <code>Ord</code> without inheriting <code>Option</code>'s mistakes.</p>



<a name="275268545"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/275268545" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#275268545">(Mar 14 2022 at 17:12)</a>:</h4>
<p><span class="user-mention silent" data-user-id="125270">scottmcm</span> <a href="#narrow/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F/near/275176875">said</a>:</p>
<blockquote>
<p>That would still have the problem of whether <code>max(None, Some(3))</code> is <code>None</code> or <code>Some(3)</code>.</p>
<p>I'd like it as a separate trait, but it can't be implied by <code>Ord</code> without inheriting <code>Option</code>'s mistakes.</p>
</blockquote>
<p>I wasn't thinking about  it as a way to "fix" Option implementing Ord.</p>



<a name="275302638"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/275302638" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#275302638">(Mar 14 2022 at 21:48)</a>:</h4>
<p>What about a clippy lint that warns if you use any Ord functions directly on Simd?</p>



<a name="275302682"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/SimdFloat%20and%20SimdInt%3F%3F%3F/near/275302682" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/SimdFloat.20and.20SimdInt.3F.3F.3F.html#275302682">(Mar 14 2022 at 21:49)</a>:</h4>
<p>You can still pass it into a data structure that requires Ord, but warn that you probably mean something else if you're calling it directly</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>