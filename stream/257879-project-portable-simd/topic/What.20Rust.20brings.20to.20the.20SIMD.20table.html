<html>
<head><meta charset="utf-8"><title>What Rust brings to the SIMD table · project-portable-simd · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/index.html">project-portable-simd</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/What.20Rust.20brings.20to.20the.20SIMD.20table.html">What Rust brings to the SIMD table</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="278472518"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/What%20Rust%20brings%20to%20the%20SIMD%20table/near/278472518" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/What.20Rust.20brings.20to.20the.20SIMD.20table.html#278472518">(Apr 10 2022 at 14:58)</a>:</h4>
<p>I have a general idea of <em>why</em> stdsimd has been so difficult from a design point of view, but if anyone has any input on the added value that Rust brings to SIMD land or the constraints that people didn’t know would come up (or multiple user groups having vastly different constraints and not agreeing on them), I’d appreciate it/write it down for posterity.</p>



<a name="278479348"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/What%20Rust%20brings%20to%20the%20SIMD%20table/near/278479348" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/What.20Rust.20brings.20to.20the.20SIMD.20table.html#278479348">(Apr 10 2022 at 17:19)</a>:</h4>
<p>I think the elevator pitch is that the standard for SIMD right now is C++ with vendor intrinsics, it's not so much that Rust brings something specific to SIMD as much as many people prefer Rust to C++.  Also, C++'s portable SIMD is experimental and doesn't hit as many use cases as our implementation</p>



<a name="278479640"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/What%20Rust%20brings%20to%20the%20SIMD%20table/near/278479640" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/What.20Rust.20brings.20to.20the.20SIMD.20table.html#278479640">(Apr 10 2022 at 17:24)</a>:</h4>
<p>Another way to look at it is that there are effectively no portable SIMD implementations in widespread use and Rust is in a good position to try it out</p>



<a name="278479680"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/What%20Rust%20brings%20to%20the%20SIMD%20table/near/278479680" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/What.20Rust.20brings.20to.20the.20SIMD.20table.html#278479680">(Apr 10 2022 at 17:25)</a>:</h4>
<p>rust has the standard memory-safety benefits...std::simd is better than most simd code/libraries because it is portable and, unlike most other simd portability libraries, it has an architecture-independent set of operations...most other simd portability libraries do something like give you all intel's simd intrinsics but make them portable to other archs -- kinda terrible because intel doesn't have all the useful ops and intel doesn't translate nicely to other archs (e.g. movmskps translates terribly to arm neon yet it's quite common and fast on x86)</p>



<a name="278479747"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/What%20Rust%20brings%20to%20the%20SIMD%20table/near/278479747" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/What.20Rust.20brings.20to.20the.20SIMD.20table.html#278479747">(Apr 10 2022 at 17:26)</a>:</h4>
<p>Do you hve any examples of where stdsimd supports more use cases than experimental C++ or established C++ libs?</p>



<a name="278479765"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/What%20Rust%20brings%20to%20the%20SIMD%20table/near/278479765" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/What.20Rust.20brings.20to.20the.20SIMD.20table.html#278479765">(Apr 10 2022 at 17:26)</a>:</h4>
<p>That too, and using LLVM basically means we don't have to worry about the backend details and can focus on making a good API</p>



<a name="278479863"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/What%20Rust%20brings%20to%20the%20SIMD%20table/near/278479863" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/What.20Rust.20brings.20to.20the.20SIMD.20table.html#278479863">(Apr 10 2022 at 17:28)</a>:</h4>
<p><span class="user-mention" data-user-id="229517">@Jacob Lifshay</span> ah, the <code>movmskps</code> kind of detail is precisely the kind of examples I’m looking for.</p>



<a name="278479865"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/What%20Rust%20brings%20to%20the%20SIMD%20table/near/278479865" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/What.20Rust.20brings.20to.20the.20SIMD.20table.html#278479865">(Apr 10 2022 at 17:28)</a>:</h4>
<p>C++'s std::simd only supports basic arithmetic operations</p>



<a name="278479894"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/What%20Rust%20brings%20to%20the%20SIMD%20table/near/278479894" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/What.20Rust.20brings.20to.20the.20SIMD.20table.html#278479894">(Apr 10 2022 at 17:29)</a>:</h4>
<p>(when I last checked, at least, again it's experimental)</p>



<a name="278479975"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/What%20Rust%20brings%20to%20the%20SIMD%20table/near/278479975" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/What.20Rust.20brings.20to.20the.20SIMD.20table.html#278479975">(Apr 10 2022 at 17:30)</a>:</h4>
<p>I doubt there's anything we provide that C++ can't do, but our API is probably easier to use</p>



<a name="278480060"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/What%20Rust%20brings%20to%20the%20SIMD%20table/near/278480060" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/What.20Rust.20brings.20to.20the.20SIMD.20table.html#278480060">(Apr 10 2022 at 17:32)</a>:</h4>
<p>well, when we eventually get <code>Simd&lt;&amp;T, N&gt;</code> aka simd-pointers, we will have stuff that i've not seen basically anywhere else (except llvm ir)</p>



<a name="278480061"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/What%20Rust%20brings%20to%20the%20SIMD%20table/near/278480061" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/What.20Rust.20brings.20to.20the.20SIMD.20table.html#278480061">(Apr 10 2022 at 17:32)</a>:</h4>
<p>Gotcha - if anyone has any nice examples that’d compare C++/libs vs the Rust equivalent?</p>



<a name="278480081"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/What%20Rust%20brings%20to%20the%20SIMD%20table/near/278480081" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/What.20Rust.20brings.20to.20the.20SIMD.20table.html#278480081">(Apr 10 2022 at 17:33)</a>:</h4>
<p><span class="user-mention" data-user-id="229517">@Jacob Lifshay</span> oooh - what kind of ops/API/workflow do you think will set it apart?</p>



<a name="278480085"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/What%20Rust%20brings%20to%20the%20SIMD%20table/near/278480085" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/What.20Rust.20brings.20to.20the.20SIMD.20table.html#278480085">(Apr 10 2022 at 17:33)</a>:</h4>
<p>I've never actually seen any C++ code using the experimental portable SIMD, I'm not even sure of the implementation status</p>



<a name="278480151"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/What%20Rust%20brings%20to%20the%20SIMD%20table/near/278480151" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/What.20Rust.20brings.20to.20the.20SIMD.20table.html#278480151">(Apr 10 2022 at 17:34)</a>:</h4>
<p>well, you'll be able to do stuff like walk a tree using simd gather ops -- simd raytracing uses this a lot iirc</p>



<a name="278480179"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/What%20Rust%20brings%20to%20the%20SIMD%20table/near/278480179" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/What.20Rust.20brings.20to.20the.20SIMD.20table.html#278480179">(Apr 10 2022 at 17:35)</a>:</h4>
<p>that sounds like a <em>must include</em> on the examples branch. Cool!</p>



<a name="278480300"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/What%20Rust%20brings%20to%20the%20SIMD%20table/near/278480300" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/What.20Rust.20brings.20to.20the.20SIMD.20table.html#278480300">(Apr 10 2022 at 17:37)</a>:</h4>
<p>one other thing that I want us to have is simd elementwise atomic operations</p>



<a name="278480359"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/What%20Rust%20brings%20to%20the%20SIMD%20table/near/278480359" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/What.20Rust.20brings.20to.20the.20SIMD.20table.html#278480359">(Apr 10 2022 at 17:38)</a>:</h4>
<p>libre-soc and gpu arches commonly have that</p>



<a name="278480388"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/What%20Rust%20brings%20to%20the%20SIMD%20table/near/278480388" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/What.20Rust.20brings.20to.20the.20SIMD.20table.html#278480388">(Apr 10 2022 at 17:39)</a>:</h4>
<p>I'm not sure that's portable?</p>



<a name="278480389"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/What%20Rust%20brings%20to%20the%20SIMD%20table/near/278480389" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/What.20Rust.20brings.20to.20the.20SIMD.20table.html#278480389">(Apr 10 2022 at 17:39)</a>:</h4>
<p>simd elementwise multi-threaded hash table insert could use that</p>



<a name="278480416"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/What%20Rust%20brings%20to%20the%20SIMD%20table/near/278480416" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/What.20Rust.20brings.20to.20the.20SIMD.20table.html#278480416">(Apr 10 2022 at 17:39)</a>:</h4>
<p>just as portable as simd integer division -- a few archs implement it</p>



<a name="278480535"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/What%20Rust%20brings%20to%20the%20SIMD%20table/near/278480535" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/What.20Rust.20brings.20to.20the.20SIMD.20table.html#278480535">(Apr 10 2022 at 17:41)</a>:</h4>
<p>another thing we're planning on adding is vector length independent ops -- kinda like risc-v v and libre-soc's svp64</p>



<a name="278480592"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/What%20Rust%20brings%20to%20the%20SIMD%20table/near/278480592" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/What.20Rust.20brings.20to.20the.20SIMD.20table.html#278480592">(Apr 10 2022 at 17:42)</a>:</h4>
<p>or, more specifically, dynamically settable vector lengths</p>



<a name="278480606"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/What%20Rust%20brings%20to%20the%20SIMD%20table/near/278480606" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/What.20Rust.20brings.20to.20the.20SIMD.20table.html#278480606">(Apr 10 2022 at 17:42)</a>:</h4>
<p>oh darn, i thought those riscv vector ops wouldn’t gel well with SIMD.</p>



<a name="278480715"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/What%20Rust%20brings%20to%20the%20SIMD%20table/near/278480715" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/What.20Rust.20brings.20to.20the.20SIMD.20table.html#278480715">(Apr 10 2022 at 17:45)</a>:</h4>
<p>arm sve2 claims to also be vector length independent but it's not usefully dynamically-settable-length (cuz the designers goofed) ... so we'd have to emulate that there, just like x86</p>



<a name="278491383"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/What%20Rust%20brings%20to%20the%20SIMD%20table/near/278491383" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/What.20Rust.20brings.20to.20the.20SIMD.20table.html#278491383">(Apr 10 2022 at 21:44)</a>:</h4>
<p>AWS Graviton3 is being previewed and it includes 256-bit SVE2.</p>



<a name="278491456"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/What%20Rust%20brings%20to%20the%20SIMD%20table/near/278491456" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/What.20Rust.20brings.20to.20the.20SIMD.20table.html#278491456">(Apr 10 2022 at 21:46)</a>:</h4>
<p>most other SVE2 impls are 128 bits wide. there are some supercomputer ones I am aware of but they use SVE, which is more limited (SVE2 implements more Neon-style ops).</p>



<a name="278491710"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/What%20Rust%20brings%20to%20the%20SIMD%20table/near/278491710" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/What.20Rust.20brings.20to.20the.20SIMD.20table.html#278491710">(Apr 10 2022 at 21:53)</a>:</h4>
<p><span class="user-mention silent" data-user-id="246783">Miguel Raz Guzmán Macedo</span> <a href="#narrow/stream/257879-project-portable-simd/topic/What.20Rust.20brings.20to.20the.20SIMD.20table/near/278480606">said</a>:</p>
<blockquote>
<p>oh darn, i thought those riscv vector ops wouldn’t gel well with SIMD.</p>
</blockquote>
<p>So the thing is that we need to do more work on dynamic-length "unsized" types before people can really use them, but it's totally possible.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>