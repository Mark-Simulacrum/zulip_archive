<html>
<head><meta charset="utf-8"><title>Type inference concerns · project-portable-simd · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/index.html">project-portable-simd</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Type.20inference.20concerns.html">Type inference concerns</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="254866080"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Type%20inference%20concerns/near/254866080" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Type.20inference.20concerns.html#254866080">(Sep 25 2021 at 19:58)</a>:</h4>
<p>This came on my radar today, it's an unrelated example and something we are allowed to break but we should remain aware of this kind of thing nonetheless. Portable SIMD shouldn't Break A Ton Of Programs, especially not ones not using SIMD at all. <a href="https://github.com/rust-lang/rust/issues/89254">https://github.com/rust-lang/rust/issues/89254</a></p>



<a name="254866837"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Type%20inference%20concerns/near/254866837" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Type.20inference.20concerns.html#254866837">(Sep 25 2021 at 20:09)</a>:</h4>
<p>Huh. I'm a little confused what's happening</p>



<a name="254866847"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Type%20inference%20concerns/near/254866847" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Type.20inference.20concerns.html#254866847">(Sep 25 2021 at 20:09)</a>:</h4>
<p>Can you explain what we might do that could break programs?</p>



<a name="254867276"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Type%20inference%20concerns/near/254867276" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Type.20inference.20concerns.html#254867276">(Sep 25 2021 at 20:16)</a>:</h4>
<p>adding impls that drive type inference to infer primitive/common Rust types, basically. But I THINK it only matters though if our code is actually pulled into scope, but it probably means we shouldn't get into the prelude, lol.</p>



<a name="254867879"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Type%20inference%20concerns/near/254867879" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Type.20inference.20concerns.html#254867879">(Sep 25 2021 at 20:26)</a>:</h4>
<blockquote>
<p>Looks like the problem is <code>impl PartialEq&lt;Value&gt; for u8</code> in serde_json. Without that, <code>impl PartialEq&lt;u8&gt; for u8</code> is the only <code>PartialEq</code> impl for <code>u8</code>.</p>
</blockquote>
<p>basically this.</p>



<a name="254868508"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Type%20inference%20concerns/near/254868508" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Type.20inference.20concerns.html#254868508">(Sep 25 2021 at 20:36)</a>:</h4>
<p>Hmmm. I think we don't impl anything other than ops so we may be okay</p>



<a name="254868652"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Type%20inference%20concerns/near/254868652" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Type.20inference.20concerns.html#254868652">(Sep 25 2021 at 20:39)</a>:</h4>
<p>Yeah, and people are used to having inference on adding integers falter. I just figured I'd mention it now so that we can remain aware now that we are getting closer integration with {core,std} and such.</p>



<a name="254870490"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Type%20inference%20concerns/near/254870490" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Type.20inference.20concerns.html#254870490">(Sep 25 2021 at 21:06)</a>:</h4>
<p>Also, worth noting maybe we could end up in the prelude since that change would happen at an edition change</p>



<a name="254871018"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Type%20inference%20concerns/near/254871018" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Type.20inference.20concerns.html#254871018">(Sep 25 2021 at 21:15)</a>:</h4>
<p>just stabilize before 2021 edition and go into that prelude ;3</p>



<a name="254872937"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Type%20inference%20concerns/near/254872937" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Type.20inference.20concerns.html#254872937">(Sep 25 2021 at 21:47)</a>:</h4>
<p><span class="user-mention silent" data-user-id="312331">Caleb Zulawski</span> <a href="#narrow/stream/257879-project-portable-simd/topic/Type.20inference.20concerns/near/254870490">said</a>:</p>
<blockquote>
<p>Also, worth noting maybe we could end up in the prelude since that change would happen at an edition change</p>
</blockquote>
<p>there is nothing necessarily requiring prelude changes to be edition gated as I understand it, it just makes it messier.</p>



<a name="258125051"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Type%20inference%20concerns/near/258125051" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Type.20inference.20concerns.html#258125051">(Oct 19 2021 at 00:53)</a>:</h4>
<p>New types in the prelude are generally fine.  It's just new traits that can cause problems -- and even those are only the kind of problem that we're allowed to cause even without an edition, so long as they're not too bad.</p>



<a name="261593805"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Type%20inference%20concerns/near/261593805" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Type.20inference.20concerns.html#261593805">(Nov 16 2021 at 03:32)</a>:</h4>
<p>We hit one: <a href="https://github.com/rust-lang/rust/issues/90904">https://github.com/rust-lang/rust/issues/90904</a></p>



<a name="263338468"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Type%20inference%20concerns/near/263338468" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Type.20inference.20concerns.html#263338468">(Dec 01 2021 at 18:51)</a>:</h4>
<p><a href="https://github.com/sharkdp/bat/issues/1963">https://github.com/sharkdp/bat/issues/1963</a> Breaking builds.</p>



<a name="263352099"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Type%20inference%20concerns/near/263352099" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Type.20inference.20concerns.html#263352099">(Dec 01 2021 at 20:19)</a>:</h4>
<p>Those minimized things are weird.  Which are the problematic ones.  Just the <code>Add&lt;u8&gt;</code> ones and such?</p>



<a name="263354872"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Type%20inference%20concerns/near/263354872" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Type.20inference.20concerns.html#263354872">(Dec 01 2021 at 20:43)</a>:</h4>
<p>Yeah.</p>



<a name="263358680"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Type%20inference%20concerns/near/263358680" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Type.20inference.20concerns.html#263358680">(Dec 01 2021 at 21:15)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281757">Jubilee</span> <a href="https://github.com/rust-lang/rust/issues/90904#issuecomment-984048967">said</a>:</p>
<blockquote>
<p>This was reviewed in the T-libs-api meeting today, right now, and it was decided that we will need to land a revert of the relevant impls that follow a format roughly equivalent to</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">impl</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">N</span>: <span class="kt">usize</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Add</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Simd</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="o">&gt;</span><span class="w"></span>
<span class="k">where</span><span class="w"></span>
<span class="w">    </span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">Simd</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">AndYourDog</span>: <span class="nc">ManySimdBounds</span><span class="p">,</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">Output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">Self</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">rhs</span>: <span class="nc">T</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Simd</span>::<span class="n">splat</span><span class="p">(</span><span class="n">rhs</span><span class="p">))</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>and, because this breakage has currently hit beta, beta backport it.</p>
<p>However, the backport should be deferred (not very long!) until after the next scheduled beta crater run (which is very soon to come, within a week) so we can see the amount of ecosystem breakage in play and understand the relevant mitigations we can take for landing these impls in the future, if any. Essentially, "Since we're here, we might as well see what all the broken cases actually are!" We have until January ~7, to make sure we don't miss the cut, but there will be no reason to wait that long.</p>
<p>Ideally we could land these in the future, but it may be a more distant one depending on the results of that and what may need to happen in order to accommodate these cases, if at all.</p>
</blockquote>



<a name="263359270"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Type%20inference%20concerns/near/263359270" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Type.20inference.20concerns.html#263359270">(Dec 01 2021 at 21:20)</a>:</h4>
<p><code>AndYourDog: ManySimdBounds</code> <span aria-label="joy" class="emoji emoji-1f602" role="img" title="joy">:joy:</span></p>



<a name="263364677"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Type%20inference%20concerns/near/263364677" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Type.20inference.20concerns.html#263364677">(Dec 01 2021 at 22:07)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281757">Jubilee</span> <a href="#narrow/stream/257879-project-portable-simd/topic/Type.20inference.20concerns/near/254867276">said</a>:</p>
<blockquote>
<p>adding impls that drive type inference to infer primitive/common Rust types, basically. But I THINK it only matters though if our code is actually pulled into scope, but it probably means we shouldn't get into the prelude, lol.</p>
</blockquote>
<p>This doesn't actually really matter, as it turns out. :D</p>



<a name="263371061"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Type%20inference%20concerns/near/263371061" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Type.20inference.20concerns.html#263371061">(Dec 01 2021 at 23:11)</a>:</h4>
<p>confirmed for prelude then</p>



<a name="263375021"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Type%20inference%20concerns/near/263375021" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Type.20inference.20concerns.html#263375021">(Dec 01 2021 at 23:56)</a>:</h4>
<p>The required changes were folded in to <a href="https://github.com/rust-lang/portable-simd/pull/195">https://github.com/rust-lang/portable-simd/pull/195</a> because that was the PR I was mangling the implementations of everything in anyways.</p>



<a name="263523135"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Type%20inference%20concerns/near/263523135" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Type.20inference.20concerns.html#263523135">(Dec 03 2021 at 01:09)</a>:</h4>
<p>re: next sync, <span class="user-mention" data-user-id="312331">@Caleb Zulawski</span> We probably want to go earlier rather than later due to needing to backport the changes in order to not break users on stable. I realize it's awkward but <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span></p>



<a name="263523480"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Type%20inference%20concerns/near/263523480" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Type.20inference.20concerns.html#263523480">(Dec 03 2021 at 01:13)</a>:</h4>
<p>maybe we should revert the bitops change before that sync?  And then we can readdress those more completely along with the other ops</p>



<a name="263523572"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Type%20inference%20concerns/near/263523572" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Type.20inference.20concerns.html#263523572">(Dec 03 2021 at 01:14)</a>:</h4>
<p>Mm, is it currently any more invalid than the other things, tho'?</p>



<a name="263523652"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Type%20inference%20concerns/near/263523652" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Type.20inference.20concerns.html#263523652">(Dec 03 2021 at 01:15)</a>:</h4>
<p>I suppose it's no more invalid than the lane comparisons, if that's what you mean</p>



<a name="263523726"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Type%20inference%20concerns/near/263523726" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Type.20inference.20concerns.html#263523726">(Dec 03 2021 at 01:16)</a>:</h4>
<p>Basically.</p>



<a name="263523738"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Type%20inference%20concerns/near/263523738" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Type.20inference.20concerns.html#263523738">(Dec 03 2021 at 01:16)</a>:</h4>
<p>it might be unnecessary work in that case</p>



<a name="263523794"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Type%20inference%20concerns/near/263523794" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Type.20inference.20concerns.html#263523794">(Dec 03 2021 at 01:17)</a>:</h4>
<p>I will probably set some time aside to automate the sync process so we can just resolve these questions by saying, "nah, we're just gonna throw sync PRs as fast as bors can keep up" instead.</p>



<a name="263524247"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Type%20inference%20concerns/near/263524247" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Type.20inference.20concerns.html#263524247">(Dec 03 2021 at 01:22)</a>:</h4>
<p>get users goin' "hey I like the code I can write this week more than the code I can write 2 weeks ago but I preferred the code I could write last month."</p>



<a name="263529116"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Type%20inference%20concerns/near/263529116" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Type.20inference.20concerns.html#263529116">(Dec 03 2021 at 02:36)</a>:</h4>
<div class="codehilite" data-code-language="PowerShell"><pre><span></span><code><span class="n">error</span><span class="no">[E0277]</span><span class="p">:</span> <span class="n">cannot</span> <span class="n">multiply</span> <span class="p">`</span><span class="n">Simd</span><span class="p">&lt;</span><span class="n">f32</span><span class="p">,</span> <span class="n">4_usize</span><span class="p">&gt;`</span> <span class="n">by</span> <span class="p">`{</span><span class="n">float</span><span class="p">}`</span>
  <span class="p">--&gt;</span> <span class="n">library</span><span class="p">\</span><span class="n">core</span><span class="p">\</span><span class="n">tests</span><span class="p">\</span><span class="n">simd</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="n">10</span><span class="p">:</span><span class="n">15</span>
   <span class="p">|</span>
<span class="n">10</span> <span class="p">|</span>     <span class="n">let</span> <span class="nb">h </span><span class="p">=</span> <span class="n">x</span> <span class="p">*</span> <span class="n">0</span><span class="p">.</span><span class="n">5</span><span class="p">;</span>
   <span class="p">|</span>               <span class="p">^</span> <span class="n">no</span> <span class="n">implementation</span> <span class="k">for</span> <span class="p">`</span><span class="n">Simd</span><span class="p">&lt;</span><span class="n">f32</span><span class="p">,</span> <span class="n">4_usize</span><span class="p">&gt;</span> <span class="p">*</span> <span class="p">{</span><span class="n">float</span><span class="p">}`</span>
   <span class="p">|</span>
   <span class="p">=</span> <span class="n">help</span><span class="p">:</span> <span class="n">the</span> <span class="n">trait</span> <span class="p">`</span><span class="n">std</span><span class="p">::</span><span class="n">ops</span><span class="p">::</span><span class="n">Mul</span><span class="p">&lt;{</span><span class="n">float</span><span class="p">}&gt;`</span> <span class="n">is</span> <span class="n">not</span> <span class="n">implemented</span> <span class="k">for</span> <span class="p">`</span><span class="n">Simd</span><span class="p">&lt;</span><span class="n">f32</span><span class="p">,</span> <span class="n">4_usize</span><span class="p">&gt;`</span>

<span class="k">For</span> <span class="n">more</span> <span class="n">information</span> <span class="n">about</span> <span class="n">this</span> <span class="n">error</span><span class="p">,</span> <span class="k">try</span> <span class="p">`</span><span class="n">rustc</span> <span class="p">-</span><span class="n">-explain</span> <span class="n">E0277</span><span class="p">`.</span>
</code></pre></div>
<p>Pain.</p>



<a name="263531429"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Type%20inference%20concerns/near/263531429" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Type.20inference.20concerns.html#263531429">(Dec 03 2021 at 03:19)</a>:</h4>
<p>why does rustc even report float and int as missing trait impls when they're not types you can actually make values of. silly rustc</p>



<a name="263557121"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Type%20inference%20concerns/near/263557121" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Type.20inference.20concerns.html#263557121">(Dec 03 2021 at 10:02)</a>:</h4>
<p><code>{int}</code> and <code>{float}</code> are inference variables restricted to integers or floats. Rustc will unify them with any integer/float type, but not any other types like regular inference variables (printed as <code>_</code> in errors by default).</p>



<a name="263557286"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Type%20inference%20concerns/near/263557286" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Type.20inference.20concerns.html#263557286">(Dec 03 2021 at 10:04)</a>:</h4>
<p>Whenever a float literal is written, the typechecker will create a <code>{float}</code> inference variable. <code>{int}</code> and <code>{float}</code> normally default to <code>i32</code> (or was it <code>u32</code>) and <code>f32</code>, but sometimes this defaulting doesn't happen.</p>



<a name="263615506"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Type%20inference%20concerns/near/263615506" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Type.20inference.20concerns.html#263615506">(Dec 03 2021 at 18:00)</a>:</h4>
<p>umm, iirc <code>{int}</code> defaults to <code>i32</code> and <code>{float}</code> defaults to <code>f64</code></p>



<a name="263615659"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Type%20inference%20concerns/near/263615659" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Type.20inference.20concerns.html#263615659">(Dec 03 2021 at 18:01)</a>:</h4>
<p><a href="https://doc.rust-lang.org/rust-by-example/types/literals.html">https://doc.rust-lang.org/rust-by-example/types/literals.html</a> 2nd paragraph</p>



<a name="263615704"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Type%20inference%20concerns/near/263615704" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Type.20inference.20concerns.html#263615704">(Dec 03 2021 at 18:01)</a>:</h4>
<blockquote>
<p>The type of unsuffixed numeric literals will depend on how they are used. If no constraint exists, the compiler will use i32 for integers, and f64 for floating-point numbers.</p>
</blockquote>



<a name="263617306"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Type%20inference%20concerns/near/263617306" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Type.20inference.20concerns.html#263617306">(Dec 03 2021 at 18:14)</a>:</h4>
<p>Right that was my thinking, so it shouldn't ever try "multiply by {int}", because that clearly isn't a thing to begin with, so i would expect the message to be about i32, or in the case of {float} give a message about f64.</p>



<a name="263617673"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Type%20inference%20concerns/near/263617673" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Type.20inference.20concerns.html#263617673">(Dec 03 2021 at 18:16)</a>:</h4>
<p>basically, if the compiler says "the trait <code>Name</code> is not implemented for <code>Type</code>", I expect that it should be possible to actually implement Name for Type (or for <em>someone</em> to be able to do it, orphan rules, whatever, you get the idea).</p>



<a name="263617700"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Type%20inference%20concerns/near/263617700" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Type.20inference.20concerns.html#263617700">(Dec 03 2021 at 18:16)</a>:</h4>
<p>imho the message should still be about <code>{int}</code> or <code>{float}</code> cuz if you error about no impl for i32 users may have a harder time figuring out that an impl for u8 also works</p>



<a name="263617751"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Type%20inference%20concerns/near/263617751" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Type.20inference.20concerns.html#263617751">(Dec 03 2021 at 18:17)</a>:</h4>
<p>it could explain what <code>{int}</code> means tho</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>