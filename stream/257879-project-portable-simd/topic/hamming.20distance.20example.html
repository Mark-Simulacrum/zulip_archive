<html>
<head><meta charset="utf-8"><title>hamming distance example · project-portable-simd · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/index.html">project-portable-simd</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/hamming.20distance.20example.html">hamming distance example</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="277549667"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/hamming%20distance%20example/near/277549667" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/hamming.20distance.20example.html#277549667">(Apr 02 2022 at 20:22)</a>:</h4>
<p>Posting here if anyone wants to take a crack at coming up with the fastest SIMD version of the <code>hamming distance</code> exercise</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">hamming0</span><span class="p">(</span><span class="n">a</span>: <span class="kp">&amp;</span><span class="kt">str</span><span class="p">,</span><span class="w"> </span><span class="n">b</span>: <span class="kp">&amp;</span><span class="kt">str</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">i32</span> <span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">a</span><span class="p">.</span><span class="n">chars</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="n">zip</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">chars</span><span class="p">())</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="o">|</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="o">|</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="n">fold</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">acc</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">acc</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">i32</span><span class="p">})</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span><span class="w"> </span><span class="n">hamming0</span><span class="p">(</span><span class="s">"abcabc"</span><span class="p">,</span><span class="w"> </span><span class="s">"abcabb"</span><span class="p">));</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="277549970"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/hamming%20distance%20example/near/277549970" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Samuel Shepard <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/hamming.20distance.20example.html#277549970">(Apr 02 2022 at 20:28)</a>:</h4>
<p>I do plan to try,  happy for anyone else to do so as well since you have much more experience, but for my application I'm interested in the u8 version because that's how we store genetic information.</p>



<a name="277549981"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/hamming%20distance%20example/near/277549981" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/hamming.20distance.20example.html#277549981">(Apr 02 2022 at 20:29)</a>:</h4>
<p>Oh, yeah, the <code>.chars()</code> there is going to essentially keep it from ever using simd.</p>



<a name="277550289"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/hamming%20distance%20example/near/277550289" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/hamming.20distance.20example.html#277550289">(Apr 02 2022 at 20:37)</a>:</h4>
<p><span class="user-mention" data-user-id="480147">@Samuel Shepard</span> if you're already looking at DNA/RNA seq's,</p>
<ol>
<li>May I suggest looking at Julia's <code>BioSequences.jl</code> <a href="https://biojulia.net/BioSequences.jl/stable/counting/">package</a>?</li>
</ol>
<div class="codehilite" data-code-language="Julia"><pre><span></span><code><span class="n">julia</span><span class="o">&gt;</span> <span class="k">using</span> <span class="n">BioSequences</span>
<span class="n">julia</span><span class="o">&gt;</span> <span class="n">count</span><span class="p">(</span><span class="o">!=</span><span class="p">,</span> <span class="sa">dna</span><span class="s">"ATCGM"</span><span class="p">,</span> <span class="sa">dna</span><span class="s">"GCCGM"</span><span class="p">)</span>
<span class="mi">2</span>
</code></pre></div>
<p>That package will already handle most of the super efficient encoding and bit packing and SIMD that you want. No need to reinvent the wheel if you just want something that's already productive. Specifically, if you can provide more specific information on the base pair encoding,it is possible to speedup the computations and such by simply changing the types.</p>
<ol start="2">
<li><span class="user-mention" data-user-id="125270">@scottmcm</span> what's the alternative to <code>chars()</code> here? I'm fighting <code>rustc</code> to give me a plain bytes iterator.</li>
</ol>



<a name="277550360"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/hamming%20distance%20example/near/277550360" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/hamming.20distance.20example.html#277550360">(Apr 02 2022 at 20:38)</a>:</h4>
<p><span class="user-mention silent" data-user-id="246783">Miguel Raz Guzmán Macedo</span> <a href="#narrow/stream/257879-project-portable-simd/topic/hamming.20distance.20example/near/277550289">said</a>:</p>
<blockquote>
<ol start="2">
<li><span class="user-mention silent" data-user-id="125270">scottmcm</span> what's the alternative to <code>chars()</code> here? I'm fighting <code>rustc</code> to give me a plain bytes iterator.</li>
</ol>
</blockquote>
<p><code>.bytes()</code></p>



<a name="277550369"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/hamming%20distance%20example/near/277550369" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/hamming.20distance.20example.html#277550369">(Apr 02 2022 at 20:38)</a>:</h4>
<p><span class="user-mention silent" data-user-id="246783">Miguel Raz Guzmán Macedo</span> <a href="#narrow/stream/257879-project-portable-simd/topic/hamming.20distance.20example/near/277550289">said</a>:</p>
<blockquote>
<ol start="2">
<li><span class="user-mention silent" data-user-id="125270">scottmcm</span> what's the alternative to <code>chars()</code> here? I'm fighting <code>rustc</code> to give me a plain bytes iterator.</li>
</ol>
</blockquote>
<p>or <a href="https://doc.rust-lang.org/std/primitive.str.html#method.as_bytes">https://doc.rust-lang.org/std/primitive.str.html#method.as_bytes</a> for a <code>&amp;[u8]</code>.</p>



<a name="277550386"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/hamming%20distance%20example/near/277550386" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/hamming.20distance.20example.html#277550386">(Apr 02 2022 at 20:38)</a>:</h4>
<p>...darn it I would've sworn I tried that.</p>



<a name="277550400"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/hamming%20distance%20example/near/277550400" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/hamming.20distance.20example.html#277550400">(Apr 02 2022 at 20:39)</a>:</h4>
<p>Here's my stab at a scalar version: <a href="https://rust.godbolt.org/z/n3KMr1xxr">https://rust.godbolt.org/z/n3KMr1xxr</a></p>



<a name="277550489"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/hamming%20distance%20example/near/277550489" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/hamming.20distance.20example.html#277550489">(Apr 02 2022 at 20:40)</a>:</h4>
<p>Neat!</p>



<a name="277550502"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/hamming%20distance%20example/near/277550502" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/hamming.20distance.20example.html#277550502">(Apr 02 2022 at 20:40)</a>:</h4>
<p>What are the metrics that we want to talk to people about here?</p>
<div class="codehilite" data-code-language="Markdown"><pre><span></span><code>Iterations:        100
Instructions:      12100
Total Cycles:      3220
Total uOps:        12700

Dispatch Width:    6
uOps Per Cycle:    3.94
IPC:               3.76
Block RThroughput: 31.0
</code></pre></div>



<a name="277550503"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/hamming%20distance%20example/near/277550503" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/hamming.20distance.20example.html#277550503">(Apr 02 2022 at 20:40)</a>:</h4>
<p>It's okay to flail a bit. No language has a perfect story for "here's the method you want to use when you want type X".<br>
like<br>
it'd work if you knew the Bytes type exists.</p>



<a name="277550519"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/hamming%20distance%20example/near/277550519" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/hamming.20distance.20example.html#277550519">(Apr 02 2022 at 20:41)</a>:</h4>
<p>and is in fact an iterator over bytes<br>
but you don't know a priori what the iterator over bytes is named</p>



<a name="277550521"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/hamming%20distance%20example/near/277550521" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/hamming.20distance.20example.html#277550521">(Apr 02 2022 at 20:41)</a>:</h4>
<p>Oh, with a higher target-cpu that works much better:  <a href="https://rust.godbolt.org/z/5cWE836xq">https://rust.godbolt.org/z/5cWE836xq</a></p>
<div class="codehilite" data-code-language="LLVM"><pre><span></span><code><span class="w">  </span><span class="nv nv-Anonymous">%17</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">icmp</span><span class="w"> </span><span class="k">ne</span><span class="w"> </span><span class="p">&lt;</span><span class="m">4</span><span class="w"> </span><span class="k">x</span><span class="w"> </span><span class="kt">i8</span><span class="p">&gt;</span><span class="w"> </span><span class="nv">%wide.load</span><span class="p">,</span><span class="w"> </span><span class="nv">%wide.load29</span><span class="p">,</span><span class="w"> </span><span class="nv">!dbg</span><span class="w"> </span><span class="nv nv-Anonymous">!84</span><span class="w"></span>
<span class="w">  </span><span class="nv nv-Anonymous">%18</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">icmp</span><span class="w"> </span><span class="k">ne</span><span class="w"> </span><span class="p">&lt;</span><span class="m">4</span><span class="w"> </span><span class="k">x</span><span class="w"> </span><span class="kt">i8</span><span class="p">&gt;</span><span class="w"> </span><span class="nv">%wide.load26</span><span class="p">,</span><span class="w"> </span><span class="nv">%wide.load30</span><span class="p">,</span><span class="w"> </span><span class="nv">!dbg</span><span class="w"> </span><span class="nv nv-Anonymous">!84</span><span class="w"></span>
<span class="w">  </span><span class="nv nv-Anonymous">%19</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">icmp</span><span class="w"> </span><span class="k">ne</span><span class="w"> </span><span class="p">&lt;</span><span class="m">4</span><span class="w"> </span><span class="k">x</span><span class="w"> </span><span class="kt">i8</span><span class="p">&gt;</span><span class="w"> </span><span class="nv">%wide.load27</span><span class="p">,</span><span class="w"> </span><span class="nv">%wide.load31</span><span class="p">,</span><span class="w"> </span><span class="nv">!dbg</span><span class="w"> </span><span class="nv nv-Anonymous">!84</span><span class="w"></span>
<span class="w">  </span><span class="nv nv-Anonymous">%20</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">icmp</span><span class="w"> </span><span class="k">ne</span><span class="w"> </span><span class="p">&lt;</span><span class="m">4</span><span class="w"> </span><span class="k">x</span><span class="w"> </span><span class="kt">i8</span><span class="p">&gt;</span><span class="w"> </span><span class="nv">%wide.load28</span><span class="p">,</span><span class="w"> </span><span class="nv">%wide.load32</span><span class="p">,</span><span class="w"> </span><span class="nv">!dbg</span><span class="w"> </span><span class="nv nv-Anonymous">!84</span><span class="w"></span>
<span class="w">  </span><span class="nv nv-Anonymous">%21</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">zext</span><span class="w"> </span><span class="p">&lt;</span><span class="m">4</span><span class="w"> </span><span class="k">x</span><span class="w"> </span><span class="kt">i1</span><span class="p">&gt;</span><span class="w"> </span><span class="nv nv-Anonymous">%17</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="p">&lt;</span><span class="m">4</span><span class="w"> </span><span class="k">x</span><span class="w"> </span><span class="kt">i64</span><span class="p">&gt;,</span><span class="w"> </span><span class="nv">!dbg</span><span class="w"> </span><span class="nv nv-Anonymous">!105</span><span class="w"></span>
<span class="w">  </span><span class="nv nv-Anonymous">%22</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">zext</span><span class="w"> </span><span class="p">&lt;</span><span class="m">4</span><span class="w"> </span><span class="k">x</span><span class="w"> </span><span class="kt">i1</span><span class="p">&gt;</span><span class="w"> </span><span class="nv nv-Anonymous">%18</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="p">&lt;</span><span class="m">4</span><span class="w"> </span><span class="k">x</span><span class="w"> </span><span class="kt">i64</span><span class="p">&gt;,</span><span class="w"> </span><span class="nv">!dbg</span><span class="w"> </span><span class="nv nv-Anonymous">!105</span><span class="w"></span>
<span class="w">  </span><span class="nv nv-Anonymous">%23</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">zext</span><span class="w"> </span><span class="p">&lt;</span><span class="m">4</span><span class="w"> </span><span class="k">x</span><span class="w"> </span><span class="kt">i1</span><span class="p">&gt;</span><span class="w"> </span><span class="nv nv-Anonymous">%19</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="p">&lt;</span><span class="m">4</span><span class="w"> </span><span class="k">x</span><span class="w"> </span><span class="kt">i64</span><span class="p">&gt;,</span><span class="w"> </span><span class="nv">!dbg</span><span class="w"> </span><span class="nv nv-Anonymous">!105</span><span class="w"></span>
<span class="w">  </span><span class="nv nv-Anonymous">%24</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">zext</span><span class="w"> </span><span class="p">&lt;</span><span class="m">4</span><span class="w"> </span><span class="k">x</span><span class="w"> </span><span class="kt">i1</span><span class="p">&gt;</span><span class="w"> </span><span class="nv nv-Anonymous">%20</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="p">&lt;</span><span class="m">4</span><span class="w"> </span><span class="k">x</span><span class="w"> </span><span class="kt">i64</span><span class="p">&gt;,</span><span class="w"> </span><span class="nv">!dbg</span><span class="w"> </span><span class="nv nv-Anonymous">!105</span><span class="w"></span>
<span class="w">  </span><span class="nv nv-Anonymous">%25</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="p">&lt;</span><span class="m">4</span><span class="w"> </span><span class="k">x</span><span class="w"> </span><span class="kt">i64</span><span class="p">&gt;</span><span class="w"> </span><span class="nv">%vec.phi</span><span class="p">,</span><span class="w"> </span><span class="nv nv-Anonymous">%21</span><span class="p">,</span><span class="w"> </span><span class="nv">!dbg</span><span class="w"> </span><span class="nv nv-Anonymous">!106</span><span class="w"></span>
<span class="w">  </span><span class="nv nv-Anonymous">%26</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="p">&lt;</span><span class="m">4</span><span class="w"> </span><span class="k">x</span><span class="w"> </span><span class="kt">i64</span><span class="p">&gt;</span><span class="w"> </span><span class="nv">%vec.phi23</span><span class="p">,</span><span class="w"> </span><span class="nv nv-Anonymous">%22</span><span class="p">,</span><span class="w"> </span><span class="nv">!dbg</span><span class="w"> </span><span class="nv nv-Anonymous">!106</span><span class="w"></span>
<span class="w">  </span><span class="nv nv-Anonymous">%27</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="p">&lt;</span><span class="m">4</span><span class="w"> </span><span class="k">x</span><span class="w"> </span><span class="kt">i64</span><span class="p">&gt;</span><span class="w"> </span><span class="nv">%vec.phi24</span><span class="p">,</span><span class="w"> </span><span class="nv nv-Anonymous">%23</span><span class="p">,</span><span class="w"> </span><span class="nv">!dbg</span><span class="w"> </span><span class="nv nv-Anonymous">!106</span><span class="w"></span>
<span class="w">  </span><span class="nv nv-Anonymous">%28</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="p">&lt;</span><span class="m">4</span><span class="w"> </span><span class="k">x</span><span class="w"> </span><span class="kt">i64</span><span class="p">&gt;</span><span class="w"> </span><span class="nv">%vec.phi25</span><span class="p">,</span><span class="w"> </span><span class="nv nv-Anonymous">%24</span><span class="p">,</span><span class="w"> </span><span class="nv">!dbg</span><span class="w"> </span><span class="nv nv-Anonymous">!106</span><span class="w"></span>
</code></pre></div>



<a name="277550525"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/hamming%20distance%20example/near/277550525" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/hamming.20distance.20example.html#277550525">(Apr 02 2022 at 20:41)</a>:</h4>
<p>Surely there's a neat explainer that can go in the <code>Beginner Guide</code>/<code>README.md</code></p>



<a name="277550577"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/hamming%20distance%20example/near/277550577" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/hamming.20distance.20example.html#277550577">(Apr 02 2022 at 20:42)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281757">Jubilee</span> <a href="#narrow/stream/257879-project-portable-simd/topic/hamming.20distance.20example/near/277550519">said</a>:</p>
<blockquote>
<p>and is in fact an iterator over bytes<br>
but you don't know a priori what the iterator over bytes is named</p>
</blockquote>
<p>If we had smth like Haskell's type-driven search for "I want the function on type X that returns a type that <code>impl Iterator&lt;Item = u8&gt;</code> actually that would be pretty good.</p>



<a name="277550579"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/hamming%20distance%20example/near/277550579" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/hamming.20distance.20example.html#277550579">(Apr 02 2022 at 20:42)</a>:</h4>
<p><span class="user-mention" data-user-id="125270">@scottmcm</span> whoa, didn't know you could change the target-cpu like that...</p>
<p>I should <span aria-label="writing" class="emoji emoji-270d" role="img" title="writing">:writing:</span> in the <code>README.md</code>...</p>



<a name="277550585"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/hamming%20distance%20example/near/277550585" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/hamming.20distance.20example.html#277550585">(Apr 02 2022 at 20:42)</a>:</h4>
<p>Yes.</p>



<a name="277550588"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/hamming%20distance%20example/near/277550588" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/hamming.20distance.20example.html#277550588">(Apr 02 2022 at 20:42)</a>:</h4>
<p>Do we support tune-cpu yet?</p>



<a name="277550596"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/hamming%20distance%20example/near/277550596" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/hamming.20distance.20example.html#277550596">(Apr 02 2022 at 20:43)</a>:</h4>
<p>Only on nightly, maybe?</p>



<a name="277550653"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/hamming%20distance%20example/near/277550653" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/hamming.20distance.20example.html#277550653">(Apr 02 2022 at 20:44)</a>:</h4>
<p>Oh, switching off <code>usize</code> down to <code>u32</code> unsurprisingly helps a bunch, at it does 8-LANES instead of 4-LANES: <a href="https://rust.godbolt.org/z/W8roKjsxM">https://rust.godbolt.org/z/W8roKjsxM</a></p>



<a name="277550675"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/hamming%20distance%20example/near/277550675" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/hamming.20distance.20example.html#277550675">(Apr 02 2022 at 20:45)</a>:</h4>
<p>I guess it doesn't know how to sink casts into simd chains the way it does for scalar code.</p>



<a name="277550688"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/hamming%20distance%20example/near/277550688" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/hamming.20distance.20example.html#277550688">(Apr 02 2022 at 20:45)</a>:</h4>
<p><span class="user-mention silent" data-user-id="125270">scottmcm</span> <a href="#narrow/stream/257879-project-portable-simd/topic/hamming.20distance.20example/near/277550653">said</a>:</p>
<blockquote>
<p>Oh, switching off <code>usize</code> down to <code>u32</code> unsurprisingly helps a bunch, at it does 8-LANES instead of 4-LANES: <a href="https://rust.godbolt.org/z/W8roKjsxM">https://rust.godbolt.org/z/W8roKjsxM</a></p>
</blockquote>
<p><span class="user-mention" data-user-id="125270">@scottmcm</span> is there a list of all the different comp targets besids <code>target-cpu=znver2</code> that I can point our kind readers to?</p>



<a name="277550740"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/hamming%20distance%20example/near/277550740" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/hamming.20distance.20example.html#277550740">(Apr 02 2022 at 20:46)</a>:</h4>
<p><code>-C target-cpu=help</code></p>



<a name="277550750"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/hamming%20distance%20example/near/277550750" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Samuel Shepard <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/hamming.20distance.20example.html#277550750">(Apr 02 2022 at 20:46)</a>:</h4>
<p><span class="user-mention" data-user-id="246783">@Miguel Raz Guzmán Macedo</span>  I am specifically rewriting some things I have in other languages in Rust for a production purpose. All of these simple functions have been written somewhere by someone, it's just a matter of learning the basics of vectorization so I can accelerate whatever I want. To that end, I'm starting with simple and familiar problems.</p>
<p>I'm particularly impressed with Rust's overall portability. It also helps me to write better code. I briefly looked at Julia, but AOT compile story was very painful. I liked it otherwise.</p>
<p>Sorry for the tangent.</p>



<a name="277550815"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/hamming%20distance%20example/near/277550815" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/hamming.20distance.20example.html#277550815">(Apr 02 2022 at 20:48)</a>:</h4>
<p>ha ha only serious: compiler that takes Julia code and emits Rust</p>



<a name="277550828"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/hamming%20distance%20example/near/277550828" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/hamming.20distance.20example.html#277550828">(Apr 02 2022 at 20:48)</a>:</h4>
<p><span class="user-mention silent" data-user-id="480147">Samuel Shepard</span> <a href="#narrow/stream/257879-project-portable-simd/topic/hamming.20distance.20example/near/277550750">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="246783">Miguel Raz Guzmán Macedo</span>  I am specifically rewriting some things I have in other languages in Rust for a production purpose. All of these simple functions have been written somewhere by someone, it's just a matter of learning the basics of vectorization so I can accelerate whatever I want. To that end, I'm starting with simple and familiar problems.</p>
<p>I'm particularly impressed with Rust's overall portability. It also helps me to write better code. I briefly looked at Julia, but AOT compile story was very painful. I liked it otherwise.</p>
<p>Sorry for the tangent.</p>
</blockquote>
<p>No worries - that's a good reason to switch to Rust imo. It's gotten way, way better in the last few releases if you are willing to take a look at it again, but no worries.</p>



<a name="277550830"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/hamming%20distance%20example/near/277550830" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/hamming.20distance.20example.html#277550830">(Apr 02 2022 at 20:49)</a>:</h4>
<p>The most useful targets for me are </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">    </span><span class="n">x86</span><span class="o">-</span><span class="mi">64</span><span class="w"></span>
<span class="w">    </span><span class="n">x86</span><span class="o">-</span><span class="mi">64</span><span class="o">-</span><span class="n">v2</span><span class="w"></span>
<span class="w">    </span><span class="n">x86</span><span class="o">-</span><span class="mi">64</span><span class="o">-</span><span class="n">v3</span><span class="w"></span>
<span class="w">    </span><span class="n">x86</span><span class="o">-</span><span class="mi">64</span><span class="o">-</span><span class="n">v4</span><span class="w"></span>
</code></pre></div>
<p>which you can read more about in <a href="https://github.com/rust-lang/rust/issues/82024">#82024</a></p>
<p>Because individual chips are generally not that useful (running on your own machine only you can use <code>native</code>), but the different "eras" of chips (since x64 is so old) can help.</p>



<a name="277550889"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/hamming%20distance%20example/near/277550889" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/hamming.20distance.20example.html#277550889">(Apr 02 2022 at 20:50)</a>:</h4>
<p><code>rustc --print</code> accepts the following arguments:</p>
<p><code>[crate-name|file-names|sysroot|target-libdir|cfg|target-list|target-cpus|target-features|relocation-models|code-models|tls-models|target-spec-json|native-static-libs|stack-protector-strategies|link-args]</code></p>



<a name="277550899"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/hamming%20distance%20example/near/277550899" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/hamming.20distance.20example.html#277550899">(Apr 02 2022 at 20:50)</a>:</h4>
<p>Often you want to combine this with e.g.<br>
<code>--target</code></p>



<a name="277550969"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/hamming%20distance%20example/near/277550969" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/hamming.20distance.20example.html#277550969">(Apr 02 2022 at 20:52)</a>:</h4>
<p>so you compose those with <code>| grep &lt;PATTERN&gt;</code> to answer a query like<br>
"what are the features for this?"<br>
here is an example of this being done in a rustc issue, because this was one of my recent side adventures<br>
<a href="https://github.com/rust-lang/rust/issues/95122">https://github.com/rust-lang/rust/issues/95122</a></p>



<a name="277551013"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/hamming%20distance%20example/near/277551013" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/hamming.20distance.20example.html#277551013">(Apr 02 2022 at 20:53)</a>:</h4>
<p><span class="user-mention silent" data-user-id="125270">scottmcm</span> <a href="#narrow/stream/257879-project-portable-simd/topic/hamming.20distance.20example/near/277550830">said</a>:</p>
<blockquote>
<p>The most useful targets for me are </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">    </span><span class="n">x86</span><span class="o">-</span><span class="mi">64</span><span class="w"></span>
<span class="w">    </span><span class="n">x86</span><span class="o">-</span><span class="mi">64</span><span class="o">-</span><span class="n">v2</span><span class="w"></span>
<span class="w">    </span><span class="n">x86</span><span class="o">-</span><span class="mi">64</span><span class="o">-</span><span class="n">v3</span><span class="w"></span>
<span class="w">    </span><span class="n">x86</span><span class="o">-</span><span class="mi">64</span><span class="o">-</span><span class="n">v4</span><span class="w"></span>
</code></pre></div>
<p>which you can read more about in <a href="https://github.com/rust-lang/rust/issues/82024">#82024</a></p>
<p>Because individual chips are generally not that useful (running on your own machine only you can use <code>native</code>), but the different "eras" of chips (since x64 is so old) can help.</p>
</blockquote>
<p>Oh thank you, this really simplifies down a bunch of stuff. I'm so glad these features got coalesced into a single monotonic version number.</p>



<a name="277551022"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/hamming%20distance%20example/near/277551022" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/hamming.20distance.20example.html#277551022">(Apr 02 2022 at 20:53)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/issues/95319">https://github.com/rust-lang/rust/issues/95319</a> <code>--print cfg</code> is particularly useful</p>



<a name="277551142"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/hamming%20distance%20example/near/277551142" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/hamming.20distance.20example.html#277551142">(Apr 02 2022 at 20:55)</a>:</h4>
<p>Yeah, those targets emerged from LLVM and GCC sitting down with like, some distro maintainers I think also? and hashing out the "what should the targets be?"</p>



<a name="277551206"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/hamming%20distance%20example/near/277551206" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/hamming.20distance.20example.html#277551206">(Apr 02 2022 at 20:56)</a>:</h4>
<p>Oh, the table in the PDF is pretty nice:<br>
<a href="/user_uploads/4715/DVTHx0CzfJOYByVbAMVpHTDY/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/DVTHx0CzfJOYByVbAMVpHTDY/image.png" title="image.png"><img src="/user_uploads/4715/DVTHx0CzfJOYByVbAMVpHTDY/image.png"></a></div>



<a name="277551213"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/hamming%20distance%20example/near/277551213" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/hamming.20distance.20example.html#277551213">(Apr 02 2022 at 20:57)</a>:</h4>
<p>It turns out they're almost identical to certain CPUs, like e.g. v3 is very very close to <code>-Ctarget-cpu=haswell</code>.</p>



<a name="277551231"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/hamming%20distance%20example/near/277551231" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/hamming.20distance.20example.html#277551231">(Apr 02 2022 at 20:57)</a>:</h4>
<p>But that's more a function of "the Haswell happens to be very representative of the 'era' of x86-64 CPUs they wanted to describe" than anything else. v3 may, for instance, use different scheduling information than the Haswell.</p>



<a name="277551292"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/hamming%20distance%20example/near/277551292" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/hamming.20distance.20example.html#277551292">(Apr 02 2022 at 20:58)</a>:</h4>
<p><span class="user-mention silent" data-user-id="125270">scottmcm</span> <a href="#narrow/stream/257879-project-portable-simd/topic/hamming.20distance.20example/near/277551206">said</a>:</p>
<blockquote>
<p>Oh, the table in the PDF is pretty nice:<br>
<a href="/user_uploads/4715/DVTHx0CzfJOYByVbAMVpHTDY/image.png">image.png</a></p>
</blockquote>
<p>So do those represent that if you are in <code>v2</code>, you at least have all the instructions in <code>v1</code>, and maybe but not necessarily all of those in <code>v2</code>?</p>



<a name="277551312"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/hamming%20distance%20example/near/277551312" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/hamming.20distance.20example.html#277551312">(Apr 02 2022 at 20:59)</a>:</h4>
<p>And for simd, it looks like it's largely "basic 128-bit simd", "good 128-bit simd", "256-bit simd", "newfangled 512-bit simd" <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span></p>



<a name="277551397"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/hamming%20distance%20example/near/277551397" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/hamming.20distance.20example.html#277551397">(Apr 02 2022 at 21:00)</a>:</h4>
<p><span class="user-mention silent" data-user-id="125270">scottmcm</span> <a href="#narrow/stream/257879-project-portable-simd/topic/hamming.20distance.20example/near/277551312">said</a>:</p>
<blockquote>
<p>And for simd, it looks like it's largely "basic 128-bit simd", "good 128-bit simd", "256-bit simd", "newfangled 512-bit simd" <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span></p>
</blockquote>
<p>Correct.</p>



<a name="277551438"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/hamming%20distance%20example/near/277551438" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/hamming.20distance.20example.html#277551438">(Apr 02 2022 at 21:00)</a>:</h4>
<p><span class="user-mention silent" data-user-id="246783">Miguel Raz Guzmán Macedo</span> <a href="#narrow/stream/257879-project-portable-simd/topic/hamming.20distance.20example/near/277551292">said</a>:</p>
<blockquote>
<p>So do those represent that if you are in <code>v2</code>, you at least have all the instructions in <code>v1</code>, and maybe but not necessarily all of those in <code>v2</code>?</p>
</blockquote>
<p>No, they are "this codegens assuming all of these features are available"</p>



<a name="277551439"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/hamming%20distance%20example/near/277551439" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/hamming.20distance.20example.html#277551439">(Apr 02 2022 at 21:00)</a>:</h4>
<p><span class="user-mention silent" data-user-id="246783">Miguel Raz Guzmán Macedo</span> <a href="#narrow/stream/257879-project-portable-simd/topic/hamming.20distance.20example/near/277551292">said</a>:</p>
<blockquote>
<p>So do those represent that if you are in <code>v2</code>, you at least have all the instructions in <code>v1</code>, and maybe but not necessarily all of those in <code>v2</code>?</p>
</blockquote>
<p>I think it's "everything in your row and above for sure, and you can use runtime detection for fancier things if you want".</p>



<a name="277551460"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/hamming%20distance%20example/near/277551460" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/hamming.20distance.20example.html#277551460">(Apr 02 2022 at 21:01)</a>:</h4>
<p>So a recent Ryzen processor can run <code>v3</code> code but would sigill on <code>v4</code>.</p>



<a name="277551937"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/hamming%20distance%20example/near/277551937" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/hamming.20distance.20example.html#277551937">(Apr 02 2022 at 21:11)</a>:</h4>
<p><span class="user-mention" data-user-id="125270">@scottmcm</span> I got almost identical timings (IIUC) to your <code>filter/count</code> with the <code>map/fold</code> and appropriate <code>&amp;[u8] -&gt; usize</code> <a href="https://rust.godbolt.org/z/bvo15hfhE">switching here</a></p>



<a name="277552478"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/hamming%20distance%20example/near/277552478" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/hamming.20distance.20example.html#277552478">(Apr 02 2022 at 21:23)</a>:</h4>
<p><span class="user-mention silent" data-user-id="246783">Miguel Raz Guzmán Macedo</span> <a href="#narrow/stream/257879-project-portable-simd/topic/hamming.20distance.20example/near/277551937">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="125270">scottmcm</span> I got almost identical timings (IIUC) to your <code>filter/count</code> with the <code>map/fold</code> and appropriate <code>&amp;[u8] -&gt; usize</code> <a href="https://rust.godbolt.org/z/bvo15hfhE">switching here</a></p>
</blockquote>
<p>That's to be expected, with <code>usize</code>, because <code>filter</code>+<code>count</code> is implemented using <code>map</code>+<code>sum</code> <span aria-label="grinning face with smiling eyes" class="emoji emoji-1f601" role="img" title="grinning face with smiling eyes">:grinning_face_with_smiling_eyes:</span>  <a href="https://doc.rust-lang.org/1.59.0/src/core/iter/adapters/filter.rs.html#77">https://doc.rust-lang.org/1.59.0/src/core/iter/adapters/filter.rs.html#77</a></p>
<p>Try comparing these two instead: <a href="https://rust.godbolt.org/z/oTE1dosaf">https://rust.godbolt.org/z/oTE1dosaf</a></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>