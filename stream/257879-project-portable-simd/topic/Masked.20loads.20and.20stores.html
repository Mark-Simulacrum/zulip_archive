<html>
<head><meta charset="utf-8"><title>Masked loads and stores · project-portable-simd · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/index.html">project-portable-simd</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Masked.20loads.20and.20stores.html">Masked loads and stores</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="271049352"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Masked%20loads%20and%20stores/near/271049352" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Masked.20loads.20and.20stores.html#271049352">(Feb 07 2022 at 22:05)</a>:</h4>
<p>Should these methods be offered on <code>ptr</code>, as equivalents to <code>ptr::read</code> and <code>ptr::write</code>?</p>



<a name="271050399"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Masked%20loads%20and%20stores/near/271050399" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Masked.20loads.20and.20stores.html#271050399">(Feb 07 2022 at 22:13)</a>:</h4>
<p>sure, but also on  references to arrays/slices</p>



<a name="271050880"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Masked%20loads%20and%20stores/near/271050880" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Masked.20loads.20and.20stores.html#271050880">(Feb 07 2022 at 22:16)</a>:</h4>
<p>we'd also want unaligned variants</p>



<a name="271050987"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Masked%20loads%20and%20stores/near/271050987" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Masked.20loads.20and.20stores.html#271050987">(Feb 07 2022 at 22:16)</a>:</h4>
<p>I think we probably want the unaligned variants to be the defaults, since we generally think of arrays as aligned to the element type</p>



<a name="271051034"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Masked%20loads%20and%20stores/near/271051034" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Masked.20loads.20and.20stores.html#271051034">(Feb 07 2022 at 22:17)</a>:</h4>
<p>Default meaning having the shortest function name</p>



<a name="271051062"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Masked%20loads%20and%20stores/near/271051062" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Masked.20loads.20and.20stores.html#271051062">(Feb 07 2022 at 22:17)</a>:</h4>
<p>maybe we'd want masked read/write to ptr to Simd so we can get full alignof(Simd) alignment</p>



<a name="271051187"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Masked%20loads%20and%20stores/near/271051187" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Masked.20loads.20and.20stores.html#271051187">(Feb 07 2022 at 22:18)</a>:</h4>
<p>masked read/write to ptr to element or array/slice of element should have element align</p>



<a name="271051238"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Masked%20loads%20and%20stores/near/271051238" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Masked.20loads.20and.20stores.html#271051238">(Feb 07 2022 at 22:18)</a>:</h4>
<p>unaligned read/write shouldn't be default -- it means align=1</p>



<a name="271051248"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Masked%20loads%20and%20stores/near/271051248" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Masked.20loads.20and.20stores.html#271051248">(Feb 07 2022 at 22:18)</a>:</h4>
<p>Yeah, the pointers could be different to indicate alignment</p>



<a name="271051307"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Masked%20loads%20and%20stores/near/271051307" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Masked.20loads.20and.20stores.html#271051307">(Feb 07 2022 at 22:19)</a>:</h4>
<p>I don't mean completely unaligned, I mean scalar aligned</p>



<a name="271051422"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Masked%20loads%20and%20stores/near/271051422" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Masked.20loads.20and.20stores.html#271051422">(Feb 07 2022 at 22:20)</a>:</h4>
<p><a href="https://llvm.org/docs/LangRef.html#llvm-masked-load-intrinsics">https://llvm.org/docs/LangRef.html#llvm-masked-load-intrinsics</a></p>



<a name="271051441"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Masked%20loads%20and%20stores/near/271051441" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Masked.20loads.20and.20stores.html#271051441">(Feb 07 2022 at 22:20)</a>:</h4>
<p>^ has align parameter</p>



<a name="271051697"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Masked%20loads%20and%20stores/near/271051697" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Masked.20loads.20and.20stores.html#271051697">(Feb 07 2022 at 22:22)</a>:</h4>
<p>( I wonder if a const generic parameter would work... )</p>



<a name="271051980"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Masked%20loads%20and%20stores/near/271051980" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Masked.20loads.20and.20stores.html#271051980">(Feb 07 2022 at 22:24)</a>:</h4>
<p>maybe, i was thinking we'd just provide byte/element/full-simd-type aligns and call it a day...<code>ptr::write[_unaligned]</code> seems to get away with something similar</p>



<a name="271051990"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Masked%20loads%20and%20stores/near/271051990" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Masked.20loads.20and.20stores.html#271051990">(Feb 07 2022 at 22:24)</a>:</h4>
<p>I was wondering the same, though I think there are only two possible values we would ever want...</p>



<a name="271052053"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Masked%20loads%20and%20stores/near/271052053" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Masked.20loads.20and.20stores.html#271052053">(Feb 07 2022 at 22:25)</a>:</h4>
<p>Yeah, I was thinking that it'd be a param with a default.</p>



<a name="271052066"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Masked%20loads%20and%20stores/near/271052066" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Masked.20loads.20and.20stores.html#271052066">(Feb 07 2022 at 22:25)</a>:</h4>
<p>if that's even possible.</p>



<a name="271052181"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Masked%20loads%20and%20stores/near/271052181" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Masked.20loads.20and.20stores.html#271052181">(Feb 07 2022 at 22:26)</a>:</h4>
<p>we'd specifically want element align as an option, cuz risc-v/SimpleV/maybe-SVE all like that better than full-simd-align</p>



<a name="271052262"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Masked%20loads%20and%20stores/near/271052262" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Masked.20loads.20and.20stores.html#271052262">(Feb 07 2022 at 22:26)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281757">Jubilee</span> <a href="#narrow/stream/257879-project-portable-simd/topic/Masked.20loads.20and.20stores/near/271052066">said</a>:</p>
<blockquote>
<p>if that's even possible.</p>
</blockquote>
<p>No defaults on generic functions, right now.</p>



<a name="271052276"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Masked%20loads%20and%20stores/near/271052276" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Masked.20loads.20and.20stores.html#271052276">(Feb 07 2022 at 22:26)</a>:</h4>
<p>Aw okay.</p>



<a name="271052303"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Masked%20loads%20and%20stores/near/271052303" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Masked.20loads.20and.20stores.html#271052303">(Feb 07 2022 at 22:27)</a>:</h4>
<p>And on other architectures it generally hardly makes a difference, and it's way easier to program against</p>



<a name="271052330"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Masked%20loads%20and%20stores/near/271052330" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Masked.20loads.20and.20stores.html#271052330">(Feb 07 2022 at 22:27)</a>:</h4>
<p><span class="user-mention silent" data-user-id="229517">Jacob Lifshay</span> <a href="#narrow/stream/257879-project-portable-simd/topic/Masked.20loads.20and.20stores/near/271052181">said</a>:</p>
<blockquote>
<p>we'd specifically want element align as an option, cuz risc-v/SimpleV/maybe-SVE all like that better than full-simd-align</p>
</blockquote>
<p>Yeah, my thought is that element alignment would be the default.</p>



<a name="271052371"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Masked%20loads%20and%20stores/near/271052371" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Masked.20loads.20and.20stores.html#271052371">(Feb 07 2022 at 22:27)</a>:</h4>
<p>Note that LLVM is actually pretty good at flowing alignment.  If you do a <code>ptr::read_unaligned</code> from something that came from a reference, my recollection is that it'll actually use a higher one.</p>



<a name="271052534"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Masked%20loads%20and%20stores/near/271052534" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Masked.20loads.20and.20stores.html#271052534">(Feb 07 2022 at 22:28)</a>:</h4>
<p>Ah nice.</p>



<a name="271052697"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Masked%20loads%20and%20stores/near/271052697" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Masked.20loads.20and.20stores.html#271052697">(Feb 07 2022 at 22:30)</a>:</h4>
<p>( I actually suspect that using read with full alignment is better for AVX512 specifically. )</p>



<a name="271052762"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Masked%20loads%20and%20stores/near/271052762" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Masked.20loads.20and.20stores.html#271052762">(Feb 07 2022 at 22:30)</a>:</h4>
<p>because you avoid the cache tearing penalty... &lt;_&lt;</p>



<a name="271052877"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Masked%20loads%20and%20stores/near/271052877" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Masked.20loads.20and.20stores.html#271052877">(Feb 07 2022 at 22:31)</a>:</h4>
<p>"if your vector happens to be the size of one entire cache line, try to read it aligned."</p>



<a name="271052960"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Masked%20loads%20and%20stores/near/271052960" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Masked.20loads.20and.20stores.html#271052960">(Feb 07 2022 at 22:31)</a>:</h4>
<p>usually x86 does a dynamic address alignment check, so you only pay the penalty if it's unaligned at runtime, rather than paying the penalty if you use the unaligned instruction</p>



<a name="271053035"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Masked%20loads%20and%20stores/near/271053035" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Masked.20loads.20and.20stores.html#271053035">(Feb 07 2022 at 22:32)</a>:</h4>
<p>yeah.</p>



<a name="271053050"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Masked%20loads%20and%20stores/near/271053050" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Masked.20loads.20and.20stores.html#271053050">(Feb 07 2022 at 22:32)</a>:</h4>
<p>tho i could be wrong for avx512</p>



<a name="271053347"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Masked%20loads%20and%20stores/near/271053347" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Masked.20loads.20and.20stores.html#271053347">(Feb 07 2022 at 22:34)</a>:</h4>
<p>I believe you are completely correct. The cache tearing penalty is just another penalty.</p>



<a name="271053440"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Masked%20loads%20and%20stores/near/271053440" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Masked.20loads.20and.20stores.html#271053440">(Feb 07 2022 at 22:35)</a>:</h4>
<p>I think the element-aligned things might be handled sufficiently well with just <code>from_array</code>.</p>



<a name="271053476"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Masked%20loads%20and%20stores/near/271053476" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Masked.20loads.20and.20stores.html#271053476">(Feb 07 2022 at 22:35)</a>:</h4>
<p>Since you can always get a <code>*const [f32; 4]</code> and read that, for example.</p>



<a name="271053557"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Masked%20loads%20and%20stores/near/271053557" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Masked.20loads.20and.20stores.html#271053557">(Feb 07 2022 at 22:36)</a>:</h4>
<p>(And if you have slices it's even easier, since <code>as_chunks</code> will give you <code>&amp;[f32; 4]</code>s and such.)</p>



<a name="271053785"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Masked%20loads%20and%20stores/near/271053785" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Masked.20loads.20and.20stores.html#271053785">(Feb 07 2022 at 22:38)</a>:</h4>
<p>i don't think <code>from_array</code> does what we want here, we want llvm to use <code>llvm.masked.load.*</code></p>



<a name="271053872"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Masked%20loads%20and%20stores/near/271053872" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Masked.20loads.20and.20stores.html#271053872">(Feb 07 2022 at 22:39)</a>:</h4>
<p>or maybe i misunderstood what you meant</p>



<a name="271053879"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Masked%20loads%20and%20stores/near/271053879" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Masked.20loads.20and.20stores.html#271053879">(Feb 07 2022 at 22:39)</a>:</h4>
<p>Oh, my mistake -- I forgot to check the topic.</p>



<a name="272186522"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Masked%20loads%20and%20stores/near/272186522" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Masked.20loads.20and.20stores.html#272186522">(Feb 16 2022 at 22:12)</a>:</h4>
<p>I was briefly considering saying we could make the Rust-side intrinsic straight-up accept arrays but then I remembered that we can just expose an API that casts arrays to vectors so... lol?</p>



<a name="272187165"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Masked%20loads%20and%20stores/near/272187165" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Masked.20loads.20and.20stores.html#272187165">(Feb 16 2022 at 22:16)</a>:</h4>
<p>vectors may have more strict alignment, so masked load/store to <code>&amp;mut [T; N]</code> would still be useful</p>



<a name="272187356"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Masked%20loads%20and%20stores/near/272187356" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Masked.20loads.20and.20stores.html#272187356">(Feb 16 2022 at 22:18)</a>:</h4>
<p>Oh I mean as the input to store or the output of load.</p>



<a name="272187393"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Masked%20loads%20and%20stores/near/272187393" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Masked.20loads.20and.20stores.html#272187393">(Feb 16 2022 at 22:18)</a>:</h4>
<p>ah, yeah that should totally just be a vector</p>



<a name="272188073"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/Masked%20loads%20and%20stores/near/272188073" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/Masked.20loads.20and.20stores.html#272188073">(Feb 16 2022 at 22:25)</a>:</h4>
<p>though we will probably want a <code>Simd::&lt;MaybeUninit&lt;T&gt;, N&gt;::masked_store(self, dest: *mut [MaybeUninit&lt;T&gt;; N], mask: Mask&lt;i32, N&gt;)</code> for the extra flexibility</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>