<html>
<head><meta charset="utf-8"><title>mask8x64 not compiling? · project-portable-simd · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/index.html">project-portable-simd</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/mask8x64.20not.20compiling.3F.html">mask8x64 not compiling?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="262264089"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/mask8x64%20not%20compiling%3F/near/262264089" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jorge Leitao <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/mask8x64.20not.20compiling.3F.html#262264089">(Nov 21 2021 at 22:24)</a>:</h4>
<p>Hey. I am trying to port from packed_simd to std::simd and I am hitting the following:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#![feature(portable_simd)]</span><span class="w"></span>

<span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">simd</span>::<span class="n">mask8x64</span><span class="p">;</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">hello_world</span><span class="p">(</span><span class="n">chunk</span>: <span class="kt">u64</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">mask8x64</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="fm">todo!</span><span class="p">()</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>which is not compiling  (<a href="https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2021&amp;gist=c6ac94bcc09ede5df1374ac71f8c9229">https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2021&amp;gist=c6ac94bcc09ede5df1374ac71f8c9229</a>). Is this something to be expected?</p>



<a name="262264214"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/mask8x64%20not%20compiling%3F/near/262264214" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/mask8x64.20not.20compiling.3F.html#262264214">(Nov 21 2021 at 22:26)</a>:</h4>
<p>Oh dear.<br>
Yes, we didn't expand our support (and testing) to support 64 lanes again.</p>



<a name="262264221"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/mask8x64%20not%20compiling%3F/near/262264221" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/mask8x64.20not.20compiling.3F.html#262264221">(Nov 21 2021 at 22:26)</a>:</h4>
<p>But we apparently never culled the aliases.</p>



<a name="262264252"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/mask8x64%20not%20compiling%3F/near/262264252" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/mask8x64.20not.20compiling.3F.html#262264252">(Nov 21 2021 at 22:27)</a>:</h4>
<p>We should actually try 64 lanes again, too</p>



<a name="262264255"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/mask8x64%20not%20compiling%3F/near/262264255" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/mask8x64.20not.20compiling.3F.html#262264255">(Nov 21 2021 at 22:27)</a>:</h4>
<p>Yeah.</p>



<a name="262264526"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/mask8x64%20not%20compiling%3F/near/262264526" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jorge Leitao <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/mask8x64.20not.20compiling.3F.html#262264526">(Nov 21 2021 at 22:32)</a>:</h4>
<p>thanks for the quick reply. I did not understand it, though: is it a bug, should I create a feature request on github, it is by design at this point in time, or? xD</p>



<a name="262264551"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/mask8x64%20not%20compiling%3F/near/262264551" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/mask8x64.20not.20compiling.3F.html#262264551">(Nov 21 2021 at 22:33)</a>:</h4>
<p>Well, it's not a bug in the sense that we purposefully don't support 64 lane vectors right now. But we do want to support them</p>



<a name="262264594"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/mask8x64%20not%20compiling%3F/near/262264594" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/mask8x64.20not.20compiling.3F.html#262264594">(Nov 21 2021 at 22:34)</a>:</h4>
<p>iirc we encountered llvm bugs with 64 lanes, so we intentionally removed support for 64-lane vectors, we're planning on re-adding them later</p>



<a name="262264615"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/mask8x64%20not%20compiling%3F/near/262264615" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/mask8x64.20not.20compiling.3F.html#262264615">(Nov 21 2021 at 22:34)</a>:</h4>
<p>same thing with 128-bit elements</p>



<a name="262264730"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/mask8x64%20not%20compiling%3F/near/262264730" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/mask8x64.20not.20compiling.3F.html#262264730">(Nov 21 2021 at 22:37)</a>:</h4>
<p><a href="https://github.com/rust-lang/portable-simd/pull/197">https://github.com/rust-lang/portable-simd/pull/197</a> Let's see what the test suite says.</p>



<a name="262264780"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/mask8x64%20not%20compiling%3F/near/262264780" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/mask8x64.20not.20compiling.3F.html#262264780">(Nov 21 2021 at 22:38)</a>:</h4>
<p><span class="user-mention silent" data-user-id="399416">Jorge Leitao</span> <a href="#narrow/stream/257879-project-portable-simd/topic/mask8x64.20not.20compiling.3F/near/262264526">said</a>:</p>
<blockquote>
<p>thanks for the quick reply. I did not understand it, though: is it a bug, should I create a feature request on github, it is by design at this point in time, or? xD</p>
</blockquote>
<p>Basically, "SupportedLaneCount" literally is a bound on the type which blocks you from using it with a lane count which we can't compile.</p>



<a name="262264856"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/mask8x64%20not%20compiling%3F/near/262264856" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/mask8x64.20not.20compiling.3F.html#262264856">(Nov 21 2021 at 22:40)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="sd">/// A SIMD vector of `LANES` elements of type `T`.</span>
<span class="cp">#[repr(simd)]</span><span class="w"></span>
<span class="k">pub</span><span class="w"> </span><span class="k">struct</span> <span class="nc">Simd</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">LANES</span>: <span class="kt">usize</span><span class="o">&gt;</span><span class="p">([</span><span class="n">T</span><span class="p">;</span><span class="w"> </span><span class="n">LANES</span><span class="p">])</span><span class="w"></span>
<span class="k">where</span><span class="w"></span>
<span class="w">    </span><span class="n">T</span>: <span class="nc">SimdElement</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">LaneCount</span><span class="o">&lt;</span><span class="n">LANES</span><span class="o">&gt;</span>: <span class="nc">SupportedLaneCount</span><span class="p">;</span><span class="w"></span>
</code></pre></div>



<a name="262264883"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/mask8x64%20not%20compiling%3F/near/262264883" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/mask8x64.20not.20compiling.3F.html#262264883">(Nov 21 2021 at 22:41)</a>:</h4>
<p>LaneCount is a struct that does nothing and is never intended to be instantiated, except play host to that trait bound.<br>
If this seems like a weird hack, it's because it is.</p>



<a name="262265188"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/mask8x64%20not%20compiling%3F/near/262265188" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/mask8x64.20not.20compiling.3F.html#262265188">(Nov 21 2021 at 22:49)</a>:</h4>
<p>Was it Arm that broke on 64 lanes, or was that also PowerPC?</p>



<a name="262265197"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/mask8x64%20not%20compiling%3F/near/262265197" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/mask8x64.20not.20compiling.3F.html#262265197">(Nov 21 2021 at 22:49)</a>:</h4>
<p>icr, but powerpc broke on i128</p>



<a name="262265244"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/mask8x64%20not%20compiling%3F/near/262265244" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/mask8x64.20not.20compiling.3F.html#262265244">(Nov 21 2021 at 22:50)</a>:</h4>
<p>ppc64le</p>



<a name="262371446"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/mask8x64%20not%20compiling%3F/near/262371446" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/mask8x64.20not.20compiling.3F.html#262371446">(Nov 22 2021 at 20:11)</a>:</h4>
<p>Looks like all tests passing. And the issue was on aarch64.<br>
Can people here with recent Appletops try the test suite from that branch?</p>



<a name="262371461"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/mask8x64%20not%20compiling%3F/near/262371461" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/mask8x64.20not.20compiling.3F.html#262371461">(Nov 22 2021 at 20:11)</a>:</h4>
<p><span class="user-mention" data-user-id="209168">@Thom Chiovoloni</span> you have one right?</p>



<a name="262371511"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/mask8x64%20not%20compiling%3F/near/262371511" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/mask8x64.20not.20compiling.3F.html#262371511">(Nov 22 2021 at 20:11)</a>:</h4>
<p>yeah</p>



<a name="262371659"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/mask8x64%20not%20compiling%3F/near/262371659" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/mask8x64.20not.20compiling.3F.html#262371659">(Nov 22 2021 at 20:12)</a>:</h4>
<p>if you ping me in like, 5 hours, i can try on it, i'm not near that machine atm though</p>



<a name="262403201"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/mask8x64%20not%20compiling%3F/near/262403201" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/mask8x64.20not.20compiling.3F.html#262403201">(Nov 23 2021 at 01:47)</a>:</h4>
<p>cargo test from <a href="https://github.com/rust-lang/portable-simd/pull/197">https://github.com/rust-lang/portable-simd/pull/197</a> passes on my m1, if thats what the question was</p>



<a name="262403219"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/mask8x64%20not%20compiling%3F/near/262403219" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/mask8x64.20not.20compiling.3F.html#262403219">(Nov 23 2021 at 01:47)</a>:</h4>
<p>yep! Thank you!</p>



<a name="262476879"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/mask8x64%20not%20compiling%3F/near/262476879" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jorge Leitao <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/mask8x64.20not.20compiling.3F.html#262476879">(Nov 23 2021 at 16:11)</a>:</h4>
<p>out of curiosity, if I want to depend on that branch/PR through cargo, I should just point to the github? I.e. the nightly <code>std::simd</code> is just being compiled from the latest main from the github repo?</p>



<a name="262491971"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/mask8x64%20not%20compiling%3F/near/262491971" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/mask8x64.20not.20compiling.3F.html#262491971">(Nov 23 2021 at 18:02)</a>:</h4>
<p>iirc nightly <code>std::simd</code> is not just the latest portable-simd master, we have to submit a PR to rust that syncs the latest changes.</p>



<a name="262542915"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/mask8x64%20not%20compiling%3F/near/262542915" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/mask8x64.20not.20compiling.3F.html#262542915">(Nov 24 2021 at 03:30)</a>:</h4>
<p>Yes, if you want to use us through cargo instead of std, you can do that. We don't publish a crate to discourage that sort of thing a bit, as our implementation hasn't actually passed e.g. rust-lang/rust CI when it's on our main branch.</p>



<a name="262552566"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/mask8x64%20not%20compiling%3F/near/262552566" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jorge Leitao <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/mask8x64.20not.20compiling.3F.html#262552566">(Nov 24 2021 at 07:06)</a>:</h4>
<p>Sounds good. I think it is a good call about not publishing in cargo; this is mostly useful to be able to test a PR and give you some feedback.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>