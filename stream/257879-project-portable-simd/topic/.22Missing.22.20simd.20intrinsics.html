<html>
<head><meta charset="utf-8"><title>&quot;Missing&quot; simd intrinsics · project-portable-simd · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/index.html">project-portable-simd</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html">&quot;Missing&quot; simd intrinsics</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="234431544"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234431544" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234431544">(Apr 14 2021 at 02:23)</a>:</h4>
<p>It is very weird there's simd_fabs but no simd_abs.<br>
No conclusion from this, just saying.</p>



<a name="234432377"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234432377" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sparrow Li <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234432377">(Apr 14 2021 at 02:36)</a>:</h4>
<p>I think this is because the link of fabs is more general. For example, the abs of f32 needs to be linked to llvm.fabs.v2f32, but the abs of s32 on aarch64 needs to be linked to llvm.aarch64.neon.abs.v2i32.</p>



<a name="234432433"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234432433" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234432433">(Apr 14 2021 at 02:36)</a>:</h4>
<p>Interesting.</p>



<a name="234433054"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234433054" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234433054">(Apr 14 2021 at 02:46)</a>:</h4>
<p>I have not the foggiest idea for why this doesn't work. <a href="https://github.com/rust-lang/stdsimd/pull/95">https://github.com/rust-lang/stdsimd/pull/95</a></p>



<a name="234433770"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234433770" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234433770">(Apr 14 2021 at 02:57)</a>:</h4>
<p>I wonder if fabs is wrong, or not sufficient in some way</p>



<a name="234433777"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234433777" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234433777">(Apr 14 2021 at 02:57)</a>:</h4>
<p>And on your silicon it does something different</p>



<a name="234433845"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234433845" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234433845">(Apr 14 2021 at 02:58)</a>:</h4>
<p>Btw I noticed some bugs in your saturation code relating to abs, I started fixing them but can't finish until we get simd_abs</p>



<a name="234433850"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234433850" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234433850">(Apr 14 2021 at 02:58)</a>:</h4>
<p>whoops.</p>



<a name="234433855"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234433855" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234433855">(Apr 14 2021 at 02:58)</a>:</h4>
<p>I was going to PR it once I get around to it...</p>



<a name="234433860"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234433860" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234433860">(Apr 14 2021 at 02:59)</a>:</h4>
<p>what were the bugs?</p>



<a name="234433886"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234433886" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234433886">(Apr 14 2021 at 02:59)</a>:</h4>
<p>If you look at the saturation docs you messed up the formatting slightly</p>



<a name="234433896"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234433896" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234433896">(Apr 14 2021 at 02:59)</a>:</h4>
<p>And then it turns out those tests don't actually run</p>



<a name="234433903"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234433903" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234433903">(Apr 14 2021 at 03:00)</a>:</h4>
<p>oh wow.</p>



<a name="234433955"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234433955" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234433955">(Apr 14 2021 at 03:00)</a>:</h4>
<p>And then it turns out we don't have abs for integers lol</p>



<a name="234433971"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234433971" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234433971">(Apr 14 2021 at 03:00)</a>:</h4>
<p>yeah, I knew that part.</p>



<a name="234434039"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234434039" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234434039">(Apr 14 2021 at 03:00)</a>:</h4>
<p>I suppose we could implement it as a scalar op right now just until we get simd_abs</p>



<a name="234434072"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234434072" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234434072">(Apr 14 2021 at 03:01)</a>:</h4>
<p>I knew we ran the tests.</p>



<a name="234434079"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234434079" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234434079">(Apr 14 2021 at 03:01)</a>:</h4>
<p>Or well, I know I ran the tests locally.</p>



<a name="234434283"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234434283" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234434283">(Apr 14 2021 at 03:04)</a>:</h4>
<p>Ahh I see, I did mess up the syntax.</p>



<a name="234434300"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234434300" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234434300">(Apr 14 2021 at 03:04)</a>:</h4>
<p>Yeah it looks like a copy paste error</p>



<a name="234434308"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234434308" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234434308">(Apr 14 2021 at 03:04)</a>:</h4>
<p>Something like that</p>



<a name="234435377"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234435377" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234435377">(Apr 14 2021 at 03:21)</a>:</h4>
<p><span class="user-mention" data-user-id="312331">@Caleb Zulawski</span> I pulled out fix-sat-math as a branch including your commit and layered another commit on it if you want to take over that / cherry-pick / whatever.</p>



<a name="234435493"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234435493" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234435493">(Apr 14 2021 at 03:23)</a>:</h4>
<p>Includes the amazing butcher-work of "vecter? never heard of her"</p>



<a name="234438547"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234438547" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234438547">(Apr 14 2021 at 04:11)</a>:</h4>
<p>there's no "abs" intrinsic in the compiler, apparently.</p>



<a name="234438643"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234438643" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234438643">(Apr 14 2021 at 04:13)</a>:</h4>
<p>...guess the compiler doesn't like to do crunhes <span aria-label="sunglasses" class="emoji emoji-1f60e" role="img" title="sunglasses">:sunglasses:</span></p>



<a name="234438795"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234438795" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234438795">(Apr 14 2021 at 04:15)</a>:</h4>
<p>pffft.</p>



<a name="234438875"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234438875" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234438875">(Apr 14 2021 at 04:17)</a>:</h4>
<p>there's no inherent abs in x86, apparently???<br>
wait, there IS a SIMD absolute value</p>



<a name="234438891"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234438891" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234438891">(Apr 14 2021 at 04:17)</a>:</h4>
<p>for 8~32 bit integers.</p>



<a name="234439784"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234439784" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234439784">(Apr 14 2021 at 04:33)</a>:</h4>
<p><em>nudges rustc with toe</em><br>
bootstrap!!</p>



<a name="234441466"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234441466" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234441466">(Apr 14 2021 at 05:01)</a>:</h4>
<p>float abs is defined to be a bitwise operation on the sign bit, leaving all other bits unchanged. so some arches dont even provide it. ones that do i guess it's good to use to reduce pressure on integer ports though</p>



<a name="234441474"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234441474" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234441474">(Apr 14 2021 at 05:01)</a>:</h4>
<p>oh, i misread</p>



<a name="234451343"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234451343" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234451343">(Apr 14 2021 at 07:07)</a>:</h4>
<p>spent some time hacking on the compiler. trying to figure out how the LLVM API works. then I will be able to add intrinsics in so we can wrap up <a href="https://github.com/rust-lang/rust/issues/46">#46</a>. there is support in the compiler for some things already but not others.</p>



<a name="234537910"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234537910" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234537910">(Apr 14 2021 at 17:12)</a>:</h4>
<p>We don't need <code>simd_trunc</code> for fp -&gt; int conversion. <code>simd_cast</code> already does it.</p>



<a name="234538291"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234538291" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234538291">(Apr 14 2021 at 17:15)</a>:</h4>
<p>Oh cool</p>



<a name="234538366"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234538366" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234538366">(Apr 14 2021 at 17:15)</a>:</h4>
<p>Wouldn't <code>simd_cast</code> round instead of truncate?</p>



<a name="234538425"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234538425" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234538425">(Apr 14 2021 at 17:16)</a>:</h4>
<p>It "rounds" towards 0.</p>



<a name="234538523"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234538523" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234538523">(Apr 14 2021 at 17:16)</a>:</h4>
<p>which is the desired effect: float truncation to a plausibly signed integer value.</p>



<a name="234538839"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234538839" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234538839">(Apr 14 2021 at 17:19)</a>:</h4>
<p>nice</p>



<a name="234538843"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234538843" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234538843">(Apr 14 2021 at 17:19)</a>:</h4>
<p>Yeah, I think we determined that the way to round to int is to just do fround first</p>



<a name="234540280"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234540280" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234540280">(Apr 14 2021 at 17:27)</a>:</h4>
<div class="codehilite" data-code-language="GAS"><pre><span></span><code><span class="nl">example:</span><span class="err">:</span><span class="nl">f32x4:</span><span class="err">:</span><span class="nl">trunc:</span>
        <span class="nf">movq</span>    <span class="nv">%rdi</span><span class="p">,</span> <span class="nv">%rax</span>
        <span class="nf">cvttps2dq</span>       <span class="p">(</span><span class="nv">%rsi</span><span class="p">),</span> <span class="nv">%xmm0</span>
        <span class="nf">movaps</span>  <span class="nv">%xmm0</span><span class="p">,</span> <span class="p">(</span><span class="nv">%rdi</span><span class="p">)</span>
        <span class="nf">retq</span>
</code></pre></div>
<p>specifically this is what is called on x64 when you do</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">trunc</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">i32x4</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">unsafe</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">simd_cast</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="234540512"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234540512" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234540512">(Apr 14 2021 at 17:28)</a>:</h4>
<p>Okay so that looks like it's unsafe?</p>



<a name="234540530"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234540530" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234540530">(Apr 14 2021 at 17:28)</a>:</h4>
<p>oh <em>wildly</em></p>



<a name="234540561"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234540561" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234540561">(Apr 14 2021 at 17:29)</a>:</h4>
<p>The checks are fairly simple but we do need to check</p>



<a name="234588597"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234588597" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234588597">(Apr 14 2021 at 22:48)</a>:</h4>
<p>We still kiiinda need most of math.h, so I opened <a href="https://github.com/rust-lang/rust/pull/84205">https://github.com/rust-lang/rust/pull/84205</a></p>



<a name="234588809"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234588809" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234588809">(Apr 14 2021 at 22:51)</a>:</h4>
<p>Did you consider adding simd_abs to that?  Or is there a reason not too</p>



<a name="234588841"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234588841" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234588841">(Apr 14 2021 at 22:51)</a>:</h4>
<p>It requires me to touch different segments of code, and isn't a floating-point intrinsic, so I decided to make it a separate PR.</p>



<a name="234588905"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234588905" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234588905">(Apr 14 2021 at 22:52)</a>:</h4>
<p>Works for me</p>



<a name="234588946"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234588946" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234588946">(Apr 14 2021 at 22:52)</a>:</h4>
<p>Is simd_trunc different from simd_cast?</p>



<a name="234589038"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234589038" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234589038">(Apr 14 2021 at 22:54)</a>:</h4>
<p>casting to int is not <em>as</em> useful as truncating the float directly but keeping it as a float if you can do that.</p>



<a name="234589346"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234589346" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234589346">(Apr 14 2021 at 22:56)</a>:</h4>
<p>Oh so the output is float, not int. Cool.</p>



<a name="234590533"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234590533" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234590533">(Apr 14 2021 at 23:07)</a>:</h4>
<p><span class="user-mention" data-user-id="312331">@Caleb Zulawski</span> Also besides, the same ops work for SIMD abs. :P ( I pushed that up to <code>fix-sat-math</code> actually, after doublechecking. )</p>



<a name="234590828"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234590828" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234590828">(Apr 14 2021 at 23:10)</a>:</h4>
<p>produce a sign-mask (-1 or 0)<br>
xor value by sign-mask<br>
subtract sign-mask</p>



<a name="234590950"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234590950" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234590950">(Apr 14 2021 at 23:11)</a>:</h4>
<p>Mind, these do exist, so I wanna poke around more, but last night I got lost poking around the SIMD backend and realizing that there are multiple different ways intrinsics are built and fed to LLVM, giving me a headache. <a href="https://www.felixcloutier.com/x86/pabsb:pabsw:pabsd:pabsq">https://www.felixcloutier.com/x86/pabsb:pabsw:pabsd:pabsq</a></p>



<a name="234592398"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234592398" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234592398">(Apr 14 2021 at 23:27)</a>:</h4>
<p>Yeah, the abs instructions are theoretically a little better but negligibly so</p>



<a name="234592738"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234592738" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234592738">(Apr 14 2021 at 23:31)</a>:</h4>
<p>I think is only relevant on x86 because x86 doesn't have a dedicated zero register</p>



<a name="234593934"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234593934" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234593934">(Apr 14 2021 at 23:43)</a>:</h4>
<p>Hm? why would a zero register matter for Neon abs?</p>



<a name="234596592"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234596592" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234596592">(Apr 15 2021 at 00:11)</a>:</h4>
<p>On neon abs would be <code>sub r0 r1 r1</code> but on x86 it would be</p>
<div class="codehilite"><pre><span></span><code>xor r0 r0 r0
sub r0 r1 r1
</code></pre></div>



<a name="234596633"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234596633" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234596633">(Apr 15 2021 at 00:11)</a>:</h4>
<p>As opposed to just <code>pabs r1 r1</code> or whatever</p>



<a name="234596729"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234596729" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234596729">(Apr 15 2021 at 00:12)</a>:</h4>
<p>...but that returns negative if r1 is positive, <span class="user-mention" data-user-id="312331">@Caleb Zulawski</span></p>



<a name="234596751"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234596751" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234596751">(Apr 15 2021 at 00:13)</a>:</h4>
<p>Oh wait I was thinking just negative lol</p>



<a name="234596859"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234596859" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234596859">(Apr 15 2021 at 00:15)</a>:</h4>
<p>&lt;_&lt;;<br>
Neon has a saturating abs intrinsic, amusingly.</p>



<a name="234740039"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234740039" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234740039">(Apr 15 2021 at 19:41)</a>:</h4>
<p>So my current plan is basically to continue adding most of <a href="https://llvm.org/docs/LangRef.html#standard-c-c-library-intrinsics">https://llvm.org/docs/LangRef.html#standard-c-c-library-intrinsics</a>, <span class="user-mention" data-user-id="133247">@bjorn3</span>, to Rust's platform intrinsics, until I'm satisfied. If you have any opinions or requests, I'm listening.</p>



<a name="234740548"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234740548" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234740548">(Apr 15 2021 at 19:44)</a>:</h4>
<p>Please only add the intrinsics you actually need.</p>



<a name="234740595"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234740595" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234740595">(Apr 15 2021 at 19:44)</a>:</h4>
<p>By the way you can find the full list of instructions supported by Cranelift at <a href="https://docs.rs/cranelift-codegen/0.73.0/cranelift_codegen/ir/trait.InstBuilder.html">https://docs.rs/cranelift-codegen/0.73.0/cranelift_codegen/ir/trait.InstBuilder.html</a></p>



<a name="234740649"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234740649" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234740649">(Apr 15 2021 at 19:45)</a>:</h4>
<p>Of course. That just will probably still be a Lot of them.</p>



<a name="234740720"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234740720" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234740720">(Apr 15 2021 at 19:45)</a>:</h4>
<p>What kind of operations are necessary?</p>



<a name="234740766"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234740766" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234740766">(Apr 15 2021 at 19:46)</a>:</h4>
<p>I think we are actually already in pretty good shape and not missing all that many</p>



<a name="234740866"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234740866" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234740866">(Apr 15 2021 at 19:46)</a>:</h4>
<p>We probably still need almost all of the checked arithmetic, though</p>



<a name="234741150"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234741150" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234741150">(Apr 15 2021 at 19:48)</a>:</h4>
<p>Does LLVM even support checked arith in the IR?</p>



<a name="234741229"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234741229" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234741229">(Apr 15 2021 at 19:48)</a>:</h4>
<blockquote>
<p>Arithmetic with Overflow Intrinsics</p>
</blockquote>
<p>Ah yeah.</p>



<a name="234741248"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234741248" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234741248">(Apr 15 2021 at 19:49)</a>:</h4>
<p>Yup those.</p>



<a name="234741619"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234741619" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234741619">(Apr 15 2021 at 19:51)</a>:</h4>
<p>I think we're fine with not adding those for now actually because while we want them, they're not in <code>packed_simd</code>, and I think I want to focus on getting on nightly first for things that aren't about establishing feature parity with <code>packed_simd</code>.</p>



<a name="234741770"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234741770" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234741770">(Apr 15 2021 at 19:52)</a>:</h4>
<p>Yeah that's fair.  Those are the only ones I can think of where there are a lot missing, though</p>



<a name="234742715"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234742715" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234742715">(Apr 15 2021 at 19:59)</a>:</h4>
<p><span class="user-mention silent" data-user-id="133247">bjorn3</span> <a href="#narrow/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics/near/234740720">said</a>:</p>
<blockquote>
<p>What kind of operations are necessary?</p>
</blockquote>
<p>Caleb would like <code>abs</code> for SimdInts. I am not sure how high priority that is because there <em>are</em> easy implementations for it. There are also vector instructions for it, tho'. <em>I</em> want LLVM's <code>shl.sat</code>. Specifically, I want <code>mul.sat</code>, actually. I can write a saturating multiply but it is absolutely wretched.</p>



<a name="234745651"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234745651" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234745651">(Apr 15 2021 at 20:18)</a>:</h4>
<p>that or checked multiplication (deriving a mask, ideally) which allows saturation using the mask. Not sure how much either exist in hardware.</p>



<a name="234754876"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234754876" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234754876">(Apr 15 2021 at 21:12)</a>:</h4>
<p>llvm has the fixed-point saturating multiply intrinsics, and fixed-point with 0 fractional bits is the same as integers.</p>



<a name="234755988"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234755988" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234755988">(Apr 15 2021 at 21:18)</a>:</h4>
<p>As I mentioned, I feel very dubious about that because from what I saw LLVM devs were not entirely confident it exactly matched either.</p>



<a name="234756382"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234756382" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234756382">(Apr 15 2021 at 21:21)</a>:</h4>
<p><a href="https://llvm.godbolt.org/z/9YGPfxPs6">https://llvm.godbolt.org/z/9YGPfxPs6</a></p>
<p>have fun!</p>



<a name="234756581"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234756581" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234756581">(Apr 15 2021 at 21:22)</a>:</h4>
<p>I think that's definitely something that we test with fuzzing, since there's no reason it shouldn't match</p>



<a name="234757527"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234757527" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234757527">(Apr 15 2021 at 21:29)</a>:</h4>
<p>Seems Sus.</p>



<a name="234757730"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234757730" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234757730">(Apr 15 2021 at 21:31)</a>:</h4>
<p>one issue: that fixed point intrinsic is not supported on wasm for llvm 12: <a href="https://llvm.godbolt.org/z/cf6hehhGq">https://llvm.godbolt.org/z/cf6hehhGq</a></p>



<a name="234758907"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234758907" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234758907">(Apr 15 2021 at 21:41)</a>:</h4>
<p>Sounds like a dealbreaker. <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="234795842"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234795842" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234795842">(Apr 16 2021 at 05:14)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/pull/84205">https://github.com/rust-lang/rust/pull/84205</a> got merged~</p>



<a name="234923095"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/234923095" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#234923095">(Apr 16 2021 at 21:15)</a>:</h4>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code><span class="o">[</span>feat/round 852d95c<span class="o">]</span> Add SIMD rounding intrinsics
 <span class="m">2</span> files changed, <span class="m">48</span> insertions<span class="o">(</span>+<span class="o">)</span>, <span class="m">12</span> deletions<span class="o">(</span>-<span class="o">)</span>
</code></pre></div>



<a name="236099613"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/%22Missing%22%20simd%20intrinsics/near/236099613" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/.22Missing.22.20simd.20intrinsics.html#236099613">(Apr 25 2021 at 22:47)</a>:</h4>
<p><a href="https://github.com/rust-lang/stdsimd/pull/107/checks">https://github.com/rust-lang/stdsimd/pull/107/checks</a> <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>