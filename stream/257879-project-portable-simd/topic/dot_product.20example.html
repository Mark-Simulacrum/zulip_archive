<html>
<head><meta charset="utf-8"><title>dot_product example · project-portable-simd · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/index.html">project-portable-simd</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html">dot_product example</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="276743415"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/276743415" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#276743415">(Mar 26 2022 at 20:09)</a>:</h4>
<p>Alright - I'm back on the saddle and trying to flesh together <a href="https://github.com/rust-lang/portable-simd/pull/128">this code</a>.</p>
<p>After a rebase, I don't know how I can get around this error:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code><span class="o">[</span>I<span class="o">]</span> mrg@JuliaLap ~/p/r/s/c/core_simd <span class="o">(</span>dotprodexample<span class="o">)</span> <span class="o">[</span><span class="m">101</span><span class="o">]</span>&gt; cargo <span class="nb">test</span>
   Compiling core_simd v0.1.0 <span class="o">(</span>/home/mrg/projects/rust/stdsimd/crates/core_simd<span class="o">)</span>
error: unrecognized platform-specific intrinsic <span class="k">function</span>: <span class="sb">`</span>simd_as<span class="sb">`</span>
  --&gt; crates/core_simd/src/intrinsics.rs:72:5
   <span class="p">|</span>
<span class="m">72</span> <span class="p">|</span>     pub<span class="o">(</span>crate<span class="o">)</span> fn simd_as&lt;T, U&gt;<span class="o">(</span>x: T<span class="o">)</span> -&gt; U<span class="p">;</span>
   <span class="p">|</span>     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

error: could not compile <span class="sb">`</span>core_simd<span class="sb">`</span> due to previous error
</code></pre></div>
<p>I'm on <code>cargo version 1.58.0-nightly</code> and just rebased to <code>main</code> branch.</p>



<a name="276743488"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/276743488" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#276743488">(Mar 26 2022 at 20:10)</a>:</h4>
<p><code>rustup update nightly</code></p>



<a name="276743516"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/276743516" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#276743516">(Mar 26 2022 at 20:11)</a>:</h4>
<p><code>rustup update nightly --force</code> because the other choked on some <code>rls</code> stuff.</p>



<a name="276743569"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/276743569" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#276743569">(Mar 26 2022 at 20:12)</a>:</h4>
<p>Ah, you should probably remove rls as a component.</p>



<a name="276743581"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/276743581" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#276743581">(Mar 26 2022 at 20:12)</a>:</h4>
<p>Oh, will do.</p>



<a name="276744220"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/276744220" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#276744220">(Mar 26 2022 at 20:29)</a>:</h4>
<p>Alright, I think we're in business.</p>



<a name="276747983"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/276747983" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#276747983">(Mar 26 2022 at 21:56)</a>:</h4>
<p>What's the easiest way to make a vector of 1024 random ints/floats?</p>



<a name="276748273"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/276748273" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#276748273">(Mar 26 2022 at 22:02)</a>:</h4>
<p>Ah, <code>let x = [2.0; 1000];</code> gets me what I want.</p>



<a name="276748311"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/276748311" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#276748311">(Mar 26 2022 at 22:02)</a>:</h4>
<p><code>rand::random::&lt;[[f32; 32]; 32]&gt;().into_iter().flatten().collect()</code>, maybe?</p>



<a name="276748321"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/276748321" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#276748321">(Mar 26 2022 at 22:02)</a>:</h4>
<p>(<a href="https://docs.rs/rand/latest/rand/fn.random.html#provided-implementations">https://docs.rs/rand/latest/rand/fn.random.html#provided-implementations</a> suggests it's not const-generic yet, thus the dance to stay at 32.)</p>



<a name="276748393"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/276748393" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#276748393">(Mar 26 2022 at 22:04)</a>:</h4>
<p>oh, wait, <code>std::iter::repeat_with(rand::random).take(1024).collect()</code> is way easier.</p>



<a name="276748588"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/276748588" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#276748588">(Mar 26 2022 at 22:08)</a>:</h4>
<p><span class="user-mention" data-user-id="125270">@scottmcm</span> Thanks, I think the <code>[2.0; 1000].to_vec()</code> approach will do for now because it means inspecting the tests is easy.</p>



<a name="276748619"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/276748619" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#276748619">(Mar 26 2022 at 22:10)</a>:</h4>
<p><strong>ack</strong> I see we don't have fma tests <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="276748732"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/276748732" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#276748732">(Mar 26 2022 at 22:12)</a>:</h4>
<p>Does anyone have an example of the API?</p>



<a name="276748921"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/276748921" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#276748921">(Mar 26 2022 at 22:17)</a>:</h4>
<p>Ah, if you don't need random then <code>vec![2.0; 1000]</code> works.</p>



<a name="276749439"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/276749439" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#276749439">(Mar 26 2022 at 22:31)</a>:</h4>
<p>oooh, neat, I hd forgotten that one.</p>



<a name="276749782"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/276749782" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#276749782">(Mar 26 2022 at 22:39)</a>:</h4>
<p><span class="user-mention silent" data-user-id="246783">Miguel Raz Guzmán Macedo</span> <a href="#narrow/stream/257879-project-portable-simd/topic/dot_product.20example/near/276748619">said</a>:</p>
<blockquote>
<p><strong>ack</strong> I see we don't have fma tests <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>
</blockquote>
<p>are you looking for mul_add?</p>



<a name="276749935"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/276749935" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#276749935">(Mar 26 2022 at 22:42)</a>:</h4>
<p>Think so. Afk for a bit.</p>



<a name="276752045"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/276752045" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#276752045">(Mar 26 2022 at 23:30)</a>:</h4>
<p><span class="user-mention" data-user-id="281757">@Jubilee</span> Ah, I'm not getting how to use it here:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="c1">// A lot of knowledgeable use of SIMD comes from knowing specific instructions that are</span>
<span class="c1">// available - let's try to use the `mul_add` instruction, which is the fused-multiply-add we were looking for.</span>
<span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">dot_prod_simd_2</span><span class="p">(</span><span class="n">a</span>: <span class="kp">&amp;</span><span class="p">[</span><span class="kt">f32</span><span class="p">],</span><span class="w"> </span><span class="n">b</span>: <span class="kp">&amp;</span><span class="p">[</span><span class="kt">f32</span><span class="p">])</span><span class="w"> </span>-&gt; <span class="kt">f32</span> <span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">len</span><span class="p">(),</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">len</span><span class="p">());</span><span class="w"></span>
<span class="w">    </span><span class="c1">// TODO handle remainder when a.len() % 4 != 0</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f32x4</span>::<span class="n">splat</span><span class="p">(</span><span class="mf">0.0</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">a</span><span class="p">.</span><span class="n">array_chunks</span>::<span class="o">&lt;</span><span class="mi">4</span><span class="o">&gt;</span><span class="p">()</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="o">|&amp;</span><span class="n">a</span><span class="o">|</span><span class="w"> </span><span class="n">f32x4</span>::<span class="n">from_array</span><span class="p">(</span><span class="n">a</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">zip</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">array_chunks</span>::<span class="o">&lt;</span><span class="mi">4</span><span class="o">&gt;</span><span class="p">().</span><span class="n">map</span><span class="p">(</span><span class="o">|&amp;</span><span class="n">b</span><span class="o">|</span><span class="w"> </span><span class="n">f32x4</span>::<span class="n">from_array</span><span class="p">(</span><span class="n">b</span><span class="p">)))</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="o">|</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span><span class="o">|</span><span class="w"> </span><span class="n">mul_add</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">));</span><span class="w"></span>
<span class="w">        </span><span class="n">res</span><span class="p">.</span><span class="n">reduce_sum</span><span class="p">()</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="276752178"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/276752178" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#276752178">(Mar 26 2022 at 23:34)</a>:</h4>
<p><span class="user-mention silent" data-user-id="246783">Miguel Raz Guzmán Macedo</span> <a href="#narrow/stream/257879-project-portable-simd/topic/dot_product.20example/near/276752045">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="281757">Jubilee</span> Ah, I'm not getting how to use it here:</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">dot_prod_simd_2</span><span class="p">(</span><span class="n">a</span>: <span class="kp">&amp;</span><span class="p">[</span><span class="kt">f32</span><span class="p">],</span><span class="w"> </span><span class="n">b</span>: <span class="kp">&amp;</span><span class="p">[</span><span class="kt">f32</span><span class="p">])</span><span class="w"> </span>-&gt; <span class="kt">f32</span> <span class="p">{</span><span class="w"></span>
<span class="o">..</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="o">|</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span><span class="o">|</span><span class="w"> </span><span class="n">mul_add</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">));</span><span class="w"></span>
<span class="o">..</span><span class="w"></span>
</code></pre></div><br>
</p>
</blockquote>
<p>It's an function implemented via the StdFloat trait on vectors of floats, so you won't find it as an free function in the global namespace.</p>



<a name="276752236"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/276752236" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#276752236">(Mar 26 2022 at 23:34)</a>:</h4>
<p>thus it looks like</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">simd</span>::<span class="n">StdFloat</span><span class="p">;</span><span class="w"></span>
<span class="n">res</span><span class="p">.</span><span class="n">mul_add</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"></span>
</code></pre></div>



<a name="276752378"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/276752378" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#276752378">(Mar 26 2022 at 23:38)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281757">Jubilee</span> <a href="#narrow/stream/257879-project-portable-simd/topic/dot_product.20example/near/276752236">said</a>:</p>
<blockquote>
<p>thus it looks like</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">simd</span>::<span class="n">StdFloat</span><span class="p">;</span><span class="w"></span>
<span class="n">res</span><span class="p">.</span><span class="n">mul_add</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"></span>
</code></pre></div><br>
</p>
</blockquote>
<p>Hmm, I get an error here for <code>unresolved import</code>.</p>



<a name="276753430"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/276753430" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#276753430">(Mar 27 2022 at 00:01)</a>:</h4>
<p>mmmm, you probably need a different path?</p>



<a name="276753431"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/276753431" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#276753431">(Mar 27 2022 at 00:01)</a>:</h4>
<p>show the full error?</p>



<a name="276753554"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/276753554" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#276753554">(Mar 27 2022 at 00:04)</a>:</h4>
<p>Worked for me with that path: <a href="https://rust.godbolt.org/z/GKoxTKjGW">https://rust.godbolt.org/z/GKoxTKjGW</a></p>



<a name="276753657"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/276753657" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#276753657">(Mar 27 2022 at 00:07)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">[</span><span class="n">I</span><span class="p">]</span><span class="w"> </span><span class="n">mrg</span><span class="o">@</span><span class="n">JuliaLap</span><span class="w"> </span><span class="o">~/</span><span class="n">p</span><span class="o">/</span><span class="n">r</span><span class="o">/</span><span class="n">s</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">core_simd</span><span class="w"> </span><span class="p">(</span><span class="n">dotprodexample</span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="mi">101</span><span class="p">]</span><span class="o">&gt;</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">test</span><span class="w"></span>
<span class="w">   </span><span class="n">Compiling</span><span class="w"> </span><span class="n">core_simd</span><span class="w"> </span><span class="n">v0</span><span class="p">.</span><span class="mf">1.0</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">mrg</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">stdsimd</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">core_simd</span><span class="p">)</span><span class="w"></span>
<span class="n">error</span><span class="p">[</span><span class="n">E0599</span><span class="p">]</span>: <span class="nc">no</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="n">named</span><span class="w"> </span><span class="err">`</span><span class="n">mul_add</span><span class="err">`</span><span class="w"> </span><span class="n">found</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="k">struct</span> <span class="err">`</span><span class="n">core_simd</span>::<span class="n">Simd</span><span class="err">`</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">current</span><span class="w"> </span><span class="n">scope</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span>-&gt; <span class="nc">crates</span><span class="o">/</span><span class="n">core_simd</span><span class="o">/</span><span class="n">examples</span><span class="o">/</span><span class="n">dot_product</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">84</span>:<span class="mi">26</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="mi">84</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="o">|</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span><span class="o">|</span><span class="w"> </span><span class="n">res</span><span class="p">.</span><span class="n">mul_add</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">));</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w">                          </span><span class="o">^^^^^^^</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">found</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="err">`</span><span class="n">core_simd</span>::<span class="n">Simd</span><span class="o">&lt;</span><span class="kt">f32</span><span class="p">,</span><span class="w"> </span><span class="mi">4_</span><span class="k">usize</span><span class="o">&gt;</span><span class="err">`</span><span class="w"></span>

<span class="n">warning</span>: <span class="nc">unused</span><span class="w"> </span><span class="n">import</span>: <span class="err">`</span><span class="n">std</span>::<span class="n">simd</span>::<span class="n">StdFloat</span><span class="err">`</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span>-&gt; <span class="nc">crates</span><span class="o">/</span><span class="n">core_simd</span><span class="o">/</span><span class="n">examples</span><span class="o">/</span><span class="n">dot_product</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">76</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="mi">76</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">simd</span>::<span class="n">StdFloat</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w">     </span><span class="o">^^^^^^^^^^^^^^^^^^^</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="err">`</span><span class="cp">#[warn(unused_imports)]</span><span class="err">`</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">default</span><span class="w"></span>

<span class="n">For</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">information</span><span class="w"> </span><span class="n">about</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">error</span><span class="p">,</span><span class="w"> </span><span class="kr">try</span><span class="w"> </span><span class="err">`</span><span class="n">rustc</span><span class="w"> </span><span class="o">--</span><span class="n">explain</span><span class="w"> </span><span class="n">E0599</span><span class="err">`</span><span class="p">.</span><span class="w"></span>
<span class="n">warning</span>: <span class="err">`</span><span class="n">core_simd</span><span class="err">`</span><span class="w"> </span><span class="p">(</span><span class="n">example</span><span class="w"> </span><span class="s">"dot_product"</span><span class="p">)</span><span class="w"> </span><span class="n">generated</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">warning</span><span class="w"></span>
<span class="n">error</span>: <span class="nc">could</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">compile</span><span class="w"> </span><span class="err">`</span><span class="n">core_simd</span><span class="err">`</span><span class="w"> </span><span class="n">due</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">previous</span><span class="w"> </span><span class="n">error</span><span class="p">;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">warning</span><span class="w"> </span><span class="n">emitted</span><span class="w"></span>
</code></pre></div>



<a name="276754158"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/276754158" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#276754158">(Mar 27 2022 at 00:20)</a>:</h4>
<p>huh</p>



<a name="276754166"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/276754166" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#276754166">(Mar 27 2022 at 00:21)</a>:</h4>
<p>…whelp.</p>



<a name="276754173"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/276754173" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#276754173">(Mar 27 2022 at 00:21)</a>:</h4>
<p>oh<br>
use std_float::stdFloat;</p>



<a name="276926745"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/276926745" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#276926745">(Mar 28 2022 at 20:25)</a>:</h4>
<p>Sweet! The arg order punk'd me for a bit but it's cool now <span aria-label="gym" class="emoji emoji-1f3cb" role="img" title="gym">:gym:</span></p>



<a name="277035878"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277035878" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277035878">(Mar 29 2022 at 17:02)</a>:</h4>
<p>Alright, I think this isn’t too bad - I just need a way to run the different dot_products with benchmarks. What’s the recommended way for that?</p>



<a name="277037604"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277037604" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277037604">(Mar 29 2022 at 17:15)</a>:</h4>
<p><a href="https://bheisler.github.io/criterion.rs/book/">https://bheisler.github.io/criterion.rs/book/</a> is the usual recommendation for making trustworthy benchmarks.</p>



<a name="277039058"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277039058" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277039058">(Mar 29 2022 at 17:25)</a>:</h4>
<p>Sweet. I’ll look into that. Is that a dependency that can be added only to the <code>examples</code> crate?</p>



<a name="277039859"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277039859" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277039859">(Mar 29 2022 at 17:31)</a>:</h4>
<p>yeah it's a dev-dependency</p>



<a name="277045501"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277045501" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277045501">(Mar 29 2022 at 18:15)</a>:</h4>
<p>See the example at <a href="https://bheisler.github.io/criterion.rs/book/user_guide/html_report/Fibonacci2/report/index.html">https://bheisler.github.io/criterion.rs/book/user_guide/html_report/Fibonacci2/report/index.html</a> for why it's so much better than things like the built-in <code>#[bench]</code>.  The violin comparison plots, the regression line to confirm linearity, ... -- it's so important for making a convincing case and ensuring that the benchmark is actually working.</p>



<a name="277052906"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277052906" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277052906">(Mar 29 2022 at 19:18)</a>:</h4>
<p>Cool cool. I’ll see if I can include output asm to confirm the data movement suspicions and build the proper narrative development.</p>



<a name="277071521"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277071521" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277071521">(Mar 29 2022 at 22:15)</a>:</h4>
<p>OK I think benchmarking will be done later in a second PR - it seems sensible to have examples first and then setup the proper infra for benches and such in a second PR</p>



<a name="277072456"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277072456" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277072456">(Mar 29 2022 at 22:23)</a>:</h4>
<p><span class="user-mention" data-user-id="281757">@Jubilee</span> <span aria-label="balloon" class="emoji emoji-1f388" role="img" title="balloon">:balloon:</span> : PR's up!</p>



<a name="277072550"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277072550" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277072550">(Mar 29 2022 at 22:24)</a>:</h4>
<p>aha! brain thaw.</p>



<a name="277072614"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277072614" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277072614">(Mar 29 2022 at 22:25)</a>:</h4>
<p><span class="user-mention" data-user-id="246783">@Miguel Raz Guzmán Macedo</span> it's pestering you to rustfmt</p>



<a name="277072760"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277072760" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277072760">(Mar 29 2022 at 22:27)</a>:</h4>
<p><code>rustfmt</code> gods appeased <span aria-label="smiling devil" class="emoji emoji-1f608" role="img" title="smiling devil">:smiling_devil:</span></p>



<a name="277072875"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277072875" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cyborus <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277072875">(Mar 29 2022 at 22:28)</a>:</h4>
<p>praise <code>rustfmt</code></p>



<a name="277073930"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277073930" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277073930">(Mar 29 2022 at 22:39)</a>:</h4>
<p>I just need to add in <span class="user-mention" data-user-id="312331">@Caleb Zulawski</span> 's example for the vanilla version and then it should be good.</p>



<a name="277074337"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277074337" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277074337">(Mar 29 2022 at 22:44)</a>:</h4>
<p>hm, </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">        </span><span class="p">.</span><span class="n">fold</span><span class="p">(</span><span class="n">f32x4</span>::<span class="n">splat</span><span class="p">(</span><span class="mf">0.</span><span class="p">),</span><span class="w"> </span><span class="n">std</span>::<span class="n">ops</span>::<span class="n">Add</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<p>Rust does not like this idiom, but I've not seen it before.</p>



<a name="277076377"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277076377" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Zulawski <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277076377">(Mar 29 2022 at 23:13)</a>:</h4>
<p>That should be fine, vectors also implement Sum</p>



<a name="277076628"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277076628" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277076628">(Mar 29 2022 at 23:16)</a>:</h4>
<p>I get </p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code><span class="o">[</span>I<span class="o">]</span> mrg@JuliaLap ~/p/r/s/c/c/examples <span class="o">(</span>dotprodexample<span class="o">)</span>&gt; cargo <span class="nb">test</span> --example dot_product
   Compiling core_simd v0.1.0 <span class="o">(</span>/home/mrg/projects/rust/stdsimd/crates/core_simd<span class="o">)</span>
error<span class="o">[</span>E0423<span class="o">]</span>: expected value, found trait <span class="sb">`</span>std::ops::Add<span class="sb">`</span>
   --&gt; crates/core_simd/examples/dot_product.rs:122:34
    <span class="p">|</span>
<span class="m">122</span> <span class="p">|</span>         .fold<span class="o">(</span>f32x4::splat<span class="o">(</span><span class="m">0</span>.0<span class="o">)</span>, std::ops::Add<span class="o">)</span>
    <span class="p">|</span>                                  ^^^^^^^^^^^^^ not a value

warning: unused import: <span class="sb">`</span>std::ops::Add<span class="sb">`</span>
   --&gt; crates/core_simd/examples/dot_product.rs:115:5
    <span class="p">|</span>
<span class="m">115</span> <span class="p">|</span> use std::ops::Add<span class="p">;</span>
    <span class="p">|</span>     ^^^^^^^^^^^^^
    <span class="p">|</span>
    <span class="o">=</span> note: <span class="sb">`</span><span class="c1">#[warn(unused_imports)]` on by default</span>

For more information about this error, try <span class="sb">`</span>rustc --explain E0423<span class="sb">`</span>.
warning: <span class="sb">`</span>core_simd<span class="sb">`</span> <span class="o">(</span>example <span class="s2">"dot_product"</span> <span class="nb">test</span><span class="o">)</span> generated <span class="m">1</span> warning
error: could not compile <span class="sb">`</span>core_simd<span class="sb">`</span> due to previous error<span class="p">;</span> <span class="m">1</span> warning emitted
</code></pre></div>



<a name="277076640"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277076640" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277076640">(Mar 29 2022 at 23:17)</a>:</h4>
<p>ah, the issue is that the import and that path is redundant.</p>



<a name="277076644"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277076644" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277076644">(Mar 29 2022 at 23:17)</a>:</h4>
<p>the import makes it into <code>Add</code></p>



<a name="277076757"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277076757" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cyborus <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277076757">(Mar 29 2022 at 23:19)</a>:</h4>
<p>should that be <code>.fold(f32x4::splat(0.0), std::ops::Add:add)</code>since <code>Add</code> is just a trait?</p>



<a name="277076770"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277076770" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277076770">(Mar 29 2022 at 23:19)</a>:</h4>
<p>prooobably</p>



<a name="277076971"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277076971" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277076971">(Mar 29 2022 at 23:22)</a>:</h4>
<p>(but with one more colon)</p>



<a name="277076975"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277076975" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cyborus <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277076975">(Mar 29 2022 at 23:22)</a>:</h4>
<p>oops</p>



<a name="277077023"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277077023" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cyborus <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277077023">(Mar 29 2022 at 23:23)</a>:</h4>
<p>and that's is why i love RA</p>



<a name="277077094"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277077094" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277077094">(Mar 29 2022 at 23:24)</a>:</h4>
<p>Ah, <code>std::ops::Add</code> is the trait, <code>std::ops::Add::add</code> is the actual op.</p>



<a name="277077105"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277077105" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277077105">(Mar 29 2022 at 23:24)</a>:</h4>
<p>yes.</p>



<a name="277077128"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277077128" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277077128">(Mar 29 2022 at 23:25)</a>:</h4>
<p><span aria-label="writing" class="emoji emoji-270d" role="img" title="writing">:writing:</span> <em>brb <a href="https://miguelraz.github.io/diary/">writing in Diary</a></em></p>



<a name="277077918"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277077918" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277077918">(Mar 29 2022 at 23:35)</a>:</h4>
<p>Ah, I missed adding some tests.</p>



<a name="277078164"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277078164" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277078164">(Mar 29 2022 at 23:38)</a>:</h4>
<p>Added!</p>



<a name="277078350"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277078350" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277078350">(Mar 29 2022 at 23:40)</a>:</h4>
<p>(Added the <code>mul_add</code> arg order to the diary because grrrr...)</p>



<a name="277318052"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277318052" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277318052">(Mar 31 2022 at 17:58)</a>:</h4>
<p>Alright, now I'm trying to add the output assembly with <code>cargo-asm</code>.<br>
Their examples says to try</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>cargo asm lib_crate::bar::double_n --rust
</code></pre></div>
<p>and so I'm trying to do</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>cargo asm core_simd::examples::dot_prod_scalar_0 --rust
</code></pre></div>
<p>but I can't find the function.</p>



<a name="277318172"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277318172" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277318172">(Mar 31 2022 at 17:59)</a>:</h4>
<p>(I'm calling this within the <code>/examples/</code> folder.)</p>



<a name="277318492"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277318492" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cyborus <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277318492">(Mar 31 2022 at 18:02)</a>:</h4>
<p>I think each example is compiled as its own crate sharing the name of the file, so I think it would be:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>cargo asm dot_product::dot_prod_scalar_0 --rust
</code></pre></div>
<p>if <code>cargo asm</code> works with examples at all (which I don't know)</p>



<a name="277319220"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277319220" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277319220">(Mar 31 2022 at 18:08)</a>:</h4>
<p>Hmmm. I'm not getting that to work. I might have to actually refactor it into separate mini crates.</p>



<a name="277319335"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277319335" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277319335">(Mar 31 2022 at 18:09)</a>:</h4>
<p>I just reallly, <em>really</em> want to be able to have the assembly printed for each tight loop in the <code>dot_product.rs</code> example.</p>



<a name="277320257"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277320257" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cyborus <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277320257">(Mar 31 2022 at 18:18)</a>:</h4>
<p>after a bit of testing myself, it seems it doesn't support examples</p>



<a name="277320359"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277320359" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cyborus <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277320359">(Mar 31 2022 at 18:18)</a>:</h4>
<p>running <code>&gt; cargo asm</code> on its own will list all available functions, and doing that in the example directory just lists the functions from the main crate</p>



<a name="277320432"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277320432" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cyborus <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277320432">(Mar 31 2022 at 18:19)</a>:</h4>
<p><span aria-label="oh no" class="emoji emoji-1f615" role="img" title="oh no">:oh_no:</span></p>



<a name="277320554"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277320554" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277320554">(Mar 31 2022 at 18:20)</a>:</h4>
<p>Yeah ran into the same thing - and actually, there's not <em>that</em> many functions listed there. IDK if it is a heuristic cutoff or if not all of them are exported right now.</p>



<a name="277320689"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277320689" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cyborus <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277320689">(Mar 31 2022 at 18:21)</a>:</h4>
<p>hmm, true. there's way more than just 6 functions in the crate I'm testing it on but that's all its showing.</p>



<a name="277320803"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277320803" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277320803">(Mar 31 2022 at 18:22)</a>:</h4>
<p>hmmmm - untouched since August 2018. Maybe there's another option here.</p>



<a name="277320878"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277320878" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cyborus <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277320878">(Mar 31 2022 at 18:23)</a>:</h4>
<p>I looked through the issues on that and one of them linked to a maintained fork that has a most recent commit from feb</p>



<a name="277320889"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277320889" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cyborus <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277320889">(Mar 31 2022 at 18:23)</a>:</h4>
<p><a href="https://github.com/taiki-e/cargo-asm">https://github.com/taiki-e/cargo-asm</a></p>



<a name="277320990"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277320990" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277320990">(Mar 31 2022 at 18:24)</a>:</h4>
<p>Oh neat - I don't know how to include <code>fork</code> repos in the crate though.</p>



<a name="277321055"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277321055" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cyborus <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277321055">(Mar 31 2022 at 18:24)</a>:</h4>
<p>wdym?</p>



<a name="277321102"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277321102" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277321102">(Mar 31 2022 at 18:25)</a>:</h4>
<p>I only know how to do <code>cargo add foo</code> when <code>foo</code> is registered on <code>crates.io</code>.</p>



<a name="277321113"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277321113" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277321113">(Mar 31 2022 at 18:25)</a>:</h4>
<p>You might also be able to do something like <code>cargo rustc -- --emit=asm</code>.  (Or <code>RUSTFLAGS="--emit=llvm-ir" cargo build</code> or ....)</p>



<a name="277321265"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277321265" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cyborus <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277321265">(Mar 31 2022 at 18:26)</a>:</h4>
<p>You can clone the repo and run <code>cargo install --path .</code></p>



<a name="277322015"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277322015" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cyborus <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277322015">(Mar 31 2022 at 18:33)</a>:</h4>
<blockquote>
<p>You might also be able to do something like <code>cargo rustc -- --emit=asm</code>.</p>
</blockquote>
<p>that worked! <code>cargo rustc --examples -- --emit=asm</code> will create a <code>./target/debug/examples/{name}.s</code> file</p>



<a name="277324070"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277324070" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277324070">(Mar 31 2022 at 18:49)</a>:</h4>
<p>ok I can't get <code>cargo rustc --examples -- --emit=asm</code> to work <span aria-label="cry" class="emoji emoji-1f622" role="img" title="cry">:cry:</span></p>



<a name="277324096"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277324096" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cyborus <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277324096">(Mar 31 2022 at 18:49)</a>:</h4>
<p>oh no</p>



<a name="277324113"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277324113" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cyborus <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277324113">(Mar 31 2022 at 18:49)</a>:</h4>
<p>what's going on?</p>



<a name="277324894"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277324894" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277324894">(Mar 31 2022 at 18:55)</a>:</h4>
<p>ok<br>
<code>cargo rust --release -- --emit=asm</code><br>
compiles and finishes, but then <code>.../target/release/examples</code> has nothing inside of it.</p>



<a name="277324951"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277324951" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277324951">(Mar 31 2022 at 18:55)</a>:</h4>
<p>(Thanks for the support, I will write this down in the <code>README.md</code> when I finish to spare others the same grief)</p>



<a name="277325124"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277325124" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cyborus <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277325124">(Mar 31 2022 at 18:56)</a>:</h4>
<p>did you pass the <code>--examples</code> flag?</p>



<a name="277325250"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277325250" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277325250">(Mar 31 2022 at 18:57)</a>:</h4>
<p>yup</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code><span class="o">[</span>I<span class="o">]</span> mrg@JuliaLap ~/p/r/s/c/core_simd <span class="o">(</span>assemblyexamples<span class="o">)</span>&gt; ls
Cargo.toml  LICENSE-APACHE  src    webdriver.json
examples    LICENSE-MIT     tests
<span class="o">[</span>I<span class="o">]</span> mrg@JuliaLap ~/p/r/s/c/core_simd <span class="o">(</span>assemblyexamples<span class="o">)</span>&gt; cargo rustc --examples -- --emit<span class="o">=</span>asm
error: extra arguments to <span class="sb">`</span>rustc<span class="sb">`</span> can only be passed to one target, consider filtering
the package by passing, e.g., <span class="sb">`</span>--lib<span class="sb">`</span> or <span class="sb">`</span>--bin NAME<span class="sb">`</span> to specify a single target
</code></pre></div>



<a name="277325324"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277325324" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277325324">(Mar 31 2022 at 18:58)</a>:</h4>
<p>lemme try it with Scott's RUSTFLAGS suggestion</p>



<a name="277325754"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277325754" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cyborus <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277325754">(Mar 31 2022 at 19:01)</a>:</h4>
<p>what directory are you checking for it in?</p>



<a name="277325776"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277325776" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cyborus <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277325776">(Mar 31 2022 at 19:01)</a>:</h4>
<p>release or debug?</p>



<a name="277325847"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277325847" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277325847">(Mar 31 2022 at 19:01)</a>:</h4>
<p>^ this recent one was at the top level <code>core_simd</code> (you can see it in the prompt).</p>



<a name="277325923"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277325923" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277325923">(Mar 31 2022 at 19:02)</a>:</h4>
<p>I'm trying to do release (I'm guessing debug won't run the autovectorizer, but I will check it in a bit)</p>



<a name="277326386"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277326386" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cyborus <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277326386">(Mar 31 2022 at 19:06)</a>:</h4>
<p>did you run <code>cargo rustc --examples -- --emit=asm</code> or <code>cargo rustc --examples --release -- --emit=asm</code>?</p>



<a name="277326535"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277326535" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cyborus <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277326535">(Mar 31 2022 at 19:08)</a>:</h4>
<p>sorry i'm asking so many questions, just trying to understand exactly what's going on</p>



<a name="277326700"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277326700" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277326700">(Mar 31 2022 at 19:09)</a>:</h4>
<p>No worries, ask  away!</p>



<a name="277326711"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277326711" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277326711">(Mar 31 2022 at 19:09)</a>:</h4>
<p>I got this to work: <code>[I] mrg@JuliaLap ~/p/r/s/c/core_simd (assemblyexamples)&gt; RUSTFLAGS="--emit=asm" cargo test --release --examples dot_product.rs</code></p>



<a name="277326749"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277326749" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277326749">(Mar 31 2022 at 19:09)</a>:</h4>
<p>...but it produces a 760k line assembly file soooooo yeah.</p>



<a name="277326766"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277326766" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277326766">(Mar 31 2022 at 19:10)</a>:</h4>
<p>I'm going to try using the <code>cargo asm</code> crate after all.</p>



<a name="277326833"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277326833" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cyborus <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277326833">(Mar 31 2022 at 19:10)</a>:</h4>
<p>oh heck</p>



<a name="277327029"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277327029" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277327029">(Mar 31 2022 at 19:11)</a>:</h4>
<p>yup.</p>



<a name="277328170"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277328170" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277328170">(Mar 31 2022 at 19:21)</a>:</h4>
<p>Well this is even more confusing because I can't even find <code>dot_prod_scalar_0</code> in the outputted <code>target/release/dot_product-...-.s</code> files <span aria-label="confused" class="emoji emoji-1f615" role="img" title="confused">:confused:</span></p>



<a name="277329961"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277329961" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cyborus <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277329961">(Mar 31 2022 at 19:38)</a>:</h4>
<p>I was gonna suggest maybe they got optimized out but they're not even showing up in a debug build...</p>



<a name="277330027"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277330027" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277330027">(Mar 31 2022 at 19:39)</a>:</h4>
<p>I’m guessing they should go into main().</p>



<a name="277330113"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277330113" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cyborus <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277330113">(Mar 31 2022 at 19:40)</a>:</h4>
<p>possibly</p>



<a name="277330251"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277330251" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277330251">(Mar 31 2022 at 19:41)</a>:</h4>
<p>it often helps to add <code>#[inline(never)]</code> to ensure your function shows up in the output.</p>



<a name="277330819"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277330819" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277330819">(Mar 31 2022 at 19:47)</a>:</h4>
<p>Can examples be non-binaries?  Usually if I'm looking at assembly I do it by <em>not</em> having a <code>main</code>, and thus all the <code>pub</code> functions will be there.</p>
<p>(And for extra fun, <code>#[inline(never)]</code> doesn't actually keep LLVM from inlining things in all situations.)</p>



<a name="277330953"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277330953" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cyborus <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277330953">(Mar 31 2022 at 19:48)</a>:</h4>
<p><code>#[inline(please_dont)]</code></p>



<a name="277331273"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277331273" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277331273">(Mar 31 2022 at 19:50)</a>:</h4>
<p>yes, you can make examples that are libs</p>



<a name="277331277"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277331277" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277331277">(Mar 31 2022 at 19:51)</a>:</h4>
<p>i dont know why you would though</p>



<a name="277331340"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277331340" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cyborus <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277331340">(Mar 31 2022 at 19:51)</a>:</h4>
<p>actually, <code>#[inline(minimal)]</code> would make sense</p>



<a name="277331351"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277331351" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cyborus <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277331351">(Mar 31 2022 at 19:51)</a>:</h4>
<p>oops sorry getting off track</p>



<a name="277331441"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277331441" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277331441">(Mar 31 2022 at 19:52)</a>:</h4>
<p><span class="user-mention" data-user-id="125270">@scottmcm</span> I’m up for examples being whatever as long as newbies like me can inspect the assembly in a bash 1liner</p>



<a name="277331535"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277331535" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277331535">(Mar 31 2022 at 19:53)</a>:</h4>
<p>you might be able to paste the relevant funciton into <a href="https://rust.godbolt.org/">https://rust.godbolt.org/</a>. i heavily use that when iterating on optimizations</p>



<a name="277331554"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277331554" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277331554">(Mar 31 2022 at 19:53)</a>:</h4>
<p>it can be a pain in the ass though</p>



<a name="277331614"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277331614" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277331614">(Mar 31 2022 at 19:53)</a>:</h4>
<p>I thought I could use something liek that, but idk how up to date their stdsimd libs are</p>



<a name="277339526"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277339526" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277339526">(Mar 31 2022 at 21:02)</a>:</h4>
<p>It's usually fairly recent -- you can see from the <code>i</code>:<br>
<a href="/user_uploads/4715/IcYV4ZezHs8trsc-_OSmbGgU/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/IcYV4ZezHs8trsc-_OSmbGgU/image.png" title="image.png"><img src="/user_uploads/4715/IcYV4ZezHs8trsc-_OSmbGgU/image.png"></a></div>



<a name="277339592"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277339592" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277339592">(Mar 31 2022 at 21:02)</a>:</h4>
<p>neat stuff. I’ll check it when I get back from lunch.</p>



<a name="277347459"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277347459" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277347459">(Mar 31 2022 at 22:17)</a>:</h4>
<p>grrrrr</p>



<a name="277347471"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277347471" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277347471">(Mar 31 2022 at 22:17)</a>:</h4>
<p>Does anyone have a "hello world" working on rust godbolt?</p>



<a name="277347618"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277347618" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277347618">(Mar 31 2022 at 22:19)</a>:</h4>
<p>iirc you could get <code>cargo rustc</code> to work if you specify on the command line which example to compile, rather than passing <code>--examples</code> which tells it to compile all examples.</p>



<a name="277347783"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277347783" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277347783">(Mar 31 2022 at 22:21)</a>:</h4>
<p><span class="user-mention" data-user-id="229517">@Jacob Lifshay</span> thanks, I'll give it another shot in a sec</p>



<a name="277350085"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277350085" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277350085">(Mar 31 2022 at 22:46)</a>:</h4>
<p>Sweet.</p>



<a name="277350112"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277350112" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277350112">(Mar 31 2022 at 22:47)</a>:</h4>
<p>Anyone know why it says that <code>dot_prod_scalar_0</code> is never used here?<br>
<a href="https://rust.godbolt.org/z/K3o9jPrds">https://rust.godbolt.org/z/K3o9jPrds</a></p>



<a name="277350313"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277350313" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277350313">(Mar 31 2022 at 22:49)</a>:</h4>
<p>because it thinks you're compiling a library rather than a binary and none of those functions are <code>pub</code>?</p>



<a name="277350341"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277350341" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277350341">(Mar 31 2022 at 22:49)</a>:</h4>
<p>i'd delete <code>main</code> and change the functions to <code>pub</code></p>



<a name="277350353"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277350353" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277350353">(Mar 31 2022 at 22:49)</a>:</h4>
<p>Oh...</p>



<a name="277350449"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277350449" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277350449">(Mar 31 2022 at 22:50)</a>:</h4>
<p>Thanks for the tips, my scripting brain is trying to catch up with all these pub/mod/crate/exports hoops - I'm very much not used to them.</p>



<a name="277350694"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277350694" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277350694">(Mar 31 2022 at 22:53)</a>:</h4>
<p>Oh wow - I don't even need a <code>main</code>, huh.</p>



<a name="277350842"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277350842" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277350842">(Mar 31 2022 at 22:54)</a>:</h4>
<p>Alright, now I don't know how to get <code>use core_simd::*;</code> to work on rust godbolt.</p>



<a name="277350854"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277350854" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277350854">(Mar 31 2022 at 22:54)</a>:</h4>
<p><span class="user-mention" data-user-id="209168">@Thom Chiovoloni</span> any reccs here?</p>



<a name="277350897"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277350897" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277350897">(Mar 31 2022 at 22:55)</a>:</h4>
<p><code>use core::simd::*</code> and switch the compiler to nightly?</p>



<a name="277350923"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277350923" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277350923">(Mar 31 2022 at 22:55)</a>:</h4>
<p>or <code>use std::simd::*</code></p>



<a name="277351172"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277351172" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277351172">(Mar 31 2022 at 22:58)</a>:</h4>
<p>Hmm - <a href="https://rust.godbolt.org/z/bfPozMEPv">tried both, no luck yet.</a></p>



<a name="277351452"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277351452" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277351452">(Mar 31 2022 at 23:01)</a>:</h4>
<p>works for me: <a href="https://rust.godbolt.org/z/a8K14Gezo">https://rust.godbolt.org/z/a8K14Gezo</a></p>



<a name="277351524"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277351524" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277351524">(Mar 31 2022 at 23:02)</a>:</h4>
<p>you forgot to switch to the nightly compiler.</p>



<a name="277351564"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277351564" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277351564">(Mar 31 2022 at 23:03)</a>:</h4>
<p>and the <code>use</code> needs to be <code>std::simd::*</code>, not <code>std::*</code></p>



<a name="277351633"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277351633" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277351633">(Mar 31 2022 at 23:04)</a>:</h4>
<p><span class="user-mention silent" data-user-id="229517">Jacob Lifshay</span> <a href="#narrow/stream/257879-project-portable-simd/topic/dot_product.20example/near/277351452">said</a>:</p>
<blockquote>
<p>works for me: <a href="https://rust.godbolt.org/z/a8K14Gezo">https://rust.godbolt.org/z/a8K14Gezo</a></p>
</blockquote>
<p>Right, I had tried both the nightly and the beta compilers, thanks for the help &lt;3</p>



<a name="277351762"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277351762" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277351762">(Mar 31 2022 at 23:06)</a>:</h4>
<p>Wait - that's <code>portable_simd</code>. Is that <code>== stdsimd</code>?</p>



<a name="277351797"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277351797" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277351797">(Mar 31 2022 at 23:06)</a>:</h4>
<p>yes</p>



<a name="277351827"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277351827" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277351827">(Mar 31 2022 at 23:07)</a>:</h4>
<p>but not <code>std::arch</code> (confusingly also called stdsimd)</p>



<a name="277352009"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277352009" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277352009">(Mar 31 2022 at 23:09)</a>:</h4>
<p>Ok, I feel like I can cut myself some slack as to the confusion here then <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span> jajajaj</p>



<a name="277352480"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277352480" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277352480">(Mar 31 2022 at 23:15)</a>:</h4>
<p>Yeah, that's why I figured we would want to make the rename, ultimately.</p>



<a name="277352504"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277352504" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277352504">(Mar 31 2022 at 23:15)</a>:</h4>
<p>gotcha.</p>



<a name="277352523"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277352523" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277352523">(Mar 31 2022 at 23:16)</a>:</h4>
<p>Oh, I think there's a nifty way to make the diff view with multiple different implementations neat here.</p>



<a name="277353431"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277353431" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277353431">(Mar 31 2022 at 23:28)</a>:</h4>
<p>Alright, bikeshed time:<br>
How do people <a href="https://rust.godbolt.org/z/rzhYs9z8n">like this view?</a></p>
<p>I like that you can see both code versions in an apples-to-apples fashion and that you get the <code>llvm-mca</code> output on the right to truly, honestly say that both ways compile down to the same source <span aria-label="muscle" class="emoji emoji-1f4aa" role="img" title="muscle">:muscle:</span></p>



<a name="277353500"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277353500" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277353500">(Mar 31 2022 at 23:29)</a>:</h4>
<p>too dense for mobile...</p>



<a name="277353572"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277353572" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277353572">(Mar 31 2022 at 23:30)</a>:</h4>
<p>yes, it’s best viewed on a full screen 😭</p>



<a name="277354510"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277354510" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277354510">(Mar 31 2022 at 23:44)</a>:</h4>
<p>Another possibility, since I wanted more vertical space for the IR: &lt;<a href="https://rust.godbolt.org/z/xn8bfPG9W">https://rust.godbolt.org/z/xn8bfPG9W</a>&gt;</p>
<p>(I have a 21½:9 monitor, though, so this might be too wide for some.)</p>



<a name="277354546"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277354546" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277354546">(Mar 31 2022 at 23:45)</a>:</h4>
<p>Oooo0o0o0o0o0oh</p>



<a name="277354548"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277354548" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277354548">(Mar 31 2022 at 23:45)</a>:</h4>
<p>Neat</p>



<a name="277354561"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277354561" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277354561">(Mar 31 2022 at 23:45)</a>:</h4>
<p>Yes, I like these sort of "pre-digested" benchmark views.</p>



<a name="277354683"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277354683" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277354683">(Mar 31 2022 at 23:47)</a>:</h4>
<p>Hmm, the MCA there seems unuseful -- It's including the <code>Debug::fmt</code>, for example.</p>



<a name="277355136"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277355136" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277355136">(Mar 31 2022 at 23:55)</a>:</h4>
<p>Hmph. <span aria-label="confused" class="emoji emoji-1f615" role="img" title="confused">:confused:</span> I don't know how to get rid of that.</p>



<a name="277355898"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277355898" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277355898">(Apr 01 2022 at 00:05)</a>:</h4>
<p>use <code>assert!(a == b)</code> instead of <code>assert_eq!(a, b)</code></p>



<a name="277355958"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277355958" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277355958">(Apr 01 2022 at 00:06)</a>:</h4>
<p>Ah, I was wondering how to propagate that length. thx!</p>



<a name="277356027"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277356027" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277356027">(Apr 01 2022 at 00:07)</a>:</h4>
<p>or maybe <code>if a != b {return &lt;const&gt;;}</code>, it gets rid of the panic stuff</p>



<a name="277357885"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277357885" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277357885">(Apr 01 2022 at 00:39)</a>:</h4>
<p><span class="user-mention silent" data-user-id="246783">Miguel Raz Guzmán Macedo</span> <a href="#narrow/stream/257879-project-portable-simd/topic/dot_product.20example/near/277350854">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="209168">Thom Chiovoloni</span> any reccs here?</p>
</blockquote>
<p>Sorry, I'm in "on the phone with health insurance" hell today so I probably wont be able to answer many questions. Did you figure it out?</p>



<a name="277357958"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277357958" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277357958">(Apr 01 2022 at 00:41)</a>:</h4>
<p><span class="user-mention" data-user-id="209168">@Thom Chiovoloni</span> Yes, made good progress <span aria-label="blush" class="emoji emoji-1f60a" role="img" title="blush">:blush:</span></p>



<a name="277357961"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277357961" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277357961">(Apr 01 2022 at 00:41)</a>:</h4>
<p>Hope it all works out for ya.</p>



<a name="277361649"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277361649" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277361649">(Apr 01 2022 at 01:45)</a>:</h4>
<p>LOL commenting out the <code>assert</code> gives some veeeery nice and compact assembly <span aria-label="speak no evil" class="emoji emoji-1f64a" role="img" title="speak no evil">:speak_no_evil:</span></p>



<a name="277361664"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277361664" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cyborus <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277361664">(Apr 01 2022 at 01:45)</a>:</h4>
<p>panicking is B i g</p>



<a name="277361755"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277361755" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277361755">(Apr 01 2022 at 01:47)</a>:</h4>
<p>yeah, hot dang.</p>



<a name="277361763"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277361763" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277361763">(Apr 01 2022 at 01:47)</a>:</h4>
<p>(goes to write it down <span aria-label="writing" class="emoji emoji-270d" role="img" title="writing">:writing:</span> )</p>



<a name="277362028"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277362028" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cyborus <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277362028">(Apr 01 2022 at 01:52)</a>:</h4>
<p>I wonder how much of it is formatting</p>



<a name="277362032"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277362032" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cyborus <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277362032">(Apr 01 2022 at 01:52)</a>:</h4>
<p>one sec gonna see if i can check</p>



<a name="277362497"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277362497" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cyborus <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277362497">(Apr 01 2022 at 02:00)</a>:</h4>
<p>update: turns out getting rid of panicking is hard</p>



<a name="277362517"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277362517" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cyborus <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277362517">(Apr 01 2022 at 02:01)</a>:</h4>
<p>even </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
</code></pre></div>
<p>has panicking stuff</p>



<a name="277362536"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277362536" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277362536">(Apr 01 2022 at 02:01)</a>:</h4>
<p><span class="user-mention silent" data-user-id="488929">Cyborus</span> <a href="#narrow/stream/257879-project-portable-simd/topic/dot_product.20example/near/277362497">said</a>:</p>
<blockquote>
<p>update: turns out getting rid of panicking is hard</p>
</blockquote>
<p>story of my life</p>



<a name="277362549"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277362549" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cyborus <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277362549">(Apr 01 2022 at 02:01)</a>:</h4>
<p>oof</p>



<a name="277362550"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277362550" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277362550">(Apr 01 2022 at 02:01)</a>:</h4>
<p>getting rid of main helps greatly</p>



<a name="277362556"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277362556" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277362556">(Apr 01 2022 at 02:01)</a>:</h4>
<p><span class="user-mention silent" data-user-id="229517">Jacob Lifshay</span> <a href="#narrow/stream/257879-project-portable-simd/topic/dot_product.20example/near/277362550">said</a>:</p>
<blockquote>
<p>getting rid of main helps greatly</p>
</blockquote>
<p>how so?</p>



<a name="277362601"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277362601" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277362601">(Apr 01 2022 at 02:02)</a>:</h4>
<p>less register setup and teardown?</p>



<a name="277362633"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277362633" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277362633">(Apr 01 2022 at 02:02)</a>:</h4>
<p>because main is where rustc generates tons of additional code for adapting C's main to rust's main</p>



<a name="277362665"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277362665" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277362665">(Apr 01 2022 at 02:03)</a>:</h4>
<p>Huh.</p>



<a name="277362870"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277362870" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cyborus <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277362870">(Apr 01 2022 at 02:07)</a>:</h4>
<p>might make a new topic investigating this mystery</p>



<a name="277362964"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277362964" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277362964">(Apr 01 2022 at 02:09)</a>:</h4>
<p><span class="user-mention" data-user-id="229517">@Jacob Lifshay</span> so if there's no <code>main</code>... the program just "runs"/doesn't setup a runtime?</p>



<a name="277363059"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277363059" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cyborus <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277363059">(Apr 01 2022 at 02:10)</a>:</h4>
<p>to make no <code>main</code>, you put <code>#![no_main]</code> at the top of the root file, and then have to create your own entry point for the program to start at</p>



<a name="277363084"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277363084" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cyborus <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277363084">(Apr 01 2022 at 02:11)</a>:</h4>
<p>i.e. <code>#[no_mangle] pub extern "C" fn _start() -&gt; ! { /* ... */ }</code>for wasi</p>



<a name="277363094"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277363094" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cyborus <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277363094">(Apr 01 2022 at 02:11)</a>:</h4>
<p>err, the <code>-&gt; !</code> might not be needed. one sec</p>



<a name="277363118"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277363118" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cyborus <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277363118">(Apr 01 2022 at 02:12)</a>:</h4>
<p>yeah it isn't</p>



<a name="277363900"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277363900" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277363900">(Apr 01 2022 at 02:27)</a>:</h4>
<p>Alright, does anyone know how to target SSE1, SSE2, AVX, AVX512 on the godbolt machine? I'm trying <code>-C -target-feature=+avx2</code> but no cigar.</p>



<a name="277364768"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277364768" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277364768">(Apr 01 2022 at 02:45)</a>:</h4>
<p>squeeeee <span class="user-mention" data-user-id="281757">@Jubilee</span> check it out<br>
<a href="https://rust.godbolt.org/z/jnbjxToE5">https://rust.godbolt.org/z/jnbjxToE5</a></p>



<a name="277365265"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277365265" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277365265">(Apr 01 2022 at 02:56)</a>:</h4>
<p>omg godbolt has has docs on hover for the <code>asm</code> instructions o.0</p>



<a name="277365565"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277365565" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277365565">(Apr 01 2022 at 03:02)</a>:</h4>
<p><code>-C target-feature=+avx2</code></p>



<a name="277365569"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277365569" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277365569">(Apr 01 2022 at 03:03)</a>:</h4>
<p>not <code>-C -target-feature</code></p>



<a name="277365574"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277365574" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277365574">(Apr 01 2022 at 03:03)</a>:</h4>
<p>no dash</p>



<a name="277365590"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277365590" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277365590">(Apr 01 2022 at 03:03)</a>:</h4>
<p><span class="user-mention" data-user-id="246783">@Miguel Raz Guzmán Macedo</span>  actually you dont even need the leading space. <code>-Ctarget-feature=+avx2</code> should work. or <code>-Ctarget-cpu=native</code></p>



<a name="277365599"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277365599" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277365599">(Apr 01 2022 at 03:03)</a>:</h4>
<p>kk thx. brb.</p>



<a name="277365603"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277365603" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277365603">(Apr 01 2022 at 03:04)</a>:</h4>
<p>(native might give you avx512 stuff, since its a server)</p>



<a name="277365812"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277365812" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277365812">(Apr 01 2022 at 03:08)</a>:</h4>
<p><span class="user-mention silent" data-user-id="209168">Thom Chiovoloni</span> <a href="#narrow/stream/257879-project-portable-simd/topic/dot_product.20example/near/277365590">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="246783">Miguel Raz Guzmán Macedo</span>  actually you dont even need the leading space. <code>-Ctarget-feature=+avx2</code> should work. or <code>-Ctarget-cpu=native</code></p>
</blockquote>
<p>hmmm - not getting it <a href="https://rust.godbolt.org/z/zhhs5936h">to work here</a></p>



<a name="277365833"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277365833" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277365833">(Apr 01 2022 at 03:09)</a>:</h4>
<p>-Ctarget-feature=+avx2 -Copt-level=3 gets you to the next part (you need a -C for both).</p>



<a name="277365894"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277365894" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277365894">(Apr 01 2022 at 03:10)</a>:</h4>
<p>you also either need <code>pub unsafe fn dot_prod_simd_0</code> since #[target_feature(enable)] functions must be unsafe</p>



<a name="277365904"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277365904" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277365904">(Apr 01 2022 at 03:10)</a>:</h4>
<p>but you also could remove the target_feature(enable) since you're passing a -Ctarget-feature statically</p>



<a name="277365923"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277365923" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277365923">(Apr 01 2022 at 03:11)</a>:</h4>
<p><a href="https://rust.godbolt.org/z/hMqbnjbbn">https://rust.godbolt.org/z/hMqbnjbbn</a> (you don't need #[inline(never)] in this case)</p>



<a name="277365926"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277365926" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277365926">(Apr 01 2022 at 03:11)</a>:</h4>
<p>yay I guessed the <code>-C</code> per chain was needed just before looking over here :D</p>



<a name="277365971"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277365971" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277365971">(Apr 01 2022 at 03:12)</a>:</h4>
<p>and the <code>pub unsafe</code> stuff from looking at the errors.</p>



<a name="277365986"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277365986" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277365986">(Apr 01 2022 at 03:12)</a>:</h4>
<p><span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span> yayyy it's aliveeee</p>



<a name="277366133"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277366133" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277366133">(Apr 01 2022 at 03:16)</a>:</h4>
<p>you shouldn't do reduce_sum every iteration though</p>



<a name="277366134"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277366134" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277366134">(Apr 01 2022 at 03:17)</a>:</h4>
<p>thats a very slow sequence of instructions</p>



<a name="277366206"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277366206" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277366206">(Apr 01 2022 at 03:18)</a>:</h4>
<p>consider something like</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">        </span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="o">|</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="o">|</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">sum</span>::<span class="o">&lt;</span><span class="n">f32x4</span><span class="o">&gt;</span><span class="p">()</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">reduce_sum</span><span class="p">()</span><span class="w"></span>
</code></pre></div>
<p>or perhaps</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">        </span><span class="p">.</span><span class="n">fold</span><span class="p">(</span><span class="n">f32x4</span>::<span class="n">splat</span><span class="p">(</span><span class="mf">0.0</span><span class="p">),</span><span class="w"> </span><span class="o">|</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">)</span><span class="o">|</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">mul_add</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">reduce_sum</span><span class="p">()</span><span class="w"></span>
</code></pre></div>



<a name="277366212"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277366212" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277366212">(Apr 01 2022 at 03:18)</a>:</h4>
<p>so that you only do the reduce_sum once at the end</p>



<a name="277366244"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277366244" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277366244">(Apr 01 2022 at 03:19)</a>:</h4>
<p>yeah, so that's what the last few examples do. I wanted to keep the inefficient examples, measure their throuput, and build up the intuition on minimizing data movement in each iteration.</p>



<a name="277366917"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277366917" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277366917">(Apr 01 2022 at 03:31)</a>:</h4>
<p><span class="user-mention silent" data-user-id="488929">Cyborus</span> <a href="#narrow/stream/257879-project-portable-simd/topic/dot_product.20example/near/277362517">said</a>:</p>
<blockquote>
<p>even </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
</code></pre></div>
<p>has panicking stuff</p>
</blockquote>
<p>All the more reason to use libraries when looking at assembly <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="277367184"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277367184" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277367184">(Apr 01 2022 at 03:36)</a>:</h4>
<p>hmm, i wonder if it needs to or if that could be fixed</p>



<a name="277367204"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277367204" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277367204">(Apr 01 2022 at 03:37)</a>:</h4>
<p>it'd be nice if <code>fn main()</code> didnt on its own bring in the panic runtime, althouhg realistically i guess there's no avoiding the next thing you do bringing it in in realistic cases</p>



<a name="277368086"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277368086" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cyborus <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277368086">(Apr 01 2022 at 03:54)</a>:</h4>
<p>so far I've found the panic on windows (<a href="https://github.com/rust-lang/rust/blob/master/library/std/src/sys/windows/stack_overflow.rs#L38">here</a>)</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="n">c</span>::<span class="n">AddVectoredExceptionHandler</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">vectored_handler</span><span class="p">).</span><span class="n">is_null</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="fm">panic!</span><span class="p">(</span><span class="s">"failed to install exception handler"</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="277368117"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277368117" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cyborus <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277368117">(Apr 01 2022 at 03:54)</a>:</h4>
<p>i find it kinda ironic that it causes the equivalent to an exception just after failing to set the exception handler</p>



<a name="277368820"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277368820" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cyborus <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277368820">(Apr 01 2022 at 04:06)</a>:</h4>
<p>it seems the panics for unix/linux (and probably other platforms) come from within <code>Vec</code></p>



<a name="277370171"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277370171" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277370171">(Apr 01 2022 at 04:42)</a>:</h4>
<p>branch is polluted with dirty commits but people can opine on it now I guess <a href="https://github.com/rust-lang/portable-simd/pull/270">https://github.com/rust-lang/portable-simd/pull/270</a></p>



<a name="277370247"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277370247" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277370247">(Apr 01 2022 at 04:44)</a>:</h4>
<p><span aria-label="balloon" class="emoji emoji-1f388" role="img" title="balloon">:balloon:</span> is up <span class="user-mention" data-user-id="281757">@Jubilee</span></p>



<a name="277371319"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277371319" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277371319">(Apr 01 2022 at 05:06)</a>:</h4>
<p>yay.</p>



<a name="277549978"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277549978" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Miguel Raz Guzmán Macedo <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277549978">(Apr 02 2022 at 20:29)</a>:</h4>
<p>Alright I cleanded the PR branch with a nice rebase and <code>--force</code> push <span aria-label="sunglasses" class="emoji emoji-1f60e" role="img" title="sunglasses">:sunglasses:</span></p>



<a name="277550603"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277550603" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277550603">(Apr 02 2022 at 20:43)</a>:</h4>
<p>nice</p>



<a name="277661615"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257879-project-portable-simd/topic/dot_product%20example/near/277661615" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/257879-project-portable-simd/topic/dot_product.20example.html#277661615">(Apr 03 2022 at 21:18)</a>:</h4>
<p>Ah, <a href="https://github.com/rust-lang/portable-simd/pull/128">https://github.com/rust-lang/portable-simd/pull/128</a> didn't get rebased?</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>