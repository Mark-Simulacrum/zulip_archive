<html>
<head><meta charset="utf-8"><title>Possible improvement to `help: add feature` message? · t-compiler/wg-diagnostics · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/index.html">t-compiler/wg-diagnostics</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/topic/Possible.20improvement.20to.20.60help.3A.20add.20feature.60.20message.3F.html">Possible improvement to `help: add feature` message?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="260392896"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/147480-t-compiler/wg-diagnostics/topic/Possible%20improvement%20to%20%60help%3A%20add%20feature%60%20message%3F/near/260392896" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Waffle Lapkin <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/topic/Possible.20improvement.20to.20.60help.3A.20add.20feature.60.20message.3F.html#260392896">(Nov 05 2021 at 11:21)</a>:</h4>
<p>There is a <code>help</code> message when a nightly feature is required but not enabled:</p>
<div class="codehilite" data-code-language="Text only"><pre><span></span><code>    = help: add `#![feature(const_eval_select)]` to the crate attributes to enable
</code></pre></div>
<p>I wander if this could also include a link to the crate root file like this:</p>
<div class="codehilite" data-code-language="Text only"><pre><span></span><code>    = help: add `#![feature(const_eval_select)]` to the crate attributes to enable: src/lib.rs:1:1
</code></pre></div>
<p>Because in a big project it is sometimes hard to find the crate root and it's a lot easier to just click the link :)</p>
<p>Does this seem reasonable?</p>



<a name="260400687"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/147480-t-compiler/wg-diagnostics/topic/Possible%20improvement%20to%20%60help%3A%20add%20feature%60%20message%3F/near/260400687" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Waffle Lapkin <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/topic/Possible.20improvement.20to.20.60help.3A.20add.20feature.60.20message.3F.html#260400687">(Nov 05 2021 at 12:52)</a>:</h4>
<p>This could also help in cases when "the crate" is actually test/binary/etc i.e. not the only/main crate in the project</p>



<a name="260408418"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/147480-t-compiler/wg-diagnostics/topic/Possible%20improvement%20to%20%60help%3A%20add%20feature%60%20message%3F/near/260408418" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/topic/Possible.20improvement.20to.20.60help.3A.20add.20feature.60.20message.3F.html#260408418">(Nov 05 2021 at 13:59)</a>:</h4>
<p>I think it would be great if there was a MachineApplicable suggestion on where to place the feature attribute. However, I vaguely recall looking into this in the past, and finding it was not easy to do.  The place where this error is generated doesn't seem to have easy access to the crate root span (AFAIK).  <a href="https://github.com/rust-lang/rust/issues/81370">#81370</a> somewhat covers this issue.</p>



<a name="260434987"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/147480-t-compiler/wg-diagnostics/topic/Possible%20improvement%20to%20%60help%3A%20add%20feature%60%20message%3F/near/260434987" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manish Goregaokar <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/topic/Possible.20improvement.20to.20.60help.3A.20add.20feature.60.20message.3F.html#260434987">(Nov 05 2021 at 17:08)</a>:</h4>
<p>it's also, imo, MaybeIncorrect, because a project may not want to opt into a feature</p>



<a name="260543142"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/147480-t-compiler/wg-diagnostics/topic/Possible%20improvement%20to%20%60help%3A%20add%20feature%60%20message%3F/near/260543142" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/topic/Possible.20improvement.20to.20.60help.3A.20add.20feature.60.20message.3F.html#260543142">(Nov 06 2021 at 23:51)</a>:</h4>
<p><span class="user-mention silent" data-user-id="120518">Eric Huss</span> <a href="#narrow/stream/147480-t-compiler.2Fwg-diagnostics/topic/Possible.20improvement.20to.20.60help.3A.20add.20feature.60.20message.3F/near/260408418">said</a>:</p>
<blockquote>
<p>I think it would be great if there was a MachineApplicable suggestion on where to place the feature attribute. However, I vaguely recall looking into this in the past, and finding it was not easy to do.  The place where this error is generated doesn't seem to have easy access to the crate root span (AFAIK).  <a href="https://github.com/rust-lang/rust/issues/81370">#81370</a> somewhat covers this issue.</p>
</blockquote>
<p>I think you could access the crate root span with something along the lines of <code>tcx.def_span(CRATE_DEF_ID)</code>. But you'd still need to adjust it so it points to the right spot. Maybe <code>.shrink_to_lo()</code> would be good enough?</p>



<a name="260543349"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/147480-t-compiler/wg-diagnostics/topic/Possible%20improvement%20to%20%60help%3A%20add%20feature%60%20message%3F/near/260543349" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/topic/Possible.20improvement.20to.20.60help.3A.20add.20feature.60.20message.3F.html#260543349">(Nov 06 2021 at 23:57)</a>:</h4>
<p><span class="user-mention" data-user-id="307537">@Noah Lev</span> The issue I saw was that this error primarily happens in <code>feature_err_issue</code>, which only has access to a <code>ParseSess</code>, and I don't see a way to get the crate root from there. Is there a way?</p>



<a name="260543566"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/147480-t-compiler/wg-diagnostics/topic/Possible%20improvement%20to%20%60help%3A%20add%20feature%60%20message%3F/near/260543566" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/topic/Possible.20improvement.20to.20.60help.3A.20add.20feature.60.20message.3F.html#260543566">(Nov 07 2021 at 00:01)</a>:</h4>
<p>Ah, I didn't realize this was pre-TyCtxt</p>



<a name="260543576"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/147480-t-compiler/wg-diagnostics/topic/Possible%20improvement%20to%20%60help%3A%20add%20feature%60%20message%3F/near/260543576" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/topic/Possible.20improvement.20to.20.60help.3A.20add.20feature.60.20message.3F.html#260543576">(Nov 07 2021 at 00:01)</a>:</h4>
<p>Although I thought a lot of feature-gating (though not all) is post-expansion?</p>



<a name="260543625"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/147480-t-compiler/wg-diagnostics/topic/Possible%20improvement%20to%20%60help%3A%20add%20feature%60%20message%3F/near/260543625" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/topic/Possible.20improvement.20to.20.60help.3A.20add.20feature.60.20message.3F.html#260543625">(Nov 07 2021 at 00:02)</a>:</h4>
<p>Perhaps I'm misremembering</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>