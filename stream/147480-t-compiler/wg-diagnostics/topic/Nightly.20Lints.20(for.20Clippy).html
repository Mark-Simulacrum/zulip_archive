<html>
<head><meta charset="utf-8"><title>Nightly Lints (for Clippy) · t-compiler/wg-diagnostics · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/index.html">t-compiler/wg-diagnostics</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/topic/Nightly.20Lints.20(for.20Clippy).html">Nightly Lints (for Clippy)</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="272393640"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/147480-t-compiler/wg-diagnostics/topic/Nightly%20Lints%20%28for%20Clippy%29/near/272393640" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> xFrednet <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/topic/Nightly.20Lints.20(for.20Clippy).html#272393640">(Feb 18 2022 at 12:08)</a>:</h4>
<p>Hello, in Clippy we've discussed some ways how we can get more early feedback and maybe reduce the false positive rate for new lints. One problem, is that sometimes new lints are only available on nightly for one week until the beta branch is created. It is still possible to address some issues with backports, but ideally, we would like to increase the time that new lints stay on nightly to get more feedback from users. It was suggested to add nightly lints which behave like normal lints on nightly, but are allow-by-default on beta and stable.</p>



<a name="272393684"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/147480-t-compiler/wg-diagnostics/topic/Nightly%20Lints%20%28for%20Clippy%29/near/272393684" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> xFrednet <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/topic/Nightly.20Lints.20(for.20Clippy).html#272393684">(Feb 18 2022 at 12:09)</a>:</h4>
<p>Is that something that could potentially be implemented in rustc?</p>



<a name="272393711"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/147480-t-compiler/wg-diagnostics/topic/Nightly%20Lints%20%28for%20Clippy%29/near/272393711" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> xFrednet <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/topic/Nightly.20Lints.20(for.20Clippy).html#272393711">(Feb 18 2022 at 12:09)</a>:</h4>
<p>cc: <span class="user-mention" data-user-id="264664">@flip1995</span> <span class="user-mention" data-user-id="360405">@Cameron Steffen</span></p>



<a name="272394442"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/147480-t-compiler/wg-diagnostics/topic/Nightly%20Lints%20%28for%20Clippy%29/near/272394442" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> flip1995 <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/topic/Nightly.20Lints.20(for.20Clippy).html#272394442">(Feb 18 2022 at 12:18)</a>:</h4>
<p>As a possible way to implement this, I would think of adding a <code>is_nightly</code>/<code>is_unstable</code> field to the <code>Lint</code> struct and during lint emission to check that field  and check if the current toolchain is the nightly toolchain.</p>
<p>Another question that is still not really answered is how to deal with <code>allow</code>/... attributes of those nightly lints on a stable/beta toolchain. Mostly this is because Clippy is really limited in what it can do here. I think this could also be handled better and more flexible in rustc.</p>



<a name="272394695"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/147480-t-compiler/wg-diagnostics/topic/Nightly%20Lints%20%28for%20Clippy%29/near/272394695" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> flip1995 <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/topic/Nightly.20Lints.20(for.20Clippy).html#272394695">(Feb 18 2022 at 12:21)</a>:</h4>
<p>As an alternative we may be able to reuse the <code>feature_gate</code> field of the <code>Lint</code> struct and gate Clippy lints under a <code>clippy_nightly</code> feature or similar and then enable this feature through the <code>clippy-driver</code> if we're in a nightly build. But I'm not sure if that is technically possible in Clippy. This also feels a bit hacky to me.</p>



<a name="272397107"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/147480-t-compiler/wg-diagnostics/topic/Nightly%20Lints%20%28for%20Clippy%29/near/272397107" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/topic/Nightly.20Lints.20(for.20Clippy).html#272397107">(Feb 18 2022 at 12:47)</a>:</h4>
<p>Implementing it is pretty easy, I think. I'm worried about the likelihood of beta promotion failure as a result of divergence in clippy (or rustc tests)</p>



<a name="272397211"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/147480-t-compiler/wg-diagnostics/topic/Nightly%20Lints%20%28for%20Clippy%29/near/272397211" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/topic/Nightly.20Lints.20(for.20Clippy).html#272397211">(Feb 18 2022 at 12:48)</a>:</h4>
<p>We can try and mitigate that of course, but it's not atypical for this kind of thing to end up going somewhat poorly :)</p>



<a name="272413139"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/147480-t-compiler/wg-diagnostics/topic/Nightly%20Lints%20%28for%20Clippy%29/near/272413139" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> xFrednet <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/topic/Nightly.20Lints.20(for.20Clippy).html#272413139">(Feb 18 2022 at 15:10)</a>:</h4>
<p>I think a big question is how these lints should behave on stable. If we only change the lint level depending on if they are nightly or not, then tests should remain working as usual as long as we have <code>#[deny(lint_name)]</code> in the file. Otherwise, it might require some more hackery</p>



<a name="272413328"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/147480-t-compiler/wg-diagnostics/topic/Nightly%20Lints%20%28for%20Clippy%29/near/272413328" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> xFrednet <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/topic/Nightly.20Lints.20(for.20Clippy).html#272413328">(Feb 18 2022 at 15:12)</a>:</h4>
<p>If nobody is apposed to that idea, I'd be happy to work on that. I already build two prototypes in Clippy which are a bit hacky. First, I'll wait some more to give everyone the opportunity or answer :)</p>



<a name="272413595"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/147480-t-compiler/wg-diagnostics/topic/Nightly%20Lints%20%28for%20Clippy%29/near/272413595" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> flip1995 <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/topic/Nightly.20Lints.20(for.20Clippy).html#272413595">(Feb 18 2022 at 15:14)</a>:</h4>
<blockquote>
<p>I'm worried about the likelihood of beta promotion failure as a result of divergence in clippy (or rustc tests)</p>
</blockquote>
<p>If we introduce nightly lints in Clippy, this is of concern either way, I think. So we'll have to deal with it anyway, regardless if we implement support for nightly lints in rustc directly or in Clippy. </p>
<p>But yeah, that wasn't on the list of concerns I had about this. Thanks for pointing it out! :)</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>