<html>
<head><meta charset="utf-8"><title>Internal lint against diag messages that breaks conventions · t-compiler/wg-diagnostics · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/index.html">t-compiler/wg-diagnostics</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/topic/Internal.20lint.20against.20diag.20messages.20that.20breaks.20conventions.html">Internal lint against diag messages that breaks conventions</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="254821310"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/147480-t-compiler/wg-diagnostics/topic/Internal%20lint%20against%20diag%20messages%20that%20breaks%20conventions/near/254821310" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hirochika Matsumoto <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/topic/Internal.20lint.20against.20diag.20messages.20that.20breaks.20conventions.html#254821310">(Sep 25 2021 at 08:33)</a>:</h4>
<p>It's nice to add lint that checks if newly-added diagnostic messages follow <a href="https://rustc-dev-guide.rust-lang.org/diagnostics.html#diagnostic-output-style-guide">some conventions</a>, but I guess it's hard to get the lint implemented because there are a bunch of helper functions/methods that produce diag messages.<br>
Alternatively, we can add a script that iterates through all <code>.stderr</code> files and check if the conventions are practiced, and run it on CI or something.<br>
Do you think it's worth adding the lint or the script?<br>
cc: <span class="user-mention" data-user-id="119031">@Esteban Küber</span></p>



<a name="254825996"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/147480-t-compiler/wg-diagnostics/topic/Internal%20lint%20against%20diag%20messages%20that%20breaks%20conventions/near/254825996" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Esteban Küber <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/topic/Internal.20lint.20against.20diag.20messages.20that.20breaks.20conventions.html#254825996">(Sep 25 2021 at 09:52)</a>:</h4>
<p><span class="user-mention" data-user-id="331617">@Hirochika Matsumoto</span> that's an excellent idea. I think we could make start with some small checks first, like making sure we don't start messages with upper case and things like that and build up from there. What do you think?</p>



<a name="254826052"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/147480-t-compiler/wg-diagnostics/topic/Internal%20lint%20against%20diag%20messages%20that%20breaks%20conventions/near/254826052" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Esteban Küber <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/topic/Internal.20lint.20against.20diag.20messages.20that.20breaks.20conventions.html#254826052">(Sep 25 2021 at 09:53)</a>:</h4>
<p>The script idea also helps and I would like to make it clear when spans overlap so that have some way of revising them to try to avoid that. That could be integrated into the test machinery that checks the //~ annotations</p>



<a name="254853053"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/147480-t-compiler/wg-diagnostics/topic/Internal%20lint%20against%20diag%20messages%20that%20breaks%20conventions/near/254853053" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hirochika Matsumoto <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/topic/Internal.20lint.20against.20diag.20messages.20that.20breaks.20conventions.html#254853053">(Sep 25 2021 at 16:45)</a>:</h4>
<blockquote>
<p>I think we could make start with some small checks first, like making sure we don't start messages with upper case and things like that and build up from there. What do you think?</p>
</blockquote>
<p>Can't agree more. I gonna make a small PoC with the latter (a script) approach tomorrow and see how it goes. With the former approach it's hard to support clippy I presumed.</p>
<blockquote>
<p>That could be integrated into the test machinery that checks the //~ annotations</p>
</blockquote>
<p>That's interesting. I'll ask you for some advice on the integration once the PoC is done.</p>



<a name="254943903"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/147480-t-compiler/wg-diagnostics/topic/Internal%20lint%20against%20diag%20messages%20that%20breaks%20conventions/near/254943903" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hirochika Matsumoto <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/topic/Internal.20lint.20against.20diag.20messages.20that.20breaks.20conventions.html#254943903">(Sep 26 2021 at 16:34)</a>:</h4>
<p>PoC's here: <a href="https://github.com/hkmatsumoto/diaglint">https://github.com/hkmatsumoto/diaglint</a></p>



<a name="254954510"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/147480-t-compiler/wg-diagnostics/topic/Internal%20lint%20against%20diag%20messages%20that%20breaks%20conventions/near/254954510" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Esteban Küber <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/topic/Internal.20lint.20against.20diag.20messages.20that.20breaks.20conventions.html#254954510">(Sep 26 2021 at 19:14)</a>:</h4>
<p>I'll take a look at it tomorrow</p>



<a name="255177524"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/147480-t-compiler/wg-diagnostics/topic/Internal%20lint%20against%20diag%20messages%20that%20breaks%20conventions/near/255177524" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> flip1995 <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/topic/Internal.20lint.20against.20diag.20messages.20that.20breaks.20conventions.html#255177524">(Sep 28 2021 at 08:04)</a>:</h4>
<p>We also tried to do this in Clippy and found that writing a internal lint in Clippy was not viable. So Clippy has a test, that checks the <code>stderr</code> outputs: <a href="https://github.com/rust-lang/rust-clippy/blob/master/tests/lint_message_convention.rs">https://github.com/rust-lang/rust-clippy/blob/master/tests/lint_message_convention.rs</a></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>