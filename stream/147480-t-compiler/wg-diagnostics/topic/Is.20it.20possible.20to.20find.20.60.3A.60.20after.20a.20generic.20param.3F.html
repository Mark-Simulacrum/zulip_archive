<html>
<head><meta charset="utf-8"><title>Is it possible to find `:` after a generic param? · t-compiler/wg-diagnostics · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/index.html">t-compiler/wg-diagnostics</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/topic/Is.20it.20possible.20to.20find.20.60.3A.60.20after.20a.20generic.20param.3F.html">Is it possible to find `:` after a generic param?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="278480706"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/147480-t-compiler/wg-diagnostics/topic/Is%20it%20possible%20to%20find%20%60%3A%60%20after%20a%20generic%20param%3F/near/278480706" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Waffle Lapkin <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/topic/Is.20it.20possible.20to.20find.20.60.3A.60.20after.20a.20generic.20param.3F.html#278480706">(Apr 10 2022 at 17:45)</a>:</h4>
<p>Is there a way to differentiate between  <code>foo</code> and <code>bar</code> here?</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">foo</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">bar</span><span class="o">&lt;</span><span class="n">T</span>:<span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
</code></pre></div>
<p>to produce correct suggestions I need to know whatever <code>:</code> is there...</p>



<a name="278480767"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/147480-t-compiler/wg-diagnostics/topic/Is%20it%20possible%20to%20find%20%60%3A%60%20after%20a%20generic%20param%3F/near/278480767" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/topic/Is.20it.20possible.20to.20find.20.60.3A.60.20after.20a.20generic.20param.3F.html#278480767">(Apr 10 2022 at 17:46)</a>:</h4>
<p>that's legal?</p>



<a name="278480785"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/147480-t-compiler/wg-diagnostics/topic/Is%20it%20possible%20to%20find%20%60%3A%60%20after%20a%20generic%20param%3F/near/278480785" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Waffle Lapkin <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/topic/Is.20it.20possible.20to.20find.20.60.3A.60.20after.20a.20generic.20param.3F.html#278480785">(Apr 10 2022 at 17:47)</a>:</h4>
<p>yes</p>



<a name="278480797"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/147480-t-compiler/wg-diagnostics/topic/Is%20it%20possible%20to%20find%20%60%3A%60%20after%20a%20generic%20param%3F/near/278480797" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Waffle Lapkin <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/topic/Is.20it.20possible.20to.20find.20.60.3A.60.20after.20a.20generic.20param.3F.html#278480797">(Apr 10 2022 at 17:47)</a>:</h4>
<p>For context, I'm working with <code>hir::Generics</code> here</p>



<a name="278480853"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/147480-t-compiler/wg-diagnostics/topic/Is%20it%20possible%20to%20find%20%60%3A%60%20after%20a%20generic%20param%3F/near/278480853" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/topic/Is.20it.20possible.20to.20find.20.60.3A.60.20after.20a.20generic.20param.3F.html#278480853">(Apr 10 2022 at 17:48)</a>:</h4>
<p>I see it's in the <a href="https://doc.rust-lang.org/reference/items/generics.html">reference</a> too. I wonder why it is allowed?</p>



<a name="278481562"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/147480-t-compiler/wg-diagnostics/topic/Is%20it%20possible%20to%20find%20%60%3A%60%20after%20a%20generic%20param%3F/near/278481562" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/topic/Is.20it.20possible.20to.20find.20.60.3A.60.20after.20a.20generic.20param.3F.html#278481562">(Apr 10 2022 at 18:03)</a>:</h4>
<p>generic const exprs is abusing the syntax as a stand in for <code>evaluatable { CONST EXPRESSION }</code> i think</p>



<a name="278481564"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/147480-t-compiler/wg-diagnostics/topic/Is%20it%20possible%20to%20find%20%60%3A%60%20after%20a%20generic%20param%3F/near/278481564" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/topic/Is.20it.20possible.20to.20find.20.60.3A.60.20after.20a.20generic.20param.3F.html#278481564">(Apr 10 2022 at 18:03)</a>:</h4>
<p>it might also be there for macros</p>



<a name="278484285"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/147480-t-compiler/wg-diagnostics/topic/Is%20it%20possible%20to%20find%20%60%3A%60%20after%20a%20generic%20param%3F/near/278484285" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Esteban Küber <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/topic/Is.20it.20possible.20to.20find.20.60.3A.60.20after.20a.20generic.20param.3F.html#278484285">(Apr 10 2022 at 19:05)</a>:</h4>
<p>I think that there might be a difference on the span for the param and the name of the param, even though there's an empty bound</p>



<a name="278484301"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/147480-t-compiler/wg-diagnostics/topic/Is%20it%20possible%20to%20find%20%60%3A%60%20after%20a%20generic%20param%3F/near/278484301" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Esteban Küber <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/topic/Is.20it.20possible.20to.20find.20.60.3A.60.20after.20a.20generic.20param.3F.html#278484301">(Apr 10 2022 at 19:05)</a>:</h4>
<p>and if there isn't, you could... change the parser so there is</p>



<a name="278484613"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/147480-t-compiler/wg-diagnostics/topic/Is%20it%20possible%20to%20find%20%60%3A%60%20after%20a%20generic%20param%3F/near/278484613" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Goulet (compiler-errors) <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/topic/Is.20it.20possible.20to.20find.20.60.3A.60.20after.20a.20generic.20param.3F.html#278484613">(Apr 10 2022 at 19:11)</a>:</h4>
<p>If you want to stay completely in HIR, you could look for a corresponding <code>WhereBoundPredicate</code> with no <code>bounds</code>: <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_hir/hir/struct.WhereBoundPredicate.html">https://doc.rust-lang.org/nightly/nightly-rustc/rustc_hir/hir/struct.WhereBoundPredicate.html</a></p>



<a name="278484657"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/147480-t-compiler/wg-diagnostics/topic/Is%20it%20possible%20to%20find%20%60%3A%60%20after%20a%20generic%20param%3F/near/278484657" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Goulet (compiler-errors) <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/topic/Is.20it.20possible.20to.20find.20.60.3A.60.20after.20a.20generic.20param.3F.html#278484657">(Apr 10 2022 at 19:12)</a>:</h4>
<p>If it bounds slice is empty then it corresponds to <code>where Ty:</code></p>



<a name="278484664"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/147480-t-compiler/wg-diagnostics/topic/Is%20it%20possible%20to%20find%20%60%3A%60%20after%20a%20generic%20param%3F/near/278484664" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Goulet (compiler-errors) <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/topic/Is.20it.20possible.20to.20find.20.60.3A.60.20after.20a.20generic.20param.3F.html#278484664">(Apr 10 2022 at 19:12)</a>:</h4>
<p>which (at least I'm 30% sure) is what <code>&lt;T:&gt;</code> desugars into --&gt; <code>&lt;T&gt; .. where T:</code></p>



<a name="278484698"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/147480-t-compiler/wg-diagnostics/topic/Is%20it%20possible%20to%20find%20%60%3A%60%20after%20a%20generic%20param%3F/near/278484698" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Goulet (compiler-errors) <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/topic/Is.20it.20possible.20to.20find.20.60.3A.60.20after.20a.20generic.20param.3F.html#278484698">(Apr 10 2022 at 19:13)</a>:</h4>
<p><code>WhereBoundPredicate</code> even has <code>is_param_bound</code> to make that filtering for the <code>T</code> param even quicker :)</p>



<a name="278487810"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/147480-t-compiler/wg-diagnostics/topic/Is%20it%20possible%20to%20find%20%60%3A%60%20after%20a%20generic%20param%3F/near/278487810" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Waffle Lapkin <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/topic/Is.20it.20possible.20to.20find.20.60.3A.60.20after.20a.20generic.20param.3F.html#278487810">(Apr 10 2022 at 20:22)</a>:</h4>
<p><span class="user-mention silent" data-user-id="426609">Michael Goulet (compiler-errors)</span> <a href="#narrow/stream/147480-t-compiler.2Fwg-diagnostics/topic/Is.20it.20possible.20to.20find.20.60.3A.60.20after.20a.20generic.20param.3F/near/278484664">said</a>:</p>
<blockquote>
<p>which (at least I'm 30% sure) is what <code>&lt;T:&gt;</code> desugars into --&gt; <code>&lt;T&gt; .. where T:</code></p>
</blockquote>
<p>It doesn't seem to</p>
<p>This is what I've got:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">foo</span><span class="o">&lt;</span><span class="n">T</span>:<span class="o">&gt;</span><span class="p">(</span><span class="n">t</span>: <span class="nc">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Generics</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">params</span>: <span class="p">[</span><span class="n">GenericParam</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">hir_id</span>: <span class="nc">HirId</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">owner</span>: <span class="nc">DefId</span><span class="p">(</span><span class="mi">0</span>:<span class="mi">3</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="mi">92</span><span class="n">cd</span><span class="p">]</span>::<span class="n">foo</span><span class="p">),</span><span class="w"> </span><span class="n">local_id</span>: <span class="mi">11</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">name</span>: <span class="nc">Plain</span><span class="p">(</span><span class="n">T</span>#<span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="n">bounds</span>: <span class="p">[],</span><span class="w"> </span><span class="n">span</span>: <span class="p">.</span><span class="o">/</span><span class="n">t</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1</span>:<span class="mi">8</span>: <span class="mi">1</span>:<span class="mi">9</span><span class="w"> </span><span class="p">(</span>#<span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="n">pure_wrt_drop</span>: <span class="nc">false</span><span class="p">,</span><span class="w"> </span><span class="n">kind</span>: <span class="nc">Type</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">default</span>: <span class="nb">None</span><span class="p">,</span><span class="w"> </span><span class="n">synthetic</span>: <span class="nc">false</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}],</span><span class="w"> </span><span class="n">where_clause</span>: <span class="nc">WhereClause</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">predicates</span>: <span class="p">[],</span><span class="w"> </span><span class="n">span</span>: <span class="p">.</span><span class="o">/</span><span class="n">t</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1</span>:<span class="mi">17</span>: <span class="mi">1</span>:<span class="mi">17</span><span class="w"> </span><span class="p">(</span>#<span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">span</span>: <span class="p">.</span><span class="o">/</span><span class="n">t</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1</span>:<span class="mi">7</span>: <span class="mi">1</span>:<span class="mi">11</span><span class="w"> </span><span class="p">(</span>#<span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<blockquote>
<p>WhereClause { predicates: []</p>
</blockquote>



<a name="278488092"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/147480-t-compiler/wg-diagnostics/topic/Is%20it%20possible%20to%20find%20%60%3A%60%20after%20a%20generic%20param%3F/near/278488092" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Waffle Lapkin <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/topic/Is.20it.20possible.20to.20find.20.60.3A.60.20after.20a.20generic.20param.3F.html#278488092">(Apr 10 2022 at 20:29)</a>:</h4>
<p><span class="user-mention silent" data-user-id="119031">Esteban Küber</span> <a href="#narrow/stream/147480-t-compiler.2Fwg-diagnostics/topic/Is.20it.20possible.20to.20find.20.60.3A.60.20after.20a.20generic.20param.3F/near/278484285">said</a>:</p>
<blockquote>
<p>I think that there might be a difference on the span for the param and the name of the param, even though there's an empty bound</p>
</blockquote>
<p>(first is <code>&lt;T:&gt;</code> second is <code>&lt;T&gt;</code>)</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Generics</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">params</span>: <span class="p">[</span><span class="n">GenericParam</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">hir_id</span>: <span class="nc">HirId</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">owner</span>: <span class="nc">DefId</span><span class="p">(</span><span class="mi">0</span>:<span class="mi">3</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="mi">92</span><span class="n">cd</span><span class="p">]</span>::<span class="n">foo</span><span class="p">),</span><span class="w"> </span><span class="n">local_id</span>: <span class="mi">11</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">name</span>: <span class="nc">Plain</span><span class="p">(</span><span class="n">T</span>#<span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="n">bounds</span>: <span class="p">[],</span><span class="w"> </span><span class="n">span</span>: <span class="p">.</span><span class="o">/</span><span class="n">t</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1</span>:<span class="mi">8</span>: <span class="mi">1</span>:<span class="mi">9</span><span class="w"> </span><span class="p">(</span>#<span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="n">pure_wrt_drop</span>: <span class="nc">false</span><span class="p">,</span><span class="w"> </span><span class="n">kind</span>: <span class="nc">Type</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">default</span>: <span class="nb">None</span><span class="p">,</span><span class="w"> </span><span class="n">synthetic</span>: <span class="nc">false</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}],</span><span class="w"> </span><span class="n">where_clause</span>: <span class="nc">WhereClause</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">predicates</span>: <span class="p">[],</span><span class="w"> </span><span class="n">span</span>: <span class="p">.</span><span class="o">/</span><span class="n">t</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1</span>:<span class="mi">17</span>: <span class="mi">1</span>:<span class="mi">17</span><span class="w"> </span><span class="p">(</span>#<span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">span</span>: <span class="p">.</span><span class="o">/</span><span class="n">t</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1</span>:<span class="mi">7</span>: <span class="mi">1</span>:<span class="mi">11</span><span class="w"> </span><span class="p">(</span>#<span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="n">Generics</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">params</span>: <span class="p">[</span><span class="n">GenericParam</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">hir_id</span>: <span class="nc">HirId</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">owner</span>: <span class="nc">DefId</span><span class="p">(</span><span class="mi">0</span>:<span class="mi">3</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="mi">92</span><span class="n">cd</span><span class="p">]</span>::<span class="n">foo</span><span class="p">),</span><span class="w"> </span><span class="n">local_id</span>: <span class="mi">11</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">name</span>: <span class="nc">Plain</span><span class="p">(</span><span class="n">T</span>#<span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="n">bounds</span>: <span class="p">[],</span><span class="w"> </span><span class="n">span</span>: <span class="p">.</span><span class="o">/</span><span class="n">t</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1</span>:<span class="mi">8</span>: <span class="mi">1</span>:<span class="mi">9</span><span class="w"> </span><span class="p">(</span>#<span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="n">pure_wrt_drop</span>: <span class="nc">false</span><span class="p">,</span><span class="w"> </span><span class="n">kind</span>: <span class="nc">Type</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">default</span>: <span class="nb">None</span><span class="p">,</span><span class="w"> </span><span class="n">synthetic</span>: <span class="nc">false</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}],</span><span class="w"> </span><span class="n">where_clause</span>: <span class="nc">WhereClause</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">predicates</span>: <span class="p">[],</span><span class="w"> </span><span class="n">span</span>: <span class="p">.</span><span class="o">/</span><span class="n">t</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1</span>:<span class="mi">16</span>: <span class="mi">1</span>:<span class="mi">16</span><span class="w"> </span><span class="p">(</span>#<span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">span</span>: <span class="p">.</span><span class="o">/</span><span class="n">t</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1</span>:<span class="mi">7</span>: <span class="mi">1</span>:<span class="mi">10</span><span class="w"> </span><span class="p">(</span>#<span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>As far as I see the only difference that I can spot is that <code>Generics</code> have different span (because it is either <code>&lt;T:&gt;</code> or <code>&lt;T&gt;</code>) and <code>WhereClause</code> has different span (because it points after <code>)</code> that is after the generics)</p>



<a name="278488664"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/147480-t-compiler/wg-diagnostics/topic/Is%20it%20possible%20to%20find%20%60%3A%60%20after%20a%20generic%20param%3F/near/278488664" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Waffle Lapkin <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/topic/Is.20it.20possible.20to.20find.20.60.3A.60.20after.20a.20generic.20param.3F.html#278488664">(Apr 10 2022 at 20:42)</a>:</h4>
<p>Huh, it seems like <code>:</code> is not included in any spans ever. This is <code>hit::Generics</code> for the following function:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">foo</span><span class="o">&lt;</span><span class="n">T</span>:<span class="nb">Clone</span><span class="o">&gt;</span><span class="p">(</span><span class="n">t</span>: <span class="nc">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="p">[</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">];</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<div class="codehilite" data-code-language="Text only"><pre><span></span><code>Generics {
  params: [
     GenericParam {
       hir_id: HirId { owner: DefId(0:3 ~ t[92cd]::foo), local_id: 13 },
       name: Plain(T#0),
       bounds: [
         Trait(PolyTraitRef {
           bound_generic_params: [],
           trait_ref: TraitRef {
             path: Path {
               span: ./t.rs:1:10: 1:15 (#0),
               res: Def(Trait, DefId(2:2685 ~ core[501d]::clone::Clone)),
               segments: [PathSegment { ident: Clone#0, hir_id: Some(HirId { owner: DefId(0:3 ~ t[92cd]::foo), local_id: 11 }), res: Some(Def(Trait, DefId(2:2685 ~ core[501d]::clone::Clone))), args: None, infer_args: false }]
              },
             hir_ref_id: HirId { owner: DefId(0:3 ~ t[92cd]::foo), local_id: 12 }
           },
           span: ./t.rs:1:10: 1:15 (#0)
         }, None)
       ],
       span: ./t.rs:1:8: 1:9 (#0),
       pure_wrt_drop: false,
       kind: Type { default: None, synthetic: false }
     }
  ],
  where_clause: WhereClause { predicates: [], span: ./t.rs:1:22: 1:22 (#0) }, span: ./t.rs:1:7: 1:16 (#0)
}
</code></pre></div>
<p>The <code>:</code> should be in <code>1:9 1:10</code></p>



<a name="278488680"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/147480-t-compiler/wg-diagnostics/topic/Is%20it%20possible%20to%20find%20%60%3A%60%20after%20a%20generic%20param%3F/near/278488680" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Waffle Lapkin <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/topic/Is.20it.20possible.20to.20find.20.60.3A.60.20after.20a.20generic.20param.3F.html#278488680">(Apr 10 2022 at 20:43)</a>:</h4>
<p>(btw it's such a pain to format debug output uhhh)</p>



<a name="278488780"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/147480-t-compiler/wg-diagnostics/topic/Is%20it%20possible%20to%20find%20%60%3A%60%20after%20a%20generic%20param%3F/near/278488780" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Waffle Lapkin <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/topic/Is.20it.20possible.20to.20find.20.60.3A.60.20after.20a.20generic.20param.3F.html#278488780">(Apr 10 2022 at 20:45)</a>:</h4>
<p>I'm not really sure what exactly to change here, to allow for <code>:</code> detection</p>



<a name="278489538"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/147480-t-compiler/wg-diagnostics/topic/Is%20it%20possible%20to%20find%20%60%3A%60%20after%20a%20generic%20param%3F/near/278489538" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Goulet (compiler-errors) <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/topic/Is.20it.20possible.20to.20find.20.60.3A.60.20after.20a.20generic.20param.3F.html#278489538">(Apr 10 2022 at 21:00)</a>:</h4>
<p><span class="user-mention silent" data-user-id="273349">Waffle Lapkin</span> <a href="#narrow/stream/147480-t-compiler.2Fwg-diagnostics/topic/Is.20it.20possible.20to.20find.20.60.3A.60.20after.20a.20generic.20param.3F/near/278488680">said</a>:</p>
<blockquote>
<p>(btw it's such a pain to format debug output uhhh)</p>
</blockquote>
<p>(I usually use <code>:#?</code>, does that work?)</p>



<a name="278489557"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/147480-t-compiler/wg-diagnostics/topic/Is%20it%20possible%20to%20find%20%60%3A%60%20after%20a%20generic%20param%3F/near/278489557" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Goulet (compiler-errors) <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/topic/Is.20it.20possible.20to.20find.20.60.3A.60.20after.20a.20generic.20param.3F.html#278489557">(Apr 10 2022 at 21:01)</a>:</h4>
<p>Possibly use <code>https://doc.rust-lang.org/nightly/nightly-rustc/rustc_span/source_map/struct.SourceMap.html#method.next_point</code> on the span of the generic?</p>



<a name="278489569"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/147480-t-compiler/wg-diagnostics/topic/Is%20it%20possible%20to%20find%20%60%3A%60%20after%20a%20generic%20param%3F/near/278489569" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Goulet (compiler-errors) <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/topic/Is.20it.20possible.20to.20find.20.60.3A.60.20after.20a.20generic.20param.3F.html#278489569">(Apr 10 2022 at 21:01)</a>:</h4>
<p>just curious, what are you trying to do this for? Knowing when to add <code>: Bound</code>?</p>



<a name="278490021"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/147480-t-compiler/wg-diagnostics/topic/Is%20it%20possible%20to%20find%20%60%3A%60%20after%20a%20generic%20param%3F/near/278490021" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Goulet (compiler-errors) <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/topic/Is.20it.20possible.20to.20find.20.60.3A.60.20after.20a.20generic.20param.3F.html#278490021">(Apr 10 2022 at 21:12)</a>:</h4>
<p>(also filed <a href="https://github.com/rust-lang/rust/issues/95898">#95898</a> because we treat <code>T:</code> incorrectly in other places, hehe)</p>



<a name="278571759"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/147480-t-compiler/wg-diagnostics/topic/Is%20it%20possible%20to%20find%20%60%3A%60%20after%20a%20generic%20param%3F/near/278571759" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Waffle Lapkin <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/topic/Is.20it.20possible.20to.20find.20.60.3A.60.20after.20a.20generic.20param.3F.html#278571759">(Apr 11 2022 at 15:31)</a>:</h4>
<p><span class="user-mention silent" data-user-id="426609">Michael Goulet (compiler-errors)</span> <a href="#narrow/stream/147480-t-compiler.2Fwg-diagnostics/topic/Is.20it.20possible.20to.20find.20.60.3A.60.20after.20a.20generic.20param.3F/near/278489569">said</a>:</p>
<blockquote>
<p>just curious, what are you trying to do this for? Knowing when to add <code>: Bound</code>?</p>
</blockquote>
<p>Yep. We currently do weird stuff like suggesting</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">f</span><span class="o">&lt;</span><span class="n">T</span>: <span class="nb">Copy</span>:<span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">g</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">T</span>: <span class="o">+</span><span class="w"> </span><span class="nb">Copy</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
</code></pre></div>



<a name="278571926"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/147480-t-compiler/wg-diagnostics/topic/Is%20it%20possible%20to%20find%20%60%3A%60%20after%20a%20generic%20param%3F/near/278571926" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Waffle Lapkin <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/topic/Is.20it.20possible.20to.20find.20.60.3A.60.20after.20a.20generic.20param.3F.html#278571926">(Apr 11 2022 at 15:32)</a>:</h4>
<p>The <code>g</code> case I've fixed but the <code>f</code> case is a little bit more tricky</p>



<a name="278583054"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/147480-t-compiler/wg-diagnostics/topic/Is%20it%20possible%20to%20find%20%60%3A%60%20after%20a%20generic%20param%3F/near/278583054" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Waffle Lapkin <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/topic/Is.20it.20possible.20to.20find.20.60.3A.60.20after.20a.20generic.20param.3F.html#278583054">(Apr 11 2022 at 16:50)</a>:</h4>
<p><span class="user-mention silent" data-user-id="426609">Michael Goulet (compiler-errors)</span> <a href="#narrow/stream/147480-t-compiler.2Fwg-diagnostics/topic/Is.20it.20possible.20to.20find.20.60.3A.60.20after.20a.20generic.20param.3F/near/278489538">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="273349">Waffle Lapkin</span> <a href="#narrow/stream/147480-t-compiler.2Fwg-diagnostics/topic/Is.20it.20possible.20to.20find.20.60.3A.60.20after.20a.20generic.20param.3F/near/278488680">said</a>:</p>
<blockquote>
<p>(btw it's such a pain to format debug output uhhh)</p>
</blockquote>
<p>(I usually use <code>:#?</code>, does that work?)</p>
</blockquote>
<p>(it does, but for this I need to recompile everything :") )</p>



<a name="278648800"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/147480-t-compiler/wg-diagnostics/topic/Is%20it%20possible%20to%20find%20%60%3A%60%20after%20a%20generic%20param%3F/near/278648800" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Waffle Lapkin <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/topic/Is.20it.20possible.20to.20find.20.60.3A.60.20after.20a.20generic.20param.3F.html#278648800">(Apr 12 2022 at 05:05)</a>:</h4>
<p><span class="user-mention silent" data-user-id="426609">Michael Goulet (compiler-errors)</span> <a href="#narrow/stream/147480-t-compiler.2Fwg-diagnostics/topic/Is.20it.20possible.20to.20find.20.60.3A.60.20after.20a.20generic.20param.3F/near/278489557">said</a>:</p>
<blockquote>
<p>Possibly use <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_span/source_map/struct.SourceMap.html#method.next_point"><code>SourceMap::next_point</code></a> on the span of the generic?</p>
</blockquote>
<p>Am I missing something or is it broken? <a href="/user_uploads/4715/j9ybkyQuIhA6yWD5shxgQiDI/2022-04-12_09-03.png">2022-04-12_09-03.png</a> <code>next_point</code> calls <code>find_width_of_character_at_span</code> with an empty span, in which case <code>find_width_of_character_at_span</code> always returns 1</p>
<div class="message_inline_image"><a href="/user_uploads/4715/j9ybkyQuIhA6yWD5shxgQiDI/2022-04-12_09-03.png" title="2022-04-12_09-03.png"><img src="/user_uploads/4715/j9ybkyQuIhA6yWD5shxgQiDI/2022-04-12_09-03.png"></a></div>



<a name="278649568"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/147480-t-compiler/wg-diagnostics/topic/Is%20it%20possible%20to%20find%20%60%3A%60%20after%20a%20generic%20param%3F/near/278649568" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Waffle Lapkin <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/topic/Is.20it.20possible.20to.20find.20.60.3A.60.20after.20a.20generic.20param.3F.html#278649568">(Apr 12 2022 at 05:23)</a>:</h4>
<p>My hacky solution currently looks like this:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">colon_sp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">source_map</span><span class="p">.</span><span class="n">span_extend_while</span><span class="p">(</span><span class="n">param</span><span class="p">.</span><span class="n">span</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">c</span><span class="o">|</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="sc">','</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="sc">'&gt;'</span><span class="p">).</span><span class="n">ok</span><span class="p">();</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">colon_text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">colon_sp</span><span class="p">.</span><span class="n">and_then</span><span class="p">(</span><span class="o">|</span><span class="n">sp</span><span class="o">|</span><span class="w"> </span><span class="n">source_map</span><span class="p">.</span><span class="n">span_to_snippet</span><span class="p">(</span><span class="n">sp</span><span class="p">).</span><span class="n">ok</span><span class="p">());</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">suggest_colon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">colon_text</span><span class="p">.</span><span class="n">as_deref</span><span class="p">().</span><span class="n">map</span><span class="p">(</span><span class="o">|</span><span class="n">text</span><span class="o">|</span><span class="w"> </span><span class="o">!</span><span class="n">text</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="sc">':'</span><span class="p">)).</span><span class="n">unwrap_or</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w"></span>
</code></pre></div>



<a name="278656118"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/147480-t-compiler/wg-diagnostics/topic/Is%20it%20possible%20to%20find%20%60%3A%60%20after%20a%20generic%20param%3F/near/278656118" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Waffle Lapkin <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/topic/Is.20it.20possible.20to.20find.20.60.3A.60.20after.20a.20generic.20param.3F.html#278656118">(Apr 12 2022 at 07:16)</a>:</h4>
<p>In the end I come up with the following:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="c1">// hir::GenericParam&lt;'_&gt;</span>
<span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">colon_span_for_suggestions</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">source_map</span>: <span class="kp">&amp;</span><span class="nc">SourceMap</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Option</span><span class="o">&lt;</span><span class="n">Span</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">source_map</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">span_extend_while</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">span</span><span class="p">.</span><span class="n">shrink_to_hi</span><span class="p">(),</span><span class="w"> </span><span class="o">|</span><span class="n">c</span><span class="o">|</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">is_whitespace</span><span class="p">()</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">':'</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">ok</span><span class="p">()</span><span class="o">?</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">snippet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">source_map</span><span class="p">.</span><span class="n">span_to_snippet</span><span class="p">(</span><span class="n">sp</span><span class="p">).</span><span class="n">ok</span><span class="p">()</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">offset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">snippet</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="sc">':'</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">colon_sp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sp</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">with_lo</span><span class="p">(</span><span class="n">BytePos</span><span class="p">(</span><span class="n">sp</span><span class="p">.</span><span class="n">lo</span><span class="p">().</span><span class="mi">0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">offset</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">u32</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">with_hi</span><span class="p">(</span><span class="n">BytePos</span><span class="p">(</span><span class="n">sp</span><span class="p">.</span><span class="n">lo</span><span class="p">().</span><span class="mi">0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">offset</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="sc">':'</span><span class="p">.</span><span class="n">len_utf8</span><span class="p">())</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">u32</span><span class="p">));</span><span class="w"></span>

<span class="w">    </span><span class="nb">Some</span><span class="p">(</span><span class="n">colon_sp</span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="278668256"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/147480-t-compiler/wg-diagnostics/topic/Is%20it%20possible%20to%20find%20%60%3A%60%20after%20a%20generic%20param%3F/near/278668256" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Waffle Lapkin <a href="https://zulip-archive.rust-lang.org/stream/147480-t-compiler/wg-diagnostics/topic/Is.20it.20possible.20to.20find.20.60.3A.60.20after.20a.20generic.20param.3F.html#278668256">(Apr 12 2022 at 09:29)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/pull/95970">https://github.com/rust-lang/rust/pull/95970</a></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>