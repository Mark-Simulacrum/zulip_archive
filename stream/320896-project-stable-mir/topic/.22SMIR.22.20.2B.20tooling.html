<html>
<head><meta charset="utf-8"><title>&quot;SMIR&quot; + tooling · project-stable-mir · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/320896-project-stable-mir/index.html">project-stable-mir</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/320896-project-stable-mir/topic/.22SMIR.22.20.2B.20tooling.html">&quot;SMIR&quot; + tooling</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="278559351"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/320896-project-stable-mir/topic/%22SMIR%22%20%2B%20tooling/near/278559351" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/320896-project-stable-mir/topic/.22SMIR.22.20.2B.20tooling.html#278559351">(Apr 11 2022 at 14:13)</a>:</h4>
<p>First off, I demand that we call stable MIR "SMIR" (pronounced "smear").</p>



<a name="278572032"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/320896-project-stable-mir/topic/%22SMIR%22%20%2B%20tooling/near/278572032" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/320896-project-stable-mir/topic/.22SMIR.22.20.2B.20tooling.html#278572032">(Apr 11 2022 at 15:33)</a>:</h4>
<p>But also--- we talked a fair about about how SMIR + verification tooling could fit together</p>



<a name="278572097"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/320896-project-stable-mir/topic/%22SMIR%22%20%2B%20tooling/near/278572097" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/320896-project-stable-mir/topic/.22SMIR.22.20.2B.20tooling.html#278572097">(Apr 11 2022 at 15:34)</a>:</h4>
<p>and also the "division of responsibilities" between the core compiler team and the tool maintainers</p>



<a name="278572154"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/320896-project-stable-mir/topic/%22SMIR%22%20%2B%20tooling/near/278572154" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/320896-project-stable-mir/topic/.22SMIR.22.20.2B.20tooling.html#278572154">(Apr 11 2022 at 15:34)</a>:</h4>
<p>our idea was basically that it makes sense to have a lib, I'm calling it tool-lib for now but it needs a snazzier name, that contains common code and provides a nicer interface to SMIR and the compiler</p>



<a name="278572184"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/320896-project-stable-mir/topic/%22SMIR%22%20%2B%20tooling/near/278572184" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/320896-project-stable-mir/topic/.22SMIR.22.20.2B.20tooling.html#278572184">(Apr 11 2022 at 15:34)</a>:</h4>
<p>so the core compiler team would (mostly) maintain the translation from MIR to SMIR</p>



<a name="278572196"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/320896-project-stable-mir/topic/%22SMIR%22%20%2B%20tooling/near/278572196" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/320896-project-stable-mir/topic/.22SMIR.22.20.2B.20tooling.html#278572196">(Apr 11 2022 at 15:34)</a>:</h4>
<p>but there'd be a sepaarate subteam maintaining this tools-lib</p>



<a name="278572221"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/320896-project-stable-mir/topic/%22SMIR%22%20%2B%20tooling/near/278572221" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/320896-project-stable-mir/topic/.22SMIR.22.20.2B.20tooling.html#278572221">(Apr 11 2022 at 15:35)</a>:</h4>
<p>(and perhaps managing some of the trickier transitions)</p>



<a name="278610565"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/320896-project-stable-mir/topic/%22SMIR%22%20%2B%20tooling/near/278610565" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vytautas Astrauskas [he/him] <a href="https://zulip-archive.rust-lang.org/stream/320896-project-stable-mir/topic/.22SMIR.22.20.2B.20tooling.html#278610565">(Apr 11 2022 at 20:17)</a>:</h4>
<p>I tried to summarize the idea in a HackMD document: <a href="https://hackmd.io/jhtHKTXpRJ-D2WH7alJITw?view">https://hackmd.io/jhtHKTXpRJ-D2WH7alJITw?view</a></p>



<a name="278610688"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/320896-project-stable-mir/topic/%22SMIR%22%20%2B%20tooling/near/278610688" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vytautas Astrauskas [he/him] <a href="https://zulip-archive.rust-lang.org/stream/320896-project-stable-mir/topic/.22SMIR.22.20.2B.20tooling.html#278610688">(Apr 11 2022 at 20:18)</a>:</h4>
<p><span class="user-mention" data-user-id="312719">@Xavier Denis</span> <span class="user-mention" data-user-id="116852">@Andrea Lattuada</span> Could you please double-check that I did not write nonsense and that I did not forget anything?</p>



<a name="278622488"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/320896-project-stable-mir/topic/%22SMIR%22%20%2B%20tooling/near/278622488" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Xavier Denis <a href="https://zulip-archive.rust-lang.org/stream/320896-project-stable-mir/topic/.22SMIR.22.20.2B.20tooling.html#278622488">(Apr 11 2022 at 21:57)</a>:</h4>
<p>It seems good and complete to me</p>



<a name="278622569"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/320896-project-stable-mir/topic/%22SMIR%22%20%2B%20tooling/near/278622569" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Xavier Denis <a href="https://zulip-archive.rust-lang.org/stream/320896-project-stable-mir/topic/.22SMIR.22.20.2B.20tooling.html#278622569">(Apr 11 2022 at 21:58)</a>:</h4>
<p>The only nit I would make is that in your diagram borrowck etc should be above tool lib and have arrows into and out of the compiler box</p>



<a name="278628689"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/320896-project-stable-mir/topic/%22SMIR%22%20%2B%20tooling/near/278628689" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Celina V. <a href="https://zulip-archive.rust-lang.org/stream/320896-project-stable-mir/topic/.22SMIR.22.20.2B.20tooling.html#278628689">(Apr 11 2022 at 23:06)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116109">Vytautas Astrauskas [he/him]</span> <a href="#narrow/stream/320896-project-stable-mir/topic/.22SMIR.22.20.2B.20tooling/near/278610565">said</a>:</p>
<blockquote>
<p>I tried to summarize the idea in a HackMD document: <a href="https://hackmd.io/jhtHKTXpRJ-D2WH7alJITw?view">https://hackmd.io/jhtHKTXpRJ-D2WH7alJITw?view</a></p>
</blockquote>
<p>That's awesome! Thanks for capturing this. I added a few comments to the document.</p>



<a name="278670980"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/320896-project-stable-mir/topic/%22SMIR%22%20%2B%20tooling/near/278670980" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vytautas Astrauskas [he/him] <a href="https://zulip-archive.rust-lang.org/stream/320896-project-stable-mir/topic/.22SMIR.22.20.2B.20tooling.html#278670980">(Apr 12 2022 at 09:57)</a>:</h4>
<p><span class="user-mention silent" data-user-id="312719">Xavier Denis</span> <a href="#narrow/stream/320896-project-stable-mir/topic/.22SMIR.22.20.2B.20tooling/near/278622569">said</a>:</p>
<blockquote>
<p>The only nit I would make is that in your diagram borrowck etc should be above tool lib and have arrows into and out of the compiler box</p>
</blockquote>
<p>Do you mean that borrowck should be part of the compiler?</p>



<a name="278686241"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/320896-project-stable-mir/topic/%22SMIR%22%20%2B%20tooling/near/278686241" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/320896-project-stable-mir/topic/.22SMIR.22.20.2B.20tooling.html#278686241">(Apr 12 2022 at 12:39)</a>:</h4>
<p>borrowck is definitely part of the compiler</p>



<a name="278686459"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/320896-project-stable-mir/topic/%22SMIR%22%20%2B%20tooling/near/278686459" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/320896-project-stable-mir/topic/.22SMIR.22.20.2B.20tooling.html#278686459">(Apr 12 2022 at 12:40)</a>:</h4>
<p>One of the open questions is about how to handle the different use cases here: Some people are going to want to produce SMIR <em>without</em> performing borrowck on it, and hand it off to the compiler to do the dirty work of lifetime inference and borrowck. But, most of our initial group of users, we expect, are going to want SMIR to, at least potentially, <em>carry</em> the borrowck info so that they can reference it in their own analyses.</p>



<a name="278686547"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/320896-project-stable-mir/topic/%22SMIR%22%20%2B%20tooling/near/278686547" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/320896-project-stable-mir/topic/.22SMIR.22.20.2B.20tooling.html#278686547">(Apr 12 2022 at 12:41)</a>:</h4>
<p>So the implication is that, in the long term, you will have some people producing SMIR and feeding it into the compiler to be borrowck'ed. But most other people will be consuming SMIR that comes out of the compiler, with borrowck info attached.</p>



<a name="278686579"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/320896-project-stable-mir/topic/%22SMIR%22%20%2B%20tooling/near/278686579" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/320896-project-stable-mir/topic/.22SMIR.22.20.2B.20tooling.html#278686579">(Apr 12 2022 at 12:41)</a>:</h4>
<p>That's probably why <span class="user-mention" data-user-id="312719">@Xavier Denis</span> was saying that there should be arrows into and out of the compiler box</p>



<a name="278703255"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/320896-project-stable-mir/topic/%22SMIR%22%20%2B%20tooling/near/278703255" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Xavier Denis <a href="https://zulip-archive.rust-lang.org/stream/320896-project-stable-mir/topic/.22SMIR.22.20.2B.20tooling.html#278703255">(Apr 12 2022 at 14:47)</a>:</h4>
<p>indeed</p>



<a name="278703309"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/320896-project-stable-mir/topic/%22SMIR%22%20%2B%20tooling/near/278703309" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Xavier Denis <a href="https://zulip-archive.rust-lang.org/stream/320896-project-stable-mir/topic/.22SMIR.22.20.2B.20tooling.html#278703309">(Apr 12 2022 at 14:48)</a>:</h4>
<p>and another point: this diagram is implying that the librarified borrowck can run on both the internal rep of the compiler and SMIR</p>



<a name="278703392"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/320896-project-stable-mir/topic/%22SMIR%22%20%2B%20tooling/near/278703392" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Xavier Denis <a href="https://zulip-archive.rust-lang.org/stream/320896-project-stable-mir/topic/.22SMIR.22.20.2B.20tooling.html#278703392">(Apr 12 2022 at 14:48)</a>:</h4>
<p>which is a strong claim to make</p>



<a name="278703589"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/320896-project-stable-mir/topic/%22SMIR%22%20%2B%20tooling/near/278703589" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/320896-project-stable-mir/topic/.22SMIR.22.20.2B.20tooling.html#278703589">(Apr 12 2022 at 14:50)</a>:</h4>
<p>What we should have is probably just arrows connecting borrowck and internal MIR, at least for now. Maybe at some point in the future there will be a borrowck that operates on SMIR, but I don't think anyone is looking to invest in that in the short term.</p>



<a name="278709244"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/320896-project-stable-mir/topic/%22SMIR%22%20%2B%20tooling/near/278709244" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Xavier Denis <a href="https://zulip-archive.rust-lang.org/stream/320896-project-stable-mir/topic/.22SMIR.22.20.2B.20tooling.html#278709244">(Apr 12 2022 at 15:26)</a>:</h4>
<p>exactly, that's what I would expect</p>



<a name="278709306"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/320896-project-stable-mir/topic/%22SMIR%22%20%2B%20tooling/near/278709306" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Xavier Denis <a href="https://zulip-archive.rust-lang.org/stream/320896-project-stable-mir/topic/.22SMIR.22.20.2B.20tooling.html#278709306">(Apr 12 2022 at 15:26)</a>:</h4>
<p>however, I would also expect that that information is embedded in the syntax of SMIR for tools like prusti to use it</p>



<a name="278709364"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/320896-project-stable-mir/topic/%22SMIR%22%20%2B%20tooling/near/278709364" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Xavier Denis <a href="https://zulip-archive.rust-lang.org/stream/320896-project-stable-mir/topic/.22SMIR.22.20.2B.20tooling.html#278709364">(Apr 12 2022 at 15:26)</a>:</h4>
<p>incidentally: this means that SMIR should include a separate dataflow system as I think that liveness / initialization / points-to are common and shared analyses</p>



<a name="278709379"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/320896-project-stable-mir/topic/%22SMIR%22%20%2B%20tooling/near/278709379" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Xavier Denis <a href="https://zulip-archive.rust-lang.org/stream/320896-project-stable-mir/topic/.22SMIR.22.20.2B.20tooling.html#278709379">(Apr 12 2022 at 15:27)</a>:</h4>
<p>cc <span class="user-mention" data-user-id="265377">@Will Crichton</span></p>



<a name="278712728"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/320896-project-stable-mir/topic/%22SMIR%22%20%2B%20tooling/near/278712728" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vytautas Astrauskas [he/him] <a href="https://zulip-archive.rust-lang.org/stream/320896-project-stable-mir/topic/.22SMIR.22.20.2B.20tooling.html#278712728">(Apr 12 2022 at 15:53)</a>:</h4>
<p><span class="user-mention silent" data-user-id="312719">Xavier Denis</span> <a href="#narrow/stream/320896-project-stable-mir/topic/.22SMIR.22.20.2B.20tooling/near/278703309">said</a>:</p>
<blockquote>
<p>and another point: this diagram is implying that the librarified borrowck can run on both the internal rep of the compiler and SMIR</p>
</blockquote>
<p>But you do need this to be the case for trait checking, or do I misunderstand something?</p>



<a name="278716620"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/320896-project-stable-mir/topic/%22SMIR%22%20%2B%20tooling/near/278716620" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Xavier Denis <a href="https://zulip-archive.rust-lang.org/stream/320896-project-stable-mir/topic/.22SMIR.22.20.2B.20tooling.html#278716620">(Apr 12 2022 at 16:22)</a>:</h4>
<p>Well depends how opaque Smir is</p>



<a name="278716711"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/320896-project-stable-mir/topic/%22SMIR%22%20%2B%20tooling/near/278716711" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Xavier Denis <a href="https://zulip-archive.rust-lang.org/stream/320896-project-stable-mir/topic/.22SMIR.22.20.2B.20tooling.html#278716711">(Apr 12 2022 at 16:22)</a>:</h4>
<p>It’s true that until this is the case I cannot realistically consider using it</p>



<a name="278716747"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/320896-project-stable-mir/topic/%22SMIR%22%20%2B%20tooling/near/278716747" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Xavier Denis <a href="https://zulip-archive.rust-lang.org/stream/320896-project-stable-mir/topic/.22SMIR.22.20.2B.20tooling.html#278716747">(Apr 12 2022 at 16:22)</a>:</h4>
<p>But chalk is further along librarification than borrowck is</p>



<a name="278716774"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/320896-project-stable-mir/topic/%22SMIR%22%20%2B%20tooling/near/278716774" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Xavier Denis <a href="https://zulip-archive.rust-lang.org/stream/320896-project-stable-mir/topic/.22SMIR.22.20.2B.20tooling.html#278716774">(Apr 12 2022 at 16:23)</a>:</h4>
<p>So that might be a more realistic goal in the medium term</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>