<html>
<head><meta charset="utf-8"><title>clippy useless_format fails on format arg capture · clippy · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/index.html">clippy</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/clippy.20useless_format.20fails.20on.20format.20arg.20capture.html">clippy useless_format fails on format arg capture</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="268123576"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/clippy%20useless_format%20fails%20on%20format%20arg%20capture/near/268123576" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matthiaskrgr <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/clippy.20useless_format.20fails.20on.20format.20arg.20capture.html#268123576">(Jan 15 2022 at 12:32)</a>:</h4>
<p>So rust 1.58 (current stable)  introduced format arg capture like</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"hello"</span><span class="p">;</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">format!</span><span class="p">(</span><span class="s">"{x}"</span><span class="p">);</span><span class="w"></span>
</code></pre></div>
<p>but clippys <code>useless_format</code> lint totally does not take this into account and suggests something like<br>
<code>{x}.to_string()</code>.</p>
<p>It's kinda bad that we didn't have a test for this kind of stuff (we had like 2 releases to notice..? <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span> )<br>
I've added <code>P-high</code> to <a href="https://github.com/rust-lang/rust-clippy/issues/8290">https://github.com/rust-lang/rust-clippy/issues/8290</a><br>
Is a fix to this something that should be backported?<br>
I think there were was some backport for stable planned anyway?</p>
<p>I <em>think</em> have not seen any tickets about this yet (which means not a lot of people used fmt args capture on nightly/beta and run clippy...?) but now that it hit stable we might see some broader adoption...</p>



<a name="268123810"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/clippy%20useless_format%20fails%20on%20format%20arg%20capture/near/268123810" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> xFrednet <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/clippy.20useless_format.20fails.20on.20format.20arg.20capture.html#268123810">(Jan 15 2022 at 12:38)</a>:</h4>
<blockquote>
<p>I think there were was some backport for stable planned anyway?</p>
</blockquote>
<p>Yes for <a href="https://github.com/rust-lang/rust-clippy/issues/8045">clippy#8045</a> on next Thursday</p>
<blockquote>
<p>Is a fix to this something that should be backported?</p>
</blockquote>
<p>I think it depends in the impact. <span class="user-mention silent" data-user-id="121055">Pietro Albini</span> said that he prefers backporting the minimal set of changes to stable. Since nobody complained so far I think it would be enough to backport to beta.</p>



<a name="268124025"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/clippy%20useless_format%20fails%20on%20format%20arg%20capture/near/268124025" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matthiaskrgr <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/clippy.20useless_format.20fails.20on.20format.20arg.20capture.html#268124025">(Jan 15 2022 at 12:44)</a>:</h4>
<p>added the nomination label for the next clippy meeting or so :)</p>



<a name="268124027"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/clippy%20useless_format%20fails%20on%20format%20arg%20capture/near/268124027" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matthiaskrgr <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/clippy.20useless_format.20fails.20on.20format.20arg.20capture.html#268124027">(Jan 15 2022 at 12:44)</a>:</h4>
<p>(feel free to remove if we have an earlier conclusion :) )</p>



<a name="268124272"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/clippy%20useless_format%20fails%20on%20format%20arg%20capture/near/268124272" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> flip1995 <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/clippy.20useless_format.20fails.20on.20format.20arg.20capture.html#268124272">(Jan 15 2022 at 12:50)</a>:</h4>
<p>Even though we don't see any complains yet, I expected that with 1.59 at the latest more and more complains will come in. Next Clippy meeting is after the planned stable backport. If someone gets a fix for this in (that is small enough) we can ask if it can also be backported to stable. </p>
<p>Otherwise I would at least backport it to beta, which has a lower bar.</p>



<a name="268184517"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/clippy%20useless_format%20fails%20on%20format%20arg%20capture/near/268184517" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> xFrednet <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/clippy.20useless_format.20fails.20on.20format.20arg.20capture.html#268184517">(Jan 16 2022 at 13:31)</a>:</h4>
<p>This issue was fixed by <span class="user-mention silent" data-user-id="399480">Jason Newcomb</span> in <a href="https://github.com/rust-lang/rust-clippy/issues/8295">clippy#8295</a> (Bors tests are currently running)</p>



<a name="268184604"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/clippy%20useless_format%20fails%20on%20format%20arg%20capture/near/268184604" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> xFrednet <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/clippy.20useless_format.20fails.20on.20format.20arg.20capture.html#268184604">(Jan 16 2022 at 13:33)</a>:</h4>
<p>The fix is small enough that a backport to stable should be reasonable if we have a point version anyways <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span></p>



<a name="268254078"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/clippy%20useless_format%20fails%20on%20format%20arg%20capture/near/268254078" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> flip1995 <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/clippy.20useless_format.20fails.20on.20format.20arg.20capture.html#268254078">(Jan 17 2022 at 10:47)</a>:</h4>
<p>I opened an out-of-cycle sync <a href="https://github.com/rust-lang/rust/pull/93001">https://github.com/rust-lang/rust/pull/93001</a>. After that is merged I'll propose backporting <a href="https://github.com/rust-lang/rust/commit/cb384ff03b7a10bca10b962d9907c0d56ba3086f">https://github.com/rust-lang/rust/commit/cb384ff03b7a10bca10b962d9907c0d56ba3086f</a> to beta and stable.</p>



<a name="268257037"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/clippy%20useless_format%20fails%20on%20format%20arg%20capture/near/268257037" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> xFrednet <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/clippy.20useless_format.20fails.20on.20format.20arg.20capture.html#268257037">(Jan 17 2022 at 11:16)</a>:</h4>
<p>If you do a backport to beta could you also change the lint group of <code>return_self_not_must_use</code> to <code>pedantic</code>. This was discussed in <a href="#narrow/stream/257328-clippy/topic/Lint.20group.20for.20.60return_self_not_must_use.60/near/268075617">this Zulip stream</a> at least at first.</p>



<a name="268257198"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/clippy%20useless_format%20fails%20on%20format%20arg%20capture/near/268257198" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> flip1995 <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/clippy.20useless_format.20fails.20on.20format.20arg.20capture.html#268257198">(Jan 17 2022 at 11:18)</a>:</h4>
<p>Was this lint already moved to <code>pedantic</code> in the Clippy repo?</p>



<a name="268257252"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/clippy%20useless_format%20fails%20on%20format%20arg%20capture/near/268257252" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> flip1995 <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/clippy.20useless_format.20fails.20on.20format.20arg.20capture.html#268257252">(Jan 17 2022 at 11:19)</a>:</h4>
<p>Just answered this question myself: no</p>



<a name="268257277"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/clippy%20useless_format%20fails%20on%20format%20arg%20capture/near/268257277" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> flip1995 <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/clippy.20useless_format.20fails.20on.20format.20arg.20capture.html#268257277">(Jan 17 2022 at 11:19)</a>:</h4>
<p>We should do that first</p>



<a name="268257444"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/clippy%20useless_format%20fails%20on%20format%20arg%20capture/near/268257444" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> xFrednet <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/clippy.20useless_format.20fails.20on.20format.20arg.20capture.html#268257444">(Jan 17 2022 at 11:20)</a>:</h4>
<p>Nope, that was on my todo list, among other things <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="268257459"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/clippy%20useless_format%20fails%20on%20format%20arg%20capture/near/268257459" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> xFrednet <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/clippy.20useless_format.20fails.20on.20format.20arg.20capture.html#268257459">(Jan 17 2022 at 11:21)</a>:</h4>
<p>Should I create a quick PR?</p>



<a name="268257820"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/clippy%20useless_format%20fails%20on%20format%20arg%20capture/near/268257820" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> flip1995 <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/clippy.20useless_format.20fails.20on.20format.20arg.20capture.html#268257820">(Jan 17 2022 at 11:24)</a>:</h4>
<p>I can also quickly do that.</p>



<a name="268257851"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/clippy%20useless_format%20fails%20on%20format%20arg%20capture/near/268257851" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> xFrednet <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/clippy.20useless_format.20fails.20on.20format.20arg.20capture.html#268257851">(Jan 17 2022 at 11:24)</a>:</h4>
<p>My ui tests are already running xD</p>



<a name="268257901"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/clippy%20useless_format%20fails%20on%20format%20arg%20capture/near/268257901" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> flip1995 <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/clippy.20useless_format.20fails.20on.20format.20arg.20capture.html#268257901">(Jan 17 2022 at 11:25)</a>:</h4>
<p>Shouldn't you write on your bachelor thesis? <span aria-label="stuck out tongue closed eyes" class="emoji emoji-1f61d" role="img" title="stuck out tongue closed eyes">:stuck_out_tongue_closed_eyes:</span> Ok then, let me know once you have the PR ready <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="268258251"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/clippy%20useless_format%20fails%20on%20format%20arg%20capture/near/268258251" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> xFrednet <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/clippy.20useless_format.20fails.20on.20format.20arg.20capture.html#268258251">(Jan 17 2022 at 11:29)</a>:</h4>
<p>Maybe, actually definitely... After this I will <span aria-label="rolling on the floor laughing" class="emoji emoji-1f923" role="img" title="rolling on the floor laughing">:rolling_on_the_floor_laughing:</span></p>



<a name="268258544"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/clippy%20useless_format%20fails%20on%20format%20arg%20capture/near/268258544" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> xFrednet <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/clippy.20useless_format.20fails.20on.20format.20arg.20capture.html#268258544">(Jan 17 2022 at 11:32)</a>:</h4>
<p>Done <a href="https://github.com/rust-lang/rust-clippy/issues/8302">clippy#8302</a></p>



<a name="268258622"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/clippy%20useless_format%20fails%20on%20format%20arg%20capture/near/268258622" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> xFrednet <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/clippy.20useless_format.20fails.20on.20format.20arg.20capture.html#268258622">(Jan 17 2022 at 11:33)</a>:</h4>
<p>It took a second until I noticed that I've only added <code>#[warn(clippy::return_self_not_must_use)]</code> to the tests without the exclamation mark to make the attribute global <span aria-label="joy" class="emoji emoji-1f602" role="img" title="joy">:joy:</span></p>



<a name="268258692"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/clippy%20useless_format%20fails%20on%20format%20arg%20capture/near/268258692" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> xFrednet <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/clippy.20useless_format.20fails.20on.20format.20arg.20capture.html#268258692">(Jan 17 2022 at 11:34)</a>:</h4>
<p>And now I'm running out of excuses not to write on my thesis ^^</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>