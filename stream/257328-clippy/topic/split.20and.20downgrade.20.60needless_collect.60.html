<html>
<head><meta charset="utf-8"><title>split and downgrade `needless_collect` · clippy · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/index.html">clippy</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/split.20and.20downgrade.20.60needless_collect.60.html">split and downgrade `needless_collect`</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="263377664"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/split%20and%20downgrade%20%60needless_collect%60/near/263377664" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Takayuki Nakata <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/split.20and.20downgrade.20.60needless_collect.60.html#263377664">(Dec 02 2021 at 00:25)</a>:</h4>
<p>Many false positives have been reported for <code>needless_collect</code>, so I think it's time to downgrade it to nursery. But false positives have been reported for the indirect usage, not for the direct usage. So, IMO it would be better that <code>needless_collect</code> is split into two and the indirect usage is downgraded to nursery. What do you think?<br>
<a href="https://github.com/rust-lang/rust-clippy/issues/6420#issuecomment-984176013">https://github.com/rust-lang/rust-clippy/issues/6420#issuecomment-984176013</a></p>



<a name="263409679"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/split%20and%20downgrade%20%60needless_collect%60/near/263409679" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> flip1995 <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/split.20and.20downgrade.20.60needless_collect.60.html#263409679">(Dec 02 2021 at 09:11)</a>:</h4>
<p>Sounds reasonable. Lint name for the nursery one? <code>needless_indirect_collect</code>? <code>needless_delayed_collect</code>? </p>
<p>Another option would be adding a configuration.</p>



<a name="263438498"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/split%20and%20downgrade%20%60needless_collect%60/near/263438498" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Takayuki Nakata <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/split.20and.20downgrade.20.60needless_collect.60.html#263438498">(Dec 02 2021 at 13:44)</a>:</h4>
<p>I don't have a strong opinion for naming, but I like <code>needless_indirect_collect</code>.</p>



<a name="263438797"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/split%20and%20downgrade%20%60needless_collect%60/near/263438797" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dswijj <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/split.20and.20downgrade.20.60needless_collect.60.html#263438797">(Dec 02 2021 at 13:47)</a>:</h4>
<p><span class="user-mention silent" data-user-id="264664">flip1995</span> <a href="#narrow/stream/257328-clippy/topic/split.20and.20downgrade.20.60needless_collect.60/near/263409679">said</a>:</p>
<blockquote>
<p>Another option would be adding a configuration.</p>
</blockquote>
<p>I'm not so sure about adding a configuration to separate enabling  nursery and not-nursery for a lint. Seems like it's out of place here? <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="263497623"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/split%20and%20downgrade%20%60needless_collect%60/near/263497623" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> flip1995 <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/split.20and.20downgrade.20.60needless_collect.60.html#263497623">(Dec 02 2021 at 20:41)</a>:</h4>
<p>Not for the lint group. But that you can re-activate the behavior on linting indirect calls to <code>collect</code>.</p>



<a name="263502853"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/split%20and%20downgrade%20%60needless_collect%60/near/263502853" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> llogiq <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/split.20and.20downgrade.20.60needless_collect.60.html#263502853">(Dec 02 2021 at 21:29)</a>:</h4>
<p>So the configuration would default to linting only direct <code>collect</code>s. That has the benefit of removing most FPs without requiring yet another lint that will need to be maintained, documented, searched, etc. I like it.</p>



<a name="263503578"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/split%20and%20downgrade%20%60needless_collect%60/near/263503578" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matthiaskrgr <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/split.20and.20downgrade.20.60needless_collect.60.html#263503578">(Dec 02 2021 at 21:34)</a>:</h4>
<p>But the configuration is quite binary, you can either switch it off or on, right?<br>
If you have lints, you can switch them on/off on a crate/file/block/line basis, deny it here, allow it there. <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="263528796"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/split%20and%20downgrade%20%60needless_collect%60/near/263528796" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dswijj <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/split.20and.20downgrade.20.60needless_collect.60.html#263528796">(Dec 03 2021 at 02:31)</a>:</h4>
<p><span class="user-mention silent" data-user-id="217864">matthiaskrgr</span> <a href="#narrow/stream/257328-clippy/topic/split.20and.20downgrade.20.60needless_collect.60/near/263503578">said</a>:</p>
<blockquote>
<p>But the configuration is quite binary, you can either switch it off or on, right?<br>
If you have lints, you can switch them on/off on a crate/file/block/line basis, deny it here, allow it there. <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>
</blockquote>
<p>Yeah, this elaborates my concern well. Separating it into a new lint decouples it pretty nicely, while also allowing us to keep track of the work to improve the said lint.</p>



<a name="263666173"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/split%20and%20downgrade%20%60needless_collect%60/near/263666173" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/split.20and.20downgrade.20.60needless_collect.60.html#263666173">(Dec 03 2021 at 23:18)</a>:</h4>
<p>I'd just downgrade the whole thing. But that's just me.</p>



<a name="263666578"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/split%20and%20downgrade%20%60needless_collect%60/near/263666578" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/split.20and.20downgrade.20.60needless_collect.60.html#263666578">(Dec 03 2021 at 23:24)</a>:</h4>
<p>Or call the new lint <code>needless_collect_nursery</code> with the idea that we can always move some individual cases back to <code>needless_collect</code>. I just don't think the "indirect" distinction is very meaningful to the user.</p>



<a name="263671124"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/split%20and%20downgrade%20%60needless_collect%60/near/263671124" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/split.20and.20downgrade.20.60needless_collect.60.html#263671124">(Dec 04 2021 at 00:28)</a>:</h4>
<p>Rustc does this with <code>min_needless_collect</code> and <code>needless_collect</code>, maybe that would work here?</p>



<a name="263695746"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/split%20and%20downgrade%20%60needless_collect%60/near/263695746" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matthiaskrgr <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/split.20and.20downgrade.20.60needless_collect.60.html#263695746">(Dec 04 2021 at 09:39)</a>:</h4>
<p><code>needless_collect</code>, <code>maybe_not_so_needless_collect</code> <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span></p>



<a name="263796004"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/split%20and%20downgrade%20%60needless_collect%60/near/263796004" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Takayuki Nakata <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/split.20and.20downgrade.20.60needless_collect.60.html#263796004">(Dec 05 2021 at 23:45)</a>:</h4>
<p>Splitting the lint looks good, but naming is difficult...</p>



<a name="263796233"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/split%20and%20downgrade%20%60needless_collect%60/near/263796233" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Takayuki Nakata <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/split.20and.20downgrade.20.60needless_collect.60.html#263796233">(Dec 05 2021 at 23:50)</a>:</h4>
<p>I don't want to confuse users with inappropriate naming. If we can't come up with a good naming, I'm thinking of downgrading the whole lint <code>needless_collect</code>. It should be possible to split the lint later.</p>



<a name="263830004"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/split%20and%20downgrade%20%60needless_collect%60/near/263830004" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dirkjan Ochtman <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/split.20and.20downgrade.20.60needless_collect.60.html#263830004">(Dec 06 2021 at 10:20)</a>:</h4>
<p>Would be sad if the direct usage lint (with low FP rate) gets pushed out of the default set</p>



<a name="263830048"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/split%20and%20downgrade%20%60needless_collect%60/near/263830048" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dirkjan Ochtman <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/split.20and.20downgrade.20.60needless_collect.60.html#263830048">(Dec 06 2021 at 10:20)</a>:</h4>
<p>Especially if the only reason for doing so would be that we cannot come up with a name for the alternative?</p>



<a name="263830272"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/split%20and%20downgrade%20%60needless_collect%60/near/263830272" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dswijj <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/split.20and.20downgrade.20.60needless_collect.60.html#263830272">(Dec 06 2021 at 10:22)</a>:</h4>
<p>Yeah, a bad name would be better than pushing out the direct usage lint, imo.</p>



<a name="265506573"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/split%20and%20downgrade%20%60needless_collect%60/near/265506573" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/split.20and.20downgrade.20.60needless_collect.60.html#265506573">(Dec 19 2021 at 23:32)</a>:</h4>
<p>It makes sense for the buggy lint to have a less desirable name.</p>



<a name="266853230"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/split%20and%20downgrade%20%60needless_collect%60/near/266853230" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/split.20and.20downgrade.20.60needless_collect.60.html#266853230">(Jan 04 2022 at 19:40)</a>:</h4>
<p>This applies to <code>unnecessary_to_owned</code> too <a href="https://github.com/rust-lang/rust-clippy/issues/8148">rust-lang/rust-clippy#8148</a></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>