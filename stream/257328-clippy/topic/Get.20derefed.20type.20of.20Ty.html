<html>
<head><meta charset="utf-8"><title>Get derefed type of Ty · clippy · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/index.html">clippy</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/Get.20derefed.20type.20of.20Ty.html">Get derefed type of Ty</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="251390486"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/Get%20derefed%20type%20of%20Ty/near/251390486" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lengyijun <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/Get.20derefed.20type.20of.20Ty.html#251390486">(Aug 31 2021 at 14:06)</a>:</h4>
<p>Given a Ty, for example <code>&amp;String</code>, can we get the derefed type: <code>&amp;str</code> ?<br>
I didn't find similar lints in clippy.</p>



<a name="251391385"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/Get%20derefed%20type%20of%20Ty/near/251391385" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> xFrednet <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/Get.20derefed.20type.20of.20Ty.html#251391385">(Aug 31 2021 at 14:11)</a>:</h4>
<p>You can try using <a href="https://github.com/rust-lang/rust-clippy/blob/87c375fa625526d6ef93b12c0cf19ba3453a2ea5/clippy_utils/src/ty.rs#L118"><code>implements_trait</code></a> to check for the <code>Deref</code> trait. And than you could get associated trait types with something similar to <a href="https://github.com/rust-lang/rust-clippy/blob/87c375fa625526d6ef93b12c0cf19ba3453a2ea5/clippy_utils/src/ty.rs#L57-L72"><code>get_iterator_item_ty</code></a></p>



<a name="251391430"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/Get%20derefed%20type%20of%20Ty/near/251391430" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> xFrednet <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/Get.20derefed.20type.20of.20Ty.html#251391430">(Aug 31 2021 at 14:12)</a>:</h4>
<p>I'm not sure if there is a better way right now</p>



<a name="251883338"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/Get%20derefed%20type%20of%20Ty/near/251883338" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/Get.20derefed.20type.20of.20Ty.html#251883338">(Sep 03 2021 at 13:52)</a>:</h4>
<p>In addition, the way the compiler does this is with <code>rustc_trait_selection::autoderef::Autoderef</code>. I'm not sure if that is usable in Clippy. Note that if an expression <em>is already</em> being auto-dereferenced, then you can observe the details in <code>cx.typeck_results().expr_adjustments()</code>.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>