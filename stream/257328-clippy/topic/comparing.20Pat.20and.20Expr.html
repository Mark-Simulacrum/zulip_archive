<html>
<head><meta charset="utf-8"><title>comparing Pat and Expr · clippy · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/index.html">clippy</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/comparing.20Pat.20and.20Expr.html">comparing Pat and Expr</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="269079198"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/comparing%20Pat%20and%20Expr/near/269079198" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonathan Lee <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/comparing.20Pat.20and.20Expr.html#269079198">(Jan 24 2022 at 09:33)</a>:</h4>
<p>Ok, I've been look into <a href="https://github.com/rust-lang/rust-clippy/issues/8288"><code>issue#8288</code></a> for a couple days so far, but I don't think I'm getting anywhere since I'm still very new to clippy XD.</p>
<p>From what my understanding of the OP's suggestion, basically the lint <code>question_mark</code> also needs to be able to pick up the following code.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">foo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>And my current idea was to compare the two <code>Err(err)</code>s, one is a <code>rustc_hir::Pat</code> type and the later one is <code>rustc_hir::Expr</code> type. How do I achieve this, or perhaps there are better ways of solving this issue?</p>



<a name="269088787"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/comparing%20Pat%20and%20Expr/near/269088787" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> flip1995 <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/comparing.20Pat.20and.20Expr.html#269088787">(Jan 24 2022 at 11:01)</a>:</h4>
<p>As an extension of the <code>question_mark</code> lint, you can destructure the <code>Pat</code> . In this case the <code>pat.kind</code> should be <code>PatKind::Variant</code>.</p>



<a name="269089218"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/comparing%20Pat%20and%20Expr/near/269089218" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> flip1995 <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/comparing.20Pat.20and.20Expr.html#269089218">(Jan 24 2022 at 11:05)</a>:</h4>
<p>The <code>PatKind::Variant</code> should then have exactly one pattern, which should be a <code>PatKind::Binding</code>.  You can then compare the <code>Symbol</code> of this binding with the symbol that is returned. I don't think you have to compare <code>HirId</code>s or <code>DefId</code>s in this case, since you know that there can't be any shadowed variable or something like that get in the way.</p>



<a name="269089274"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/comparing%20Pat%20and%20Expr/near/269089274" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> flip1995 <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/comparing.20Pat.20and.20Expr.html#269089274">(Jan 24 2022 at 11:05)</a>:</h4>
<p>Here's the documentaion for <code>rustc_hit::Pat</code>: <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/thir/struct.Pat.html">https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/thir/struct.Pat.html</a> , which will lead you to <code>PatKind</code></p>



<a name="269089392"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/comparing%20Pat%20and%20Expr/near/269089392" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> flip1995 <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/comparing.20Pat.20and.20Expr.html#269089392">(Jan 24 2022 at 11:06)</a>:</h4>
<p>This will work for the simple case of your example. But I can't really think of more complex cases where this lint extension would really make sense</p>



<a name="269195318"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/comparing%20Pat%20and%20Expr/near/269195318" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonathan Lee <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/comparing.20Pat.20and.20Expr.html#269195318">(Jan 25 2022 at 01:09)</a>:</h4>
<p><span class="user-mention" data-user-id="264664">@flip1995</span> Thank you very much~ that does sound like a good starting point</p>



<a name="269917598"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/comparing%20Pat%20and%20Expr/near/269917598" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonathan Lee <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/comparing.20Pat.20and.20Expr.html#269917598">(Jan 30 2022 at 07:42)</a>:</h4>
<p>Okay... May I ask what's the method that extract symbol from an expression? Or how do I compare the exact symbol between expression and pattern. I've been using <code>clippy_utils::contains_name(name, expr)</code> to do the trick until I realized that <code>Some(a) == Some(a+1)</code> is also true. XD</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>