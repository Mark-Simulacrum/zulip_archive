<html>
<head><meta charset="utf-8"><title>Weird error while executing `cargo uitest` · clippy · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/index.html">clippy</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/Weird.20error.20while.20executing.20.60cargo.20uitest.60.html">Weird error while executing `cargo uitest`</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="254398408"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/Weird%20error%20while%20executing%20%60cargo%20uitest%60/near/254398408" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Waffle Lapkin <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/Weird.20error.20while.20executing.20.60cargo.20uitest.60.html#254398408">(Sep 22 2021 at 16:42)</a>:</h4>
<p>I want to create a new clippy lint. I was following the guides in the repo, but when I execute <code>TESTNAME=my_new_list cargo uitest</code>, I get the following error: </p>
<div class="codehilite"><pre><span></span><code>...
warning: `clippy_lints` (lib) generated 2 warnings
    Finished test [unoptimized + debuginfo] target(s) in 0.03s
     Running tests/compile-test.rs (target/debug/deps/compile_test-5f00544648835871)

running 1 test
test compile_test ... FAILED

failures:

---- compile_test stdout ----
thread &#39;compile_test&#39; panicked at &#39;dependencies not found in depinfo: [&quot;clippy_utils&quot;, &quot;derive_new&quot;, &quot;if_chain&quot;, &quot;itertools&quot;, &quot;quote&quot;, &quot;regex&quot;, &quot;serde&quot;, &quot;serde_derive&quot;, &quot;syn&quot;]&#39;, tests/compile-test.rs:94:9
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace


failures:
    compile_test

test result: FAILED. 0 passed; 1 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s

error: test failed, to rerun pass &#39;--test compile-test&#39;
</code></pre></div>
<p>any ideas how to fix this?</p>



<a name="254469681"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/Weird%20error%20while%20executing%20%60cargo%20uitest%60/near/254469681" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dswijj <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/Weird.20error.20while.20executing.20.60cargo.20uitest.60.html#254469681">(Sep 23 2021 at 02:14)</a>:</h4>
<p>The new lint that you just created does not compile when you run the test</p>
<div class="codehilite"><pre><span></span><code>thread &#39;compile_test&#39; panicked at &#39;dependencies not found in depinfo: [&quot;clippy_utils&quot;, &quot;derive_new&quot;, &quot;if_chain&quot;, &quot;itertools&quot;, &quot;quote&quot;, &quot;regex&quot;, &quot;serde&quot;, &quot;serde_derive&quot;, &quot;syn&quot;]&#39;, tests/compile-test.rs:94:9
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
</code></pre></div>



<a name="254469960"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/Weird%20error%20while%20executing%20%60cargo%20uitest%60/near/254469960" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dswijj <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/Weird.20error.20while.20executing.20.60cargo.20uitest.60.html#254469960">(Sep 23 2021 at 02:18)</a>:</h4>
<p>I guess the output of the test is indeed a bit too much, but you can always go and look at the clean ouput of the failed test from <code>target/debug/test_build_base/{lint_name}.stage_id.*</code></p>



<a name="254485049"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/Weird%20error%20while%20executing%20%60cargo%20uitest%60/near/254485049" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Waffle Lapkin <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/Weird.20error.20while.20executing.20.60cargo.20uitest.60.html#254485049">(Sep 23 2021 at 05:59)</a>:</h4>
<p>I don't quite get it... I see warnings about unused imports in the new lint, so it should be compiled, right?</p>



<a name="254485089"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/Weird%20error%20while%20executing%20%60cargo%20uitest%60/near/254485089" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Waffle Lapkin <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/Weird.20error.20while.20executing.20.60cargo.20uitest.60.html#254485089">(Sep 23 2021 at 05:59)</a>:</h4>
<p>Hmm, I've just checked and <code>cargo uitest</code> fails for me even without any changes to the repo, ie with a fresh <code>git clone</code></p>



<a name="254486486"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/Weird%20error%20while%20executing%20%60cargo%20uitest%60/near/254486486" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Waffle Lapkin <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/Weird.20error.20while.20executing.20.60cargo.20uitest.60.html#254486486">(Sep 23 2021 at 06:16)</a>:</h4>
<p><code>cargo test</code> doesn't work either (error is the same)</p>



<a name="254486810"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/Weird%20error%20while%20executing%20%60cargo%20uitest%60/near/254486810" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Waffle Lapkin <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/Weird.20error.20while.20executing.20.60cargo.20uitest.60.html#254486810">(Sep 23 2021 at 06:20)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust-clippy/blob/master/doc/basics.md">https://github.com/rust-lang/rust-clippy/blob/master/doc/basics.md</a> doesn't mention any setup besides the git clone so I'm confused</p>



<a name="254488359"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/Weird%20error%20while%20executing%20%60cargo%20uitest%60/near/254488359" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ThibsG <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/Weird.20error.20while.20executing.20.60cargo.20uitest.60.html#254488359">(Sep 23 2021 at 06:41)</a>:</h4>
<p>yeah basically you don't need to setup extra stuff. Are you on Linux?</p>



<a name="254488454"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/Weird%20error%20while%20executing%20%60cargo%20uitest%60/near/254488454" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Waffle Lapkin <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/Weird.20error.20while.20executing.20.60cargo.20uitest.60.html#254488454">(Sep 23 2021 at 06:42)</a>:</h4>
<p>yes, I'm on linux</p>



<a name="254488919"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/Weird%20error%20while%20executing%20%60cargo%20uitest%60/near/254488919" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ThibsG <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/Weird.20error.20while.20executing.20.60cargo.20uitest.60.html#254488919">(Sep 23 2021 at 06:47)</a>:</h4>
<p>do you have more information with <code>RUST_BACKTRACE=1</code>?</p>



<a name="254489034"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/Weird%20error%20while%20executing%20%60cargo%20uitest%60/near/254489034" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Waffle Lapkin <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/Weird.20error.20while.20executing.20.60cargo.20uitest.60.html#254489034">(Sep 23 2021 at 06:48)</a>:</h4>
<p>There is the backtrace:</p>
<div class="codehilite"><pre><span></span><code>thread &#39;compile_test&#39; panicked at &#39;dependencies not found in depinfo: [&quot;clippy_utils&quot;, &quot;derive_new&quot;, &quot;if_chain&quot;, &quot;itertools&quot;, &quot;quote&quot;, &quot;regex&quot;, &quot;serde&quot;, &quot;serde_derive&quot;, &quot;syn&quot;]&#39;, tests/compile-test.rs:94:9
stack backtrace:
   0: rust_begin_unwind
             at /rustc/fdf65053e99e8966f9bd83b5a8491326cb33d638/library/std/src/panicking.rs:517:5
   1: std::panicking::begin_panic_fmt
             at /rustc/fdf65053e99e8966f9bd83b5a8491326cb33d638/library/std/src/panicking.rs:460:5
   2: compile_test::extern_flags
             at ./tests/compile-test.rs:94:9
   3: compile_test::default_config
             at ./tests/compile-test.rs:128:9
   4: compile_test::compile_test
             at ./tests/compile-test.rs:309:22
   5: compile_test::compile_test::{{closure}}
             at ./tests/compile-test.rs:307:1
   6: core::ops::function::FnOnce::call_once
             at /rustc/fdf65053e99e8966f9bd83b5a8491326cb33d638/library/core/src/ops/function.rs:227:5
   7: core::ops::function::FnOnce::call_once
             at /rustc/fdf65053e99e8966f9bd83b5a8491326cb33d638/library/core/src/ops/function.rs:227:5
</code></pre></div>



<a name="254489095"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/Weird%20error%20while%20executing%20%60cargo%20uitest%60/near/254489095" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ThibsG <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/Weird.20error.20while.20executing.20.60cargo.20uitest.60.html#254489095">(Sep 23 2021 at 06:49)</a>:</h4>
<p>Does <code>cargo build</code> run well?</p>



<a name="254490931"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/Weird%20error%20while%20executing%20%60cargo%20uitest%60/near/254490931" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Waffle Lapkin <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/Weird.20error.20while.20executing.20.60cargo.20uitest.60.html#254490931">(Sep 23 2021 at 07:09)</a>:</h4>
<p>It does</p>



<a name="254493147"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/Weird%20error%20while%20executing%20%60cargo%20uitest%60/near/254493147" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> xFrednet <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/Weird.20error.20while.20executing.20.60cargo.20uitest.60.html#254493147">(Sep 23 2021 at 07:30)</a>:</h4>
<p>There where some changes to UI test dependencies in <a href="https://github.com/rust-lang/rust-clippy/issues/7631">rust-clippy#7631</a>. I'm not sure if this is related tough.<br>
<span class="user-mention" data-user-id="360405">@Cameron Steffen</span> could this maybe be a result of these changes? <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="254494524"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/Weird%20error%20while%20executing%20%60cargo%20uitest%60/near/254494524" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ThibsG <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/Weird.20error.20while.20executing.20.60cargo.20uitest.60.html#254494524">(Sep 23 2021 at 07:43)</a>:</h4>
<p>I cloned a fresh master, and it works like a charm by my side</p>



<a name="254495336"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/Weird%20error%20while%20executing%20%60cargo%20uitest%60/near/254495336" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Waffle Lapkin <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/Weird.20error.20while.20executing.20.60cargo.20uitest.60.html#254495336">(Sep 23 2021 at 07:50)</a>:</h4>
<p>Turns out it was coused by </p>
<div class="codehilite" data-code-language="TOML"><pre><span></span><code><span class="k">[target.x86_64-unknown-linux-gnu]</span>
<span class="n">rustflags</span> <span class="o">=</span> <span class="p">[</span><span class="s">"-C"</span><span class="p">,</span> <span class="s">"link-arg=-fuse-ld=lld"</span><span class="p">]</span>
</code></pre></div>
<p>In my <code>~/.cargo/config</code></p>



<a name="254527233"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/Weird%20error%20while%20executing%20%60cargo%20uitest%60/near/254527233" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/Weird.20error.20while.20executing.20.60cargo.20uitest.60.html#254527233">(Sep 23 2021 at 12:37)</a>:</h4>
<p>The cargo config in the project doesn't override/amend that? Wonder if that's fixable... Or if we can at least detect the scenario.</p>



<a name="254552159"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/Weird%20error%20while%20executing%20%60cargo%20uitest%60/near/254552159" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> flip1995 <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/Weird.20error.20while.20executing.20.60cargo.20uitest.60.html#254552159">(Sep 23 2021 at 15:12)</a>:</h4>
<p>Why does using a different linker change the location of the dependencies? Or is it that the linker args for some reason don't apply when the UI tests are run? <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="254556468"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/Weird%20error%20while%20executing%20%60cargo%20uitest%60/near/254556468" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/Weird.20error.20while.20executing.20.60cargo.20uitest.60.html#254556468">(Sep 23 2021 at 15:39)</a>:</h4>
<p>I think it is overriding <a href="https://github.com/rust-lang/rust-clippy/blob/ef2e2f0a0c61ac29986ac1cee5c06406783a89a2/.cargo/config#L9">our rustflags</a></p>



<a name="254556985"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/Weird%20error%20while%20executing%20%60cargo%20uitest%60/near/254556985" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/Weird.20error.20while.20executing.20.60cargo.20uitest.60.html#254556985">(Sep 23 2021 at 15:42)</a>:</h4>
<p>So I think we can detect the problem by reading CARGO_BUILD_RUSTFLAGS. Maybe even at compile time?</p>



<a name="254557477"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/Weird%20error%20while%20executing%20%60cargo%20uitest%60/near/254557477" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> flip1995 <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/Weird.20error.20while.20executing.20.60cargo.20uitest.60.html#254557477">(Sep 23 2021 at 15:45)</a>:</h4>
<p>According to the <a href="https://doc.rust-lang.org/cargo/reference/config.html#hierarchical-structure"><code>.cargo/config</code></a> documentation, the <code>rustflags</code> should get merged together. But I guess they don't get merged, because the <code>rustflags</code> in the <code>$HOME</code> config is under the <code>target.</code> key and our <code>rustflags</code> is under the <code>build</code> key. I guess the behavior in this case is not really defined? <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="254557905"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/Weird%20error%20while%20executing%20%60cargo%20uitest%60/near/254557905" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/Weird.20error.20while.20executing.20.60cargo.20uitest.60.html#254557905">(Sep 23 2021 at 15:48)</a>:</h4>
<p><a href="https://github.com/rust-lang/cargo/issues/5376">https://github.com/rust-lang/cargo/issues/5376</a></p>



<a name="254558011"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/Weird%20error%20while%20executing%20%60cargo%20uitest%60/near/254558011" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/Weird.20error.20while.20executing.20.60cargo.20uitest.60.html#254558011">(Sep 23 2021 at 15:49)</a>:</h4>
<p>looks like rustflags is an exception</p>



<a name="254558906"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/Weird%20error%20while%20executing%20%60cargo%20uitest%60/near/254558906" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> flip1995 <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/Weird.20error.20while.20executing.20.60cargo.20uitest.60.html#254558906">(Sep 23 2021 at 15:54)</a>:</h4>
<p>Yeah. The funny thing is that Mara also complained about this 40 minutes ago <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="254580330"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/Weird%20error%20while%20executing%20%60cargo%20uitest%60/near/254580330" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/Weird.20error.20while.20executing.20.60cargo.20uitest.60.html#254580330">(Sep 23 2021 at 18:17)</a>:</h4>
<p>I improved the error message <a href="https://github.com/rust-lang/rust-clippy/pull/7711">https://github.com/rust-lang/rust-clippy/pull/7711</a></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>