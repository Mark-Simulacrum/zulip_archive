<html>
<head><meta charset="utf-8"><title>Fail `./x.py test src/tools/clippy` in rust-lang/rust · clippy · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/index.html">clippy</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/Fail.20.60.2E.2Fx.2Epy.20test.20src.2Ftools.2Fclippy.60.20in.20rust-lang.2Frust.html">Fail `./x.py test src/tools/clippy` in rust-lang/rust</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="257004863"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/Fail%20%60./x.py%20test%20src/tools/clippy%60%20in%20rust-lang/rust/near/257004863" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Takayuki Nakata <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/Fail.20.60.2E.2Fx.2Epy.20test.20src.2Ftools.2Fclippy.60.20in.20rust-lang.2Frust.html#257004863">(Oct 11 2021 at 02:51)</a>:</h4>
<p>I don't know why the test is failing in rust-lang/rust. The commit hash is <code>3bf55753c68</code>. This is the first time I've run a test with <code>./x.py test src/tools/clippy</code> in rust-lang/rust</p>
<div class="codehilite"><pre><span></span><code>test [ui] ui/or_fun_call.rs ... FAILED

...(snip)
(.stderr)

 error: use of `or_insert` followed by a function call
   --&gt; $DIR/or_fun_call.rs:85:23
    |
 LL |     map_vec.entry(42).or_insert(vec![]);
-   |                       ^^^^^^^^^^^^^^^^^ help: try this: `or_insert_with(Vec::new)`
+   |                       ^^^^^^^^^^^^^^^^^ help: try this: `or_insert_with(..)`

...(snip)
(.fixed)

-    map_vec.entry(42).or_insert_with(Vec::new);
+    map_vec.entry(42).or_insert_with(..);
</code></pre></div>



<a name="257024642"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/Fail%20%60./x.py%20test%20src/tools/clippy%60%20in%20rust-lang/rust/near/257024642" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> flip1995 <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/Fail.20.60.2E.2Fx.2Epy.20test.20src.2Ftools.2Fclippy.60.20in.20rust-lang.2Frust.html#257024642">(Oct 11 2021 at 07:35)</a>:</h4>
<p>This looks like the <code>snippet</code> util can't find the span of <code>vec![]</code> and therefore defaults to <code>".."</code>. No idea why this happens though...</p>



<a name="257064272"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/Fail%20%60./x.py%20test%20src/tools/clippy%60%20in%20rust-lang/rust/near/257064272" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/Fail.20.60.2E.2Fx.2Epy.20test.20src.2Ftools.2Fclippy.60.20in.20rust-lang.2Frust.html#257064272">(Oct 11 2021 at 13:29)</a>:</h4>
<p>Something with --remap-path-prefix maybe? I know it's been inconsistent in the past whether the compiler knows where the sources for the standard library are or not</p>



<a name="257064289"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/Fail%20%60./x.py%20test%20src/tools/clippy%60%20in%20rust-lang/rust/near/257064289" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/Fail.20.60.2E.2Fx.2Epy.20test.20src.2Ftools.2Fclippy.60.20in.20rust-lang.2Frust.html#257064289">(Oct 11 2021 at 13:29)</a>:</h4>
<p>It's strange that this is passing CI though</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>