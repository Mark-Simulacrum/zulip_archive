<html>
<head><meta charset="utf-8"><title>Troubles with installing from source · clippy · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/index.html">clippy</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/Troubles.20with.20installing.20from.20source.html">Troubles with installing from source</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="272871390"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/Troubles%20with%20installing%20from%20source/near/272871390" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fmease <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/Troubles.20with.20installing.20from.20source.html#272871390">(Feb 22 2022 at 21:50)</a>:</h4>
<p>Hey, I recently cloned the repo for the first time to work on a bug fix and I have issues with building Clippy from source, i.e. adding <code>cargo-clippy</code> as a component to the toolchain (specified in <code>/rust-toolchain</code> which currently is <code>nightly-2022-02-10</code>). I am following the commands given in <a href="https://github.com/rust-lang/rust-clippy/blob/master/doc/basics.md#install-from-source">these docs</a>. I hope this is the right place to ask.</p>
<p>After making some changes to Clippy (let's say adding some <code>println</code>s or alternatively a <code>panic</code>) and executing <code>cargo build --release --bin cargo-clippy --bin clippy-driver -Zunstable-options --out-dir "$(rustc --print=sysroot)/bin"</code> (optionally w/o <code>--release</code>) in the Clippy repo, I can successfully access and run <code>cargo clippy</code> as well as <code>cargo +nightly-2022-02-10 clippy</code> inside of the Clippy repo and any subfolders and observe the output of the <code>println</code>s. <code>cargo +nightly-2022-02-10 clippy --version</code> yields <code>0.1.60 (9e605ef80 2022-02-21)</code> (let's call it YESTERDAY).</p>
<p><strong>However</strong>, running <code>cargo +nightly-2022-02-10 clippy</code>outside of the repo executes a different Clippy which does not contain my uncommitted local changes and is of the same version YESTERDAY. I can delete it (<code>rm "$(rustc --print=sysroot)/bin/cargo-clippy"</code>) and obviously <code>rustup</code> then complains about the missing component <code>cargo-clippy</code> (inside and outside of the repo).</p>
<p>Re-building the clippy components with the command from above makes it available again and the situation is the same: Executed from inside the repo, the built Clippy contains the local changes (the output of <code>println</code>s can be seen, alternatively the panic) but executed outside of the repo, the local changes are not observable.</p>
<p><strong>What's more</strong>, if I introduce some more local changes e.g. to <code>clippy_lints</code> and I rebuild the component, <code>cargo +nightly-2022-02-10 clippy</code>does not contain those changes! The rebuild used incremental compilation but cargo allegedly did rebuild <code>clippy_lints</code> (as seen in its output: <code>Compiling clippy_lints v0.1.60 (…)</code>). Only when I do a <code>cargo clean</code> and then rebuild the component, the changes are reflected!</p>
<p>According to the linked documentation, I shouldn't face any of those issues and the built Clippy component should be accessible from anywhere in the system.</p>
<hr>
<p>Am I misunderstanding <code>rustup</code>? Is my <code>rustup</code> misconfigured? Its version is<code>1.24.3 (2021-11-09)</code> and it was installed from the Linux Arch package repository. I've never faced such issues with it.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>