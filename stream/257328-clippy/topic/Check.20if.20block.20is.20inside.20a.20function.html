<html>
<head><meta charset="utf-8"><title>Check if block is inside a function · clippy · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/index.html">clippy</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/Check.20if.20block.20is.20inside.20a.20function.html">Check if block is inside a function</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="249243051"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/Check%20if%20block%20is%20inside%20a%20function/near/249243051" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bastian <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/Check.20if.20block.20is.20inside.20a.20function.html#249243051">(Aug 12 2021 at 14:37)</a>:</h4>
<p>Hey there <span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span> <br>
I wondered how I find out if a block is the body of a function definition</p>
<p>lets say I have a body like this:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="o">+</span><span class="n">LL</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="k">fn</span> <span class="nf">just_get_unit</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="o">+</span><span class="w">   </span><span class="o">|</span><span class="w">  </span><span class="n">____________________</span><span class="o">^</span><span class="w"></span>
<span class="o">+</span><span class="n">LL</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">get_unit</span><span class="p">();</span><span class="w"></span>
<span class="o">+</span><span class="n">LL</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="o">+</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="n">_</span><span class="o">^</span><span class="w"></span>
<span class="o">+</span><span class="w">   </span><span class="o">|</span><span class="w"></span>
</code></pre></div>
<p>How would I check if the block is the body of <code>just_get_unit</code> function?</p>



<a name="249245281"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/Check%20if%20block%20is%20inside%20a%20function/near/249245281" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> flip1995 <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/Check.20if.20block.20is.20inside.20a.20function.html#249245281">(Aug 12 2021 at 14:54)</a>:</h4>
<p>Really unsure if it is the best way to do that, but here's how I would do it:</p>
<ol>
<li>Get the parent item of the block with <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/hir/map/struct.Map.html#method.get_parent_item"><code>get_parent_item</code></a></li>
<li>Then use <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/hir/map/struct.Map.html#method.expect_item"><code>expect_item</code></a> to get the item and match it if it is a function.</li>
<li>From there you have a <code>BodyId</code> of the function, which you can convert to a <code>Body</code> from which you can match the expr if it is a block and if so compare the <code>HirId</code> with the one of the block you need this information for.</li>
</ol>
<p>If you're only interested in blocks directly on functions you may be better off with just using <code>check_fn</code></p>



<a name="249250952"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/Check%20if%20block%20is%20inside%20a%20function/near/249250952" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/Check.20if.20block.20is.20inside.20a.20function.html#249250952">(Aug 12 2021 at 15:33)</a>:</h4>
<p>You can use <a href="http://get_parent_node">get_parent_node</a> or <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/hir/map/struct.Map.html#method.parent_iter">parent_iter</a> and <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/hir/map/struct.Map.html#method.maybe_body_owned_by">maybe_body_owned_by</a>. I'm not sure if you want to look at the parent or maybe parent of parent, and then see if maybe_body_owned_by is Some.</p>



<a name="249251123"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/Check%20if%20block%20is%20inside%20a%20function/near/249251123" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/Check.20if.20block.20is.20inside.20a.20function.html#249251123">(Aug 12 2021 at 15:34)</a>:</h4>
<p>get_parent_item would skip up the parents until it finds the function</p>



<a name="249334463"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/Check%20if%20block%20is%20inside%20a%20function/near/249334463" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bastian <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/Check.20if.20block.20is.20inside.20a.20function.html#249334463">(Aug 13 2021 at 08:21)</a>:</h4>
<p><span class="user-mention silent" data-user-id="264664">flip1995</span> <a href="#narrow/stream/257328-clippy/topic/Check.20if.20block.20is.20inside.20a.20function/near/249245281">said</a>:</p>
<blockquote>
<p>Really unsure if it is the best way to do that, but here's how I would do it:</p>
<ol>
<li>Get the parent item of the block with <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/hir/map/struct.Map.html#method.get_parent_item"><code>get_parent_item</code></a></li>
<li>Then use <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/hir/map/struct.Map.html#method.expect_item"><code>expect_item</code></a> to get the item and match it if it is a function.</li>
<li>From there you have a <code>BodyId</code> of the function, which you can convert to a <code>Body</code> from which you can match the expr if it is a block and if so compare the <code>HirId</code> with the one of the block you need this information for.</li>
</ol>
<p>If you're only interested in blocks directly on functions you may be better off with just using <code>check_fn</code></p>
</blockquote>
<p>Ah great that works for me! I actually need to check every block, so <code>check_fn</code> wouldn't really work...</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>