<html>
<head><meta charset="utf-8"><title>Troubles installing from source · clippy · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/index.html">clippy</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/Troubles.20installing.20from.20source.html">Troubles installing from source</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="272871922"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/Troubles%20installing%20from%20source/near/272871922" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fmease <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/Troubles.20installing.20from.20source.html#272871922">(Feb 22 2022 at 21:56)</a>:</h4>
<p>Note that after "having installed" the <code>cargo-clippy</code> component from source, it's not listed in <code>rustup +nightly-2022-02-10 component list --installed</code>.</p>



<a name="272930317"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/Troubles%20installing%20from%20source/near/272930317" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> flip1995 <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/Troubles.20installing.20from.20source.html#272930317">(Feb 23 2022 at 10:34)</a>:</h4>
<p>Just tried it myself and can only give the 2 most unsatisfying answers:</p>
<ol>
<li>It works for me </li>
<li>Why do you want to do this? (I assume to test your changes on a specific crate) But could you write a test in <code>tests/ui</code> instead or extract the offending code to a file? If you can do the second thing, you can do <code>cargo dev lint &lt;filename.rs&gt;</code> in the Clippy repo. </li>
</ol>
<p>But to maybe help you a bit in what you try to do:</p>
<ul>
<li><code>rustup component list</code> is not expected to display the from-source installed clippy component. At least it doesn't for me, but local changes are visible anyway.</li>
<li>Do you run Clippy with <code>cargo +nightly-2022-02-10 clippy</code> outside of the Clippy repo? If not, there might be a <code>rust-toolchain</code> file in the crate you try to check overriding the toolchain, if you just run  <code>cargo clippy</code>.</li>
</ul>
<p>Regarding changing something in <code>clippy_lints</code> and the changes aren't visible, even in the Clippy dir: Do you run <code>cargo build</code> inside the <code>clippy_lints</code> dir? If so you want to do that in the project root instead. Or alternatively: Do you run the whole install-from-source-command from the doc again after changing something in <code>clippy_lints</code> or just <code>cargo build</code>?</p>
<p>Hope this gets you closer to where you want to be.</p>



<a name="272930449"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/Troubles%20installing%20from%20source/near/272930449" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> flip1995 <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/Troubles.20installing.20from.20source.html#272930449">(Feb 23 2022 at 10:36)</a>:</h4>
<p>You may want to insert a unconditional <code>panic!()</code> somewhere to <strong>really</strong> make sure that your changes aren't applied outside of the Clippy dir.</p>



<a name="272998157"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/Troubles%20installing%20from%20source/near/272998157" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fmease <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/Troubles.20installing.20from.20source.html#272998157">(Feb 23 2022 at 19:18)</a>:</h4>
<p>Thanks for replying! :) Yeah, I guess my situation is a weird one ^^. </p>
<blockquote>
<p>Why do you want to do this? […] But could you write a test in <code>tests/ui</code></p>
</blockquote>
<p>Most definitely! I planned to go the UI test route when actually starting work on the bug fix since that would result in a way faster workflow.<br>
As to why I wanted to build the component from source: Not sure if that makes any sense to you but I just wanted to <em>get a feel</em> for the code base and experiment with it “live”.</p>
<blockquote>
<p>Do you run cargo build inside the <code>clippy_lints</code> dir?</p>
</blockquote>
<p>No, I was either in the root of the repo or used <code>--manifest-path="&lt;relative&gt;/Cargo.toml"</code>.</p>
<blockquote>
<p>Do you run the whole install-from-source-command […]?</p>
</blockquote>
<p>Yes, every time.</p>
<blockquote>
<p>You may want to insert a unconditional <code>panic!()</code> somewhere</p>
</blockquote>
<p>Thank you for the suggestion. I already did that: Used some <code>println</code>s, then I moved to <code>panic</code>s since I wasn't sure if the output was swallowed. I also changed the diagnostic message of a FP lint which always triggered on the test crate.</p>
<p>I will probably just move to the UI test workflow and not waste time on this one. It probably has to do with my system.</p>



<a name="273014383"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/Troubles%20installing%20from%20source/near/273014383" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> flip1995 <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/Troubles.20installing.20from.20source.html#273014383">(Feb 23 2022 at 21:34)</a>:</h4>
<p>The only idea I have left is that something overrides your toolchain. Which is weird, because <code>cargo +toolchain</code> should have priority. You might want to run <code>rustup show active-toolchain</code> and <code>rustup +nightly-2022-02-10 show active-toolchain</code> to check if it is overridden.</p>
<p>As an intermediate step you can try to extract the code to a file and lint that with your custom changes with <code>cargo dev lint &lt;filename.rs&gt;</code>.</p>



<a name="273014966"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/Troubles%20installing%20from%20source/near/273014966" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> flip1995 <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/Troubles.20installing.20from.20source.html#273014966">(Feb 23 2022 at 21:39)</a>:</h4>
<p>Oh  can you check the output of <code>ls -l ~/.cargo/bin</code>. Most of the binaries in there should all have the exact same size. If the <code>cargo-clippy</code> binary is overridden and has a different size, then this is the reason why it doesn't work. (It is still weird that it works in the Clippy repo though). Also check the output <code>which cargo-clippy</code>. It should point to <code>~/.cargo/bin/cargo-clippy</code></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>