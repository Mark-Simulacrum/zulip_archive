<html>
<head><meta charset="utf-8"><title>cargo dev bless · clippy · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/index.html">clippy</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/cargo.20dev.20bless.html">cargo dev bless</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="218590397"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/cargo%20dev%20bless/near/218590397" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Phil H <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/cargo.20dev.20bless.html#218590397">(Dec 02 2020 at 17:27)</a>:</h4>
<p>I was about to open a PR for the Rust rewrite of the <code>update-all-references</code> scripts, but then I saw a crucial detail in the issue:</p>
<blockquote>
<p>bless: <strong>execute</strong> UI-tests and update reference files</p>
</blockquote>
<p>Right now, my <code>cargo dev bless</code> just updates the reference files; should it also run the tests beforehand?</p>



<a name="218591993"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/cargo%20dev%20bless/near/218591993" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Phil H <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/cargo.20dev.20bless.html#218591993">(Dec 02 2020 at 17:38)</a>:</h4>
<p>Just went ahead and opened the PR for now: <a href="https://github.com/rust-lang/rust-clippy/pull/6413">https://github.com/rust-lang/rust-clippy/pull/6413</a><br>
We can discuss it there as well, I guess <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="218615634"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/cargo%20dev%20bless/near/218615634" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> flip1995 <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/cargo.20dev.20bless.html#218615634">(Dec 02 2020 at 20:35)</a>:</h4>
<p>I will review this over the weekend. Thanks for moving this ahead!</p>
<p>Ulitmately, the command should check if tests already ran and run them if they haven't. But for the first iteration just having a pure bless command where you have to run the tests manually is a real blessing <span aria-label="smirk" class="emoji emoji-1f60f" role="img" title="smirk">:smirk:</span></p>



<a name="218627873"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/cargo%20dev%20bless/near/218627873" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick12 <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/cargo.20dev.20bless.html#218627873">(Dec 02 2020 at 22:14)</a>:</h4>
<p>As a windows user, thanks for working on this, having to open a bash shell to bless is slightly annoying :P</p>



<a name="219712273"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/cargo%20dev%20bless/near/219712273" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Phil H <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/cargo.20dev.20bless.html#219712273">(Dec 12 2020 at 14:59)</a>:</h4>
<p><code>cargo dev bless</code> has now replaced the <code>update_references</code> scripts on master <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span></p>



<a name="219712395"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/cargo%20dev%20bless/near/219712395" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Phil H <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/cargo.20dev.20bless.html#219712395">(Dec 12 2020 at 15:02)</a>:</h4>
<p>So, if you were running <code>./tests/&lt;suite&gt;/update-all-references.sh</code> before, now it should be just <code>cargo dev bless</code>. It will update the reference files in all the different test suites we have (ui, ui-toml, ui-cargo)</p>



<a name="219722871"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/cargo%20dev%20bless/near/219722871" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/cargo.20dev.20bless.html#219722871">(Dec 12 2020 at 19:17)</a>:</h4>
<p>Does it work in rust-lang/rust too, or no?</p>



<a name="219722878"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/cargo%20dev%20bless/near/219722878" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> flip1995 <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/cargo.20dev.20bless.html#219722878">(Dec 12 2020 at 19:17)</a>:</h4>
<p>not yet. We'll get it to work in the next step.</p>



<a name="219761924"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/cargo%20dev%20bless/near/219761924" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Phil H <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/cargo.20dev.20bless.html#219761924">(Dec 13 2020 at 13:38)</a>:</h4>
<p>rustc integration would require calling <code>cargo dev</code> from <code>./x.py</code> right? Or do you have something else in mind?</p>



<a name="219762205"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/cargo%20dev%20bless/near/219762205" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/cargo.20dev.20bless.html#219762205">(Dec 13 2020 at 13:47)</a>:</h4>
<p><span class="user-mention silent" data-user-id="197894">Philipp Hansch</span> <a href="#narrow/stream/257328-clippy/topic/cargo.20dev.20bless/near/219761924">said</a>:</p>
<blockquote>
<p>rustc integration would require calling <code>cargo dev</code> from <code>./x.py</code> right? Or do you have something else in mind?</p>
</blockquote>
<p>I think it would be great for <code>x.py test --bless src/tools/clippy</code> to just work :)</p>



<a name="219762211"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/cargo%20dev%20bless/near/219762211" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/cargo.20dev.20bless.html#219762211">(Dec 13 2020 at 13:47)</a>:</h4>
<p>happy to help with that if you want</p>



<a name="219762476"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/cargo%20dev%20bless/near/219762476" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> flip1995 <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/cargo.20dev.20bless.html#219762476">(Dec 13 2020 at 13:55)</a>:</h4>
<p>Another thing to keep in mind: The clippy ui tests currently write the results into a dir, that can be found via the <code>OUT_DIR</code> env-var. You can look at the <code>compiltest.rs</code> file to see where the test output goes.</p>



<a name="220047305"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/cargo%20dev%20bless/near/220047305" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Phil H <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/cargo.20dev.20bless.html#220047305">(Dec 15 2020 at 21:47)</a>:</h4>
<p>Also, if we ever switch to using rustc's compiletest (not the separate one we currently use), that would already come with <code>bless</code> support as well, making integration a bit tighter</p>



<a name="220047539"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/cargo%20dev%20bless/near/220047539" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Phil H <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/cargo.20dev.20bless.html#220047539">(Dec 15 2020 at 21:49)</a>:</h4>
<p>I have a prototype working now where I can call clippy_dev subcommands from <code>./x.py</code>, I just need to do a subtree sync locally first to pull in the <code>bless</code> changes</p>



<a name="220103380"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/cargo%20dev%20bless/near/220103380" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> flip1995 <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/cargo.20dev.20bless.html#220103380">(Dec 16 2020 at 11:18)</a>:</h4>
<p>tomorrow is sync day anyway, if you want/can to wait until then. Don't want to hold you back though.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>