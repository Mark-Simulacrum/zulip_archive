<html>
<head><meta charset="utf-8"><title>comparing `rustc_hir::hir::Ty` with `rustc_middle::ty::Ty` · clippy · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/index.html">clippy</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/comparing.20.60rustc_hir.3A.3Ahir.3A.3ATy.60.20with.20.60rustc_middle.3A.3Aty.3A.3ATy.60.html">comparing `rustc_hir::hir::Ty` with `rustc_middle::ty::Ty`</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="275629452"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/comparing%20%60rustc_hir%3A%3Ahir%3A%3ATy%60%20with%20%60rustc_middle%3A%3Aty%3A%3ATy%60/near/275629452" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonathan Lee <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/comparing.20.60rustc_hir.3A.3Ahir.3A.3ATy.60.20with.20.60rustc_middle.3A.3Aty.3A.3ATy.60.html#275629452">(Mar 17 2022 at 10:05)</a>:</h4>
<p>I wanted to compare a function return type that I extracted using <code>Node::fn_decl()</code>, with an expression type to see if they matches.</p>
<p>But as I was very excited to put them into <code>clippy_utils::same_type_and_consts</code>, I found out that those <code>Ty</code>s are totally different things and got a bit disappointed. So, are there any conversion methods between these two or other ways to do the comparison?</p>
<p>Thanks!</p>



<a name="275632582"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/comparing%20%60rustc_hir%3A%3Ahir%3A%3ATy%60%20with%20%60rustc_middle%3A%3Aty%3A%3ATy%60/near/275632582" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Léo Lanteri Thauvin <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/comparing.20.60rustc_hir.3A.3Ahir.3A.3ATy.60.20with.20.60rustc_middle.3A.3Aty.3A.3ATy.60.html#275632582">(Mar 17 2022 at 10:35)</a>:</h4>
<p>In this case I think <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/ty/context/struct.TyCtxt.html#method.fn_sig"><code>TyCtxt::fn_sig</code></a> might help?</p>



<a name="275633105"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/comparing%20%60rustc_hir%3A%3Ahir%3A%3ATy%60%20with%20%60rustc_middle%3A%3Aty%3A%3ATy%60/near/275633105" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Léo Lanteri Thauvin <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/comparing.20.60rustc_hir.3A.3Ahir.3A.3ATy.60.20with.20.60rustc_middle.3A.3Aty.3A.3ATy.60.html#275633105">(Mar 17 2022 at 10:40)</a>:</h4>
<p>For the details of the difference between <code>hir::Ty</code> and <code>ty::Ty</code> see <a href="https://rustc-dev-guide.rust-lang.org/ty.html#rustc_hirty-vs-tyty">the rustc-dev-guide</a></p>



<a name="275633108"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/comparing%20%60rustc_hir%3A%3Ahir%3A%3ATy%60%20with%20%60rustc_middle%3A%3Aty%3A%3ATy%60/near/275633108" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonathan Lee <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/comparing.20.60rustc_hir.3A.3Ahir.3A.3ATy.60.20with.20.60rustc_middle.3A.3Aty.3A.3ATy.60.html#275633108">(Mar 17 2022 at 10:40)</a>:</h4>
<p><span class="user-mention silent" data-user-id="255061">Léo Lanteri Thauvin</span> <a href="#narrow/stream/257328-clippy/topic/comparing.20.60rustc_hir.3A.3Ahir.3A.3ATy.60.20with.20.60rustc_middle.3A.3Aty.3A.3ATy.60/near/275632582">said</a>:</p>
<blockquote>
<p>In this case I think <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/ty/context/struct.TyCtxt.html#method.fn_sig"><code>TyCtxt::fn_sig</code></a> might help?</p>
</blockquote>
<p>Thanks~ maybe that'll helps avoiding using <code>rustc_typeck::hir_ty_to_ty</code>, I'll take a look.</p>



<a name="275636439"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257328-clippy/topic/comparing%20%60rustc_hir%3A%3Ahir%3A%3ATy%60%20with%20%60rustc_middle%3A%3Aty%3A%3ATy%60/near/275636439" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> flip1995 <a href="https://zulip-archive.rust-lang.org/stream/257328-clippy/topic/comparing.20.60rustc_hir.3A.3Ahir.3A.3ATy.60.20with.20.60rustc_middle.3A.3Aty.3A.3ATy.60.html#275636439">(Mar 17 2022 at 11:11)</a>:</h4>
<p>If all things should fail, there is still <code>hir_ty_to_ty</code>. But you have to be careful with that, because it could lead to ICEs. I think the <code>use_self</code> lint has some comments on how this function can/can't be used.</p>
<p>If you have to use it, just open a WIP PR and I can help you verify the correct usage.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>