<html>
<head><meta charset="utf-8"><title>DOM id tidy check · rustdoc · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/index.html">rustdoc</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html">DOM id tidy check</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="264396984"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264396984" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264396984">(Dec 10 2021 at 02:49)</a>:</h4>
<p>So, <a href="https://github.com/rust-lang/rust/issues/86178">#86178</a> has been open since June. I'm currently assigned on it, but I'm unsure what to do.</p>
<p>On the one hand, ensuring DOM ids are declared in the map (or removed from the map if they are unused) seems like a good thing to have. On the other hand, the check adds a lot of code and seems very fragile. IIRC, it also only detects uses of ids with <code>write_small_section_header</code>, but ids are used in other places as well and there's nothing that ensures they are only used in <code>write_small_section_header</code>.</p>
<p>On balance, I think I'm leaning towards closing it, but I don't feel super strongly. If someone else feels strongly in favor, please feel free to take over the review. I just don't want this PR to sit in limbo forever.</p>
<p>What do you (T-rustdoc) think?</p>
<p>cc <span class="user-mention" data-user-id="210316">@GuillaumeGomez</span></p>



<a name="264400566"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264400566" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264400566">(Dec 10 2021 at 03:59)</a>:</h4>
<p>Could we make the check more reliable by checking the generated HTML instead of the Rust source?</p>



<a name="264404223"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264404223" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264404223">(Dec 10 2021 at 05:14)</a>:</h4>
<p>that sounds more like a test than a tidy check, right? so e.g. generate library/std, grep for <code>id="([a-zA-z0-9-]*)"</code>, and check the result matches the id map?</p>



<a name="264404233"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264404233" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264404233">(Dec 10 2021 at 05:14)</a>:</h4>
<p>or do the same with the XPath tests instead, assuming they have equally good coverage and are smaller (and are generated anyhow during tests)</p>



<a name="264421912"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264421912" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264421912">(Dec 10 2021 at 09:34)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check/near/264400566">said</a>:</p>
<blockquote>
<p>Could we make the check more reliable by checking the generated HTML instead of the Rust source?</p>
</blockquote>
<p>If we do like that, it's very likely that we will miss a lot of potential ID duplication (and we already test that in the HTML too). </p>
<p>Using regex like <span class="user-mention" data-user-id="315412">@jsha</span> suggested would work too I guess since we have to look inside html and rust code. The problem is really that we can't check using the generated HTML...</p>



<a name="264445347"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264445347" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264445347">(Dec 10 2021 at 13:19)</a>:</h4>
<p>Maybe related: I recently added my own header called “structs” which stole the anchor from the “jump to the list of structs” link. Would this address that?</p>



<a name="264448931"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264448931" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264448931">(Dec 10 2021 at 13:46)</a>:</h4>
<p>Probably not - to catch that we'd need a test that has an item named <code>structs</code></p>



<a name="264462913"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264462913" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264462913">(Dec 10 2021 at 15:28)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116155">Jake Goulding</span> <a href="#narrow/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check/near/264445347">said</a>:</p>
<blockquote>
<p>Maybe related: I recently added my own header called “structs” which stole the anchor from the “jump to the list of structs” link. Would this address that?</p>
</blockquote>
<p>The test is to ensure that the ID used in rustdoc are listed in the ID map so that in your case, it doesn't conflict.</p>



<a name="264463028"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264463028" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264463028">(Dec 10 2021 at 15:29)</a>:</h4>
<p><span class="user-mention" data-user-id="210316">@GuillaumeGomez</span> I'm confused by your response - are you saying the <em>goal</em> of the test is to catch issues like that? I'm saying even if that's the goal, none of the proposed <em>implementations</em> would catch it.</p>



<a name="264463425"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264463425" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264463425">(Dec 10 2021 at 15:32)</a>:</h4>
<p>The goal of the test is to ensure that all IDs used in rustdoc are listed in the ID map to prevent ID conflicts when generating markdown (the headings all have an ID, which might conflict)</p>



<a name="264463461"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264463461" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264463461">(Dec 10 2021 at 15:32)</a>:</h4>
<p>the end goal is to prevent the issue <span class="user-mention" data-user-id="116155">@Jake Goulding</span> was talking about ;)</p>



<a name="264463512"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264463512" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264463512">(Dec 10 2021 at 15:33)</a>:</h4>
<p>(does it make sense? I can try to reword if not)</p>



<a name="264487649"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264487649" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264487649">(Dec 10 2021 at 18:21)</a>:</h4>
<p>I think I get it - the ID map is an input to the markdown generator. If the markdown generator is about to generate an <code>id</code> that would conflict with an <code>id</code> already in use, it will rename the about-to-be-generated <code>id</code> so it doesn't conflict.</p>
<p>The <code>id</code> <code>structs</code> is not currently in the ID map, but it should be. Presumably the "regex on built HTML" approach would catch that and tell us to add <code>structs</code> to the ID map. <span class="user-mention" data-user-id="210316">@GuillaumeGomez</span> in <a href="https://github.com/rust-lang/rust/pull/86178/files">https://github.com/rust-lang/rust/pull/86178/files</a>, I don't see <code>structs</code> being added. Why is <code>structs</code> not caught by the technique you are using there?</p>



<a name="264487732"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264487732" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264487732">(Dec 10 2021 at 18:22)</a>:</h4>
<p>Also I'm realizing the "regex on built HTML" approach will be _over_ inclusive, since it will catch IDs generated by markdown.</p>



<a name="264498115"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264498115" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264498115">(Dec 10 2021 at 19:42)</a>:</h4>
<p>So, I'll try to re-explain it:</p>
<p>In rustdoc, we generate the DOM with some hardcoded HTML IDs (like "main"). For each page, we have an ID map. When we generate something with an HTML ID, we first check if it already exists in the map. If not we add it into it, otherwise we add a <code>-n</code> (where <code>n</code> is number starting from 0 that we increase until we have a free ID and then store this new HTML ID).</p>
<p>Now, a problem that often occurs is that we forget to declare a hardcoded ID into the ID map. If so, it means it's possible for an element of the page to use this ID, making it appear twice in the page. For example, if we don't add "main" to the ID map and I have a markdown like this:</p>
<div class="codehilite"><pre><span></span><code># main
</code></pre></div>
<p>It'll generate something like <code>&lt;h3 id="main"&gt;main&lt;/h3&gt;</code>. But that is invalid in HTML to have more than one element with the same ID.</p>
<p>We already have a tool which checks into the std docs if a page has a duplicated ID. However, it doesn't check if we forgot to add a harcoded ID into the map, making it possible (and based on the PR, it was very possible) to have a page with a duplicated ID.</p>
<p>Since it's unfortunately not possible to check it on generated HTML, I wrote a tidy check which goes through rustdoc source code and look for <code>id="..."</code> IDs (into templates too) and then check if they are in the ID map.</p>



<a name="264498279"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264498279" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264498279">(Dec 10 2021 at 19:44)</a>:</h4>
<p><span class="user-mention silent" data-user-id="315412">jsha</span> <a href="#narrow/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check/near/264487732">said</a>:</p>
<blockquote>
<p>Also I'm realizing the "regex on built HTML" approach will be _over_ inclusive, since it will catch IDs generated by markdown.</p>
</blockquote>
<p>We can only check if an ID is duplicated (and such a check already exists). But just like you said, we can't do it to check if we forgot to put a hardcoded ID into the ID map.</p>



<a name="264499972"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264499972" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264499972">(Dec 10 2021 at 19:58)</a>:</h4>
<p>so "structs" is a good example of where the approach of going through rustdoc source looking for <code>id="..."</code> is fragile. We don't have <code>id="structs"</code> anywhere. Instead we have<code>ItemType::Struct =&gt; ("structs", "Structs"),</code>, which gets interpolated eventually into <code>id="{}"</code> somewhere.</p>



<a name="264500287"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264500287" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264500287">(Dec 10 2021 at 20:00)</a>:</h4>
<p>Can we potentially move off of using <code>id</code> for things rustdoc generates, other than markdown output? that would presumably avoid this problem at the root, right? My assumption is that all IDs could in theory be replaced with e.g. classes at no real cost, and linting against <em>all</em> usage of id= in librustdoc seems considerably easier than trying to only use 'the right ones'.</p>



<a name="264500446"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264500446" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264500446">(Dec 10 2021 at 20:02)</a>:</h4>
<p>(I feel like there must have been discussion on this aspect, but I don't actually recall discussing the need for IDs)</p>



<a name="264500606"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264500606" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264500606">(Dec 10 2021 at 20:03)</a>:</h4>
<p>Obviously, it's also the case that collisions between e.g. css classes for styling, etc. would have problems too -- but that seems potentially more straightforward to solve</p>



<a name="264501832"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264501832" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264501832">(Dec 10 2021 at 20:14)</a>:</h4>
<p>Don't you need IDs for things like: <a href="/user_uploads/4715/sOEZ-_yaSPR7gBvqYRwV-2RW/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/sOEZ-_yaSPR7gBvqYRwV-2RW/image.png" title="image.png"><img src="/user_uploads/4715/sOEZ-_yaSPR7gBvqYRwV-2RW/image.png"></a></div>



<a name="264501843"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264501843" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264501843">(Dec 10 2021 at 20:14)</a>:</h4>
<p><code>id</code> is used for targetting parts of the page with URL fragments, e.g. <a href="https://doc.rust-lang.org/nightly/std/string/struct.String.html#implementations">https://doc.rust-lang.org/nightly/std/string/struct.String.html#implementations</a></p>



<a name="264502330"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264502330" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264502330">(Dec 10 2021 at 20:18)</a>:</h4>
<p><span class="user-mention silent" data-user-id="315412">jsha</span> <a href="#narrow/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check/near/264501843">said</a>:</p>
<blockquote>
<p><code>id</code> is used for targetting parts of the page with URL fragments, e.g. <a href="https://doc.rust-lang.org/nightly/std/string/struct.String.html#implementations">https://doc.rust-lang.org/nightly/std/string/struct.String.html#implementations</a></p>
</blockquote>
<p>Ah, right. I forgot that we generated our own such IDs.</p>
<p>As you mention with the structs example, it seems like it's easy for conflicts to arise even within rustdoc -- not just with markdown-generated IDs. Maybe we can enforce that IDs are generated through the id map by linting the final html s.t. ids are always prefixed with something (e.g., <code>rd-</code>...) but that seems suboptimal too.</p>



<a name="264503631"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264503631" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Howell <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264503631">(Dec 10 2021 at 20:29)</a>:</h4>
<p>This is one of the reasons I would like to use Tera for generating HTML. Since Tera templates are HTML with other stuff in it, you can use an HTML parser on the templates to get a full list of IDs in them, and build the ID map from that.</p>



<a name="264504363"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264504363" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264504363">(Dec 10 2021 at 20:35)</a>:</h4>
<p>Seems like that would have the same problem <a href="#narrow/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check/near/264499972">mentioned earlier</a>. Hypothetical Tera template:</p>
<div class="codehilite"><pre><span></span><code>&lt;div id=&quot;{{ awesome_id }}&quot; /&gt;
</code></pre></div>
<p>You wouldn't know the value of the ID from <em>just</em> the template, right?</p>



<a name="264504635"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264504635" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264504635">(Dec 10 2021 at 20:37)</a>:</h4>
<p>I really want to finish the Tera work too! Currently it's blocked on a performance regression from migrating the most recent template: <a href="https://github.com/rust-lang/rust/issues/89732">https://github.com/rust-lang/rust/issues/89732</a>. I think that may be fundamental to Tera's use of <code>Serialize</code>. That could improve with a migration to <code>valuable</code> but that's a bit uncertain at the moment: <a href="https://github.com/Keats/tera/issues/637#issuecomment-941926705">https://github.com/Keats/tera/issues/637#issuecomment-941926705</a>.</p>
<p>At any rate, Jake Goulding is right; templating doesn't solve this particular problem because you can interpolate ids.</p>



<a name="264504777"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264504777" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264504777">(Dec 10 2021 at 20:38)</a>:</h4>
<p>Here's an informative example of what currently happens:</p>
<p><a href="https://doc.rust-lang.org/nightly/std/string/struct.String.html#examples">https://doc.rust-lang.org/nightly/std/string/struct.String.html#examples</a><br>
<a href="https://doc.rust-lang.org/nightly/std/string/struct.String.html#examples-1">https://doc.rust-lang.org/nightly/std/string/struct.String.html#examples-1</a><br>
<a href="https://doc.rust-lang.org/nightly/std/string/struct.String.html#examples-2">https://doc.rust-lang.org/nightly/std/string/struct.String.html#examples-2</a></p>
<p><code>String</code> has many different "examples" subheadings, in different parts of the doc. They would all conflict with each other, so ones after the first get renamed to add <code>-1</code> etc.</p>



<a name="264504873"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264504873" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264504873">(Dec 10 2021 at 20:39)</a>:</h4>
<p>Actually, something we could do is add a tidy which checks that we don't have <code>id="..."</code> in rustdoc source code and create a new struct looking like this: <code>struct HtmlId(&amp;'static str)</code> which would impl <code>Display</code> and render <code>id="..."</code>. That seems much simpler no?</p>



<a name="264504891"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264504891" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264504891">(Dec 10 2021 at 20:39)</a>:</h4>
<p>That doesn't cover tera templates, but that reduces the problem quite a bit</p>



<a name="264504935"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264504935" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264504935">(Dec 10 2021 at 20:40)</a>:</h4>
<p>One possibility could be to scope ids by a "parent" id. So for instance <a href="https://doc.rust-lang.org/nightly/std/string/struct.String.html#method.with_capacity">https://doc.rust-lang.org/nightly/std/string/struct.String.html#method.with_capacity</a> has an <code>Examples</code> section. Instead of having that be <code>id="examples-1"</code>, it could be <code>id="method.with_capacity.examples"</code></p>



<a name="264505044"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264505044" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264505044">(Dec 10 2021 at 20:41)</a>:</h4>
<p>The topmost examples section could be <code>id="top.examples"</code></p>



<a name="264505104"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264505104" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264505104">(Dec 10 2021 at 20:41)</a>:</h4>
<p>And the examples section under <a href="https://doc.rust-lang.org/nightly/std/string/struct.String.html#method.from_utf8">https://doc.rust-lang.org/nightly/std/string/struct.String.html#method.from_utf8</a> could be <code>id="method.from_utf8.examples"</code></p>



<a name="264505321"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264505321" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264505321">(Dec 10 2021 at 20:43)</a>:</h4>
<p>basically the intuition is that instead of avoiding conflicts by knowing everything in our id namespace, we should avoid conflicts by maintaining separate namespaces for our own ids and for markdown ids.</p>



<a name="264505428"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264505428" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264505428">(Dec 10 2021 at 20:44)</a>:</h4>
<p>For my own selfish reasons, I'd love it if the numbered ids were removed in favor of something like that that appears (on the surface) to be less brittle to changes across versions</p>



<a name="264507233"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264507233" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264507233">(Dec 10 2021 at 20:59)</a>:</h4>
<p>That's also a great reason for the namespacing approach! yeah, the numbers are very brittle. That will be particularly an issue now that <a href="http://docs.rs">docs.rs</a> uses /latest/ URLs rather than redirecting to specific versions.</p>



<a name="264508011"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264508011" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264508011">(Dec 10 2021 at 21:04)</a>:</h4>
<p>I like the namespacing approach too</p>



<a name="264508050"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264508050" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264508050">(Dec 10 2021 at 21:05)</a>:</h4>
<p>no need to worry about hardcoded HTML IDs</p>



<a name="264508057"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264508057" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264508057">(Dec 10 2021 at 21:05)</a>:</h4>
<p>I love really like it</p>



<a name="264509233"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264509233" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264509233">(Dec 10 2021 at 21:14)</a>:</h4>
<p>Am I missing something or can we just have a check that runs on the doc output of tests or <code>library/std</code> to make sure there are no duplicate IDs for each page? It seems like we could use an off the shelf tool for that.</p>



<a name="264509278"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264509278" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264509278">(Dec 10 2021 at 21:15)</a>:</h4>
<p>In other words, it wouldn't compare with the ID map; it would just ensure that each page only has one occurrence of each ID.</p>



<a name="264509418"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264509418" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264509418">(Dec 10 2021 at 21:16)</a>:</h4>
<p>I think that would catch most of these issues.</p>



<a name="264509456"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264509456" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264509456">(Dec 10 2021 at 21:16)</a>:</h4>
<p>Building our own tooling just seems like too much engineering effort and maintenance cost to be worth it.</p>



<a name="264509528"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264509528" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264509528">(Dec 10 2021 at 21:16)</a>:</h4>
<p>that doesn't work because there's a good chance <code>library/std</code> happens to not duplicate any IDs, but some other crate would.</p>
<p>For instance consider <span class="user-mention" data-user-id="116155">@Jake Goulding</span>'s case - they added a <code># Structs</code> and it broke. Is there any instance of <code># Structs</code> in <code>library/std</code>? Probably not, so we wouldn't have caught that problem.</p>



<a name="264509598"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264509598" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264509598">(Dec 10 2021 at 21:17)</a>:</h4>
<p>(in fact I just grepped and there is no instance of <code># Structs</code> in <code>library/std</code>)</p>



<a name="264509705"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264509705" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264509705">(Dec 10 2021 at 21:18)</a>:</h4>
<p>We could self-check on emitting HTML and panic, once we are more confident that the problem has been fixed at the root, so that at least there's bug reports when it happens (perhaps with some kind of opt-out from the checking so that users can still build docs...?)</p>



<a name="264509736"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264509736" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264509736">(Dec 10 2021 at 21:18)</a>:</h4>
<p>But in general, yes, I think there's a need for some kind of hierarchy etc to get this right.</p>



<a name="264509971"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264509971" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264509971">(Dec 10 2021 at 21:20)</a>:</h4>
<p>I think a warning would make more sense so we don't break people's builds. Although I guess that will just get hidden on <a href="http://docs.rs">docs.rs</a>. Maybe we could have <a href="http://docs.rs">docs.rs</a> grep the output of rustdoc and report somewhere if it sees the warning?</p>



<a name="264510053"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264510053" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264510053">(Dec 10 2021 at 21:21)</a>:</h4>
<p><span class="user-mention silent" data-user-id="315412">jsha</span> <a href="#narrow/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check/near/264509528">said</a>:</p>
<blockquote>
<p>that doesn't work because there's a good chance <code>library/std</code> happens to not duplicate any IDs, but some other crate would.</p>
<p>For instance consider <span class="user-mention silent" data-user-id="116155">Jake Goulding</span>'s case - they added a <code># Structs</code> and it broke. Is there any instance of <code># Structs</code> in <code>library/std</code>? Probably not, so we wouldn't have caught that problem.</p>
</blockquote>
<p>Short of some sort of fancy static analysis, we're never going to catch <em>all</em> instances of this problem, but we might catch some at least. I don't think we should spend so much effort for a bug that is, in the end, not that big of a deal.</p>



<a name="264510188"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264510188" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264510188">(Dec 10 2021 at 21:22)</a>:</h4>
<p>The worst that happens is that</p>
<ul>
<li>styles are applied incorrectly</li>
<li>the wrong anchor is jumped to</li>
</ul>
<p>Is preventing that really worth all this effort? We'll get bug reports from users in many cases, and rustdoc has much more serious bugs that we should spend effort to prevent.</p>



<a name="264510234"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264510234" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264510234">(Dec 10 2021 at 21:23)</a>:</h4>
<p>I think that's correct. My current opinion is: switch to namespacing, which fixes the most common instances of this bug, and don't land the tidy check. Still need to keep the ID map, and add to it the missing ids we've mentioned in this thread ("Structs" and friends)</p>



<a name="264510282"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264510282" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264510282">(Dec 10 2021 at 21:23)</a>:</h4>
<p>I'm going to close the PR for now. I think it could make sense to do some kind of check (hand-rolled or off the shelf) on the std output, but other than that, I don't think it's worth it.</p>



<a name="264510283"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264510283" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264510283">(Dec 10 2021 at 21:23)</a>:</h4>
<p>Switching to namespacing also yields side benefits like having more stable and readable anchors</p>



<a name="264510303"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264510303" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264510303">(Dec 10 2021 at 21:23)</a>:</h4>
<p>Yes, namespacing seems like a good idea. I think that's a better way to solve the problem.</p>



<a name="264510554"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264510554" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264510554">(Dec 10 2021 at 21:25)</a>:</h4>
<p>Ok, I closed the PR.</p>



<a name="264510978"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264510978" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264510978">(Dec 10 2021 at 21:28)</a>:</h4>
<p>I've also opened two issues to track the primary outcomes of this discussion: <a href="https://github.com/rust-lang/rust/issues/91758">#91758</a> and <a href="https://github.com/rust-lang/rust/issues/91759">#91759</a>.</p>



<a name="264511780"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264511780" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264511780">(Dec 10 2021 at 21:35)</a>:</h4>
<p>I'm happy to edit the descriptions for those to be a nice summary of the discussion so folks don't have to read through the zulip. What's the ettiquette - is it okay to just edit the top post even though that makes it look like my words were said by you (which is ok by me if it's ok by you)?</p>



<a name="264511809"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264511809" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264511809">(Dec 10 2021 at 21:35)</a>:</h4>
<p>I'll check for an answer later, right now heading out to try and get boosted <span aria-label="injection" class="emoji emoji-1f489" role="img" title="injection">:injection:</span></p>



<a name="264512976"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264512976" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264512976">(Dec 10 2021 at 21:46)</a>:</h4>
<p>Etiquette about editing posts varies somewhat. Usually editing the top post is more okay. Sometimes I put <code>EDIT(camelid)</code> to make it clear it's me. In this case, feel free to add some summaries :)</p>



<a name="264513008"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264513008" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264513008">(Dec 10 2021 at 21:47)</a>:</h4>
<p>People can also see the edit history if they want to know who wrote it</p>



<a name="264514839"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264514839" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264514839">(Dec 10 2021 at 22:02)</a>:</h4>
<p><span class="user-mention silent" data-user-id="307537">Noah Lev</span> <a href="#narrow/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check/near/264509233">said</a>:</p>
<blockquote>
<p>Am I missing something or can we just have a check that runs on the doc output of tests or <code>library/std</code> to make sure there are no duplicate IDs for each page? It seems like we could use an off the shelf tool for that.</p>
</blockquote>
<p>I said it multiple times but maybe I wasn't clear (sorry): there is a test which checks that there is no duplicated IDs</p>



<a name="264515586"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264515586" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264515586">(Dec 10 2021 at 22:09)</a>:</h4>
<p>Ah, where is it? I'm curious to see it.</p>



<a name="264515621"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264515621" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264515621">(Dec 10 2021 at 22:09)</a>:</h4>
<p>Updated the issues (alas no booster; I was hoping the local pharmacy had walkups)</p>



<a name="264516733"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264516733" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264516733">(Dec 10 2021 at 22:17)</a>:</h4>
<p><span class="user-mention silent" data-user-id="307537">Noah Lev</span> <a href="#narrow/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check/near/264515586">said</a>:</p>
<blockquote>
<p>Ah, where is it? I'm curious to see it.</p>
</blockquote>
<p><code>src/tools/linkchecker/main.rs</code> line 552</p>



<a name="264516739"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264516739" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264516739">(Dec 10 2021 at 22:17)</a>:</h4>
<p>:)</p>



<a name="264524994"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264524994" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264524994">(Dec 10 2021 at 23:42)</a>:</h4>
<blockquote>
<p>I think a warning would make more sense so we don't break people's builds. Although I guess that will just get hidden on <a href="http://docs.rs">docs.rs</a>. Maybe we could have <a href="http://docs.rs">docs.rs</a> grep the output of rustdoc and report somewhere if it sees the warning?</p>
</blockquote>
<p>Please no, I don't want to have to add GitHub authentication to <a href="http://docs.rs">docs.rs</a>. Plus it will be too noisy to reasonably deal with.</p>
<p>We could add it to sentry issues but I really don't want to be the only person with access to both rustdoc and sentry, and I suspect there will be way too many false positives to have any hope of dealing with it manually.</p>



<a name="264525336"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264525336" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264525336">(Dec 10 2021 at 23:45)</a>:</h4>
<p>Yeah, I realized that it's not worth it</p>



<a name="264559006"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264559006" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264559006">(Dec 11 2021 at 12:03)</a>:</h4>
<p>If you go the namespace route, is it possible for rustdoc to provide a warning to the user if they create an id that starts with that namespace?</p>



<a name="264559066"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264559066" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264559066">(Dec 11 2021 at 12:04)</a>:</h4>
<p>E.g. if you picked <code>rd-</code> and I had the markdown <code># rd-cowabunga</code>?</p>



<a name="264559075"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264559075" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264559075">(Dec 11 2021 at 12:04)</a>:</h4>
<p>So not even an exact match, just a prefix match</p>



<a name="264573803"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264573803" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264573803">(Dec 11 2021 at 17:24)</a>:</h4>
<p>That wouldn't be an issue, because <code># rd-cowabunga</code> would become <code>id="rd-rd-cowabunga"</code></p>



<a name="264574355"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264574355" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264574355">(Dec 11 2021 at 17:34)</a>:</h4>
<p>(I have that reference!)</p>



<a name="264582339"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264582339" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264582339">(Dec 11 2021 at 20:19)</a>:</h4>
<p><span class="user-mention silent" data-user-id="315412">jsha</span> <a href="#narrow/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check/near/264573803">said</a>:</p>
<blockquote>
<p>That wouldn't be an issue, because <code># rd-cowabunga</code> would become <code>id="rd-rd-cowabunga"</code></p>
</blockquote>
<p>So you are going to put all the <em>user</em> specified IDs into a namespace? I must have misunderstood.</p>



<a name="264582439"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264582439" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264582439">(Dec 11 2021 at 20:21)</a>:</h4>
<p>I think the idea was to prefix user IDs by the section of the docs they were in. E.g., a header for the method <code>my_method</code> would get the id <code>#method.my_method.the-header</code>.</p>



<a name="264582529"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264582529" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264582529">(Dec 11 2021 at 20:23)</a>:</h4>
<p>Do we currently have plans to change the format for method/field/etc. URL fragments? I know <span class="user-mention" data-user-id="232545">@Joshua Nelson</span> has suggested changing <code>struct.Foo.html</code> to <code>t.Foo.html</code>, but I wasn't sure if there were similar ideas for URL fragments.</p>



<a name="264582548"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264582548" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264582548">(Dec 11 2021 at 20:23)</a>:</h4>
<p>The difficulty of changing URL fragments is that redirects are harder.</p>



<a name="264582568"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264582568" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264582568">(Dec 11 2021 at 20:23)</a>:</h4>
<p>But if we think we might change them soon, we might want to wait on the namespacing to avoid having to create even more redirects.</p>



<a name="264582715"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264582715" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264582715">(Dec 11 2021 at 20:26)</a>:</h4>
<p>That RFC's been open a year, I don't have much hope of it getting accepted</p>



<a name="264582863"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264582863" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264582863">(Dec 11 2021 at 20:29)</a>:</h4>
<p>Did you end up opening an RFC? I thought it was just a pre-RFC but I may have missed it</p>



<a name="264583178"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/264583178" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#264583178">(Dec 11 2021 at 20:36)</a>:</h4>
<p>Found it: <a href="https://github.com/rust-lang/rfcs/issues/2988">rfcs#2988</a></p>



<a name="265295399"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/DOM%20id%20tidy%20check/near/265295399" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check.html#265295399">(Dec 17 2021 at 13:31)</a>:</h4>
<p><span class="user-mention silent" data-user-id="307537">Noah Lev</span> <a href="#narrow/stream/266220-rustdoc/topic/DOM.20id.20tidy.20check/near/264582548">said</a>:</p>
<blockquote>
<p>The difficulty of changing URL fragments is that redirects are harder.</p>
</blockquote>
<p>I don't see how it impacts the namespacing of the markdown headings ID: we don't link to them. Or were you talking about something else?</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>