<html>
<head><meta charset="utf-8"><title>updating tests in #92745 · rustdoc · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/index.html">rustdoc</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745.html">updating tests in #92745</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="267917177"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/updating%20tests%20in%20%2392745/near/267917177" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745.html#267917177">(Jan 13 2022 at 19:19)</a>:</h4>
<p><span class="user-mention" data-user-id="316352">@pierwill</span> let's move the discussion about the tests to Zulip. It'll be easier to discuss here.</p>



<a name="267917270"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/updating%20tests%20in%20%2392745/near/267917270" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745.html#267917270">(Jan 13 2022 at 19:20)</a>:</h4>
<p>You're very close, you only have 2 tests left to be updated</p>



<a name="267917297"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/updating%20tests%20in%20%2392745/near/267917297" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745.html#267917297">(Jan 13 2022 at 19:20)</a>:</h4>
<p>One just needs its IDs updated:</p>
<div class="codehilite"><pre><span></span><code>39: @has check failed
1832
    `XPATH PATTERN` did not match
1833
    // @has foo/struct.Foo.html &#39;//div[@id=&quot;impl-Foo&quot;]/h3[@class=&quot;code-header in-band&quot;]&#39; &#39;impl&lt;const M: usize&gt; Foo&lt;M&gt; where u8: Trait&lt;M&gt;&#39;
1834
50: @has check failed
1835
    `XPATH PATTERN` did not match
1836
    // @has foo/struct.Bar.html &#39;//div[@id=&quot;impl-Bar&quot;]/h3[@class=&quot;code-header in-band&quot;]&#39; &#39;impl&lt;const M: usize&gt; Bar&lt;u8, M&gt;&#39;
1837

1838
Encountered 2 errors
1839
</code></pre></div>



<a name="267917374"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/updating%20tests%20in%20%2392745/near/267917374" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745.html#267917374">(Jan 13 2022 at 19:21)</a>:</h4>
<p>(I think just <code>impl-Foo</code> to <code>impl-Foo&lt;M&gt;</code> etc.)</p>



<a name="267917425"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/updating%20tests%20in%20%2392745/near/267917425" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745.html#267917425">(Jan 13 2022 at 19:21)</a>:</h4>
<p>The other one I think just needs its quotes fixed:</p>
<div class="codehilite"><pre><span></span><code>KeyError: (&#39;.//div[@id=&quot;impl-Escape&lt;r#&quot;&lt;script&gt;alert(&quot;Escape&quot;)%3B&lt;/script&gt;&quot;#&gt;&quot;]/h3[@class=&quot;code-header in-band&quot;]&#39;,)
1797
</code></pre></div>



<a name="267917604"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/updating%20tests%20in%20%2392745/near/267917604" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745.html#267917604">(Jan 13 2022 at 19:22)</a>:</h4>
<p>Notice how you have <code>[@id="</code> but then <code>r#"</code>; the quotes within the ID are messing with the quotes enclosing the ID</p>



<a name="267917664"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/updating%20tests%20in%20%2392745/near/267917664" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745.html#267917664">(Jan 13 2022 at 19:23)</a>:</h4>
<p>So I think you just need to escape the <code>"</code> inside the ID with <code>\"</code>. If that doesn't work, we'll try to come up with a different solution</p>



<a name="267917680"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/updating%20tests%20in%20%2392745/near/267917680" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745.html#267917680">(Jan 13 2022 at 19:23)</a>:</h4>
<p>cc <span class="user-mention" data-user-id="315412">@jsha</span> as well</p>



<a name="267920892"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/updating%20tests%20in%20%2392745/near/267920892" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745.html#267920892">(Jan 13 2022 at 19:49)</a>:</h4>
<p><span class="user-mention" data-user-id="307537">@Noah Lev</span> Thanks for the help! Those two suggestions aren't working, tho: <a href="https://github.com/rust-lang/rust/pull/92745/commits/d5d98a27c2fac7816b7e5a620cddaf5cc2c240be">https://github.com/rust-lang/rust/pull/92745/commits/d5d98a27c2fac7816b7e5a620cddaf5cc2c240be</a></p>



<a name="267920933"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/updating%20tests%20in%20%2392745/near/267920933" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745.html#267920933">(Jan 13 2022 at 19:50)</a>:</h4>
<p>Maybe i'll try this again: <a href="https://github.com/rust-lang/rust/pull/92745/commits/d5d98a27c2fac7816b7e5a620cddaf5cc2c240be#r782702781">https://github.com/rust-lang/rust/pull/92745/commits/d5d98a27c2fac7816b7e5a620cddaf5cc2c240be#r782702781</a></p>



<a name="267921231"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/updating%20tests%20in%20%2392745/near/267921231" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745.html#267921231">(Jan 13 2022 at 19:52)</a>:</h4>
<p>BTW, just making sure you know about a couple of tricks to shorten the debug cycle:</p>
<ul>
<li>You can run a single test with <code>./x.py test src/test/rustdoc/const-generics/const-generics-docs.rs</code></li>
<li>The built HTML for a given test case is in build/x86_64-unknown-linux-gnu/test/rustdoc/const-generics/const-generics-docs/ (but I assume you know this since you mentioned copy-pasting from the HTML)</li>
</ul>



<a name="267921367"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/updating%20tests%20in%20%2392745/near/267921367" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745.html#267921367">(Jan 13 2022 at 19:52)</a>:</h4>
<p>Also, I haven't used this, but there's an XPath evaluator in JS that might enable you to try out different expressions faster: <a href="https://developer.mozilla.org/en-US/docs/Web/XPath/Introduction_to_using_XPath_in_JavaScript">https://developer.mozilla.org/en-US/docs/Web/XPath/Introduction_to_using_XPath_in_JavaScript</a></p>
<p>Though note that our tests use a bit of a custom XPath library that might not be exactly like other systems.</p>



<a name="267921579"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/updating%20tests%20in%20%2392745/near/267921579" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745.html#267921579">(Jan 13 2022 at 19:54)</a>:</h4>
<p>why oh why can't this test show the expected and actual output?</p>



<a name="267922097"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/updating%20tests%20in%20%2392745/near/267922097" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745.html#267922097">(Jan 13 2022 at 19:59)</a>:</h4>
<p>Yeah, I know it's frustrating :(</p>



<a name="267922292"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/updating%20tests%20in%20%2392745/near/267922292" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745.html#267922292">(Jan 13 2022 at 20:00)</a>:</h4>
<p>This difficulty in updating tests is part of why I added <a href="https://github.com/rust-lang/rust/blob/256721ee519f6ff15dc5c1cfaf3ebf9af75efa4a/src/etc/htmldocck.py#L97-L105">snapshot tests</a> to rustdoc, but I don't know if they'd work for this purpose</p>



<a name="267922436"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/updating%20tests%20in%20%2392745/near/267922436" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745.html#267922436">(Jan 13 2022 at 20:01)</a>:</h4>
<p><span class="user-mention" data-user-id="316352">@pierwill</span> can you post the relevant parts of the HTML for both tests that you're having trouble with?</p>



<a name="267922567"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/updating%20tests%20in%20%2392745/near/267922567" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745.html#267922567">(Jan 13 2022 at 20:02)</a>:</h4>
<p><span class="user-mention silent" data-user-id="307537">Noah Lev</span> <a href="#narrow/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745/near/267922436">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="316352">pierwill</span> can you post the relevant parts of the HTML for both tests that you're having trouble with?</p>
</blockquote>
<p>this is probably all my fault... I've just been grabbing it from the url bar at the top of the browser after clicking... i'll go in and inspect the actual source....</p>



<a name="267922901"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/updating%20tests%20in%20%2392745/near/267922901" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745.html#267922901">(Jan 13 2022 at 20:04)</a>:</h4>
<p>okay only one failing now!</p>



<a name="267923239"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/updating%20tests%20in%20%2392745/near/267923239" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745.html#267923239">(Jan 13 2022 at 20:07)</a>:</h4>
<p><a href="/user_uploads/4715/pMVLxh-GYTmhX-S1KZBbBrrp/Screen-Shot-2022-01-13-at-2.06.32-PM.png">Screen-Shot-2022-01-13-at-2.06.32-PM.png</a> </p>
<div class="message_inline_image"><a href="/user_uploads/4715/pMVLxh-GYTmhX-S1KZBbBrrp/Screen-Shot-2022-01-13-at-2.06.32-PM.png" title="Screen-Shot-2022-01-13-at-2.06.32-PM.png"><img src="/user_uploads/4715/pMVLxh-GYTmhX-S1KZBbBrrp/Screen-Shot-2022-01-13-at-2.06.32-PM.png"></a></div><p><code>#impl-Escape%3Cr#%22%3Cscript%3Ealert(%22Escape%22)%3B%3C/script%3E%22#%3E</code></p>



<a name="267923270"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/updating%20tests%20in%20%2392745/near/267923270" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745.html#267923270">(Jan 13 2022 at 20:07)</a>:</h4>
<p>it's still not happy tho...</p>



<a name="267923438"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/updating%20tests%20in%20%2392745/near/267923438" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745.html#267923438">(Jan 13 2022 at 20:08)</a>:</h4>
<p>ah!</p>



<a name="267923534"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/updating%20tests%20in%20%2392745/near/267923534" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745.html#267923534">(Jan 13 2022 at 20:09)</a>:</h4>
<p>FWIW, the version you see in Dev Tools in your browser is transformed in subtle ways. That may not always matter, but if you want to look at the exact thing the tests are operating on, you should open the HTML source - either with View Source, or opening it in your favorite editor.</p>



<a name="267923553"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/updating%20tests%20in%20%2392745/near/267923553" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745.html#267923553">(Jan 13 2022 at 20:09)</a>:</h4>
<p>Feel free to post any errors :)</p>



<a name="267923578"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/updating%20tests%20in%20%2392745/near/267923578" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745.html#267923578">(Jan 13 2022 at 20:09)</a>:</h4>
<p><span class="user-mention silent" data-user-id="315412">jsha</span> <a href="#narrow/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745/near/267923534">said</a>:</p>
<blockquote>
<p>FWIW, the version you see in Dev Tools in your browser is transformed in subtle ways. That may not always matter, but if you want to look at the exact thing the tests are operating on, you should open the HTML source - either with View Source, or opening it in your favorite editor.</p>
</blockquote>
<p>Interesting, I didn't know that!</p>



<a name="267923677"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/updating%20tests%20in%20%2392745/near/267923677" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745.html#267923677">(Jan 13 2022 at 20:10)</a>:</h4>
<p>passing <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span> </p>
<p>now there's more test suites, right lol</p>



<a name="267923735"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/updating%20tests%20in%20%2392745/near/267923735" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745.html#267923735">(Jan 13 2022 at 20:10)</a>:</h4>
<p>That's the main one though <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span></p>



<a name="267923811"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/updating%20tests%20in%20%2392745/near/267923811" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745.html#267923811">(Jan 13 2022 at 20:11)</a>:</h4>
<div class="codehilite"><pre><span></span><code>stdoc-gui (12 concurrently) ...
........F. (10/57)
......F... (20/57)
F......... (30/57)
..F....... (40/57)
.......... (50/57)
.......    (57/57)


/Users/user/repos/rust/src/test/rustdoc-gui/anchors.goml anchors... FAILED
[ERROR] (line 31) Error: No node found for selector: #impl: for command `move-cursor-to: &quot;#impl&quot;`

/Users/user/repos/rust/src/test/rustdoc-gui/headings.goml headings... FAILED
[ERROR] (line 37) &quot;#impl &gt; h3.code-header&quot; not found: for command `assert-css: (&quot;#impl &gt; h3.code-header&quot;, {&quot;font-size&quot;: &quot;17.6px&quot;})`

/Users/user/repos/rust/src/test/rustdoc-gui/headers-color.goml headers-color... FAILED
[ERROR] (line 27) &quot;#impl&quot; not found: for command `assert-css: (
    &quot;#impl&quot;,
    {&quot;color&quot;: &quot;rgb(197, 197, 197)&quot;, &quot;background-color&quot;: &quot;rgba(255, 236, 164, 0.06)&quot;},
)`

/Users/user/repos/rust/src/test/rustdoc-gui/search-filter.goml search-filter... FAILED
[ERROR] (line 17) assert didn&#39;t fail: for command `assert-false: &quot;#results .externcrate&quot;`



command did not execute successfully: &quot;/usr/local/bin/node&quot; &quot;/Users/user/repos/rust/src/tools/rustdoc-gui/tester.js&quot; &quot;--jobs&quot; &quot;12&quot; &quot;--doc-folder&quot; &quot;/Users/user/repos/rust/build/x86_64-apple-darwin/test/rustdoc-gui/doc&quot; &quot;--tests-folder&quot; &quot;/Users/user/repos/rust/src/test/rustdoc-gui&quot;
expected success, got: exit status: 1


Build completed unsuccessfully in 0:00:34
</code></pre></div>



<a name="267923854"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/updating%20tests%20in%20%2392745/near/267923854" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745.html#267923854">(Jan 13 2022 at 20:11)</a>:</h4>
<p>Yeah, basically, you need to update the same things <code>impl</code> -&gt; <code>impl-...-for-...</code> or <code>impl-...</code></p>



<a name="267923950"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/updating%20tests%20in%20%2392745/near/267923950" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745.html#267923950">(Jan 13 2022 at 20:12)</a>:</h4>
<p>And this one? </p>
<div class="codehilite"><pre><span></span><code>Users/user/repos/rust/src/test/rustdoc-gui/search-filter.goml search-filter... FAILED
[ERROR] (line 17) assert didn&#39;t fail: for command `assert-false: &quot;#results .externcrate&quot;`
</code></pre></div>



<a name="267923969"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/updating%20tests%20in%20%2392745/near/267923969" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745.html#267923969">(Jan 13 2022 at 20:12)</a>:</h4>
<p>If you change the DOM, pretty much all tests fail yes ^^'</p>



<a name="267923979"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/updating%20tests%20in%20%2392745/near/267923979" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745.html#267923979">(Jan 13 2022 at 20:12)</a>:</h4>
<p>DOM?</p>



<a name="267923989"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/updating%20tests%20in%20%2392745/near/267923989" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745.html#267923989">(Jan 13 2022 at 20:13)</a>:</h4>
<p>HTML</p>



<a name="267924328"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/updating%20tests%20in%20%2392745/near/267924328" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745.html#267924328">(Jan 13 2022 at 20:16)</a>:</h4>
<p><span class="user-mention silent" data-user-id="316352">pierwill</span> <a href="#narrow/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745/near/267923950">said</a>:</p>
<blockquote>
<p>And this one? </p>
<p><div class="codehilite"><pre><span></span><code>Users/user/repos/rust/src/test/rustdoc-gui/search-filter.goml search-filter... FAILED
[ERROR] (line 17) assert didn&#39;t fail: for command `assert-false: &quot;#results .externcrate&quot;`
</code></pre></div><br>
</p>
</blockquote>
<p>Um... no clue</p>



<a name="267924342"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/updating%20tests%20in%20%2392745/near/267924342" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745.html#267924342">(Jan 13 2022 at 20:16)</a>:</h4>
<p>Maybe leave that one as-is for now and we'll come back to it <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="267924343"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/updating%20tests%20in%20%2392745/near/267924343" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745.html#267924343">(Jan 13 2022 at 20:16)</a>:</h4>
<p>To be more exact, DOM is how we call the structure of your HTML document</p>



<a name="267924375"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/updating%20tests%20in%20%2392745/near/267924375" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745.html#267924375">(Jan 13 2022 at 20:16)</a>:</h4>
<p><span class="user-mention silent" data-user-id="307537">Noah Lev</span> <a href="#narrow/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745/near/267924328">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="316352">pierwill</span> <a href="#narrow/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745/near/267923950">said</a>:</p>
<blockquote>
<p>And this one? </p>
<p><div class="codehilite"><pre><span></span><code>Users/user/repos/rust/src/test/rustdoc-gui/search-filter.goml search-filter... FAILED
[ERROR] (line 17) assert didn&#39;t fail: for command `assert-false: &quot;#results .externcrate&quot;`
</code></pre></div><br>
</p>
</blockquote>
<p>Um... no clue</p>
</blockquote>
<p>It means that the command was supposed to fail and didn't haha</p>



<a name="267924390"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/updating%20tests%20in%20%2392745/near/267924390" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745.html#267924390">(Jan 13 2022 at 20:16)</a>:</h4>
<p>let me check what it checks</p>



<a name="267924402"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/updating%20tests%20in%20%2392745/near/267924402" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745.html#267924402">(Jan 13 2022 at 20:16)</a>:</h4>
<p>In my changes, I removed some code from implIds about <code>is_foreign_type</code> or something like that... maybe that has to do with this externcrate test?</p>



<a name="267924428"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/updating%20tests%20in%20%2392745/near/267924428" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745.html#267924428">(Jan 13 2022 at 20:17)</a>:</h4>
<p>foreign types are different</p>



<a name="267924447"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/updating%20tests%20in%20%2392745/near/267924447" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745.html#267924447">(Jan 13 2022 at 20:17)</a>:</h4>
<p><span class="user-mention silent" data-user-id="210316">GuillaumeGomez</span> <a href="#narrow/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745/near/267924343">said</a>:</p>
<blockquote>
<p>To be more exact, DOM is how we call the structure of your HTML document</p>
</blockquote>
<p><span class="user-mention" data-user-id="316352">@pierwill</span> <a href="https://en.wikipedia.org/wiki/Document_Object_Model">https://en.wikipedia.org/wiki/Document_Object_Model</a></p>



<a name="267924563"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/updating%20tests%20in%20%2392745/near/267924563" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745.html#267924563">(Jan 13 2022 at 20:18)</a>:</h4>
<p>So, the test which fails is checking that the search results doesn't contain something. In your case, this something is showing up (which is very surprising), meaning the filter isn't working?</p>



<a name="267924574"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/updating%20tests%20in%20%2392745/near/267924574" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745.html#267924574">(Jan 13 2022 at 20:18)</a>:</h4>
<p>Right - if we want to get really precise, HTML is the raw bytes, and when the browser loads them into a page, that becomes the DOM - which can be manipulated by JS.</p>
<p>That's the main way in which the Dev Tools view is different - it represents the DOM, which is after parsing and after any JS manipulations.</p>



<a name="267925013"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/updating%20tests%20in%20%2392745/near/267925013" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745.html#267925013">(Jan 13 2022 at 20:22)</a>:</h4>
<p>How do I find the HTML for these <code>goml</code> tests? <a href="https://github.com/pierwill/rust/blob/4575f5fc7a12fb883c0fba18e039d04f1bc57b76/src/test/rustdoc-gui/anchors.goml#L31">https://github.com/pierwill/rust/blob/4575f5fc7a12fb883c0fba18e039d04f1bc57b76/src/test/rustdoc-gui/anchors.goml#L31</a></p>



<a name="267925115"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/updating%20tests%20in%20%2392745/near/267925115" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745.html#267925115">(Jan 13 2022 at 20:23)</a>:</h4>
<p>it's generated in <code>build/[arch]/tests/rustdoc-gui</code></p>



<a name="267925224"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/updating%20tests%20in%20%2392745/near/267925224" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745.html#267925224">(Jan 13 2022 at 20:24)</a>:</h4>
<p>In this case, <code>goto</code> is in the <code>test_docs</code> crate, so <code>test_docs/index.html</code></p>



<a name="267925235"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/updating%20tests%20in%20%2392745/near/267925235" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745.html#267925235">(Jan 13 2022 at 20:24)</a>:</h4>
<p>just open it with your web browser</p>



<a name="267926304"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/updating%20tests%20in%20%2392745/near/267926304" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745.html#267926304">(Jan 13 2022 at 20:33)</a>:</h4>
<p>and if you want to run a single test and see it in the browser, run something like:</p>
<div class="codehilite"><pre><span></span><code>node src/tools/rustdoc-gui/tester.js --no-headless --tests-folder src/test/rustdoc-gui/ --doc-folder $PWD/build/x86_64-unknown-linux-gnu/test/rustdoc-gui/doc --show-text --file type-declation-overflow.goml
</code></pre></div>
<p>Note: you'll also have to add a <code>wait-for: 100000</code> before whatever assertion is failing, so the browser will stay open long enough to debug</p>



<a name="267926949"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/updating%20tests%20in%20%2392745/near/267926949" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745.html#267926949">(Jan 13 2022 at 20:39)</a>:</h4>
<p><span class="user-mention silent" data-user-id="315412">jsha</span> <a href="#narrow/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745/near/267926304">said</a>:</p>
<blockquote>
<p>and if you want to run a single test and see it in the browser...</p>
</blockquote>
<p>Thanks but this makes my brain hurt <span aria-label="grinning face with smiling eyes" class="emoji emoji-1f601" role="img" title="grinning face with smiling eyes">:grinning_face_with_smiling_eyes:</span></p>



<a name="267927088"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/updating%20tests%20in%20%2392745/near/267927088" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745.html#267927088">(Jan 13 2022 at 20:40)</a>:</h4>
<p>Still getting</p>
<div class="codehilite"><pre><span></span><code>/repos/rust/src/test/rustdoc-gui/anchors.goml anchors... FAILED
[ERROR] (line 31) Error: No node found for selector: impl-Foo: for command `move-cursor-to: &quot;impl-Foo&quot;`
</code></pre></div>
<p>despite</p>
<div class="codehilite"><pre><span></span><code>&lt;a href=&quot;#impl-Foo&quot; class=&quot;anchor&quot;&gt;&lt;/a&gt;
</code></pre></div>



<a name="267927153"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/updating%20tests%20in%20%2392745/near/267927153" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745.html#267927153">(Jan 13 2022 at 20:40)</a>:</h4>
<p>in the goml file:</p>
<div class="codehilite" data-code-language="Diff"><pre><span></span><code><span class="gd">-move-cursor-to: "#impl"</span>
<span class="gi">+move-cursor-to: "#impl-Foo"</span>
</code></pre></div>



<a name="267928293"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/updating%20tests%20in%20%2392745/near/267928293" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745.html#267928293">(Jan 13 2022 at 20:50)</a>:</h4>
<p>ah! maybe....</p>



<a name="267928326"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/updating%20tests%20in%20%2392745/near/267928326" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745.html#267928326">(Jan 13 2022 at 20:50)</a>:</h4>
<p><code>&lt;a href="#impl-Foo&gt;</code> means "here's a link that will take you to #impl-Foo".</p>
<p>What this test failure is telling you is: There should be something like <code>&lt;h3 id="#impl-Foo"&gt;</code> somewhere, and I can't find it.</p>



<a name="267928386"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/updating%20tests%20in%20%2392745/near/267928386" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745.html#267928386">(Jan 13 2022 at 20:51)</a>:</h4>
<p>Or in other words, <code>&lt;a&gt;</code> is like the pointer, and <code>&lt;h3 id="...."&gt;</code> is the pointed-to object :-D</p>



<a name="267930295"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/updating%20tests%20in%20%2392745/near/267930295" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745.html#267930295">(Jan 13 2022 at 21:05)</a>:</h4>
<p>Finally got <code>x test src/test/rustdoc-gui*</code> to pass! <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span></p>



<a name="267930648"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/updating%20tests%20in%20%2392745/near/267930648" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745.html#267930648">(Jan 13 2022 at 21:07)</a>:</h4>
<p><code>@rustbot ready</code> <span aria-label="innocent" class="emoji emoji-1f607" role="img" title="innocent">:innocent:</span></p>



<a name="267931107"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/updating%20tests%20in%20%2392745/near/267931107" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/updating.20tests.20in.20.2392745.html#267931107">(Jan 13 2022 at 21:10)</a>:</h4>
<p>congratulations! thanks for working through all those test failures. sorry it was such a slog.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>