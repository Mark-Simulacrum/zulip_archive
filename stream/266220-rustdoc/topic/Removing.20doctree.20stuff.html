<html>
<head><meta charset="utf-8"><title>Removing doctree stuff · rustdoc · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/index.html">rustdoc</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html">Removing doctree stuff</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="222763658"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222763658" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> CraftSpider <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222763658">(Jan 14 2021 at 18:48)</a>:</h4>
<p>Is anyone currently working on removing <code>doctree::Import</code>?</p>



<a name="222769456"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222769456" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222769456">(Jan 14 2021 at 19:27)</a>:</h4>
<p><span class="user-mention" data-user-id="319144">@Rune Tynan</span> not that I know of :)</p>



<a name="222769481"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222769481" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222769481">(Jan 14 2021 at 19:27)</a>:</h4>
<p>it might be tricky though - I think <code>Import</code> is used for inlining</p>



<a name="222769784"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222769784" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> CraftSpider <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222769784">(Jan 14 2021 at 19:29)</a>:</h4>
<p>It looks like it is, but also that the inlining part of the clean implementation doesn't use anything not easily available from the Item or its Kind</p>



<a name="222769859"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222769859" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222769859">(Jan 14 2021 at 19:29)</a>:</h4>
<p>gotcha - you can remove <code>doctree::Import</code> without changing much code in <code>visit_ast</code> or clean</p>



<a name="222769869"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222769869" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222769869">(Jan 14 2021 at 19:29)</a>:</h4>
<p>sounds perfect :)</p>



<a name="222770146"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222770146" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> CraftSpider <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222770146">(Jan 14 2021 at 19:31)</a>:</h4>
<p>Yeah. I'm running tests now (I actually started doing the work, then thought 'wait I should ask if this is necessary'), I basically just ripped out <code>Import</code>, replaced <code>impl Clean</code> with <code>clean_use_statement</code>, and made <code>Item {...}</code> into <code>Item::from_def_id_and_parts</code></p>



<a name="222771959"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222771959" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> CraftSpider <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222771959">(Jan 14 2021 at 19:41)</a>:</h4>
<p>I got what looks like an unrelated failure from <code>issue-80893.rs</code>, about 'failed to spawn rustc process: The system cannot find the file specified'</p>



<a name="222771997"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222771997" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> CraftSpider <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222771997">(Jan 14 2021 at 19:41)</a>:</h4>
<p>Other than that, rustdoc-ui and rustdoc suites pass</p>



<a name="222772167"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222772167" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222772167">(Jan 14 2021 at 19:42)</a>:</h4>
<p><span class="user-mention silent" data-user-id="319144">Rune Tynan</span> <a href="#narrow/stream/266220-rustdoc/topic/Removing.20doctree.20stuff/near/222771959">said</a>:</p>
<blockquote>
<p>I got what looks like an unrelated failure from <code>issue-80893.rs</code>, about 'failed to spawn rustc process: The system cannot find the file specified'</p>
</blockquote>
<p>hmm, is that a doctest or something?</p>



<a name="222772272"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222772272" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> CraftSpider <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222772272">(Jan 14 2021 at 19:43)</a>:</h4>
<div class="codehilite"><pre><span></span><code>// compile-flags: --test -Z unstable-options --test-builder true

/// ```no_run
/// This tests that `--test-builder` is accepted as a flag by rustdoc.
/// ```
pub struct Foo;
</code></pre></div>



<a name="222772580"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222772580" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222772580">(Jan 14 2021 at 19:44)</a>:</h4>
<p>oh lol I don't think <code>true</code> exists on windows</p>



<a name="222772625"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222772625" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222772625">(Jan 14 2021 at 19:45)</a>:</h4>
<p>I would just ignore that error, or if you have time find some innocuous command that's on both windows and linux</p>



<a name="222773614"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222773614" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> CraftSpider <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222773614">(Jan 14 2021 at 19:51)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/issues/81021">https://github.com/rust-lang/rust/issues/81021</a> opened</p>



<a name="222777836"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222777836" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> CraftSpider <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222777836">(Jan 14 2021 at 20:19)</a>:</h4>
<p>doctree::Variant looks like the easiest thing to remove: 1 use in all places, impl Clean for Variant, never constructed or referenced</p>



<a name="222778182"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222778182" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222778182">(Jan 14 2021 at 20:22)</a>:</h4>
<p>I really wish the compiler would warn about unused <code>impl</code>s</p>



<a name="222778204"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222778204" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222778204">(Jan 14 2021 at 20:22)</a>:</h4>
<p>I have a feeling there's a ton floating around rustdoc</p>



<a name="222778592"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222778592" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> CraftSpider <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222778592">(Jan 14 2021 at 20:24)</a>:</h4>
<p>Staples: that was easy<br>
<a href="https://github.com/rust-lang/rust/pull/81023">https://github.com/rust-lang/rust/pull/81023</a></p>



<a name="222778668"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222778668" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222778668">(Jan 14 2021 at 20:25)</a>:</h4>
<p>I got in trouble on a final project once for saying that lol</p>



<a name="222778684"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222778684" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222778684">(Jan 14 2021 at 20:25)</a>:</h4>
<p>teacher called me a smartass but gave me a 100 anyway <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="222778730"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222778730" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> CraftSpider <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222778730">(Jan 14 2021 at 20:25)</a>:</h4>
<p>Hahaha</p>



<a name="222779414"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222779414" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> CraftSpider <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222779414">(Jan 14 2021 at 20:30)</a>:</h4>
<p>The <code>StructType</code> enum is used in clean types, it and its associated function look like it might be worth to just move them into <code>clean/types.rs</code>. And maybe remove the duplicate type in the json rendering module</p>



<a name="222779457"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222779457" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222779457">(Jan 14 2021 at 20:30)</a>:</h4>
<p>I would prefer to keep the JSON stuff for now</p>



<a name="222779488"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222779488" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222779488">(Jan 14 2021 at 20:30)</a>:</h4>
<p>it's buggy enough without tying it to the rest of rustdoc</p>



<a name="222779529"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222779529" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222779529">(Jan 14 2021 at 20:31)</a>:</h4>
<p>but yeah, +1 to moving things from doctree to clean</p>



<a name="222779538"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222779538" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> CraftSpider <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222779538">(Jan 14 2021 at 20:31)</a>:</h4>
<p>Alright, so all the JSON stuff getting cleaned up is its own whole project</p>



<a name="222779561"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222779561" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222779561">(Jan 14 2021 at 20:31)</a>:</h4>
<p>well, getting it to work at <em>all</em> is a project <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="222779566"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222779566" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222779566">(Jan 14 2021 at 20:31)</a>:</h4>
<p>it ICEs half the time right now</p>



<a name="222779600"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222779600" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222779600">(Jan 14 2021 at 20:31)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/issues/80664">https://github.com/rust-lang/rust/issues/80664</a></p>



<a name="222779732"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222779732" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> CraftSpider <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222779732">(Jan 14 2021 at 20:32)</a>:</h4>
<p>Sounds like a Good Time™</p>



<a name="222780199"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222780199" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222780199">(Jan 14 2021 at 20:36)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/266220-rustdoc/topic/Removing.20doctree.20stuff/near/222779566">said</a>:</p>
<blockquote>
<p>it ICEs half the time right now</p>
</blockquote>
<p>speaking of which <a href="https://github.com/rust-lang/rust/pull/81021#issuecomment-760456663">https://github.com/rust-lang/rust/pull/81021#issuecomment-760456663</a></p>



<a name="222780366"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222780366" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> CraftSpider <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222780366">(Jan 14 2021 at 20:37)</a>:</h4>
<p>Looking at that error, and the code it errored on, it looks like that code expects python3 but was run with python2</p>



<a name="222780504"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222780504" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> CraftSpider <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222780504">(Jan 14 2021 at 20:38)</a>:</h4>
<p><code>super()</code> is a python3 construct, for python2 you use <code>super(ClsName, instance)</code></p>



<a name="222780505"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222780505" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222780505">(Jan 14 2021 at 20:38)</a>:</h4>
<p>... why would it only fail now?</p>



<a name="222780516"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222780516" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222780516">(Jan 14 2021 at 20:38)</a>:</h4>
<p>maybe it's never hit this code before</p>



<a name="222780537"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222780537" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222780537">(Jan 14 2021 at 20:38)</a>:</h4>
<p>dynamic languages are so annoying</p>



<a name="222780738"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222780738" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> CraftSpider <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222780738">(Jan 14 2021 at 20:40)</a>:</h4>
<p>Yeah, it looks like this code is only hit in the error path</p>



<a name="222780822"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222780822" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> CraftSpider <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222780822">(Jan 14 2021 at 20:41)</a>:</h4>
<p>So there was a legitimate error, but we can't see it because it triggered an unrelated error</p>



<a name="222780874"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222780874" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222780874">(Jan 14 2021 at 20:41)</a>:</h4>
<p><span class="user-mention" data-user-id="319144">@Rune Tynan</span> if you have python3 locally you should be able to replicate the error</p>



<a name="222780888"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222780888" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222780888">(Jan 14 2021 at 20:41)</a>:</h4>
<p><code>x.py test src/test/rustdoc-json</code></p>



<a name="222780915"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222780915" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> CraftSpider <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222780915">(Jan 14 2021 at 20:42)</a>:</h4>
<p>Yep, trying it now</p>



<a name="222780966"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222780966" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> CraftSpider <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222780966">(Jan 14 2021 at 20:42)</a>:</h4>
<p>Well. It just ran and both tests passed</p>



<a name="222780980"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222780980" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> CraftSpider <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222780980">(Jan 14 2021 at 20:42)</a>:</h4>
<p>Wait! Wrong branch</p>



<a name="222780983"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222780983" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222780983">(Jan 14 2021 at 20:42)</a>:</h4>
<p>try with python2?</p>



<a name="222781232"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222781232" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> CraftSpider <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222781232">(Jan 14 2021 at 20:44)</a>:</h4>
<p>Running on the right branch with python3.6, and behind door number one is... (waiting for librustdoc to build again)</p>



<a name="222781245"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222781245" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> CraftSpider <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222781245">(Jan 14 2021 at 20:44)</a>:</h4>
<p><code>__main__.SubsetException: ['inner', 'items', '0:3', 'inner', 'items', '0:7', 'inner']: Key </code>glob<code> not found in output</code></p>



<a name="222781299"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222781299" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> CraftSpider <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222781299">(Jan 14 2021 at 20:44)</a>:</h4>
<p>Hmmm, guess it's time for me to look through the json code to understand what changed</p>



<a name="222781313"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222781313" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222781313">(Jan 14 2021 at 20:45)</a>:</h4>
<p>hmm that's weird, you didn't mess with the JSON at all</p>



<a name="222781474"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222781474" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> CraftSpider <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222781474">(Jan 14 2021 at 20:46)</a>:</h4>
<p>I changed <code>Item {...}</code> into <code>Item::from_def_id_and_parts(...)</code>, I wonder if one of the values changed. You'd think that would change the HTML tests somehow, but maybe it's subtle / only the JSON cares??</p>



<a name="222781564"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222781564" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222781564">(Jan 14 2021 at 20:47)</a>:</h4>
<p>I would see what the JSON output was before and after your change</p>



<a name="222781692"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222781692" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222781692">(Jan 14 2021 at 20:48)</a>:</h4>
<p>(shouldn't need to recompile btw -  I would expect latest nightly to have the same output)</p>



<a name="222782238"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222782238" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> CraftSpider <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222782238">(Jan 14 2021 at 20:52)</a>:</h4>
<p>If I'm reading this trace right, the key missing is <code>"glob": false</code> on line 137 of nested.expected</p>



<a name="222783590"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222783590" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> CraftSpider <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222783590">(Jan 14 2021 at 21:02)</a>:</h4>
<p>Yeah, I can't see why this would have changed, except that I somehow changed the kind of the item</p>



<a name="222783627"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222783627" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222783627">(Jan 14 2021 at 21:03)</a>:</h4>
<p>seems weird that the kind would have changed</p>



<a name="222783639"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222783639" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222783639">(Jan 14 2021 at 21:03)</a>:</h4>
<p>if you revert the <code>from_def_id...</code> call, does it fix it?</p>



<a name="222783669"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222783669" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222783669">(Jan 14 2021 at 21:03)</a>:</h4>
<p>if so you can run <code>assert_eq!</code> to see exactly what changed</p>



<a name="222785132"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222785132" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> CraftSpider <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222785132">(Jan 14 2021 at 21:14)</a>:</h4>
<p>That didn't seem to fix it, so I'm stumped. I also tried playing with using <code>renamed.unwrap_or(item.ident.name)</code> instead of what the generic impl does, and that didn't fix it either</p>



<a name="222785188"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222785188" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222785188">(Jan 14 2021 at 21:15)</a>:</h4>
<p>hmm, let me look at the chnages again</p>



<a name="222785568"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222785568" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> CraftSpider <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222785568">(Jan 14 2021 at 21:18)</a>:</h4>
<p>Please do, I think I've hit the 'I wrote it and I can't see the error' part :P</p>



<a name="222785765"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222785765" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222785765">(Jan 14 2021 at 21:19)</a>:</h4>
<p>oh don't worry, this happens every time I try to fix up clean lol</p>



<a name="222786043"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222786043" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222786043">(Jan 14 2021 at 21:21)</a>:</h4>
<p><span class="user-mention" data-user-id="319144">@Rune Tynan</span> can you revert the <code>from_def_id</code> change and push it to a branch somewhere so the diff is smaller?</p>



<a name="222786056"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222786056" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222786056">(Jan 14 2021 at 21:21)</a>:</h4>
<p>even if it doesn't fix the error it will be easier to read</p>



<a name="222786395"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222786395" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> CraftSpider <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222786395">(Jan 14 2021 at 21:24)</a>:</h4>
<p><a href="https://github.com/CraftSpider/rust/tree/rustdoc-temp">https://github.com/CraftSpider/rust/tree/rustdoc-temp</a><br>
Here's the branch, minus the from_def_id_and_parts changes</p>



<a name="222786433"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222786433" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> CraftSpider <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222786433">(Jan 14 2021 at 21:24)</a>:</h4>
<p>Still errors, but may be easier to debug :P</p>



<a name="222786467"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222786467" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222786467">(Jan 14 2021 at 21:24)</a>:</h4>
<p>thanks :)</p>



<a name="222794285"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222794285" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222794285">(Jan 14 2021 at 22:25)</a>:</h4>
<p><span class="user-mention" data-user-id="319144">@Rune Tynan</span> so the main difference I saw is that the new generated JSON has way more items than the old one</p>
<div class="codehilite"><pre><span></span><code>&gt; jq . /home/joshua/rustc/src/test/rustdoc-json/nested.expected | diff - &lt;(jq . /home/joshua/rustc/build/x86_64-unknown-linux-gnu/test/rustdoc-json/nested/nested.json) | grep &#39;^&gt;&#39; | wc -l
20880
</code></pre></div>



<a name="222794295"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222794295" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222794295">(Jan 14 2021 at 22:25)</a>:</h4>
<p>so it's possible that the tests are just broken</p>



<a name="222797157"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222797157" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> CraftSpider <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222797157">(Jan 14 2021 at 22:52)</a>:</h4>
<p>Interesting. Also, looking at the actual json output, I notice that <code>["0:7"]["inner"]["glob"]</code> exists, and is <code>false</code></p>



<a name="222797543"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222797543" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> CraftSpider <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222797543">(Jan 14 2021 at 22:56)</a>:</h4>
<p>Actually <span class="user-mention" data-user-id="232545">@Joshua Nelson</span> From what I can tell, the <code>.expected</code> is not a full copy of the expected output, but a strict subset</p>



<a name="222797562"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222797562" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> CraftSpider <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222797562">(Jan 14 2021 at 22:56)</a>:</h4>
<p>As the test method is called 'check_subset'</p>



<a name="222797598"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222797598" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> CraftSpider <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222797598">(Jan 14 2021 at 22:56)</a>:</h4>
<p>And appears to only check that for item in expected, item matches in actual, not the other way around</p>



<a name="222802754"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222802754" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> CraftSpider <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222802754">(Jan 14 2021 at 23:59)</a>:</h4>
<p>I ran old vs new through a checker, and there is exactly one diff found:<br>
<a href="/user_uploads/4715/eHiqJr8MDNFv9vVHtF7buAB4/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/eHiqJr8MDNFv9vVHtF7buAB4/image.png" title="image.png"><img src="/user_uploads/4715/eHiqJr8MDNFv9vVHtF7buAB4/image.png"></a></div>



<a name="222802891"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222802891" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> CraftSpider <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222802891">(Jan 15 2021 at 00:00)</a>:</h4>
<p>(That image is backwards, new is on left)</p>



<a name="222802947"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222802947" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> CraftSpider <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222802947">(Jan 15 2021 at 00:01)</a>:</h4>
<p>I literally swap that line in expected, and... it works! Yay for error messages that didn't convey the change that occured</p>



<a name="222804204"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222804204" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> CraftSpider <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222804204">(Jan 15 2021 at 00:21)</a>:</h4>
<p>I think the position change is just because use items are now added to the final vec in the same order they are fed to rustdoc, not processed before other items</p>



<a name="222804527"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222804527" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222804527">(Jan 15 2021 at 00:25)</a>:</h4>
<p>ok, so just a bug in the test suite then</p>



<a name="222804578"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222804578" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222804578">(Jan 15 2021 at 00:26)</a>:</h4>
<p>maybe sort the items before checking them?</p>



<a name="222804863"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222804863" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222804863">(Jan 15 2021 at 00:30)</a>:</h4>
<p>oh I see you updated the <code>.expected</code> file, that works too. Can you add a comment to the test suite for the next poor soul?</p>



<a name="222805306"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222805306" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> CraftSpider <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222805306">(Jan 15 2021 at 00:37)</a>:</h4>
<p>Does this sound good?</p>
<div class="codehilite"><pre><span></span><code># WARNING: The error messages produced by this may be misleading, in the case of list re-ordering it may
#          point to apparently unrelated keys.
</code></pre></div>



<a name="222805430"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222805430" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222805430">(Jan 15 2021 at 00:38)</a>:</h4>
<p>looks great, thanks :)</p>



<a name="222805713"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222805713" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> CraftSpider <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222805713">(Jan 15 2021 at 00:42)</a>:</h4>
<p>All this JSON stuff is making me wonder about how it could be improved, either the tests or the JSON rendering itself. I wonder if there could be something like jsondocck.py, which would interpret <code>@has ...</code> comments into JSON paths, and allow things like 'in this list, but I don't care where'</p>



<a name="222805910"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Removing%20doctree%20stuff/near/222805910" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Removing.20doctree.20stuff.html#222805910">(Jan 15 2021 at 00:45)</a>:</h4>
<p>that would be pretty cool :)</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>