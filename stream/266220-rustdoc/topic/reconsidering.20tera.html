<html>
<head><meta charset="utf-8"><title>reconsidering tera · rustdoc · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/index.html">rustdoc</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html">reconsidering tera</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="264916006"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/264916006" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#264916006">(Dec 14 2021 at 19:54)</a>:</h4>
<p><span class="user-mention" data-user-id="232545">@Joshua Nelson</span> and I both feel like we should reconsider whether tera is worth it.</p>
<p>Some of the reasons (some mine, some shared):</p>
<ol>
<li>It hurts performance.</li>
<li>Requiring types that are passed to the template to be <code>serde::Serialize</code> is somewhat annoying.</li>
<li>It adds another source of complexity and tool to learn (a whole templating language and engine) to rustdoc.</li>
</ol>



<a name="264916263"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/264916263" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#264916263">(Dec 14 2021 at 19:56)</a>:</h4>
<p>I personally think we should see if we can have a more lightweight, custom system for rendering.</p>



<a name="264916378"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/264916378" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#264916378">(Dec 14 2021 at 19:57)</a>:</h4>
<p>For example, we could add more builder types like <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustdoc/html/length_limit/struct.HtmlWithLimit.html"><code>HtmlWithLimit</code></a> that abstract over common behavior.</p>



<a name="264917767"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/264917767" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#264917767">(Dec 14 2021 at 20:07)</a>:</h4>
<p>cc <span class="user-mention" data-user-id="315412">@jsha</span></p>



<a name="264919029"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/264919029" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#264919029">(Dec 14 2021 at 20:17)</a>:</h4>
<p>I suspect we can come up with a good way to make (2) non-annoying - but yeah, (1) seems to be a current blocker.</p>
<p>To be clear, the current data we have on (1) is <a href="https://github.com/rust-lang/rust/issues/89732">#89732</a> / <a href="https://github.com/rust-lang/rust/pull/89695">https://github.com/rust-lang/rust/pull/89695</a>: we templatized the navbar part of the page, and it resulted in a 3.7% increase in instruction counts. That's not a slam dunk for showing Tera is unworkably slow, but it's a decent directional indicator. I did find one easy speedup in Tera, which landed and I need to pull into rustdoc. But it probably won't account for the full 3.7%.</p>
<p>The possible future for tera speedups is incorporating <code>valuable</code>, which is approximately a non-copying replacement for Serialize in this use case. <a href="https://github.com/Keats/tera/issues/637#issuecomment-942074982">https://github.com/Keats/tera/issues/637#issuecomment-942074982</a>. However, that may be a ways off, and it depends on <code>valuable</code>, which seems to be moving a bit slowly.</p>
<p>For (3) - I think using a templating engine significantly _lowers_ the bar for contributors to rustdoc, for most contributions. One of the hard parts of contributing to rustdoc is looking at some piece of HTML and figuring out how it is generated, across many various print calls. If there is a set of templates whose shape mirrors that of the generated HTML, it's much easier for someone to figure out what needs to change. Especially if it's an HTML-only change.</p>
<p>I think we need a templating engine of some sort. I don't think we should roll our own (though I'm curious to hear more about your idea; maybe I'm wrong). Another path forward would be to try Askama, which has much better performance than Tera. I initially decided to go with Tera because (a) Askama's error messages on malformed templates are very hard to understand, and (b) Tera allows live-reloading of templates. But those can take a back burner to the fact that we're currently blocked on additional Tera work by performance concerns.</p>



<a name="264920362"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/264920362" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#264920362">(Dec 14 2021 at 20:27)</a>:</h4>
<p>Fundamentally, tera does runtime template reading, parsing, and evaluating, so it's going to be slower than rustdoc's very performant "hand-coded" <code>write!</code> version.</p>



<a name="264920550"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/264920550" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#264920550">(Dec 14 2021 at 20:29)</a>:</h4>
<p>Which actually brings up another issue: what happens if there's a syntax or type error (not sure if type errors are possible in tera though) in a template that does not have adequate? Will rustdoc fail at runtime? It seems unlikely, but worth thinking about.</p>



<a name="264920594"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/264920594" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#264920594">(Dec 14 2021 at 20:29)</a>:</h4>
<p>the template reading and parsing happens once at startup so it's very effectively amortized across a doc generation run. Yes, evaluating will potentially take more time - but it doesn't have to take longer than an existing <code>if</code> / <code>then</code> block.</p>



<a name="264920779"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/264920779" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#264920779">(Dec 14 2021 at 20:30)</a>:</h4>
<blockquote>
<p>For (3) - I think using a templating engine significantly _lowers_ the bar for contributors to rustdoc, for most contributions. One of the hard parts of contributing to rustdoc is looking at some piece of HTML and figuring out how it is generated, across many various print calls. If there is a set of templates whose shape mirrors that of the generated HTML, it's much easier for someone to figure out what needs to change. Especially if it's an HTML-only change.</p>
</blockquote>
<p>I'm not so sure about this. It means that contributors need to have at least a working knowledge of tera (and, FWIW, I find tera's syntax somewhat unintuitive). And while it may make HTML-only changes easier, I think it'll make changes that affect <em>what</em> is rendered harder.</p>



<a name="264920836"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/264920836" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#264920836">(Dec 14 2021 at 20:31)</a>:</h4>
<p>Syntax errors in a template will get flagged during testing, since we parse all templates on any doc run. There is some runtime safety to be concerned about - if you try to interpolate a variable that doesn't exist in the input, you'll get a runtime error. My feeling on the original issue was that that's an acceptable tradeoff. But that is one thing that Askama gets you - more compile-time checking.</p>



<a name="264921014"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/264921014" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#264921014">(Dec 14 2021 at 20:32)</a>:</h4>
<p>Ok, it's good to know that template loading happens only once. But still, <code>Serialize</code>ing data constantly is going to be slower than just rendering it directly.</p>



<a name="264921070"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/264921070" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#264921070">(Dec 14 2021 at 20:33)</a>:</h4>
<p>Yep, agreed. That's what <code>valuable</code> solves, since it doesn't <code>Serialize</code> the data but provides an efficient way to runtime iterate over borrowed fields of the data.</p>



<a name="264921085"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/264921085" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#264921085">(Dec 14 2021 at 20:33)</a>:</h4>
<p>And Askama solves that by not Serializing - it does code generation at compile time.</p>



<a name="264921155"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/264921155" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#264921155">(Dec 14 2021 at 20:34)</a>:</h4>
<p>I didn't follow the original #t-compiler/help thread in detail - would you mind summarizing what the problem there was? Something about having to make<code>Symbol</code> impl <code>Serialize</code> so it could be put in a template?</p>



<a name="264921218"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/264921218" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#264921218">(Dec 14 2021 at 20:34)</a>:</h4>
<p>Yes, but T-compiler doesn't want to add a dependency on serde, so we'd have to then create our own wrapper for Symbol. And this is likely the case for other compiler types too.</p>



<a name="264921267"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/264921267" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#264921267">(Dec 14 2021 at 20:35)</a>:</h4>
<p>Long-term, I want to switch rustdoc to use more rustc types, which is at odds with serializing the data.</p>



<a name="264921363"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/264921363" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#264921363">(Dec 14 2021 at 20:35)</a>:</h4>
<p>I would prefer using a more compile-time approach. But I still don't really feel that using a full-blown templating library in rustdoc is necessary.</p>



<a name="264921706"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/264921706" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#264921706">(Dec 14 2021 at 20:37)</a>:</h4>
<p>Yeah, we should definitely find a way that we can use compiler types directly without requiring the compiler to implement anything special on them. I'd consider that a requirement of making further progress on templating, though I hadn't thought of it previously.</p>



<a name="264922125"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/264922125" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#264922125">(Dec 14 2021 at 20:40)</a>:</h4>
<p>Personally I see our lack of templates as a big source of technical debt. I've run into a lot of HTML generation bugs that can be chalked up to lack of templates. In particular mismatched tags are a big problem. You need to make sure when you open a tag, you close it in all possible paths through a function - even if the close tag is potentially very far away from the open tag. This is generally much easier when you can see the tags in context in a template. For instance, in a template you have indentation to help, and you can verify that any optional / repeated blocks are fully self contained (they open and close all their own tags).</p>



<a name="264922289"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/264922289" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#264922289">(Dec 14 2021 at 20:42)</a>:</h4>
<p>Even when it doesn't cause bugs, avoiding tag open / tag close problems results in some pretty awkward code with our current system. I ran into this particularly when working on the details/summary changes, where an item may or may not be wrapped in a details/summary, and you have to track the state of whether you opened one of those tags to make sure you closed it. And you have to close it at just the right spot.</p>



<a name="264922407"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/264922407" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#264922407">(Dec 14 2021 at 20:43)</a>:</h4>
<p>I do see how things like mismatched tags could be a problem. I think we could solve this problem with either a smart builder type like <code>HtmlWithLimit</code> (which solves this problem already, though it'd need to be expanded to work with more of rustdoc's HTML generation needs) or some sort of system like what Elm does.</p>



<a name="264922545"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/264922545" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#264922545">(Dec 14 2021 at 20:44)</a>:</h4>
<p>(Oops, just realized I wrote "mismatched <em>types</em>" :D)</p>



<a name="264922660"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/264922660" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#264922660">(Dec 14 2021 at 20:45)</a>:</h4>
<p>Can you tell me more about what you mean about HtmlWithLimit? A quick grep shows me it's a type in librustdoc, but I'm not familiar with it already. How does it relate to templating?</p>



<a name="264922694"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/264922694" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#264922694">(Dec 14 2021 at 20:45)</a>:</h4>
<p>Check out its docs: <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustdoc/html/length_limit/struct.HtmlWithLimit.html">https://doc.rust-lang.org/nightly/nightly-rustc/rustdoc/html/length_limit/struct.HtmlWithLimit.html</a></p>



<a name="264922798"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/264922798" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#264922798">(Dec 14 2021 at 20:46)</a>:</h4>
<p>It's used by the Markdown search summary rendering to ensure all tags are closed, even when the length limit is reached.</p>



<a name="264922829"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/264922829" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#264922829">(Dec 14 2021 at 20:46)</a>:</h4>
<p>But it could be easily changed so the limit functionality could be turned off.</p>



<a name="264923037"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/264923037" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#264923037">(Dec 14 2021 at 20:48)</a>:</h4>
<p>That's pretty nice! Would definitely be an improvement to some of our existing code (it could also introduce a runtime performance penalty, though probably much less than tera's allocations).</p>



<a name="264923082"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/264923082" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#264923082">(Dec 14 2021 at 20:49)</a>:</h4>
<blockquote>
<p>it could also introduce a runtime performance penalty</p>
</blockquote>
<p>How so?</p>



<a name="264923107"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/264923107" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#264923107">(Dec 14 2021 at 20:49)</a>:</h4>
<p>It's gotta (lightly) parse the HTML that's written into it, right?</p>



<a name="264923133"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/264923133" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#264923133">(Dec 14 2021 at 20:49)</a>:</h4>
<p>No, there's no parsing</p>



<a name="264923172"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/264923172" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#264923172">(Dec 14 2021 at 20:49)</a>:</h4>
<p>It's used like this:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">buf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">HtmlWithLimit</span>::<span class="n">new</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">buf</span><span class="p">.</span><span class="n">open_tag</span><span class="p">(</span><span class="s">"a"</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">buf</span><span class="p">.</span><span class="n">open_tag</span><span class="p">(</span><span class="s">"em"</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">buf</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="s">"hello"</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">buf</span><span class="p">.</span><span class="n">close_tag</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">.</span><span class="n">finish</span><span class="p">());</span><span class="w"></span>
</code></pre></div>



<a name="264923331"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/264923331" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#264923331">(Dec 14 2021 at 20:50)</a>:</h4>
<p>This is just an example. It demonstrates that even if you forget to close a tag, it's closed for you:</p>
<div class="codehilite" data-code-language="HTML"><pre><span></span><code><span class="p">&lt;</span><span class="nt">a</span><span class="p">&gt;&lt;</span><span class="nt">em</span><span class="p">&gt;</span>hello<span class="p">&lt;/</span><span class="nt">em</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</code></pre></div>



<a name="264923451"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/264923451" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#264923451">(Dec 14 2021 at 20:51)</a>:</h4>
<p>Nice! This does introduce an issue that it would make our HTML-generating code look even _less_ like HTML. For instance, someone looking for an a tag might reasonably try grepping for <code>&lt;a</code>, but this breaks that.</p>



<a name="264923590"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/264923590" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#264923590">(Dec 14 2021 at 20:52)</a>:</h4>
<p>That's true <span aria-label="shrug" class="emoji emoji-1f937" role="img" title="shrug">:shrug:</span></p>



<a name="264923775"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/264923775" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#264923775">(Dec 14 2021 at 20:53)</a>:</h4>
<p>OTOH, its API is minimal and intuitive (at least to me).</p>



<a name="264924159"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/264924159" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#264924159">(Dec 14 2021 at 20:56)</a>:</h4>
<p>FWIW, my experience from the small templates we've already ported has been great. Right now we have the head of the HTML ported, and I've made a bunch of changes in the HTML head, and also reviewed a handful of them. Both the writing and the reviewing experience has been _much_ more pleasant and I've been much more confident in the correctness of the outcome. But perhaps this is somewhat tautological - I'm used to writing HTML with templates, so I added template support, and I find it intuitive and helpful. :-)</p>



<a name="264929289"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/264929289" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#264929289">(Dec 14 2021 at 21:38)</a>:</h4>
<blockquote>
<p>But perhaps this is somewhat tautological - I'm used to writing HTML with templates, so I added template support, and I find it intuitive and helpful. :-)</p>
</blockquote>
<p>Yeah, this is probably the case :)</p>



<a name="264929343"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/264929343" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#264929343">(Dec 14 2021 at 21:38)</a>:</h4>
<p>One thing about tera that seems quite non-optimal is the need to write <code>{# -#}</code> everywhere to avoid extra whitespace.</p>



<a name="264929629"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/264929629" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#264929629">(Dec 14 2021 at 21:40)</a>:</h4>
<p><span class="user-mention silent" data-user-id="307537">Noah Lev</span> <a href="#narrow/stream/266220-rustdoc/topic/reconsidering.20tera/near/264929289">said</a>:</p>
<blockquote>
<blockquote>
<p>But perhaps this is somewhat tautological - I'm used to writing HTML with templates, so I added template support, and I find it intuitive and helpful. :-)</p>
</blockquote>
<p>Yeah, this is probably the case :)</p>
</blockquote>
<p>maybe, but I don't think it's necessarily a bad thing - if we use tools that people are familiar with, it will be easier to recruit contributors</p>



<a name="264929826"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/264929826" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#264929826">(Dec 14 2021 at 21:41)</a>:</h4>
<p>I want to avoid NIH syndrome if at all possible, we already have enough code to maintain</p>



<a name="264929885"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/264929885" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#264929885">(Dec 14 2021 at 21:41)</a>:</h4>
<p>Askama seems like a reasonable compromise between ease of use and performance :)</p>



<a name="264930156"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/264930156" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#264930156">(Dec 14 2021 at 21:42)</a>:</h4>
<p><span class="user-mention" data-user-id="315412">@jsha</span> how does Askama's serialization system work?</p>



<a name="264930336"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/264930336" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#264930336">(Dec 14 2021 at 21:43)</a>:</h4>
<blockquote>
<p>maybe, but I don't think it's necessarily a bad thing - if we use tools that people are familiar with, it will be easier to recruit contributors</p>
</blockquote>
<p>The thing is that people are not necessarily familiar with tera. E.g., I've used it a bit, but I'm not sure if I'd feel comfortable reviewing changes to tera templates.</p>



<a name="264930411"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/264930411" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#264930411">(Dec 14 2021 at 21:44)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/266220-rustdoc/topic/reconsidering.20tera/near/264930156">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="315412">jsha</span> how does Askama's serialization system work?</p>
</blockquote>
<p>My understanding is that Askama doesn't serialize—it's fully at compile-time—though I may be mistaken.</p>



<a name="264930566"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/264930566" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#264930566">(Dec 14 2021 at 21:45)</a>:</h4>
<p><span class="user-mention silent" data-user-id="307537">Noah Lev</span> <a href="#narrow/stream/266220-rustdoc/topic/reconsidering.20tera/near/264930336">said</a>:</p>
<blockquote>
<blockquote>
<p>maybe, but I don't think it's necessarily a bad thing - if we use tools that people are familiar with, it will be easier to recruit contributors</p>
</blockquote>
<p>The thing is that people are not necessarily familiar with tera. E.g., I've used it a bit, but I'm not sure if I'd feel comfortable reviewing changes to tera templates.</p>
</blockquote>
<p><em>We're</em> not familiar with Tera, but almost everyone else who builds websites is. I'd much rather review a Tera change than a <code>write!</code> change.</p>



<a name="264930737"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/264930737" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Urgau <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#264930737">(Dec 14 2021 at 21:46)</a>:</h4>
<p>Sorry to jump here but I've develop a PoC of a rustdoc purely based on rustdoc-json and I've used the <a href="https://lib.rs/crates/markup">markup</a> crate for that, you could maybe use something similar.</p>



<a name="264930833"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/264930833" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#264930833">(Dec 14 2021 at 21:47)</a>:</h4>
<p><span class="user-mention" data-user-id="327095">@Urgau</span> what advantage does that have over Askama?</p>



<a name="264930926"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/264930926" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#264930926">(Dec 14 2021 at 21:48)</a>:</h4>
<blockquote>
<p>We're not familiar with Tera, but almost everyone else who builds websites is.</p>
</blockquote>
<p>Rustdoc contributors are not necessarily people who build websites though.</p>



<a name="264931061"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/264931061" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#264931061">(Dec 14 2021 at 21:49)</a>:</h4>
<p>right, yes, but I would like to recruit people who do; we don't have many people that understand the frontend stuff currently</p>



<a name="264931106"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/264931106" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#264931106">(Dec 14 2021 at 21:49)</a>:</h4>
<p>there's more to rustdoc than just the compiler integration</p>



<a name="264931212"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/264931212" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#264931212">(Dec 14 2021 at 21:50)</a>:</h4>
<p>I do see the advantage of having some sort of templating system. I just want to make sure it doesn't make contributing to and maintaining rustdoc harder in other ways.</p>



<a name="264931229"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/264931229" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Urgau <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#264931229">(Dec 14 2021 at 21:50)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/266220-rustdoc/topic/reconsidering.20tera/near/264930833">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="327095">Urgau</span> what advantage does that have over Askama?</p>
</blockquote>
<p>I've never used it but from what I can see, Askama is more like Tera (use of separate files). Markup put the template directly in the rust code with proc-macro for the generation of the code.</p>



<a name="264931337"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/264931337" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#264931337">(Dec 14 2021 at 21:51)</a>:</h4>
<p>I think our HTML is large enough we may not <em>want</em> to put it inline <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span> but I'll defer to <span class="user-mention" data-user-id="315412">@jsha</span> on that</p>



<a name="264931466"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/264931466" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Urgau <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#264931466">(Dec 14 2021 at 21:52)</a>:</h4>
<p>There is an example on the on README.md if you want to see what that looks like.</p>



<a name="264931522"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/264931522" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Urgau <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#264931522">(Dec 14 2021 at 21:53)</a>:</h4>
<p><a href="https://github.com/utkarshkukreti/markup.rs/blob/HEAD/markup/#example">https://github.com/utkarshkukreti/markup.rs/blob/HEAD/markup/#example</a></p>



<a name="264931774"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/264931774" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#264931774">(Dec 14 2021 at 21:55)</a>:</h4>
<p>Not a fan that the syntax it uses is so different than all the other templating systems</p>



<a name="264932267"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/264932267" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#264932267">(Dec 14 2021 at 21:59)</a>:</h4>
<p>I think using a template engine is the best solution. I think it'd be better to avoid generating HTML from source code directly as much as possible. If tera is still too slow, we can test another one like suggested above.</p>



<a name="266220342"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/266220342" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#266220342">(Dec 28 2021 at 00:53)</a>:</h4>
<p>I think most people were on-board with switching to Askama, and given that it's fairly similar to Tera I think that would be a good way to try things out with a minimum of churn. <span class="user-mention" data-user-id="307537">@Noah Lev</span> I know you were concerned about making PRs harder to review. What do you think about giving Askama a try for a month or two, asking lots of questions if something isn't clear, and then we can reconsider at the end whether we think it's worth it compared to custom builder types? I don't think it should be any harder to review than Tera.</p>



<a name="266223964"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/266223964" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#266223964">(Dec 28 2021 at 02:06)</a>:</h4>
<p>Oh, I wasn't saying Askama would be harder to review than Tera; I was concerned Tera (or Tera-style engines) would be harder to review than plain Rust (since Tera doesn't have much static checking and is a framework I've only used a little).</p>
<p>Since Askama has static checking, I'm more open to it. My only concern would be about its maintenance and stability guarantees.</p>



<a name="266224434"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/266224434" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#266224434">(Dec 28 2021 at 02:16)</a>:</h4>
<p>It <a href="https://github.com/djc/template-benchmarks-rs/blob/main/big-table.svg">looks like</a> Askama is a bit slower (on benchmarks) than <code>write!</code>, but it's a lot faster than Tera. Since rustdoc's rendering takes up a relatively small proportion of total run time, I imagine switching to Askama probably wouldn't slow rustdoc down much.</p>



<a name="266403654"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/266403654" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manish Goregaokar <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#266403654">(Dec 30 2021 at 05:18)</a>:</h4>
<p>Has anyone tried out handlebars? We used it in the website and it was pretty nice</p>



<a name="266403662"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/266403662" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manish Goregaokar <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#266403662">(Dec 30 2021 at 05:18)</a>:</h4>
<p>it also has fluent integration if we ever want to support i18n, though that's more than just using the fluent integration</p>



<a name="266432820"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/266432820" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#266432820">(Dec 30 2021 at 14:34)</a>:</h4>
<p><span class="user-mention" data-user-id="132040">@Manish Goregaokar</span> handlebars is basically the same as tera but with slightly different syntax, right? I'd be worried it's also slow like tera</p>



<a name="266432830"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/266432830" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manish Goregaokar <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#266432830">(Dec 30 2021 at 14:34)</a>:</h4>
<p>Yeah it's worth testing</p>



<a name="266432844"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/266432844" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manish Goregaokar <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#266432844">(Dec 30 2021 at 14:35)</a>:</h4>
<p>It has a decent ecosystem in rust and is a syntax used across PL ecosystems</p>



<a name="266433387"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/266433387" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#266433387">(Dec 30 2021 at 14:41)</a>:</h4>
<p>(handlebars is way more limited in what it allows you to do in templates though)</p>



<a name="266433583"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/266433583" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> apiraino <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#266433583">(Dec 30 2021 at 14:44)</a>:</h4>
<p>A data point (2020) with some bench of different templating engines:<br>
<a href="https://github.com/djc/template-benchmarks-rs#results">https://github.com/djc/template-benchmarks-rs#results</a></p>



<a name="266435372"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/266435372" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#266435372">(Dec 30 2021 at 15:13)</a>:</h4>
<p><span class="user-mention silent" data-user-id="250987">apiraino</span> <a href="#narrow/stream/266220-rustdoc/topic/reconsidering.20tera/near/266433583">said</a>:</p>
<blockquote>
<p>A data point (2020) with some bench of different templating engines:<br>
<a href="https://github.com/djc/template-benchmarks-rs#results">https://github.com/djc/template-benchmarks-rs#results</a></p>
</blockquote>
<p>Nice, thanks! Based on the data, <code>handlebars</code> is slower than <code>tera</code> which is already too slow for us. Doesn't seem like the right match for us, unless I misread?</p>



<a name="266435415"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/266435415" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#266435415">(Dec 30 2021 at 15:13)</a>:</h4>
<p>I proposed handlebars in the initial issue (I've used it on other projects and I like it a lot), but folks on the team were more familiar with tera, which tipped the balance.</p>
<p>I agree that if we're switching for performance reasons, handlebars (or anything that relies on Serialize, which allocates a lot) probably isn't what we want.</p>



<a name="266437021"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/266437021" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#266437021">(Dec 30 2021 at 15:40)</a>:</h4>
<p>by the way it's worth considering now how much performance hit we would be willing to take for the better maintenance experience of templates. 10%? 20%? Should we measure in terms of total doc build time or just the HTML rendering phase?</p>



<a name="266442358"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/266442358" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#266442358">(Dec 30 2021 at 17:00)</a>:</h4>
<p>I'm hoping to reduce the rest of the doc build time, so I think we should measure in terms of HTML rendering. FWIW there are some open PRs to balance out the slowdowns: <a href="https://github.com/rust-lang/rust/pull/91948">https://github.com/rust-lang/rust/pull/91948</a> which, like, if we end up where we are now in terms of performance but without the maintenance burden, that absolutely seems like a win to me</p>



<a name="266466071"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/266466071" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#266466071">(Dec 30 2021 at 23:15)</a>:</h4>
<p>Performance is one reason I'd rather not use tera/handlebars, but I think the bigger reason is the lack of static checking. Rustdoc's test coverage is pretty paltry.</p>



<a name="266636875"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/266636875" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#266636875">(Jan 02 2022 at 22:44)</a>:</h4>
<p>ok, it sounds like there's consensus on at least trying out Askama - anyone interested in making a PR? :P I'll leave a comment on the tracking issue this is something we want to do</p>



<a name="266640226"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/266640226" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#266640226">(Jan 03 2022 at 00:05)</a>:</h4>
<p>thanks for pushing forward on that! I am in theory willing to do the PR, since I have been pushing for templates and am a big believer. But in practice the things making me most excited right now are simplifying / refining the UI, and improving caching. So if someone else has the energy to work on an Askama conversion, that would make me quite happy!</p>
<p>By the way, I did land a notable speedup in Tera that I've been meaning to upgrade rustdoc to (<a href="https://github.com/Keats/tera/pull/678">https://github.com/Keats/tera/pull/678</a>). I'm dubious it would be a big enough speedup to change the consensus about switching engines, but I do think it would be neat to measure. I'm just not very confident in doing the performance measurements yet.</p>



<a name="266646788"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/266646788" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#266646788">(Jan 03 2022 at 02:46)</a>:</h4>
<p>Also, as I said, performance is not the only consideration; I think static checking matters too.</p>



<a name="266740760"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/reconsidering%20tera/near/266740760" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/reconsidering.20tera.html#266740760">(Jan 03 2022 at 21:50)</a>:</h4>
<p>FYI switching to askama was an enormously large speedup :) <a href="https://github.com/rust-lang/rust/pull/92526#issuecomment-1004369149">https://github.com/rust-lang/rust/pull/92526#issuecomment-1004369149</a></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>