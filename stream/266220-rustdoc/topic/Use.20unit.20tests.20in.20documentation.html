<html>
<head><meta charset="utf-8"><title>Use unit tests in documentation · rustdoc · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/index.html">rustdoc</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Use.20unit.20tests.20in.20documentation.html">Use unit tests in documentation</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="269350120"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Use%20unit%20tests%20in%20documentation/near/269350120" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Clayton <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Use.20unit.20tests.20in.20documentation.html#269350120">(Jan 26 2022 at 01:13)</a>:</h4>
<p>Has anyone ever discussed being able to use unit tests inside documentation, rather than having to write out the documentation test? This way you still get all the editor features writing a normal unit test but can quickly add it to the documentation for examples.</p>
<p>e.g. right now you have to do something like this:</p>
<div class="codehilite"><pre><span></span><code>/**
Get median of arrays
## Examples
 ```
let nums1 = vec![1, 5, 7];
let nums2 = vec![1, 4, 7];
assert_eq!(algs::vec::median_sorted_two_vecs(nums1, nums2), 4.5);
 ```
**/
</code></pre></div>
<p>My proposal is to be able to do this:</p>
<div class="codehilite"><pre><span></span><code>/**
Get median of arrays
\#\# Examples
```algs::vec::test_sorted_f64```
**/

#[test]
fn test_sorted_f64() {
    let nums1 = vec![1.25, 15.2, 50.47];
    let nums2 = vec![0.25, 15.77, 200.6];
    assert_eq!(median_sorted_two_vecs(nums1, nums2), 15.485);
}
</code></pre></div>
<p>Which would generate the exact same HTML with the example containing the code inside the test function.</p>
<p>What do you think?</p>



<a name="269350660"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Use%20unit%20tests%20in%20documentation/near/269350660" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Use.20unit.20tests.20in.20documentation.html#269350660">(Jan 26 2022 at 01:20)</a>:</h4>
<p>(the eyeball icon in the Zulip editor allows you to preview your markdown)</p>



<a name="269350728"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Use%20unit%20tests%20in%20documentation/near/269350728" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Clayton <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Use.20unit.20tests.20in.20documentation.html#269350728">(Jan 26 2022 at 01:21)</a>:</h4>
<p><span class="user-mention" data-user-id="116155">@Jake Goulding</span> lol thanks fixing it now</p>



<a name="269350818"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Use%20unit%20tests%20in%20documentation/near/269350818" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Use.20unit.20tests.20in.20documentation.html#269350818">(Jan 26 2022 at 01:22)</a>:</h4>
<p>I don't follow how this would work. The <code>#[test]</code> is still inside of the comment block, so your editor would have to know that some lines aren't text and are code instead. Since your editor already needs to know that, what is stopping it from supporting the current form?</p>



<a name="269351100"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Use%20unit%20tests%20in%20documentation/near/269351100" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Clayton <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Use.20unit.20tests.20in.20documentation.html#269351100">(Jan 26 2022 at 01:26)</a>:</h4>
<p><span class="user-mention" data-user-id="116155">@Jake Goulding</span>  I updated it, meant to put the test outside the documentation</p>



<a name="269351317"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Use%20unit%20tests%20in%20documentation/near/269351317" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Use.20unit.20tests.20in.20documentation.html#269351317">(Jan 26 2022 at 01:29)</a>:</h4>
<p>potentially relevant things: </p>
<ul>
<li><a href="https://rust-lang.github.io/rfcs/3123-rustdoc-scrape-examples.html">https://rust-lang.github.io/rfcs/3123-rustdoc-scrape-examples.html</a></li>
<li><a href="https://stackoverflow.com/a/48982679/155423">How is it possible to keep Rust module documentation in separate Markdown files?</a></li>
</ul>



<a name="269365474"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Use%20unit%20tests%20in%20documentation/near/269365474" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Use.20unit.20tests.20in.20documentation.html#269365474">(Jan 26 2022 at 05:26)</a>:</h4>
<p>I do like the general goal of being able to write examples not inside <code>///</code>s, as that does make them somewhat more annoying to type out in the first place.</p>
<p>My first instinct is that something needing name lookup to find it is a bit weird.  But maybe the ship has sailed on that now that intra-doc links exist, since those need it too.</p>
<p>Spitballing: Maybe there could be a way to do this with <em>inner</em> stuff?  That'd still keep them closer than, say, a <code>#[test]</code> could be in an <code>impl</code> (since for something like the <code>Iterator</code> examples one would need to write the tests quite far from the method declaration).</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="sd">/// Doc comments!</span>
<span class="sd">///</span>
<span class="sd">/// # Panics</span>
<span class="sd">///</span>
<span class="sd">/// They're so cool</span>
<span class="sd">///</span>
<span class="sd">/// # Examples</span>
<span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">do_cool_stuff</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="kt">u32</span> <span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="cp">#[example]</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">so_great</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">do_cool_stuff</span><span class="p">(),</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="mi">5</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>But this also brings up a whole bunch of questions like how to find the necessary <code>use</code>s to make it copy-paste runnable, how to do the equivalent of <code>#</code> lines, etc.</p>



<a name="269366250"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Use%20unit%20tests%20in%20documentation/near/269366250" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Clayton <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Use.20unit.20tests.20in.20documentation.html#269366250">(Jan 26 2022 at 05:41)</a>:</h4>
<p><span class="user-mention" data-user-id="125270">@scottmcm</span>  That gives me an idea around Rust Analyzer, using /** for comments allows you to put code without any <code>///</code>'s, it would just be a matter of setting Rust Analyzer to parse documentation tests inside a block like that as though it were a unit test. I'm going to work on this from that angle, thanks for the spitball. <span class="user-mention" data-user-id="116155">@Jake Goulding</span> That scrape-examples is really cool I had a play with that thanks</p>



<a name="269367957"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Use%20unit%20tests%20in%20documentation/near/269367957" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Use.20unit.20tests.20in.20documentation.html#269367957">(Jan 26 2022 at 06:13)</a>:</h4>
<p>Oh, right, I'm been so conditioned to never use <code>//*</code>s that I forgot about it.</p>
<p>I should try out using</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="sd">/// # Examples</span>
<span class="sd">///</span>
<span class="sd">/** ```</span>
<span class="sd">    code here</span>
<span class="sd">    ``` */</span><span class="w"></span>
</code></pre></div>
<p>and see how it feels.</p>



<a name="269442460"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Use%20unit%20tests%20in%20documentation/near/269442460" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Use.20unit.20tests.20in.20documentation.html#269442460">(Jan 26 2022 at 16:45)</a>:</h4>
<blockquote>
<p>setting Rust Analyzer to parse documentation tests inside a block like that</p>
</blockquote>
<p>If you are going to do that, you could also make R-A look for ```rust in the doc anyway. No "big" changes.</p>



<a name="269484245"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Use%20unit%20tests%20in%20documentation/near/269484245" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Use.20unit.20tests.20in.20documentation.html#269484245">(Jan 26 2022 at 21:21)</a>:</h4>
<p>r-a already does syntax highlighting inside <code> ```rust </code>, so extending it to also give suggestions etc. seems like a good idea.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>