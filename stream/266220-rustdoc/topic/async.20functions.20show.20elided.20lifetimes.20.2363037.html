<html>
<head><meta charset="utf-8"><title>async functions show elided lifetimes #63037 · rustdoc · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/index.html">rustdoc</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html">async functions show elided lifetimes #63037</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="220716021"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220716021" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220716021">(Dec 22 2020 at 17:50)</a>:</h4>
<p>so I'm working on <a href="https://github.com/rust-lang/rust/issues/63037">https://github.com/rust-lang/rust/issues/63037</a> and I found that the difference between the two is that the signature is different before rustdoc ever processes it</p>
<div class="codehilite"><pre><span></span><code>DEBUG rustdoc::clean clean_fn_sig: generics=Generics { params: [GenericParamDef { name: &quot;\&#39;_&quot;, kind: Lifetime }], where_predicates: [] }, decl=FnDecl { inputs: Arguments { values: [Argument { type_: BorrowedRef { lifetime: Some(Lifetime(&quot;\&#39;_&quot;)), mutability: Not, type_: Primitive(Str) }, name: &quot;foo&quot; }] }, output: Return(ImplTrait([TraitBound(PolyTrait { trait_: ResolvedPath { path: Path { global: false, res: Err, segments: [PathSegment { name: &quot;Future&quot;, args: AngleBracketed { args: [], bindings: [TypeBinding { name: &quot;Output&quot;, kind: Equality { ty: ResolvedPath { path: Path { global: false, res: Def(Struct, DefId(5:5688 ~ alloc[4799]::string::String)), segments: [PathSegment { name: &quot;String&quot;, args: AngleBracketed { args: [], bindings: [] } }] }, param_names: None, did: DefId(5:5688 ~ alloc[4799]::string::String), is_generic: false } } }] } }] }, param_names: None, did: DefId(2:9354 ~ core[f78c]::future::future::Future), is_generic: false }, generic_params: [] }, None)])), c_variadic: false, attrs: Attributes { doc_strings: [], other_attrs: [], cfg: None, span: None, links: [], inner_docs: false } }
DEBUG rustdoc::clean clean_fn_sig: generics=Generics { params: [], where_predicates: [] }, decl=FnDecl { inputs: Arguments { values: [Argument { type_: BorrowedRef { lifetime: None, mutability: Not, type_: Primitive(Str) }, name: &quot;foo&quot; }] }, output: Return(ResolvedPath { path: Path { global: false, res: Def(Struct, DefId(5:5688 ~ alloc[4799]::string::String)), segments: [PathSegment { name: &quot;String&quot;, args: AngleBracketed { args: [], bindings: [] } }] }, param_names: None, did: DefId(5:5688 ~ alloc[4799]::string::String), is_generic: false }), c_variadic: false, attrs: Attributes { doc_strings: [], other_attrs: [], cfg: None, span: None, links: [], inner_docs: false } }
</code></pre></div>



<a name="220716064"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220716064" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220716064">(Dec 22 2020 at 17:50)</a>:</h4>
<p>which is slightly concerning</p>



<a name="220716086"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220716086" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220716086">(Dec 22 2020 at 17:51)</a>:</h4>
<p><span class="user-mention" data-user-id="116883">@tmandry</span> do you know where in rustc <code>async fn</code> gets desugared?</p>



<a name="220716812"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220716812" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220716812">(Dec 22 2020 at 17:57)</a>:</h4>
<p>yeah, this is literally all the preprocessing that happens: <a href="https://github.com/rust-lang/rust/blob/0fe1dc6ac214d443369134177940b4d0111e1df6/src/librustdoc/visit_ast.rs#L311">https://github.com/rust-lang/rust/blob/0fe1dc6ac214d443369134177940b4d0111e1df6/src/librustdoc/visit_ast.rs#L311</a></p>



<a name="220716936"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220716936" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220716936">(Dec 22 2020 at 17:58)</a>:</h4>
<p>compiler/rustc_ast_lowering looks right</p>



<a name="220717381"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220717381" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220717381">(Dec 22 2020 at 18:02)</a>:</h4>
<p>aha! <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_ast_lowering/enum.AnonymousLifetimeMode.html">https://doc.rust-lang.org/nightly/nightly-rustc/rustc_ast_lowering/enum.AnonymousLifetimeMode.html</a></p>



<a name="220718061"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220718061" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220718061">(Dec 22 2020 at 18:10)</a>:</h4>
<p>ok, so I found the function adding the lifetimes: <a href="https://github.com/rust-lang/rust/blob/0fe1dc6ac214d443369134177940b4d0111e1df6/compiler/rustc_ast_lowering/src/item.rs#L297-L310">https://github.com/rust-lang/rust/blob/0fe1dc6ac214d443369134177940b4d0111e1df6/compiler/rustc_ast_lowering/src/item.rs#L297-L310</a></p>
<p>before:</p>
<div class="codehilite"><pre><span></span><code>DEBUG rustc_ast_lowering::item lower_fn_kind(generics=Generics { params: [], where_clause: WhereClause { has_where_token: false, predicates: [], span: /home/joshua/rustc/src/librustdoc/async.rs:1:47: 1:47 (#0) }, span: /home/joshua/rustc/src/librustdoc/async.rs:1:26: 1:26 (#0) })
</code></pre></div>
<p>after:</p>
<div class="codehilite"><pre><span></span><code>DEBUG rustc_ast_lowering::item lower_fn_kind: generics=Generics { params: [GenericParam { hir_id: HirId { owner: DefId(0:3), local_id: 72 }, name: Fresh(0), attrs: [], bounds: [], span: /home/joshua/rustc/src/librustdoc/async.rs:1:32: 1:33 (#0), pure_wrt_drop: false, kind: Lifetime { kind: Elided } }], where_clause: WhereClause { predicates: [], span: /home/joshua/rustc/src/librustdoc/async.rs:1:47: 1:47 (#0) }, span: /home/joshua/rustc/src/librustdoc/async.rs:1:26: 1:26 (#0) }
</code></pre></div>
<p>and for comparison, the non-async version still has no params:</p>
<div class="codehilite"><pre><span></span><code>DEBUG rustc_ast_lowering::item lower_fn_kind(generics=Generics { params: [], where_clause: WhereClause { has_where_token: false, predicates: [], span: /home/joshua/rustc/src/librustdoc/async.rs:5:45: 5:45 (#0) }, span: /home/joshua/rustc/src/librustdoc/async.rs:5:24: 5:24 (#0) })
DEBUG rustc_ast_lowering::item lower_fn_kind: generics=Generics { params: [], where_clause: WhereClause { predicates: [], span: /home/joshua/rustc/src/librustdoc/async.rs:5:45: 5:45 (#0) }, span: /home/joshua/rustc/src/librustdoc/async.rs:5:24: 5:24 (#0) }
</code></pre></div>



<a name="220718495"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220718495" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220718495">(Dec 22 2020 at 18:14)</a>:</h4>
<p>and in particular the new params are from <a href="https://github.com/rust-lang/rust/blob/0fe1dc6ac214d443369134177940b4d0111e1df6/compiler/rustc_ast_lowering/src/lib.rs#L898">'add_in_band_defs'</a>:</p>
<div class="codehilite"><pre><span></span><code>DEBUG rustc_ast_lowering add_in_band_defs: params=[], in_band_defs=[GenericParam { hir_id: HirId { owner: DefId(0:3), local_id: 72 }, name: Fresh(0), attrs: [], bounds: [], span: /home/joshua/rustc/src/librustdoc/async.rs:1:32: 1:33 (#0), pure_wrt_drop: false, kind: Lifetime { kind: Elided } }]
</code></pre></div>



<a name="220718640"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220718640" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220718640">(Dec 22 2020 at 18:16)</a>:</h4>
<p>so now I have a useful question to ask: <span class="user-mention" data-user-id="116883">@tmandry</span> do you know why <code>lower_generics_mut</code> behaves differently for <code>async fn</code> and <code>fn</code>? <a href="https://github.com/rust-lang/rust/blob/0fe1dc6ac214d443369134177940b4d0111e1df6/compiler/rustc_ast_lowering/src/lib.rs#L884-L893">https://github.com/rust-lang/rust/blob/0fe1dc6ac214d443369134177940b4d0111e1df6/compiler/rustc_ast_lowering/src/lib.rs#L884-L893</a></p>



<a name="220718969"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220718969" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220718969">(Dec 22 2020 at 18:20)</a>:</h4>
<p>the really weird thing is that <code>lower_generic_param</code> never gets called</p>



<a name="220718982"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220718982" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220718982">(Dec 22 2020 at 18:20)</a>:</h4>
<p>maybe <code>async fn</code> adds an implicit <code>where</code> clause somehow?</p>



<a name="220719468"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220719468" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220719468">(Dec 22 2020 at 18:26)</a>:</h4>
<p>aha! I was on the wrong track, these are actually added by <a href="https://github.com/rust-lang/rust/blob/0fe1dc6ac214d443369134177940b4d0111e1df6/compiler/rustc_ast_lowering/src/lib.rs#L760"><code>lifetime_to_generic_param</code></a></p>



<a name="220719728"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220719728" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220719728">(Dec 22 2020 at 18:28)</a>:</h4>
<p>oh interesting, for <code>fn</code>, <code>lifetime_to_generic_param</code> isn't called at all</p>



<a name="220720142"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220720142" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220720142">(Dec 22 2020 at 18:32)</a>:</h4>
<p><del>so I guess somewhere a lifetime is getting marked as <code>Plain("_")</code> instead of <code>Fresh</code>? <a href="https://github.com/rust-lang/rust/blob/0fe1dc6ac214d443369134177940b4d0111e1df6/compiler/rustc_ast_lowering/src/lib.rs#L779-L783">https://github.com/rust-lang/rust/blob/0fe1dc6ac214d443369134177940b4d0111e1df6/compiler/rustc_ast_lowering/src/lib.rs#L779-L783</a> </del> nope - the debugging says it's <code>Fresh</code>: <a href="#narrow/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes/near/220718495">https://rust-lang.zulipchat.com/#narrow/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes/near/220718495</a></p>



<a name="220721603"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220721603" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220721603">(Dec 22 2020 at 18:49)</a>:</h4>
<p>ok so these are added to <a href="https://github.com/rust-lang/rust/blob/0fe1dc6ac214d443369134177940b4d0111e1df6/compiler/rustc_ast_lowering/src/lib.rs#L756"><code>lifetimes_to_define</code></a> somewhere:<br>
<code>DEBUG rustc_ast_lowering collect_in_band_defs: lifetimes_to_define=[(/home/joshua/rustc/src/librustdoc/async.rs:1:32: 1:33 (#0), Fresh(0))]</code></p>



<a name="220721961"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220721961" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220721961">(Dec 22 2020 at 18:53)</a>:</h4>
<blockquote>
<p>somewhere</p>
</blockquote>
<p><a href="https://github.com/rust-lang/rust/blob/0fe1dc6ac214d443369134177940b4d0111e1df6/compiler/rustc_ast_lowering/src/lib.rs#L839">https://github.com/rust-lang/rust/blob/0fe1dc6ac214d443369134177940b4d0111e1df6/compiler/rustc_ast_lowering/src/lib.rs#L839</a></p>



<a name="220722349"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220722349" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220722349">(Dec 22 2020 at 18:57)</a>:</h4>
<p>ok I <em>finally</em> found the issue - <code>elided_ref_lifetime</code> is called with <code>AnonymousLifetimeMode::CreateParameter</code> for <code>async fn</code>, but with <code>PassThrough</code> for `fn<br>
<a href="https://github.com/rust-lang/rust/blob/0fe1dc6ac214d443369134177940b4d0111e1df6/compiler/rustc_ast_lowering/src/lib.rs#L2577">https://github.com/rust-lang/rust/blob/0fe1dc6ac214d443369134177940b4d0111e1df6/compiler/rustc_ast_lowering/src/lib.rs#L2577</a></p>



<a name="220722402"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220722402" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220722402">(Dec 22 2020 at 18:57)</a>:</h4>
<p>and so <em>now</em> my question is why this is different from a normal function:</p>
<div class="codehilite"><pre><span></span><code>            // Intercept when we are in an impl header or async fn and introduce an in-band
            // lifetime.
            // Hence `impl Foo for &amp;u32` becomes `impl&lt;&#39;f&gt; Foo for &amp;&#39;f u32` for some fresh
            // `&#39;f`.
</code></pre></div>



<a name="220722605"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220722605" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220722605">(Dec 22 2020 at 18:59)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/blob/0fe1dc6ac214d443369134177940b4d0111e1df6/compiler/rustc_ast_lowering/src/lib.rs#L1751-L1754">https://github.com/rust-lang/rust/blob/0fe1dc6ac214d443369134177940b4d0111e1df6/compiler/rustc_ast_lowering/src/lib.rs#L1751-L1754</a></p>
<div class="codehilite"><pre><span></span><code>            // In `async fn`, argument-position elided lifetimes
            // must be transformed into fresh generic parameters so that
            // they can be applied to the opaque `impl Trait` return type.
            AnonymousLifetimeMode::CreateParameter
</code></pre></div>



<a name="220722763"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220722763" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220722763">(Dec 22 2020 at 19:01)</a>:</h4>
<p>added in <a href="https://github.com/rust-lang/rust/commit/749349fc9f7b12f212bca9ba2297e463328cb701">https://github.com/rust-lang/rust/commit/749349fc9f7b12f212bca9ba2297e463328cb701</a></p>



<a name="220723110"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220723110" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220723110">(Dec 22 2020 at 19:04)</a>:</h4>
<p>and indeed changing that fixes rustdoc's issue:<br>
<a href="/user_uploads/4715/y4N7JeqFSjsqbgpWl-S5MVus/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/y4N7JeqFSjsqbgpWl-S5MVus/image.png" title="image.png"><img src="/user_uploads/4715/y4N7JeqFSjsqbgpWl-S5MVus/image.png"></a></div>



<a name="220723163"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220723163" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220723163">(Dec 22 2020 at 19:04)</a>:</h4>
<p>so <span class="user-mention" data-user-id="116883">@tmandry</span> my question now is 'what will break' <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span> is there a way to do this without creating fresh generic parameters? or does rustdoc need to change on its end?</p>



<a name="220723489"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220723489" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220723489">(Dec 22 2020 at 19:08)</a>:</h4>
<p>oh I'm really sorry I've been pinging the wrong person</p>



<a name="220723503"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220723503" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220723503">(Dec 22 2020 at 19:08)</a>:</h4>
<p><span class="user-mention" data-user-id="127859">@Taylor Cramer</span> added this in <a href="https://github.com/rust-lang/rust/commit/749349fc9f7b12f212bca9ba2297e463328cb701">https://github.com/rust-lang/rust/commit/749349fc9f7b12f212bca9ba2297e463328cb701</a></p>



<a name="220723635"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220723635" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220723635">(Dec 22 2020 at 19:10)</a>:</h4>
<p>here's the error when I naively remove it:</p>
<div class="codehilite"><pre><span></span><code>---- [ui] ui/suggestions/issue-72766.rs stdout ----
diff of stderr:

+   error[E0759]: `self` has an anonymous lifetime `&#39;_` but it needs to satisfy a `&#39;static` lifetime requirement
+     --&gt; $DIR/issue-72766.rs:7:48
+      |
+   LL |       pub async fn call(&amp;self) -&gt; Result&lt;(), ()&gt; {
+      |  _______________________-----____________________^
+      | |                       |
+      | |                       this data with an anonymous lifetime `&#39;_`...
+   LL | |         Ok(())
+   LL | |     }
+      | |_____^ ...is captured here...
+      |
+   note: ...and is required to live as long as `&#39;static` here
+     --&gt; $DIR/issue-72766.rs:7:33
+      |
+   LL |     pub async fn call(&amp;self) -&gt; Result&lt;(), ()&gt; {
+      |                                 ^^^^^^^^^^^^^^
+
</code></pre></div>



<a name="220743280"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220743280" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220743280">(Dec 22 2020 at 22:48)</a>:</h4>
<p>my first thought is to find a way to add information to the new parameter about it being “synthetic” that rustdoc can use to ignore it</p>



<a name="220743383"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220743383" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220743383">(Dec 22 2020 at 22:50)</a>:</h4>
<p>or find some other way to detect the situation (lifetime parameters with the ‘_ name in a function signature aren’t something I’ve seen in real code before but maybe you can write them?)</p>



<a name="220743500"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220743500" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220743500">(Dec 22 2020 at 22:51)</a>:</h4>
<p>yes, you can write <code>fn f(&amp;'_ self)</code></p>



<a name="220743549"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220743549" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220743549">(Dec 22 2020 at 22:52)</a>:</h4>
<p>and I would prefer to keep that the same as the source code if possible</p>



<a name="220743580"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220743580" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220743580">(Dec 22 2020 at 22:52)</a>:</h4>
<p>otherwise things get way more complicated because rustdoc needs to know <em>where</em> the lifetime comes from, because <code>Box&lt;dyn Trait + '_&gt;</code> is different from <code>Box&lt;dyn Trait&gt;</code></p>



<a name="220743746"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220743746" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220743746">(Dec 22 2020 at 22:54)</a>:</h4>
<p>I meant in the generics list, like: fn&lt;‘_&gt;(...)</p>



<a name="220743764"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220743764" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220743764">(Dec 22 2020 at 22:54)</a>:</h4>
<p>but I’m not sure that’s represented any differently in HIR</p>



<a name="220743883"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220743883" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220743883">(Dec 22 2020 at 22:56)</a>:</h4>
<p>anyway, it’s sounding like you want some way of representing synthetic lifetimes</p>



<a name="220743948"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220743948" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220743948">(Dec 22 2020 at 22:57)</a>:</h4>
<p>that would work, I think</p>



<a name="220743969"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220743969" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220743969">(Dec 22 2020 at 22:57)</a>:</h4>
<p>I'm not sure why the lifetimes are necessary in the first place</p>



<a name="220744202"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220744202" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220744202">(Dec 22 2020 at 23:00)</a>:</h4>
<p>I guess otherwise the return type is <code>impl Future</code> instead of <code>impl Future + '_</code>?</p>



<a name="220744210"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220744210" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220744210">(Dec 22 2020 at 23:00)</a>:</h4>
<p>which defaults to 'static?</p>



<a name="220744237"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220744237" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220744237">(Dec 22 2020 at 23:00)</a>:</h4>
<p>if there were some way to <em>only</em> add the lifetime to the return type that would be ideal</p>



<a name="220744865"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220744865" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220744865">(Dec 22 2020 at 23:09)</a>:</h4>
<p>well you need that but I think that’s already done in the desugaring</p>



<a name="220744915"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220744915" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220744915">(Dec 22 2020 at 23:09)</a>:</h4>
<p>this is so we can construct a synthetic type for the future / state machine returned by the function</p>



<a name="220744986"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220744986" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220744986">(Dec 22 2020 at 23:10)</a>:</h4>
<p>and we need to be able to name lifetimes in that type which correspond to the (elided) lifetimes in the function signature</p>



<a name="220745125"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220745125" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220745125">(Dec 22 2020 at 23:12)</a>:</h4>
<p>hmm, ok</p>



<a name="220745140"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220745140" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220745140">(Dec 22 2020 at 23:12)</a>:</h4>
<p>let me try ignoring anonymous lifetimes in function parameters like you suggested</p>



<a name="220745150"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220745150" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220745150">(Dec 22 2020 at 23:12)</a>:</h4>
<p>and the bogus <code>fn f&lt;'_, '_&gt;</code></p>



<a name="220745171"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220745171" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220745171">(Dec 22 2020 at 23:13)</a>:</h4>
<p>so e.g. if you have <code>async fn foo(x: &amp;i32)</code> we have to be able to create <code>struct FooFuture&lt;'a&gt;(&amp;'a i32)</code>, roughly</p>



<a name="220745189"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220745189" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220745189">(Dec 22 2020 at 23:13)</a>:</h4>
<p>ahhh that makes sense</p>



<a name="220745213"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220745213" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220745213">(Dec 22 2020 at 23:13)</a>:</h4>
<p>and resolve the opaque return type so it looks like <code>fn foo&lt;'a&gt;(x: &amp;'a i32) -&gt; FooFuture&lt;'a&gt;</code></p>



<a name="220745292"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220745292" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220745292">(Dec 22 2020 at 23:14)</a>:</h4>
<p>so I guess my question is - why is this different from normal functions?</p>



<a name="220745300"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220745300" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220745300">(Dec 22 2020 at 23:14)</a>:</h4>
<p>for <code>fn foo(x: &amp;i32)</code> you still have an arbitrary lifetime, right?</p>



<a name="220745310"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220745310" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220745310">(Dec 22 2020 at 23:14)</a>:</h4>
<p>is it because you need to name it?</p>



<a name="220745486"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220745486" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220745486">(Dec 22 2020 at 23:17)</a>:</h4>
<p>yeah, you need to name the same lifetime in two different places</p>



<a name="220745508"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220745508" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220745508">(Dec 22 2020 at 23:17)</a>:</h4>
<p>for a single input/output lifetime elision can still work</p>



<a name="220745565"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220745565" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220745565">(Dec 22 2020 at 23:18)</a>:</h4>
<p>(I don't remember at what level elision is handled right now, I think desugaring?)</p>



<a name="220745567"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220745567" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220745567">(Dec 22 2020 at 23:18)</a>:</h4>
<p>but when there are multiple you need names</p>



<a name="220745633"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220745633" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220745633">(Dec 22 2020 at 23:19)</a>:</h4>
<p>so in general we need to handle cases where there are multiple unnamed lifetimes in the <code>async fn</code> signature</p>



<a name="220745698"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220745698" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220745698">(Dec 22 2020 at 23:20)</a>:</h4>
<p>oh that makes a lot of sense - I remember I tried <code>fn f(a: &amp;str, b: &amp;str)</code> with 1.34 (before this change was made) and it gave an error about multiple elided lifetimes</p>



<a name="220749626"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220749626" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220749626">(Dec 23 2020 at 00:13)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116883">tmandry</span> <a href="#narrow/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes/near/220743883">said</a>:</p>
<blockquote>
<p>anyway, it’s sounding like you want some way of representing synthetic lifetimes</p>
</blockquote>
<p>hmm, I thought I could tell this apart by looking at <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_hir/hir/enum.LifetimeParamKind.html#variant.InBand"><code>InBand</code></a> vs <code>Elided</code>, but these lifetimes are marked as Elided for some reason :/</p>



<a name="220749726"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220749726" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220749726">(Dec 23 2020 at 00:14)</a>:</h4>
<p>what's the difference between 'elided' and 'inband' anyway?</p>



<a name="220749842"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220749842" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220749842">(Dec 23 2020 at 00:16)</a>:</h4>
<p>ok well good news, filtering out Elided lifetimes gets rid of the <code>&lt;'_&gt;</code> :)</p>



<a name="220749846"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220749846" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220749846">(Dec 23 2020 at 00:16)</a>:</h4>
<p>and that should always be safe because you can't write <code>&lt;'_&gt;</code> in user code</p>



<a name="220754279"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220754279" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220754279">(Dec 23 2020 at 01:42)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/pull/80319">https://github.com/rust-lang/rust/pull/80319</a></p>



<a name="220754455"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220754455" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220754455">(Dec 23 2020 at 01:47)</a>:</h4>
<p><span class="user-mention" data-user-id="116883">@tmandry</span>  thanks for the help with this :)</p>



<a name="220754520"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220754520" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220754520">(Dec 23 2020 at 01:48)</a>:</h4>
<p>glad I could help!</p>



<a name="220755531"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220755531" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220755531">(Dec 23 2020 at 02:12)</a>:</h4>
<p><span class="user-mention" data-user-id="232545">@Joshua Nelson</span> left a review, btw</p>



<a name="220756194"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/async%20functions%20show%20elided%20lifetimes%20%2363037/near/220756194" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/async.20functions.20show.20elided.20lifetimes.20.2363037.html#220756194">(Dec 23 2020 at 02:30)</a>:</h4>
<p>left a response</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>