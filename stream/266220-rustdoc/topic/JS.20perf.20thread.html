<html>
<head><meta charset="utf-8"><title>JS perf thread · rustdoc · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/index.html">rustdoc</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/JS.20perf.20thread.html">JS perf thread</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="272906423"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/JS%20perf%20thread/near/272906423" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/JS.20perf.20thread.html#272906423">(Feb 23 2022 at 05:26)</a>:</h4>
<p>This Twitter thread about an unintuitive aspect of JS performance is quite interesting: <a href="https://twitter.com/SeaRyanC/status/1496273922714902528">https://twitter.com/SeaRyanC/status/1496273922714902528</a>. It probably has implications for the performance of search.js!</p>
<div class="inline-preview-twitter"><div class="twitter-tweet"><a href="https://twitter.com/SeaRyanC/status/1496273922714902528"><img class="twitter-avatar" src="https://uploads.zulipusercontent.net/0a81d07c6b44299f4058b61a0e6d100c8a2b2b54/68747470733a2f2f7062732e7477696d672e636f6d2f70726f66696c655f696d616765732f3837373631343239343639343733393936392f32593561787238465f6e6f726d616c2e6a7067"></a><p>JavaScript performance is bananas, a thread.

Let's write a function to sum the values from a the 'val' property of each element in an array:

function sum(arr) {
    let acc = 0;
    for (let i = 0; i &lt; arr.length; i++) {
        acc += arr[i].val;
    }
    return acc;
}

1/10</p><span>- Ryan Cavanaugh (@SeaRyanC)</span></div></div>



<a name="272906447"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/JS%20perf%20thread/near/272906447" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/JS.20perf.20thread.html#272906447">(Feb 23 2022 at 05:27)</a>:</h4>
<p>The TL;DR is that if you have an array where some items have fields that other items don't have, the performance gets much worse.</p>



<a name="272936057"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/JS%20perf%20thread/near/272936057" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/JS.20perf.20thread.html#272936057">(Feb 23 2022 at 11:31)</a>:</h4>
<p>I thought that is a fairly well-known property of JS engines that they basically try to infer implicit classes and then essentially turn <code>Vec&lt;HashMap&lt;String, &amp;dyn Obj&gt;&gt;</code> into <code>Vec&lt;T&gt;</code> at runtime.</p>



<a name="272937259"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/JS%20perf%20thread/near/272937259" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/JS.20perf.20thread.html#272937259">(Feb 23 2022 at 11:44)</a>:</h4>
<p>well-known if one reads blog posts about JS engines I guess <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="272939868"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/JS%20perf%20thread/near/272939868" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/JS.20perf.20thread.html#272939868">(Feb 23 2022 at 12:13)</a>:</h4>
<p>I didn't know at least. ^^'</p>



<a name="272968355"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/JS%20perf%20thread/near/272968355" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael notriddle Howell <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/JS.20perf.20thread.html#272968355">(Feb 23 2022 at 15:58)</a>:</h4>
<p>I knew about it. That's why I wrote code like this in it: <a href="https://github.com/rust-lang/rust/blob/c651ba8a542c7d89b271efbf024a31091c824f4b/src/librustdoc/html/static/js/search.js#L1322-L1324">https://github.com/rust-lang/rust/blob/c651ba8a542c7d89b271efbf024a31091c824f4b/src/librustdoc/html/static/js/search.js#L1322-L1324</a></p>



<a name="273010341"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/JS%20perf%20thread/near/273010341" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/JS.20perf.20thread.html#273010341">(Feb 23 2022 at 20:56)</a>:</h4>
<p>yeah, I've come across that comment a few times, and didn't really grok it til I'd read this tweet thread. I did actually learn many years ago about how JS engines try to infer classes and optimize based on that - but I never turned that into concrete performance advice in my mind.</p>
<p>I'm guessing that's also why search-index.js is organized as a bunch of arrays containing simple types (strings, ints), rather than a big array containing objects with fields? Or maybe that's more to save space on field names.</p>



<a name="273013224"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/JS%20perf%20thread/near/273013224" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael notriddle Howell <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/JS.20perf.20thread.html#273013224">(Feb 23 2022 at 21:23)</a>:</h4>
<p>That's more of a disk space and network transmission optimization than a runtime perf optimization. <a href="https://github.com/rust-lang/rust/pull/83003">https://github.com/rust-lang/rust/pull/83003</a> and <a href="https://github.com/rust-lang/rust/pull/13431">https://github.com/rust-lang/rust/pull/13431</a> are the two PRs that really defined the current format compared to the naive object oriented original format.</p>



<a name="273014427"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/JS%20perf%20thread/near/273014427" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/JS.20perf.20thread.html#273014427">(Feb 23 2022 at 21:34)</a>:</h4>
<p>aha, super helpful! Thanks for the links.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>