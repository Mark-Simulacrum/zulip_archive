<html>
<head><meta charset="utf-8"><title>JS minifier and ASI · rustdoc · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/index.html">rustdoc</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/JS.20minifier.20and.20ASI.html">JS minifier and ASI</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="267900647"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/JS%20minifier%20and%20ASI/near/267900647" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/JS.20minifier.20and.20ASI.html#267900647">(Jan 13 2022 at 17:15)</a>:</h4>
<p>JS has an odd thing called "Automatic Semicolon Insertion" (<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Lexical_grammar#automatic_semicolon_insertion">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Lexical_grammar#automatic_semicolon_insertion</a>). Both of these are valid:</p>
<div class="codehilite"><pre><span></span><code>let foo = function() {}
if (bar) {
  console.log(&quot;hi&quot;)
}
</code></pre></div>
<div class="codehilite"><pre><span></span><code>let foo = function() {};
if (bar) {
  console.log(&quot;hi&quot;)
}
</code></pre></div>
<p>(note the semicolon after <code>let foo</code>)</p>
<p>Setting aside whether we should stylistically require the semicolons or not - our minifier messes up these cases. If you wrote the first one, it would work with unminified code, but when the "real" minified version gets built, it would break (because the <code>if</code> would be put right after the <code>let</code> without an intervening semicolon).</p>
<p>This has bit me a few times and is a stumbling block when working on our JS. Unfortunately I'm not sure the best way to fix it. I think making our minifier aware of ASI would require actually parsing the JS.</p>



<a name="267912297"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/JS%20minifier%20and%20ASI/near/267912297" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/JS.20minifier.20and.20ASI.html#267912297">(Jan 13 2022 at 18:43)</a>:</h4>
<p>It's a known issue. I still hope someone will write a JS minifier in Rust so I can remove mine but I guess it's not happening any time soon... :'(</p>



<a name="267916125"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/JS%20minifier%20and%20ASI/near/267916125" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/JS.20minifier.20and.20ASI.html#267916125">(Jan 13 2022 at 19:11)</a>:</h4>
<p>Wouldn't the easiest fix be to just require semicolons in our JS? IIRC, it's very common to require them in style guides for simplicity.</p>



<a name="267916665"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/JS%20minifier%20and%20ASI/near/267916665" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/JS.20minifier.20and.20ASI.html#267916665">(Jan 13 2022 at 19:15)</a>:</h4>
<p>Normally they're supposed to be required with eslint...</p>



<a name="267920421"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/JS%20minifier%20and%20ASI/near/267920421" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/JS.20minifier.20and.20ASI.html#267920421">(Jan 13 2022 at 19:45)</a>:</h4>
<p>I'm fine with requiring semicolons, but to do so requires a JS parser or ESLint. The issue occurs when you're iterating on an unminified file, and then do a full build and have a surprising error. So what I'd like is something that can catch the lint violation at the full build step, OR a minifier that does the right thing.</p>



<a name="267921615"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/JS%20minifier%20and%20ASI/near/267921615" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/JS.20minifier.20and.20ASI.html#267921615">(Jan 13 2022 at 19:54)</a>:</h4>
<p>eslint is run in the CI so that should be fine normally.</p>



<a name="267924655"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/JS%20minifier%20and%20ASI/near/267924655" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/JS.20minifier.20and.20ASI.html#267924655">(Jan 13 2022 at 20:19)</a>:</h4>
<p>yeah - it's a dev-time annoyance more than anything else</p>



<a name="267924758"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/JS%20minifier%20and%20ASI/near/267924758" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/JS.20minifier.20and.20ASI.html#267924758">(Jan 13 2022 at 20:20)</a>:</h4>
<p>Oh I see. Little advice: simply copy/paste your js file into the build dir</p>



<a name="267924787"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/JS%20minifier%20and%20ASI/near/267924787" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/JS.20minifier.20and.20ASI.html#267924787">(Jan 13 2022 at 20:20)</a>:</h4>
<p>that's how i do so I don't have to regen every time :3</p>



<a name="267926437"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/JS%20minifier%20and%20ASI/near/267926437" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/JS.20minifier.20and.20ASI.html#267926437">(Jan 13 2022 at 20:34)</a>:</h4>
<p>that's what runs me into the problem. actually what I do is: I have a script <code>link.sh</code> that symlinks all JS and CSS from a built docs to the version in source control. That lets me iterate really fast, without worrying about losing my files.</p>
<p>The problem is I get something that works in symlinked mode, but stops working when I do an actual build. Same problem would happen with copying.</p>



<a name="267928052"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/JS%20minifier%20and%20ASI/near/267928052" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/JS.20minifier.20and.20ASI.html#267928052">(Jan 13 2022 at 20:48)</a>:</h4>
<p>well, the copy seems "safer", but you need to run it at each build</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>