<html>
<head><meta charset="utf-8"><title>rustdoc uses `debug` deps · rustdoc · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/index.html">rustdoc</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/rustdoc.20uses.20.60debug.60.20deps.html">rustdoc uses `debug` deps</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="251639846"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/rustdoc%20uses%20%60debug%60%20deps/near/251639846" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gus Wynn <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/rustdoc.20uses.20.60debug.60.20deps.html#251639846">(Sep 01 2021 at 22:36)</a>:</h4>
<p>I was trying to build a series of crates where there were disjoint features (I know, but it was for async runtimes), and i was trying to use <code>--cgf=docsrs</code> instead of features to ALWAYS show a special method used only by one of the runtimes, but when the downstream crate was building docs, it kept saying that couldnt find that method</p>
<p>with some <code>-vv</code> digging, it looks like the rustdoc invocations linked against the <code>debug</code> builds of the deps, not the <code>doc</code> builds, is this expected?</p>



<a name="251640712"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/rustdoc%20uses%20%60debug%60%20deps/near/251640712" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/rustdoc.20uses.20.60debug.60.20deps.html#251640712">(Sep 01 2021 at 22:47)</a>:</h4>
<p>What do you mean by debug builds? Rustdoc reuses the same cache as cargo check</p>



<a name="251640725"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/rustdoc%20uses%20%60debug%60%20deps/near/251640725" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/rustdoc.20uses.20.60debug.60.20deps.html#251640725">(Sep 01 2021 at 22:47)</a>:</h4>
<p>Are you expecting cfg(doc) to be set for dependencies? It's not</p>



<a name="251640827"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/rustdoc%20uses%20%60debug%60%20deps/near/251640827" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/rustdoc.20uses.20.60debug.60.20deps.html#251640827">(Sep 01 2021 at 22:48)</a>:</h4>
<p>--cfg=docsrs needs to be set for both RUSTFLAGS and RUSTDOCFLAGS if you want it to be set for dependencies</p>



<a name="251640851"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/rustdoc%20uses%20%60debug%60%20deps/near/251640851" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/rustdoc.20uses.20.60debug.60.20deps.html#251640851">(Sep 01 2021 at 22:49)</a>:</h4>
<p>(maybe a simpler way to say those three things is "rustdoc can't generate metadata")</p>



<a name="251641055"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/rustdoc%20uses%20%60debug%60%20deps/near/251641055" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gus Wynn <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/rustdoc.20uses.20.60debug.60.20deps.html#251641055">(Sep 01 2021 at 22:51)</a>:</h4>
<p>I was building all the crates inside a single workplace, so I was expecting things to be the same, but i see now that it doesnt generate metadata</p>
<p>another interesting "consequence" of this was that <code>#[cfg_attr(docrs, doc(...))]</code> attributes were not being forward</p>
<p>I think the RUSTFLAGS would fix that, but in this case it would require I alter the <code>[package.metadata.docs.rs]</code>to also include `rustc-args = ["--cfg=docsrs"]</p>



<a name="251641091"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/rustdoc%20uses%20%60debug%60%20deps/near/251641091" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gus Wynn <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/rustdoc.20uses.20.60debug.60.20deps.html#251641091">(Sep 01 2021 at 22:51)</a>:</h4>
<p>interesting, ill mention to the sqlx people that I can clean up the feature soup I needed with RUSTFLAGS instead, if thats what they want</p>



<a name="251641141"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/rustdoc%20uses%20%60debug%60%20deps/near/251641141" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gus Wynn <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/rustdoc.20uses.20.60debug.60.20deps.html#251641141">(Sep 01 2021 at 22:52)</a>:</h4>
<p>Thanks for explaining!</p>



<a name="251641151"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/rustdoc%20uses%20%60debug%60%20deps/near/251641151" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gus Wynn <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/rustdoc.20uses.20.60debug.60.20deps.html#251641151">(Sep 01 2021 at 22:52)</a>:</h4>
<p>I may link to this zulip stream on the PR</p>



<a name="251641168"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/rustdoc%20uses%20%60debug%60%20deps/near/251641168" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/rustdoc.20uses.20.60debug.60.20deps.html#251641168">(Sep 01 2021 at 22:52)</a>:</h4>
<p>Sure, feel free</p>



<a name="251641351"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/rustdoc%20uses%20%60debug%60%20deps/near/251641351" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gus Wynn <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/rustdoc.20uses.20.60debug.60.20deps.html#251641351">(Sep 01 2021 at 22:55)</a>:</h4>
<p>so in a workplace, if you cargo doc that root, each dep is built twice?</p>



<a name="251641367"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/rustdoc%20uses%20%60debug%60%20deps/near/251641367" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/rustdoc.20uses.20.60debug.60.20deps.html#251641367">(Sep 01 2021 at 22:55)</a>:</h4>
<p>Only if a later crate depends on it</p>



<a name="251641387"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/rustdoc%20uses%20%60debug%60%20deps/near/251641387" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/rustdoc.20uses.20.60debug.60.20deps.html#251641387">(Sep 01 2021 at 22:55)</a>:</h4>
<p><code>cargo doc -p my_crate</code> doesn't require that you first run <code>cargo check -p my_crate</code></p>



<a name="251641504"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/rustdoc%20uses%20%60debug%60%20deps/near/251641504" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/rustdoc.20uses.20.60debug.60.20deps.html#251641504">(Sep 01 2021 at 22:57)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/266220-rustdoc/topic/rustdoc.20uses.20.60debug.60.20deps/near/251640851">said</a>:</p>
<blockquote>
<p>(maybe a simpler way to say those three things is "rustdoc can't generate metadata")</p>
</blockquote>
<p>so more accurately: rustdoc doesn't <em>serialize</em> metadata</p>



<a name="251641680"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/rustdoc%20uses%20%60debug%60%20deps/near/251641680" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/rustdoc.20uses.20.60debug.60.20deps.html#251641680">(Sep 01 2021 at 22:59)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/266220-rustdoc/topic/rustdoc.20uses.20.60debug.60.20deps/near/251641387">said</a>:</p>
<blockquote>
<p><code>cargo doc -p my_crate</code> doesn't require that you first run <code>cargo check -p my_crate</code></p>
</blockquote>
<p>That's because rustdoc basically runs <code>cargo check</code>, right?</p>



<a name="251641741"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/rustdoc%20uses%20%60debug%60%20deps/near/251641741" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/rustdoc.20uses.20.60debug.60.20deps.html#251641741">(Sep 01 2021 at 23:00)</a>:</h4>
<p>Essentially, yes. It doesn't type check function bodies.</p>



<a name="251641783"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/rustdoc%20uses%20%60debug%60%20deps/near/251641783" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/rustdoc.20uses.20.60debug.60.20deps.html#251641783">(Sep 01 2021 at 23:00)</a>:</h4>
<p><del>Well, it sometimes does.</del> nvm, was thinking of something else</p>



<a name="251641787"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/rustdoc%20uses%20%60debug%60%20deps/near/251641787" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/rustdoc.20uses.20.60debug.60.20deps.html#251641787">(Sep 01 2021 at 23:00)</a>:</h4>
<p>And there are a bunch of other checks it omits too</p>



<a name="251642019"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/rustdoc%20uses%20%60debug%60%20deps/near/251642019" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gus Wynn <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/rustdoc.20uses.20.60debug.60.20deps.html#251642019">(Sep 01 2021 at 23:02)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/266220-rustdoc/topic/rustdoc.20uses.20.60debug.60.20deps/near/251641367">said</a>:</p>
<blockquote>
<p>Only if a later crate depends on it</p>
</blockquote>
<p>ah so in the sqlx case, there is a tree of crates depending on each other, so the non-root crates will all be built in <code>debug</code> mode and <code>doc</code> mode</p>



<a name="251642042"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/rustdoc%20uses%20%60debug%60%20deps/near/251642042" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gus Wynn <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/rustdoc.20uses.20.60debug.60.20deps.html#251642042">(Sep 01 2021 at 23:03)</a>:</h4>
<p>ah thats why the cargo output has "Checking" AND "Documenting"</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>