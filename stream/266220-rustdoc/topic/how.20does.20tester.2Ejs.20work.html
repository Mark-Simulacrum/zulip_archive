<html>
<head><meta charset="utf-8"><title>how does tester.js work · rustdoc · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/index.html">rustdoc</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/how.20does.20tester.2Ejs.20work.html">how does tester.js work</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="265606111"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/how%20does%20tester.js%20work/near/265606111" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/how.20does.20tester.2Ejs.20work.html#265606111">(Dec 20 2021 at 19:26)</a>:</h4>
<p>Reviewing <a href="https://github.com/rust-lang/rust/pull/92127">https://github.com/rust-lang/rust/pull/92127</a>, I checked for a test case and there already is one: src/test/rustdoc-js-std/deduplication.js. I'm somewhat surprised that didn't require amendment with this change, since we're moving the place deduplication was done.</p>
<p>Previously, deduplication was done in addTab. Now it will be done in transformResults (great!). But how was tester.js previously picking up the deduplication that happened in addTab? addTab operates on the DOM, but src/tools/rustdoc-js/tester.js runs in Node, where there is no DOM.</p>



<a name="265606210"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/how%20does%20tester.js%20work/near/265606210" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/how.20does.20tester.2Ejs.20work.html#265606210">(Dec 20 2021 at 19:27)</a>:</h4>
<p>Basically it looped until it got the maximum number of results</p>



<a name="265606318"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/how%20does%20tester.js%20work/near/265606318" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/how.20does.20tester.2Ejs.20work.html#265606318">(Dec 20 2021 at 19:28)</a>:</h4>
<p>and duplicates tend to have less great lev distance</p>



<a name="265606337"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/how%20does%20tester.js%20work/near/265606337" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/how.20does.20tester.2Ejs.20work.html#265606337">(Dec 20 2021 at 19:28)</a>:</h4>
<p>so they rarely come up in the results because they have less good results</p>



<a name="265607095"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/how%20does%20tester.js%20work/near/265607095" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/how.20does.20tester.2Ejs.20work.html#265607095">(Dec 20 2021 at 19:37)</a>:</h4>
<p>I don't understand. :-)</p>
<p>"less great lev distance" do you mean smaller levenshtein distance to the search query? they are a better match?</p>
<p>Or "less good lev distance", meaning they are a worse match.</p>



<a name="265607489"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/how%20does%20tester.js%20work/near/265607489" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/how.20does.20tester.2Ejs.20work.html#265607489">(Dec 20 2021 at 19:41)</a>:</h4>
<p>Also, to frame my question better:</p>
<p>In tester.js, to run the search we call <code>execSearch</code>. That returns a list of results for each tab. But those results are _not_ filtered yet for duplicates. That filtering happens in addTab, which is not exercised in tester.js.</p>
<p>It's okay that addTab is not exercised in search.js. It interacts with the DOM, so it's more appropriate for rustdoc-gui-tester.</p>
<p>But the existing deduplication code is in addTab. If tester.js never calls addTab, how was deduplication.js working? Was it really exercising the deduplication code path?</p>



<a name="265607868"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/how%20does%20tester.js%20work/near/265607868" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/how.20does.20tester.2Ejs.20work.html#265607868">(Dec 20 2021 at 19:45)</a>:</h4>
<p>Sorry, trying to explain better then! &gt;&lt;</p>



<a name="265607932"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/how%20does%20tester.js%20work/near/265607932" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/how.20does.20tester.2Ejs.20work.html#265607932">(Dec 20 2021 at 19:45)</a>:</h4>
<p>Duplicates are a less good match generally because they tend to have a bigger levenshtein distance, so they are not in the 10 first search results when they show up</p>



<a name="265607990"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/how%20does%20tester.js%20work/near/265607990" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/how.20does.20tester.2Ejs.20work.html#265607990">(Dec 20 2021 at 19:46)</a>:</h4>
<p>so in the JS tests, they were still "out of range"</p>



<a name="265609669"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/how%20does%20tester.js%20work/near/265609669" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/how.20does.20tester.2Ejs.20work.html#265609669">(Dec 20 2021 at 20:02)</a>:</h4>
<p>so is deduplication.js not really exercising the deduplication code path?</p>



<a name="265609729"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/how%20does%20tester.js%20work/near/265609729" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/how.20does.20tester.2Ejs.20work.html#265609729">(Dec 20 2021 at 20:03)</a>:</h4>
<p>also deduplication.js only lists 3 results, not 10</p>



<a name="265610004"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/how%20does%20tester.js%20work/near/265610004" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/how.20does.20tester.2Ejs.20work.html#265610004">(Dec 20 2021 at 20:06)</a>:</h4>
<p>Also, if I visit the results on nightly: <a href="https://doc.rust-lang.org/nightly/std/string/trait.ToString.html?search=is_nan">https://doc.rust-lang.org/nightly/std/string/trait.ToString.html?search=is_nan</a></p>
<p>I see 9 results, as compared to the 3 results listed in deduplication.js.</p>



<a name="265614571"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/how%20does%20tester.js%20work/near/265614571" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/how.20does.20tester.2Ejs.20work.html#265614571">(Dec 20 2021 at 20:53)</a>:</h4>
<p>It isn't an "exact-check" ;)</p>



<a name="265614633"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/how%20does%20tester.js%20work/near/265614633" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/how.20does.20tester.2Ejs.20work.html#265614633">(Dec 20 2021 at 20:54)</a>:</h4>
<p>In this case, it only checks their presence and/or their order</p>



<a name="265617116"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/how%20does%20tester.js%20work/near/265617116" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/how.20does.20tester.2Ejs.20work.html#265617116">(Dec 20 2021 at 21:19)</a>:</h4>
<p>So what is the property that deduplication.js is supposed to test?</p>
<p>And it sounds like we need another test case, that is an exact-check, to test the duplicate removal from <a href="https://github.com/rust-lang/rust/issues/92127">#92127</a>.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>