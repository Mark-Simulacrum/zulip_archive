<html>
<head><meta charset="utf-8"><title>Json output lacks some item which are supposed to be there · rustdoc · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/index.html">rustdoc</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Json.20output.20lacks.20some.20item.20which.20are.20supposed.20to.20be.20there.html">Json output lacks some item which are supposed to be there</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="250005015"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Json%20output%20lacks%20some%20item%20which%20are%20supposed%20to%20be%20there/near/250005015" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hirochika Matsumoto <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Json.20output.20lacks.20some.20item.20which.20are.20supposed.20to.20be.20there.html#250005015">(Aug 19 2021 at 15:45)</a>:</h4>
<p>In developing <a href="https://github.com/hkmatsumoto/roogle">roogle</a> I noticed the output of rustdoc lacks items which the target crates has.<br>
I'm using the json output of the standard library <code>std</code> generated by the rustdoc <a href="https://github.com/hkmatsumoto/rust/commit/ba1a0f7f0e3ba19dac739e19eb12485d1f14cf77">I patched</a>, and the output does not contain items like <code>char::is_uppercase</code>. I suppose that <a href="https://github.com/hkmatsumoto/rust/blob/ba1a0f7f0e3ba19dac739e19eb12485d1f14cf77/src/librustdoc/json/mod.rs#L173">this line</a> is pushing the items away, but in that case I think the swapped items should be present in the output, but not...</p>



<a name="250005251"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Json%20output%20lacks%20some%20item%20which%20are%20supposed%20to%20be%20there/near/250005251" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Json.20output.20lacks.20some.20item.20which.20are.20supposed.20to.20be.20there.html#250005251">(Aug 19 2021 at 15:47)</a>:</h4>
<p><span class="user-mention" data-user-id="331617">@Hirochika Matsumoto</span> you've commented out the assert that would panic rustdoc when that situation occurs</p>



<a name="250005263"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Json%20output%20lacks%20some%20item%20which%20are%20supposed%20to%20be%20there/near/250005263" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Json.20output.20lacks.20some.20item.20which.20are.20supposed.20to.20be.20there.html#250005263">(Aug 19 2021 at 15:47)</a>:</h4>
<p>there are already lots of open bugs about the assert triggerring</p>



<a name="250005292"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Json%20output%20lacks%20some%20item%20which%20are%20supposed%20to%20be%20there/near/250005292" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Json.20output.20lacks.20some.20item.20which.20are.20supposed.20to.20be.20there.html#250005292">(Aug 19 2021 at 15:47)</a>:</h4>
<p>there's no simple fix or it would have been fixed already</p>



<a name="250005951"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Json%20output%20lacks%20some%20item%20which%20are%20supposed%20to%20be%20there/near/250005951" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Json.20output.20lacks.20some.20item.20which.20are.20supposed.20to.20be.20there.html#250005951">(Aug 19 2021 at 15:52)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/issues/83720">https://github.com/rust-lang/rust/issues/83720</a> and <a href="https://github.com/rust-lang/rust/issues/83718">https://github.com/rust-lang/rust/issues/83718</a> are a couple of the issues</p>



<a name="250006100"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Json%20output%20lacks%20some%20item%20which%20are%20supposed%20to%20be%20there/near/250006100" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hirochika Matsumoto <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Json.20output.20lacks.20some.20item.20which.20are.20supposed.20to.20be.20there.html#250006100">(Aug 19 2021 at 15:53)</a>:</h4>
<p><span class="user-mention" data-user-id="232545">@Joshua Nelson</span> Thanks I'll take a look! <code>A-rustdoc-json</code> label is the label for this I guess?</p>



<a name="250006127"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Json%20output%20lacks%20some%20item%20which%20are%20supposed%20to%20be%20there/near/250006127" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Json.20output.20lacks.20some.20item.20which.20are.20supposed.20to.20be.20there.html#250006127">(Aug 19 2021 at 15:53)</a>:</h4>
<p>yup</p>



<a name="250007171"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Json%20output%20lacks%20some%20item%20which%20are%20supposed%20to%20be%20there/near/250007171" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Json.20output.20lacks.20some.20item.20which.20are.20supposed.20to.20be.20there.html#250007171">(Aug 19 2021 at 16:01)</a>:</h4>
<p>thank you for working on it!</p>



<a name="250009652"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Json%20output%20lacks%20some%20item%20which%20are%20supposed%20to%20be%20there/near/250009652" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hirochika Matsumoto <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Json.20output.20lacks.20some.20item.20which.20are.20supposed.20to.20be.20there.html#250009652">(Aug 19 2021 at 16:20)</a>:</h4>
<p>By searching for <code>use [a-zA-Z0-9_]* as [a-zA-Z0-9_]*;$</code> it turned out that <code>is_uppercase</code> nor <code>char</code> is reexported, so some orthogonal problems are the cause.<br>
I used <code>cargo +stage1 rustdoc -- --output-format json -Z unstable-options</code> on <code>&lt;path to local rust clone&gt;/library/std</code> to get a json file. Do you think this does the trick?</p>



<a name="250010469"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Json%20output%20lacks%20some%20item%20which%20are%20supposed%20to%20be%20there/near/250010469" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Json.20output.20lacks.20some.20item.20which.20are.20supposed.20to.20be.20there.html#250010469">(Aug 19 2021 at 16:27)</a>:</h4>
<p>what do you mean by "does the trick"?</p>



<a name="250010498"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Json%20output%20lacks%20some%20item%20which%20are%20supposed%20to%20be%20there/near/250010498" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Json.20output.20lacks.20some.20item.20which.20are.20supposed.20to.20be.20there.html#250010498">(Aug 19 2021 at 16:27)</a>:</h4>
<p>I would expect that to generate the .json file if that's what you mean</p>



<a name="250028460"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Json%20output%20lacks%20some%20item%20which%20are%20supposed%20to%20be%20there/near/250028460" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hirochika Matsumoto <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Json.20output.20lacks.20some.20item.20which.20are.20supposed.20to.20be.20there.html#250028460">(Aug 19 2021 at 18:36)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/266220-rustdoc/topic/Json.20output.20lacks.20some.20item.20which.20are.20supposed.20to.20be.20there/near/250010498">said</a>:</p>
<blockquote>
<p>I would expect that to generate the .json file if that's what you mean</p>
</blockquote>
<p>Yes that's what I meant.</p>



<a name="250028669"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Json%20output%20lacks%20some%20item%20which%20are%20supposed%20to%20be%20there/near/250028669" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hirochika Matsumoto <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Json.20output.20lacks.20some.20item.20which.20are.20supposed.20to.20be.20there.html#250028669">(Aug 19 2021 at 18:38)</a>:</h4>
<p>Okay, the problem is occurring because rustdoc's json backend somehow ignores/skips some kind of items (functions, impls at least) which has `#[lang = "..."] in its attributes.</p>



<a name="250028975"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Json%20output%20lacks%20some%20item%20which%20are%20supposed%20to%20be%20there/near/250028975" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Json.20output.20lacks.20some.20item.20which.20are.20supposed.20to.20be.20there.html#250028975">(Aug 19 2021 at 18:40)</a>:</h4>
<p>oh <em>fun</em></p>



<a name="250029004"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Json%20output%20lacks%20some%20item%20which%20are%20supposed%20to%20be%20there/near/250029004" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Json.20output.20lacks.20some.20item.20which.20are.20supposed.20to.20be.20there.html#250029004">(Aug 19 2021 at 18:40)</a>:</h4>
<p>on the bright side, that is probably an easy fix if you can find where to put it</p>



<a name="250029147"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Json%20output%20lacks%20some%20item%20which%20are%20supposed%20to%20be%20there/near/250029147" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hirochika Matsumoto <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Json.20output.20lacks.20some.20item.20which.20are.20supposed.20to.20be.20there.html#250029147">(Aug 19 2021 at 18:41)</a>:</h4>
<p>Yup, the html backend does not skip them, so I suppose comparing two backends will show me where to edit</p>



<a name="250272670"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Json%20output%20lacks%20some%20item%20which%20are%20supposed%20to%20be%20there/near/250272670" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hirochika Matsumoto <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Json.20output.20lacks.20some.20item.20which.20are.20supposed.20to.20be.20there.html#250272670">(Aug 22 2021 at 12:50)</a>:</h4>
<p><span class="user-mention" data-user-id="232545">@Joshua Nelson</span> I've managed to solve this problem! The cause was that, <code>impl</code>s are indexed <a href="https://github.com/rust-lang/rust/blob/80dad6477520553899049c994a6f534dce5a4951/src/librustdoc/json/mod.rs#L166-L172">here</a> but the if-lets don't cover <code>impl &lt;prim ty&gt;</code> case.</p>



<a name="250272685"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Json%20output%20lacks%20some%20item%20which%20are%20supposed%20to%20be%20there/near/250272685" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Json.20output.20lacks.20some.20item.20which.20are.20supposed.20to.20be.20there.html#250272685">(Aug 22 2021 at 12:51)</a>:</h4>
<p>That's great! Could you make a PR with the fix? Feel free to ask me to review, I'm jyn514 on GitHub :)</p>



<a name="250272687"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Json%20output%20lacks%20some%20item%20which%20are%20supposed%20to%20be%20there/near/250272687" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hirochika Matsumoto <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Json.20output.20lacks.20some.20item.20which.20are.20supposed.20to.20be.20there.html#250272687">(Aug 22 2021 at 12:51)</a>:</h4>
<p>The patched rustdoc  <a href="https://github.com/hkmatsumoto/rust/commit/f598ac1bd766d7ee87611c0ad6eb6e355b62b3d0">https://github.com/hkmatsumoto/rust/commit/f598ac1bd766d7ee87611c0ad6eb6e355b62b3d0</a> correctly indexes prmimitives :)</p>



<a name="250272705"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Json%20output%20lacks%20some%20item%20which%20are%20supposed%20to%20be%20there/near/250272705" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hirochika Matsumoto <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Json.20output.20lacks.20some.20item.20which.20are.20supposed.20to.20be.20there.html#250272705">(Aug 22 2021 at 12:51)</a>:</h4>
<p>Ok, I'll send a PR</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>