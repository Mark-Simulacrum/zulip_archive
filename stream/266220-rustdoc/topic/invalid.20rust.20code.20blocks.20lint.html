<html>
<head><meta charset="utf-8"><title>invalid rust code blocks lint · rustdoc · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/index.html">rustdoc</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/invalid.20rust.20code.20blocks.20lint.html">invalid rust code blocks lint</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="254084967"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/invalid%20rust%20code%20blocks%20lint/near/254084967" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/invalid.20rust.20code.20blocks.20lint.html#254084967">(Sep 20 2021 at 17:16)</a>:</h4>
<p>I'm trying to migrate the compiler to 2021, and it looks like this lint attempts to tokenize input without passing in the edition of the code block (e.g., <code>edition2018</code>), which runs into errors. (It also seems like the lint is not actually parsing text, just getting a token stream, but that I'm less certain on -- just because async fn foo() {} gives no warnings in 2015).</p>



<a name="254085005"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/invalid%20rust%20code%20blocks%20lint/near/254085005" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/invalid.20rust.20code.20blocks.20lint.html#254085005">(Sep 20 2021 at 17:16)</a>:</h4>
<p>I'm going to silence the lint for now, but wanted to ask if this was a known issue or if a bug report etc makes sense</p>



<a name="254089191"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/invalid%20rust%20code%20blocks%20lint/near/254089191" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/invalid.20rust.20code.20blocks.20lint.html#254089191">(Sep 20 2021 at 17:44)</a>:</h4>
<p>That does seem like a bug. Could you file a bug report?</p>



<a name="254089480"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/invalid%20rust%20code%20blocks%20lint/near/254089480" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/invalid.20rust.20code.20blocks.20lint.html#254089480">(Sep 20 2021 at 17:46)</a>:</h4>
<p>Will put it on my list</p>



<a name="254089838"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/invalid%20rust%20code%20blocks%20lint/near/254089838" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/invalid.20rust.20code.20blocks.20lint.html#254089838">(Sep 20 2021 at 17:48)</a>:</h4>
<p>I suspect the issue is that when we call <code>parse_stream_from_source_str</code>, we need to pass an overrided span that has the correct edition instead of <code>None</code>, which I think inherits the crate's edition.</p>



<a name="254089954"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/invalid%20rust%20code%20blocks%20lint/near/254089954" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/invalid.20rust.20code.20blocks.20lint.html#254089954">(Sep 20 2021 at 17:49)</a>:</h4>
<p>Yeah, that was my suspicion as well when trying to dig in</p>



<a name="254090145"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/invalid%20rust%20code%20blocks%20lint/near/254090145" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/invalid.20rust.20code.20blocks.20lint.html#254090145">(Sep 20 2021 at 17:50)</a>:</h4>
<p>I'll look into it a bit more; it <em>might</em> be an easy fix.</p>



<a name="254143874"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/invalid%20rust%20code%20blocks%20lint/near/254143874" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/invalid.20rust.20code.20blocks.20lint.html#254143874">(Sep 21 2021 at 01:40)</a>:</h4>
<p>Ok, going to go ahead and file an issue. I think this may be something we need to backport, or move the lint to allow by default temporarily in 2021... this is hitting a <em>bunch</em> of code that was "fine" before because we're definitely just tokenizing</p>



<a name="254149560"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/invalid%20rust%20code%20blocks%20lint/near/254149560" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/invalid.20rust.20code.20blocks.20lint.html#254149560">(Sep 21 2021 at 03:06)</a>:</h4>
<p>Yeah, I think the best bet is to move it to allow-by-default temporarily in 2021, and then we can properly fix it after. It is a bit surprising that it only tokenizes; I suspect the purpose of the lint is more to make sure syntax highlighting will work, but of course, it isn't really useful to syntax-highlight non-Rust code.</p>



<a name="254149638"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/invalid%20rust%20code%20blocks%20lint/near/254149638" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/invalid.20rust.20code.20blocks.20lint.html#254149638">(Sep 21 2021 at 03:08)</a>:</h4>
<p>I pinged the team on the issue for further discussion.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>