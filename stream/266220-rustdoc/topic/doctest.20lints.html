<html>
<head><meta charset="utf-8"><title>doctest lints · rustdoc · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/index.html">rustdoc</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/doctest.20lints.html">doctest lints</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="262833273"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/doctest%20lints/near/262833273" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/doctest.20lints.html#262833273">(Nov 26 2021 at 20:36)</a>:</h4>
<p>I spent more of my afternoon on this than I'd like to admit <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span> I wrote up some ideas on how checking lints for doctests should work and integrate with cargo on <a href="https://github.com/rust-lang/cargo/issues/10025#issuecomment-980181784">https://github.com/rust-lang/cargo/issues/10025#issuecomment-980181784</a> and <a href="https://github.com/rust-lang/rust/issues/56232#issuecomment-980419827">https://github.com/rust-lang/rust/issues/56232#issuecomment-980419827</a>. I also opened <a href="https://github.com/rust-lang/rust/pull/91259">https://github.com/rust-lang/rust/pull/91259</a> removing <code>--display-doctest-warnings</code> which is related (although I didn't start an FCP since it's only an unstable option and the alternatives seem pretty clearly an improvement to me).</p>
<p>I have two questions:</p>
<ol>
<li>Does my writeup in the "Oh rust doctest lints, where art þou?" issue seem reasonable? If not, do you have suggestions for improving it?</li>
<li>Do you think this is large enough for an RFC?</li>
</ol>



<a name="262833403"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/doctest%20lints/near/262833403" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/doctest.20lints.html#262833403">(Nov 26 2021 at 20:39)</a>:</h4>
<p>I read it very quickly and didn't see anything crazy. I'll try to take another look in the next days more in depth to try to see how big it'll be.</p>



<a name="262833478"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/doctest%20lints/near/262833478" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/doctest.20lints.html#262833478">(Nov 26 2021 at 20:40)</a>:</h4>
<p>I think the rustdoc side shouldn't be <em>too</em> difficult, we're basically taking the existing code in <code>doctest.rs</code> and running the test-runner directly instead of going through libtest</p>



<a name="262833482"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/doctest%20lints/near/262833482" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/doctest.20lints.html#262833482">(Nov 26 2021 at 20:40)</a>:</h4>
<p>I'm mostly worried about getting the user interface right</p>



<a name="262833628"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/doctest%20lints/near/262833628" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/doctest.20lints.html#262833628">(Nov 26 2021 at 20:43)</a>:</h4>
<p>Funnily enough, I had the opposite in mind haha</p>



<a name="262833744"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/doctest%20lints/near/262833744" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/doctest.20lints.html#262833744">(Nov 26 2021 at 20:45)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/266220-rustdoc/topic/doctest.20lints/near/262833482">said</a>:</p>
<blockquote>
<p>I'm mostly worried about getting the user interface right</p>
</blockquote>
<p>Yeah, my main concern is this all feels really complicated <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span> </p>
<p>And this is as someone who's knowledgeable about rustdoc's edge cases; I imagine it'd feel even more complicated for users.</p>



<a name="262833789"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/doctest%20lints/near/262833789" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/doctest.20lints.html#262833789">(Nov 26 2021 at 20:46)</a>:</h4>
<p>I wonder if there's a way for us to solve these problems in a more unified way.</p>



<a name="262833883"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/doctest%20lints/near/262833883" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/doctest.20lints.html#262833883">(Nov 26 2021 at 20:48)</a>:</h4>
<p>hmm, so I think the cargo interface is pretty clear, other than whether to call it <code>check --doc</code> or split it into <code>check --doctest</code>. I just don't want to have multiple ways to do the same thing.</p>



<a name="262833902"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/doctest%20lints/near/262833902" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/doctest.20lints.html#262833902">(Nov 26 2021 at 20:48)</a>:</h4>
<p>I don't expect people to use rustdoc on its own for this</p>



<a name="262833910"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/doctest%20lints/near/262833910" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/doctest.20lints.html#262833910">(Nov 26 2021 at 20:48)</a>:</h4>
<p>what do you mean by more unified?</p>



<a name="262834052"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/doctest%20lints/near/262834052" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/doctest.20lints.html#262834052">(Nov 26 2021 at 20:51)</a>:</h4>
<p>Well, AIUI, these are currently being proposed: <code>check --doc</code>, <code>check --doctest</code>, <code>clippy --doc[test]</code>. At least some of these would be included as part of <code>--all-targets</code>. It just feels like a lot of flags to keep track of.</p>



<a name="262834122"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/doctest%20lints/near/262834122" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/doctest.20lints.html#262834122">(Nov 26 2021 at 20:52)</a>:</h4>
<p>I thought I saw other flags being proposed as well, but perhaps I'm just thinking of the implementation flags.</p>



<a name="262834153"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/doctest%20lints/near/262834153" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/doctest.20lints.html#262834153">(Nov 26 2021 at 20:53)</a>:</h4>
<p>There's also the existing <code>test --doc</code> ... which would be inconsistent with <code>check --doctest</code>!</p>



<a name="262834159"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/doctest%20lints/near/262834159" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/doctest.20lints.html#262834159">(Nov 26 2021 at 20:53)</a>:</h4>
<blockquote>
<p>clippy --doc[test]</p>
</blockquote>
<p>I'm only suggesting <code>clippy --doc</code>, which would run on doctests. It doesn't make sense to check documentation itself with clippy.</p>
<p>Sure, I would be ok with condensing <code>check --doc</code> and <code>check --doctest</code> into a single command if you think it's simpler. We should probably get feedback from T-cargo about this.</p>



<a name="262834213"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/doctest%20lints/near/262834213" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/doctest.20lints.html#262834213">(Nov 26 2021 at 20:54)</a>:</h4>
<p>Yeah, I mean, I see the advantages of either approach. It just feels like a lot to keep track of.</p>



<a name="262834221"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/doctest%20lints/near/262834221" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/doctest.20lints.html#262834221">(Nov 26 2021 at 20:54)</a>:</h4>
<blockquote>
<p>It just feels like a lot of flags to keep track of.</p>
</blockquote>
<p>hmm, I don't think this is a big deal though? you the user only have to remember the flags you want to use, and if you're confused you can say <code>--all-targets</code> to mean everything</p>



<a name="262834252"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/doctest%20lints/near/262834252" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/doctest.20lints.html#262834252">(Nov 26 2021 at 20:55)</a>:</h4>
<p>cc <span class="user-group-mention" data-user-group-id="3139">@T-cargo</span>, we're trying to imagine what the user interface for doctest lints should look like</p>



<a name="262834263"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/doctest%20lints/near/262834263" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/doctest.20lints.html#262834263">(Nov 26 2021 at 20:56)</a>:</h4>
<p>the most important thing I think is to make sure they're consistent with other cargo commands</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>