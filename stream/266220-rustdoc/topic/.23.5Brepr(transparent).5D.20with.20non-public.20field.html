<html>
<head><meta charset="utf-8"><title>#[repr(transparent)] with non-public field · rustdoc · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/index.html">rustdoc</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/.23.5Brepr(transparent).5D.20with.20non-public.20field.html">#[repr(transparent)] with non-public field</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="259706755"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/%23%5Brepr%28transparent%29%5D%20with%20non-public%20field/near/259706755" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/.23.5Brepr(transparent).5D.20with.20non-public.20field.html#259706755">(Oct 30 2021 at 03:06)</a>:</h4>
<p>Should <code>#[repr(transparent)]</code> be hidden on structs where the field is non-public? My understanding of stability guarantees is that the attribute doesn't guarantee anything unless the field is public.</p>



<a name="259706772"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/%23%5Brepr%28transparent%29%5D%20with%20non-public%20field/near/259706772" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/.23.5Brepr(transparent).5D.20with.20non-public.20field.html#259706772">(Oct 30 2021 at 03:07)</a>:</h4>
<p>that seems reasonable to me, as long as <code>--document-private-items</code> wasn't passed</p>



<a name="259706934"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/%23%5Brepr%28transparent%29%5D%20with%20non-public%20field/near/259706934" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/.23.5Brepr(transparent).5D.20with.20non-public.20field.html#259706934">(Oct 30 2021 at 03:11)</a>:</h4>
<p>can you open an issue?</p>



<a name="259708201"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/%23%5Brepr%28transparent%29%5D%20with%20non-public%20field/near/259708201" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/.23.5Brepr(transparent).5D.20with.20non-public.20field.html#259708201">(Oct 30 2021 at 03:43)</a>:</h4>
<p>Yeah that bit was a given. I'll file an issue shortly.</p>



<a name="259708512"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/%23%5Brepr%28transparent%29%5D%20with%20non-public%20field/near/259708512" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/.23.5Brepr(transparent).5D.20with.20non-public.20field.html#259708512">(Oct 30 2021 at 03:50)</a>:</h4>
<p>Might be worth double-checking with T-lang, but sounds reasonable to me too.</p>



<a name="259708836"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/%23%5Brepr%28transparent%29%5D%20with%20non-public%20field/near/259708836" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/.23.5Brepr(transparent).5D.20with.20non-public.20field.html#259708836">(Oct 30 2021 at 03:59)</a>:</h4>
<p>Per David Tolnay in a previous PR of mine: <a href="https://github.com/rust-lang/rust/pull/72841#pullrequestreview-429527831">https://github.com/rust-lang/rust/pull/72841#pullrequestreview-429527831</a></p>



<a name="259708841"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/%23%5Brepr%28transparent%29%5D%20with%20non-public%20field/near/259708841" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/.23.5Brepr(transparent).5D.20with.20non-public.20field.html#259708841">(Oct 30 2021 at 03:59)</a>:</h4>
<blockquote>
<p>Note that repr(transparent) is not the same as permission to inspect or manipulate the internal representation of a type. That permission only exists if the field is also exposed as pub.</p>
</blockquote>



<a name="259715877"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/%23%5Brepr%28transparent%29%5D%20with%20non-public%20field/near/259715877" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/.23.5Brepr(transparent).5D.20with.20non-public.20field.html#259715877">(Oct 30 2021 at 07:22)</a>:</h4>
<p>The safe transmute work has had a bunch of conversation about how it should have a <code>derive</code> or similar to opt-in, as the <code>repr</code>s are internal.</p>
<p>I'd be tempted to just <em>always</em> exclude <code>repr</code> from rustdoc -- if a user wants to rely on it it should be documented in text, and the <code>[src]</code> link is always there if you want to look at it anyway.</p>



<a name="259716221"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/%23%5Brepr%28transparent%29%5D%20with%20non-public%20field/near/259716221" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/.23.5Brepr(transparent).5D.20with.20non-public.20field.html#259716221">(Oct 30 2021 at 07:31)</a>:</h4>
<p>On the contrary, I specifically added <code>#[repr(u8)]</code> to the <code>Month</code> enum <a href="https://docs.rs/time/0.3.4/time/enum.Month.html">here</a> so that I <em>wouldn't</em> have to say it elsewhere.</p>



<a name="259716404"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/%23%5Brepr%28transparent%29%5D%20with%20non-public%20field/near/259716404" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/.23.5Brepr(transparent).5D.20with.20non-public.20field.html#259716404">(Oct 30 2021 at 07:36)</a>:</h4>
<p><span class="user-mention" data-user-id="245610">@Jacob Pratt</span> this is probably an explicit choice on your part, but you can autogenerate basically that whole file of impls with <code>strum</code><br>
<a href="https://docs.rs/strum/0.22.0/strum/">https://docs.rs/strum/0.22.0/strum/</a></p>



<a name="259716412"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/%23%5Brepr%28transparent%29%5D%20with%20non-public%20field/near/259716412" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/.23.5Brepr(transparent).5D.20with.20non-public.20field.html#259716412">(Oct 30 2021 at 07:37)</a>:</h4>
<p>And yeah I agree it would be weird to hide the repr completely, that seems to kind of defeat the point of adding it</p>



<a name="259716413"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/%23%5Brepr%28transparent%29%5D%20with%20non-public%20field/near/259716413" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/.23.5Brepr(transparent).5D.20with.20non-public.20field.html#259716413">(Oct 30 2021 at 07:37)</a>:</h4>
<p>Yeah, that's a conscious choice. Zero mandatory dependencies <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="259716432"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/%23%5Brepr%28transparent%29%5D%20with%20non-public%20field/near/259716432" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/.23.5Brepr(transparent).5D.20with.20non-public.20field.html#259716432">(Oct 30 2021 at 07:38)</a>:</h4>
<p>All I am suggesting is to hide it when it means nothing to the person viewing it, essentially.</p>



<a name="259725773"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/%23%5Brepr%28transparent%29%5D%20with%20non-public%20field/near/259725773" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/.23.5Brepr(transparent).5D.20with.20non-public.20field.html#259725773">(Oct 30 2021 at 11:30)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/266220-rustdoc/topic/.23.5Brepr.28transparent.29.5D.20with.20non-public.20field/near/259716412">said</a>:</p>
<blockquote>
<p>And yeah I agree it would be weird to hide the repr completely, that seems to kind of defeat the point of adding it</p>
</blockquote>
<p>That depends greatly on what the repr is used for.  Once can also add it for internal <code>unsafe</code> use even through it should never matter to callers.</p>



<a name="259778842"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/%23%5Brepr%28transparent%29%5D%20with%20non-public%20field/near/259778842" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/.23.5Brepr(transparent).5D.20with.20non-public.20field.html#259778842">(Oct 31 2021 at 09:24)</a>:</h4>
<p>Filed as <a href="https://github.com/rust-lang/rust/issues/90435">#90435</a>.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>