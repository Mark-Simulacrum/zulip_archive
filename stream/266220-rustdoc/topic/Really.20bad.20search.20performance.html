<html>
<head><meta charset="utf-8"><title>Really bad search performance · rustdoc · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/index.html">rustdoc</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Really.20bad.20search.20performance.html">Really bad search performance</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="253647510"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Really%20bad%20search%20performance/near/253647510" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chase Wilson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Really.20bad.20search.20performance.html#253647510">(Sep 16 2021 at 20:41)</a>:</h4>
<p>I've been browsing the <a href="https://microsoft.github.io/windows-docs-rs/doc/bindings/Windows/index.html">window-rs docs</a> lately which are a truly massive set of documentation, and searching is painfully slow and stuttery</p>
<p><a href="/user_uploads/4715/k_kS_PTLFoRIL1Hmz-Imt3Pl/Video.mp4">Clip</a></p>
<p>It's worth noting that (just to spite me since I was reporting an issue) my previous "real world" performance was worse than the video depicted, when I was using it organically it was stuttering while I was typing, freezing, not taking inputs, etc.</p>



<a name="253655923"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Really%20bad%20search%20performance/near/253655923" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Really.20bad.20search.20performance.html#253655923">(Sep 16 2021 at 21:45)</a>:</h4>
<p>damn that search-index.js is 46 MB</p>



<a name="253659008"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Really%20bad%20search%20performance/near/253659008" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Really.20bad.20search.20performance.html#253659008">(Sep 16 2021 at 22:12)</a>:</h4>
<p>Yep, I have some perf improvements on hold</p>



<a name="253659028"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Really%20bad%20search%20performance/near/253659028" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Really.20bad.20search.20performance.html#253659028">(Sep 16 2021 at 22:13)</a>:</h4>
<p>alongside a rework of the search engine itself</p>



<a name="253659083"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Really%20bad%20search%20performance/near/253659083" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Really.20bad.20search.20performance.html#253659083">(Sep 16 2021 at 22:13)</a>:</h4>
<p>needs <a href="https://github.com/rust-lang/rust/pull/88268">https://github.com/rust-lang/rust/pull/88268</a> to be merged first</p>



<a name="253667544"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Really%20bad%20search%20performance/near/253667544" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chase Wilson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Really.20bad.20search.20performance.html#253667544">(Sep 16 2021 at 23:40)</a>:</h4>
<p>Good news, I figured out that my recorder has keystroke stuff, so here's the <a href="/user_uploads/4715/FUSHaZfxlRLZxRqKmpHIfPih/Rustdoc.mp4">video</a> with my keystrokes on top of it</p>



<a name="255114066"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Really%20bad%20search%20performance/near/255114066" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Really.20bad.20search.20performance.html#255114066">(Sep 27 2021 at 20:23)</a>:</h4>
<p>As I understand it, searching is O(n) in the number of items in a set of documentation. So very large crates  will indeed have really bad performance.  A few possibilities:</p>
<ul>
<li>With the current code, we could add yield points (e.g. with setTimeout(currentFunction(), 0) ) to avoid stuttering problems.</li>
<li>We can add better user feedback, so for instance before we dive into the expensive search code, we could make sure we update the page to say "Searching for ..."</li>
<li>With new code, presumably what GuillaumeGomez has in mind, we could create an actual index of searchable terms, which could result in a big speedup.</li>
<li>Right now, we automatically search if the user stops typing for 500ms. We could detect when the set of items to search is very large, and turn off the automatic search, instead presenting a prompt "hit enter to search."</li>
</ul>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>