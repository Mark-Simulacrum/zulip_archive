<html>
<head><meta charset="utf-8"><title>implied doc(cfg) · rustdoc · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/index.html">rustdoc</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/implied.20doc(cfg).html">implied doc(cfg)</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="257491224"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/implied%20doc%28cfg%29/near/257491224" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/implied.20doc(cfg).html#257491224">(Oct 14 2021 at 07:25)</a>:</h4>
<p>Appears as though <a href="https://github.com/rust-lang/rust/issues/89596">#89596</a> does <em>not</em> apply to <code>#[cfg(foo)]</code> that is placed in another file. Is this intentional?<br>
(I don't know if the actual boundary is file. I just noticed it when it's on a module or a type defined elsewhere)</p>



<a name="257495787"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/implied%20doc%28cfg%29/near/257495787" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/implied.20doc(cfg).html#257495787">(Oct 14 2021 at 08:08)</a>:</h4>
<p>Do you have an example please so I can take a look?</p>



<a name="257496627"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/implied%20doc%28cfg%29/near/257496627" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/implied.20doc(cfg).html#257496627">(Oct 14 2021 at 08:15)</a>:</h4>
<p>Just on a hunch I created a minimal example:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#![feature(doc_cfg)]</span><span class="w"></span>

<span class="cp">#[cfg(feature = </span><span class="s">"foo"</span><span class="cp">)]</span><span class="w"></span>
<span class="k">mod</span> <span class="nn">foo</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">bar</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">pub</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="n">foo</span>::<span class="n">bar</span><span class="p">;</span><span class="w"></span>
</code></pre></div>



<a name="257496699"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/implied%20doc%28cfg%29/near/257496699" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/implied.20doc(cfg).html#257496699">(Oct 14 2021 at 08:16)</a>:</h4>
<p>If I were to guess I'd say it has something to do with visibility, as making <code>foo</code> public displays the annotation as expected.</p>



<a name="257496895"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/implied%20doc%28cfg%29/near/257496895" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/implied.20doc(cfg).html#257496895">(Oct 14 2021 at 08:18)</a>:</h4>
<p>In addition, <em>even if</em> <code>foo</code> is <code>pub</code>, adding <code>#[doc(inline)]</code> to <code>pub use foo::bar;</code> doesn't have the annotation.</p>



<a name="257496970"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/implied%20doc%28cfg%29/near/257496970" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/implied.20doc(cfg).html#257496970">(Oct 14 2021 at 08:18)</a>:</h4>
<p>The annotations are displayed if the item is validating the cfg. If you want it to be displayed in any case, try <code>#]cfg(any(doc, feature = "foo"))]</code></p>



<a name="257497002"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/implied%20doc%28cfg%29/near/257497002" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/implied.20doc(cfg).html#257497002">(Oct 14 2021 at 08:18)</a>:</h4>
<p><span class="user-mention silent" data-user-id="245610">Jacob Pratt</span> <a href="#narrow/stream/266220-rustdoc/topic/implied.20doc.28cfg.29/near/257496895">said</a>:</p>
<blockquote>
<p>In addition, <em>even if</em> <code>foo</code> is <code>pub</code>, adding <code>#[doc(inline)]</code> to <code>pub use foo::bar;</code> doesn't have the annotation.</p>
</blockquote>
<p>that seems to be another issue</p>



<a name="257497079"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/implied%20doc%28cfg%29/near/257497079" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/implied.20doc(cfg).html#257497079">(Oct 14 2021 at 08:20)</a>:</h4>
<p>Was that the goal of the PR? Or is that the end goal? As a user, I'd expect the <code>#[cfg]</code> annotation be displayed on the re-export in the code as shown.</p>



<a name="257497136"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/implied%20doc%28cfg%29/near/257497136" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/implied.20doc(cfg).html#257497136">(Oct 14 2021 at 08:20)</a>:</h4>
<p>If that wasn't a goal of the PR, okay. But I just want to make sure.</p>



<a name="257497159"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/implied%20doc%28cfg%29/near/257497159" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/implied.20doc(cfg).html#257497159">(Oct 14 2021 at 08:20)</a>:</h4>
<p>It was the goal: to display the cfg annotations for items validating the cfg</p>



<a name="257497221"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/implied%20doc%28cfg%29/near/257497221" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/implied.20doc(cfg).html#257497221">(Oct 14 2021 at 08:21)</a>:</h4>
<p>Ok <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span> Future goals then!</p>



<a name="257497255"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/implied%20doc%28cfg%29/near/257497255" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/implied.20doc(cfg).html#257497255">(Oct 14 2021 at 08:21)</a>:</h4>
<p>Thank you for the minimal implementation, by the way. I'm by no means complaining. I'm happy to have <em>something</em>.</p>



<a name="257497302"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/implied%20doc%28cfg%29/near/257497302" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/implied.20doc(cfg).html#257497302">(Oct 14 2021 at 08:21)</a>:</h4>
<p>otherwise, the technical challenges are much greater. For example, if you have the same item available under different cfgs, first, how do we recognize that it's the same item? Then we'd need to merge all cfgs (this part is easy so it's fine) by that'd require to store the cfgs from the other one, etc</p>



<a name="257497639"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/implied%20doc%28cfg%29/near/257497639" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/implied.20doc(cfg).html#257497639">(Oct 14 2021 at 08:24)</a>:</h4>
<p>Oh, for sure. I just found what I had to be a common pattern - re-exporting something public from inside a private module. I certainly don't mind the few annotations that exist now as compared to before.</p>



<a name="257498151"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/implied%20doc%28cfg%29/near/257498151" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/implied.20doc(cfg).html#257498151">(Oct 14 2021 at 08:28)</a>:</h4>
<p>Quick check shows that 54 instances were removed thanks to this change while 31 remain. So even this catches roughly two thirds of uses in my codebase!</p>



<a name="257500395"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/implied%20doc%28cfg%29/near/257500395" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/implied.20doc(cfg).html#257500395">(Oct 14 2021 at 08:45)</a>:</h4>
<p>yeay! \o/</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>