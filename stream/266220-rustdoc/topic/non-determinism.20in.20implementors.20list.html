<html>
<head><meta charset="utf-8"><title>non-determinism in implementors list · rustdoc · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/index.html">rustdoc</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/non-determinism.20in.20implementors.20list.html">non-determinism in implementors list</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="268298234"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/non-determinism%20in%20implementors%20list/near/268298234" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/non-determinism.20in.20implementors.20list.html#268298234">(Jan 17 2022 at 17:39)</a>:</h4>
<p>hey all -- while reviewing <a href="https://github.com/rust-lang/rust/pull/92800">https://github.com/rust-lang/rust/pull/92800</a>, I was interested in seeing what kinds of differences between the docs we generate for different platforms are currently present. It looks like a common case is different sort order for the foreign impls for a given type (and presumably in general the vec in implementors) -- <a href="https://github.com/rust-lang/rust/blob/master/src/librustdoc/formats/cache.rs#L70">https://github.com/rust-lang/rust/blob/master/src/librustdoc/formats/cache.rs#L70</a></p>
<p>I have two related questions (1) does someone have a quick idea for what might cause that sort of non-determinism across platforms, and (2) would patches fixing it be welcome?</p>
<p>In general, if we can get to a point where at least std's docs are equivalent independent of the host platform rendering them, it would let us generate only a single tarball of docs which would be quite convenient. Obviously, we aren't anywhere near there yet I suspect, but this bug makes it harder to determine which files are "actually" different or just have a slightly different ordering.</p>



<a name="268300559"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/non-determinism%20in%20implementors%20list/near/268300559" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/non-determinism.20in.20implementors.20list.html#268300559">(Jan 17 2022 at 18:04)</a>:</h4>
<p>I suspect it's related to this: <a href="https://github.com/rust-lang/rust/issues/85418">https://github.com/rust-lang/rust/issues/85418</a></p>
<p>What you see under the "Implementors" section is actually pasted together by JS from two sources:</p>
<ul>
<li>The HTML, which was generated by the rustdoc run for the current crate, and</li>
<li>Some JS containing a list of additional implementors, seen when documenting other crates into the same directory.</li>
</ul>
<p>The JS gets updated by each rustdoc run. So for instance for the <code>std</code> docs, that's five runs: <code>core</code>, <code>alloc</code>, <code>std</code>, <code>proc_macro</code>, <code>test</code>. Those are run concurrently, so the order in which the JS gets updated is nondeterministic.</p>
<p>If the goal is determinism of display, we could put some sorting in the JS. It would still not be sorting relative to the other impls, but it would be more deterministic.</p>



<a name="268300591"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/non-determinism%20in%20implementors%20list/near/268300591" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/non-determinism.20in.20implementors.20list.html#268300591">(Jan 17 2022 at 18:04)</a>:</h4>
<p>also see discussion here about a possible rearrangement of the "Implementors" sections - <a href="#narrow/stream/266220-rustdoc/topic/implementors.20in.20foreign.20crates">https://rust-lang.zulipchat.com/#narrow/stream/266220-rustdoc/topic/implementors.20in.20foreign.20crates</a></p>



<a name="268304790"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/non-determinism%20in%20implementors%20list/near/268304790" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/non-determinism.20in.20implementors.20list.html#268304790">(Jan 17 2022 at 18:55)</a>:</h4>
<p>I don't think this is related to the JS/HTML merging; I'm diff'ing the raw html files</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>