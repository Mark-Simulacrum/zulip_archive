<html>
<head><meta charset="utf-8"><title>possible performance win · rustdoc · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/index.html">rustdoc</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/possible.20performance.20win.html">possible performance win</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="270147357"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/possible%20performance%20win/near/270147357" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/possible.20performance.20win.html#270147357">(Feb 01 2022 at 03:47)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/blob/master/src/librustdoc/html/format.rs#L1157-L1158">https://github.com/rust-lang/rust/blob/master/src/librustdoc/html/format.rs#L1157-L1158</a></p>
<p>It looks like <code>inner_full_print</code> (which formats a method signature, and so is called a bunch of times) creates two Strings: args and args_plain, where args_plain seems to be the "plaintext" version of the args, suitable for instance to put in a <code>&lt;pre&gt;</code> tag. But it looks like args_plain is not actually used, except to calculate the width of the declaration to decide if it should be wrapped. We could replace it with a counter that we increment in all the appropriate places.</p>
<p>Also I wonder if we should be making the <code>args</code> String with an initial capacity? We can figure out a sort of median or 80th percentile size of a declaration, and save reallocating as we go.</p>



<a name="270611609"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/possible%20performance%20win/near/270611609" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/possible.20performance.20win.html#270611609">(Feb 03 2022 at 20:20)</a>:</h4>
<p>Hmm, I wonder if I could adjust <code>HtmlWithLimit</code> somehow so we could use it for this purpose. It already has support for counting non-tag characters, so it should be useful for this case</p>



<a name="270611666"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/possible%20performance%20win/near/270611666" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/possible.20performance.20win.html#270611666">(Feb 03 2022 at 20:21)</a>:</h4>
<p>In general, we should just change this code so it writes directly to the buffer rather than returning a new string I think</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>