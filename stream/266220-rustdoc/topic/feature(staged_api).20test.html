<html>
<head><meta charset="utf-8"><title>feature(staged_api) test · rustdoc · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/index.html">rustdoc</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/feature(staged_api).20test.html">feature(staged_api) test</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="268100041"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/feature%28staged_api%29%20test/near/268100041" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/feature(staged_api).20test.html#268100041">(Jan 15 2022 at 02:49)</a>:</h4>
<p><span class="user-mention" data-user-id="307537">@Noah Lev</span> when I add <code>#![feature(staged_api)]</code> near the top of  src/test/rustdoc-gui/src/test_docs/lib.rs, I get tons of these errors:</p>
<div class="codehilite"><pre><span></span><code>error: constant has missing stability attribute
    --&gt; /home/jsha/rust/rust/build/x86_64-unknown-linux-gnu/test/rustdoc-gui/debug/build/test_docs-2878cbbd48bb447d/out/huge_amount_of_consts.rs:3942:1
     |
3942 | pub const A1970: isize = 0;
     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^
</code></pre></div>



<a name="268100045"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/feature%28staged_api%29%20test/near/268100045" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/feature(staged_api).20test.html#268100045">(Jan 15 2022 at 02:49)</a>:</h4>
<p>(re <a href="https://github.com/rust-lang/rust/pull/92830#issuecomment-1013592763">https://github.com/rust-lang/rust/pull/92830#issuecomment-1013592763</a>)</p>



<a name="268100089"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/feature%28staged_api%29%20test/near/268100089" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/feature(staged_api).20test.html#268100089">(Jan 15 2022 at 02:50)</a>:</h4>
<p>Ah, yeah</p>



<a name="268100096"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/feature%28staged_api%29%20test/near/268100096" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/feature(staged_api).20test.html#268100096">(Jan 15 2022 at 02:50)</a>:</h4>
<p>I'd create a new test crate then</p>



<a name="268100104"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/feature%28staged_api%29%20test/near/268100104" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/feature(staged_api).20test.html#268100104">(Jan 15 2022 at 02:50)</a>:</h4>
<p>(<code>test_docs</code> is getting pretty big anyway)</p>



<a name="268100107"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/feature%28staged_api%29%20test/near/268100107" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/feature(staged_api).20test.html#268100107">(Jan 15 2022 at 02:50)</a>:</h4>
<p>The new test would be called <code>staged_api_tests</code> or something like that</p>



<a name="268100574"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/feature%28staged_api%29%20test/near/268100574" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/feature(staged_api).20test.html#268100574">(Jan 15 2022 at 03:01)</a>:</h4>
<p>now I'm getting a really weird error:</p>
<div class="codehilite"><pre><span></span><code>warning: output filename collision.
The lib target `cargo-platform` in package `cargo-platform v0.1.2` has the same output filename as the lib target `cargo-platform` in package `cargo-platform v0.1.2 (/home/jsha/rust/rust/src/tools/cargo/crates/cargo-platform)`.
Colliding filename is: /home/jsha/rust/rust/build/x86_64-unknown-linux-gnu/test/rustdoc-gui/doc/cargo_platform/index.html
The targets should have unique names.
This is a known bug where multiple crates with the same name use
the same path; see &lt;https://github.com/rust-lang/cargo/issues/6313&gt;.
error: document output filename collision
The bin `rustc` in package `rls-rustc v0.6.0 (/home/jsha/rust/rust/src/tools/rls/rls-rustc)` has the same name as the bin `rustc` in package `bootstrap v0.0.0 (/home/jsha/rust/rust/src/bootstrap)`.
Only one may be documented at once since they output to the same path.
Consider documenting only one, renaming one, or marking one with `doc = false` in Cargo.toml.


command did not execute successfully: &quot;/home/jsha/rust/rust/build/x86_64-unknown-linux-gnu/stage0/bin/cargo&quot; &quot;doc&quot; &quot;--target-dir&quot; &quot;/home/jsha/rust/rust/build/x86_64-unknown-linux-gnu/test/rustdoc-gui&quot;
expected success, got: exit status: 101
</code></pre></div>
<p>Even after I remove my newly added crate!</p>



<a name="268100630"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/feature%28staged_api%29%20test/near/268100630" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/feature(staged_api).20test.html#268100630">(Jan 15 2022 at 03:02)</a>:</h4>
<p>What does <code>git status</code> show?</p>



<a name="268100635"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/feature%28staged_api%29%20test/near/268100635" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/feature(staged_api).20test.html#268100635">(Jan 15 2022 at 03:02)</a>:</h4>
<p>If there's nothing there, try <code>./x.py clean</code></p>



<a name="268100642"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/feature%28staged_api%29%20test/near/268100642" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/feature(staged_api).20test.html#268100642">(Jan 15 2022 at 03:02)</a>:</h4>
<p>Did you directly copy <code>test_docs</code> and then rename it and edit its contents or did you do something else?</p>



<a name="268100717"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/feature%28staged_api%29%20test/near/268100717" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/feature(staged_api).20test.html#268100717">(Jan 15 2022 at 03:04)</a>:</h4>
<p>I created a new directory, staged_api, and wrote a new <a href="http://lib.rs">lib.rs</a> in it with minimal contents</p>



<a name="268100726"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/feature%28staged_api%29%20test/near/268100726" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/feature(staged_api).20test.html#268100726">(Jan 15 2022 at 03:05)</a>:</h4>
<p>I've run an x.py clean. Here's the latest output with <code>git status</code> below:</p>
<div class="codehilite"><pre><span></span><code>$ ./x.py test src/test/rustdoc-gui/
Updating only changed submodules
  Submodules updated in 0.01 seconds
Building rustbuild
    Finished dev [unoptimized] target(s) in 0.21s
Building rustdoc for stage2 (x86_64-unknown-linux-gnu)
   Compiling rustdoc v0.0.0 (/home/jsha/rust/rust/src/librustdoc)
   Compiling rustdoc-tool v0.0.0 (/home/jsha/rust/rust/src/tools/rustdoc)
    Finished release [optimized] target(s) in 7.88s
 Documenting settings v0.1.0 (/home/jsha/rust/rust/src/test/rustdoc-gui/src/settings)
    Finished dev [unoptimized + debuginfo] target(s) in 1.05s
   Compiling test_docs v0.1.0 (/home/jsha/rust/rust/src/test/rustdoc-gui/src/test_docs)
 Documenting test_docs v0.1.0 (/home/jsha/rust/rust/src/test/rustdoc-gui/src/test_docs)
    Finished dev [unoptimized + debuginfo] target(s) in 1.66s
 Documenting link_to_definition v0.1.0 (/home/jsha/rust/rust/src/test/rustdoc-gui/src/link_to_definition)
    Finished dev [unoptimized + debuginfo] target(s) in 0.74s
 Documenting implementors v0.1.0 (/home/jsha/rust/rust/src/test/rustdoc-gui/src/lib2/implementors)
    Checking implementors v0.1.0 (/home/jsha/rust/rust/src/test/rustdoc-gui/src/lib2/implementors)
 Documenting lib2 v0.1.0 (/home/jsha/rust/rust/src/test/rustdoc-gui/src/lib2)
    Finished dev [unoptimized + debuginfo] target(s) in 1.51s
warning: output filename collision.
The lib target `cargo-platform` in package `cargo-platform v0.1.2` has the same output filename as the lib target `cargo-platform` in package `cargo-platform v0.1.2 (/home/jsha/rust/rust/src/tools/cargo/crates/cargo-platform)`.
Colliding filename is: /home/jsha/rust/rust/build/x86_64-unknown-linux-gnu/test/rustdoc-gui/doc/cargo_platform/index.html
The targets should have unique names.
This is a known bug where multiple crates with the same name use
the same path; see &lt;https://github.com/rust-lang/cargo/issues/6313&gt;.
error: document output filename collision
The bin `rustc` in package `rls-rustc v0.6.0 (/home/jsha/rust/rust/src/tools/rls/rls-rustc)` has the same name as the bin `rustc` in package `bootstrap v0.0.0 (/home/jsha/rust/rust/src/bootstrap)`.
Only one may be documented at once since they output to the same path.
Consider documenting only one, renaming one, or marking one with `doc = false` in Cargo.toml.


command did not execute successfully: &quot;/home/jsha/rust/rust/build/x86_64-unknown-linux-gnu/stage0/bin/cargo&quot; &quot;doc&quot; &quot;--target-dir&quot; &quot;/home/jsha/rust/rust/build/x86_64-unknown-linux-gnu/test/rustdoc-gui&quot;
expected success, got: exit status: 101


Build completed unsuccessfully in 0:00:15
carapace:~/rust/rust $ git status
On branch style-cleanups
Changes not staged for commit:
  (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)
  (use &quot;git restore &lt;file&gt;...&quot; to discard changes in working directory)
  (commit or discard the untracked or modified content in submodules)
        modified:   library/backtrace (untracked content)

Untracked files:
  (use &quot;git add &lt;file&gt;...&quot; to include in what will be committed)
        package.json

no changes added to commit (use &quot;git add&quot; and/or &quot;git commit -a&quot;)
</code></pre></div>



<a name="268100822"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/feature%28staged_api%29%20test/near/268100822" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/feature(staged_api).20test.html#268100822">(Jan 15 2022 at 03:07)</a>:</h4>
<p>This output is post-clean?</p>



<a name="268100884"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/feature%28staged_api%29%20test/near/268100884" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/feature(staged_api).20test.html#268100884">(Jan 15 2022 at 03:09)</a>:</h4>
<p>Anyway, I think the issue is you need a Cargo.toml and other things in your test</p>



<a name="268100892"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/feature%28staged_api%29%20test/near/268100892" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/feature(staged_api).20test.html#268100892">(Jan 15 2022 at 03:09)</a>:</h4>
<p>yep, post-clean. pretty mysterious. Cargo.toml is a good point.</p>



<a name="268100903"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/feature%28staged_api%29%20test/near/268100903" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/feature(staged_api).20test.html#268100903">(Jan 15 2022 at 03:09)</a>:</h4>
<p>I'd suggest copying <code>test_docs</code>, updating the Cargo.toml, and editing the source</p>



<a name="268100906"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/feature%28staged_api%29%20test/near/268100906" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/feature(staged_api).20test.html#268100906">(Jan 15 2022 at 03:09)</a>:</h4>
<p>Because it looks like you also need a <code>build.rs</code> <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="268100950"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/feature%28staged_api%29%20test/near/268100950" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/feature(staged_api).20test.html#268100950">(Jan 15 2022 at 03:10)</a>:</h4>
<p>Actually the <code>build.rs</code> is not necessary</p>



<a name="268100954"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/feature%28staged_api%29%20test/near/268100954" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/feature(staged_api).20test.html#268100954">(Jan 15 2022 at 03:10)</a>:</h4>
<p>So you'll want to remove that</p>



<a name="268100966"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/feature%28staged_api%29%20test/near/268100966" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/feature(staged_api).20test.html#268100966">(Jan 15 2022 at 03:11)</a>:</h4>
<p>ah! I figured out the mystery - <code>src/test/rustdoc-gui/src/staged_api</code> still existed as an empty directory but wasn't showing up in git status. Once I removed it, things build again.</p>



<a name="268101130"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/feature%28staged_api%29%20test/near/268101130" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/feature(staged_api).20test.html#268101130">(Jan 15 2022 at 03:14)</a>:</h4>
<p>k, now I'm getting:</p>
<div class="codehilite"><pre><span></span><code>error: module has missing stability attribute
 --&gt; lib.rs:1:1
  |
1 | / #![feature(staged_api)]
2 | |
3 | | #[stable(feature=&quot;foo&quot;,since=&quot;1.3.5&quot;)]
4 | | fn foo() {}
  | |___________^

error: could not document `staged_api`
</code></pre></div>
<p><a href="http://lib.rs">lib.rs</a>:</p>
<div class="codehilite"><pre><span></span><code>#![feature(staged_api)]

#[stable(feature=&quot;foo&quot;,since=&quot;1.3.5&quot;)]
fn foo() {}
</code></pre></div>
<p>Cargo.toml:</p>
<div class="codehilite"><pre><span></span><code>[package]
name = &quot;staged_api&quot;
version = &quot;0.1.0&quot;
edition = &quot;2021&quot;

[lib]
path = &quot;lib.rs&quot;

[features]
foo = []
</code></pre></div>



<a name="268101378"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/feature%28staged_api%29%20test/near/268101378" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/feature(staged_api).20test.html#268101378">(Jan 15 2022 at 03:20)</a>:</h4>
<p>aha! got it sorted</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>