<html>
<head><meta charset="utf-8"><title>JSON tests in rust · rustdoc · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/index.html">rustdoc</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/JSON.20tests.20in.20rust.html">JSON tests in rust</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="272462046"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/JSON%20tests%20in%20rust/near/272462046" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nixon Enraght-Moony <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/JSON.20tests.20in.20rust.html#272462046">(Feb 18 2022 at 21:48)</a>:</h4>
<p>I've started working on a tool (<a href="https://github.com/aDotInTheVoid/jsondocckng">link</a>) to replace the existing <code>jsondocck</code> /  <code>check_missing_items.py</code></p>
<p>The idea is you write <code>module.rs</code> and <code>module_test.rs</code> and it will convert <code>module.rs</code> to a json <code>Crate</code>, and then <code>module_test.rs</code> exposes <code>pub(super) fn test(k: TCrate)</code> (TCrate is a conveniance wrapper over Crate`)</p>
<h2>Advantages</h2>
<ul>
<li>Rust is a more expressive language than jsonpath, so writing tests is easier</li>
<li>New Contributors dont need to be taught a new language to write tests</li>
<li>Easier to maintain, as we get type errors when changing the format, rather than hard to diagnose json errors</li>
<li>Easer to maintain, as we can create helper utilities to abstract away common paterns</li>
</ul>
<h2>Disadvantages</h2>
<ul>
<li>We move away from testing on the Raw Json, to the serialized rust repr</li>
<li>Not currently complete</li>
<li>Would we work to integrate</li>
<li>Risk of adding bugs, as less mature</li>
</ul>
<p>cc <span class="user-mention" data-user-id="319144">@CraftSpider</span></p>



<a name="272471470"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/JSON%20tests%20in%20rust/near/272471470" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/JSON.20tests.20in.20rust.html#272471470">(Feb 18 2022 at 23:12)</a>:</h4>
<p>I've had a lot of trouble using the current jsondocck, so this sounds like a good idea to me.</p>



<a name="272471532"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/JSON%20tests%20in%20rust/near/272471532" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/JSON.20tests.20in.20rust.html#272471532">(Feb 18 2022 at 23:13)</a>:</h4>
<p>Why the <code>TCrate</code> wrapper though?</p>



<a name="272473731"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/JSON%20tests%20in%20rust/near/272473731" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nixon Enraght-Moony <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/JSON.20tests.20in.20rust.html#272473731">(Feb 18 2022 at 23:36)</a>:</h4>
<p>It hosts higher level methods that dont make sense to put on <code>Crate</code></p>
<p>eg <code> let foo = k.load_root::&lt;Enum&gt;("Foo");</code></p>



<a name="272473768"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/JSON%20tests%20in%20rust/near/272473768" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/JSON.20tests.20in.20rust.html#272473768">(Feb 18 2022 at 23:37)</a>:</h4>
<p>Why not just create a trait that you implement on <code>Crate</code>?</p>



<a name="272474817"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/JSON%20tests%20in%20rust/near/272474817" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nixon Enraght-Moony <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/JSON.20tests.20in.20rust.html#272474817">(Feb 18 2022 at 23:51)</a>:</h4>
<p>You could, but it feels like an abuse of extension traits, and a wrapper feels more natural</p>



<a name="272474923"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/JSON%20tests%20in%20rust/near/272474923" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> CraftSpider <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/JSON.20tests.20in.20rust.html#272474923">(Feb 18 2022 at 23:52)</a>:</h4>
<p>I'm in support of the idea. I actually wrote a whole JsonPath crate, hoping to eventually replace the current one and fix several of its issues, but this looks like a better long-term solution. I think the cons are either acceptable, or will be mitigated by further work.</p>



<a name="272474970"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/JSON%20tests%20in%20rust/near/272474970" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> CraftSpider <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/JSON.20tests.20in.20rust.html#272474970">(Feb 18 2022 at 23:52)</a>:</h4>
<p>And yeah, I think an extension trait would be fitting, as long as TCrate doesn't need any extra state.</p>



<a name="272475087"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/JSON%20tests%20in%20rust/near/272475087" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> CraftSpider <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/JSON.20tests.20in.20rust.html#272475087">(Feb 18 2022 at 23:54)</a>:</h4>
<p>Ah, response before I sent to the extension idea :P<br>
I'm fine with the wrapper if you really think it's better, this isn't something I'm too opinionated on either way.</p>



<a name="272475272"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/JSON%20tests%20in%20rust/near/272475272" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/JSON.20tests.20in.20rust.html#272475272">(Feb 18 2022 at 23:57)</a>:</h4>
<p>I don't really see how this is an abuse of extension traits, and I'm not sure why a wrapper would be better. Unless <code>TCrate</code> has extra data, there's no need for it?</p>



<a name="272475672"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/JSON%20tests%20in%20rust/near/272475672" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nixon Enraght-Moony <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/JSON.20tests.20in.20rust.html#272475672">(Feb 19 2022 at 00:01)</a>:</h4>
<p>Another reason not do to a wrapper, many methods arnt part of the "public" (to tests) api, (eg the internals of validation), and I dont want to expose then throught the extension trait</p>



<a name="272476637"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/JSON%20tests%20in%20rust/near/272476637" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nixon Enraght-Moony <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/JSON.20tests.20in.20rust.html#272476637">(Feb 19 2022 at 00:12)</a>:</h4>
<p>I've opened <a href="https://github.com/rust-lang/rust/issues/94140">https://github.com/rust-lang/rust/issues/94140</a> to track this</p>



<a name="272476699"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/JSON%20tests%20in%20rust/near/272476699" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> CraftSpider <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/JSON.20tests.20in.20rust.html#272476699">(Feb 19 2022 at 00:13)</a>:</h4>
<p>Hmm, I get the exposure concern. That swings me more towards a wrapper being a good idea.</p>



<a name="272484402"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/JSON%20tests%20in%20rust/near/272484402" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/JSON.20tests.20in.20rust.html#272484402">(Feb 19 2022 at 02:08)</a>:</h4>
<p>I'm confused about what methods you don't want to expose to the testsuite. Where are these methods defined? Isn't rustdoc-json-types just types?</p>



<a name="272484896"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/JSON%20tests%20in%20rust/near/272484896" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nixon Enraght-Moony <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/JSON.20tests.20in.20rust.html#272484896">(Feb 19 2022 at 02:16)</a>:</h4>
<p>Oh, I hadn't pushed them yet, sorry</p>



<a name="272484899"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/JSON%20tests%20in%20rust/near/272484899" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nixon Enraght-Moony <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/JSON.20tests.20in.20rust.html#272484899">(Feb 19 2022 at 02:17)</a>:</h4>
<p>See <a href="https://github.com/aDotInTheVoid/jsondocckng/blob/trunk/src/validate.rs">https://github.com/aDotInTheVoid/jsondocckng/blob/trunk/src/validate.rs</a></p>



<a name="272484925"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/JSON%20tests%20in%20rust/near/272484925" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nixon Enraght-Moony <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/JSON.20tests.20in.20rust.html#272484925">(Feb 19 2022 at 02:17)</a>:</h4>
<p><code>TCrate::validate</code> should be exposed, <code>TCrate::validate_*</code> shouldn't be, and the extension trait won't let us do this</p>



<a name="272848583"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/JSON%20tests%20in%20rust/near/272848583" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nixon Enraght-Moony <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/JSON.20tests.20in.20rust.html#272848583">(Feb 22 2022 at 18:44)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/issues/94140#issuecomment-1047957668">More thaughs on github</a>. Where's the right place to ask questions about bootstrap/rustbuild/compiletest?</p>



<a name="272849979"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/JSON%20tests%20in%20rust/near/272849979" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> CraftSpider <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/JSON.20tests.20in.20rust.html#272849979">(Feb 22 2022 at 18:55)</a>:</h4>
<p>I'd try asking in... t-compiler/help maybe? I am hoping to look into the integration of your stuff to compiletest myself at some point soon, as the existing stuff can handle things like 'custom compile flags' and 'one crate per test' stuff, so it may make your implementation simpler</p>



<a name="272850155"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/JSON%20tests%20in%20rust/near/272850155" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nixon Enraght-Moony <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/JSON.20tests.20in.20rust.html#272850155">(Feb 22 2022 at 18:56)</a>:</h4>
<p>Yeah, I deffinatly want to put <code>compiletest</code> in charge of invoking rustdoc</p>



<a name="272850316"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/JSON%20tests%20in%20rust/near/272850316" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> CraftSpider <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/JSON.20tests.20in.20rust.html#272850316">(Feb 22 2022 at 18:57)</a>:</h4>
<p>Here's the existing jsondocck invocation <a href="https://github.com/rust-lang/rust/blob/68369a041cea809a87e5bd80701da90e0e0a4799/src/tools/compiletest/src/runtest.rs#L2412">https://github.com/rust-lang/rust/blob/68369a041cea809a87e5bd80701da90e0e0a4799/src/tools/compiletest/src/runtest.rs#L2412</a></p>



<a name="272850566"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/JSON%20tests%20in%20rust/near/272850566" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> CraftSpider <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/JSON.20tests.20in.20rust.html#272850566">(Feb 22 2022 at 18:59)</a>:</h4>
<p>Some of the other stuff in that file may be helpful for figuring out how to handle compiling crates for testing 'alongside'. The existing 'auxiliary' infrastructure may be what you want to support the single common utilities.</p>



<a name="272850604"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/JSON%20tests%20in%20rust/near/272850604" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> CraftSpider <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/JSON.20tests.20in.20rust.html#272850604">(Feb 22 2022 at 18:59)</a>:</h4>
<p>Though it may also not be, I'm not sure</p>



<a name="275039050"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/JSON%20tests%20in%20rust/near/275039050" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nixon Enraght-Moony <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/JSON.20tests.20in.20rust.html#275039050">(Mar 11 2022 at 21:55)</a>:</h4>
<p>Started working on this: <a href="https://github.com/aDotInTheVoid/rust/tree/jsondocck-ng">https://github.com/aDotInTheVoid/rust/tree/jsondocck-ng</a></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>