<html>
<head><meta charset="utf-8"><title>syntax aliases · rustdoc · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/index.html">rustdoc</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/syntax.20aliases.html">syntax aliases</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="266896087"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/syntax%20aliases/near/266896087" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/syntax.20aliases.html#266896087">(Jan 05 2022 at 04:13)</a>:</h4>
<p>in rustdoc search queries, <code>&lt;</code> and <code>&gt;</code> are syntax (indicating type parameters).</p>
<p>However, <code>&lt;</code> is also a valid search - it is a doc alias for the <code>Ord</code>family of traits. We have tests for this.</p>
<p>I propose we eliminate the possibility of searching for <code>&lt;</code> as a type, in favor of an unambiguous grammar for rustdoc search queries. This would simplify the search code somewhat.</p>
<p>More broadly - maybe we should eliminate the possibility of punctuation as a doc alias?</p>
<p>Here's the PR that added doc aliases for many common operators: <a href="https://github.com/rust-lang/rust/pull/50231/files">https://github.com/rust-lang/rust/pull/50231/files</a></p>



<a name="266897292"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/syntax%20aliases/near/266897292" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/syntax.20aliases.html#266897292">(Jan 05 2022 at 04:34)</a>:</h4>
<p>alternately, we could say syntaxy doc aliases only get returned if they are an exact match for the whole search, so the query parser doesn't have to worry about them</p>



<a name="266898716"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/syntax%20aliases/near/266898716" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/syntax.20aliases.html#266898716">(Jan 05 2022 at 05:05)</a>:</h4>
<p><span class="user-mention silent" data-user-id="315412">jsha</span> <a href="#narrow/stream/266220-rustdoc/topic/syntax.20aliases/near/266897292">said</a>:</p>
<blockquote>
<p>alternately, we could say syntaxy doc aliases only get returned if they are an exact match for the whole search, so the query parser doesn't have to worry about them</p>
</blockquote>
<p>That seems like the best approach to me, assuming it's not too complicated to implement.</p>



<a name="266899713"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/syntax%20aliases/near/266899713" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/syntax.20aliases.html#266899713">(Jan 05 2022 at 05:26)</a>:</h4>
<p>It winds up being kinda messy because it means the query parser has to accept any arbitrary string, in hopes of matching against some doc alias. Alternately there could be a separate phase that happens _before_ query parsing, where we try to match the raw query against all doc aliases. Neither way seems super appealing.</p>



<a name="266938972"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/syntax%20aliases/near/266938972" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/syntax.20aliases.html#266938972">(Jan 05 2022 at 14:04)</a>:</h4>
<p>actually i thought of how to do this: in <span class="user-mention" data-user-id="210316">@GuillaumeGomez</span>'s PR in progress, when we catch a query parser error, we always return no results.</p>
<p>Instead, when we catch a query parser error we should return a ParsedQuery with <code>raw: "&lt;"</code> and <code>literalSearch: true</code>.</p>



<a name="266954701"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/syntax%20aliases/near/266954701" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/syntax.20aliases.html#266954701">(Jan 05 2022 at 16:13)</a>:</h4>
<p>Something I thought about was simply to do as follow: if there is an error, we simply try to check all doc aliases, and if there are none, then we show the syntax error</p>



<a name="266955567"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/syntax%20aliases/near/266955567" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/syntax.20aliases.html#266955567">(Jan 05 2022 at 16:20)</a>:</h4>
<p>I think it's better to have a clean separation of duties. The query parser's job is to produce a ParsedQuery (or possibly an error). <code>execSearch</code>'s job is to process that query.</p>
<p>Since we already have a way to express "match this exact string" in a ParsedQuery, we might as well use that. Then <code>execSearch</code> can do its job as normal.</p>



<a name="266956284"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/syntax%20aliases/near/266956284" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/syntax.20aliases.html#266956284">(Jan 05 2022 at 16:26)</a>:</h4>
<p>It's not part of the parser, it's after it. Something like:</p>
<div class="codehilite"><pre><span></span><code>var parsed = ParserQuery(userQuery);
if (!parsed.error) {
    execSearch(parsed);
}
lookForDocAliases(userQuery);
</code></pre></div>
<p>Currently, <code>lookForDocAliases</code> is called in the <code>!parsed.error</code> (and is already a special call).</p>



<a name="267203529"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/syntax%20aliases/near/267203529" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/syntax.20aliases.html#267203529">(Jan 07 2022 at 15:41)</a>:</h4>
<p>In the last round of review, I had a bunch of comments on places where we should really error out because invalid syntax was found, and you mentioned we can't do that because of doc aliases. I really think we should implement "on error, search as a raw string" as part of this PR. It will make the parser much much nicer.</p>



<a name="267208444"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/syntax%20aliases/near/267208444" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/syntax.20aliases.html#267208444">(Jan 07 2022 at 16:20)</a>:</h4>
<p>I'm fine with it. So then we should show the syntax error message only if no result was found? It's a bit confusing no?</p>



<a name="267209424"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/syntax%20aliases/near/267209424" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/syntax.20aliases.html#267209424">(Jan 07 2022 at 16:28)</a>:</h4>
<p>Should I show the syntax error in any case?</p>



<a name="267210013"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/syntax%20aliases/near/267210013" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/syntax.20aliases.html#267210013">(Jan 07 2022 at 16:33)</a>:</h4>
<p>No, I think we should avoid showing syntax errors to the user if they can help it. What I'm thinking is like this:</p>
<ul>
<li>User enters <code>::::::</code></li>
<li>Parser throws an error!</li>
<li>We look for doc aliases that exactly match (or substring match?) <code>::::::</code>. If they exist, we show them.</li>
<li>Otherwise, no results</li>
</ul>



<a name="267216211"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/syntax%20aliases/near/267216211" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/syntax.20aliases.html#267216211">(Jan 07 2022 at 17:23)</a>:</h4>
<p>We don't show the error like we do currently then? Because currently, if the parser has an error, we show it</p>



<a name="267217500"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/syntax%20aliases/near/267217500" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/syntax.20aliases.html#267217500">(Jan 07 2022 at 17:33)</a>:</h4>
<p>ah I hadn't realized that. yes, let's not show the error to the user. we could console.log it if you think it would be useful for debugging.</p>



<a name="267223500"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/syntax%20aliases/near/267223500" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/syntax.20aliases.html#267223500">(Jan 07 2022 at 18:23)</a>:</h4>
<p>That seems pretty bad too... How can the user fix the query? Maybe we can show the syntax error and add something like <code>syntax error: ... but some doc aliases matched:</code></p>



<a name="267232395"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/syntax%20aliases/near/267232395" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/syntax.20aliases.html#267232395">(Jan 07 2022 at 19:32)</a>:</h4>
<p>I think we should show errors. Rustdoc's search is/will be complex enough that I think it'd be best to not silently fail.</p>



<a name="267244206"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/syntax%20aliases/near/267244206" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/syntax.20aliases.html#267244206">(Jan 07 2022 at 21:19)</a>:</h4>
<p>Ok, so I'll implement all the errors suggested by <span class="user-mention" data-user-id="315412">@jsha</span> and if there are aliases matching it, show them too. I'll do that tomorrow. :)</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>