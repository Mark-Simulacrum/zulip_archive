<html>
<head><meta charset="utf-8"><title>Incorrect auto trait impl Â· rustdoc Â· Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/index.html">rustdoc</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Incorrect.20auto.20trait.20impl.html">Incorrect auto trait impl</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="276097871"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Incorrect%20auto%20trait%20impl/near/276097871" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt ðŸ‡ºðŸ‡¦ <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Incorrect.20auto.20trait.20impl.html#276097871">(Mar 21 2022 at 18:51)</a>:</h4>
<p>I just ran across something peculiar. On <a href="http://docs.rs">docs.rs</a>, <code>time::error::Format</code> is correctly shown as <code>!UnwindSafe</code> and <code>!RefUnwindSafe</code> because of the presence of <code>std::io::Error</code> in a variant <a href="https://docs.rs/time/latest/time/error/enum.Format.html">(ref)</a>. However, the docs I build in CI (using the same flags) show the exact opposite â€” it implements <code>UnwindSafe</code> and <code>RefUnwindSafe</code>, which is incorrect <a href="https://time-rs.github.io/api/time/error/enum.Format.html">(ref)</a>. I just reproduced the latter locally on the latest nightly. Note that the type <em>does not</em> implement either trait.</p>
<p>Something isn't right here. The definition of the enum has not changed, yet the generated documentation is now wrong. This must have happened sometime since January 26 when the most recent version of <code>time</code> was published.</p>



<a name="276098317"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Incorrect%20auto%20trait%20impl/near/276098317" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt ðŸ‡ºðŸ‡¦ <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Incorrect.20auto.20trait.20impl.html#276098317">(Mar 21 2022 at 18:54)</a>:</h4>
<p>Related? <a href="https://github.com/rust-lang/rust/issues/90324">#90324</a></p>



<a name="276098364"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Incorrect%20auto%20trait%20impl/near/276098364" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt ðŸ‡ºðŸ‡¦ <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Incorrect.20auto.20trait.20impl.html#276098364">(Mar 21 2022 at 18:54)</a>:</h4>
<p>The time frame doesn't match up (assuming <a href="http://docs.rs">docs.rs</a> uses the latest nightly), but the general bug is the same.</p>



<a name="276101796"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Incorrect%20auto%20trait%20impl/near/276101796" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Incorrect.20auto.20trait.20impl.html#276101796">(Mar 21 2022 at 19:24)</a>:</h4>
<p>I <em>think</em> it is related. <a href="https://github.com/rust-lang/rust/pull/95069">https://github.com/rust-lang/rust/pull/95069</a> should fix it. It's waiting for compiler people to check it's doing what it's supposed to. Strange that there is a difference between local and remote though.</p>



<a name="276394093"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Incorrect%20auto%20trait%20impl/near/276394093" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Incorrect.20auto.20trait.20impl.html#276394093">(Mar 23 2022 at 20:19)</a>:</h4>
<p><span class="user-mention" data-user-id="245610">@Jacob Pratt</span> the <a href="http://docs.rs">docs.rs</a> link you sent (<a href="https://docs.rs/time/latest/time/error/enum.Format.html">https://docs.rs/time/latest/time/error/enum.Format.html</a>) shows the same as the GitHub link, that <code>UnwindSafe</code> and <code>RefUnwindSafe</code> (not their negations) <strong>are implemented</strong>. The <code>/latest/</code> currently redirects to version 0.3.9, but 0.3.7 â€“ which was built by <a href="http://docs.rs">docs.rs</a> in January â€“ shows the negations that you describe. So there's actually no difference between CI and <a href="http://docs.rs">docs.rs</a>.</p>



<a name="276394294"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Incorrect%20auto%20trait%20impl/near/276394294" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Incorrect.20auto.20trait.20impl.html#276394294">(Mar 23 2022 at 20:20)</a>:</h4>
<p>Yeah, I published 0.3.9 in the meantime. My intent of pointing that out was that something must have changed in that ~2 month period.</p>



<a name="276401061"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Incorrect%20auto%20trait%20impl/near/276401061" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Incorrect.20auto.20trait.20impl.html#276401061">(Mar 23 2022 at 21:10)</a>:</h4>
<p>Ah, I see what you mean <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="276401249"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Incorrect%20auto%20trait%20impl/near/276401249" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Incorrect.20auto.20trait.20impl.html#276401249">(Mar 23 2022 at 21:12)</a>:</h4>
<p>I'm not sure what would have changed; it's weird. If you really want, you could bisect it using <a href="https://github.com/rust-lang/cargo-bisect-rustc">https://github.com/rust-lang/cargo-bisect-rustc</a> ( <code>cargo bisect-rustc --prompt --start=YYYY-MM-DD --end=YYYY-MM-DD -- doc</code>).</p>



<a name="276401274"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Incorrect%20auto%20trait%20impl/near/276401274" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Incorrect.20auto.20trait.20impl.html#276401274">(Mar 23 2022 at 21:12)</a>:</h4>
<p>For those that work on it, it gives a definitive start and end point for a bisection. I figure that would narrow it down to only a couple of PRs, at which point it should be (I think?) somewhat obvious what the change was.</p>



<a name="276401338"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Incorrect%20auto%20trait%20impl/near/276401338" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Incorrect.20auto.20trait.20impl.html#276401338">(Mar 23 2022 at 21:13)</a>:</h4>
<p>Yeah, I might do a bisection at some point. Just takes time and clogs up my bandwidth, obviously.</p>



<a name="276406632"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Incorrect%20auto%20trait%20impl/near/276406632" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Incorrect.20auto.20trait.20impl.html#276406632">(Mar 23 2022 at 22:00)</a>:</h4>
<p>cargo-bisect-rustc will bisect to a single PR (although it may be a rollup PR), as long as the regression happened within the last half-year or so.</p>



<a name="276416601"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Incorrect%20auto%20trait%20impl/near/276416601" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Incorrect.20auto.20trait.20impl.html#276416601">(Mar 23 2022 at 23:36)</a>:</h4>
<p>Regression occurred in this PR: <a href="https://github.com/rust-lang/rust/pull/87869">https://github.com/rust-lang/rust/pull/87869</a></p>
<p>cc <span class="user-mention" data-user-id="210316">@GuillaumeGomez</span>  <span class="user-mention" data-user-id="209168">@Thom Chiovoloni</span></p>



<a name="276416686"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Incorrect%20auto%20trait%20impl/near/276416686" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Incorrect.20auto.20trait.20impl.html#276416686">(Mar 23 2022 at 23:37)</a>:</h4>
<p>Oh, does io::Error need explicit UnwindSafe/RefUnwindSafe impls with the bitpacked repr now?</p>



<a name="276416771"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Incorrect%20auto%20trait%20impl/near/276416771" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Incorrect.20auto.20trait.20impl.html#276416771">(Mar 23 2022 at 23:38)</a>:</h4>
<p>That's surprising, but should be fine.</p>



<a name="276416883"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Incorrect%20auto%20trait%20impl/near/276416883" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Incorrect.20auto.20trait.20impl.html#276416883">(Mar 23 2022 at 23:40)</a>:</h4>
<p>Also I see that <a href="https://github.com/rust-lang/rust/issues/95203">#95203</a> was opened two days ago (seemingly not in response to this thread), which links back to that PR</p>



<a name="276416982"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Incorrect%20auto%20trait%20impl/near/276416982" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Incorrect.20auto.20trait.20impl.html#276416982">(Mar 23 2022 at 23:40)</a>:</h4>
<p><span class="user-mention silent" data-user-id="209168">Thom Chiovoloni</span> <a href="#narrow/stream/266220-rustdoc/topic/Incorrect.20auto.20trait.20impl/near/276416686">said</a>:</p>
<blockquote>
<p>Oh, does io::Error need explicit UnwindSafe/RefUnwindSafe impls with the bitpacked repr now?</p>
</blockquote>
<p><code>io::Error</code> actually went from <code>!UnwindSafe</code> to <code>UnwindSafe</code>, not the other way around. Apparently this is only the case on 64 bit platforms.</p>



<a name="276417028"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Incorrect%20auto%20trait%20impl/near/276417028" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Incorrect.20auto.20trait.20impl.html#276417028">(Mar 23 2022 at 23:41)</a>:</h4>
<p>Uh, hm. I suppose it's not unwindsafe because the custom data could be !unwindsafe?</p>



<a name="276417087"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Incorrect%20auto%20trait%20impl/near/276417087" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Incorrect.20auto.20trait.20impl.html#276417087">(Mar 23 2022 at 23:42)</a>:</h4>
<p>iirc that's what the backtrace showed a couple days ago</p>



<a name="276417094"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Incorrect%20auto%20trait%20impl/near/276417094" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Incorrect.20auto.20trait.20impl.html#276417094">(Mar 23 2022 at 23:42)</a>:</h4>
<p>It was the <code>Box&lt;dyn Error&gt;</code> in <code>Error::Custom</code></p>



<a name="276417166"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Incorrect%20auto%20trait%20impl/near/276417166" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Incorrect.20auto.20trait.20impl.html#276417166">(Mar 23 2022 at 23:43)</a>:</h4>
<p>I see. So it needs a !UnwindSafe impl (or some PhantomData)</p>



<a name="276417243"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Incorrect%20auto%20trait%20impl/near/276417243" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Incorrect.20auto.20trait.20impl.html#276417243">(Mar 23 2022 at 23:44)</a>:</h4>
<p>That would be my assumption. I know neither the reason for the change nor what correct is, just that it changed <span aria-label="shrug" class="emoji emoji-1f937" role="img" title="shrug">:shrug:</span></p>



<a name="276417277"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Incorrect%20auto%20trait%20impl/near/276417277" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Incorrect.20auto.20trait.20impl.html#276417277">(Mar 23 2022 at 23:45)</a>:</h4>
<p>Yeah it wasn't intended to change.</p>



<a name="276417293"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Incorrect%20auto%20trait%20impl/near/276417293" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Incorrect.20auto.20trait.20impl.html#276417293">(Mar 23 2022 at 23:45)</a>:</h4>
<div class="codehilite" data-code-language="Text only"><pre><span></span><code>    = help: the trait `UnwindSafe` is not implemented for `(dyn StdError + Send + Sync + 'static)`
    = note: required because of the requirements on the impl of `UnwindSafe` for `Unique&lt;(dyn StdError + Send + Sync + 'static)&gt;`
    = note: required because it appears within the type `Box&lt;(dyn StdError + Send + Sync + 'static)&gt;`
    = note: required because it appears within the type `std::io::error::Custom`
    = note: required because of the requirements on the impl of `UnwindSafe` for `Unique&lt;std::io::error::Custom&gt;`
    = note: required because it appears within the type `Box&lt;std::io::error::Custom&gt;`
    = note: required because it appears within the type `std::io::error::Repr`
    = note: required because it appears within the type `std::io::Error`
</code></pre></div>
<p>Relevant part of the backtrace</p>



<a name="276417421"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Incorrect%20auto%20trait%20impl/near/276417421" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Incorrect.20auto.20trait.20impl.html#276417421">(Mar 23 2022 at 23:47)</a>:</h4>
<p>Can you file a bug about the fact that this changed? I probably can't get a patch up today</p>



<a name="276417664"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Incorrect%20auto%20trait%20impl/near/276417664" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Incorrect.20auto.20trait.20impl.html#276417664">(Mar 23 2022 at 23:50)</a>:</h4>
<p>That would be <a href="https://github.com/rust-lang/rust/issues/95203">#95203</a>, I think</p>



<a name="276418290"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Incorrect%20auto%20trait%20impl/near/276418290" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Incorrect.20auto.20trait.20impl.html#276418290">(Mar 23 2022 at 23:58)</a>:</h4>
<p>Thanks</p>



<a name="276422858"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Incorrect%20auto%20trait%20impl/near/276422858" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Incorrect.20auto.20trait.20impl.html#276422858">(Mar 24 2022 at 01:11)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="245610">@Jacob Pratt</span> !</p>



<a name="276423021"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Incorrect%20auto%20trait%20impl/near/276423021" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Incorrect.20auto.20trait.20impl.html#276423021">(Mar 24 2022 at 01:14)</a>:</h4>
<p>No problem! Good news for you is that it's a libs issue, not rustdoc.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>