<html>
<head><meta charset="utf-8"><title>broken CI · rustdoc · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/index.html">rustdoc</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/broken.20CI.html">broken CI</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="262561959"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/broken%20CI/near/262561959" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/broken.20CI.html#262561959">(Nov 24 2021 at 09:08)</a>:</h4>
<p>FYI, CI was broken by a recently merged PR of mine. It seems to only affect rustdoc PRs AFAICT? Anyhow I have a PR up with a fix: <a href="https://github.com/rust-lang/rust/pull/91171">https://github.com/rust-lang/rust/pull/91171</a></p>



<a name="262568823"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/broken%20CI/near/262568823" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/broken.20CI.html#262568823">(Nov 24 2021 at 10:14)</a>:</h4>
<p>This is strange, how could it pass CI before? :-/</p>



<a name="262604506"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/broken%20CI/near/262604506" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/broken.20CI.html#262604506">(Nov 24 2021 at 15:41)</a>:</h4>
<p>hmm, I worry that the tools tests are <em>only</em> running in PR CI and not bors</p>



<a name="262604550"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/broken%20CI/near/262604550" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/broken.20CI.html#262604550">(Nov 24 2021 at 15:41)</a>:</h4>
<p><span class="user-mention" data-user-id="210316">@GuillaumeGomez</span> you added those originally, right? the <code>gnu-tools</code> job?</p>



<a name="262604614"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/broken%20CI/near/262604614" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/broken.20CI.html#262604614">(Nov 24 2021 at 15:42)</a>:</h4>
<p>but that wouldn't make sense why they then failed later ...</p>



<a name="262611448"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/broken%20CI/near/262611448" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/broken.20CI.html#262611448">(Nov 24 2021 at 16:34)</a>:</h4>
<p>Yes I did, but even the fact that they passed in the CI is concerning</p>



<a name="262611495"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/broken%20CI/near/262611495" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/broken.20CI.html#262611495">(Nov 24 2021 at 16:34)</a>:</h4>
<p>I checked and they ran in the CI even before when run with r+</p>



<a name="262612437"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/broken%20CI/near/262612437" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/broken.20CI.html#262612437">(Nov 24 2021 at 16:41)</a>:</h4>
<p>oof, that makes me worry that the GOML test runner has a bug somewhere</p>



<a name="262612513"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/broken%20CI/near/262612513" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/broken.20CI.html#262612513">(Nov 24 2021 at 16:41)</a>:</h4>
<p>Very likely, I'm investigating it</p>



<a name="262612621"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/broken%20CI/near/262612621" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/broken.20CI.html#262612621">(Nov 24 2021 at 16:42)</a>:</h4>
<p>I added another check today about text colors to prevent <a href="https://github.com/rust-lang/rust/pull/91179#discussion_r756023009">this</a></p>



<a name="262612668"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/broken%20CI/near/262612668" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/broken.20CI.html#262612668">(Nov 24 2021 at 16:42)</a>:</h4>
<p>I'll send a PR to update the browser-ui-test version we use in the CI</p>



<a name="262612850"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/broken%20CI/near/262612850" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/broken.20CI.html#262612850">(Nov 24 2021 at 16:44)</a>:</h4>
<p>interestingly enough, I trigger this bug 100% locally</p>



<a name="262615758"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/broken%20CI/near/262615758" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/broken.20CI.html#262615758">(Nov 24 2021 at 17:04)</a>:</h4>
<p>Anyway, I opened <a href="https://github.com/rust-lang/rust/pull/91181">https://github.com/rust-lang/rust/pull/91181</a>. It'll already prevent issues we recently encountered.</p>



<a name="262615786"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/broken%20CI/near/262615786" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/broken.20CI.html#262615786">(Nov 24 2021 at 17:05)</a>:</h4>
<p>For the rest, I'll continue my investigations.</p>



<a name="262625387"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/broken%20CI/near/262625387" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/broken.20CI.html#262625387">(Nov 24 2021 at 18:31)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/266220-rustdoc/topic/broken.20CI/near/262604550">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="210316">GuillaumeGomez</span> you added those originally, right? the <code>gnu-tools</code> job?</p>
</blockquote>
<p>gnu-tools only runs tests if subtrees/submodules were changed, e.g. <a href="https://github.com/rust-lang/rust/runs/4315888779?check_suite_focus=true">https://github.com/rust-lang/rust/runs/4315888779?check_suite_focus=true</a></p>



<a name="262625739"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/broken%20CI/near/262625739" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/broken.20CI.html#262625739">(Nov 24 2021 at 18:34)</a>:</h4>
<p>So I don't think it'd run on rustdoc PRs.</p>



<a name="262626923"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/broken%20CI/near/262626923" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/broken.20CI.html#262626923">(Nov 24 2021 at 18:46)</a>:</h4>
<p>It was updated recently to run on changes to librustdoc too; I don't have a link offhand</p>



<a name="262630090"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/broken%20CI/near/262630090" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/broken.20CI.html#262630090">(Nov 24 2021 at 19:15)</a>:</h4>
<p>The CI run I linked to is from today, so it doesn't look that way?</p>



<a name="262631742"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/broken%20CI/near/262631742" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/broken.20CI.html#262631742">(Nov 24 2021 at 19:33)</a>:</h4>
<p><span class="user-mention" data-user-id="307537">@Noah Lev</span> <a href="https://github.com/rust-lang/rust/issues/91185">#91185</a> doesn't appear to touch librustdoc. It seems like it is working as expected?</p>



<a name="262632470"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/broken%20CI/near/262632470" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/broken.20CI.html#262632470">(Nov 24 2021 at 19:40)</a>:</h4>
<p>You are correct it doesn't touch rustdoc. The thing that confused me is the CI message doesn't make it sound like it checked rustdoc:</p>
<div class="codehilite"><pre><span></span><code>Not executing this job since no submodules nor subtrees were updated
</code></pre></div>
<p>But looking at the <code>should-skip-this.sh</code> code, it does look correct.</p>



<a name="262632507"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/broken%20CI/near/262632507" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/broken.20CI.html#262632507">(Nov 24 2021 at 19:40)</a>:</h4>
<p>I've always wondered why there's gnu-tools and gnu-llvm-12. Why are they separate?</p>



<a name="262632946"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/broken%20CI/near/262632946" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/broken.20CI.html#262632946">(Nov 24 2021 at 19:45)</a>:</h4>
<p>I'm not sure I understand the question, those jobs do completely different things.  <code>gnu-tools</code> runs tests for various submodules, rustfmt, and clippy, and publishes the toolstate status.</p>
<p><code>gnu-llvm-12</code> runs some compiler tests using an older version of LLVM than is normally used.</p>



<a name="262633549"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/broken%20CI/near/262633549" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/broken.20CI.html#262633549">(Nov 24 2021 at 19:52)</a>:</h4>
<p><span class="user-mention silent" data-user-id="120518">Eric Huss</span> <a href="#narrow/stream/266220-rustdoc/topic/broken.20CI/near/262632946">said</a>:</p>
<blockquote>
<p>I'm not sure I understand the question, those jobs do completely different things.  <code>gnu-tools</code> runs tests for various submodules, rustfmt, and clippy, and publishes the toolstate status.</p>
<p><code>gnu-llvm-12</code> runs some compiler tests using an older version of LLVM than is normally used.</p>
</blockquote>
<p>Then why does gnu-tools run for rustdoc if it only deals with toolstate? And why is an old version of LLVM used for x86_64-gnu, given that the only other job is for MingW?</p>



<a name="262649843"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/broken%20CI/near/262649843" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/broken.20CI.html#262649843">(Nov 24 2021 at 23:06)</a>:</h4>
<p>I think rustdoc tests are done in <code>gnu-tools</code> just for convenience (it is already checking for git changes, which requires fetching more history from github, and it doesn't fit very well in the other jobs).</p>
<p>As for why PRs use an older LLVM like <code>gnu-llvm-12</code>, I can only guess is to keep the build times down by avoiding building llvm, and that image conveniently has llvm available, and is fast.</p>



<a name="262649959"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/broken%20CI/near/262649959" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/broken.20CI.html#262649959">(Nov 24 2021 at 23:08)</a>:</h4>
<p>Hmm, I guess I just would assume that rustdoc tests would be run at the same time as rustc tests since rustdoc is pretty much just a layer on top of rustc.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>