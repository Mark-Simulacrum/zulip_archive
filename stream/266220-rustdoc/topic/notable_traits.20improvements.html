<html>
<head><meta charset="utf-8"><title>notable_traits improvements · rustdoc · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/index.html">rustdoc</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/notable_traits.20improvements.html">notable_traits improvements</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="275149100"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/notable_traits%20improvements/near/275149100" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Conrad Ludgate <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/notable_traits.20improvements.html#275149100">(Mar 13 2022 at 11:42)</a>:</h4>
<p>I've been thinking about notable traits recently. I found the original tracking issue for 'spotlight' (renamed later) and I had some thoughts. Would appreciate some feedback: <a href="https://github.com/rust-lang/rust/issues/45040#issuecomment-1066082986">https://github.com/rust-lang/rust/issues/45040#issuecomment-1066082986</a></p>



<a name="275164789"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/notable_traits%20improvements/near/275164789" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/notable_traits.20improvements.html#275164789">(Mar 13 2022 at 17:11)</a>:</h4>
<p>I like the idea of reinforcing the Notable Traits concept on struct / enum pages. It could help people figure out what a "Notable Trait" is. And given those traits are often the most important thing about a type, it makes sense to front-load them.</p>
<p>I started a thread about some somewhat orthogonal changes to notable traits here: <a href="https://internals.rust-lang.org/t/revisiting-spotlight-notable-traits-in-rustdoc/14759">https://internals.rust-lang.org/t/revisiting-spotlight-notable-traits-in-rustdoc/14759</a>. TL;DR I wanted to replace the <code>(i)</code> with a chip / lozenge that says what the notable trait is: <code>Iterator</code>, <code>Read</code>, <code>Write</code>, etc.</p>
<p>A similar concept could apply here: Rather than have a heading that says "Notable Traits" but doesn't say what they are, why not have a heading (or similar) that just says <code>Iterator</code>, <code>Read</code>, <code>Write</code>, etc? Or: have a chip at the top of the page that says <code>Iterator</code> / <code>Read</code> / <code>Write</code> and links to the relevant implementation within the page. That would be nice because the UI could be similar to what shows up on other pages referencing the type.</p>



<a name="275166492"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/notable_traits%20improvements/near/275166492" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/notable_traits.20improvements.html#275166492">(Mar 13 2022 at 17:52)</a>:</h4>
<p>I have some issues with Notable Traits from the opposite direction. You discuss how it's under-inclusive for Result types, which is a good point. I also think it's over-inclusive in some scenarios.</p>
<p>For instance, every method that returns a Vec gets an ⓘ annotation because Vec is Write:</p>
<div class="codehilite"><pre><span></span><code>pub const fn new() -&gt; Vec&lt;T, Global&gt;ⓘ
pub fn with_capacity(capacity: usize) -&gt; Vec&lt;T, Global&gt;ⓘ
</code></pre></div>
<p>But that's not really the most notable thing about Vec. I consider it an issue because Vec is so common, it weakens the concept of ⓘ as "this is something you should pay attention to."</p>
<p>A similar issue shows up for functions that return <code>&amp;[u8]</code> (Read and Write), like several on String:</p>
<div class="codehilite"><pre><span></span><code>pub fn as_bytes(&amp;self) -&gt; &amp;[u8]ⓘ
</code></pre></div>
<p>Notable Traits also shows up for anything that returns Box, because there are passthrough implementations for Iterator, Read, Write, and Future on Box.</p>
<p><a href="/user_uploads/4715/ntiaz6T77Wuwk7tphIO9txdL/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/ntiaz6T77Wuwk7tphIO9txdL/image.png" title="image.png"><img src="/user_uploads/4715/ntiaz6T77Wuwk7tphIO9txdL/image.png"></a></div>



<a name="275166598"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/notable_traits%20improvements/near/275166598" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/notable_traits.20improvements.html#275166598">(Mar 13 2022 at 17:55)</a>:</h4>
<p>In other words, I think <code>Vec</code>, <code>&amp;[u8]</code>, and <code>Box</code> shouldn't get ⓘ annotations. But also, as you say, <code>Result&lt;Foo&gt;</code> should get a ⓘ  annotation if  Foo gets one. We should figure out a way to do those that is consistent and predictable.</p>



<a name="275168134"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/notable_traits%20improvements/near/275168134" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Conrad Ludgate <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/notable_traits.20improvements.html#275168134">(Mar 13 2022 at 18:29)</a>:</h4>
<p><span class="user-mention silent" data-user-id="315412">jsha</span> <a href="#narrow/stream/266220-rustdoc/topic/notable_traits.20improvements/near/275166492">said</a>:</p>
<blockquote>
<p>For instance, every method that returns a Vec gets an ⓘ annotation because Vec is Write:</p>
</blockquote>
<p>Yeah, I definitely agree with that, and my previous comment proposed a fix for that and I already have put up a PR. The gist is that specific impls can be notable rather than whole traits</p>



<a name="275168281"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/notable_traits%20improvements/near/275168281" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Conrad Ludgate <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/notable_traits.20improvements.html#275168281">(Mar 13 2022 at 18:33)</a>:</h4>
<p><span class="user-mention silent" data-user-id="315412">jsha</span> <a href="#narrow/stream/266220-rustdoc/topic/notable_traits.20improvements/near/275164789">said</a>:</p>
<blockquote>
<p>TL;DR I wanted to replace the <code>(i)</code> with a chip / lozenge that says what the notable trait is: <code>Iterator</code>, <code>Read</code>, <code>Write</code>, etc.</p>
<p>A similar concept could apply here: Rather than have a heading that says "Notable Traits" but doesn't say what they are, why not have a heading (or similar) that just says <code>Iterator</code>, <code>Read</code>, <code>Write</code>, etc? Or: have a chip at the top of the page that says <code>Iterator</code> / <code>Read</code> / <code>Write</code> and links to the relevant implementation within the page. That would be nice because the UI could be similar to what shows up on other pages referencing the type.</p>
</blockquote>
<p>I like it in concept. It's good to have more visibility of the notability I think. I agree with the other comments that it should be regular rust syntax IMO (like everything else in rustdoc).</p>
<p>How would this scale to multiple notable traits. Does having multiple notable traits even make sense (I think it does, eg TcpStream is notably <code>Read + Write</code>).</p>



<a name="275169496"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/notable_traits%20improvements/near/275169496" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Conrad Ludgate <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/notable_traits.20improvements.html#275169496">(Mar 13 2022 at 19:01)</a>:</h4>
<p><span class="user-mention silent" data-user-id="315412">jsha</span> <a href="#narrow/stream/266220-rustdoc/topic/notable_traits.20improvements/near/275166598">said</a>:</p>
<blockquote>
<p>In other words, I think <code>Vec</code>, <code>&amp;[u8]</code>, and <code>Box</code> shouldn't get ⓘ annotations. But also, as you say, <code>Result&lt;Foo&gt;</code> should get a ⓘ  annotation if  Foo gets one. We should figure out a way to do those that is consistent and predictable.</p>
</blockquote>
<p>My suggestion to fix these is as follows:</p>
<ol>
<li>Any blanket impls should not qualify for notability. This solves box being an iterator.</li>
<li>Read/Write are not notable themselves, but specific impls will be (eg TcpStream). This solves vec/[u8] being notable for read/write.</li>
<li>Result (as a Try&lt;Output = T&gt; type) will inherit the notability of T</li>
</ol>



<a name="275172280"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/notable_traits%20improvements/near/275172280" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Conrad Ludgate <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/notable_traits.20improvements.html#275172280">(Mar 13 2022 at 20:01)</a>:</h4>
<p>Thinking about that more, the 'blanket impl' suggestion I had does not work using rustdoc's current interpretation of blanket. Not sure how to formalise that</p>



<a name="275172421"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/notable_traits%20improvements/near/275172421" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Conrad Ludgate <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/notable_traits.20improvements.html#275172421">(Mar 13 2022 at 20:04)</a>:</h4>
<p>Also, I'd say that (while not relevant in this case) BufReader should qualify as notable Read even though it could be interpreted using my previous logic as a blanket impl</p>



<a name="275179265"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/notable_traits%20improvements/near/275179265" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/notable_traits.20improvements.html#275179265">(Mar 13 2022 at 22:48)</a>:</h4>
<p>I like these ideas!</p>
<blockquote>
<p>I agree with the other comments that it should be regular rust syntax IMO (like everything else in rustdoc).</p>
</blockquote>
<p>I assume you mean the comments from the internals thread I linked, like <a href="https://internals.rust-lang.org/t/revisiting-spotlight-notable-traits-in-rustdoc/14759/8">https://internals.rust-lang.org/t/revisiting-spotlight-notable-traits-in-rustdoc/14759/8</a> ?</p>
<p>I agree the best in theory would be for the various function on Iterator (for instance) to return <code>impl Iterator</code> rather than a concrete Iterator type. But later in the thread it's pointed out that <code>-&gt; impl Iterator</code> is not exactly the same as <code>-&gt; Rev&lt;Self&gt;</code>, and so having the docs replace one with the other would be misleading. I think that makes automatically rewriting a non-starter, and the stdlib at least can't make a code change to <code>-&gt; impl Iterator</code> for backwards compat reasons.</p>



<a name="275196281"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/notable_traits%20improvements/near/275196281" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Conrad Ludgate <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/notable_traits.20improvements.html#275196281">(Mar 14 2022 at 05:49)</a>:</h4>
<p>I dont mean necessarily replacing each use, but the supplementary lozenge will not be a special format, but just the traits <code>(impl Read + Write)</code></p>



<a name="275204754"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/notable_traits%20improvements/near/275204754" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Conrad Ludgate <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/notable_traits.20improvements.html#275204754">(Mar 14 2022 at 08:22)</a>:</h4>
<p>This <code>Box</code> situation is very hard. Looking at the impl, it's very hard to distinguish it from <code>Map</code>. I think the only difference is that it's a 'Smart Pointer'. So potentially, any Defef type should not qualify for general notability? They could still have impl specific ones which take priority</p>



<a name="275209396"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/notable_traits%20improvements/near/275209396" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/notable_traits.20improvements.html#275209396">(Mar 14 2022 at 09:13)</a>:</h4>
<p>Taking Deref into account makes sense to me. I think the intuition is 'how would I commonly treat the return type' and usually that means treating pointers transparently and using <code>?</code> on Result, etc.</p>



<a name="275209930"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/notable_traits%20improvements/near/275209930" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/notable_traits.20improvements.html#275209930">(Mar 14 2022 at 09:18)</a>:</h4>
<p>I think it is worth spending some time experimenting with UI. I really dislike the current 'i' UI because it is both too obtrusive (making the type signature noisy) and too subtle (unless you know what hides behind it, you don't know to click it. For beginners (or even experienced users who haven't used the feature in rustdoc), 'notable traits' is unclear and could apply to the function as well as the return type)). I'll also note that function signatures serve as titles, not just as information, so the UI should ideally not get in the way of that function.</p>



<a name="275210138"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/notable_traits%20improvements/near/275210138" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/notable_traits.20improvements.html#275210138">(Mar 14 2022 at 09:20)</a>:</h4>
<p>Maybe the information should be in the body of the docs for the function, rather than in the signature?</p>



<a name="275212836"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/notable_traits%20improvements/near/275212836" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Conrad Ludgate <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/notable_traits.20improvements.html#275212836">(Mar 14 2022 at 09:47)</a>:</h4>
<p><span class="user-mention silent" data-user-id="256841">Nick Cameron</span> <a href="#narrow/stream/266220-rustdoc/topic/notable_traits.20improvements/near/275209396">said</a>:</p>
<blockquote>
<p>Taking Deref into account makes sense to me. I think the intuition is 'how would I commonly treat the return type' and usually that means treating pointers transparently and using <code>?</code> on Result, etc.</p>
</blockquote>
<p>So, <code>Box</code> and <code>Result</code> should not qualify (as <code>Deref&lt;Target = T&gt;</code> or <code>Try&lt;Output = T&gt;</code> impls), but their respective <code>T</code> types can be used to determine whether a function output is notable?</p>
<p>Eg, <br>
I have a function that returns a <code>Box&lt;Sleep&gt;</code> it would make sense to display that as notably <code>impl Future</code>.<br>
I have a function that returns a <code>io::Result&lt;File&gt;</code>, it would make sense to display that as notable <code>impl Read + Write</code>.</p>
<p>But If I go directly to the page for <code>Box&lt;T&gt;</code>, I should not see on <code>Box::new(T)</code> that the output is notably a <code>Future</code></p>



<a name="275213348"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/notable_traits%20improvements/near/275213348" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/notable_traits.20improvements.html#275213348">(Mar 14 2022 at 09:52)</a>:</h4>
<p>That all sounds right to me. For Box&lt;T&gt;::new, there is no Future bound on T, so I wouldn't expect to see anything about Future</p>



<a name="275218950"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/notable_traits%20improvements/near/275218950" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Waffle Lapkin <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/notable_traits.20improvements.html#275218950">(Mar 14 2022 at 10:47)</a>:</h4>
<p><span class="user-mention silent" data-user-id="396593">Conrad Ludgate</span> <a href="#narrow/stream/266220-rustdoc/topic/notable_traits.20improvements/near/275169496">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="315412">jsha</span> <a href="#narrow/stream/266220-rustdoc/topic/notable_traits.20improvements/near/275166598">said</a>:</p>
<blockquote>
<p>In other words, I think <code>Vec</code>, <code>&amp;[u8]</code>, and <code>Box</code> shouldn't get ⓘ annotations. But also, as you say, <code>Result&lt;Foo&gt;</code> should get a ⓘ  annotation if  Foo gets one. We should figure out a way to do those that is consistent and predictable.</p>
</blockquote>
<p>My suggestion to fix these is as follows:</p>
<ol>
<li>Any blanket impls should not qualify for notability. This solves box being an iterator.</li>
<li>Read/Write are not notable themselves, but specific impls will be (eg TcpStream). This solves vec/[u8] being notable for read/write.</li>
<li>Result (as a Try&lt;Output = T&gt; type) will inherit the notability of T</li>
</ol>
</blockquote>
<p>There is another solution (that I propose (in addition to these?)): impls can be marked as opt-out, this solves the <code>Vec</code>/<code>Box</code>/etc problem, without necessarily making <code>Read</code>/<code>Write</code> non-notable or making blanket impl non-notable (the latter will work badly with <code>Iterator</code> adaptors for example)</p>



<a name="275219301"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/notable_traits%20improvements/near/275219301" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Conrad Ludgate <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/notable_traits.20improvements.html#275219301">(Mar 14 2022 at 10:50)</a>:</h4>
<p>I've been trying to avoid entertaining the idea of negative notability attributes, but I guess it will eventually be necessary anyway</p>



<a name="275219492"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/notable_traits%20improvements/near/275219492" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Waffle Lapkin <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/notable_traits.20improvements.html#275219492">(Mar 14 2022 at 10:52)</a>:</h4>
<p><span class="user-mention silent" data-user-id="396593">Conrad Ludgate</span> <a href="#narrow/stream/266220-rustdoc/topic/notable_traits.20improvements/near/275196281">said</a>:</p>
<blockquote>
<p>I dont mean necessarily replacing each use, but the supplementary lozenge will not be a special format, but just the traits <code>(impl Read + Write)</code></p>
</blockquote>
<p><code>(impl Trait)</code> is somewhat similar to what IDEs (r-a, idea) sometimes do to typehints for <code>Iterator</code>s and <code>Future</code>s. I generally think it would be nice (and better than the current <code>(i)</code>), but at the same time for a function signature that may be too much noise...</p>



<a name="275221900"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/notable_traits%20improvements/near/275221900" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Conrad Ludgate <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/notable_traits.20improvements.html#275221900">(Mar 14 2022 at 11:15)</a>:</h4>
<p>I agree, there needs to be good effort in order to not make it overly cluttered, but also providing enough information at a glance</p>



<a name="275221990"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/notable_traits%20improvements/near/275221990" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Conrad Ludgate <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/notable_traits.20improvements.html#275221990">(Mar 14 2022 at 11:16)</a>:</h4>
<p>As nrc said, below the fn line could be good, we just need a solid design idea that is clear</p>



<a name="275291578"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/notable_traits%20improvements/near/275291578" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/notable_traits.20improvements.html#275291578">(Mar 14 2022 at 20:08)</a>:</h4>
<p>i would expect notable traits to be an auto-generated header and then bulleted list in the main body of the type docs, at the end after the programmer's notes</p>



<a name="275291706"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/notable_traits%20improvements/near/275291706" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/notable_traits.20improvements.html#275291706">(Mar 14 2022 at 20:09)</a>:</h4>
<div class="codehilite"><pre><span></span><code>## notable traits
the following traits are notable for this type
* impl From&lt;u64&gt;
* impl Iterator&lt;Item=u8&gt;
* ...
</code></pre></div>



<a name="275294551"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/notable_traits%20improvements/near/275294551" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Conrad Ludgate <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/notable_traits.20improvements.html#275294551">(Mar 14 2022 at 20:36)</a>:</h4>
<p>That's kinda my intention currently, although re-using the existing trait implementations rendering for consistency.</p>
<p>Notable Traits show above any other traits in their own section (admittedly below any non trait implementations). My reasoning for that is that most notable types don't have many methods of their own so it doesn't matter either way</p>



<a name="275294599"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/notable_traits%20improvements/near/275294599" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Conrad Ludgate <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/notable_traits.20improvements.html#275294599">(Mar 14 2022 at 20:37)</a>:</h4>
<p>If the traits are not expanded by default, you'll have all the information necessary up front like that</p>



<a name="275294671"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/notable_traits%20improvements/near/275294671" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Conrad Ludgate <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/notable_traits.20improvements.html#275294671">(Mar 14 2022 at 20:37)</a>:</h4>
<p>Actually, the un-expanded Iterator impl does not show its associated types :/</p>



<a name="275298154"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/notable_traits%20improvements/near/275298154" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Conrad Ludgate <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/notable_traits.20improvements.html#275298154">(Mar 14 2022 at 21:05)</a>:</h4>
<p><span class="user-mention silent" data-user-id="396593">Conrad Ludgate</span> <a href="#narrow/stream/266220-rustdoc/topic/notable_traits.20improvements/near/275212836">said</a>:</p>
<blockquote>
<p>So, <code>Box</code> and <code>Result</code> should not qualify (as <code>Deref&lt;Target = T&gt;</code> or <code>Try&lt;Output = T&gt;</code> impls), but their respective <code>T</code> types can be used to determine whether a function output is notable?</p>
<p>Eg, <br>
I have a function that returns a <code>Box&lt;Sleep&gt;</code> it would make sense to display that as notably <code>impl Future</code>.<br>
I have a function that returns a <code>io::Result&lt;File&gt;</code>, it would make sense to display that as notable <code>impl Read + Write</code>.</p>
<p>But If I go directly to the page for <code>Box&lt;T&gt;</code>, I should not see on <code>Box::new(T)</code> that the output is notably a <code>Future</code></p>
</blockquote>
<p>So exploring this idea, what's a good way to determine if a type implements a specific trait? I assume the <code>DefID</code>s of traits are not consistent and should not be relied upon, so I'll need to determine beforehand what DefID <code>Deref</code>/<code>Try</code> have. Also, would there be any difference between <code>::core::ops::Deref</code> and <code>::std::ops::Deref</code>?</p>



<a name="275298241"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/notable_traits%20improvements/near/275298241" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Conrad Ludgate <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/notable_traits.20improvements.html#275298241">(Mar 14 2022 at 21:06)</a>:</h4>
<p>Ahh, I can use something like this i presume: <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_hir/lang_items/struct.LanguageItems.html#method.deref_trait">https://doc.rust-lang.org/nightly/nightly-rustc/rustc_hir/lang_items/struct.LanguageItems.html#method.deref_trait</a></p>



<a name="275318506"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/notable_traits%20improvements/near/275318506" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/notable_traits.20improvements.html#275318506">(Mar 15 2022 at 01:13)</a>:</h4>
<p><span class="user-mention silent" data-user-id="396593">Conrad Ludgate</span> <a href="#narrow/stream/266220-rustdoc/topic/notable_traits.20improvements/near/275294551">said</a>:</p>
<blockquote>
<p>That's kinda my intention currently, although re-using the existing trait implementations rendering for consistency.</p>
<p>Notable Traits show above any other traits in their own section (admittedly below any non trait implementations). My reasoning for that is that most notable types don't have many methods of their own so it doesn't matter either way</p>
</blockquote>
<p>I think that a more "skimable" cluster of info, not the entire normal presentation, might help.</p>



<a name="275493523"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/notable_traits%20improvements/near/275493523" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Waffle Lapkin <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/notable_traits.20improvements.html#275493523">(Mar 16 2022 at 10:50)</a>:</h4>
<p><span class="user-mention" data-user-id="396593">@Conrad Ludgate</span> I recently implemented a suggestion in the compiler that needed to check if the type implements a trait, I think you may reuse something from there: <a href="https://github.com/compiler-errors/rust/blob/7624565d0a464ffc0a6f9368d7f789df6d53ab52/compiler/rustc_borrowck/src/diagnostics/conflict_errors.rs#L441-L460">conflict_errors.rs#L441-L460</a></p>



<a name="275555938"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/notable_traits%20improvements/near/275555938" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manish Goregaokar <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/notable_traits.20improvements.html#275555938">(Mar 16 2022 at 18:18)</a>:</h4>
<p><span class="user-mention" data-user-id="315412">@jsha</span> i really like the idea of a chip, and on hover you can get the actual impls.</p>
<p>I think for _iterator_ we should have the chip on each instance of the iterator, but perhaps for Write we should have it be opt-in on methods?</p>



<a name="275555971"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/notable_traits%20improvements/near/275555971" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manish Goregaokar <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/notable_traits.20improvements.html#275555971">(Mar 16 2022 at 18:19)</a>:</h4>
<p>I do think the usage for Write gets very annoying?</p>



<a name="275567241"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/notable_traits%20improvements/near/275567241" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Conrad Ludgate <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/notable_traits.20improvements.html#275567241">(Mar 16 2022 at 19:44)</a>:</h4>
<p>FYI I've already implemented this Write functionality: <a href="https://github.com/rust-lang/rust/pull/94904">https://github.com/rust-lang/rust/pull/94904</a></p>



<a name="275567298"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/notable_traits%20improvements/near/275567298" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Conrad Ludgate <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/notable_traits.20improvements.html#275567298">(Mar 16 2022 at 19:44)</a>:</h4>
<p>Not on methods but on impls</p>



<a name="275567836"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/notable_traits%20improvements/near/275567836" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Conrad Ludgate <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/notable_traits.20improvements.html#275567836">(Mar 16 2022 at 19:48)</a>:</h4>
<p>I'm not sure if I agree that methods choose the notability of their return types</p>



<a name="275567871"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/notable_traits%20improvements/near/275567871" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Conrad Ludgate <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/notable_traits.20improvements.html#275567871">(Mar 16 2022 at 19:48)</a>:</h4>
<p>Seems like something that will be forgotten a lot</p>



<a name="275567952"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/notable_traits%20improvements/near/275567952" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/notable_traits.20improvements.html#275567952">(Mar 16 2022 at 19:49)</a>:</h4>
<p><span class="user-mention silent" data-user-id="132040">Manish Goregaokar</span> <a href="#narrow/stream/266220-rustdoc/topic/notable_traits.20improvements/near/275555938">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="315412">jsha</span> i really like the idea of a chip, and on hover you can get the actual impls.</p>
</blockquote>
<p>Little thing: needs to be on click for mobile devices. ;) (but yes, doesn't change anything otherwise)</p>



<a name="275587270"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/notable_traits%20improvements/near/275587270" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/notable_traits.20improvements.html#275587270">(Mar 16 2022 at 22:51)</a>:</h4>
<blockquote>
<p>I'm not sure if I agree that methods choose the notability of their return types</p>
</blockquote>
<p>I think methods should not choose the notability of their return types. Conceptually, notability is a property of a type, not a method.</p>
<p>Also, it's probably useful to expand on what "notable traits" means to all of us. For me, notable traits solves this problem: When learning Iterators, I would see a method signature like:</p>
<div class="codehilite"><pre><span></span><code>fn take(self, n: usize) -&gt; Take&lt;Self&gt;ⓘ
</code></pre></div>
<p>and think "oh no, what's this <code>Take</code>? A whole new type I have to learn about. Must be complex if it has its own struct." But in practice, <code>Take</code> is just an Iterator that happens to have its own name (and today that API might be written <code>fn take(self, n: usize) -&gt; impl Iterator&lt;Item = Self::Item&gt;</code>). The ⓘ helps you notice that and save a click, knowing that <code>struct Take</code> isn't that interesting since the description you need is on <code>fn take</code>.</p>
<p>Generalizing that, there are certain traits where, if a struct implements them, that implementation is probably the most notable thing about the struct. And conversely there are structs that have very little inherently interesting about them (e.g. no public fields, no inherent impls), such that implementation of one of those notable traits is the most interesting thing about the struct.</p>



<a name="275612155"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/notable_traits%20improvements/near/275612155" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Conrad Ludgate <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/notable_traits.20improvements.html#275612155">(Mar 17 2022 at 06:35)</a>:</h4>
<p>Same here, at least I'll go a little further. If the type has significant methods of its own (besides just new and other trivial ones), its likely not going to be notable as a trait.</p>
<p>For instance, BufReader has a bunch of getter/setter methods, which are not very interesting to learn about, but all of its non-trivial functionality comes from its Read/BufRead impls</p>
<p>Vec is a Write, but it has significant use on its own. It has achieved self-notability and therefore is not notable for being any traits</p>



<a name="275612789"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/notable_traits%20improvements/near/275612789" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/notable_traits.20improvements.html#275612789">(Mar 17 2022 at 06:48)</a>:</h4>
<p>This doesn't help now, but would anything change here if <em>inherent traits</em> were a thing (even if just in nightly)?  Is it possible that the notable ones could just be the inherent ones on the type?</p>



<a name="275614812"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/notable_traits%20improvements/near/275614812" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Conrad Ludgate <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/notable_traits.20improvements.html#275614812">(Mar 17 2022 at 07:23)</a>:</h4>
<p>I'm not familiar with this concept</p>



<a name="275620481"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/notable_traits%20improvements/near/275620481" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/notable_traits.20improvements.html#275620481">(Mar 17 2022 at 08:37)</a>:</h4>
<p>"I think methods should not choose the notability of their return types. Conceptually, notability is a property of a type, not a method." - I don't think this is quite right, the context in which the type is used is important. Notable traits isn't just traits for a type but is about how we expect the return type to be used. E.g., when calling an iter method we expect the result to be treated only as an iterator. However when you call ConcreteIterator::new, then the user might well be interested in the concrete type. IMO, notable traits is a workaround for not having <code>impl Trait</code> return types at 1.0.</p>



<a name="275620650"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/notable_traits%20improvements/near/275620650" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/notable_traits.20improvements.html#275620650">(Mar 17 2022 at 08:39)</a>:</h4>
<p>Even for the generic iterator case, it's possible to implement Iterator for a type which does more than just iterate, it's just common to have single purpose iterator types. I believe this is why notable traits for Write (etc) feel worse than for Iterator - because types which impl Write are often multi-purpose types and not single-purpose dictated by a trait</p>



<a name="275686750"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/notable_traits%20improvements/near/275686750" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/notable_traits.20improvements.html#275686750">(Mar 17 2022 at 16:36)</a>:</h4>
<blockquote>
<p>IMO, notable traits is a workaround for not having impl Trait return types at 1.0.</p>
</blockquote>
<p>I agree.</p>
<blockquote>
<p>I believe this is why notable traits for Write (etc) feel worse than for Iterator - because types which impl Write are often multi-purpose types and not single-purpose dictated by a trait</p>
</blockquote>
<p>That makes sense!</p>



<a name="275709200"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/notable_traits%20improvements/near/275709200" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/notable_traits.20improvements.html#275709200">(Mar 17 2022 at 18:54)</a>:</h4>
<p>Even if impl Trait was in 1.0, plenty of iterators would need to be their own type because they have special additional methods. So we'd want a system like this even so</p>



<a name="275717199"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/notable_traits%20improvements/near/275717199" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/notable_traits.20improvements.html#275717199">(Mar 17 2022 at 19:58)</a>:</h4>
<p>And it's unclear how all the conditional-traits stuff we do today could be expressed in <code>impl Trait</code> return types -- like <code>Map</code> being exact-sized only if the iterator it wraps is also exact-sized.</p>



<a name="275744027"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/notable_traits%20improvements/near/275744027" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/notable_traits.20improvements.html#275744027">(Mar 17 2022 at 23:53)</a>:</h4>
<p>ah, good points!</p>



<a name="275752501"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/notable_traits%20improvements/near/275752501" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/notable_traits.20improvements.html#275752501">(Mar 18 2022 at 02:12)</a>:</h4>
<p>And also without TAIT you can't name those iterator adapters so libraries generally try to avoid <code>impl Trait</code>. (Of course you often can't name them anyway if for example you want a type like <code>Map&lt;X, |T| -&gt; U&gt;</code> containing a closure type)</p>



<a name="275770907"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/notable_traits%20improvements/near/275770907" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/notable_traits.20improvements.html#275770907">(Mar 18 2022 at 08:16)</a>:</h4>
<p>True, true! I guess a better phrasing is that notable traits feels like a docs feature which is the moral equivalent of the impl Trait language feature, but that there are constraints on the language cf docs which make them different features</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>