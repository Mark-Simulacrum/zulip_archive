<html>
<head><meta charset="utf-8"><title>side effects in search.js · rustdoc · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/index.html">rustdoc</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/side.20effects.20in.20search.2Ejs.html">side effects in search.js</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="265342277"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/side%20effects%20in%20search.js/near/265342277" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/side.20effects.20in.20search.2Ejs.html#265342277">(Dec 17 2021 at 18:50)</a>:</h4>
<p><span class="user-mention" data-user-id="210316">@GuillaumeGomez</span> when I was poking around in the search JS last night, I noticed we rely a lot of side effects and "global" variables (not really global, but in the scope of search.js' big initSearch function). As one example: <code>buildIndex</code> generates two variables <code>searchIndex</code> and <code>searchWords</code>. It assigns <code>searchIndex</code> directly to the "global" variable <code>searchIndex</code> and it returns <code>searchWords</code>. But then the caller immediately assigned <code>searchWords</code> to the "global" variable <code>index</code>.</p>
<p>I think we would be better off treating <code>buildIndex</code> as a pure function - it takes a raw index, and returns (<code>searchIndex</code>, <code>searchWords</code>). Then the caller can take care of storing those where it wants to.</p>
<p>Even better we can define a class that contains (<code>searchIndex</code>, <code>searchWords</code>), and that class can expose functions like <code>execQuery</code> that use those fields.</p>



<a name="265362351"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/side%20effects%20in%20search.js/near/265362351" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/side.20effects.20in.20search.2Ejs.html#265362351">(Dec 17 2021 at 21:22)</a>:</h4>
<p>I've been intending to split the big function for quite a while now. Just never found the time to. I wanted to use the rewrite of the search to do it and for now I need to finish it by splitting it up in smaller PRs (which is being done currently). But yes, I strongly agree, I don't like "local global" variables.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>