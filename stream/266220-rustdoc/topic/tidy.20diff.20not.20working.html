<html>
<head><meta charset="utf-8"><title>tidy diff not working · rustdoc · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/index.html">rustdoc</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/tidy.20diff.20not.20working.html">tidy diff not working</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="263787913"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/tidy%20diff%20not%20working/near/263787913" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/tidy.20diff.20not.20working.html#263787913">(Dec 05 2021 at 20:42)</a>:</h4>
<p>I finally installed a recent version of HTML tidy, but I'm still not getting HTML diffs. Any idea what's wrong? I'm using download-rustc.</p>



<a name="263788122"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/tidy%20diff%20not%20working/near/263788122" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/tidy.20diff.20not.20working.html#263788122">(Dec 05 2021 at 20:48)</a>:</h4>
<p>What do you get when running rustdoc tests?</p>



<a name="263788190"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/tidy%20diff%20not%20working/near/263788190" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/tidy.20diff.20not.20working.html#263788190">(Dec 05 2021 at 20:49)</a>:</h4>
<p>I've been getting these weird errors. It looks like they're coming from the nightly run? Perhaps that's why the diff isn't working.</p>
<div class="codehilite"><pre><span></span><code>error[E0514]: found crate `std` compiled by an incompatible version of rustc
  |
  = help: please recompile that crate using this compiler (rustc 1.59.0-nightly (efec54529 2021-12-04)) (consider running `cargo clean` first)
  = note: the following crate versions were found:
          crate `std` compiled by rustc 1.59.0-nightly (532d2b14c 2021-12-03): /Users/noahlev/.rustup/toolchains/nightly-aarch64-apple-darwin/lib/rustlib/aarch64-apple-darwin/lib/libstd-229cb653067ce774.rlib
          crate `std` compiled by rustc 1.59.0-nightly (532d2b14c 2021-12-03): /Users/noahlev/.rustup/toolchains/nightly-aarch64-apple-darwin/lib/rustlib/aarch64-apple-darwin/lib/libstd-229cb653067ce774.dylib
          crate `std` compiled by rustc 1.59.0-nightly (532d2b14c 2021-12-03): /Users/noahlev/.rustup/toolchains/nightly-aarch64-apple-darwin/lib/rustlib/aarch64-apple-darwin/lib/libstd_detect-6ad8a5c19de72402.rlib

error: requires `sized` lang_item

error: aborting due to 2 previous errors
</code></pre></div>



<a name="263788298"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/tidy%20diff%20not%20working/near/263788298" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/tidy.20diff.20not.20working.html#263788298">(Dec 05 2021 at 20:51)</a>:</h4>
<p>Here's an example of the full output I get for a failing test (I believe this test is failing correctly btw):</p>
<div class="codehilite"><pre><span></span><code>---- [rustdoc] rustdoc/issue-85454.rs stdout ----

error: htmldocck failed!
status: exit status: 1
command: &quot;/Library/Developer/CommandLineTools/usr/bin/python3&quot; &quot;/Users/noahlev/code/rust/r1/src/etc/htmldocck.py&quot; &quot;/Users/noahlev/code/rust/r1/build/aarch64-apple-darwin/test/rustdoc/issue-85454&quot; &quot;/Users/noahlev/code/rust/r1/src/test/rustdoc/issue-85454.rs&quot;
stdout:
------------------------------------------

------------------------------------------
stderr:
------------------------------------------
27: @has check failed
    `XPATH PATTERN` did not match
        // @has - &#39;//pre[@class=&quot;rust trait&quot;]&#39; &#39;pub trait FromResidual&lt;R = &lt;Self as Try&gt;::Residual&gt; { fn from_residual(residual: R) -&gt; Self; }&#39;

Encountered 1 errors

------------------------------------------

info: generating a diff against nightly rustdoc

error: auxiliary build of &quot;/Users/noahlev/code/rust/r1/src/test/rustdoc/auxiliary/issue-85454.rs&quot; failed to compile:
status: exit status: 1
command: &quot;rustc&quot; &quot;/Users/noahlev/code/rust/r1/src/test/rustdoc/auxiliary/issue-85454.rs&quot; &quot;-Zthreads=1&quot; &quot;--target=aarch64-apple-darwin&quot; &quot;-C&quot; &quot;prefer-dynamic&quot; &quot;--out-dir&quot; &quot;/Users/noahlev/code/rust/r1/build/aarch64-apple-darwin/test/rustdoc/issue-85454/auxiliary&quot; &quot;-Crpath&quot; &quot;-O&quot; &quot;-Cdebuginfo=0&quot; &quot;-Lnative=/Users/noahlev/code/rust/r1/build/aarch64-apple-darwin/native/rust-test-helpers&quot; &quot;--crate-type&quot; &quot;dylib&quot; &quot;-L&quot; &quot;/Users/noahlev/code/rust/r1/build/aarch64-apple-darwin/test/rustdoc/issue-85454/auxiliary&quot;
stdout:
------------------------------------------

------------------------------------------
stderr:
------------------------------------------
error[E0514]: found crate `std` compiled by an incompatible version of rustc
  |
  = help: please recompile that crate using this compiler (rustc 1.59.0-nightly (efec54529 2021-12-04)) (consider running `cargo clean` first)
  = note: the following crate versions were found:
          crate `std` compiled by rustc 1.59.0-nightly (532d2b14c 2021-12-03): /Users/noahlev/.rustup/toolchains/nightly-aarch64-apple-darwin/lib/rustlib/aarch64-apple-darwin/lib/libstd-229cb653067ce774.rlib
          crate `std` compiled by rustc 1.59.0-nightly (532d2b14c 2021-12-03): /Users/noahlev/.rustup/toolchains/nightly-aarch64-apple-darwin/lib/rustlib/aarch64-apple-darwin/lib/libstd-229cb653067ce774.dylib
          crate `std` compiled by rustc 1.59.0-nightly (532d2b14c 2021-12-03): /Users/noahlev/.rustup/toolchains/nightly-aarch64-apple-darwin/lib/rustlib/aarch64-apple-darwin/lib/libstd_detect-6ad8a5c19de72402.rlib

error: requires `sized` lang_item

error: aborting due to 2 previous errors


------------------------------------------
</code></pre></div>



<a name="263788550"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/tidy%20diff%20not%20working/near/263788550" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/tidy.20diff.20not.20working.html#263788550">(Dec 05 2021 at 20:57)</a>:</h4>
<p><span class="user-mention" data-user-id="210316">@GuillaumeGomez</span> Does the diffing work on your machine?</p>



<a name="263788618"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/tidy%20diff%20not%20working/near/263788618" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/tidy.20diff.20not.20working.html#263788618">(Dec 05 2021 at 20:58)</a>:</h4>
<p>Yes. If it doesn't find the <code>tidy</code> binary, you're supposed to see a warning when running the command (I was looking for that). If you don't have a warning, it means it failed before the HTML comparison (which seems to be your case)</p>



<a name="263788647"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/tidy%20diff%20not%20working/near/263788647" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/tidy.20diff.20not.20working.html#263788647">(Dec 05 2021 at 20:59)</a>:</h4>
<p>Does it work for you with download-rustc enabled?</p>



<a name="263788651"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/tidy%20diff%20not%20working/near/263788651" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/tidy.20diff.20not.20working.html#263788651">(Dec 05 2021 at 20:59)</a>:</h4>
<blockquote>
<p>If you don't have a warning, it means it failed before the HTML comparison (which seems to be your case)</p>
</blockquote>
<p>Yeah, it's weird</p>



<a name="263789170"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/tidy%20diff%20not%20working/near/263789170" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/tidy.20diff.20not.20working.html#263789170">(Dec 05 2021 at 21:08)</a>:</h4>
<p>Aha, I removed my build directory and disabled download-rustc, and it's now working!</p>



<a name="263789186"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/tidy%20diff%20not%20working/near/263789186" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/tidy.20diff.20not.20working.html#263789186">(Dec 05 2021 at 21:08)</a>:</h4>
<p>I think it's due to download-rustc because I'm pretty sure I had tried removing my build directory before</p>



<a name="263789363"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/tidy%20diff%20not%20working/near/263789363" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/tidy.20diff.20not.20working.html#263789363">(Dec 05 2021 at 21:12)</a>:</h4>
<p>Although neither paging nor colors seem to be working...</p>



<a name="263791057"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/tidy%20diff%20not%20working/near/263791057" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/tidy.20diff.20not.20working.html#263791057">(Dec 05 2021 at 21:51)</a>:</h4>
<p><span class="user-mention silent" data-user-id="307537">Noah Lev</span> <a href="#narrow/stream/266220-rustdoc/topic/tidy.20diff.20not.20working/near/263788647">said</a>:</p>
<blockquote>
<p>Does it work for you with download-rustc enabled?</p>
</blockquote>
<p>Yes (I always use it)</p>



<a name="263791107"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/tidy%20diff%20not%20working/near/263791107" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/tidy.20diff.20not.20working.html#263791107">(Dec 05 2021 at 21:52)</a>:</h4>
<p>Famous sentence: "In case of doubts, remove the build directory and rebuild"</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>