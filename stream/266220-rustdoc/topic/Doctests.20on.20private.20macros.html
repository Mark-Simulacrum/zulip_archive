<html>
<head><meta charset="utf-8"><title>Doctests on private macros · rustdoc · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/index.html">rustdoc</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Doctests.20on.20private.20macros.html">Doctests on private macros</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="249445313"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Doctests%20on%20private%20macros/near/249445313" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> inquisitivecrystal <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Doctests.20on.20private.20macros.html#249445313">(Aug 14 2021 at 06:53)</a>:</h4>
<p>I have an interesting problem for y'all. I'm hitting an error in <a href="https://github.com/rust-lang/rust/issues/88019">#88019</a> because the changes I'm making there lead to doctests running on non-exported macros. Previously, doctests were only run on exported macros. I'm not entirely sure what to do about it. Keeping the old behavior is trivial, but it may not be desirable. After all, it's probably bad for the tests to silently be ignored, particularly when that doesn't match with the behavior for other private items. At the same time, starting to run them is backwards incompatible, as the error I'm getting demonstrates.</p>



<a name="249445486"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Doctests%20on%20private%20macros/near/249445486" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> inquisitivecrystal <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Doctests.20on.20private.20macros.html#249445486">(Aug 14 2021 at 06:58)</a>:</h4>
<p>The simplest thing to do is probably to leave a FIXME. Then, in future. someone can make it so that the test generates a warning but doesn't actually fail.</p>



<a name="249462295"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/266220-rustdoc/topic/Doctests%20on%20private%20macros/near/249462295" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/266220-rustdoc/topic/Doctests.20on.20private.20macros.html#249462295">(Aug 14 2021 at 14:25)</a>:</h4>
<p>I think a FIXME is a good idea, that makes it less likely we have to revert. That said I definitely think we should run these tests, for two reasons:</p>
<ul>
<li>it's only a test failure, not a compile failure, and the code is actually wrong - the breakage isn't needless, the user was presumably expecting these tests to run or they wouldn't have written them</li>
<li>not many people are going to be writing doctests on private macros and also using --document-private-items when testing</li>
</ul>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>