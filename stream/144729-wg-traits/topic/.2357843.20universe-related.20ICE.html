<html>
<head><meta charset="utf-8"><title>#57843 universe-related ICE · wg-traits · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/index.html">wg-traits</a></h2>
<h3>Topic: <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html">#57843 universe-related ICE</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://rust-lang.github.io/zulip_archive/style.css" rel="stylesheet"></head>

<a name="157108040"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157108040" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157108040">(Jan 29 2019 at 14:23)</a>:</h4>
<p>So, <span class="user-mention" data-user-id="116083">@pnkfelix</span> ...</p>



<a name="157108059"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157108059" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157108059">(Jan 29 2019 at 14:23)</a>:</h4>
<p>probably I should indeed make my own local build, but can you convey what the type is which is failing the assertion?</p>



<a name="157108112"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157108112" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157108112">(Jan 29 2019 at 14:24)</a>:</h4>
<p>I'll attempt to do so</p>



<a name="157108129"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157108129" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157108129">(Jan 29 2019 at 14:24)</a>:</h4>
<p><code>std::boxed::Box&lt;[closure@../../issue-57843-ice-with-cloneablefn.rs:12:18: 12:24]&gt;</code></p>



<a name="157108142"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157108142" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157108142">(Jan 29 2019 at 14:24)</a>:</h4>
<p>i.e. the closure in the <code>fn main</code></p>



<a name="157108172"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157108172" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157108172">(Jan 29 2019 at 14:25)</a>:</h4>
<p>which is somewhat unsurprising given that the ICE goes away when one adds a type-annotation to the closure formal parameter</p>



<a name="157108175"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157108175" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157108175">(Jan 29 2019 at 14:25)</a>:</h4>
<p>maybe with <code>-Zverbose</code>?</p>



<a name="157108182"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157108182" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157108182">(Jan 29 2019 at 14:25)</a>:</h4>
<p>that was with <code>-Z verbose</code></p>



<a name="157108186"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157108186" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157108186">(Jan 29 2019 at 14:25)</a>:</h4>
<p>hmm</p>



<a name="157108191"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157108191" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157108191">(Jan 29 2019 at 14:25)</a>:</h4>
<p>is the problem that it has a placeholder in it?</p>



<a name="157108193"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157108193" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157108193">(Jan 29 2019 at 14:25)</a>:</h4>
<p>the type in question has <code>needs_infer: false, has_ty_placholders: false, has_re_placholders: true</code></p>



<a name="157108196"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157108196" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157108196">(Jan 29 2019 at 14:26)</a>:</h4>
<p>yes</p>



<a name="157108243"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157108243" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157108243">(Jan 29 2019 at 14:26)</a>:</h4>
<p>i.e. the region placeholder</p>



<a name="157108258"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157108258" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157108258">(Jan 29 2019 at 14:26)</a>:</h4>
<p>oh let me just gist my log</p>



<a name="157108274"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157108274" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157108274">(Jan 29 2019 at 14:26)</a>:</h4>
<p>yes ok</p>



<a name="157108275"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157108275" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157108275">(Jan 29 2019 at 14:26)</a>:</h4>
<p><a href="https://gist.github.com/070ea7fe4b4a95c8129c06694cbeb457" target="_blank" title="https://gist.github.com/070ea7fe4b4a95c8129c06694cbeb457">https://gist.github.com/070ea7fe4b4a95c8129c06694cbeb457</a></p>



<a name="157108282"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157108282" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157108282">(Jan 29 2019 at 14:26)</a>:</h4>
<p>I can <em>sort of</em> see what's happening</p>



<a name="157108310"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157108310" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157108310">(Jan 29 2019 at 14:27)</a>:</h4>
<p>(this is after I added a couple of <code>debug!</code> statements)</p>



<a name="157108387"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157108387" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157108387">(Jan 29 2019 at 14:28)</a>:</h4>
<p>and with <code>RUST_LOG=rustc::traits,rustc::infer,rustc::ty::sty,rustc::infer::higher_ranked,rustc_typeck::check</code></p>



<a name="157108436"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157108436" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157108436">(Jan 29 2019 at 14:29)</a>:</h4>
<p>(ok, doing a local build)</p>



<a name="157108457"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157108457" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157108457">(Jan 29 2019 at 14:29)</a>:</h4>
<p>but also skimming some of the closure code</p>



<a name="157108542"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157108542" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157108542">(Jan 29 2019 at 14:30)</a>:</h4>
<p>so as part of the instrumentation I added <code>debug!</code> for the (few) places where <code>RePlaceholder</code> are created</p>



<a name="157108553"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157108553" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157108553">(Jan 29 2019 at 14:30)</a>:</h4>
<p>just to leave a few random notes</p>



<a name="157108558"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157108558" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157108558">(Jan 29 2019 at 14:30)</a>:</h4>
<p>there are only two lines that correspond to <code>RePlaceholder(Placeholder { universe: U6, name: BrNamed(crate0:DefIndex(1:14), 'a) })</code></p>



<a name="157108628"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157108628" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157108628">(Jan 29 2019 at 14:31)</a>:</h4>
<ul>
<li>we're going to <a href="https://github.com/rust-lang/rust/blob/106b3e9fa4d53efc4e8eab47d1043789c88f99a5/src/librustc_typeck/check/closure.rs#L54" target="_blank" title="https://github.com/rust-lang/rust/blob/106b3e9fa4d53efc4e8eab47d1043789c88f99a5/src/librustc_typeck/check/closure.rs#L54">deduce an expected signature</a></li>
<li>we'll invoke <a href="https://github.com/rust-lang/rust/blob/106b3e9fa4d53efc4e8eab47d1043789c88f99a5/src/librustc_typeck/check/closure.rs#L80" target="_blank" title="https://github.com/rust-lang/rust/blob/106b3e9fa4d53efc4e8eab47d1043789c88f99a5/src/librustc_typeck/check/closure.rs#L80"><code>sig_of_closure</code></a></li>
<li>leading to <a href="https://github.com/rust-lang/rust/blob/106b3e9fa4d53efc4e8eab47d1043789c88f99a5/src/librustc_typeck/check/closure.rs#L374-L380" target="_blank" title="https://github.com/rust-lang/rust/blob/106b3e9fa4d53efc4e8eab47d1043789c88f99a5/src/librustc_typeck/check/closure.rs#L374-L380"><code>sig_of_closure_with_expectation</code></a></li>
</ul>



<a name="157108679"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157108679" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157108679">(Jan 29 2019 at 14:32)</a>:</h4>
<p><a href="https://gist.github.com/pnkfelix/070ea7fe4b4a95c8129c06694cbeb457#file-rlog-L3715" target="_blank" title="https://gist.github.com/pnkfelix/070ea7fe4b4a95c8129c06694cbeb457#file-rlog-L3715">https://gist.github.com/pnkfelix/070ea7fe4b4a95c8129c06694cbeb457#file-rlog-L3715</a></p>



<a name="157108688"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157108688" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157108688">(Jan 29 2019 at 14:32)</a>:</h4>
<p><a href="https://gist.github.com/pnkfelix/070ea7fe4b4a95c8129c06694cbeb457#file-rlog-L3779" target="_blank" title="https://gist.github.com/pnkfelix/070ea7fe4b4a95c8129c06694cbeb457#file-rlog-L3779">https://gist.github.com/pnkfelix/070ea7fe4b4a95c8129c06694cbeb457#file-rlog-L3779</a></p>



<a name="157108730"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157108730" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157108730">(Jan 29 2019 at 14:32)</a>:</h4>
<p>...which creates <a href="https://github.com/rust-lang/rust/blob/106b3e9fa4d53efc4e8eab47d1043789c88f99a5/src/librustc_typeck/check/closure.rs#L640-L641" target="_blank" title="https://github.com/rust-lang/rust/blob/106b3e9fa4d53efc4e8eab47d1043789c88f99a5/src/librustc_typeck/check/closure.rs#L640-L641">the liberated signature</a>...</p>



<a name="157108766"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157108766" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157108766">(Jan 29 2019 at 14:33)</a>:</h4>
<p>hmm, I don't see anything obviously wrong with <em>this</em> path</p>



<a name="157108776"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157108776" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157108776">(Jan 29 2019 at 14:33)</a>:</h4>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span> the type which winds up being invalid, what is it the type of?</p>



<a name="157108779"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157108779" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157108779">(Jan 29 2019 at 14:33)</a>:</h4>
<p>oh, my build is done</p>



<a name="157108787"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157108787" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157108787">(Jan 29 2019 at 14:33)</a>:</h4>
<p>er, no it's not</p>



<a name="157108808"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157108808" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157108808">(Jan 29 2019 at 14:33)</a>:</h4>
<p>the Boxed closure?</p>



<a name="157108846"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157108846" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157108846">(Jan 29 2019 at 14:34)</a>:</h4>
<p>I guess I can browser your gist</p>



<a name="157108884"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157108884" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157108884">(Jan 29 2019 at 14:34)</a>:</h4>
<p>here: <a href="https://gist.github.com/pnkfelix/070ea7fe4b4a95c8129c06694cbeb457#file-rlog-L5539" target="_blank" title="https://gist.github.com/pnkfelix/070ea7fe4b4a95c8129c06694cbeb457#file-rlog-L5539">https://gist.github.com/pnkfelix/070ea7fe4b4a95c8129c06694cbeb457#file-rlog-L5539</a></p>



<a name="157108925"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157108925" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157108925">(Jan 29 2019 at 14:35)</a>:</h4>
<p>but I think I must misunderstand your Q, since "boxed closure" is what I pasted up above</p>



<a name="157109110"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157109110" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157109110">(Jan 29 2019 at 14:37)</a>:</h4>
<p>hmm</p>



<a name="157109119"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157109119" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157109119">(Jan 29 2019 at 14:37)</a>:</h4>
<p>my debug log doesn't show a call to sig_of_closure_with_expectation</p>



<a name="157109398"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157109398" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157109398">(Jan 29 2019 at 14:40)</a>:</h4>
<p>but even <code>sig_of_closure_no_expectation</code> will also go down into <code>closure_sigs</code> which is what is calling <code>liberate_late_bound_regions</code> ..</p>



<a name="157109421"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157109421" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157109421">(Jan 29 2019 at 14:41)</a>:</h4>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span> I'm poking at your log, sorry, still trying to understand just where the placeholder is/comes from. I really dislike how types print out, even with <code>-Zverbose</code> :(</p>



<a name="157109445"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157109445" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157109445">(Jan 29 2019 at 14:41)</a>:</h4>
<p>no need to be sorry; hearing you being unsure about where they arise makes me feel less dumb about my own inability to determine it</p>



<a name="157109580"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157109580" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157109580">(Jan 29 2019 at 14:43)</a>:</h4>
<p>I <em>believe</em> they are coming from <code>rustc::traits::select::match_impl</code></p>



<a name="157109675"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157109675" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157109675">(Jan 29 2019 at 14:44)</a>:</h4>
<p>(but maybe you want to identify the culprit further from the hot end of the call stack)</p>



<a name="157109889"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157109889" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157109889">(Jan 29 2019 at 14:47)</a>:</h4>
<p>maybe you can supply me with higher level understanding of the design here</p>



<a name="157109958"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157109958" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157109958">(Jan 29 2019 at 14:48)</a>:</h4>
<p>I infer that that placeholders (of any kind, region or type) are not meant to show up in the tables that we write into in <code>writeback.rs</code>, right?</p>



<a name="157110011"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157110011" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157110011">(Jan 29 2019 at 14:49)</a>:</h4>
<p>so the code that does <code>replace_bound_vars_with_placeholders</code> ... is that only supposed to be creating types that are just temporary objects that we use for e.g. comparisons with other types, and then discard?</p>



<a name="157110158"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157110158" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157110158">(Jan 29 2019 at 14:51)</a>:</h4>
<p>right</p>



<a name="157110163"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157110163" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157110163">(Jan 29 2019 at 14:51)</a>:</h4>
<p>what should be happening is that we create placeholders</p>



<a name="157110170"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157110170" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157110170">(Jan 29 2019 at 14:51)</a>:</h4>
<p>but if they wind up related to some inference variable</p>



<a name="157110175"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157110175" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157110175">(Jan 29 2019 at 14:51)</a>:</h4>
<p>that would appear in the writeback table</p>



<a name="157110185"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157110185" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157110185">(Jan 29 2019 at 14:51)</a>:</h4>
<p>then the varibale is in an earlier universe that cannot contain the placeholder</p>



<a name="157110192"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157110192" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157110192">(Jan 29 2019 at 14:51)</a>:</h4>
<p>and hence gets changed during inference</p>



<a name="157113344"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157113344" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157113344">(Jan 29 2019 at 15:38)</a>:</h4>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span> i think maybe I found the problem</p>



<a name="157113363"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157113363" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157113363">(Jan 29 2019 at 15:39)</a>:</h4>
<p>I'm all ears</p>



<a name="157113369"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157113369" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157113369">(Jan 29 2019 at 15:39)</a>:</h4>
<p>let me double check one thing</p>



<a name="157113690"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157113690" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157113690">(Jan 29 2019 at 15:44)</a>:</h4>
<p>ok I haven't quite proven it yet <em>but</em></p>



<a name="157113742"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157113742" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157113742">(Jan 29 2019 at 15:44)</a>:</h4>
<p>I'm pretty sure the problem is this 'opportunistic region resolve' thing</p>



<a name="157113754"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157113754" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157113754">(Jan 29 2019 at 15:44)</a>:</h4>
<p>right now, if we have a <code>make_eqregion</code> call, we unify region variables</p>



<a name="157113761"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157113761" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157113761">(Jan 29 2019 at 15:44)</a>:</h4>
<p>but if they are in different universes</p>



<a name="157113769"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157113769" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157113769">(Jan 29 2019 at 15:44)</a>:</h4>
<p>I think this can cause the placeholder to leak out</p>



<a name="157113783"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157113783" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157113783">(Jan 29 2019 at 15:44)</a>:</h4>
<p>we're not using a universe-aware unification, in other words</p>



<a name="157113921"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157113921" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157113921">(Jan 29 2019 at 15:46)</a>:</h4>
<p>hmm</p>



<a name="157113926"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157113926" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157113926">(Jan 29 2019 at 15:46)</a>:</h4>
<p>that sounds more subtle than what I was hoping for</p>



<a name="157113940"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157113940" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157113940">(Jan 29 2019 at 15:46)</a>:</h4>
<p>but an understandable oversight, I guess</p>



<a name="157115274"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157115274" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157115274">(Jan 29 2019 at 16:05)</a>:</h4>
<p>I'm still trrying to "prove it"</p>



<a name="157115316"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157115316" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157115316">(Jan 29 2019 at 16:06)</a>:</h4>
<p>not sure the best fix</p>



<a name="157115367"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157115367" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157115367">(Jan 29 2019 at 16:07)</a>:</h4>
<p>I <em>might</em> be wrong</p>



<a name="157115446"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157115446" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157115446">(Jan 29 2019 at 16:08)</a>:</h4>
<p>although <em>if</em> I am, it sort of suggests another possible bug lurking :)</p>



<a name="157115492"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157115492" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157115492">(Jan 29 2019 at 16:09)</a>:</h4>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span> ok I thnk i'm wrong</p>



<a name="157115496"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157115496" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157115496">(Jan 29 2019 at 16:09)</a>:</h4>
<p>but I think know what the bug is <em>now</em></p>



<a name="157120705"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157120705" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157120705">(Jan 29 2019 at 17:18)</a>:</h4>
<p>well, it seems like I am wrong again. I <em>thought</em> the problem (which seems like maybe <em>another</em> bug lurking) had to do with type generalization using the wrong universes.</p>



<a name="157120798"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157120798" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157120798">(Jan 29 2019 at 17:19)</a>:</h4>
<p>I think <span class="user-mention" data-user-id="116083">@pnkfelix</span> maybe it'd be interesting tomorrow morning to try and walk through this a bit together, though my schedule tomorrow likely doesn't mesh with yours (I think I am available only starting at 11:00 UTC-05:00)</p>



<a name="157175768"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157175768" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157175768">(Jan 30 2019 at 10:21)</a>:</h4>
<p>yeah that's around when I have to leave to pick up Logan</p>



<a name="157175774"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157175774" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157175774">(Jan 30 2019 at 10:21)</a>:</h4>
<p>though actually: You know, I could just leave earlier and work from home before then</p>



<a name="157175783"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157175783" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157175783">(Jan 30 2019 at 10:21)</a>:</h4>
<p>that would allow us to work together for maybe 25 minutes or so, starting at 11:00 UTC-05:00</p>



<a name="157183391"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157183391" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157183391">(Jan 30 2019 at 12:30)</a>:</h4>
<p>ok let's do that</p>



<a name="157197873"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157197873" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157197873">(Jan 30 2019 at 16:02)</a>:</h4>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span> ping</p>



<a name="157197976"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157197976" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157197976">(Jan 30 2019 at 16:03)</a>:</h4>
<p>argh</p>



<a name="157197985"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157197985" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157197985">(Jan 30 2019 at 16:03)</a>:</h4>
<p>I didn't actually leave in time</p>



<a name="157198027"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157198027" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157198027">(Jan 30 2019 at 16:04)</a>:</h4>
<p>because I got nerd-sniped doing <a href="https://github.com/rust-lang/rust/issues/57735" target="_blank" title="https://github.com/rust-lang/rust/issues/57735">#57735</a></p>



<a name="157198068"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157198068" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157198068">(Jan 30 2019 at 16:04)</a>:</h4>
<p>so I just cannot do a pair up right now; I have to leave too soon. <span aria-label="sad" class="emoji emoji-2639" role="img" title="sad">:sad:</span></p>



<a name="157198141"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157198141" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157198141">(Jan 30 2019 at 16:05)</a>:</h4>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span> no worries, maybe I'll dig a bit and leave some more notes?</p>



<a name="157198206"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157198206" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157198206">(Jan 30 2019 at 16:06)</a>:</h4>
<p>sure. sorry for failing to live up to the proposal</p>



<a name="157198207"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157198207" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157198207">(Jan 30 2019 at 16:06)</a>:</h4>
<p>We could try to sync up a bit tomorrow morning before compiler meeting (though I know you often do pre-triage) or Friday, too</p>



<a name="157198216"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157198216" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157198216">(Jan 30 2019 at 16:06)</a>:</h4>
<p>well, it was a bit tight</p>



<a name="157281521"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157281521" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157281521">(Jan 31 2019 at 15:56)</a>:</h4>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span> so I wasn't able to follow up on this</p>



<a name="157281523"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157281523" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157281523">(Jan 31 2019 at 15:56)</a>:</h4>
<p>but I still want to =)</p>



<a name="157281533"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157281533" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157281533">(Jan 31 2019 at 15:56)</a>:</h4>
<p>Do you have time tomorrow?</p>



<a name="157281535"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157281535" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157281535">(Jan 31 2019 at 15:56)</a>:</h4>
<p>Do you think you'd like to try pairing tomorrow morning?</p>



<a name="157281541"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157281541" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157281541">(Jan 31 2019 at 15:56)</a>:</h4>
<p>Yeah, Friday is relatively free for me right now</p>



<a name="157281542"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157281542" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157281542">(Jan 31 2019 at 15:56)</a>:</h4>
<p>yeah sure</p>



<a name="157281561"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157281561" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157281561">(Jan 31 2019 at 15:57)</a>:</h4>
<p>the only thing I want to do is go over all the homework for Berlin. :)</p>



<a name="157281568"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157281568" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157281568">(Jan 31 2019 at 15:57)</a>:</h4>
<p>but we should carve out time for this</p>



<a name="157281669"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157281669" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157281669">(Jan 31 2019 at 15:58)</a>:</h4>
<p>Your schedule is more constrained than mine. Do you have a time in mind?</p>



<a name="157281681"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157281681" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157281681">(Jan 31 2019 at 15:58)</a>:</h4>
<p>If not then you can just ping me.</p>



<a name="157281718"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157281718" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157281718">(Jan 31 2019 at 15:59)</a>:</h4>
<p>oh wait, let me check something</p>



<a name="157283077"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157283077" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157283077">(Jan 31 2019 at 16:17)</a>:</h4>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span> I was imagining 9am UTC-5</p>



<a name="157354810"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157354810" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157354810">(Feb 01 2019 at 14:07)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> is that, like, now?</p>



<a name="157355715"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157355715" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157355715">(Feb 01 2019 at 14:23)</a>:</h4>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span> would've been, but I got held up</p>



<a name="157355742"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157355742" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157355742">(Feb 01 2019 at 14:24)</a>:</h4>
<p>Also, I had in mind doing a video chat, but for .. reasons .. I'm holed up in a cafe now. But I would be happy to chat back and forth a bit on Zulip</p>



<a name="157355778"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157355778" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157355778">(Feb 01 2019 at 14:24)</a>:</h4>
<p>regardless I plan to spend some time investigating</p>



<a name="157356482"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157356482" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157356482">(Feb 01 2019 at 14:34)</a>:</h4>
<p>So, some notes:</p>
<ul>
<li>the region variable that is being resolved to a placeholder is <code>'_#3r</code></li>
</ul>



<a name="157356504"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157356504" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157356504">(Feb 01 2019 at 14:34)</a>:</h4>
<ul>
<li>I <strong>believe</strong> it comes from the type variable <code>'_#9t</code></li>
</ul>



<a name="157356533"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157356533" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157356533">(Feb 01 2019 at 14:35)</a>:</h4>
<p>but I'm trying to remember why I thought that</p>



<a name="157356553"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157356553" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157356553">(Feb 01 2019 at 14:35)</a>:</h4>
<p>the output of closure types is super unhelpful here</p>



<a name="157356672"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157356672" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157356672">(Feb 01 2019 at 14:37)</a>:</h4>
<p>Maybe we should revise their output under -Z verbose</p>



<a name="157356777"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157356777" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157356777">(Feb 01 2019 at 14:38)</a>:</h4>
<p>anyway sure lets chat here for maybe 20minutes; I am going to attempt to take Logan to his first trip to a barber after that.</p>



<a name="157356790"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157356790" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157356790">(Feb 01 2019 at 14:39)</a>:</h4>
<blockquote>
<p>Maybe we should revise their output under -Z verbose</p>
</blockquote>
<p>I'm doing that now to double check a few things</p>



<a name="157356804"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157356804" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157356804">(Feb 01 2019 at 14:39)</a>:</h4>
<p>but what I <strong>believe</strong> is that <code>_#9t</code> is the type variable we use to represent the closure signature</p>



<a name="157356817"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157356817" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157356817">(Feb 01 2019 at 14:39)</a>:</h4>
<p>in any case, <code>'_#9t</code> gets created when we are doing some trait solving</p>



<a name="157356838"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157356838" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157356838">(Feb 01 2019 at 14:39)</a>:</h4>
<p>at first I was confused because</p>



<a name="157356849"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157356849" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157356849">(Feb 01 2019 at 14:39)</a>:</h4>
<p>I presumed that the placeholder from U6 was "leaking" into a variable where it didn't belong</p>



<a name="157356904"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157356904" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157356904">(Feb 01 2019 at 14:40)</a>:</h4>
<p>the basic idea being that any type which writeback is trying to resolve</p>



<a name="157357009"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157357009" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157357009">(Feb 01 2019 at 14:41)</a>:</h4>
<p>should be in universe 0</p>



<a name="157357011"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157357011" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157357011">(Feb 01 2019 at 14:41)</a>:</h4>
<p>and hence not able to contain placeholders</p>



<a name="157357064"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157357064" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157357064">(Feb 01 2019 at 14:42)</a>:</h4>
<p>but for some reason <code>'_#9t</code> <em>is</em> defined in universe 6 I believe</p>



<a name="157357371"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157357371" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157357371">(Feb 01 2019 at 14:46)</a>:</h4>
<p>the hypothesized "leaking" was occurring due to this line: <a href="https://gist.github.com/pnkfelix/070ea7fe4b4a95c8129c06694cbeb457#file-rlog-L3735" target="_blank" title="https://gist.github.com/pnkfelix/070ea7fe4b4a95c8129c06694cbeb457#file-rlog-L3735">https://gist.github.com/pnkfelix/070ea7fe4b4a95c8129c06694cbeb457#file-rlog-L3735</a> ?</p>



<a name="157357397"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157357397" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157357397">(Feb 01 2019 at 14:46)</a>:</h4>
<p>right</p>



<a name="157357398"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157357398" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157357398">(Feb 01 2019 at 14:46)</a>:</h4>
<p>so</p>



<a name="157357404"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157357404" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157357404">(Feb 01 2019 at 14:46)</a>:</h4>
<p>I found what I think are two bugs so far :)</p>



<a name="157357413"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157357413" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157357413">(Feb 01 2019 at 14:46)</a>:</h4>
<p>but neither of them apply here</p>



<a name="157357432"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157357432" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157357432">(Feb 01 2019 at 14:47)</a>:</h4>
<p>because in this case <code>'_#9t</code> <em>is</em> in U6, so it's not really a leak</p>



<a name="157357434"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157357434" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157357434">(Feb 01 2019 at 14:47)</a>:</h4>
<p>as my thesis advisor used to say</p>



<a name="157357437"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157357437" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157357437">(Feb 01 2019 at 14:47)</a>:</h4>
<p>"that's great news!"</p>



<a name="157357466"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157357466" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157357466">(Feb 01 2019 at 14:47)</a>:</h4>
<p>(or maybe it was more like "congratulations! You found a bug!")</p>



<a name="157357467"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157357467" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157357467">(Feb 01 2019 at 14:47)</a>:</h4>
<p>so i'm trying now to dig a bit more into the context around this <code>'_#9t</code></p>



<a name="157357483"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157357483" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157357483">(Feb 01 2019 at 14:47)</a>:</h4>
<p>I have the fixes for the bugs in my branch, so afer this maybe I'll try to create test cases</p>



<a name="157357485"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157357485" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157357485">(Feb 01 2019 at 14:48)</a>:</h4>
<p>its (<code>'_#9t</code>) for the type parameter <code>T</code>, right? <a href="https://gist.github.com/pnkfelix/070ea7fe4b4a95c8129c06694cbeb457#file-rlog-L3718" target="_blank" title="https://gist.github.com/pnkfelix/070ea7fe4b4a95c8129c06694cbeb457#file-rlog-L3718">https://gist.github.com/pnkfelix/070ea7fe4b4a95c8129c06694cbeb457#file-rlog-L3718</a></p>



<a name="157357586"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157357586" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157357586">(Feb 01 2019 at 14:49)</a>:</h4>
<p>(in the context of the instantiation of that trait within <code>fn main</code>, I assume)</p>



<a name="157357731"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157357731" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157357731">(Feb 01 2019 at 14:50)</a>:</h4>
<p>yeah, presumably. So I see this:</p>
<div class="codehilite"><pre><span></span>DEBUG 2019-02-01T14:48:44Z: rustc::infer::at: eq(
&lt;[closure@/home/nmatsakis/tmp/57843.rs:15:18: 15:24 closure_kind_ty=_#4t closure_sig_ty=extern &quot;rust-call&quot; fn((_#3t,))] as ClonableFn&lt;&amp;RePlaceholder(Placeholder { universe: U6, name: BrNamed(crate0:DefIndex(1:14), &#39;a) }) bool&gt;&gt;
==
&lt;_#10t as ClonableFn&lt;_#9t&gt;&gt;)
</pre></div>



<a name="157357880"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157357880" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157357880">(Feb 01 2019 at 14:52)</a>:</h4>
<p>which I think is coming from trait solving</p>



<a name="157357901"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157357901" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157357901">(Feb 01 2019 at 14:53)</a>:</h4>
<p>the debug output is wacky here but basically it's unifying the impl trait ref (<code>_#10t: CloneableFn&lt;_#9t&gt;</code>) with the thing the closure offers</p>



<a name="157357910"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157357910" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157357910">(Feb 01 2019 at 14:53)</a>:</h4>
<p>and you can see that the closure has a placeholder</p>



<a name="157358264"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157358264" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157358264">(Feb 01 2019 at 14:57)</a>:</h4>
<p>I have a higher level question</p>



<a name="157358268"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157358268" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157358268">(Feb 01 2019 at 14:58)</a>:</h4>
<p>which is: What .. do you expect here?</p>



<a name="157358318"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157358318" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157358318">(Feb 01 2019 at 14:58)</a>:</h4>
<p>for no type at all to be fed into writeback ?</p>



<a name="157358325"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157358325" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157358325">(Feb 01 2019 at 14:58)</a>:</h4>
<p>(for the higher-ranked closure, that is)</p>



<a name="157358330"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157358330" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157358330">(Feb 01 2019 at 14:58)</a>:</h4>
<p>or for a type with a different structure to be fed in?</p>



<a name="157358388"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157358388" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157358388">(Feb 01 2019 at 14:59)</a>:</h4>
<blockquote>
<p>which is: What .. do you expect here?</p>
</blockquote>
<p>I expect -- I <em>think</em> -- a region inference error, but I guess I need to go back and study the example program</p>



<a name="157358446"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157358446" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157358446">(Feb 01 2019 at 15:00)</a>:</h4>
<div class="codehilite"><pre><span></span>DEBUG 2019-02-01T14:56:51Z: rustc::traits::select: assemble_candidates_from_impls(obligation=Obligation(predicate=Binder(TraitPredicate(&lt;[closure@/home/nmatsakis/tmp/57843.rs:15:18: 15:24 closure_kind_ty=_#4t closure_sig_ty=extern &quot;rust-call&quot; fn((_#3t,))] as ClonableFn&lt;&amp;ReLateBound(DebruijnIndex(0), BrNamed(crate0:DefIndex(1:14), &#39;a)) bool&gt;&gt;)),cause=ObligationCause { span: /home/nmatsakis/tmp/57843.rs:15:9: 15:25, body_id: NodeId(115), code: ObjectCastObligation((dyn for&lt;&#39;a&gt; ClonableFn&lt;&amp;ReLateBound(DebruijnIndex(0), BrNamed(crate0:DefIndex(1:14), &#39;a)) bool&gt; + &#39;_#1r)) },param_env=ParamEnv { caller_bounds: [], reveal: UserFacing, def_id: None },depth=2))
</pre></div>



<a name="157358468"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157358468" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157358468">(Feb 01 2019 at 15:00)</a>:</h4>
<p>that is the context of what is happening</p>



<a name="157358470"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157358470" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157358470">(Feb 01 2019 at 15:00)</a>:</h4>
<p>that I finally found</p>



<a name="157358485"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157358485" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157358485">(Feb 01 2019 at 15:00)</a>:</h4>
<p>I realized I wasn't dumping the <code>rustc::traits</code> debug log</p>



<a name="157358496"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157358496" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157358496">(Feb 01 2019 at 15:00)</a>:</h4>
<p>let me try to translate that</p>



<a name="157358539"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157358539" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157358539">(Feb 01 2019 at 15:01)</a>:</h4>
<p>we are asked to solve:</p>
<div class="codehilite"><pre><span></span>for&lt;&#39;a&gt; {
   Closure&lt;fn(_#3t)&gt;: ClonableFn(&amp;&#39;a bool)
}
</pre></div>



<a name="157358686"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157358686" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157358686">(Feb 01 2019 at 15:03)</a>:</h4>
<p>where the <code>fn(_#3t)</code> is the "pseudo-type parameter" closures use to encode their expected signature</p>



<a name="157358703"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157358703" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157358703">(Feb 01 2019 at 15:03)</a>:</h4>
<p>but now I want to circle back to the example program again</p>



<a name="157358720"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157358720" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157358720">(Feb 01 2019 at 15:03)</a>:</h4>
<p>we have this</p>
<div class="codehilite"><pre><span></span> Foo(Box::new(|_| ()));
</pre></div>


<p>where <code>Foo</code> is <code>struct Foo(Box&lt;dyn for&lt;'a&gt; ClonableFn&lt;&amp;'a bool&gt;&gt;)</code></p>



<a name="157358815"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157358815" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157358815">(Feb 01 2019 at 15:04)</a>:</h4>
<p>and indeed when type-checking the closure we <em>do</em> have the "expected" type of</p>
<div class="codehilite"><pre><span></span>ExpectRvalueLikeUnsized((dyn for&lt;&#39;a&gt; ClonableFn&lt;&amp;ReLateBound(DebruijnIndex(0), BrNamed(crate0:DefIndex(1:14), &#39;a)) bool&gt; + &#39;_#0r)))
</pre></div>



<a name="157358858"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157358858" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157358858">(Feb 01 2019 at 15:05)</a>:</h4>
<p>and yet we wind up with no expected signature:</p>
<div class="codehilite"><pre><span></span>DEBUG 2019-02-01T14:56:51Z: rustc_typeck::check::closure: check_closure(opt_kind=None, expected_sig=None)
</pre></div>



<a name="157358879"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157358879" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157358879">(Feb 01 2019 at 15:05)</a>:</h4>
<p>I'm not sure why that is, but it fits my expectation that we should be seeing an error here</p>



<a name="157358932"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157358932" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157358932">(Feb 01 2019 at 15:06)</a>:</h4>
<p>in particular, we've effectively created a type variable <code>_#3t</code> in the root universe and said the closure type has signature <code>fn(_#3t)</code> -- note the binder is not on the <code>fn</code></p>



<a name="157358988"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157358988" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157358988">(Feb 01 2019 at 15:06)</a>:</h4>
<p>but then we are tying to say (effectively)</p>
<div class="codehilite"><pre><span></span>exists&lt;T3&gt; { // the variable `_#3t`
    forall&lt;&#39;a&gt; {
        T3 = &amp;&#39;a bool // because of the required fn signature
    }
}
</pre></div>


<p>and of course that should not work</p>



<a name="157359648"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157359648" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157359648">(Feb 01 2019 at 15:14)</a>:</h4>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span> ok i'm digging a bit more. I suspect one of the bugs I found <em>may</em> be the culprit, but my fix was incompleted. In particular, I'm looking at the "generalize" code. I see these logs (from my branch, which has a few extra logs):</p>
<div class="codehilite"><pre><span></span>DEBUG 2019-02-01T14:56:51Z: rustc::infer::combine: generalize(ty=&amp;&#39;_#3r bool, for_vid=_#3t, dir=EqTo
DEBUG 2019-02-01T14:56:51Z: rustc::infer::combine: generalize: ambient_variance = o
DEBUG 2019-02-01T14:56:51Z: rustc::infer::combine: generalize: for_universe = U0
DEBUG 2019-02-01T14:56:51Z: rustc::infer::combine: generalize: success { &amp;&#39;_#3r bool, false }
DEBUG 2019-02-01T14:56:51Z: rustc::infer::combine: instantiate(a_ty=&amp;&#39;_#3r bool, dir=EqTo, b_vid=_#3t, generalized b_ty=&amp;&#39;_#3r bool)
</pre></div>


<p>what this is saying is that we have to unify <code>_#3t</code> (which is in the universe <code>U0</code>) with <code>&amp;'_#3r bool</code> -- but <code>'_#3r</code> was created in the universe U6:</p>
<div class="codehilite"><pre><span></span>  12327:DEBUG 2019-02-01T14:56:51Z: rustc::infer::region_constraints: created new region variable &#39;_#3r in U6 with origin MiscVariable(/home/nmatsakis/tmp/57843.rs:15:9: 15:25)
</pre></div>


<p>the plan was to "instantiate"  <code>'_#3t</code> to <code>&amp;'X bool</code> where <code>'X</code> is a fresh variable in U0 (i.e., the universe of <code>'_#3t</code>) and then relate <code>&amp;'X bool</code> and <code>&amp;'3 bool</code>, which should eventually result in a region error. but something's not working there.</p>



<a name="157359683"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157359683" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157359683">(Feb 01 2019 at 15:15)</a>:</h4>
<p>Ah, I see</p>



<a name="157360031"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157360031" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157360031">(Feb 01 2019 at 15:19)</a>:</h4>
<p>I think the good news is that it is one of the two bugs I found; the bad news is that my fix was wrong (but I can fix it, so that's not really bad). But let's see.</p>



<a name="157360772"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157360772" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157360772">(Feb 01 2019 at 15:27)</a>:</h4>
<p>Huzzah:</p>
<div class="codehilite"><pre><span></span>&gt; rustc +rust-2-stage1 ~/tmp/57843.rs
error[E0308]: mismatched types
  --&gt; /home/nmatsakis/tmp/57843.rs:15:9
   |
15 |     Foo(Box::new(|_| ()));
   |         ^^^^^^^^^^^^^^^^ one type is more general than the other
   |
   = note: expected type `std::ops::FnOnce&lt;(&amp;&#39;a bool,)&gt;`
              found type `std::ops::FnOnce&lt;(&amp;bool,)&gt;`
</pre></div>



<a name="157360788"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157360788" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157360788">(Feb 01 2019 at 15:27)</a>:</h4>
<p>now I just need to rebase over <span class="user-mention" data-user-id="116113">@lqd</span>'s PR so I can get decent diagnostics :)</p>



<a name="157361007"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157361007" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157361007">(Feb 01 2019 at 15:30)</a>:</h4>
<p>(unfortunately I think this latter diagnostic might be <a href="https://github.com/rust-lang/rust/issues/57875" target="_blank" title="https://github.com/rust-lang/rust/issues/57875">#57875</a> with PolyTraitRefs ?)</p>



<a name="157361026"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157361026" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157361026">(Feb 01 2019 at 15:30)</a>:</h4>
<p>heh, probably true</p>



<a name="157361587"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2357843%20universe-related%20ICE/near/157361587" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2357843.20universe-related.20ICE.html#157361587">(Feb 01 2019 at 15:38)</a>:</h4>
<p>Incidentally, <span class="user-mention" data-user-id="116083">@pnkfelix</span>, this points to something of an efficiency shortcoming in the way I integrated universe support. We adopted this simplification where the inference table always has a single "current universe" counter that is incremented each time we enter a placeholder -- <strong>but never decremented again</strong>. This avoided the need to carry universes around in our obligations and other things, but it means that we sometimes wind up with inference variables that logically <em>could</em> be in the root universe being assigned to some higher universe (which is an extension of the root universe, so it all works out). </p>
<p>I think that as the chalk transition continues, we could do better here.</p>
<p>All of this is making me think that we really need to do some "let's talk about the design of universes in detail" sort of thing. (Next rustc lecture series, maybe?)</p>



<hr><p>Last updated: Aug 07 2021 at 22:04 UTC</p>
</html>