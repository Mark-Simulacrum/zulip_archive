<html>
<head><meta charset="utf-8"><title>reintegrating chalk into rustc · wg-traits · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/index.html">wg-traits</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html">reintegrating chalk into rustc</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="187698558"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/187698558" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#187698558">(Feb 08 2020 at 02:44)</a>:</h4>
<p>So I did a thing and the rustc <em>builds</em> with the latest Chalk version</p>



<a name="187698562"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/187698562" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#187698562">(Feb 08 2020 at 02:44)</a>:</h4>
<p>Now, there are definitely some <code>todo!()</code>s</p>



<a name="187698571"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/187698571" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#187698571">(Feb 08 2020 at 02:45)</a>:</h4>
<p>And keeps the same scheme as before - where everything is built around <code>chalk-engine</code></p>



<a name="187698579"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/187698579" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#187698579">(Feb 08 2020 at 02:45)</a>:</h4>
<p>But it at least is a starting point (for me at least)</p>



<a name="187698618"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/187698618" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#187698618">(Feb 08 2020 at 02:46)</a>:</h4>
<p>Now, two questions:</p>



<a name="187698622"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/187698622" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#187698622">(Feb 08 2020 at 02:46)</a>:</h4>
<p>Actually maybe three</p>



<a name="187698627"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/187698627" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#187698627">(Feb 08 2020 at 02:47)</a>:</h4>
<p>1) Maybe we should regularly publish chalk versions to <a href="http://crates.io" target="_blank" title="http://crates.io">crates.io</a>, even if they're still <code>0.x.x</code> for now</p>



<a name="187698628"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/187698628" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#187698628">(Feb 08 2020 at 02:47)</a>:</h4>
<p>2) Should I push this to a branch so people can check it out?</p>



<a name="187698666"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/187698666" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#187698666">(Feb 08 2020 at 02:48)</a>:</h4>
<p>3) Is it more worth it to completely rip out the existing integration and start fresh</p>



<a name="187712987"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/187712987" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#187712987">(Feb 08 2020 at 11:21)</a>:</h4>
<p>Interesting. I was debating about this.</p>



<a name="187713034"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/187713034" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#187713034">(Feb 08 2020 at 11:22)</a>:</h4>
<p>It seems like some folks are blocked on the current chalk integration, so I think it makes sense to do something to change that ASAP</p>



<a name="187713038"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/187713038" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#187713038">(Feb 08 2020 at 11:22)</a>:</h4>
<p>I do think we should probably get in the habit of publishing regular versions to <a href="http://crates.io" target="_blank" title="http://crates.io">crates.io</a></p>



<a name="187713108"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/187713108" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#187713108">(Feb 08 2020 at 11:24)</a>:</h4>
<p>I am debating about whether it makes sense to try and remove the existing integration or upgrade it -- I guess I don't have a strong feeling. The benefits I see of upgrading are</p>
<ul>
<li>you already did it :)</li>
<li>it lets us run some tests, which we could try to use more of</li>
<li>it is maybe easier to port over to using chalk-solve this way</li>
</ul>
<p>The benefits I see of removing are</p>
<ul>
<li>less code for rustc to compile, marginally faster compilation times  :)</li>
<li>I don't really expect to re-use that much of the code that's in there</li>
<li>We don't have to start publishing <em>yet</em> -- though I think we will want to <em>soon</em></li>
</ul>



<a name="187733544"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/187733544" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#187733544">(Feb 08 2020 at 22:17)</a>:</h4>
<p>So, the idea I was going for is: Can I spend only a bit of time and get rustc to build with the latest version of Chalk, so we can start to unblock issues like <a href="https://github.com/rust-lang/rust/pull/68807" target="_blank" title="https://github.com/rust-lang/rust/pull/68807">https://github.com/rust-lang/rust/pull/68807</a>. Under the assumption that we don't particularly care if it <em>works</em>.</p>



<a name="187733585"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/187733585" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#187733585">(Feb 08 2020 at 22:18)</a>:</h4>
<p>And yes, it's completely possible and only about an hour of work</p>



<a name="187733593"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/187733593" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#187733593">(Feb 08 2020 at 22:19)</a>:</h4>
<p>But, I also sort of think that a lot of the existing code will be replaced when we move to use <code>chalk-solve</code></p>



<a name="187735696"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/187735696" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#187735696">(Feb 08 2020 at 23:27)</a>:</h4>
<p>Shoot, I know this was talked about at some point (I think), but what was the reasoning for making all the functions of <code>TypeFamily</code> (particularly here the intern* functions) take no parameter that could store state</p>



<a name="187735765"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/187735765" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#187735765">(Feb 08 2020 at 23:29)</a>:</h4>
<p>So, like in <code>ChakIr</code> and <code>rust-analyzer</code> <code>intern_goal</code> just returns <code>Arc::new(goal)</code>. But in rustc, the goals are actually interned on <code>TyCtxt</code></p>



<a name="187736141"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/187736141" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#187736141">(Feb 08 2020 at 23:42)</a>:</h4>
<p>Ok in hindsight <a href="https://github.com/rust-lang/chalk/commit/9f5d084d3cd39feba2a6264d879ffc4e1c09d9e8#diff-f8d532fdb5ed1dd1137e521e1fb3f704" target="_blank" title="https://github.com/rust-lang/chalk/commit/9f5d084d3cd39feba2a6264d879ffc4e1c09d9e8#diff-f8d532fdb5ed1dd1137e521e1fb3f704">https://github.com/rust-lang/chalk/commit/9f5d084d3cd39feba2a6264d879ffc4e1c09d9e8#diff-f8d532fdb5ed1dd1137e521e1fb3f704</a> was a bad commit</p>



<a name="187736736"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/187736736" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#187736736">(Feb 09 2020 at 00:03)</a>:</h4>
<p>Oh hey, all the <code>-Z chalk</code> tests pass</p>



<a name="187736865"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/187736865" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#187736865">(Feb 09 2020 at 00:06)</a>:</h4>
<p>that can't be right....too many <code>todo!()</code>s</p>



<a name="187738291"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/187738291" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#187738291">(Feb 09 2020 at 00:59)</a>:</h4>
<p>update: it wasn't right</p>



<a name="187738347"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/187738347" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#187738347">(Feb 09 2020 at 01:00)</a>:</h4>
<p>So, next roadblock</p>



<a name="187738352"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/187738352" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#187738352">(Feb 09 2020 at 01:00)</a>:</h4>
<p><code>instantiate_ucanonical_goal</code> and <code>instantiate_ex_clause</code></p>



<a name="187738371"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/187738371" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#187738371">(Feb 09 2020 at 01:01)</a>:</h4>
<p>And I knew this one was coming</p>



<a name="187738415"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/187738415" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#187738415">(Feb 09 2020 at 01:02)</a>:</h4>
<p>But, the essentially <code>impl Fn</code> arg was added to these for when Chalk was originally integrated with rustc</p>



<a name="187738422"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/187738422" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#187738422">(Feb 09 2020 at 01:02)</a>:</h4>
<p>But in the name of simplicity, these have been reverted back to just returning the instantiated forms</p>



<a name="187738428"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/187738428" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#187738428">(Feb 09 2020 at 01:02)</a>:</h4>
<p>(which works fine in <code>chalk-solve</code>)</p>



<a name="187738483"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/187738483" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#187738483">(Feb 09 2020 at 01:04)</a>:</h4>
<p>but in rustc the <code>InferenceTable</code> includes a reference to <code>InferCtxt</code>, which is passed as an arg to the function provided to <code>enter_with_canonical</code></p>



<a name="187738537"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/187738537" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#187738537">(Feb 09 2020 at 01:06)</a>:</h4>
<p>now, <code>instantiate_ucanonical_goal</code> doesn't seem <em>too</em> bad, I don't think, since the two times we use it, the return values are "short-lived"</p>



<a name="187738538"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/187738538" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#187738538">(Feb 09 2020 at 01:06)</a>:</h4>
<p>now, <code>instantiate_ex_clause</code> is a bit more difficult</p>



<a name="187738543"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/187738543" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#187738543">(Feb 09 2020 at 01:06)</a>:</h4>
<p>since that makes a <code>Strand</code>, which we store on the <code>Stack</code></p>



<a name="187738748"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/187738748" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#187738748">(Feb 09 2020 at 01:12)</a>:</h4>
<p>now, looking through <code>chalk-engine</code> a bit, I think we could actually get away with instantiating the <code>ExClause</code> further down, instead of when we pop the <code>CanonicalStrand</code></p>



<a name="187738754"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/187738754" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#187738754">(Feb 09 2020 at 01:12)</a>:</h4>
<p>Though, this does mean more calls to instantiate it</p>



<a name="187738811"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/187738811" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#187738811">(Feb 09 2020 at 01:14)</a>:</h4>
<p>Maybe I should step back and clarify why requiring that <code>instantiate_ex_clause</code> take a function with a scoped reference is a bad thing right now:</p>



<a name="187738812"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/187738812" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#187738812">(Feb 09 2020 at 01:14)</a>:</h4>
<p>it means that we have to start thinking recursively again</p>



<a name="187738891"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/187738891" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#187738891">(Feb 09 2020 at 01:17)</a>:</h4>
<p>Also, looking back at <a href="https://github.com/rust-lang/chalk/pull/277" target="_blank" title="https://github.com/rust-lang/chalk/pull/277">https://github.com/rust-lang/chalk/pull/277</a></p>



<a name="187738936"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/187738936" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#187738936">(Feb 09 2020 at 01:18)</a>:</h4>
<p>specifically this <code>Clone</code> bound: <a href="https://github.com/rust-lang/chalk/pull/277/files#diff-f8d532fdb5ed1dd1137e521e1fb3f704R80" target="_blank" title="https://github.com/rust-lang/chalk/pull/277/files#diff-f8d532fdb5ed1dd1137e521e1fb3f704R80">https://github.com/rust-lang/chalk/pull/277/files#diff-f8d532fdb5ed1dd1137e521e1fb3f704R80</a></p>



<a name="187738941"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/187738941" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#187738941">(Feb 09 2020 at 01:18)</a>:</h4>
<p>I think that scheme wouldn't work for rustc</p>



<a name="187739044"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/187739044" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#187739044">(Feb 09 2020 at 01:22)</a>:</h4>
<p>Now, the other question is: do we really have to think about this, or will switching to <code>chalk-solve</code> fix this automatically</p>



<a name="187739094"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/187739094" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#187739094">(Feb 09 2020 at 01:24)</a>:</h4>
<p>I have a feeling we're gonna run into this somewhere</p>



<a name="187739097"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/187739097" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#187739097">(Feb 09 2020 at 01:24)</a>:</h4>
<blockquote>
<p>So, like in <code>ChakIr</code> and <code>rust-analyzer</code> <code>intern_goal</code> just returns <code>Arc::new(goal)</code>. But in rustc, the goals are actually interned on <code>TyCtxt</code></p>
</blockquote>
<p>maybe it's here</p>



<a name="187849880"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/187849880" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#187849880">(Feb 10 2020 at 19:30)</a>:</h4>
<blockquote>
<p>Shoot, I know this was talked about at some point (I think), but what was the reasoning for making all the functions of <code>TypeFamily</code> (particularly here the intern* functions) take no parameter that could store state</p>
</blockquote>
<p>I think we want to add such a parameter</p>



<a name="187849888"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/187849888" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#187849888">(Feb 10 2020 at 19:30)</a>:</h4>
<p>the reasoning was "incremental steps", but that's one of the big refactorings yet to come I think</p>



<a name="187880074"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/187880074" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#187880074">(Feb 11 2020 at 03:18)</a>:</h4>
<p>Question, would throwing more people at chalk integration help it get into the compiler faster? I'd be interested in dedicating time to help out if the issue is just lack of people hours and you can just throw blockers at me to grind away at, but if the issue is just the complexity of the issue I would rather not distract from the work.</p>



<a name="187886327"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/187886327" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> detrumi <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#187886327">(Feb 11 2020 at 06:06)</a>:</h4>
<p>We definitely could use some help! We're in the process of organizing things better so we can split up tasks, so I expect you can help out</p>



<a name="187900377"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/187900377" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matprec <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#187900377">(Feb 11 2020 at 10:38)</a>:</h4>
<p>I'm interested as well but it always seemed that people are busy enough to get their own tasks done :D</p>



<a name="187900447"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/187900447" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matprec <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#187900447">(Feb 11 2020 at 10:39)</a>:</h4>
<p>Feel free to ping me if there is something easy to tackle :)</p>



<a name="187918065"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/187918065" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#187918065">(Feb 11 2020 at 14:47)</a>:</h4>
<p>Yes <span class="user-mention" data-user-id="220273">@Jane Lusby</span> <span class="user-mention" data-user-id="202314">@matprec</span>, there are always things to do :) As <span class="user-mention" data-user-id="125131">@detrumi</span> said, we're in process of setting up a sprint for the next 6 weeks, so be on the lookout for a blog post (or hang around the channel)</p>



<a name="187919794"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/187919794" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#187919794">(Feb 11 2020 at 15:07)</a>:</h4>
<p>Okay well write my name down and assign me issues, I have Sunjay who can mentor me on getting started with chalk so I think I'll be able to get up and running quickly</p>



<a name="187919818"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/187919818" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#187919818">(Feb 11 2020 at 15:07)</a>:</h4>
<p>Definitely extremely interested in chalk integration</p>



<a name="187920610"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/187920610" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sunjay Varma <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#187920610">(Feb 11 2020 at 15:16)</a>:</h4>
<p>(I should note that I'm happy to help Jane get started if anyone needs me to, but I'm not really involved very much right now because of a lot of things going on in my personal life. Hoping to come back in a few months in a way where I can be much more consistent in my contributions!)</p>



<a name="188212231"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188212231" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188212231">(Feb 14 2020 at 14:50)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> you around?</p>



<a name="188212265"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188212265" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188212265">(Feb 14 2020 at 14:50)</a>:</h4>
<p>Whoops</p>



<a name="188212327"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188212327" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188212327">(Feb 14 2020 at 14:50)</a>:</h4>
<p>Was doing more work on integrating chalk into rustc last night</p>



<a name="188212358"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188212358" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188212358">(Feb 14 2020 at 14:51)</a>:</h4>
<p>Specifically, using chalk-solve and chalk-ir</p>



<a name="188212388"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188212388" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188212388">(Feb 14 2020 at 14:51)</a>:</h4>
<p>And came across this problem:</p>



<a name="188212516"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188212516" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188212516">(Feb 14 2020 at 14:52)</a>:</h4>
<p>So, in <code>TypeFamily</code>, the <code>_data</code> functions return back a reference</p>



<a name="188212569"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188212569" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188212569">(Feb 14 2020 at 14:52)</a>:</h4>
<p>Which, makes sense if the argument is a reference</p>



<a name="188212610"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188212610" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188212610">(Feb 14 2020 at 14:53)</a>:</h4>
<p>But, when we have to create a new <code>TyData</code> instance, it doesn't work</p>



<a name="188212634"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188212634" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188212634">(Feb 14 2020 at 14:53)</a>:</h4>
<p>(rust-analyzer also has this problem)</p>



<a name="188212747"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188212747" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188212747">(Feb 14 2020 at 14:55)</a>:</h4>
<p>So I was thinking, rather than returning a reference, we could have the <code>_data</code> functions take a function that is called with the reference to the <code>TyData</code></p>



<a name="188212820"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188212820" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188212820">(Feb 14 2020 at 14:55)</a>:</h4>
<p>So, for the default <code>TypeFamily</code>, it just passes the argument</p>



<a name="188212915"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188212915" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188212915">(Feb 14 2020 at 14:56)</a>:</h4>
<p>But for rustc or rust-analyzer, where we have to create a <code>TyData</code>, we don't have to store it anywhere</p>



<a name="188212936"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188212936" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188212936">(Feb 14 2020 at 14:57)</a>:</h4>
<p>Just wanted to know what you thought</p>



<a name="188213698"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188213698" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188213698">(Feb 14 2020 at 15:05)</a>:</h4>
<p>Either that, or make <code>_data</code> functions return a non-reference <code>TyData</code></p>



<a name="188213750"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188213750" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188213750">(Feb 14 2020 at 15:05)</a>:</h4>
<p>(I guess this same problem applies for other types other than <code>Ty</code>/<code>TyData</code>)</p>



<a name="188217275"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188217275" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188217275">(Feb 14 2020 at 15:42)</a>:</h4>
<p>Actually maybe <span class="user-mention" data-user-id="129457">@Florian Diebold</span> might want to chime in here too (or has an opinion), since they do the rust-analyzer related work, I think</p>



<a name="188218469"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188218469" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188218469">(Feb 14 2020 at 15:54)</a>:</h4>
<p>we would also have this problem in RA, yeah, at least until we completely switch to Chalk's type representation. I guess the idea is that the type family is really just interning types, not synthesizing them on the fly. </p>
<blockquote>
<p>have the _data functions take a function that is called with the reference to the TyData</p>
</blockquote>
<p>that seems a bit weird as an API, but I guess it would work. Another alternative might just be returning a <code>Cow</code>...</p>



<a name="188218528"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188218528" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188218528">(Feb 14 2020 at 15:54)</a>:</h4>
<p>on the other hand, if rustc is fine synthesizing <code>TyData</code>s performance-wise, why not just return an owned <code>TyData</code> <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="188218780"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188218780" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188218780">(Feb 14 2020 at 15:56)</a>:</h4>
<p><span class="user-mention silent" data-user-id="129457">Florian Diebold</span> <a href="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/188218469" title="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/188218469">said</a>:</p>
<blockquote>
<p>that seems a bit weird as an API, but I guess it would work. Another alternative might just be returning a <code>Cow</code>...</p>
</blockquote>



<a name="188218786"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188218786" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188218786">(Feb 14 2020 at 15:56)</a>:</h4>
<p>whoops</p>



<a name="188218832"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188218832" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188218832">(Feb 14 2020 at 15:57)</a>:</h4>
<p>not entirely a weird api, it's essentially the same as like tls apis</p>



<a name="188219253"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188219253" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188219253">(Feb 14 2020 at 16:00)</a>:</h4>
<p>maybe I'm just misunderstanding the goal a bit. The current <code>TypeFamily</code> seems to be mostly not super useful unless your <code>InternedTy</code> <em>is</em> <code>TyData</code> (as is the default <code>TypeFamily</code>)</p>



<a name="188219349"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188219349" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188219349">(Feb 14 2020 at 16:01)</a>:</h4>
<p><em>or</em> you store the <code>TyData</code> in your <code>InternedType</code></p>



<a name="188219441"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188219441" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188219441">(Feb 14 2020 at 16:02)</a>:</h4>
<p>I <em>thought</em> it was supposed to act as sort of a "bridge"</p>



<a name="188235125"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188235125" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188235125">(Feb 14 2020 at 18:59)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232957">Jack Huey</span> <a href="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/188212747" title="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/188212747">said</a>:</p>
<blockquote>
<p>So I was thinking, rather than returning a reference, we could have the <code>_data</code> functions take a function that is called with the reference to the <code>TyData</code></p>
</blockquote>
<p>nope :)</p>



<a name="188235131"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188235131" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188235131">(Feb 14 2020 at 19:00)</a>:</h4>
<p>or at least</p>



<a name="188235177"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188235177" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188235177">(Feb 14 2020 at 19:00)</a>:</h4>
<p>it was designed the way it is</p>



<a name="188235189"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188235189" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188235189">(Feb 14 2020 at 19:00)</a>:</h4>
<p>intentionally</p>



<a name="188235225"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188235225" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188235225">(Feb 14 2020 at 19:00)</a>:</h4>
<p>I would prefer that we return references</p>



<a name="188235251"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188235251" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188235251">(Feb 14 2020 at 19:00)</a>:</h4>
<p>(sorry, I hate the way I reply nope without thinking how jerky that sounds ;) please accept my apology!)</p>



<a name="188235259"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188235259" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188235259">(Feb 14 2020 at 19:00)</a>:</h4>
<p>let me back up and enumerate:</p>



<a name="188235289"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188235289" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188235289">(Feb 14 2020 at 19:00)</a>:</h4>
<p>what I had hope to do in the case of <em>rustc</em> was this</p>



<a name="188235350"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188235350" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188235350">(Feb 14 2020 at 19:01)</a>:</h4>
<ul>
<li>for each <code>Ty&lt;'tcx&gt;</code>, we would allocate (in the tcx arena) a <code>&amp;'tcx TyData</code> that we can return</li>
</ul>



<a name="188235364"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188235364" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188235364">(Feb 14 2020 at 19:01)</a>:</h4>
<ul>
<li>we'd probably keep (for now) a cache from one to the other, though we could include a <code>Cell&lt;&gt;</code> in the <code>TyData</code> or something, rather than a separate hashmap</li>
</ul>



<a name="188235382"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188235382" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188235382">(Feb 14 2020 at 19:01)</a>:</h4>
<ul>
<li>cell would be faster, but hashmap would be "zero cost" if chalk is not in use</li>
</ul>



<a name="188235436"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188235436" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188235436">(Feb 14 2020 at 19:02)</a>:</h4>
<p>in the case of <em>rust analyzer</em>, ideally there would be no map at all</p>



<a name="188235441"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188235441" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188235441">(Feb 14 2020 at 19:02)</a>:</h4>
<p>they would just be using chalk's types</p>



<a name="188235449"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188235449" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188235449">(Feb 14 2020 at 19:02)</a>:</h4>
<p>and if that's a problem, then we should see why and adjust chalk's types</p>



<a name="188235453"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188235453" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188235453">(Feb 14 2020 at 19:02)</a>:</h4>
<p>so that it can work</p>



<a name="188235470"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188235470" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188235470">(Feb 14 2020 at 19:02)</a>:</h4>
<p>longer term, I would think rustc would also just be using chalk's types</p>



<a name="188235492"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188235492" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188235492">(Feb 14 2020 at 19:02)</a>:</h4>
<p>I would really prefer not to use <code>Cow</code> or the TLS-style APIs,</p>



<a name="188235503"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188235503" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188235503">(Feb 14 2020 at 19:03)</a>:</h4>
<p>TLS beacuse it'll be annoying as all get out in practice</p>



<a name="188235533"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188235533" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188235533">(Feb 14 2020 at 19:03)</a>:</h4>
<p>Cow because you really don't want to be allocating this data every time anyway I don't think and because it's also kind of complex :)</p>



<a name="188235549"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188235549" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188235549">(Feb 14 2020 at 19:03)</a>:</h4>
<p>Anyway, what do you think about those directions? I could imagine there's a flaw</p>



<a name="188235614"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188235614" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188235614">(Feb 14 2020 at 19:04)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/188235436" title="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/188235436">said</a>:</p>
<blockquote>
<p>in the case of <em>rust analyzer</em>, ideally there would be no map at all</p>
</blockquote>
<p>but I guess <span class="user-mention" data-user-id="129457">@Florian Diebold</span> might be able to tell us how feasible this is :)</p>



<a name="188236474"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188236474" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188236474">(Feb 14 2020 at 19:13)</a>:</h4>
<p>so far it's not been possible because the <code>TypeFamily</code> can't carry any context, I think once that is changed it should be doable. I'm a bit wary about the inference code becoming more verbose, but we'll see</p>



<a name="188236614"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188236614" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188236614">(Feb 14 2020 at 19:14)</a>:</h4>
<p>Interesting!</p>



<a name="188236634"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188236634" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188236634">(Feb 14 2020 at 19:15)</a>:</h4>
<p>One of the things I wanted to mentor for this sprint is adding context to <code>TypeFamily</code></p>



<a name="188236639"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188236639" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188236639">(Feb 14 2020 at 19:15)</a>:</h4>
<p>let's prioritize that</p>



<a name="188236833"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188236833" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188236833">(Feb 14 2020 at 19:17)</a>:</h4>
<p>Interesting</p>



<a name="188237004"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188237004" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188237004">(Feb 14 2020 at 19:19)</a>:</h4>
<p>Thanks for the feedback :)</p>



<a name="188237011"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188237011" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188237011">(Feb 14 2020 at 19:19)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/188236634" title="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/188236634">said</a>:</p>
<blockquote>
<p>One of the things I wanted to mentor for this sprint is adding context to <code>TypeFamily</code></p>
</blockquote>
<p>I'd be interested in working on this if you're looking for a mentee</p>



<a name="188237330"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188237330" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188237330">(Feb 14 2020 at 19:22)</a>:</h4>
<p><span class="user-mention silent" data-user-id="129457">Florian Diebold</span> <a href="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/188236474" title="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/188236474">said</a>:</p>
<blockquote>
<p>so far it's not been possible because the <code>TypeFamily</code> can't carry any context, I think once that is changed it should be doable. I'm a bit wary about the inference code becoming more verbose, but we'll see</p>
</blockquote>
<p>this would also be useful to know</p>



<a name="188237401"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188237401" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188237401">(Feb 14 2020 at 19:22)</a>:</h4>
<p>I do think eventually we should have everyone using a library like chalk-ty to represent their types, so if we can figure out what's the most ergonomic/correct set of variants, would be good</p>



<a name="188237467"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188237467" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188237467">(Feb 14 2020 at 19:23)</a>:</h4>
<p><span class="user-mention" data-user-id="129457">@Florian Diebold</span> are you using the salsa interning mechanism, too?</p>



<a name="188237863"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188237863" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188237863">(Feb 14 2020 at 19:27)</a>:</h4>
<p>yes</p>



<a name="188237990"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188237990" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188237990">(Feb 14 2020 at 19:28)</a>:</h4>
<p>OK, good. Or I mean "bad", in the sense  that it means you also need <code>&amp;self</code> during lookup</p>



<a name="188238000"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188238000" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188238000">(Feb 14 2020 at 19:28)</a>:</h4>
<p>but I think that's the right design anyway</p>



<a name="188238042"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188238042" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188238042">(Feb 14 2020 at 19:29)</a>:</h4>
<p>one thing that might be nice would be having <code>TypeName</code> be an associated type of the <code>TypeFamily</code>, so we can keep it as a richer enum (so we don't need to intern things all the time during inference)</p>



<a name="188238370"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188238370" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188238370">(Feb 14 2020 at 19:32)</a>:</h4>
<p>Yeah, I was debating about whether <code>TypeName</code> should be an associated type or not</p>



<a name="188244316"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188244316" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188244316">(Feb 14 2020 at 20:40)</a>:</h4>
<p>There was another thing I found that I should bring up</p>



<a name="188244377"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188244377" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188244377">(Feb 14 2020 at 20:40)</a>:</h4>
<p>why are all the <code>Interned</code> types required to be <code>Ord</code></p>



<a name="188244415"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188244415" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188244415">(Feb 14 2020 at 20:40)</a>:</h4>
<p>could be no reason :)</p>



<a name="188244427"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188244427" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188244427">(Feb 14 2020 at 20:40)</a>:</h4>
<p>or could be that use <code>BTreeMap</code> in some places for determinism</p>



<a name="188244439"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188244439" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188244439">(Feb 14 2020 at 20:40)</a>:</h4>
<p>we could probably switch to rustc-hash</p>



<a name="188244441"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188244441" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188244441">(Feb 14 2020 at 20:41)</a>:</h4>
<p>if it's the latter</p>



<a name="188244456"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188244456" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188244456">(Feb 14 2020 at 20:41)</a>:</h4>
<p>that didn't used to exist at the time</p>



<a name="188244458"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188244458" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188244458">(Feb 14 2020 at 20:41)</a>:</h4>
<p>I removed <code>Ord</code> on all of them (because rustc)</p>



<a name="188244468"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188244468" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188244468">(Feb 14 2020 at 20:41)</a>:</h4>
<p>seems ok, if it built</p>



<a name="188244469"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188244469" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188244469">(Feb 14 2020 at 20:41)</a>:</h4>
<p>and there was only one <code>BTreeSet</code> use</p>



<a name="188244476"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188244476" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188244476">(Feb 14 2020 at 20:41)</a>:</h4>
<p>for program_clauses</p>



<a name="188244489"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188244489" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188244489">(Feb 14 2020 at 20:41)</a>:</h4>
<p>somewhere related to that</p>



<a name="188244500"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188244500" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188244500">(Feb 14 2020 at 20:41)</a>:</h4>
<p>yeah ok</p>



<a name="188244506"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188244506" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188244506">(Feb 14 2020 at 20:42)</a>:</h4>
<p>I think we could switch to rustc-hash</p>



<a name="188244572"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188244572" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188244572">(Feb 14 2020 at 20:42)</a>:</h4>
<p>I don't think we care <em>what</em> ordering we have, just that it is consistent run to run for the same inputs</p>



<a name="188244583"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188244583" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188244583">(Feb 14 2020 at 20:42)</a>:</h4>
<p>probably</p>



<a name="188244601"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188244601" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188244601">(Feb 14 2020 at 20:42)</a>:</h4>
<p>anyway rustc-hash would be faster!</p>



<a name="188244646"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188244646" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188244646">(Feb 14 2020 at 20:43)</a>:</h4>
<p>I also had to make a bunch of misc. changes like removing <code>extern crate</code>s, <code>HashMap</code> to <code>FxHashMap</code>, <code>Formatter</code> to <code>Formatter&lt;'_&gt;</code></p>



<a name="188244665"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188244665" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188244665">(Feb 14 2020 at 20:43)</a>:</h4>
<p>I'll probably make a PR with just those changes at some point</p>



<a name="188244722"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188244722" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188244722">(Feb 14 2020 at 20:44)</a>:</h4>
<p>Also, if the determinism <em>is</em> important, it's not currently checked by any tests</p>



<a name="188244751"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188244751" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188244751">(Feb 14 2020 at 20:44)</a>:</h4>
<p>it's more that tests didn't work</p>



<a name="188244776"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188244776" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188244776">(Feb 14 2020 at 20:44)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232957">Jack Huey</span> <a href="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/188244646" title="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/188244646">said</a>:</p>
<blockquote>
<p>I also had to make a bunch of misc. changes like removing <code>extern crate</code>s, <code>HashMap</code> to <code>FxHashMap</code>, <code>Formatter</code> to <code>Formatter&lt;'_&gt;</code></p>
</blockquote>
<p>eh? are we not on rust 2018?</p>



<a name="188244793"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188244793" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188244793">(Feb 14 2020 at 20:45)</a>:</h4>
<p>anyway that PR seems good</p>



<a name="188244823"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188244823" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188244823">(Feb 14 2020 at 20:45)</a>:</h4>
<p><code>edition = "2018"</code></p>



<a name="188244851"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188244851" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188244851">(Feb 14 2020 at 20:45)</a>:</h4>
<p>but still <span aria-label="shrug" class="emoji emoji-1f937" role="img" title="shrug">:shrug:</span>‍♂️</p>



<a name="188301511"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188301511" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188301511">(Feb 15 2020 at 22:32)</a>:</h4>
<p>So I realized that not having a <code>interner</code> value passed an argument is <em>not</em> a blocker (necessarily), because we can "get it to work" by using tls</p>



<a name="188301575"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188301575" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188301575">(Feb 15 2020 at 22:34)</a>:</h4>
<p>that being said, I've actually got the skeleton of chalk-solve/chalk-ir set up</p>



<a name="188301584"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188301584" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188301584">(Feb 15 2020 at 22:34)</a>:</h4>
<p>everything in <code>RustIrDatabase</code> is <code>unimplemented!()</code></p>



<a name="188301586"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188301586" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188301586">(Feb 15 2020 at 22:34)</a>:</h4>
<p>and everything in <code>Interner</code> essentially just matched the default</p>



<a name="188301588"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188301588" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188301588">(Feb 15 2020 at 22:34)</a>:</h4>
<p>but getting there</p>



<a name="188308006"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188308006" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188308006">(Feb 16 2020 at 02:02)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232957">Jack Huey</span> <a href="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/188301511" title="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/188301511">said</a>:</p>
<blockquote>
<p>So I realized that not having a <code>interner</code> value passed an argument is <em>not</em> a blocker (necessarily), because we can "get it to work" by using tls</p>
</blockquote>
<p><span aria-label="face palm" class="emoji emoji-1f926" role="img" title="face palm">:face_palm:</span>‍♂️nevermind this</p>



<a name="188504054"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188504054" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188504054">(Feb 19 2020 at 00:00)</a>:</h4>
<p>Ok so I have integrated chalk-solve/chalk-ir into rustc <em>just enough</em> to be able to lower the most basic rustc goal and some traits/structs/impls</p>



<a name="188504060"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188504060" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188504060">(Feb 19 2020 at 00:00)</a>:</h4>
<p><em>but</em> it's not right</p>



<a name="188504087"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188504087" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188504087">(Feb 19 2020 at 00:00)</a>:</h4>
<p>and I'm doing something <em>very</em> unsafe in order to be able to actually intern types</p>



<a name="188504113"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188504113" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188504113">(Feb 19 2020 at 00:01)</a>:</h4>
<p>(using tls <code>TyCtxt</code> and transmuting lifetime)</p>



<a name="188504123"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188504123" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188504123">(Feb 19 2020 at 00:01)</a>:</h4>
<p>so it's not actually <em>correct</em></p>



<a name="188504178"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188504178" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188504178">(Feb 19 2020 at 00:02)</a>:</h4>
<p>but theoretically, that should be a local fix once <span class="user-mention" data-user-id="220273">@Jane Lusby</span>'s changes get merged</p>



<a name="188504203"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188504203" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188504203">(Feb 19 2020 at 00:02)</a>:</h4>
<p>in the meantime, I gotta figure out why the simple query I am doing is failing</p>



<a name="188504205"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188504205" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188504205">(Feb 19 2020 at 00:02)</a>:</h4>
<p>soon <span aria-label="tm" class="emoji emoji-2122" role="img" title="tm">:tm:</span></p>



<a name="188504223"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188504223" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188504223">(Feb 19 2020 at 00:03)</a>:</h4>
<p>somewhere, a <code>TraitRef</code> is getting created with an empty substitution</p>



<a name="188504249"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188504249" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188504249">(Feb 19 2020 at 00:03)</a>:</h4>
<p>but I don't <em>think</em> it's because of how I'm lowering to <code>TraitRef</code>s directly. I think it has to do with the <code>Binder</code>s</p>



<a name="188884792"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188884792" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188884792">(Feb 23 2020 at 21:16)</a>:</h4>
<p><a href="https://github.com/rust-lang/chalk/pull/332" target="_blank" title="https://github.com/rust-lang/chalk/pull/332">https://github.com/rust-lang/chalk/pull/332</a> and <a href="https://github.com/rust-lang/rust/pull/69406" target="_blank" title="https://github.com/rust-lang/rust/pull/69406">https://github.com/rust-lang/rust/pull/69406</a></p>



<a name="188950210"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188950210" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188950210">(Feb 24 2020 at 18:04)</a>:</h4>
<p><span class="user-mention" data-user-id="232957">@Jack Huey</span> nice, will take a look, I have a question --</p>



<a name="188950223"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188950223" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188950223">(Feb 24 2020 at 18:04)</a>:</h4>
<p>there was this PR about removing the existing integration</p>



<a name="188950236"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188950236" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188950236">(Feb 24 2020 at 18:05)</a>:</h4>
<p>I have to look it over but I was thinking of merging it, just to undo the old dependency</p>



<a name="188950238"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188950238" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188950238">(Feb 24 2020 at 18:05)</a>:</h4>
<p>do you think that would make this PR harder?</p>



<a name="188950252"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188950252" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188950252">(Feb 24 2020 at 18:05)</a>:</h4>
<p>seems like "probably not"</p>



<a name="188951489"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188951489" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188951489">(Feb 24 2020 at 18:20)</a>:</h4>
<p>So, in some ways, <em>yes</em></p>



<a name="188951515"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188951515" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188951515">(Feb 24 2020 at 18:21)</a>:</h4>
<p>because that PR also removes all the infrastructure for <code>-Z chalk</code></p>



<a name="188951625"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188951625" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188951625">(Feb 24 2020 at 18:22)</a>:</h4>
<p>and there are some places like here <a href="https://github.com/rust-lang/rust/pull/69247/files#diff-f485b4e6b0c24b409813516a33e7083aL360" target="_blank" title="https://github.com/rust-lang/rust/pull/69247/files#diff-f485b4e6b0c24b409813516a33e7083aL360">https://github.com/rust-lang/rust/pull/69247/files#diff-f485b4e6b0c24b409813516a33e7083aL360</a> that are doing something special for Chalk (unsure exactly why)</p>



<a name="188951661"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188951661" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188951661">(Feb 24 2020 at 18:23)</a>:</h4>
<p>that's not to say I can't <em>revert</em> that PR as my first commit in my PR</p>



<a name="188951679"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188951679" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188951679">(Feb 24 2020 at 18:23)</a>:</h4>
<p>(since a good chunk of that code does get removed/changed anyways)</p>



<a name="188958798"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188958798" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188958798">(Feb 24 2020 at 19:42)</a>:</h4>
<p>OK, that PR perhaps goes a bit too far then</p>



<a name="188973905"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188973905" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188973905">(Feb 24 2020 at 22:38)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> you around?</p>



<a name="188973939"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188973939" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188973939">(Feb 24 2020 at 22:38)</a>:</h4>
<p>question about rustc I think</p>



<a name="188973968"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188973968" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188973968">(Feb 24 2020 at 22:39)</a>:</h4>
<p>related to <a href="https://github.com/rust-lang/chalk/issues/261" target="_blank" title="https://github.com/rust-lang/chalk/issues/261">https://github.com/rust-lang/chalk/issues/261</a></p>



<a name="188974045"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188974045" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188974045">(Feb 24 2020 at 22:40)</a>:</h4>
<p>do you know what the best way to generate these clauses are?</p>



<a name="188974659"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188974659" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188974659">(Feb 24 2020 at 22:49)</a>:</h4>
<p>well</p>



<a name="188974675"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188974675" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188974675">(Feb 24 2020 at 22:49)</a>:</h4>
<p>Sized is maybe the trickiest to start with</p>



<a name="188974686"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188974686" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188974686">(Feb 24 2020 at 22:49)</a>:</h4>
<p>I realize now</p>



<a name="188974696"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188974696" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188974696">(Feb 24 2020 at 22:49)</a>:</h4>
<p>or, maybe not</p>



<a name="188974703"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188974703" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188974703">(Feb 24 2020 at 22:49)</a>:</h4>
<p>there is some specialized code in rustc to handle Sized</p>



<a name="188974707"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188974707" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188974707">(Feb 24 2020 at 22:49)</a>:</h4>
<p>but I think it's primarily done that way for efficiency</p>



<a name="188974723"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188974723" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188974723">(Feb 24 2020 at 22:50)</a>:</h4>
<p>/me thinks</p>



<a name="188974774"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188974774" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188974774">(Feb 24 2020 at 22:50)</a>:</h4>
<p>the short version is that there will be some custom code in chalk-solve I think</p>



<a name="188974778"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188974778" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188974778">(Feb 24 2020 at 22:50)</a>:</h4>
<p>that looks at the "Self type" and generates some clauses</p>



<a name="188974812"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188974812" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188974812">(Feb 24 2020 at 22:51)</a>:</h4>
<p>in the case of <code>SomeStruct: Sized</code> (i.e., where self-type is a struct type) we would want to check that the fields are <code>Sized</code> -- in fact, the <em>actual</em> rules are that only the <em>final field</em> can be unsized I think, so that's really the only type you have to check</p>



<a name="188974829"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188974829" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188974829">(Feb 24 2020 at 22:51)</a>:</h4>
<p>it might be easier to start with some of the other well-known traits, e.g. <code>Clone</code></p>



<a name="188974848"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188974848" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188974848">(Feb 24 2020 at 22:51)</a>:</h4>
<p><code>Clone</code> is interesting in that it has a mix of user-given impls and -- for some types, like closures -- we auto-generate impls</p>



<a name="188974857"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188974857" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188974857">(Feb 24 2020 at 22:51)</a>:</h4>
<p>the current chalk-ir doesn't recognize those distinctions I guess</p>



<a name="188974928"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188974928" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188974928">(Feb 24 2020 at 22:52)</a>:</h4>
<p>So, for reference, I'm trying to get the most basic possible program to compile successfully</p>



<a name="188974929"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188974929" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188974929">(Feb 24 2020 at 22:52)</a>:</h4>
<p>we should make a list of all the built-in traits that are required and start to list them out with some notes on what their impls are</p>



<a name="188974941"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188974941" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188974941">(Feb 24 2020 at 22:52)</a>:</h4>
<div class="codehilite"><pre><span></span>trait Foo {}

struct Bar {}

impl Foo for Bar {}

fn main() -&gt; () {
}
</pre></div>



<a name="188974942"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188974942" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188974942">(Feb 24 2020 at 22:52)</a>:</h4>
<p>ah, ok, and you're hitting the need for <code>Sized</code> specifically I guess</p>



<a name="188974947"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188974947" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188974947">(Feb 24 2020 at 22:52)</a>:</h4>
<p>exactly</p>



<a name="188974967"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188974967" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188974967">(Feb 24 2020 at 22:52)</a>:</h4>
<p>well basically the rule would be that, for a struct type, all the fields must be sized</p>



<a name="188974971"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188974971" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188974971">(Feb 24 2020 at 22:52)</a>:</h4>
<p>BUT, <code>unimplemented!()</code>s get called</p>



<a name="188974973"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188974973" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188974973">(Feb 24 2020 at 22:52)</a>:</h4>
<p>that's more than you need but it's ok</p>



<a name="188974987"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188974987" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188974987">(Feb 24 2020 at 22:53)</a>:</h4>
<p>good starting point</p>



<a name="188974991"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188974991" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188974991">(Feb 24 2020 at 22:53)</a>:</h4>
<p>I mean, there is <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc/ty/struct.TyS.html#method.is_sized" target="_blank" title="https://doc.rust-lang.org/nightly/nightly-rustc/rustc/ty/struct.TyS.html#method.is_sized">https://doc.rust-lang.org/nightly/nightly-rustc/rustc/ty/struct.TyS.html#method.is_sized</a></p>



<a name="188975009"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188975009" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188975009">(Feb 24 2020 at 22:53)</a>:</h4>
<p>I don't know if I can use that</p>



<a name="188975036"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188975036" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188975036">(Feb 24 2020 at 22:53)</a>:</h4>
<p>The problem right now, is I assume I would have to return that impl in <code>impls_for_trait</code></p>



<a name="188975095"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188975095" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188975095">(Feb 24 2020 at 22:54)</a>:</h4>
<p>but, then I would have to return all impls for <code>Sized</code></p>



<a name="188975183"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188975183" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188975183">(Feb 24 2020 at 22:55)</a>:</h4>
<p>I guess <code>Sized</code> is an auto trait?</p>



<a name="188976948"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188976948" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188976948">(Feb 24 2020 at 23:19)</a>:</h4>
<p>Well, not exactly</p>



<a name="188976961"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188976961" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188976961">(Feb 24 2020 at 23:20)</a>:</h4>
<p>but that <em>scheme</em> seems to work here</p>



<a name="188977034"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188977034" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188977034">(Feb 24 2020 at 23:20)</a>:</h4>
<p>since, chalk-solve calls <code>impl_provided_for</code> for auto traits</p>



<a name="188977485"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188977485" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188977485">(Feb 24 2020 at 23:27)</a>:</h4>
<p>Sized is <em>special</em></p>



<a name="188977742"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188977742" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188977742">(Feb 24 2020 at 23:31)</a>:</h4>
<p>This makes me think. Maybe <code>chalk-ir</code> needs a bit of refining in regards to auto traits. They really represent a couple things right now: coinductive (which is a separate flag too), non_enumerable (also a separate flag too), and this "late implementations" (similar to the idea of non-enumerability, but we can generate a <em>single</em> clause given a struct via <code>impl_provided_for</code>)</p>



<a name="188977813"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188977813" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188977813">(Feb 24 2020 at 23:32)</a>:</h4>
<p>So, maybe "auto trait" in chalk-ir should also should only mean that bit (renamed maybe too). And both actual auto traits and <code>Sized</code> would have that flag</p>



<a name="188977827"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188977827" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188977827">(Feb 24 2020 at 23:33)</a>:</h4>
<p>I actually don't think <code>Clone</code> is that special tbh</p>



<a name="188979501"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188979501" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188979501">(Feb 25 2020 at 00:01)</a>:</h4>
<p>ok so I (with tons of hacks) got all of the goals from the basic test to return a Unique Solution.</p>



<a name="188979551"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188979551" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188979551">(Feb 25 2020 at 00:02)</a>:</h4>
<p>And I <em>expected</em> that to cause the test to pass</p>



<a name="188979555"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188979555" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188979555">(Feb 25 2020 at 00:02)</a>:</h4>
<p>But it still fails</p>



<a name="188979565"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188979565" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188979565">(Feb 25 2020 at 00:02)</a>:</h4>
<p>But I don't get any info why</p>



<a name="188979568"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188979568" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188979568">(Feb 25 2020 at 00:02)</a>:</h4>
<p><span aria-label="shrug" class="emoji emoji-1f937" role="img" title="shrug">:shrug:</span>‍♂️</p>



<a name="188979669"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188979669" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188979669">(Feb 25 2020 at 00:04)</a>:</h4>
<p>So, I'm probably lowering something as a struct or something where it should be variable</p>



<a name="188979866"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188979866" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188979866">(Feb 25 2020 at 00:07)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232957">Jack Huey</span> <a href="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/188977742" title="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/188977742">said</a>:</p>
<blockquote>
<p>but we can generate a <em>single</em> clause given a struct via <code>impl_provided_for</code>)</p>
</blockquote>
<p>Also, I realized this isn't correct. We generate the impl if this is false</p>



<a name="188980076"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188980076" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188980076">(Feb 25 2020 at 00:11)</a>:</h4>
<p>oh haha</p>



<a name="188980080"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188980080" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188980080">(Feb 25 2020 at 00:11)</a>:</h4>
<p>I had to --bless the test <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="188980138"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188980138" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188980138">(Feb 25 2020 at 00:12)</a>:</h4>
<p>That means....first passing test with Chalk reintegration</p>



<a name="188980153"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188980153" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188980153">(Feb 25 2020 at 00:12)</a>:</h4>
<p>(don't pay attention to the terrible hacks done to get this specific test to pass)</p>



<a name="188980247"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188980247" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188980247">(Feb 25 2020 at 00:14)</a>:</h4>
<p><a href="/user_uploads/4715/jx4_fXebMPk9knGE8qZYPLQS/image.png" target="_blank" title="image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/jx4_fXebMPk9knGE8qZYPLQS/image.png" target="_blank" title="image.png"><img src="/user_uploads/4715/jx4_fXebMPk9knGE8qZYPLQS/image.png"></a></div>



<a name="188980257"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188980257" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188980257">(Feb 25 2020 at 00:14)</a>:</h4>
<p>wait...</p>



<a name="188980299"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/188980299" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#188980299">(Feb 25 2020 at 00:15)</a>:</h4>
<p><a href="/user_uploads/4715/rD1xn-RJzlG7VxU3C3e3nawT/image.png" target="_blank" title="image.png">image.png</a> it was because it had already ran/passed</p>
<div class="message_inline_image"><a href="/user_uploads/4715/rD1xn-RJzlG7VxU3C3e3nawT/image.png" target="_blank" title="image.png"><img src="/user_uploads/4715/rD1xn-RJzlG7VxU3C3e3nawT/image.png"></a></div>



<a name="189051433"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189051433" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189051433">(Feb 25 2020 at 19:21)</a>:</h4>
<p>auto-trait is a completely distinct thing from <code>Sized</code>, imo</p>



<a name="189051474"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189051474" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189051474">(Feb 25 2020 at 19:22)</a>:</h4>
<p>there are some vague similarities but</p>



<a name="189051493"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189051493" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189051493">(Feb 25 2020 at 19:22)</a>:</h4>
<p>what I mean is</p>



<a name="189051506"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189051506" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189051506">(Feb 25 2020 at 19:22)</a>:</h4>
<p>it's true that the most naive rule for <code>Sized</code> is to generate a similar predicate for all field types</p>



<a name="189051512"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189051512" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189051512">(Feb 25 2020 at 19:22)</a>:</h4>
<p>but rustc uses a rather different rule</p>



<a name="189051515"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189051515" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189051515">(Feb 25 2020 at 19:22)</a>:</h4>
<p>(that is significantly more efficient)</p>



<a name="189051521"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189051521" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189051521">(Feb 25 2020 at 19:22)</a>:</h4>
<p>and I expect we will ultimately want that</p>



<a name="189051569"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189051569" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189051569">(Feb 25 2020 at 19:23)</a>:</h4>
<p>side note: do you think <span class="user-mention" data-user-id="232957">@Jack Huey</span> that I should merge your PR that upgrades chalk into rustc, as opposed to the PR that is trying to <em>remove</em> support?</p>



<a name="189051574"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189051574" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189051574">(Feb 25 2020 at 19:23)</a>:</h4>
<p>(I didn't catch up on all your comments above yet)</p>



<a name="189051821"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189051821" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189051821">(Feb 25 2020 at 19:26)</a>:</h4>
<p>We can talk more about Sized during design meeting.</p>



<a name="189051889"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189051889" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189051889">(Feb 25 2020 at 19:26)</a>:</h4>
<p>And I think if we can get the upgrade PR to a place that it can be merged, it would just be easier to merge that</p>



<a name="189057084"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189057084" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189057084">(Feb 25 2020 at 20:21)</a>:</h4>
<p>OK</p>



<a name="189073857"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189073857" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189073857">(Feb 25 2020 at 23:57)</a>:</h4>
<p>Another thing to think about, because I'm unsure, is how do we handle <code>Predicate::RegionOutlives</code> and <code>Predicate::TypeOutlives</code></p>



<a name="189123490"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189123490" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189123490">(Feb 26 2020 at 15:19)</a>:</h4>
<p>for now you should just ignore them :) but we should add that to our list of things to work out</p>



<a name="189138332"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189138332" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189138332">(Feb 26 2020 at 17:46)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> another question if you're around</p>



<a name="189138386"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189138386" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189138386">(Feb 26 2020 at 17:47)</a>:</h4>
<p>how do I best translate a <code>PolyTraitPredicate</code> into a <code>WhereClause</code>?</p>



<a name="189138579"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189138579" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189138579">(Feb 26 2020 at 17:49)</a>:</h4>
<p>For example, <code>Binder(TraitPredicate(&lt;P as std::ops::FnMut&lt;(&amp;T,)&gt;&gt;))</code></p>



<a name="189226459"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189226459" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189226459">(Feb 27 2020 at 15:58)</a>:</h4>
<p>heh this is one of the things I want to refactor</p>



<a name="189226466"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189226466" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189226466">(Feb 27 2020 at 15:58)</a>:</h4>
<p>(on the rustc side)</p>



<a name="189226480"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189226480" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189226480">(Feb 27 2020 at 15:58)</a>:</h4>
<p>but basically that would be converted to multiple where clauses</p>



<a name="189226551"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189226551" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189226551">(Feb 27 2020 at 15:59)</a>:</h4>
<p>actually, are you sure you want to return a <code>WhereClause</code>?</p>



<a name="189226562"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189226562" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189226562">(Feb 27 2020 at 15:59)</a>:</h4>
<p>(vs a <code>Goal</code> or <code>Clause</code>?)</p>



<a name="189226567"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189226567" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189226567">(Feb 27 2020 at 15:59)</a>:</h4>
<p>if so, that seems like a problem =)</p>



<a name="189227704"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189227704" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189227704">(Feb 27 2020 at 16:10)</a>:</h4>
<p>So, this is in <code>impl_datum</code></p>



<a name="189227731"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189227731" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189227731">(Feb 27 2020 at 16:11)</a>:</h4>
<p>so, need to return <code>QuantifiedWhereClause</code></p>



<a name="189227763"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189227763" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189227763">(Feb 27 2020 at 16:11)</a>:</h4>
<p>so...kind of just answered my own question</p>



<a name="189372906"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189372906" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189372906">(Feb 29 2020 at 03:24)</a>:</h4>
<p>Ok yeah, I definitely think that I this is the PR is sort of in a place that I need some kind of review to be able to tell what I'm doing wrong</p>



<a name="189372909"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189372909" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189372909">(Feb 29 2020 at 03:24)</a>:</h4>
<p>but I should maybe clean things up a bit</p>



<a name="189523876"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189523876" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189523876">(Mar 02 2020 at 19:01)</a>:</h4>
<p><span class="user-mention" data-user-id="232957">@Jack Huey</span> so regarding <a href="https://github.com/rust-lang/rust/pull/69247/" target="_blank" title="https://github.com/rust-lang/rust/pull/69247/">https://github.com/rust-lang/rust/pull/69247/</a> --</p>



<a name="189523891"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189523891" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189523891">(Mar 02 2020 at 19:01)</a>:</h4>
<p>you felt like you wouldn't be able to "just revert"</p>



<a name="189523897"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189523897" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189523897">(Mar 02 2020 at 19:01)</a>:</h4>
<p>if we tried to land it first</p>



<a name="189523911"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189523911" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189523911">(Mar 02 2020 at 19:01)</a>:</h4>
<p>I see that it removes e.g. the <code>-Zchalk</code> option etc</p>



<a name="189524291"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189524291" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189524291">(Mar 02 2020 at 19:05)</a>:</h4>
<p>but I'm not quite sure why it can't be reverted</p>



<a name="189526355"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189526355" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189526355">(Mar 02 2020 at 19:24)</a>:</h4>
<p>no no, I said I <em>can</em> revert it :)</p>



<a name="189531604"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189531604" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189531604">(Mar 02 2020 at 20:15)</a>:</h4>
<p>oh, I misunderstood then :)</p>



<a name="189531631"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189531631" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189531631">(Mar 02 2020 at 20:15)</a>:</h4>
<p><span class="user-mention" data-user-id="232957">@Jack Huey</span> I was more-or-less expecting that we would land it and just revert it and build on that revert (and then perhaps flatten those first few commits)</p>



<a name="189531641"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189531641" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189531641">(Mar 02 2020 at 20:15)</a>:</h4>
<p>"seems ok"</p>



<a name="189532087"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189532087" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189532087">(Mar 02 2020 at 20:20)</a>:</h4>
<p>that works for me</p>



<a name="189544052"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189544052" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189544052">(Mar 02 2020 at 22:20)</a>:</h4>
<p><code>pub trait Interner: Debug + Copy + Eq + Ord + Hash</code></p>



<a name="189544059"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189544059" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189544059">(Mar 02 2020 at 22:20)</a>:</h4>
<p>it really shouldn't need those bounds</p>



<a name="189544109"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189544109" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189544109">(Mar 02 2020 at 22:21)</a>:</h4>
<p>(and if we're gonna store a <code>&amp;'tcx TyCtxt</code> in <code>RustInterner</code>, we can't have them)</p>



<a name="189544210"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189544210" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189544210">(Mar 02 2020 at 22:22)</a>:</h4>
<p>But then in places like <code>chalk-solve</code>, when making the <code>Graph&lt;ImplId&lt;I&gt;, ()&gt;</code>, you can't unless <code>I: Ord</code></p>



<a name="189544262"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189544262" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189544262">(Mar 02 2020 at 22:23)</a>:</h4>
<p>probably because those use <code>derive(Ord)</code></p>



<a name="189545615"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189545615" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189545615">(Mar 02 2020 at 22:42)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232957">Jack Huey</span> <a href="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/189544052" title="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/189544052">said</a>:</p>
<blockquote>
<p><code>pub trait Interner: Debug + Copy + Eq + Ord + Hash</code></p>
</blockquote>
<p>oh but it's so convenient :)</p>



<a name="189545619"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189545619" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189545619">(Mar 02 2020 at 22:42)</a>:</h4>
<p>we can have them</p>



<a name="189545626"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189545626" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189545626">(Mar 02 2020 at 22:42)</a>:</h4>
<p><code>eq</code> can just always be false or something</p>



<a name="189545647"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189545647" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189545647">(Mar 02 2020 at 22:42)</a>:</h4>
<p>or always true :)</p>



<a name="189545666"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189545666" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189545666">(Mar 02 2020 at 22:43)</a>:</h4>
<p>but maybe that's too hacky</p>



<a name="189545675"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189545675" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189545675">(Mar 02 2020 at 22:43)</a>:</h4>
<p>well, it does't have to be that, it can use ptr comparison or something</p>



<a name="189545744"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189545744" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189545744">(Mar 02 2020 at 22:44)</a>:</h4>
<p>yeah, I almost want to just keep those because not adding those spreads so fast</p>



<a name="189606418"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189606418" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189606418">(Mar 03 2020 at 16:01)</a>:</h4>
<p>"just keep those" = "keep Debug +C opy + Eq + Org + HAsh"?</p>



<a name="189606426"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189606426" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189606426">(Mar 03 2020 at 16:01)</a>:</h4>
<p>I definitely want to keep them :)</p>



<a name="189606441"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189606441" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189606441">(Mar 03 2020 at 16:02)</a>:</h4>
<p>being able to use <code>#[derive]</code> is a big win</p>



<a name="189606508"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189606508" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189606508">(Mar 03 2020 at 16:02)</a>:</h4>
<p>and I don't think there's a real problem caused by those bounds</p>



<a name="189606516"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189606516" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189606516">(Mar 03 2020 at 16:02)</a>:</h4>
<p>we have to add a few impls, seems ok</p>



<a name="189606528"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189606528" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189606528">(Mar 03 2020 at 16:02)</a>:</h4>
<p>honestly, those impls can even <code>panic!</code></p>



<a name="189606530"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189606530" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189606530">(Mar 03 2020 at 16:02)</a>:</h4>
<p>who cares</p>



<a name="189607090"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189607090" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189607090">(Mar 03 2020 at 16:07)</a>:</h4>
<p>That's actually a good compromise, to make the impls panic</p>



<a name="189639517"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189639517" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189639517">(Mar 03 2020 at 22:02)</a>:</h4>
<p>so <span class="user-mention" data-user-id="232957">@Jack Huey</span> -- Friday -- are you flexible as for times?</p>



<a name="189639587"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189639587" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189639587">(Mar 03 2020 at 22:03)</a>:</h4>
<p>I'm working out a few things</p>



<a name="189639596"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189639596" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189639596">(Mar 03 2020 at 22:03)</a>:</h4>
<p>I'm flexible</p>



<a name="189639602"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189639602" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189639602">(Mar 03 2020 at 22:03)</a>:</h4>
<p>I have to stop early this particular Friday because of childcare duties, but I suspect something like 9am would work well</p>



<a name="189639620"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189639620" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189639620">(Mar 03 2020 at 22:04)</a>:</h4>
<p>Also good for other days, but I know you're carving out time on Friday</p>



<a name="189639646"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189639646" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189639646">(Mar 03 2020 at 22:04)</a>:</h4>
<p>actually let's ust say that</p>



<a name="189639654"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189639654" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189639654">(Mar 03 2020 at 22:04)</a>:</h4>
<p>hmm ok I might be able to ping you earlier :)</p>



<a name="189639675"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189639675" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189639675">(Mar 03 2020 at 22:04)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/189639602" title="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/189639602">said</a>:</p>
<blockquote>
<p>I have to stop early this particular Friday because of childcare duties, but I suspect something like 9am would work well</p>
</blockquote>
<p>or is that too early for you :)</p>



<a name="189639676"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189639676" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189639676">(Mar 03 2020 at 22:04)</a>:</h4>
<p>Okay, let's plan for Friday 9am</p>



<a name="189639683"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189639683" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189639683">(Mar 03 2020 at 22:04)</a>:</h4>
<p>and earlier if you need</p>



<a name="189639700"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189639700" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189639700">(Mar 03 2020 at 22:04)</a>:</h4>
<p>(9 am is early, but it's okay)</p>



<a name="189748244"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189748244" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189748244">(Mar 04 2020 at 23:48)</a>:</h4>
<p>So next thing I'm finding is that I think the <code>WellFormed</code> clauses for <code>TyData::Function</code> are wrong</p>



<a name="189748367"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189748367" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189748367">(Mar 04 2020 at 23:50)</a>:</h4>
<p>chalk-solve currently just gives the program clauses for each of the parameter types</p>



<a name="189809815"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189809815" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189809815">(Mar 05 2020 at 16:33)</a>:</h4>
<p>Another thing that I think might be wrong:</p>



<a name="189809864"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189809864" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189809864">(Mar 05 2020 at 16:34)</a>:</h4>
<p>So, there is a portion of the <code>builtin-copy-clone.rs</code> test:</p>



<a name="189809924"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189809924" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189809924">(Mar 05 2020 at 16:34)</a>:</h4>
<div class="codehilite"><pre><span></span>fn test_copy&lt;T: Copy&gt;(arg: T) {
    let _ = arg;
    let _ = arg;
}
</pre></div>



<a name="189809987"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189809987" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189809987">(Mar 05 2020 at 16:34)</a>:</h4>
<p>And rustc generates a goal <code>Implemented(T: Clone)</code></p>



<a name="189810012"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189810012" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189810012">(Mar 05 2020 at 16:35)</a>:</h4>
<p>With <code>T: Copy</code> in the environment</p>



<a name="189810037"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189810037" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189810037">(Mar 05 2020 at 16:35)</a>:</h4>
<p>and of course <code>Copy: Clone</code></p>



<a name="189810091"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189810091" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189810091">(Mar 05 2020 at 16:35)</a>:</h4>
<p>So a clause gets generated <code>FromEnv(T: Clone) :- FromEnv(T: Copy)</code></p>



<a name="189810272"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189810272" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189810272">(Mar 05 2020 at 16:37)</a>:</h4>
<p>(one sec, looking so I can paste/confirm)</p>



<a name="189810433"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189810433" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189810433">(Mar 05 2020 at 16:38)</a>:</h4>
<p><code>: : : | pushed clause Some(for&lt;type, lifetime&gt; FromEnv(StructId(Param(Self/#0)): TraitId(Trait(DefId(2:1593 ~ core[8350]::clone[0]::Clone[0])))) :- FromEnv(^0: TraitId(Trait(DefId(2:1893 ~ core[8350]::marker[0]::Copy[0])))))</code></p>



<a name="189810490"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189810490" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189810490">(Mar 05 2020 at 16:39)</a>:</h4>
<p>Well that's not right...that's <code>FromEnv(Self: Clone) :- FromEnv(Self: Copy)</code></p>



<a name="189810615"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189810615" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189810615">(Mar 05 2020 at 16:40)</a>:</h4>
<p>ok so I might be lowering that wrong</p>



<a name="189847624"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189847624" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189847624">(Mar 05 2020 at 23:14)</a>:</h4>
<p>I was indeed lowering wrong. <code>Self</code> really should have been a <code>BoundVar</code>. Now it's hackily (is that a word) fixed</p>



<a name="189847658"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189847658" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189847658">(Mar 05 2020 at 23:14)</a>:</h4>
<p>Next thing: checking if <code>chalk_ir::Fn</code> is <code>Sized</code></p>



<a name="189847689"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189847689" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189847689">(Mar 05 2020 at 23:15)</a>:</h4>
<p>I feel like this is where my auto-trait hijacking is gonna break down</p>



<a name="189892474"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189892474" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189892474">(Mar 06 2020 at 13:33)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> if you're around, I am too</p>



<a name="189893373"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189893373" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189893373">(Mar 06 2020 at 13:45)</a>:</h4>
<p><span class="user-mention" data-user-id="232957">@Jack Huey</span> here now</p>



<a name="189893436"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189893436" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189893436">(Mar 06 2020 at 13:46)</a>:</h4>
<p>Have you had a chance to at least briefly skim over the PR?</p>



<a name="189893487"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189893487" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189893487">(Mar 06 2020 at 13:47)</a>:</h4>
<p>nope, let me do that now</p>



<a name="189893540"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189893540" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189893540">(Mar 06 2020 at 13:47)</a>:</h4>
<p>yeah, that would probably be best. Because I'm sure there are things I am doing wrong</p>



<a name="189894413"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189894413" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189894413">(Mar 06 2020 at 13:57)</a>:</h4>
<p>there's a lot  here :)</p>



<a name="189894458"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189894458" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189894458">(Mar 06 2020 at 13:58)</a>:</h4>
<p>(duh)</p>



<a name="189894464"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189894464" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189894464">(Mar 06 2020 at 13:58)</a>:</h4>
<p>(hopefully that's good?)</p>



<a name="189894473"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189894473" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189894473">(Mar 06 2020 at 13:58)</a>:</h4>
<p>I guess a few fundamental things to point out/talk about:</p>



<a name="189894477"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189894477" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189894477">(Mar 06 2020 at 13:58)</a>:</h4>
<ul>
<li><code>Interned</code></li>
</ul>



<a name="189894484"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189894484" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189894484">(Mar 06 2020 at 13:58)</a>:</h4>
<p>it's just taking me some time to get a sense for it</p>



<a name="189894520"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189894520" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189894520">(Mar 06 2020 at 13:58)</a>:</h4>
<p>(going through and adding a couple things to that list)</p>



<a name="189894527"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189894527" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189894527">(Mar 06 2020 at 13:59)</a>:</h4>
<p>many parts are what I expected :)</p>



<a name="189894574"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189894574" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189894574">(Mar 06 2020 at 13:59)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232957">Jack Huey</span> <a href="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/189894464" title="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/189894464">said</a>:</p>
<blockquote>
<p>(hopefully that's good?)</p>
</blockquote>
<p>to be clear, yes, good :)</p>



<a name="189894590"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189894590" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189894590">(Mar 06 2020 at 13:59)</a>:</h4>
<p>I'm mostly looking for difficulties I didn't expect</p>



<a name="189894636"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189894636" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189894636">(Mar 06 2020 at 14:00)</a>:</h4>
<ul>
<li>What to do about <code>const</code></li>
</ul>



<a name="189894659"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189894659" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189894659">(Mar 06 2020 at 14:00)</a>:</h4>
<p>I thought I would start with the code that converts rust types into chalk types (similar goals etc)</p>



<a name="189894672"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189894672" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189894672">(Mar 06 2020 at 14:00)</a>:</h4>
<p>that works too :)</p>



<a name="189894674"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189894674" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189894674">(Mar 06 2020 at 14:00)</a>:</h4>
<p>I gather that's the <code>lower_into</code> fns</p>



<a name="189894697"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189894697" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189894697">(Mar 06 2020 at 14:00)</a>:</h4>
<p>yes</p>



<a name="189894700"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189894700" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189894700">(Mar 06 2020 at 14:00)</a>:</h4>
<p>well, that plus the <code>RustIrDatabase</code> impl</p>



<a name="189894710"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189894710" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189894710">(Mar 06 2020 at 14:00)</a>:</h4>
<p>Yeah, it's a <em>bit</em> scattered right now</p>



<a name="189894734"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189894734" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189894734">(Mar 06 2020 at 14:01)</a>:</h4>
<p>(it was worse initially, but I've consolidated somewhat into <code>lower_into</code>s)</p>



<a name="189894772"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189894772" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189894772">(Mar 06 2020 at 14:01)</a>:</h4>
<p>we talked a bit about the <code>RustDefId</code> enum</p>



<a name="189894773"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189894773" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189894773">(Mar 06 2020 at 14:01)</a>:</h4>
<ul>
<li>What is the difference between <code>CanonicalVarKind::Placeholder*</code> and <code>CanonicalVarKind::*</code></li>
</ul>



<a name="189894906"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189894906" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189894906">(Mar 06 2020 at 14:03)</a>:</h4>
<ul>
<li>For <code>Params</code>, do those always gets substituted for <code>Parameter</code>/<code>BoundVar</code>?</li>
</ul>



<a name="189894929"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189894929" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189894929">(Mar 06 2020 at 14:03)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232957">Jack Huey</span> <a href="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/189894636" title="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/189894636">said</a>:</p>
<blockquote>
<ul>
<li>What to do about <code>const</code></li>
</ul>
</blockquote>
<p>I expected to panic for now :)</p>



<a name="189895011"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189895011" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189895011">(Mar 06 2020 at 14:04)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232957">Jack Huey</span> <a href="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/189894906" title="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/189894906">said</a>:</p>
<blockquote>
<ul>
<li>For <code>Params</code>, do those always gets substituted for <code>Parameter</code>/<code>BoundVar</code>?</li>
</ul>
</blockquote>
<p>you may have noticed I had a work item for chalk; this is one of the cases where I thought we might want to extend Chalk's type IR with another variant -- logically, rust's param types are a combination of "bound variables" or "placeholders"</p>



<a name="189895029"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189895029" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189895029">(Mar 06 2020 at 14:04)</a>:</h4>
<p>but rustc draws a distinction that may be useful</p>



<a name="189895133"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189895133" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189895133">(Mar 06 2020 at 14:05)</a>:</h4>
<p>Which is?</p>



<a name="189895140"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189895140" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189895140">(Mar 06 2020 at 14:05)</a>:</h4>
<p>(guessing you're explaining)</p>



<a name="189895232"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189895232" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189895232">(Mar 06 2020 at 14:06)</a>:</h4>
<p>well</p>



<a name="189895251"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189895251" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189895251">(Mar 06 2020 at 14:07)</a>:</h4>
<p>so in rustc we use <code>ty::Param</code> for type parameters declares on impls, structs, and other "declarations"</p>



<a name="189895286"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189895286" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189895286">(Mar 06 2020 at 14:07)</a>:</h4>
<p>but we use a different thing for the regions that are bound as part of a type (e.g., the <code>'a</code> in <code>for&lt;'a&gt; fn(&amp;'a u32)</code>)</p>



<a name="189895313"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189895313" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189895313">(Mar 06 2020 at 14:08)</a>:</h4>
<p>"early" vs "late" bound, is the rustc terminology</p>



<a name="189895369"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189895369" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189895369">(Mar 06 2020 at 14:08)</a>:</h4>
<p>I believe rust-analyzer has a similar distinction</p>



<a name="189895412"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189895412" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189895412">(Mar 06 2020 at 14:08)</a>:</h4>
<p>so, if nothing else, in chalk, it might be easier for us if we create a form of placeholder that makes it easy to map a <code>ty::Param</code></p>



<a name="189895421"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189895421" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189895421">(Mar 06 2020 at 14:08)</a>:</h4>
<p>I believe rustc parameters have def-ids by now?</p>



<a name="189895425"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189895425" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189895425">(Mar 06 2020 at 14:08)</a>:</h4>
<p>let me double check</p>



<a name="189895507"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189895507" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189895507">(Mar 06 2020 at 14:09)</a>:</h4>
<p>ah, interesting, no, they <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc/ty/struct.ParamTy.html" target="_blank" title="https://doc.rust-lang.org/nightly/nightly-rustc/rustc/ty/struct.ParamTy.html">just have an index</a></p>



<a name="189895509"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189895509" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189895509">(Mar 06 2020 at 14:09)</a>:</h4>
<p>I don't think so</p>



<a name="189895549"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189895549" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189895549">(Mar 06 2020 at 14:09)</a>:</h4>
<p>I mean they <em>do</em> have a DefId</p>



<a name="189895556"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189895556" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189895556">(Mar 06 2020 at 14:09)</a>:</h4>
<p>but we don't store it in the type</p>



<a name="189895558"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189895558" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189895558">(Mar 06 2020 at 14:09)</a>:</h4>
<p>those docs are so nice</p>



<a name="189895578"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189895578" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189895578">(Mar 06 2020 at 14:09)</a>:</h4>
<p>rustdocs?</p>



<a name="189895640"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189895640" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189895640">(Mar 06 2020 at 14:10)</a>:</h4>
<p>it's nice to have them, I remember how long it took us to get them setup</p>



<a name="189895641"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189895641" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189895641">(Mar 06 2020 at 14:10)</a>:</h4>
<p>yep</p>



<a name="189895665"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189895665" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189895665">(Mar 06 2020 at 14:10)</a>:</h4>
<p>I find them hard to read with the "This is an internal compiler API" all over the place :)</p>



<a name="189895666"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189895666" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189895666">(Mar 06 2020 at 14:10)</a>:</h4>
<p>but oh well</p>



<a name="189895670"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189895670" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189895670">(Mar 06 2020 at 14:10)</a>:</h4>
<p>otherwise I would be absolutely lost</p>



<a name="189895699"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189895699" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189895699">(Mar 06 2020 at 14:10)</a>:</h4>
<p>I've learned to ignore that</p>



<a name="189895712"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189895712" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189895712">(Mar 06 2020 at 14:10)</a>:</h4>
<p>so somewhat separately</p>



<a name="189895716"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189895716" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189895716">(Mar 06 2020 at 14:10)</a>:</h4>
<p>but relatedly</p>



<a name="189895758"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189895758" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189895758">(Mar 06 2020 at 14:11)</a>:</h4>
<p>the way I still think we should handle region constraints</p>



<a name="189895779"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189895779" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189895779">(Mar 06 2020 at 14:11)</a>:</h4>
<p>does require a kind of distinction between "external region placeholders"</p>



<a name="189895788"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189895788" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189895788">(Mar 06 2020 at 14:11)</a>:</h4>
<p>and the ones we create from higher-ranked things like <code>for&lt;'a&gt;</code></p>



<a name="189895816"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189895816" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189895816">(Mar 06 2020 at 14:11)</a>:</h4>
<p>which is only to say</p>



<a name="189895906"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189895906" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189895906">(Mar 06 2020 at 14:12)</a>:</h4>
<p>that this distinction between "placeholders in scope in the starting environment"</p>



<a name="189895919"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189895919" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189895919">(Mar 06 2020 at 14:12)</a>:</h4>
<p>and "placeholders we introduce as part of solving forall goals"</p>



<a name="189895920"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189895920" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189895920">(Mar 06 2020 at 14:12)</a>:</h4>
<p>might be useful there too</p>



<a name="189895971"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189895971" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189895971">(Mar 06 2020 at 14:13)</a>:</h4>
<p>is this only useful for regions?</p>



<a name="189895986"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189895986" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189895986">(Mar 06 2020 at 14:13)</a>:</h4>
<p>not types?</p>



<a name="189896004"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189896004" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189896004">(Mar 06 2020 at 14:13)</a>:</h4>
<p>depends what you mean</p>



<a name="189896019"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189896019" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189896019">(Mar 06 2020 at 14:13)</a>:</h4>
<p>I think it's useful for both</p>



<a name="189896043"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189896043" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189896043">(Mar 06 2020 at 14:14)</a>:</h4>
<p>well ok so let's back up</p>



<a name="189896086"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189896086" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189896086">(Mar 06 2020 at 14:14)</a>:</h4>
<p>maybe we should make a hackmd or something that we can use for shared context?</p>



<a name="189896096"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189896096" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189896096">(Mar 06 2020 at 14:14)</a>:</h4>
<p>i.e., the list of questions and "uncomfortable things"</p>



<a name="189896139"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189896139" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189896139">(Mar 06 2020 at 14:14)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/189896086" title="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/189896086">said</a>:</p>
<blockquote>
<p>maybe we should make a hackmd or something that we can use for shared context?</p>
</blockquote>
<p>that works</p>



<a name="189896195"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189896195" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189896195">(Mar 06 2020 at 14:14)</a>:</h4>
<p>do you want to create it?</p>



<a name="189896231"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189896231" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189896231">(Mar 06 2020 at 14:15)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232957">Jack Huey</span> <a href="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/189894477" title="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/189894477">said</a>:</p>
<blockquote>
<ul>
<li><code>Interned</code></li>
</ul>
</blockquote>
<p>So, this is more of talking about the <code>Interner</code> in general</p>



<a name="189896251"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189896251" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189896251">(Mar 06 2020 at 14:15)</a>:</h4>
<p>I'll create one</p>



<a name="189896296"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189896296" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189896296">(Mar 06 2020 at 14:15)</a>:</h4>
<p><a href="https://hackmd.io/6Ftm1EgRTOy_wmQyc_kAng?both" target="_blank" title="https://hackmd.io/6Ftm1EgRTOy_wmQyc_kAng?both">https://hackmd.io/6Ftm1EgRTOy_wmQyc_kAng?both</a></p>



<a name="189896429"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189896429" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189896429">(Mar 06 2020 at 14:16)</a>:</h4>
<p>So, for interning, I'm just using the same interners as the rest of rustc</p>



<a name="189896438"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189896438" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189896438">(Mar 06 2020 at 14:16)</a>:</h4>
<p>which I think is correct?</p>



<a name="189896480"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189896480" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189896480">(Mar 06 2020 at 14:17)</a>:</h4>
<p>but it does mean I have to make <code>Interned</code> public: <a href="https://github.com/rust-lang/rust/pull/69406/files#diff-c8a6d543f758cb294320bcac3b5268aeR1951" target="_blank" title="https://github.com/rust-lang/rust/pull/69406/files#diff-c8a6d543f758cb294320bcac3b5268aeR1951">https://github.com/rust-lang/rust/pull/69406/files#diff-c8a6d543f758cb294320bcac3b5268aeR1951</a></p>



<a name="189896484"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189896484" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189896484">(Mar 06 2020 at 14:17)</a>:</h4>
<p>yes, that's what I expected</p>



<a name="189896533"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189896533" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189896533">(Mar 06 2020 at 14:17)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232957">Jack Huey</span> <a href="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/189896480" title="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/189896480">said</a>:</p>
<blockquote>
<p>but it does mean I have to make <code>Interned</code> public: <a href="https://github.com/rust-lang/rust/pull/69406/files#diff-c8a6d543f758cb294320bcac3b5268aeR1951" target="_blank" title="https://github.com/rust-lang/rust/pull/69406/files#diff-c8a6d543f758cb294320bcac3b5268aeR1951">https://github.com/rust-lang/rust/pull/69406/files#diff-c8a6d543f758cb294320bcac3b5268aeR1951</a></p>
</blockquote>
<p>because it is used across crates?</p>



<a name="189896609"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189896609" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189896609">(Mar 06 2020 at 14:18)</a>:</h4>
<p>The <code>'tcx T</code> field is still only <code>pub(crate)</code>, but I think if that was public, I could actually move everything to <code>librustc_traits</code></p>



<a name="189896614"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189896614" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189896614">(Mar 06 2020 at 14:18)</a>:</h4>
<p>yes</p>



<a name="189896622"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189896622" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189896622">(Mar 06 2020 at 14:18)</a>:</h4>
<p>because it gets exposed in <code>Interner</code></p>



<a name="189896738"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189896738" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189896738">(Mar 06 2020 at 14:19)</a>:</h4>
<p>And I just wanted to touch base that this is <em>okay</em></p>



<a name="189896854"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189896854" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189896854">(Mar 06 2020 at 14:20)</a>:</h4>
<p>Alternatively, could make a new <code>ChalkInterned</code> type</p>



<a name="189896907"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189896907" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189896907">(Mar 06 2020 at 14:20)</a>:</h4>
<p>it seems ok, though I don't <em>quite</em> know why it's necessary yet</p>



<a name="189896927"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189896927" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189896927">(Mar 06 2020 at 14:20)</a>:</h4>
<p>oh, because this?</p>



<a name="189896932"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189896932" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189896932">(Mar 06 2020 at 14:21)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="w">     </span><span class="k">type</span> <span class="nc">InternedType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Interned</span><span class="o">&lt;</span><span class="na">&#39;tcx</span><span class="p">,</span><span class="w"> </span><span class="n">chalk_ir</span>::<span class="n">TyData</span><span class="o">&lt;</span><span class="n">Self</span><span class="o">&gt;&gt;</span><span class="p">;</span><span class="w"></span>
</pre></div>



<a name="189896939"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189896939" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189896939">(Mar 06 2020 at 14:21)</a>:</h4>
<p>yes</p>



<a name="189896969"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189896969" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189896969">(Mar 06 2020 at 14:21)</a>:</h4>
<p>I expected <code>&amp;'tcx chalk_ir::TyData&lt;Self&gt;</code></p>



<a name="189896984"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189896984" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189896984">(Mar 06 2020 at 14:21)</a>:</h4>
<p>oh</p>



<a name="189896991"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189896991" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189896991">(Mar 06 2020 at 14:21)</a>:</h4>
<p>that would work too...</p>



<a name="189897016"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189897016" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189897016">(Mar 06 2020 at 14:21)</a>:</h4>
<p>although I suppose that might have some downsides</p>



<a name="189897102"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189897102" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189897102">(Mar 06 2020 at 14:22)</a>:</h4>
<p>in particular the <code>PartialEq</code> etc is less efficient</p>



<a name="189897119"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189897119" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189897119">(Mar 06 2020 at 14:22)</a>:</h4>
<p>anyway I don't think it's <em>bad</em> for <code>Interned</code> to be public</p>



<a name="189897186"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189897186" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189897186">(Mar 06 2020 at 14:23)</a>:</h4>
<p>you could overcome the <code>PartialEq</code> perf loss by having some "newtype" like <code>&amp;'tcx InternedTyData&lt;Self&gt;</code></p>



<a name="189897197"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189897197" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189897197">(Mar 06 2020 at 14:23)</a>:</h4>
<p>but then you're just kind of reproducing what <code>Interned</code> already does, I imagine..?</p>



<a name="189897231"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189897231" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189897231">(Mar 06 2020 at 14:23)</a>:</h4>
<p>So</p>



<a name="189897242"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189897242" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189897242">(Mar 06 2020 at 14:23)</a>:</h4>
<p>relevant: <a href="https://github.com/rust-lang/rust/pull/69406/files#diff-c8a6d543f758cb294320bcac3b5268aeR2137" target="_blank" title="https://github.com/rust-lang/rust/pull/69406/files#diff-c8a6d543f758cb294320bcac3b5268aeR2137">https://github.com/rust-lang/rust/pull/69406/files#diff-c8a6d543f758cb294320bcac3b5268aeR2137</a></p>



<a name="189897334"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189897334" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189897334">(Mar 06 2020 at 14:24)</a>:</h4>
<p>mm yeah I guesss you're adding those impls yourself anyway</p>



<a name="189897398"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189897398" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189897398">(Mar 06 2020 at 14:25)</a>:</h4>
<p>I'm sure there is a reason we don't have blanket impls</p>



<a name="189897402"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189897402" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189897402">(Mar 06 2020 at 14:25)</a>:</h4>
<p>though I don't recall what it is</p>



<a name="189897439"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189897439" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189897439">(Mar 06 2020 at 14:25)</a>:</h4>
<p>anyway this is small potatoes</p>



<a name="189897443"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189897443" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189897443">(Mar 06 2020 at 14:26)</a>:</h4>
<p>let's move on to the other stuff :)</p>



<a name="189897489"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189897489" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189897489">(Mar 06 2020 at 14:26)</a>:</h4>
<p>I think it's ok to make <code>Interned</code> public for now</p>



<a name="189897498"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189897498" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189897498">(Mar 06 2020 at 14:26)</a>:</h4>
<p>or to use <code>&amp;'tcx TyData</code></p>



<a name="189897509"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189897509" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189897509">(Mar 06 2020 at 14:26)</a>:</h4>
<p>I'll try the latter</p>



<a name="189897514"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189897514" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189897514">(Mar 06 2020 at 14:26)</a>:</h4>
<p>So, for const</p>



<a name="189897535"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189897535" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189897535">(Mar 06 2020 at 14:26)</a>:</h4>
<p>I would add a TODO or FIXME or something</p>



<a name="189897536"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189897536" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189897536">(Mar 06 2020 at 14:26)</a>:</h4>
<p>Is an "okay" alternative to panicing just replace it with <code>()</code>?</p>



<a name="189897546"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189897546" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189897546">(Mar 06 2020 at 14:26)</a>:</h4>
<p>indicating like "this could be more efficient if we used the address"</p>



<a name="189897576"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189897576" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189897576">(Mar 06 2020 at 14:27)</a>:</h4>
<p>i.e., convert all constants to unit type?</p>



<a name="189897581"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189897581" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189897581">(Mar 06 2020 at 14:27)</a>:</h4>
<p>yeah</p>



<a name="189897592"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189897592" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189897592">(Mar 06 2020 at 14:27)</a>:</h4>
<p>I guess it's ok for now</p>



<a name="189897607"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189897607" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189897607">(Mar 06 2020 at 14:27)</a>:</h4>
<p>not something I had considered but it seems fine</p>



<a name="189897611"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189897611" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189897611">(Mar 06 2020 at 14:27)</a>:</h4>
<p>it'l make some things pass that shouldn't</p>



<a name="189897614"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189897614" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189897614">(Mar 06 2020 at 14:27)</a>:</h4>
<p>So, for context:</p>



<a name="189897683"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189897683" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189897683">(Mar 06 2020 at 14:28)</a>:</h4>
<p>I was running into an issue where I was trying to lower I think <code>IntoIter</code></p>



<a name="189897692"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189897692" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189897692">(Mar 06 2020 at 14:28)</a>:</h4>
<p>I guess without doing <em>something</em> we may not be able to get very far</p>



<a name="189897699"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189897699" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189897699">(Mar 06 2020 at 14:28)</a>:</h4>
<p>we could also talk about extending chalk with constants</p>



<a name="189897708"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189897708" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189897708">(Mar 06 2020 at 14:28)</a>:</h4>
<p>which has the <code>const</code> param</p>



<a name="189897712"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189897712" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189897712">(Mar 06 2020 at 14:28)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232957">Jack Huey</span> <a href="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/189897683" title="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/189897683">said</a>:</p>
<blockquote>
<p>I was running into an issue where I was trying to lower I think <code>IntoIter</code></p>
</blockquote>
<p>yeah, I just realized that you'll hit some primitive impls in libcore</p>



<a name="189897733"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189897733" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189897733">(Mar 06 2020 at 14:29)</a>:</h4>
<p>I should be updating the roadmap actually, hold up :)</p>



<a name="189897738"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189897738" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189897738">(Mar 06 2020 at 14:29)</a>:</h4>
<p>constant support is definitely a "category of work"</p>



<a name="189897741"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189897741" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189897741">(Mar 06 2020 at 14:29)</a>:</h4>
<p>Though, may not have to worry about that, because I <em>was</em> being super conservative and returning <em>all</em> impls instead of filtering</p>



<a name="189897761"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189897761" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189897761">(Mar 06 2020 at 14:29)</a>:</h4>
<p>Yeah, I think that's an issue already somewhere</p>



<a name="189897766"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189897766" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189897766">(Mar 06 2020 at 14:29)</a>:</h4>
<p>I suspect we could do something reasonable</p>



<a name="189897774"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189897774" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189897774">(Mar 06 2020 at 14:29)</a>:</h4>
<p>that works for "the simple stuff"</p>



<a name="189897777"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189897777" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189897777">(Mar 06 2020 at 14:29)</a>:</h4>
<p>fairly easily</p>



<a name="189897797"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189897797" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189897797">(Mar 06 2020 at 14:30)</a>:</h4>
<p>Along the same lines, how do I handle <code>Array</code>?</p>



<a name="189897859"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189897859" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189897859">(Mar 06 2020 at 14:30)</a>:</h4>
<p>Because the array length is specified as a mir <code>Const</code></p>



<a name="189897908"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189897908" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189897908">(Mar 06 2020 at 14:30)</a>:</h4>
<p>right, that's why you might want better support for constants</p>



<a name="189897921"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189897921" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189897921">(Mar 06 2020 at 14:30)</a>:</h4>
<p>Just keep that around?</p>



<a name="189897927"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189897927" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189897927">(Mar 06 2020 at 14:30)</a>:</h4>
<p>okay</p>



<a name="189898027"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189898027" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189898027">(Mar 06 2020 at 14:32)</a>:</h4>
<p>I'm wondering if we should just go ahead and try to add some sort of constants</p>



<a name="189898079"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189898079" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189898079">(Mar 06 2020 at 14:32)</a>:</h4>
<p>Probably sooner rather than later</p>



<a name="189898080"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189898080" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189898080">(Mar 06 2020 at 14:32)</a>:</h4>
<p>basically i'm wondering a bit whether the better strategy</p>



<a name="189898102"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189898102" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189898102">(Mar 06 2020 at 14:32)</a>:</h4>
<p>is to build up "something that works" on rustc side asap</p>



<a name="189898108"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189898108" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189898108">(Mar 06 2020 at 14:32)</a>:</h4>
<p>or to take the time to go and refactor chalk</p>



<a name="189898115"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189898115" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189898115">(Mar 06 2020 at 14:32)</a>:</h4>
<p>with things like constants, parameters, etc</p>



<a name="189898117"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189898117" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189898117">(Mar 06 2020 at 14:32)</a>:</h4>
<p>that feel rough</p>



<a name="189898122"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189898122" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189898122">(Mar 06 2020 at 14:32)</a>:</h4>
<p>given that we have rust-analyzer</p>



<a name="189898131"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189898131" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189898131">(Mar 06 2020 at 14:32)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/189898108" title="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/189898108">said</a>:</p>
<blockquote>
<p>or to take the time to go and refactor chalk</p>
</blockquote>
<p>this might be better</p>



<a name="189898150"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189898150" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189898150">(Mar 06 2020 at 14:33)</a>:</h4>
<p>but I'd be curious about your take on it</p>



<a name="189898159"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189898159" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189898159">(Mar 06 2020 at 14:33)</a>:</h4>
<p>Yeah, I've basically been trying to "get as far as I can"</p>



<a name="189898170"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189898170" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189898170">(Mar 06 2020 at 14:33)</a>:</h4>
<p>But there's some fundamental things that will make the integration not possible in a general sense</p>



<a name="189898176"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189898176" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189898176">(Mar 06 2020 at 14:33)</a>:</h4>
<p>So far:</p>



<a name="189898180"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189898180" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189898180">(Mar 06 2020 at 14:33)</a>:</h4>
<p>yes, I viewed your effort in part as</p>



<a name="189898194"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189898194" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189898194">(Mar 06 2020 at 14:33)</a>:</h4>
<p>"let's give this a try to get a better idea of what work is left"</p>



<a name="189898197"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189898197" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189898197">(Mar 06 2020 at 14:33)</a>:</h4>
<ul>
<li>Binders and such</li>
<li>Consts</li>
<li>Sized and such</li>
</ul>



<a name="189898203"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189898203" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189898203">(Mar 06 2020 at 14:34)</a>:</h4>
<p>(maybe others)</p>



<a name="189898305"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189898305" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189898305">(Mar 06 2020 at 14:34)</a>:</h4>
<p>There's quite a few things that I'm doing on to let the <em>current test</em> go a bit further</p>



<a name="189898396"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189898396" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189898396">(Mar 06 2020 at 14:35)</a>:</h4>
<p>can we take a sec to try and get them into roadmap a bit?</p>



<a name="189898404"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189898404" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189898404">(Mar 06 2020 at 14:35)</a>:</h4>
<p>so built-in traits are a major thing that's not present</p>



<a name="189898410"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189898410" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189898410">(Mar 06 2020 at 14:35)</a>:</h4>
<p>(I'm editing a file locally now)</p>



<a name="189898414"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189898414" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189898414">(Mar 06 2020 at 14:35)</a>:</h4>
<p>Yes</p>



<a name="189898484"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189898484" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189898484">(Mar 06 2020 at 14:36)</a>:</h4>
<p>what's the list of built-in traits?</p>



<a name="189898489"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189898489" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189898489">(Mar 06 2020 at 14:36)</a>:</h4>
<p>Sized, Clone, Copy</p>



<a name="189898499"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189898499" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189898499">(Mar 06 2020 at 14:36)</a>:</h4>
<p>I forget if there are others</p>



<a name="189898500"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189898500" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189898500">(Mar 06 2020 at 14:36)</a>:</h4>
<p>I think only <code>Sized</code></p>



<a name="189898503"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189898503" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189898503">(Mar 06 2020 at 14:36)</a>:</h4>
<p>(at least <em>partially</em> built-in)</p>



<a name="189898510"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189898510" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189898510">(Mar 06 2020 at 14:36)</a>:</h4>
<p>Clone and Copy are not a problem</p>



<a name="189898517"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189898517" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189898517">(Mar 06 2020 at 14:36)</a>:</h4>
<p>well, no, we have built-in impls for Clone and Copy that relate to closures</p>



<a name="189898524"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189898524" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189898524">(Mar 06 2020 at 14:36)</a>:</h4>
<p>not a problem, it's true</p>



<a name="189898532"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189898532" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189898532">(Mar 06 2020 at 14:36)</a>:</h4>
<p>oh</p>



<a name="189898533"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189898533" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189898533">(Mar 06 2020 at 14:36)</a>:</h4>
<p>but we don't support them yet</p>



<a name="189898572"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189898572" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189898572">(Mar 06 2020 at 14:36)</a>:</h4>
<p>oh, <code>Unsize</code></p>



<a name="189898577"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189898577" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189898577">(Mar 06 2020 at 14:36)</a>:</h4>
<p>that's a big one</p>



<a name="189898584"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189898584" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189898584">(Mar 06 2020 at 14:36)</a>:</h4>
<p>you'll find this logic in <a href="http://select.rs" target="_blank" title="http://select.rs">select.rs</a></p>



<a name="189898620"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189898620" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189898620">(Mar 06 2020 at 14:37)</a>:</h4>
<p>ok I'll take a look</p>



<a name="189898630"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189898630" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189898630">(Mar 06 2020 at 14:37)</a>:</h4>
<p>at some point</p>



<a name="189898678"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189898678" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189898678">(Mar 06 2020 at 14:37)</a>:</h4>
<p><code>UnwindSafe</code> is just an auto trait right?</p>



<a name="189898820"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189898820" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189898820">(Mar 06 2020 at 14:39)</a>:</h4>
<p>I thnk <code>UnwindSafe</code> is a regular auto trait</p>



<a name="189898918"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189898918" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189898918">(Mar 06 2020 at 14:40)</a>:</h4>
<p><span class="user-mention" data-user-id="232957">@Jack Huey</span> the place to look, in part, is at the <a href="https://github.com/rust-lang/rust/blob/865b44a3e330f3ef8be0f6edf69896c9ed957ac0/src/librustc/traits/select.rs#L106" target="_blank" title="https://github.com/rust-lang/rust/blob/865b44a3e330f3ef8be0f6edf69896c9ed957ac0/src/librustc/traits/select.rs#L106"><code>SelectionCandidate</code></a></p>



<a name="189898943"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189898943" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189898943">(Mar 06 2020 at 14:40)</a>:</h4>
<p>Oh interesting</p>



<a name="189898966"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189898966" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189898966">(Mar 06 2020 at 14:40)</a>:</h4>
<p>oh right</p>



<a name="189898978"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189898978" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189898978">(Mar 06 2020 at 14:40)</a>:</h4>
<p>this code got moved into crates at some point</p>



<a name="189898991"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189898991" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189898991">(Mar 06 2020 at 14:40)</a>:</h4>
<p>I was like "where...did all the contents of this file go"</p>



<a name="189899028"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189899028" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189899028">(Mar 06 2020 at 14:41)</a>:</h4>
<p>Oh another thing to add to the think about is <code>chalk_ir::Function</code> and it's interaction with those (specifically Sized is what I've run into)</p>



<a name="189899045"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189899045" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189899045">(Mar 06 2020 at 14:41)</a>:</h4>
<p>But I guess that will just be part of the logic</p>



<a name="189899167"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189899167" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189899167">(Mar 06 2020 at 14:42)</a>:</h4>
<p>so yeah the built-in logic is <a href="https://github.com/rust-lang/rust/blob/865b44a3e330f3ef8be0f6edf69896c9ed957ac0/src/librustc_infer/traits/select.rs#L1373-L1404" target="_blank" title="https://github.com/rust-lang/rust/blob/865b44a3e330f3ef8be0f6edf69896c9ed957ac0/src/librustc_infer/traits/select.rs#L1373-L1404">sized/copy/clone/unsize</a></p>



<a name="189899198"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189899198" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189899198">(Mar 06 2020 at 14:43)</a>:</h4>
<p>Cool</p>



<a name="189899219"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189899219" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189899219">(Mar 06 2020 at 14:43)</a>:</h4>
<p>Also another think to maybe discuss is: is this the right "level" of integration for Chalk?</p>



<a name="189899231"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189899231" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189899231">(Mar 06 2020 at 14:43)</a>:</h4>
<p>By that I mean</p>



<a name="189899238"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189899238" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189899238">(Mar 06 2020 at 14:43)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232957">Jack Huey</span> <a href="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/189898203" title="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/189898203">said</a>:</p>
<blockquote>
<p>(maybe others)</p>
</blockquote>
<p>so I think there are some things in mapping types that are difficult</p>



<a name="189899297"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189899297" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189899297">(Mar 06 2020 at 14:44)</a>:</h4>
<p>it seems like the rules around Well-formedness are already being defined upstream of <code>evaluate_goal</code></p>



<a name="189899346"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189899346" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189899346">(Mar 06 2020 at 14:44)</a>:</h4>
<p>well so</p>



<a name="189899371"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189899371" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189899371">(Mar 06 2020 at 14:45)</a>:</h4>
<p>coherence checks and well-formedness</p>



<a name="189899403"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189899403" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189899403">(Mar 06 2020 at 14:45)</a>:</h4>
<p>are another layer where rustc duplicates chalk to some extent</p>



<a name="189899407"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189899407" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189899407">(Mar 06 2020 at 14:45)</a>:</h4>
<p>and that I would expect to consolidate</p>



<a name="189899426"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189899426" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189899426">(Mar 06 2020 at 14:45)</a>:</h4>
<p>but I think we're going to need to do the level we're doing <em>now</em> first</p>



<a name="189899536"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189899536" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189899536">(Mar 06 2020 at 14:46)</a>:</h4>
<p>okay</p>



<a name="189899543"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189899543" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189899543">(Mar 06 2020 at 14:46)</a>:</h4>
<p>I sort of figured that</p>



<a name="189899548"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189899548" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189899548">(Mar 06 2020 at 14:46)</a>:</h4>
<p>but wanted to double check</p>



<a name="189899646"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189899646" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189899646">(Mar 06 2020 at 14:47)</a>:</h4>
<p>So, in terms of "roadmap"</p>



<a name="189899721"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189899721" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189899721">(Mar 06 2020 at 14:48)</a>:</h4>
<p>I think that the items that we identify as "blockers" should probably be the "focus" of next sprint?</p>



<a name="189899829"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189899829" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189899829">(Mar 06 2020 at 14:49)</a>:</h4>
<p>yes probably</p>



<a name="189899840"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189899840" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189899840">(Mar 06 2020 at 14:49)</a>:</h4>
<p>I'm about to push an updated roadmap with the stuff we've said so far,</p>



<a name="189899859"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189899859" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189899859">(Mar 06 2020 at 14:49)</a>:</h4>
<p>but I think we could use to drill a bit more into the type details</p>



<a name="189899921"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189899921" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189899921">(Mar 06 2020 at 14:50)</a>:</h4>
<p>Anything specific?</p>



<a name="189899934"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189899934" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189899934">(Mar 06 2020 at 14:50)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232957">Jack Huey</span> <a href="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/189899721" title="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/189899721">said</a>:</p>
<blockquote>
<p>I think that the items that we identify as "blockers" should probably be the "focus" of next sprint?</p>
</blockquote>
<p>this was kind of my hope, that we would use this time to be better prepared next time :)</p>



<a name="189899951"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189899951" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189899951">(Mar 06 2020 at 14:50)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232957">Jack Huey</span> <a href="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/189899921" title="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/189899921">said</a>:</p>
<blockquote>
<p>Anything specific?</p>
</blockquote>
<p>good question, let me see if I can drop some thoughts into the hackmd</p>



<a name="189899955"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189899955" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189899955">(Mar 06 2020 at 14:50)</a>:</h4>
<p>to start</p>



<a name="189900198"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189900198" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189900198">(Mar 06 2020 at 14:53)</a>:</h4>
<p>We do have an <code>Error</code> TypeName right?</p>



<a name="189900229"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189900229" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189900229">(Mar 06 2020 at 14:53)</a>:</h4>
<p>yes</p>



<a name="189900574"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189900574" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189900574">(Mar 06 2020 at 14:56)</a>:</h4>
<p>ok, I left some notes in <a href="https://hackmd.io/6Ftm1EgRTOy_wmQyc_kAng?both#What-about-mapping-types" target="_blank" title="https://hackmd.io/6Ftm1EgRTOy_wmQyc_kAng?both#What-about-mapping-types">what about mapping types</a> section</p>



<a name="189900584"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189900584" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189900584">(Mar 06 2020 at 14:56)</a>:</h4>
<p>I saw</p>



<a name="189900600"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189900600" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189900600">(Mar 06 2020 at 14:57)</a>:</h4>
<p>Basically out of time for today though</p>



<a name="189900614"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189900614" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189900614">(Mar 06 2020 at 14:57)</a>:</h4>
<p>This was a good prelude to the design meeting lol</p>



<a name="189900646"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189900646" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189900646">(Mar 06 2020 at 14:57)</a>:</h4>
<p>heh, yes</p>



<a name="189900766"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189900766" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189900766">(Mar 06 2020 at 14:58)</a>:</h4>
<p>I mean, of course my first "real" contribution to rustc ends up being the <em>trait system</em> of all things</p>



<a name="189900795"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/189900795" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#189900795">(Mar 06 2020 at 14:59)</a>:</h4>
<p><a href="https://github.com/rust-lang/wg-traits/pull/10" target="_blank" title="https://github.com/rust-lang/wg-traits/pull/10">https://github.com/rust-lang/wg-traits/pull/10</a></p>



<a name="190336373"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190336373" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190336373">(Mar 11 2020 at 21:57)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> are you available Friday at 9 again?</p>



<a name="190336384"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190336384" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190336384">(Mar 11 2020 at 21:57)</a>:</h4>
<p>Yes.</p>



<a name="190336407"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190336407" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190336407">(Mar 11 2020 at 21:57)</a>:</h4>
<p>Want to talk more?</p>



<a name="190336490"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190336490" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190336490">(Mar 11 2020 at 21:58)</a>:</h4>
<p>Definitely would like to discuss more about <code>Param</code> and what extending <code>chalk-ir</code> with another variant would look like</p>



<a name="190375422"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190375422" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190375422">(Mar 12 2020 at 10:39)</a>:</h4>
<p><span class="user-mention" data-user-id="232957">@Jack Huey</span> yes!</p>



<a name="190411417"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190411417" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190411417">(Mar 12 2020 at 16:30)</a>:</h4>
<p>Okay tomorrow at 9 AM :)</p>



<a name="190452592"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190452592" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190452592">(Mar 12 2020 at 22:28)</a>:</h4>
<p>Ok, so current status: still unsure about <code>Param</code>s</p>



<a name="190452657"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190452657" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190452657">(Mar 12 2020 at 22:29)</a>:</h4>
<p>So, before, I was essentially lowering <code>ty::Param(p)</code> to <code>TyData::Apply(RustDefId::Param(p))</code></p>



<a name="190452710"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190452710" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190452710">(Mar 12 2020 at 22:29)</a>:</h4>
<p>But from talking with <span class="user-mention" data-user-id="116009">@nikomatsakis</span> before, it seemed like these should be either <code>BoundVar</code>s or <code>Placeholder</code>s, depending on where we lower</p>



<a name="190452772"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190452772" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190452772">(Mar 12 2020 at 22:30)</a>:</h4>
<p>So, I started switching things around for that</p>



<a name="190452789"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190452789" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190452789">(Mar 12 2020 at 22:30)</a>:</h4>
<p>(trying to get the <code>lower_impl</code> test to check-pass)</p>



<a name="190452852"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190452852" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190452852">(Mar 12 2020 at 22:31)</a>:</h4>
<p>but, I think that, actually, I was "right" to lower <code>ty::Param</code> to <code>TyData::Apply(..)</code> in <em>some</em> cases</p>



<a name="190452940"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190452940" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190452940">(Mar 12 2020 at 22:32)</a>:</h4>
<p>meaning, that in terms of <em>Chalk</em>, the <code>Param</code>s (when we're trying to solve a goal like <code>WellFormed(T)</code>) act like <code>Apply</code>s</p>



<a name="190452979"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190452979" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190452979">(Mar 12 2020 at 22:33)</a>:</h4>
<p>I say this, primarily, because we don't generate <code>WellFormed</code> clauses for <code>Placeholder</code>s</p>



<a name="190453096"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190453096" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190453096">(Mar 12 2020 at 22:34)</a>:</h4>
<p><a href="https://github.com/rust-lang/chalk/blob/master/chalk-solve/src/clauses.rs#L336" target="_blank" title="https://github.com/rust-lang/chalk/blob/master/chalk-solve/src/clauses.rs#L336">https://github.com/rust-lang/chalk/blob/master/chalk-solve/src/clauses.rs#L336</a></p>



<a name="190453330"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190453330" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190453330">(Mar 12 2020 at 22:37)</a>:</h4>
<p>so there's 3 options here:<br>
1) We treat <code>Param</code>s here as <code>Apply</code> (with a special (chalk)<code>DefId</code>).<br>
2) We allow generating clauses for <code>Placeholder</code>s<br>
3) We introduce a new <code>TyData::Param</code></p>



<a name="190454559"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190454559" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190454559">(Mar 12 2020 at 22:56)</a>:</h4>
<p>Also, are we generated <code>WellFormed</code> goals for traits?</p>



<a name="190454623"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190454623" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190454623">(Mar 12 2020 at 22:57)</a>:</h4>
<p>yes</p>



<a name="190455124"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190455124" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190455124">(Mar 12 2020 at 23:05)</a>:</h4>
<p>So, something different between the way Chalk handles well-formed goals and rustc:</p>



<a name="190455141"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190455141" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190455141">(Mar 12 2020 at 23:05)</a>:</h4>
<p>This is rustc's WF goal for a trait:</p>
<div class="codehilite"><pre><span></span>Canonical {
    max_universe: U0,
    variables: [],
    value: InEnvironment {
        environment: Environment {
            clauses: [
                ForAll(
                    Binder(
                        ProgramClause {
                            goal: FromEnv(
                                Trait(
                                    TraitPredicate(&lt;Self as Foo&gt;),
                                ),
                            ),
                            hypotheses: [],
                            category: Other,
                        },
                    ),
                ),
            ],
        },
        goal: WellFormed(Self),
    },
}
</pre></div>



<a name="190455193"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190455193" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190455193">(Mar 12 2020 at 23:06)</a>:</h4>
<p><code>goal: WellFormed(Self)</code> is the particularly interesting bit</p>



<a name="190455220"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190455220" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190455220">(Mar 12 2020 at 23:06)</a>:</h4>
<p>In Chalk, the WF goal for a trait is <code>WellFormed(&lt;Self as Foo&gt;)</code></p>



<a name="190455251"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190455251" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190455251">(Mar 12 2020 at 23:07)</a>:</h4>
<p>ah nevermind it's the same</p>



<a name="190455259"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190455259" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190455259">(Mar 12 2020 at 23:07)</a>:</h4>
<p><code>Trait(TraitPredicate&lt;'tcx&gt;)</code></p>



<a name="190455573"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190455573" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190455573">(Mar 12 2020 at 23:11)</a>:</h4>
<p>ok I've been lowering this wrong :/</p>



<a name="190455652"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190455652" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190455652">(Mar 12 2020 at 23:13)</a>:</h4>
<p>wait no</p>



<a name="190455709"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190455709" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190455709">(Mar 12 2020 at 23:14)</a>:</h4>
<p><code>Predicate::WellFormed</code> is a <code>Ty</code></p>



<a name="190455744"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190455744" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190455744">(Mar 12 2020 at 23:14)</a>:</h4>
<p>ah, yes, because that <code>Ty</code> is a <code>Param</code></p>



<a name="190455778"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190455778" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190455778">(Mar 12 2020 at 23:15)</a>:</h4>
<p>Really, that should get lowered into a WF trait goal</p>



<a name="190456029"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190456029" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190456029">(Mar 12 2020 at 23:18)</a>:</h4>
<div class="codehilite"><pre><span></span>Canonical {
    max_universe: U0,
    variables: [],
    value: InEnvironment {
        environment: Environment {
            clauses: [
                ForAll(
                    Binder(
                        ProgramClause {
                            goal: FromEnv(
                                Trait(
                                    TraitPredicate(&lt;Self as Foo&gt;),
                                ),
                            ),
                            hypotheses: [],
                            category: Other,
                        },
                    ),
                ),
            ],
        },
        goal: Binder(
            TraitPredicate(&lt;Self as Foo&gt;),
        ),
    },
}
</pre></div>



<a name="190456036"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190456036" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190456036">(Mar 12 2020 at 23:18)</a>:</h4>
<p>now I'm just confused</p>



<a name="190457071"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190457071" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190457071">(Mar 12 2020 at 23:35)</a>:</h4>
<p>ok so I don't think <code>chalk-integration</code> actually checks if all traits are well-formed</p>



<a name="190457209"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190457209" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190457209">(Mar 12 2020 at 23:36)</a>:</h4>
<p>and I'm gonna defer further thought until tomorrow morning</p>



<a name="190495145"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190495145" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190495145">(Mar 13 2020 at 12:05)</a>:</h4>
<p><span class="user-mention" data-user-id="232957">@Jack Huey</span> oh, just saw these comments, haven't read them yet -- just wanted to say that I might not be avail at 9am but I started updating <a href="https://internals.rust-lang.org/t/stepping-away-from-the-rust-project/11971" target="_blank" title="https://internals.rust-lang.org/t/stepping-away-from-the-rust-project/11971">the gist</a> with a few more details</p>



<a name="190495234"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190495234" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190495234">(Mar 13 2020 at 12:06)</a>:</h4>
<p>Oof okay</p>



<a name="190495236"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190495236" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> detrumi <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190495236">(Mar 13 2020 at 12:06)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> wrong link</p>



<a name="190513887"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190513887" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190513887">(Mar 13 2020 at 15:11)</a>:</h4>
<p>lol correct</p>



<a name="190513897"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190513897" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190513897">(Mar 13 2020 at 15:11)</a>:</h4>
<p><span class="user-mention" data-user-id="232957">@Jack Huey</span> i'm around now</p>



<a name="190513902"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190513902" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190513902">(Mar 13 2020 at 15:11)</a>:</h4>
<p>sorry, I blame COVID-19 :)</p>



<a name="190513926"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190513926" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190513926">(Mar 13 2020 at 15:11)</a>:</h4>
<p>my daughter's school is canceled and our schedule's are all topsy turvy :)</p>



<a name="190514062"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190514062" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190514062">(Mar 13 2020 at 15:12)</a>:</h4>
<p>no problem</p>



<a name="190514087"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190514087" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190514087">(Mar 13 2020 at 15:12)</a>:</h4>
<p>so let me see, should I first read all your comments?</p>



<a name="190514103"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190514103" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190514103">(Mar 13 2020 at 15:12)</a>:</h4>
<p>as <span class="user-mention silent" data-user-id="125131">detrumi</span>  said, the gist link isn't correct :)</p>



<a name="190514173"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190514173" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190514173">(Mar 13 2020 at 15:12)</a>:</h4>
<p>Uh, maybe not all of them</p>



<a name="190514194"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190514194" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190514194">(Mar 13 2020 at 15:13)</a>:</h4>
<p>quite a bit was me rambling as I tried to understand things</p>



<a name="190514210"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190514210" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190514210">(Mar 13 2020 at 15:13)</a>:</h4>
<p>let me see if I can pull out the most relevant</p>



<a name="190514229"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190514229" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190514229">(Mar 13 2020 at 15:13)</a>:</h4>
<p>actually give me 5 minutes</p>



<a name="190514235"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190514235" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190514235">(Mar 13 2020 at 15:13)</a>:</h4>
<p>to talk with my partner and figure out my workday schedule</p>



<a name="190514247"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190514247" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190514247">(Mar 13 2020 at 15:13)</a>:</h4>
<p>since right now i'm fielding like 3 conversations at once :)</p>



<a name="190514258"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190514258" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190514258">(Mar 13 2020 at 15:13)</a>:</h4>
<p>brb</p>



<a name="190514303"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190514303" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190514303">(Mar 13 2020 at 15:13)</a>:</h4>
<p>no problem, I'm gonna go through the comments</p>



<a name="190514590"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190514590" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190514590">(Mar 13 2020 at 15:16)</a>:</h4>
<p>Ok, yeah, so I was basically getting confused/stuck with how to deal with the <code>WellFormed</code> goal generated by rustc for traits <code>WellFormed(Self)</code> (where <code>Self</code> is the Param presumably for <code>Foo</code> for <code>trait Foo { }</code>)</p>



<a name="190514666"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190514666" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190514666">(Mar 13 2020 at 15:16)</a>:</h4>
<p>But rustc is also generating this goal: <code>goal: Binder(TraitPredicate(&lt;Self as Foo&gt;))</code></p>



<a name="190514701"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190514701" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190514701">(Mar 13 2020 at 15:17)</a>:</h4>
<p>Which gets lowered to <code>Implemented(Self: Foo)</code></p>



<a name="190514762"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190514762" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190514762">(Mar 13 2020 at 15:17)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232957">Jack Huey</span> <a href="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/190453330" title="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/190453330">said</a>:</p>
<blockquote>
<p>so there's 3 options here:<br>
1) We treat <code>Param</code>s here as <code>Apply</code> (with a special (chalk)<code>DefId</code>).<br>
2) We allow generating clauses for <code>Placeholder</code>s<br>
3) We introduce a new <code>TyData::Param</code></p>
</blockquote>
<p>Then here I also was thinking about <code>Param</code> and how to lower it</p>



<a name="190515000"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190515000" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190515000">(Mar 13 2020 at 15:19)</a>:</h4>
<p>I've found that it's actually really helpful to just look at the old chalk integration (have to look at an older commit), since in a lot of cases things are fairly similar</p>



<a name="190515037"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190515037" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190515037">(Mar 13 2020 at 15:19)</a>:</h4>
<p>For example, here is where the <code>WellFormed</code> goals are lowered: <a href="https://github.com/rust-lang/rust/blob/21affdd00d52fba6388f1858a52c253b3f83a90d/src/librustc_traits/chalk_context/program_clauses/mod.rs#L165" target="_blank" title="https://github.com/rust-lang/rust/blob/21affdd00d52fba6388f1858a52c253b3f83a90d/src/librustc_traits/chalk_context/program_clauses/mod.rs#L165">https://github.com/rust-lang/rust/blob/21affdd00d52fba6388f1858a52c253b3f83a90d/src/librustc_traits/chalk_context/program_clauses/mod.rs#L165</a></p>



<a name="190515164"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190515164" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190515164">(Mar 13 2020 at 15:20)</a>:</h4>
<p>And so, for a bunch of types (including <code>Param</code>), if we followed the same idea, we can lower this into an empty set of goals</p>



<a name="190515189"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190515189" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190515189">(Mar 13 2020 at 15:20)</a>:</h4>
<p>(but not sure that's what we <em>want</em> to do)</p>



<a name="190515356"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190515356" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190515356">(Mar 13 2020 at 15:21)</a>:</h4>
<p>ok, better</p>



<a name="190515449"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190515449" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190515449">(Mar 13 2020 at 15:22)</a>:</h4>
<p>OK so</p>



<a name="190515462"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190515462" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190515462">(Mar 13 2020 at 15:22)</a>:</h4>
<p>let's back up one second</p>



<a name="190515477"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190515477" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190515477">(Mar 13 2020 at 15:22)</a>:</h4>
<p>gladly :)</p>



<a name="190515497"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190515497" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190515497">(Mar 13 2020 at 15:22)</a>:</h4>
<p>I <em>think</em> what you're asking about is the way that <code>ty::Param</code> in rustc has a "dual role"</p>



<a name="190515513"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190515513" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190515513">(Mar 13 2020 at 15:22)</a>:</h4>
<p>sometimes it is what chalk would call a "bound variable"</p>



<a name="190515521"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190515521" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190515521">(Mar 13 2020 at 15:22)</a>:</h4>
<p>and other times it's a placeholder</p>



<a name="190515548"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190515548" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190515548">(Mar 13 2020 at 15:23)</a>:</h4>
<p>in rustc, this has to be known by context</p>



<a name="190515589"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190515589" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190515589">(Mar 13 2020 at 15:23)</a>:</h4>
<p>I'm not 100% sure how this is connected to <code>WellFormed</code> goals though</p>



<a name="190515600"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190515600" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190515600">(Mar 13 2020 at 15:23)</a>:</h4>
<p>I think it's independent from that</p>



<a name="190515722"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190515722" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190515722">(Mar 13 2020 at 15:24)</a>:</h4>
<p>so maybe I'm a bit confused?</p>



<a name="190515839"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190515839" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190515839">(Mar 13 2020 at 15:24)</a>:</h4>
<p>PS, the <a href="https://gist.github.com/fe440aec437f7e8ad4cce8319954a973" target="_blank" title="https://gist.github.com/fe440aec437f7e8ad4cce8319954a973">gist link</a> is this -- same as before, though</p>



<a name="190515860"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190515860" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190515860">(Mar 13 2020 at 15:25)</a>:</h4>
<p>you're right. I switched gears because that was the problem I was encountering at the time</p>



<a name="190515879"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190515879" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190515879">(Mar 13 2020 at 15:25)</a>:</h4>
<p>I was just at the end starting to get into the <code>ty::Param</code> question</p>



<a name="190515899"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190515899" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190515899">(Mar 13 2020 at 15:25)</a>:</h4>
<p>(oh that one, about <code>Param</code>s)</p>



<a name="190515917"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190515917" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190515917">(Mar 13 2020 at 15:25)</a>:</h4>
<p>we can talk about <code>Param</code>s only for now</p>



<a name="190515942"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190515942" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190515942">(Mar 13 2020 at 15:25)</a>:</h4>
<p>there are some practical advantages to what rustc does</p>



<a name="190515955"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190515955" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190515955">(Mar 13 2020 at 15:25)</a>:</h4>
<p>but before we talk about that, do you understand what it's doing?</p>



<a name="190516097"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190516097" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190516097">(Mar 13 2020 at 15:26)</a>:</h4>
<p>I'm understanding the gist of it</p>



<a name="190516144"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190516144" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190516144">(Mar 13 2020 at 15:27)</a>:</h4>
<p>but still trying to wrap my head around it completely</p>



<a name="190516147"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190516147" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190516147">(Mar 13 2020 at 15:27)</a>:</h4>
<p>the key point is that</p>



<a name="190516177"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190516177" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190516177">(Mar 13 2020 at 15:27)</a>:</h4>
<p>when you get some type out of the <code>RustIrDatabase</code> (well, the rustc equivalent of it, which is the <code>tcx</code> queries)</p>



<a name="190516195"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190516195" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190516195">(Mar 13 2020 at 15:27)</a>:</h4>
<p>you just kind of "know" if that type needs substitution or not</p>



<a name="190516206"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190516206" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190516206">(Mar 13 2020 at 15:27)</a>:</h4>
<p>based on whether it's the type of something in your "current scope" or not</p>



<a name="190516254"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190516254" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190516254">(Mar 13 2020 at 15:28)</a>:</h4>
<p>this doesn't really all apply to chalk that much</p>



<a name="190516286"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190516286" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190516286">(Mar 13 2020 at 15:28)</a>:</h4>
<p>but in short, if you are getting the type of some other thing, like the signature of a function being called</p>



<a name="190516317"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190516317" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190516317">(Mar 13 2020 at 15:28)</a>:</h4>
<p>you always apply the substitution first to "import" it into your current type-checking context, so to speak</p>



<a name="190516338"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190516338" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190516338">(Mar 13 2020 at 15:28)</a>:</h4>
<p>and thus the <em>substitution code</em> treats <code>ty::Param</code> as a bound variable</p>



<a name="190516352"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190516352" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190516352">(Mar 13 2020 at 15:28)</a>:</h4>
<p>but the rest of the code treats it as a placeholder, essentially</p>



<a name="190516388"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190516388" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190516388">(Mar 13 2020 at 15:29)</a>:</h4>
<p>because you would never be (e.g.) unifying the type of something before you've applied the substitution</p>



<a name="190516421"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190516421" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190516421">(Mar 13 2020 at 15:29)</a>:</h4>
<p>this is why rustc has this function <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc/ty/subst/type.InternalSubsts.html#method.identity_for_item" target="_blank" title="https://doc.rust-lang.org/nightly/nightly-rustc/rustc/ty/subst/type.InternalSubsts.html#method.identity_for_item"><code>identity_for_item</code></a></p>



<a name="190516440"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190516440" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190516440">(Mar 13 2020 at 15:29)</a>:</h4>
<p>which returns a substitution like <code>0 =&gt; ty::Param(0), ...</code></p>



<a name="190516454"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190516454" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190516454">(Mar 13 2020 at 15:30)</a>:</h4>
<p>i.e., this substitution, when applied, has no effect on the actual type that results</p>



<a name="190516518"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190516518" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190516518">(Mar 13 2020 at 15:30)</a>:</h4>
<p>but "conceptually" it's replacing the bound variables with their placeholders</p>



<a name="190516525"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190516525" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190516525">(Mar 13 2020 at 15:30)</a>:</h4>
<p>which just happen to share the same representation</p>



<a name="190516605"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190516605" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190516605">(Mar 13 2020 at 15:30)</a>:</h4>
<p>I decided not to take  this approach in chalk because it's kind of conflating two concepts</p>



<a name="190516627"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190516627" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190516627">(Mar 13 2020 at 15:30)</a>:</h4>
<p>and I wanted chalk's code to be clean and resilient :)</p>



<a name="190516708"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190516708" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190516708">(Mar 13 2020 at 15:31)</a>:</h4>
<p>Is this what we do with <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc/ty/subst/type.InternalSubsts.html#method.bound_vars_for_item" target="_blank" title="https://doc.rust-lang.org/nightly/nightly-rustc/rustc/ty/subst/type.InternalSubsts.html#method.bound_vars_for_item"><code>bound_vars_for_item</code></a></p>



<a name="190516832"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190516832" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190516832">(Mar 13 2020 at 15:32)</a>:</h4>
<p>yeah, I think the "chalk translation code" uses that to convert <code>ty::Param</code> into its bound form</p>



<a name="190516869"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190516869" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190516869">(Mar 13 2020 at 15:32)</a>:</h4>
<p>there are some advantages to rustc's approach, though:</p>



<a name="190516894"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190516894" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190516894">(Mar 13 2020 at 15:33)</a>:</h4>
<ul>
<li>when you are e.g. type-checking the body of a function, you can just use the types from its signature without doing any substitution</li>
</ul>



<a name="190516962"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190516962" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190516962">(Mar 13 2020 at 15:33)</a>:</h4>
<ul>
<li>even if you do the substitution, you have fewer overall types, so you use less memory</li>
</ul>



<a name="190517193"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190517193" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190517193">(Mar 13 2020 at 15:35)</a>:</h4>
<p>sorry if I'm not talking much, trying to wrap my head around everything</p>



<a name="190517201"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190517201" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190517201">(Mar 13 2020 at 15:35)</a>:</h4>
<p>i.e., if you apply an identity substitution,</p>



<a name="190517236"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190517236" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190517236">(Mar 13 2020 at 15:36)</a>:</h4>
<p>you will get back a "logically distinct" (but actually identical) type</p>



<a name="190517281"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190517281" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190517281">(Mar 13 2020 at 15:36)</a>:</h4>
<p>which will be interned to the same pointer</p>



<a name="190517296"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190517296" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190517296">(Mar 13 2020 at 15:36)</a>:</h4>
<p>interestingly,</p>



<a name="190517304"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190517304" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190517304">(Mar 13 2020 at 15:36)</a>:</h4>
<p><em>within chalk</em>,</p>



<a name="190517319"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190517319" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190517319">(Mar 13 2020 at 15:36)</a>:</h4>
<p>I had wanted to explore the idea of separating out things a bit more by using distinct interners</p>



<a name="190517398"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190517398" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190517398">(Mar 13 2020 at 15:36)</a>:</h4>
<p>i.e., the interner that represents "types from RustIrDatabase" might be a different parameter than the interner for "types we are processing in the engine"</p>



<a name="190517410"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190517410" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190517410">(Mar 13 2020 at 15:36)</a>:</h4>
<p>even if they are both the same interner at the end</p>



<a name="190517416"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190517416" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190517416">(Mar 13 2020 at 15:37)</a>:</h4>
<p>which helps to draw these logical distinctions</p>



<a name="190517428"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190517428" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190517428">(Mar 13 2020 at 15:37)</a>:</h4>
<p>and keep them cleanly separated in the code</p>



<a name="190517451"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190517451" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190517451">(Mar 13 2020 at 15:37)</a>:</h4>
<p>anyway, let me pull this back: the question is, should we adjust chalk to match rustc, or try to meet somewhere in the middle</p>



<a name="190517461"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190517461" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190517461">(Mar 13 2020 at 15:37)</a>:</h4>
<p>I was starting to sketch what it would mean to adjust chalk to match rustc</p>



<a name="190517496"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190517496" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190517496">(Mar 13 2020 at 15:37)</a>:</h4>
<p>to get an idea of "how nice or not nice would that be"</p>



<a name="190517624"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190517624" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190517624">(Mar 13 2020 at 15:38)</a>:</h4>
<p>this is for more than just the <code>ty:Param</code> question, of course, it also applies to the bound variables schemes etc</p>



<a name="190517648"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190517648" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190517648">(Mar 13 2020 at 15:38)</a>:</h4>
<p>yeah, I was gonna say</p>



<a name="190517669"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190517669" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190517669">(Mar 13 2020 at 15:39)</a>:</h4>
<p>it seems like there are <em>a few</em> differences here</p>



<a name="190517692"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190517692" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190517692">(Mar 13 2020 at 15:39)</a>:</h4>
<p>Right, so ignoring the <code>ty::Param</code> question to start</p>



<a name="190517738"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190517738" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190517738">(Mar 13 2020 at 15:39)</a>:</h4>
<p>rustc has this early/late bound distinction and represents them differently</p>



<a name="190517765"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190517765" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190517765">(Mar 13 2020 at 15:40)</a>:</h4>
<p>we could do the same, it would <em>basically</em> mean you have two "substitution folders"</p>



<a name="190517813"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190517813" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190517813">(Mar 13 2020 at 15:40)</a>:</h4>
<p>and essentially two forms of <code>Binders</code></p>



<a name="190517891"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190517891" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190517891">(Mar 13 2020 at 15:41)</a>:</h4>
<p>(Side note that I wonder if the best way to do this would be to try and play with the code itself to show the impact?)</p>



<a name="190517919"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190517919" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190517919">(Mar 13 2020 at 15:41)</a>:</h4>
<p>on Chalk side?</p>



<a name="190517921"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190517921" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190517921">(Mar 13 2020 at 15:41)</a>:</h4>
<p>I think the impact wouldn't really be that deep ultimately</p>



<a name="190517931"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190517931" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190517931">(Mar 13 2020 at 15:41)</a>:</h4>
<p>Right, on chalk side</p>



<a name="190517946"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190517946" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190517946">(Mar 13 2020 at 15:41)</a>:</h4>
<p>in some sense, it's the "rust-ir" code that would use the early binders</p>



<a name="190517970"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190517970" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190517970">(Mar 13 2020 at 15:41)</a>:</h4>
<ul>
<li>
<p><strong>Early bound</strong> -- these are any binders attached to "declarations"<br>
  or named things, such as traits, structs, associated types. Those<br>
  are the things that, when referenced, have to get a "parameter list"<br>
  to specify the values for them.</p>
</li>
<li>
<p><strong>Late bound</strong> -- these are binders that in types, goals, and<br>
  perhaps canonical values (see below). What these have in common is<br>
  that the binder has no "def-id" and there is no construct that<br>
  instantiates the binder with a list of values (instead, we always<br>
  instantiate the binders with fresh inference variables or<br>
  placeholders).</p>
</li>
</ul>



<a name="190517995"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190517995" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190517995">(Mar 13 2020 at 15:42)</a>:</h4>
<p>(from the gist)</p>



<a name="190518028"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190518028" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190518028">(Mar 13 2020 at 15:42)</a>:</h4>
<p>yes, I've been reading it over a couple times</p>



<a name="190518053"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190518053" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190518053">(Mar 13 2020 at 15:42)</a>:</h4>
<p>maybe i'll move that to a hackmd</p>



<a name="190518199"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190518199" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190518199">(Mar 13 2020 at 15:43)</a>:</h4>
<p>Ok, so I don't know if I've missed this</p>



<a name="190518232"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190518232" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190518232">(Mar 13 2020 at 15:43)</a>:</h4>
<p>What is the <em>benefit</em> of early vs late bound?</p>



<a name="190518286"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190518286" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190518286">(Mar 13 2020 at 15:44)</a>:</h4>
<p>Like, why is making that distinction important?</p>



<a name="190518358"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190518358" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190518358">(Mar 13 2020 at 15:44)</a>:</h4>
<p>there are maybe two answers to that question</p>



<a name="190518411"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190518411" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190518411">(Mar 13 2020 at 15:45)</a>:</h4>
<p>at the <em>language level</em> we have this concept of early- vs late-bound parameters on functions that is more-or-less orthogonal from this discussion</p>



<a name="190518417"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190518417" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190518417">(Mar 13 2020 at 15:45)</a>:</h4>
<p>(I mean, functions are obvious since <code>for&lt;'a&gt; (&amp;'a)</code>)</p>



<a name="190518419"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190518419" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190518419">(Mar 13 2020 at 15:45)</a>:</h4>
<p>but it's where those terms came from</p>



<a name="190518457"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190518457" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190518457">(Mar 13 2020 at 15:46)</a>:</h4>
<p>not sure where the best description of this is; I have a really old blog post from a very different Rust that talks a bit about it</p>



<a name="190518500"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190518500" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190518500">(Mar 13 2020 at 15:46)</a>:</h4>
<p>there might be a chapter in rustc-dev-guide or something</p>



<a name="190518539"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190518539" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190518539">(Mar 13 2020 at 15:46)</a>:</h4>
<p>but as I said it's not really that important, the main thing is that when you have functions like</p>
<div class="codehilite"><pre><span></span>fn foo&lt;&#39;a, &#39;b, T&gt;(x: &amp;&#39;a u32, y: &amp;&#39;b T) where T: &#39;b { ... }
</pre></div>



<a name="190518586"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190518586" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190518586">(Mar 13 2020 at 15:47)</a>:</h4>
<p>rustc presently doesn't treat <code>'a</code> and <code>'b</code> in quite the same way --</p>



<a name="190518651"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190518651" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190518651">(Mar 13 2020 at 15:47)</a>:</h4>
<p>and in particular not <code>T</code></p>



<a name="190518733"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190518733" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190518733">(Mar 13 2020 at 15:48)</a>:</h4>
<p>the distinction is that function types can't have <code>for&lt;T&gt; { .. }</code>, only <code>for&lt;'a&gt;</code>...</p>



<a name="190518779"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190518779" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190518779">(Mar 13 2020 at 15:48)</a>:</h4>
<p>...so whenever you reference <code>foo</code> the type you get back can't be <code>for&lt;'a, 'b, T&gt; fn(&amp;'a u32, y: &amp;'b T)</code></p>



<a name="190518797"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190518797" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190518797">(Mar 13 2020 at 15:48)</a>:</h4>
<p>the <code>T</code> must be substituted "early"</p>



<a name="190518857"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190518857" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190518857">(Mar 13 2020 at 15:49)</a>:</h4>
<p>in particular if you have</p>
<div class="codehilite"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">foo</span><span class="p">;</span><span class="w"> </span><span class="c1">// T, &#39;b have to be substituted here</span>
<span class="n">x</span><span class="p">(...);</span><span class="w"> </span><span class="c1">// &#39;a substituted here, at the point of call</span>
<span class="n">x</span><span class="p">(..);</span><span class="w"> </span><span class="c1">// &#39;a substituted here with a different value</span>
</pre></div>



<a name="190518866"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190518866" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190518866">(Mar 13 2020 at 15:49)</a>:</h4>
<p>I think I've just realized I've been mixing up early and late bound regions in my mind for a bit</p>



<a name="190518869"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190518869" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190518869">(Mar 13 2020 at 15:49)</a>:</h4>
<p>anyway,  as I said, this <em>actually</em> isn't that relevant</p>



<a name="190518883"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190518883" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190518883">(Mar 13 2020 at 15:49)</a>:</h4>
<p>(and it's kind of an artificial limitation)</p>



<a name="190518906"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190518906" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190518906">(Mar 13 2020 at 15:49)</a>:</h4>
<p>(kind of)</p>



<a name="190518985"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190518985" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190518985">(Mar 13 2020 at 15:50)</a>:</h4>
<p>if the question is, why is it good to represent some bound variables one way, and others a different way</p>



<a name="190519014"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190519014" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190519014">(Mar 13 2020 at 15:50)</a>:</h4>
<p>I think that .. mm .. it really isn't particularly good</p>



<a name="190519056"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190519056" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190519056">(Mar 13 2020 at 15:50)</a>:</h4>
<p>but it is what rustc does and I suspect it's maybe convenient sometimes, I'm trying to think a bit more about that</p>



<a name="190519069"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190519069" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190519069">(Mar 13 2020 at 15:50)</a>:</h4>
<p>the other question is</p>



<a name="190519075"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190519075" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190519075">(Mar 13 2020 at 15:50)</a>:</h4>
<p>is it <em>bad</em></p>



<a name="190519108"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190519108" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190519108">(Mar 13 2020 at 15:51)</a>:</h4>
<p>I think the answer there is mostly that it's potentially confusing and hard to explain</p>



<a name="190519132"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190519132" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190519132">(Mar 13 2020 at 15:51)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/190519014" title="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/190519014">said</a>:</p>
<blockquote>
<p>I think that .. mm .. it really isn't particularly good</p>
</blockquote>
<p>well, there is also this stuff I was saying earlier,</p>



<a name="190519142"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190519142" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190519142">(Mar 13 2020 at 15:51)</a>:</h4>
<p>about having fewer types overall</p>



<a name="190519164"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190519164" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190519164">(Mar 13 2020 at 15:51)</a>:</h4>
<p>and thus using less memory</p>



<a name="190519185"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190519185" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190519185">(Mar 13 2020 at 15:51)</a>:</h4>
<p>and perhaps increasing efficiency (because you don't have to fold types in some cases, since you're just doing an identify substitution)</p>



<a name="190519294"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190519294" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190519294">(Mar 13 2020 at 15:52)</a>:</h4>
<p>I'm not sure how connected that is to the early/late distinction <em>exactly</em> but it feels at least sort of related</p>



<a name="190519353"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190519353" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190519353">(Mar 13 2020 at 15:53)</a>:</h4>
<p>that is to say, maybe you can have only one sort of parameter (eliminate debruijn indices, say) and get those same benefits</p>



<a name="190519440"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190519440" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190519440">(Mar 13 2020 at 15:53)</a>:</h4>
<p>(separately I've been pondering if we could/should try to eliminate debruijn indices, they too have advantages and disadvantages compared to other schemes we could use; some things are simpler and more efficient, but they have to be explained, and nobody knows how to spell them)</p>



<a name="190519555"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190519555" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190519555">(Mar 13 2020 at 15:54)</a>:</h4>
<p>I guess I feel a certain desire to avoid trying to figure out the perfect answer</p>



<a name="190519575"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190519575" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190519575">(Mar 13 2020 at 15:54)</a>:</h4>
<p>in other words, if we can adjust chalk to match rustc fairly easily</p>



<a name="190519595"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190519595" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190519595">(Mar 13 2020 at 15:54)</a>:</h4>
<p>we could defer a bit the question of whether we should try something different</p>



<a name="190519600"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190519600" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190519600">(Mar 13 2020 at 15:54)</a>:</h4>
<p>and explore it a bit async</p>



<a name="190519618"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190519618" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190519618">(Mar 13 2020 at 15:54)</a>:</h4>
<p>so, question</p>



<a name="190519670"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190519670" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190519670">(Mar 13 2020 at 15:55)</a>:</h4>
<p>In what cases (if any) would you have two or more levels of late-bound regions</p>



<a name="190519744"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190519744" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190519744">(Mar 13 2020 at 15:55)</a>:</h4>
<p>well, nested fn types, nested goals,</p>



<a name="190519769"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190519769" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190519769">(Mar 13 2020 at 15:55)</a>:</h4>
<p>e.g. <code>for&lt;'a&gt; fn(for&lt;'b&gt; fn(&amp;'a &amp;'b u32))</code></p>



<a name="190519776"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190519776" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190519776">(Mar 13 2020 at 15:55)</a>:</h4>
<p>ah yeah</p>



<a name="190519820"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190519820" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190519820">(Mar 13 2020 at 15:56)</a>:</h4>
<p>or <code>forall&lt;T&gt; { exists&lt;U&gt; { T = U } }</code></p>



<a name="190519900"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190519900" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190519900">(Mar 13 2020 at 15:56)</a>:</h4>
<p>PS, I have a meeting in 4 minutes :/</p>



<a name="190519924"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190519924" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190519924">(Mar 13 2020 at 15:56)</a>:</h4>
<p>I guess we didn't reach a firm conclusion but I do want to put forward this question:</p>



<a name="190519940"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190519940" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190519940">(Mar 13 2020 at 15:56)</a>:</h4>
<p>this has been helpful, I think</p>



<a name="190520000"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190520000" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190520000">(Mar 13 2020 at 15:57)</a>:</h4>
<ul>
<li>how much to emphasize  "align with rustc and make progress, then revisit best choice"</li>
<li>vs "explore all choices now and move rustc/chalk to match"</li>
</ul>



<a name="190520023"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190520023" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190520023">(Mar 13 2020 at 15:57)</a>:</h4>
<p>my sense is it may be worth sketching out somewhat the range of possibilities</p>



<a name="190520148"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190520148" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190520148">(Mar 13 2020 at 15:58)</a>:</h4>
<p>I honestly don't know if I have enough information/context to properly give the "best" answer here</p>



<a name="190520177"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190520177" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190520177">(Mar 13 2020 at 15:58)</a>:</h4>
<p>I do think the practical value of not having to refactor rustc very much is not to be overlooked, though (but of course we can refactor rustc if we want to)</p>



<a name="190520185"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190520185" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190520185">(Mar 13 2020 at 15:58)</a>:</h4>
<p>but I somewhat lean towards the second</p>



<a name="190520188"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190520188" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190520188">(Mar 13 2020 at 15:58)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232957">Jack Huey</span> <a href="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/190520148" title="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/190520148">said</a>:</p>
<blockquote>
<p>I honestly don't know if I have enough information/context to properly give the "best" answer here</p>
</blockquote>
<p>yeah :) I doubt there is a "best" answer anyway</p>



<a name="190520252"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190520252" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190520252">(Mar 13 2020 at 15:59)</a>:</h4>
<p>But I guess it sort of depends on if we <em>can</em> bridge between the two in the meantime</p>



<a name="190520319"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190520319" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190520319">(Mar 13 2020 at 15:59)</a>:</h4>
<p>to be clear I thkn we could totally bridge rustc to what chalk has now</p>



<a name="190520326"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190520326" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190520326">(Mar 13 2020 at 15:59)</a>:</h4>
<p>and I can talk you through it</p>



<a name="190520351"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190520351" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190520351">(Mar 13 2020 at 15:59)</a>:</h4>
<p>(I've been trying)</p>



<a name="190520352"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190520352" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190520352">(Mar 13 2020 at 15:59)</a>:</h4>
<p>but I think long term we don't want to be bridging</p>



<a name="190520386"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190520386" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190520386">(Mar 13 2020 at 16:00)</a>:</h4>
<p>of course</p>



<a name="190520456"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190520456" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190520456">(Mar 13 2020 at 16:00)</a>:</h4>
<p>but, along the rule of "temporary is never temporary"</p>



<a name="190520485"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190520485" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190520485">(Mar 13 2020 at 16:00)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232957">Jack Huey</span> <a href="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/190520351" title="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/190520351">said</a>:</p>
<blockquote>
<p>(I've been trying)</p>
</blockquote>
<p>&lt;3</p>



<a name="190520526"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190520526" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190520526">(Mar 13 2020 at 16:01)</a>:</h4>
<p>I feel like if we just go with "align with rustc, change later to 'better'", that "later" might not come</p>



<a name="190520542"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190520542" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190520542">(Mar 13 2020 at 16:01)</a>:</h4>
<p>or, it might be even <em>more</em> difficult</p>



<a name="190520547"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190520547" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190520547">(Mar 13 2020 at 16:01)</a>:</h4>
<p>I think that's quite possible :)</p>



<a name="190520567"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190520567" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190520567">(Mar 13 2020 at 16:01)</a>:</h4>
<p>well but one caveat is</p>



<a name="190520603"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190520603" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190520603">(Mar 13 2020 at 16:01)</a>:</h4>
<p>I think that doing the refactoring in rustc is a good way to assess true feasibility or find out some of the advantages/disadvantages that may be less apparent</p>



<a name="190520656"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190520656" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190520656">(Mar 13 2020 at 16:02)</a>:</h4>
<p>anyway I'm on this call, will ping back later, I'll at least try to skech out some of the possibilities I see</p>



<a name="190520791"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190520791" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190520791">(Mar 13 2020 at 16:03)</a>:</h4>
<p>I mean (not saying this will happen anytime <em>soon</em>) but I would <em>maybe</em> be up for trying some of these</p>



<a name="190902070"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190902070" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190902070">(Mar 17 2020 at 19:51)</a>:</h4>
<p>I've pushed more thoughts into <a href="https://gist.github.com/nikomatsakis/fe440aec437f7e8ad4cce8319954a973" target="_blank" title="https://gist.github.com/nikomatsakis/fe440aec437f7e8ad4cce8319954a973">the gist about how to represent parameters</a></p>



<a name="190903577"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190903577" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190903577">(Mar 17 2020 at 20:03)</a>:</h4>
<p><span class="user-mention" data-user-id="129457">@Florian Diebold</span> the reason I asked if you were around is that I wanted to know how rust-analyer was dealing with things like generics. What I was examining so far in that gist is that -- if we wanted to map most closely to rustc -- we would essentially create a "generic parameter placeholder" type similar to <code>ty::Param</code> (i.e., it'd probably have both an index and a def-id) that is used to represent "named parameters". This would really only be used in <code>RustIrDatbase</code>, but it would replace the use of <code>Binders</code> and debruijn indices there (and we'd have some special mode to substitute for it). I was curious if this would align well with what r-a does.</p>



<a name="190904138"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190904138" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190904138">(Mar 17 2020 at 20:07)</a>:</h4>
<p>I've kind of switched to the chalk model, using BoundVars wherever we would want to substitute them and using Param only in the placeholder function</p>



<a name="190904356"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190904356" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190904356">(Mar 17 2020 at 20:08)</a>:</h4>
<p>It used to be more like that, but I actually like how it's working now</p>



<a name="190905038"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190905038" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190905038">(Mar 17 2020 at 20:14)</a>:</h4>
<p>that's interesting feedback</p>



<a name="190905086"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190905086" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190905086">(Mar 17 2020 at 20:14)</a>:</h4>
<p>how are you managing the indices on those bound vars..? same way as chalk would, I guess?</p>



<a name="190906014"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190906014" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190906014">(Mar 17 2020 at 20:23)</a>:</h4>
<p>Yeah</p>



<a name="190906340"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190906340" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190906340">(Mar 17 2020 at 20:26)</a>:</h4>
<p>One of the tensions I've been struggling with a bit here is that I think that the "count variables" method that chalk uses has some disadvantages compared to counting binders, but it has a nice advantage in that it lets you have a single list of parameters to use for a set of substitutions on generic declarations</p>



<a name="190906402"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190906402" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190906402">(Mar 17 2020 at 20:27)</a>:</h4>
<p>Though maybe I'm overthinking this -- e.g., we could not have 'nested binders' in the rust-ir-database representation, potentially, and just have a single binder level that includes the binders from the trait etc</p>



<a name="190917065"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190917065" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190917065">(Mar 17 2020 at 22:06)</a>:</h4>
<p>PS, <span class="user-mention" data-user-id="232957">@Jack Huey</span> I'm looking a bit into your branch and pondering whether I was correct to say that the types can be bridged as is -- or rather, I suspect it could be done, but maybe it would require doing the full conversion "eagerly' and isn't worth it</p>



<a name="190917842"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190917842" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190917842">(Mar 17 2020 at 22:15)</a>:</h4>
<p>Oh</p>



<a name="190920193"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190920193" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190920193">(Mar 17 2020 at 22:41)</a>:</h4>
<p><span class="user-mention" data-user-id="232957">@Jack Huey</span> so now i'm thinking that there may be a way to "re-align" things in chalk so that we can (a) count binders but (b) put all the parameters for e.g. associated types at the same binder level. anyway, I should stop working now. I'll ponder a bit more but this might be a reasonable starting point at least.</p>



<a name="190920361"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190920361" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190920361">(Mar 17 2020 at 22:43)</a>:</h4>
<p>are parameters for associated types not in the same binder level?</p>



<a name="190980239"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190980239" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190980239">(Mar 18 2020 at 13:37)</a>:</h4>
<p><span class="user-mention" data-user-id="232957">@Jack Huey</span> currently not, but I'm not sure if this is good or not. Currently we have e.g. the impl as one binding scope and the associated type as an inner one</p>



<a name="190980271"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190980271" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190980271">(Mar 18 2020 at 13:37)</a>:</h4>
<p>the same thing applies to methods</p>



<a name="190980372"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190980372" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190980372">(Mar 18 2020 at 13:38)</a>:</h4>
<p>in rustc however we create a single unified binding scope for methods, associated types</p>



<a name="190980522"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190980522" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190980522">(Mar 18 2020 at 13:39)</a>:</h4>
<p>that said, I think the chalk structure is in some ways suboptimal (in other ways good)</p>



<a name="190980593"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190980593" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190980593">(Mar 18 2020 at 13:39)</a>:</h4>
<p>I am going to look a bit at how hard it would be to change, I suspect not so hard</p>



<a name="190981243"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190981243" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190981243">(Mar 18 2020 at 13:44)</a>:</h4>
<p>one thing I like about the way we do it in RA now (now that I'm at a keyboard) is that since we never use <code>Param</code> for substitution, we can just use the global ID of the parameter in the type. Previously, that was annoying to do because it made substitution more complicated, so we had an index in there like rustc. (And having the global ID there then makes things like printing the type cleaner)</p>



<a name="190981326"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190981326" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190981326">(Mar 18 2020 at 13:45)</a>:</h4>
<p><span class="user-mention" data-user-id="129457">@Florian Diebold</span> interesting -- so rustc has both (index + def-id)</p>



<a name="190981352"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190981352" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190981352">(Mar 18 2020 at 13:45)</a>:</h4>
<p>but you're saying that you effectively have a "placeholder" type that has a def-id, right?</p>



<a name="190981357"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190981357" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190981357">(Mar 18 2020 at 13:45)</a>:</h4>
<p>I was thinking indeed of adding such a thing</p>



<a name="190981363"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190981363" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190981363">(Mar 18 2020 at 13:45)</a>:</h4>
<p>yeah</p>



<a name="190981386"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190981386" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190981386">(Mar 18 2020 at 13:45)</a>:</h4>
<p>though I would also sort of like it if we had TLS in place</p>



<a name="190981398"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190981398" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190981398">(Mar 18 2020 at 13:45)</a>:</h4>
<p>actually, I renamed it to <code>Placeholder</code> already</p>



<a name="190981413"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/190981413" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#190981413">(Mar 18 2020 at 13:45)</a>:</h4>
<p>that told you the generics and other bits of context in scope</p>



<a name="191636548"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/191636548" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#191636548">(Mar 24 2020 at 16:27)</a>:</h4>
<p>So <span class="user-mention" data-user-id="232957">@Jack Huey</span> I think that if we were going to do integration <em>today</em> (without any further refactorings), we'd probably have to convert each <code>Ty&lt;'tcx&gt;</code> to a <code>&amp;'tcx chalk_ir::TyData&lt;TyArena&lt;'tcx&gt;&gt;</code> deeply and eagerly. Then <code>TyArena::InternedType</code> would be <code>&amp;'tcx chalk_ir::TyData&lt;Self&gt;</code>. I don't see any reason we can't do that today.</p>



<a name="191636693"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/191636693" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#191636693">(Mar 24 2020 at 16:28)</a>:</h4>
<p><em>Eventually</em> we would want to make it possible for <code>TyArena::InternedType</code> to be <code>Ty&lt;'tcx&gt;</code> and not <code>&amp;TyData</code> (and/or we want those to become more-or-less equivalent by migrating rustc)</p>



<a name="191644664"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/191644664" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#191644664">(Mar 24 2020 at 17:22)</a>:</h4>
<p>Hmm. I think this makes sense</p>



<a name="191650413"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/191650413" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#191650413">(Mar 24 2020 at 18:02)</a>:</h4>
<p>I was debating about what we should try to do in the next sprint</p>



<a name="191653254"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/191653254" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#191653254">(Mar 24 2020 at 18:26)</a>:</h4>
<p><em>palpatine voice</em>: Do it</p>



<a name="191658985"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/191658985" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#191658985">(Mar 24 2020 at 19:11)</a>:</h4>
<p>I've also been thinking about this. There's lots <em>to do</em>, it's more about getting things organized. I think it would be great to be able to get some sort of MVP for chalk reintegration in. Then we could come up with a list of things that need to be adjusted</p>



<a name="192080255"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192080255" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192080255">(Mar 27 2020 at 21:06)</a>:</h4>
<p><span class="user-mention" data-user-id="232957">@Jack Huey</span> -- you have some kind of "extended def-id", right?</p>



<a name="192080281"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192080281" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192080281">(Mar 27 2020 at 21:06)</a>:</h4>
<p>in your branch, I mean</p>



<a name="192080287"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192080287" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192080287">(Mar 27 2020 at 21:06)</a>:</h4>
<p>do you have a link to that?</p>



<a name="192080365"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192080365" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192080365">(Mar 27 2020 at 21:07)</a>:</h4>
<p>yes</p>



<a name="192080425"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192080425" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192080425">(Mar 27 2020 at 21:07)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/pull/69406/files#diff-57dad27d24554a6c8bc73a6fdb28debcR15" title="https://github.com/rust-lang/rust/pull/69406/files#diff-57dad27d24554a6c8bc73a6fdb28debcR15">https://github.com/rust-lang/rust/pull/69406/files#diff-57dad27d24554a6c8bc73a6fdb28debcR15</a></p>



<a name="192081335"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192081335" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192081335">(Mar 27 2020 at 21:14)</a>:</h4>
<p>thanks</p>



<a name="192093551"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192093551" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192093551">(Mar 27 2020 at 23:46)</a>:</h4>
<p>would be nice to put all of those that don't have a <code>DefId</code> themselves, behind a <code>Builtin</code> variant :P</p>



<a name="192093566"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192093566" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192093566">(Mar 27 2020 at 23:46)</a>:</h4>
<p>(but also this seems to miss the distinction between <code>*mut T</code> and <code>*const T</code>?</p>



<a name="192094963"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192094963" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192094963">(Mar 28 2020 at 00:12)</a>:</h4>
<p>Yeah this is pretty hacky so far</p>



<a name="192094989"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192094989" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192094989">(Mar 28 2020 at 00:12)</a>:</h4>
<p>I think we were talking about maybe moving this to <code>TypeName</code></p>



<a name="192095007"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192095007" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192095007">(Mar 28 2020 at 00:12)</a>:</h4>
<p>This misses a few other types</p>



<a name="192095017"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192095017" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192095017">(Mar 28 2020 at 00:12)</a>:</h4>
<p>(haven't gotten to them yet)</p>



<a name="192098057"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192098057" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192098057">(Mar 28 2020 at 01:19)</a>:</h4>
<p>indeed, the idea is not to need this type at all when we're done</p>



<a name="192215074"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192215074" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192215074">(Mar 30 2020 at 06:21)</a>:</h4>
<p>So, something I'm running into</p>



<a name="192215134"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192215134" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192215134">(Mar 30 2020 at 06:22)</a>:</h4>
<p>So, rustc is generating goals like <code>WellFormed(^0)</code></p>



<a name="192215142"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192215142" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192215142">(Mar 30 2020 at 06:22)</a>:</h4>
<p>So, asking if a BoundVar is well-formed</p>



<a name="192215150"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192215150" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192215150">(Mar 30 2020 at 06:22)</a>:</h4>
<p>which...we don't do in Chalk</p>



<a name="192215159"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192215159" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192215159">(Mar 30 2020 at 06:23)</a>:</h4>
<p>so this just flounders and leads to an ambiguous solution</p>



<a name="192215167"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192215167" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192215167">(Mar 30 2020 at 06:23)</a>:</h4>
<p>I think</p>



<a name="192215223"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192215223" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192215223">(Mar 30 2020 at 06:24)</a>:</h4>
<p>err</p>



<a name="192215230"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192215230" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192215230">(Mar 30 2020 at 06:24)</a>:</h4>
<p>well, yes that</p>



<a name="192215877"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192215877" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192215877">(Mar 30 2020 at 06:36)</a>:</h4>
<p>but also, I think we're missing the WellFormed(Fn) clause</p>



<a name="192295057"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192295057" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192295057">(Mar 30 2020 at 18:05)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> you around?</p>



<a name="192295124"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192295124" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192295124">(Mar 30 2020 at 18:05)</a>:</h4>
<p>I have like 3 (maybe 4) questions</p>



<a name="192295362"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192295362" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192295362">(Mar 30 2020 at 18:07)</a>:</h4>
<p>1) How would you feel about adding a stopgap solution for builtin traits. A <code>force_impl_for(&amp;self, wellknown: WellKnownTrait, ...)</code> function to <code>Interner</code>. Then rustc can just return true for types based on internal logic</p>



<a name="192295637"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192295637" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192295637">(Mar 30 2020 at 18:08)</a>:</h4>
<p>2) For <code>Fn</code>s, we should add a <code>WellFormed(Fn) :- WellFormed(inputs and outputs)</code> (obviously enumerated for each) right?</p>



<a name="192295707"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192295707" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192295707">(Mar 30 2020 at 18:09)</a>:</h4>
<p>3) For placeholders, we should add a <code>WellFormed(placeholder) :- FromEnv(placeholder)</code>?</p>



<a name="192295911"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192295911" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192295911">(Mar 30 2020 at 18:10)</a>:</h4>
<p>4) rustc definitely is generated goals with a bound var:</p>
<div class="codehilite"><pre><span></span>Canonical {
    max_universe: U0,
    variables: [
        CanonicalVarInfo {
            kind: Ty(
                General(
                    U0,
                ),
            ),
        },
    ],
    value: InEnvironment {
        environment: Environment {
            clauses: [],
        },
        goal: Binder(
            TraitPredicate(&lt;^1_0 as std::marker::Sized&gt;),
        ),
    },
}
</pre></div>



<a name="192295933"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192295933" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192295933">(Mar 30 2020 at 18:10)</a>:</h4>
<p>How do I handle this?</p>



<a name="192296665"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192296665" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192296665">(Mar 30 2020 at 18:16)</a>:</h4>
<p>it's completely normal that such goals are generated I think, usually the bound var will be inferred to something more specific later</p>



<a name="192297349"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192297349" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192297349">(Mar 30 2020 at 18:22)</a>:</h4>
<p>I mean, is there any that <em>should</em> be returned other than ambiguous?</p>



<a name="192298107"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192298107" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192298107">(Mar 30 2020 at 18:28)</a>:</h4>
<p>as far as I understand it, it should just be ambiguous</p>



<a name="192298327"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192298327" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192298327">(Mar 30 2020 at 18:30)</a>:</h4>
<p>okay</p>



<a name="192300140"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192300140" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192300140">(Mar 30 2020 at 18:45)</a>:</h4>
<p>The other strange thing about these goals is that the debruijn index is 1, not 0</p>



<a name="192300215"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192300215" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192300215">(Mar 30 2020 at 18:46)</a>:</h4>
<p>but there's not a second Binder</p>



<a name="192300247"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192300247" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192300247">(Mar 30 2020 at 18:46)</a>:</h4>
<p>I guess the variables count as binders?</p>



<a name="192300504"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192300504" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192300504">(Mar 30 2020 at 18:48)</a>:</h4>
<p>yeah, duh</p>



<a name="192316400"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192316400" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192316400">(Mar 30 2020 at 20:57)</a>:</h4>
<p>yeah, the "canonical" is a binder</p>



<a name="192316425"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192316425" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192316425">(Mar 30 2020 at 20:57)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232957">Jack Huey</span> <a href="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/192215134" title="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/192215134">said</a>:</p>
<blockquote>
<p>So, rustc is generating goals like <code>WellFormed(^0)</code></p>
</blockquote>
<p>hmm so what rustc means and what we mean by WF may be a bit different</p>



<a name="192316543"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192316543" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192316543">(Mar 30 2020 at 20:58)</a>:</h4>
<p>I was pondering today that I have to bring the implied bounds back into cache, and that it might be nice if made chalk match rustc's current behavior to start</p>



<a name="192316559"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192316559" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192316559">(Mar 30 2020 at 20:59)</a>:</h4>
<p>(that's tied up a bit in the <code>WellFormed</code> goal stuff, is why I mention it)</p>



<a name="192316596"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192316596" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192316596">(Mar 30 2020 at 20:59)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232957">Jack Huey</span> <a href="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/192215877" title="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/192215877">said</a>:</p>
<blockquote>
<p>but also, I think we're missing the WellFormed(Fn) clause</p>
</blockquote>
<p>I'm not quite sure what <code>Fn</code> is here I guess -- the special type for functions?</p>



<a name="192316600"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192316600" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192316600">(Mar 30 2020 at 20:59)</a>:</h4>
<p>ah</p>



<a name="192316609"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192316609" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192316609">(Mar 30 2020 at 20:59)</a>:</h4>
<p>i.e., the <em>chalk</em> type for fn pointers?</p>



<a name="192316702"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192316702" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192316702">(Mar 30 2020 at 21:00)</a>:</h4>
<p>the WF rules there are perhaps a bit weird because of the bound variables</p>



<a name="192316847"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192316847" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192316847">(Mar 30 2020 at 21:01)</a>:</h4>
<p>I think the right rule might even just be <code>WellFormed(Fn).</code> -- i.e., those types are <em>always</em> well-formed, although I don't think this is quite what rustc does. (I think we try to test that the argument types are well-formed, but only if they don't contain bound regions; it's kind of an "optional" check, since ultimately we'll test that the argument/return types are well-formed at the point of call -- this is how we were handling well-formedness before I really underestood the right way to do it)</p>



<a name="192422569"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192422569" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192422569">(Mar 31 2020 at 17:30)</a>:</h4>
<p>Yeah, rustc is definitely doing things we aren't</p>



<a name="192422676"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192422676" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192422676">(Mar 31 2020 at 17:31)</a>:</h4>
<p>so, the <code>Fn</code> type here is Chalk's <code>Fn</code> (held by <code>TyData::Function</code></p>



<a name="192422715"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192422715" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192422715">(Mar 31 2020 at 17:31)</a>:</h4>
<p>Or rustc's <code>FnPtr</code></p>



<a name="192422849"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192422849" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192422849">(Mar 31 2020 at 17:32)</a>:</h4>
<p>rustc generates obligations that <code>WellFormed(Fn)</code> if all the inputs and outputs are well formed</p>



<a name="192422869"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192422869" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192422869">(Mar 31 2020 at 17:32)</a>:</h4>
<p>(and I just matched that locally)</p>



<a name="192422916"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192422916" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192422916">(Mar 31 2020 at 17:33)</a>:</h4>
<p>and yeah, without bound variables</p>



<a name="192423259"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192423259" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192423259">(Mar 31 2020 at 17:35)</a>:</h4>
<p>so, with a stopgap solution to allow forcing builtin clauses from rustc, I've got the <code>builtin-copy-clone</code> test passing</p>



<a name="192428100"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192428100" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192428100">(Mar 31 2020 at 18:11)</a>:</h4>
<p>what does "forcing" builtin clauses mean?</p>



<a name="192428255"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192428255" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192428255">(Mar 31 2020 at 18:12)</a>:</h4>
<p>Basically just overriding any (currently missing) logic in <code>chalk_solve</code> to add the clause</p>



<a name="192428340"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192428340" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192428340">(Mar 31 2020 at 18:13)</a>:</h4>
<div class="codehilite"><pre><span></span>    if db.force_impl_for(well_known, ty) {
        builder.push_fact(trait_ref.clone());
    }
</pre></div>



<a name="192428362"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192428362" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192428362">(Mar 31 2020 at 18:13)</a>:</h4>
<p>I saw the comment now</p>



<a name="192428384"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192428384" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192428384">(Mar 31 2020 at 18:13)</a>:</h4>
<p>in the short term, seems ok, but I don't think we want it long term</p>



<a name="192428412"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192428412" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192428412">(Mar 31 2020 at 18:13)</a>:</h4>
<p>No, definitely not something we want long term</p>



<a name="192428515"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192428515" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192428515">(Mar 31 2020 at 18:14)</a>:</h4>
<p>Though, we will have to think about how to deal with specific <code>Apply</code> types</p>



<a name="192428550"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192428550" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192428550">(Mar 31 2020 at 18:14)</a>:</h4>
<p>e.g. <code>Bool</code>, <code>Int</code>,etc. vs. <code>Str</code></p>



<a name="192429099"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192429099" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192429099">(Mar 31 2020 at 18:18)</a>:</h4>
<p>Ok, so for <code>WellFormed(Fn)</code>, I should change this to just be fact?</p>



<a name="192430624"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192430624" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192430624">(Mar 31 2020 at 18:30)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> when you get a chance: <a href="https://github.com/rust-lang/chalk/pull/367" title="https://github.com/rust-lang/chalk/pull/367">https://github.com/rust-lang/chalk/pull/367</a></p>



<a name="192430671"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192430671" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192430671">(Mar 31 2020 at 18:30)</a>:</h4>
<p>cc <span class="user-mention" data-user-id="220273">@Jane Lusby</span> re. builtin traits</p>



<a name="192430675"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192430675" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192430675">(Mar 31 2020 at 18:30)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232957">Jack Huey</span> <a href="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/192428515" title="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/192428515">said</a>:</p>
<blockquote>
<p>Though, we will have to think about how to deal with specific <code>Apply</code> types</p>
</blockquote>
<p>in what sense?</p>



<a name="192430689"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192430689" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192430689">(Mar 31 2020 at 18:30)</a>:</h4>
<p>I expect us to add variants to the <code>ApplyName</code> in chalk for al the rust types</p>



<a name="192430703"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192430703" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192430703">(Mar 31 2020 at 18:30)</a>:</h4>
<p>and just add those rules into chalk-solve</p>



<a name="192430734"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192430734" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192430734">(Mar 31 2020 at 18:30)</a>:</h4>
<p>That works</p>



<a name="192430800"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192430800" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192430800">(Mar 31 2020 at 18:31)</a>:</h4>
<p>it's a bit of a shift for chalk, in that we've traditionally kind of avoided getting into all the "grungy details" of Rust</p>



<a name="192430807"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192430807" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192430807">(Mar 31 2020 at 18:31)</a>:</h4>
<p>but I think it's right</p>



<a name="192430824"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192430824" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192430824">(Mar 31 2020 at 18:31)</a>:</h4>
<p>chalk should I think encapsulate all you need to have a full trait solver</p>



<a name="192430833"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192430833" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192430833">(Mar 31 2020 at 18:31)</a>:</h4>
<p>but <em>nothing more than that</em></p>



<a name="192430930"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192430930" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192430930">(Mar 31 2020 at 18:32)</a>:</h4>
<p>and it seems like knowing that <code>u32: Copy</code> is just part of that to me</p>



<a name="192430958"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192430958" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192430958">(Mar 31 2020 at 18:32)</a>:</h4>
<p>otherwise, rust-analyzer + rustc would ahve to duplicate it</p>



<a name="192431175"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192431175" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192431175">(Mar 31 2020 at 18:34)</a>:</h4>
<p>yeah</p>



<a name="192431208"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192431208" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192431208">(Mar 31 2020 at 18:34)</a>:</h4>
<p>I wonder if there's opportunity to split <code>chalk_solve</code> into two</p>



<a name="192431245"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192431245" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192431245">(Mar 31 2020 at 18:34)</a>:</h4>
<p>One for the solving details without these bits, and one for these bits</p>



<a name="192431449"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192431449" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> detrumi <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192431449">(Mar 31 2020 at 18:36)</a>:</h4>
<p>Can you do that without needing to split enums as well?</p>



<a name="192431561"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192431561" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192431561">(Mar 31 2020 at 18:37)</a>:</h4>
<p>I don't know</p>



<a name="192431729"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192431729" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> detrumi <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192431729">(Mar 31 2020 at 18:38)</a>:</h4>
<p>But yeah, interesting idea.</p>



<a name="192563235"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192563235" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192563235">(Apr 01 2020 at 17:25)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> you around?</p>



<a name="192563290"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192563290" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192563290">(Apr 01 2020 at 17:26)</a>:</h4>
<p>yeah</p>



<a name="192563300"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192563300" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192563300">(Apr 01 2020 at 17:26)</a>:</h4>
<p>more or less</p>



<a name="192563321"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192563321" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192563321">(Apr 01 2020 at 17:26)</a>:</h4>
<p>So, thinking about how to "deeply" convert rustc types to chalk, and back</p>



<a name="192563332"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192563332" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192563332">(Apr 01 2020 at 17:26)</a>:</h4>
<p>specifically about Params</p>



<a name="192563391"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192563391" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192563391">(Apr 01 2020 at 17:26)</a>:</h4>
<p>so, my thought is in <em>most</em> cases we can just convert to a placeholder</p>



<a name="192563428"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192563428" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192563428">(Apr 01 2020 at 17:27)</a>:</h4>
<p>the problem though, is converting <em>back</em></p>



<a name="192563734"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192563734" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192563734">(Apr 01 2020 at 17:29)</a>:</h4>
<p>I'm somewhat confused/thinking through what the universe of the placeholder would be</p>



<a name="192563799"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192563799" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192563799">(Apr 01 2020 at 17:29)</a>:</h4>
<p>More or less, the universe roughly translates to a level of binder removed right?</p>



<a name="192563979"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192563979" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192563979">(Apr 01 2020 at 17:30)</a>:</h4>
<p>hmm</p>



<a name="192564014"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192564014" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192564014">(Apr 01 2020 at 17:31)</a>:</h4>
<p>why do we have to convert.. oh, duh, inference hints?</p>



<a name="192564029"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192564029" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192564029">(Apr 01 2020 at 17:31)</a>:</h4>
<p>I had sort of hoped to avoid converting back to start I think :)</p>



<a name="192564041"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192564041" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192564041">(Apr 01 2020 at 17:31)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232957">Jack Huey</span> <a href="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/192563734" title="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/192563734">said</a>:</p>
<blockquote>
<p>I'm somewhat confused/thinking through what the universe of the placeholder would be</p>
</blockquote>
<p>root</p>



<a name="192564058"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192564058" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192564058">(Apr 01 2020 at 17:31)</a>:</h4>
<p>but that's partly a cheat</p>



<a name="192564090"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192564090" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192564090">(Apr 01 2020 at 17:31)</a>:</h4>
<p>so like <code>forall&lt;1&gt; { forall&lt;0&gt; { ^1: ^0 } }</code> -&gt; <code>forall&lt;0&gt; { !0_0: ^0 }</code> -&gt; <code>!1_0: !0_0</code></p>



<a name="192564100"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192564100" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192564100">(Apr 01 2020 at 17:31)</a>:</h4>
<p>still, I think we could definitely convert <code>ParamTy</code> to a placeholder in the root universe with the given index</p>



<a name="192564112"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192564112" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192564112">(Apr 01 2020 at 17:31)</a>:</h4>
<p>(or is that wildy wrong)</p>



<a name="192564119"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192564119" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192564119">(Apr 01 2020 at 17:31)</a>:</h4>
<p>we will never create placeholders in that universe "normally" in chalk</p>



<a name="192564181"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192564181" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192564181">(Apr 01 2020 at 17:32)</a>:</h4>
<p>it's off by one</p>



<a name="192564192"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192564192" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192564192">(Apr 01 2020 at 17:32)</a>:</h4>
<p>I believe we <em>first</em> introduce a new universe</p>



<a name="192564206"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192564206" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192564206">(Apr 01 2020 at 17:32)</a>:</h4>
<p>then create the placeholders in it</p>



<a name="192564216"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192564216" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192564216">(Apr 01 2020 at 17:32)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/192564100" title="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/192564100">said</a>:</p>
<blockquote>
<p>still, I think we could definitely convert <code>ParamTy</code> to a placeholder in the root universe with the given index</p>
</blockquote>
<p>that's what I've been doing I think</p>



<a name="192564225"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192564225" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192564225">(Apr 01 2020 at 17:32)</a>:</h4>
<p>they don't get added to the <em>existing</em> universe, that wouldn't make sense</p>



<a name="192564256"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192564256" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192564256">(Apr 01 2020 at 17:32)</a>:</h4>
<p>i.e., they're supposed to be fresh types that don't alias anything that exists, so you have to put them in a new universe</p>



<a name="192564265"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192564265" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192564265">(Apr 01 2020 at 17:32)</a>:</h4>
<p>but let me double check</p>



<a name="192564335"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192564335" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192564335">(Apr 01 2020 at 17:33)</a>:</h4>
<p>right --</p>



<a name="192564345"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192564345" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192564345">(Apr 01 2020 at 17:33)</a>:</h4>
<p><a href="http://rust-lang.github.io/chalk/src/chalk_solve/infer/instantiate.rs.html#86" title="http://rust-lang.github.io/chalk/src/chalk_solve/infer/instantiate.rs.html#86">line 86</a> creates a new universe</p>



<a name="192564377"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192564377" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192564377">(Apr 01 2020 at 17:33)</a>:</h4>
<p>and then <a href="http://rust-lang.github.io/chalk/src/chalk_solve/infer/instantiate.rs.html#91" title="http://rust-lang.github.io/chalk/src/chalk_solve/infer/instantiate.rs.html#91">line 91</a> puts placeholders in it</p>



<a name="192564521"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192564521" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192564521">(Apr 01 2020 at 17:34)</a>:</h4>
<p>hmm</p>



<a name="192564792"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192564792" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192564792">(Apr 01 2020 at 17:36)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/192564029" title="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/192564029">said</a>:</p>
<blockquote>
<p>I had sort of hoped to avoid converting back to start I think :)</p>
</blockquote>
<p>Hmm, let me double check that there are currently cases in the few tests where we do have to convert back</p>



<a name="192565261"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192565261" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192565261">(Apr 01 2020 at 17:40)</a>:</h4>
<p>so, if we <em>do</em> have to convert back</p>



<a name="192565271"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192565271" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192565271">(Apr 01 2020 at 17:40)</a>:</h4>
<p>the idea that I had:</p>



<a name="192565377"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192565377" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192565377">(Apr 01 2020 at 17:41)</a>:</h4>
<p>was we start by folding through the goal, and collecting the params, create a placeholder, and store a map of that placeholder to the param</p>



<a name="192565415"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192565415" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192565415">(Apr 01 2020 at 17:41)</a>:</h4>
<p>(replacing the param with the placeholder as we go)</p>



<a name="192565573"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192565573" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192565573">(Apr 01 2020 at 17:42)</a>:</h4>
<p>then, if we have placeholders in the solution, we can just map back</p>



<a name="192748160"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192748160" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192748160">(Apr 03 2020 at 01:10)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> so I wrote the code to collect bound vars for the rustc integration</p>



<a name="192748168"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192748168" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192748168">(Apr 03 2020 at 01:10)</a>:</h4>
<p>and to convert params to placeholders</p>



<a name="192748212"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192748212" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192748212">(Apr 03 2020 at 01:11)</a>:</h4>
<p>starting here: <a href="https://github.com/rust-lang/rust/pull/69406/files#diff-2c4ca7669b79bd3e9c8c06315b1b1f33R520" title="https://github.com/rust-lang/rust/pull/69406/files#diff-2c4ca7669b79bd3e9c8c06315b1b1f33R520">https://github.com/rust-lang/rust/pull/69406/files#diff-2c4ca7669b79bd3e9c8c06315b1b1f33R520</a></p>



<a name="192748284"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192748284" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192748284">(Apr 03 2020 at 01:12)</a>:</h4>
<p>Right now,  we theoretically <em>could</em> convert any placeholders <em>back</em> in the solution, since we do this eagerly</p>



<a name="192748305"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192748305" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192748305">(Apr 03 2020 at 01:13)</a>:</h4>
<p>Bound vars, I don't we need to convert back?</p>



<a name="192748437"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192748437" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192748437">(Apr 03 2020 at 01:15)</a>:</h4>
<p>but anyways, trying to get the inherent_impl test to pass</p>



<a name="192748465"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192748465" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192748465">(Apr 03 2020 at 01:16)</a>:</h4>
<p>And ending up with this error:</p>
<div class="codehilite"><pre><span></span>error[E0308]: mismatched types
  --&gt; /home/hueyj/temp/rust/rust/src/test/ui/chalkify/inherent_impl.rs:17:18
   |
LL | impl&lt;T&gt; S&lt;T&gt; {
   |      - this type parameter
...
LL |         only_foo(&amp;self.x)
   |                  ^^^^^^^ expected `i32`, found type parameter `T`
   |
   = note: expected reference `&amp;i32`
              found reference `&amp;T`
   = help: type parameters must be constrained to match other types
   = note: for more information, visit https://doc.rust-lang.org/book/ch10-02-traits.html#traits-as-parameters
</pre></div>



<a name="192748510"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192748510" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192748510">(Apr 03 2020 at 01:16)</a>:</h4>
<p>And I'm not exactly sure which one of the solutions I'm returning is the problem</p>



<a name="192748540"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192748540" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192748540">(Apr 03 2020 at 01:17)</a>:</h4>
<p>none of them are a Param...</p>



<a name="192748627"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192748627" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192748627">(Apr 03 2020 at 01:19)</a>:</h4>
<p>the goal/solution that seems most relevant is this one:</p>
<div class="codehilite"><pre><span></span>[src/librustc_traits/chalk/mod.rs:175] &amp;_lowered_goal = UCanonical {
    canonical: Canonical {
        value: InEnvironment {
            environment: Env([for&lt;&gt; FromEnv(Ty(!1_0): TraitId(Trait(DefId(2:1893 ~ core[797c]::marker[0]::Sized[0])))), for&lt;&gt; FromEnv(Ty(!1_1): TraitId(Trait(DefId(2:1893 ~ core[797c]::marker[0]::Sized[0])))), for&lt;&gt; FromEnv(Ty(!1_1): TraitId(Trait(DefId(0:13 ~ inherent_impl[317d]::Bar[0])))), FromEnv(StructId(Ref(Not))&lt;Lifetime(&#39;^0.0), Ty(StructId(Adt(DefId(0:5 ~ inherent_impl[317d]::S[0])))&lt;Ty(!0_0)&gt;)&gt;), FromEnv(StructId(Adt(DefId(0:5 ~ inherent_impl[317d]::S[0])))&lt;Ty(!0_0)&gt;), FromEnv(!0_0)]),
            goal: ForAll&lt;&gt; { Implemented(Ty(^1.1): TraitId(Trait(DefId(0:3 ~ inherent_impl[317d]::Foo[0])))) },
        },
        binders: [
            Lifetime(U0),
            Ty(U0),
        ],
    },
    universes: 1,
}
[src/librustc_traits/chalk/mod.rs:176] solution = Some(
    Unique(
        Canonical {
            value: ConstrainedSubst {
                subst: [Lifetime(&#39;^0.0), Ty(StructId(Int(I32)))],
                constraints: [],
            },
            binders: [
                Lifetime(U0),
            ],
        },
    ),
)
</pre></div>



<a name="192748730"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192748730" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192748730">(Apr 03 2020 at 01:21)</a>:</h4>
<p>there's also this one:</p>
<div class="codehilite"><pre><span></span>[src/librustc_traits/chalk/mod.rs:175] &amp;_lowered_goal = UCanonical {
    canonical: Canonical {
        value: InEnvironment {
            environment: Env([]),
            goal: ForAll&lt;&gt; { Implemented(Ty(^1.0): TraitId(Trait(DefId(0:3 ~ inherent_impl[317d]::Foo[0])))) },
        },
        binders: [
            Ty(U0),
        ],
    },
    universes: 1,
}
[src/librustc_traits/chalk/mod.rs:176] solution = Some(
    Unique(
        Canonical {
            value: ConstrainedSubst {
                subst: [Ty(StructId(Int(I32)))],
                constraints: [],
            },
            binders: [],
        },
    ),
)
</pre></div>



<a name="192748949"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192748949" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192748949">(Apr 03 2020 at 01:25)</a>:</h4>
<p>So, I'm obviously doing something wrong <em>somewhere</em> and I would appreciate it if you could take a look</p>



<a name="192749026"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192749026" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192749026">(Apr 03 2020 at 01:26)</a>:</h4>
<p>But, assuming that we're okay with the stopgap builtin traits solution for the MVP, once we get this fixed, that should be enough for the MVP to be "done"</p>



<a name="192749037"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192749037" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192749037">(Apr 03 2020 at 01:27)</a>:</h4>
<p>I'll obviously have to cleanup everything (lots of dbg statements everywhere), and rebase/fmt/etc.</p>



<a name="192749040"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192749040" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192749040">(Apr 03 2020 at 01:27)</a>:</h4>
<p>But I think this is pretty close</p>



<a name="192749798"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192749798" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192749798">(Apr 03 2020 at 01:45)</a>:</h4>
<p>I'm wondering if the error here is backwards</p>



<a name="192749814"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192749814" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192749814">(Apr 03 2020 at 01:46)</a>:</h4>
<p>That we're returning i32 but expecting the Param <code>T</code></p>



<a name="192749866"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192749866" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192749866">(Apr 03 2020 at 01:46)</a>:</h4>
<p>Ah yeah</p>



<a name="192749871"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192749871" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192749871">(Apr 03 2020 at 01:47)</a>:</h4>
<p>We're essentially checking this:</p>
<div class="codehilite"><pre><span></span>fn only_foo&lt;T: Foo&gt;(_x: &amp;T) { }

impl&lt;T&gt; S&lt;T&gt; {
    // Test that we have the correct environment inside an inherent method.
    fn dummy_foo(&amp;self) {
        only_foo(&amp;self.x)
    }
}
</pre></div>



<a name="192749950"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192749950" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192749950">(Apr 03 2020 at 01:48)</a>:</h4>
<p>So this bit of the environment is important <code>for&lt;&gt; FromEnv(Ty(!1_0): TraitId(Trait(DefId(0:3 ~ inherent_impl[317d]::Foo[0]))))</code></p>



<a name="192751379"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192751379" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192751379">(Apr 03 2020 at 02:20)</a>:</h4>
<p>ah, so I think this should be returning ambiguous here</p>



<a name="192751384"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192751384" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192751384">(Apr 03 2020 at 02:20)</a>:</h4>
<p>And the reason why it's not</p>



<a name="192751395"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192751395" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192751395">(Apr 03 2020 at 02:20)</a>:</h4>
<p>is because that <code>FromEnv(...)</code> clause isn't getting counted</p>



<a name="192751734"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192751734" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192751734">(Apr 03 2020 at 02:28)</a>:</h4>
<p>Do we...never add the environment clauses to the list of program clauses that could match?</p>



<a name="192751762"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192751762" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192751762">(Apr 03 2020 at 02:29)</a>:</h4>
<p>How can that be</p>



<a name="192752421"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192752421" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192752421">(Apr 03 2020 at 02:45)</a>:</h4>
<p>Wait where did I get that <code>FromEnv</code> clause from</p>



<a name="192836971"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192836971" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192836971">(Apr 03 2020 at 17:19)</a>:</h4>
<p><span class="user-mention" data-user-id="232957">@Jack Huey</span> We have to convert the predicates you find in the <code>ParamEnv</code> into "from-env" predicates</p>



<a name="192837009"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192837009" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192837009">(Apr 03 2020 at 17:19)</a>:</h4>
<p>There is a bit of a "two modes" thing here -- the same where-clause, when appearing in the environment, becomes <code>FromEnv</code>, and when apperaing as a goal to prove, is <code>Implemented</code></p>



<a name="192837022"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192837022" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192837022">(Apr 03 2020 at 17:19)</a>:</h4>
<p>maybe that's the problem?</p>



<a name="192837120"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192837120" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192837120">(Apr 03 2020 at 17:20)</a>:</h4>
<p>Can you elaborate that first sentence?</p>



<a name="192838531"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192838531" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192838531">(Apr 03 2020 at 17:31)</a>:</h4>
<p>So, the environment is getting correctly converted I think</p>



<a name="192838544"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192838544" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192838544">(Apr 03 2020 at 17:31)</a>:</h4>
<p>I think there's a couple things going on here</p>



<a name="192838673"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192838673" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192838673">(Apr 03 2020 at 17:32)</a>:</h4>
<p>The first one is there impl definition <code>impl&lt;T&gt; S&lt;T&gt; { ... }</code></p>



<a name="192838749"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192838749" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192838749">(Apr 03 2020 at 17:33)</a>:</h4>
<p>Is that supposed to be <code>impl&lt;T: Foo&gt; S&lt;T&gt; { ... }</code>?</p>



<a name="192838891"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192838891" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192838891">(Apr 03 2020 at 17:34)</a>:</h4>
<p>(this is why I'm not seeing this clause <code>for&lt;&gt; FromEnv(Ty(!1_0): TraitId(Trait(DefId(0:3 ~ inherent_impl[317d]::Foo[0]))))</code> in the environment)</p>



<a name="192838968"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192838968" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192838968">(Apr 03 2020 at 17:34)</a>:</h4>
<p>second, even when I change the inherent_impl test to <code>impl&lt;T: Foo&gt; ...</code>, there is still the same error, which I'm checking</p>



<a name="192839003"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192839003" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192839003">(Apr 03 2020 at 17:35)</a>:</h4>
<p>but that FromEnv clause does appear in the environment</p>



<a name="192840076"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192840076" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192840076">(Apr 03 2020 at 17:43)</a>:</h4>
<p>okay so it seems <code>!1_0</code> can't unify with the <code>?1</code> of the goal <code>FromEnv(Ty(?1): TraitId(Trait(DefId(0:3 ~ inherent_impl[317d]::Foo[0]))))</code></p>



<a name="192842804"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192842804" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192842804">(Apr 03 2020 at 18:04)</a>:</h4>
<p>yeah, okay, I'm gonna have to think about this a lot harder later</p>



<a name="192842936"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192842936" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192842936">(Apr 03 2020 at 18:05)</a>:</h4>
<p>Because I need to look at/think about more thing now (e.g. OccursCheck, unifying w/ universes, placeholder universes as we change tables)</p>



<a name="192847180"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192847180" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192847180">(Apr 03 2020 at 18:38)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232957">Jack Huey</span> <a href="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/192838673" title="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/192838673">said</a>:</p>
<blockquote>
<p>The first one is there impl definition <code>impl&lt;T&gt; S&lt;T&gt; { ... }</code></p>
</blockquote>
<p>What are you reading this from?</p>



<a name="192847220"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192847220" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192847220">(Apr 03 2020 at 18:39)</a>:</h4>
<p>I'l try to look in more detail at your code in just a bit, trying to get through my notifications first</p>



<a name="192848856"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192848856" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192848856">(Apr 03 2020 at 18:52)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/pull/69406/files#diff-b92c83fac73fe9d1333abc149ec0b55cR14" title="https://github.com/rust-lang/rust/pull/69406/files#diff-b92c83fac73fe9d1333abc149ec0b55cR14">https://github.com/rust-lang/rust/pull/69406/files#diff-b92c83fac73fe9d1333abc149ec0b55cR14</a></p>



<a name="192848962"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192848962" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192848962">(Apr 03 2020 at 18:53)</a>:</h4>
<p>I can also give you the massive stderr file with all the dbg and CHALK_DEBUG output, if you think that would be helpful</p>



<a name="192851328"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192851328" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192851328">(Apr 03 2020 at 19:12)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232957">Jack Huey</span> <a href="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/192848856" title="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/192848856">said</a>:</p>
<blockquote>
<p><a href="https://github.com/rust-lang/rust/pull/69406/files#diff-b92c83fac73fe9d1333abc149ec0b55cR14" title="https://github.com/rust-lang/rust/pull/69406/files#diff-b92c83fac73fe9d1333abc149ec0b55cR14">https://github.com/rust-lang/rust/pull/69406/files#diff-b92c83fac73fe9d1333abc149ec0b55cR14</a></p>
</blockquote>
<p>ok, so</p>



<a name="192851341"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192851341" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192851341">(Apr 03 2020 at 19:12)</a>:</h4>
<p>the reason that this test is written the way it is</p>



<a name="192851364"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192851364" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192851364">(Apr 03 2020 at 19:12)</a>:</h4>
<p>is that you don't need the <code>T: Foo</code> with chalk's version of implied bounds</p>



<a name="192851383"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192851383" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192851383">(Apr 03 2020 at 19:12)</a>:</h4>
<p>this is precisely the "extended variant of implied bounds" that chalk is implementing</p>



<a name="192851395"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192851395" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192851395">(Apr 03 2020 at 19:12)</a>:</h4>
<p>we are able to figure out that <code>T: Foo</code> because otherwise <code>S&lt;T&gt;</code> would be ill-formed</p>



<a name="192851461"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192851461" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192851461">(Apr 03 2020 at 19:13)</a>:</h4>
<p>a massive debug might help me to see why, but I think what would be most useful is just to see all the <em>goals</em> we are trying to prove along the way</p>



<a name="192852479"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192852479" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192852479">(Apr 03 2020 at 19:22)</a>:</h4>
<p>I'll just give you the std err, then you can search for "_lowered_goal = "</p>



<a name="192852793"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192852793" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192852793">(Apr 03 2020 at 19:25)</a>:</h4>
<p>ok</p>



<a name="192853381"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192853381" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192853381">(Apr 03 2020 at 19:30)</a>:</h4>
<p>I'm waiting for build/test with the src as-is in the PR</p>



<a name="192854513"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192854513" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192854513">(Apr 03 2020 at 19:40)</a>:</h4>
<p><a href="https://www.dropbox.com/s/2ivzgauuiq1fgcb/test.log?dl=0" title="https://www.dropbox.com/s/2ivzgauuiq1fgcb/test.log?dl=0">https://www.dropbox.com/s/2ivzgauuiq1fgcb/test.log?dl=0</a></p>
<div class="message_inline_ref"><a href="https://www.dropbox.com/s/2ivzgauuiq1fgcb/test.log?dl=0" title="test.log"><img src="https://www.dropbox.com/static/images/spectrum-icons/generated/content/content-unknown-large.png"></a><div><div class="message_inline_image_title">test.log</div><desc class="message_inline_image_desc"></desc></div></div>



<a name="192854611"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192854611" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192854611">(Apr 03 2020 at 19:41)</a>:</h4>
<p>Let me know if you need anything else</p>



<a name="192855170"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192855170" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192855170">(Apr 03 2020 at 19:47)</a>:</h4>
<p>Oh, you know..</p>



<a name="192855178"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192855178" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192855178">(Apr 03 2020 at 19:47)</a>:</h4>
<p>I thnk I know the problem</p>



<a name="192855194"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192855194" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192855194">(Apr 03 2020 at 19:47)</a>:</h4>
<p><em>rustc</em> is constructing these environments, I guess</p>



<a name="192855211"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192855211" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192855211">(Apr 03 2020 at 19:47)</a>:</h4>
<p>i.e., you're convering a rustc <code>ParamEnv</code>?</p>



<a name="192855257"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192855257" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192855257">(Apr 03 2020 at 19:48)</a>:</h4>
<p>the problem here is that the stuff which chalk expects to be in the environment</p>



<a name="192855261"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192855261" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192855261">(Apr 03 2020 at 19:48)</a>:</h4>
<p>and the stuff that rustc currently adds</p>



<a name="192855263"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192855263" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192855263">(Apr 03 2020 at 19:48)</a>:</h4>
<p>aren't quite aligned</p>



<a name="192855280"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192855280" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192855280">(Apr 03 2020 at 19:48)</a>:</h4>
<p>in particular, chalk would expect a <code>FromEnv(WellFormed(S&lt;T&gt;))</code></p>



<a name="192855296"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192855296" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192855296">(Apr 03 2020 at 19:48)</a>:</h4>
<p>but rustc doesn't work like that</p>



<a name="192855303"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192855303" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192855303">(Apr 03 2020 at 19:48)</a>:</h4>
<p>we could alter this behavior of rustc with <code>-Zchalk</code>, potentially</p>



<a name="192855349"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192855349" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192855349">(Apr 03 2020 at 19:49)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/192855296" title="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/192855296">said</a>:</p>
<blockquote>
<p>but rustc doesn't work like that</p>
</blockquote>
<p>rustc handles "implied bounds" by trying to enumerate all the things that are implied to be true and adding them</p>



<a name="192855390"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192855390" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192855390">(Apr 03 2020 at 19:49)</a>:</h4>
<p>chalk, in contrast, just adds the "type this should be well-formed" and then lets us work out the implications from there</p>



<a name="192855401"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192855401" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192855401">(Apr 03 2020 at 19:49)</a>:</h4>
<p>which is better for certain things</p>



<a name="192855955"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192855955" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192855955">(Apr 03 2020 at 19:54)</a>:</h4>
<p>The ParamEnv conversion happens here I think: <a href="https://github.com/rust-lang/rust/pull/69406/files#diff-aecdbcef2e4435e37471cf92a7d10fdeR30" title="https://github.com/rust-lang/rust/pull/69406/files#diff-aecdbcef2e4435e37471cf92a7d10fdeR30">https://github.com/rust-lang/rust/pull/69406/files#diff-aecdbcef2e4435e37471cf92a7d10fdeR30</a></p>



<a name="192855985"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192855985" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192855985">(Apr 03 2020 at 19:54)</a>:</h4>
<p>(which, was how it was done in the old integration and I haven't touched)</p>



<a name="192856044"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192856044" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192856044">(Apr 03 2020 at 19:55)</a>:</h4>
<p>hmm</p>



<a name="192856193"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192856193" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192856193">(Apr 03 2020 at 19:56)</a>:</h4>
<p><code>FromEnv(StructId(Adt(DefId(0:5 ~ inherent_impl[317d]::S[0])))&lt;Ty(!0_0)&gt;)</code> that is in the environment though</p>



<a name="192856212"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192856212" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192856212">(Apr 03 2020 at 19:56)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/192855280" title="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/192855280">said</a>:</p>
<blockquote>
<p>in particular, chalk would expect a <code>FromEnv(WellFormed(S&lt;T&gt;))</code></p>
</blockquote>
<p>this</p>



<a name="192856234"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192856234" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192856234">(Apr 03 2020 at 19:56)</a>:</h4>
<p>maybe I missed it</p>



<a name="192856263"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192856263" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192856263">(Apr 03 2020 at 19:56)</a>:</h4>
<p>note that here <code>T</code> has already been converted into a placeholder (<code>!0_0</code>)</p>



<a name="192856376"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192856376" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192856376">(Apr 03 2020 at 19:57)</a>:</h4>
<p>OK I gues I was mistaken</p>



<a name="192856431"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192856431" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192856431">(Apr 03 2020 at 19:58)</a>:</h4>
<p>I sort of remember this coming up before now, and that we added some def-id into param-env for that reason...</p>



<a name="192856526"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192856526" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192856526">(Apr 03 2020 at 19:59)</a>:</h4>
<p>so the problem is that we're getting an error that <code>T: Foo</code> doesn't hold, right?</p>



<a name="192856560"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192856560" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192856560">(Apr 03 2020 at 19:59)</a>:</h4>
<p>Well, so the goal/solution that I think is wrong is:</p>



<a name="192856595"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192856595" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192856595">(Apr 03 2020 at 19:59)</a>:</h4>
<div class="codehilite"><pre><span></span>UCanonical {
    canonical: Canonical {
        value: InEnvironment {
            environment: Env([for&lt;&gt; FromEnv(Ty(!1_0): TraitId(Trait(DefId(2:1893 ~ core[797c]::marker[0]::Sized[0])))), for&lt;&gt; FromEnv(Ty(!1_1): TraitId(Trait(DefId(2:1893 ~ core[797c]::marker[0]::Sized[0])))), for&lt;&gt; FromEnv(Ty(!1_1): TraitId(Trait(DefId(0:13 ~ inherent_impl[317d]::Bar[0])))), FromEnv(StructId(Ref(Not))&lt;Lifetime(&#39;^0.0), Ty(StructId(Adt(DefId(0:5 ~ inherent_impl[317d]::S[0])))&lt;Ty(!0_0)&gt;)&gt;), FromEnv(StructId(Adt(DefId(0:5 ~ inherent_impl[317d]::S[0])))&lt;Ty(!0_0)&gt;), FromEnv(!0_0)]),
            goal: ForAll&lt;&gt; { Implemented(Ty(^1.1): TraitId(Trait(DefId(0:3 ~ inherent_impl[317d]::Foo[0])))) },
        },
        binders: [
            Lifetime(U0),
            Ty(U0),
        ],
    },
    universes: 1,
}
</pre></div>



<a name="192856622"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192856622" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192856622">(Apr 03 2020 at 19:59)</a>:</h4>
<div class="codehilite"><pre><span></span>Some(
    Unique(
        Canonical {
            value: ConstrainedSubst {
                subst: [Lifetime(&#39;^0.0), Ty(StructId(Int(I32)))],
                constraints: [],
            },
            binders: [
                Lifetime(U0),
            ],
        },
    ),
)
</pre></div>



<a name="192856794"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192856794" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192856794">(Apr 03 2020 at 20:00)</a>:</h4>
<p>So, chalk finds that <code>i32</code> impls <code>Foo</code></p>



<a name="192856858"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192856858" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192856858">(Apr 03 2020 at 20:01)</a>:</h4>
<p>But I think what rustc wants is that <code>T</code> impls <code>Foo</code>, given that <code>T: Foo</code></p>



<a name="192857153"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192857153" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192857153">(Apr 03 2020 at 20:04)</a>:</h4>
<p>hmm</p>



<a name="192857157"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192857157" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192857157">(Apr 03 2020 at 20:04)</a>:</h4>
<p>PS</p>



<a name="192857169"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192857169" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192857169">(Apr 03 2020 at 20:04)</a>:</h4>
<p>if we had made progress on that "dump out the chalk-ir stuff"</p>



<a name="192857176"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192857176" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192857176">(Apr 03 2020 at 20:04)</a>:</h4>
<p>this would be so useful here :)</p>



<a name="192857187"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192857187" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192857187">(Apr 03 2020 at 20:04)</a>:</h4>
<p>yes haha</p>



<a name="192857217"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192857217" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192857217">(Apr 03 2020 at 20:04)</a>:</h4>
<p>so I think the "right answer" would probably be ambiguity</p>



<a name="192857259"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192857259" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192857259">(Apr 03 2020 at 20:05)</a>:</h4>
<p>i.e., if I'm understanding the goal is <code>?T: Foo</code></p>



<a name="192857281"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192857281" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192857281">(Apr 03 2020 at 20:05)</a>:</h4>
<p>and chalk is saying "hey, <code>?T = i32</code> is a good answer"</p>



<a name="192857287"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192857287" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192857287">(Apr 03 2020 at 20:05)</a>:</h4>
<p>but there's another valid answer, which is <code>?T = T</code></p>



<a name="192857306"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192857306" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192857306">(Apr 03 2020 at 20:05)</a>:</h4>
<p>and the question is kind of "why didn't we see it"?</p>



<a name="192857324"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192857324" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192857324">(Apr 03 2020 at 20:05)</a>:</h4>
<p>right, exactly</p>



<a name="192857332"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192857332" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192857332">(Apr 03 2020 at 20:05)</a>:</h4>
<p>also, can you point to the line number in the log where that happens?</p>



<a name="192857376"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192857376" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192857376">(Apr 03 2020 at 20:06)</a>:</h4>
<p>64382 begins that goal</p>



<a name="192857413"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192857413" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192857413">(Apr 03 2020 at 20:06)</a>:</h4>
<p>maybe I'm looking at it now</p>



<a name="192857431"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192857431" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192857431">(Apr 03 2020 at 20:06)</a>:</h4>
<p>(though, this one is actually the second <code>only_foo</code> call I think)</p>



<a name="192857443"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192857443" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192857443">(Apr 03 2020 at 20:06)</a>:</h4>
<div class="codehilite"><pre><span></span>    fn dummy_bar&lt;U: Bar&gt;(&amp;self) {
        only_foo(&amp;self.x);
        only_bar::&lt;U&gt;();
    }
</pre></div>



<a name="192857466"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192857466" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192857466">(Apr 03 2020 at 20:06)</a>:</h4>
<p>Since there are two placeholders</p>



<a name="192857515"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192857515" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192857515">(Apr 03 2020 at 20:07)</a>:</h4>
<p>hmm</p>



<a name="192857537"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192857537" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192857537">(Apr 03 2020 at 20:07)</a>:</h4>
<p>can you maybe try with a smaller test?</p>



<a name="192857543"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192857543" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192857543">(Apr 03 2020 at 20:07)</a>:</h4>
<p>maybe I should build your branch...</p>



<a name="192857550"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192857550" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192857550">(Apr 03 2020 at 20:07)</a>:</h4>
<p>The other is line 79090</p>



<a name="192857555"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192857555" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192857555">(Apr 03 2020 at 20:07)</a>:</h4>
<p>hard to read in a web browser.</p>



<a name="192857562"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192857562" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192857562">(Apr 03 2020 at 20:07)</a>:</h4>
<p>yeah, I can cut this down</p>



<a name="192857676"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192857676" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192857676">(Apr 03 2020 at 20:09)</a>:</h4>
<p>I commited a non-building branch :/ Have the remove the <code>let self_parameter ...</code> line in <code>chalk/db.rs</code> line 310</p>



<a name="192857708"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192857708" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192857708">(Apr 03 2020 at 20:09)</a>:</h4>
<p>But other than that, builds fine</p>



<a name="192857761"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192857761" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192857761">(Apr 03 2020 at 20:09)</a>:</h4>
<p>(also have an extra dbg for obligations so locally so line numbers won't be the same)</p>



<a name="192857823"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192857823" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192857823">(Apr 03 2020 at 20:10)</a>:</h4>
<p>And I think I've seen the order of these goals be different run-to-run...</p>



<a name="192858140"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192858140" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192858140">(Apr 03 2020 at 20:13)</a>:</h4>
<p>smaller test:</p>
<div class="codehilite"><pre><span></span>// run-pass
// compile-flags: -Z chalk

trait Foo { }

impl Foo for i32 { }

struct S&lt;T: Foo&gt; {
    x: T,
}

fn only_foo&lt;T: Foo&gt;(_x: &amp;T) { }

impl&lt;T&gt; S&lt;T&gt; {
    // Test that we have the correct environment inside an inherent method.
    fn dummy_foo(&amp;self) {
        only_foo(&amp;self.x)
    }
}

fn main() {
    let s = S {
        x: 5,
    };

    s.dummy_foo();
}
</pre></div>



<a name="192858226"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192858226" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192858226">(Apr 03 2020 at 20:14)</a>:</h4>
<p><span class="user-mention" data-user-id="232957">@Jack Huey</span> I'm currently building your branch, but it's taking a bit because it's a fresh directory of rust</p>



<a name="192858240"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192858240" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192858240">(Apr 03 2020 at 20:14)</a>:</h4>
<p>Interestingly, there's nothing in the environment:</p>
<div class="codehilite"><pre><span></span>UCanonical {
    canonical: Canonical {
        value: InEnvironment {
            environment: Env([]),
            goal: ForAll&lt;&gt; { Implemented(Ty(^1.0): TraitId(Trait(DefId(0:3 ~ inherent_impl_min[317d]::Foo[0])))) },
        },
        binders: [
            Ty(U0),
        ],
    },
    universes: 1,
}
</pre></div>



<a name="192858475"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192858475" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192858475">(Apr 03 2020 at 20:16)</a>:</h4>
<p><span class="user-mention" data-user-id="232957">@Jack Huey</span> does it need some special version of chalk btw?</p>



<a name="192858565"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192858565" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192858565">(Apr 03 2020 at 20:17)</a>:</h4>
<p>Nope</p>



<a name="192858567"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192858567" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192858567">(Apr 03 2020 at 20:17)</a>:</h4>
<p>I guess I will find out :)</p>



<a name="192858568"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192858568" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192858568">(Apr 03 2020 at 20:17)</a>:</h4>
<p>ok</p>



<a name="192858586"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192858586" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192858586">(Apr 03 2020 at 20:17)</a>:</h4>
<p>I have mine set to a chalk in the parent directory</p>



<a name="192858588"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192858588" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192858588">(Apr 03 2020 at 20:17)</a>:</h4>
<p>so I can make chalk changes</p>



<a name="192858643"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192858643" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192858643">(Apr 03 2020 at 20:18)</a>:</h4>
<p>but you could just change it to use the current chalk master from git</p>



<a name="192858738"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192858738" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192858738">(Apr 03 2020 at 20:19)</a>:</h4>
<p>the <code>librustc</code> Cargo.toml has <code>chalk-ir</code>, and <code>librustc_traits</code> has <code>chalk-ir</code>, <code>chalk-rust-ir</code>, and <code>chalk-solve</code></p>



<a name="192863436"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192863436" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192863436">(Apr 03 2020 at 21:01)</a>:</h4>
<p><span class="user-mention" data-user-id="232957">@Jack Huey</span> so i'm reproducing the problem, will try to dig into the log a bit, i'm not quite sure what's happening yet</p>



<a name="192863826"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192863826" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192863826">(Apr 03 2020 at 21:04)</a>:</h4>
<p>ok great</p>



<a name="192863834"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192863834" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192863834">(Apr 03 2020 at 21:04)</a>:</h4>
<p>thanks :)</p>



<a name="192864126"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192864126" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192864126">(Apr 03 2020 at 21:07)</a>:</h4>
<p>I'm wondering if just making all traits non_enumerable would fix it</p>



<a name="192867435"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192867435" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192867435">(Apr 03 2020 at 21:42)</a>:</h4>
<p><span class="user-mention" data-user-id="232957">@Jack Huey</span> well probably, and we probably want to do that eventually, but it doesn't seem like the right fix</p>



<a name="192867449"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192867449" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192867449">(Apr 03 2020 at 21:42)</a>:</h4>
<p>i.e., it seems like someting else is off</p>



<a name="192867493"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192867493" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192867493">(Apr 03 2020 at 21:43)</a>:</h4>
<p>I see</p>



<a name="192867619"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192867619" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192867619">(Apr 03 2020 at 21:44)</a>:</h4>
<p>hmm, I do see this</p>



<a name="192867628"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192867628" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192867628">(Apr 03 2020 at 21:44)</a>:</h4>
<div class="codehilite"><pre><span></span>: | new answer to table with goal UCanonical { canonical: Canonical { value: InEnvironment { environment: Env([for&lt;&gt; FromEnv(Ty(!1_0): TraitId(Trait(DefId(2:1893 ~ core[d046]::marker[0]::Sized[0])))), FromEnv(StructId(Adt(DefId(0:5 ~ inherent_impl[317d]::S[0])))&lt;Ty(!0_0)&gt;), FromEnv(!0_0)]), goal: ForAll&lt;&gt; { Implemented(Ty(^1.0): TraitId(Trait(DefId(0:3 ~ inherent_impl[317d]::Foo[0])))) } }, binders: [Ty(U0)] }, universes: 1 }: answer=Answer { subst: Canonical { value: AnswerSubst { subst: [Ty(StructId(Int(I32)))], constraints: [], delayed_subgoals: [] }, binders: [] }, ambiguous: false }
</pre></div>



<a name="192867653"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192867653" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192867653">(Apr 03 2020 at 21:45)</a>:</h4>
<p>er nm</p>



<a name="192867656"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192867656" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192867656">(Apr 03 2020 at 21:45)</a>:</h4>
<p>I was misreading that</p>



<a name="192867784"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192867784" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192867784">(Apr 03 2020 at 21:46)</a>:</h4>
<p>Are you using minimized test?</p>



<a name="192868346"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192868346" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192868346">(Apr 03 2020 at 21:52)</a>:</h4>
<p>I miminized the test, i'm tracing a bit the chalk debug logs now</p>



<a name="192868367"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192868367" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192868367">(Apr 03 2020 at 21:53)</a>:</h4>
<p>oh okay</p>



<a name="192868638"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192868638" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192868638">(Apr 03 2020 at 21:56)</a>:</h4>
<p><span class="user-mention" data-user-id="232957">@Jack Huey</span> well I think this is the problem:</p>



<a name="192868660"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192868660" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192868660">(Apr 03 2020 at 21:56)</a>:</h4>
<div class="codehilite"><pre><span></span>StructDatum { binders: for&lt;type&gt; StructDatumBound { fields: [], where_clauses: [] }
</pre></div>



<a name="192868684"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192868684" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192868684">(Apr 03 2020 at 21:57)</a>:</h4>
<p>I think the where clauses list should not be empty :)</p>



<a name="192868731"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192868731" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192868731">(Apr 03 2020 at 21:57)</a>:</h4>
<p>in particular, that test is testing that we can deduce <code>T: Foo</code> based on the fact that <code>S&lt;T&gt;</code> requires <code>T: Foo</code>, which is derived from the where-clauses on <code>S</code></p>



<a name="192868907"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192868907" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192868907">(Apr 03 2020 at 21:59)</a>:</h4>
<p>whoops <span aria-label="face palm" class="emoji emoji-1f926" role="img" title="face palm">:face_palm:</span>‍♀️</p>



<a name="192888277"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192888277" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192888277">(Apr 04 2020 at 04:07)</a>:</h4>
<p>Okay, so yeah. I actually made the <code>StructDatum</code>s have where_clauses</p>



<a name="192888287"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192888287" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192888287">(Apr 04 2020 at 04:07)</a>:</h4>
<p>new error: error: internal compiler error: broken MIR in DefId(0:12 ~ inherent_impl_min[317d]::{{impl}}[1]::dummy_foo[0]) (NoSolution): could not prove Binder(TraitPredicate(&lt;T as Foo&gt;))</p>



<a name="192888419"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192888419" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192888419">(Apr 04 2020 at 04:11)</a>:</h4>
<p>And if I add that <code>T: Foo</code> bound to the <code>S</code> impl it passes</p>



<a name="192902433"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192902433" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192902433">(Apr 04 2020 at 11:05)</a>:</h4>
<p><span class="user-mention" data-user-id="232957">@Jack Huey</span> can you push your latest changes?</p>



<a name="192909200"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192909200" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192909200">(Apr 04 2020 at 14:07)</a>:</h4>
<p>Let me do that now</p>



<a name="192909214"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192909214" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192909214">(Apr 04 2020 at 14:07)</a>:</h4>
<p>Should have done that last night</p>



<a name="192909362"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192909362" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192909362">(Apr 04 2020 at 14:10)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> pushed</p>



<a name="192921012"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192921012" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192921012">(Apr 04 2020 at 18:30)</a>:</h4>
<p>Fixed it. I think I need a refresher on how placeholder universes work</p>



<a name="192921445"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192921445" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192921445">(Apr 04 2020 at 18:42)</a>:</h4>
<p>Well, I fixed <em>that</em> error</p>



<a name="192921448"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192921448" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192921448">(Apr 04 2020 at 18:42)</a>:</h4>
<p>But now it's saying <code>S&lt;T&gt;</code> isn't well formed</p>



<a name="192927259"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192927259" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192927259">(Apr 04 2020 at 21:11)</a>:</h4>
<p>Okay, so I got it working with the minimal inherent impl test</p>



<a name="192927269"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192927269" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192927269">(Apr 04 2020 at 21:11)</a>:</h4>
<p>but the full one is giving me this error: </p>
<div class="codehilite"><pre><span></span>error: internal compiler error: broken MIR in DefId(0:21 ~ inherent_impl[317d]::main[0]) (CanonicalUserTypeAnnotation { user_ty: Canonical { max_universe: U0, variables: [CanonicalVarInfo { kind: Ty(General(U0)) }], value: TypeOf(DefId(0:19 ~ inherent_impl[317d]::{{impl}}[3]::dummy_bar[0]), UserSubsts { substs: [^0, u32], user_self_ty: None }) }, span: /home/hueyj/temp/rust/rust/src/test/ui/chalkify/inherent_impl.rs:41:7: 41:16, inferred_ty: for&lt;&#39;r&gt; fn(&amp;&#39;r S&lt;i32&gt;) {S::&lt;i32&gt;::dummy_bar::&lt;u32&gt;} }): bad user type AscribeUserType(for&lt;&#39;r&gt; fn(&amp;&#39;r S&lt;i32&gt;) {S::&lt;i32&gt;::dummy_bar::&lt;u32&gt;}, DefId(0:19 ~ inherent_impl[317d]::{{impl}}[3]::dummy_bar[0]) UserSubsts { substs: [_, u32], user_self_ty: None }): NoSolution
</pre></div>



<a name="192927324"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192927324" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192927324">(Apr 04 2020 at 21:12)</a>:</h4>
<p>probably caused by the one goal that is returning <code>solution = None</code></p>



<a name="192927989"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192927989" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark McCaskey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192927989">(Apr 04 2020 at 21:33)</a>:</h4>
<p>I've made some decent progress on <a href="https://github.com/rust-lang/chalk/issues/368" title="https://github.com/rust-lang/chalk/issues/368">https://github.com/rust-lang/chalk/issues/368</a></p>
<p>I'd appreciate some feedback on if I'm going in the right direction with this!  <code>FnDef</code> seems fairly complete (though we can't parse into it yet) and I just started working on closures now. <a href="https://github.com/rust-lang/chalk/pull/371" title="https://github.com/rust-lang/chalk/pull/371">https://github.com/rust-lang/chalk/pull/371</a></p>



<a name="192928612"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192928612" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark McCaskey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192928612">(Apr 04 2020 at 21:50)</a>:</h4>
<p>Although now that I think of it, my <code>FnDef</code> is really a function declaration not a function definition <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="192929023"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192929023" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192929023">(Apr 04 2020 at 22:00)</a>:</h4>
<p><span class="user-mention" data-user-id="281304">@Mark McCaskey</span> I'll take a look</p>



<a name="192929738"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192929738" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192929738">(Apr 04 2020 at 22:18)</a>:</h4>
<p>re. my error: something is weird with how I'm doing FnDefs. For one, need to figure out the binders</p>



<a name="192930526"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/192930526" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark McCaskey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#192930526">(Apr 04 2020 at 22:40)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232957">Jack Huey</span> <a href="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/192929023" title="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/192929023">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="281304">Mark McCaskey</span> I'll take a look</p>
</blockquote>
<p>Thanks!  The PR is bigger than I initially expected and I've mostly just been following the flow of the existing project in terms of what I'm updating, so even just confirmation that I've not gone completely off the rails would be valuable to me <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="193069133"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193069133" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193069133">(Apr 06 2020 at 16:47)</a>:</h4>
<p>After fixing <code>FnDef</code> lowering, inherent_impl test passes :)</p>



<a name="193097858"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193097858" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193097858">(Apr 06 2020 at 20:33)</a>:</h4>
<p>I'm building the latest here</p>



<a name="193102194"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193102194" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193102194">(Apr 06 2020 at 21:09)</a>:</h4>
<p>I don't think I pushed the latest changes</p>



<a name="193102243"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193102243" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193102243">(Apr 06 2020 at 21:09)</a>:</h4>
<p>But basically, in lowering, FnDef shouldn't have substs</p>



<a name="193102283"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193102283" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193102283">(Apr 06 2020 at 21:09)</a>:</h4>
<p>The next problem I have to tackle is just making sure substitute Params</p>



<a name="193102380"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193102380" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193102380">(Apr 06 2020 at 21:10)</a>:</h4>
<p>I ran into an issue because I'm not currently handling <code>ReEarlyBound</code>s</p>



<a name="193102424"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193102424" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193102424">(Apr 06 2020 at 21:10)</a>:</h4>
<p>And I think to fix that I have to change up the BoundVarCollector</p>



<a name="193102469"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193102469" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193102469">(Apr 06 2020 at 21:11)</a>:</h4>
<p>(Oops those last couple sentences are two different problems)</p>



<a name="193142997"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193142997" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193142997">(Apr 07 2020 at 05:44)</a>:</h4>
<p>Ok just pushed the FnDef subst fix</p>



<a name="193143039"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193143039" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193143039">(Apr 07 2020 at 05:44)</a>:</h4>
<p>with that, here's the current state of the tests:</p>



<a name="193143045"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193143045" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193143045">(Apr 07 2020 at 05:44)</a>:</h4>
<p>(chalkify tests)</p>



<a name="193143109"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193143109" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193143109">(Apr 07 2020 at 05:46)</a>:</h4>
<p>lower_impl, lower_trait_higher_rank, lower_trait_where_clause all fail because we don't take into account <code>ReEarlyBound</code>s in <code>BoundVarCollector</code>. Need to be smarter with this. I think we'll actually have to substitute initially with a indexed bound var (for lowering)</p>



<a name="193143151"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193143151" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193143151">(Apr 07 2020 at 05:46)</a>:</h4>
<p>lower_trait fails with "cannot infer type for array `[_; 0]", but I haven't looked into it</p>



<a name="193143213"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193143213" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193143213">(Apr 07 2020 at 05:47)</a>:</h4>
<p>projection fails because of the current <code>force_impl_for</code> not handling <code>TypeName::AssociatedType</code></p>



<a name="193143284"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193143284" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193143284">(Apr 07 2020 at 05:48)</a>:</h4>
<p>type inference  is supposed to fail, but it's not clear whether it's doing so correctly. Too much stderr output</p>



<a name="193246012"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193246012" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193246012">(Apr 07 2020 at 20:49)</a>:</h4>
<p>I can pull your latest and start doing a build btw</p>



<a name="193246192"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193246192" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193246192">(Apr 07 2020 at 20:50)</a>:</h4>
<p>that would be great</p>



<a name="193246231"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193246231" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193246231">(Apr 07 2020 at 20:51)</a>:</h4>
<p>some general feedback on everything would be nice</p>



<a name="193246258"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193246258" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193246258">(Apr 07 2020 at 20:51)</a>:</h4>
<p>or specific feedback on <code>ReEarlyBound</code>s would be good</p>



<a name="193247272"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193247272" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193247272">(Apr 07 2020 at 21:00)</a>:</h4>
<p>I'm going to have to devote a bigger block of time to <em>really</em> read into this</p>



<a name="193247365"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193247365" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193247365">(Apr 07 2020 at 21:01)</a>:</h4>
<p><span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="193247478"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193247478" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193247478">(Apr 07 2020 at 21:01)</a>:</h4>
<p>Like I said, I think it's <em>pretty</em> close</p>



<a name="193247510"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193247510" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193247510">(Apr 07 2020 at 21:01)</a>:</h4>
<p>so, a review would be better sooner rather than later</p>



<a name="193247926"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193247926" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193247926">(Apr 07 2020 at 21:04)</a>:</h4>
<p>ok</p>



<a name="193251270"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193251270" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193251270">(Apr 07 2020 at 21:33)</a>:</h4>
<p>building now, in any case, and I'll try to get you meaningful feedback before end of the week</p>



<a name="193545125"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193545125" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193545125">(Apr 10 2020 at 07:39)</a>:</h4>
<p>Okay, so I did some work on properly handling <code>ReEarlyBound</code>, <code>ReNamed</code>, etc.</p>



<a name="193545136"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193545136" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193545136">(Apr 10 2020 at 07:39)</a>:</h4>
<p>It's sort of broken right now</p>



<a name="193545142"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193545142" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193545142">(Apr 10 2020 at 07:39)</a>:</h4>
<p>So not worth pushing</p>



<a name="193545160"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193545160" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193545160">(Apr 10 2020 at 07:39)</a>:</h4>
<p>But I'll also need to clean things up a bit</p>



<a name="193545231"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193545231" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193545231">(Apr 10 2020 at 07:40)</a>:</h4>
<p>Also realized that still not being correct with how I lower <code>Param</code>s</p>



<a name="193545256"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193545256" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193545256">(Apr 10 2020 at 07:41)</a>:</h4>
<p>Specifically, in the current state, they always lower to Placeholders</p>



<a name="193545282"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193545282" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193545282">(Apr 10 2020 at 07:41)</a>:</h4>
<p>But that's not correct, <em>specifically in where clauses</em></p>



<a name="193545286"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193545286" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193545286">(Apr 10 2020 at 07:41)</a>:</h4>
<p>If not other places</p>



<a name="193545294"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193545294" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193545294">(Apr 10 2020 at 07:41)</a>:</h4>
<p>So, in these places we need to eagerly convert to bound vars</p>



<a name="193608881"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193608881" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193608881">(Apr 10 2020 at 19:37)</a>:</h4>
<p>Ok so I added support for ReEarlyBound and ReNamed</p>



<a name="193608909"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193608909" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193608909">(Apr 10 2020 at 19:37)</a>:</h4>
<p>Still haven't fixed the params issue yet</p>



<a name="193608992"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193608992" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193608992">(Apr 10 2020 at 19:38)</a>:</h4>
<p>but none of the chalkify tests panic :)</p>



<a name="193617952"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193617952" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193617952">(Apr 10 2020 at 21:09)</a>:</h4>
<p>Okay I have a quick question that someone with better knowledge of rustc may be able to answer</p>



<a name="193618025"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193618025" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193618025">(Apr 10 2020 at 21:10)</a>:</h4>
<p>So, if I get a solution from chalk</p>



<a name="193618059"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193618059" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193618059">(Apr 10 2020 at 21:10)</a>:</h4>
<p>e.g. </p>
<div class="codehilite"><pre><span></span>Canonical {
    max_universe: U0,
    variables: [
        CanonicalVarInfo {
            kind: Region(
                U0,
            ),
        },
    ],
    value: InEnvironment {
        environment: Environment {
            clauses: [],
        },
        goal: Binder(
            TraitPredicate(&lt;&amp;[std::fmt::ArgumentV1&lt;&#39;_&gt;] as std::marker::Sized&gt;),
        ),
    },
}
</pre></div>



<a name="193618086"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193618086" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193618086">(Apr 10 2020 at 21:11)</a>:</h4>
<p>the solution chalk returns is "true for all lifetimes"</p>



<a name="193618119"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193618119" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193618119">(Apr 10 2020 at 21:11)</a>:</h4>
<p>here is what it's currently returning: </p>
<div class="codehilite"><pre><span></span>Some(
    Unique(
        Canonical {
            value: ConstrainedSubst {
                subst: [Lifetime(&#39;^0.0)],
                constraints: [],
            },
            binders: [
                Lifetime(U0),
            ],
        },
    ),
)
</pre></div>



<a name="193618195"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193618195" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193618195">(Apr 10 2020 at 21:12)</a>:</h4>
<p>(chalk)</p>



<a name="193618219"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193618219" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193618219">(Apr 10 2020 at 21:12)</a>:</h4>
<p>what would be the <code>var_values</code> be</p>



<a name="193618248"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193618248" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193618248">(Apr 10 2020 at 21:13)</a>:</h4>
<p>Currently it's <code>[ReLateBound(DebruijnIndex(0), BrAnon(0))]</code></p>



<a name="193618266"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193618266" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193618266">(Apr 10 2020 at 21:13)</a>:</h4>
<p>But rustc doesn't like this I don't think</p>



<a name="193618366"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193618366" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193618366">(Apr 10 2020 at 21:14)</a>:</h4>
<p>(or, the problem I'm seeing is happening from an earlier goal)</p>



<a name="193618427"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193618427" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193618427">(Apr 10 2020 at 21:14)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232957">Jack Huey</span> <a href="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/193618219" title="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/193618219">said</a>:</p>
<blockquote>
<p>what would be the <code>var_values</code> be</p>
</blockquote>
<p>So, this is the question.</p>



<a name="193618450"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193618450" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193618450">(Apr 10 2020 at 21:15)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> or maybe <span class="user-mention" data-user-id="119009">@eddyb</span></p>



<a name="193618652"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193618652" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193618652">(Apr 10 2020 at 21:17)</a>:</h4>
<p>ah, it might be the error I'm getting (something like "can't infer [_; 0] in the <code>println!("hello");</code>")</p>



<a name="193618806"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193618806" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193618806">(Apr 10 2020 at 21:18)</a>:</h4>
<p>I probably don't know the answer</p>



<a name="193618844"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193618844" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193618844">(Apr 10 2020 at 21:19)</a>:</h4>
<p>I figured it was a long shot</p>



<a name="193619014"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193619014" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193619014">(Apr 10 2020 at 21:20)</a>:</h4>
<p>yeah, so writing in explicit panic in <code>need_type_info_err</code> unveils two errors that point to the source of the problem more: <code>dtorck encountered internal error</code> and <code>unresolved inference variable in outlives: _#6t</code></p>



<a name="193642147"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193642147" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193642147">(Apr 11 2020 at 04:38)</a>:</h4>
<p>Alright, so the problem is almost certainly the fact that we're essentially ignoring <code>RegionOutlives</code>, <code>TypeOutlives</code>, and <code>Subtype</code> goals</p>



<a name="193642158"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193642158" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193642158">(Apr 11 2020 at 04:38)</a>:</h4>
<p>(I think we're returning an empty solution when it should be ambiguous)</p>



<a name="193642300"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193642300" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193642300">(Apr 11 2020 at 04:43)</a>:</h4>
<p>So, since for our MVP, we're choosing to ignore those, I've decided to move the <code>println!("hello");</code> lines out of the for chalkify tests and into it's own test for now</p>



<a name="193642303"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193642303" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193642303">(Apr 11 2020 at 04:43)</a>:</h4>
<p>With that, all the existing chalkify tests pass</p>



<a name="193642323"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193642323" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193642323">(Apr 11 2020 at 04:44)</a>:</h4>
<p>only the new test fails</p>



<a name="193642346"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193642346" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193642346">(Apr 11 2020 at 04:44)</a>:</h4>
<p>which we're accepting right now</p>



<a name="193649137"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193649137" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193649137">(Apr 11 2020 at 08:31)</a>:</h4>
<p>Ok, so did a bit of cleanup</p>



<a name="193649182"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193649182" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193649182">(Apr 11 2020 at 08:32)</a>:</h4>
<p>The type_inference test <em>does</em> look like something is wrong</p>



<a name="193649187"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193649187" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193649187">(Apr 11 2020 at 08:32)</a>:</h4>
<p>"ERROR the trait bound <code>{float}: Bar</code> is not satisfied" that error isn't being emitted</p>



<a name="193649200"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193649200" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193649200">(Apr 11 2020 at 08:33)</a>:</h4>
<p>I mean, of course I discover this <em>after</em> I remove all the dbg! statements</p>



<a name="193675236"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193675236" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193675236">(Apr 11 2020 at 19:21)</a>:</h4>
<p>Ah okay, so the type_inference test is blocked on <a href="https://github.com/rust-lang/chalk/issues/327" title="https://github.com/rust-lang/chalk/issues/327">https://github.com/rust-lang/chalk/issues/327</a></p>



<a name="193675246"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193675246" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193675246">(Apr 11 2020 at 19:21)</a>:</h4>
<p>We know it's a float, so we actually do <em>know</em> that there are no solutions</p>



<a name="193675289"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193675289" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193675289">(Apr 11 2020 at 19:22)</a>:</h4>
<p>as opposed to ambiguity</p>



<a name="193675305"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193675305" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193675305">(Apr 11 2020 at 19:22)</a>:</h4>
<p>Surprisingly, there isn't an error given by rustc on <code>Ambig(Unknown)</code> for <code>only_bar(5.0)</code></p>



<a name="193677727"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193677727" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193677727">(Apr 11 2020 at 20:20)</a>:</h4>
<p>Oh, so apparently there are compile-fail/chalkify tests</p>



<a name="193677732"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193677732" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193677732">(Apr 11 2020 at 20:21)</a>:</h4>
<p>gonna move those to ui/chalkify ...</p>



<a name="193683321"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193683321" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193683321">(Apr 11 2020 at 22:42)</a>:</h4>
<p>yeah, so it seems there's quite a bit that requires us to know about float/ty special handling</p>



<a name="193683331"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193683331" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193683331">(Apr 11 2020 at 22:43)</a>:</h4>
<p>in some of the new tests, for example, we have to know that {float}: Sized</p>



<a name="193683334"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193683334" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193683334">(Apr 11 2020 at 22:43)</a>:</h4>
<p>For now, these portions of the tests I'm leaving out</p>



<a name="193683400"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193683400" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193683400">(Apr 11 2020 at 22:45)</a>:</h4>
<blockquote>
<p>test result: ok. 23 passed; 0 failed; 0 ignored; 0 measured; 9885 filtered out</p>
</blockquote>



<a name="193683774"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193683774" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193683774">(Apr 11 2020 at 22:57)</a>:</h4>
<p>Okay, so now my PR should build :)</p>



<a name="193693389"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193693389" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193693389">(Apr 12 2020 at 04:18)</a>:</h4>
<p>huh</p>



<a name="193693392"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193693392" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193693392">(Apr 12 2020 at 04:19)</a>:</h4>
<p>so, the recursive_where_clause_on_type test passes locally</p>



<a name="193693393"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193693393" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193693393">(Apr 12 2020 at 04:19)</a>:</h4>
<p>but on ci it fails</p>



<a name="193695137"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193695137" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193695137">(Apr 12 2020 at 05:15)</a>:</h4>
<p>so, the error is duplicated</p>



<a name="193695139"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193695139" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193695139">(Apr 12 2020 at 05:15)</a>:</h4>
<p>and the order on ci is different</p>



<a name="193695178"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193695178" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193695178">(Apr 12 2020 at 05:16)</a>:</h4>
<p>so, seems it might have a non-deterministic order</p>



<a name="193696625"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193696625" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193696625">(Apr 12 2020 at 06:01)</a>:</h4>
<p>ugh no something else is different between local and ci for me</p>



<a name="193696626"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193696626" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193696626">(Apr 12 2020 at 06:01)</a>:</h4>
<p>stderr</p>



<a name="193696629"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193696629" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193696629">(Apr 12 2020 at 06:01)</a>:</h4>
<blockquote>
<p>[ui] ui/chalkify/impl_wf.rs<br>
    [ui] ui/chalkify/recursive_where_clause_on_type.rs<br>
    [ui] ui/const-generics/issues/issue-65675.rs</p>
</blockquote>



<a name="193699017"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193699017" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193699017">(Apr 12 2020 at 07:21)</a>:</h4>
<p>ugh okay yeah the output seems different every time I push</p>



<a name="193699302"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193699302" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> detrumi <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193699302">(Apr 12 2020 at 07:31)</a>:</h4>
<p>Is rustc causing it to be non-deterministic, or chalk?</p>



<a name="193717736"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193717736" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193717736">(Apr 12 2020 at 15:35)</a>:</h4>
<p>I actually don't know</p>



<a name="193718685"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193718685" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193718685">(Apr 12 2020 at 16:01)</a>:</h4>
<p>locally, I get the same output every time</p>



<a name="193720921"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193720921" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193720921">(Apr 12 2020 at 17:03)</a>:</h4>
<p>Okay, I think <em>now</em> my PR should build</p>



<a name="193720980"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193720980" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193720980">(Apr 12 2020 at 17:04)</a>:</h4>
<p>the recursive_where_clause_on_type test still doesn't match my local output</p>



<a name="193720983"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193720983" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193720983">(Apr 12 2020 at 17:04)</a>:</h4>
<p>there's an extra <code>warning: 1 warning emitted</code></p>



<a name="193721068"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193721068" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193721068">(Apr 12 2020 at 17:06)</a>:</h4>
<p>ah right, everything works but tidy complains about chalk because they are pointing to git</p>



<a name="193721148"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193721148" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193721148">(Apr 12 2020 at 17:09)</a>:</h4>
<p>and whitelist</p>



<a name="193809819"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193809819" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193809819">(Apr 13 2020 at 19:20)</a>:</h4>
<p><span class="user-mention" data-user-id="232957">@Jack Huey</span> I've been digging into the branch. I'm going to push a few comments</p>



<a name="193809821"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193809821" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193809821">(Apr 13 2020 at 19:20)</a>:</h4>
<p>as a commit</p>



<a name="193809853"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193809853" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193809853">(Apr 13 2020 at 19:20)</a>:</h4>
<p>Works for me</p>



<a name="193809854"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193809854" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193809854">(Apr 13 2020 at 19:20)</a>:</h4>
<p>so far I don't see anything major</p>



<a name="193809865"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193809865" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193809865">(Apr 13 2020 at 19:21)</a>:</h4>
<p>plenty of work remaining of course</p>



<a name="193809876"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193809876" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193809876">(Apr 13 2020 at 19:21)</a>:</h4>
<p>one thing I am wondering about</p>



<a name="193809892"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193809892" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193809892">(Apr 13 2020 at 19:21)</a>:</h4>
<p>is the role of <code>DomainGoal</code> (the rustc version)</p>



<a name="193809909"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193809909" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193809909">(Apr 13 2020 at 19:21)</a>:</h4>
<p>I feel like we shouldn't have that type</p>



<a name="193810031"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193810031" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193810031">(Apr 13 2020 at 19:22)</a>:</h4>
<p>In rustc? Why</p>



<a name="193810073"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193810073" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193810073">(Apr 13 2020 at 19:22)</a>:</h4>
<p>because we have <code>Predicate</code>, and I think <code>DomainGoal</code> was only ever used in the old integration</p>



<a name="193810095"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193810095" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193810095">(Apr 13 2020 at 19:23)</a>:</h4>
<p>i.e., we should be able to use the chalk version, in short</p>



<a name="193810109"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193810109" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193810109">(Apr 13 2020 at 19:23)</a>:</h4>
<p>Oh I see</p>



<a name="193810177"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193810177" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193810177">(Apr 13 2020 at 19:24)</a>:</h4>
<p>I've not read all your comments above but one of the other "major-ish" things I was wondering about</p>



<a name="193810251"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193810251" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193810251">(Apr 13 2020 at 19:24)</a>:</h4>
<p>was this code</p>



<a name="193810255"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193810255" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193810255">(Apr 13 2020 at 19:24)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="k">impl</span><span class="o">&lt;</span><span class="na">&#39;tcx</span><span class="o">&gt;</span><span class="w"> </span><span class="n">LowerInto</span><span class="o">&lt;</span><span class="na">&#39;tcx</span><span class="p">,</span><span class="w"> </span><span class="n">chalk_ir</span>::<span class="n">Lifetime</span><span class="o">&lt;</span><span class="n">RustInterner</span><span class="o">&lt;</span><span class="na">&#39;tcx</span><span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Region</span><span class="o">&lt;</span><span class="na">&#39;tcx</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">lower_into</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">interner</span>: <span class="kp">&amp;</span><span class="nc">RustInterner</span><span class="o">&lt;</span><span class="na">&#39;tcx</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">chalk_ir</span>::<span class="n">Lifetime</span><span class="o">&lt;</span><span class="n">RustInterner</span><span class="o">&lt;</span><span class="na">&#39;tcx</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">use</span><span class="w"> </span><span class="n">rustc_middle</span>::<span class="n">ty</span>::<span class="n">RegionKind</span>::<span class="o">*</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="k">match</span><span class="w"> </span><span class="bp">self</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="c1">// FIXME: shouldn&#39;t be an InferenceVar</span>
<span class="w">            </span><span class="c1">//</span>
<span class="w">            </span><span class="c1">// ndm: No, it really shouldn&#39;t! I sort of expect to never</span>
<span class="w">            </span><span class="c1">// see these, because I expect us to substitute them</span>
<span class="w">            </span><span class="c1">// away. Have you tried making this panic?</span>
<span class="w">            </span><span class="n">ReEarlyBound</span><span class="p">(</span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">chalk_ir</span>::<span class="n">LifetimeData</span>::<span class="n">InferenceVar</span><span class="p">(</span><span class="n">chalk_ir</span>::<span class="n">InferenceVar</span>::<span class="n">from</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="w"></span>
<span class="w">                    </span><span class="p">.</span><span class="n">intern</span><span class="p">(</span><span class="n">interner</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
</pre></div>



<a name="193810267"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193810267" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193810267">(Apr 13 2020 at 19:24)</a>:</h4>
<p>see my comment there (the one that starts "ndm")</p>



<a name="193810296"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193810296" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193810296">(Apr 13 2020 at 19:24)</a>:</h4>
<p>I have to run for a bit (meeting) but I wanted to go back and look at how you are handling early-bound placeholdrs in general</p>



<a name="193810311"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193810311" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193810311">(Apr 13 2020 at 19:25)</a>:</h4>
<p>I saw you mention about something about translating subst into placeholders or something</p>



<a name="193810362"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193810362" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193810362">(Apr 13 2020 at 19:25)</a>:</h4>
<p>I <em>suspect</em> that if you are doing substitutions at the right places, then indeed translating <code>ty::Param</code> into placeholders <em>is</em> ok, because you'd just never see them I guess</p>



<a name="193810377"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193810377" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193810377">(Apr 13 2020 at 19:25)</a>:</h4>
<p>in particular for where clauses I think that's true</p>



<a name="193810580"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193810580" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193810580">(Apr 13 2020 at 19:27)</a>:</h4>
<p>That was one of the first things I wrote. I'm gonna have to go back and look at that</p>



<a name="193810644"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193810644" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193810644">(Apr 13 2020 at 19:27)</a>:</h4>
<p>So Params are a bit tricky</p>



<a name="193810695"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193810695" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193810695">(Apr 13 2020 at 19:28)</a>:</h4>
<p>(btw, I'm kicking off a build to run the tests myself)</p>



<a name="193810727"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193810727" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193810727">(Apr 13 2020 at 19:28)</a>:</h4>
<p>In most places, they're getting substituted as placeholders</p>



<a name="193810749"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193810749" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193810749">(Apr 13 2020 at 19:28)</a>:</h4>
<p>But there's a couple places that they get substituted as bound vars</p>



<a name="193810842"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193810842" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193810842">(Apr 13 2020 at 19:29)</a>:</h4>
<p>(for tests, you <em>might</em> run into output differences compared to what is in the PR. At least I did)</p>



<a name="193810867"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193810867" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193810867">(Apr 13 2020 at 19:29)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232957">Jack Huey</span> <a href="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/193810749" title="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/193810749">said</a>:</p>
<blockquote>
<p>But there's a couple places that they get substituted as bound vars</p>
</blockquote>
<p>I would expect them to be subst as bound variables in most places</p>



<a name="193810884"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193810884" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193810884">(Apr 13 2020 at 19:29)</a>:</h4>
<p>but maybe I'm misunderstanding you</p>



<a name="193810906"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193810906" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193810906">(Apr 13 2020 at 19:29)</a>:</h4>
<p>in particular, I would expect that in methods like <code>trait_datum</code> and the like</p>



<a name="193810937"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193810937" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193810937">(Apr 13 2020 at 19:29)</a>:</h4>
<p>you'd be substituting them as bound variables</p>



<a name="193810994"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193810994" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193810994">(Apr 13 2020 at 19:30)</a>:</h4>
<p>and I don't expect you to be substituting them much anywhere else, I guess</p>



<a name="193811017"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193811017" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193811017">(Apr 13 2020 at 19:30)</a>:</h4>
<p>if by substitute, you mean using the <code>subst</code> method</p>



<a name="193811386"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193811386" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193811386">(Apr 13 2020 at 19:32)</a>:</h4>
<p>yeah, you're right</p>



<a name="193811415"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193811415" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193811415">(Apr 13 2020 at 19:32)</a>:</h4>
<p>Maybe the only place they get substituted as placeholders is in the goal itself</p>



<a name="193811965"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193811965" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193811965">(Apr 13 2020 at 19:38)</a>:</h4>
<p>This is actually wrong: <a href="https://github.com/rust-lang/rust/pull/69406/files#diff-828ef7bd1dead769c57f685079e876f6R297" title="https://github.com/rust-lang/rust/pull/69406/files#diff-828ef7bd1dead769c57f685079e876f6R297">https://github.com/rust-lang/rust/pull/69406/files#diff-828ef7bd1dead769c57f685079e876f6R297</a></p>



<a name="193812095"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193812095" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193812095">(Apr 13 2020 at 19:39)</a>:</h4>
<p>That should be replaced with <code>substitute_params</code> I think</p>



<a name="193812277"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193812277" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193812277">(Apr 13 2020 at 19:41)</a>:</h4>
<p>Well, maybe that should instead not actually lower each impl, but instead check on Rust <code>Ty</code>s</p>



<a name="193815140"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193815140" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193815140">(Apr 13 2020 at 20:07)</a>:</h4>
<p>So one other thing <span class="user-mention" data-user-id="232957">@Jack Huey</span> is that it'd be good to land the extensions to <code>TypeName</code> --</p>



<a name="193815151"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193815151" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193815151">(Apr 13 2020 at 20:07)</a>:</h4>
<p>but I guess that we could as well land this first and rebase atop such changes</p>



<a name="193815458"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193815458" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193815458">(Apr 13 2020 at 20:10)</a>:</h4>
<p>I added that to the agenda for tomorrow</p>



<a name="193815469"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193815469" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193815469">(Apr 13 2020 at 20:10)</a>:</h4>
<p>I think we should discuss</p>



<a name="193817194"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193817194" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193817194">(Apr 13 2020 at 20:26)</a>:</h4>
<p>OK. Also the changes I pushed don't <em>quite</em>  build I guess :)</p>



<a name="193817907"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193817907" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193817907">(Apr 13 2020 at 20:33)</a>:</h4>
<div class="codehilite"><pre><span></span>                upstream: trait_id.is_local(),
                fundamental: self.tcx.has_attr(trait_ref.def_id, sym::fundamental),
                non_enumerable: true,
</pre></div>


<p>these?</p>



<a name="193818983"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193818983" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193818983">(Apr 13 2020 at 20:43)</a>:</h4>
<p>right, a few minor fixes needed</p>



<a name="193821405"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193821405" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193821405">(Apr 13 2020 at 21:05)</a>:</h4>
<p>Do you want to play with it or do you want me to</p>



<a name="193958233"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193958233" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193958233">(Apr 14 2020 at 21:16)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> when would be a good time for a zoom call to go over the PR?</p>



<a name="193958645"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193958645" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193958645">(Apr 14 2020 at 21:21)</a>:</h4>
<p><span class="user-mention" data-user-id="232957">@Jack Huey</span> I could do tomorrow morning or afternoon</p>



<a name="193958700"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193958700" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193958700">(Apr 14 2020 at 21:21)</a>:</h4>
<p>I can do either, so whichever is better</p>



<a name="193959347"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193959347" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193959347">(Apr 14 2020 at 21:28)</a>:</h4>
<p>3pm in the afternoon, perhaps?</p>



<a name="193959456"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193959456" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193959456">(Apr 14 2020 at 21:29)</a>:</h4>
<p>Works for me</p>



<a name="193959526"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193959526" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193959526">(Apr 14 2020 at 21:30)</a>:</h4>
<p>btw I already address your InferenceVar comment</p>



<a name="193959530"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193959530" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Areredify <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193959530">(Apr 14 2020 at 21:30)</a>:</h4>
<p>3pm et?</p>



<a name="193959538"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193959538" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193959538">(Apr 14 2020 at 21:30)</a>:</h4>
<p>yes</p>



<a name="193959839"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/193959839" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#193959839">(Apr 14 2020 at 21:34)</a>:</h4>
<p>OK, added to <a href="https://calendar.google.com/event?action=TEMPLATE&amp;tmeid=Nzd0b2NkazJjb24zZXFhaW10ZWN2cXEwM3MgNnU1cnJ0Y2U2bHJ0djA3cGZpM2RhbWdqdXNAZw&amp;tmsrc=6u5rrtce6lrtv07pfi3damgjus%40group.calendar.google.com" title="https://calendar.google.com/event?action=TEMPLATE&amp;tmeid=Nzd0b2NkazJjb24zZXFhaW10ZWN2cXEwM3MgNnU1cnJ0Y2U2bHJ0djA3cGZpM2RhbWdqdXNAZw&amp;tmsrc=6u5rrtce6lrtv07pfi3damgjus%40group.calendar.google.com">calendar</a> w/ a zoom url</p>



<a name="194212178"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/194212178" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> detrumi <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#194212178">(Apr 15 2020 at 19:01)</a>:</h4>
<p><span class="user-mention" data-user-id="251766">@Areredify</span> Are you joining the call?</p>



<a name="194212199"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/194212199" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Areredify <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#194212199">(Apr 15 2020 at 19:01)</a>:</h4>
<p>yeah I moment</p>



<a name="194212210"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/194212210" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Areredify <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#194212210">(Apr 15 2020 at 19:01)</a>:</h4>
<p>gotta install zoom</p>



<a name="194212613"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/194212613" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#194212613">(Apr 15 2020 at 19:04)</a>:</h4>
<p><a href="https://paper.dropbox.com/doc/rustc-integration-overview--AyLn_P7a~ID3MA_v4Sc60qUlAg-R89osb7kQmMpVmBxmMJDB" title="https://paper.dropbox.com/doc/rustc-integration-overview--AyLn_P7a~ID3MA_v4Sc60qUlAg-R89osb7kQmMpVmBxmMJDB">paper doc</a></p>



<a name="194212667"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/194212667" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#194212667">(Apr 15 2020 at 19:04)</a>:</h4>
<p><span class="user-mention" data-user-id="125131">@detrumi</span> <span class="user-mention" data-user-id="251766">@Areredify</span> <span class="user-mention" data-user-id="232957">@Jack Huey</span> <span aria-label="point up" class="emoji emoji-1f446" role="img" title="point up">:point_up:</span></p>



<a name="194227923"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/194227923" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#194227923">(Apr 15 2020 at 21:09)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> can you push your commit with comments</p>



<a name="194230655"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/194230655" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#194230655">(Apr 15 2020 at 21:33)</a>:</h4>
<p>whoops, sorry, done</p>



<a name="194325951"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/194325951" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#194325951">(Apr 16 2020 at 15:52)</a>:</h4>
<p>so I made a recording of that meeting, would it be useful to upload?</p>



<a name="194328944"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/194328944" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#194328944">(Apr 16 2020 at 16:10)</a>:</h4>
<p>sure</p>



<a name="194987375"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/194987375" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#194987375">(Apr 22 2020 at 20:29)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> you around?</p>



<a name="194987381"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/194987381" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#194987381">(Apr 22 2020 at 20:29)</a>:</h4>
<p>Question</p>



<a name="194987391"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/194987391" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#194987391">(Apr 22 2020 at 20:29)</a>:</h4>
<p>This impl: <a href="https://github.com/rust-lang/rust/blob/master/src/libcore/iter/traits/iterator.rs#L3255" title="https://github.com/rust-lang/rust/blob/master/src/libcore/iter/traits/iterator.rs#L3255">https://github.com/rust-lang/rust/blob/master/src/libcore/iter/traits/iterator.rs#L3255</a></p>



<a name="194987407"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/194987407" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#194987407">(Apr 22 2020 at 20:30)</a>:</h4>
<p>go for it</p>



<a name="194987456"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/194987456" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#194987456">(Apr 22 2020 at 20:30)</a>:</h4>
<p>I'm around-ish</p>



<a name="194987458"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/194987458" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#194987458">(Apr 22 2020 at 20:30)</a>:</h4>
<p>Is the lifetime on that <code>&amp;mut Iterator</code> latebound</p>



<a name="194987475"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/194987475" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#194987475">(Apr 22 2020 at 20:30)</a>:</h4>
<p>that's what I'm seeing</p>



<a name="194987509"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/194987509" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#194987509">(Apr 22 2020 at 20:30)</a>:</h4>
<p>nope</p>



<a name="194987531"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/194987531" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#194987531">(Apr 22 2020 at 20:30)</a>:</h4>
<p>not sure why you're seeing that, I think you may be misinterpreting</p>



<a name="194987536"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/194987536" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#194987536">(Apr 22 2020 at 20:30)</a>:</h4>
<p>it <em>is</em> anonymous</p>



<a name="194987576"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/194987576" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#194987576">(Apr 22 2020 at 20:31)</a>:</h4>
<p>I'm trying to remember if we do something strange in HIR lowering that might make it be late-bound</p>



<a name="194987577"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/194987577" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#194987577">(Apr 22 2020 at 20:31)</a>:</h4>
<p>hmm</p>



<a name="194987598"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/194987598" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#194987598">(Apr 22 2020 at 20:31)</a>:</h4>
<p>but I don't believe so</p>



<a name="194987623"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/194987623" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#194987623">(Apr 22 2020 at 20:31)</a>:</h4>
<p>let me point you to the lowering code where this is popping up</p>



<a name="194987632"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/194987632" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#194987632">(Apr 22 2020 at 20:31)</a>:</h4>
<p>if you have time</p>



<a name="194987773"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/194987773" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#194987773">(Apr 22 2020 at 20:32)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/pull/69406/files#diff-828ef7bd1dead769c57f685079e876f6R279" title="https://github.com/rust-lang/rust/pull/69406/files#diff-828ef7bd1dead769c57f685079e876f6R279">https://github.com/rust-lang/rust/pull/69406/files#diff-828ef7bd1dead769c57f685079e876f6R279</a></p>



<a name="194987798"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/194987798" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#194987798">(Apr 22 2020 at 20:33)</a>:</h4>
<p>I'm trying to remove the <code>subtitute_params</code> call on <code>trait_ref</code></p>



<a name="194987902"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/194987902" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#194987902">(Apr 22 2020 at 20:33)</a>:</h4>
<p>(in that, I convert latebound named to latebound anons)</p>



<a name="194988249"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/194988249" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#194988249">(Apr 22 2020 at 20:37)</a>:</h4>
<p>And it hits this <a href="https://github.com/rust-lang/rust/pull/69406/files#diff-2c4ca7669b79bd3e9c8c06315b1b1f33R447" title="https://github.com/rust-lang/rust/pull/69406/files#diff-2c4ca7669b79bd3e9c8c06315b1b1f33R447">https://github.com/rust-lang/rust/pull/69406/files#diff-2c4ca7669b79bd3e9c8c06315b1b1f33R447</a></p>



<a name="194989409"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/194989409" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#194989409">(Apr 22 2020 at 20:48)</a>:</h4>
<p><span class="user-mention" data-user-id="232957">@Jack Huey</span> hmm those links aren't working for me :(</p>



<a name="194989423"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/194989423" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#194989423">(Apr 22 2020 at 20:48)</a>:</h4>
<p>can you maybe make them links into your repo instead?</p>



<a name="194989447"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/194989447" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#194989447">(Apr 22 2020 at 20:48)</a>:</h4>
<p>Yeah</p>



<a name="194989457"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/194989457" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#194989457">(Apr 22 2020 at 20:48)</a>:</h4>
<p>also, is there some debugging output</p>



<a name="194989467"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/194989467" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#194989467">(Apr 22 2020 at 20:48)</a>:</h4>
<p>I bet it's because they are into collapsed files</p>



<a name="194989470"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/194989470" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#194989470">(Apr 22 2020 at 20:48)</a>:</h4>
<p>or maybe you can puhs the commits and I can run it locally</p>



<a name="194989522"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/194989522" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#194989522">(Apr 22 2020 at 20:49)</a>:</h4>
<p>it's super small, I'll just paste it</p>



<a name="194989530"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/194989530" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#194989530">(Apr 22 2020 at 20:49)</a>:</h4>
<p>let me get the links first</p>



<a name="194989674"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/194989674" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#194989674">(Apr 22 2020 at 20:50)</a>:</h4>
<p>this is the second link: <a href="https://github.com/rust-lang/rust/blob/230a19f295279b60c670bce5ab393145668e8618/src/librustc_traits/lowering/mod.rs#L447" title="https://github.com/rust-lang/rust/blob/230a19f295279b60c670bce5ab393145668e8618/src/librustc_traits/lowering/mod.rs#L447">https://github.com/rust-lang/rust/blob/230a19f295279b60c670bce5ab393145668e8618/src/librustc_traits/lowering/mod.rs#L447</a></p>



<a name="194989779"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/194989779" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#194989779">(Apr 22 2020 at 20:51)</a>:</h4>
<p>This is where the lowering gets called: <a href="https://github.com/rust-lang/rust/blob/230a19f295279b60c670bce5ab393145668e8618/src/librustc_traits/chalk/db.rs#L266" title="https://github.com/rust-lang/rust/blob/230a19f295279b60c670bce5ab393145668e8618/src/librustc_traits/chalk/db.rs#L266">https://github.com/rust-lang/rust/blob/230a19f295279b60c670bce5ab393145668e8618/src/librustc_traits/chalk/db.rs#L266</a></p>



<a name="194989922"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/194989922" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#194989922">(Apr 22 2020 at 20:53)</a>:</h4>
<p>The diff is at 258 at <a href="http://db.rs" title="http://db.rs">db.rs</a></p>



<a name="194989948"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/194989948" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#194989948">(Apr 22 2020 at 20:53)</a>:</h4>
<p>comment out</p>
<div class="codehilite"><pre><span></span>let (trait_ref, binders, _named_regions) =
            crate::lowering::substitute_params(self.tcx, bound_vars, &amp;trait_ref);
</pre></div>



<a name="194989982"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/194989982" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#194989982">(Apr 22 2020 at 20:53)</a>:</h4>
<p>Add </p>
<div class="codehilite"><pre><span></span>        let binders = bound_vars
            .iter()
            .map(|arg| match arg.unpack() {
                ty::subst::GenericArgKind::Lifetime(_re) =&gt; chalk_ir::ParameterKind::Lifetime(()),
                ty::subst::GenericArgKind::Type(_ty) =&gt; chalk_ir::ParameterKind::Ty(()),
                ty::subst::GenericArgKind::Const(_const) =&gt; chalk_ir::ParameterKind::Ty(()),
            })
            .collect();
</pre></div>



<a name="194990375"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/194990375" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#194990375">(Apr 22 2020 at 20:57)</a>:</h4>
<p>And some potentially relevant debug output:</p>
<div class="codehilite"><pre><span></span>[src/librustc_traits/chalk/db.rs:245] &amp;bound_vars = [
    ReLateBound(DebruijnIndex(0), BrNamed(DefId(2:38280 ~ core[797c]::iter[0]::traits[0]::iterator[0]::{{impl}}[0]::&#39;_[0]), &#39;_)),
    I,
]
[src/librustc_traits/chalk/db.rs:261] &amp;trait_ref = &lt;&amp;mut I as std::iter::Iterator&gt;
[src/librustc_traits/chalk/db.rs:273] &amp;_predicates = [
    (
        Binder(
            TraitPredicate(&lt;I as std::iter::Iterator&gt;),
        ),
        /home/hueyj/temp/rust/rust/src/libcore/iter/traits/iterator.rs:3255:9: 3255:17,
    ),
]
thread &#39;rustc&#39; panicked at &#39;not implemented&#39;, src/librustc_traits/lowering/mod.rs:447:65
</pre></div>



<a name="194994468"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/194994468" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#194994468">(Apr 22 2020 at 21:37)</a>:</h4>
<p>hmm</p>



<a name="194994621"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/194994621" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#194994621">(Apr 22 2020 at 21:38)</a>:</h4>
<p>sorry I haven't been very "at keyboard"</p>



<a name="194994728"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/194994728" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#194994728">(Apr 22 2020 at 21:40)</a>:</h4>
<p>It's okay. Just whenever you have some time to take a look, it would be helpful :)</p>



<a name="194994794"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/194994794" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#194994794">(Apr 22 2020 at 21:40)</a>:</h4>
<p>trying to reproduce now</p>



<a name="194994800"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/194994800" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#194994800">(Apr 22 2020 at 21:40)</a>:</h4>
<p>I'll post an update later on</p>



<a name="194994811"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/194994811" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#194994811">(Apr 22 2020 at 21:41)</a>:</h4>
<p>I can't really explain it :)</p>



<a name="194994867"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/194994867" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#194994867">(Apr 22 2020 at 21:41)</a>:</h4>
<p>Works for me</p>



<a name="194994883"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/194994883" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#194994883">(Apr 22 2020 at 21:41)</a>:</h4>
<p>I'll be around whenever</p>



<a name="194996642"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/194996642" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#194996642">(Apr 22 2020 at 22:01)</a>:</h4>
<p><span class="user-mention" data-user-id="232957">@Jack Huey</span> what test are you running?</p>



<a name="194997248"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/194997248" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#194997248">(Apr 22 2020 at 22:08)</a>:</h4>
<p>oops, lower_impl</p>



<a name="194997257"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/194997257" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#194997257">(Apr 22 2020 at 22:08)</a>:</h4>
<p>that's important :)</p>



<a name="195000471"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195000471" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195000471">(Apr 22 2020 at 22:47)</a>:</h4>
<p><span class="user-mention" data-user-id="232957">@Jack Huey</span> so I added some <code>debug!</code> statements..</p>



<a name="195000484"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195000484" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195000484">(Apr 22 2020 at 22:47)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">trait_ref</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">tcx</span><span class="p">.</span><span class="n">impl_trait_ref</span><span class="p">(</span><span class="n">def_id</span><span class="p">).</span><span class="n">expect</span><span class="p">(</span><span class="s">&quot;not an impl&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">debug</span><span class="o">!</span><span class="p">(</span><span class="s">&quot;impl_trait_ref={:?}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">trait_ref</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">trait_ref</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">trait_ref</span><span class="p">.</span><span class="n">subst</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">tcx</span><span class="p">,</span><span class="w"> </span><span class="n">bound_vars</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">debug</span><span class="o">!</span><span class="p">(</span><span class="s">&quot;trait_ref post substitution={:?}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">trait_ref</span><span class="p">);</span><span class="w"></span>
</pre></div>



<a name="195000494"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195000494" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195000494">(Apr 22 2020 at 22:47)</a>:</h4>
<p>...and then ran with <code>-Zverbose</code>, which is a trick you might not know about...</p>



<a name="195000506"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195000506" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195000506">(Apr 22 2020 at 22:48)</a>:</h4>
<p>and I see this</p>



<a name="195000546"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195000546" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195000546">(Apr 22 2020 at 22:48)</a>:</h4>
<div class="codehilite"><pre><span></span>[DEBUG rustc_traits::chalk::db] impl_trait_ref=&lt;&amp;ReEarlyBound(0, &#39;_) mut I as std::iter::Iterator&gt;
[DEBUG rustc_traits::chalk::db] trait_ref post substitution=&lt;&amp;ReLateBound(DebruijnIndex(0), BrNamed(DefId(2:38280 ~ core[d046]::iter[0]::traits[0]::iterator[0]::{{impl}}[0]::&#39;_[0]), &#39;_)) mut I as std::iter::Iterator&gt;
</pre></div>



<a name="195000568"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195000568" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195000568">(Apr 22 2020 at 22:48)</a>:</h4>
<p>in other words, the <code>LateBound</code> is being injected by the <code>bound_vars</code> substitution</p>



<a name="195001396"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195001396" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195001396">(Apr 22 2020 at 22:58)</a>:</h4>
<p>I did not know about <code>-Zverbose</code></p>



<a name="195001422"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195001422" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195001422">(Apr 22 2020 at 22:59)</a>:</h4>
<p>right, <code>bound_vars</code> has a <code>ReLateBound</code></p>



<a name="195001429"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195001429" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195001429">(Apr 22 2020 at 22:59)</a>:</h4>
<p>(see above)</p>



<a name="195001446"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195001446" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195001446">(Apr 22 2020 at 22:59)</a>:</h4>
<div class="codehilite"><pre><span></span>&amp;bound_vars = [
    ReLateBound(DebruijnIndex(0), BrNamed(DefId(2:38280 ~ core[797c]::iter[0]::traits[0]::iterator[0]::{{impl}}[0]::&#39;_[0]), &#39;_)),
    I,
]
</pre></div>



<a name="195001586"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195001586" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195001586">(Apr 22 2020 at 23:00)</a>:</h4>
<p>yeah, so, I mean that does answer the question where it's coming :)</p>



<a name="195001617"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195001617" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195001617">(Apr 22 2020 at 23:00)</a>:</h4>
<p>maybe I don't understand your question exactly</p>



<a name="195001644"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195001644" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195001644">(Apr 22 2020 at 23:01)</a>:</h4>
<p>I think I would expect that, after the subst, you'd produce the form that lowering expects</p>



<a name="195001658"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195001658" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195001658">(Apr 22 2020 at 23:01)</a>:</h4>
<p>and in particular that it would convert <code>ReLateBound</code> into chalk's bound</p>



<a name="195001696"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195001696" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195001696">(Apr 22 2020 at 23:01)</a>:</h4>
<p>not quite, because it's a <code>BrNamed</code></p>



<a name="195001767"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195001767" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195001767">(Apr 22 2020 at 23:02)</a>:</h4>
<p>I guess what's surprising is that it's a <code>ReLateBound</code> in an impl</p>



<a name="195001910"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195001910" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195001910">(Apr 22 2020 at 23:04)</a>:</h4>
<p>huh so .. rustc never generates one</p>



<a name="195001934"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195001934" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195001934">(Apr 22 2020 at 23:04)</a>:</h4>
<p>but you injected it through the substitution</p>



<a name="195001949"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195001949" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195001949">(Apr 22 2020 at 23:04)</a>:</h4>
<p>Well, it from <code>bound_vars_for_item</code></p>



<a name="195001964"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195001964" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195001964">(Apr 22 2020 at 23:04)</a>:</h4>
<p>yeah, which is some chalk-specific code</p>



<a name="195001970"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195001970" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195001970">(Apr 22 2020 at 23:04)</a>:</h4>
<p>oh</p>



<a name="195001980"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195001980" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195001980">(Apr 22 2020 at 23:04)</a>:</h4>
<p>shoot</p>



<a name="195001981"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195001981" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195001981">(Apr 22 2020 at 23:04)</a>:</h4>
<p>it's meant to translate from "rust terms" to "bound variables that chalk understands", I think</p>



<a name="195002000"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195002000" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195002000">(Apr 22 2020 at 23:05)</a>:</h4>
<p>so it chooses "re-late-bound" because, in chalk, the <code>'a</code> would be a Bound region</p>



<a name="195002015"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195002015" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195002015">(Apr 22 2020 at 23:05)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/195001964" title="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/195001964">said</a>:</p>
<blockquote>
<p>yeah, which is some chalk-specific code</p>
</blockquote>
<p>pretty sure about this, anyway</p>



<a name="195002017"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195002017" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195002017">(Apr 22 2020 at 23:05)</a>:</h4>
<p>Okay, <em>thats</em> the answer I needed :)</p>



<a name="195002029"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195002029" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195002029">(Apr 22 2020 at 23:05)</a>:</h4>
<p>indeed, it's only used in <code>librustc_traits</code></p>



<a name="195002031"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195002031" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195002031">(Apr 22 2020 at 23:05)</a>:</h4>
<p>sorry it took so long :)</p>



<a name="195002093"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195002093" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195002093">(Apr 22 2020 at 23:06)</a>:</h4>
<p>no problem</p>



<a name="195002097"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195002097" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195002097">(Apr 22 2020 at 23:06)</a>:</h4>
<p>thanks for the help</p>



<a name="195002145"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195002145" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195002145">(Apr 22 2020 at 23:07)</a>:</h4>
<p>I'm wondering if it's worth doing another round of "chalk removal" <em>before</em> this PR is merged</p>



<a name="195002151"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195002151" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195002151">(Apr 22 2020 at 23:07)</a>:</h4>
<p>or, if it's better after</p>



<a name="195002358"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195002358" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195002358">(Apr 22 2020 at 23:10)</a>:</h4>
<p>i.e., to remove the domaingoal types and helpers etc?</p>



<a name="195002359"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195002359" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195002359">(Apr 22 2020 at 23:10)</a>:</h4>
<p>it might be nice, might help clarify the PR itself</p>



<a name="195002611"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195002611" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195002611">(Apr 22 2020 at 23:14)</a>:</h4>
<p>Yeah, somewhat</p>



<a name="195002645"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195002645" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195002645">(Apr 22 2020 at 23:15)</a>:</h4>
<p>The only sort of, I guess, objection I have is that, when I tried to remove <code>DomainGoal</code>, things got interesting with placeholder canonicalization</p>



<a name="195020760"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195020760" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195020760">(Apr 23 2020 at 05:51)</a>:</h4>
<p>What are the well-formed rules for <code>Tuple</code>s? That a tuple is well-formed if all the fields are?</p>



<a name="195020778"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195020778" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195020778">(Apr 23 2020 at 05:51)</a>:</h4>
<p>Or, a tuple is always well formed?</p>



<a name="195020867"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195020867" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195020867">(Apr 23 2020 at 05:53)</a>:</h4>
<p>Updating the rustc integration PR causes all the tests to fail because <code>() is not well-formed</code> (the <code>match_type_name</code> function is empty for tuples, so no well-formed rule is generated)</p>



<a name="195064559"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195064559" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195064559">(Apr 23 2020 at 14:00)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232957">Jack Huey</span> <a href="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/195020760" title="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/195020760">said</a>:</p>
<blockquote>
<p>What are the well-formed rules for <code>Tuple</code>s? That a tuple is well-formed if all the fields are?</p>
</blockquote>
<p>this</p>



<a name="195064589"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195064589" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195064589">(Apr 23 2020 at 14:00)</a>:</h4>
<p><em>but</em></p>



<a name="195064633"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195064633" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195064633">(Apr 23 2020 at 14:00)</a>:</h4>
<p>probably the rule we want for <code>match_Type_name</code> is just "tuples are always WF", because of the thing we were discussing earlier, that the iteration over types is done "externally"</p>



<a name="195064691"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195064691" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195064691">(Apr 23 2020 at 14:01)</a>:</h4>
<p>I noticed there was no rule there in the original PR but I wanted to ponder the right addition, so I didn't mention it:)</p>



<a name="195064710"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195064710" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195064710">(Apr 23 2020 at 14:01)</a>:</h4>
<p>/me afk today btw, also tomorrow</p>



<a name="195069324"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195069324" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195069324">(Apr 23 2020 at 14:32)</a>:</h4>
<p>Oh ok. I'll make a PR to add that at some point</p>



<a name="195150302"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195150302" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195150302">(Apr 24 2020 at 06:21)</a>:</h4>
<p>Okay <span class="user-mention" data-user-id="116009">@nikomatsakis</span>, I did some more cleanups of the PR</p>



<a name="195150306"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195150306" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195150306">(Apr 24 2020 at 06:21)</a>:</h4>
<p>including removing the <code>subtitute_params</code> in favor of <code>subst</code></p>



<a name="195150350"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195150350" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195150350">(Apr 24 2020 at 06:22)</a>:</h4>
<p>And the only one of your comments that hasn't been addressed is removing <code>DomainGoal</code></p>



<a name="195150355"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195150355" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195150355">(Apr 24 2020 at 06:22)</a>:</h4>
<p>But I feel like we should do that in a followup PR</p>



<a name="195150362"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195150362" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195150362">(Apr 24 2020 at 06:22)</a>:</h4>
<p>I had one question/observation: <a href="https://github.com/rust-lang/rust/blob/d4a58787fbd81d50d3e23cb86c7a01602e1bf6a4/src/librustc_traits/lowering/mod.rs#L858" title="https://github.com/rust-lang/rust/blob/d4a58787fbd81d50d3e23cb86c7a01602e1bf6a4/src/librustc_traits/lowering/mod.rs#L858">https://github.com/rust-lang/rust/blob/d4a58787fbd81d50d3e23cb86c7a01602e1bf6a4/src/librustc_traits/lowering/mod.rs#L858</a></p>



<a name="195150375"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195150375" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195150375">(Apr 24 2020 at 06:23)</a>:</h4>
<p>But other than that, I think this is getting to a point that it needs a "real" review</p>



<a name="195150455"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195150455" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195150455">(Apr 24 2020 at 06:25)</a>:</h4>
<p>That being said, I think after this PR is merged <a href="https://github.com/rust-lang/chalk/pull/411" title="https://github.com/rust-lang/chalk/pull/411">https://github.com/rust-lang/chalk/pull/411</a>, we should do a release</p>



<a name="195267238"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195267238" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195267238">(Apr 25 2020 at 04:22)</a>:</h4>
<p>So, I did end up putting in the work to remove <code>DomainGoal</code> and other related types from rustc. I'm a bit hesitant to merge it into the main PR <em>right now</em>, since there is something wrong, at least in terms of lifetimes</p>



<a name="195267249"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195267249" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195267249">(Apr 25 2020 at 04:23)</a>:</h4>
<p>The commits diffed to the PR: <a href="https://github.com/jackh726/rust/compare/chalk-upgrade...jackh726:chalk-upgrade-dg-new" title="https://github.com/jackh726/rust/compare/chalk-upgrade...jackh726:chalk-upgrade-dg-new">https://github.com/jackh726/rust/compare/chalk-upgrade...jackh726:chalk-upgrade-dg-new</a></p>



<a name="195267305"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195267305" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195267305">(Apr 25 2020 at 04:24)</a>:</h4>
<p>The error I get with these changes (in lower_trait_where_clause test):</p>
<div class="codehilite"><pre><span></span>error[E0308]: mismatched types
  --&gt; /home/hueyj/temp/rust/rust/src/test/ui/chalkify/lower_trait_where_clause.rs:6:1
   |
LL | / trait Foo&lt;&#39;a, &#39;b, T, U&gt;
LL | | where
LL | |     T: Borrow&lt;U&gt; + ?Sized,
LL | |     U: ?Sized + &#39;b,
...  |
LL | | {
LL | | }
   | |_^ lifetime mismatch
   |
   = note: expected type `&#39;a`
              found type `&#39;b`
note: the lifetime `&#39;b` as defined on the trait at 6:15...
  --&gt; /home/hueyj/temp/rust/rust/src/test/ui/chalkify/lower_trait_where_clause.rs:6:15
   |
LL | trait Foo&lt;&#39;a, &#39;b, T, U&gt;
   |               ^^
note: ...does not necessarily outlive the lifetime `&#39;a` as defined on the trait at 6:11
  --&gt; /home/hueyj/temp/rust/rust/src/test/ui/chalkify/lower_trait_where_clause.rs:6:11
   |
LL | trait Foo&lt;&#39;a, &#39;b, T, U&gt;
   |           ^^
</pre></div>



<a name="195311144"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195311144" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195311144">(Apr 26 2020 at 01:25)</a>:</h4>
<p>Yeah, so I sort of changed up how I was approaching this a bit</p>



<a name="195311189"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195311189" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195311189">(Apr 26 2020 at 01:26)</a>:</h4>
<p>I was getting these errors, basically, because I was elaborating the environment <em>after</em> canonicalization</p>



<a name="195311197"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195311197" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195311197">(Apr 26 2020 at 01:26)</a>:</h4>
<p>So, I now create a super simplified "environment" pre-canonicalization</p>



<a name="195311200"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195311200" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195311200">(Apr 26 2020 at 01:27)</a>:</h4>
<p>then canonicalize everything together</p>



<a name="195311250"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195311250" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195311250">(Apr 26 2020 at 01:28)</a>:</h4>
<p>It's moves a little bit of code around (some back into <code>librustc_trait_selection</code>, some up to <code>librustc_midle</code> because interning), but I think this is probably okay</p>



<a name="195315694"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195315694" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195315694">(Apr 26 2020 at 03:51)</a>:</h4>
<p>Ok, I added a commit to the PR that removes DomainGoal and related types</p>



<a name="195474678"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195474678" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195474678">(Apr 27 2020 at 21:03)</a>:</h4>
<p><span class="user-mention" data-user-id="232957">@Jack Huey</span> &lt;3</p>



<a name="195474687"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195474687" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195474687">(Apr 27 2020 at 21:03)</a>:</h4>
<p>you're moving fast :)</p>



<a name="195474697"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195474697" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195474697">(Apr 27 2020 at 21:03)</a>:</h4>
<p>do you think it's ready for a "real review"?</p>



<a name="195474699"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195474699" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195474699">(Apr 27 2020 at 21:03)</a>:</h4>
<p>seems like yes!</p>



<a name="195475949"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195475949" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195475949">(Apr 27 2020 at 21:14)</a>:</h4>
<p>Yes</p>



<a name="195475978"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195475978" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195475978">(Apr 27 2020 at 21:14)</a>:</h4>
<p>Doing some cleanups, but I think it's basically ready</p>



<a name="195477463"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195477463" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195477463">(Apr 27 2020 at 21:28)</a>:</h4>
<p>Okay I finally fixed the submodules and Cargo.lock <span aria-label="cold sweat" class="emoji emoji-1f630" role="img" title="cold sweat">:cold_sweat:</span></p>



<a name="195482150"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195482150" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195482150">(Apr 27 2020 at 22:18)</a>:</h4>
<p>Is there a way to create an interned <code>List</code> where <code>T</code> isn't <code>Copy</code></p>



<a name="195482184"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195482184" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195482184">(Apr 27 2020 at 22:18)</a>:</h4>
<p>I only see <code>from_arena</code></p>



<a name="195482186"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195482186" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195482186">(Apr 27 2020 at 22:18)</a>:</h4>
<p>which requires that</p>



<a name="195615496"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195615496" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195615496">(Apr 28 2020 at 19:41)</a>:</h4>
<p>Hmm</p>



<a name="195615498"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195615498" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195615498">(Apr 28 2020 at 19:41)</a>:</h4>
<p>Probably not</p>



<a name="195615512"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195615512" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195615512">(Apr 28 2020 at 19:41)</a>:</h4>
<p>Because the arena we're using, I think, doesn't run destructors</p>



<a name="195615525"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195615525" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195615525">(Apr 28 2020 at 19:41)</a>:</h4>
<p>which generally simplifies things</p>



<a name="195615640"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195615640" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195615640">(Apr 28 2020 at 19:42)</a>:</h4>
<p>I need to add <code>Copy</code> derives to all our wrapper types in Chalk</p>



<a name="195615652"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195615652" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195615652">(Apr 28 2020 at 19:42)</a>:</h4>
<p>Only <code>Lifetime</code> has it currently :/</p>



<a name="195617308"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195617308" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195617308">(Apr 28 2020 at 19:54)</a>:</h4>
<p>Ok, so maybe we should talk a little about <code>from_fallible</code> methods on the various types in <code>Interner</code></p>



<a name="195617449"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195617449" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195617449">(Apr 28 2020 at 19:55)</a>:</h4>
<p>So, all except <code>Substitution</code> collect an <code>impl IntoIterator&lt;Item = Result&lt;impl CastTo&lt;...&lt;I&gt;&gt;, E&gt;&gt;</code> into a <code>Result&lt;Vec&lt;Goal&lt;I&gt;&gt;, _&gt;</code></p>



<a name="195617469"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195617469" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195617469">(Apr 28 2020 at 19:55)</a>:</h4>
<p>use <code>?</code> to return potential error</p>



<a name="195617538"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195617538" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195617538">(Apr 28 2020 at 19:56)</a>:</h4>
<p>then, call <code>from</code> on the Vec</p>



<a name="195617560"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195617560" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195617560">(Apr 28 2020 at 19:56)</a>:</h4>
<p><code>Substitution</code> is different, in that it's the other way around</p>



<a name="195617589"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195617589" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195617589">(Apr 28 2020 at 19:56)</a>:</h4>
<p>and it's up to the interner to return an error</p>



<a name="195617692"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195617692" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195617692">(Apr 28 2020 at 19:57)</a>:</h4>
<p>yeah ..</p>



<a name="195617704"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195617704" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195617704">(Apr 28 2020 at 19:57)</a>:</h4>
<p>I think I imagined we might eventually invert that</p>



<a name="195617720"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195617720" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195617720">(Apr 28 2020 at 19:57)</a>:</h4>
<p>invert which?</p>



<a name="195617724"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195617724" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195617724">(Apr 28 2020 at 19:57)</a>:</h4>
<p>Substitution?</p>



<a name="195617745"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195617745" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195617745">(Apr 28 2020 at 19:57)</a>:</h4>
<p>i.e., so that "from-fallible" was the "core operation"</p>



<a name="195617757"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195617757" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195617757">(Apr 28 2020 at 19:57)</a>:</h4>
<p>and the infallible case included an <code>Ok</code> and an <code>unwrap</code></p>



<a name="195617778"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195617778" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195617778">(Apr 28 2020 at 19:57)</a>:</h4>
<p>on the other hand, I think rustc's core operation presently is infallible</p>



<a name="195617779"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195617779" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195617779">(Apr 28 2020 at 19:57)</a>:</h4>
<p>oh</p>



<a name="195617783"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195617783" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195617783">(Apr 28 2020 at 19:58)</a>:</h4>
<p>I forget</p>



<a name="195617820"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195617820" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195617820">(Apr 28 2020 at 19:58)</a>:</h4>
<p>it is</p>



<a name="195617830"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195617830" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195617830">(Apr 28 2020 at 19:58)</a>:</h4>
<p>one of those small things to be reconciled</p>



<a name="195617857"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195617857" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195617857">(Apr 28 2020 at 19:58)</a>:</h4>
<p>(I'm running into this because I'm finishing up the actually interning)</p>



<a name="195617867"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195617867" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195617867">(Apr 28 2020 at 19:58)</a>:</h4>
<p>(though fallibility makes sense to me, I think rustc doesn't do quite enough plumbing around of <code>Result</code>)</p>



<a name="195618066"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195618066" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195618066">(Apr 28 2020 at 19:59)</a>:</h4>
<p>I definitely think whatever solution we go for, we need to not collect into a vec</p>



<a name="195656366"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195656366" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195656366">(Apr 29 2020 at 03:36)</a>:</h4>
<p>Some more things to think about, that haven't been discussed much:</p>



<a name="195656381"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195656381" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195656381">(Apr 29 2020 at 03:37)</a>:</h4>
<p>Other builtin types, with potentially interesting implications: <code>Slice</code>, <code>Array</code>, <code>Ref</code>, <code>Never</code></p>



<a name="195656452"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195656452" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195656452">(Apr 29 2020 at 03:38)</a>:</h4>
<p>Do we/should we split <code>TypeName::Struct</code> into <code>TypeName::Struct</code>/<code>TypeName::Enum</code>/<code>TypeName::Union</code>? Particularly, how do we deal with the "last field"</p>



<a name="195661274"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195661274" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195661274">(Apr 29 2020 at 05:06)</a>:</h4>
<p>Okay, I did a few more cleanups. I'm gonna wait for a review to do anything else</p>



<a name="195764491"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195764491" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195764491">(Apr 29 2020 at 20:18)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232957">Jack Huey</span> <a href="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/195656452" title="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/195656452">said</a>:</p>
<blockquote>
<p>Do we/should we split <code>TypeName::Struct</code> into <code>TypeName::Struct</code>/<code>TypeName::Enum</code>/<code>TypeName::Union</code>? Particularly, how do we deal with the "last field"</p>
</blockquote>
<p>I think not</p>



<a name="195764508"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195764508" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195764508">(Apr 29 2020 at 20:19)</a>:</h4>
<p>We used to do that in rustc and migrated away from it, iirc</p>



<a name="195764520"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195764520" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195764520">(Apr 29 2020 at 20:19)</a>:</h4>
<p>I think it's best to have the struct/enum/union info accessible in the <code>StructDatum</code></p>



<a name="195764536"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195764536" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195764536">(Apr 29 2020 at 20:19)</a>:</h4>
<p>we might however want to rename to "adt" or whatever to indicate the generalization</p>



<a name="195764802"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195764802" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195764802">(Apr 29 2020 at 20:21)</a>:</h4>
<p>I figured that was probably the option to go with</p>



<a name="195764826"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195764826" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195764826">(Apr 29 2020 at 20:21)</a>:</h4>
<p>I guess the question is then how do we handle variants and fields</p>



<a name="195764894"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195764894" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195764894">(Apr 29 2020 at 20:22)</a>:</h4>
<p>e.g. do we just match how rustc does it</p>



<a name="195764928"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195764928" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Areredify <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195764928">(Apr 29 2020 at 20:22)</a>:</h4>
<p>I don't think there is any alternative, is there?</p>



<a name="195764981"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195764981" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195764981">(Apr 29 2020 at 20:23)</a>:</h4>
<p>I actually somewhat am curious why the different <code>AdtKind</code>s don't store the variant info</p>



<a name="195765117"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195765117" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195765117">(Apr 29 2020 at 20:24)</a>:</h4>
<p>I guess it's stored as flags</p>



<a name="195840709"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195840709" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195840709">(Apr 30 2020 at 13:47)</a>:</h4>
<p>Can someone help me figure out why the rustc integration PR failed CI? It just said rustc_middle failed to build with no specific error.</p>



<a name="195840800"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195840800" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195840800">(Apr 30 2020 at 13:48)</a>:</h4>
<p>But only on the mingw check</p>



<a name="195931678"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195931678" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195931678">(May 01 2020 at 04:44)</a>:</h4>
<p>Ok, so something is a bit weird with my PR and <code>parallel-compiler = true</code></p>



<a name="195931691"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195931691" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195931691">(May 01 2020 at 04:45)</a>:</h4>
<p>It basically uses up a ton of memory</p>



<a name="195931701"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195931701" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195931701">(May 01 2020 at 04:45)</a>:</h4>
<p>(Not sure if it does finish eventually)</p>



<a name="195931721"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195931721" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195931721">(May 01 2020 at 04:45)</a>:</h4>
<p>So essentially, I think I'm gonna start trying to figure out why</p>



<a name="195931795"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195931795" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195931795">(May 01 2020 at 04:46)</a>:</h4>
<p>But I figured a good intermediate step (which also is just better for reviewing) is to split out the removing of DomainGoal and such into a separate PR</p>



<a name="195931804"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195931804" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195931804">(May 01 2020 at 04:46)</a>:</h4>
<p>Since I doubt <em>removing</em> things causes memory issues</p>



<a name="195931818"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195931818" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195931818">(May 01 2020 at 04:47)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> the PR is just definitely reviewable still though</p>



<a name="195983396"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195983396" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195983396">(May 01 2020 at 17:07)</a>:</h4>
<p>New PR <a href="https://github.com/rust-lang/rust/issues/71758" title="https://github.com/rust-lang/rust/issues/71758">#71758</a></p>



<a name="195983407"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/195983407" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#195983407">(May 01 2020 at 17:07)</a>:</h4>
<p>Some surprising error changes</p>



<a name="196010157"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196010157" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196010157">(May 01 2020 at 21:06)</a>:</h4>
<p>I'm trying to decide how much I care about those surprising error changes.</p>



<a name="196011725"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196011725" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196011725">(May 01 2020 at 21:22)</a>:</h4>
<p>They only come up with <code>parallel-compiler = true</code></p>



<a name="196011735"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196011735" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196011735">(May 01 2020 at 21:23)</a>:</h4>
<p>And have nothing to do with the changes</p>



<a name="196011769"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196011769" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196011769">(May 01 2020 at 21:23)</a>:</h4>
<p>(they're removed now and everything passes as expected)</p>



<a name="196011836"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196011836" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196011836">(May 01 2020 at 21:24)</a>:</h4>
<p>I'm not trying to figure out what exactly is causing the memory problems with <code>parallel-compiler = true</code></p>



<a name="196011901"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196011901" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196011901">(May 01 2020 at 21:25)</a>:</h4>
<p>Currently just trying to minimize from this: <a href="https://github.com/jackh726/rust/compare/chalk-remove..chalk-middle" title="https://github.com/jackh726/rust/compare/chalk-remove..chalk-middle">https://github.com/jackh726/rust/compare/chalk-remove..chalk-middle</a></p>



<a name="196012801"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196012801" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196012801">(May 01 2020 at 21:35)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232957">Jack Huey</span> <a href="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/196011725" title="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/196011725">said</a>:</p>
<blockquote>
<p>They only come up with <code>parallel-compiler = true</code></p>
</blockquote>
<p>I meant the changes to errors from <a href="https://github.com/rust-lang/rust/issues/71758" title="https://github.com/rust-lang/rust/issues/71758">#71758</a></p>



<a name="196013028"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196013028" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196013028">(May 01 2020 at 21:37)</a>:</h4>
<p>No changes to errors anymore</p>



<a name="196013138"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196013138" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196013138">(May 01 2020 at 21:38)</a>:</h4>
<div class="codehilite"><pre><span></span><code>...
    = note: required because it appears within the type `chalk_ir::GoalData&lt;traits::chalk::RustInterner&lt;&#39;_&gt;&gt;`
    = note: required because it appears within the type `chalk_ir::GoalData&lt;traits::chalk::RustInterner&lt;&#39;_&gt;&gt;`
    = note: required because it appears within the type `chalk_ir::GoalData&lt;traits::chalk::RustInterner&lt;&#39;_&gt;&gt;`
    = note: required because it appears within the type `chalk_ir::Goal&lt;traits::chalk::RustInterner&lt;&#39;_&gt;&gt;`
</code></pre></div>



<a name="196013162"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196013162" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196013162">(May 01 2020 at 21:38)</a>:</h4>
<p>That might have something to do with the memory issues...</p>



<a name="196013360"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196013360" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196013360">(May 01 2020 at 21:40)</a>:</h4>
<div class="codehilite"><pre><span></span><code>error[E0275]: overflow evaluating the requirement `traits::chalk::RustInterner&lt;&#39;_&gt;: chalk_ir::interner::Interner`
  --&gt; src/librustc_middle/traits/chalk.rs:74:26
   |
74 |     type InternedGoals = Vec&lt;chalk_ir::Goal&lt;Self&gt;&gt;;
   |                          ^^^^^^^^^^^^^^^^^^^^^^^^^
   |
  ::: /home/hueyj/.cargo/registry/src/github.com-1ecc6299db9ec823/chalk-ir-0.10.0/src/interner.rs:99:46
   |
99 |     type InternedGoals: Debug + Clone + Eq + Hash;
   |                                              ---- required by this bound in `chalk_ir::interner::Interner`
   |
</code></pre></div>



<a name="196013547"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196013547" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196013547">(May 01 2020 at 21:42)</a>:</h4>
<p>oh wait there's more</p>



<a name="196013558"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196013558" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196013558">(May 01 2020 at 21:42)</a>:</h4>
<div class="codehilite"><pre><span></span><code>error[E0275]: overflow evaluating the requirement `traits::chalk::RustInterner&lt;&#39;_&gt;: chalk_ir::interner::Interner`
   --&gt; src/librustc_middle/traits/chalk.rs:74:5
    |
74  |     type InternedGoals = Vec&lt;chalk_ir::Goal&lt;Self&gt;&gt;;
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |
   ::: /home/hueyj/temp/rust/rust/src/liballoc/vec.rs:300:16
    |
300 | pub struct Vec&lt;T&gt; {
    |                - required by this bound in `std::vec::Vec`
    |
</code></pre></div>



<a name="196013599"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196013599" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196013599">(May 01 2020 at 21:43)</a>:</h4>
<div class="codehilite"><pre><span></span><code>error[E0275]: overflow evaluating the requirement `traits::chalk::RustInterner&lt;&#39;_&gt;: chalk_ir::interner::Interner`
   --&gt; src/librustc_middle/traits/chalk.rs:189:33
    |
189 |         data: impl IntoIterator&lt;Item = Result&lt;chalk_ir::Goal&lt;Self&gt;, E&gt;&gt;,
    |                                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |
   ::: /home/hueyj/temp/rust/rust/src/libcore/result.rs:247:17
    |
247 | pub enum Result&lt;T, E&gt; {
    |                 - required by this bound in `std::result::Result`
    |
</code></pre></div>



<a name="196013612"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196013612" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196013612">(May 01 2020 at 21:43)</a>:</h4>
<div class="codehilite"><pre><span></span><code>error[E0275]: overflow evaluating the requirement `traits::chalk::RustInterner&lt;&#39;_&gt;: chalk_ir::interner::Interner`
   --&gt; src/librustc_middle/traits/chalk.rs:194:37
    |
194 |     fn goals_data&lt;&#39;a&gt;(&amp;self, goals: &amp;&#39;a Self::InternedGoals) -&gt; &amp;&#39;a [chalk_ir::Goal&lt;Self&gt;] {
    |                                     ^^^^^^^^^^^^^^^^^^^^^^^
    |
   ::: /home/hueyj/temp/rust/rust/src/liballoc/vec.rs:300:16
    |
300 | pub struct Vec&lt;T&gt; {
    |                - required by this bound in `std::vec::Vec`
    |
</code></pre></div>



<a name="196015487"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196015487" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196015487">(May 01 2020 at 22:04)</a>:</h4>
<p>Seems like some sort of recursive bounds problem that's showing up only with <code>parallel-compiler = true</code></p>



<a name="196015672"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196015672" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196015672">(May 01 2020 at 22:07)</a>:</h4>
<p>I think roughly what's happening is (for example): <code>Goals</code> is getting checked, sees <code>InternedGoal</code>, <code>InternedGoal</code> is <code>TyData&lt;Self&gt;</code>, so now we have to check that <code>Self: Interner</code>, then recursion</p>



<a name="196015796"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196015796" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196015796">(May 01 2020 at 22:08)</a>:</h4>
<p>Ok so <em>this</em> error is still showing up with <code>parallel-compiler = false</code></p>



<a name="196027949"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196027949" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196027949">(May 02 2020 at 02:14)</a>:</h4>
<p>Nevermind. Boxing the interned types removes those errors</p>



<a name="196027951"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196027951" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196027951">(May 02 2020 at 02:14)</a>:</h4>
<p>but doesn't fix the memory problems</p>



<a name="196030625"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196030625" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196030625">(May 02 2020 at 03:32)</a>:</h4>
<p>Wait using <code>Box</code> instead of interning <em>does</em> fix the memory problems</p>



<a name="196033739"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196033739" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196033739">(May 02 2020 at 04:56)</a>:</h4>
<p>Okay this is a "minimal" reproduction of the problem: <a href="https://github.com/rust-lang/rust/compare/master...jackh726:chalk-middle" title="https://github.com/rust-lang/rust/compare/master...jackh726:chalk-middle">https://github.com/rust-lang/rust/compare/master...jackh726:chalk-middle</a></p>



<a name="196033760"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196033760" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196033760">(May 02 2020 at 04:57)</a>:</h4>
<p>This is <em>completely</em> fine with <code>parallel-compiler = false</code>, but just keeps increasing memory with <code>parallel-compiler = true</code></p>



<a name="196033811"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196033811" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196033811">(May 02 2020 at 04:59)</a>:</h4>
<p>Removing the <code>chalk_ty</code> interner here <a href="https://github.com/rust-lang/rust/compare/master...jackh726:chalk-middle#diff-1bffadcc6a4ac0564af0f075eb094eb1R99" title="https://github.com/rust-lang/rust/compare/master...jackh726:chalk-middle#diff-1bffadcc6a4ac0564af0f075eb094eb1R99">https://github.com/rust-lang/rust/compare/master...jackh726:chalk-middle#diff-1bffadcc6a4ac0564af0f075eb094eb1R99</a> works fine</p>



<a name="196033817"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196033817" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196033817">(May 02 2020 at 04:59)</a>:</h4>
<p>(also note that the interner is not even used in this repro)</p>



<a name="196036569"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196036569" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196036569">(May 02 2020 at 06:22)</a>:</h4>
<p>Removed the interners in the chalk integration PR and it seems like it's gonna build/pass (just waiting on Azure now)</p>



<a name="196221948"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196221948" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196221948">(May 04 2020 at 18:37)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232957">Jack Huey</span> <a href="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/196033817" title="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/196033817">said</a>:</p>
<blockquote>
<p>(also note that the interner is not even used in this repro)</p>
</blockquote>
<p><span class="user-mention" data-user-id="232957">@Jack Huey</span> woah</p>



<a name="196232758"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196232758" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196232758">(May 04 2020 at 20:01)</a>:</h4>
<p>Yeah, so something is <em>very</em> wrong here</p>



<a name="196244318"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196244318" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196244318">(May 04 2020 at 21:50)</a>:</h4>
<p>Trying to decide if it's worth filing an issue</p>



<a name="196244354"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196244354" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196244354">(May 04 2020 at 21:50)</a>:</h4>
<p><span class="user-mention" data-user-id="232957">@Jack Huey</span> you currently have two PRs related to this?</p>



<a name="196244372"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196244372" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196244372">(May 04 2020 at 21:51)</a>:</h4>
<p>Nope, just the integration PR, which I've reverted the interning</p>



<a name="196244382"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196244382" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196244382">(May 04 2020 at 21:51)</a>:</h4>
<p>I have the minimal repro in a branch</p>



<a name="196244394"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196244394" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196244394">(May 04 2020 at 21:51)</a>:</h4>
<p>"minimal" at least in the sense that it uses Chalk</p>



<a name="196244407"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196244407" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196244407">(May 04 2020 at 21:52)</a>:</h4>
<p>I haven't tried to minimize it to a non-Chalk case</p>



<a name="196244569"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196244569" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196244569">(May 04 2020 at 21:53)</a>:</h4>
<p>There used to be a PR that removed the "old chalk integration"</p>



<a name="196244571"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196244571" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196244571">(May 04 2020 at 21:53)</a>:</h4>
<p>what happened to it?</p>



<a name="196244841"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196244841" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196244841">(May 04 2020 at 21:57)</a>:</h4>
<p>it got merged?</p>



<a name="196244956"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196244956" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196244956">(May 04 2020 at 21:58)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/pull/71758" title="https://github.com/rust-lang/rust/pull/71758">https://github.com/rust-lang/rust/pull/71758</a></p>



<a name="196244981"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196244981" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196244981">(May 04 2020 at 21:58)</a>:</h4>
<p>Was that premature? oops...</p>



<a name="196245022"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196245022" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196245022">(May 04 2020 at 21:59)</a>:</h4>
<p>no, that's ok</p>



<a name="196245054"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196245054" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196245054">(May 04 2020 at 21:59)</a>:</h4>
<p>Basically, the random errors were not PR issues, just <code>parallel-compiler</code> issues</p>



<a name="196245062"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196245062" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196245062">(May 04 2020 at 21:59)</a>:</h4>
<p>yep, I see now</p>



<a name="196247147"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196247147" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196247147">(May 04 2020 at 22:23)</a>:</h4>
<p>heh, ok, I'm reading back over this PR</p>



<a name="196247163"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196247163" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196247163">(May 04 2020 at 22:23)</a>:</h4>
<p>it's a lot of code with relatively few comments...</p>



<a name="196247182"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196247182" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196247182">(May 04 2020 at 22:23)</a>:</h4>
<p>...but I'm wondering how much to worry about that, since I expect a lot of this code to eventually be removed</p>



<a name="196247865"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196247865" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196247865">(May 04 2020 at 22:30)</a>:</h4>
<p>I think what might be nicest is a high-level overview of what the role of each file is etc</p>



<a name="196247873"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196247873" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196247873">(May 04 2020 at 22:30)</a>:</h4>
<p>I can add lots of comments</p>



<a name="196248071"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196248071" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196248071">(May 04 2020 at 22:32)</a>:</h4>
<p>I just extended <a href="https://github.com/rust-lang/chalk/issues/368" title="https://github.com/rust-lang/chalk/issues/368">https://github.com/rust-lang/chalk/issues/368</a></p>



<a name="196248074"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196248074" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196248074">(May 04 2020 at 22:32)</a>:</h4>
<p>with a bunch of stuff taken from the PR</p>



<a name="196248224"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196248224" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196248224">(May 04 2020 at 22:34)</a>:</h4>
<p>ok, I didn't have a lot of comments -- I mean it's fairly rough -- but it looks like what I expect</p>



<a name="196248226"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196248226" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196248226">(May 04 2020 at 22:34)</a>:</h4>
<p>very nice</p>



<a name="196248236"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196248236" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196248236">(May 04 2020 at 22:34)</a>:</h4>
<p>one thing I remembered... we discussed how to handle the environment a fair amount</p>



<a name="196248254"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196248254" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196248254">(May 04 2020 at 22:35)</a>:</h4>
<p>Ah, I see what you wound up with</p>



<a name="196248265"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196248265" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196248265">(May 04 2020 at 22:35)</a>:</h4>
<p><code>ChalkEnvironmentClause</code>?</p>



<a name="196248267"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196248267" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196248267">(May 04 2020 at 22:35)</a>:</h4>
<p>Seems good</p>



<a name="196248303"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196248303" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196248303">(May 04 2020 at 22:35)</a>:</h4>
<p>Yep</p>



<a name="196248367"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196248367" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196248367">(May 04 2020 at 22:36)</a>:</h4>
<p>Basically as minimal as possible without having to try to a lower a non-canonicalized goal</p>



<a name="196248412"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196248412" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196248412">(May 04 2020 at 22:36)</a>:</h4>
<p>(which, by the way, <code>canonicalize</code> is currently <code>pub(crate)</code>)</p>



<a name="196367766"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196367766" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196367766">(May 05 2020 at 21:06)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> I'm gonna some time this evening to add docs and address comments</p>



<a name="196826338"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196826338" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196826338">(May 07 2020 at 20:30)</a>:</h4>
<p>Ok <span class="user-mention" data-user-id="116009">@nikomatsakis</span> added some docs and addressed comments</p>



<a name="196826404"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196826404" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196826404">(May 07 2020 at 20:31)</a>:</h4>
<p>When you're done reviewing, I'm actually gonna squash the commits I think. Or I could do it now.</p>



<a name="196829571"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196829571" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196829571">(May 07 2020 at 21:01)</a>:</h4>
<p><span class="user-mention" data-user-id="232957">@Jack Huey</span> you might as well do it now</p>



<a name="196833391"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196833391" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196833391">(May 07 2020 at 21:36)</a>:</h4>
<p>Okay, will do that</p>



<a name="196833403"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196833403" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196833403">(May 07 2020 at 21:37)</a>:</h4>
<p>Also looks like CI is complaining about Cargo.lock file for some reason</p>



<a name="196833408"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196833408" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196833408">(May 07 2020 at 21:37)</a>:</h4>
<p>So rebasing on master</p>



<a name="196833441"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196833441" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196833441">(May 07 2020 at 21:37)</a>:</h4>
<p>reviewing now!</p>



<a name="196834004"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196834004" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196834004">(May 07 2020 at 21:42)</a>:</h4>
<p>heh, I'm wondering if we .. uh .. need an MCP here</p>



<a name="196834017"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196834017" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196834017">(May 07 2020 at 21:42)</a>:</h4>
<p>or if that's just kind of silly :P</p>



<a name="196834049"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196834049" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196834049">(May 07 2020 at 21:43)</a>:</h4>
<p>btw, I think the short comments are still really great to have</p>



<a name="196834064"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196834064" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196834064">(May 07 2020 at 21:43)</a>:</h4>
<p>a file with no comments is just so disspiriting</p>



<a name="196834508"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196834508" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196834508">(May 07 2020 at 21:47)</a>:</h4>
<p>I guess I feel like it's a good idea, even if I will probably "move the process" fast</p>



<a name="196834571"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196834571" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196834571">(May 07 2020 at 21:48)</a>:</h4>
<p>I wonder if we should make a design meeting proposal to talk about the integration and how it works (to disseminate info)</p>



<a name="196834874"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196834874" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196834874">(May 07 2020 at 21:51)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/196834004" title="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/196834004">said</a>:</p>
<blockquote>
<p>heh, I'm wondering if we .. uh .. need an MCP here</p>
</blockquote>
<p>Hmm. I mean, maybe. It's...a lot of code...but it's pretty much isolated to <code>-Z chalk</code></p>



<a name="196834926"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196834926" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196834926">(May 07 2020 at 21:51)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/196834049" title="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/196834049">said</a>:</p>
<blockquote>
<p>btw, I think the short comments are still really great to have</p>
</blockquote>
<p>Is there something that you still think is missing?</p>



<a name="196834996"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196834996" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196834996">(May 07 2020 at 21:52)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/196834571" title="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/196834571">said</a>:</p>
<blockquote>
<p>I wonder if we should make a design meeting proposal to talk about the integration and how it works (to disseminate info)</p>
</blockquote>
<p>Pre-merge? Or not necessarily?</p>



<a name="196835785"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196835785" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196835785">(May 07 2020 at 22:00)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/196834508" title="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/196834508">said</a>:</p>
<blockquote>
<p>I guess I feel like it's a good idea, even if I will probably "move the process" fast</p>
</blockquote>
<p>this is probably in regards to the MCP</p>



<a name="196836979"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196836979" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196836979">(May 07 2020 at 22:12)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232957">Jack Huey</span> <a href="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/196834996" title="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/196834996">said</a>:</p>
<blockquote>
<p>Pre-merge? Or not necessarily?</p>
</blockquote>
<p>post-merge, Imeant</p>



<a name="196836995"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196836995" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196836995">(May 07 2020 at 22:12)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232957">Jack Huey</span> <a href="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/196835785" title="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/196835785">said</a>:</p>
<blockquote>
<p>this is probably in regards to the MCP</p>
</blockquote>
<p>yep.</p>



<a name="196837006"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196837006" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196837006">(May 07 2020 at 22:12)</a>:</h4>
<p>in particular, the MCP process includes a specific proviso for "forego the long waiting period" if we believe it to be uncontroversial</p>



<a name="196837025"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196837025" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196837025">(May 07 2020 at 22:13)</a>:</h4>
<p>I think that applies here</p>



<a name="196837050"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196837050" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196837050">(May 07 2020 at 22:13)</a>:</h4>
<p>in any case i'm still skimming comments, I think they probably cover the important bits</p>



<a name="196837109"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196837109" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196837109">(May 07 2020 at 22:14)</a>:</h4>
<p>I do think we should try to get a better sense of the FIXMEs--but I guess in reality when we're actually talking about ungating this stuff we're going to be mostly driving the process by "run all the tests"</p>



<a name="196837132"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196837132" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196837132">(May 07 2020 at 22:14)</a>:</h4>
<p>Right</p>



<a name="196837175"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196837175" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196837175">(May 07 2020 at 22:15)</a>:</h4>
<p>I wouldn't say the FIXMEs are an exhaustive set of changes that need to be made to make this "correct"</p>



<a name="196837177"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196837177" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196837177">(May 07 2020 at 22:15)</a>:</h4>
<p>I think in the <a href="http://lowering.rs" title="http://lowering.rs">lowering.rs</a> file, I might have talked a bit more about the trait</p>



<a name="196837183"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196837183" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196837183">(May 07 2020 at 22:15)</a>:</h4>
<p>and how it is used elsewhere</p>



<a name="196837192"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196837192" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196837192">(May 07 2020 at 22:15)</a>:</h4>
<p>but .. it's fine</p>



<a name="196837214"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196837214" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196837214">(May 07 2020 at 22:15)</a>:</h4>
<p>Ah, I see</p>



<a name="196837219"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196837219" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196837219">(May 07 2020 at 22:15)</a>:</h4>
<p>this is awesome</p>



<a name="196837222"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196837222" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196837222">(May 07 2020 at 22:15)</a>:</h4>
<p>quite a lot of work you put into this &lt;3</p>



<a name="196837279"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196837279" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196837279">(May 07 2020 at 22:16)</a>:</h4>
<p>Feels like it</p>



<a name="196837288"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196837288" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196837288">(May 07 2020 at 22:16)</a>:</h4>
<p>I think it's basically good to go</p>



<a name="196837299"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196837299" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196837299">(May 07 2020 at 22:16)</a>:</h4>
<p>awesome</p>



<a name="196837311"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196837311" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196837311">(May 07 2020 at 22:16)</a>:</h4>
<p>Do you want me to make an MCP issue?</p>



<a name="196837336"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196837336" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196837336">(May 07 2020 at 22:17)</a>:</h4>
<p>hmm if you don't mind, why not -- I'll go ahead and second it</p>



<a name="196837361"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196837361" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196837361">(May 07 2020 at 22:17)</a>:</h4>
<p>the only thing I'm at all wondering is if we wanted to "feature gate" this in some way so avoid bumping up build times, but I have no reason to think it necessrily increases those</p>



<a name="196837400"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196837400" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196837400">(May 07 2020 at 22:17)</a>:</h4>
<p>In regards to build times</p>



<a name="196837444"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196837444" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196837444">(May 07 2020 at 22:18)</a>:</h4>
<p>I really don't think it's going to have much impact</p>



<a name="196837452"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196837452" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196837452">(May 07 2020 at 22:18)</a>:</h4>
<p>I suspect not too</p>



<a name="196837465"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196837465" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196837465">(May 07 2020 at 22:18)</a>:</h4>
<p>it's in that "highly parallelized" time I suspect</p>



<a name="196837468"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196837468" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196837468">(May 07 2020 at 22:18)</a>:</h4>
<p>90% of the code is in <code>librustc_traits</code>, which is very late in build</p>



<a name="196837505"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196837505" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196837505">(May 07 2020 at 22:18)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/196837465" title="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/196837465">said</a>:</p>
<blockquote>
<p>it's in that "highly parallelized" time I suspect</p>
</blockquote>
<p>that's a better way to put it</p>



<a name="196837665"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196837665" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196837665">(May 07 2020 at 22:20)</a>:</h4>
<p>(re: MCP, ping me, but it doens't have to be super long or anything...)</p>



<a name="196837672"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196837672" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196837672">(May 07 2020 at 22:20)</a>:</h4>
<p>writing it now</p>



<a name="196838738"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196838738" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196838738">(May 07 2020 at 22:34)</a>:</h4>
<p><a href="https://github.com/rust-lang/compiler-team/issues/289" title="https://github.com/rust-lang/compiler-team/issues/289">https://github.com/rust-lang/compiler-team/issues/289</a></p>



<a name="196838871"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196838871" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196838871">(May 07 2020 at 22:35)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span></p>



<a name="196840357"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196840357" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196840357">(May 07 2020 at 22:53)</a>:</h4>
<p>seconded and r+'d</p>



<a name="196840406"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196840406" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196840406">(May 07 2020 at 22:54)</a>:</h4>
<p>I'm so ready</p>



<a name="196920520"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196920520" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196920520">(May 08 2020 at 16:52)</a>:</h4>
<p>Well, it was getting tested with bors and then my mouse spazzed out and I accidentally clicked close PR. So now after reopening I have to wait</p>



<a name="196920669"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/196920669" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#196920669">(May 08 2020 at 16:53)</a>:</h4>
<p>Ah, rollup anyways</p>



<a name="197012887"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/197012887" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#197012887">(May 09 2020 at 21:07)</a>:</h4>
<p>PR has landed :)</p>



<a name="197345800"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/197345800" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#197345800">(May 12 2020 at 22:02)</a>:</h4>
<p>I got the compare mode for chalk working</p>



<a name="197368603"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/197368603" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#197368603">(May 13 2020 at 04:43)</a>:</h4>
<p>So, I found an interesting problem</p>



<a name="197368604"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/197368604" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#197368604">(May 13 2020 at 04:43)</a>:</h4>
<p>somewhat related to binders and such</p>



<a name="197368649"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/197368649" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#197368649">(May 13 2020 at 04:44)</a>:</h4>
<p>So, when we elaborate the environment for a goal, we add clauses in the environment <code>FromEnv(Ty)</code> for all types in the goal</p>



<a name="197368652"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/197368652" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#197368652">(May 13 2020 at 04:44)</a>:</h4>
<p>But, looking here: <a href="https://github.com/rust-lang/rust/blob/master/src/librustc_trait_selection/traits/chalk_fulfill.rs#L104">https://github.com/rust-lang/rust/blob/master/src/librustc_trait_selection/traits/chalk_fulfill.rs#L104</a></p>



<a name="197368661"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/197368661" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#197368661">(May 13 2020 at 04:45)</a>:</h4>
<p>We just skip late bound regions</p>



<a name="197368674"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/197368674" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#197368674">(May 13 2020 at 04:45)</a>:</h4>
<p>err well</p>



<a name="197368684"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/197368684" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#197368684">(May 13 2020 at 04:45)</a>:</h4>
<p><code>liberate_late_bound_regions</code></p>



<a name="197368730"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/197368730" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#197368730">(May 13 2020 at 04:46)</a>:</h4>
<p>According to the docs: "Replaces any late-bound regions bound in value with free variants attached to all_outlive_scope."</p>



<a name="197368748"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/197368748" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#197368748">(May 13 2020 at 04:46)</a>:</h4>
<p>But...that's not exactly what I'm seeing</p>



<a name="197368809"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/197368809" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#197368809">(May 13 2020 at 04:49)</a>:</h4>
<p>I'm seeing a <code>ChalkEnvironmentAndGoal</code>:</p>
<div class="codehilite"><pre><span></span><code>ChalkEnvironmentAndGoal {
    environment: [
        TypeFromEnv(for&lt;&#39;a, &#39;b&gt; fn(&amp;&#39;a u8, &amp;&#39;b u8) -&gt; &amp;&#39;a u8),
        TypeFromEnv(&amp;u8),
        TypeFromEnv(u8),
        TypeFromEnv(&amp;u8),
    ],
    goal: Binder(
        TraitPredicate(&lt;for&lt;&#39;a, &#39;b&gt; fn(&amp;&#39;a u8, &amp;&#39;b u8) -&gt; &amp;&#39;a u8 as TheTrait&gt;),
    ),
}
</code></pre></div>



<a name="197368868"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/197368868" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#197368868">(May 13 2020 at 04:50)</a>:</h4>
<p>But those regions are <code>ReLateBound</code> with a <code>BoundRegion::BrNamed</code></p>



<a name="197368952"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/197368952" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#197368952">(May 13 2020 at 04:52)</a>:</h4>
<p>Haha oh wait</p>



<a name="197368954"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/197368954" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#197368954">(May 13 2020 at 04:52)</a>:</h4>
<p>The line I referenced isn't right</p>



<a name="197368958"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/197368958" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#197368958">(May 13 2020 at 04:52)</a>:</h4>
<p>in reality, it's <code>TraitImpl</code></p>



<a name="197368963"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/197368963" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#197368963">(May 13 2020 at 04:52)</a>:</h4>
<p>So it's using <code>args.walk()</code></p>



<a name="198125570"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198125570" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198125570">(May 19 2020 at 20:57)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> So, one thing I wanted to talk about was our plans for how we want to handle <code>Param</code>. I.e. do we want to add it to Chalk? Or do we want to try to modify rustc to use bound vars or placeholders</p>



<a name="198125625"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198125625" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198125625">(May 19 2020 at 20:58)</a>:</h4>
<p>ah yeah</p>



<a name="198125630"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198125630" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198125630">(May 19 2020 at 20:58)</a>:</h4>
<p>that's a good question</p>



<a name="198125662"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198125662" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198125662">(May 19 2020 at 20:58)</a>:</h4>
<p>I added a bullet around extending how rustc handles late-bound... but I forgot about that mismatch</p>



<a name="198125694"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198125694" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198125694">(May 19 2020 at 20:58)</a>:</h4>
<p>I would be in favor of trying to modify rustc, but it's gonna be "a job"</p>



<a name="198125695"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198125695" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198125695">(May 19 2020 at 20:58)</a>:</h4>
<p>So...theoretically if I wanted to remove Param in rustc...where would I even start</p>



<a name="198125720"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198125720" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198125720">(May 19 2020 at 20:58)</a>:</h4>
<p>That's a tough question obviously</p>



<a name="198125723"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198125723" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198125723">(May 19 2020 at 20:58)</a>:</h4>
<p>lol, exactly</p>



<a name="198125745"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198125745" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198125745">(May 19 2020 at 20:59)</a>:</h4>
<p>let me see</p>



<a name="198125767"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198125767" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198125767">(May 19 2020 at 20:59)</a>:</h4>
<p>I think what I would do first</p>



<a name="198125777"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198125777" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198125777">(May 19 2020 at 20:59)</a>:</h4>
<p>is to try and introduce a new type <em>like</em> <code>Binders</code> but not <code>Binders</code></p>



<a name="198125784"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198125784" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198125784">(May 19 2020 at 20:59)</a>:</h4>
<p>something like <code>EarlyBinders</code></p>



<a name="198125822"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198125822" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198125822">(May 19 2020 at 20:59)</a>:</h4>
<p>and put it on all the queries that yield types which return values that contain bound values that need substitution</p>



<a name="198125897"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198125897" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198125897">(May 19 2020 at 21:00)</a>:</h4>
<p>Ah interesting</p>



<a name="198125907"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198125907" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198125907">(May 19 2020 at 21:00)</a>:</h4>
<p>such that you have to do some kind of <code>.subst_identify()</code> call to access the data</p>



<a name="198125976"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198125976" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198125976">(May 19 2020 at 21:00)</a>:</h4>
<p>I'm not sure how important it is to do it first, but it feels we would do it query-by-query</p>



<a name="198125985"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198125985" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198125985">(May 19 2020 at 21:00)</a>:</h4>
<p>and it would help us to get a feel for what we're getting ourselves into</p>



<a name="198126027"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198126027" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198126027">(May 19 2020 at 21:01)</a>:</h4>
<p>Hmm. That was sort of what I was wondering. If there was a way to break it up</p>



<a name="198126045"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198126045" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198126045">(May 19 2020 at 21:01)</a>:</h4>
<p>Or if we have to jump in the deep end</p>



<a name="198126078"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198126078" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198126078">(May 19 2020 at 21:01)</a>:</h4>
<p>this is sort of somewhere in between</p>



<a name="198126087"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198126087" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198126087">(May 19 2020 at 21:01)</a>:</h4>
<p>as this idea doesn't actually <em>change</em> anything</p>



<a name="198126139"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198126139" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198126139">(May 19 2020 at 21:02)</a>:</h4>
<p>but I think it can be done bit by bit</p>



<a name="198126156"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198126156" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198126156">(May 19 2020 at 21:02)</a>:</h4>
<p>e.g., we might start with just types or something</p>



<a name="198126172"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198126172" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198126172">(May 19 2020 at 21:02)</a>:</h4>
<p>like, struct types and enums and that sort of thing</p>



<a name="198126186"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198126186" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198126186">(May 19 2020 at 21:02)</a>:</h4>
<p>though it may be hard to do actually</p>



<a name="198126201"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198126201" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198126201">(May 19 2020 at 21:02)</a>:</h4>
<p>because rustc does some amount of "punning"</p>



<a name="198126256"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198126256" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198126256">(May 19 2020 at 21:03)</a>:</h4>
<p>in other words, there are various sorts of things, all of which can have a <code>DefId</code>, and for which you can use <code>generics_of</code>, <code>predicates_of</code>, and <code>type_of</code> query</p>



<a name="198126262"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198126262" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198126262">(May 19 2020 at 21:03)</a>:</h4>
<p>and they all work in the same way</p>



<a name="198126273"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198126273" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198126273">(May 19 2020 at 21:03)</a>:</h4>
<p>so I don't know if you can change one "category of things"</p>



<a name="198126286"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198126286" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198126286">(May 19 2020 at 21:03)</a>:</h4>
<p>so yeah I think i'd start by introducing this new type</p>



<a name="198126315"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198126315" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198126315">(May 19 2020 at 21:03)</a>:</h4>
<p>and this would be my first commit, in part beacuse that you <em>can</em> add bit by bit and do the rote work</p>



<a name="198126342"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198126342" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198126342">(May 19 2020 at 21:04)</a>:</h4>
<p>then I might go try to change name resolution and see what happens</p>



<a name="198126394"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198126394" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198126394">(May 19 2020 at 21:04)</a>:</h4>
<p>i.e., figure out how to produce late-bound things</p>



<a name="198126422"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198126422" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198126422">(May 19 2020 at 21:04)</a>:</h4>
<p>this will probably cause things to break, identifying more areas to introduce "binders"</p>



<a name="198126448"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198126448" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198126448">(May 19 2020 at 21:04)</a>:</h4>
<p>Welp okay</p>



<a name="198126456"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198126456" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198126456">(May 19 2020 at 21:04)</a>:</h4>
<p>iterate until things seem to work :)</p>



<a name="198126474"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198126474" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198126474">(May 19 2020 at 21:04)</a>:</h4>
<p>one other option might be</p>



<a name="198126475"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198126475" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198126475">(May 19 2020 at 21:04)</a>:</h4>
<p>So, the idea of <code>EarlyBinders</code> is what exactly?</p>



<a name="198126486"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198126486" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198126486">(May 19 2020 at 21:05)</a>:</h4>
<p>hmm ok maybe this</p>



<a name="198126521"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198126521" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198126521">(May 19 2020 at 21:05)</a>:</h4>
<p>right so -- I think the "main bit" of work we have to do is identify where people are leveraging the "identify substitution"</p>



<a name="198126535"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198126535" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198126535">(May 19 2020 at 21:05)</a>:</h4>
<p>and replace it with some kind of <em>active</em> substitution to use placeholders</p>



<a name="198126545"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198126545" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198126545">(May 19 2020 at 21:05)</a>:</h4>
<p>btw, there is a chance that this will be a perf regression</p>



<a name="198126550"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198126550" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198126550">(May 19 2020 at 21:05)</a>:</h4>
<p>I'm not sure whether we care</p>



<a name="198126557"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198126557" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198126557">(May 19 2020 at 21:06)</a>:</h4>
<p>I mean it does <em>seem</em> like strictly more work</p>



<a name="198126600"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198126600" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198126600">(May 19 2020 at 21:06)</a>:</h4>
<p>but it's not clear how much that matters</p>



<a name="198126626"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198126626" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198126626">(May 19 2020 at 21:06)</a>:</h4>
<p>so the idea with <code>EarlyBinders</code> was to help identify those places and introduce some kind of fn call</p>



<a name="198126649"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198126649" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198126649">(May 19 2020 at 21:06)</a>:</h4>
<p>By "identify substitution", do you mean "identity"</p>



<a name="198126659"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198126659" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198126659">(May 19 2020 at 21:06)</a>:</h4>
<p>I..do</p>



<a name="198126677"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198126677" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198126677">(May 19 2020 at 21:06)</a>:</h4>
<p>was I writing identify?</p>



<a name="198126684"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198126684" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198126684">(May 19 2020 at 21:06)</a>:</h4>
<p>yes</p>



<a name="198126686"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198126686" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198126686">(May 19 2020 at 21:06)</a>:</h4>
<p>looks like I was...</p>



<a name="198126703"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198126703" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198126703">(May 19 2020 at 21:07)</a>:</h4>
<p>identity</p>



<a name="198126707"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198126707" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198126707">(May 19 2020 at 21:07)</a>:</h4>
<p>I was a <em>bit</em> confused</p>



<a name="198126712"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198126712" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198126712">(May 19 2020 at 21:07)</a>:</h4>
<p>and wanted to clarify</p>



<a name="198126761"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198126761" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198126761">(May 19 2020 at 21:07)</a>:</h4>
<p>before I converted <code>ty::Param</code> to actual <code>ty::BoundVar</code>, I would probably add some "intermediate" step that can be asserted--</p>



<a name="198126816"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198126816" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198126816">(May 19 2020 at 21:08)</a>:</h4>
<p>like maybe a <code>ty::EarlyBound(usize)</code> or something</p>



<a name="198126824"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198126824" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198126824">(May 19 2020 at 21:08)</a>:</h4>
<p>and change the substitution to replace <em>that</em></p>



<a name="198126839"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198126839" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198126839">(May 19 2020 at 21:08)</a>:</h4>
<p>this way we will start to get asserions when we are failing to substitute</p>



<a name="198126873"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198126873" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198126873">(May 19 2020 at 21:08)</a>:</h4>
<p>then once that is all working, we would drop all these "early" types and convert them to use debrujin indices</p>



<a name="198126884"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198126884" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198126884">(May 19 2020 at 21:08)</a>:</h4>
<p>anyway I'm still not seeing a good "incremental" path here tbh</p>



<a name="198126894"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198126894" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198126894">(May 19 2020 at 21:09)</a>:</h4>
<p>and this is <em>definitely</em> a MCP issue</p>



<a name="198126914"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198126914" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198126914">(May 19 2020 at 21:09)</a>:</h4>
<p>personally I think it will make the code clearer</p>



<a name="198126940"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198126940" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198126940">(May 19 2020 at 21:09)</a>:</h4>
<p>but I can imagine others might disagree</p>



<a name="198126960"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198126960" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198126960">(May 19 2020 at 21:09)</a>:</h4>
<p>but it seems like there is an "implicit step" happening that would become explicit</p>



<a name="198126973"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198126973" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198126973">(May 19 2020 at 21:09)</a>:</h4>
<p>and it will be harder to make certain kinds of errors</p>



<a name="198126993"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198126993" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198126993">(May 19 2020 at 21:09)</a>:</h4>
<p>in particular it would be hard to forget to substitute</p>



<a name="198127056"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198127056" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198127056">(May 19 2020 at 21:10)</a>:</h4>
<p>Is it worth trying to do a bit before writing an MCP to get a better gist of what the steps will be</p>



<a name="198127144"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198127144" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198127144">(May 19 2020 at 21:10)</a>:</h4>
<p>possibly</p>



<a name="198127184"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198127184" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198127184">(May 19 2020 at 21:10)</a>:</h4>
<p>it'd be good to see if <span class="user-mention" data-user-id="119009">@eddyb</span> has any bright ideas here (or opinions)</p>



<a name="198127220"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198127220" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198127220">(May 19 2020 at 21:11)</a>:</h4>
<p>I only really say that because...well...I don't really know what I'm doing here at all</p>



<a name="198127287"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198127287" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198127287">(May 19 2020 at 21:11)</a>:</h4>
<p>one thing we could do</p>



<a name="198127294"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198127294" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198127294">(May 19 2020 at 21:11)</a>:</h4>
<p>something we've rarely done I guess</p>



<a name="198127301"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198127301" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198127301">(May 19 2020 at 21:11)</a>:</h4>
<p>would be to schedule a 1 hour virtual pairing session</p>



<a name="198127312"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198127312" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198127312">(May 19 2020 at 21:11)</a>:</h4>
<p>to kind of "get started"</p>



<a name="198127374"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198127374" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198127374">(May 19 2020 at 21:12)</a>:</h4>
<p>that said</p>



<a name="198127381"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198127381" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198127381">(May 19 2020 at 21:12)</a>:</h4>
<p>I think this is not the refactoring I would do first</p>



<a name="198127391"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198127391" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198127391">(May 19 2020 at 21:12)</a>:</h4>
<p>That would be helpful</p>



<a name="198127396"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198127396" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198127396">(May 19 2020 at 21:12)</a>:</h4>
<p>Hmm</p>



<a name="198127399"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198127399" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198127399">(May 19 2020 at 21:12)</a>:</h4>
<p>the one I would do first is trying to change how <em>late-bound</em> stuff works to align better with chalk</p>



<a name="198127416"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198127416" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198127416">(May 19 2020 at 21:12)</a>:</h4>
<p>because it serves a few purposes</p>



<a name="198127462"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198127462" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198127462">(May 19 2020 at 21:12)</a>:</h4>
<p>the current <code>Binders</code> for rustc doesn't have any idea of what things it binds</p>



<a name="198127469"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198127469" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198127469">(May 19 2020 at 21:13)</a>:</h4>
<p>and it also doesn't know their kinds</p>



<a name="198127487"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198127487" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198127487">(May 19 2020 at 21:13)</a>:</h4>
<p>(i.e., are they constants? regions?)</p>



<a name="198127499"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198127499" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198127499">(May 19 2020 at 21:13)</a>:</h4>
<p>right</p>



<a name="198127516"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198127516" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198127516">(May 19 2020 at 21:13)</a>:</h4>
<p>I think we need to bridge that gap</p>



<a name="198127524"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198127524" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198127524">(May 19 2020 at 21:13)</a>:</h4>
<p>hmm, okay</p>



<a name="198127529"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198127529" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198127529">(May 19 2020 at 21:13)</a>:</h4>
<p>I <em>think</em> we probably want to make rustc have a list of things with each binder?</p>



<a name="198127536"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198127536" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198127536">(May 19 2020 at 21:13)</a>:</h4>
<p>(the other option would be to move chalk to match rustc of course)</p>



<a name="198127614"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198127614" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198127614">(May 19 2020 at 21:14)</a>:</h4>
<p>I actually don't 100% know which one I think is better</p>



<a name="198127673"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198127673" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198127673">(May 19 2020 at 21:14)</a>:</h4>
<p>the reason I thought this served multiple purposes</p>



<a name="198127801"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198127801" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198127801">(May 19 2020 at 21:15)</a>:</h4>
<p>is that if we want to support GATs, we do need to be able to express <code>forall&lt;T&gt; { .. }</code> in rustc</p>



<a name="198127814"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198127814" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198127814">(May 19 2020 at 21:15)</a>:</h4>
<p>er, <code>for&lt;T&gt; T: Trait</code>, things like that</p>



<a name="198127816"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198127816" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198127816">(May 19 2020 at 21:15)</a>:</h4>
<p>and that means that we need late-bound types</p>



<a name="198127818"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198127818" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198127818">(May 19 2020 at 21:16)</a>:</h4>
<p>The other thing that might be potentially useful to refactor is to make <em>all</em> late-bound regions have an index</p>



<a name="198127865"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198127865" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198127865">(May 19 2020 at 21:16)</a>:</h4>
<p>yes that is part of this</p>



<a name="198127880"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198127880" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198127880">(May 19 2020 at 21:16)</a>:</h4>
<p>i.e., if we had a single vector of kinds, then I think the variables need to have their index into that vector</p>



<a name="198127898"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198127898" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198127898">(May 19 2020 at 21:16)</a>:</h4>
<p>but I guess I <em>am</em> partly wondering if it's just "more data structure to keep in sync"</p>



<a name="198127922"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198127922" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198127922">(May 19 2020 at 21:16)</a>:</h4>
<p>the negative of the rustc approach of course is that you must walk the full data structure to get a list of what is bound within it</p>



<a name="198127932"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198127932" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198127932">(May 19 2020 at 21:17)</a>:</h4>
<p>and for things like canonicalization it doesn't work as well</p>



<a name="198127958"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198127958" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198127958">(May 19 2020 at 21:17)</a>:</h4>
<p>since the ordering is pretty important there</p>



<a name="198127973"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198127973" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198127973">(May 19 2020 at 21:17)</a>:</h4>
<p>which is why rustc has a separate <code>ReCanonical</code> or whatever I think</p>



<a name="198128003"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198128003" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198128003">(May 19 2020 at 21:17)</a>:</h4>
<p>(i.e., you need the vector there)</p>



<a name="198128020"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198128020" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198128020">(May 19 2020 at 21:17)</a>:</h4>
<p>Hmm</p>



<a name="198128026"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198128026" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198128026">(May 19 2020 at 21:17)</a>:</h4>
<p>I guess that giving everything an index might be something we could do somewhat independently</p>



<a name="198128103"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198128103" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198128103">(May 19 2020 at 21:18)</a>:</h4>
<p>one other annoying thing is going to be the <code>Debug</code> impls</p>



<a name="198128188"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198128188" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198128188">(May 19 2020 at 21:19)</a>:</h4>
<p>How so?</p>



<a name="198128992"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198128992" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198128992">(May 19 2020 at 21:26)</a>:</h4>
<p>well</p>



<a name="198129001"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198129001" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198129001">(May 19 2020 at 21:26)</a>:</h4>
<p>whenever you have indices, you have to make a choice</p>



<a name="198129008"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198129008" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198129008">(May 19 2020 at 21:26)</a>:</h4>
<p>do you store the name <em>and</em> the index?</p>



<a name="198129012"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198129012" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198129012">(May 19 2020 at 21:26)</a>:</h4>
<p>or just the index?</p>



<a name="198129032"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198129032" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198129032">(May 19 2020 at 21:26)</a>:</h4>
<p>if you store the name, you can use it in the debug impl</p>



<a name="198129063"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198129063" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198129063">(May 19 2020 at 21:27)</a>:</h4>
<p>if you don't, you have to dump the index</p>



<a name="198129073"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198129073" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198129073">(May 19 2020 at 21:27)</a>:</h4>
<p>I should not say debug impl</p>



<a name="198129110"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198129110" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198129110">(May 19 2020 at 21:27)</a>:</h4>
<p>the problem I'm thinking of in rustc is actually more centered on the <code>Display</code> impl</p>



<a name="198129116"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198129116" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198129116">(May 19 2020 at 21:27)</a>:</h4>
<p>i.e., when we print types for error messages</p>



<a name="198129154"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198129154" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198129154">(May 19 2020 at 21:27)</a>:</h4>
<p>we do have some special treatment for bound regions but I'm concerned that we'll have to do some work to thread sufficient context down</p>



<a name="198129169"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198129169" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198129169">(May 19 2020 at 21:27)</a>:</h4>
<p>esp. if we want to retain the user's names</p>



<a name="198129185"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198129185" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198129185">(May 19 2020 at 21:27)</a>:</h4>
<p>unless we embed them as "extra data"</p>



<a name="198129187"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198129187" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198129187">(May 19 2020 at 21:28)</a>:</h4>
<p>which I guess we can do but I hate it :P</p>



<a name="198129234"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198129234" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198129234">(May 19 2020 at 21:28)</a>:</h4>
<p>it is what we do for <code>ty::Param</code>I think tho</p>



<a name="198129265"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198129265" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198129265">(May 19 2020 at 21:28)</a>:</h4>
<p>I just don't like it because <em>then</em> you lose the "canonical" property of debruijn indices</p>



<a name="198129274"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198129274" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198129274">(May 19 2020 at 21:28)</a>:</h4>
<p>and you have to have ideas like "anonymizing" them</p>



<a name="198129294"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198129294" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198129294">(May 19 2020 at 21:28)</a>:</h4>
<p>Isn't rustc using global storage for some types atm?</p>



<a name="198129301"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198129301" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198129301">(May 19 2020 at 21:28)</a>:</h4>
<p>yes, all its types</p>



<a name="198129336"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198129336" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198129336">(May 19 2020 at 21:29)</a>:</h4>
<p>I mean for the debug impls</p>



<a name="198129731"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198129731" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198129731">(May 19 2020 at 21:32)</a>:</h4>
<p>I don't really remember</p>



<a name="198129888"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198129888" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198129888">(May 19 2020 at 21:34)</a>:</h4>
<p>A lot of debug impls use <a href="https://github.com/rust-lang/rust/blob/672b272077561ca7b5027a8aff9ea2957c7d4c21/src/librustc_middle/ty/context.rs#L1708-L1712">https://github.com/rust-lang/rust/blob/672b272077561ca7b5027a8aff9ea2957c7d4c21/src/librustc_middle/ty/context.rs#L1708-L1712</a></p>



<a name="198129975"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198129975" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198129975">(May 19 2020 at 21:35)</a>:</h4>
<p>See <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/ty/tls/fn.with.html">https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/ty/tls/fn.with.html</a></p>



<a name="198131722"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198131722" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198131722">(May 19 2020 at 21:52)</a>:</h4>
<p>I <em>think</em> that is just giving access to the tcx</p>



<a name="198131738"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198131738" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198131738">(May 19 2020 at 21:52)</a>:</h4>
<p>Which is a start but not enough</p>



<a name="198131814"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198131814" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198131814">(May 19 2020 at 21:53)</a>:</h4>
<p>e.g., if we have <code>for&lt;'a&gt; { .. }</code>, and we represent a reference to <code>'a</code> with <code>^0</code>, and we try to print a type that involves <code>^0</code>, we'd have to know what name to use</p>



<a name="198131822"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198131822" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198131822">(May 19 2020 at 21:53)</a>:</h4>
<p>usually though we don't manipulate bound types directly</p>



<a name="198131844"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198131844" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198131844">(May 19 2020 at 21:53)</a>:</h4>
<p>so I don't know how much of a problem it is</p>



<a name="198132155"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198132155" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198132155">(May 19 2020 at 21:56)</a>:</h4>
<p>Aaah, then I understood this slightly wrong. One could always make the constructor of regions private and automatically update the tcx correctly I guess <span aria-label="shrug" class="emoji emoji-1f937" role="img" title="shrug">:shrug:</span> <span aria-label="shrug" class="emoji emoji-1f937" role="img" title="shrug">:shrug:</span></p>



<a name="198132195"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198132195" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198132195">(May 19 2020 at 21:57)</a>:</h4>
<p>That's seems quite horrible though</p>



<a name="198132390"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198132390" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198132390">(May 19 2020 at 21:59)</a>:</h4>
<p>the more I think about it</p>



<a name="198132393"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198132393" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198132393">(May 19 2020 at 21:59)</a>:</h4>
<p>the less of a problem I think it is</p>



<a name="198132406"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198132406" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198132406">(May 19 2020 at 21:59)</a>:</h4>
<p>but it would be relevant for placeholders</p>



<a name="198132420"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198132420" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198132420">(May 19 2020 at 21:59)</a>:</h4>
<p>tbh I think it'd be useful in genreal</p>



<a name="198132425"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198132425" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198132425">(May 19 2020 at 21:59)</a>:</h4>
<p>if for our debug routines</p>



<a name="198132430"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198132430" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198132430">(May 19 2020 at 21:59)</a>:</h4>
<p>we had some way to push more state</p>



<a name="198132436"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198132436" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198132436">(May 19 2020 at 22:00)</a>:</h4>
<p>e.g., "we are type-checking this def-id"</p>



<a name="198132487"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198132487" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198132487">(May 19 2020 at 22:00)</a>:</h4>
<p>but i'm not 100% sure why I think that anymore</p>



<a name="198132503"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198132503" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198132503">(May 19 2020 at 22:00)</a>:</h4>
<p>I want the Lark design :P except that was maybe more annoying in practice than I thought it would be</p>



<a name="198132526"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/198132526" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#198132526">(May 19 2020 at 22:00)</a>:</h4>
<p>(in particular we used a <code>DebugWith</code> trait to let you thread context down very easily)</p>



<a name="199573198"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/199573198" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#199573198">(Jun 03 2020 at 02:03)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> PR for Chalk upgrade: <a href="https://github.com/rust-lang/rust/pull/72936">https://github.com/rust-lang/rust/pull/72936</a></p>



<a name="199634453"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/199634453" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#199634453">(Jun 03 2020 at 15:28)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> you around? So <code>InternedAdtDef</code> requires it to be <code>Copy</code> but <code>AdtDef</code> is not</p>



<a name="199648057"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/199648057" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#199648057">(Jun 03 2020 at 17:11)</a>:</h4>
<p>interesting</p>



<a name="199648158"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/199648158" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#199648158">(Jun 03 2020 at 17:12)</a>:</h4>
<p>yeah ok I didn't realize that the <code>AdtDef</code>  was "owned" by the type</p>



<a name="199648199"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/199648199" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#199648199">(Jun 03 2020 at 17:12)</a>:</h4>
<p>leave it as is for now I guess</p>



<a name="199648555"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/199648555" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#199648555">(Jun 03 2020 at 17:15)</a>:</h4>
<p>Okay</p>



<a name="199648563"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/199648563" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#199648563">(Jun 03 2020 at 17:15)</a>:</h4>
<p>Would <code>&amp;'tcx AdtDef</code> work?</p>



<a name="199648590"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/199648590" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#199648590">(Jun 03 2020 at 17:16)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span>  I addressed your other changes</p>



<a name="199648649"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/199648649" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#199648649">(Jun 03 2020 at 17:16)</a>:</h4>
<p><span class="user-mention" data-user-id="216206">@lcnr</span> is there an interned AdtDef?</p>



<a name="199648682"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/199648682" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#199648682">(Jun 03 2020 at 17:16)</a>:</h4>
<p>All <code>AdtDef</code>  are interned afaik</p>



<a name="199648717"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/199648717" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#199648717">(Jun 03 2020 at 17:16)</a>:</h4>
<p>yeah so</p>



<a name="199648723"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/199648723" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#199648723">(Jun 03 2020 at 17:16)</a>:</h4>
<p>I considered that</p>



<a name="199648743"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/199648743" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#199648743">(Jun 03 2020 at 17:16)</a>:</h4>
<p>you could do it for now</p>



<a name="199648759"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/199648759" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#199648759">(Jun 03 2020 at 17:16)</a>:</h4>
<p>eventually though we'd either have to change rustc to match</p>



<a name="199648769"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/199648769" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#199648769">(Jun 03 2020 at 17:17)</a>:</h4>
<p>or else adapt a <code>DefId</code></p>



<a name="199648786"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/199648786" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#199648786">(Jun 03 2020 at 17:17)</a>:</h4>
<p>the <code>AdtDEf</code> are interned as part of the type today, it seems</p>



<a name="199648806"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/199648806" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#199648806">(Jun 03 2020 at 17:17)</a>:</h4>
<p>wait maybe I'm confused</p>



<a name="199648811"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/199648811" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#199648811">(Jun 03 2020 at 17:17)</a>:</h4>
<p>/me double checks</p>



<a name="199648834"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/199648834" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#199648834">(Jun 03 2020 at 17:17)</a>:</h4>
<p>oh I misunderstood you <span class="user-mention" data-user-id="232957">@Jack Huey</span></p>



<a name="199648917"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/199648917" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#199648917">(Jun 03 2020 at 17:18)</a>:</h4>
<p>the rustc variant <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/ty/enum.TyKind.html#variant.Adt">Adt</a> already stores a <code>&amp;'tcx AdtDef</code></p>



<a name="199648924"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/199648924" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#199648924">(Jun 03 2020 at 17:18)</a>:</h4>
<p>so yeah that's what I would do</p>



<a name="199648965"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/199648965" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#199648965">(Jun 03 2020 at 17:18)</a>:</h4>
<p>Yeah, I didn't realize that</p>



<a name="199648995"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/199648995" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#199648995">(Jun 03 2020 at 17:18)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="k">impl</span><span class="w"> </span><span class="nb">PartialEq</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">AdtDef</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// `AdtDef`s are always interned, and this is part of `TyS` equality.</span>
<span class="w">    </span><span class="cp">#[inline]</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">eq</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">other</span>: <span class="kp">&amp;</span><span class="nc">Self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">ptr</span>::<span class="n">eq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">other</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="199649085"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/199649085" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#199649085">(Jun 03 2020 at 17:19)</a>:</h4>
<p>Let me change that real quick</p>



<a name="199650881"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/199650881" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#199650881">(Jun 03 2020 at 17:34)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> okay updated :)</p>



<a name="199678090"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/199678090" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#199678090">(Jun 03 2020 at 21:19)</a>:</h4>
<p>So, am I correct that it's only <em>unnamed</em> late bound lifetimes that would be showing up in <code>FnSig</code>, but not the generics?</p>



<a name="199678730"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/199678730" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#199678730">(Jun 03 2020 at 21:24)</a>:</h4>
<p>hmm okay no</p>



<a name="199680306"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/199680306" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#199680306">(Jun 03 2020 at 21:38)</a>:</h4>
<p>no, the rules are that lifetimes are late bound if they </p>
<ul>
<li>appear in the fn arguments, and</li>
<li>do not appear in where clauses or bounds</li>
</ul>
<p>something like that.</p>



<a name="199680796"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/199680796" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#199680796">(Jun 03 2020 at 21:43)</a>:</h4>
<p>So, is it possible to just concatenate the binders and late-bound lifetimes?</p>



<a name="199681037"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/199681037" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#199681037">(Jun 03 2020 at 21:45)</a>:</h4>
<p>Or I guess, it might be better to ask: is that <em>right</em></p>



<a name="199683460"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/199683460" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#199683460">(Jun 03 2020 at 22:10)</a>:</h4>
<p>hmm no</p>



<a name="199683531"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/199683531" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#199683531">(Jun 03 2020 at 22:11)</a>:</h4>
<p>Because when rustc asks if a fn is WF, it doesn't give the late-bound region as a parameter</p>



<a name="199683614"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/199683614" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#199683614">(Jun 03 2020 at 22:12)</a>:</h4>
<p>e.g. <code>WellFormed(FnDefId(DefId(0:19 ~ inherent_impl[317d]::{{impl}}[3]::dummy_bar[0]))&lt;Ty(Int(I32)), Ty(Uint(U32))&gt;)</code></p>



<a name="199683809"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/199683809" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#199683809">(Jun 03 2020 at 22:14)</a>:</h4>
<p>So, does Chalk even care about the late bound lifetimes?</p>



<a name="199684265"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/199684265" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#199684265">(Jun 03 2020 at 22:19)</a>:</h4>
<p>I mean, of course it has to, since the inputs and outputs can name it</p>



<a name="199687042"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/199687042" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#199687042">(Jun 03 2020 at 22:52)</a>:</h4>
<p>I think that the inputs/outputs in the <a href="http://rust-lang.github.io/chalk/chalk_solve/rust_ir/struct.FnDefDatumBound.html"><code>FnDefDatumBound</code></a> should be under a binder</p>



<a name="199687049"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/199687049" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#199687049">(Jun 03 2020 at 22:52)</a>:</h4>
<p>and it is rustc's job to put the late-bound stuff in that binder</p>



<a name="199687057"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/199687057" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#199687057">(Jun 03 2020 at 22:52)</a>:</h4>
<p>for our <em>input</em> format I might separate it out for convenience</p>



<a name="199687060"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/199687060" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#199687060">(Jun 03 2020 at 22:52)</a>:</h4>
<p>i.e., for our unit tests</p>



<a name="199687082"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/199687082" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#199687082">(Jun 03 2020 at 22:53)</a>:</h4>
<p>or we could reproduce the logic frm rustc that classifies each region parameter as either early or late</p>



<a name="199687100"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/199687100" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#199687100">(Jun 03 2020 at 22:53)</a>:</h4>
<p>we've discused how we might eliminate the distinction but I think it's out of scope for this group/effort :)</p>



<a name="199687912"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/199687912" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#199687912">(Jun 03 2020 at 23:03)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/199687042">said</a>:</p>
<blockquote>
<p>I think that the inputs/outputs in the <a href="http://rust-lang.github.io/chalk/chalk_solve/rust_ir/struct.FnDefDatumBound.html"><code>FnDefDatumBound</code></a> should be under a binder</p>
</blockquote>
<p>I did this locally and everything works as expected</p>



<a name="199786409"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/199786409" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#199786409">(Jun 04 2020 at 18:05)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232957">Jack Huey</span> <a href="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/199680796">said</a>:</p>
<blockquote>
<p>So, is it possible to just concatenate the binders and late-bound lifetimes?</p>
</blockquote>
<p>So, thought a bit more about this. When I tried this, it didn't work because rustc doesn't provide the late-bound regions in the substs. But I think if we did want to do this, it would be possible to add a dummy lifetime(s) when we lower <code>FnDef</code> substs</p>



<a name="199786543"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/199786543" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#199786543">(Jun 04 2020 at 18:07)</a>:</h4>
<p>I <em>almost</em> think that's the better way to go. Since it keeps a more clear divide between "Chalk logic" and "rustc logic", specifically in regards to late-bound regions</p>



<a name="199786611"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/199786611" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#199786611">(Jun 04 2020 at 18:07)</a>:</h4>
<p>But on the other hand, it's a little more simpler (in the short run) to just add the <code>Binders</code> around the inputs and output</p>



<a name="199786634"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/199786634" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#199786634">(Jun 04 2020 at 18:08)</a>:</h4>
<p>Even though Chalk doesn't use it <em>at all</em></p>



<a name="199812394"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/199812394" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#199812394">(Jun 04 2020 at 21:44)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> around?</p>



<a name="199812409"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/199812409" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#199812409">(Jun 04 2020 at 21:44)</a>:</h4>
<p>Anything else you want from <a href="https://github.com/rust-lang/rust/pull/72936">https://github.com/rust-lang/rust/pull/72936</a></p>



<a name="199814456"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/199814456" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#199814456">(Jun 04 2020 at 22:05)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232957">Jack Huey</span> <a href="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/199786634">said</a>:</p>
<blockquote>
<p>Even though Chalk doesn't use it <em>at all</em></p>
</blockquote>
<p>it will</p>



<a name="199814461"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/199814461" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#199814461">(Jun 04 2020 at 22:05)</a>:</h4>
<p>when it implements the <code>Fn</code> traits</p>



<a name="199814521"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/199814521" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#199814521">(Jun 04 2020 at 22:06)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232957">Jack Huey</span> <a href="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/199812409">said</a>:</p>
<blockquote>
<p>Anything else you want from <a href="https://github.com/rust-lang/rust/pull/72936">https://github.com/rust-lang/rust/pull/72936</a></p>
</blockquote>
<p>r+'d</p>



<a name="199814729"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/199814729" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#199814729">(Jun 04 2020 at 22:08)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/199814461">said</a>:</p>
<blockquote>
<p>when it implements the <code>Fn</code> traits</p>
</blockquote>
<p>ah true</p>



<a name="199814774"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/199814774" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#199814774">(Jun 04 2020 at 22:08)</a>:</h4>
<p>I guess that is a good next step</p>



<a name="199814864"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/199814864" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#199814864">(Jun 04 2020 at 22:09)</a>:</h4>
<p>Yeah, I'm working on it in the closures branch</p>



<a name="200142297"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/200142297" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#200142297">(Jun 08 2020 at 19:04)</a>:</h4>
<p>Okay I've got basic closures implemented locally</p>



<a name="200142309"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/200142309" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#200142309">(Jun 08 2020 at 19:04)</a>:</h4>
<p>But there is a problem</p>



<a name="200142379"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/200142379" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#200142379">(Jun 08 2020 at 19:05)</a>:</h4>
<p>So, rustc is giving us this goal: <code>WellFormed(extern "rust-call" fn(&amp;[closure@/home/hueyj/temp/rust/rust/src/test/ui/chalkify/closure.rs:31:13: 33:6], (&amp;i32,)) -&gt; ^1_2)</code></p>



<a name="200142438"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/200142438" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#200142438">(Jun 08 2020 at 19:06)</a>:</h4>
<p>Which gets lowered to <code>WellFormed(for&lt;0&gt; [Ty(Not&lt;Lifetime('^1.0), Ty({closure:ClosureId(DefId(0:4 ~ closure[317d]::main[0]::{{closure}}[0]))}&lt;Ty(Int(I8)), Ty(for&lt;0&gt; [Ty(1&lt;Ty(Not&lt;Lifetime('^2.1), Ty(Int(I32))&gt;)&gt;), Ty(^2.2)]), Ty(0)&gt;)&gt;), Ty(1&lt;Ty(Not&lt;Lifetime('^1.1), Ty(Int(I32))&gt;)&gt;), Ty(^1.2)])</code></p>



<a name="200142441"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/200142441" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#200142441">(Jun 08 2020 at 19:06)</a>:</h4>
<p>Good so far</p>



<a name="200142467"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/200142467" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#200142467">(Jun 08 2020 at 19:06)</a>:</h4>
<p>(I know that's really verbose. Don't worry too much about every bit)</p>



<a name="200142511"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/200142511" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#200142511">(Jun 08 2020 at 19:06)</a>:</h4>
<p>Now, this goal is provable in rustc</p>



<a name="200142564"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/200142564" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#200142564">(Jun 08 2020 at 19:07)</a>:</h4>
<p>Now, the problem comes in when we try to solve this in chalk</p>



<a name="200142605"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/200142605" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#200142605">(Jun 08 2020 at 19:07)</a>:</h4>
<p>when we <code>instantiate</code> that goal to get program clauses, we end up with:</p>



<a name="200142659"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/200142659" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#200142659">(Jun 08 2020 at 19:08)</a>:</h4>
<p><code>WellFormed(for&lt;0&gt; [Ty(Not&lt;Lifetime('?0), Ty({closure:ClosureId(DefId(0:4 ~ closure[317d]::main[0]::{{closure}}[0]))}&lt;Ty(Int(I8)), Ty(for&lt;0&gt; [Ty(1&lt;Ty(Not&lt;Lifetime('?1), Ty(Int(I32))&gt;)&gt;), Ty(?2)]), Ty(0)&gt;)&gt;), Ty(1&lt;Ty(Not&lt;Lifetime('?1), Ty(Int(I32))&gt;)&gt;), Ty(?2)]), environment=Env([])</code></p>



<a name="200142732"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/200142732" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#200142732">(Jun 08 2020 at 19:08)</a>:</h4>
<p>Specifically, those bound vars (<code>'^1.0</code>, <code>'1.1</code>, <code>1.2</code>) gets replaced by inference variables</p>



<a name="200142754"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/200142754" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#200142754">(Jun 08 2020 at 19:09)</a>:</h4>
<p>Well, inferenance variables aren't WF</p>



<a name="200142770"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/200142770" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#200142770">(Jun 08 2020 at 19:09)</a>:</h4>
<p>so the entire goal isn't provable</p>



<a name="200142778"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/200142778" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#200142778">(Jun 08 2020 at 19:09)</a>:</h4>
<p>(we flounder)</p>



<a name="200142798"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/200142798" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#200142798">(Jun 08 2020 at 19:09)</a>:</h4>
<p>Side note though, in rustc, bound vars are WF, in chalk they flounder</p>



<a name="200293503"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/200293503" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#200293503">(Jun 09 2020 at 21:31)</a>:</h4>
<p><span class="user-mention" data-user-id="281572">@marmeladema</span> okay, so the general idea of the integration into rustc <em>so far</em> is just get things implemented</p>



<a name="200293508"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/200293508" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#200293508">(Jun 09 2020 at 21:31)</a>:</h4>
<p>so</p>



<a name="200293537"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/200293537" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#200293537">(Jun 09 2020 at 21:31)</a>:</h4>
<p>there's quite a lot of <code>unimplemented!</code> in the <code>librustc_traits</code> crate</p>



<a name="200293561"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/200293561" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#200293561">(Jun 09 2020 at 21:31)</a>:</h4>
<p>And a lot of <code>FIXME(chalk)</code></p>



<a name="200293630"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/200293630" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#200293630">(Jun 09 2020 at 21:32)</a>:</h4>
<p>looking for those would be an easy way to get started</p>



<a name="200293682"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/200293682" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#200293682">(Jun 09 2020 at 21:32)</a>:</h4>
<p>let me quickly go through and see if there's something in particular worth doing</p>



<a name="200293779"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/200293779" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#200293779">(Jun 09 2020 at 21:33)</a>:</h4>
<p>Another thing that somewhat related but not part of the chalk integration itself would be the "should we track the number of bound vars in <code>Binders</code>" question</p>



<a name="200293848"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/200293848" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#200293848">(Jun 09 2020 at 21:34)</a>:</h4>
<p>I had started a branch to try to convert rustc's <code>Binder</code> to count bound vars</p>



<a name="200293873"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/200293873" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#200293873">(Jun 09 2020 at 21:34)</a>:</h4>
<p>but <span class="user-mention" data-user-id="116009">@nikomatsakis</span> suggested it might be worth trying to refactor <em>Chalk</em> to <em>not</em> count bound vars</p>



<a name="200294057"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/200294057" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#200294057">(Jun 09 2020 at 21:36)</a>:</h4>
<p>Hum ok. You also have a pending branch that has a lot of changes in <code>librustc_traits</code>, maybe I should take a look once its merged.</p>



<a name="200294426"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/200294426" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#200294426">(Jun 09 2020 at 21:40)</a>:</h4>
<p>For avoid counting bound vars in charlk, is there an issue that describes in more detail what should be done?</p>



<a name="200295210"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/200295210" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#200295210">(Jun 09 2020 at 21:47)</a>:</h4>
<p>Yeah, that PR is still pending. So if you wanted to take a look, it would probably be best to look after merge, or just at the branch itself</p>



<a name="200295233"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/200295233" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#200295233">(Jun 09 2020 at 21:47)</a>:</h4>
<p>Hmm, I'm not sure if we ever wrote an issue for the bound var counting</p>



<a name="200295381"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/200295381" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#200295381">(Jun 09 2020 at 21:49)</a>:</h4>
<p>But, maybe I can briefly sort of explain the problem</p>



<a name="200295449"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/200295449" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#200295449">(Jun 09 2020 at 21:49)</a>:</h4>
<p>So, in Chalk, our <code>Binders</code> looks like: <a href="https://github.com/rust-lang/chalk/blob/master/chalk-ir/src/lib.rs#L1486">https://github.com/rust-lang/chalk/blob/master/chalk-ir/src/lib.rs#L1486</a></p>



<a name="200295553"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/200295553" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#200295553">(Jun 09 2020 at 21:50)</a>:</h4>
<p>In rustc, it looks like <a href="https://github.com/rust-lang/rust/blob/master/src/librustc_middle/ty/sty.rs#L842">https://github.com/rust-lang/rust/blob/master/src/librustc_middle/ty/sty.rs#L842</a></p>



<a name="200295595"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/200295595" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#200295595">(Jun 09 2020 at 21:51)</a>:</h4>
<p>Notably, in rustc, we don't store the VariableKinds</p>



<a name="200295649"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/200295649" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#200295649">(Jun 09 2020 at 21:51)</a>:</h4>
<p>It's a little bit more nuanced, because in Chalk <em>all</em> bound vars are have a integer index</p>



<a name="200295739"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/200295739" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#200295739">(Jun 09 2020 at 21:52)</a>:</h4>
<p>In rustc, only a subset do. But others are named</p>



<a name="200295810"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/200295810" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#200295810">(Jun 09 2020 at 21:53)</a>:</h4>
<p>But also, it's a bit different since rustc has the idea of "late-bound regions"</p>



<a name="200295829"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/200295829" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#200295829">(Jun 09 2020 at 21:53)</a>:</h4>
<p>But anyways</p>



<a name="200295940"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/200295940" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#200295940">(Jun 09 2020 at 21:54)</a>:</h4>
<p>Right now, any time we need to convert rustc <code>Binder&lt;T&gt;</code> to chalk's <code>Binders&lt;T&gt;</code>, we have to <a href="https://github.com/rust-lang/rust/blob/master/src/librustc_traits/chalk/lowering.rs#L484"><code>collect_bound_vars</code></a></p>



<a name="200295950"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/200295950" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#200295950">(Jun 09 2020 at 21:54)</a>:</h4>
<p>I am still there, but not really grasping everything^^</p>



<a name="200296068"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/200296068" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#200296068">(Jun 09 2020 at 21:55)</a>:</h4>
<p>Long term, the goal is for chalk and rustc to share a type library, so this difference needs to be accounted for</p>



<a name="200296269"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/200296269" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#200296269">(Jun 09 2020 at 21:57)</a>:</h4>
<p>It's also perhaps worth reading the previous discussion I had with Niko: <a href="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/198125570">https://rust-lang.zulipchat.com/#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/198125570</a></p>



<a name="200296519"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/200296519" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#200296519">(Jun 09 2020 at 21:59)</a>:</h4>
<p>This is also my WIP branch <a href="https://github.com/jackh726/rust/tree/binder-refactor">https://github.com/jackh726/rust/tree/binder-refactor</a></p>



<a name="200296638"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/200296638" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#200296638">(Jun 09 2020 at 22:00)</a>:</h4>
<p>Ok i'll take a look. If you feel like making progress don't wait for me, it willl probably take me a while to understand all of this.</p>



<a name="200297277"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/200297277" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#200297277">(Jun 09 2020 at 22:07)</a>:</h4>
<p>Yeah, no worries :)</p>



<a name="200297311"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/200297311" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#200297311">(Jun 09 2020 at 22:07)</a>:</h4>
<p>Like I said, you can also just go through and look for <code>unimplemented!()</code>s or <code>FIXME(chalk)</code>s</p>



<a name="200297398"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/200297398" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#200297398">(Jun 09 2020 at 22:08)</a>:</h4>
<p>The branch for the PR is here: <a href="https://github.com/jackh726/rust/tree/chalk-more">https://github.com/jackh726/rust/tree/chalk-more</a></p>



<a name="200297424"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/200297424" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#200297424">(Jun 09 2020 at 22:08)</a>:</h4>
<p>And feel free to ask questions</p>



<a name="201073948"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201073948" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201073948">(Jun 16 2020 at 21:05)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> question</p>



<a name="201073983"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201073983" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201073983">(Jun 16 2020 at 21:05)</a>:</h4>
<p>related to <code>Fn</code> substitutions</p>



<a name="201074045"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201074045" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201074045">(Jun 16 2020 at 21:06)</a>:</h4>
<p>So, in rustc, args are stored in a tuple</p>



<a name="201074073"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201074073" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201074073">(Jun 16 2020 at 21:06)</a>:</h4>
<p>right</p>



<a name="201074104"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201074104" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201074104">(Jun 16 2020 at 21:06)</a>:</h4>
<p>in chalk, we're storing them in the list + output</p>



<a name="201074135"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201074135" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201074135">(Jun 16 2020 at 21:06)</a>:</h4>
<p>should we move to also storing args in a tuple</p>



<a name="201074183"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201074183" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201074183">(Jun 16 2020 at 21:07)</a>:</h4>
<p>wait</p>



<a name="201074189"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201074189" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201074189">(Jun 16 2020 at 21:07)</a>:</h4>
<p>ah</p>



<a name="201074195"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201074195" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201074195">(Jun 16 2020 at 21:07)</a>:</h4>
<p>you mean like <code>Fn&lt;(A1, A2)&gt;</code></p>



<a name="201074210"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201074210" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201074210">(Jun 16 2020 at 21:07)</a>:</h4>
<p><em>that</em> tuple?</p>



<a name="201074276"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201074276" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201074276">(Jun 16 2020 at 21:08)</a>:</h4>
<p>yes</p>



<a name="201074336"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201074336" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201074336">(Jun 16 2020 at 21:08)</a>:</h4>
<p>err</p>



<a name="201074339"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201074339" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201074339">(Jun 16 2020 at 21:08)</a>:</h4>
<p>good point :)</p>



<a name="201074352"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201074352" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201074352">(Jun 16 2020 at 21:08)</a>:</h4>
<p>I guess we should</p>



<a name="201074363"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201074363" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201074363">(Jun 16 2020 at 21:08)</a>:</h4>
<p>yeah</p>



<a name="201074436"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201074436" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201074436">(Jun 16 2020 at 21:09)</a>:</h4>
<p>Okay, so a substitution for a <code>Function</code> will always have two parameters</p>



<a name="201074456"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201074456" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201074456">(Jun 16 2020 at 21:10)</a>:</h4>
<p>wait</p>



<a name="201074504"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201074504" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201074504">(Jun 16 2020 at 21:10)</a>:</h4>
<p>Err</p>



<a name="201074510"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201074510" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201074510">(Jun 16 2020 at 21:10)</a>:</h4>
<p>I'm a bit confused</p>



<a name="201074520"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201074520" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201074520">(Jun 16 2020 at 21:10)</a>:</h4>
<p>me too</p>



<a name="201074528"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201074528" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201074528">(Jun 16 2020 at 21:10)</a>:</h4>
<p>there are I guess two distinct things</p>



<a name="201074567"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201074567" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201074567">(Jun 16 2020 at 21:10)</a>:</h4>
<p>so in rustc at least the set of inputs+outputs are stored in one list,</p>



<a name="201074576"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201074576" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201074576">(Jun 16 2020 at 21:10)</a>:</h4>
<p>but I guess that when we decide what <code>Fn</code> traits it implements,</p>



<a name="201074595"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201074595" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201074595">(Jun 16 2020 at 21:10)</a>:</h4>
<p>we construct the tuple type from that list</p>



<a name="201074601"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201074601" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201074601">(Jun 16 2020 at 21:11)</a>:</h4>
<p>which isn't really the most efficient thing I suppose</p>



<a name="201074623"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201074623" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201074623">(Jun 16 2020 at 21:11)</a>:</h4>
<p>I think I just did this wrong</p>



<a name="201074640"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201074640" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201074640">(Jun 16 2020 at 21:11)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/201074576">said</a>:</p>
<blockquote>
<p>but I guess that when we decide what <code>Fn</code> traits it implements,</p>
</blockquote>
<p>I did the same thing in the Chalk impl</p>



<a name="201074721"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201074721" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201074721">(Jun 16 2020 at 21:12)</a>:</h4>
<p><a href="https://github.com/rust-lang/chalk/blob/5bf3a51402d26a73b7cff430aafd742cb3a7752a/chalk-solve/src/clauses/builtin_traits/fn_family.rs#L38-L47">https://github.com/rust-lang/chalk/blob/5bf3a51402d26a73b7cff430aafd742cb3a7752a/chalk-solve/src/clauses/builtin_traits/fn_family.rs#L38-L47</a></p>



<a name="201074852"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201074852" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201074852">(Jun 16 2020 at 21:12)</a>:</h4>
<p>I'm thinking about <code>FnDef</code></p>



<a name="201074909"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201074909" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201074909">(Jun 16 2020 at 21:13)</a>:</h4>
<p>the arguments types we get from rustc are a tuple</p>



<a name="201074924"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201074924" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201074924">(Jun 16 2020 at 21:13)</a>:</h4>
<p>in Chalk, we're storing them as a vec</p>



<a name="201075070"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201075070" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201075070">(Jun 16 2020 at 21:14)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232957">Jack Huey</span> <a href="#narrow/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc/near/201074909">said</a>:</p>
<blockquote>
<p>the arguments types we get from rustc are a tuple</p>
</blockquote>
<p>oh?</p>



<a name="201075087"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201075087" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201075087">(Jun 16 2020 at 21:14)</a>:</h4>
<p>I'm not sure what you mean exactly</p>



<a name="201075104"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201075104" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201075104">(Jun 16 2020 at 21:14)</a>:</h4>
<p>the <code>FnDef</code> has a <code>Substs</code>, which corresponds to the function's type/region parameters</p>



<a name="201075141"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201075141" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201075141">(Jun 16 2020 at 21:15)</a>:</h4>
<p>Wait, am I still confused</p>



<a name="201075147"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201075147" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201075147">(Jun 16 2020 at 21:15)</a>:</h4>
<p>but you can then get a <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/ty/struct.FnSig.html"><code>FnSig</code></a> for it</p>



<a name="201075184"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201075184" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201075184">(Jun 16 2020 at 21:15)</a>:</h4>
<p>/me had forgotten about variadic...</p>



<a name="201075258"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201075258" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201075258">(Jun 16 2020 at 21:16)</a>:</h4>
<p>okay so I think it's just closures that are weird</p>



<a name="201075290"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201075290" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201075290">(Jun 16 2020 at 21:16)</a>:</h4>
<p>closures do store their <em>upvars</em> in a tuple...</p>



<a name="201075302"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201075302" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201075302">(Jun 16 2020 at 21:16)</a>:</h4>
<p>I think that they store their <em>signature</em> if a <code>fn</code> type</p>



<a name="201075343"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201075343" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201075343">(Jun 16 2020 at 21:17)</a>:</h4>
<p>yeah</p>



<a name="201075566"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201075566" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201075566">(Jun 16 2020 at 21:19)</a>:</h4>
<p>and they store their kind in an integer type (but don't think about that too much)</p>



<a name="201075611"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201075611" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201075611">(Jun 16 2020 at 21:20)</a>:</h4>
<p>does it store the arguments for the closure signature as a tuple...</p>



<a name="201075695"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201075695" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201075695">(Jun 16 2020 at 21:20)</a>:</h4>
<div class="codehilite"><pre><span></span><code>Binder(
    ([()]; c_variadic: false)-&gt;(),
)
</code></pre></div>



<a name="201075712"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201075712" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201075712">(Jun 16 2020 at 21:21)</a>:</h4>
<p>That's an empty closure <code>|| {}</code></p>



<a name="201075837"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201075837" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201075837">(Jun 16 2020 at 21:22)</a>:</h4>
<p>or, more precisely, that's the <code>FnSig</code> part of an empty closure</p>



<a name="201075933"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201075933" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201075933">(Jun 16 2020 at 21:23)</a>:</h4>
<div class="codehilite"><pre><span></span><code>[src/librustc_traits/chalk/lowering.rs:434] substs = [
    ^1_0,
    extern &quot;rust-call&quot; fn(()),
    (),
]
[src/librustc_traits/chalk/lowering.rs:411] &amp;sig = Binder(
    ([()]; c_variadic: false)-&gt;(),
)
[src/librustc_traits/chalk/lowering.rs:414] &amp;inputs_and_outputs = [
    (),
    (),
]
</code></pre></div>



<a name="201076310"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201076310" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201076310">(Jun 16 2020 at 21:26)</a>:</h4>
<p>right okay</p>



<a name="201076324"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201076324" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201076324">(Jun 16 2020 at 21:26)</a>:</h4>
<p>so there is definitely something weird with the fnsig in closures</p>



<a name="201076351"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201076351" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201076351">(Jun 16 2020 at 21:27)</a>:</h4>
<p>Unless I am still confused, which is completely possible</p>



<a name="201076649"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201076649" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201076649">(Jun 16 2020 at 21:30)</a>:</h4>
<p>The closure signature (and ABI) is chosen to match <code>FnOnce::call_once</code> but without the self type. So it's going to have the inputs tupled.</p>



<a name="201076753"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201076753" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201076753">(Jun 16 2020 at 21:30)</a>:</h4>
<p>okay</p>



<a name="201076768"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201076768" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201076768">(Jun 16 2020 at 21:30)</a>:</h4>
<p>So the FnSig contains a list of a tuple of the parameter types and the return type on its own.</p>



<a name="201076830"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201076830" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201076830">(Jun 16 2020 at 21:31)</a>:</h4>
<p>the docs in <code>ClosureSubsts</code> should probably mention this :/</p>



<a name="201076888"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201076888" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201076888">(Jun 16 2020 at 21:32)</a>:</h4>
<p>probably</p>



<a name="201076924"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201076924" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201076924">(Jun 16 2020 at 21:32)</a>:</h4>
<blockquote>
<p>CS represents the closure signature, representing as a fn() type. For example, fn(u32, u32) -&gt; u32 would mean that the closure implements CK&lt;(u32, u32), Output = u32&gt;</p>
</blockquote>



<a name="201076938"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201076938" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201076938">(Jun 16 2020 at 21:32)</a>:</h4>
<p>That doesn't suggest these are tupled at all</p>



<a name="201077112"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201077112" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201077112">(Jun 16 2020 at 21:34)</a>:</h4>
<p>I honestly thought I was crazy</p>



<a name="201077746"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201077746" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201077746">(Jun 16 2020 at 21:40)</a>:</h4>
<p>fwiw <span class="user-mention" data-user-id="232957">@Jack Huey</span> I didn't realize this, or I'd forgotten about it :)</p>



<a name="201077854"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201077854" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201077854">(Jun 16 2020 at 21:41)</a>:</h4>
<p>I did a poor job explaining</p>



<a name="201077871"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201077871" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201077871">(Jun 16 2020 at 21:41)</a>:</h4>
<p>but mostly because I didn't even realize <em>that</em> was where the problem was</p>



<a name="201078213"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201078213" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201078213">(Jun 16 2020 at 21:44)</a>:</h4>
<p>I was so confused</p>



<a name="201078565"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201078565" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201078565">(Jun 16 2020 at 21:49)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> closure PR ready</p>



<a name="201079061"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201079061" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201079061">(Jun 16 2020 at 21:54)</a>:</h4>
<p><span class="user-mention" data-user-id="232957">@Jack Huey</span> have you been testing this against rustc, too?</p>



<a name="201079112"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201079112" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201079112">(Jun 16 2020 at 21:54)</a>:</h4>
<p>indeed</p>



<a name="201079133"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201079133" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201079133">(Jun 16 2020 at 21:54)</a>:</h4>
<div class="codehilite"><pre><span></span><code>    let t = || {};
    t();

    let mut a = 0;
    let mut b = move || {
        a = 1;
    };
    b();

    let mut c = b;

    c();
    b();

    let mut a = 0;
    let mut b = || {
        a = 1;
    };
    b();

    let mut c = b;

    c();
    b(); //~ ERROR
</code></pre></div>



<a name="201079146"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201079146" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201079146">(Jun 16 2020 at 21:54)</a>:</h4>
<p>that's the current tests I'm using</p>



<a name="201079170"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201079170" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201079170">(Jun 16 2020 at 21:54)</a>:</h4>
<div class="codehilite"><pre><span></span><code>    let b = |c| {
        c
    };

    let a = &amp;32;
    b(a);
</code></pre></div>


<p>fails right now</p>



<a name="201079197"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201079197" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201079197">(Jun 16 2020 at 21:55)</a>:</h4>
<p>(not entirely sure why, but I don't think it's related to closures directly)</p>



<a name="201081960"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201081960" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201081960">(Jun 16 2020 at 22:29)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> another question</p>



<a name="201081980"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201081980" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201081980">(Jun 16 2020 at 22:29)</a>:</h4>
<p>In rustc, Bound tys are considered WF</p>



<a name="201081996"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201081996" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201081996">(Jun 16 2020 at 22:29)</a>:</h4>
<p>in Chalk, they flounder</p>



<a name="201082041"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201082041" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201082041">(Jun 16 2020 at 22:30)</a>:</h4>
<p>what's the best solution</p>



<a name="201082279"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201082279" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201082279">(Jun 16 2020 at 22:32)</a>:</h4>
<p>can you give a more concrete example?</p>



<a name="201082456"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201082456" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201082456">(Jun 16 2020 at 22:34)</a>:</h4>
<p>Hmm</p>



<a name="201082471"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201082471" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201082471">(Jun 16 2020 at 22:34)</a>:</h4>
<p>Well, this is sort of an example</p>



<a name="201082477"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201082477" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201082477">(Jun 16 2020 at 22:34)</a>:</h4>
<p><code>WellFormed(for&lt;0&gt; [Ty(Not&lt;Lifetime('^1.0), Ty({closure:ClosureId(DefId(0:4 ~ closure[317d]::main[0]::{{closure}}[0]))}&lt;Ty(Int(I8)), Ty(for&lt;0&gt; [Ty(1&lt;Ty(Not&lt;Lifetime('^2.1), Ty(Int(I32))&gt;)&gt;), Ty(^2.2)]), Ty(0)&gt;)&gt;), Ty(1&lt;Ty(Not&lt;Lifetime('^1.1), Ty(Int(I32))&gt;)&gt;), Ty(^1.2)])</code></p>



<a name="201082491"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201082491" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201082491">(Jun 16 2020 at 22:34)</a>:</h4>
<p>That's very verbose</p>



<a name="201082519"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201082519" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201082519">(Jun 16 2020 at 22:35)</a>:</h4>
<p>But essentially, those bound vars get instantiated into inference vars, which aren't WF</p>



<a name="201082532"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201082532" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201082532">(Jun 16 2020 at 22:35)</a>:</h4>
<p>which, isn't the same</p>



<a name="201082627"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201082627" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201082627">(Jun 16 2020 at 22:36)</a>:</h4>
<p>I'm not 100% sure this is what is causing that last case to fail</p>



<a name="201562145"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201562145" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201562145">(Jun 22 2020 at 01:55)</a>:</h4>
<p>So chalk upgrade PR is merged</p>



<a name="201562186"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201562186" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201562186">(Jun 22 2020 at 01:56)</a>:</h4>
<p>Sad thing is I already have enough for probably another</p>



<a name="201576771"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201576771" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201576771">(Jun 22 2020 at 07:59)</a>:</h4>
<p>Congrats! I would not say its sad though :P</p>



<a name="201608172"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201608172" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201608172">(Jun 22 2020 at 13:54)</a>:</h4>
<p>Oh, I guess sad in that more queue time :)</p>



<a name="201780855"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201780855" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201780855">(Jun 23 2020 at 20:49)</a>:</h4>
<p><span class="user-mention" data-user-id="281572">@marmeladema</span> would you actually be interesting in the shared type library work?</p>



<a name="201780940"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201780940" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201780940">(Jun 23 2020 at 20:49)</a>:</h4>
<p>Probably yes, it still a bit fuzzy on the boundaries</p>



<a name="201781010"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201781010" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201781010">(Jun 23 2020 at 20:50)</a>:</h4>
<p>Like what should be in the type library and what should not</p>



<a name="201781087"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201781087" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201781087">(Jun 23 2020 at 20:50)</a>:</h4>
<p>So, you could imagine that like 90% of what's in <code>chalk-ir</code> would eventually be in the shared type library</p>



<a name="201781182"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201781182" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201781182">(Jun 23 2020 at 20:51)</a>:</h4>
<p>There's a couple possible "first steps" that can be taken here</p>



<a name="201781224"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201781224" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201781224">(Jun 23 2020 at 20:51)</a>:</h4>
<p>One was changing <code>ty.kind</code> to be <code>ty.kind(tcx)</code></p>



<a name="201781305"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201781305" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201781305">(Jun 23 2020 at 20:52)</a>:</h4>
<p>Another was working on the late-bound region binders</p>



<a name="201781335"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201781335" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201781335">(Jun 23 2020 at 20:52)</a>:</h4>
<p>And either having rust track bound vars, or chalk <em>not</em></p>



<a name="201781558"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201781558" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201781558">(Jun 23 2020 at 20:54)</a>:</h4>
<p>Ok, pardon me, but i am not sure i understand what is the late-bound region binders.</p>



<a name="201781637"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201781637" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201781637">(Jun 23 2020 at 20:54)</a>:</h4>
<p>let me get some documentation</p>



<a name="201781648"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201781648" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201781648">(Jun 23 2020 at 20:54)</a>:</h4>
<p>there are some <a href="https://rustc-dev-guide.rust-lang.org/early-late-bound.html?highlight=late-bound#early-and-late-bound-variables">docs in the rustc-dev-guide</a> (thanks <span class="user-mention" data-user-id="198054">@mark-i-m</span>)</p>



<a name="201781738"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201781738" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201781738">(Jun 23 2020 at 20:55)</a>:</h4>
<p>beat me</p>



<a name="201781764"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201781764" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201781764">(Jun 23 2020 at 20:55)</a>:</h4>
<p>Yeah i should probably start reading that part of the guide before going further. I've actually only read the part I needed to contribute</p>



<a name="201781892"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201781892" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201781892">(Jun 23 2020 at 20:56)</a>:</h4>
<p>no problem :)</p>



<a name="201782079"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201782079" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201782079">(Jun 23 2020 at 20:58)</a>:</h4>
<p>I also have branch with some changes for this</p>



<a name="201788685"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201788685" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201788685">(Jun 23 2020 at 21:53)</a>:</h4>
<p>So i've read <a href="https://rustc-dev-guide.rust-lang.org/early-late-bound.html">https://rustc-dev-guide.rust-lang.org/early-late-bound.html</a> but it doesn't really explain why we _need_ late bounds. Why can't everything be modeled by early bounds?</p>



<a name="201788962"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201788962" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201788962">(Jun 23 2020 at 21:56)</a>:</h4>
<p>Yeah, that's a good question</p>



<a name="201788973"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201788973" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201788973">(Jun 23 2020 at 21:56)</a>:</h4>
<p>And one I don't really have an answer for</p>



<a name="201788993"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201788993" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201788993">(Jun 23 2020 at 21:56)</a>:</h4>
<p>Indeed, this is something that we've talked about changing</p>



<a name="201789007"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201789007" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201789007">(Jun 23 2020 at 21:56)</a>:</h4>
<p>(as part of the shared type library)</p>



<a name="201789038"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201789038" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201789038">(Jun 23 2020 at 21:57)</a>:</h4>
<p>I don't even want to change anything at this point but rather understand what problems late bounds are solving.</p>



<a name="201789079"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201789079" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201789079">(Jun 23 2020 at 21:57)</a>:</h4>
<p>Problems cannot be solved with early bounds obviously</p>



<a name="201789866"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201789866" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201789866">(Jun 23 2020 at 22:04)</a>:</h4>
<p>so, I think it's a bit of the opposite</p>



<a name="201789877"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201789877" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201789877">(Jun 23 2020 at 22:05)</a>:</h4>
<p>the <em>early bounds</em> solve a problem</p>



<a name="201789899"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201789899" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201789899">(Jun 23 2020 at 22:05)</a>:</h4>
<p>at least, the theoretical problem</p>



<a name="201789904"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201789904" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201789904">(Jun 23 2020 at 22:05)</a>:</h4>
<p>of performance</p>



<a name="201811285"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/201811285" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#201811285">(Jun 24 2020 at 04:47)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> Chalk 0.14 upgrade PR: <a href="https://github.com/rust-lang/rust/issues/73681">#73681</a></p>



<a name="202691567"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/202691567" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#202691567">(Jul 02 2020 at 13:58)</a>:</h4>
<p>So with the subtype changes locally (and a couple other smaller things), <code>println!("hello")</code> actually compiles :)</p>



<a name="202704692"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/reintegrating%20chalk%20into%20rustc/near/202704692" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/reintegrating.20chalk.20into.20rustc.html#202704692">(Jul 02 2020 at 15:35)</a>:</h4>
<p>nice!</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>