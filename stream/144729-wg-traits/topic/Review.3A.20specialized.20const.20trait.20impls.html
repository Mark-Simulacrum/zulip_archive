<html>
<head><meta charset="utf-8"><title>Review: specialized const trait impls · wg-traits · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/index.html">wg-traits</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Review.3A.20specialized.20const.20trait.20impls.html">Review: specialized const trait impls</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="276559132"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Review%3A%20specialized%20const%20trait%20impls/near/276559132" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Reeves <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Review.3A.20specialized.20const.20trait.20impls.html#276559132">(Mar 25 2022 at 00:54)</a>:</h4>
<p>Hi all. It would seem that the const-eval code is already properly hooked up to the specialization graph (I discovered this by accident when trying to prove the opposite <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span>). IMO we should allow <code>min_specialization</code> to now accept specialized <code>const_trait_impls</code>. So I've posted <a href="https://github.com/rust-lang/rust/pull/95292">https://github.com/rust-lang/rust/pull/95292</a> to prove the concept.</p>
<p>I'd like some input, particularly regarding missing test cases and possible edge cases I haven't considered.</p>



<a name="276581435"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Review%3A%20specialized%20const%20trait%20impls/near/276581435" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Review.3A.20specialized.20const.20trait.20impls.html#276581435">(Mar 25 2022 at 06:40)</a>:</h4>
<p>afaik we're currently reworking the way const trait impls are implemented, i think <span class="user-mention" data-user-id="124288">@oli</span>  was talking about replacing "constness" with a new generic parameter kind. Does it make sense to continue the work on the current impl with that in mind?</p>



<a name="276581945"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Review%3A%20specialized%20const%20trait%20impls/near/276581945" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Review.3A.20specialized.20const.20trait.20impls.html#276581945">(Mar 25 2022 at 06:52)</a>:</h4>
<p>Yea I'd prefer to put all these things on hold until we have finished that refactoring. Too much danger of things slipping through</p>



<a name="276654297"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Review%3A%20specialized%20const%20trait%20impls/near/276654297" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Reeves <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Review.3A.20specialized.20const.20trait.20impls.html#276654297">(Mar 25 2022 at 17:37)</a>:</h4>
<p>Ok sounds good. What would be the best way for me to follow along with the progress of this refactor?</p>



<a name="277943218"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Review%3A%20specialized%20const%20trait%20impls/near/277943218" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Reeves <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Review.3A.20specialized.20const.20trait.20impls.html#277943218">(Apr 05 2022 at 21:05)</a>:</h4>
<p><span class="user-mention" data-user-id="124288">@oli</span> asking again: how I can follow along with the refactor of trait constness that you mentioned? Or help it along?</p>



<a name="277976969"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Review%3A%20specialized%20const%20trait%20impls/near/277976969" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Review.3A.20specialized.20const.20trait.20impls.html#277976969">(Apr 06 2022 at 05:24)</a>:</h4>
<p>Ah, the current impl is at <a href="https://github.com/fee1-dead/rust/tree/const_trait">https://github.com/fee1-dead/rust/tree/const_trait</a></p>



<a name="277977002"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Review%3A%20specialized%20const%20trait%20impls/near/277977002" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Review.3A.20specialized.20const.20trait.20impls.html#277977002">(Apr 06 2022 at 05:26)</a>:</h4>
<p>I don't know when i'll get to it, but I can merge things to that branch, so I can mentor you and you do PRs against that</p>



<a name="278134098"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Review%3A%20specialized%20const%20trait%20impls/near/278134098" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fee1-dead <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Review.3A.20specialized.20const.20trait.20impls.html#278134098">(Apr 07 2022 at 08:51)</a>:</h4>
<p>If you want I can add you access to my repo</p>



<a name="278134215"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Review%3A%20specialized%20const%20trait%20impls/near/278134215" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fee1-dead <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Review.3A.20specialized.20const.20trait.20impls.html#278134215">(Apr 07 2022 at 08:52)</a>:</h4>
<p>but right now it's been pretty boring: I added a new variant to <code>ty::GenericParamKind</code> (IIRC the name) and it has been just handling the case of the new variant</p>



<a name="278134304"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Review%3A%20specialized%20const%20trait%20impls/near/278134304" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fee1-dead <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Review.3A.20specialized.20const.20trait.20impls.html#278134304">(Apr 07 2022 at 08:53)</a>:</h4>
<p>Also added an expectation to <code>TraitRef</code> that its substs must have a ConstnessParam as its last argument. This has not yet been reflected in <code>rustc_typeck</code>'s <code>generics_of</code> impl.</p>



<a name="278134371"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Review%3A%20specialized%20const%20trait%20impls/near/278134371" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fee1-dead <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Review.3A.20specialized.20const.20trait.20impls.html#278134371">(Apr 07 2022 at 08:54)</a>:</h4>
<p><span class="user-mention" data-user-id="124288">@oli</span> would you prefer having ConstnessParam as last or first?</p>



<a name="278137427"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Review%3A%20specialized%20const%20trait%20impls/near/278137427" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Review.3A.20specialized.20const.20trait.20impls.html#278137427">(Apr 07 2022 at 09:25)</a>:</h4>
<p>Last seems good to me, as long as only const traits have it <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="278139927"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Review%3A%20specialized%20const%20trait%20impls/near/278139927" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fee1-dead <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Review.3A.20specialized.20const.20trait.20impls.html#278139927">(Apr 07 2022 at 09:52)</a>:</h4>
<p>hmm. non-const traits can just have it as <code>ConstnessParam::Not</code>, right?</p>



<a name="278140201"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Review%3A%20specialized%20const%20trait%20impls/near/278140201" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Review.3A.20specialized.20const.20trait.20impls.html#278140201">(Apr 07 2022 at 09:55)</a>:</h4>
<p>what is a non const trait? <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="278140847"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Review%3A%20specialized%20const%20trait%20impls/near/278140847" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fee1-dead <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Review.3A.20specialized.20const.20trait.20impls.html#278140847">(Apr 07 2022 at 10:01)</a>:</h4>
<p>The idea is that we'd only allow some traits to have const impls (opt-in) and we decided to implement that first with an attribute <code>#[const_trait]</code></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>