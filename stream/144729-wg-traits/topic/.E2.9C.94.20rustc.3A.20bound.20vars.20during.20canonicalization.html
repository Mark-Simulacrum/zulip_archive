<html>
<head><meta charset="utf-8"><title>✔ rustc: bound vars during canonicalization · wg-traits · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/index.html">wg-traits</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/.E2.9C.94.20rustc.3A.20bound.20vars.20during.20canonicalization.html">✔ rustc: bound vars during canonicalization</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="250039650"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%E2%9C%94%20rustc%3A%20bound%20vars%20during%20canonicalization/near/250039650" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/.E2.9C.94.20rustc.3A.20bound.20vars.20during.20canonicalization.html#250039650">(Aug 19 2021 at 19:48)</a>:</h4>
<p>What do you mean what binds the bound variables?</p>



<a name="250039710"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%E2%9C%94%20rustc%3A%20bound%20vars%20during%20canonicalization/near/250039710" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/.E2.9C.94.20rustc.3A.20bound.20vars.20during.20canonicalization.html#250039710">(Aug 19 2021 at 19:48)</a>:</h4>
<p>If you had something like <code>?0: Trait</code>, that gets canonicalized to <code>for&lt;T&gt; T: Trait</code></p>



<a name="250039737"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%E2%9C%94%20rustc%3A%20bound%20vars%20during%20canonicalization/near/250039737" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/.E2.9C.94.20rustc.3A.20bound.20vars.20during.20canonicalization.html#250039737">(Aug 19 2021 at 19:48)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232957">Jack Huey</span> <a href="#narrow/stream/144729-wg-traits/topic/.E2.9C.94.20rustc.3A.20bound.20vars.20during.20canonicalization/near/250039650">said</a>:</p>
<blockquote>
<p>What do you mean what binds the bound variables?</p>
</blockquote>
<p>why are we using the terminology <code>bound variable</code></p>



<a name="250039765"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%E2%9C%94%20rustc%3A%20bound%20vars%20during%20canonicalization/near/250039765" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/.E2.9C.94.20rustc.3A.20bound.20vars.20during.20canonicalization.html#250039765">(Aug 19 2021 at 19:49)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232957">Jack Huey</span> <a href="#narrow/stream/144729-wg-traits/topic/.E2.9C.94.20rustc.3A.20bound.20vars.20during.20canonicalization/near/250039710">said</a>:</p>
<blockquote>
<p>If you had something like <code>?0: Trait</code>, that gets canonicalized to <code>for&lt;T&gt; T: Trait</code></p>
</blockquote>
<p>and that's the answer i wanted <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="250039898"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%E2%9C%94%20rustc%3A%20bound%20vars%20during%20canonicalization/near/250039898" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/.E2.9C.94.20rustc.3A.20bound.20vars.20during.20canonicalization.html#250039898">(Aug 19 2021 at 19:50)</a>:</h4>
<p>imo, it's much clearer in Chalk than rustc as to what's happening</p>



<a name="250039934"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%E2%9C%94%20rustc%3A%20bound%20vars%20during%20canonicalization/near/250039934" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/.E2.9C.94.20rustc.3A.20bound.20vars.20during.20canonicalization.html#250039934">(Aug 19 2021 at 19:50)</a>:</h4>
<p>ah alright, so a canonical query takes some input with inference variables (or regions (*)) and computes the answer for all possible values of the inference vars, i.e. introduces a new <em>forall</em> binder</p>



<a name="250039983"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%E2%9C%94%20rustc%3A%20bound%20vars%20during%20canonicalization/near/250039983" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/.E2.9C.94.20rustc.3A.20bound.20vars.20during.20canonicalization.html#250039983">(Aug 19 2021 at 19:50)</a>:</h4>
<p>correct</p>



<a name="250040045"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%E2%9C%94%20rustc%3A%20bound%20vars%20during%20canonicalization/near/250040045" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/.E2.9C.94.20rustc.3A.20bound.20vars.20during.20canonicalization.html#250040045">(Aug 19 2021 at 19:51)</a>:</h4>
<p>(*): regions probably because they can't influence trait selection and stuff, so the query <em>just has to</em> return the same result for all possible regions</p>



<a name="250040285"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%E2%9C%94%20rustc%3A%20bound%20vars%20during%20canonicalization/near/250040285" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/.E2.9C.94.20rustc.3A.20bound.20vars.20during.20canonicalization.html#250040285">(Aug 19 2021 at 19:53)</a>:</h4>
<p>regions make things a bit more difficult</p>



<a name="250041285"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%E2%9C%94%20rustc%3A%20bound%20vars%20during%20canonicalization/near/250041285" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/.E2.9C.94.20rustc.3A.20bound.20vars.20during.20canonicalization.html#250041285">(Aug 19 2021 at 20:00)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232957">Jack Huey</span> <a href="#narrow/stream/144729-wg-traits/topic/.E2.9C.94.20rustc.3A.20bound.20vars.20during.20canonicalization/near/250040285">said</a>:</p>
<blockquote>
<p>regions make things a bit more difficult</p>
</blockquote>
<p>in which ways? (only answer if you have the time/energy to do so, while I am interested in this, I don't need to know any of this for the things I am currently doing)</p>



<a name="250041592"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%E2%9C%94%20rustc%3A%20bound%20vars%20during%20canonicalization/near/250041592" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/.E2.9C.94.20rustc.3A.20bound.20vars.20during.20canonicalization.html#250041592">(Aug 19 2021 at 20:01)</a>:</h4>
<p>so, from I can understand, region constraints don't necessarily affect selection; they're registered and later resolved by something like <code>resolve_regions_and_report_errors</code></p>



<a name="250041684"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%E2%9C%94%20rustc%3A%20bound%20vars%20during%20canonicalization/near/250041684" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/.E2.9C.94.20rustc.3A.20bound.20vars.20during.20canonicalization.html#250041684">(Aug 19 2021 at 20:02)</a>:</h4>
<p>Now, take what I say with a grain of solve, because I'm no expert here</p>



<a name="250041697"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%E2%9C%94%20rustc%3A%20bound%20vars%20during%20canonicalization/near/250041697" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/.E2.9C.94.20rustc.3A.20bound.20vars.20during.20canonicalization.html#250041697">(Aug 19 2021 at 20:02)</a>:</h4>
<p>yeah, we check region constraints after selection</p>



<a name="250041766"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%E2%9C%94%20rustc%3A%20bound%20vars%20during%20canonicalization/near/250041766" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/.E2.9C.94.20rustc.3A.20bound.20vars.20during.20canonicalization.html#250041766">(Aug 19 2021 at 20:03)</a>:</h4>
<p>so afaik we return any region constraints we encounter during selection from the canonical query</p>



<a name="250041810"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%E2%9C%94%20rustc%3A%20bound%20vars%20during%20canonicalization/near/250041810" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/.E2.9C.94.20rustc.3A.20bound.20vars.20during.20canonicalization.html#250041810">(Aug 19 2021 at 20:03)</a>:</h4>
<p>but I can imagine that when solving <code>for&lt;'a&gt; T: Trait&lt;'a&gt;</code> for example, we sort of cheat and return either <code>EvaluatedtoOk</code> or <code>EvaluatedToOkModuloRegions</code></p>



<a name="250041947"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%E2%9C%94%20rustc%3A%20bound%20vars%20during%20canonicalization/near/250041947" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/.E2.9C.94.20rustc.3A.20bound.20vars.20during.20canonicalization.html#250041947">(Aug 19 2021 at 20:04)</a>:</h4>
<p>so, region constraints aren't as "isolated" as they are in Chalk</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>