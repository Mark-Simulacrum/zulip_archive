<html>
<head><meta charset="utf-8"><title>HRTB bug · wg-traits · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/index.html">wg-traits</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/HRTB.20bug.html">HRTB bug</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="272702749"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/HRTB%20bug/near/272702749" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/HRTB.20bug.html#272702749">(Feb 21 2022 at 15:30)</a>:</h4>
<p><em>oh</em>. I missed this.</p>
<p><a href="https://github.com/rust-lang/rust/pull/94070/commits/e92dac75d24d3bfc18174692055e966b87e15ce7#diff-f85bed603ee587435284ae2ff856e8416d627ac52acb2f0c8e495e97f79ec828R1">https://github.com/rust-lang/rust/pull/94070/commits/e92dac75d24d3bfc18174692055e966b87e15ce7#diff-f85bed603ee587435284ae2ff856e8416d627ac52acb2f0c8e495e97f79ec828R1</a></p>



<a name="272702890"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/HRTB%20bug/near/272702890" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/HRTB.20bug.html#272702890">(Feb 21 2022 at 15:31)</a>:</h4>
<p>I think <a href="https://github.com/rust-lang/rust/issues/94108">#94108</a> introduced a bug that only is shown with <a href="https://github.com/rust-lang/rust/issues/94070">#94070</a> or <a href="https://github.com/rust-lang/rust/issues/90887">#90887</a></p>



<a name="272703509"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/HRTB%20bug/near/272703509" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/HRTB.20bug.html#272703509">(Feb 21 2022 at 15:36)</a>:</h4>
<p><span class="user-mention" data-user-id="426609">@Michael Goulet (compiler-errors)</span></p>



<a name="272703935"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/HRTB%20bug/near/272703935" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/HRTB.20bug.html#272703935">(Feb 21 2022 at 15:40)</a>:</h4>
<p>Likely the same root cause of the changes to this test are to blame: <a href="https://github.com/rust-lang/rust/pull/94108/files#diff-db18a58c95407cb183b3c51c0479daa69fda69c981bf14256091df588aebb77cR10">https://github.com/rust-lang/rust/pull/94108/files#diff-db18a58c95407cb183b3c51c0479daa69fda69c981bf14256091df588aebb77cR10</a></p>



<a name="272704083"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/HRTB%20bug/near/272704083" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/HRTB.20bug.html#272704083">(Feb 21 2022 at 15:41)</a>:</h4>
<p>I initially wrote that off a weird, but not necessarily wrong (there are known issues with that test)</p>



<a name="272704417"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/HRTB%20bug/near/272704417" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/HRTB.20bug.html#272704417">(Feb 21 2022 at 15:44)</a>:</h4>
<p>okay, actually, maybe not</p>



<a name="272704468"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/HRTB%20bug/near/272704468" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/HRTB.20bug.html#272704468">(Feb 21 2022 at 15:44)</a>:</h4>
<p>I reverted that merge locally and it still fails</p>



<a name="272705355"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/HRTB%20bug/near/272705355" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/HRTB.20bug.html#272705355">(Feb 21 2022 at 15:51)</a>:</h4>
<p>Okay, so the last try/perf run on <a href="https://github.com/rust-lang/rust/issues/90887">#90887</a> was based on <code>f52c31840df7ec9c9350baff51a8964b20b5e1ba</code>, and <a href="https://github.com/rust-lang/rust/issues/91139">#91139</a> was passing. Rebasing it on master now has it failing.</p>



<a name="272705367"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/HRTB%20bug/near/272705367" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/HRTB.20bug.html#272705367">(Feb 21 2022 at 15:51)</a>:</h4>
<p>So let's do a bisect</p>



<a name="272706034"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/HRTB%20bug/near/272706034" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Goulet (compiler-errors) <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/HRTB.20bug.html#272706034">(Feb 21 2022 at 15:57)</a>:</h4>
<p>yes i saw the same thing where it only started looking different after a rebase..</p>



<a name="272706073"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/HRTB%20bug/near/272706073" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Goulet (compiler-errors) <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/HRTB.20bug.html#272706073">(Feb 21 2022 at 15:57)</a>:</h4>
<p>are you doing a bisect or shall I?</p>



<a name="272707296"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/HRTB%20bug/near/272707296" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/HRTB.20bug.html#272707296">(Feb 21 2022 at 16:06)</a>:</h4>
<p>I'm doing it</p>



<a name="272707306"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/HRTB%20bug/near/272707306" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/HRTB.20bug.html#272707306">(Feb 21 2022 at 16:06)</a>:</h4>
<p>and <a href="https://github.com/rust-lang/rust/pull/94108#issuecomment-1047013676">https://github.com/rust-lang/rust/pull/94108#issuecomment-1047013676</a></p>



<a name="272707310"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/HRTB%20bug/near/272707310" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/HRTB.20bug.html#272707310">(Feb 21 2022 at 16:06)</a>:</h4>
<p>the heck</p>



<a name="272707556"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/HRTB%20bug/near/272707556" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/HRTB.20bug.html#272707556">(Feb 21 2022 at 16:08)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> I blame you for taking so long to review this PR :P</p>



<a name="272708786"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/HRTB%20bug/near/272708786" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Goulet (compiler-errors) <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/HRTB.20bug.html#272708786">(Feb 21 2022 at 16:19)</a>:</h4>
<p>the non-local perf effects between that PR and the other two it was intended to be stacked on are spooky</p>



<a name="272711458"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/HRTB%20bug/near/272711458" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/HRTB.20bug.html#272711458">(Feb 21 2022 at 16:42)</a>:</h4>
<p>Not that weird. You did have to rebase. Its possible you rebased onto something that had that perf effect</p>



<a name="272711517"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/HRTB%20bug/near/272711517" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/HRTB.20bug.html#272711517">(Feb 21 2022 at 16:43)</a>:</h4>
<p>It's pretty common for code inlining changes to effect trait code</p>



<a name="272711697"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/HRTB%20bug/near/272711697" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/HRTB.20bug.html#272711697">(Feb 21 2022 at 16:45)</a>:</h4>
<p>And by that, I mean the choices llvm makes with inlining</p>



<a name="272717426"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/HRTB%20bug/near/272717426" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/HRTB.20bug.html#272717426">(Feb 21 2022 at 17:38)</a>:</h4>
<p>git is being really annoying</p>



<a name="272718292"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/HRTB%20bug/near/272718292" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/HRTB.20bug.html#272718292">(Feb 21 2022 at 17:48)</a>:</h4>
<p>I try to check out e.g. <code>6966a42c1a56bca8df305496274682a01139099c</code> and it just deletes everything</p>



<a name="272718719"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/HRTB%20bug/near/272718719" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/HRTB.20bug.html#272718719">(Feb 21 2022 at 17:53)</a>:</h4>
<p>oh wtf <a href="https://github.com/rust-lang/rust/tree/093e32052e4f3b0a92293dac4a5524effda86934">https://github.com/rust-lang/rust/tree/093e32052e4f3b0a92293dac4a5524effda86934</a></p>



<a name="272718750"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/HRTB%20bug/near/272718750" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/HRTB.20bug.html#272718750">(Feb 21 2022 at 17:53)</a>:</h4>
<p>guess it's a clippy thing</p>



<a name="272721040"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/HRTB%20bug/near/272721040" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/HRTB.20bug.html#272721040">(Feb 21 2022 at 18:19)</a>:</h4>
<p><span aria-label="face palm" class="emoji emoji-1f926" role="img" title="face palm">:face_palm:</span> the test was <em>added</em> since I ran the try/perf last time</p>



<a name="272721160"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/HRTB%20bug/near/272721160" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/HRTB.20bug.html#272721160">(Feb 21 2022 at 18:20)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232957">Jack Huey</span> <a href="#narrow/stream/144729-wg-traits/topic/HRTB.20bug/near/272707556">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> I blame you for taking so long to review this PR :P</p>
</blockquote>
<p>I retract this statement</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>