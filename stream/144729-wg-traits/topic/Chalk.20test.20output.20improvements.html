<html>
<head><meta charset="utf-8"><title>Chalk test output improvements · wg-traits · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/index.html">wg-traits</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Chalk.20test.20output.20improvements.html">Chalk test output improvements</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="265766744"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Chalk%20test%20output%20improvements/near/265766744" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Chalk.20test.20output.20improvements.html#265766744">(Dec 22 2021 at 05:04)</a>:</h4>
<p><span class="user-mention silent" data-user-id="271719">Mario Carneiro</span> <a href="#narrow/stream/144729-wg-traits/topic/How.20to.20interpret.20outlives.20constraints.20from.20HRTB.20subtype.20goal/near/265766363">said</a>:</p>
<blockquote>
<p>It still seems unnecessarily opaque to print things like this. I would at least use a notation like <code>forall&lt;v0_0, v0_1&gt; exists&lt;v1_0&gt;{ 'v0_0: 'v1_0, 'v0_1: 'v1_0 }</code></p>
</blockquote>
<p>Open to PRs changing this</p>



<a name="265766796"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Chalk%20test%20output%20improvements/near/265766796" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Chalk.20test.20output.20improvements.html#265766796">(Dec 22 2021 at 05:05)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232957">Jack Huey</span> <a href="#narrow/stream/144729-wg-traits/topic/How.20to.20interpret.20outlives.20constraints.20from.20HRTB.20subtype.20goal/near/265766744">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="271719">Mario Carneiro</span> <a href="#narrow/stream/144729-wg-traits/topic/How.20to.20interpret.20outlives.20constraints.20from.20HRTB.20subtype.20goal/near/265766363">said</a>:</p>
<blockquote>
<p>It still seems unnecessarily opaque to print things like this. I would at least use a notation like <code>forall&lt;v0_0, v0_1&gt; exists&lt;v1_0&gt;{ 'v0_0: 'v1_0, 'v0_1: 'v1_0 }</code></p>
</blockquote>
<p>Open to PRs changing this</p>
</blockquote>
<p>I'm interested.</p>



<a name="265766846"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Chalk%20test%20output%20improvements/near/265766846" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Chalk.20test.20output.20improvements.html#265766846">(Dec 22 2021 at 05:06)</a>:</h4>
<p><span class="user-mention silent" data-user-id="118594">Dylan MacKenzie (ecstatic-morse)</span> <a href="#narrow/stream/144729-wg-traits/topic/How.20to.20interpret.20outlives.20constraints.20from.20HRTB.20subtype.20goal/near/265766796">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="232957">Jack Huey</span> <a href="#narrow/stream/144729-wg-traits/topic/How.20to.20interpret.20outlives.20constraints.20from.20HRTB.20subtype.20goal/near/265766744">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="271719">Mario Carneiro</span> <a href="#narrow/stream/144729-wg-traits/topic/How.20to.20interpret.20outlives.20constraints.20from.20HRTB.20subtype.20goal/near/265766363">said</a>:</p>
<blockquote>
<p>It still seems unnecessarily opaque to print things like this. I would at least use a notation like <code>forall&lt;v0_0, v0_1&gt; exists&lt;v1_0&gt;{ 'v0_0: 'v1_0, 'v0_1: 'v1_0 }</code></p>
</blockquote>
<p>Open to PRs changing this</p>
</blockquote>
<p>I'm interested.</p>
</blockquote>
<p>Here: <a href="https://github.com/rust-lang/chalk/blob/884cd715c6a168afd6723d4f248b919d1e0cb842/chalk-solve/src/solve.rs#L148">https://github.com/rust-lang/chalk/blob/884cd715c6a168afd6723d4f248b919d1e0cb842/chalk-solve/src/solve.rs#L148</a></p>



<a name="265766924"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Chalk%20test%20output%20improvements/near/265766924" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Chalk.20test.20output.20improvements.html#265766924">(Dec 22 2021 at 05:08)</a>:</h4>
<p>(that's at least a start)</p>



<a name="265767547"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Chalk%20test%20output%20improvements/near/265767547" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Chalk.20test.20output.20improvements.html#265767547">(Dec 22 2021 at 05:23)</a>:</h4>
<p>My other question was "why aren't they using <a href="https://insta.rs#test-workflow">insta</a>?"</p>



<a name="265767751"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Chalk%20test%20output%20improvements/near/265767751" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Chalk.20test.20output.20improvements.html#265767751">(Dec 22 2021 at 05:27)</a>:</h4>
<p>I had thought about it at one point</p>



<a name="265767761"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Chalk%20test%20output%20improvements/near/265767761" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Chalk.20test.20output.20improvements.html#265767761">(Dec 22 2021 at 05:27)</a>:</h4>
<p>I think Chalk tests predate insta</p>



<a name="265767772"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Chalk%20test%20output%20improvements/near/265767772" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Chalk.20test.20output.20improvements.html#265767772">(Dec 22 2021 at 05:27)</a>:</h4>
<p>But when I gave a cursory glance/thought, I think there was something that seemed not obvious</p>



<a name="265767790"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Chalk%20test%20output%20improvements/near/265767790" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Chalk.20test.20output.20improvements.html#265767790">(Dec 22 2021 at 05:28)</a>:</h4>
<p>But again, welcome changes if there's something better</p>



<a name="265767939"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Chalk%20test%20output%20improvements/near/265767939" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Chalk.20test.20output.20improvements.html#265767939">(Dec 22 2021 at 05:30)</a>:</h4>
<p>I'm not quite sure how I feel about needing a separate utility installed to review changes and such. And I think we definitely would still want them inline, and that needs <code>cargo insta</code></p>



<a name="265767945"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Chalk%20test%20output%20improvements/near/265767945" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Chalk.20test.20output.20improvements.html#265767945">(Dec 22 2021 at 05:30)</a>:</h4>
<p>I think the fact that you're using a test macro would make the inline blessing difficult. I doubt that it's supported, so you'd have to switch to out-of-line.</p>



<a name="265768049"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Chalk%20test%20output%20improvements/near/265768049" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Chalk.20test.20output.20improvements.html#265768049">(Dec 22 2021 at 05:33)</a>:</h4>
<p>Right, it would would be a big-ish change to how tests are run</p>



<a name="265768346"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Chalk%20test%20output%20improvements/near/265768346" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Chalk.20test.20output.20improvements.html#265768346">(Dec 22 2021 at 05:39)</a>:</h4>
<p>To be clear, you can still do everything <code>cargo insta</code> does by hand. Like, <code>cargo test</code> still works and will read the out-of-line tests.</p>



<a name="265768360"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Chalk%20test%20output%20improvements/near/265768360" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Chalk.20test.20output.20improvements.html#265768360">(Dec 22 2021 at 05:39)</a>:</h4>
<p>But if it's not that big a problem for you, it's probably not worth a big change.</p>



<a name="265768415"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Chalk%20test%20output%20improvements/near/265768415" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Chalk.20test.20output.20improvements.html#265768415">(Dec 22 2021 at 05:40)</a>:</h4>
<p>Better names for metavariables seems less invasive.</p>



<a name="265768466"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Chalk%20test%20output%20improvements/near/265768466" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Chalk.20test.20output.20improvements.html#265768466">(Dec 22 2021 at 05:41)</a>:</h4>
<p>Well, I saw "It's not necessary for working with regular snapshots but it's required when working with inline snapshots."</p>



<a name="265768585"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Chalk%20test%20output%20improvements/near/265768585" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Chalk.20test.20output.20improvements.html#265768585">(Dec 22 2021 at 05:43)</a>:</h4>
<p>I think that's specifically for blessing things. <code>cargo test</code> will output the "actual" output in the correct format out-of-line, but obviously it can't figure out where in your .rs file it should go without external tooling.</p>



<a name="265768708"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Chalk%20test%20output%20improvements/near/265768708" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Chalk.20test.20output.20improvements.html#265768708">(Dec 22 2021 at 05:46)</a>:</h4>
<p>Ah I see</p>



<a name="265768747"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Chalk%20test%20output%20improvements/near/265768747" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Chalk.20test.20output.20improvements.html#265768747">(Dec 22 2021 at 05:46)</a>:</h4>
<p>I guess I'd have to really see it implemented to know if it's really a better solution. Could be a fun task, but might not be worth peoples' times</p>



<a name="265768761"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Chalk%20test%20output%20improvements/near/265768761" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Chalk.20test.20output.20improvements.html#265768761">(Dec 22 2021 at 05:47)</a>:</h4>
<p>Anyways, if it's not a pain point. I wouldn't worry about it. I just assumed that writing large numbers of test cases is rather unpleasant, but maybe it's not so bad.</p>



<a name="265768828"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Chalk%20test%20output%20improvements/near/265768828" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Chalk.20test.20output.20improvements.html#265768828">(Dec 22 2021 at 05:49)</a>:</h4>
<p>Taking the opportunity to plug <a href="https://crates.io/crates/expect-test">https://crates.io/crates/expect-test</a> :-)</p>



<a name="265768983"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Chalk%20test%20output%20improvements/near/265768983" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Chalk.20test.20output.20improvements.html#265768983">(Dec 22 2021 at 05:52)</a>:</h4>
<p>I've never had any pain really with tests (though I'm aware I might not be the best litmus test here)</p>



<a name="265851122"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Chalk%20test%20output%20improvements/near/265851122" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Chalk.20test.20output.20improvements.html#265851122">(Dec 22 2021 at 20:49)</a>:</h4>
<p>I actually ended up doing this using <code>expect-test</code>. There's a few blockers though.</p>



<a name="265851138"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Chalk%20test%20output%20improvements/near/265851138" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Chalk.20test.20output.20improvements.html#265851138">(Dec 22 2021 at 20:49)</a>:</h4>
<p><a href="https://github.com/rust-lang/chalk/issues/744">rust-lang/chalk#744</a></p>



<a name="265921343"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Chalk%20test%20output%20improvements/near/265921343" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Chalk.20test.20output.20improvements.html#265921343">(Dec 23 2021 at 14:29)</a>:</h4>
<p>Is there anything I need to do now? Or just wait until blockers are resolved?</p>



<a name="265947824"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Chalk%20test%20output%20improvements/near/265947824" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Chalk.20test.20output.20improvements.html#265947824">(Dec 23 2021 at 19:48)</a>:</h4>
<p><span class="user-mention" data-user-id="232957">@Jack Huey</span> No, unless there's some constraints or preferences that I didn't take into account. I'll need to get some changes to <code>expect-test</code> upstream before it's reviewable. I'll ping you when that happens.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>