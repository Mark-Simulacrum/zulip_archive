<html>
<head><meta charset="utf-8"><title>`FnCtxt` outside of bodies · wg-traits · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/index.html">wg-traits</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/.60FnCtxt.60.20outside.20of.20bodies.html">`FnCtxt` outside of bodies</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="277290194"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%60FnCtxt%60%20outside%20of%20bodies/near/277290194" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/.60FnCtxt.60.20outside.20of.20bodies.html#277290194">(Mar 31 2022 at 14:30)</a>:</h4>
<p>In my understanding <code>FnCtxt</code> is mostly intended to be used during hir typeck for anything with a body, so functions and constants.</p>



<a name="277290235"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%60FnCtxt%60%20outside%20of%20bodies/near/277290235" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/.60FnCtxt.60.20outside.20of.20bodies.html#277290235">(Mar 31 2022 at 14:30)</a>:</h4>
<p>But it is also used pretty much anywhere we want to check regions</p>



<a name="277290272"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%60FnCtxt%60%20outside%20of%20bodies/near/277290272" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/.60FnCtxt.60.20outside.20of.20bodies.html#277290272">(Mar 31 2022 at 14:31)</a>:</h4>
<p>There's a FIXME somewhere for that</p>



<a name="277290331"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%60FnCtxt%60%20outside%20of%20bodies/near/277290331" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/.60FnCtxt.60.20outside.20of.20bodies.html#277290331">(Mar 31 2022 at 14:31)</a>:</h4>
<p>that's cool <span aria-label="rofl" class="emoji emoji-1f923" role="img" title="rofl">:rofl:</span></p>



<a name="277290420"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%60FnCtxt%60%20outside%20of%20bodies/near/277290420" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/.60FnCtxt.60.20outside.20of.20bodies.html#277290420">(Mar 31 2022 at 14:32)</a>:</h4>
<p>idk why that's actually rly funny to me <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="277290450"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%60FnCtxt%60%20outside%20of%20bodies/near/277290450" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/.60FnCtxt.60.20outside.20of.20bodies.html#277290450">(Mar 31 2022 at 14:32)</a>:</h4>
<p>I guess the goal would be to only require an <code>InferCtxt</code> to check region obligations</p>



<a name="277290502"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%60FnCtxt%60%20outside%20of%20bodies/near/277290502" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/.60FnCtxt.60.20outside.20of.20bodies.html#277290502">(Mar 31 2022 at 14:32)</a>:</h4>
<p>also, why is <code>in_progress_typeck_results</code> a field of <code>InferCtxt</code> instead of <code>FnCtxt</code>?</p>



<a name="277290729"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%60FnCtxt%60%20outside%20of%20bodies/near/277290729" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/.60FnCtxt.60.20outside.20of.20bodies.html#277290729">(Mar 31 2022 at 14:34)</a>:</h4>
<p><em>shrug</em> this is an area I haven't done a ton of work on</p>



<a name="277290730"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%60FnCtxt%60%20outside%20of%20bodies/near/277290730" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/.60FnCtxt.60.20outside.20of.20bodies.html#277290730">(Mar 31 2022 at 14:34)</a>:</h4>
<p><span class="user-mention silent" data-user-id="216206">lcnr</span> <a href="#narrow/stream/144729-wg-traits/topic/.60FnCtxt.60.20outside.20of.20bodies/near/277290502">said</a>:</p>
<blockquote>
<p>also, why is <code>in_progress_typeck_results</code> a field of <code>InferCtxt</code> instead of <code>FnCtxt</code>?</p>
</blockquote>
<p>that's something I can just try to change myself <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="277290941"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%60FnCtxt%60%20outside%20of%20bodies/near/277290941" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/.60FnCtxt.60.20outside.20of.20bodies.html#277290941">(Mar 31 2022 at 14:35)</a>:</h4>
<p>I guess, cc <span class="user-mention" data-user-id="124288">@oli</span> can I also try to move <code>with_opaque_type_inference</code> into the <code>FnCtxt</code> from the inference context?</p>



<a name="277291624"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%60FnCtxt%60%20outside%20of%20bodies/near/277291624" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/.60FnCtxt.60.20outside.20of.20bodies.html#277291624">(Mar 31 2022 at 14:40)</a>:</h4>
<p>that is what sets <code>defining_use_anchor</code>, and that one can't be moved unless we re-adopt an opaque type obligation and bubble the anchor in via the <code>select_all_or*</code> methods</p>



<a name="277291663"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%60FnCtxt%60%20outside%20of%20bodies/near/277291663" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/.60FnCtxt.60.20outside.20of.20bodies.html#277291663">(Mar 31 2022 at 14:40)</a>:</h4>
<p>at some point we need to decide whether to bind the opaque type or whether to handle it opaquely</p>



<a name="277291725"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%60FnCtxt%60%20outside%20of%20bodies/near/277291725" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/.60FnCtxt.60.20outside.20of.20bodies.html#277291725">(Mar 31 2022 at 14:41)</a>:</h4>
<p>ah, my hope was to move <code>defining_use_anchor</code> out of <code>InferCtxt</code></p>



<a name="277291747"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%60FnCtxt%60%20outside%20of%20bodies/near/277291747" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/.60FnCtxt.60.20outside.20of.20bodies.html#277291747">(Mar 31 2022 at 14:41)</a>:</h4>
<p>as it should only be used when part inside of a <code>FnCtxt</code></p>



<a name="277291792"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%60FnCtxt%60%20outside%20of%20bodies/near/277291792" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/.60FnCtxt.60.20outside.20of.20bodies.html#277291792">(Mar 31 2022 at 14:41)</a>:</h4>
<p>but that might not actually work because trait selection and stuff also relies on that i think?</p>



<a name="277291808"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%60FnCtxt%60%20outside%20of%20bodies/near/277291808" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/.60FnCtxt.60.20outside.20of.20bodies.html#277291808">(Mar 31 2022 at 14:41)</a>:</h4>
<p>and we don't want to use <code>FnCtxt</code> for that</p>



<a name="277292273"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%60FnCtxt%60%20outside%20of%20bodies/near/277292273" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/.60FnCtxt.60.20outside.20of.20bodies.html#277292273">(Mar 31 2022 at 14:45)</a>:</h4>
<p><span class="user-mention silent" data-user-id="216206">lcnr</span> <a href="#narrow/stream/144729-wg-traits/topic/.60FnCtxt.60.20outside.20of.20bodies/near/277291792">said</a>:</p>
<blockquote>
<p>but that might not actually work because trait selection and stuff also relies on that i think?</p>
</blockquote>
<p>yea, basically that. I mean... we could just do the same thing we do for queries and assume we are allowed to constrain the hidden type and then have the FnCtxt process them at the end, not sure if possible, but worth exploring I guess?</p>



<a name="277292314"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%60FnCtxt%60%20outside%20of%20bodies/near/277292314" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/.60FnCtxt.60.20outside.20of.20bodies.html#277292314">(Mar 31 2022 at 14:45)</a>:</h4>
<p>would be interested in trying that</p>



<a name="277292392"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%60FnCtxt%60%20outside%20of%20bodies/near/277292392" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/.60FnCtxt.60.20outside.20of.20bodies.html#277292392">(Mar 31 2022 at 14:45)</a>:</h4>
<p>though starting with <code>in_progress_typeck_results</code> feels more impactful for me</p>



<a name="277293468"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%60FnCtxt%60%20outside%20of%20bodies/near/277293468" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/.60FnCtxt.60.20outside.20of.20bodies.html#277293468">(Mar 31 2022 at 14:53)</a>:</h4>
<p>agreed</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>