<html>
<head><meta charset="utf-8"><title>GATs things · wg-traits · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/index.html">wg-traits</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20things.html">GATs things</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="248872043"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20things/near/248872043" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20things.html#248872043">(Aug 09 2021 at 16:27)</a>:</h4>
<p>Okay, can someone help me figure out why <a href="https://github.com/rust-lang/rust/blob/master/src/test/ui/generic-associated-types/issue-74684-1.rs">https://github.com/rust-lang/rust/blob/master/src/test/ui/generic-associated-types/issue-74684-1.rs</a> should error (it does), or if this is a bug</p>



<a name="248872126"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20things/near/248872126" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20things.html#248872126">(Aug 09 2021 at 16:28)</a>:</h4>
<p>wait nvm</p>



<a name="248872294"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20things/near/248872294" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20things.html#248872294">(Aug 09 2021 at 16:29)</a>:</h4>
<p>I missed the "lifetime <code>'a</code> defined here"</p>



<a name="248872369"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20things/near/248872369" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20things.html#248872369">(Aug 09 2021 at 16:30)</a>:</h4>
<p>and of course, it wasn't until <em>right after</em> I post that I see it</p>



<a name="248884906"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20things/near/248884906" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20things.html#248884906">(Aug 09 2021 at 18:04)</a>:</h4>
<p>So, I'm like 70% sure that <a href="https://github.com/rust-lang/rust/issues/87429">#87429</a> is an issue that is highlighting something "incomplete" about our handling of GATs</p>



<a name="248884973"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20things/near/248884973" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20things.html#248884973">(Aug 09 2021 at 18:05)</a>:</h4>
<p>So, at some point we need to prove</p>
<div class="codehilite"><pre><span></span><code>TraitPredicate(&lt;&lt;I32 as Family&gt;::Member&lt;ReEarlyBound(0, &#39;a)&gt; as std::cmp::PartialEq&lt;&lt;I32 as Family&gt;::Member&lt;ReLateBound(DebruijnIndex(0), BoundRegion { var: 0, kind: BrNamed(DefId(0:6 ~ issue_87429[d218]::Family::Member::&#39;b), &#39;b) })&gt;&gt;&gt;)
</code></pre></div>



<a name="248885061"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20things/near/248885061" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20things.html#248885061">(Aug 09 2021 at 18:06)</a>:</h4>
<p>So, we first try to normalize that</p>



<a name="248885099"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20things/near/248885099" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20things.html#248885099">(Aug 09 2021 at 18:06)</a>:</h4>
<p>First, we get to <code>&lt;I32 as Family&gt;::Member&lt;ReEarlyBound(0, 'a)&gt;</code> and normalize to <code>i32</code> fine</p>



<a name="248885162"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20things/near/248885162" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20things.html#248885162">(Aug 09 2021 at 18:07)</a>:</h4>
<p>Then we get to <code>&lt;I32 as Family&gt;::Member&lt;ReLateBound(DebruijnIndex(0), BoundRegion { var: 0, kind: BrNamed(DefId(0:6 ~ issue_87429[d218]::Family::Member::'b), 'b) })&gt;</code> and we run into problems, but probably not because of why you might think</p>



<a name="248885334"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20things/near/248885334" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20things.html#248885334">(Aug 09 2021 at 18:08)</a>:</h4>
<p>(we do actually try the late bound lifetime here correctly, so that's not it)</p>



<a name="248885403"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20things/near/248885403" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20things.html#248885403">(Aug 09 2021 at 18:09)</a>:</h4>
<p>So, we eventually try to <code>opt_normalize</code> <code>ProjectionTy { substs: [I32, RePlaceholder(Placeholder { universe: U1, name: BrNamed(DefId(0:6 ~ issue_87429[d218]::Family::Member::'b), 'b) })], item_def_id: DefId(0:4 ~ issue_87429[d218]::Family::Member) }</code></p>



<a name="248885431"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20things/near/248885431" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20things.html#248885431">(Aug 09 2021 at 18:09)</a>:</h4>
<p>This is fine: we've replaced late bound vars by placeholders, that's right</p>



<a name="248885566"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20things/near/248885566" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20things.html#248885566">(Aug 09 2021 at 18:10)</a>:</h4>
<p>There's a predicate in the <code>param_env</code> that we can use to project this:</p>
<div class="codehilite"><pre><span></span><code>Binder(ProjectionPredicate(ProjectionTy { substs: [I32, ReEarlyBound(0, &#39;a)], item_def_id: DefId(0:4 ~ issue_87429[d218]::Family::Member) }, i32), [])
</code></pre></div>



<a name="248885701"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20things/near/248885701" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20things.html#248885701">(Aug 09 2021 at 18:11)</a>:</h4>
<p>Well, using this, we eventually end up with the region constraints <code>ReEarlyBound('a) == RePlaceholder('b)</code></p>



<a name="248885713"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20things/near/248885713" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20things.html#248885713">(Aug 09 2021 at 18:11)</a>:</h4>
<p>That eventually fails</p>



<a name="248885728"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20things/near/248885728" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20things.html#248885728">(Aug 09 2021 at 18:11)</a>:</h4>
<p>Well...this is wrong.</p>



<a name="248885830"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20things/near/248885830" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20things.html#248885830">(Aug 09 2021 at 18:12)</a>:</h4>
<p>That param_env predicate <em>should</em> be <code>for&lt;'a&gt; &lt;I32 as Family&gt;::Member&lt;'a&gt; == i32</code></p>



<a name="248885861"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20things/near/248885861" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20things.html#248885861">(Aug 09 2021 at 18:12)</a>:</h4>
<p>Pay attention to the use of bound vars instead of an early bound region</p>



<a name="248885950"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20things/near/248885950" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20things.html#248885950">(Aug 09 2021 at 18:13)</a>:</h4>
<p>But, I'm unsure if just "fixing" that will work. I think this is a deeper issue</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>