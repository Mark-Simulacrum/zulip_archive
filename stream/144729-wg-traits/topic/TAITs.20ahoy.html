<html>
<head><meta charset="utf-8"><title>TAITs ahoy · wg-traits · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/index.html">wg-traits</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html">TAITs ahoy</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="247205934"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247205934" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247205934">(Jul 26 2021 at 14:01)</a>:</h4>
<p>Hey <span class="user-mention" data-user-id="124288">@oli</span> and <span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> or others-- can we sync on Zuliptoday?</p>



<a name="247205955"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247205955" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247205955">(Jul 26 2021 at 14:01)</a>:</h4>
<p><span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span>, sure!</p>



<a name="247205960"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247205960" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247205960">(Jul 26 2021 at 14:01)</a>:</h4>
<p>zulip party sgtm</p>



<a name="247206014"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247206014" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247206014">(Jul 26 2021 at 14:01)</a>:</h4>
<p>I was going to ask, what's the plan with <code>min_type_alias_impl_trait</code>?</p>



<a name="247206085"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247206085" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247206085">(Jul 26 2021 at 14:02)</a>:</h4>
<p>put it into a bunker next to a nuke and run</p>



<a name="247206104"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247206104" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247206104">(Jul 26 2021 at 14:02)</a>:</h4>
<p>lol</p>



<a name="247206112"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247206112" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247206112">(Jul 26 2021 at 14:02)</a>:</h4>
<p>idk, we can still use it for syntactical gating</p>



<a name="247206130"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247206130" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247206130">(Jul 26 2021 at 14:02)</a>:</h4>
<p>but the usefulness of that is... unclear</p>



<a name="247206153"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247206153" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247206153">(Jul 26 2021 at 14:02)</a>:</h4>
<p>ok</p>



<a name="247206166"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247206166" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247206166">(Jul 26 2021 at 14:02)</a>:</h4>
<p>like, we can't really protect against using it <em>everywhere</em> with the new system</p>



<a name="247206176"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247206176" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247206176">(Jul 26 2021 at 14:03)</a>:</h4>
<p>I think at this point the idea should be scrapped</p>



<a name="247206192"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247206192" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247206192">(Jul 26 2021 at 14:03)</a>:</h4>
<p>and we should just run with <code>type_alias_impl_trait</code> and stabilize the "whole thing"</p>



<a name="247206199"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247206199" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247206199">(Jul 26 2021 at 14:03)</a>:</h4>
<p>or move any remaining details to other feature gates</p>



<a name="247206204"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247206204" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247206204">(Jul 26 2021 at 14:03)</a>:</h4>
<p><span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="247206241"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247206241" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247206241">(Jul 26 2021 at 14:03)</a>:</h4>
<p><span class="user-mention" data-user-id="124288">@oli</span> how goes the hacking on the newer approach?</p>



<a name="247206334"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247206334" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247206334">(Jul 26 2021 at 14:04)</a>:</h4>
<p>well... as we discussed on Friday, there is an unfortunate coupling of the current eager <code>instantiate</code> scheme that does both infer var generation and bound generation</p>



<a name="247206428"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247206428" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247206428">(Jul 26 2021 at 14:05)</a>:</h4>
<p>I am now splitting this up. The eager thing will still generate the infer vars, but the bound generation will happen after inference is done</p>



<a name="247206459"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247206459" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247206459">(Jul 26 2021 at 14:05)</a>:</h4>
<p>i.e., if we have <code>-&gt; impl Debug</code>, which we instantiate to <code>?X</code>, then "bound generation" means adding <code>?X: Debug</code>?</p>



<a name="247206481"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247206481" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247206481">(Jul 26 2021 at 14:05)</a>:</h4>
<p>I've crossed a lot of time zones since Friday, so forgive me while I page things back in</p>



<a name="247206505"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247206505" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247206505">(Jul 26 2021 at 14:05)</a>:</h4>
<p>yea</p>



<a name="247206516"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247206516" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247206516">(Jul 26 2021 at 14:05)</a>:</h4>
<p><span class="user-mention silent" data-user-id="124288">oli</span> <a href="#narrow/stream/144729-wg-traits/topic/TAITs.20ahoy/near/247206428">said</a>:</p>
<blockquote>
<p>I am now splitting this up. The eager thing will still generate the infer vars, but the bound generation will happen after inference is done</p>
</blockquote>
<p>unification does return a set of obligations</p>



<a name="247206521"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247206521" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247206521">(Jul 26 2021 at 14:05)</a>:</h4>
<p>that's exactly it</p>



<a name="247206523"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247206523" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247206523">(Jul 26 2021 at 14:05)</a>:</h4>
<p>(the <code>InferOk</code> list)</p>



<a name="247206578"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247206578" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247206578">(Jul 26 2021 at 14:06)</a>:</h4>
<p>so plausibly we could return the bounds in there, right?</p>



<a name="247206587"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247206587" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247206587">(Jul 26 2021 at 14:06)</a>:</h4>
<p>hmm</p>



<a name="247206606"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247206606" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247206606">(Jul 26 2021 at 14:06)</a>:</h4>
<p>the problem was that we can't compute the bounds</p>



<a name="247206624"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247206624" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247206624">(Jul 26 2021 at 14:06)</a>:</h4>
<p>because <code>rustc_infer</code> doesn't have access to <code>rustc_trait_resolve</code></p>



<a name="247206647"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247206647" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247206647">(Jul 26 2021 at 14:06)</a>:</h4>
<p>it seems ok to generate the bounds later</p>



<a name="247206655"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247206655" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247206655">(Jul 26 2021 at 14:06)</a>:</h4>
<p>but remind me why this matters :)</p>



<a name="247206735"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247206735" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247206735">(Jul 26 2021 at 14:07)</a>:</h4>
<p>sec, I need to link to code to explain</p>



<a name="247207126"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247207126" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247207126">(Jul 26 2021 at 14:10)</a>:</h4>
<p>argml, vscode doesn't link to lines anymore, just to files</p>



<a name="247207200"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247207200" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247207200">(Jul 26 2021 at 14:11)</a>:</h4>
<p>anyway, so we have a FnCtxt for typeck to check an entire function. This currently eagerly instantiates opaque types from the return type</p>



<a name="247207306"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247207306" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247207306">(Jul 26 2021 at 14:12)</a>:</h4>
<p>the obligations generated during that (returned via <code>InferOk</code>) are stored in the FnCtxt</p>



<a name="247207372"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247207372" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247207372">(Jul 26 2021 at 14:12)</a>:</h4>
<p>are they handled specially somewhere?</p>



<a name="247207397"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247207397" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247207397">(Jul 26 2021 at 14:12)</a>:</h4>
<p>The obligations are generated in <code>instantiate_opaque_types_in_map</code> or more precisely <code>fold_opaque_ty</code></p>



<a name="247207410"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247207410" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247207410">(Jul 26 2021 at 14:13)</a>:</h4>
<p>right</p>



<a name="247207426"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247207426" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247207426">(Jul 26 2021 at 14:13)</a>:</h4>
<p>not really, they are just generated right when we create the inference variable</p>



<a name="247207443"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247207443" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247207443">(Jul 26 2021 at 14:13)</a>:</h4>
<p>but doing this at the same time is not necessary</p>



<a name="247207450"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247207450" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247207450">(Jul 26 2021 at 14:13)</a>:</h4>
<p>right</p>



<a name="247207460"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247207460" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247207460">(Jul 26 2021 at 14:13)</a>:</h4>
<p>I definitely think we <em>can</em> do it later</p>



<a name="247207484"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247207484" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247207484">(Jul 26 2021 at 14:13)</a>:</h4>
<p>I might have expected us to do it via <code>InferOk</code></p>



<a name="247207491"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247207491" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247207491">(Jul 26 2021 at 14:14)</a>:</h4>
<p>but I am ok with either approach</p>



<a name="247207540"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247207540" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247207540">(Jul 26 2021 at 14:14)</a>:</h4>
<p>at least for now</p>



<a name="247207580"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247207580" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247207580">(Jul 26 2021 at 14:14)</a>:</h4>
<p>I imagine that you are thinking we'll have the <code>FnCtxt</code> iterate over the hashmap of "instantiated opaque types" in the inferctxt and add the relevant obligations, probably at the very end of typecheck?</p>



<a name="247207591"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247207591" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247207591">(Jul 26 2021 at 14:14)</a>:</h4>
<p>yes</p>



<a name="247207601"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247207601" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247207601">(Jul 26 2021 at 14:14)</a>:</h4>
<p>we may have to do it more than once</p>



<a name="247207608"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247207608" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247207608">(Jul 26 2021 at 14:14)</a>:</h4>
<p>or-- perhaps--</p>



<a name="247207657"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247207657" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247207657">(Jul 26 2021 at 14:15)</a>:</h4>
<p>I would probably add that logic into the "fulfill obligations if necessary" callback-- let me find it</p>



<a name="247207809"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247207809" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247207809">(Jul 26 2021 at 14:16)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/144729-wg-traits/topic/TAITs.20ahoy/near/247206655">said</a>:</p>
<blockquote>
<p>but remind me why this matters <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>
</blockquote>
<p>the problem is that inference happens in <code>rustc_infer</code>, but obligation generation needs to call code from <code>rustc_trait_selection</code>, and I don't want to even try to add a dependency to <code>rustc_infer</code></p>



<a name="247208163"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247208163" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247208163">(Jul 26 2021 at 14:18)</a>:</h4>
<p>ok ok, I'm not sure why they should ahve to, but I believe you</p>



<a name="247208210"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247208210" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247208210">(Jul 26 2021 at 14:19)</a>:</h4>
<p>it may be possible to untangle them</p>



<a name="247208216"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247208216" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247208216">(Jul 26 2021 at 14:19)</a>:</h4>
<p>but it is very entangled right now</p>



<a name="247208289"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247208289" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247208289">(Jul 26 2021 at 14:19)</a>:</h4>
<p>so I would add the automatic generation here I think</p>



<a name="247208296"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247208296" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247208296">(Jul 26 2021 at 14:19)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">    </span><span class="k">pub</span><span class="p">(</span><span class="k">in</span><span class="w"> </span><span class="k">super</span>::<span class="k">super</span><span class="p">)</span><span class="w"> </span><span class="k">fn</span> <span class="nf">select_obligations_where_possible</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">fallback_has_occurred</span>: <span class="kt">bool</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">mutate_fulfillment_errors</span>: <span class="nc">impl</span><span class="w"> </span><span class="nb">Fn</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">traits</span>::<span class="n">FulfillmentError</span><span class="o">&lt;'</span><span class="na">tcx</span><span class="o">&gt;&gt;</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</code></pre></div>



<a name="247208344"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247208344" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247208344">(Jul 26 2021 at 14:20)</a>:</h4>
<p>in <code>impl FnCtxt</code></p>



<a name="247208379"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247208379" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247208379">(Jul 26 2021 at 14:20)</a>:</h4>
<p>I can't easily generate my github links this second</p>



<a name="247208397"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247208397" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247208397">(Jul 26 2021 at 14:20)</a>:</h4>
<p>I see it</p>



<a name="247208406"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247208406" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247208406">(Jul 26 2021 at 14:20)</a>:</h4>
<p>but to explain my thinking:</p>



<a name="247208458"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247208458" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247208458">(Jul 26 2021 at 14:20)</a>:</h4>
<p>we call that function when we want to try to solve obligations-- either because we have to (at the end of compilation) or because doing so may give us more typing hints</p>



<a name="247208504"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247208504" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247208504">(Jul 26 2021 at 14:21)</a>:</h4>
<p>this does require us to be a bit smarter around the inference contxt, i.e., we'd have to be able to say "have we already added the obligations? if so, don't do it again"</p>



<a name="247208517"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247208517" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247208517">(Jul 26 2021 at 14:21)</a>:</h4>
<p>but that's not hard</p>



<a name="247208539"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247208539" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247208539">(Jul 26 2021 at 14:21)</a>:</h4>
<p>yea, that sounds like the right spot</p>



<a name="247208565"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247208565" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247208565">(Jul 26 2021 at 14:21)</a>:</h4>
<p>there are two things I like about this</p>



<a name="247208587"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247208587" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247208587">(Jul 26 2021 at 14:21)</a>:</h4>
<ul>
<li>in the future, I'd like us to be able to conclude that <code>?T: Debug</code> based on the fact that we're going to have to prove it later</li>
</ul>



<a name="247208612"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247208612" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247208612">(Jul 26 2021 at 14:21)</a>:</h4>
<p>for that to work, we'd need the <code>?T: Debug</code> obligation to be registered :)</p>



<a name="247208656"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247208656" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247208656">(Jul 26 2021 at 14:22)</a>:</h4>
<p>and e.g. method dispatch (if I'm not mistaken) calls into this function</p>



<a name="247208696"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247208696" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247208696">(Jul 26 2021 at 14:22)</a>:</h4>
<p>on the hopes that it will figure out what <code>?T</code> is</p>



<a name="247208726"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247208726" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247208726">(Jul 26 2021 at 14:22)</a>:</h4>
<ul>
<li>we may have to do obligation generation in rounds anyway:</li>
</ul>



<a name="247208783"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247208783" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247208783">(Jul 26 2021 at 14:22)</a>:</h4>
<p>the end of type check is this fixed point thing where we try to solve all the obligatios, then do some defaulting, and try to prove some more, etc</p>



<a name="247208812"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247208812" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247208812">(Jul 26 2021 at 14:23)</a>:</h4>
<p>I could imagine that that process may wind up touching on some TAITs that are in scope</p>



<a name="247208820"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247208820" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247208820">(Jul 26 2021 at 14:23)</a>:</h4>
<p>and hence growing the set</p>



<a name="247208840"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247208840" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247208840">(Jul 26 2021 at 14:23)</a>:</h4>
<p>it'd be good to try and make a test case for that though :) sounds a bit complex lol</p>



<a name="247208844"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247208844" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247208844">(Jul 26 2021 at 14:23)</a>:</h4>
<p>make sense?</p>



<a name="247208859"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247208859" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247208859">(Jul 26 2021 at 14:23)</a>:</h4>
<p>yes, both points</p>



<a name="247209040"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247209040" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247209040">(Jul 26 2021 at 14:24)</a>:</h4>
<p>cool</p>



<a name="247209123"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247209123" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247209123">(Jul 26 2021 at 14:25)</a>:</h4>
<p>so <span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> not sure what you're up to :) test cases?</p>



<a name="247209167"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247209167" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247209167">(Jul 26 2021 at 14:25)</a>:</h4>
<p><span class="user-mention" data-user-id="124288">@oli</span> do you have a sense for timeline here?</p>



<a name="247209196"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247209196" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247209196">(Jul 26 2021 at 14:25)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/144729-wg-traits/topic/TAITs.20ahoy/near/247209123">said</a>:</p>
<blockquote>
<p>so <span class="user-mention silent" data-user-id="116266">Santiago Pastorino</span> not sure what you're up to :) test cases?</p>
</blockquote>
<p>yes, I'm with the test cases</p>



<a name="247209273"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247209273" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247209273">(Jul 26 2021 at 14:26)</a>:</h4>
<p>there are tests that exist in the test suite but we don't have in the document</p>



<a name="247209298"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247209298" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247209298">(Jul 26 2021 at 14:26)</a>:</h4>
<p>I'm adding a section in a document I own, saying what they are them about</p>



<a name="247209331"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247209331" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247209331">(Jul 26 2021 at 14:26)</a>:</h4>
<p>but also, I'd be fine to get some coding tasks too if there's any to do</p>



<a name="247209481"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247209481" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247209481">(Jul 26 2021 at 14:27)</a>:</h4>
<p>oh one other point, <span class="user-mention" data-user-id="124288">@oli</span>, as a final consistency check, we should check that the set of types for which we have instantiated obligations, and the set of types we have instantiated within inferctxt, are the same set :)</p>



<a name="247209567"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247209567" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247209567">(Jul 26 2021 at 14:28)</a>:</h4>
<p>ok, that all sounds good <span class="user-mention" data-user-id="116266">@Santiago Pastorino</span></p>



<a name="247209595"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247209595" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247209595">(Jul 26 2021 at 14:28)</a>:</h4>
<p>as far as coding, I <em>think</em> right now we're still blocked on <span class="user-mention" data-user-id="124288">@oli</span>'s refactoring before it makes sense to do anything else</p>



<a name="247209624"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247209624" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247209624">(Jul 26 2021 at 14:28)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/144729-wg-traits/topic/TAITs.20ahoy/near/247209167">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="124288">oli</span> do you have a sense for timeline here?</p>
</blockquote>
<p>well, so far it has been an "looks good, oh weird situation -&gt; lots more work", this pattern may continue. Other than that, probably two weeks for the impl plus another for testing? Also got a weird ICE after removing the typeck dependency for tait information during mir borrowck: <a href="https://github.com/rust-lang/rust/issues/87455#issue-952299650">https://github.com/rust-lang/rust/issues/87455#issue-952299650</a></p>



<a name="247209647"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247209647" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247209647">(Jul 26 2021 at 14:28)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/144729-wg-traits/topic/TAITs.20ahoy/near/247209595">said</a>:</p>
<blockquote>
<p>as far as coding, I <em>think</em> right now we're still blocked on <span class="user-mention silent" data-user-id="124288">oli</span>'s refactoring before it makes sense to do anything else</p>
</blockquote>
<p>removing min_tait can be done in parallel</p>



<a name="247209746"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247209746" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247209746">(Jul 26 2021 at 14:29)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/144729-wg-traits/topic/TAITs.20ahoy/near/247209481">said</a>:</p>
<blockquote>
<p>oh one other point, <span class="user-mention silent" data-user-id="124288">oli</span>, as a final consistency check, we should check that the set of types for which we have instantiated obligations, and the set of types we have instantiated within inferctxt, are the same set <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>
</blockquote>
<p>that will require a bit of tracking overhead, but seems ok to do right now and remove later</p>



<a name="247209843"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247209843" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247209843">(Jul 26 2021 at 14:30)</a>:</h4>
<p>I'm imagining you have to do that anyway</p>



<a name="247209884"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247209884" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247209884">(Jul 26 2021 at 14:30)</a>:</h4>
<p><span class="user-mention silent" data-user-id="124288">oli</span> <a href="#narrow/stream/144729-wg-traits/topic/TAITs.20ahoy/near/247209647">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/144729-wg-traits/topic/TAITs.20ahoy/near/247209595">said</a>:</p>
<blockquote>
<p>as far as coding, I <em>think</em> right now we're still blocked on <span class="user-mention silent" data-user-id="124288">oli</span>'s refactoring before it makes sense to do anything else</p>
</blockquote>
<p>removing min_tait can be done in parallel</p>
</blockquote>
<p>do you think we should remove the feature flag and just leave <code>type_alias_impl_trait</code>?</p>



<a name="247209892"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247209892" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247209892">(Jul 26 2021 at 14:30)</a>:</h4>
<p>I was thinking that, in the <code>FnCtxt</code>, there would be a hashset of "all TAITs that have had their obligations created"</p>



<a name="247209910"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247209910" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247209910">(Jul 26 2021 at 14:30)</a>:</h4>
<p>and we would compare its contents against the set "all TAITs taht have inference variables"</p>



<a name="247209931"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247209931" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247209931">(Jul 26 2021 at 14:30)</a>:</h4>
<p>ok, I can remove the feature flag then</p>



<a name="247209935"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247209935" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247209935">(Jul 26 2021 at 14:30)</a>:</h4>
<p>in order to create any obligations that are needed</p>



<a name="247209961"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247209961" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247209961">(Jul 26 2021 at 14:31)</a>:</h4>
<p>is "let binding impl trait" fully removed?</p>



<a name="247209974"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247209974" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247209974">(Jul 26 2021 at 14:31)</a>:</h4>
<p>yes</p>



<a name="247210000"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247210000" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247210000">(Jul 26 2021 at 14:31)</a>:</h4>
<p>also, I've adjusted our dashboard</p>



<a name="247210003"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247210003" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247210003">(Jul 26 2021 at 14:31)</a>:</h4>
<p>very nice</p>



<a name="247210008"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247210008" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247210008">(Jul 26 2021 at 14:31)</a>:</h4>
<p>moved some tasks to complete</p>



<a name="247210049"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247210049" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247210049">(Jul 26 2021 at 14:31)</a>:</h4>
<p>also the work we were doing together is merged</p>



<a name="247210098"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247210098" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247210098">(Jul 26 2021 at 14:31)</a>:</h4>
<p>talking about <a href="https://github.com/rust-lang/rust/issues/87287">#87287</a>, which closes <a href="https://github.com/rust-lang/rust/issues/86465">#86465</a></p>



<a name="247210101"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247210101" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247210101">(Jul 26 2021 at 14:31)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/144729-wg-traits/topic/TAITs.20ahoy/near/247209935">said</a>:</p>
<blockquote>
<p>in order to create any obligations that are needed</p>
</blockquote>
<p>I was considering just adding a "todo" queue that gets emptied every time we resolve some, but just having a set works, too</p>



<a name="247210201"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247210201" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247210201">(Jul 26 2021 at 14:32)</a>:</h4>
<p>and <a href="https://github.com/rust-lang/rust/issues/86410">#86410</a> is merged too</p>



<a name="247210768"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247210768" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247210768">(Jul 26 2021 at 14:36)</a>:</h4>
<p><span class="user-mention" data-user-id="124288">@oli</span> a to-do- queue could work, yeah, in that case checking for consistency is just checking that the queue is empty.</p>



<a name="247211224"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247211224" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247211224">(Jul 26 2021 at 14:39)</a>:</h4>
<p>cool, seems like not much to talk about then?</p>



<a name="247211287"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247211287" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247211287">(Jul 26 2021 at 14:40)</a>:</h4>
<p>I guess <span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> can remove the <code>min_tait</code> feature gate</p>



<a name="247211316"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247211316" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247211316">(Jul 26 2021 at 14:40)</a>:</h4>
<p>I'm wondering then about the issue triage -- butI think we'll just revisit it after the "reimplement the core engine" work is done</p>



<a name="247211531"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247211531" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247211531">(Jul 26 2021 at 14:41)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/144729-wg-traits/topic/TAITs.20ahoy/near/247211316">said</a>:</p>
<blockquote>
<p>I'm wondering then about the issue triage -- butI think we'll just revisit it after the "reimplement the core engine" work is done</p>
</blockquote>
<p>someone already did a PR to close all the impl trait in bindings ICE issues by creating tests for them</p>



<a name="247211624"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247211624" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247211624">(Jul 26 2021 at 14:42)</a>:</h4>
<p>but yea, the rest needs a full review with the new information we have now</p>



<a name="247214364"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247214364" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247214364">(Jul 26 2021 at 15:00)</a>:</h4>
<p><span class="user-mention silent" data-user-id="124288">oli</span> <a href="#narrow/stream/144729-wg-traits/topic/TAITs.20ahoy/near/247211531">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/144729-wg-traits/topic/TAITs.20ahoy/near/247211316">said</a>:</p>
<blockquote>
<p>I'm wondering then about the issue triage -- butI think we'll just revisit it after the "reimplement the core engine" work is done</p>
</blockquote>
<p>someone already did a PR to close all the impl trait in bindings ICE issues by creating tests for them</p>
</blockquote>
<p>can you provide a link to that?</p>



<a name="247215714"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247215714" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247215714">(Jul 26 2021 at 15:09)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/pull/87383">https://github.com/rust-lang/rust/pull/87383</a></p>



<a name="247501681"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/247501681" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#247501681">(Jul 28 2021 at 18:55)</a>:</h4>
<p>I caused an ICE with the mir borrowck/typeck decoupling. The fix is up in <a href="https://github.com/rust-lang/rust/pull/87483">https://github.com/rust-lang/rust/pull/87483</a></p>



<a name="249592631"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249592631" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249592631">(Aug 16 2021 at 14:04)</a>:</h4>
<p>Hey <span class="user-mention" data-user-id="124288">@oli</span> and <span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> -- shall we chat here?</p>



<a name="249592654"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249592654" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249592654">(Aug 16 2021 at 14:04)</a>:</h4>
<p>I'm back from vacation today =)</p>



<a name="249592668"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249592668" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249592668">(Aug 16 2021 at 14:04)</a>:</h4>
<p><span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span></p>



<a name="249592673"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249592673" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249592673">(Aug 16 2021 at 14:04)</a>:</h4>
<p>welcome back</p>



<a name="249592678"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249592678" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249592678">(Aug 16 2021 at 14:04)</a>:</h4>
<p>probably jus going to "mark all as read"</p>



<a name="249592685"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249592685" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249592685">(Aug 16 2021 at 14:04)</a>:</h4>
<p>so I'm going to need some context :)</p>



<a name="249592691"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249592691" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249592691">(Aug 16 2021 at 14:04)</a>:</h4>
<p><span aria-label="clap" class="emoji emoji-1f44f" role="img" title="clap">:clap:</span></p>



<a name="249592699"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249592699" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249592699">(Aug 16 2021 at 14:04)</a>:</h4>
<p>wise decision :)</p>



<a name="249592723"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249592723" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249592723">(Aug 16 2021 at 14:04)</a>:</h4>
<p><a href="https://hackmd.io/FNLjLrevQcSKoIDAsf9ivQ">https://hackmd.io/FNLjLrevQcSKoIDAsf9ivQ</a> &lt;-- hackmd</p>



<a name="249592757"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249592757" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249592757">(Aug 16 2021 at 14:05)</a>:</h4>
<p><span class="user-mention" data-user-id="124288">@oli</span> is the one that made the important progress here</p>



<a name="249592766"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249592766" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249592766">(Aug 16 2021 at 14:05)</a>:</h4>
<p>I just did some minor stuff</p>



<a name="249592791"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249592791" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249592791">(Aug 16 2021 at 14:05)</a>:</h4>
<p>but would be waiting also to take new tasks</p>



<a name="249592797"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249592797" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249592797">(Aug 16 2021 at 14:05)</a>:</h4>
<p>ok</p>



<a name="249592900"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249592900" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249592900">(Aug 16 2021 at 14:06)</a>:</h4>
<p><code>min_type_alias_impl_trait</code> is also removed as it was the bindings</p>



<a name="249592918"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249592918" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249592918">(Aug 16 2021 at 14:06)</a>:</h4>
<p>but <span class="user-mention" data-user-id="124288">@oli</span> was doing some refactors</p>



<a name="249592926"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249592926" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249592926">(Aug 16 2021 at 14:06)</a>:</h4>
<p>that's great</p>



<a name="249592951"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249592951" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249592951">(Aug 16 2021 at 14:06)</a>:</h4>
<p>I wonder if <span class="user-mention" data-user-id="124288">@oli</span> is around now</p>



<a name="249592994"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249592994" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249592994">(Aug 16 2021 at 14:07)</a>:</h4>
<p>this is all I did :) + reviewing some of <span class="user-mention" data-user-id="124288">@oli</span>'s PRs and minor cleanups</p>



<a name="249593018"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249593018" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249593018">(Aug 16 2021 at 14:07)</a>:</h4>
<p>ahh I've also finished a table with the tests</p>



<a name="249593045"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249593045" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249593045">(Aug 16 2021 at 14:07)</a>:</h4>
<p>going to share that a bit later, so I can polish it</p>



<a name="249593055"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249593055" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249593055">(Aug 16 2021 at 14:07)</a>:</h4>
<p>ah, very cool</p>



<a name="249593062"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249593062" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249593062">(Aug 16 2021 at 14:07)</a>:</h4>
<p>and after that I guess I can implement missing tests</p>



<a name="249593146"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249593146" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249593146">(Aug 16 2021 at 14:08)</a>:</h4>
<p>(got to run to the bathroom, brb)</p>



<a name="249593150"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249593150" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249593150">(Aug 16 2021 at 14:08)</a>:</h4>
<p>but I'd like to sync with you and <span class="user-mention" data-user-id="124288">@oli</span> to see if you think we are covered with the tests that we have in the table</p>



<a name="249593452"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249593452" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249593452">(Aug 16 2021 at 14:10)</a>:</h4>
<p>can you link your test hackmd again?</p>



<a name="249593602"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249593602" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249593602">(Aug 16 2021 at 14:11)</a>:</h4>
<p>on my end: the refactorings already mentioned by santiago, I managed to completely resolve the issues we had. The previous code required normalization, but we can just register obligations with the <code>InferCtxt</code> that state that said projections must hold instead of immediately trying to prove them</p>



<a name="249593604"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249593604" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249593604">(Aug 16 2021 at 14:11)</a>:</h4>
<p>sure, I will a bit later, let me polish it :)</p>



<a name="249593718"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249593718" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249593718">(Aug 16 2021 at 14:12)</a>:</h4>
<p>back now</p>



<a name="249593802"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249593802" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249593802">(Aug 16 2021 at 14:13)</a>:</h4>
<p>so <span class="user-mention" data-user-id="124288">@oli</span> can you catch me up on what you've been up to?</p>



<a name="249593813"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249593813" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249593813">(Aug 16 2021 at 14:13)</a>:</h4>
<p>I am currently in a state where the opaque type system (without eagerly (or lazily) using inference vars for each opaque type) works to resolve the opaque type, but I'm still crashing badly because there seem to be some unresolved inference vars (e.g. within closures that are the defining type of the opaque type) that writeback cannot resolve.</p>



<a name="249593893"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249593893" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249593893">(Aug 16 2021 at 14:14)</a>:</h4>
<p>hmm</p>



<a name="249593900"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249593900" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249593900">(Aug 16 2021 at 14:14)</a>:</h4>
<p>is there a PR?</p>



<a name="249593915"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249593915" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249593915">(Aug 16 2021 at 14:14)</a>:</h4>
<p>no</p>



<a name="249593982"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249593982" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249593982">(Aug 16 2021 at 14:14)</a>:</h4>
<p>a branch? :</p>



<a name="249594019"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249594019" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249594019">(Aug 16 2021 at 14:15)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/compare/master...oli-obk:lazy_tait2?expand=1">https://github.com/rust-lang/rust/compare/master...oli-obk:lazy_tait2?expand=1</a></p>



<a name="249594025"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249594025" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249594025">(Aug 16 2021 at 14:15)</a>:</h4>
<p>was just pushing</p>



<a name="249594084"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249594084" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249594084">(Aug 16 2021 at 14:15)</a>:</h4>
<p>oh yea, one interesting thing I noticed is that the opaque type storage did not support snapshots/rollback</p>



<a name="249594094"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249594094" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249594094">(Aug 16 2021 at 14:15)</a>:</h4>
<p>I had to introduce that</p>



<a name="249594168"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249594168" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249594168">(Aug 16 2021 at 14:16)</a>:</h4>
<p>it didn't matter before, because all resolutions happened outside of snapshots <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span></p>



<a name="249594224"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249594224" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249594224">(Aug 16 2021 at 14:16)</a>:</h4>
<p>The last WIP commit is the actually interesting change, and the only commit that doesn't work, all others pass all tests</p>



<a name="249594339"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249594339" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249594339">(Aug 16 2021 at 14:18)</a>:</h4>
<p>ok</p>



<a name="249594409"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249594409" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249594409">(Aug 16 2021 at 14:18)</a>:</h4>
<p>I've just checked it out locally</p>



<a name="249594468"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249594468" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249594468">(Aug 16 2021 at 14:19)</a>:</h4>
<p>but I guess we can dig into the details later</p>



<a name="249594472"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249594472" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249594472">(Aug 16 2021 at 14:19)</a>:</h4>
<p>yea</p>



<a name="249594535"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249594535" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249594535">(Aug 16 2021 at 14:19)</a>:</h4>
<p>I'm adding updates to <a href="https://hackmd.io/FNLjLrevQcSKoIDAsf9ivQ">https://hackmd.io/FNLjLrevQcSKoIDAsf9ivQ</a></p>



<a name="249594692"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249594692" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249594692">(Aug 16 2021 at 14:20)</a>:</h4>
<p><span class="user-mention silent" data-user-id="124288">oli</span> <a href="#narrow/stream/144729-wg-traits/topic/TAITs.20ahoy/near/249593602">said</a>:</p>
<blockquote>
<p>on my end: the refactorings already mentioned by santiago, I managed to completely resolve the issues we had. The previous code required normalization, but we can just register obligations with the <code>InferCtxt</code> that state that said projections must hold instead of immediately trying to prove them</p>
</blockquote>
<p>have these all landed?</p>



<a name="249594748"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249594748" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249594748">(Aug 16 2021 at 14:21)</a>:</h4>
<p>no, part of that branch</p>



<a name="249594753"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249594753" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249594753">(Aug 16 2021 at 14:21)</a>:</h4>
<p>but we can land them on their own</p>



<a name="249594778"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249594778" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249594778">(Aug 16 2021 at 14:21)</a>:</h4>
<p>ok</p>



<a name="249594796"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249594796" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249594796">(Aug 16 2021 at 14:21)</a>:</h4>
<p>at this point I guess we are still basically blocked on landing this refactoring?</p>



<a name="249595083"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249595083" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249595083">(Aug 16 2021 at 14:23)</a>:</h4>
<p>yes</p>



<a name="249595216"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249595216" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249595216">(Aug 16 2021 at 14:24)</a>:</h4>
<p>then why don't I dig into this branch</p>



<a name="249595850"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249595850" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249595850">(Aug 16 2021 at 14:29)</a>:</h4>
<p>so... my current hypothesis is that the previous system that generated an inference var for opaque types in return position allowed the inference system to compare said inference var with more complex things like closures containing inference vars and this allowed everything to work out. The part that I can't figure out is why this doesn't work if we just use the first closure&lt;&gt;opaquety comparison to start replacing all opaque types of the same type with the closure from now on.</p>



<a name="249596006"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249596006" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249596006">(Aug 16 2021 at 14:30)</a>:</h4>
<p>is there a specific example that fails?</p>



<a name="249596110"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249596110" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249596110">(Aug 16 2021 at 14:31)</a>:</h4>
<div class="codehilite"><pre><span></span><code>error[E0282]: type annotations needed
   --&gt; library/core/src/iter/adapters/mod.rs:194:54
    |
194 |         fn ok&lt;B, T&gt;(mut f: impl FnMut(B, T) -&gt; B) -&gt; impl FnMut(B, T) -&gt; Result&lt;B, !&gt; {
    |                                                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ cannot infer type for opaque type `impl FnMut&lt;(B, T)&gt;`
</code></pre></div>



<a name="249596131"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249596131" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249596131">(Aug 16 2021 at 14:31)</a>:</h4>
<p>ok :) fun</p>



<a name="249596164"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249596164" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249596164">(Aug 16 2021 at 14:31)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/blob/73d96b090bb68065cd3a469b27cbd568e39bf0e7/library/core/src/iter/adapters/mod.rs#L194">https://github.com/rust-lang/rust/blob/73d96b090bb68065cd3a469b27cbd568e39bf0e7/library/core/src/iter/adapters/mod.rs#L194</a></p>



<a name="249596167"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249596167" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249596167">(Aug 16 2021 at 14:31)</a>:</h4>
<p>have you tried to minimize it or anything</p>



<a name="249596223"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249596223" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249596223">(Aug 16 2021 at 14:32)</a>:</h4>
<blockquote>
<p>Resolver::fold_ty: input type <code>Closure(DefId(0:6779 ~ core[c54b]::iter::adapters::{impl#0}::fold::ok::{closure#0}), [B, T, impl FnMut(B, T) -&gt; B, _, extern "rust-call" fn((_, _)) -&gt; _, _])</code> not fully resolvable: unconstrained type</p>
</blockquote>



<a name="249596252"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249596252" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249596252">(Aug 16 2021 at 14:32)</a>:</h4>
<p>well... I was debating whether to feature gate this and then write tests</p>



<a name="249596300"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249596300" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249596300">(Aug 16 2021 at 14:33)</a>:</h4>
<p>I have a hunch</p>



<a name="249596331"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249596331" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249596331">(Aug 16 2021 at 14:33)</a>:</h4>
<p>I wonder if what is going wrong has to do with the "infer closure signature" logic</p>



<a name="249596351"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249596351" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249596351">(Aug 16 2021 at 14:33)</a>:</h4>
<p>note that we can resolve it to <code>[B, T, impl FnMut(B, T) -&gt; B, _, extern "rust-call" fn((B, T)) -&gt; Result&lt;T, _&gt;, _]</code> or maybe even a bit further</p>



<a name="249596368"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249596368" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249596368">(Aug 16 2021 at 14:33)</a>:</h4>
<p>looks like I am reproducing the same failure now</p>



<a name="249596513"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249596513" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249596513">(Aug 16 2021 at 14:34)</a>:</h4>
<p>if you move the <code>visit_opaque_types</code> call before the <code>visit_body</code> in <code>writeback.rs</code>, you get the partial resolution</p>



<a name="249596583"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249596583" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249596583">(Aug 16 2021 at 14:35)</a>:</h4>
<p>from the logs:</p>



<a name="249596603"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249596603" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249596603">(Aug 16 2021 at 14:35)</a>:</h4>
<div class="codehilite"><pre><span></span><code>(#0), None), span: library/core/src/iter/adapters/mod.rs:195:13: 195:40 (#0) },expected=ExpectHasType(impl ops::function::FnMut&lt;(B, T)&gt;))
DEBUG rustc_typeck::check::closure deduce_expectations_from_expected_type(expected_ty=impl ops::function::FnMut&lt;(B, T)&gt;)
DEBUG rustc_typeck::check::closure check_closure(opt_kind=None, expected_sig=None)
DEBUG rustc_typeck::check::closure sig_of_closure_no_expectation() &lt;------ this line in particular
</code></pre></div>



<a name="249596622"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249596622" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249596622">(Aug 16 2021 at 14:35)</a>:</h4>
<p>hmm</p>



<a name="249596635"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249596635" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249596635">(Aug 16 2021 at 14:35)</a>:</h4>
<p>I believe how this <em>used</em> to work</p>



<a name="249596651"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249596651" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249596651">(Aug 16 2021 at 14:35)</a>:</h4>
<p>is that (a) we have an inference variable as the expected type</p>



<a name="249596724"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249596724" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249596724">(Aug 16 2021 at 14:36)</a>:</h4>
<p>(b) we have pending obligations in the fulfillment context like <code>?X: FnMut(...)</code></p>



<a name="249596738"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249596738" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249596738">(Aug 16 2021 at 14:36)</a>:</h4>
<p>from which we can deduce the signature</p>



<a name="249596745"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249596745" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249596745">(Aug 16 2021 at 14:36)</a>:</h4>
<p>that's the thing, we don't have such obligations</p>



<a name="249596753"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249596753" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249596753">(Aug 16 2021 at 14:36)</a>:</h4>
<p>like, even before we don't generate them afaict</p>



<a name="249596781"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249596781" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249596781">(Aug 16 2021 at 14:37)</a>:</h4>
<p>that doesn't seem correct</p>



<a name="249596802"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249596802" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249596802">(Aug 16 2021 at 14:37)</a>:</h4>
<p>DEBUG rustc_typeck:<span aria-label="check" class="emoji emoji-2705" role="img" title="check">:check:</span>:closure deduce_expectations_from_expected_type(expected_ty=impl ops::function::FnMut&lt;(B, T)&gt;)</p>



<a name="249596806"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249596806" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249596806">(Aug 16 2021 at 14:37)</a>:</h4>
<p>my change is minimal, it does not do less</p>



<a name="249596807"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249596807" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249596807">(Aug 16 2021 at 14:37)</a>:</h4>
<p>that's interesting</p>



<a name="249596830"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249596830" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249596830">(Aug 16 2021 at 14:37)</a>:</h4>
<p>it just doesn't use the inference var, but uses the first type we compare with</p>



<a name="249596862"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249596862" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249596862">(Aug 16 2021 at 14:37)</a>:</h4>
<p>your change to what?</p>



<a name="249596874"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249596874" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249596874">(Aug 16 2021 at 14:37)</a>:</h4>
<p>maybe I need to read what your commit does :)</p>



<a name="249596877"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249596877" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249596877">(Aug 16 2021 at 14:37)</a>:</h4>
<p>my last commit</p>



<a name="249596974"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249596974" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249596974">(Aug 16 2021 at 14:38)</a>:</h4>
<p>it comments out one eager return type instantiation and uses the same logic that used to be there for lazy instantiation with a concrete type instead of an inference var</p>



<a name="249597040"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249597040" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249597040">(Aug 16 2021 at 14:39)</a>:</h4>
<p>I can probably split up that commit to make it more obvious what is not a functional change and what is, but this was my local WIP <span aria-label="confused" class="emoji emoji-1f615" role="img" title="confused">:confused:</span></p>



<a name="249597077"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249597077" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249597077">(Aug 16 2021 at 14:39)</a>:</h4>
<p>is the assumption in <code>replace_if_defining</code> that this <code>opaque_type_storage</code> table will be populated</p>



<a name="249597093"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249597093" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249597093">(Aug 16 2021 at 14:39)</a>:</h4>
<p>yes</p>



<a name="249597098"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249597098" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249597098">(Aug 16 2021 at 14:39)</a>:</h4>
<p>presumably this is an incremental step towards the final goal?</p>



<a name="249597120"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249597120" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249597120">(Aug 16 2021 at 14:39)</a>:</h4>
<p>no, the first one puts something in</p>



<a name="249597139"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249597139" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249597139">(Aug 16 2021 at 14:39)</a>:</h4>
<p>all future uses just compare with the value that is there</p>



<a name="249597191"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249597191" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249597191">(Aug 16 2021 at 14:40)</a>:</h4>
<p>oic</p>



<a name="249597230"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249597230" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249597230">(Aug 16 2021 at 14:40)</a>:</h4>
<p>which I assumed would work due to all the inference logic that happens on comparisons</p>



<a name="249597272"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249597272" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249597272">(Aug 16 2021 at 14:40)</a>:</h4>
<p>but even if I lazily generate an inference var, we get the same error</p>



<a name="249597289"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249597289" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249597289">(Aug 16 2021 at 14:40)</a>:</h4>
<p>should've probably started with that information -.-</p>



<a name="249597293"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249597293" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249597293">(Aug 16 2021 at 14:41)</a>:</h4>
<p>I think the problem is more <em>when</em> it is happening</p>



<a name="249597361"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249597361" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249597361">(Aug 16 2021 at 14:41)</a>:</h4>
<p>ah wait</p>



<a name="249597370"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249597370" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249597370">(Aug 16 2021 at 14:41)</a>:</h4>
<p><span class="user-mention silent" data-user-id="124288">oli</span> <a href="#narrow/stream/144729-wg-traits/topic/TAITs.20ahoy/near/249597139">said</a>:</p>
<blockquote>
<p>all future uses just compare with the value that is there</p>
</blockquote>
<p>I see</p>



<a name="249597396"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249597396" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249597396">(Aug 16 2021 at 14:41)</a>:</h4>
<p>so you never generate an inference variable, right</p>



<a name="249597401"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249597401" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249597401">(Aug 16 2021 at 14:41)</a>:</h4>
<p><span class="user-mention silent" data-user-id="124288">oli</span> <a href="#narrow/stream/144729-wg-traits/topic/TAITs.20ahoy/near/249597272">said</a>:</p>
<blockquote>
<p>but even if I lazily generate an inference var, we get the same error</p>
</blockquote>
<p>I was here a week ago, but then decided to implement what we actually discussed, and ended up in the same position again</p>



<a name="249597430"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249597430" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249597430">(Aug 16 2021 at 14:42)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/144729-wg-traits/topic/TAITs.20ahoy/near/249597396">said</a>:</p>
<blockquote>
<p>so you never generate an inference variable, right</p>
</blockquote>
<p>no</p>



<a name="249597484"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249597484" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249597484">(Aug 16 2021 at 14:42)</a>:</h4>
<p>so</p>



<a name="249597496"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249597496" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249597496">(Aug 16 2021 at 14:42)</a>:</h4>
<p>the closure inference logic has some very specific reasoning</p>



<a name="249597511"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249597511" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249597511">(Aug 16 2021 at 14:42)</a>:</h4>
<p><em>probably</em> the right thing to do, given this new pathway</p>



<a name="249597523"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249597523" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249597523">(Aug 16 2021 at 14:42)</a>:</h4>
<p>is to expand it to cover <code>Opaque</code> types</p>



<a name="249597546"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249597546" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249597546">(Aug 16 2021 at 14:43)</a>:</h4>
<p>and/or to invoke <code>replace_if_defining</code>, but in this case we woudln't have much to replace it with</p>



<a name="249597568"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249597568" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249597568">(Aug 16 2021 at 14:43)</a>:</h4>
<p>check out <code>deduce_expectations_from_expected_type</code></p>



<a name="249597604"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249597604" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249597604">(Aug 16 2021 at 14:43)</a>:</h4>
<p>note that it <em>specifically</em> looks for unresolved inference variables</p>



<a name="249597708"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249597708" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249597708">(Aug 16 2021 at 14:44)</a>:</h4>
<p>the logs indicate that the expected_ty is now now an opaque type</p>



<a name="249597718"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249597718" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249597718">(Aug 16 2021 at 14:44)</a>:</h4>
<p>I think we could treat that the same as we treat <code>Dynamic</code></p>



<a name="249597723"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249597723" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249597723">(Aug 16 2021 at 14:44)</a>:</h4>
<p>and it should work ok</p>



<a name="249598054"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249598054" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249598054">(Aug 16 2021 at 14:46)</a>:</h4>
<p>oh</p>



<a name="249598099"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249598099" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249598099">(Aug 16 2021 at 14:47)</a>:</h4>
<p>yea, <code>deduce_expectations_from_expected_type</code> sounds very much like it is the culprit</p>



<a name="249598403"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249598403" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249598403">(Aug 16 2021 at 14:49)</a>:</h4>
<p>do you see what I mean by treat it like we treat dynamic?</p>



<a name="249598435"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249598435" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249598435">(Aug 16 2021 at 14:49)</a>:</h4>
<p>not literally the same, but basically look up the obligations from the <code>impl Trait</code> and dedcide it from there</p>



<a name="249598440"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249598440" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249598440">(Aug 16 2021 at 14:49)</a>:</h4>
<p>not yet, I am comparing dynamic with infer to see what these do</p>



<a name="249598749"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249598749" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249598749">(Aug 16 2021 at 14:51)</a>:</h4>
<p>do you understand the purpose of the fn overall?</p>



<a name="249598773"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249598773" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249598773">(Aug 16 2021 at 14:51)</a>:</h4>
<p>yes, but I don't see how the inference var got its projections</p>



<a name="249598834"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249598834" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249598834">(Aug 16 2021 at 14:52)</a>:</h4>
<p>I just found <code>fcx.demand_suptype(span, revealed_ret_ty, actual_return_ty);</code></p>



<a name="249598929"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249598929" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249598929">(Aug 16 2021 at 14:53)</a>:</h4>
<p>but I think that is just never type related</p>



<a name="249598974"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249598974" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249598974">(Aug 16 2021 at 14:53)</a>:</h4>
<p><span class="user-mention silent" data-user-id="124288">oli</span> <a href="#narrow/stream/144729-wg-traits/topic/TAITs.20ahoy/near/249598773">said</a>:</p>
<blockquote>
<p>yes, but I don't see how the inference var got its projections</p>
</blockquote>
<p>do you mean obligations?</p>



<a name="249598988"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249598988" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249598988">(Aug 16 2021 at 14:53)</a>:</h4>
<p>uh yea</p>



<a name="249598991"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249598991" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249598991">(Aug 16 2021 at 14:53)</a>:</h4>
<p>obligations</p>



<a name="249598999"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249598999" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249598999">(Aug 16 2021 at 14:53)</a>:</h4>
<p>well</p>



<a name="249599138"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249599138" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249599138">(Aug 16 2021 at 14:55)</a>:</h4>
<p>let me send you a link</p>



<a name="249599334"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249599334" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249599334">(Aug 16 2021 at 14:56)</a>:</h4>
<p><span class="user-mention" data-user-id="124288">@oli</span> wasn't it <a href="https://github.com/rust-lang/rust/blob/73d96b090bb68065cd3a469b27cbd568e39bf0e7/compiler/rustc_trait_selection/src/opaque_types.rs#L1030-L1042">this code</a>?</p>



<a name="249599430"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249599430" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249599430">(Aug 16 2021 at 14:57)</a>:</h4>
<p>that never touched the inference var</p>



<a name="249599444"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249599444" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249599444">(Aug 16 2021 at 14:57)</a>:</h4>
<p>I'm not sure what you mean</p>



<a name="249599503"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249599503" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249599503">(Aug 16 2021 at 14:58)</a>:</h4>
<p>by "touched", specifically</p>



<a name="249599585"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249599585" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249599585">(Aug 16 2021 at 14:58)</a>:</h4>
<p>well, "used" or did anything with it. That function is completely independent of the inference var generated for the opaque type</p>



<a name="249599639"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249599639" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249599639">(Aug 16 2021 at 14:58)</a>:</h4>
<p>ok so -- <a href="https://github.com/rust-lang/rust/blob/73d96b090bb68065cd3a469b27cbd568e39bf0e7/compiler/rustc_trait_selection/src/opaque_types.rs#L967-L970">here</a> is where we created the inference var</p>



<a name="249599669"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249599669" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249599669">(Aug 16 2021 at 14:58)</a>:</h4>
<p>and we <a href="https://github.com/rust-lang/rust/blob/73d96b090bb68065cd3a469b27cbd568e39bf0e7/compiler/rustc_trait_selection/src/opaque_types.rs#L991">insert</a> that into this map here</p>



<a name="249599775"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249599775" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249599775">(Aug 16 2021 at 14:59)</a>:</h4>
<p>that map is only ever used for the fallback</p>



<a name="249599788"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249599788" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249599788">(Aug 16 2021 at 14:59)</a>:</h4>
<p>if the opaque type is used opaquely</p>



<a name="249599853"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249599853" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249599853">(Aug 16 2021 at 15:00)</a>:</h4>
<p>yeah I'm reading, I admit it's a bit curious, the code doesn't <em>quite</em> look like I expected</p>



<a name="249599879"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249599879" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249599879">(Aug 16 2021 at 15:00)</a>:</h4>
<p>in <code>fn foo(x: Opaque) -&gt; Opaque { x }</code></p>



<a name="249599925"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249599925" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249599925">(Aug 16 2021 at 15:00)</a>:</h4>
<p>and that logic (and the map) will go away completely with the lazy system</p>



<a name="249599930"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249599930" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249599930">(Aug 16 2021 at 15:00)</a>:</h4>
<p>do you have a copy of master lying around? I'd be curious to see what result gets printed by <a href="https://github.com/rust-lang/rust/blob/73d96b090bb68065cd3a469b27cbd568e39bf0e7/compiler/rustc_trait_selection/src/opaque_types.rs#L1040">this debug statement</a></p>



<a name="249600062"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249600062" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249600062">(Aug 16 2021 at 15:01)</a>:</h4>
<p>I don't have one ready right now</p>



<a name="249600099"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249600099" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249600099">(Aug 16 2021 at 15:01)</a>:</h4>
<p>I guess I can just checkout HEAD^ on your branch</p>



<a name="249600119"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249600119" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249600119">(Aug 16 2021 at 15:01)</a>:</h4>
<p>oh</p>



<a name="249600159"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249600159" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249600159">(Aug 16 2021 at 15:01)</a>:</h4>
<p>heh I see what you are saying</p>



<a name="249600233"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249600233" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249600233">(Aug 16 2021 at 15:02)</a>:</h4>
<p>yes, you can see this even on the lazy_tait2 branch</p>



<a name="249600256"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249600256" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249600256">(Aug 16 2021 at 15:02)</a>:</h4>
<p>and yes, this is how obligations on the inference var get generated</p>



<a name="249600261"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249600261" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249600261">(Aug 16 2021 at 15:02)</a>:</h4>
<p>oof</p>



<a name="249600290"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249600290" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249600290">(Aug 16 2021 at 15:02)</a>:</h4>
<p>this recursion has gotten me a few times</p>



<a name="249600433"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249600433" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249600433">(Aug 16 2021 at 15:03)</a>:</h4>
<p>right right, I see it now</p>



<a name="249600436"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249600436" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249600436">(Aug 16 2021 at 15:03)</a>:</h4>
<p>so... while we still do the same thing for non-inference vars, that is obviously not enough, as we need to do the special closure logic as you said</p>



<a name="249600438"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249600438" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249600438">(Aug 16 2021 at 15:03)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/blob/73d96b090bb68065cd3a469b27cbd568e39bf0e7/compiler/rustc_trait_selection/src/opaque_types.rs#L987-L990">this line</a> does the store</p>



<a name="249600466"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249600466" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249600466">(Aug 16 2021 at 15:03)</a>:</h4>
<p>I understand now what happens! wheeee! thanks <span aria-label="grinning" class="emoji emoji-1f600" role="img" title="grinning">:grinning:</span></p>



<a name="249600478"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249600478" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249600478">(Aug 16 2021 at 15:03)</a>:</h4>
<p>great!</p>



<a name="249600520"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249600520" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249600520">(Aug 16 2021 at 15:04)</a>:</h4>
<p>the code threw me for a bit too with that recursion :)</p>



<a name="249600558"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/249600558" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#249600558">(Aug 16 2021 at 15:04)</a>:</h4>
<p>but it all makes sense now</p>



<a name="250005644"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/250005644" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#250005644">(Aug 19 2021 at 15:50)</a>:</h4>
<p>ok... I have learned a lot about <code>InferCtxt</code> probing and fallback in the last 10 days. And I finally understand where our troubles are coming from. When we haven't found a concrete type for an opaque type yet, we may go into a probe that compares a random type with our opaque type. This will always succeed if we are in a defining use scope, as we will assume that this is the hidden type. So all <code>eq</code>/<code>sub</code>/<code>...</code> probes from a yet unknown opaque type against anything else will succeed, and register the obligations of that opaque type for whatever we temporarily set it to. Then we revert the probe, but keep the new obligations (I think? That's what I assumed and this is what the errors seem to hint at).</p>
<div class="codehilite"><pre><span></span><code>error[E0309]: the parameter type `R` may not live long enough
  --&gt; library/core/src/iter/adapters/enumerate.rs:82:14
   |
82 |         ) -&gt; impl FnMut(Acc, T) -&gt; R + &#39;a {
   |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   |
   = help: consider adding an explicit lifetime bound `R: &#39;a`...
</code></pre></div>



<a name="250006039"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/250006039" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#250006039">(Aug 19 2021 at 15:53)</a>:</h4>
<p>so... my guess is that what we should be doing is not generate obligations so eagerly? I'm currently trying to find out where these obligations leak from the probe..</p>



<a name="250010038"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/250010038" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#250010038">(Aug 19 2021 at 16:23)</a>:</h4>
<p>found it... yea, we shouldn't generate obligations when we hit a defining use</p>



<a name="250052834"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/250052834" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#250052834">(Aug 19 2021 at 21:39)</a>:</h4>
<p>ugh</p>



<a name="250355633"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/250355633" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#250355633">(Aug 23 2021 at 14:01)</a>:</h4>
<p><span class="user-mention" data-user-id="124288">@oli</span> and <span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> zoom or zulip?</p>



<a name="250355794"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/250355794" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#250355794">(Aug 23 2021 at 14:03)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> same for me</p>



<a name="250355925"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/250355925" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#250355925">(Aug 23 2021 at 14:03)</a>:</h4>
<p>OK, well, i'm in Zoom but happy to do Zulip</p>



<a name="250356330"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/250356330" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#250356330">(Aug 23 2021 at 14:06)</a>:</h4>
<p><a href="https://hackmd.io/y1HwFSBUQS2ZKrSFuQ0Dnw?view">https://hackmd.io/y1HwFSBUQS2ZKrSFuQ0Dnw?view</a></p>



<a name="250356418"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/250356418" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#250356418">(Aug 23 2021 at 14:07)</a>:</h4>
<p><a href="https://hackmd.io/FNLjLrevQcSKoIDAsf9ivQ?edit">https://hackmd.io/FNLjLrevQcSKoIDAsf9ivQ?edit</a></p>



<a name="251233113"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251233113" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251233113">(Aug 30 2021 at 13:57)</a>:</h4>
<p><span aria-label="rofl" class="emoji emoji-1f923" role="img" title="rofl">:rofl:</span> </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">fn</span> <span class="nf">from_generator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">gen</span>: <span class="nc">T</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">impl</span><span class="w"> </span><span class="n">Future</span><span class="o">&lt;</span><span class="n">Output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span>::<span class="n">Return</span><span class="o">&gt;</span><span class="w"></span>
<span class="k">where</span><span class="w"></span>
<span class="w">    </span><span class="n">T</span>: <span class="nc">Generator</span><span class="o">&lt;</span><span class="n">ResumeTy</span><span class="p">,</span><span class="w"> </span><span class="n">Yield</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">struct</span> <span class="nc">GenFuture</span><span class="o">&lt;</span><span class="n">T</span>: <span class="nc">Generator</span><span class="o">&lt;</span><span class="n">ResumeTy</span><span class="p">,</span><span class="w"> </span><span class="n">Yield</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">T</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">// We rely on the fact that async/await futures are immovable in order to create</span>
<span class="w">    </span><span class="c1">// self-referential borrows in the underlying generator.</span>
<span class="w">    </span><span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span>: <span class="nc">Generator</span><span class="o">&lt;</span><span class="n">ResumeTy</span><span class="p">,</span><span class="w"> </span><span class="n">Yield</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="o">!</span><span class="nb">Unpin</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">GenFuture</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="w">    </span><span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span>: <span class="nc">Generator</span><span class="o">&lt;</span><span class="n">ResumeTy</span><span class="p">,</span><span class="w"> </span><span class="n">Yield</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">Future</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">GenFuture</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">type</span> <span class="nc">Output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span>::<span class="n">Return</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">fn</span> <span class="nf">poll</span><span class="p">(</span><span class="bp">self</span>: <span class="nc">Pin</span><span class="o">&lt;&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">Self</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">cx</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">Context</span><span class="o">&lt;'</span><span class="nb">_</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Poll</span><span class="o">&lt;</span><span class="bp">Self</span>::<span class="n">Output</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="c1">// SAFETY: Safe because we're !Unpin + !Drop, and this is just a field projection.</span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">gen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">unsafe</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Pin</span>::<span class="n">map_unchecked_mut</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">s</span><span class="o">|</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">};</span><span class="w"></span>

<span class="w">            </span><span class="c1">// Resume the generator, turning the `&amp;mut Context` into a `NonNull` raw pointer. The</span>
<span class="w">            </span><span class="c1">// `.await` lowering will safely cast that back to a `&amp;mut Context`.</span>
<span class="w">            </span><span class="k">match</span><span class="w"> </span><span class="n">gen</span><span class="p">.</span><span class="n">resume</span><span class="p">(</span><span class="n">ResumeTy</span><span class="p">(</span><span class="n">NonNull</span>::<span class="n">from</span><span class="p">(</span><span class="n">cx</span><span class="p">).</span><span class="n">cast</span>::<span class="o">&lt;</span><span class="n">Context</span><span class="o">&lt;'</span><span class="nb">static</span><span class="o">&gt;&gt;</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">GeneratorState</span>::<span class="n">Yielded</span><span class="p">(())</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Poll</span>::<span class="n">Pending</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="n">GeneratorState</span>::<span class="n">Complete</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Poll</span>::<span class="n">Ready</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="n">GenFuture</span><span class="p">(</span><span class="n">gen</span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>gives</p>
<div class="codehilite"><pre><span></span><code>error[E0391]: cycle detected when computing type of `from_generator::{opaque#0}`
  --&gt; /home/ubuntu/rust/src/test/ui/lazy-type-alias-impl-trait/freeze_cycle.rs:20:43
   |
LL | pub const fn from_generator&lt;T&gt;(gen: T) -&gt; impl Future&lt;Output = T::Return&gt;
   |                                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   |
note: ...which requires borrow-checking `from_generator`...
  --&gt; /home/ubuntu/rust/src/test/ui/lazy-type-alias-impl-trait/freeze_cycle.rs:20:1
   |
LL | / pub const fn from_generator&lt;T&gt;(gen: T) -&gt; impl Future&lt;Output = T::Return&gt;
LL | | where
LL | |     T: Generator&lt;ResumeTy, Yield = ()&gt;,
   | |_______________________________________^
note: ...which requires processing `from_generator`...
  --&gt; /home/ubuntu/rust/src/test/ui/lazy-type-alias-impl-trait/freeze_cycle.rs:20:1
   |
LL | / pub const fn from_generator&lt;T&gt;(gen: T) -&gt; impl Future&lt;Output = T::Return&gt;
LL | | where
LL | |     T: Generator&lt;ResumeTy, Yield = ()&gt;,
   | |_______________________________________^
note: ...which requires const checking `from_generator`...
  --&gt; /home/ubuntu/rust/src/test/ui/lazy-type-alias-impl-trait/freeze_cycle.rs:20:1
   |
LL | / pub const fn from_generator&lt;T&gt;(gen: T) -&gt; impl Future&lt;Output = T::Return&gt;
LL | | where
LL | |     T: Generator&lt;ResumeTy, Yield = ()&gt;,
   | |_______________________________________^
   = note: ...which requires computing whether `impl std::future::Future` is freeze...
   = note: ...which requires evaluating trait selection obligation `impl std::future::Future: std::marker::Freeze`...
   = note: ...which again requires computing type of `from_generator::{opaque#0}`, completing the cycle
note: cycle used when checking item types in top-level module
  --&gt; /home/ubuntu/rust/src/test/ui/lazy-type-alias-impl-trait/freeze_cycle.rs:2:1
   |
LL | / #![feature(lazy_impl_trait)]
LL | | #![feature(gen_future, generator_trait, negative_impls, const_fn_trait_bound, const_impl_trait)]
LL | |
LL | | use std::ops::{Generator, GeneratorState};
...  |
LL | |     GenFuture(gen)
LL | | }
   | |_^
</code></pre></div>
<p>with lazy tait, because the MIR now contains lots of "ty::Opaque" instead of already knowing the hidden type due to typeck having run earlier. This causes const checking to ask whether that opaque type is freeze, which causes <code>type_of</code> to be called on the opaque type, but the opaque type is defined by the current function</p>



<a name="251233628"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251233628" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251233628">(Aug 30 2021 at 14:00)</a>:</h4>
<p>Oh, I should mention that mir borrowck runs <em>after</em> const checking, so we haven't done type inference yet</p>



<a name="251233654"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251233654" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251233654">(Aug 30 2021 at 14:00)</a>:</h4>
<p>hey folks</p>



<a name="251233667"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251233667" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251233667">(Aug 30 2021 at 14:01)</a>:</h4>
<p>if we can chat on Zulip today, I'd be obliged</p>



<a name="251233678"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251233678" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251233678">(Aug 30 2021 at 14:01)</a>:</h4>
<p>sgtm</p>



<a name="251233838"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251233838" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251233838">(Aug 30 2021 at 14:02)</a>:</h4>
<p>good news: I have found the lifetime issue, so all 3 examples we extracted from libcore last time work now</p>



<a name="251233850"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251233850" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251233850">(Aug 30 2021 at 14:02)</a>:</h4>
<p>bad news: see above <span aria-label="grinning" class="emoji emoji-1f600" role="img" title="grinning">:grinning:</span></p>



<a name="251234007"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251234007" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251234007">(Aug 30 2021 at 14:03)</a>:</h4>
<p><span class="user-mention silent" data-user-id="124288">oli</span> <a href="#narrow/stream/144729-wg-traits/topic/TAITs.20ahoy/near/251233838">said</a>:</p>
<blockquote>
<p>good news: I have found the lifetime issue, so all 3 examples we extracted from libcore last time work now</p>
</blockquote>
<p>oooh, great</p>



<a name="251234010"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251234010" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251234010">(Aug 30 2021 at 14:03)</a>:</h4>
<p><span class="user-mention silent" data-user-id="124288">oli</span> <a href="#narrow/stream/144729-wg-traits/topic/TAITs.20ahoy/near/251233850">said</a>:</p>
<blockquote>
<p>bad news: see above :D</p>
</blockquote>
<p>ok</p>



<a name="251234239"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251234239" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251234239">(Aug 30 2021 at 14:04)</a>:</h4>
<p>I just realized there was a "see more" on that</p>



<a name="251234256"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251234256" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251234256">(Aug 30 2021 at 14:04)</a>:</h4>
<p>(also, cc <span class="user-mention" data-user-id="116266">@Santiago Pastorino</span>)</p>



<a name="251234365"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251234365" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251234365">(Aug 30 2021 at 14:05)</a>:</h4>
<p>basically, without lazy tait, the <code>RETURN_PLACE</code> has type <code>GenFuture</code></p>



<a name="251234517"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251234517" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251234517">(Aug 30 2021 at 14:06)</a>:</h4>
<p>with lazy tait, it has type <code>impl Future&lt;Output = T::Return&gt;</code></p>



<a name="251234538"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251234538" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251234538">(Aug 30 2021 at 14:06)</a>:</h4>
<p>yeah; I'm thinking a bit to myself about why this is</p>



<a name="251234559"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251234559" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251234559">(Aug 30 2021 at 14:07)</a>:</h4>
<p>because lazy tait only resolves these once it gets to mir borrowck</p>



<a name="251234563"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251234563" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251234563">(Aug 30 2021 at 14:07)</a>:</h4>
<p>when MIR build runs, we have computed <em>the function's</em> view at least</p>



<a name="251234603"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251234603" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251234603">(Aug 30 2021 at 14:07)</a>:</h4>
<p>yea, we technically have this information due to typeck having run before building MIR</p>



<a name="251234615"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251234615" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251234615">(Aug 30 2021 at 14:07)</a>:</h4>
<p>well</p>



<a name="251234622"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251234622" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251234622">(Aug 30 2021 at 14:07)</a>:</h4>
<p>we have a partial view on it</p>



<a name="251234650"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251234650" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251234650">(Aug 30 2021 at 14:07)</a>:</h4>
<p>i.e., we know the constraints introduced by this function</p>



<a name="251234698"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251234698" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251234698">(Aug 30 2021 at 14:08)</a>:</h4>
<p>we also have done some type inference</p>



<a name="251234737"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251234737" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251234737">(Aug 30 2021 at 14:08)</a>:</h4>
<p>in Ye Olde Days, we would store this "interview view" of the signature separately</p>



<a name="251234762"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251234762" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251234762">(Aug 30 2021 at 14:08)</a>:</h4>
<p>right?</p>



<a name="251234787"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251234787" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251234787">(Aug 30 2021 at 14:08)</a>:</h4>
<p>i.e., in "eager TAIT" (or on master)</p>



<a name="251234823"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251234823" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251234823">(Aug 30 2021 at 14:08)</a>:</h4>
<p>yea, we had the signature from the view from within the function</p>



<a name="251234884"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251234884" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251234884">(Aug 30 2021 at 14:09)</a>:</h4>
<p>presumably we <em>could</em> apply the substitutions still</p>



<a name="251234928"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251234928" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251234928">(Aug 30 2021 at 14:09)</a>:</h4>
<p>i.e., at the end of type check, we can go and replace the "TAIT" with the type that we inferred locally</p>



<a name="251234949"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251234949" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251234949">(Aug 30 2021 at 14:09)</a>:</h4>
<p>yea</p>



<a name="251234955"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251234955" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251234955">(Aug 30 2021 at 14:09)</a>:</h4>
<p>then we still know that we will go and do a global check that all fns have defined the same type</p>



<a name="251234992"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251234992" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251234992">(Aug 30 2021 at 14:10)</a>:</h4>
<p>that is not even the issue</p>



<a name="251235050"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251235050" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251235050">(Aug 30 2021 at 14:10)</a>:</h4>
<p>let's stay within a single function for now</p>



<a name="251235058"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251235058" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251235058">(Aug 30 2021 at 14:10)</a>:</h4>
<p>I know it's not the issue here</p>



<a name="251235075"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251235075" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251235075">(Aug 30 2021 at 14:10)</a>:</h4>
<p>just trying to put the whole thing together in my head</p>



<a name="251235077"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251235077" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251235077">(Aug 30 2021 at 14:10)</a>:</h4>
<p>right</p>



<a name="251235165"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251235165" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251235165">(Aug 30 2021 at 14:11)</a>:</h4>
<p>And of course there's been this question of whether we can "defer" auto trait resolution</p>



<a name="251235181"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251235181" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251235181">(Aug 30 2021 at 14:11)</a>:</h4>
<p>which would be useful also for generators</p>



<a name="251235190"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251235190" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251235190">(Aug 30 2021 at 14:11)</a>:</h4>
<p>it interacts poorly with specialization</p>



<a name="251235207"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251235207" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251235207">(Aug 30 2021 at 14:11)</a>:</h4>
<p>so... the reason master mir borrock has all this whacky logic around opaque types is that there are no more opaque types that the current function constrains to a concrete hidden type</p>



<a name="251235245"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251235245" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251235245">(Aug 30 2021 at 14:11)</a>:</h4>
<p>and with lazy tait, a lot of it goes away</p>



<a name="251235315"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251235315" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251235315">(Aug 30 2021 at 14:12)</a>:</h4>
<p>because there is no distinction of this kind?</p>



<a name="251235329"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251235329" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251235329">(Aug 30 2021 at 14:12)</a>:</h4>
<p>I see</p>



<a name="251235351"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251235351" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251235351">(Aug 30 2021 at 14:12)</a>:</h4>
<p>well wait</p>



<a name="251235356"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251235356" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251235356">(Aug 30 2021 at 14:12)</a>:</h4>
<p>it will go away because mir borrowck will actually see the opaque types and do the "proper thing"</p>



<a name="251235380"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251235380" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251235380">(Aug 30 2021 at 14:12)</a>:</h4>
<p>there's another alternative here</p>



<a name="251235387"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251235387" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251235387">(Aug 30 2021 at 14:12)</a>:</h4>
<p>and not have to patch up the world after it's done</p>



<a name="251235407"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251235407" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251235407">(Aug 30 2021 at 14:12)</a>:</h4>
<p>but first let me repeat back to you what you are saying</p>



<a name="251235413"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251235413" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251235413">(Aug 30 2021 at 14:12)</a>:</h4>
<p>to make sure I understand it</p>



<a name="251235458"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251235458" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251235458">(Aug 30 2021 at 14:13)</a>:</h4>
<p>I think you are saying that: it was painful before because the types that MIR borrowck didn't contain the impl trait</p>



<a name="251235479"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251235479" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251235479">(Aug 30 2021 at 14:13)</a>:</h4>
<p>but rather they had the hidden type in its place</p>



<a name="251235505"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251235505" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251235505">(Aug 30 2021 at 14:13)</a>:</h4>
<p>and we had to kind of "reconstruct" which impl trait that came from etc</p>



<a name="251235543"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251235543" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251235543">(Aug 30 2021 at 14:13)</a>:</h4>
<p>and in general we had to juggle this logic, where sometimes we saw the hidden type, and sometimes we didn't</p>



<a name="251235653"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251235653" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251235653">(Aug 30 2021 at 14:14)</a>:</h4>
<p>ok, that makes sense to me, and I agree that is worth keeping</p>



<a name="251235705"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251235705" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251235705">(Aug 30 2021 at 14:14)</a>:</h4>
<blockquote>
<p>= note: ...which requires computing whether <code>impl std::future::Future</code> is freeze...</p>
</blockquote>



<a name="251235709"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251235709" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251235709">(Aug 30 2021 at 14:14)</a>:</h4>
<p>yea, and the only place we actually checked any of this was in return types, so I'm not even sure how it would interact with mentioning opaque types in local variable's types</p>



<a name="251235771"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251235771" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251235771">(Aug 30 2021 at 14:14)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/144729-wg-traits/topic/TAITs.20ahoy/near/251235705">said</a>:</p>
<blockquote>
<blockquote>
<p>= note: ...which requires computing whether <code>impl std::future::Future</code> is freeze...</p>
</blockquote>
</blockquote>
<p>we can delay this, const checking doesn't actually need to prove this immediately</p>



<a name="251235830"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251235830" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251235830">(Aug 30 2021 at 14:15)</a>:</h4>
<p>it just needs to be sure this will get proven before the code compiles</p>



<a name="251235833"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251235833" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251235833">(Aug 30 2021 at 14:15)</a>:</h4>
<p>no</p>



<a name="251235845"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251235845" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251235845">(Aug 30 2021 at 14:15)</a>:</h4>
<p>there's another option</p>



<a name="251235870"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251235870" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251235870">(Aug 30 2021 at 14:15)</a>:</h4>
<p>we could replace the hidden type <em>there</em></p>



<a name="251235922"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251235922" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251235922">(Aug 30 2021 at 14:15)</a>:</h4>
<p>can this be a problem if the lifetimes aren't known?</p>



<a name="251235949"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251235949" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251235949">(Aug 30 2021 at 14:16)</a>:</h4>
<p>that doesn't affect whether something is <code>Freeze</code></p>



<a name="251236009"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251236009" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251236009">(Aug 30 2021 at 14:16)</a>:</h4>
<p>oh because it's not user definable</p>



<a name="251236030"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251236030" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251236030">(Aug 30 2021 at 14:16)</a>:</h4>
<p>we haven't stabilized auto traits, we probably need to define some rules to that effect, we should note it on the tracking issue</p>



<a name="251236045"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251236045" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251236045">(Aug 30 2021 at 14:16)</a>:</h4>
<p>but in any case ... for now ... no :)</p>



<a name="251236077"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251236077" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251236077">(Aug 30 2021 at 14:16)</a>:</h4>
<p>there can't be <code>impl Freeze for Foo&lt;'static&gt;</code></p>



<a name="251236089"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251236089" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251236089">(Aug 30 2021 at 14:16)</a>:</h4>
<p>and I think it would be an imporatnt invariant anyway</p>



<a name="251236116"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251236116" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251236116">(Aug 30 2021 at 14:16)</a>:</h4>
<p>because of specialization</p>



<a name="251236134"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251236134" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251236134">(Aug 30 2021 at 14:17)</a>:</h4>
<p>(actually, hmm, ... )</p>



<a name="251236148"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251236148" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251236148">(Aug 30 2021 at 14:17)</a>:</h4>
<p>anyway, off topic</p>



<a name="251236155"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251236155" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251236155">(Aug 30 2021 at 14:17)</a>:</h4>
<p>I'm just thinking about specialization a bit now :)</p>



<a name="251236171"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251236171" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251236171">(Aug 30 2021 at 14:17)</a>:</h4>
<p>/me desperately wants to get back to that</p>



<a name="251236173"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251236173" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251236173">(Aug 30 2021 at 14:17)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/144729-wg-traits/topic/TAITs.20ahoy/near/251236089">said</a>:</p>
<blockquote>
<p>and I think it would be an imporatnt invariant anyway</p>
</blockquote>
<p>invariant being "all auto traits must be the same for all impls (of the same type)"?</p>



<a name="251236351"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251236351" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251236351">(Aug 30 2021 at 14:18)</a>:</h4>
<p>all auto trait impls must be <a href="https://smallcultfollowing.com/babysteps/blog/2018/02/09/maximally-minimal-specialization-always-applicable-impls/">"always applicable"</a></p>



<a name="251236360"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251236360" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251236360">(Aug 30 2021 at 14:18)</a>:</h4>
<p>or something in that vein</p>



<a name="251236423"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251236423" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251236423">(Aug 30 2021 at 14:18)</a>:</h4>
<p>it's not clear to me that we would ever stabilize the ability to add new auto traits</p>



<a name="251236440"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251236440" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251236440">(Aug 30 2021 at 14:18)</a>:</h4>
<p>they are a semver hazard</p>



<a name="251236469"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251236469" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251236469">(Aug 30 2021 at 14:18)</a>:</h4>
<p>they might just be an "implementation mechanism" for special traits</p>



<a name="251236540"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251236540" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251236540">(Aug 30 2021 at 14:19)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">unsafe</span><span class="w"> </span><span class="k">impl</span><span class="w"> </span><span class="nb">Send</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Foo</span><span class="o">&lt;'</span><span class="nb">static</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="k">struct</span> <span class="nc">Foo</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;'</span><span class="na">a</span><span class="w"> </span><span class="kt">i32</span><span class="p">);</span><span class="w"></span>
</code></pre></div>
<p>this works on stable today, but... we are way off topic and it's probably not relevant here</p>



<a name="251236543"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251236543" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251236543">(Aug 30 2021 at 14:19)</a>:</h4>
<p>regardless, I think I favor at the moment substituting the hidden type here</p>



<a name="251236570"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251236570" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251236570">(Aug 30 2021 at 14:19)</a>:</h4>
<p>hmm</p>



<a name="251236578"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251236578" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251236578">(Aug 30 2021 at 14:19)</a>:</h4>
<p>yes, off topic :)</p>



<a name="251236584"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251236584" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251236584">(Aug 30 2021 at 14:19)</a>:</h4>
<p><span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span> <span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> I guess we need to put the hidden type back into <code>TypeckResult</code></p>



<a name="251236668"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251236668" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251236668">(Aug 30 2021 at 14:20)</a>:</h4>
<p>Well, <span class="user-mention" data-user-id="124288">@oli</span></p>



<a name="251236691"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251236691" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251236691">(Aug 30 2021 at 14:20)</a>:</h4>
<p>I guess we could also separate this part of const checking and have it run post borrow check?</p>



<a name="251236707"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251236707" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251236707">(Aug 30 2021 at 14:20)</a>:</h4>
<p>(or maybe run <em>all</em> of const checking post borrow check?)</p>



<a name="251236723"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251236723" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251236723">(Aug 30 2021 at 14:20)</a>:</h4>
<p>that was my original suggestion</p>



<a name="251236728"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251236728" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251236728">(Aug 30 2021 at 14:20)</a>:</h4>
<p>oh, sorry</p>



<a name="251236763"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251236763" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251236763">(Aug 30 2021 at 14:20)</a>:</h4>
<p>I am nervous about deferring auto trait solving <em>in general</em></p>



<a name="251236773"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251236773" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251236773">(Aug 30 2021 at 14:20)</a>:</h4>
<p>although I think it would be a cool thing</p>



<a name="251236780"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251236780" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251236780">(Aug 30 2021 at 14:20)</a>:</h4>
<p>can't run all of it afterwards, we need it for promotion, which <em>must</em> run before borrowck</p>



<a name="251236790"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251236790" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251236790">(Aug 30 2021 at 14:21)</a>:</h4>
<p>ah, yes</p>



<a name="251236812"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251236812" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251236812">(Aug 30 2021 at 14:21)</a>:</h4>
<p>but this particular check is "just" a safety check</p>



<a name="251236866"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251236866" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251236866">(Aug 30 2021 at 14:21)</a>:</h4>
<p>I'm ok with either approach. The key thing is that this is kind of a narrow problem.</p>



<a name="251236882"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251236882" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251236882">(Aug 30 2021 at 14:21)</a>:</h4>
<p>Not something that we expect to hit us generally</p>



<a name="251236908"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251236908" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251236908">(Aug 30 2021 at 14:22)</a>:</h4>
<p>(Right?)</p>



<a name="251236939"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251236939" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251236939">(Aug 30 2021 at 14:22)</a>:</h4>
<p>Now i'm wondering. :)</p>



<a name="251236947"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251236947" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251236947">(Aug 30 2021 at 14:22)</a>:</h4>
<p>I... hope so</p>



<a name="251236977"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251236977" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251236977">(Aug 30 2021 at 14:22)</a>:</h4>
<p>If it did, I thnk the approach I was suggesting can probably be extended</p>



<a name="251236978"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251236978" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251236978">(Aug 30 2021 at 14:22)</a>:</h4>
<p>Send and Sync cycles with async/futures are... weird</p>



<a name="251237019"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251237019" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251237019">(Aug 30 2021 at 14:22)</a>:</h4>
<p>yeah, the logic is all a bit tortured</p>



<a name="251237211"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251237211" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251237211">(Aug 30 2021 at 14:23)</a>:</h4>
<p>I wonder how much of it is covered in the rustc-dev-guide</p>



<a name="251237269"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251237269" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251237269">(Aug 30 2021 at 14:24)</a>:</h4>
<p>I'd like to go write up a little diagram, beacuse I have a hard time remembering how the queries etc interact</p>



<a name="251237328"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251237328" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251237328">(Aug 30 2021 at 14:24)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/144729-wg-traits/topic/TAITs.20ahoy/near/251236977">said</a>:</p>
<blockquote>
<p>If it did, I thnk the approach I was suggesting can probably be extended</p>
</blockquote>
<p>in other words: if we find this arising more often, we can probably patch the various spots in between type check and borrow check so that they substitute the hidden types</p>



<a name="251237336"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251237336" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251237336">(Aug 30 2021 at 14:24)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/144729-wg-traits/topic/TAITs.20ahoy/near/251237269">said</a>:</p>
<blockquote>
<p>I'd like to go write up a little diagram, beacuse I have a hard time remembering how the queries etc interact</p>
</blockquote>
<p>I wish we just generated this automatically on every commit</p>



<a name="251237460"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251237460" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251237460">(Aug 30 2021 at 14:25)</a>:</h4>
<p>yea, I was mainly amused with this one, not worried it was hard to fix, but let's see what else comes up in libcore <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="251237694"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251237694" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251237694">(Aug 30 2021 at 14:27)</a>:</h4>
<p>yeah those things would be great to have</p>



<a name="251237710"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251237710" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251237710">(Aug 30 2021 at 14:27)</a>:</h4>
<p>to be honest I'm not really sure how much is covered in rustc dev guide</p>



<a name="251237809"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251237809" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251237809">(Aug 30 2021 at 14:28)</a>:</h4>
<p>I'm re-reading certain parts and there are parts that I've never read so I will read them, hope I have a more clear picture about the guide soon :)</p>



<a name="251238039"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251238039" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251238039">(Aug 30 2021 at 14:29)</a>:</h4>
<p>so what else is on the agenda for today</p>



<a name="251238066"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251238066" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251238066">(Aug 30 2021 at 14:29)</a>:</h4>
<p>I created this repository <a href="https://github.com/rust-lang/impl-trait-initiative">https://github.com/rust-lang/impl-trait-initiative</a></p>



<a name="251238071"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251238071" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251238071">(Aug 30 2021 at 14:29)</a>:</h4>
<p>new stuff for santiago to do</p>



<a name="251238076"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251238076" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251238076">(Aug 30 2021 at 14:29)</a>:</h4>
<p>I plan to start writing stuff into it</p>



<a name="251238088"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251238088" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251238088">(Aug 30 2021 at 14:29)</a>:</h4>
<p>but we should maybe make a project baord to help us track the overall plan</p>



<a name="251238222"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251238222" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251238222">(Aug 30 2021 at 14:30)</a>:</h4>
<p>yeah 2 things</p>



<a name="251238246"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251238246" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251238246">(Aug 30 2021 at 14:30)</a>:</h4>
<p><a href="https://github.com/rust-lang/impl-trait-initiative/projects/2?add_cards_query=is%3Aopen">https://github.com/rust-lang/impl-trait-initiative/projects/2?add_cards_query=is%3Aopen</a></p>



<a name="251238254"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251238254" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251238254">(Aug 30 2021 at 14:30)</a>:</h4>
<p>I've completed the tests, please check that out and we should probably close the issue</p>



<a name="251238293"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251238293" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251238293">(Aug 30 2021 at 14:31)</a>:</h4>
<p>what's the PR?</p>



<a name="251238313"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251238313" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251238313">(Aug 30 2021 at 14:31)</a>:</h4>
<p>I guess I'll see it as I go through my notifications</p>



<a name="251238317"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251238317" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251238317">(Aug 30 2021 at 14:31)</a>:</h4>
<p>and the other thing as <span class="user-mention" data-user-id="124288">@oli</span> have said is ... what else could I do?</p>



<a name="251238343"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251238343" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251238343">(Aug 30 2021 at 14:31)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/144729-wg-traits/topic/TAITs.20ahoy/near/251238293">said</a>:</p>
<blockquote>
<p>what's the PR?</p>
</blockquote>
<p>there were like 20 PRs</p>



<a name="251238393"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251238393" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251238393">(Aug 30 2021 at 14:31)</a>:</h4>
<p>lol ok</p>



<a name="251238396"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251238396" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251238396">(Aug 30 2021 at 14:31)</a>:</h4>
<p>start from here <a href="https://github.com/rust-lang/rust/issues/86727">#86727</a></p>



<a name="251238404"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251238404" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251238404">(Aug 30 2021 at 14:31)</a>:</h4>
<p>so what should I check out</p>



<a name="251238420"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251238420" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251238420">(Aug 30 2021 at 14:31)</a>:</h4>
<p>and everything is linked</p>



<a name="251238473"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251238473" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251238473">(Aug 30 2021 at 14:32)</a>:</h4>
<p>but I guess the most reasonable thing to do is to check <a href="https://hackmd.io/y1HwFSBUQS2ZKrSFuQ0Dnw?view">https://hackmd.io/y1HwFSBUQS2ZKrSFuQ0Dnw?view</a></p>



<a name="251238522"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251238522" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251238522">(Aug 30 2021 at 14:32)</a>:</h4>
<p>see what are we covering, see if we need to cover more or if we can just say that this is finished</p>



<a name="251238537"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251238537" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251238537">(Aug 30 2021 at 14:32)</a>:</h4>
<p>that's super awesome</p>



<a name="251238571"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251238571" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251238571">(Aug 30 2021 at 14:32)</a>:</h4>
<p>but yeah, I don't have other tasks to do</p>



<a name="251238615"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251238615" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251238615">(Aug 30 2021 at 14:33)</a>:</h4>
<p>I guess I could check <a href="https://github.com/rust-lang/rust/issues/83190">#83190</a></p>



<a name="251238673"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251238673" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251238673">(Aug 30 2021 at 14:33)</a>:</h4>
<p>unsure if you <span class="user-mention" data-user-id="124288">@oli</span> have checked it out or what's the status</p>



<a name="251238704"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251238704" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251238704">(Aug 30 2021 at 14:33)</a>:</h4>
<p>because it's also a <code>P-high</code> beta regression</p>



<a name="251238800"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251238800" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251238800">(Aug 30 2021 at 14:34)</a>:</h4>
<p>that should be fixed</p>



<a name="251238826"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251238826" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251238826">(Aug 30 2021 at 14:34)</a>:</h4>
<p>check if it works on beta and close the issue if it does</p>



<a name="251238829"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251238829" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251238829">(Aug 30 2021 at 14:34)</a>:</h4>
<p>on master, or on your branch?</p>



<a name="251238854"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251238854" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251238854">(Aug 30 2021 at 14:35)</a>:</h4>
<p>my PR that fixed it on master was backported</p>



<a name="251238863"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251238863" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251238863">(Aug 30 2021 at 14:35)</a>:</h4>
<p>to beta</p>



<a name="251238883"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251238883" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251238883">(Aug 30 2021 at 14:35)</a>:</h4>
<p>but we never checked if the issue is actually fixed</p>



<a name="251238885"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251238885" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251238885">(Aug 30 2021 at 14:35)</a>:</h4>
<p>ohh I see</p>



<a name="251239054"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251239054" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251239054">(Aug 30 2021 at 14:36)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/144729-wg-traits/topic/TAITs.20ahoy/near/251238829">said</a>:</p>
<blockquote>
<p>on master, or on your branch?</p>
</blockquote>
<p>master and beta, haven't run my branch on all ui tests yet... libcore is failing after all ^^</p>



<a name="251239079"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251239079" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251239079">(Aug 30 2021 at 14:36)</a>:</h4>
<p>well, that would be convenient</p>



<a name="251239127"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251239127" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251239127">(Aug 30 2021 at 14:37)</a>:</h4>
<p>(if it were indeed already fixed)</p>



<a name="251239457"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251239457" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251239457">(Aug 30 2021 at 14:39)</a>:</h4>
<p>so apart from that--- <span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> I guess we are still kind of blocked on oli, I am wondering about "redploying" you temporarily to a few other potential "areas"</p>



<a name="251239473"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251239473" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251239473">(Aug 30 2021 at 14:39)</a>:</h4>
<p>e.g. I was thining about having somebody work a bit on async fn sugar :)</p>



<a name="251239508"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251239508" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251239508">(Aug 30 2021 at 14:39)</a>:</h4>
<p>async fn in traits, specifically</p>



<a name="251241695"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251241695" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251241695">(Aug 30 2021 at 14:54)</a>:</h4>
<p>(bbiab)</p>



<a name="251264681"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251264681" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251264681">(Aug 30 2021 at 17:34)</a>:</h4>
<p>I actually found a better way than heavily modifying how const checking works... if there are opaque types involved, just don't try to take the short circuit that checks marker traits but take the long route by running the actual analysis that would run if the marker trait were not implemented</p>



<a name="251265342"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251265342" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251265342">(Aug 30 2021 at 17:39)</a>:</h4>
<p>aaaand we are a go for libcore</p>



<a name="251265361"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251265361" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251265361">(Aug 30 2021 at 17:39)</a>:</h4>
<p>next boss: liballoc</p>



<a name="251265942"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251265942" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251265942">(Aug 30 2021 at 17:43)</a>:</h4>
<div class="codehilite"><pre><span></span><code>error[E0161]: cannot move a value of type impl Iterator: the size of impl Iterator cannot be statically determined
  --&gt; library/alloc/src/collections/vec_deque/pair_slices.rs:41:9
   |
41 |         IntoIterator::into_iter([self.b0, self.b1])
   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
</code></pre></div>



<a name="251267256"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251267256" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251267256">(Aug 30 2021 at 17:53)</a>:</h4>
<p><span aria-label="rofl" class="emoji emoji-1f923" role="img" title="rofl">:rofl:</span> </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#![feature(lazy_impl_trait)]</span><span class="w"></span>
<span class="cp">#![feature(unsized_fn_params)]</span><span class="w"></span>
</code></pre></div>
<p>an unholy combination</p>



<a name="251267292"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251267292" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251267292">(Aug 30 2021 at 17:53)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">struct</span> <span class="nc">PairSlices</span><span class="o">&lt;'</span><span class="na">a</span><span class="p">,</span><span class="w"> </span><span class="o">'</span><span class="na">b</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">pub</span><span class="p">(</span><span class="k">crate</span><span class="p">)</span><span class="w"> </span><span class="n">a0</span>: <span class="kp">&amp;</span><span class="o">'</span><span class="na">a</span> <span class="nc">mut</span><span class="w"> </span><span class="p">[</span><span class="n">T</span><span class="p">],</span><span class="w"></span>
<span class="w">    </span><span class="k">pub</span><span class="p">(</span><span class="k">crate</span><span class="p">)</span><span class="w"> </span><span class="n">a1</span>: <span class="kp">&amp;</span><span class="o">'</span><span class="na">a</span> <span class="nc">mut</span><span class="w"> </span><span class="p">[</span><span class="n">T</span><span class="p">],</span><span class="w"></span>
<span class="w">    </span><span class="k">pub</span><span class="p">(</span><span class="k">crate</span><span class="p">)</span><span class="w"> </span><span class="n">b0</span>: <span class="kp">&amp;</span><span class="o">'</span><span class="na">b</span> <span class="p">[</span><span class="n">T</span><span class="p">],</span><span class="w"></span>
<span class="w">    </span><span class="k">pub</span><span class="p">(</span><span class="k">crate</span><span class="p">)</span><span class="w"> </span><span class="n">b1</span>: <span class="kp">&amp;</span><span class="o">'</span><span class="na">b</span> <span class="p">[</span><span class="n">T</span><span class="p">],</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">impl</span><span class="o">&lt;'</span><span class="na">a</span><span class="p">,</span><span class="w"> </span><span class="o">'</span><span class="na">b</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">PairSlices</span><span class="o">&lt;'</span><span class="na">a</span><span class="p">,</span><span class="w"> </span><span class="o">'</span><span class="na">b</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">remainder</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">impl</span><span class="w"> </span><span class="nb">Iterator</span><span class="o">&lt;</span><span class="n">Item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;'</span><span class="na">b</span><span class="w"> </span><span class="p">[</span><span class="n">T</span><span class="p">]</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nb">IntoIterator</span>::<span class="n">into_iter</span><span class="p">([</span><span class="bp">self</span><span class="p">.</span><span class="n">b0</span><span class="p">,</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">b1</span><span class="p">])</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="251267766"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251267766" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251267766">(Aug 30 2021 at 17:57)</a>:</h4>
<p>out of some reason, with <code>unsized_fn_params</code> this will fail to figure out that <code>&lt;[&amp;'b [T]; 2] as IntoIterator&gt;::IntoIter: Sized</code></p>



<a name="251267945"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251267945" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251267945">(Aug 30 2021 at 17:58)</a>:</h4>
<p>I mean... technically <code>self</code> could be unsized, and that can only be if the last field is unsized, so <code>&amp;'b [T]</code> could be unsized, and probably somewhere with lazy tait we can't figure this out anymore...</p>



<a name="251267966"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251267966" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251267966">(Aug 30 2021 at 17:58)</a>:</h4>
<p>will look at this tomorrow</p>



<a name="251382076"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251382076" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251382076">(Aug 31 2021 at 13:14)</a>:</h4>
<p><span class="user-mention silent" data-user-id="124288">oli</span> <a href="#narrow/stream/144729-wg-traits/topic/TAITs.20ahoy/near/251267966">said</a>:</p>
<blockquote>
<p>will look at this tomorrow</p>
</blockquote>
<p>that was easy.. just needed a carefully placed <code>resolve_vars_if_possible</code> so we can see the hidden type</p>



<a name="251382135"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251382135" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251382135">(Aug 31 2021 at 13:14)</a>:</h4>
<p>which... reminds me.. we should change the variable names and fields names in opaque type stuff from the confusing <code>concrete_ty</code> to <code>hidden_ty</code></p>



<a name="251414494"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251414494" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251414494">(Aug 31 2021 at 16:28)</a>:</h4>
<p>yes</p>



<a name="251414509"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251414509" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251414509">(Aug 31 2021 at 16:28)</a>:</h4>
<p><span class="user-mention" data-user-id="124288">@oli</span> when you said that TAIT replaced <code>typeof</code>, can you elaborate?</p>



<a name="251414549"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251414549" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251414549">(Aug 31 2021 at 16:29)</a>:</h4>
<p>was it basically that you can do </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">type</span> <span class="nc">Foo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">impl</span><span class="w"> </span><span class="n">Debug</span><span class="p">;</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">x</span>: <span class="nc">Foo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"></span>
</code></pre></div>
<p>and then talk about <code>Foo</code>?</p>



<a name="251414853"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251414853" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251414853">(Aug 31 2021 at 16:30)</a>:</h4>
<p>yea, basically that. A full example has been written in <a href="https://github.com/rust-lang/rust/issues/88531#issuecomment-909282314">https://github.com/rust-lang/rust/issues/88531#issuecomment-909282314</a></p>



<a name="251420259"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251420259" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Giacomo Stevanato <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251420259">(Aug 31 2021 at 17:07)</a>:</h4>
<p>Local bindings doesn't seem to count as defining use right now though, so I had to use a closure like <code>|| -&gt; Foo { x }</code></p>



<a name="251423492"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251423492" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251423492">(Aug 31 2021 at 17:29)</a>:</h4>
<p>yea, but they will work as defining uses soonish</p>



<a name="251490622"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251490622" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251490622">(Sep 01 2021 at 02:30)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/144729-wg-traits/topic/TAITs.20ahoy/near/251239508">said</a>:</p>
<blockquote>
<p>async fn in traits, specifically</p>
</blockquote>
<p>Wouldn't that need an RFC first?</p>



<a name="251551034"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251551034" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251551034">(Sep 01 2021 at 12:44)</a>:</h4>
<p>No, it does need a proposal before we land code.</p>



<a name="251551066"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251551066" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251551066">(Sep 01 2021 at 12:44)</a>:</h4>
<p>(That's underway)</p>



<a name="251551075"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251551075" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251551075">(Sep 01 2021 at 12:45)</a>:</h4>
<p>Some unknowns, but some things are clear enough</p>



<a name="251572066"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251572066" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251572066">(Sep 01 2021 at 14:49)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/144729-wg-traits/topic/TAITs.20ahoy/near/251551066">said</a>:</p>
<blockquote>
<p>(That's underway)</p>
</blockquote>
<p>The code is underway, or the proposal is?</p>



<a name="251575394"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251575394" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251575394">(Sep 01 2021 at 15:06)</a>:</h4>
<p>The proposal; you can see <a href="https://rust-lang.github.io/wg-async-foundations/vision/roadmap.html">https://rust-lang.github.io/wg-async-foundations/vision/roadmap.html</a> for more details</p>



<a name="251576836"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251576836" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251576836">(Sep 01 2021 at 15:15)</a>:</h4>
<p>Ah right, okay</p>



<a name="251576857"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251576857" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251576857">(Sep 01 2021 at 15:15)</a>:</h4>
<p>So the first goal is allowing <code>trait Foo { fn bar() -&gt; impl Trait; }</code>?</p>



<a name="251577297"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251577297" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251577297">(Sep 01 2021 at 15:18)</a>:</h4>
<p>Or is the first goal allowing <code>trait Foo { async fn bar() -&gt; usize; }</code>, and later extending that to any <code>impl Trait</code>.</p>



<a name="251626559"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251626559" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251626559">(Sep 01 2021 at 20:46)</a>:</h4>
<p>I would be interested in working on this, but it's probably well above my knowledge of rustc :)</p>



<a name="251870555"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251870555" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251870555">(Sep 03 2021 at 12:16)</a>:</h4>
<p><del>So... I found a problem with the "treat opaque types as inference vars in many situations" approach: if we are trying to prove that some type is Sized (or anything else really, but I have an example for Sized), we always return an ambiguity "error" (it's just a marker, not a real error, as it may get resolved elsewhere). For inference vars this is fine, as afaict we never <span aria-label="tm" class="emoji emoji-2122" role="img" title="tm">:tm:</span> (rustdoc does this, there may be good uses for it?) have parameter environments that contain e.g. <code>_$some_inf_var: Sized</code> bounds. Now... we "suddenly" are doing this for opaque types, too, even though (in contrast to inference vars) we know a bunch of things about opaque types, so we can try to prove things about them. This gets us into the fun situation where we cache said inference failure...</del></p>
<p>aaand I just answered my own question: Don't cache opaque types in the global cache if we treat that opaque type inference-var-like</p>



<a name="251886051"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251886051" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251886051">(Sep 03 2021 at 14:09)</a>:</h4>
<p>Hmm... looks like wf-checking used to be redoing type inference from scratch. I made it not do that for opaque types (by fetching the hidden type via the type_of query), but this seems like a general thing that we may want to have a look at. Seems wasteful to do type inference three times, when we could do it just twice, or potentially just 1.3 times depending on how much of it we can do in mir borrowck's typeck instead of the HIR typeck</p>



<a name="251886362"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251886362" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251886362">(Sep 03 2021 at 14:11)</a>:</h4>
<p>And we have a working libcore + libstd</p>



<a name="251886408"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251886408" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251886408">(Sep 03 2021 at 14:11)</a>:</h4>
<p>perfect timing, I'm going on vacation in 2h <span aria-label="grinning" class="emoji emoji-1f600" role="img" title="grinning">:grinning:</span></p>



<a name="251886729"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251886729" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251886729">(Sep 03 2021 at 14:13)</a>:</h4>
<p><span class="user-mention silent" data-user-id="124288">oli</span> <a href="#narrow/stream/144729-wg-traits/topic/TAITs.20ahoy/near/251886051">said</a>:</p>
<blockquote>
<p>Hmm... looks like wf-checking used to be redoing type inference from scratch. I made it not do that for opaque types (by fetching the hidden type via the type_of query), but this seems like a general thing that we may want to have a look at. Seems wasteful to do type inference three times, when we could do it just twice, or potentially just 1.3 times depending on how much of it we can do in mir borrowck's typeck instead of the HIR typeck</p>
</blockquote>
<p>nevermind, looks like generators don't like it if you ask their type with typeof, even if you do it as late as wf-checking</p>



<a name="251887317"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251887317" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251887317">(Sep 03 2021 at 14:16)</a>:</h4>
<p>oh lol</p>



<a name="251887320"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251887320" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251887320">(Sep 03 2021 at 14:16)</a>:</h4>
<p>uh</p>



<a name="251887353"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251887353" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251887353">(Sep 03 2021 at 14:16)</a>:</h4>
<p>this is due to mir validation being run on mir-opt tests</p>



<a name="251887369"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251887369" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251887369">(Sep 03 2021 at 14:17)</a>:</h4>
<p>and mir validation reveal-all's all types</p>



<a name="251887572"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251887572" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251887572">(Sep 03 2021 at 14:18)</a>:</h4>
<blockquote>
<p>test result: FAILED. 11709 passed; 376 failed; 97 ignored; 0 measured; 0 filtered out; finished in 28.77s</p>
</blockquote>



<a name="251888071"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251888071" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251888071">(Sep 03 2021 at 14:21)</a>:</h4>
<div class="codehilite"><pre><span></span><code>error[E0282]: type annotations needed
  --&gt; /home/ubuntu/rust/src/test/ui/type-alias-impl-trait/type-alias-impl-trait.rs:9:22
   |
LL |     assert_eq!(foo().to_string(), &quot;foo&quot;);
   |                      ^^^^^^^^^ cannot infer type
   |
   = note: type must be known at this point

error[E0599]: no method named `to_string` found for opaque type `impl std::fmt::Display` in the current scope
  --&gt; /home/ubuntu/rust/src/test/ui/type-alias-impl-trait/type-alias-impl-trait.rs:9:22
   |
LL |     assert_eq!(foo().to_string(), &quot;foo&quot;);
   |                      ^^^^^^^^^ method not found in `impl std::fmt::Display`
   |
   = note: `foo()` is a function, perhaps you wish to call it
</code></pre></div>
<p>ok this was expected. We end up with unconstrained opaque types within a defining use scope. If this op is done outside of the defining use, then it works.</p>



<a name="251906227"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/251906227" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#251906227">(Sep 03 2021 at 16:21)</a>:</h4>
<p>I pushed my current status to <a href="https://github.com/oli-obk/rust/tree/lazy_tait2">https://github.com/oli-obk/rust/tree/lazy_tait2</a> (note that the second to last commit doesn't compile, it contains notes on where to continue in plain text in the code). Things that need doing:</p>
<ul>
<li>adjust tests (often duplicating them, recording the current errors in one version and adjusting the other version to move the TAITs into a submodule so the defining use scopes work out)</li>
<li>Fix ICEs by adding some appropriate delay_span_bug with fallback</li>
<li>Fix async stuff by implementing what the second to last commit states (add infer <code>Future</code> type from obligations on the opaque type, which now isn't an inference var anymore).</li>
<li>Triage the other issues</li>
</ul>



<a name="253083019"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253083019" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253083019">(Sep 13 2021 at 12:46)</a>:</h4>
<p><span class="user-mention" data-user-id="124288">@oli</span> are you around today?</p>



<a name="253083031"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253083031" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253083031">(Sep 13 2021 at 12:46)</a>:</h4>
<p>If so, can we meet on Zulip</p>



<a name="253084682"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253084682" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253084682">(Sep 13 2021 at 12:59)</a>:</h4>
<p>I am, zulip sounds good</p>



<a name="253094087"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253094087" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253094087">(Sep 13 2021 at 14:01)</a>:</h4>
<p>Ok, so update to the above: I fixed 170 of the 370 failing tests (they were all async fn/block tests). They were failing because there was some code still assuming that opaque types are eagerly converted to inference vars. That code was searching the entire obligation space for obligations on the inferctxt to find one that was a <code>&lt;_ as Future&gt;::Output</code>. This is now much simpler, since we just grab the trait bounds on the opaque type and go through these</p>



<a name="253094217"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253094217" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253094217">(Sep 13 2021 at 14:01)</a>:</h4>
<p>ok, I'm here</p>



<a name="253094344"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253094344" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253094344">(Sep 13 2021 at 14:02)</a>:</h4>
<p>Hey <span class="user-mention" data-user-id="124288">@oli</span></p>



<a name="253094426"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253094426" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253094426">(Sep 13 2021 at 14:02)</a>:</h4>
<p>(cc <span class="user-mention" data-user-id="116266">@Santiago Pastorino</span>)</p>



<a name="253094433"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253094433" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253094433">(Sep 13 2021 at 14:02)</a>:</h4>
<p>The thing I am tackling right now is that associated tait stopped working. Same issue: type_of on associated types was just grabbing the type from the ast and converting that to a Ty, which just gave us an opaque type again. We could fix this by adding an <code>ImplItemKind::TyOpaque</code>, or by simply detecting that we got an opaque type and trying to resolve it</p>



<a name="253094445"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253094445" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253094445">(Sep 13 2021 at 14:02)</a>:</h4>
<p><span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span></p>



<a name="253094546"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253094546" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253094546">(Sep 13 2021 at 14:03)</a>:</h4>
<p>/me reads</p>



<a name="253094622"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253094622" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253094622">(Sep 13 2021 at 14:03)</a>:</h4>
<p>the two text blocks sum up what I did today, everything is proceeding well, I skimmed the failing tests, but haven't triaged them yet, am mostly playing whack-a-mole while they are obvious</p>



<a name="253094886"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253094886" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253094886">(Sep 13 2021 at 14:05)</a>:</h4>
<p>ok, it took me like 3 tries to read that sentence</p>



<a name="253094903"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253094903" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253094903">(Sep 13 2021 at 14:05)</a>:</h4>
<p>uh</p>



<a name="253094914"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253094914" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253094914">(Sep 13 2021 at 14:05)</a>:</h4>
<p>which one? D</p>



<a name="253094919"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253094919" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253094919">(Sep 13 2021 at 14:05)</a>:</h4>
<p><span class="user-mention silent" data-user-id="124288">oli</span> <a href="#narrow/stream/144729-wg-traits/topic/TAITs.20ahoy/near/253094433">said</a>:</p>
<blockquote>
<p>The thing I am tackling right now is that associated tait stopped working. Same issue: type_of on associated types was just grabbing the type from the ast and converting that to a Ty, which just gave us an opaque type again. We could fix this by adding an <code>ImplItemKind::TyOpaque</code>, or by simply detecting that we got an opaque type and trying to resolve it</p>
</blockquote>
<p>this one :)</p>



<a name="253094928"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253094928" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253094928">(Sep 13 2021 at 14:05)</a>:</h4>
<p>but I read it now :)</p>



<a name="253094930"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253094930" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253094930">(Sep 13 2021 at 14:05)</a>:</h4>
<p>ah</p>



<a name="253094979"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253094979" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253094979">(Sep 13 2021 at 14:05)</a>:</h4>
<p>That said, I don't quite know how <code>ImplItemKind::TyOpaque</code> would help or what what would mean exactly</p>



<a name="253095088"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253095088" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253095088">(Sep 13 2021 at 14:06)</a>:</h4>
<p><span class="user-mention silent" data-user-id="124288">oli</span> <a href="#narrow/stream/144729-wg-traits/topic/TAITs.20ahoy/near/253094087">said</a>:</p>
<blockquote>
<p>Ok, so update to the above: I fixed 170 of the 370 failing tests (they were all async fn/block tests). They were failing because there was some code still assuming that opaque types are eagerly converted to inference vars. That code was searching the entire obligation space for obligations on the inferctxt to find one that was a <code>&lt;_ as Future&gt;::Output</code>. This is now much simpler, since we just grab the trait bounds on the opaque type and go through these</p>
</blockquote>
<p>this sounds very good</p>



<a name="253095130"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253095130" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253095130">(Sep 13 2021 at 14:06)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/144729-wg-traits/topic/TAITs.20ahoy/near/253094979">said</a>:</p>
<blockquote>
<p>That said, I don't quite know how <code>ImplItemKind::TyOpaque</code> would help or what what would mean exactly</p>
</blockquote>
<p>I guess you mean that if we had <code>type Foo = impl Bar</code> we would add such an item?</p>



<a name="253095180"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253095180" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253095180">(Sep 13 2021 at 14:06)</a>:</h4>
<p>yea, just like with free taits</p>



<a name="253095205"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253095205" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253095205">(Sep 13 2021 at 14:07)</a>:</h4>
<p>(where we do have a separate variant)</p>



<a name="253095224"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253095224" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253095224">(Sep 13 2021 at 14:07)</a>:</h4>
<p>but... I am still investigating</p>



<a name="253095256"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253095256" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253095256">(Sep 13 2021 at 14:07)</a>:</h4>
<p>the thing is</p>



<a name="253095272"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253095272" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253095272">(Sep 13 2021 at 14:07)</a>:</h4>
<p>it is different from other impl items</p>



<a name="253095284"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253095284" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253095284">(Sep 13 2021 at 14:07)</a>:</h4>
<p>it doesn't correspond to something in the trait</p>



<a name="253095300"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253095300" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253095300">(Sep 13 2021 at 14:07)</a>:</h4>
<p>yea</p>



<a name="253095307"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253095307" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253095307">(Sep 13 2021 at 14:07)</a>:</h4>
<p>and there could be like <code>type Foo = (impl Bar, impl Baz)</code></p>



<a name="253095358"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253095358" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253095358">(Sep 13 2021 at 14:08)</a>:</h4>
<p>I always imagined it would be more like the opaque types we attach to functions</p>



<a name="253095459"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253095459" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253095459">(Sep 13 2021 at 14:08)</a>:</h4>
<p>I guess that's...maybe the point, that functions "have" nested items, but impls normally don't?</p>



<a name="253095514"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253095514" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253095514">(Sep 13 2021 at 14:08)</a>:</h4>
<p>kind of yea, but since everything was working before, this can't really be an issue</p>



<a name="253095645"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253095645" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253095645">(Sep 13 2021 at 14:09)</a>:</h4>
<p>It is probably just that I haven't fully understood the failing tests yet</p>



<a name="253095734"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253095734" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253095734">(Sep 13 2021 at 14:10)</a>:</h4>
<p>ok</p>



<a name="253095748"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253095748" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253095748">(Sep 13 2021 at 14:10)</a>:</h4>
<p>are you blocked on anything I can help with at this point?</p>



<a name="253095789"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253095789" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253095789">(Sep 13 2021 at 14:10)</a>:</h4>
<p>Nope, this is the fun part. whack-a-mole <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="253095830"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253095830" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253095830">(Sep 13 2021 at 14:10)</a>:</h4>
<p>with simple tests, too <span aria-label="grinning" class="emoji emoji-1f600" role="img" title="grinning">:grinning:</span></p>



<a name="253095887"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253095887" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253095887">(Sep 13 2021 at 14:11)</a>:</h4>
<p>So, santiago opened all those PRs that cover the tests</p>



<a name="253095895"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253095895" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253095895">(Sep 13 2021 at 14:11)</a>:</h4>
<p>you're fixing up the implementation</p>



<a name="253095906"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253095906" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253095906">(Sep 13 2021 at 14:11)</a>:</h4>
<p>jup</p>



<a name="253095912"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253095912" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253095912">(Sep 13 2021 at 14:11)</a>:</h4>
<p>I don't think we have any design questions left at this point</p>



<a name="253095957"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253095957" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253095957">(Sep 13 2021 at 14:11)</a>:</h4>
<p>I think I will just kepe working today a bit on the explainer for <a href="https://rust-lang.github.io/impl-trait-initiative/">https://rust-lang.github.io/impl-trait-initiative/</a></p>



<a name="253095977"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253095977" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253095977">(Sep 13 2021 at 14:11)</a>:</h4>
<p>I am duplicating some tests, because now we have the situation where we don't allow mixing non-defining uses in the defining scope</p>



<a name="253095983"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253095983" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253095983">(Sep 13 2021 at 14:11)</a>:</h4>
<p>I'm trying to lay out the whole scheme in one place</p>



<a name="253096000"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253096000" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253096000">(Sep 13 2021 at 14:11)</a>:</h4>
<p><span class="user-mention silent" data-user-id="124288">oli</span> <a href="#narrow/stream/144729-wg-traits/topic/TAITs.20ahoy/near/253095977">said</a>:</p>
<blockquote>
<p>I am duplicating some tests, because now we have the situation where we don't allow mixing non-defining uses in the defining scope</p>
</blockquote>
<p>example?</p>



<a name="253096071"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253096071" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253096071">(Sep 13 2021 at 14:12)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">mod</span> <span class="nn">defining_scope</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">Foo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">impl</span><span class="w"> </span><span class="n">Debug</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">unit</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">Foo</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="k">use</span><span class="w"> </span><span class="n">defining_scope</span>::<span class="o">*</span><span class="p">;</span><span class="w"></span>

<span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">ice</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{:?}"</span><span class="p">,</span><span class="w"> </span><span class="n">unit</span><span class="p">())</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
</code></pre></div>



<a name="253096080"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253096080" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253096080">(Sep 13 2021 at 14:12)</a>:</h4>
<p>is a duplicated one</p>



<a name="253096093"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253096093" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253096093">(Sep 13 2021 at 14:12)</a>:</h4>
<p>the original one has no module</p>



<a name="253096169"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253096169" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253096169">(Sep 13 2021 at 14:12)</a>:</h4>
<p>dear god</p>



<a name="253096183"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253096183" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253096183">(Sep 13 2021 at 14:12)</a>:</h4>
<p>this one is a bit over the top</p>



<a name="253096185"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253096185" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253096185">(Sep 13 2021 at 14:12)</a>:</h4>
<p>what am I looking at</p>



<a name="253096205"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253096205" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253096205">(Sep 13 2021 at 14:13)</a>:</h4>
<p>ok, I think I see</p>



<a name="253096208"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253096208" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253096208">(Sep 13 2021 at 14:13)</a>:</h4>
<p>let me give you a simpler one <span aria-label="grinning" class="emoji emoji-1f600" role="img" title="grinning">:grinning:</span></p>



<a name="253096283"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253096283" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253096283">(Sep 13 2021 at 14:13)</a>:</h4>
<p>actually i'm a bit confused by that one</p>



<a name="253096307"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253096307" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253096307">(Sep 13 2021 at 14:13)</a>:</h4>
<p>I wouldn't expect the behavior to change with the new code</p>



<a name="253096323"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253096323" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253096323">(Sep 13 2021 at 14:13)</a>:</h4>
<p>did it?</p>



<a name="253096348"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253096348" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253096348">(Sep 13 2021 at 14:13)</a>:</h4>
<p>simpler one now</p>



<a name="253096372"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253096372" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253096372">(Sep 13 2021 at 14:14)</a>:</h4>
<p>ok, this one I could imagine changing</p>



<a name="253096425"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253096425" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253096425">(Sep 13 2021 at 14:14)</a>:</h4>
<p>yea it did, the <code>ice</code> function failed</p>



<a name="253096429"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253096429" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253096429">(Sep 13 2021 at 14:14)</a>:</h4>
<p>and it would be good to test both I would think</p>



<a name="253096461"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253096461" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253096461">(Sep 13 2021 at 14:14)</a>:</h4>
<p>that's what I thought, too, so I'm duplicating them</p>



<a name="253096474"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253096474" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253096474">(Sep 13 2021 at 14:14)</a>:</h4>
<p><span class="user-mention silent" data-user-id="124288">oli</span> <a href="#narrow/stream/144729-wg-traits/topic/TAITs.20ahoy/near/253096425">said</a>:</p>
<blockquote>
<p>yea it did, the <code>ice</code> function failed</p>
</blockquote>
<p>!</p>



<a name="253096539"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253096539" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253096539">(Sep 13 2021 at 14:14)</a>:</h4>
<p>to be clear, i'm taling about the test with the pattern</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">foo</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">impl</span><span class="w"> </span><span class="nb">Into</span><span class="o">&lt;..</span><span class="p">.</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">ice</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">Into</span>::<span class="n">into</span><span class="p">(</span><span class="n">foo</span><span class="p">())</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="253096576"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253096576" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253096576">(Sep 13 2021 at 14:15)</a>:</h4>
<p>the "defining scope" for that opaque type <em>should</em> just be <code>fn foo</code></p>



<a name="253096594"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253096594" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253096594">(Sep 13 2021 at 14:15)</a>:</h4>
<p>ah yea, sorry, that was just a case of me copying a very similar test</p>



<a name="253096602"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253096602" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253096602">(Sep 13 2021 at 14:15)</a>:</h4>
<p>yea and it is</p>



<a name="253096607"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253096607" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253096607">(Sep 13 2021 at 14:15)</a>:</h4>
<p>ok ok</p>



<a name="253097974"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253097974" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253097974">(Sep 13 2021 at 14:23)</a>:</h4>
<p><span aria-label="rofl" class="emoji emoji-1f923" role="img" title="rofl">:rofl:</span> uh, so I found the issue with the other one that I mentioned:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">trait</span><span class="w"> </span><span class="n">Trait</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">Assoc</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">impl</span><span class="w"> </span><span class="n">Trait</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">Assoc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">unit</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">impl</span><span class="w"> </span><span class="nb">Into</span><span class="o">&lt;&lt;</span><span class="p">()</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Trait</span><span class="o">&gt;</span>::<span class="n">Assoc</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">ice</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nb">Into</span>::<span class="n">into</span><span class="p">(</span><span class="n">unit</span><span class="p">());</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p><code>unit</code> does not detect any definition of the opaque return type, because in MIR the <code>RETURN_PLACE</code> is already <code>()</code>, and not <code>ty::Opaque</code></p>



<a name="253099466"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253099466" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253099466">(Sep 13 2021 at 14:32)</a>:</h4>
<p>oh dear :)</p>



<a name="253099549"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253099549" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253099549">(Sep 13 2021 at 14:33)</a>:</h4>
<p>maybe someone did something smart in MIR building for empty bodies XD</p>



<a name="253099577"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253099577" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253099577">(Sep 13 2021 at 14:33)</a>:</h4>
<p>well wait</p>



<a name="253099597"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253099597" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253099597">(Sep 13 2021 at 14:33)</a>:</h4>
<p>is it particular to the empty body?</p>



<a name="253099647"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253099647" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253099647">(Sep 13 2021 at 14:33)</a>:</h4>
<p>ah, you're saying that maybe MIR building has some kind of shortcut for that?</p>



<a name="253099653"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253099653" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253099653">(Sep 13 2021 at 14:33)</a>:</h4>
<p>I did it with a 42 in the body and Assoc = i32, and that compiled</p>



<a name="253099661"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253099661" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253099661">(Sep 13 2021 at 14:33)</a>:</h4>
<p>could well be</p>



<a name="253099681"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253099681" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253099681">(Sep 13 2021 at 14:33)</a>:</h4>
<p>(what about <code>()</code> in the body?)</p>



<a name="253099697"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253099697" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253099697">(Sep 13 2021 at 14:33)</a>:</h4>
<p>but I imagine it would be the same, yeah</p>



<a name="253099783"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253099783" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253099783">(Sep 13 2021 at 14:34)</a>:</h4>
<p>yea, <code>()</code> in the body compiles, too</p>



<a name="253099799"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253099799" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253099799">(Sep 13 2021 at 14:34)</a>:</h4>
<p>it's just empty bodies XD</p>



<a name="253099920"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253099920" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253099920">(Sep 13 2021 at 14:35)</a>:</h4>
<p>there probably is some special case</p>



<a name="253100079"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253100079" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253100079">(Sep 13 2021 at 14:36)</a>:</h4>
<p>wait what?</p>
<p>mir for empty body on stable</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">unit</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">_0</span>: <span class="p">();</span><span class="w">                      </span><span class="c1">// return place in scope 0 at src/lib.rs:9:14: 9:45</span>

<span class="w">    </span><span class="n">bb0</span>: <span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">_0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">();</span><span class="w">                   </span><span class="c1">// scope 0 at src/lib.rs:9:46: 9:48</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span><span class="w">                          </span><span class="c1">// scope 0 at src/lib.rs:9:48: 9:48</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>mir for <code>()</code> body on stable</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">unit</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">_0</span>: <span class="p">();</span><span class="w">                      </span><span class="c1">// return place in scope 0 at src/lib.rs:9:14: 9:45</span>

<span class="w">    </span><span class="n">bb0</span>: <span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span><span class="w">                          </span><span class="c1">// scope 0 at src/lib.rs:9:52: 9:52</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>and no, I did not accidentally swap them</p>



<a name="253100117"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253100117" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253100117">(Sep 13 2021 at 14:36)</a>:</h4>
<p>this is mir after mir opts, but still</p>



<a name="253100203"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253100203" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253100203">(Sep 13 2021 at 14:36)</a>:</h4>
<p><a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=2fb0ba631d685c8474be55c847b24a0f">https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=2fb0ba631d685c8474be55c847b24a0f</a></p>



<a name="253105145"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253105145" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253105145">(Sep 13 2021 at 15:05)</a>:</h4>
<p>yea, so there's some code that checks "if no_body &amp;&amp; ret_type.is_unit() {} else { assume divergence }",</p>



<a name="253288893"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253288893" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253288893">(Sep 14 2021 at 17:22)</a>:</h4>
<p>I am stuck. <code>expected_inputs_for_expected_output</code> compares an inference var against a <code>ty::Opaque</code> and then throws this information away, so we never know that they are equal. This is problematic when we figure out a closure's kind, as the <code>ty::Opaque</code> may not contain the information we need (no <code>Fn*</code> bound), but instead the information exists as a pending obligation on the inference type.</p>
<p>this happens for</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">type</span> <span class="nc">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">impl</span><span class="w"> </span><span class="nb">Clone</span><span class="p">;</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">bar</span><span class="o">&lt;</span><span class="n">F</span>: <span class="nb">Fn</span><span class="p">(</span><span class="o">&amp;</span><span class="kt">i32</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">Clone</span><span class="o">&gt;</span><span class="p">(</span><span class="n">f</span>: <span class="nc">F</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">F</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">f</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">foo</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">X</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">bar</span><span class="p">(</span><span class="o">|</span><span class="n">_</span><span class="o">|</span><span class="w"> </span><span class="p">())</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>we correctly propagate <code>X</code> through the return type of <code>bar</code> into the argument of <code>bar</code> and then try to figure out the closure kind.</p>
<p>The problem is that the bounds on <code>F</code> do not get put on <code>X</code>, but on some inference variable. That inference variable gets instantiated to <code>X</code> in a probe (well, in a fudge, which is the problem we have), propagated to the arguments, and then the fact that the inference var was instantiated is forgotten. This forgetting is on purpose, as a bunch of lifetimes will die horribly otherwise, and the instantiation happens again later. So everything normally works out. Unless you have a closure as an argument to a generic identity function. Essentially we try to figure out the closure kind too early, as we try to figure it out when processing the arguments of the function call (as the closure is an argument), and only once all that is done, we process the type of the call expression.</p>



<a name="253289615"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253289615" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253289615">(Sep 14 2021 at 17:26)</a>:</h4>
<p>I think it would be wrong to do the call expression type check before checking its arguments, as we first need to figure out the arguments to be really sure about the return type if there's enough projections involved.</p>



<a name="253289673"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253289673" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253289673">(Sep 14 2021 at 17:26)</a>:</h4>
<p>the main thing I'm wondering, and which the docs don't really make clear is <em>why</em> we do a probe here instead of just plainly equating the return type with the expected type</p>



<a name="253380838"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253380838" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253380838">(Sep 15 2021 at 08:43)</a>:</h4>
<p>I was thinking about this while falling asleep yesterday (no it's not so boring it puts me to sleep, but it's calming/relaxing XD) and I think I know what to do. I have a specific check that ensures that opaque types never get a concrete type that is in fact an inference var, but we don't need that anymore now that we don't use unconstrained opaque types in the trait solver until we manage to resolve them (just like we do with inference vars). That way, the moment an inference var is compared with an opaque type, the opaque type's concrete type becomes the inference var and we resolve the opaque type to the inference var from now on. Thus the "equality"of them is preserved</p>



<a name="253380925"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253380925" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253380925">(Sep 15 2021 at 08:44)</a>:</h4>
<p>this reverts most of the closure changes I did for lazy tait</p>



<a name="253468149"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253468149" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253468149">(Sep 15 2021 at 18:54)</a>:</h4>
<p><span class="user-mention" data-user-id="124288">@oli</span> I didn't follow this.</p>



<a name="253468153"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253468153" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253468153">(Sep 15 2021 at 18:54)</a>:</h4>
<p>Should I?</p>



<a name="253483851"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253483851" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253483851">(Sep 15 2021 at 20:38)</a>:</h4>
<p>I think I figured it out, I'll let you know once I tried it</p>



<a name="253561637"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253561637" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253561637">(Sep 16 2021 at 10:51)</a>:</h4>
<p><span aria-label="face palm" class="emoji emoji-1f926" role="img" title="face palm">:face_palm:</span> I found one reason why impl trait in bindings was broken before: wf-checks never ran for them, we only run wf-checks for opaque types on return types of functions</p>



<a name="253712003"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253712003" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253712003">(Sep 17 2021 at 09:05)</a>:</h4>
<p>I'm going to start splitting out things from the lazy TAIT mega-branch</p>



<a name="253752733"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/253752733" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#253752733">(Sep 17 2021 at 14:41)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/pull/89024">https://github.com/rust-lang/rust/pull/89024</a> and <a href="https://github.com/rust-lang/rust/pull/89045">https://github.com/rust-lang/rust/pull/89045</a> are the first two such PRs and should be trivial to review as they don't meaningfully (beyond diagnostics) change the behaviour</p>



<a name="254054331"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/254054331" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#254054331">(Sep 20 2021 at 14:01)</a>:</h4>
<p><span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span></p>



<a name="254054360"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/254054360" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#254054360">(Sep 20 2021 at 14:01)</a>:</h4>
<p>Hey <span class="user-mention" data-user-id="124288">@oli</span> and <span class="user-mention" data-user-id="116266">@Santiago Pastorino</span></p>



<a name="254054445"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/254054445" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#254054445">(Sep 20 2021 at 14:02)</a>:</h4>
<p>hey!</p>



<a name="254054454"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/254054454" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#254054454">(Sep 20 2021 at 14:02)</a>:</h4>
<p>Zoom or Zulip wfm</p>



<a name="254054483"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/254054483" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#254054483">(Sep 20 2021 at 14:02)</a>:</h4>
<p>but maybe Zulip mildly preferred</p>



<a name="254054534"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/254054534" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#254054534">(Sep 20 2021 at 14:02)</a>:</h4>
<p>whatever is fine for me</p>



<a name="254054601"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/254054601" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#254054601">(Sep 20 2021 at 14:03)</a>:</h4>
<p><span class="user-mention" data-user-id="124288">@oli</span> you around today?</p>



<a name="254054660"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/254054660" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#254054660">(Sep 20 2021 at 14:03)</a>:</h4>
<p>I'm here</p>



<a name="254054777"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/254054777" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#254054777">(Sep 20 2021 at 14:04)</a>:</h4>
<p>I am currently in the process of getting parts of my huge PR merged, because I now ended up adding some refactorings that also apply to the current system.</p>



<a name="254054801"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/254054801" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#254054801">(Sep 20 2021 at 14:04)</a>:</h4>
<p>it will also make merging the huge PR easier in the end</p>



<a name="254054815"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/254054815" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#254054815">(Sep 20 2021 at 14:05)</a>:</h4>
<p>Yes. I saw some PRs</p>



<a name="254054825"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/254054825" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#254054825">(Sep 20 2021 at 14:05)</a>:</h4>
<p>seems like a good idea!</p>



<a name="254054852"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/254054852" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#254054852">(Sep 20 2021 at 14:05)</a>:</h4>
<p>in terms of the overall state you've reached, how are things going?</p>



<a name="254054892"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/254054892" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#254054892">(Sep 20 2021 at 14:05)</a>:</h4>
<p>there are still around 180 tests failing, most of which are tests that should error and are now additionally ICEing</p>



<a name="254054944"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/254054944" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#254054944">(Sep 20 2021 at 14:06)</a>:</h4>
<p>ok, any idea why that is?</p>



<a name="254055073"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/254055073" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#254055073">(Sep 20 2021 at 14:06)</a>:</h4>
<p>not yet, I believe some if it may be fixed by one of the current small PRs, as it will ensure that we don't miss invalid opaque types inside function bodies</p>



<a name="254055228"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/254055228" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#254055228">(Sep 20 2021 at 14:07)</a>:</h4>
<p>OK. Is there anything to discuss today?</p>



<a name="254055296"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/254055296" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#254055296">(Sep 20 2021 at 14:08)</a>:</h4>
<p>My impression is that you are basically just churning through the code and don't really need anything but reviews</p>



<a name="254055305"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/254055305" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#254055305">(Sep 20 2021 at 14:08)</a>:</h4>
<p>I don't think so</p>



<a name="254055388"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/254055388" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#254055388">(Sep 20 2021 at 14:08)</a>:</h4>
<p>yea, I am progressing all the time, so I'm not worried. It's just slow work figuring out what is actually wrong with each new kind of failing test</p>



<a name="254055465"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/254055465" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#254055465">(Sep 20 2021 at 14:09)</a>:</h4>
<p>OK, then we can end the meeting super early from my POV</p>



<a name="254055550"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/254055550" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#254055550">(Sep 20 2021 at 14:09)</a>:</h4>
<p><span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="256266349"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/256266349" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#256266349">(Oct 05 2021 at 15:27)</a>:</h4>
<p><span class="user-mention" data-user-id="124288">@oli</span> are you around by any chance?</p>



<a name="256275282"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/256275282" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#256275282">(Oct 05 2021 at 16:20)</a>:</h4>
<p>Kind of</p>



<a name="262814611"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/262814611" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#262814611">(Nov 26 2021 at 16:25)</a>:</h4>
<p>The lazy TAIT PR has a small problem with </p>
<div class="codehilite"><pre><span></span><code>fn main() {}

trait T {}
impl T for () {}

fn should_ret_unit() -&gt; impl T {
    panic!()
}
</code></pre></div>
<p>this passes on stable right now, but will fail with lazy TAIT, as the opaque type is never actually compared with any other type in MIR. Previously this wasn't a problem, as without TAITs in general we don't need to wait for mir borrowck, we were able to just grab the hidden types from typeck and just figure out their lifetimes in mir borrowck. With TAIT, there can be multiple assignments to the same opaque type, and they can have different generic (including lifetime) parameters <em>on the opaque type</em>, as TAITs can have generic parameters in contrast to RPIT.</p>



<a name="262814839"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/262814839" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#262814839">(Nov 26 2021 at 16:28)</a>:</h4>
<p>We can either get fancy with fallback things, or revisit our strategy of resolving opaque types solely from the MIR and going back to the previous scheme of figuring out all the hidden types in typeck and giving them fresh lifetimes in mir borrowck</p>



<a name="262814867"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/262814867" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#262814867">(Nov 26 2021 at 16:29)</a>:</h4>
<p>some more info, because the above mentions various topics that I didn't explain:</p>



<a name="262814956"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/262814956" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#262814956">(Nov 26 2021 at 16:30)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">type</span> <span class="nc">Foo</span><span class="o">&lt;</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">Y</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">impl</span><span class="w"> </span><span class="n">Trait</span><span class="p">;</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">foo</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">U</span><span class="o">&gt;</span><span class="p">(</span><span class="n">t</span>: <span class="nc">T</span><span class="p">,</span><span class="w"> </span><span class="n">u</span>: <span class="nc">U</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">_</span>: <span class="nc">Foo</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">U</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">_</span>: <span class="nc">Foo</span><span class="o">&lt;</span><span class="n">U</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>is basically the situation I'm wondering about. The two uses of <code>Foo</code> can get unified, but we'd first need to "normalize" their generic parameters somehow so that we can actually compare their hidden types in some way.</p>



<a name="262815486"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/262815486" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#262815486">(Nov 26 2021 at 16:37)</a>:</h4>
<p>TLDR: I think I screwed up by throwing away the hidden types from typeck and figuring them out all over again in mir borrowck, because mir borrowck doesn't find all of them</p>



<a name="263103649"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/263103649" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Barbone <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#263103649">(Nov 30 2021 at 05:33)</a>:</h4>
<blockquote>
<p><code>_ : Foo&lt;T, U&gt; = (t, u)</code></p>
</blockquote>
<p>This looks like a higher-order unification problem -- <code>Foo</code> is a unification variable representing a function of two arguments, and the goal is to solve it as <code>λ T U. (T, U)</code>.  (This particular case is in the pattern fragment of higher-order unification problems, so it's efficiently solvable.)  I think typically the specific problem of unifying <code>λ T U. (T, U)</code> with <code>λ U T. (U, T)</code> is solved in dependent typecheckers/lambda prolog implementations by either (a) using de Bruijn indices/levels; or (b) when unifying two lambdas, invent a fresh constant <code>x</code> for their argument, and unify the results of applying them to that constant.  (Or both (a) and (b).)  Sorry if I'm stating the obvious here; I'm not familiar enough with rustc internals to completely understand the problem.</p>
<p>Does Rustc maintain enough info to know during unification whether <code>type Foo&lt;X,Y&gt; = (T, U)</code> would be a legal instantiation, or does it only check wf-ness after unification?</p>
<p>(Also, hi <span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span> I'm new to rustc, but I have some logic programming knowledge (I recently made a <a href="https://github.com/mb64/simple-lambda-prolog">lambda prolog interpreter</a>) and I'd love to contribute to traits/typechecking however I can!)</p>



<a name="263464974"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/263464974" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#263464974">(Dec 02 2021 at 16:39)</a>:</h4>
<p><span class="user-mention silent" data-user-id="124288">oli</span> <a href="#narrow/stream/144729-wg-traits/topic/TAITs.20ahoy/near/262815486">said</a>:</p>
<blockquote>
<p>TLDR: I think I screwed up by throwing away the hidden types from typeck and figuring them out all over again in mir borrowck, because mir borrowck doesn't find all of them</p>
</blockquote>
<p>Nope, that isn't the issue XD it's actually that some things are performed in queries, and we do not feed the "defining use scope" of the caller of the query into the query. Thus the query does not instantiate any opaque types's hidden types, thus some things fail. I'm actually amazed that this is not a more frequent issue, but I worked around the issue in some places where there was a non-query fallback path</p>



<a name="263465185"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/263465185" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#263465185">(Dec 02 2021 at 16:40)</a>:</h4>
<p>So... basically, my current idea is that we add a new <code>PredicateKind</code>: <code>DefiningUseScope(LocalDefId)</code> that is automatically added to a param env at creation time, where we know for which item we are creating the param env</p>



<a name="263468646"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/263468646" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#263468646">(Dec 02 2021 at 17:02)</a>:</h4>
<p>hmm... that will brick a lot of caching though</p>



<a name="263469233"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/263469233" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#263469233">(Dec 02 2021 at 17:06)</a>:</h4>
<p>Ah, but we can fix that with some fancy use of <code>ParamEnvAnd</code></p>



<a name="263602840"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/263602840" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#263602840">(Dec 03 2021 at 16:23)</a>:</h4>
<p>I have a solution that is both efficient, simple to implement and probably simple to understand: the defining scope of an <code>impl Trait</code> (no matter what kind) is the crate it is defined in</p>



<a name="263602850"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/263602850" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#263602850">(Dec 03 2021 at 16:23)</a>:</h4>
<p>problem solved</p>



<a name="263602869"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/263602869" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#263602869">(Dec 03 2021 at 16:24)</a>:</h4>
<p>async stuff will probably break badly XD</p>



<a name="263610701"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/263610701" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#263610701">(Dec 03 2021 at 17:23)</a>:</h4>
<p>ah we can just do this for TAIT and leave RPIT untouched</p>



<a name="263617389"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/263617389" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#263617389">(Dec 03 2021 at 18:14)</a>:</h4>
<p><span class="user-mention silent" data-user-id="124288">oli</span> <a href="#narrow/stream/144729-wg-traits/topic/TAITs.20ahoy/near/263610701">said</a>:</p>
<blockquote>
<p>ah we can just do this for TAIT and leave RPIT untouched</p>
</blockquote>
<p>unsure if you've talked with <span class="user-mention" data-user-id="116009">@nikomatsakis</span> about his RPIT solution</p>



<a name="263623358"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/263623358" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#263623358">(Dec 03 2021 at 19:02)</a>:</h4>
<p>Uuh what solution? XD</p>



<a name="269451081"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/269451081" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#269451081">(Jan 26 2022 at 17:39)</a>:</h4>
<p>except for docs, diagnostics (just open issues) and the two thread I started here, <a href="https://github.com/rust-lang/rust/pull/92007">https://github.com/rust-lang/rust/pull/92007</a> is ready!</p>



<a name="271312354"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/271312354" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#271312354">(Feb 09 2022 at 17:12)</a>:</h4>
<p>I just want to share this beautiful piece of code that we're sadly accepting on stable</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">foo</span><span class="p">(</span><span class="n">b</span>: <span class="kt">bool</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">impl</span><span class="w"> </span><span class="nb">IntoIterator</span><span class="o">&lt;</span><span class="n">Item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="fm">vec!</span><span class="p">[()];</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">[()].</span><span class="n">into_iter</span><span class="p">().</span><span class="n">collect</span><span class="p">()</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p><a href="https://github.com/rust-lang/rust/issues/93794">https://github.com/rust-lang/rust/issues/93794</a> is the issue</p>
<p>It's not really compatible with lazy tait to allow this, because</p>
<blockquote>
<p>the trait <code>FromIterator&lt;()&gt;</code> is not implemented for <code>impl IntoIterator&lt;Item = ()&gt;</code></p>
</blockquote>
<p>is exactly the error I would expect from this with lazy TAIT</p>



<a name="271312696"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/271312696" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#271312696">(Feb 09 2022 at 17:14)</a>:</h4>
<p>but the fix for this is afaict to change how typeck handles the expected type of return expressions in case they are RPIT</p>



<a name="271315625"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/271315625" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#271315625">(Feb 09 2022 at 17:31)</a>:</h4>
<p><span aria-label="face palm" class="emoji emoji-1f926" role="img" title="face palm">:face_palm:</span>‍♂️</p>



<a name="271315908"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/271315908" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#271315908">(Feb 09 2022 at 17:33)</a>:</h4>
<p>How widespread is that kind of code? Could with get away with calling it a semver-allowed inference breakage?</p>



<a name="271321890"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/271321890" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#271321890">(Feb 09 2022 at 18:04)</a>:</h4>
<p>would we want to check the lazy tait PR on crater to see ? (the exact piece of code above was ofc only recently allowed in edition 2021, but the pattern may be more widespread)</p>



<a name="271324632"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/271324632" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#271324632">(Feb 09 2022 at 18:21)</a>:</h4>
<p>Someone already linked a from a real crate's repo to the issue. I think i'll look into writing a (likely hacky) fix and then we can discuss phasing it out.</p>



<a name="271347700"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/271347700" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#271347700">(Feb 09 2022 at 21:09)</a>:</h4>
<p>So...would it have been better to do a crater run on <a href="https://github.com/rust-lang/rust/issues/92007">#92007</a> before landing?</p>



<a name="271349079"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/271349079" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#271349079">(Feb 09 2022 at 21:20)</a>:</h4>
<p>Proooobably</p>



<a name="271349126"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/271349126" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#271349126">(Feb 09 2022 at 21:20)</a>:</h4>
<p>I'll try to squash the bugs as they appear.</p>



<a name="271349146"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/271349146" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#271349146">(Feb 09 2022 at 21:21)</a>:</h4>
<p>It's not <em>too</em> late to revert and try again</p>



<a name="271349160"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/271349160" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#271349160">(Feb 09 2022 at 21:21)</a>:</h4>
<p>True</p>



<a name="271349164"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/271349164" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#271349164">(Feb 09 2022 at 21:21)</a>:</h4>
<p>But that's not ideal</p>



<a name="271349222"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/271349222" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#271349222">(Feb 09 2022 at 21:21)</a>:</h4>
<p>Not against that, but yea... not too great</p>



<a name="271349304"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/271349304" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#271349304">(Feb 09 2022 at 21:22)</a>:</h4>
<p>A revert only gets more difficult as time passes</p>



<a name="271349339"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/271349339" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#271349339">(Feb 09 2022 at 21:22)</a>:</h4>
<p>Another alternative: start a crater run <em>right now</em></p>



<a name="271349363"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/271349363" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#271349363">(Feb 09 2022 at 21:22)</a>:</h4>
<p>As opposed to a revert now or just waiting for bug reports</p>



<a name="271349426"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/271349426" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#271349426">(Feb 09 2022 at 21:23)</a>:</h4>
<p>Hmm... how long is the queue?</p>



<a name="271349462"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/271349462" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#271349462">(Feb 09 2022 at 21:23)</a>:</h4>
<p>empty as of yesterday</p>



<a name="271349514"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/271349514" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#271349514">(Feb 09 2022 at 21:24)</a>:</h4>
<p>oh, one thing</p>



<a name="271349547"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/271349547" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#271349547">(Feb 09 2022 at 21:24)</a>:</h4>
<p>I'd argue that checking lazy TAIT is p=1 though</p>



<a name="271349564"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/271349564" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#271349564">(Feb 09 2022 at 21:24)</a>:</h4>
<p>(given it's already landed)</p>



<a name="271349650"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/271349650" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#271349650">(Feb 09 2022 at 21:25)</a>:</h4>
<p>Yea. I guess running crater now helps catch things before the beta</p>



<a name="271349665"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/271349665" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#271349665">(Feb 09 2022 at 21:25)</a>:</h4>
<p>And I keep squashing bugs in parallel</p>



<a name="271349678"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/271349678" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#271349678">(Feb 09 2022 at 21:25)</a>:</h4>
<p>yeah basically</p>



<a name="271349778"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/271349778" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#271349778">(Feb 09 2022 at 21:26)</a>:</h4>
<p>I guess we can run crater on the merge commit's build?</p>



<a name="271349830"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/271349830" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#271349830">(Feb 09 2022 at 21:27)</a>:</h4>
<p>Uh, probably on yesterday's nightly</p>



<a name="271349847"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/271349847" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#271349847">(Feb 09 2022 at 21:27)</a>:</h4>
<p>so your fix from yesterday is included</p>



<a name="271349895"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/271349895" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#271349895">(Feb 09 2022 at 21:27)</a>:</h4>
<p>Ah right, we can just compare over a larger period of time</p>



<a name="271349902"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/271349902" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#271349902">(Feb 09 2022 at 21:27)</a>:</h4>
<p>doing a crater run now means 1) no revert (for now at least) 2) Longer lead time before beta to decide if we <em>do</em> need a revert 3) Less time elapsed before revert if needed</p>



<a name="271349935"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/271349935" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#271349935">(Feb 09 2022 at 21:28)</a>:</h4>
<p>Sgtm</p>



<a name="271350012"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/271350012" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#271350012">(Feb 09 2022 at 21:28)</a>:</h4>
<p><span class="user-mention" data-user-id="116122">@simulacrum</span> can you help set this up?</p>



<a name="271350080"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/271350080" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#271350080">(Feb 09 2022 at 21:29)</a>:</h4>
<p>I can help -- is there something beyond the docs <a href="https://github.com/rust-lang/crater/blob/master/docs/bot-usage.md">https://github.com/rust-lang/crater/blob/master/docs/bot-usage.md</a> that's needed?</p>



<a name="271350152"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/271350152" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#271350152">(Feb 09 2022 at 21:29)</a>:</h4>
<p>probably not</p>



<a name="271350165"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/271350165" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#271350165">(Feb 09 2022 at 21:29)</a>:</h4>
<p>I'm just afraid of messing it up</p>



<a name="271350252"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/271350252" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#271350252">(Feb 09 2022 at 21:30)</a>:</h4>
<p>I mean, worst case extra comments? :)</p>



<a name="271350328"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/271350328" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#271350328">(Feb 09 2022 at 21:31)</a>:</h4>
<p>maybe</p>



<a name="271350378"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/271350378" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#271350378">(Feb 09 2022 at 21:31)</a>:</h4>
<p>not sure how to specify the two nightlies. Just by the name you would give e.g. rustup?</p>



<a name="271350420"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/271350420" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#271350420">(Feb 09 2022 at 21:32)</a>:</h4>
<p>"You can specify a toolchain using a rustup name"</p>



<a name="271350428"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/271350428" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#271350428">(Feb 09 2022 at 21:32)</a>:</h4>
<p>That would work, yeah, or you can use master#&lt;sha&gt; and master#&lt;sha2&gt; for the start/end</p>



<a name="271350480"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/271350480" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#271350480">(Feb 09 2022 at 21:32)</a>:</h4>
<p>Okay, let me try this</p>



<a name="271350486"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/271350486" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#271350486">(Feb 09 2022 at 21:32)</a>:</h4>
<p>I'll open a new issue for this</p>



<a name="271350905"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/271350905" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#271350905">(Feb 09 2022 at 21:36)</a>:</h4>
<p>so...when exactly do nightlies get built</p>



<a name="271351039"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/271351039" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#271351039">(Feb 09 2022 at 21:37)</a>:</h4>
<p>Try using the PR's merge before my lazy TAIT PR and the merge of my fix PR instead of specific nightlies</p>



<a name="271351098"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/271351098" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#271351098">(Feb 09 2022 at 21:38)</a>:</h4>
<p>Sorry I'm not any help, basically asleep already xD</p>



<a name="271351354"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/271351354" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#271351354">(Feb 09 2022 at 21:41)</a>:</h4>
<p>How do you have crater yield to a higher priority run?</p>



<a name="271351610"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/271351610" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#271351610">(Feb 09 2022 at 21:43)</a>:</h4>
<p><span class="user-mention" data-user-id="232957">@Jack Huey</span> the current one should be done quite soon</p>



<a name="271351619"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/271351619" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#271351619">(Feb 09 2022 at 21:43)</a>:</h4>
<p>but if you prioritize (p=1) it'll automatically yield</p>



<a name="271351696"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/271351696" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#271351696">(Feb 09 2022 at 21:44)</a>:</h4>
<p>I did prioritize. Maybe it just takes a second</p>



<a name="271351762"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/271351762" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#271351762">(Feb 09 2022 at 21:44)</a>:</h4>
<p>It'll take 30 minutes or so -- the current set of crates running on each builder needs to run out</p>



<a name="271351791"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/271351791" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#271351791">(Feb 09 2022 at 21:44)</a>:</h4>
<p>but on the next request I believe the new one will take priority, not 100%, but I believe so</p>



<a name="271351829"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/271351829" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#271351829">(Feb 09 2022 at 21:45)</a>:</h4>
<p>if not it'll start in around 24 hours.</p>



<a name="271351862"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/271351862" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#271351862">(Feb 09 2022 at 21:45)</a>:</h4>
<p>yeah, not <em>too</em> worried about it</p>



<a name="271537302"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/271537302" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#271537302">(Feb 11 2022 at 06:43)</a>:</h4>
<p>I think we have reached the point where we revert. I'm not going to be able to catch up with the bugs before the beta cut off</p>



<a name="271540971"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/271540971" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#271540971">(Feb 11 2022 at 07:48)</a>:</h4>
<p>revert PR:  <a href="https://github.com/rust-lang/rust/issues/93893">#93893</a></p>



<a name="271573415"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/271573415" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#271573415">(Feb 11 2022 at 13:12)</a>:</h4>
<p>We probably should have kept the crater run issue open</p>



<a name="271575930"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/271575930" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#271575930">(Feb 11 2022 at 13:28)</a>:</h4>
<p>I'll do a new one with the various fixes</p>



<a name="271575985"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/271575985" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#271575985">(Feb 11 2022 at 13:29)</a>:</h4>
<p>That way we get more precise results (fixes can easily result in more regressions)</p>



<a name="271576021"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy/near/271576021" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.html#271576021">(Feb 11 2022 at 13:29)</a>:</h4>
<p>That's fair</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>