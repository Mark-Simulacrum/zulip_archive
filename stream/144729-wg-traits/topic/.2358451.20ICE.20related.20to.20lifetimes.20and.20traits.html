<html>
<head><meta charset="utf-8"><title>#58451 ICE related to lifetimes and traits · wg-traits · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/index.html">wg-traits</a></h2>
<h3>Topic: <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html">#58451 ICE related to lifetimes and traits</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://rust-lang.github.io/zulip_archive/style.css" rel="stylesheet"></head>

<a name="158547947"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158547947" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158547947">(Feb 14 2019 at 17:38)</a>:</h4>
<p>Looking at this issue, it seems to be caused by the fact that a type error leads to an incomplete constraint graph.<br>
By the use of placeholders, we can already tell that there is a region error, since we expanded one of the region vars to <code>'static</code><br>
However, during error reporting, we cannot trace that error back to a concrete region (in this case, a scope) due to the graph being incomplete (it doesn't contain the scope at all).</p>



<a name="158548075"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158548075" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158548075">(Feb 14 2019 at 17:40)</a>:</h4>
<p>So maybe the correct behavior is to replace <a href="https://github.com/rust-lang/rust/blob/master/src/librustc/infer/lexical_region_resolve/mod.rs#L632" target="_blank" title="https://github.com/rust-lang/rust/blob/master/src/librustc/infer/lexical_region_resolve/mod.rs#L632">this <code>span_bug!</code></a> with <code>delay_span_bug</code></p>



<a name="158548098"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158548098" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158548098">(Feb 14 2019 at 17:40)</a>:</h4>
<p>..since this is caused by an already-reported error</p>



<a name="158548109"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158548109" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158548109">(Feb 14 2019 at 17:41)</a>:</h4>
<p>Does this seem right? cc <span class="user-mention" data-user-id="116009">@nikomatsakis</span> <span class="user-mention" data-user-id="116113">@lqd</span></p>



<a name="158548456"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158548456" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158548456">(Feb 14 2019 at 17:44)</a>:</h4>
<p>Hmm</p>



<a name="158548460"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158548460" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158548460">(Feb 14 2019 at 17:44)</a>:</h4>
<p>I was just looking at that</p>



<a name="158548469"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158548469" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158548469">(Feb 14 2019 at 17:44)</a>:</h4>
<p>so was I</p>



<a name="158548474"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158548474" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158548474">(Feb 14 2019 at 17:45)</a>:</h4>
<p>I dont' think that's quite the right assesment</p>



<a name="158548494"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158548494" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158548494">(Feb 14 2019 at 17:45)</a>:</h4>
<p>but I could be remembering wrong</p>



<a name="158548543"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158548543" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158548543">(Feb 14 2019 at 17:45)</a>:</h4>
<p>I think what is happening is that, when the error is found, we go traversing the graph looking for the "causes" of the error, but that search isn't taking into account the effects of crossing universes</p>



<a name="158548636"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158548636" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158548636">(Feb 14 2019 at 17:46)</a>:</h4>
<p>the lower bounds and upper bounds seemed to be the same right ?</p>



<a name="158548641"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158548641" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158548641">(Feb 14 2019 at 17:46)</a>:</h4>
<p>the way the algorithm works -- iirc -- is that, given some node X that has an error, it finds all the regions that X must outlive (i.e., all regions R where X: R) and all regions that outlive X. If you think of there being a graph where <code>A: B</code> means <code>A &lt;- B</code>, we are basically finding all things that can reach Xand all things reachable from X</p>



<a name="158548668"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158548668" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158548668">(Feb 14 2019 at 17:47)</a>:</h4>
<p>we assume that there will be two regions R1, R2 where <code>R2: X: R1</code> but <code>R2: R1</code> is false</p>



<a name="158548679"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158548679" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158548679">(Feb 14 2019 at 17:47)</a>:</h4>
<p>but I'm not sure that's true when universes come into play</p>



<a name="158548688"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158548688" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158548688">(Feb 14 2019 at 17:47)</a>:</h4>
<p>we had similar ICEs in the NLL code IIRC</p>



<a name="158548763"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158548763" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158548763">(Feb 14 2019 at 17:48)</a>:</h4>
<p>among other things, an edge <code>X: R1</code> can result in <code>X</code> becoming <code>'static</code> if <code>R1</code> is a placeholder, even though there is no direct edge between<code>X</code> and <code>'static</code></p>



<a name="158548792"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158548792" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158548792">(Feb 14 2019 at 17:48)</a>:</h4>
<p>I think that's the root cause of the ICE</p>



<a name="158548807"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158548807" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158548807">(Feb 14 2019 at 17:48)</a>:</h4>
<p>not sure <span class="user-mention" data-user-id="116113">@lqd</span> if that is what you meant =)</p>



<a name="158548938"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158548938" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158548938">(Feb 14 2019 at 17:50)</a>:</h4>
<p>it might be way ahead of me :)</p>



<a name="158548949"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158548949" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158548949">(Feb 14 2019 at 17:50)</a>:</h4>
<p>that is:</p>



<a name="158549019"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158549019" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158549019">(Feb 14 2019 at 17:51)</a>:</h4>
<p>I think what I was seeing was only one region in both the upper and lower bounds</p>



<a name="158549049"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158549049" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158549049">(Feb 14 2019 at 17:52)</a>:</h4>
<p>Yes, it is happening that our <code>X</code> is becoming <code>'static</code></p>



<a name="158549124"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158549124" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158549124">(Feb 14 2019 at 17:52)</a>:</h4>
<p>Just that when you get rid of the other error in the code (by replacing <code>f(&amp;[f()]);</code> with <code>f(&amp;[()]);</code>, for instance)</p>



<a name="158549265"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158549265" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158549265">(Feb 14 2019 at 17:54)</a>:</h4>
<p>..the error reporting mechanism is able to trace the conflict down to the scope of our <code>&amp;</code></p>



<a name="158549291"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158549291" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158549291">(Feb 14 2019 at 17:54)</a>:</h4>
<p>and as a result it reports an error that seems "correct"</p>



<a name="158549332"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158549332" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158549332">(Feb 14 2019 at 17:55)</a>:</h4>
<p>my point is that it is unable to do this in the original example, because the scope is nowhere in the constraint graph</p>



<a name="158549341"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158549341" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158549341">(Feb 14 2019 at 17:55)</a>:</h4>
<p>ah yes interesting point indeed</p>



<a name="158549350"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158549350" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158549350">(Feb 14 2019 at 17:55)</a>:</h4>
<p>hmm</p>



<a name="158549353"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158549353" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158549353">(Feb 14 2019 at 17:55)</a>:</h4>
<p>but maybe your point <span class="user-mention" data-user-id="116009">@nikomatsakis</span> is that it should be able to find and report an error regardless</p>



<a name="158549361"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158549361" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158549361">(Feb 14 2019 at 17:55)</a>:</h4>
<p>that is my point, basically</p>



<a name="158549403"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158549403" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158549403">(Feb 14 2019 at 17:56)</a>:</h4>
<p>it's possible I am mistaken</p>



<a name="158549416"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158549416" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158549416">(Feb 14 2019 at 17:56)</a>:</h4>
<p>that would mean the problem should be earlier than this function, correct ?</p>



<a name="158549417"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158549417" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158549417">(Feb 14 2019 at 17:56)</a>:</h4>
<p>but I still sorta suspect I am not ;)</p>



<a name="158549431"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158549431" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158549431">(Feb 14 2019 at 17:56)</a>:</h4>
<p>I have to run in a bit but let me share one thought:</p>



<a name="158549454"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158549454" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158549454">(Feb 14 2019 at 17:56)</a>:</h4>
<p>the ICE is</p>
<div class="codehilite"><pre><span></span>error: internal compiler error: src/librustc/infer/lexical_region_resolve/mod.rs:632: collect_error_for_expanding_node() could not find error for var &#39;_#4r in universe U6, lower_bounds=[
    RegionAndOrigin(RePlaceholder(Placeholder { universe: U6, name: BrNamed(crate0:DefIndex(1:10), &#39;a) }),Subtype(TypeTrace(ObligationCause { span: /home/nmatsakis/tmp/issue-58451.rs:8:5: 8:6, body_id: HirId { owner: DefIndex(0:4), loca\
l_id: 11 }, code: ItemObligation(DefId(0/0:3 ~ issue_58451[317d]::f[0])) }))),
    RegionAndOrigin(RePlaceholder(Placeholder { universe: U6, name: BrNamed(crate0:DefIndex(1:10), &#39;a) }),Subtype(TypeTrace(ObligationCause { span: /home/nmatsakis/tmp/issue-58451.rs:8:5: 8:6, body_id: HirId { owner: DefIndex(0:4), loca\
l_id: 11 }, code: ItemObligation(DefId(0/0:3 ~ issue_58451[317d]::f[0])) })))
], upper_bounds=[
    RegionAndOrigin(RePlaceholder(Placeholder { universe: U6, name: BrNamed(crate0:DefIndex(1:10), &#39;a) }),Subtype(TypeTrace(ObligationCause { span: /home/nmatsakis/tmp/issue-58451.rs:8:5: 8:6, body_id: HirId { owner: DefIndex(0:4), loca\
l_id: 11 }, code: ItemObligation(DefId(0/0:3 ~ issue_58451[317d]::f[0])) }))),
    RegionAndOrigin(RePlaceholder(Placeholder { universe: U6, name: BrNamed(crate0:DefIndex(1:10), &#39;a) }),Subtype(TypeTrace(ObligationCause { span: /home/nmatsakis/tmp/issue-58451.rs:8:5: 8:6, body_id: HirId { owner: DefIndex(0:4), loca\
l_id: 11 }, code: ItemObligation(DefId(0/0:3 ~ issue_58451[317d]::f[0])) })))
]
</pre></div>



<a name="158549490"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158549490" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158549490">(Feb 14 2019 at 17:57)</a>:</h4>
<p>in particular the error is listeing our the "lower" and "upper" bounds:</p>
<ul>
<li>lower<br>
    - some placeholder in U6</li>
<li>upper<br>
    - same placeholder</li>
</ul>



<a name="158549496"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158549496" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158549496">(Feb 14 2019 at 17:57)</a>:</h4>
<p>those regions are not in conflict</p>



<a name="158549511"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158549511" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158549511">(Feb 14 2019 at 17:57)</a>:</h4>
<p>but the conflict arises -- I think -- because the variable '_#4 can't name that placeholder (or some variable it's related to)</p>



<a name="158549525"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158549525" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158549525">(Feb 14 2019 at 17:58)</a>:</h4>
<p>basically I think that algorithm of walking the graph to find "leaf nodes" and comparing them is flawed</p>



<a name="158549565"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158549565" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158549565">(Feb 14 2019 at 17:58)</a>:</h4>
<p>in this context</p>



<a name="158549581"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158549581" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158549581">(Feb 14 2019 at 17:58)</a>:</h4>
<p>but it should be possible to extend it without <em>too</em> much difficult I suspect</p>



<a name="158549654"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158549654" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158549654">(Feb 14 2019 at 17:59)</a>:</h4>
<p>quick Q: is <a href="https://github.com/rust-lang/rust/blob/master/src/librustc/infer/lexical_region_resolve/mod.rs#L574-L630" target="_blank" title="https://github.com/rust-lang/rust/blob/master/src/librustc/infer/lexical_region_resolve/mod.rs#L574-L630">this</a> the graph walking algorithm you're mentioning (I assume it is), or something else upstream ?</p>



<a name="158549812"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158549812" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158549812">(Feb 14 2019 at 18:01)</a>:</h4>
<p><span class="user-mention" data-user-id="116113">@lqd</span> that's the one</p>



<a name="158549882"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158549882" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158549882">(Feb 14 2019 at 18:02)</a>:</h4>
<p>great, thank you</p>



<a name="158555809"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158555809" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158555809">(Feb 14 2019 at 19:16)</a>:</h4>
<p><span class="user-mention" data-user-id="116883">@tmandry</span>  does this match your understanding ? we have '_#4r (== 'static), and the placeholder. The former should be a subregion of the latter, which we can't verify so this should be an error. We don't emit it immediately in <code>collect_errors</code>, and leave it for later, to do so in <code>collect_var_errors</code>. There, we'll later try to find the error for '_#4r, but it is in U6, which is the same universe as the placeholder: since it’s universe it can name itself, and the lower and upper bounds are the same (the placeholder), there's no conflict — and we're in the ICE territory. So I wondered (and could be very wrong, I know very little about this compared to you) whether in this case maybe the effective_lower_bound should still be 'static (as if the placeholder’s universe couldn't be named by the var’s universe). I tried 1) your earlier suggestion to <code>delay_span_bug</code> here – and confusingly it didn't end up emitting the region conflict (so there was ultimately only the "missing parameter" error here), and 2) also tried this 'static effective lower bound, which similarly didn't end up emitting an error either, even though (and this was different from just using <code>delay_span_bug</code>) there's a <code>SubSupConflict</code>, for '_#4r and the placeholder in U6, "region inference error" downstream. I only saw this latter one in the logs and not emitted by rustc, confusingly.</p>



<a name="158555841"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158555841" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158555841">(Feb 14 2019 at 19:17)</a>:</h4>
<p>(gotta head out to dinner rn, will check back later :)</p>



<a name="158558158"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158558158" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158558158">(Feb 14 2019 at 19:43)</a>:</h4>
<blockquote>
<p>we have '_#4r (== 'static), and the placeholder. The former should be a subregion of the latter, which we can't verify so this should be an error, which we don't emit immediately in <code>collect_errors</code>, and leave for later to do so in <code>collect_var_errors</code>. </p>
</blockquote>
<p>yep!</p>
<blockquote>
<p>There, we'll later try to find the error for '_#4r, but it is in U6</p>
</blockquote>
<p>I don't believe <code>'_#4r</code> is in U6. If it were, it would not have been expanded to <code>'static</code> in <a href="https://github.com/rust-lang/rust/blob/f47ec2ad5b6887b3d400aee49e2294bd27733d18/src/librustc/infer/lexical_region_resolve/mod.rs#L257-L271" target="_blank" title="https://github.com/rust-lang/rust/blob/f47ec2ad5b6887b3d400aee49e2294bd27733d18/src/librustc/infer/lexical_region_resolve/mod.rs#L257-L271">this code</a> during the expand stage</p>



<a name="158558189"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158558189" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158558189">(Feb 14 2019 at 19:43)</a>:</h4>
<p>(I believe it that's the reason you see <code>='static</code>)</p>



<a name="158558474"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158558474" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158558474">(Feb 14 2019 at 19:47)</a>:</h4>
<p>I added a log in the if (on my phone rn so will get a link shortly) and saw: DEBUG 2019-02-14T19:07:53Z: rustc::infer::lexical_region_resolve: collect_error_for_expanding_node - node_universe=U6 can name universe=U6</p>



<a name="158558656"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158558656" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158558656">(Feb 14 2019 at 19:49)</a>:</h4>
<p>à la:</p>
<div class="codehilite"><pre><span></span><span class="k">if</span><span class="w"> </span><span class="n">node_universe</span><span class="p">.</span><span class="n">cannot_name</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">universe</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">debug</span><span class="o">!</span><span class="p">(</span><span class="s">&quot;collect_error_for_expanding_node - node_universe={:?} cannot name universe={:?}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">node_universe</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">universe</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="bp">self</span><span class="p">.</span><span class="n">tcx</span><span class="p">().</span><span class="n">types</span><span class="p">.</span><span class="n">re_static</span><span class="w"></span>
<span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">debug</span><span class="o">!</span><span class="p">(</span><span class="s">&quot;collect_error_for_expanding_node - node_universe={:?} can name universe={:?}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">node_universe</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">universe</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">lower_bound</span><span class="p">.</span><span class="n">region</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>



<a name="158558733"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158558733" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158558733">(Feb 14 2019 at 19:50)</a>:</h4>
<blockquote>
<p>maybe the effective_lower_bound should still be 'static (as if the placeholder’s universe couldn't be named by the var’s universe).</p>
</blockquote>
<p>This.. seems right to me, but I don't fully understand the code myself</p>



<a name="158558766"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158558766" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158558766">(Feb 14 2019 at 19:50)</a>:</h4>
<p>I saw the = ‘static in some contraction logs</p>



<a name="158558853"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158558853" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158558853">(Feb 14 2019 at 19:51)</a>:</h4>
<p>You can use triple-backticks to denote code blocks, same as github :)</p>



<a name="158558935"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158558935" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158558935">(Feb 14 2019 at 19:52)</a>:</h4>
<p>(i know but can’t find back ticks on my phone keyboard sorry :p)</p>



<a name="158558993"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158558993" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158558993">(Feb 14 2019 at 19:52)</a>:</h4>
<p>ah, no problem :)</p>



<a name="158558995"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158558995" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158558995">(Feb 14 2019 at 19:52)</a>:</h4>
<p>(I’ll edit it as soon as I get to a proper keyboard soon)</p>



<a name="158559039"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158559039" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158559039">(Feb 14 2019 at 19:53)</a>:</h4>
<p>are you sure the log you're seeing is for <code>'_#4r</code>?</p>



<a name="158559150"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158559150" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158559150">(Feb 14 2019 at 19:54)</a>:</h4>
<p>I’ll double check</p>



<a name="158559205"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158559205" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158559205">(Feb 14 2019 at 19:55)</a>:</h4>
<blockquote>
<p>I tried 1) your earlier suggestion to delay_span_bug here – and confusingly it didn't end up emitting the region conflict (so there was ultimately only the "missing parameter" error here)</p>
</blockquote>
<p>This I expect.. basically we get here because we fail to emit a diagnostic for the error. The assumption of <code>delay_span_bug</code> being that we can _only_ get here if there was some other error in the compilation causing this</p>



<a name="158559267"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158559267" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158559267">(Feb 14 2019 at 19:55)</a>:</h4>
<p>(But it sounds like this isn't the right way to go)</p>



<a name="158559392"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158559392" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158559392">(Feb 14 2019 at 19:57)</a>:</h4>
<blockquote>
<p>also tried this 'static effective lower bound, which similarly didn't end up emitting an error either, even though (and this was different from just using <code>delay_span_bug</code>) there's a <code>SubSupConflict</code>, for '_#4r and the placeholder in U6, "region inference error" downstream. I only saw this latter one in the logs and not emitted by rustc, confusingly.</p>
</blockquote>
<p>This I find surprising, personally</p>



<a name="158559451"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158559451" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158559451">(Feb 14 2019 at 19:57)</a>:</h4>
<p>haha yeah so did I</p>



<a name="158560260"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158560260" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158560260">(Feb 14 2019 at 20:07)</a>:</h4>
<p>the only node_universe I see <a href="https://github.com/rust-lang/rust/blob/f47ec2ad5b6887b3d400aee49e2294bd27733d18/src/librustc/infer/lexical_region_resolve/mod.rs#L596" target="_blank" title="https://github.com/rust-lang/rust/blob/f47ec2ad5b6887b3d400aee49e2294bd27733d18/src/librustc/infer/lexical_region_resolve/mod.rs#L596">here</a> in my logs is U6 :/ (but I haven't logged the node_idx so I'm not even sure it's '_#4r anymore) I don't know if these have shared information, and if so, wondered if there could be a mismatch between some information <code>self.var_infos</code> and <code>var_data</code> which is set <a href="https://github.com/rust-lang/rust/blob/f47ec2ad5b6887b3d400aee49e2294bd27733d18/src/librustc/infer/lexical_region_resolve/mod.rs#L415-L434" target="_blank" title="https://github.com/rust-lang/rust/blob/f47ec2ad5b6887b3d400aee49e2294bd27733d18/src/librustc/infer/lexical_region_resolve/mod.rs#L415-L434">here</a> to mark the var in error to collect later.</p>



<a name="158560398"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158560398" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158560398">(Feb 14 2019 at 20:09)</a>:</h4>
<p>So, I get the following log:<br>
<code>Expanding value of '_#4r from RePlaceholder(Placeholder { universe: U6, name: BrNamed(crate0:DefIndex(1:10), 'a) }) to ReStatic</code><br>
the question is, what is causing that :)</p>



<a name="158560749"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158560749" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158560749">(Feb 14 2019 at 20:13)</a>:</h4>
<p>is there a chain like '4: '2: '1: '0 ?</p>



<a name="158561457"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158561457" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158561457">(Feb 14 2019 at 20:23)</a>:</h4>
<p>wait I think I see</p>



<a name="158561478"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158561478" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158561478">(Feb 14 2019 at 20:23)</a>:</h4>
<p>I thought you were logging in <code>expand_node</code>, but the log code you pasted looks like it's in <code>collect_error_for_expanding_node</code></p>



<a name="158561594"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158561594" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158561594">(Feb 14 2019 at 20:24)</a>:</h4>
<p>I bet if you log on the conditional in <code>expand_node</code> (I linked to above), you will see <code>'_#4r</code> cannot name our placeholder at first</p>



<a name="158561965"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158561965" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158561965">(Feb 14 2019 at 20:30)</a>:</h4>
<p>yeah maybe indeed — I was thinking all these mutations would have made 'static  show up in the lower/upper bounds in <code>collect_error_for_expanding_node</code>, but apparently not. I'll have to check this more closely tomorrow.... (I'm in Europe, so "tomorrow" is a bit sooner than one might think :)</p>



<a name="158617618"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158617618" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158617618">(Feb 15 2019 at 14:29)</a>:</h4>
<p>how I understand this: <a href="https://gist.github.com/lqd/c75f840c6606f5e45fc10b0d5b07c478" target="_blank" title="https://gist.github.com/lqd/c75f840c6606f5e45fc10b0d5b07c478">lexical_resolve_region log</a> there are RegSubVar/VarSubReg constraints between <code>'_#4r</code> and the placeholder, there are VarSubVar constraints between <code>'_#4r</code> and <code>'_#2r</code>. <code>'_#4r</code> is indeed in U6, as is the placeholder, so the universe can be named.  However, <code>'_#2r</code> is in U4 and can't name U6. This expands <code>'_#2r</code> to 'static, in turn updating <code>'_#4r</code> to 'static. We cannot verify that <code>'_#4r</code> &lt;= the placeholder, and is the error we'll want to emit later. In <code>collect_error_for_expanding_node</code> we look for the two regions R1, R2 where <code>R2: X: R1</code> but <code>R2: R1</code> is false. In our case, R1 == R2 == the placeholder, X is 'static, the placeholder being in the same universe as the var in error <code>'_#4r</code>, and there is no such lower and upper bound creating the SubSupConflict (so this is where we ICE). Does that kind of make sense <span class="user-mention" data-user-id="116009">@nikomatsakis</span>  ?</p>



<a name="158622699"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158622699" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158622699">(Feb 15 2019 at 15:35)</a>:</h4>
<p>however since these specific regions are not in conflict, which error we <em>should emit</em> is more of a mystery to me</p>



<a name="158643871"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158643871" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158643871">(Feb 15 2019 at 19:51)</a>:</h4>
<p><span class="user-mention" data-user-id="116113">@lqd</span> ps sorry I will try to read that shortly :)</p>



<a name="158861111"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158861111" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158861111">(Feb 19 2019 at 09:19)</a>:</h4>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span>  salut Felix :) IIRC you're familiar with AST borrowck pre-Universes ? would you happen to know what kind of error <a href="https://github.com/rust-lang/rust/issues/58451" target="_blank" title="https://github.com/rust-lang/rust/issues/58451">#58451</a> is supposed to produce (instead of ICE-ing). I've summarized my understanding in this thread (just the message before this one) and there's more information from earlier with Tyler and Niko. In this particular situation, the lower and upper bounds do not conflict but there still needs to be an error of some kind (and IIRC blindly pushing a SubSupConflict error for the non-conflicting regions does not produce a UI error, so I'd assume it's filtered somewhere down the line and is a direction I could investigate for sure). If you happen to have ideas I could try or look up it'd be awesome</p>



<a name="158863579"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158863579" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158863579">(Feb 19 2019 at 09:43)</a>:</h4>
<p>I'll try to look</p>



<a name="158863745"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158863745" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158863745">(Feb 19 2019 at 09:44)</a>:</h4>
<p>thanks a bunch</p>



<a name="158863776"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158863776" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158863776">(Feb 19 2019 at 09:44)</a>:</h4>
<p>I take it you are not interesting the actual diagnostic that used to be produced</p>



<a name="158863803"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158863803" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158863803">(Feb 19 2019 at 09:44)</a>:</h4>
<p>since you can readily observe that via the stable channel</p>



<a name="158864145"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158864145" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158864145">(Feb 19 2019 at 09:47)</a>:</h4>
<p>I can observe the older output but not easily infer how to reproduce it post-Universes (or in general, with my current knowledge of rustc)</p>



<a name="158864507"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158864507" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158864507">(Feb 19 2019 at 09:49)</a>:</h4>
<p>I can surely investigate more in that direction by rebuilding an older rustc, if that's what you're proposing ?</p>



<a name="158864772"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158864772" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158864772">(Feb 19 2019 at 09:51)</a>:</h4>
<p>that would indeed show more details on the error we used to produce if we wanted/needed to duplicate it</p>



<a name="158865077"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158865077" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158865077">(Feb 19 2019 at 09:53)</a>:</h4>
<p>I suppose having a locally-built older rustc is certainly a straight-forward step, assuming you have spare hardware (cycles+memory) around to dedicate to that task.</p>



<a name="158865539"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158865539" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158865539">(Feb 19 2019 at 09:56)</a>:</h4>
<p>I can try yeah, it's gonna take a while ofc, so I was hoping to avoid it as long as I could. I guess it can't be helped if we want to reproduce the same exact error, which I didn't know was what we needed (or if that's "possible")</p>



<a name="158866109"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158866109" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158866109">(Feb 19 2019 at 10:00)</a>:</h4>
<p>alright I'll see what I can do with this, thanks <span class="user-mention" data-user-id="116083">@pnkfelix</span></p>



<a name="158873453"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158873453" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158873453">(Feb 19 2019 at 11:20)</a>:</h4>
<p><span class="user-mention" data-user-id="116113">@lqd</span> I <strong>finally</strong> your update. Yes, that sounds like exactly what I expected, and I think perhaps reveals the flaw in the existing algorithm. Well, one caveat. You wrote this:</p>
<blockquote>
<p>we look for the two regions R1, R2 where <code>R2: X: R1</code> but <code>R2: R1</code> is false. In our case, R1 == R2 == the placeholder, X is 'static</p>
</blockquote>
<p>but I think <code>X</code> here is always going to be some <strong>inference variable whose current value is <code>'static</code></strong>, does that sound right?</p>



<a name="158873476"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158873476" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158873476">(Feb 19 2019 at 11:21)</a>:</h4>
<p>yeah</p>



<a name="158873499"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158873499" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158873499">(Feb 19 2019 at 11:21)</a>:</h4>
<p>I think how I might extend the algorithm would be to say that if a "predecessor" of <code>X</code> (i.e., some lower bound) is a placeholder in a universe that <code>X</code> cannot name, then when we are testing for a predecessor that is greater than a successor (i.e., an upper bound), we test instead for <code>'static</code></p>



<a name="158873503"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158873503" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158873503">(Feb 19 2019 at 11:21)</a>:</h4>
<p>at least in this specific configuration of placeholder bounds I mean</p>



<a name="158873505"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158873505" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158873505">(Feb 19 2019 at 11:21)</a>:</h4>
<p>does that make sense?</p>



<a name="158873558"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158873558" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158873558">(Feb 19 2019 at 11:22)</a>:</h4>
<p>I've not looked at the code itself just now to assess how easy/hard that would be</p>



<a name="158873580"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158873580" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158873580">(Feb 19 2019 at 11:23)</a>:</h4>
<p>would another VarSubVar constraint like we have here between '_#4r and '_#2r be considered a precedessor ?</p>



<a name="158873609"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158873609" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158873609">(Feb 19 2019 at 11:23)</a>:</h4>
<p>since this is the one turning X ('_#4r) into 'static while still being able to name the bounds' universe</p>



<a name="158873830"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158873830" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158873830">(Feb 19 2019 at 11:26)</a>:</h4>
<blockquote>
<p>would another VarSubVar constraint like we have here between '_#4r and '_#2r be considered a precedessor ?</p>
</blockquote>
<p>ok I see</p>



<a name="158873834"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158873834" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158873834">(Feb 19 2019 at 11:26)</a>:</h4>
<p>it would not I thnk</p>



<a name="158873844"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158873844" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158873844">(Feb 19 2019 at 11:26)</a>:</h4>
<p>though we could change that</p>



<a name="158873851"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158873851" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158873851">(Feb 19 2019 at 11:26)</a>:</h4>
<p>and indeed this may be the thing to do</p>



<a name="158873860"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158873860" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158873860">(Feb 19 2019 at 11:26)</a>:</h4>
<p>that is, I think right now we walk the graph until we encounter constraints that are NOT from variables</p>



<a name="158873864"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158873864" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158873864">(Feb 19 2019 at 11:26)</a>:</h4>
<p>but we might have to think more carefully about var-var edges</p>



<a name="158873958"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158873958" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158873958">(Feb 19 2019 at 11:28)</a>:</h4>
<p>I'll look at the graph walking more carefully as I seem to remember some traversal due to VarSubVar constraints but can't remember more; and this is where it might be more interesting indeed to look at them to see if they should be terminal</p>



<a name="158874110"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/158874110" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#158874110">(Feb 19 2019 at 11:31)</a>:</h4>
<p>sweet, thanks Niko</p>



<a name="159070945"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/159070945" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#159070945">(Feb 21 2019 at 14:22)</a>:</h4>
<p>so <a href="https://github.com/rust-lang/rust/issues/58592" target="_blank" title="https://github.com/rust-lang/rust/issues/58592">#58592</a> will fix this ICE, but I did have a WIP fix <a href="https://github.com/lqd/rust/commit/4bb206023931b8c29eb93f9a33a7565ca39bad9f" target="_blank" title="https://github.com/lqd/rust/commit/4bb206023931b8c29eb93f9a33a7565ca39bad9f">here</a>. I'm not happy with it yet as it's very ad-hoc and specific to this issue. I'll work to generalize it so we can use it if/when the leak check revival is removed again, but at least tests currently pass with this fix. The error now generated for the code in the issue is ignored later anyway (the infcx is "tainted").</p>



<a name="159071081"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358451%20ICE%20related%20to%20lifetimes%20and%20traits/near/159071081" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358451.20ICE.20related.20to.20lifetimes.20and.20traits.html#159071081">(Feb 21 2019 at 14:24)</a>:</h4>
<p>it does have this artful diagram tho</p>
<div class="codehilite"><pre><span></span>       +--------+
       v        |
       &#39;1 +---&gt; &#39;2 +---&gt; &#39;!1
                ^         |
                +---------+
</pre></div>


<p>so at least there's that :)</p>



<hr><p>Last updated: Aug 07 2021 at 22:04 UTC</p>
</html>