<html>
<head><meta charset="utf-8"><title>chalk: inference with projection fails · wg-traits · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/index.html">wg-traits</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.3A.20inference.20with.20projection.20fails.html">chalk: inference with projection fails</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="273862628"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%3A%20inference%20with%20projection%20fails/near/273862628" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.3A.20inference.20with.20projection.20fails.html#273862628">(Mar 02 2022 at 19:22)</a>:</h4>
<p>I'm trying to debug why inferring the type for <code>y</code>  fails with chalk:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">trait</span><span class="w"> </span><span class="n">Get</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">Value</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">struct</span> <span class="nc">Struct</span><span class="p">;</span><span class="w"></span>
<span class="k">impl</span><span class="w"> </span><span class="n">Get</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Struct</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">Value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">isize</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">grab</span><span class="o">&lt;</span><span class="n">T</span>: <span class="nc">Get</span><span class="o">&gt;</span><span class="p">(</span><span class="n">x</span>: <span class="nc">T</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="o">&lt;</span><span class="n">T</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Get</span><span class="o">&gt;</span>::<span class="n">Value</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">loop</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Struct</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">grab</span><span class="p">(</span><span class="n">s</span><span class="p">);</span><span class="w"> </span><span class="c1">// error[E0282]: type annotations needed for `_#2t`</span>
<span class="w">    </span><span class="c1">//  ^ consider giving `y` the explicit type `_#2t`, where the type parameter `_#3t` is specified</span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>I think I've narrowed it down to this solver call returning no guidance: </p>
<div class="codehilite"><pre><span></span><code>│ │ │ │ │ ├─ DEBUG rustc_traits::chalk lowered_goal=UCanonical { canonical: Canonical { value: InEnvironment { environment: Env([]), goal: ForAll[] { AliasEq(projection: AssocTypeId(DefId(0:4 ~ associated_types_in_fn[b8ba]::Get::Value)) [Ty(AdtId(Struct)&lt;[]&gt;)] = ^1.0) } }, binders: [U0 with kind type] }, universes: 1 }
│ │ │ │ │ ├─ DEBUG rustc_traits::chalk evaluate goal, obligation=Canonical { max_universe: U0, variables: [CanonicalVarInfo { kind: Ty(General(U0)) }], value: ChalkEnvironmentAndGoal { environment: [], goal: Binder(ProjectionPredicate(ProjectionTy { substs: [Struct], item_def_id: DefId(0:4 ~ associated_types_in_fn[b8ba]::Get::Value) }, Ty(^1_0)), []) } }, solution=Some(Ambig(Unknown))
</code></pre></div>
<p>It seems to methat has enough info to deduce <code>^1_0 = isize</code>, right?</p>



<a name="273862738"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%3A%20inference%20with%20projection%20fails/near/273862738" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.3A.20inference.20with.20projection.20fails.html#273862738">(Mar 02 2022 at 19:23)</a>:</h4>
<p>Likely <a href="https://github.com/rust-lang/chalk/issues/234">chalk#234</a></p>



<a name="273864882"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%3A%20inference%20with%20projection%20fails/near/273864882" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.3A.20inference.20with.20projection.20fails.html#273864882">(Mar 02 2022 at 19:38)</a>:</h4>
<p>hmm I can repro in the REPL, did I do it right? </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">trait</span><span class="w"> </span><span class="n">Get</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">Value</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">struct</span> <span class="nc">Struct</span><span class="p">{}</span><span class="w"></span>
<span class="k">impl</span><span class="w"> </span><span class="n">Get</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Struct</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">Value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">isize</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// ?- exists&lt;T&gt; { &lt;Struct as Get&gt;::Value = T }</span>
<span class="c1">// Ambiguous; no inference guidance</span>
</code></pre></div>



<a name="273864959"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%3A%20inference%20with%20projection%20fails/near/273864959" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.3A.20inference.20with.20projection.20fails.html#273864959">(Mar 02 2022 at 19:39)</a>:</h4>
<p>this example seems much simpler than the one in <a href="https://github.com/rust-lang/chalk/issues/234">chalk#234</a> though...?</p>



<a name="273865164"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%3A%20inference%20with%20projection%20fails/near/273865164" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.3A.20inference.20with.20projection.20fails.html#273865164">(Mar 02 2022 at 19:40)</a>:</h4>
<p>It's because we get <code>(Get::Value)&lt;Struct&gt;</code> and <code>isize</code> as answers</p>



<a name="273872462"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%3A%20inference%20with%20projection%20fails/near/273872462" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.3A.20inference.20with.20projection.20fails.html#273872462">(Mar 02 2022 at 20:33)</a>:</h4>
<p>welp I guess I didn't pick an easy one then :(<br>
Has there been any new developments on how to proceed other than what's written in the issue, or is it still unclear? It does work with the recursive solver, is the plan to switch to that?</p>



<a name="273872531"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%3A%20inference%20with%20projection%20fails/near/273872531" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.3A.20inference.20with.20projection.20fails.html#273872531">(Mar 02 2022 at 20:34)</a>:</h4>
<p>There aren't any new developments - even though I'm getting antsy to get back to it.</p>



<a name="273872599"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%3A%20inference%20with%20projection%20fails/near/273872599" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.3A.20inference.20with.20projection.20fails.html#273872599">(Mar 02 2022 at 20:34)</a>:</h4>
<p>If you want, it might be worth just trying to switch to the recursive solver.</p>



<a name="273872746"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%3A%20inference%20with%20projection%20fails/near/273872746" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.3A.20inference.20with.20projection.20fails.html#273872746">(Mar 02 2022 at 20:35)</a>:</h4>
<p>add a <code>-Zchalk-solver=recursive</code> flag to rustc?</p>



<a name="273873249"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%3A%20inference%20with%20projection%20fails/near/273873249" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.3A.20inference.20with.20projection.20fails.html#273873249">(Mar 02 2022 at 20:39)</a>:</h4>
<p>Well, that could be one way. Or just switch</p>



<a name="273876279"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%3A%20inference%20with%20projection%20fails/near/273876279" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.3A.20inference.20with.20projection.20fails.html#273876279">(Mar 02 2022 at 21:00)</a>:</h4>
<p>hmm, it makes 2 tests hang and 1 fail</p>
<div class="codehilite"><pre><span></span><code>test [ui] ui/chalkify/lower_env2.rs has been running for over 60 seconds
test [ui] ui/chalkify/lower_trait_where_clause.rs has been running for over 60 seconds

---- [ui] ui/chalkify/lower_impl.rs stdout ----

error: test compilation failed although it shouldn&#39;t!
status: exit status: 1
command: &quot;/home/dirbaio/rust/build/x86_64-unknown-linux-gnu/stage1/bin/rustc&quot; &quot;/home/dirbaio/rust/src/test/ui/chalkify/lower_impl.rs&quot; &quot;-Zthreads=1&quot; &quot;--target=x86_64-unknown-linux-gnu&quot; &quot;--error-format&quot; &quot;json&quot; &quot;--json&quot; &quot;future-incompat&quot; &quot;-Ccodegen-units=1&quot; &quot;-Zui-testing&quot; &quot;-Zdeduplicate-diagnostics=no&quot; &quot;--emit&quot; &quot;metadata&quot; &quot;-C&quot; &quot;prefer-dynamic&quot; &quot;--out-dir&quot; &quot;/home/dirbaio/rust/build/x86_64-unknown-linux-gnu/test/ui/chalkify/lower_impl&quot; &quot;-A&quot; &quot;unused&quot; &quot;-Crpath&quot; &quot;-O&quot; &quot;-Cdebuginfo=0&quot; &quot;-Lnative=/home/dirbaio/rust/build/x86_64-unknown-linux-gnu/native/rust-test-helpers&quot; &quot;-Z&quot; &quot;chalk&quot; &quot;-L&quot; &quot;/home/dirbaio/rust/build/x86_64-unknown-linux-gnu/test/ui/chalkify/lower_impl/auxiliary&quot;
stdout: none
--- stderr -------------------------------
error[E0283]: type annotations needed
  --&gt; /home/dirbaio/rust/src/test/ui/chalkify/lower_impl.rs:6:18
   |
LL | impl&lt;T: &#39;static&gt; Foo for T where T: Iterator&lt;Item = i32&gt; { }
   |                  ^^^ cannot infer type for type parameter `T`
   |
   = note: cannot satisfy `T: Foo`

error: aborting due to previous error

For more information about this error, try `rustc --explain E0283`.
------------------------------------------
</code></pre></div>



<a name="273876385"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%3A%20inference%20with%20projection%20fails/near/273876385" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.3A.20inference.20with.20projection.20fails.html#273876385">(Mar 02 2022 at 21:01)</a>:</h4>
<p>Right okay. That sounds about like what it was the last time I tried it</p>



<a name="273876460"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%3A%20inference%20with%20projection%20fails/near/273876460" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.3A.20inference.20with.20projection.20fails.html#273876460">(Mar 02 2022 at 21:02)</a>:</h4>
<p>(We should figure out why its hanging)</p>



<a name="273887448"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%3A%20inference%20with%20projection%20fails/near/273887448" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.3A.20inference.20with.20projection.20fails.html#273887448">(Mar 02 2022 at 22:28)</a>:</h4>
<p>this hangs with an empty program: <code>exists&lt;'a, T&gt; { if(T: 'a) { WellFormed(&amp;'a T) } }</code></p>



<a name="273887539"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%3A%20inference%20with%20projection%20fails/near/273887539" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.3A.20inference.20with.20projection.20fails.html#273887539">(Mar 02 2022 at 22:29)</a>:</h4>
<p>I think that's the cause of these tests hanging</p>



<a name="273887922"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%3A%20inference%20with%20projection%20fails/near/273887922" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.3A.20inference.20with.20projection.20fails.html#273887922">(Mar 02 2022 at 22:32)</a>:</h4>
<p>That hangs with the recursive solver but not SLG?</p>



<a name="273888133"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%3A%20inference%20with%20projection%20fails/near/273888133" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.3A.20inference.20with.20projection.20fails.html#273888133">(Mar 02 2022 at 22:33)</a>:</h4>
<p>yep, with SLG it gives</p>
<div class="codehilite"><pre><span></span><code>?- exists&lt;&#39;a, T&gt; { if(T: &#39;a) { WellFormed(&amp;&#39;a T) } }
Ambiguous; definite substitution for&lt;?U0,?U0&gt; { [?0 := ^0.0, ?1 := &#39;^0.1] }
</code></pre></div>



<a name="273889024"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%3A%20inference%20with%20projection%20fails/near/273889024" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.3A.20inference.20with.20projection.20fails.html#273889024">(Mar 02 2022 at 22:40)</a>:</h4>
<p>these substitutions are weird, they contain no new info. Why are they returned?</p>



<a name="273889123"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%3A%20inference%20with%20projection%20fails/near/273889123" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.3A.20inference.20with.20projection.20fails.html#273889123">(Mar 02 2022 at 22:42)</a>:</h4>
<p>That's exactly correct. It means "this is true for the exact inputs given"</p>



<a name="273889371"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%3A%20inference%20with%20projection%20fails/near/273889371" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.3A.20inference.20with.20projection.20fails.html#273889371">(Mar 02 2022 at 22:43)</a>:</h4>
<p>Well, more precisely it's saying: There might be many solutions, but any solution will use the exact inputs given.</p>



<a name="273889557"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%3A%20inference%20with%20projection%20fails/near/273889557" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.3A.20inference.20with.20projection.20fails.html#273889557">(Mar 02 2022 at 22:45)</a>:</h4>
<p>I see</p>



<a name="273890069"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%3A%20inference%20with%20projection%20fails/near/273890069" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.3A.20inference.20with.20projection.20fails.html#273890069">(Mar 02 2022 at 22:49)</a>:</h4>
<p>It would be definitely good to know why this hangs :)</p>



<a name="273890090"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%3A%20inference%20with%20projection%20fails/near/273890090" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.3A.20inference.20with.20projection.20fails.html#273890090">(Mar 02 2022 at 22:49)</a>:</h4>
<p>This is pretty critical I think</p>



<a name="273912019"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%3A%20inference%20with%20projection%20fails/near/273912019" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.3A.20inference.20with.20projection.20fails.html#273912019">(Mar 03 2022 at 02:22)</a>:</h4>
<p>so, it's hanging here <a href="https://github.com/rust-lang/chalk/blob/master/chalk-recursive/src/fulfill.rs#L448">https://github.com/rust-lang/chalk/blob/master/chalk-recursive/src/fulfill.rs#L448</a></p>



<a name="273912071"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%3A%20inference%20with%20projection%20fails/near/273912071" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.3A.20inference.20with.20projection.20fails.html#273912071">(Mar 03 2022 at 02:23)</a>:</h4>
<div class="codehilite"><pre><span></span><code>            617ms DEBUG start of round, 2 obligations
            prove wc=InEnvironment { environment: Env([for&lt;&gt; ?0: &#39;?1]), goal: ?2: &#39;?3 }
              solve_goal goal=UCanonical { canonical: Canonical { value: InEnvironment { environment: Env([for&lt;&gt; ^1.0: &#39;^1.1]), goal: ^0.0: &#39;^0.1 }, binders: [U0 with kind type, U0 with kind lifetime] }, universes: 1 }
                0ms DEBUG Cache hit, goal=UCanonical { canonical: Canonical { value: InEnvironment { environment: Env([for&lt;&gt; ^1.0: &#39;^1.1]), goal: ^0.0: &#39;^0.1 }, binders: [U0 with kind type, U0 with kind lifetime] }, universes: 1 }, result=Ok(Ambig(Definite(Canonical { value: [?0 := ^0.0, ?1 := &#39;^0.1], binders: [U0 with kind type, U0 with kind lifetime] })))
                0ms DEBUG solve_reduced_goal: cache hit, value=Ok(Ambig(Definite(Canonical { value: [?0 := ^0.0, ?1 := &#39;^0.1], binders: [U0 with kind type, U0 with kind lifetime] })))
            618ms DEBUG fulfill::apply_solution: adding constraints []
            618ms DEBUG unify(?2, ?1140) succeeded
            618ms DEBUG unify: goals=[]
            618ms DEBUG unify(&#39;?3, &#39;?1141) succeeded
            618ms DEBUG unify: goals=[]
            618ms DEBUG ambiguous result: Prove(InEnvironment { environment: Env([for&lt;&gt; ?0: &#39;?1]), goal: ?2: &#39;?3 })
            prove wc=InEnvironment { environment: Env([for&lt;&gt; ?0: &#39;?1]), goal: WellFormed(?2) }
              solve_goal goal=UCanonical { canonical: Canonical { value: InEnvironment { environment: Env([for&lt;&gt; ^1.0: &#39;^1.1]), goal: WellFormed(^0.0) }, binders: [U0 with kind type, U0 with kind lifetime] }, universes: 1 }
                0ms DEBUG Cache hit, goal=UCanonical { canonical: Canonical { value: InEnvironment { environment: Env([for&lt;&gt; ^1.0: &#39;^1.1]), goal: WellFormed(^0.0) }, binders: [U0 with kind type, U0 with kind lifetime] }, universes: 1 }, result=Ok(Ambig(Unknown))
                0ms DEBUG solve_reduced_goal: cache hit, value=Ok(Ambig(Unknown))
            618ms DEBUG ambiguous result: Prove(InEnvironment { environment: Env([for&lt;&gt; ?0: &#39;?1]), goal: WellFormed(?2) })
            618ms DEBUG end of round, 2 obligations left


            618ms DEBUG start of round, 2 obligations
            prove wc=InEnvironment { environment: Env([for&lt;&gt; ?0: &#39;?1]), goal: WellFormed(?2) }
              solve_goal goal=UCanonical { canonical: Canonical { value: InEnvironment { environment: Env([for&lt;&gt; ^1.0: &#39;^1.1]), goal: WellFormed(^0.0) }, binders: [U0 with kind type, U0 with kind lifetime] }, universes: 1 }
                0ms DEBUG Cache hit, goal=UCanonical { canonical: Canonical { value: InEnvironment { environment: Env([for&lt;&gt; ^1.0: &#39;^1.1]), goal: WellFormed(^0.0) }, binders: [U0 with kind type, U0 with kind lifetime] }, universes: 1 }, result=Ok(Ambig(Unknown))
                0ms DEBUG solve_reduced_goal: cache hit, value=Ok(Ambig(Unknown))
            619ms DEBUG ambiguous result: Prove(InEnvironment { environment: Env([for&lt;&gt; ?0: &#39;?1]), goal: WellFormed(?2) })
            prove wc=InEnvironment { environment: Env([for&lt;&gt; ?0: &#39;?1]), goal: ?2: &#39;?3 }
              solve_goal goal=UCanonical { canonical: Canonical { value: InEnvironment { environment: Env([for&lt;&gt; ^1.0: &#39;^1.1]), goal: ^0.0: &#39;^0.1 }, binders: [U0 with kind type, U0 with kind lifetime] }, universes: 1 }
                0ms DEBUG Cache hit, goal=UCanonical { canonical: Canonical { value: InEnvironment { environment: Env([for&lt;&gt; ^1.0: &#39;^1.1]), goal: ^0.0: &#39;^0.1 }, binders: [U0 with kind type, U0 with kind lifetime] }, universes: 1 }, result=Ok(Ambig(Definite(Canonical { value: [?0 := ^0.0, ?1 := &#39;^0.1], binders: [U0 with kind type, U0 with kind lifetime] })))
                0ms DEBUG solve_reduced_goal: cache hit, value=Ok(Ambig(Definite(Canonical { value: [?0 := ^0.0, ?1 := &#39;^0.1], binders: [U0 with kind type, U0 with kind lifetime] })))
            619ms DEBUG fulfill::apply_solution: adding constraints []
            619ms DEBUG unify(?2, ?1142) succeeded
            619ms DEBUG unify: goals=[]
            619ms DEBUG unify(&#39;?3, &#39;?1143) succeeded
            619ms DEBUG unify: goals=[]
            619ms DEBUG ambiguous result: Prove(InEnvironment { environment: Env([for&lt;&gt; ?0: &#39;?1]), goal: ?2: &#39;?3 })
            619ms DEBUG end of round, 2 obligations left


            619ms DEBUG start of round, 2 obligations
            prove wc=InEnvironment { environment: Env([for&lt;&gt; ?0: &#39;?1]), goal: ?2: &#39;?3 }
              solve_goal goal=UCanonical { canonical: Canonical { value: InEnvironment { environment: Env([for&lt;&gt; ^1.0: &#39;^1.1]), goal: ^0.0: &#39;^0.1 }, binders: [U0 with kind type, U0 with kind lifetime] }, universes: 1 }
                0ms DEBUG Cache hit, goal=UCanonical { canonical: Canonical { value: InEnvironment { environment: Env([for&lt;&gt; ^1.0: &#39;^1.1]), goal: ^0.0: &#39;^0.1 }, binders: [U0 with kind type, U0 with kind lifetime] }, universes: 1 }, result=Ok(Ambig(Definite(Canonical { value: [?0 := ^0.0, ?1 := &#39;^0.1], binders: [U0 with kind type, U0 with kind lifetime] })))
                0ms DEBUG solve_reduced_goal: cache hit, value=Ok(Ambig(Definite(Canonical { value: [?0 := ^0.0, ?1 := &#39;^0.1], binders: [U0 with kind type, U0 with kind lifetime] })))
            620ms DEBUG fulfill::apply_solution: adding constraints []
            620ms DEBUG unify(?2, ?1144) succeeded
            620ms DEBUG unify: goals=[]
            620ms DEBUG unify(&#39;?3, &#39;?1145) succeeded
            620ms DEBUG unify: goals=[]
            620ms DEBUG ambiguous result: Prove(InEnvironment { environment: Env([for&lt;&gt; ?0: &#39;?1]), goal: ?2: &#39;?3 })
            prove wc=InEnvironment { environment: Env([for&lt;&gt; ?0: &#39;?1]), goal: WellFormed(?2) }
              solve_goal goal=UCanonical { canonical: Canonical { value: InEnvironment { environment: Env([for&lt;&gt; ^1.0: &#39;^1.1]), goal: WellFormed(^0.0) }, binders: [U0 with kind type, U0 with kind lifetime] }, universes: 1 }
                0ms DEBUG Cache hit, goal=UCanonical { canonical: Canonical { value: InEnvironment { environment: Env([for&lt;&gt; ^1.0: &#39;^1.1]), goal: WellFormed(^0.0) }, binders: [U0 with kind type, U0 with kind lifetime] }, universes: 1 }, result=Ok(Ambig(Unknown))
                0ms DEBUG solve_reduced_goal: cache hit, value=Ok(Ambig(Unknown))
            620ms DEBUG ambiguous result: Prove(InEnvironment { environment: Env([for&lt;&gt; ?0: &#39;?1]), goal: WellFormed(?2) })
            620ms DEBUG end of round, 2 obligations left
</code></pre></div>



<a name="273912319"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%3A%20inference%20with%20projection%20fails/near/273912319" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.3A.20inference.20with.20projection.20fails.html#273912319">(Mar 03 2022 at 02:26)</a>:</h4>
<p>it tries to prove <code>InEnvironment { environment: Env([for&lt;&gt; ?0: '?1]), goal: ?2: '?3 }</code><br>
it gets "useless" substs <code>[?0 := ^0.0, ?1 := '^0.1]</code><br>
it applies them, they cause nothing to change but it thinks they did<br>
so in next round it processes again the exact same obligation...</p>



<a name="273913206"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%3A%20inference%20with%20projection%20fails/near/273913206" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.3A.20inference.20with.20projection.20fails.html#273913206">(Mar 03 2022 at 02:38)</a>:</h4>
<p>are substs always guaranteed to be "useful"?</p>



<a name="273913508"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%3A%20inference%20with%20projection%20fails/near/273913508" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.3A.20inference.20with.20projection.20fails.html#273913508">(Mar 03 2022 at 02:42)</a>:</h4>
<p>Not necessarily</p>



<a name="273913530"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%3A%20inference%20with%20projection%20fails/near/273913530" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.3A.20inference.20with.20projection.20fails.html#273913530">(Mar 03 2022 at 02:43)</a>:</h4>
<p>so the bug is in that loop, it needs a smarter way to check whether we've arrived to a fixed point</p>



<a name="273913582"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%3A%20inference%20with%20projection%20fails/near/273913582" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.3A.20inference.20with.20projection.20fails.html#273913582">(Mar 03 2022 at 02:44)</a>:</h4>
<p>but how?</p>



<a name="273913604"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%3A%20inference%20with%20projection%20fails/near/273913604" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.3A.20inference.20with.20projection.20fails.html#273913604">(Mar 03 2022 at 02:44)</a>:</h4>
<p>Not sure, it's been a bit</p>



<a name="273916060"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%3A%20inference%20with%20projection%20fails/near/273916060" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.3A.20inference.20with.20projection.20fails.html#273916060">(Mar 03 2022 at 03:18)</a>:</h4>
<p>comparing the full <code>Fulfill</code> state won't work, it technically gets mutated (new vars get created then unified)</p>



<a name="273916112"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%3A%20inference%20with%20projection%20fails/near/273916112" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.3A.20inference.20with.20projection.20fails.html#273916112">(Mar 03 2022 at 03:19)</a>:</h4>
<p>I'm thinking something like: if substs are 1-to-1 and there's no constraints, then they're "useless"</p>



<a name="273916191"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%3A%20inference%20with%20projection%20fails/near/273916191" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.3A.20inference.20with.20projection.20fails.html#273916191">(Mar 03 2022 at 03:20)</a>:</h4>
<p>it feels like a hack though</p>



<a name="273916274"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%3A%20inference%20with%20projection%20fails/near/273916274" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.3A.20inference.20with.20projection.20fails.html#273916274">(Mar 03 2022 at 03:22)</a>:</h4>
<p>this <code>if</code> is already kindof a hack <a href="https://github.com/rust-lang/chalk/blob/master/chalk-recursive/src/fulfill.rs#L474">https://github.com/rust-lang/chalk/blob/master/chalk-recursive/src/fulfill.rs#L474</a><br>
this would be a more "powerful" version of it</p>



<a name="273920794"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%3A%20inference%20with%20projection%20fails/near/273920794" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.3A.20inference.20with.20projection.20fails.html#273920794">(Mar 03 2022 at 04:25)</a>:</h4>
<p>it seems to work! :D <a href="https://github.com/rust-lang/chalk/pull/752">https://github.com/rust-lang/chalk/pull/752</a></p>



<a name="273920973"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%3A%20inference%20with%20projection%20fails/near/273920973" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.3A.20inference.20with.20projection.20fails.html#273920973">(Mar 03 2022 at 04:28)</a>:</h4>
<p>That's not quite right I don't think. Should be definite substitution</p>



<a name="273921033"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%3A%20inference%20with%20projection%20fails/near/273921033" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.3A.20inference.20with.20projection.20fails.html#273921033">(Mar 03 2022 at 04:29)</a>:</h4>
<p>yeah I found that suspicious as well.. can this cause an issue in practice?</p>



<a name="273921531"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%3A%20inference%20with%20projection%20fails/near/273921531" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.3A.20inference.20with.20projection.20fails.html#273921531">(Mar 03 2022 at 04:36)</a>:</h4>
<p>why does it have to be definite? it hasn't really learned anything, has it?</p>
<p>it's hitting this <a href="https://github.com/rust-lang/chalk/blob/master/chalk-recursive/src/fulfill.rs#L576">https://github.com/rust-lang/chalk/blob/master/chalk-recursive/src/fulfill.rs#L576</a><br>
if I also put the "trivial" check there then it returns <code>Guidance::Unknown</code> instead, not sure if that's better or worse</p>



<a name="273921997"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%3A%20inference%20with%20projection%20fails/near/273921997" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.3A.20inference.20with.20projection.20fails.html#273921997">(Mar 03 2022 at 04:43)</a>:</h4>
<p>It different, definite means "real" progress. Suggested is "not real"</p>



<a name="273922086"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%3A%20inference%20with%20projection%20fails/near/273922086" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.3A.20inference.20with.20projection.20fails.html#273922086">(Mar 03 2022 at 04:44)</a>:</h4>
<p>but it's returning just "0=0, 1=1", how's that "real" progress?</p>



<a name="273922109"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%3A%20inference%20with%20projection%20fails/near/273922109" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.3A.20inference.20with.20projection.20fails.html#273922109">(Mar 03 2022 at 04:45)</a>:</h4>
<blockquote>
<p><code>Ambiguous; definite substitution for&lt;?U0,?U0&gt; { [?0 := ^0.0, ?1 := '^0.1] }</code></p>
</blockquote>



<a name="273922863"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%3A%20inference%20with%20projection%20fails/near/273922863" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.3A.20inference.20with.20projection.20fails.html#273922863">(Mar 03 2022 at 04:58)</a>:</h4>
<p>Because it literally means "if you use these substs, the answer will be correct"</p>



<a name="273922871"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%3A%20inference%20with%20projection%20fails/near/273922871" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.3A.20inference.20with.20projection.20fails.html#273922871">(Mar 03 2022 at 04:58)</a>:</h4>
<p>Whereas suggested doesn't have that</p>



<a name="273922885"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%3A%20inference%20with%20projection%20fails/near/273922885" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.3A.20inference.20with.20projection.20fails.html#273922885">(Mar 03 2022 at 04:58)</a>:</h4>
<p>(At least in theory, I dont think we've precisely defined these)</p>



<a name="273922892"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%3A%20inference%20with%20projection%20fails/near/273922892" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.3A.20inference.20with.20projection.20fails.html#273922892">(Mar 03 2022 at 04:58)</a>:</h4>
<p>ah, so it's "proven" as in here <a href="https://rust-lang.github.io/chalk/book/canonical_queries.html">https://rust-lang.github.io/chalk/book/canonical_queries.html</a> ?</p>



<a name="273923423"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%3A%20inference%20with%20projection%20fails/near/273923423" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.3A.20inference.20with.20projection.20fails.html#273923423">(Mar 03 2022 at 05:04)</a>:</h4>
<p>I think so</p>



<a name="273924207"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%3A%20inference%20with%20projection%20fails/near/273924207" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.3A.20inference.20with.20projection.20fails.html#273924207">(Mar 03 2022 at 05:17)</a>:</h4>
<p>hmhmhm I don't get it</p>



<a name="273924307"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%3A%20inference%20with%20projection%20fails/near/273924307" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.3A.20inference.20with.20projection.20fails.html#273924307">(Mar 03 2022 at 05:19)</a>:</h4>
<p>as I understand it from the docs here:  <a href="https://github.com/rust-lang/chalk/blob/master/chalk-solve/src/solve.rs#L12">https://github.com/rust-lang/chalk/blob/master/chalk-solve/src/solve.rs#L12</a></p>



<a name="273924652"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%3A%20inference%20with%20projection%20fails/near/273924652" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.3A.20inference.20with.20projection.20fails.html#273924652">(Mar 03 2022 at 05:24)</a>:</h4>
<p><code>Unique(substs)</code> =&gt; Proven, always holds. You can substitute any value in <code>substs</code> and it'll work. <br>
<code>Ambig(Definite(substs))</code> =&gt; Not proven, may or may not hold. However, <code>substs</code> is a logic consequence of the goal, it's guaranteed that all solutions (if any) satisfy <code>substs</code>.<br>
<code>Ambig(Suggested(substs))</code> =&gt; Not proven, may or may not hold. <code>substs</code> is just heuristic guidance, there might be solutions either satisfying <code>substs</code> or not.</p>



<a name="273924697"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%3A%20inference%20with%20projection%20fails/near/273924697" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.3A.20inference.20with.20projection.20fails.html#273924697">(Mar 03 2022 at 05:24)</a>:</h4>
<p>so returning <code>Suggested</code> instead of <code>Definite</code> is still correct, it's just "less useful"...?</p>



<a name="273925556"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%3A%20inference%20with%20projection%20fails/near/273925556" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.3A.20inference.20with.20projection.20fails.html#273925556">(Mar 03 2022 at 05:36)</a>:</h4>
<p>ugh rustc does treat <code>Ambig(Definite(_))</code> as <code>Proven</code> <a href="https://github.com/rust-lang/rust/blob/master/compiler/rustc_traits/src/chalk/mod.rs#L136">here</a>.</p>
<p>I feel like there's something super basic that I'm not understanding, not sure what. Enlightenment would be appreciated <span aria-label="joy" class="emoji emoji-1f602" role="img" title="joy">:joy:</span></p>



<a name="273975703"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%3A%20inference%20with%20projection%20fails/near/273975703" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.3A.20inference.20with.20projection.20fails.html#273975703">(Mar 03 2022 at 13:57)</a>:</h4>
<p><code>Unique</code> is basically "there is one solution and this is it", <code>Definite</code> is "there are many solutions to your query, but these substs are a generalization of them all", <code>Suggestion</code> is "we didn't find a solution, but these substs might get you closer</p>



<a name="273975780"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%3A%20inference%20with%20projection%20fails/near/273975780" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.3A.20inference.20with.20projection.20fails.html#273975780">(Mar 03 2022 at 13:58)</a>:</h4>
<p>Looking at the recursive code bit you linked, maybe that should be <code>Definite</code></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>