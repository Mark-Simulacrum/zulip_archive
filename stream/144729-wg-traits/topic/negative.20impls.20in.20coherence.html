<html>
<head><meta charset="utf-8"><title>negative impls in coherence · wg-traits · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/index.html">wg-traits</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html">negative impls in coherence</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="241074988"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/241074988" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#241074988">(Jun 01 2021 at 21:00)</a>:</h4>
<p><span class="user-mention" data-user-id="220273">@Jane Lusby</span> I'm making this topic for us to talk further</p>



<a name="241075462"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/241075462" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#241075462">(Jun 01 2021 at 21:04)</a>:</h4>
<p><span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="241075801"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/241075801" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#241075801">(Jun 01 2021 at 21:07)</a>:</h4>
<p>to help with continuity<br>
previous convo: <a href="#narrow/stream/131828-t-compiler/topic/conflicting.20impls">https://rust-lang.zulipchat.com/#narrow/stream/131828-t-compiler/topic/conflicting.20impls</a><br>
notes: <a href="https://hackmd.io/@nikomatsakis/HJLd4WE9O">https://hackmd.io/@nikomatsakis/HJLd4WE9O</a></p>



<a name="241075854"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/241075854" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#241075854">(Jun 01 2021 at 21:08)</a>:</h4>
<p>WIP PR: <a href="https://github.com/rust-lang/rust/pull/85764">https://github.com/rust-lang/rust/pull/85764</a></p>



<a name="241076069"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/241076069" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#241076069">(Jun 01 2021 at 21:09)</a>:</h4>
<p>the other question, which we didn't touch on, is what is needed from the lang team side</p>



<a name="241076108"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/241076108" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#241076108">(Jun 01 2021 at 21:10)</a>:</h4>
<p>I'm not sure!</p>



<a name="241076334"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/241076334" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#241076334">(Jun 01 2021 at 21:12)</a>:</h4>
<p>I think I will create a project propsal</p>



<a name="241076914"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/241076914" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#241076914">(Jun 01 2021 at 21:16)</a>:</h4>
<p><a href="https://github.com/rust-lang/lang-team/issues/96">https://github.com/rust-lang/lang-team/issues/96</a></p>



<a name="241077848"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/241077848" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#241077848">(Jun 01 2021 at 21:23)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence/near/241076914">said</a>:</p>
<blockquote>
<p><a href="https://github.com/rust-lang/lang-team/issues/96">https://github.com/rust-lang/lang-team/issues/96</a></p>
</blockquote>
<p>blessed, ty</p>



<a name="241077911"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/241077911" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#241077911">(Jun 01 2021 at 21:24)</a>:</h4>
<p>minor typo in the motivating examples</p>



<a name="241077931"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/241077931" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#241077931">(Jun 01 2021 at 21:24)</a>:</h4>
<p>should be <code>From&lt;&amp;str&gt; for Box&lt;dyn Error&gt;</code> but it's reversed</p>



<a name="241078132"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/241078132" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#241078132">(Jun 01 2021 at 21:26)</a>:</h4>
<p>ah yeah</p>



<a name="241089407"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/241089407" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#241089407">(Jun 01 2021 at 23:41)</a>:</h4>
<p>part of the idea with the new PredicateKind is to change existing negative impls that used to get exposed in <code>predicates</code> as <code>PredicateKind::Trait</code> to <code>PredicateKind::NotTrait</code> right? As in it's not just to have the representation available so we can invert actual impls when doing the overlap check.</p>



<a name="241089513"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/241089513" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#241089513">(Jun 01 2021 at 23:43)</a>:</h4>
<p>trying to figure out what "teach the trait checker to prove <code>T: !Trait</code> if there are negative impls" entails and starting with making it so negative impls show up as <code>PredicateKind::NotTrait</code> in <code>overlap_within_probe</code></p>



<a name="241089933"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/241089933" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#241089933">(Jun 01 2021 at 23:49)</a>:</h4>
<p>ended up digging pretty deep into <a href="http://collect.rs">collect.rs</a> but started to second guess by the time I got to <code>gather_explicit_predicates_of</code></p>



<a name="241145952"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/241145952" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#241145952">(Jun 02 2021 at 13:11)</a>:</h4>
<p><span class="user-mention" data-user-id="220273">@Jane Lusby</span> I hadn't quite figured out what shape I thought that should have</p>



<a name="241145976"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/241145976" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#241145976">(Jun 02 2021 at 13:11)</a>:</h4>
<p>this is also connected (a bit) to the semantics of auto traits and negative impls</p>



<a name="241145990"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/241145990" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#241145990">(Jun 02 2021 at 13:11)</a>:</h4>
<p>something that <span class="user-mention" data-user-id="216206">@lcnr</span> and I were discussing recently</p>



<a name="241146037"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/241146037" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#241146037">(Jun 02 2021 at 13:12)</a>:</h4>
<p>I think my expectation is that we would not change <a href="http://collect.rs">collect.rs</a></p>



<a name="241146058"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/241146058" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#241146058">(Jun 02 2021 at 13:12)</a>:</h4>
<p>I would expect to change how we manage candidates a bit</p>



<a name="241146255"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/241146255" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#241146255">(Jun 02 2021 at 13:13)</a>:</h4>
<p>I'm pulling up the relevant code</p>



<a name="241146489"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/241146489" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#241146489">(Jun 02 2021 at 13:15)</a>:</h4>
<p>basically, where <code>candidate_from_obligation_no_cache</code> invokes <code>filter_negative_and_reservation_impls</code> and so forth</p>



<a name="241146501"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/241146501" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#241146501">(Jun 02 2021 at 13:15)</a>:</h4>
<p>I think we might tweak this a bit</p>



<a name="241146517"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/241146517" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#241146517">(Jun 02 2021 at 13:15)</a>:</h4>
<p>so that there is a "negative candidate" and a "positive candidate" function</p>



<a name="241146586"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/241146586" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#241146586">(Jun 02 2021 at 13:16)</a>:</h4>
<p>it's still a bit odd that we assemble both polarities together into one list, but I think it's "ok"</p>



<a name="241595032"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/241595032" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#241595032">(Jun 04 2021 at 21:24)</a>:</h4>
<p>hmm, went to do this but I'm a bit confused. I don't understand how <code>overlap_within_probe</code> is related to <code>candidate_from_obligation_no_cache</code> or how messing with the candidates in the latter will affect the predicates exposed in the latter</p>



<a name="241595977"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/241595977" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#241595977">(Jun 04 2021 at 21:36)</a>:</h4>
<p>okay so, I think I found the connection, obvious in retrospect, <code>candidate_from_obligation</code> is a method on SelectionContext which is an arg in <code>overlap_within_probe</code></p>



<a name="241596514"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/241596514" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#241596514">(Jun 04 2021 at 21:43)</a>:</h4>
<p>I think it has to be via <code>predicate_may_hold_fatal</code> but I still haven't figured out how that ends up calling <code>select</code></p>



<a name="241597217"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/241597217" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#241597217">(Jun 04 2021 at 21:51)</a>:</h4>
<p>tried tracing backwards through the callers of <code>predicate_may_hold_fatal</code> but dead ended at the <code>FulfillmentContext::select</code></p>



<a name="241597772"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/241597772" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#241597772">(Jun 04 2021 at 21:58)</a>:</h4>
<p>oh shit i think I found it in InferContext</p>



<a name="241598262"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/241598262" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#241598262">(Jun 04 2021 at 22:04)</a>:</h4>
<p>well, maybe not, but I have a better idea of how they relate, if not understanding the exact series of calls from one to the other</p>



<a name="241598736"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/241598736" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#241598736">(Jun 04 2021 at 22:07)</a>:</h4>
<p>oh my god, I think i get it, I'm negating the obligation which is an input into candidate_from_obligation</p>



<a name="241598944"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/241598944" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#241598944">(Jun 04 2021 at 22:09)</a>:</h4>
<p>wait so is the idea that we'd have a <code>filter_negative_and_reservation_impls</code> and a <code>filter_positive_and_reservation_impls</code> and when the obligation has been negated we call the <code>filter_positive</code> version instead of <code>filter_negative</code>?</p>



<a name="242783080"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/242783080" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#242783080">(Jun 15 2021 at 19:03)</a>:</h4>
<p><span class="user-mention" data-user-id="220273">@Jane Lusby</span> sorry, last week I was basically afk all week, how are you doing here?</p>



<a name="242785254"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/242785254" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#242785254">(Jun 15 2021 at 19:19)</a>:</h4>
<p>Haven't picked it back up since my last msgs</p>



<a name="245351664"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/245351664" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#245351664">(Jul 08 2021 at 18:22)</a>:</h4>
<p>finally picking this back up again</p>



<a name="245360405"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/245360405" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#245360405">(Jul 08 2021 at 19:32)</a>:</h4>
<p>we should probably find some good time to chat about it</p>



<a name="245366452"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/245366452" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#245366452">(Jul 08 2021 at 20:18)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence/near/245360405">said</a>:</p>
<blockquote>
<p>we should probably find some good time to chat about it</p>
</blockquote>
<p>my day is wide open today if you have time</p>



<a name="245441640"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/245441640" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#245441640">(Jul 09 2021 at 13:17)</a>:</h4>
<p><span class="user-mention" data-user-id="220273">@Jane Lusby</span> is your day open today? Otherwise, let's schedule a time next week</p>



<a name="245441656"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/245441656" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#245441656">(Jul 09 2021 at 13:17)</a>:</h4>
<p>I'm not sure about today, it's starting to fill up</p>



<a name="245441853"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/245441853" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#245441853">(Jul 09 2021 at 13:18)</a>:</h4>
<p>Today's my "commute to the office day" so not really open</p>



<a name="245441884"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/245441884" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#245441884">(Jul 09 2021 at 13:19)</a>:</h4>
<p>My Monday next week is pretty open though</p>



<a name="246165721"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/246165721" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#246165721">(Jul 15 2021 at 22:49)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> I changed up <a href="https://github.com/rust-lang/rust/pull/85764/">https://github.com/rust-lang/rust/pull/85764/</a> to properly negate the obligation and to thread the polarity through as a member rather than an alternate PredicateKind</p>



<a name="246165761"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/246165761" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#246165761">(Jul 15 2021 at 22:49)</a>:</h4>
<p>and now im getting ready to setup the inverse of <code>filter_negative_and_reservation_impls</code> and thread the polarity through the <code>TraitPredicate</code></p>



<a name="246165779"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/246165779" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#246165779">(Jul 15 2021 at 22:49)</a>:</h4>
<p>and I'm unsure of where exactly I should put the polarity</p>



<a name="246165786"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/246165786" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#246165786">(Jul 15 2021 at 22:49)</a>:</h4>
<p>my guesses are either in the <code>TraitPredicate</code> or in the <code>TraitRef</code></p>



<a name="246165792"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/246165792" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#246165792">(Jul 15 2021 at 22:49)</a>:</h4>
<p>but not sure which one to pick</p>



<a name="246166187"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/246166187" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#246166187">(Jul 15 2021 at 22:54)</a>:</h4>
<p>gonna put it in traitpredicate</p>



<a name="246166190"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/246166190" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#246166190">(Jul 15 2021 at 22:54)</a>:</h4>
<p>seems more appropriate</p>



<a name="246166193"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/246166193" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#246166193">(Jul 15 2021 at 22:54)</a>:</h4>
<p>yoloo</p>



<a name="246232601"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/246232601" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#246232601">(Jul 16 2021 at 14:46)</a>:</h4>
<p><span class="user-mention" data-user-id="220273">@Jane Lusby</span> that is correct</p>



<a name="246232620"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/246232620" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#246232620">(Jul 16 2021 at 14:46)</a>:</h4>
<p>TraitRef is a more "primitive" concept</p>



<a name="246232638"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/246232638" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#246232638">(Jul 16 2021 at 14:46)</a>:</h4>
<p><code>TraitPredicate</code> is <em>perfect</em></p>



<a name="246232656"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/246232656" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#246232656">(Jul 16 2021 at 14:47)</a>:</h4>
<p>TraitPredicate is basically "what you want to prove" -- either that the trait <em>is</em> or <em>is not</em> implemented</p>



<a name="246254685"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/246254685" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#246254685">(Jul 16 2021 at 17:35)</a>:</h4>
<p>perfect. Okay then I think I have that sorted already, there's a lot of places where I wasn't sure how to properly thread in the Polarity so I defaulted it to just assuming positive. The place that I saw it was creating a TraitPredicate from a PredicateKind I used the existing polarity and I'm hoping that's the only place I actually needed to thread it through. Other than that I think I may only need to setup the inverted <code>filter_negative_and_reservation_impls</code> but I'm currently unclear on how exactly to implement that and need to get a better understanding of the existing logic and what each of the return paths mean in practice.</p>



<a name="246308254"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/246308254" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#246308254">(Jul 17 2021 at 06:24)</a>:</h4>
<p><span class="user-mention" data-user-id="220273">@Jane Lusby</span> that sounds <em>reasonable</em>, at least at first glance</p>



<a name="246308281"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/246308281" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#246308281">(Jul 17 2021 at 06:25)</a>:</h4>
<p>I am imagining that this becomes <code>filter_reserved_or_opposite_polarity_impls</code> -- but the question is, did you also add the polarity into the <code>TraitObligationStack</code> somewhere?</p>



<a name="258998890"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/258998890" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#258998890">(Oct 25 2021 at 18:15)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span>, <span class="user-mention" data-user-id="211722">@Yoshua Wuyts [he/they]</span> was trying negative impls out</p>



<a name="258998895"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/258998895" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#258998895">(Oct 25 2021 at 18:15)</a>:</h4>
<p>they did <a href="https://github.com/yoshuawuyts/rust/commit/591477bd50176fb248a1913b42682bfa21a81b9c">https://github.com/yoshuawuyts/rust/commit/591477bd50176fb248a1913b42682bfa21a81b9c</a></p>



<a name="258999049"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/258999049" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#258999049">(Oct 25 2021 at 18:16)</a>:</h4>
<p>they wanted to enable:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Termination</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">F</span><span class="w"></span>
<span class="k">where</span><span class="w"></span>
<span class="w">    </span><span class="n">T</span>: <span class="nc">Termination</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">F</span>: <span class="nc">Future</span><span class="o">&lt;</span><span class="n">Output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
</code></pre></div>
<p>by doing:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">impl</span><span class="w"> </span><span class="o">!</span><span class="n">Future</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
</code></pre></div>
<p>So they don't get:</p>
<div class="codehilite" data-code-language="Text only"><pre><span></span><code>error[E0119]: conflicting implementations of trait `process::Termination` for type `()`
    --&gt; library\std\src\process.rs:2064:1
     |
2022 |   impl Termination for () {
     |   ----------------------- first implementation
here
...
2064 | / impl&lt;T, F&gt; Termination for F
2065 | | where
2066 | |     T: Termination,
2067 | |     F: Future&lt;Output = T&gt;,
...    |
2113 | |     }
2114 | | }
     | |_^ conflicting implementation for `()`
</code></pre></div>



<a name="258999470"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/258999470" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#258999470">(Oct 25 2021 at 18:19)</a>:</h4>
<p>I'm not sure why this is going on</p>



<a name="258999532"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/258999532" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#258999532">(Oct 25 2021 at 18:19)</a>:</h4>
<p>but <span class="user-mention" data-user-id="211722">@Yoshua Wuyts [he/they]</span> added a <code>!Future</code> impl which I don't think it's related to this error</p>



<a name="258999565"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/258999565" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#258999565">(Oct 25 2021 at 18:20)</a>:</h4>
<p>in this case <code>()</code> is an specialization of the general implementation they've added</p>



<a name="258999616"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/258999616" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#258999616">(Oct 25 2021 at 18:20)</a>:</h4>
<p>but unsure what's going on</p>



<a name="259002763"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259002763" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259002763">(Oct 25 2021 at 18:44)</a>:</h4>
<p>Is your new logic already in the bootstrap compiler?</p>



<a name="259017662"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259017662" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259017662">(Oct 25 2021 at 20:41)</a>:</h4>
<p>ohhh right :)</p>



<a name="259063097"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259063097" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259063097">(Oct 26 2021 at 07:56)</a>:</h4>
<p>Oh, so if I'm understanding things correctly this is likely just going to be able to work in the near future?</p>



<a name="259063239"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259063239" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259063239">(Oct 26 2021 at 07:58)</a>:</h4>
<p>Well, assuming what I did is right (:</p>



<a name="259075098"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259075098" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259075098">(Oct 26 2021 at 10:07)</a>:</h4>
<p>you can make it work right now, you just need to gate all your changes with #[cfg(not(bootstrap))] so they'll only get built with the stage1 compiler instead of the bootstrap compiler</p>



<a name="259075139"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259075139" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259075139">(Oct 26 2021 at 10:07)</a>:</h4>
<p>tho I'd first try it out by duplicating the same thing in a playground</p>



<a name="259075152"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259075152" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259075152">(Oct 26 2021 at 10:08)</a>:</h4>
<p>much easier than re-compiling the compiler on every little touch of libstd</p>



<a name="259083852"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259083852" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259083852">(Oct 26 2021 at 11:43)</a>:</h4>
<p>it'd also be nice to exercize this negative impl change, IIRC santiago's was working on improving test coverage about it, and this use case could be an interesting one for his tests</p>



<a name="259090167"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259090167" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259090167">(Oct 26 2021 at 12:46)</a>:</h4>
<p>it's always nice to improve test coverage but just in case to clarify, I'm not working on the test coverage of this</p>



<a name="259090202"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259090202" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259090202">(Oct 26 2021 at 12:46)</a>:</h4>
<p><span class="user-mention" data-user-id="116113">@lqd</span> you're confused with async fns in traits MVP :)</p>



<a name="259090285"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259090285" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259090285">(Oct 26 2021 at 12:47)</a>:</h4>
<p>oooooooops</p>



<a name="259090368"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259090368" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259090368">(Oct 26 2021 at 12:47)</a>:</h4>
<p>then it would be an interesting test .... in general :)</p>



<a name="259090549"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259090549" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259090549">(Oct 26 2021 at 12:49)</a>:</h4>
<p>for sure :)</p>



<a name="259256721"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259256721" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259256721">(Oct 27 2021 at 15:23)</a>:</h4>
<p>It seems to pass <code>cargo check</code>! <a href="https://github.com/yoshuawuyts/rust/tree/future-for-termination-2">https://github.com/yoshuawuyts/rust/tree/future-for-termination-2</a></p>



<a name="259256850"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259256850" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259256850">(Oct 27 2021 at 15:24)</a>:</h4>
<p>Need to test out whether <code>async fn main</code> <em>actually</em> works with this (<code>py ./x.py build</code> is broken locally right now for me), but I think it should!</p>



<a name="259272840"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259272840" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259272840">(Oct 27 2021 at 17:10)</a>:</h4>
<p><span class="user-mention silent" data-user-id="211722">Yoshua Wuyts [he/they]</span> <a href="#narrow/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence/near/259256850">said</a>:</p>
<blockquote>
<p><code>py ./x.py build</code> is broken locally right now for me)</p>
</blockquote>
<p>that's really unfortunate, because it probably means only part of your changes were tested: I believe the "cfg(not(bootstrap))" changes will be checked when you build stage 1 only</p>



<a name="259275952"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259275952" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259275952">(Oct 27 2021 at 17:30)</a>:</h4>
<p>(and I don't think <a href="https://github.com/yoshuawuyts/rust/commit/d2e1a09e0afac8d25711da0970ba91973204682a#diff-36874f872091dd105fbb727506ee7e2d9136ed3265acd5a165c8d925d57db7d1R122-R133">this will work</a>: the uses being private to the module mean they wouldn't be exported IIRC)</p>



<a name="259287761"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259287761" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259287761">(Oct 27 2021 at 18:47)</a>:</h4>
<p>Fixed my local compiler install!</p>



<a name="259287818"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259287818" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259287818">(Oct 27 2021 at 18:48)</a>:</h4>
<p>We're <em>so close</em> it seems now, haha</p>



<a name="259287916"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259287916" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259287916">(Oct 27 2021 at 18:49)</a>:</h4>
<p>Moved past the earlier error that showed issues with <code>()</code> to the new error, which shows issues with <code>Result&lt;(), E&gt;</code>:</p>
<div class="codehilite" data-code-language="txt"><pre><span></span><code>error[E0119]: conflicting implementations of trait `process::Termination` for type `core::result::Result&lt;(), _&gt;`
    --&gt; library\std\src\process.rs:2060:1
     |
2025 |   impl&lt;E: fmt::Debug&gt; Termination for Result&lt;(), E&gt; {
     |   ------------------------------------------------- first implementation here
...
2060 | / impl&lt;T, F&gt; Termination for F
2061 | | where
2062 | |     T: Termination,
2063 | |     F: crate::future::Future&lt;Output = T&gt;,
...    |
2114 | |     }
2115 | | }
     | |_^ conflicting implementation for `core::result::Result&lt;(), _&gt;`
</code></pre></div>



<a name="259288087"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259288087" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259288087">(Oct 27 2021 at 18:50)</a>:</h4>
<p>I've tried implementing <code>impl&lt;E&gt; !Future for Result&lt;(), E&gt; {}</code> (<a href="https://github.com/yoshuawuyts/rust/commit/377d7fa25a42af865ac14233c479892aad89bffe#diff-ce8cd7d0ae24d8c6503198eeb502052175fc9c47d15fbc85258236b53e312ba0R127">ref</a>), but it seems that the negative impls in coherence isn't yet smart enough to figure that one out!</p>



<a name="259288801"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259288801" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259288801">(Oct 27 2021 at 18:54)</a>:</h4>
<p>Oh interesting, I tried creating a repro, but this seems to compile: <a href="https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2021&amp;gist=31169f58cd7c2a6dea218a03673bf301">https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2021&amp;gist=31169f58cd7c2a6dea218a03673bf301</a></p>



<a name="259289027"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259289027" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259289027">(Oct 27 2021 at 18:56)</a>:</h4>
<p>does it maybe repro with two different crates ?</p>



<a name="259289140"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259289140" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259289140">(Oct 27 2021 at 18:57)</a>:</h4>
<p>yeah, I wonder... -- there's no way to test that on the playground, is there?</p>



<a name="259289168"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259289168" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259289168">(Oct 27 2021 at 18:57)</a>:</h4>
<p>unfortunately, I don't think so</p>



<a name="259289431"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259289431" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259289431">(Oct 27 2021 at 18:59)</a>:</h4>
<p>(though it would be sweet. maybe even supporting compiletest and its annotations, simulating multiple files and crates and so on)</p>



<a name="259289750"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259289750" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259289750">(Oct 27 2021 at 19:00)</a>:</h4>
<p>that'd be nice for sure!</p>



<a name="259289798"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259289798" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259289798">(Oct 27 2021 at 19:01)</a>:</h4>
<p>gah, think I need to punt my investigation for today</p>



<a name="259289813"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259289813" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259289813">(Oct 27 2021 at 19:01)</a>:</h4>
<p>might get back to this tomorrow!</p>



<a name="259289886"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259289886" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259289886">(Oct 27 2021 at 19:01)</a>:</h4>
<p>But if someone wants to verify the playground example using two crates before then, please feel free to!</p>



<a name="259292405"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259292405" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259292405">(Oct 27 2021 at 19:16)</a>:</h4>
<p>(if you split the Future and Termination items in 2 different crates, it looks like it does reproduce yeah)</p>



<a name="259296114"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259296114" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259296114">(Oct 27 2021 at 19:45)</a>:</h4>
<p>Yay, it def seems like we've hit a compiler bug then!</p>



<a name="259296526"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259296526" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259296526">(Oct 27 2021 at 19:49)</a>:</h4>
<p>niko and santiago may be interested in checking this out :)</p>



<a name="259296994"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259296994" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259296994">(Oct 27 2021 at 19:53)</a>:</h4>
<p><span class="user-mention" data-user-id="116113">@lqd</span> thanks, can you share the code you're using to test this in 2 different crates?</p>



<a name="259297043"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259297043" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259297043">(Oct 27 2021 at 19:53)</a>:</h4>
<p>or I meant, I'm not sure what's the issue you're pointing out</p>



<a name="259297268"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259297268" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259297268">(Oct 27 2021 at 19:55)</a>:</h4>
<p>sure, let me prepare you what we think looks interesting :)</p>



<a name="259299892"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259299892" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259299892">(Oct 27 2021 at 20:14)</a>:</h4>
<p>so what seems interesting is that in <a href="https://github.com/lqd/negative-impls">https://github.com/lqd/negative-impls</a> <code>single_crate</code> does build, but splitting its code into 2 crates (e.g. moving the <code>Future</code> things into <code>fake_libcore</code>), makes the rest of the code dealing with <code>Termination</code> (here in <code>fake_libstd</code>) stop building</p>



<a name="259301695"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259301695" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259301695">(Oct 27 2021 at 20:28)</a>:</h4>
<p><span class="user-mention" data-user-id="116113">@lqd</span> can you paste the error you're getting</p>



<a name="259301764"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259301764" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259301764">(Oct 27 2021 at 20:28)</a>:</h4>
<p>it's a repro of yosh's actual test, so the error they had here is the same <a href="#narrow/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence/near/259287916">https://rust-lang.zulipchat.com/#narrow/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence/near/259287916</a></p>



<a name="259301800"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259301800" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259301800">(Oct 27 2021 at 20:29)</a>:</h4>
<p>oh oh</p>



<a name="259301810"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259301810" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259301810">(Oct 27 2021 at 20:29)</a>:</h4>
<p>have you tried adding negative_impls in <a href="https://github.com/lqd/negative-impls/blob/master/fake_libstd/src/lib.rs">https://github.com/lqd/negative-impls/blob/master/fake_libstd/src/lib.rs</a> ?</p>



<a name="259301821"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259301821" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259301821">(Oct 27 2021 at 20:29)</a>:</h4>
<p>but simpler :)</p>



<a name="259301844"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259301844" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259301844">(Oct 27 2021 at 20:29)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116266">Santiago Pastorino</span> <a href="#narrow/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence/near/259301810">said</a>:</p>
<blockquote>
<p>have you tried adding negative_impls in <a href="https://github.com/lqd/negative-impls/blob/master/fake_libstd/src/lib.rs">https://github.com/lqd/negative-impls/blob/master/fake_libstd/src/lib.rs</a> ?</p>
</blockquote>
<p>I think this is the problem</p>



<a name="259301996"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259301996" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259301996">(Oct 27 2021 at 20:30)</a>:</h4>
<p>I don't think so, since there are no negative impls in that crate ?</p>



<a name="259302063"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259302063" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259302063">(Oct 27 2021 at 20:31)</a>:</h4>
<p>hehe :), yeah, but the checks are feature gated using that flag</p>



<a name="259302252"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259302252" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259302252">(Oct 27 2021 at 20:32)</a>:</h4>
<p>ok I've tried, and it doesn't seem to fix it</p>



<a name="259302261"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259302261" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259302261">(Oct 27 2021 at 20:32)</a>:</h4>
<p>more info <a href="https://github.com/rust-lang/rust/pull/90104#discussion_r733971073">https://github.com/rust-lang/rust/pull/90104#discussion_r733971073</a></p>



<a name="259302276"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259302276" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259302276">(Oct 27 2021 at 20:33)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116113">lqd</span> <a href="#narrow/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence/near/259302252">said</a>:</p>
<blockquote>
<p>ok I've tried, and it doesn't seem to fix it</p>
</blockquote>
<p>ohh ok</p>



<a name="259302315"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259302315" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259302315">(Oct 27 2021 at 20:33)</a>:</h4>
<p>ah thanks for the link</p>



<a name="259302900"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259302900" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259302900">(Oct 27 2021 at 20:38)</a>:</h4>
<p>it's defo true it could have mattered in this example reproduction, but probably not in yosh's original: both libcore and libstd have the feature gate already</p>



<a name="259303082"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259303082" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259303082">(Oct 27 2021 at 20:39)</a>:</h4>
<p>(but I've pushed the feature gate to the repro just in case :)</p>



<a name="259303768"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259303768" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259303768">(Oct 27 2021 at 20:45)</a>:</h4>
<p>yeah, I feel like this is more a specialization issue</p>



<a name="259303783"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259303783" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259303783">(Oct 27 2021 at 20:45)</a>:</h4>
<p>the feature flag also needs to be included</p>



<a name="259303871"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259303871" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259303871">(Oct 27 2021 at 20:45)</a>:</h4>
<p>first of all</p>



<a name="259303889"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259303889" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259303889">(Oct 27 2021 at 20:46)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#![feature(negative_impls)]</span><span class="w"></span>

<span class="k">use</span><span class="w"> </span><span class="n">fake_libcore</span>::<span class="n">Future</span><span class="p">;</span><span class="w"></span>

<span class="k">trait</span><span class="w"> </span><span class="n">Termination</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="k">impl</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Termination</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span><span class="w"> </span><span class="n">E</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="k">impl</span><span class="w"> </span><span class="n">Termination</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Termination</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
</code></pre></div>



<a name="259303916"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259303916" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259303916">(Oct 27 2021 at 20:46)</a>:</h4>
<p>gives</p>



<a name="259303926"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259303926" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259303926">(Oct 27 2021 at 20:46)</a>:</h4>
<div class="codehilite"><pre><span></span><code>error[E0119]: conflicting implementations of trait `Termination` for type `std::result::Result&lt;(), _&gt;`
  --&gt; src/lib.rs:11:1
   |
8  | impl&lt;E&gt; Termination for Result&lt;(), E&gt; {}
   | ------------------------------------- first implementation here
...
11 | impl&lt;T&gt; Termination for T {}
   | ^^^^^^^^^^^^^^^^^^^^^^^^^ conflicting implementation for `std::result::Result&lt;(), _&gt;`
</code></pre></div>



<a name="259303944"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259303944" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259303944">(Oct 27 2021 at 20:46)</a>:</h4>
<p>you add the specialization feature flag</p>



<a name="259303970"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259303970" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259303970">(Oct 27 2021 at 20:46)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#![feature(negative_impls)]</span><span class="w"></span>
<span class="cp">#![feature(min_specialization)]</span><span class="w"></span>

<span class="k">use</span><span class="w"> </span><span class="n">fake_libcore</span>::<span class="n">Future</span><span class="p">;</span><span class="w"></span>

<span class="k">trait</span><span class="w"> </span><span class="n">Termination</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="k">impl</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Termination</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span><span class="w"> </span><span class="n">E</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="k">impl</span><span class="w"> </span><span class="n">Termination</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Termination</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
</code></pre></div>



<a name="259303975"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259303975" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259303975">(Oct 27 2021 at 20:46)</a>:</h4>
<p>and it compiles</p>



<a name="259304037"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259304037" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259304037">(Oct 27 2021 at 20:47)</a>:</h4>
<p>with the specialization feature flag, the whole example doesn't work</p>



<a name="259304183"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259304183" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259304183">(Oct 27 2021 at 20:48)</a>:</h4>
<p>yeah it's not trying to add a new termination for all Ts, only Futures of Terminations</p>



<a name="259304374"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259304374" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259304374">(Oct 27 2021 at 20:50)</a>:</h4>
<p>yeah but what I meant is ... it seems to me that the conflict is not related to negative impls and probably due to a limitation of specialization</p>



<a name="259304417"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259304417" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259304417">(Oct 27 2021 at 20:50)</a>:</h4>
<p>may worth reading what <code>min_specialization</code> has left uncovered and maybe an example like this one is not yet covered</p>



<a name="259304426"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259304426" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259304426">(Oct 27 2021 at 20:51)</a>:</h4>
<p>unsure tbh</p>



<a name="259304436"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259304436" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259304436">(Oct 27 2021 at 20:51)</a>:</h4>
<p>cc <span class="user-mention" data-user-id="116009">@nikomatsakis</span></p>



<a name="259304442"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259304442" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259304442">(Oct 27 2021 at 20:51)</a>:</h4>
<p>yeah same</p>



<a name="259304473"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259304473" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259304473">(Oct 27 2021 at 20:51)</a>:</h4>
<p>at least it's <em>interesting</em> :)</p>



<a name="259304576"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259304576" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259304576">(Oct 27 2021 at 20:52)</a>:</h4>
<p>especially since it compiles when in a single crate that is</p>



<a name="259304828"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259304828" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259304828">(Oct 27 2021 at 20:54)</a>:</h4>
<p>coherence isn't an issue when it's a single crate</p>



<a name="259304958"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259304958" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259304958">(Oct 27 2021 at 20:54)</a>:</h4>
<p>good point</p>



<a name="259305233"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259305233" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259305233">(Oct 27 2021 at 20:56)</a>:</h4>
<p>then what is this error saying here ?</p>



<a name="259305244"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259305244" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259305244">(Oct 27 2021 at 20:56)</a>:</h4>
<p>I don't know if this is a specialization issue; seems like a negative impl issue</p>



<a name="259305345"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259305345" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259305345">(Oct 27 2021 at 20:57)</a>:</h4>
<p>yeah, it may be, after saying that is about specialization I ended having second thoughts :)</p>



<a name="259305375"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259305375" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259305375">(Oct 27 2021 at 20:58)</a>:</h4>
<p>I imagine that it's something to do with the fact that the negative impl has a type parameter</p>



<a name="259305579"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259305579" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259305579">(Oct 27 2021 at 20:59)</a>:</h4>
<p>right</p>



<a name="259305597"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259305597" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259305597">(Oct 27 2021 at 20:59)</a>:</h4>
<p><span class="user-mention" data-user-id="116113">@lqd</span> can you try making an even smaller repro using a "<code>Future</code>" trait without <code>Output</code></p>



<a name="259305674"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259305674" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259305674">(Oct 27 2021 at 21:00)</a>:</h4>
<p>it would also be nice to create a test case in the compiler</p>



<a name="259305690"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259305690" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259305690">(Oct 27 2021 at 21:00)</a>:</h4>
<p>it's very simple</p>



<a name="259305692"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259305692" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259305692">(Oct 27 2021 at 21:00)</a>:</h4>
<p>I can try yeah</p>



<a name="259305715"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259305715" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259305715">(Oct 27 2021 at 21:00)</a>:</h4>
<p>So this impl would look like</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Termination</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">F</span><span class="w"></span>
<span class="k">where</span><span class="w"></span>
<span class="w">    </span><span class="n">F</span>: <span class="nc">Future</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
</code></pre></div>



<a name="259305773"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259305773" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259305773">(Oct 27 2021 at 21:00)</a>:</h4>
<p>could even probably reduce <code>Result</code> to <code>Result&lt;E&gt;</code></p>



<a name="259305796"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259305796" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259305796">(Oct 27 2021 at 21:00)</a>:</h4>
<p><span class="user-mention" data-user-id="116113">@lqd</span> take a look at <a href="https://github.com/rust-lang/rust/pull/90104/files#diff-28616a2505fa0fda83688dfdb184c28b1774b60b0a8ad2756ec377a49587d009">https://github.com/rust-lang/rust/pull/90104/files#diff-28616a2505fa0fda83688dfdb184c28b1774b60b0a8ad2756ec377a49587d009</a></p>



<a name="259305811"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259305811" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259305811">(Oct 27 2021 at 21:01)</a>:</h4>
<p>or maybe just use <code>Option</code> for clarity</p>



<a name="259305900"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259305900" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259305900">(Oct 27 2021 at 21:01)</a>:</h4>
<p>a some point the repro will look like the tests in <a href="https://github.com/rust-lang/rust/issues/90104">#90104</a> which we know work :)</p>



<a name="259306131"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259306131" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259306131">(Oct 27 2021 at 21:03)</a>:</h4>
<p>lol yeah :)</p>



<a name="259306234"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259306234" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259306234">(Oct 27 2021 at 21:04)</a>:</h4>
<p>but I think <span class="user-mention silent" data-user-id="232957">Jack Huey</span> is right, it may be related to the associated type</p>



<a name="259306289"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259306289" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259306289">(Oct 27 2021 at 21:04)</a>:</h4>
<p>Well, its either the associated type, or the type parameter</p>



<a name="259306302"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259306302" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259306302">(Oct 27 2021 at 21:04)</a>:</h4>
<p>My guess is the associated type</p>



<a name="259306319"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259306319" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259306319">(Oct 27 2021 at 21:05)</a>:</h4>
<p>my guess is the associated type :)</p>



<a name="259306337"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259306337" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259306337">(Oct 27 2021 at 21:05)</a>:</h4>
<p>We'll see</p>



<a name="259306598"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259306598" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259306598">(Oct 27 2021 at 21:07)</a>:</h4>
<p>so let's say </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">impl</span><span class="o">&lt;</span><span class="n">F</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Termination</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">F</span><span class="w"></span>
<span class="k">where</span><span class="w"></span>
<span class="w">    </span><span class="n">F</span>: <span class="nc">Future</span><span class="w"></span>
<span class="w">    </span><span class="p">{}</span><span class="w"></span>
</code></pre></div>
<p>for a <code>Future</code> without <code>Output</code> ?</p>



<a name="259306730"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259306730" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259306730">(Oct 27 2021 at 21:08)</a>:</h4>
<p>still conflicts ...</p>



<a name="259307131"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259307131" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259307131">(Oct 27 2021 at 21:12)</a>:</h4>
<p>if we remove the type parameter for the result negative impl, say use an option, then it works</p>



<a name="259307602"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259307602" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259307602">(Oct 27 2021 at 21:16)</a>:</h4>
<p>Wait, what do you mean <code>Option</code>?</p>



<a name="259307624"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259307624" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259307624">(Oct 27 2021 at 21:16)</a>:</h4>
<p><code>Option&lt;T&gt;</code> or <code>Option&lt;()&gt;</code></p>



<a name="259307825"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259307825" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259307825">(Oct 27 2021 at 21:17)</a>:</h4>
<p>(my suggestion to make it <code>Option&lt;E&gt;</code> was to just remove the needless <code>()</code>)</p>



<a name="259308189"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259308189" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259308189">(Oct 27 2021 at 21:19)</a>:</h4>
<p>ah sorry I meant Option&lt;E&gt; conflicts while Option&lt;()&gt; doesn't</p>



<a name="259308399"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259308399" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259308399">(Oct 27 2021 at 21:21)</a>:</h4>
<p>ok cool</p>



<a name="259308407"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259308407" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259308407">(Oct 27 2021 at 21:21)</a>:</h4>
<p>so just about what I expected</p>



<a name="259308442"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259308442" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259308442">(Oct 27 2021 at 21:21)</a>:</h4>
<p>can you push that</p>



<a name="259308463"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259308463" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259308463">(Oct 27 2021 at 21:22)</a>:</h4>
<p>sure</p>



<a name="259308634"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259308634" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259308634">(Oct 27 2021 at 21:23)</a>:</h4>
<p>right, it's about the type parameter</p>



<a name="259308646"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259308646" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259308646">(Oct 27 2021 at 21:23)</a>:</h4>
<p>I've also tested it</p>



<a name="259308878"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259308878" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259308878">(Oct 27 2021 at 21:25)</a>:</h4>
<p>done</p>



<a name="259309208"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259309208" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259309208">(Oct 27 2021 at 21:28)</a>:</h4>
<p>the very minimal is</p>



<a name="259309218"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259309218" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259309218">(Oct 27 2021 at 21:28)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#![feature(negative_impls)]</span><span class="w"></span>

<span class="k">pub</span><span class="w"> </span><span class="k">trait</span><span class="w"> </span><span class="n">Future</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="k">impl</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">Future</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nb">Option</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
</code></pre></div>



<a name="259309227"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259309227" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259309227">(Oct 27 2021 at 21:28)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#![feature(negative_impls)]</span><span class="w"></span>

<span class="k">use</span><span class="w"> </span><span class="n">fake_libcore</span>::<span class="n">Future</span><span class="p">;</span><span class="w"></span>

<span class="k">trait</span><span class="w"> </span><span class="n">Termination</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="k">impl</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Termination</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nb">Option</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="k">impl</span><span class="o">&lt;</span><span class="n">F</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Termination</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">F</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">F</span>: <span class="nc">Future</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
</code></pre></div>



<a name="259309299"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259309299" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259309299">(Oct 27 2021 at 21:28)</a>:</h4>
<p>I don't even think  you need specialization</p>



<a name="259309344"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259309344" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259309344">(Oct 27 2021 at 21:29)</a>:</h4>
<p>ah yes: the <code>()</code> impls were more important in the real code than the example I'll remove them</p>



<a name="259309605"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259309605" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259309605">(Oct 27 2021 at 21:31)</a>:</h4>
<p>that's the perfect UI test size</p>



<a name="259433022"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259433022" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259433022">(Oct 28 2021 at 18:36)</a>:</h4>
<p>I think this will work:</p>



<a name="259433044"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259433044" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259433044">(Oct 28 2021 at 18:36)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#![feature(negative_impls)]</span><span class="w"></span>

<span class="k">pub</span><span class="w"> </span><span class="k">trait</span><span class="w"> </span><span class="n">Future</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="k">impl</span><span class="o">&lt;</span><span class="n">E</span>: <span class="o">?</span><span class="nb">Sized</span><span class="o">&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">Future</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nb">Box</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
</code></pre></div>



<a name="259433062"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259433062" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259433062">(Oct 28 2021 at 18:36)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#![feature(negative_impls)]</span><span class="w"></span>

<span class="k">use</span><span class="w"> </span><span class="n">fake_libcore</span>::<span class="n">Future</span><span class="p">;</span><span class="w"></span>

<span class="k">trait</span><span class="w"> </span><span class="n">Termination</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="k">impl</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Termination</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nb">Box</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="k">impl</span><span class="o">&lt;</span><span class="n">F</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Termination</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">F</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">F</span>: <span class="nc">Future</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
</code></pre></div>



<a name="259433177"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259433177" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259433177">(Oct 28 2021 at 18:37)</a>:</h4>
<p>you're right :)</p>



<a name="259433185"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259433185" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259433185">(Oct 28 2021 at 18:37)</a>:</h4>
<p>it works</p>



<a name="259440406"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259440406" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259440406">(Oct 28 2021 at 19:33)</a>:</h4>
<p>nice, thanks Niko! it does work on the repro as well, and yosh will hopefully be able to keep testing their idea (famous last words :)</p>
<p>(I've pushed this to the repo just in case it gets lost in this thread)</p>



<a name="259442215"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259442215" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259442215">(Oct 28 2021 at 19:47)</a>:</h4>
<p>dang implicit <code>Sized</code></p>



<a name="259489490"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259489490" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259489490">(Oct 29 2021 at 07:06)</a>:</h4>
<div class="codehilite" data-code-language="Text only"><pre><span></span><code>    Finished release [optimized] target(s) in 1m 02s
Build completed successfully in 0:06:04
</code></pre></div>
<p><span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span><span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span><span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span><span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span><span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span></p>



<a name="259489773"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259489773" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259489773">(Oct 29 2021 at 07:10)</a>:</h4>
<p>thanks everyone!!</p>



<a name="259489913"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259489913" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259489913">(Oct 29 2021 at 07:12)</a>:</h4>
<p><a href="https://github.com/yoshuawuyts/rust/commit/6a5ad78a92b0a8f8fa43e642359bc30ebe5a2c37">Here's the implementation</a>  — going to have to figure out with folks what we want to do with this; but it's really cool to know that it's now possible to implement!</p>



<a name="259513125"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259513125" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259513125">(Oct 29 2021 at 11:52)</a>:</h4>
<p><span class="user-mention" data-user-id="211722">@Yoshua Wuyts [he/they]</span> great, this is huge!!!</p>



<a name="259513172"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259513172" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259513172">(Oct 29 2021 at 11:53)</a>:</h4>
<p>we're going to fix the underlying problem because your original example should have worked</p>



<a name="259521144"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259521144" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259521144">(Oct 29 2021 at 13:07)</a>:</h4>
<p>Actually, I think the original example <em>shouldn't</em> have worked</p>



<a name="259521223"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259521223" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259521223">(Oct 29 2021 at 13:08)</a>:</h4>
<p>Because the negative impl only applies for <code>E: Sized</code></p>



<a name="259521258"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259521258" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259521258">(Oct 29 2021 at 13:08)</a>:</h4>
<p>(Right?)</p>



<a name="259524797"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259524797" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259524797">(Oct 29 2021 at 13:36)</a>:</h4>
<p>according to Niko, negative impls should behave like in an always applicable way</p>



<a name="259524852"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259524852" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259524852">(Oct 29 2021 at 13:37)</a>:</h4>
<p>I think that already happens on specialization</p>



<a name="259524860"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259524860" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259524860">(Oct 29 2021 at 13:37)</a>:</h4>
<p>need to read <a href="https://smallcultfollowing.com/babysteps/blog/2018/02/09/maximally-minimal-specialization-always-applicable-impls/">https://smallcultfollowing.com/babysteps/blog/2018/02/09/maximally-minimal-specialization-always-applicable-impls/</a></p>



<a name="259524928"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/259524928" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#259524928">(Oct 29 2021 at 13:37)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> can explain this better :)</p>



<a name="269132061"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/269132061" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#269132061">(Jan 24 2022 at 16:35)</a>:</h4>
<p><span class="user-mention" data-user-id="211722">@Yoshua Wuyts [he/they]</span> you can try out <a href="https://github.com/rust-lang/rust/issues/93175">#93175</a></p>



<a name="269132181"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/269132181" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#269132181">(Jan 24 2022 at 16:36)</a>:</h4>
<p><span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> I should have time to do that tomorrow!</p>



<a name="269132236"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/269132236" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#269132236">(Jan 24 2022 at 16:36)</a>:</h4>
<p><span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="269132289"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/269132289" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#269132289">(Jan 24 2022 at 16:36)</a>:</h4>
<p>it may be included in tomorrow's nightly</p>



<a name="269264855"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/269264855" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#269264855">(Jan 25 2022 at 14:34)</a>:</h4>
<p><span class="user-mention silent" data-user-id="211722">Yoshua Wuyts [he/they]</span> <a href="#narrow/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence/near/269132181">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="116266">Santiago Pastorino</span> I should have time to do that tomorrow!</p>
</blockquote>
<p>the thing is merged now but I don't think it's on nightly yet</p>



<a name="271446671"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/negative%20impls%20in%20coherence/near/271446671" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/negative.20impls.20in.20coherence.html#271446671">(Feb 10 2022 at 15:24)</a>:</h4>
<p>Created a stream for further communication <a class="stream" data-stream-id="315151" href="/#narrow/stream/315151-wg-traits.2Fnegative-impls">#wg-traits/negative-impls</a></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>