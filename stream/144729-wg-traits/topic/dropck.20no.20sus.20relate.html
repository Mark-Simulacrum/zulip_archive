<html>
<head><meta charset="utf-8"><title>dropck no sus relate · wg-traits · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/index.html">wg-traits</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/dropck.20no.20sus.20relate.html">dropck no sus relate</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="276634433"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/dropck%20no%20sus%20relate/near/276634433" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/dropck.20no.20sus.20relate.html#276634433">(Mar 25 2022 at 15:20)</a>:</h4>
<p><code>dropck</code> currently uses a custom <code>TypeRelation</code> which makes me rather unhappy so I've tried to do it "the right way" using our trait solver.</p>
<p>getting the error messages right this way is a mess</p>



<a name="276634446"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/dropck%20no%20sus%20relate/near/276634446" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/dropck.20no.20sus.20relate.html#276634446">(Mar 25 2022 at 15:20)</a>:</h4>
<p>relevant commit: <a href="https://github.com/rust-lang/rust/commit/b2040424b099df1efbb057c841279665376fe1b1">https://github.com/rust-lang/rust/commit/b2040424b099df1efbb057c841279665376fe1b1</a></p>



<a name="276634666"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/dropck%20no%20sus%20relate/near/276634666" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/dropck.20no.20sus.20relate.html#276634666">(Mar 25 2022 at 15:22)</a>:</h4>
<p>ideally I would have liked to simply have a function which returns all region errors and failed obligations and build custom errors directly</p>



<a name="276634687"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/dropck%20no%20sus%20relate/near/276634687" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/dropck.20no.20sus.20relate.html#276634687">(Mar 25 2022 at 15:22)</a>:</h4>
<p>but we don't have to api to do that for region errors rn</p>



<a name="276634769"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/dropck%20no%20sus%20relate/near/276634769" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/dropck.20no.20sus.20relate.html#276634769">(Mar 25 2022 at 15:23)</a>:</h4>
<p>and it might not be sensible to add that</p>



<a name="276637174"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/dropck%20no%20sus%20relate/near/276637174" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/dropck.20no.20sus.20relate.html#276637174">(Mar 25 2022 at 15:39)</a>:</h4>
<p>Would additional fine grained obligation causes be able to help?</p>



<a name="276637406"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/dropck%20no%20sus%20relate/near/276637406" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/dropck.20no.20sus.20relate.html#276637406">(Mar 25 2022 at 15:40)</a>:</h4>
<p>I think that <code>DropBoundsImpliedObligation</code> should already be enough, much rather i feel like there is too much stuff going on for error reporting</p>



<a name="276637904"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/dropck%20no%20sus%20relate/near/276637904" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/dropck.20no.20sus.20relate.html#276637904">(Mar 25 2022 at 15:44)</a>:</h4>
<p>Ah I see now. Hmm.. instead of processing the obligation just for a note, you could change the entry point for this diagnostic to go down a completely separate path if the obligation cause is that specific one</p>



<a name="276638028"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/dropck%20no%20sus%20relate/near/276638028" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/dropck.20no.20sus.20relate.html#276638028">(Mar 25 2022 at 15:45)</a>:</h4>
<p>Obligation causes are just for diagnostics, so "too much going on" is irrelevant. Tho I think you're talking about actually adding that obligation cause and similar?</p>



<a name="276638183"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/dropck%20no%20sus%20relate/near/276638183" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/dropck.20no.20sus.20relate.html#276638183">(Mar 25 2022 at 15:46)</a>:</h4>
<p>We could add a generic error reporter type, so that you can choose to switch to a different scheme, and that scheme could be "don't report but use a full error info struct instead of ErrorReported"</p>



<a name="276638222"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/dropck%20no%20sus%20relate/near/276638222" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/dropck.20no.20sus.20relate.html#276638222">(Mar 25 2022 at 15:47)</a>:</h4>
<p>idk, just felt bad adding some code to like 10 different places, most of which should never get hit if i did everything right, but I don't fully understand how the current setup ends up where it does</p>



<a name="276638247"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/dropck%20no%20sus%20relate/near/276638247" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/dropck.20no.20sus.20relate.html#276638247">(Mar 25 2022 at 15:47)</a>:</h4>
<p><span class="user-mention silent" data-user-id="124288">oli</span> <a href="#narrow/stream/144729-wg-traits/topic/dropck.20no.20sus.20relate/near/276637904">said</a>:</p>
<blockquote>
<p>Ah I see now. Hmm.. instead of processing the obligation just for a note, you could change the entry point for this diagnostic to go down a completely separate path if the obligation cause is that specific one</p>
</blockquote>
<p>that's probably what I want to do</p>



<a name="276638454"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/dropck%20no%20sus%20relate/near/276638454" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/dropck.20no.20sus.20relate.html#276638454">(Mar 25 2022 at 15:48)</a>:</h4>
<p>Well, in all the places you don't care about you can likely fall through to misc or bug! out if you want to be sure</p>



<a name="276638551"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/dropck%20no%20sus%20relate/near/276638551" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/dropck.20no.20sus.20relate.html#276638551">(Mar 25 2022 at 15:49)</a>:</h4>
<blockquote>
<p>ideally I would have liked to simply have a function which returns all region errors and failed obligations and build custom errors directly</p>
</blockquote>
<p>Uh, we do have that</p>



<a name="276638680"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/dropck%20no%20sus%20relate/near/276638680" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/dropck.20no.20sus.20relate.html#276638680">(Mar 25 2022 at 15:50)</a>:</h4>
<p>You can do the select_obligations_where_possible and then ask for the list of pending obligations.</p>



<a name="276638781"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/dropck%20no%20sus%20relate/near/276638781" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/dropck.20no.20sus.20relate.html#276638781">(Mar 25 2022 at 15:50)</a>:</h4>
<p>The select itself may already return errors</p>



<a name="276638896"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/dropck%20no%20sus%20relate/near/276638896" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/dropck.20no.20sus.20relate.html#276638896">(Mar 25 2022 at 15:51)</a>:</h4>
<p>The infra around all this may be suboptimal, but we can fix that</p>



<a name="276638926"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/dropck%20no%20sus%20relate/near/276638926" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/dropck.20no.20sus.20relate.html#276638926">(Mar 25 2022 at 15:51)</a>:</h4>
<p>yes, but that's not possible with region obligations</p>



<a name="276638993"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/dropck%20no%20sus%20relate/near/276638993" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/dropck.20no.20sus.20relate.html#276638993">(Mar 25 2022 at 15:51)</a>:</h4>
<p>these get checked separately, and currently don't propagate errors back up</p>



<a name="276639065"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/dropck%20no%20sus%20relate/near/276639065" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/dropck.20no.20sus.20relate.html#276639065">(Mar 25 2022 at 15:52)</a>:</h4>
<p>but always emit them eagerly</p>



<a name="276643955"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/dropck%20no%20sus%20relate/near/276643955" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/dropck.20no.20sus.20relate.html#276643955">(Mar 25 2022 at 16:22)</a>:</h4>
<p>Oh you mean borrowck specifically?</p>



<a name="276644013"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/dropck%20no%20sus%20relate/near/276644013" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/dropck.20no.20sus.20relate.html#276644013">(Mar 25 2022 at 16:22)</a>:</h4>
<p>We have a different scheme there, yea</p>



<a name="276644121"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/dropck%20no%20sus%20relate/near/276644121" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/dropck.20no.20sus.20relate.html#276644121">(Mar 25 2022 at 16:23)</a>:</h4>
<p>So yea I agree, not sure if we can or should do anything here</p>



<a name="276644148"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/dropck%20no%20sus%20relate/near/276644148" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/dropck.20no.20sus.20relate.html#276644148">(Mar 25 2022 at 16:23)</a>:</h4>
<p>We can certainly investigate</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>