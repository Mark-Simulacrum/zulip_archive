<html>
<head><meta charset="utf-8"><title>chalk compiletests · wg-traits · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/index.html">wg-traits</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.20compiletests.html">chalk compiletests</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="273703752"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%20compiletests/near/273703752" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.20compiletests.html#273703752">(Mar 01 2022 at 20:16)</a>:</h4>
<p>1- There are chalk-specific compiletests in <code>chalkify/</code>, the rest of tests aren't run with chalk at all in CI, right? However, many of them do pass with -Zchalk. Would it make sense to have some header saying "this test should pass both without and with chalk" so that if one regresses, we notice?<br>
2- Is there a way to see which (non-chalkify) tests start/stop passing after a change to chalk? the "compare" thing compares "non-chalk" vs "chalk", I want to compare "chalk" vs "chalk with patch"</p>



<a name="273703999"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%20compiletests/near/273703999" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.20compiletests.html#273703999">(Mar 01 2022 at 20:18)</a>:</h4>
<p><span class="user-mention silent" data-user-id="348152">Dario Nieuwenhuis</span> <a href="#narrow/stream/144729-wg-traits/topic/chalk.20compiletests/near/273703752">said</a>:</p>
<blockquote>
<p>Would it make sense to have some header saying "this test should pass both without and with chalk" so that if one regresses, we notice?</p>
</blockquote>
<p>This is just running <code>compare-mode=chalk</code> in CI in combination with  <code>ignore-compare-mode-chalk</code> where needed. Too many tests don't pass right now though for this to be realistic</p>



<a name="273704107"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%20compiletests/near/273704107" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.20compiletests.html#273704107">(Mar 01 2022 at 20:19)</a>:</h4>
<p><span class="user-mention silent" data-user-id="348152">Dario Nieuwenhuis</span> <a href="#narrow/stream/144729-wg-traits/topic/chalk.20compiletests/near/273703752">said</a>:</p>
<blockquote>
<p>I want to compare "chalk" vs "chalk with patch"</p>
</blockquote>
<p>This is just running <code>compare-mode=chalk</code> with your patch. If there is a change in test output, then <code>*.chalk.stderr</code> will change</p>



<a name="273704259"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%20compiletests/near/273704259" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.20compiletests.html#273704259">(Mar 01 2022 at 20:20)</a>:</h4>
<p>What I do locally for such situations is to build once before the patch and put that command line text into a file that I stage. Further changes will now give me a diff, which works really well for the ui test summary of the failing tests</p>



<a name="273704329"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%20compiletests/near/273704329" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.20compiletests.html#273704329">(Mar 01 2022 at 20:21)</a>:</h4>
<p><code>compare-mode=chalk</code> will run everything and then spit endless output of all the tests that don't pass with chalk. I'd like to ignore all tests that didn't pass before or after</p>



<a name="273704345"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%20compiletests/near/273704345" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.20compiletests.html#273704345">(Mar 01 2022 at 20:21)</a>:</h4>
<p>oh the diff is a nice trick, will try that, thanks!</p>



<a name="273704457"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%20compiletests/near/273704457" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.20compiletests.html#273704457">(Mar 01 2022 at 20:22)</a>:</h4>
<p>So, you want to know what tests get fixed or start failing?</p>



<a name="273704477"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%20compiletests/near/273704477" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.20compiletests.html#273704477">(Mar 01 2022 at 20:22)</a>:</h4>
<p>exactly</p>



<a name="273704637"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%20compiletests/near/273704637" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.20compiletests.html#273704637">(Mar 01 2022 at 20:23)</a>:</h4>
<p>I mean, you can always save the failing tests to a file and then do some filtering with <em>insert your favorite scripting language</em></p>



<a name="273704724"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%20compiletests/near/273704724" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.20compiletests.html#273704724">(Mar 01 2022 at 20:24)</a>:</h4>
<p>like, pick a broken test that looks feasible to fix to me as a noob, fix it, then check it at least doesn't break others</p>



<a name="273704880"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%20compiletests/near/273704880" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.20compiletests.html#273704880">(Mar 01 2022 at 20:25)</a>:</h4>
<p>which is why I was asking about non-chalk tests: if I fix one what do I do to make sure it doesn't regress, copy it to <code>chalkify/</code>?</p>



<a name="273704894"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%20compiletests/near/273704894" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.20compiletests.html#273704894">(Mar 01 2022 at 20:25)</a>:</h4>
<p>In general, in the past, I've just looked at the # of tests passing/failing in compare-mode=chalk as a measure</p>



<a name="273705033"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%20compiletests/near/273705033" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.20compiletests.html#273705033">(Mar 01 2022 at 20:26)</a>:</h4>
<p><span class="user-mention silent" data-user-id="348152">Dario Nieuwenhuis</span> <a href="#narrow/stream/144729-wg-traits/topic/chalk.20compiletests/near/273704880">said</a>:</p>
<blockquote>
<p>which is why I was asking about non-chalk tests: if I fix one what do I do to make sure it doesn't regress, copy it to <code>chalkify/</code>?</p>
</blockquote>
<p>Regress with <code>-Z chalk</code> but get fixed without? Either <code>/chalkify</code> or just not worry about it</p>



<a name="273705058"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%20compiletests/near/273705058" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.20compiletests.html#273705058">(Mar 01 2022 at 20:26)</a>:</h4>
<p>okay!</p>



<a name="273705062"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%20compiletests/near/273705062" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.20compiletests.html#273705062">(Mar 01 2022 at 20:26)</a>:</h4>
<p>thanks :D</p>



<a name="273726256"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%20compiletests/near/273726256" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.20compiletests.html#273726256">(Mar 01 2022 at 23:13)</a>:</h4>
<p>many failures are just different diagnostics:</p>
<div class="codehilite"><pre><span></span><code>-   error[E0271]: type mismatch resolving `&lt;ModelU as Vehicle&gt;::Color == Black`
+   error[E0280]: the requirement `&lt;ModelU as Vehicle&gt;::Color == Black` is not satisfied
</code></pre></div>



<a name="273726339"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%20compiletests/near/273726339" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.20compiletests.html#273726339">(Mar 01 2022 at 23:14)</a>:</h4>
<p>or same diagnostics but different spans</p>



<a name="273726347"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%20compiletests/near/273726347" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.20compiletests.html#273726347">(Mar 01 2022 at 23:14)</a>:</h4>
<p>That's not quite the same error</p>



<a name="273726361"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%20compiletests/near/273726361" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.20compiletests.html#273726361">(Mar 01 2022 at 23:14)</a>:</h4>
<p>what's the difference?</p>



<a name="273726508"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%20compiletests/near/273726508" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.20compiletests.html#273726508">(Mar 01 2022 at 23:16)</a>:</h4>
<p>oh, "type mismatch" means it knows <code>&lt;ModelU as Vehicle&gt;::Color</code> is something else, while "not satisfied" means it doesn't know</p>



<a name="273726527"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%20compiletests/near/273726527" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.20compiletests.html#273726527">(Mar 01 2022 at 23:16)</a>:</h4>
<p>okay, nevermind then! D:</p>



<a name="273726780"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%20compiletests/near/273726780" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.20compiletests.html#273726780">(Mar 01 2022 at 23:19)</a>:</h4>
<p>hmm, well actually, not sure</p>



<a name="273726841"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%20compiletests/near/273726841" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.20compiletests.html#273726841">(Mar 01 2022 at 23:20)</a>:</h4>
<p>I was thinking the first is unable to normalize, whereas the second normalizes but isn't the same</p>



<a name="273726923"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%20compiletests/near/273726923" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.20compiletests.html#273726923">(Mar 01 2022 at 23:21)</a>:</h4>
<p>full diff is </p>
<div class="codehilite"><pre><span></span><code>-   error[E0271]: type mismatch resolving `&lt;ModelT as Vehicle&gt;::Color == Blue`
+   error[E0280]: the requirement `&lt;ModelT as Vehicle&gt;::Color == Blue` is not satisfied
2     --&gt; $DIR/associated-types-binding-to-type-defined-in-supertrait.rs:31:10
3      |
4   LL | fn b() { blue_car(ModelT); }

-      |          ^^^^^^^^ type mismatch resolving `&lt;ModelT as Vehicle&gt;::Color == Blue`
+      |          ^^^^^^^^
6      |
-   note: expected this to be `Blue`
-     --&gt; $DIR/associated-types-binding-to-type-defined-in-supertrait.rs:16:40
-      |
-   LL | impl Vehicle for ModelT { type Color = Black; }
-      |                                        ^^^^^
12  note: required by a bound in `blue_car`
13    --&gt; $DIR/associated-types-binding-to-type-defined-in-supertrait.rs:27:19
14     |

15  LL | fn blue_car&lt;C:Car&lt;Color=Blue&gt;&gt;(c: C) {
16     |                   ^^^^^^^^^^ required by this bound in `blue_car`
17
-   error[E0271]: type mismatch resolving `&lt;ModelU as Vehicle&gt;::Color == Black`
+   error[E0280]: the requirement `&lt;ModelU as Vehicle&gt;::Color == Black` is not satisfied
19    --&gt; $DIR/associated-types-binding-to-type-defined-in-supertrait.rs:32:10
20     |
21  LL | fn c() { black_car(ModelU); }

-      |          ^^^^^^^^^ type mismatch resolving `&lt;ModelU as Vehicle&gt;::Color == Black`
+      |          ^^^^^^^^^
23     |
-   note: expected this to be `Black`
-     --&gt; $DIR/associated-types-binding-to-type-defined-in-supertrait.rs:21:40
-      |
-   LL | impl Vehicle for ModelU { type Color = Blue; }
-      |                                        ^^^^
29  note: required by a bound in `black_car`
30    --&gt; $DIR/associated-types-binding-to-type-defined-in-supertrait.rs:24:20
31     |

34
35  error: aborting due to 2 previous errors
36
-   For more information about this error, try `rustc --explain E0271`.
38
</code></pre></div>



<a name="273731604"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/chalk%20compiletests/near/273731604" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/chalk.20compiletests.html#273731604">(Mar 02 2022 at 00:03)</a>:</h4>
<p>not sure. Would have to look deeper</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>