<html>
<head><meta charset="utf-8"><title>common hang in rust-analyzer · wg-traits · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/index.html">wg-traits</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/common.20hang.20in.20rust-analyzer.html">common hang in rust-analyzer</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="239050006"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/common%20hang%20in%20rust-analyzer/near/239050006" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/common.20hang.20in.20rust-analyzer.html#239050006">(May 17 2021 at 08:18)</a>:</h4>
<p>Hey, I've noticed that we have a couple of issues in rust-analyzer pointing to <a href="https://github.com/rust-lang/chalk/issues/688">https://github.com/rust-lang/chalk/issues/688</a> (the most recent one being <a href="https://github.com/rust-analyzer/rust-analyzer/issues/8792">https://github.com/rust-analyzer/rust-analyzer/issues/8792</a>).</p>
<p>So I want to signal this as something for prioritization :)</p>



<a name="247907748"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/common%20hang%20in%20rust-analyzer/near/247907748" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/common.20hang.20in.20rust-analyzer.html#247907748">(Aug 02 2021 at 10:42)</a>:</h4>
<p>Friendly re-ping :)</p>
<p>Got another issue about chalk panicking <a href="https://github.com/rust-analyzer/rust-analyzer/issues/9754">today</a>, so I wondering if there's some specific things we can do to improve experience for the user of rust-analyzer. </p>
<p>For the IDE, the failure modes we see from chalk sometimes (hangs/panics) are rather critical for user-experience. Chalk underpins pretty much every interesting feature in rust-analyzer, so, when it breaks, almost nothing works, and improving that would lead to a significant improvement in the experience for end devs. Note that we are not as sensitive to wrong answers -- wrong answer is a local, isolated failure.</p>



<a name="247907783"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/common%20hang%20in%20rust-analyzer/near/247907783" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/common.20hang.20in.20rust-analyzer.html#247907783">(Aug 02 2021 at 10:42)</a>:</h4>
<p>I wonder -- does it makes sense to build something like <a href="https://github.com/bytecodealliance/wasm-tools/tree/main/crates/wasm-smith">https://github.com/bytecodealliance/wasm-tools/tree/main/crates/wasm-smith</a> for chalk-ir?</p>



<a name="247907888"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/common%20hang%20in%20rust-analyzer/near/247907888" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/common.20hang.20in.20rust-analyzer.html#247907888">(Aug 02 2021 at 10:44)</a>:</h4>
<p>To be clear: the issues are not critical, don't feel bad if they are not on the immediate roadmap: mostly, I want to backpressuer the feedback channel :)</p>



<a name="249073893"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/common%20hang%20in%20rust-analyzer/near/249073893" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> detrumi <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/common.20hang.20in.20rust-analyzer.html#249073893">(Aug 11 2021 at 06:51)</a>:</h4>
<p>I'll take another look at this</p>



<a name="249073994"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/common%20hang%20in%20rust-analyzer/near/249073994" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> detrumi <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/common.20hang.20in.20rust-analyzer.html#249073994">(Aug 11 2021 at 06:53)</a>:</h4>
<p>And yeah, returning no solutions would be a lot better than looping indefinitely</p>



<a name="249074217"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/common%20hang%20in%20rust-analyzer/near/249074217" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> detrumi <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/common.20hang.20in.20rust-analyzer.html#249074217">(Aug 11 2021 at 06:56)</a>:</h4>
<p><span class="user-mention silent" data-user-id="133169">matklad</span> <a href="#narrow/stream/144729-wg-traits/topic/common.20hang.20in.20rust-analyzer/near/247907783">said</a>:</p>
<blockquote>
<p>I wonder -- does it makes sense to build something like <a href="https://github.com/bytecodealliance/wasm-tools/tree/main/crates/wasm-smith">https://github.com/bytecodealliance/wasm-tools/tree/main/crates/wasm-smith</a> for chalk-ir?</p>
</blockquote>
<p>Interesting idea, I assume we'd mostly use that to check for infinite loops (/large running times) and panics?</p>



<a name="249074269"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/common%20hang%20in%20rust-analyzer/near/249074269" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/common.20hang.20in.20rust-analyzer.html#249074269">(Aug 11 2021 at 06:57)</a>:</h4>
<p>Might be easier to unleash <code>rust-analyzer</code> on <code>rustwide</code></p>



<a name="249074445"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/common%20hang%20in%20rust-analyzer/near/249074445" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> detrumi <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/common.20hang.20in.20rust-analyzer.html#249074445">(Aug 11 2021 at 07:00)</a>:</h4>
<p>The indirection of rust-analyzer calling chalk makes things harder to debug though, generating chalk-ir directly should make it easier to create reproducing test cases</p>



<a name="249074610"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/common%20hang%20in%20rust-analyzer/near/249074610" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/common.20hang.20in.20rust-analyzer.html#249074610">(Aug 11 2021 at 07:02)</a>:</h4>
<p>Yeah, but <code>rust-analyzer</code> and <code>rustwide</code> exist, while <code>chalk-ir-smith</code> doesn't, so it's a trade-off</p>



<a name="249161713"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/common%20hang%20in%20rust-analyzer/near/249161713" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/common.20hang.20in.20rust-analyzer.html#249161713">(Aug 11 2021 at 20:00)</a>:</h4>
<p><span class="user-mention" data-user-id="125131">@detrumi</span> it's been a while since I've looked at this, but I spent some time before trying to refactor chalk-integration to better test closures (some work <a href="https://github.com/jackh726/chalk/commit/77e606b2eac452d20fba1b18b6c611fa8d7ea69b">here</a>)</p>



<a name="249161988"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/common%20hang%20in%20rust-analyzer/near/249161988" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/common.20hang.20in.20rust-analyzer.html#249161988">(Aug 11 2021 at 20:02)</a>:</h4>
<p>Basically, I was trying to have a way to test a closures that we haven't fully inferred their signature yet</p>



<a name="249162165"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/common%20hang%20in%20rust-analyzer/near/249162165" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/common.20hang.20in.20rust-analyzer.html#249162165">(Aug 11 2021 at 20:03)</a>:</h4>
<p>basically need to add the ability to specify "variables in the environment" (something like an <code>exists&lt;T&gt;</code> so they can be used in the closure sig too</p>



<a name="249162276"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/common%20hang%20in%20rust-analyzer/near/249162276" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/common.20hang.20in.20rust-analyzer.html#249162276">(Aug 11 2021 at 20:04)</a>:</h4>
<p>I never got it to fully work and I was never actually able to reproduce the problem</p>



<a name="249162382"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/common%20hang%20in%20rust-analyzer/near/249162382" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/common.20hang.20in.20rust-analyzer.html#249162382">(Aug 11 2021 at 20:05)</a>:</h4>
<p>There's also at least one topic on Zulip that I've dug into it a big: i.e. <a href="#narrow/stream/144729-wg-traits/topic/closure.20goal.20keeps.20expanding.20lifetimes.20chalk.23688">https://rust-lang.zulipchat.com/#narrow/stream/144729-wg-traits/topic/closure.20goal.20keeps.20expanding.20lifetimes.20chalk.23688</a></p>



<a name="249162497"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/common%20hang%20in%20rust-analyzer/near/249162497" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/common.20hang.20in.20rust-analyzer.html#249162497">(Aug 11 2021 at 20:06)</a>:</h4>
<p>Also <a href="#narrow/stream/144729-wg-traits/topic/Functions.20in.20Chalk">https://rust-lang.zulipchat.com/#narrow/stream/144729-wg-traits/topic/Functions.20in.20Chalk</a></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>