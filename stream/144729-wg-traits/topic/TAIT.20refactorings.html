<html>
<head><meta charset="utf-8"><title>TAIT refactorings · wg-traits · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/index.html">wg-traits</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAIT.20refactorings.html">TAIT refactorings</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="250536825"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAIT%20refactorings/near/250536825" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAIT.20refactorings.html#250536825">(Aug 24 2021 at 19:35)</a>:</h4>
<p>Hey <span class="user-mention" data-user-id="124288">@oli</span> -- it occurred to me that your changes to make "impl trait" act like an unbound ty-var actually line up reasonably well with Chalk's idea of <em>alias types</em>.</p>



<a name="250536862"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAIT%20refactorings/near/250536862" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAIT.20refactorings.html#250536862">(Aug 24 2021 at 19:35)</a>:</h4>
<p>An <em>alias</em> type basically being a type that can be unified with anything else, but we generate some obligations that will prove that it is true</p>



<a name="250536874"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAIT%20refactorings/near/250536874" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAIT.20refactorings.html#250536874">(Aug 24 2021 at 19:35)</a>:</h4>
<p>That might be a useful bit of terminology to introduce</p>



<a name="250613243"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAIT%20refactorings/near/250613243" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAIT.20refactorings.html#250613243">(Aug 25 2021 at 12:37)</a>:</h4>
<p>cool! gonna need to read up on chalk once I'm done with this</p>



<a name="250639928"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAIT%20refactorings/near/250639928" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAIT.20refactorings.html#250639928">(Aug 25 2021 at 15:58)</a>:</h4>
<p><span class="user-mention" data-user-id="124288">@oli</span> so <span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> was asking me about this example:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">type</span> <span class="nc">Foo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">impl</span><span class="w"> </span><span class="n">Debug</span><span class="w"></span>
<span class="c1">// Not allowed (error) under current setup</span>
<span class="k">fn</span> <span class="nf">foo3</span><span class="p">(</span><span class="n">x</span>: <span class="nc">Foo</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{:?}"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="250639953"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAIT%20refactorings/near/250639953" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAIT.20refactorings.html#250639953">(Aug 25 2021 at 15:59)</a>:</h4>
<p>and I got to thinking</p>



<a name="250640010"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAIT%20refactorings/near/250640010" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAIT.20refactorings.html#250640010">(Aug 25 2021 at 15:59)</a>:</h4>
<p><em>for the purposes of method dispatch</em>, if we have an unconstrained TAIT, or even a TAIT that is constrained to an unbound var, we could manage method dispatch by only considering the methods defined in the trait itself</p>



<a name="250640020"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAIT%20refactorings/near/250640020" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAIT.20refactorings.html#250640020">(Aug 25 2021 at 15:59)</a>:</h4>
<p>this might... mean that this example would actually work?</p>



<a name="250640440"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAIT%20refactorings/near/250640440" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAIT.20refactorings.html#250640440">(Aug 25 2021 at 16:02)</a>:</h4>
<p>I'm not sure what do you mean by work or not work :)</p>



<a name="250640464"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAIT%20refactorings/near/250640464" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAIT.20refactorings.html#250640464">(Aug 25 2021 at 16:02)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#![feature(type_alias_impl_trait)]</span><span class="w"></span>

<span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">fmt</span>::<span class="n">Debug</span><span class="p">;</span><span class="w"></span>

<span class="k">type</span> <span class="nc">Foo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">impl</span><span class="w"> </span><span class="n">Debug</span><span class="p">;</span><span class="w"></span>

<span class="c1">// Not allowed (error) under current setup</span>
<span class="k">fn</span> <span class="nf">foo3</span><span class="p">(</span><span class="n">x</span>: <span class="nc">Foo</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{:?}"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">foo3</span><span class="p">(</span><span class="s">"hi"</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="250640475"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAIT%20refactorings/near/250640475" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAIT.20refactorings.html#250640475">(Aug 25 2021 at 16:02)</a>:</h4>
<p>this doesn't compile</p>



<a name="250640516"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAIT%20refactorings/near/250640516" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAIT.20refactorings.html#250640516">(Aug 25 2021 at 16:02)</a>:</h4>
<p>but this</p>



<a name="250640524"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAIT%20refactorings/near/250640524" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAIT.20refactorings.html#250640524">(Aug 25 2021 at 16:02)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#![feature(type_alias_impl_trait)]</span><span class="w"></span>

<span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">fmt</span>::<span class="n">Debug</span><span class="p">;</span><span class="w"></span>

<span class="k">type</span> <span class="nc">Foo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">impl</span><span class="w"> </span><span class="n">Debug</span><span class="p">;</span><span class="w"></span>

<span class="c1">// Not allowed (error) under current setup</span>
<span class="k">fn</span> <span class="nf">foo3</span><span class="p">(</span><span class="n">x</span>: <span class="nc">Foo</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{:?}"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="250640534"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAIT%20refactorings/near/250640534" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAIT.20refactorings.html#250640534">(Aug 25 2021 at 16:03)</a>:</h4>
<p>kind of does</p>



<a name="250640565"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAIT%20refactorings/near/250640565" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAIT.20refactorings.html#250640565">(Aug 25 2021 at 16:03)</a>:</h4>
<p>I meant "kind of" because there's no defining use</p>



<a name="250640625"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAIT%20refactorings/near/250640625" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAIT.20refactorings.html#250640625">(Aug 25 2021 at 16:03)</a>:</h4>
<p>but if you add one like ...</p>



<a name="250640633"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAIT%20refactorings/near/250640633" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAIT.20refactorings.html#250640633">(Aug 25 2021 at 16:03)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#![feature(type_alias_impl_trait)]</span><span class="w"></span>

<span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">fmt</span>::<span class="n">Debug</span><span class="p">;</span><span class="w"></span>

<span class="k">type</span> <span class="nc">Foo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">impl</span><span class="w"> </span><span class="n">Debug</span><span class="p">;</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">foo1</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">Foo</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="mi">2</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// Not allowed (error) under current setup</span>
<span class="k">fn</span> <span class="nf">foo3</span><span class="p">(</span><span class="n">x</span>: <span class="nc">Foo</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{:?}"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="250640638"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAIT%20refactorings/near/250640638" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAIT.20refactorings.html#250640638">(Aug 25 2021 at 16:03)</a>:</h4>
<p>it compiles</p>



<a name="250640788"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAIT%20refactorings/near/250640788" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAIT.20refactorings.html#250640788">(Aug 25 2021 at 16:04)</a>:</h4>
<p>but I guess you would never be able to call <code>foo3</code> at least with the current status of things</p>



<a name="250640860"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAIT%20refactorings/near/250640860" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAIT.20refactorings.html#250640860">(Aug 25 2021 at 16:05)</a>:</h4>
<p>you would get things like <code>expected opaque type, found &amp;str</code></p>



<a name="250641635"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAIT%20refactorings/near/250641635" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAIT.20refactorings.html#250641635">(Aug 25 2021 at 16:11)</a>:</h4>
<p>we can also discuss about this in <a href="https://github.com/rust-lang/rust/issues/88332">#88332</a></p>



<a name="250641637"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAIT%20refactorings/near/250641637" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAIT.20refactorings.html#250641637">(Aug 25 2021 at 16:11)</a>:</h4>
<p>Can you do <code>foo3(foo1())</code></p>



<a name="250641711"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAIT%20refactorings/near/250641711" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAIT.20refactorings.html#250641711">(Aug 25 2021 at 16:12)</a>:</h4>
<p>I guess nope</p>



<a name="250641716"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAIT%20refactorings/near/250641716" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAIT.20refactorings.html#250641716">(Aug 25 2021 at 16:12)</a>:</h4>
<p>let me try</p>



<a name="250641759"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAIT%20refactorings/near/250641759" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAIT.20refactorings.html#250641759">(Aug 25 2021 at 16:12)</a>:</h4>
<p>ohh you can</p>



<a name="250641767"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAIT%20refactorings/near/250641767" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAIT.20refactorings.html#250641767">(Aug 25 2021 at 16:12)</a>:</h4>
<p>makes sense</p>



<a name="250641771"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAIT%20refactorings/near/250641771" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAIT.20refactorings.html#250641771">(Aug 25 2021 at 16:12)</a>:</h4>
<p>then this works</p>



<a name="250641773"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAIT%20refactorings/near/250641773" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAIT.20refactorings.html#250641773">(Aug 25 2021 at 16:12)</a>:</h4>
<p>I would hope so</p>



<a name="250641803"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAIT%20refactorings/near/250641803" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAIT.20refactorings.html#250641803">(Aug 25 2021 at 16:12)</a>:</h4>
<p>I meant, I said I guess nope, but it should work :)</p>



<a name="250641820"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAIT%20refactorings/near/250641820" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAIT.20refactorings.html#250641820">(Aug 25 2021 at 16:13)</a>:</h4>
<p>I thought this was going to fail also</p>



<a name="250642044"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAIT%20refactorings/near/250642044" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAIT.20refactorings.html#250642044">(Aug 25 2021 at 16:14)</a>:</h4>
<p>so seems like almost everything works fine then, related to args</p>



<a name="250642051"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAIT%20refactorings/near/250642051" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAIT.20refactorings.html#250642051">(Aug 25 2021 at 16:15)</a>:</h4>
<p>the weird thing I see is ...</p>



<a name="250642068"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAIT%20refactorings/near/250642068" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAIT.20refactorings.html#250642068">(Aug 25 2021 at 16:15)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">foo1</span><span class="p">(</span><span class="k">mut</span><span class="w"> </span><span class="n">x</span>: <span class="nc">Foo</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">22_</span><span class="k">u32</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="c1">//~^ ERROR: mismatched types [E0308]</span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="250642234"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAIT%20refactorings/near/250642234" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAIT.20refactorings.html#250642234">(Aug 25 2021 at 16:16)</a>:</h4>
<p>I'm not sure what the RFC says about this case but <code>x = 22_u32</code> may be a defining use and given that it's the only one that exists in the current code it should work</p>



<a name="250642357"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAIT%20refactorings/near/250642357" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAIT.20refactorings.html#250642357">(Aug 25 2021 at 16:16)</a>:</h4>
<p>if you invoke <code>foo1</code> using <code>u32</code> it should also work, unless at some point the provided type is different than <code>u32</code> or <code>x</code> is assigned to a different type</p>



<a name="250642401"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAIT%20refactorings/near/250642401" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAIT.20refactorings.html#250642401">(Aug 25 2021 at 16:17)</a>:</h4>
<p>See, this doesn't make sense to me: in order for you to call <code>foo1</code>, you would have to have constructed a <code>Foo</code></p>



<a name="250642446"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAIT%20refactorings/near/250642446" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAIT.20refactorings.html#250642446">(Aug 25 2021 at 16:17)</a>:</h4>
<p>so, assigning a value to <code>x</code> can't "define" <code>Foo</code></p>



<a name="250642844"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAIT%20refactorings/near/250642844" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAIT.20refactorings.html#250642844">(Aug 25 2021 at 16:20)</a>:</h4>
<p>well, that's true</p>



<a name="250642883"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAIT%20refactorings/near/250642883" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAIT.20refactorings.html#250642883">(Aug 25 2021 at 16:20)</a>:</h4>
<p>anyway ... you could be assigning something that is of the right type</p>



<a name="250642893"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAIT%20refactorings/near/250642893" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAIT.20refactorings.html#250642893">(Aug 25 2021 at 16:20)</a>:</h4>
<p>why is this complaining?</p>



<a name="250642983"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAIT%20refactorings/near/250642983" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAIT.20refactorings.html#250642983">(Aug 25 2021 at 16:21)</a>:</h4>
<p>Well, the whole point of TAIT is they're "opaque". i.e. you can't know that <code>u32</code> is the "right type" for <code>Foo</code></p>



<a name="250643252"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAIT%20refactorings/near/250643252" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAIT.20refactorings.html#250643252">(Aug 25 2021 at 16:23)</a>:</h4>
<p>well you're right</p>



<a name="250643484"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAIT%20refactorings/near/250643484" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAIT.20refactorings.html#250643484">(Aug 25 2021 at 16:24)</a>:</h4>
<p>but in some sense in several places you expect an opaque and pass a concrete thing, because that's also the point</p>



<a name="250643540"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAIT%20refactorings/near/250643540" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAIT.20refactorings.html#250643540">(Aug 25 2021 at 16:25)</a>:</h4>
<p>several places -&gt; defining use places</p>



<a name="250643574"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAIT%20refactorings/near/250643574" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAIT.20refactorings.html#250643574">(Aug 25 2021 at 16:25)</a>:</h4>
<p>but yeah if assign is not a defining use then I think what you're saying is correct</p>



<a name="250644929"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAIT%20refactorings/near/250644929" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAIT.20refactorings.html#250644929">(Aug 25 2021 at 16:36)</a>:</h4>
<p>I'm going to move part of the discussions we are having to <a class="stream-topic" data-stream-id="144729" href="/#narrow/stream/144729-wg-traits/topic/Reconcile.20TAIT.20tests.20.2386727">#wg-traits &gt; Reconcile TAIT tests #86727</a></p>



<a name="250658804"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAIT%20refactorings/near/250658804" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAIT.20refactorings.html#250658804">(Aug 25 2021 at 18:16)</a>:</h4>
<p>if you are inside the scope of <code>Foo</code>, then the function can define what it is</p>



<a name="250658853"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAIT%20refactorings/near/250658853" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAIT.20refactorings.html#250658853">(Aug 25 2021 at 18:17)</a>:</h4>
<p>it's very artificial code in this case, but you can imagine for example</p>



<a name="250658932"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAIT%20refactorings/near/250658932" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAIT.20refactorings.html#250658932">(Aug 25 2021 at 18:17)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">type</span> <span class="nc">Foo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">impl</span><span class="w"> </span><span class="n">Debug</span><span class="p">;</span><span class="w"> </span><span class="c1">// outside the module, we just know this is a debug thing</span>
<span class="k">fn</span> <span class="nf">foo1</span><span class="p">(</span><span class="n">cache</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="nb">Option</span><span class="o">&lt;</span><span class="n">Foo</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">u32</span> <span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">cache</span><span class="p">.</span><span class="n">is_none</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">cache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="mi">0_</span><span class="k">u32</span><span class="p">);</span><span class="w"> </span><span class="c1">// inside, we know it's an integer</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="o">..</span><span class="p">.</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="250659055"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAIT%20refactorings/near/250659055" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAIT.20refactorings.html#250659055">(Aug 25 2021 at 18:18)</a>:</h4>
<p>this could be called like <code>foo1(&amp;mut None)</code></p>



<a name="250659060"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAIT%20refactorings/near/250659060" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAIT.20refactorings.html#250659060">(Aug 25 2021 at 18:18)</a>:</h4>
<p>even from outside the module :)</p>



<a name="250661111"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAIT%20refactorings/near/250661111" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAIT.20refactorings.html#250661111">(Aug 25 2021 at 18:33)</a>:</h4>
<p>Hmm</p>



<a name="250661137"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAIT%20refactorings/near/250661137" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAIT.20refactorings.html#250661137">(Aug 25 2021 at 18:33)</a>:</h4>
<p>Okay, makes sense</p>



<a name="250694383"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAIT%20refactorings/near/250694383" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAIT.20refactorings.html#250694383">(Aug 25 2021 at 22:57)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> ok, so then we need to change <a href="https://github.com/rust-lang/rust/pull/88332/files#diff-3cf983f3df591665271f8552280e1b735f155244002d65a97a37fcb6db8619d6R8">https://github.com/rust-lang/rust/pull/88332/files#diff-3cf983f3df591665271f8552280e1b735f155244002d65a97a37fcb6db8619d6R8</a></p>



<a name="250694420"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAIT%20refactorings/near/250694420" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAIT.20refactorings.html#250694420">(Aug 25 2021 at 22:57)</a>:</h4>
<p>and say maybe <code>// FIXME This should compile, but it currently doesn't</code></p>



<a name="250754428"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAIT%20refactorings/near/250754428" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAIT.20refactorings.html#250754428">(Aug 26 2021 at 11:00)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/144729-wg-traits/topic/TAIT.20refactorings/near/250640010">said</a>:</p>
<blockquote>
<p><em>for the purposes of method dispatch</em>, if we have an unconstrained TAIT, or even a TAIT that is constrained to an unbound var, we could manage method dispatch by only considering the methods defined in the trait itself</p>
</blockquote>
<p>It feels a bit odd to me, that </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">type</span> <span class="nc">Foo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">impl</span><span class="w"> </span><span class="nb">Send</span><span class="w"></span>
<span class="c1">// Not allowed (error) under current setup</span>
<span class="k">fn</span> <span class="nf">foo3</span><span class="p">(</span><span class="n">x</span>: <span class="nc">Foo</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{:?}"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">y</span>: <span class="nc">Foo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">42_</span><span class="k">i32</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>would not work, or... work depending on how typeck walks the function. If it walked backwards or had a more wholistic approach, this would suddenly change how it worked or not</p>



<a name="250754661"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAIT%20refactorings/near/250754661" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAIT.20refactorings.html#250754661">(Aug 26 2021 at 11:01)</a>:</h4>
<p>can we, instead of failing with a trait not implemented error, register an obligation and continue as if it had worked? Any further types (e.g. from method return types) could be projection types</p>



<a name="250754721"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAIT%20refactorings/near/250754721" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAIT.20refactorings.html#250754721">(Aug 26 2021 at 11:02)</a>:</h4>
<p>this would then delay such decisions until the entire function has been visited</p>



<a name="250754732"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAIT%20refactorings/near/250754732" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAIT.20refactorings.html#250754732">(Aug 26 2021 at 11:02)</a>:</h4>
<p>or... are we getting into chalky territory here?</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>