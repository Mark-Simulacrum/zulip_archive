<html>
<head><meta charset="utf-8"><title>CoerceUnsized limitations · wg-traits · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/index.html">wg-traits</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/CoerceUnsized.20limitations.html">CoerceUnsized limitations</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="255780722"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/CoerceUnsized%20limitations/near/255780722" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> CraftSpider <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/CoerceUnsized.20limitations.html#255780722">(Oct 01 2021 at 17:36)</a>:</h4>
<p>Recently, I was looking into the proposed 'storages' API. I wrote up a crate designed more for release than the PoC from a while ago, and during that noticed a significant limitation of <code>CoerceUnsized</code>: You can't coerce an item only storing metadata. I have a <code>Handle(&lt;T as Pointee&gt;::Metadata)</code>, and I'd like it to be possible to coerce this to <code>Handle(&lt;U as Pointee&gt;::Metadata)</code>. This should be possible, as it's just a subset of the normal pointer-to-pointer conversion, but I'm not sure how practical it is to implement.</p>



<a name="255794062"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/CoerceUnsized%20limitations/near/255794062" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/CoerceUnsized.20limitations.html#255794062">(Oct 01 2021 at 19:16)</a>:</h4>
<p>In the future if we every get custom dst's it is possible that unsize coercions do need access to the full pointer. A custom dst T could store it's len in the data referenced by it's pointer and coerce to [U] which stores it in the metadata part of the pointer I would guess.</p>



<a name="255810953"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/CoerceUnsized%20limitations/near/255810953" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> CraftSpider <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/CoerceUnsized.20limitations.html#255810953">(Oct 01 2021 at 21:37)</a>:</h4>
<p>Hmm, yeah I see how that could be an issue. I've... even also wanted something like that, with C interop on types where that is true. The pain of wanting two conflicting conveniences :P</p>



<a name="255811383"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/CoerceUnsized%20limitations/near/255811383" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> CraftSpider <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/CoerceUnsized.20limitations.html#255811383">(Oct 01 2021 at 21:41)</a>:</h4>
<p>Well. I guess not conflicting, the custom unsizing logic you just described would work to allow unsizing the thing _using_ the handle, even if the handle couldn't implement it itself. It needs the context of the owner, but the owner has both parts of the pointer and so could just put them together and unsize.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>