<html>
<head><meta charset="utf-8"><title>norm under binders · wg-traits · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/index.html">wg-traits</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/norm.20under.20binders.html">norm under binders</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="258625309"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/norm%20under%20binders/near/258625309" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/norm.20under.20binders.html#258625309">(Oct 21 2021 at 22:11)</a>:</h4>
<p>Is it intended that the normalization under binders PR might stop things from ICEing but still not compile?<br>
<a href="https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2018&amp;gist=6120567cf7e6862f726d428e396180f5">this code</a>:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">trait</span><span class="w"> </span><span class="n">Trait</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">Out</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">out</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span>::<span class="n">Out</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">impl</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Trait</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="kt">u8</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">Out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">u8</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">out</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span>::<span class="n">Out</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="bp">self</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">call</span><span class="o">&lt;</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">D</span><span class="o">&gt;</span><span class="p">(</span><span class="n">d</span>: <span class="nc">D</span><span class="p">,</span><span class="w"> </span><span class="n">f</span>: <span class="nc">F</span><span class="p">)</span><span class="w"> </span><span class="k">where</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="n">D</span>: <span class="nc">Trait</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="n">F</span>: <span class="nb">Fn</span><span class="p">(</span><span class="o">&lt;</span><span class="n">D</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Trait</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;&gt;</span>::<span class="n">Out</span><span class="p">),</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">f</span><span class="p">(</span><span class="n">d</span><span class="p">.</span><span class="n">out</span><span class="p">())</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">call</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">_</span><span class="o">|</span><span class="w"> </span><span class="p">());</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>gives an error:</p>
<div class="codehilite"><pre><span></span><code>error[E0631]: type mismatch in closure arguments
  --&gt; src/main.rs:21:5
   |
21 |     call(5, |_| ());
   |     ^^^^    ------ found signature of `fn(u8) -&gt; _`
   |     |
   |     expected signature of `for&lt;&#39;a&gt; fn(&lt;u8 as Trait&lt;&#39;a&gt;&gt;::Out) -&gt; _`
   |
</code></pre></div>
<p>instead of the <code>OutputTypeParameterMismatch</code> that it used to give despite the fact that <code>for&lt;'a&gt; &lt;u8 as Trait&lt;'a&gt;&gt;::Out == u8</code></p>



<a name="258625517"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/norm%20under%20binders/near/258625517" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/norm.20under.20binders.html#258625517">(Oct 21 2021 at 22:13)</a>:</h4>
<p>See <a href="https://github.com/rust-lang/rust/issues/88441">#88441</a></p>



<a name="258625534"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/norm%20under%20binders/near/258625534" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/norm.20under.20binders.html#258625534">(Oct 21 2021 at 22:13)</a>:</h4>
<p>I think that's the PR</p>



<a name="258625559"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/norm%20under%20binders/near/258625559" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/norm.20under.20binders.html#258625559">(Oct 21 2021 at 22:13)</a>:</h4>
<p>hmm okay</p>



<a name="258625563"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/norm%20under%20binders/near/258625563" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/norm.20under.20binders.html#258625563">(Oct 21 2021 at 22:13)</a>:</h4>
<p>It is</p>



<a name="258625628"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/norm%20under%20binders/near/258625628" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/norm.20under.20binders.html#258625628">(Oct 21 2021 at 22:14)</a>:</h4>
<p>is there a bunch of "small" stuff around to make things "just work<span aria-label="tm" class="emoji emoji-2122" role="img" title="tm">:tm:</span>"</p>



<a name="258625659"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/norm%20under%20binders/near/258625659" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/norm.20under.20binders.html#258625659">(Oct 21 2021 at 22:14)</a>:</h4>
<p>I was running into other weirdness with hrtb + assoc type bounds not to do with closures <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="258625667"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/norm%20under%20binders/near/258625667" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/norm.20under.20binders.html#258625667">(Oct 21 2021 at 22:14)</a>:</h4>
<p>There are a few cases where there's stuff to do</p>



<a name="258625682"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/norm%20under%20binders/near/258625682" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/norm.20under.20binders.html#258625682">(Oct 21 2021 at 22:14)</a>:</h4>
<p>I have a list of issue numbers</p>



<a name="258625698"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/norm%20under%20binders/near/258625698" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/norm.20under.20binders.html#258625698">(Oct 21 2021 at 22:14)</a>:</h4>
<p>On mobile, so can't link</p>



<a name="258625714"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/norm%20under%20binders/near/258625714" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/norm.20under.20binders.html#258625714">(Oct 21 2021 at 22:15)</a>:</h4>
<p>But they're there</p>



<a name="258625783"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/norm%20under%20binders/near/258625783" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/norm.20under.20binders.html#258625783">(Oct 21 2021 at 22:15)</a>:</h4>
<p>hmm alright. do you know if the following is fixed by some of that stuff or if it's a separate issue?:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">trait</span><span class="w"> </span><span class="n">Foo</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="k">impl</span><span class="w"> </span><span class="n">Foo</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="k">impl</span><span class="w"> </span><span class="n">Foo</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="k">trait</span><span class="w"> </span><span class="n">Bar</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">Assoc</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="k">impl</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Bar</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="kt">u8</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">Assoc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">bool</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="k">impl</span><span class="o">&lt;'</span><span class="na">a</span><span class="p">,</span><span class="w"> </span><span class="n">T</span>: <span class="nc">Bar</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">U</span>: <span class="nc">Bar</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">Bar</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">U</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">Assoc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">T</span>::<span class="n">Assoc</span><span class="p">,</span><span class="w"> </span><span class="n">U</span>::<span class="n">Assoc</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">calls</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">has_bound</span>::<span class="o">&lt;</span><span class="p">(</span><span class="kt">u8</span><span class="p">,</span><span class="w"> </span><span class="kt">u8</span><span class="p">)</span><span class="o">&gt;</span><span class="p">((</span><span class="mi">1_</span><span class="k">u8</span><span class="p">,</span><span class="w"> </span><span class="mi">1_</span><span class="k">u8</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="c1">//~^ no error</span>
<span class="w">    </span><span class="n">has_bound</span><span class="p">((</span><span class="mi">1_</span><span class="k">u8</span><span class="p">,</span><span class="w"> </span><span class="mi">1_</span><span class="k">u8</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="c1">//~^ error: the trait bound `for&lt;'a&gt; &lt;_ as Bar&lt;'a&gt;&gt;::Assoc: Foo` is not satisfied</span>
<span class="p">}</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">has_bound</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">arg</span>: <span class="nc">T</span><span class="p">)</span><span class="w"></span>
<span class="k">where</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="n">T</span>: <span class="nc">Bar</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&lt;</span><span class="n">T</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Bar</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;&gt;</span>::<span class="n">Assoc</span>: <span class="nc">Foo</span><span class="p">,</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
</code></pre></div>



<a name="258625936"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/norm%20under%20binders/near/258625936" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/norm.20under.20binders.html#258625936">(Oct 21 2021 at 22:16)</a>:</h4>
<p>The only PR open that will fix anything is <a href="https://github.com/rust-lang/rust/issues/88441">#88441</a></p>



<a name="258625982"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/norm%20under%20binders/near/258625982" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/norm.20under.20binders.html#258625982">(Oct 21 2021 at 22:17)</a>:</h4>
<p>Everything else is more difficult and basically needs lazy norm</p>



<a name="258625997"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/norm%20under%20binders/near/258625997" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/norm.20under.20binders.html#258625997">(Oct 21 2021 at 22:17)</a>:</h4>
<p>darn okay <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="258626082"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/norm%20under%20binders/near/258626082" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/norm.20under.20binders.html#258626082">(Oct 21 2021 at 22:18)</a>:</h4>
<p>are we at all close to lazy norm at this point or is it still far off</p>



<a name="258626191"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/norm%20under%20binders/near/258626191" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/norm.20under.20binders.html#258626191">(Oct 21 2021 at 22:19)</a>:</h4>
<p>In theory it's a while off. But idk someone might be able to get it to work with effort</p>



<a name="258718966"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/norm%20under%20binders/near/258718966" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/norm.20under.20binders.html#258718966">(Oct 22 2021 at 14:25)</a>:</h4>
<p>Is there a hackmd or writeup anywhere detailing exactly what lazy norm is vs how rustc currently works?</p>



<a name="258719409"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/norm%20under%20binders/near/258719409" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/norm.20under.20binders.html#258719409">(Oct 22 2021 at 14:28)</a>:</h4>
<p><a href="#narrow/stream/144729-wg-traits/topic/Rustc.20lazy.20norm">https://rust-lang.zulipchat.com/#narrow/stream/144729-wg-traits/topic/Rustc.20lazy.20norm</a> contains a write-up on an attempt to implement lazy norm and a link to a branch with the implementation.</p>



<a name="258719865"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/norm%20under%20binders/near/258719865" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/norm.20under.20binders.html#258719865">(Oct 22 2021 at 14:31)</a>:</h4>
<p><a href="https://rust-lang.github.io/chalk/book/clauses/type_equality.html">https://rust-lang.github.io/chalk/book/clauses/type_equality.html</a> gives an overview for some context</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>