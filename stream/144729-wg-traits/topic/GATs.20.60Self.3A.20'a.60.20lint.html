<html>
<head><meta charset="utf-8"><title>GATs `Self: &#x27;a` lint · wg-traits · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/index.html">wg-traits</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html">GATs `Self: &#x27;a` lint</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="256422756"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256422756" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256422756">(Oct 06 2021 at 14:42)</a>:</h4>
<p>So, I'm starting to work on/think about the <code>Self: 'a</code> lint</p>



<a name="256422798"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256422798" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256422798">(Oct 06 2021 at 14:43)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span></p>



<a name="256422807"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256422807" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256422807">(Oct 06 2021 at 14:43)</a>:</h4>
<p>I've got two "canonical" examples in mind:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">trait</span><span class="w"> </span><span class="n">Iterable</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">Item</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">iter</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;'</span><span class="na">a</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span>::<span class="n">Item</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="k">trait</span><span class="w"> </span><span class="n">Deserializer</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">Out</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">deserialize</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">input</span>: <span class="kp">&amp;</span><span class="o">'</span><span class="na">a</span> <span class="nc">T</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span>::<span class="n">Out</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="256422837"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256422837" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256422837">(Oct 06 2021 at 14:43)</a>:</h4>
<p>The former requires <code>Self: 'a</code>, the second <code>T: 'a</code></p>



<a name="256422861"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256422861" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256422861">(Oct 06 2021 at 14:43)</a>:</h4>
<p>The general scheme I'm going for is:</p>



<a name="256422888"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256422888" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256422888">(Oct 06 2021 at 14:43)</a>:</h4>
<p>For each GAT:</p>



<a name="256422959"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256422959" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256422959">(Oct 06 2021 at 14:44)</a>:</h4>
<p>Iterate through each function in the trait</p>



<a name="256422980"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256422980" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256422980">(Oct 06 2021 at 14:44)</a>:</h4>
<p>Look for regions appearing in the GAT substs</p>



<a name="256423001"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256423001" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256423001">(Oct 06 2021 at 14:44)</a>:</h4>
<p><code>'a</code> for both examples above</p>



<a name="256423058"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256423058" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256423058">(Oct 06 2021 at 14:44)</a>:</h4>
<p>Then, for each input argument, find the <em>implied</em> outlives bounds</p>



<a name="256423096"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256423096" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256423096">(Oct 06 2021 at 14:45)</a>:</h4>
<p>For the first, it's <code>Self: 'a</code>, for the latter, it's <code>T: 'a</code></p>



<a name="256423162"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256423162" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256423162">(Oct 06 2021 at 14:45)</a>:</h4>
<p>Now, these are essentially the required bounds on the GAT</p>



<a name="256423240"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256423240" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256423240">(Oct 06 2021 at 14:46)</a>:</h4>
<p>Since that's the only way you can borrow from that arg</p>



<a name="256434751"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256434751" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256434751">(Oct 06 2021 at 15:52)</a>:</h4>
<p>I suppose one place where we can fall flat here is <code>fn deserialize2&lt;'a, 'b: 'a&gt;(&amp;self, input: &amp;'b T) -&gt; Self::Out&lt;'a&gt;;</code></p>



<a name="256437289"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256437289" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256437289">(Oct 06 2021 at 16:05)</a>:</h4>
<p>But...maybe this "good". Not trying to handle this case means the rules are simpler and provides a relatively easy way to opt-out</p>



<a name="256452624"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256452624" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256452624">(Oct 06 2021 at 17:43)</a>:</h4>
<p>On the other, we can probably end up with the same bounds, since we know that <code>'b: 'a</code> and <code>T: 'b</code>, so we can infer that <code>T: 'a</code> is also implied, and so needs a bound</p>



<a name="256454484"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256454484" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256454484">(Oct 06 2021 at 17:54)</a>:</h4>
<p>I guess to that a step further, it would then make <code>fn deserialize2&lt;'a, 'b: 'a&gt;(&amp;self, input: &amp;'b T, input2: &amp;'a T) -&gt; Self::Out&lt;'a&gt;;</code> more complicated.</p>
<p>In theory, you can generate a return type from both <code>input</code> and <code>input2</code>, given the right where clauses. But with slightly more lax where clauses, you could also only generate a return type from <code>input2</code>. (Then, of course, with no where clauses, you could generate a return type given that the GAT contains no lifetimes)</p>



<a name="256490740"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256490740" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256490740">(Oct 06 2021 at 21:53)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">error</span>: <span class="nc">Missing</span><span class="w"> </span><span class="n">bound</span>: <span class="nc">Self</span>: <span class="o">'</span><span class="na">a</span>
  <span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">ui</span><span class="o">/</span><span class="n">generic</span><span class="o">-</span><span class="n">associated</span><span class="o">-</span><span class="n">types</span><span class="o">/</span><span class="bp">self</span><span class="o">-</span><span class="n">outlives</span><span class="o">-</span><span class="n">lint</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">6</span>:<span class="mi">14</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="n">LL</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="k">type</span> <span class="nc">Item</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w">              </span><span class="o">^^^^</span><span class="w"></span>

<span class="n">error</span>: <span class="nc">Missing</span><span class="w"> </span><span class="n">bound</span>: <span class="nc">T</span>: <span class="o">'</span><span class="na">a</span>
  <span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">ui</span><span class="o">/</span><span class="n">generic</span><span class="o">-</span><span class="n">associated</span><span class="o">-</span><span class="n">types</span><span class="o">/</span><span class="bp">self</span><span class="o">-</span><span class="n">outlives</span><span class="o">-</span><span class="n">lint</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">20</span>:<span class="mi">13</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="n">LL</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="k">type</span> <span class="nc">Out</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w">             </span><span class="o">^^^^</span><span class="w"></span>
</code></pre></div>
<p>Decent start. I think this could be done on hir, if we stick to the simple "you must have the implied bounds containing regions in GAT substs from the function in the GAT where clause"</p>



<a name="256490806"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256490806" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256490806">(Oct 06 2021 at 21:54)</a>:</h4>
<p>Though, that does mean we would have to copy over the implied bounds rules</p>



<a name="256490916"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256490916" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256490916">(Oct 06 2021 at 21:55)</a>:</h4>
<p>And potentially precludes more advanced implied bounds</p>



<a name="256491094"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256491094" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256491094">(Oct 06 2021 at 21:57)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232957">Jack Huey</span> <a href="#narrow/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20'a.60.20lint/near/256452624">said</a>:</p>
<blockquote>
<p>On the other, we can probably end up with the same bounds, since we know that <code>'b: 'a</code> and <code>T: 'b</code>, so we can infer that <code>T: 'a</code> is also implied, and so needs a bound</p>
</blockquote>
<p>Thinking about this, this is somewhat an elaboration of outlives bounds</p>



<a name="256493203"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256493203" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256493203">(Oct 06 2021 at 22:15)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> if you get a bit, would love some thoughts here</p>



<a name="256761281"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256761281" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256761281">(Oct 08 2021 at 15:57)</a>:</h4>
<p>ok, <span class="user-mention" data-user-id="232957">@Jack Huey</span> , going to read now :)</p>



<a name="256762327"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256762327" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256762327">(Oct 08 2021 at 16:04)</a>:</h4>
<p><span class="user-mention" data-user-id="232957">@Jack Huey</span> can I see your branch?</p>



<a name="256762373"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256762373" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256762373">(Oct 08 2021 at 16:04)</a>:</h4>
<p>I am debating about the <code>'b: 'a</code> rules</p>



<a name="256762710"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256762710" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256762710">(Oct 08 2021 at 16:07)</a>:</h4>
<p>I'm thinking about the inference we do for outlives bounds on struct declarations</p>



<a name="256763136"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256763136" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256763136">(Oct 08 2021 at 16:09)</a>:</h4>
<p>yes, let me push real quick</p>



<a name="256763158"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256763158" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256763158">(Oct 08 2021 at 16:09)</a>:</h4>
<p>I'm going to go skim back over the code</p>



<a name="256763176"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256763176" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256763176">(Oct 08 2021 at 16:09)</a>:</h4>
<p>it's not a directly analogous situation</p>



<a name="256763183"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256763183" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256763183">(Oct 08 2021 at 16:09)</a>:</h4>
<p>but it's ... close</p>



<a name="256763277"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256763277" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256763277">(Oct 08 2021 at 16:10)</a>:</h4>
<p>it would certainly be easy to handle cases like <code>'b: 'a</code></p>



<a name="256763316"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256763316" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256763316">(Oct 08 2021 at 16:10)</a>:</h4>
<p>any such rules are going to hit weird corner cases that are hard to think about</p>



<a name="256763332"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256763332" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256763332">(Oct 08 2021 at 16:10)</a>:</h4>
<p>e.g., <code>for&lt;'b&gt; 'a: 'b</code> or whatever</p>



<a name="256763413"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256763413" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256763413">(Oct 08 2021 at 16:11)</a>:</h4>
<p><a href="https://github.com/jackh726/rust/tree/gats_diagnostics">https://github.com/jackh726/rust/tree/gats_diagnostics</a></p>



<a name="256763505"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256763505" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256763505">(Oct 08 2021 at 16:11)</a>:</h4>
<p>The second commit is the relevant work</p>



<a name="256763623"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256763623" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256763623">(Oct 08 2021 at 16:12)</a>:</h4>
<p>It's still a bit hacky</p>



<a name="256763733"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256763733" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256763733">(Oct 08 2021 at 16:13)</a>:</h4>
<p>Other interesting test cases</p>



<a name="256763771"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256763771" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256763771">(Oct 08 2021 at 16:13)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">trait</span><span class="w"> </span><span class="n">Deserializer</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">Out</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">deserialize</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">input</span>: <span class="kp">&amp;</span><span class="o">'</span><span class="na">a</span> <span class="nc">T</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="p">(</span><span class="bp">Self</span>::<span class="n">Out</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="bp">Self</span>::<span class="n">Out</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="256763807"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256763807" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256763807">(Oct 08 2021 at 16:13)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">trait</span><span class="w"> </span><span class="n">Deserializer</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">Out</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">deserialize</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">input</span>: <span class="kp">&amp;</span><span class="o">'</span><span class="na">a</span> <span class="nc">T</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Vec</span><span class="o">&lt;</span><span class="bp">Self</span>::<span class="n">Out</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;&gt;</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="256764439"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256764439" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256764439">(Oct 08 2021 at 16:17)</a>:</h4>
<p>Yeah, both should be trivially covered by existing code</p>



<a name="256764558"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256764558" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256764558">(Oct 08 2021 at 16:18)</a>:</h4>
<p>The <code>RegionsInGATs</code> visitor will just add <code>('a, 0)</code> in both cases</p>



<a name="256765279"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256765279" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256765279">(Oct 08 2021 at 16:23)</a>:</h4>
<p>this looks basically good, yes</p>



<a name="256765806"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256765806" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256765806">(Oct 08 2021 at 16:27)</a>:</h4>
<p>At this point, I'm just doing a bit of cleanup. But the unanswered question here does revolve around that <code>'b: 'a</code> corner case.</p>



<a name="256765880"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256765880" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256765880">(Oct 08 2021 at 16:27)</a>:</h4>
<p>Also, should add some tests covering generics on the function itself and such</p>



<a name="256766268"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256766268" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256766268">(Oct 08 2021 at 16:29)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232957">Jack Huey</span> <a href="#narrow/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20'a.60.20lint/near/256765806">said</a>:</p>
<blockquote>
<p>At this point, I'm just doing a bit of cleanup. But the unanswered question here does revolve around that <code>'b: 'a</code> corner case.</p>
</blockquote>
<p>I'm trying to think if there's any precedent.</p>



<a name="256766374"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256766374" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256766374">(Oct 08 2021 at 16:30)</a>:</h4>
<p>I can't think of one. But I think we should extend it.</p>



<a name="256766394"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256766394" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256766394">(Oct 08 2021 at 16:30)</a>:</h4>
<p>Two reasons:</p>



<a name="256766415"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256766415" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256766415">(Oct 08 2021 at 16:30)</a>:</h4>
<ul>
<li>preserves future flexibility</li>
</ul>



<a name="256766448"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256766448" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256766448">(Oct 08 2021 at 16:30)</a>:</h4>
<ul>
<li>matches the supportive nature of this work (i.e., trying to do the right thing, first and foremost)</li>
</ul>



<a name="256766482"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256766482" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256766482">(Oct 08 2021 at 16:31)</a>:</h4>
<p>I don't think that using non-obvious outlives clauses is the "right way" to disable this default</p>



<a name="256767029"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256767029" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256767029">(Oct 08 2021 at 16:34)</a>:</h4>
<p>Hmm okay</p>



<a name="256767053"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256767053" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256767053">(Oct 08 2021 at 16:34)</a>:</h4>
<p>Then that's the next step probably</p>



<a name="256767094"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256767094" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256767094">(Oct 08 2021 at 16:34)</a>:</h4>
<p>Do you know if there's any code anywhere that does this sort of "extension" already</p>



<a name="256769287"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256769287" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256769287">(Oct 08 2021 at 16:49)</a>:</h4>
<p><span class="user-mention" data-user-id="232957">@Jack Huey</span> I think so, yes</p>



<a name="256769300"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256769300" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256769300">(Oct 08 2021 at 16:50)</a>:</h4>
<p>let me try to find it :)</p>



<a name="256771856"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256771856" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256771856">(Oct 08 2021 at 17:06)</a>:</h4>
<p><span class="user-mention" data-user-id="232957">@Jack Huey</span> the code you want is <code>FreeRegionMap</code></p>



<a name="256771892"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256771892" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256771892">(Oct 08 2021 at 17:07)</a>:</h4>
<p><a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_infer/infer/outlives/env/struct.OutlivesEnvironment.html#method.free_region_map">https://doc.rust-lang.org/nightly/nightly-rustc/rustc_infer/infer/outlives/env/struct.OutlivesEnvironment.html#method.free_region_map</a></p>



<a name="256771915"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256771915" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256771915">(Oct 08 2021 at 17:07)</a>:</h4>
<p>it might not expose "transitive relationships" logic though</p>



<a name="256771933"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256771933" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256771933">(Oct 08 2021 at 17:07)</a>:</h4>
<p>and it might not be <em>accessible</em> (but I think it is)</p>



<a name="256772016"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256772016" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256772016">(Oct 08 2021 at 17:07)</a>:</h4>
<p>hmm, how do you get this thing</p>



<a name="256772118"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256772118" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256772118">(Oct 08 2021 at 17:08)</a>:</h4>
<p>I think that's part of the <code>FnCtxt</code> maybe</p>



<a name="256772145"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256772145" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256772145">(Oct 08 2021 at 17:08)</a>:</h4>
<p>do you have a FnCtxt?</p>



<a name="256772153"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256772153" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256772153">(Oct 08 2021 at 17:08)</a>:</h4>
<p>if so, you're fine, yes</p>



<a name="256772164"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256772164" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256772164">(Oct 08 2021 at 17:08)</a>:</h4>
<p>oh, I guess you do</p>



<a name="256772209"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256772209" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256772209">(Oct 08 2021 at 17:09)</a>:</h4>
<p>Not really, but I think it's easy enough to make one</p>



<a name="256772229"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256772229" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256772229">(Oct 08 2021 at 17:09)</a>:</h4>
<p>or move this to somewhere where I do have one</p>



<a name="256772289"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256772289" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256772289">(Oct 08 2021 at 17:09)</a>:</h4>
<p>do you have a param env?</p>



<a name="256772428"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256772428" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256772428">(Oct 08 2021 at 17:10)</a>:</h4>
<p>I'm just treating it as any empty param env</p>



<a name="256772557"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256772557" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256772557">(Oct 08 2021 at 17:11)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/blob/e0aaffd8a45cd0e9f331ec7734713e9de11aa6c8/compiler/rustc_infer/src/infer/outlives/env.rs#L71-L83">https://github.com/rust-lang/rust/blob/e0aaffd8a45cd0e9f331ec7734713e9de11aa6c8/compiler/rustc_infer/src/infer/outlives/env.rs#L71-L83</a></p>



<a name="256772656"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256772656" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256772656">(Oct 08 2021 at 17:12)</a>:</h4>
<p>that's the code that populates the free region map</p>



<a name="256772719"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256772719" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256772719">(Oct 08 2021 at 17:12)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/blob/e0aaffd8a45cd0e9f331ec7734713e9de11aa6c8/compiler/rustc_infer/src/infer/outlives/env.rs#L80">this line, in particular</a></p>



<a name="256772796"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256772796" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256772796">(Oct 08 2021 at 17:12)</a>:</h4>
<p>right</p>



<a name="256772835"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256772835" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256772835">(Oct 08 2021 at 17:13)</a>:</h4>
<p>I'm more curious how to use <code>FreeRegionMap</code> to get the bounds I need</p>



<a name="256773174"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256773174" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256773174">(Oct 08 2021 at 17:15)</a>:</h4>
<p>I guess for something like <code>fn deserialize2&lt;'a, 'b: 'a&gt;(&amp;self, input: &amp;'b T) -&gt; Self::Out&lt;'a&gt;;</code></p>



<a name="256773193"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256773193" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256773193">(Oct 08 2021 at 17:15)</a>:</h4>
<p>I'll have <code>T: 'b</code> already</p>



<a name="256773215"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256773215" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256773215">(Oct 08 2021 at 17:15)</a>:</h4>
<p>And also know that I have <code>'a</code> as a GAT subst</p>



<a name="256773263"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256773263" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256773263">(Oct 08 2021 at 17:15)</a>:</h4>
<p>So, I'll probably just have to go through the all pairs</p>



<a name="256773289"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256773289" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256773289">(Oct 08 2021 at 17:15)</a>:</h4>
<p>and see if we know that <code>'b: 'a</code></p>



<a name="256773338"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256773338" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256773338">(Oct 08 2021 at 17:16)</a>:</h4>
<p>And, if so, require that bound</p>



<a name="256781888"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256781888" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256781888">(Oct 08 2021 at 18:13)</a>:</h4>
<p>Another case we probably need to cover:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">trait</span><span class="w"> </span><span class="n">Des</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">type</span> <span class="nc">Out</span><span class="o">&lt;'</span><span class="na">x</span><span class="p">,</span><span class="w"> </span><span class="n">D</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">fn</span> <span class="nf">des</span><span class="o">&lt;'</span><span class="na">a</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">data</span>: <span class="kp">&amp;</span><span class="o">'</span><span class="na">a</span> <span class="nc">T</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span>::<span class="n">Out</span><span class="o">&lt;'</span><span class="na">a</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="k">impl</span><span class="w"> </span><span class="n">Des</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">type</span> <span class="nc">Out</span><span class="o">&lt;'</span><span class="na">x</span><span class="p">,</span><span class="w"> </span><span class="n">D</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;'</span><span class="na">x</span><span class="w"> </span><span class="n">D</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">fn</span> <span class="nf">des</span><span class="o">&lt;'</span><span class="na">a</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">data</span>: <span class="kp">&amp;</span><span class="o">'</span><span class="na">a</span> <span class="nc">T</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span>::<span class="n">Out</span><span class="o">&lt;'</span><span class="na">a</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">data</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="256786736"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256786736" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256786736">(Oct 08 2021 at 18:45)</a>:</h4>
<p>the FRM does compute the transitive closures</p>



<a name="256786742"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256786742" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256786742">(Oct 08 2021 at 18:45)</a>:</h4>
<p>but I think it doesn't expose an iterator</p>



<a name="256826011"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256826011" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256826011">(Oct 09 2021 at 00:56)</a>:</h4>
<p>Another example that's a bit difficult with the current code:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">struct</span> <span class="nc">Wrap</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">T</span><span class="p">);</span><span class="w"></span>

<span class="k">trait</span><span class="w"> </span><span class="n">Des</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">type</span> <span class="nc">Out</span><span class="o">&lt;'</span><span class="na">x</span><span class="p">,</span><span class="w"> </span><span class="n">D</span><span class="o">&gt;</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">D</span>: <span class="o">'</span><span class="na">x</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">fn</span> <span class="nf">des</span><span class="o">&lt;'</span><span class="na">z</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">data</span>: <span class="kp">&amp;</span><span class="o">'</span><span class="na">z</span> <span class="nc">Wrap</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span>::<span class="n">Out</span><span class="o">&lt;'</span><span class="na">z</span><span class="p">,</span><span class="w"> </span><span class="n">Wrap</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="k">impl</span><span class="w"> </span><span class="n">Des</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">type</span> <span class="nc">Out</span><span class="o">&lt;'</span><span class="na">x</span><span class="p">,</span><span class="w"> </span><span class="n">D</span><span class="o">&gt;</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">D</span>: <span class="o">'</span><span class="na">x</span> <span class="o">=</span><span class="w"> </span><span class="o">&amp;'</span><span class="na">x</span><span class="w"> </span><span class="n">D</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">fn</span> <span class="nf">des</span><span class="o">&lt;'</span><span class="na">a</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">data</span>: <span class="kp">&amp;</span><span class="o">'</span><span class="na">a</span> <span class="nc">Wrap</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span>::<span class="n">Out</span><span class="o">&lt;'</span><span class="na">a</span><span class="p">,</span><span class="w"> </span><span class="n">Wrap</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">data</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="256826161"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256826161" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256826161">(Oct 09 2021 at 00:58)</a>:</h4>
<p>In theory, this isn't difficult: we see <code>Wrap&lt;T&gt;</code> as a GAT subst, and we imply that <code>Wrap&lt;T&gt;: 'a</code>, therefore, we should be able to say that <code>D: 'x</code> is a required clause. However, the current implied bounds code only splits out <code>T: 'a</code>, so it's a bit more difficult</p>



<a name="256964654"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256964654" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256964654">(Oct 10 2021 at 15:51)</a>:</h4>
<p>Ugh I hate this stupid example I came up with</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#![feature(generic_associated_types)]</span><span class="w"></span>

<span class="k">trait</span><span class="w"> </span><span class="n">Trait</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">Out</span><span class="o">&lt;'</span><span class="na">a</span><span class="p">,</span><span class="w"> </span><span class="o">'</span><span class="na">b</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">U</span><span class="p">,</span><span class="w"> </span><span class="n">Z</span><span class="o">&gt;</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">T</span>: <span class="o">'</span><span class="na">a</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">test</span><span class="o">&lt;'</span><span class="na">a</span><span class="p">,</span><span class="w"> </span><span class="o">'</span><span class="na">b</span><span class="p">,</span><span class="w"> </span><span class="n">A</span>: <span class="nc">IntoTupRef</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">input</span>: <span class="kp">&amp;</span><span class="o">'</span><span class="na">a</span> <span class="nc">A</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span>::<span class="n">Out</span><span class="o">&lt;'</span><span class="na">a</span><span class="p">,</span><span class="w"> </span><span class="o">'</span><span class="na">a</span><span class="p">,</span><span class="w"> </span><span class="bp">Self</span>::<span class="n">Out</span><span class="o">&lt;'</span><span class="na">a</span><span class="p">,</span><span class="w"> </span><span class="o">'</span><span class="na">b</span><span class="p">,</span><span class="w"> </span><span class="p">(),</span><span class="w"> </span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="p">(),</span><span class="w"> </span><span class="n">A</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">impl</span><span class="w"> </span><span class="n">Trait</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">Out</span><span class="o">&lt;'</span><span class="na">a</span><span class="p">,</span><span class="w"> </span><span class="o">'</span><span class="na">b</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">U</span><span class="p">,</span><span class="w"> </span><span class="n">Z</span><span class="o">&gt;</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">T</span>: <span class="o">'</span><span class="na">a</span> <span class="o">=</span><span class="w"> </span><span class="o">&amp;'</span><span class="na">a</span><span class="w"> </span><span class="n">T</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">test</span><span class="o">&lt;'</span><span class="na">a</span><span class="p">,</span><span class="w"> </span><span class="o">'</span><span class="na">b</span><span class="p">,</span><span class="w"> </span><span class="n">A</span>: <span class="nc">IntoTupRef</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">input</span>: <span class="kp">&amp;</span><span class="o">'</span><span class="na">a</span> <span class="nc">A</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span>::<span class="n">Out</span><span class="o">&lt;'</span><span class="na">a</span><span class="p">,</span><span class="w"> </span><span class="o">'</span><span class="na">a</span><span class="p">,</span><span class="w"> </span><span class="bp">Self</span>::<span class="n">Out</span><span class="o">&lt;'</span><span class="na">a</span><span class="p">,</span><span class="w"> </span><span class="o">'</span><span class="na">b</span><span class="p">,</span><span class="w"> </span><span class="p">(),</span><span class="w"> </span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="p">(),</span><span class="w"> </span><span class="n">A</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">input</span><span class="p">.</span><span class="n">tup</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">trait</span><span class="w"> </span><span class="n">IntoTupRef</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">tup</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;&amp;</span><span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">struct</span> <span class="nc">Mine</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;'</span><span class="na">a</span><span class="w"> </span><span class="o">&amp;'</span><span class="na">a</span><span class="w"> </span><span class="p">());</span><span class="w"></span>

<span class="k">impl</span><span class="w"> </span><span class="n">IntoTupRef</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Mine</span><span class="o">&lt;'</span><span class="nb">_</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">tup</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;&amp;</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="mi">0</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="256964723"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256964723" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256964723">(Oct 10 2021 at 15:52)</a>:</h4>
<p>Don't mind the extra parameters on Out, I got here playing around with impls to try to figure out what clauses we want to require</p>



<a name="256964898"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256964898" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256964898">(Oct 10 2021 at 15:55)</a>:</h4>
<p>But essentially ran into this, which more or else shows that we're not really going to be able to be "perfect" here, since we can end up a situation where we don't have an params in the GAT, but we still need a where clause</p>



<a name="256965032"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256965032" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256965032">(Oct 10 2021 at 15:57)</a>:</h4>
<p>Cleaned up a bit: <a href="https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2018&amp;gist=52fdd7b34c3997fcbec9b79e7b73b0a2">https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2018&amp;gist=52fdd7b34c3997fcbec9b79e7b73b0a2</a></p>



<a name="256965634"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256965634" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256965634">(Oct 10 2021 at 16:06)</a>:</h4>
<p>I don't think this matters for the case where the param is on the trait itself, since the rule there is only dependent on the function input args and the lifetimes we see on the GAT. Whereas when we pass both a type and a lifetime to a GAT, we can end up with the case where there's no direct obvious link between the two</p>



<a name="256965754"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/256965754" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#256965754">(Oct 10 2021 at 16:08)</a>:</h4>
<p>Simplified a bit more: <a href="https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2018&amp;gist=302d44b3cef88a3b21dbf6e5a9bb89e6">https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2018&amp;gist=302d44b3cef88a3b21dbf6e5a9bb89e6</a></p>



<a name="257063138"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/257063138" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#257063138">(Oct 11 2021 at 13:20)</a>:</h4>
<p>Even more simple: <a href="https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2018&amp;gist=ae52e60227be03d0047983fbc01539a3">https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2018&amp;gist=ae52e60227be03d0047983fbc01539a3</a></p>



<a name="257842904"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/257842904" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#257842904">(Oct 16 2021 at 16:19)</a>:</h4>
<p>Okay so I have a working branch: <a href="https://github.com/jackh726/rust/tree/gats_diagnostics">https://github.com/jackh726/rust/tree/gats_diagnostics</a></p>



<a name="257842914"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/257842914" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#257842914">(Oct 16 2021 at 16:20)</a>:</h4>
<p>Lots of errors in GAT tests</p>



<a name="257842955"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/257842955" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#257842955">(Oct 16 2021 at 16:20)</a>:</h4>
<p>Some seem legit</p>



<a name="257842964"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/257842964" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#257842964">(Oct 16 2021 at 16:20)</a>:</h4>
<p>Others need some consideration</p>



<a name="257842971"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/257842971" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#257842971">(Oct 16 2021 at 16:20)</a>:</h4>
<p>Take issue-79422:</p>



<a name="257842979"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/257842979" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#257842979">(Oct 16 2021 at 16:20)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">trait</span><span class="w"> </span><span class="n">MapLike</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span><span class="w"> </span><span class="n">V</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">VRefCont</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span>: <span class="nc">RefCont</span><span class="o">&lt;'</span><span class="na">a</span><span class="p">,</span><span class="w"> </span><span class="n">V</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">get</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;'</span><span class="na">a</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">key</span>: <span class="kp">&amp;</span><span class="nc">K</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Option</span><span class="o">&lt;</span><span class="bp">Self</span>::<span class="n">VRefCont</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;&gt;</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">impl</span><span class="o">&lt;</span><span class="n">K</span>: <span class="nb">Ord</span><span class="p">,</span><span class="w"> </span><span class="n">V</span>: <span class="o">'</span><span class="nb">static</span><span class="o">&gt;</span><span class="w"> </span><span class="n">MapLike</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span><span class="w"> </span><span class="n">V</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">std</span>::<span class="n">collections</span>::<span class="n">BTreeMap</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span><span class="w"> </span><span class="n">V</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">VRefCont</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;'</span><span class="na">a</span><span class="w"> </span><span class="n">V</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">get</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;'</span><span class="na">a</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">key</span>: <span class="kp">&amp;</span><span class="nc">K</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Option</span><span class="o">&lt;&amp;'</span><span class="na">a</span><span class="w"> </span><span class="n">V</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span>::<span class="n">collections</span>::<span class="n">BTreeMap</span>::<span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">key</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="257843009"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/257843009" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#257843009">(Oct 16 2021 at 16:21)</a>:</h4>
<p>Let's also modify it a bit to be more "generalized":</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">trait</span><span class="w"> </span><span class="n">MapLike</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span><span class="w"> </span><span class="n">V</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">VRefCont</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span>: <span class="nc">RefCont</span><span class="o">&lt;'</span><span class="na">a</span><span class="p">,</span><span class="w"> </span><span class="n">V</span><span class="o">&gt;</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">V</span>: <span class="o">'</span><span class="na">a</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">get</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;'</span><span class="na">a</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">key</span>: <span class="kp">&amp;</span><span class="nc">K</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Option</span><span class="o">&lt;</span><span class="bp">Self</span>::<span class="n">VRefCont</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;&gt;</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">impl</span><span class="o">&lt;</span><span class="n">K</span>: <span class="nb">Ord</span><span class="p">,</span><span class="w"> </span><span class="n">V</span><span class="o">&gt;</span><span class="w"> </span><span class="n">MapLike</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span><span class="w"> </span><span class="n">V</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">std</span>::<span class="n">collections</span>::<span class="n">BTreeMap</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span><span class="w"> </span><span class="n">V</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">VRefCont</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">V</span>: <span class="o">'</span><span class="na">a</span> <span class="o">=</span><span class="w"> </span><span class="o">&amp;'</span><span class="na">a</span><span class="w"> </span><span class="n">V</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">get</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;'</span><span class="na">a</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">key</span>: <span class="kp">&amp;</span><span class="nc">K</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Option</span><span class="o">&lt;&amp;'</span><span class="na">a</span><span class="w"> </span><span class="n">V</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span>::<span class="n">collections</span>::<span class="n">BTreeMap</span>::<span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">key</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="257843099"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/257843099" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#257843099">(Oct 16 2021 at 16:22)</a>:</h4>
<p>The lint as written will require <code>Self: 'a</code></p>



<a name="257843233"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/257843233" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#257843233">(Oct 16 2021 at 16:24)</a>:</h4>
<p>(Also remember that the return type is <code>Option&lt;&lt;Self as MapLike&lt;K, V&gt;&gt;::VRefCont&lt;'a&gt;&gt;</code>, so the GAT substs here are <code>[Self, K, V, 'a]</code>)</p>



<a name="257843409"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/257843409" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#257843409">(Oct 16 2021 at 16:27)</a>:</h4>
<p>Let's imagine we go with the suggestion and add a <code>Self: 'a</code>. Well, now this is unfortunate: Now we get this error:</p>
<div class="codehilite"><pre><span></span><code>error[E0309]: the parameter type `K` may not live long enough
 --&gt; src/main.rs:9:5
  |
9 |     type VRefCont&lt;&#39;a&gt; = &amp;&#39;a V;
  |     ^^^^^^^^^^^^^^^^^-^^^^^^^^
  |     |                |
  |     |                help: consider adding a where clause: `where K: &#39;a`
  |     ...so that the type `BTreeMap&lt;K, V&gt;` will meet its required lifetime bounds
</code></pre></div>



<a name="257843511"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/257843511" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#257843511">(Oct 16 2021 at 16:28)</a>:</h4>
<p>Err, nevermind. I didn't <em>also</em> add that to the impl</p>



<a name="257843647"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/257843647" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#257843647">(Oct 16 2021 at 16:30)</a>:</h4>
<p>Actually this is fine. The errors guide the way.</p>



<a name="257851089"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/257851089" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#257851089">(Oct 16 2021 at 18:26)</a>:</h4>
<p>issue-88360 is a fun one</p>



<a name="257851099"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/257851099" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#257851099">(Oct 16 2021 at 18:27)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">trait</span><span class="w"> </span><span class="n">GatTrait</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">Gat</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="bp">Self</span>: <span class="o">'</span><span class="na">a</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">fn</span> <span class="nf">test</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span>::<span class="n">Gat</span><span class="o">&lt;'</span><span class="nb">_</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">trait</span><span class="w"> </span><span class="n">SuperTrait</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"></span>
<span class="k">where</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="bp">Self</span>: <span class="nc">GatTrait</span><span class="o">&lt;</span><span class="n">Gat</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;'</span><span class="na">a</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">copy</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span>::<span class="n">Gat</span><span class="o">&lt;'</span><span class="nb">_</span><span class="o">&gt;</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">T</span>: <span class="nb">Copy</span> <span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="o">*</span><span class="bp">self</span><span class="p">.</span><span class="n">test</span><span class="p">()</span><span class="w"></span>
<span class="w">        </span><span class="c1">//~^ mismatched types</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="257851116"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/257851116" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#257851116">(Oct 16 2021 at 18:27)</a>:</h4>
<p>I think this effectively means that <code>T: 'static</code> for any impl to be able to exist</p>



<a name="259830183"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/259830183" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Charles Lew <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#259830183">(Nov 01 2021 at 06:08)</a>:</h4>
<p><span class="user-mention" data-user-id="232957">@Jack Huey</span>  May i ask a perhaps noob question about this lint? the <code>Self: 'a</code> and the <code>T: 'a</code> are for the well-formed-ness of the associated function itself, right? Why would people prefer to add the where bound to the associated type item, rather than adding them to the associated function item?</p>



<a name="259861182"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/259861182" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#259861182">(Nov 01 2021 at 13:09)</a>:</h4>
<p>These bounds are for the well-formedness of the associated type definition (so you could write <code>&amp;'a T</code> for example)</p>



<a name="259883000"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/259883000" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Charles Lew <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#259883000">(Nov 01 2021 at 16:07)</a>:</h4>
<p>Oh! Got it, thanks!</p>



<a name="259883761"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/259883761" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#259883761">(Nov 01 2021 at 16:13)</a>:</h4>
<p>I think what's potentially confusing here, is that in order to get a list of bounds that are "reasonable", we look at the associated functions. The idea being that those will tell us what bounds were required to hold to construct the GAT (from the trait functions).</p>



<a name="259886244"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/259886244" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Charles Lew <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#259886244">(Nov 01 2021 at 16:31)</a>:</h4>
<p>Yes, this would be a helpful diagnostics suggestion. I'd imagine people relying it a lot to get their GAT definitions correct :)</p>



<a name="260231281"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/260231281" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#260231281">(Nov 04 2021 at 05:33)</a>:</h4>
<p>Has anyone brought up the <code>T: ?Sized</code> syntax for opting out of these GAT where clauses/silencing the error for not having them. i.e.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">type</span> <span class="nc">Foo</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="w"></span>
<span class="k">where</span><span class="w"></span>
<span class="w">    </span><span class="bp">Self</span>: <span class="o">?'</span><span class="na">a</span><span class="p">;</span><span class="w"></span>
</code></pre></div>



<a name="260264556"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/260264556" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#260264556">(Nov 04 2021 at 12:51)</a>:</h4>
<p>Yes, but we basically were in agreement that it's not a great idea</p>



<a name="260264573"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/260264573" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#260264573">(Nov 04 2021 at 12:51)</a>:</h4>
<p>oh okay <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="260264585"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/260264585" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#260264585">(Nov 04 2021 at 12:51)</a>:</h4>
<p>With good enough rules, there should be no reason to need to opt out</p>



<a name="270991018"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/270991018" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#270991018">(Feb 07 2022 at 15:05)</a>:</h4>
<p><span class="user-mention" data-user-id="426609">@Michael Goulet (compiler-errors)</span> I'll put a few more links here to relevant discussion</p>



<a name="270991761"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/270991761" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#270991761">(Feb 07 2022 at 15:10)</a>:</h4>
<p><a href="https://hackmd.io/RqsyidaAQ_aiiB9t7PpLfQ?both#what-rule-to-apply%E2%80%A6">https://hackmd.io/RqsyidaAQ_aiiB9t7PpLfQ?both#what-rule-to-apply%E2%80%A6</a></p>



<a name="270992223"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/270992223" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#270992223">(Feb 07 2022 at 15:13)</a>:</h4>
<p>That's the algorithm Niko was talking about</p>



<a name="270992283"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/270992283" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#270992283">(Feb 07 2022 at 15:14)</a>:</h4>
<p>This example is the one we want to lint on: <a href="https://github.com/rust-lang/rust/blob/51126be1b260216b41143469086e6e6ee567647e/src/test/ui/generic-associated-types/self-outlives-lint.rs#L141">https://github.com/rust-lang/rust/blob/51126be1b260216b41143469086e6e6ee567647e/src/test/ui/generic-associated-types/self-outlives-lint.rs#L141</a></p>



<a name="270992370"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/GATs%20%60Self%3A%20%27a%60%20lint/near/270992370" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/GATs.20.60Self.3A.20&#x27;a.60.20lint.html#270992370">(Feb 07 2022 at 15:14)</a>:</h4>
<p>This is the current implementation: <a href="https://github.com/jackh726/rust/blob/e012a191d768adeda1ee36a99ef8b92d51920154/compiler/rustc_typeck/src/check/wfcheck.rs#L277">https://github.com/jackh726/rust/blob/e012a191d768adeda1ee36a99ef8b92d51920154/compiler/rustc_typeck/src/check/wfcheck.rs#L277</a></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>