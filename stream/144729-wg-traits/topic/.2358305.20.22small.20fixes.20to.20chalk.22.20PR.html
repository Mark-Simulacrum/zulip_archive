<html>
<head><meta charset="utf-8"><title>#58305 &quot;small fixes to chalk&quot; PR · wg-traits · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/index.html">wg-traits</a></h2>
<h3>Topic: <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html">#58305 &quot;small fixes to chalk&quot; PR</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://rust-lang.github.io/zulip_archive/style.css" rel="stylesheet"></head>

<a name="159189744"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/159189744" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#159189744">(Feb 22 2019 at 20:50)</a>:</h4>
<p><span class="user-mention" data-user-id="131694">@scalexm</span> you have <code>(WIP)</code> in the title of <a href="https://github.com/rust-lang/rust/pull/58305" target="_blank" title="https://github.com/rust-lang/rust/pull/58305">https://github.com/rust-lang/rust/pull/58305</a>, is there a reason not to r+?</p>



<a name="159189826"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/159189826" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scalexm <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#159189826">(Feb 22 2019 at 20:52)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> there is at least one, in the bug I fixed in the unification code (where I needed to swap <code>a_scopes</code> and <code>b_scopes</code>), I think I also need to flip the variance, what do you think?</p>



<a name="159189870"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/159189870" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#159189870">(Feb 22 2019 at 20:52)</a>:</h4>
<p>that part certainly looked unfortunate</p>



<a name="159189876"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/159189876" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#159189876">(Feb 22 2019 at 20:52)</a>:</h4>
<p>mm yes I guess you do</p>



<a name="159189889"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/159189889" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#159189889">(Feb 22 2019 at 20:52)</a>:</h4>
<p>it feels maybe like we should encapsulate that to a method?</p>



<a name="159189899"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/159189899" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#159189899">(Feb 22 2019 at 20:52)</a>:</h4>
<p>I'd rather we don't have to flip at all, of course</p>



<a name="159189900"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/159189900" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scalexm <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#159189900">(Feb 22 2019 at 20:52)</a>:</h4>
<p>Do you have another solution in mind? The whole thing seems a bit fragile</p>



<a name="159189923"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/159189923" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#159189923">(Feb 22 2019 at 20:53)</a>:</h4>
<p>I didn't look very closely but I guess the idea is that the logic would basically be identical either way?</p>



<a name="159189934"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/159189934" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#159189934">(Feb 22 2019 at 20:53)</a>:</h4>
<p>i.e., you want some code to handle the "type/var" case or whatever</p>



<a name="159189940"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/159189940" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scalexm <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#159189940">(Feb 22 2019 at 20:53)</a>:</h4>
<p>Right</p>



<a name="159189944"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/159189944" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scalexm <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#159189944">(Feb 22 2019 at 20:53)</a>:</h4>
<p>Regardless of the sides of the two types</p>



<a name="159190049"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/159190049" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#159190049">(Feb 22 2019 at 20:55)</a>:</h4>
<p>Yeah</p>



<a name="159190060"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/159190060" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#159190060">(Feb 22 2019 at 20:55)</a>:</h4>
<p>I'll have to pull up the code and look a bit more</p>



<a name="159190061"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/159190061" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#159190061">(Feb 22 2019 at 20:55)</a>:</h4>
<p>It doesn't feel great</p>



<a name="159190088"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/159190088" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scalexm <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#159190088">(Feb 22 2019 at 20:55)</a>:</h4>
<p>Other than that, I was hoping to be able to do some more work on that PR, namely trying to implement the rules for trait objects directly in rustc, and also trying to investigate the inference error I described in the PR description</p>



<a name="159190166"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/159190166" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#159190166">(Feb 22 2019 at 20:56)</a>:</h4>
<p>OK</p>



<a name="159190200"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/159190200" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scalexm <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#159190200">(Feb 22 2019 at 20:57)</a>:</h4>
<p>But I guess we could merge it once we have figured out how to cleanly fix the unification bug, there are some useful additions already in that PR</p>



<a name="159190202"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/159190202" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#159190202">(Feb 22 2019 at 20:57)</a>:</h4>
<p>I am +1 on experimenting around the rules for trait objects, though I remain .. not fully satisfied with the solutions on the table thus far.</p>



<a name="159190213"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/159190213" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#159190213">(Feb 22 2019 at 20:57)</a>:</h4>
<p>Yeah, it seems like it would be better to merge and work in a separate PR</p>



<a name="159190316"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/159190316" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#159190316">(Feb 22 2019 at 20:58)</a>:</h4>
<p>Not sure if you saw, but in <a href="#narrow/stream/144729-t-compiler.2Fwg-traits/topic/structure.20of.20the.20working.20group" title="#narrow/stream/144729-t-compiler.2Fwg-traits/topic/structure.20of.20the.20working.20group">the "structure of the working group" topic</a> I've been trying to draw up a kind of <a href="https://paper.dropbox.com/doc/Traits-Roadmap-sketch--AYEYyqaNyA~~NOuXZb2hCbyOAg-m6hucUslp7GihsY3SjNN2" target="_blank" title="https://paper.dropbox.com/doc/Traits-Roadmap-sketch--AYEYyqaNyA~~NOuXZb2hCbyOAg-m6hucUslp7GihsY3SjNN2">"master list" of actionable things around traits</a>. One of the things I wanted to do was to sketch out the next steps around chalk integration too. I know we've been over this many times. :) Sorry</p>



<a name="159190429"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/159190429" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scalexm <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#159190429">(Feb 22 2019 at 20:59)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> well, personally I think I am about satisfied with the solution I described for trait objects :) there are still not handled like « existential » types but I don’t really see how we could do that, but yes we can definitely leave that question open and experiment around it until we have some more experience</p>



<a name="159190481"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/159190481" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scalexm <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#159190481">(Feb 22 2019 at 21:00)</a>:</h4>
<p>I saw the topic but did not read it yet</p>



<a name="159190490"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/159190490" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#159190490">(Feb 22 2019 at 21:00)</a>:</h4>
<p>it may be that I just need to really devote some time to understanding it better</p>



<a name="159190500"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/159190500" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#159190500">(Feb 22 2019 at 21:00)</a>:</h4>
<p>I mean I'm not <em>dissatisfied</em> :)</p>



<a name="159190509"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/159190509" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#159190509">(Feb 22 2019 at 21:00)</a>:</h4>
<p>I could easily see that the rules you are proposing are indeed the ones we wind up with</p>



<a name="160383401"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/160383401" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scalexm <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#160383401">(Mar 09 2019 at 20:54)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> we should discuss a solution about how best to make <code>relate_ty_var</code> insensible to the direction of the relation (e.g. not having to swap scopes / variance just to be able to correctly reuse that function)</p>



<a name="160383406"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/160383406" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scalexm <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#160383406">(Mar 09 2019 at 20:54)</a>:</h4>
<p>that's probably the only blocker to <a href="https://github.com/rust-lang/rust/issues/58305" target="_blank" title="https://github.com/rust-lang/rust/issues/58305">#58305</a></p>



<a name="160383418"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/160383418" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scalexm <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#160383418">(Mar 09 2019 at 20:55)</a>:</h4>
<p>after that, I'm still unsure how much progress we want to do on the "chalk in rustc" side and what direction we should take</p>



<a name="160383424"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/160383424" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scalexm <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#160383424">(Mar 09 2019 at 20:55)</a>:</h4>
<p>e.g. maybe we should be focusing on improving the chalk crate so that we can share more code, like to lowering stuff etc</p>



<a name="160383473"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/160383473" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scalexm <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#160383473">(Mar 09 2019 at 20:56)</a>:</h4>
<p>or else focus on the other problems we encountered like handling lifetime requirements which come from unification, or the "ambiguity" bug for open goals <code>?T: Trait</code> (goal selection order etc)</p>



<a name="160383537"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/160383537" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scalexm <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#160383537">(Mar 09 2019 at 20:59)</a>:</h4>
<p>plus adding things like more builtin impls etc so that the new trait solver in rustc can compile more programs</p>



<a name="161259321"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/161259321" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#161259321">(Mar 20 2019 at 15:44)</a>:</h4>
<blockquote>
<p>we should discuss a solution about how best to make <code>relate_ty_var</code> insensible to the direction of the relation (e.g. not having to swap scopes / variance just to be able to correctly reuse that function)</p>
</blockquote>
<p><span class="user-mention" data-user-id="131694">@scalexm</span> to be clear, we're talking about <a href="https://github.com/rust-lang/rust/blob/248531af3ff86cdd4465220898c83352eff65690/src/librustc/infer/nll_relate/mod.rs#L425-L431" target="_blank" title="https://github.com/rust-lang/rust/blob/248531af3ff86cdd4465220898c83352eff65690/src/librustc/infer/nll_relate/mod.rs#L425-L431">this code</a>, right?</p>
<div class="codehilite"><pre><span></span><span class="w">                    </span><span class="c1">// We swap the order of `a` and `b` in the call to</span>
<span class="w">                    </span><span class="c1">// `relate_ty_var` below, so swap the corresponding scopes</span>
<span class="w">                    </span><span class="c1">// as well.</span>
<span class="w">                    </span><span class="n">std</span>::<span class="n">mem</span>::<span class="n">swap</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">a_scopes</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">b_scopes</span><span class="p">);</span><span class="w"></span>
<span class="w">                    </span><span class="kd">let</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">relate_ty_var</span><span class="p">(</span><span class="n">vid</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">);</span><span class="w"></span>
<span class="w">                    </span><span class="n">std</span>::<span class="n">mem</span>::<span class="n">swap</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">a_scopes</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">b_scopes</span><span class="p">);</span><span class="w"></span>
<span class="n">res</span><span class="w"></span>
</pre></div>



<a name="161259339"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/161259339" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#161259339">(Mar 20 2019 at 15:44)</a>:</h4>
<p>I note that the PR doesn't swap variance</p>



<a name="161259375"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/161259375" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#161259375">(Mar 20 2019 at 15:45)</a>:</h4>
<p>I don't <em>quite</em> remember the history there</p>



<a name="161259379"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/161259379" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#161259379">(Mar 20 2019 at 15:45)</a>:</h4>
<p>I guess I should check the PR comments</p>



<a name="161259404"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/161259404" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scalexm <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#161259404">(Mar 20 2019 at 15:45)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> yes, that’s why it shouldn’t be merged as is :)</p>



<a name="161259465"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/161259465" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#161259465">(Mar 20 2019 at 15:46)</a>:</h4>
<blockquote>
<p>there is at least one, in the bug I fixed in the unification code (where I needed to swap <code>a_scopes</code> and <code>b_scopes</code>), I think I also need to flip the variance, what do you think?</p>
</blockquote>
<p>ah, right, you were talking <em>adding</em> code to flip the variance =) heh, I remember now, sorry</p>



<a name="161259491"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/161259491" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#161259491">(Mar 20 2019 at 15:46)</a>:</h4>
<p>Looking more at the <code>relate_ty_var</code> code, I think there are other problems</p>



<a name="161259503"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/161259503" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#161259503">(Mar 20 2019 at 15:46)</a>:</h4>
<p>When it comes to variance</p>



<a name="161259536"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/161259536" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#161259536">(Mar 20 2019 at 15:47)</a>:</h4>
<p>Notably, <a href="https://github.com/rust-lang/rust/blob/248531af3ff86cdd4465220898c83352eff65690/src/librustc/infer/nll_relate/mod.rs#L307" target="_blank" title="https://github.com/rust-lang/rust/blob/248531af3ff86cdd4465220898c83352eff65690/src/librustc/infer/nll_relate/mod.rs#L307">this line</a> assumes "invariant", I believe.</p>



<a name="161259541"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/161259541" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scalexm <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#161259541">(Mar 20 2019 at 15:47)</a>:</h4>
<p>Yes, notably I think I’m doing an <code>equate</code> or something regardless of variance</p>



<a name="161259551"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/161259551" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scalexm <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#161259551">(Mar 20 2019 at 15:47)</a>:</h4>
<p>Right</p>



<a name="161259575"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/161259575" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#161259575">(Mar 20 2019 at 15:47)</a>:</h4>
<p>So, one thing we could certainly do</p>



<a name="161259592"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/161259592" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#161259592">(Mar 20 2019 at 15:47)</a>:</h4>
<p>is to refactor the code to be "generic" with respect to whether <code>vid</code> comes from A or what</p>



<a name="161259671"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/161259671" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#161259671">(Mar 20 2019 at 15:48)</a>:</h4>
<p>that doesn't seem <em>that</em> hard to do</p>



<a name="161259707"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/161259707" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scalexm <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#161259707">(Mar 20 2019 at 15:49)</a>:</h4>
<p>In the NLL code, do you happen to use something else than « invariant »? Because I think the <code>equate</code> was there already before my unification PR where I refactored this code</p>



<a name="161259738"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/161259738" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#161259738">(Mar 20 2019 at 15:49)</a>:</h4>
<p>I believe this code only used invariance before</p>



<a name="161259754"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/161259754" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#161259754">(Mar 20 2019 at 15:49)</a>:</h4>
<p>/me thinks</p>



<a name="161259755"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/161259755" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#161259755">(Mar 20 2019 at 15:49)</a>:</h4>
<p>Certainly when I first wrote it, that was true</p>



<a name="161259757"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/161259757" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#161259757">(Mar 20 2019 at 15:49)</a>:</h4>
<p>but I may have changed it</p>



<a name="161259761"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/161259761" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#161259761">(Mar 20 2019 at 15:49)</a>:</h4>
<p>and overlooked this detail :)</p>



<a name="161259768"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/161259768" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#161259768">(Mar 20 2019 at 15:49)</a>:</h4>
<p>I don't recall who added the variance code to this -- I did?</p>



<a name="161259833"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/161259833" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scalexm <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#161259833">(Mar 20 2019 at 15:50)</a>:</h4>
<p>Variance was already there indeed when I refactored the code</p>



<a name="161259852"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/161259852" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#161259852">(Mar 20 2019 at 15:50)</a>:</h4>
<p>OK. Then it's probably a bug in NLL</p>



<a name="161259859"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/161259859" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#161259859">(Mar 20 2019 at 15:50)</a>:</h4>
<p>But I have to check</p>



<a name="161260065"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/161260065" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#161260065">(Mar 20 2019 at 15:52)</a>:</h4>
<p>Well, one bug at a time</p>



<a name="161260094"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/161260094" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#161260094">(Mar 20 2019 at 15:52)</a>:</h4>
<p>Let me experiment with a refactoring here, I can push it to your branch?</p>



<a name="161260104"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/161260104" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scalexm <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#161260104">(Mar 20 2019 at 15:52)</a>:</h4>
<p>Sure</p>



<a name="161260111"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/161260111" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#161260111">(Mar 20 2019 at 15:52)</a>:</h4>
<p>Also, I think that whole match is wrong in the same way</p>



<a name="161260134"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/161260134" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#161260134">(Mar 20 2019 at 15:52)</a>:</h4>
<p>in other words, <a href="https://github.com/rust-lang/rust/blob/248531af3ff86cdd4465220898c83352eff65690/src/librustc/infer/nll_relate/mod.rs#L314" target="_blank" title="https://github.com/rust-lang/rust/blob/248531af3ff86cdd4465220898c83352eff65690/src/librustc/infer/nll_relate/mod.rs#L314">the lazy norm case also assumes invariant</a></p>



<a name="161260144"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/161260144" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#161260144">(Mar 20 2019 at 15:53)</a>:</h4>
<p>but we should file a bug about this</p>



<a name="161260994"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/161260994" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scalexm <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#161260994">(Mar 20 2019 at 16:01)</a>:</h4>
<p>I just checked, the <code>equate</code> bug was not pre-existing in NLL actually; and it is still not a bug because NLL will never relate two type variables (because of <code>forbid_inference_vars()</code>)</p>



<a name="161261708"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/161261708" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#161261708">(Mar 20 2019 at 16:07)</a>:</h4>
<p><span class="user-mention" data-user-id="131694">@scalexm</span> I was wondering about that (the forbid-inference-vars part of it)</p>



<a name="161261730"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/161261730" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#161261730">(Mar 20 2019 at 16:07)</a>:</h4>
<p>but I couldn't quite remember when we had lifted that restriction</p>



<a name="161261777"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/161261777" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#161261777">(Mar 20 2019 at 16:08)</a>:</h4>
<p>in general this code feels messier than I would like</p>



<a name="161261792"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/161261792" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#161261792">(Mar 20 2019 at 16:08)</a>:</h4>
<p>but let's talk about that later</p>



<a name="161261833"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/161261833" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#161261833">(Mar 20 2019 at 16:08)</a>:</h4>
<p>I've got a refactored version close to working now</p>



<a name="161262590"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/161262590" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scalexm <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#161262590">(Mar 20 2019 at 16:14)</a>:</h4>
<p>I lifted that restriction when I re-used that unification code for chalk, because unification in chalk must deal with inference variables in both sides of the relation</p>



<a name="161263256"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/161263256" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scalexm <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#161263256">(Mar 20 2019 at 16:21)</a>:</h4>
<p>But yes I agree it’s a bit messy</p>



<a name="161266397"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/161266397" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#161266397">(Mar 20 2019 at 16:48)</a>:</h4>
<p><span class="user-mention" data-user-id="131694">@scalexm</span> I pushed two commits to your branch</p>



<a name="161266413"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/161266413" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#161266413">(Mar 20 2019 at 16:48)</a>:</h4>
<p>took me longer than expected because I wound up doing two iterations, but I like this final version, feels pretty clean</p>



<a name="161266418"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/161266418" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#161266418">(Mar 20 2019 at 16:48)</a>:</h4>
<p>could maybe use a few more comments</p>



<a name="161266730"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/161266730" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#161266730">(Mar 20 2019 at 16:51)</a>:</h4>
<p>ok, forced pushed a few more comments</p>



<a name="161266839"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/161266839" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#161266839">(Mar 20 2019 at 16:52)</a>:</h4>
<p>if you are happy with that, then I think I am happy with the PR overall</p>



<a name="161267168"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/161267168" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scalexm <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#161267168">(Mar 20 2019 at 16:55)</a>:</h4>
<p>For the <code>equate</code> thing, could we maybe add a method on <code>VidValuePair</code>, something like <code>relate_vars</code> which just does the right thing depending on the variance?</p>



<a name="161267418"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/161267418" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scalexm <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#161267418">(Mar 20 2019 at 16:58)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> I agree <code>relate_projection_ty</code> does not need to deal with scopes anyway</p>



<a name="161269792"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/161269792" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#161269792">(Mar 20 2019 at 17:20)</a>:</h4>
<blockquote>
<p>For the <code>equate</code> thing, could we maybe add a method on <code>VidValuePair</code>, something like <code>relate_vars</code> which just does the right thing depending on the variance?</p>
</blockquote>
<p>what we have to do, I think, is to push a new constraint -- basically <code>?A &lt;: ?B</code> is something we can't make progress on until we know <em>something</em> about <code>?A</code> or <code>?B</code></p>



<a name="161269800"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/161269800" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#161269800">(Mar 20 2019 at 17:20)</a>:</h4>
<p>this is an instance of that more general problem that also afflicts <code>?T: Sized</code></p>



<a name="161269833"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/161269833" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#161269833">(Mar 20 2019 at 17:21)</a>:</h4>
<p>I am thinking that i would like to dig more -- perhaps next week over zoom? -- into how the chalk-engine works</p>



<a name="161269838"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/161269838" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#161269838">(Mar 20 2019 at 17:21)</a>:</h4>
<p>so we can discuss how to incorporate that concept</p>



<a name="161269840"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/161269840" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#161269840">(Mar 20 2019 at 17:21)</a>:</h4>
<p>e.g., SLG solving</p>



<a name="161269853"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/161269853" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#161269853">(Mar 20 2019 at 17:21)</a>:</h4>
<p>this would require me to remember some stuff :)</p>



<a name="161269862"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/161269862" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#161269862">(Mar 20 2019 at 17:21)</a>:</h4>
<p>which is .. probably god</p>



<a name="161270835"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/161270835" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scalexm <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#161270835">(Mar 20 2019 at 17:30)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span>  Ah yes I see</p>



<a name="161270892"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/161270892" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scalexm <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#161270892">(Mar 20 2019 at 17:30)</a>:</h4>
<p>I’m happy with your refactoring anyway</p>



<a name="161270900"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/161270900" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scalexm <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#161270900">(Mar 20 2019 at 17:30)</a>:</h4>
<p>So we can merge it</p>



<a name="161273294"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/161273294" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#161273294">(Mar 20 2019 at 17:53)</a>:</h4>
<p>maybe it needs a rebase?</p>



<a name="161281193"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/161281193" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scalexm <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#161281193">(Mar 20 2019 at 19:09)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> rebased</p>



<a name="161281337"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/161281337" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#161281337">(Mar 20 2019 at 19:11)</a>:</h4>
<p>left a <a href="https://github.com/rust-lang/rust/pull/58305/files/da756250077fe887b7ac61b8483f1c3ef683a6d2#pullrequestreview-216928085" target="_blank" title="https://github.com/rust-lang/rust/pull/58305/files/da756250077fe887b7ac61b8483f1c3ef683a6d2#pullrequestreview-216928085">nit</a> <span class="user-mention" data-user-id="131694">@scalexm</span> but otherwise r=me</p>



<a name="161281883"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/%2358305%20%22small%20fixes%20to%20chalk%22%20PR/near/161281883" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scalexm <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2358305.20.22small.20fixes.20to.20chalk.22.20PR.html#161281883">(Mar 20 2019 at 19:17)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> ok I removed these lines</p>



<hr><p>Last updated: Aug 07 2021 at 22:04 UTC</p>
</html>