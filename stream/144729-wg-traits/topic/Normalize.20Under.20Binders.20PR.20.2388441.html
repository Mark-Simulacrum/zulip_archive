<html>
<head><meta charset="utf-8"><title>Normalize Under Binders PR #88441 · wg-traits · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/index.html">wg-traits</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html">Normalize Under Binders PR #88441</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="256804433"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256804433" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256804433">(Oct 08 2021 at 20:55)</a>:</h4>
<p>So <span class="user-mention" data-user-id="232957">@Jack Huey</span> I've been digging into this PR and I <em>think</em> the problem is exactly the "escaping type variable" issue</p>



<a name="256804446"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256804446" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256804446">(Oct 08 2021 at 20:55)</a>:</h4>
<p>I can't 100% remember how we landed here <em>but</em></p>



<a name="256804463"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256804463" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256804463">(Oct 08 2021 at 20:55)</a>:</h4>
<p>(also, I don't know why the NLL doesn't report an error yet, that seems like a bug!)</p>



<a name="256804490"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256804490" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256804490">(Oct 08 2021 at 20:55)</a>:</h4>
<p>Hmm</p>



<a name="256804501"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256804501" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256804501">(Oct 08 2021 at 20:55)</a>:</h4>
<p>let me walk through what happens first</p>



<a name="256804506"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256804506" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256804506">(Oct 08 2021 at 20:56)</a>:</h4>
<p>actually it may not be a bug in NLL</p>



<a name="256804554"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256804554" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256804554">(Oct 08 2021 at 20:56)</a>:</h4>
<p>it may fall out from how NLL handles things, now that I think about it</p>



<a name="256804635"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256804635" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256804635">(Oct 08 2021 at 20:56)</a>:</h4>
<p>so the impls are horrific but</p>



<a name="256804648"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256804648" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256804648">(Oct 08 2021 at 20:56)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">impl</span><span class="o">&lt;'</span><span class="na">s</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Parser</span><span class="o">&lt;'</span><span class="na">s</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">F</span><span class="w"></span>
<span class="k">where</span><span class="w"></span>
<span class="w">    </span><span class="n">F</span>: <span class="nb">Fn</span><span class="p">(</span><span class="o">&amp;'</span><span class="na">s</span><span class="w"> </span><span class="kt">str</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="p">(</span><span class="o">&amp;'</span><span class="na">s</span><span class="w"> </span><span class="kt">str</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p">),</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">Output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">call</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">input</span>: <span class="kp">&amp;</span><span class="o">'</span><span class="na">s</span> <span class="kt">str</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="p">(</span><span class="o">&amp;'</span><span class="na">s</span><span class="w"> </span><span class="kt">str</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="fm">panic!</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="256804665"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256804665" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256804665">(Oct 08 2021 at 20:57)</a>:</h4>
<p>So, should this be erroring with NLL but isn't?</p>



<a name="256804679"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256804679" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256804679">(Oct 08 2021 at 20:57)</a>:</h4>
<p>not sure about NLL yet</p>



<a name="256804684"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256804684" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256804684">(Oct 08 2021 at 20:57)</a>:</h4>
<p>I've only dug into the other mode :)</p>



<a name="256804693"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256804693" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256804693">(Oct 08 2021 at 20:57)</a>:</h4>
<p>that took me all day!</p>



<a name="256804708"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256804708" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256804708">(Oct 08 2021 at 20:57)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">F2</span>: <span class="nb">FnOnce</span><span class="p">(</span><span class="o">&amp;&lt;</span><span class="n">F1</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Parser</span><span class="o">&lt;'</span><span class="nb">_</span><span class="o">&gt;&gt;</span>::<span class="n">Output</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span>
</code></pre></div>



<a name="256804732"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256804732" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256804732">(Oct 08 2021 at 20:57)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441/near/256804693">said</a>:</p>
<blockquote>
<p>that took me all day!</p>
</blockquote>
<p>ok not really :) but an hour or two of concentration...</p>



<a name="256804746"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256804746" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256804746">(Oct 08 2021 at 20:57)</a>:</h4>
<p>I'll do NLL later ;)</p>



<a name="256804762"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256804762" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256804762">(Oct 08 2021 at 20:57)</a>:</h4>
<p>first let me dump these thoughts out while I understand them</p>



<a name="256804772"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256804772" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256804772">(Oct 08 2021 at 20:58)</a>:</h4>
<p>so I thnk what it happening:</p>



<a name="256804848"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256804848" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256804848">(Oct 08 2021 at 20:58)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441/near/256804708">said</a>:</p>
<blockquote>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">F2</span>: <span class="nb">FnOnce</span><span class="p">(</span><span class="o">&amp;&lt;</span><span class="n">F1</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Parser</span><span class="o">&lt;'</span><span class="nb">_</span><span class="o">&gt;&gt;</span>::<span class="n">Output</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span>
</code></pre></div><br>
</p>
</blockquote>
<p>this is short for</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">F2</span>: <span class="nc">for</span><span class="o">&lt;'</span><span class="na">r</span><span class="p">,</span><span class="w"> </span><span class="o">'</span><span class="na">s</span><span class="o">&gt;</span><span class="w"> </span><span class="nb">FnOnce</span><span class="p">(</span><span class="o">&amp;'</span><span class="na">r</span><span class="w"> </span><span class="o">&lt;</span><span class="n">F1</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Parser</span><span class="o">&lt;'</span><span class="na">s</span><span class="o">&gt;&gt;</span>::<span class="n">Output</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span>
</code></pre></div>



<a name="256804882"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256804882" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256804882">(Oct 08 2021 at 20:58)</a>:</h4>
<p>(oh, btw, when I say that NLL maybe <em>should</em> report an error -- I believe this test should <em>ultimately</em> pass. It's just that NLL may be passing for the wrong reasons.)</p>



<a name="256804915"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256804915" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256804915">(Oct 08 2021 at 20:59)</a>:</h4>
<p>so at some point, when confirming closures,</p>



<a name="256804924"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256804924" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256804924">(Oct 08 2021 at 20:59)</a>:</h4>
<p>we do a normalization</p>



<a name="256804952"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256804952" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256804952">(Oct 08 2021 at 20:59)</a>:</h4>
<p>to normalize the <code>&lt;F1 as Parser&lt;'s&gt;&gt;::Output</code></p>



<a name="256804957"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256804957" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256804957">(Oct 08 2021 at 20:59)</a>:</h4>
<p>we apply the impl above</p>



<a name="256804992"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256804992" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256804992">(Oct 08 2021 at 20:59)</a>:</h4>
<p>this means we create a type variable for <code>T</code> (<code>_#14t</code> and <code>_#18t</code> in my debugging output)</p>



<a name="256805062"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256805062" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256805062">(Oct 08 2021 at 21:00)</a>:</h4>
<p>then we unify the impl header</p>



<a name="256805086"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256805086" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256805086">(Oct 08 2021 at 21:00)</a>:</h4>
<p>the trick is that <code>T</code> is not constrained by the impl header!</p>



<a name="256805123"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256805123" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256805123">(Oct 08 2021 at 21:00)</a>:</h4>
<p>there is an obligation <code>F: Fn(&amp;'s str) -&gt; (&amp;'s str, T)</code></p>



<a name="256805202"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256805202" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256805202">(Oct 08 2021 at 21:00)</a>:</h4>
<p>so the "final type" that we get is still an unconstrained type variable</p>



<a name="256805213"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256805213" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256805213">(Oct 08 2021 at 21:01)</a>:</h4>
<p>along with some obligations</p>



<a name="256805268"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256805268" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256805268">(Oct 08 2021 at 21:01)</a>:</h4>
<p>we enqueue the obligations but they are expressed in terms of placeholders</p>



<a name="256805304"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256805304" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256805304">(Oct 08 2021 at 21:01)</a>:</h4>
<p>this call:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">                    </span><span class="n">PlaceholderReplacer</span>::<span class="n">replace_placeholders</span><span class="p">(</span><span class="w"></span>
<span class="w">                        </span><span class="n">infcx</span><span class="p">,</span><span class="w"></span>
<span class="w">                        </span><span class="n">mapped_regions</span><span class="p">,</span><span class="w"></span>
<span class="w">                        </span><span class="n">mapped_types</span><span class="p">,</span><span class="w"></span>
<span class="w">                        </span><span class="n">mapped_consts</span><span class="p">,</span><span class="w"></span>
<span class="w">                        </span><span class="o">&amp;</span><span class="bp">self</span><span class="p">.</span><span class="n">universes</span><span class="p">,</span><span class="w"></span>
<span class="w">                        </span><span class="n">normalized_ty</span><span class="p">,</span><span class="w"></span>
<span class="w">                    </span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<p>has no effect because we don't know the value of the type variable yet</p>



<a name="256805408"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256805408" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256805408">(Oct 08 2021 at 21:02)</a>:</h4>
<p>this is the case I was worried about before</p>



<a name="256805416"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256805416" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256805416">(Oct 08 2021 at 21:02)</a>:</h4>
<p>when I was talking about that "delayed replace_placeholders logic"</p>



<a name="256805436"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256805436" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256805436">(Oct 08 2021 at 21:02)</a>:</h4>
<p>I can't remember if we convinced ourselves it couldn't happen or what</p>



<a name="256805465"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256805465" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256805465">(Oct 08 2021 at 21:02)</a>:</h4>
<p>anyway what winds up happening is that</p>



<a name="256805564"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256805564" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256805564">(Oct 08 2021 at 21:03)</a>:</h4>
<p>in <a href="https://github.com/rust-lang/rust/blob/c51f7e0f51dbb0efeada9d677f877ee496f2c655/compiler/rustc_trait_selection/src/traits/select/confirmation.rs#L651-L656">this call</a> we unify two different versions of the normalizations; but each one yielded up a type variable that didn't have the placeholders replaced</p>



<a name="256805591"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256805591" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256805591">(Oct 08 2021 at 21:04)</a>:</h4>
<p>and so each is in a distinct universe</p>



<a name="256805648"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256805648" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256805648">(Oct 08 2021 at 21:04)</a>:</h4>
<p>anyway, I'm not sure how to fix it, but it's good to know what the problem is!</p>



<a name="256805653"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256805653" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256805653">(Oct 08 2021 at 21:04)</a>:</h4>
<p>I keep thinking that we are working too hard</p>



<a name="256805665"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256805665" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256805665">(Oct 08 2021 at 21:04)</a>:</h4>
<p>that replacing the bound variables with placeholders only to map them back is silly</p>



<a name="256805699"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256805699" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256805699">(Oct 08 2021 at 21:04)</a>:</h4>
<p>but I haven't quite wrapped my head around what to do instead :)</p>



<a name="256805742"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256805742" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256805742">(Oct 08 2021 at 21:05)</a>:</h4>
<p>anyway, so, given all this, the question is: why does NLL work?</p>



<a name="256805752"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256805752" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256805752">(Oct 08 2021 at 21:05)</a>:</h4>
<p>It <em>may</em> be because the way NLL handles projections</p>



<a name="256805764"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256805764" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256805764">(Oct 08 2021 at 21:05)</a>:</h4>
<p>tends to fully process things more</p>



<a name="256805776"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256805776" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256805776">(Oct 08 2021 at 21:05)</a>:</h4>
<p>or because NLL knows more types and the code goes down a different path</p>



<a name="256805787"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256805787" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256805787">(Oct 08 2021 at 21:05)</a>:</h4>
<p>(are y'all talking about normalize-under-binder/normalization-under-binders-2.rs ?)</p>



<a name="256805795"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256805795" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256805795">(Oct 08 2021 at 21:05)</a>:</h4>
<p>it could also be that the region inferencer has a bug</p>



<a name="256805805"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256805805" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256805805">(Oct 08 2021 at 21:05)</a>:</h4>
<p>yes, <span class="user-mention" data-user-id="116113">@lqd</span></p>



<a name="256805920"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256805920" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256805920">(Oct 08 2021 at 21:06)</a>:</h4>
<p>this test doesn't currently pass with NLL though right ?</p>



<a name="256805955"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256805955" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256805955">(Oct 08 2021 at 21:06)</a>:</h4>
<p>I'm not sure, actually, but I don't think so</p>



<a name="256805984"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256805984" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256805984">(Oct 08 2021 at 21:07)</a>:</h4>
<p>no, it doesn't</p>



<a name="256805994"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256805994" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256805994">(Oct 08 2021 at 21:07)</a>:</h4>
<p>but on the PR, the behavior diverges</p>



<a name="256806072"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256806072" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256806072">(Oct 08 2021 at 21:07)</a>:</h4>
<p>interesting :)</p>



<a name="256806128"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256806128" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256806128">(Oct 08 2021 at 21:08)</a>:</h4>
<p>the PR adds some normaliztions in different spots</p>



<a name="256806134"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256806134" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256806134">(Oct 08 2021 at 21:08)</a>:</h4>
<p>so it's not so surprising</p>



<a name="256806187"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256806187" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256806187">(Oct 08 2021 at 21:08)</a>:</h4>
<p>totally unrelated, is there a "global gitignore" file?</p>



<a name="256806217"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256806217" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256806217">(Oct 08 2021 at 21:08)</a>:</h4>
<p>I suppose I could google that</p>



<a name="256806266"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256806266" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256806266">(Oct 08 2021 at 21:09)</a>:</h4>
<p>I think there is yes</p>



<a name="256806313"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256806313" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256806313">(Oct 08 2021 at 21:09)</a>:</h4>
<p>(like a "excludesfile" config to point at your gitignore)</p>



<a name="256806361"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256806361" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256806361">(Oct 08 2021 at 21:09)</a>:</h4>
<p>(there is, but you have to run <code>git config</code>...that's why it didn't work... I've forgotten this before, I remember now)</p>



<a name="256806418"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256806418" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256806418">(Oct 08 2021 at 21:10)</a>:</h4>
<p>getting sick of <code>mir-dump</code> directory showing up in <code>git status</code> all the time :)</p>



<a name="256806447"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256806447" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256806447">(Oct 08 2021 at 21:10)</a>:</h4>
<p>we should add that to the rustc .gitignore, really</p>



<a name="256806518"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256806518" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256806518">(Oct 08 2021 at 21:11)</a>:</h4>
<p>btw, <a href="http://pernos.co">pernos.co</a> was super invaluable in debugging this</p>



<a name="256806559"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256806559" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256806559">(Oct 08 2021 at 21:11)</a>:</h4>
<p>if you want to play with it, <a href="https://is.gd/vzqcnn">here is my final session</a></p>



<a name="256806683"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256806683" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256806683">(Oct 08 2021 at 21:12)</a>:</h4>
<p>the workflow I found useful:</p>



<a name="256806705"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256806705" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256806705">(Oct 08 2021 at 21:12)</a>:</h4>
<p>find the moment in the log you are interested in</p>



<a name="256806711"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256806711" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256806711">(Oct 08 2021 at 21:12)</a>:</h4>
<p>click on it</p>



<a name="256806734"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256806734" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256806734">(Oct 08 2021 at 21:12)</a>:</h4>
<p>walk up the stack to see where you are</p>



<a name="256806822"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256806822" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256806822">(Oct 08 2021 at 21:13)</a>:</h4>
<p>then you can click arund within those functions at the "green highlighted" lines and see where in the output each moment corresponds to</p>



<a name="256806841"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256806841" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256806841">(Oct 08 2021 at 21:13)</a>:</h4>
<p>too bad you can't dump the values of variables. :(</p>



<a name="256806912"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256806912" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256806912">(Oct 08 2021 at 21:13)</a>:</h4>
<p>you should ask roc about that</p>



<a name="256806915"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256806915" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256806915">(Oct 08 2021 at 21:13)</a>:</h4>
<p>the other thing that's invaluable is that ctrl-f in the log will search</p>



<a name="256806928"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256806928" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256806928">(Oct 08 2021 at 21:13)</a>:</h4>
<p>yeah, I've been talking to roc + kyle huey some</p>



<a name="256806957"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256806957" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256806957">(Oct 08 2021 at 21:13)</a>:</h4>
<p>(for those following at home, Felix also did a screencast recently about it (but with rustfmt) <a href="https://twitter.com/pnkfelix/status/1441753279822712834">https://twitter.com/pnkfelix/status/1441753279822712834</a>)</p>
<div class="inline-preview-twitter"><div class="twitter-tweet"><a href="https://twitter.com/pnkfelix/status/1441753279822712834"><img class="twitter-avatar" src="https://uploads.zulipusercontent.net/d481cd182b8f1b51780eee2728ea0a624dbecbcd/68747470733a2f2f7062732e7477696d672e636f6d2f70726f66696c655f696d616765732f3337383830303030303334393736343032352f62396537363762326535656263363331383738323633623732613832313631655f6e6f726d616c2e706e67"></a><p>I made another screencast demoing pernosco, this time analyzing a rustfmt trace. We’ll have to hear from <a href="https://twitter.com/ekuber">@ekuber</a> about whether it was useful for them to see (aka more homework!) #rustlang #debugging <a href="https://t.co/BbJUcS1qbc">https://youtu.be/VnFqe1U8ukE</a></p><span>- Felix S K II (@pnkfelix)</span></div></div>



<a name="256807038"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256807038" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256807038">(Oct 08 2021 at 21:14)</a>:</h4>
<p>I was curious whether it would add anything to my usual "log all the things" style</p>



<a name="256807044"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256807044" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256807044">(Oct 08 2021 at 21:14)</a>:</h4>
<p>answer: yes</p>



<a name="256807063"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256807063" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256807063">(Oct 08 2021 at 21:14)</a>:</h4>
<p>in particular, it helps to establish "what the heck was going on when this line was output"</p>



<a name="256807087"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256807087" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256807087">(Oct 08 2021 at 21:14)</a>:</h4>
<p>....it could be even better....</p>



<a name="256807100"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256807100" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256807100">(Oct 08 2021 at 21:14)</a>:</h4>
<p>I had to re-run a bunch of times, adding new logs etc</p>



<a name="256807115"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256807115" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256807115">(Oct 08 2021 at 21:15)</a>:</h4>
<p>it'd be so sweet if tracing were more smoothly integrated</p>



<a name="256807121"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256807121" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256807121">(Oct 08 2021 at 21:15)</a>:</h4>
<p>maybe I'll talk to them about that :)</p>



<a name="256807135"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256807135" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256807135">(Oct 08 2021 at 21:15)</a>:</h4>
<p>so it does make it even clearer than only with rr ?</p>



<a name="256807146"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256807146" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256807146">(Oct 08 2021 at 21:15)</a>:</h4>
<p>oh, definitely</p>



<a name="256807156"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256807156" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256807156">(Oct 08 2021 at 21:15)</a>:</h4>
<p>being able to click in the source and walk through</p>



<a name="256807162"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256807162" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256807162">(Oct 08 2021 at 21:15)</a>:</h4>
<p>see the callees etc</p>



<a name="256807166"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256807166" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256807166">(Oct 08 2021 at 21:15)</a>:</h4>
<p>much better than gdb</p>



<a name="256807291"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256807291" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256807291">(Oct 08 2021 at 21:16)</a>:</h4>
<p>awesome :) we should get on that: someone opens a rustc issue, some automated tool reduces it, runs it with rr and sends it to pernosco <span aria-label="heart eyes" class="emoji emoji-1f60d" role="img" title="heart eyes">:heart_eyes:</span></p>



<a name="256807539"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256807539" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256807539">(Oct 08 2021 at 21:18)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441/near/256805665">said</a>:</p>
<blockquote>
<p>that replacing the bound variables with placeholders only to map them back is silly</p>
</blockquote>
<p>so have to think more about the rest of the messages, but FWIR, I got <em>pretty</em> close to being able to just keep late bound regions around</p>



<a name="256807544"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256807544" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256807544">(Oct 08 2021 at 21:18)</a>:</h4>
<p>Probably only for select issues. At least for the send to pernosco part. Pernosco needs very heavy machines expand traces to allow for realtime analysis AFAIK.</p>



<a name="256807572"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Normalize%20Under%20Binders%20PR%20%2388441/near/256807572" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Normalize.20Under.20Binders.20PR.20.2388441.html#256807572">(Oct 08 2021 at 21:19)</a>:</h4>
<p>but the problems started when we have to register obligations</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>