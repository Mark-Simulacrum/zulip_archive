<html>
<head><meta charset="utf-8"><title>TAITs ahoy - higher order unification · wg-traits · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/index.html">wg-traits</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.20-.20higher.20order.20unification.html">TAITs ahoy - higher order unification</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="263464493"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy%20-%20higher%20order%20unification/near/263464493" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.20-.20higher.20order.20unification.html#263464493">(Dec 02 2021 at 16:35)</a>:</h4>
<blockquote>
<p>This looks like a higher-order unification problem</p>
</blockquote>
<p>It's a bit easier in our case, as they must be fully generic to be defining and so we can just (yes it's actually easy), substitute all generic params with new ones in both cases and then compare the hidden types. So <code>Foo&lt;T, U&gt; = (t, u)</code> and <code>Foo&lt;U, T&gt; = (u, t)</code>both become <code>Foo&lt;?X, ?Y&gt; = (_: ?X, _: ?Y)</code>, and are thus equal</p>



<a name="263773684"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy%20-%20higher%20order%20unification/near/263773684" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Waffle Lapkin <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.20-.20higher.20order.20unification.html#263773684">(Dec 05 2021 at 15:29)</a>:</h4>
<p>(I don't know how this cool type check stuff works so I'm sorry in advance) </p>
<p>Wouldn't there be a problem with something like</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#[derive(Copy, Clone)]</span><span class="w"></span>
<span class="k">struct</span> <span class="nc">T</span><span class="p">;</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">define_foo</span><span class="o">&lt;</span><span class="n">U</span>: <span class="nb">Copy</span><span class="o">&gt;</span><span class="p">(</span><span class="n">u</span>: <span class="nc">U</span><span class="p">,</span><span class="w"> </span><span class="n">t</span>: <span class="nc">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">_</span>: <span class="nc">Foo</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">U</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">);</span><span class="w"> </span><span class="c1">// Foo&lt;?X, ?Y&gt; = (?X, ?Y, ?X)</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">_</span>: <span class="nc">Foo</span><span class="o">&lt;</span><span class="n">U</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">);</span><span class="w"> </span><span class="c1">// Foo&lt;?X, ?Y&gt; = (?X, ?Y, ?Y)</span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>Or does this work differently? Or we disallow this anyway for some reason?</p>



<a name="263774462"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy%20-%20higher%20order%20unification/near/263774462" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.20-.20higher.20order.20unification.html#263774462">(Dec 05 2021 at 15:49)</a>:</h4>
<p>This already doesn't work because all defining uses must be fully generic</p>



<a name="263774541"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy%20-%20higher%20order%20unification/near/263774541" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.20-.20higher.20order.20unification.html#263774541">(Dec 05 2021 at 15:51)</a>:</h4>
<p>Technically we could allow some of these by checking whether there is at least one fully generic defining use, but for now it keeps me comfortable with the impl to stick with the restrictive version</p>



<a name="263774713"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy%20-%20higher%20order%20unification/near/263774713" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Waffle Lapkin <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.20-.20higher.20order.20unification.html#263774713">(Dec 05 2021 at 15:55)</a>:</h4>
<p>"Fully generic" means that if a type has generics (like "<code>Tuple3&lt;A, B, C&gt;</code> / <code>(A, B, C)</code>" in my example), then all of them must be filled from generics of TAIT, right?</p>



<a name="263787662"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy%20-%20higher%20order%20unification/near/263787662" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.20-.20higher.20order.20unification.html#263787662">(Dec 05 2021 at 20:37)</a>:</h4>
<p>Yes, and all trait bounds on these must match up</p>



<a name="263787824"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/TAITs%20ahoy%20-%20higher%20order%20unification/near/263787824" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/TAITs.20ahoy.20-.20higher.20order.20unification.html#263787824">(Dec 05 2021 at 20:40)</a>:</h4>
<p>So your function can't have fewer bounds than the type alias</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>