<html>
<head><meta charset="utf-8"><title>.chalk file writer · wg-traits · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/index.html">wg-traits</a></h2>
<h3>Topic: <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html">.chalk file writer</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://rust-lang.github.io/zulip_archive/style.css" rel="stylesheet"></head>

<a name="192922873"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/192922873" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Ross <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#192922873">(Apr 04 2020 at 19:19)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232957">Jack Huey</span> <a href="#narrow/stream/144729-wg-traits/topic/Contribution.20to.20chalk/near/192922454" title="#narrow/stream/144729-wg-traits/topic/Contribution.20to.20chalk/near/192922454">said</a>:</p>
<blockquote>
<p>This was really just a start. Really, we would want it to be at the <code>chalk_ir</code> level, not <code>chalk_integration</code></p>
</blockquote>
<p>Would that mean it belongs inside chalk-ir itself, or in an adjacent crate like the parser?</p>



<a name="192922933"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/192922933" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#192922933">(Apr 04 2020 at 19:20)</a>:</h4>
<p>Hmm</p>



<a name="192922937"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/192922937" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#192922937">(Apr 04 2020 at 19:20)</a>:</h4>
<p>I imagine probably just in chalk-ir</p>



<a name="192923014"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/192923014" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#192923014">(Apr 04 2020 at 19:22)</a>:</h4>
<p>I know we talked about this a little bit more in the past, let me see if I can find the relevant discussion</p>



<a name="192923171"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/192923171" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#192923171">(Apr 04 2020 at 19:27)</a>:</h4>
<p>I can't find it :(</p>



<a name="192923254"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/192923254" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> detrumi <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#192923254">(Apr 04 2020 at 19:29)</a>:</h4>
<p>This? <a href="#narrow/stream/144729-wg-traits/topic/design.20meeting.202019.2E12.2E30/near/184494609" title="#narrow/stream/144729-wg-traits/topic/design.20meeting.202019.2E12.2E30/near/184494609">https://rust-lang.zulipchat.com/#narrow/stream/144729-wg-traits/topic/design.20meeting.202019.2E12.2E30/near/184494609</a></p>



<a name="192923300"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/192923300" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> detrumi <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#192923300">(Apr 04 2020 at 19:30)</a>:</h4>
<p>(searching for ".chalk" in this stream did the trick)</p>



<a name="192923326"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/192923326" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> detrumi <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#192923326">(Apr 04 2020 at 19:31)</a>:</h4>
<p>I think we didn't actually discuss it that much, apart from that</p>



<a name="192923374"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/192923374" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#192923374">(Apr 04 2020 at 19:32)</a>:</h4>
<p>mmm, I think we discussed it briefly once I actually was working on my branch</p>



<a name="192923379"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/192923379" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#192923379">(Apr 04 2020 at 19:32)</a>:</h4>
<p>because we were dicussing how to name the parameters</p>



<a name="192923382"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/192923382" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#192923382">(Apr 04 2020 at 19:32)</a>:</h4>
<p>(if I recall correctly)</p>



<a name="192929188"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/192929188" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Ross <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#192929188">(Apr 04 2020 at 22:04)</a>:</h4>
<p>I guess for now we'll keep it in chalk-ir, and we can fix/change that before submitting a PR if necessary</p>



<a name="192929202"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/192929202" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#192929202">(Apr 04 2020 at 22:04)</a>:</h4>
<p>yeah, we can also move it to a separate crate if we want/need</p>



<a name="192929231"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/192929231" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#192929231">(Apr 04 2020 at 22:05)</a>:</h4>
<p>I'm wondering</p>



<a name="192929233"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/192929233" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#192929233">(Apr 04 2020 at 22:05)</a>:</h4>
<p>It actually might be better in chalk-solve</p>



<a name="192929274"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/192929274" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#192929274">(Apr 04 2020 at 22:06)</a>:</h4>
<p>Because we presumably want to write as traits/structs rather than the clauses themselves</p>



<a name="192931335"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/192931335" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Ross <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#192931335">(Apr 04 2020 at 23:05)</a>:</h4>
<p>With all the data required to print things accurately, that seems like it might be a good idea?</p>
<p>We were looking at possibly moving most of the rendering/writing code into methods in chalk-ir, we're accessing the RustIrDatabase methods of Program a lot to get names for types and other data, and we don't have access to that trait in chalk-ir</p>



<a name="192931381"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/192931381" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Ross <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#192931381">(Apr 04 2020 at 23:06)</a>:</h4>
<p>Right now we've mostly implemented more things within the giant "write" method on program and looked into various places we could move that code to be more modular</p>



<a name="192931392"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/192931392" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Ross <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#192931392">(Apr 04 2020 at 23:07)</a>:</h4>
<p>chalk-solve looks like it'd provide more functionality, but it also seems really kind of wrong to have the IR writing code in solve? That might just be a hangup around naming, though, I'm not sure</p>



<a name="192931409"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/192931409" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Ross <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#192931409">(Apr 04 2020 at 23:07)</a>:</h4>
<p>Err, if we wrote the code in chalk-solve, then we'd have access to the RustIrDatabase trait, and that'd be helpful</p>



<a name="192979226"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/192979226" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#192979226">(Apr 05 2020 at 21:31)</a>:</h4>
<p>Yes, we definitely should write in chalk-solve</p>



<a name="192979231"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/192979231" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#192979231">(Apr 05 2020 at 21:31)</a>:</h4>
<p>so, there's really two different "levels" of IR</p>



<a name="192979234"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/192979234" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#192979234">(Apr 05 2020 at 21:31)</a>:</h4>
<p>There is are "pseudo-Rust" IR</p>



<a name="192979237"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/192979237" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#192979237">(Apr 05 2020 at 21:31)</a>:</h4>
<p>Then the "Chalk IR"</p>



<a name="192979290"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/192979290" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#192979290">(Apr 05 2020 at 21:32)</a>:</h4>
<p>the former would have something like <code>impl Foo for Bar {}</code> where the latter is <code>Implemented(Bar: Foo)</code></p>



<a name="193096708"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/193096708" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#193096708">(Apr 06 2020 at 20:25)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232957">Jack Huey</span> <a href="#narrow/stream/144729-wg-traits/topic/.2Echalk.20file.20writer/near/192922937" title="#narrow/stream/144729-wg-traits/topic/.2Echalk.20file.20writer/near/192922937">said</a>:</p>
<blockquote>
<p>I imagine probably just in chalk-ir</p>
</blockquote>
<p>no, I think not chalk-ir, probably chalk-solve</p>



<a name="193096731"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/193096731" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#193096731">(Apr 06 2020 at 20:25)</a>:</h4>
<p>oh, I see you kind of got there</p>



<a name="193096774"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/193096774" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#193096774">(Apr 06 2020 at 20:25)</a>:</h4>
<p>what I was imagining is specifically that</p>



<a name="193096787"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/193096787" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#193096787">(Apr 06 2020 at 20:25)</a>:</h4>
<p>we would make a "wrapper" around <code>RustIrDatabase</code></p>



<a name="193096801"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/193096801" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#193096801">(Apr 06 2020 at 20:25)</a>:</h4>
<p>if some environment variable is set, we would take the <code>&amp;mut dyn RustIrDatabase&lt;I&gt;</code> that we get from the user</p>



<a name="193096878"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/193096878" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#193096878">(Apr 06 2020 at 20:26)</a>:</h4>
<p>and wrap it in our own database that (a) forwards along the calls and then (b) collects and dumps out the data it gets in response</p>



<a name="193096954"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/193096954" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#193096954">(Apr 06 2020 at 20:27)</a>:</h4>
<p>some of the things we have to do that are annoying: </p>
<ul>
<li>giving unique names from def-ids, it'd be best if we can preserve the names the user gave, obviously, perhaps creating longer vesions where needed</li>
</ul>



<a name="193097019"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/193097019" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#193097019">(Apr 06 2020 at 20:27)</a>:</h4>
<p>(but I'd say that to start we can just ignore the "fully qualified" things and assume names don't overlap, or else just add a disambiguation integer to every name)</p>



<a name="193097053"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/193097053" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#193097053">(Apr 06 2020 at 20:27)</a>:</h4>
<p>e.g., if the user defines <code>struct Foo</code> we write out <code>struct Foo1</code> and then if have another <code>Foo</code> in some other module, you get <code>Foo2</code></p>



<a name="193097189"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/193097189" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#193097189">(Apr 06 2020 at 20:28)</a>:</h4>
<ul>
<li>avoiding duplicate calls -- we would basically be monitoring the requests for things like <code>trait_datum(def_id)</code>, so obviously we only want to collect the first def-id</li>
</ul>



<a name="193097210"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/193097210" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#193097210">(Apr 06 2020 at 20:28)</a>:</h4>
<ul>
<li>we probably want to create many distinct files, one for each goal we are asked to solve</li>
</ul>



<a name="193675823"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/193675823" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Ross <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#193675823">(Apr 11 2020 at 19:34)</a>:</h4>
<p>Would the main thing be implementing a writer for the "pseudo-Rust" IR, then, or should we also aim at transforming the pure-Chalk IR into .chalk files as well?</p>
<p>Right now we're just doing the pseudo-Rust IR</p>



<a name="193675863"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/193675863" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#193675863">(Apr 11 2020 at 19:35)</a>:</h4>
<p>Just the pseudo-Rust IR</p>



<a name="193675959"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/193675959" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Ross <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#193675959">(Apr 11 2020 at 19:36)</a>:</h4>
<p>Cool, that works. Unrelated question, do you think it'd be appropriate to depend on DebugContext to get names from ids, or to try to make a better generic way to do that?</p>
<p>I can't seem to find a way to use either Interner nor RustIrDatabase to get good name information for traits from TraitIds</p>



<a name="193675981"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/193675981" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#193675981">(Apr 11 2020 at 19:37)</a>:</h4>
<p>Um not sure</p>



<a name="193675989"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/193675989" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#193675989">(Apr 11 2020 at 19:37)</a>:</h4>
<p>It's probably okay to use on DebugContext</p>



<a name="193676029"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/193676029" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#193676029">(Apr 11 2020 at 19:38)</a>:</h4>
<p>but also feel free to add methods to Interner or RustIrDatabase as you see fit</p>



<a name="193676148"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/193676148" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Ross <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#193676148">(Apr 11 2020 at 19:41)</a>:</h4>
<p>alright <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="193676331"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/193676331" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#193676331">(Apr 11 2020 at 19:45)</a>:</h4>
<p><code>DebugContext</code> only exists for the Chalk integration tests, shouldn't the methods on <code>Interner</code> be enough though?</p>



<a name="193676400"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/193676400" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#193676400">(Apr 11 2020 at 19:46)</a>:</h4>
<p>uh let me check</p>



<a name="193676412"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/193676412" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#193676412">(Apr 11 2020 at 19:47)</a>:</h4>
<p>tbh I actually don't remember where <code>DebugContext</code> is</p>



<a name="193676485"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/193676485" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#193676485">(Apr 11 2020 at 19:48)</a>:</h4>
<p>okay, I actually think <code>DebugContext</code> and all the tls-specific stuff should be moved out of chalk-ir</p>



<a name="193676493"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/193676493" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#193676493">(Apr 11 2020 at 19:49)</a>:</h4>
<p>seems like it just duplicates methods in <code>Interner</code></p>



<a name="193676592"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/193676592" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#193676592">(Apr 11 2020 at 19:51)</a>:</h4>
<p>err</p>



<a name="193676719"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/193676719" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#193676719">(Apr 11 2020 at 19:54)</a>:</h4>
<p>I guess it can be under <code>#[cfg(any(test, feature = "default-interner"))]</code></p>



<a name="193677093"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/193677093" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Ross <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#193677093">(Apr 11 2020 at 20:04)</a>:</h4>
<p><span class="user-mention silent" data-user-id="129457">Florian Diebold</span> <a href="#narrow/stream/144729-wg-traits/topic/.2Echalk.20file.20writer/near/193676331" title="#narrow/stream/144729-wg-traits/topic/.2Echalk.20file.20writer/near/193676331">said</a>:</p>
<blockquote>
<p><code>DebugContext</code> only exists for the Chalk integration tests, shouldn't the methods on <code>Interner</code> be enough though?</p>
</blockquote>
<p>If that's what it is then I'm OK with not using it.</p>
<p>Interner as it's currently written isn't enough because it doesn't expose any information about what things were originally named (or if it does, I can't find it)</p>



<a name="193677111"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/193677111" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Ross <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#193677111">(Apr 11 2020 at 20:05)</a>:</h4>
<p>or I guess it does have those debug_* methods but they aren't guaranteed to have answers?</p>



<a name="193677715"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/193677715" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#193677715">(Apr 11 2020 at 20:20)</a>:</h4>
<p>probably should be <code>RustIrDatabase</code></p>



<a name="193677722"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/193677722" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#193677722">(Apr 11 2020 at 20:20)</a>:</h4>
<p>for things like trait/struct names and such</p>



<a name="193677818"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/193677818" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#193677818">(Apr 11 2020 at 20:22)</a>:</h4>
<p>I personally think the debug methods should be enough for the chalk file writer, which is a debug tool itself</p>



<a name="193677941"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/193677941" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#193677941">(Apr 11 2020 at 20:25)</a>:</h4>
<p>Mmm, I think it will be enough for 80-90% of the work</p>



<a name="193684304"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/193684304" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Super Tuple <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#193684304">(Apr 11 2020 at 23:15)</a>:</h4>
<p>Is there a chance that someone will need the debug methods to output something other than valid syntax? Maybe we can provide some interfaces to give access to the data that these debug methods are using?</p>



<a name="193687291"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/193687291" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Ross <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#193687291">(Apr 12 2020 at 00:51)</a>:</h4>
<p>Unrelated question: how do binders work?</p>
<p>I think I understand the concept of debrujin indices, but I'm struggling to grasp how exactly to find some parameter's debrujin index if it isn't a BoundVar</p>



<a name="193687353"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/193687353" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Ross <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#193687353">(Apr 12 2020 at 00:53)</a>:</h4>
<p>Like, in places, we'll get something wrapping a BoundVar and from that we can get a debrujin index &amp; the other index to name it by. But then, for instance, in AssociatedTyBound, the only way to get its generics is to iterate over x.binders.binders, which has no debrujin indices</p>



<a name="193687426"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/193687426" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Ross <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#193687426">(Apr 12 2020 at 00:55)</a>:</h4>
<p>oh! wait, I think I got it. they always have debrujin index 0 because they're freshly introduced. that makes sense</p>



<a name="193690277"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/193690277" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Ross <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#193690277">(Apr 12 2020 at 02:26)</a>:</h4>
<p>Separate question: what's the recommended way to get the various types out of an AliasEq that's part of a WhereClause?</p>
<p>We've looked at the inner data, but I can't help but feel like we're missing the bigger picture here. It looks like for a where clause <code>X: Y&lt;A1, A2, A3, Z&lt;B1, B2, B3&gt;=D&gt;</code>, the various parameters end up as:</p>
<div class="codehilite"><pre><span></span>alias_eq.alias.substitution = [A1, A2, A3, X, B1, B2, B3]
alias_eq.ty = D
alias_eq.alias.associated_ty_id = (some way to get Y, Z)
</pre></div>


<p>(for <code>alias_eq</code> being the <code>AliasEq</code> inside <code>WhereClause:::AliasEq</code>)</p>
<p>All the types there, but I have no idea how A1,A2,A3 and X and B1,B2,B3 are related and why they're put in the same data structure, or how to get them out of that structure (and differentiate between A_, X, and B_).</p>



<a name="193693337"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/193693337" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#193693337">(Apr 12 2020 at 04:16)</a>:</h4>
<p><span class="user-mention silent" data-user-id="218710">David Ross</span> <a href="#narrow/stream/144729-wg-traits/topic/.2Echalk.20file.20writer/near/193687426" title="#narrow/stream/144729-wg-traits/topic/.2Echalk.20file.20writer/near/193687426">said</a>:</p>
<blockquote>
<p>oh! wait, I think I got it. they always have debrujin index 0 because they're freshly introduced. that makes sense</p>
</blockquote>
<p>yes, exactly. <code>Binders</code> define <em>what</em> is bound</p>



<a name="193693384"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/193693384" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#193693384">(Apr 12 2020 at 04:18)</a>:</h4>
<p><span class="user-mention silent" data-user-id="218710">David Ross</span> <a href="#narrow/stream/144729-wg-traits/topic/.2Echalk.20file.20writer/near/193690277" title="#narrow/stream/144729-wg-traits/topic/.2Echalk.20file.20writer/near/193690277">said</a>:</p>
<blockquote>
<p>Separate question: what's the recommended way to get the various types out of an AliasEq that's part of a WhereClause?</p>
<p>We've looked at the inner data, but I can't help but feel like we're missing the bigger picture here. It looks like for a where clause <code>X: Y&lt;A1, A2, A3, Z&lt;B1, B2, B3&gt;=D&gt;</code>, the various parameters end up as:</p>
<div class="codehilite"><pre><span></span>alias_eq.alias.substitution = [A1, A2, A3, X, B1, B2, B3]
alias_eq.ty = D
alias_eq.alias.associated_ty_id = (some way to get Y, Z)
</pre></div>


<p>(for <code>alias_eq</code> being the <code>AliasEq</code> inside <code>WhereClause:::AliasEq</code>)</p>
<p>All the types there, but I have no idea how A1,A2,A3 and X and B1,B2,B3 are related and why they're put in the same data structure, or how to get them out of that structure (and differentiate between A_, X, and B_).</p>
</blockquote>
<p>uh, I'll have to look into this. Or <span class="user-mention" data-user-id="125131">@detrumi</span> might be able to answer since they have worked on the <code>AliasEq</code>-related code more recently</p>



<a name="193693723"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/193693723" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Areredify <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#193693723">(Apr 12 2020 at 04:28)</a>:</h4>
<p>Isn't it just like everything else, i.e. you do <code>assoc_ty_datum.binders.substitute(interner, alias_eq.alias.substitution)</code> and get assoc type bounds and whatever</p>



<a name="193694130"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/193694130" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Areredify <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#193694130">(Apr 12 2020 at 04:43)</a>:</h4>
<p>As to how distinguish between A, X and B, you can refer to chalk-solve\src\split.rs, it has everything you need</p>



<a name="193694249"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/193694249" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Areredify <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#193694249">(Apr 12 2020 at 04:46)</a>:</h4>
<p>ToProgramClauses impl for AssocTyDatum is a good example of how they are used</p>



<a name="193698057"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/193698057" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> detrumi <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#193698057">(Apr 12 2020 at 06:51)</a>:</h4>
<p>One thing to know is that <code>AliasEq</code> was previously called <code>ProjectionEq</code>, the name was generalized but the other kinds of aliases (impl Trait, type alias) haven't been added yet</p>



<a name="193698067"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/193698067" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> detrumi <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#193698067">(Apr 12 2020 at 06:51)</a>:</h4>
<p>Looking at just the where clause can get confusing if you don't look at the associated type as well</p>



<a name="193698111"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/193698111" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> detrumi <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#193698111">(Apr 12 2020 at 06:53)</a>:</h4>
<p><span class="user-mention silent" data-user-id="251766">Areredify</span> <a href="#narrow/stream/144729-wg-traits/topic/.2Echalk.20file.20writer/near/193694130" title="#narrow/stream/144729-wg-traits/topic/.2Echalk.20file.20writer/near/193694130">said</a>:</p>
<blockquote>
<p>As to how distinguish between A, X and B, you can refer to chalk-solve\src\split.rs, it has everything you need</p>
</blockquote>
<p>I'm not familiar with the exact representation either, but this part seems relevant:</p>
<div class="codehilite"><pre><span></span>Given a projection of an associated type, split the type
parameters into those that come from the *trait* and those
that come from the *associated type itself*.
</pre></div>



<a name="194558736"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/194558736" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Ross <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#194558736">(Apr 18 2020 at 18:57)</a>:</h4>
<p><span class="user-mention silent" data-user-id="251766">Areredify</span> <a href="#narrow/stream/144729-wg-traits/topic/.2Echalk.20file.20writer/near/193694130" title="#narrow/stream/144729-wg-traits/topic/.2Echalk.20file.20writer/near/193694130">said</a>:</p>
<blockquote>
<p>As to how distinguish between A, X and B, you can refer to chalk-solve\src\split.rs, it has everything you need</p>
</blockquote>
<p>Awesome! This looks like exactly what we need.</p>
<p><span class="user-mention silent" data-user-id="125131">detrumi</span> <a href="#narrow/stream/144729-wg-traits/topic/.2Echalk.20file.20writer/near/193698067" title="#narrow/stream/144729-wg-traits/topic/.2Echalk.20file.20writer/near/193698067">said</a>:</p>
<blockquote>
<p>Looking at just the where clause can get confusing if you don't look at the associated type as well</p>
</blockquote>
<p>I'll be sure to try and check that out independently too!</p>



<a name="194568749"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/194568749" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Ross <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#194568749">(Apr 18 2020 at 23:22)</a>:</h4>
<p>Thanks all for answering the questions though! It's super helpful</p>



<a name="194572834"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/194572834" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Super Tuple <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#194572834">(Apr 19 2020 at 01:23)</a>:</h4>
<p>We've made progress and have most of the cases covered, if anyone wants to take a look:<br>
<a href="https://github.com/rust-lang/chalk/compare/master...daboross:program-writer" title="https://github.com/rust-lang/chalk/compare/master...daboross:program-writer">https://github.com/rust-lang/chalk/compare/master...daboross:program-writer</a><br>
Thanks for all the advice, it was very useful.</p>



<a name="194572874"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/194572874" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Ross <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#194572874">(Apr 19 2020 at 01:24)</a>:</h4>
<p>I'm looking forward to this being a real thing we can submit!</p>



<a name="194583725"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/194583725" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> detrumi <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#194583725">(Apr 19 2020 at 07:21)</a>:</h4>
<p>Nice! Feel free to open a draft/WIP PR, that makes it easier to track ongoing work, and allows leaving early review comments on the code</p>



<a name="194584196"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/194584196" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> detrumi <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#194584196">(Apr 19 2020 at 07:35)</a>:</h4>
<p>Instead of getting the trait name from trait_id in several places (I see that you're planning to use the interner debug methods), it might be cleaner to implement <code>RenderAsRust</code> for <code>TraitId&lt;I&gt;</code>, and look up the trait name there</p>



<a name="194584464"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/194584464" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> detrumi <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#194584464">(Apr 19 2020 at 07:43)</a>:</h4>
<p>One thing that's going to be important for the <code>.chalk</code> files is that they can be parsed again correctly, as it's easy for the display impl's to get outdated. One way to reduce that might be to re-use code for both debug and display output, if they produce the same output in some places, but that might be tricky.<br>
What you could also do, to ensure that chalk can parse the display output, is to have the tests parse the displayed output, and check that the original program and the reparsed program are the same (<code>Program</code> implements <code>Eq</code> after all)</p>



<a name="195297678"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/195297678" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Super Tuple <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#195297678">(Apr 25 2020 at 18:52)</a>:</h4>
<p>We were unable to find anything in the chalk program parser or the lowering logic that produces <code>TyData::Placeholder</code> or <code>TyData::InferenceVar</code>.  My guess is they are only produced by goals rather than programs. Do we need to be able to output these, and if so, what program would produce them?</p>



<a name="195298951"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/195298951" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#195298951">(Apr 25 2020 at 19:25)</a>:</h4>
<p>You are correct with that guess :)</p>



<a name="195298955"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/195298955" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#195298955">(Apr 25 2020 at 19:25)</a>:</h4>
<p>I don't think those will ever get outputed</p>



<a name="195299119"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/195299119" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Ross <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#195299119">(Apr 25 2020 at 19:29)</a>:</h4>
<p><span class="user-mention silent" data-user-id="125131">detrumi</span> <a href="#narrow/stream/144729-wg-traits/topic/.2Echalk.20file.20writer/near/194584464" title="#narrow/stream/144729-wg-traits/topic/.2Echalk.20file.20writer/near/194584464">said</a>:</p>
<blockquote>
<p>One thing that's going to be important for the <code>.chalk</code> files is that they can be parsed again correctly, as it's easy for the display impl's to get outdated. One way to reduce that might be to re-use code for both debug and display output, if they produce the same output in some places, but that might be tricky.<br>
What you could also do, to ensure that chalk can parse the display output, is to have the tests parse the displayed output, and check that the original program and the reparsed program are the same (<code>Program</code> implements <code>Eq</code> after all)</p>
</blockquote>
<p>Using reparse tests sounds good! We'll implement that.</p>
<p>On a related note, do you think it would be reasonable to implement some kind of snapshot testing for display output? We were looking at the insta crate for doing that, but it's another dependency to add (even if only a dev-dependency).</p>
<p>We're slightly hesitant to reuse debug/display code - I think the biggest problem is that they operate under different constraints. Like, the debug code doesn't have to produce valid code, but it also doesn't have access to all the data we do via RustIrDatabase. That distinction will be slightly muddled if we use the interner debug methods, but they at least seem like a small interface.</p>



<a name="195299264"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/195299264" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#195299264">(Apr 25 2020 at 19:33)</a>:</h4>
<p><span class="user-mention silent" data-user-id="218710">David Ross</span> <a href="#narrow/stream/144729-wg-traits/topic/.2Echalk.20file.20writer/near/195299119" title="#narrow/stream/144729-wg-traits/topic/.2Echalk.20file.20writer/near/195299119">said</a>:</p>
<blockquote>
<p>On a related note, do you think it would be reasonable to implement some kind of snapshot testing for display output? We were looking at the insta crate for doing that, but it's another dependency to add (even if only a dev-dependency).</p>
</blockquote>
<p>I don't think the actual output matters all that much. More so, it matters that it get re-parsed correctly. Keeping around snapshots I don't think makes sense, because we can easily just re-parse and check equality.</p>



<a name="195299515"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/195299515" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> detrumi <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#195299515">(Apr 25 2020 at 19:39)</a>:</h4>
<p>The output is probably too large to really track in snapshots as well. And having stable output isn't really a goal, it's fine if things change ordering and such (correctness tests and benchmarks are better tools to ensure output quality)</p>



<a name="195306612"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/195306612" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Ross <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#195306612">(Apr 25 2020 at 23:00)</a>:</h4>
<p>Sounds good! We're writing the reparse tests and it turns out our code had many more errors than we thought</p>



<a name="195311873"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/195311873" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#195311873">(Apr 26 2020 at 01:48)</a>:</h4>
<p>So, I just took a short glance over your branch</p>



<a name="195311876"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/195311876" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#195311876">(Apr 26 2020 at 01:48)</a>:</h4>
<p>looking pretty good</p>



<a name="195311880"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/195311880" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#195311880">(Apr 26 2020 at 01:49)</a>:</h4>
<p>one thing though</p>



<a name="195311887"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/195311887" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#195311887">(Apr 26 2020 at 01:49)</a>:</h4>
<p>that I'm not sure if you've thought about</p>



<a name="195311953"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/195311953" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#195311953">(Apr 26 2020 at 01:51)</a>:</h4>
<p>but rather having the <code>WriteProgram</code> impl on <code>Program</code>, we really should have a wrapper around <code>RustIrDatabase</code> of sorts, that essentially intercepts all calls and writes/stores them</p>



<a name="195312001"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/195312001" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#195312001">(Apr 26 2020 at 01:52)</a>:</h4>
<p>so we could, for example, wrap the rustc <code>RustIrDatabase</code> while debugging and print that</p>



<a name="195313135"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/195313135" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Ross <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#195313135">(Apr 26 2020 at 02:29)</a>:</h4>
<p>That sounds like a reasonable thing to add to me!</p>
<p>We haven't written that part of the code yet, but I think everything we have written should be fully applicable to it. Like, there's a little bit of code in WriteProgram, but we should be able to migrate it to the wrapper once we've confirmed all the display code is working well.</p>



<a name="195313244"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/195313244" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Super Tuple <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#195313244">(Apr 26 2020 at 02:32)</a>:</h4>
<p>Thanks for taking a look at it! We pushed some more commits today that added a lot of test cases, and fixed most of the issues those tests exposed.</p>



<a name="195315691"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/195315691" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#195315691">(Apr 26 2020 at 03:51)</a>:</h4>
<p>Yeah, I didn't look super deeply. If you open a WIP PR, I'll spend some time on it and make comments :)</p>



<a name="195720695"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/195720695" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#195720695">(Apr 29 2020 at 14:48)</a>:</h4>
<p>what is the current status here?</p>



<a name="195720709"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/195720709" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#195720709">(Apr 29 2020 at 14:48)</a>:</h4>
<p>is there a draft PR available?</p>



<a name="195720726"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/195720726" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#195720726">(Apr 29 2020 at 14:48)</a>:</h4>
<p>I'm pretty excited to see so much activity <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span></p>



<a name="195738185"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/195738185" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#195738185">(Apr 29 2020 at 16:44)</a>:</h4>
<p>No draft PR. Just their branch</p>



<a name="195738218"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/195738218" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#195738218">(Apr 29 2020 at 16:44)</a>:</h4>
<p><a href="https://github.com/rust-lang/chalk/compare/master...daboross:program-writer" title="https://github.com/rust-lang/chalk/compare/master...daboross:program-writer">https://github.com/rust-lang/chalk/compare/master...daboross:program-writer</a></p>



<a name="195780387"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/195780387" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Ross <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#195780387">(Apr 29 2020 at 22:58)</a>:</h4>
<p>^^ I think we were mostly trying to fix all the things we know it's missing before submitting a PR</p>



<a name="196082539"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/196082539" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Ross <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#196082539">(May 03 2020 at 03:32)</a>:</h4>
<p>We've made a WIP PR! <a href="https://github.com/rust-lang/chalk/pull/430" title="https://github.com/rust-lang/chalk/pull/430">https://github.com/rust-lang/chalk/pull/430</a></p>
<p>We cleaned up a good number of things today; remaining tasks we know about are listed in that PR</p>



<a name="196117311"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/196117311" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#196117311">(May 03 2020 at 18:59)</a>:</h4>
<p>I'll take a look :)</p>



<a name="196219394"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/196219394" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#196219394">(May 04 2020 at 18:17)</a>:</h4>
<p>nice! left a few comments, but I guess it's mostly stuff you know</p>



<a name="197019982"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/197019982" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Ross <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#197019982">(May 09 2020 at 23:24)</a>:</h4>
<p>thanks for that! I think everything seems reasonable, and we'll reply to individual comments in the PR</p>



<a name="197021015"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/197021015" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Ross <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#197021015">(May 09 2020 at 23:44)</a>:</h4>
<p>Unrelated question: for names of things, do you all think it's more important to provide useful name information, or to reduce pollution of RustIrDatabase and the burden on its implementers?</p>
<p>We've been rediscussing these two possible solutions for naming things:</p>
<ol>
<li>ask for exact, valid names, either through new methods on RustIrDatabase or new methods on DebugContext</li>
<li>
<p>use existing <code>Interner</code> debug methods, and do post-work to make these valid identifiers.</p>
<p>I think we can address the concern raised here:</p>
<p><span class="user-mention silent" data-user-id="271698">Super Tuple</span> <a href="#narrow/stream/144729-wg-traits/topic/.2Echalk.20file.20writer/near/193684304" title="#narrow/stream/144729-wg-traits/topic/.2Echalk.20file.20writer/near/193684304">said</a>:</p>
<blockquote>
<p>Is there a chance that someone will need the debug methods to output something other than valid syntax? Maybe we can provide some interfaces to give access to the data that these debug methods are using?</p>
</blockquote>
<p>by simply replacing invalid characters with <code>_</code>, in a "best effort" sort of manner.</p>
<p>I've double checked and I believe all debug methods necessary to at least try to find names exist.</p>
</li>
</ol>
<p>In either case, we'd be appending identifiers to create unique names. With that, both should be fully viable. </p>
<p>We're currently aiming to switch to option 2, and just wanted to ensure that's a sane choice. There was that discussion earlier, but I'm not 100% sure if it ended in a consensus?</p>



<a name="197031234"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/197031234" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Super Tuple <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#197031234">(May 10 2020 at 04:02)</a>:</h4>
<p>We have updated the PR with more changes, including an (untested) implementation of the <code>LoggingRustIrDatabase</code>.</p>



<a name="197826479"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/197826479" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Ross <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#197826479">(May 17 2020 at 02:40)</a>:</h4>
<p>Another pending question: what kind of integration with ChalkDatabase / the salsa system there do you think we want?</p>
<p>We were trying to integrate LoggingRustIrDatabase into the existing tests to run it on a variety of cases, but ran into trouble trying to wrap Program while at the same time keeping salsa happy.</p>
<p>Is it reasonable to try to rerun the logging database on all existing test cases? This would give us a bunch of free test cases for LoggingRustIrDatabase, but seems like it could also triple the time to run tests. Is this worth it, and if so, how would you recommend integrating it?</p>
<p>We're consider either adding a database wrapper into <code>ChalkDatabase</code>, or just circumventing <code>ChalkDatabase</code> completely.</p>
<p>For the former, what's the best way to integrate with the salsa system? Could we make <code>ChalkDatabase</code> generic over the wrapper, or somehow give salsa a function for constructing the wrapper? We tried to get this to work, but salsa's requiring <code>Eq</code> bounds makes using <code>dyn RustIrDatabase</code> pretty messy. We haven't tried making <code>ChalkDatabase</code> itself generic yet.</p>
<p>Since integrating this wrapper with the salsa system in a general way seems overly complicated, what about completely circumventing it? Would it be alright to, in tests, ignore all the <code>ChalkDatabase</code> methods and just construct the solver ourselves - passing it in a <code>LoggingRustIrDatabase</code>?</p>



<a name="197827944"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/197827944" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#197827944">(May 17 2020 at 03:26)</a>:</h4>
<p>Oh I was gonna look at these changes</p>



<a name="197827956"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/197827956" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#197827956">(May 17 2020 at 03:27)</a>:</h4>
<p>I think we want to be able to get all the info from RustIrDatabase alone</p>



<a name="197827995"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/197827995" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#197827995">(May 17 2020 at 03:28)</a>:</h4>
<p>I think for logging tests, maybe just add an extra set of tests like we have lowering tests</p>



<a name="197828060"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/197828060" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#197828060">(May 17 2020 at 03:30)</a>:</h4>
<p>I don't think I'm answering your question correctly</p>



<a name="197828190"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/197828190" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#197828190">(May 17 2020 at 03:35)</a>:</h4>
<p>Ah so. Interesting. <code>RustIrDatabase</code> is implemented for both <code>ChalkDatabase</code> and <code>Program</code></p>



<a name="197828260"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/197828260" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#197828260">(May 17 2020 at 03:37)</a>:</h4>
<p>And then <code>LoweringDatabase</code> <em>also</em> extends <code>RustIrDatabase</code></p>



<a name="197828375"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/197828375" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#197828375">(May 17 2020 at 03:41)</a>:</h4>
<p>I feel like this is a little needlessly complicated</p>



<a name="197828380"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/197828380" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#197828380">(May 17 2020 at 03:41)</a>:</h4>
<p>(but I also don't know a <em>ton</em> about how salsa requires it set up)</p>



<a name="197828425"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/197828425" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#197828425">(May 17 2020 at 03:42)</a>:</h4>
<p>I think <code>ChalkDatabase</code> doesn't need to implement <code>RustIrDatabase</code></p>



<a name="197828481"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/197828481" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#197828481">(May 17 2020 at 03:44)</a>:</h4>
<p>Oh hmm. I see what's happening</p>



<a name="197828631"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/197828631" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#197828631">(May 17 2020 at 03:49)</a>:</h4>
<p>you could just add a "logging" field to <code>ChalkDatabase</code> and then wrap the <code>program_ir</code> result with that</p>



<a name="197828688"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/197828688" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#197828688">(May 17 2020 at 03:50)</a>:</h4>
<blockquote>
<p>Could we make ChalkDatabase generic over the wrapper, or somehow give salsa a function for constructing the wrapper?</p>
</blockquote>
<p>I guess that's what you mean here</p>



<a name="197828707"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/197828707" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#197828707">(May 17 2020 at 03:52)</a>:</h4>
<p>But also, to answer your last question: yes I think it's acceptable to just not use <code>ChalkDatabase</code> for logging tests :)</p>



<a name="197828746"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/197828746" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#197828746">(May 17 2020 at 03:52)</a>:</h4>
<p>Since <em>really</em> those tests are only tests the wrapper</p>



<a name="197828749"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/197828749" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#197828749">(May 17 2020 at 03:52)</a>:</h4>
<p>You also can completely ignore and coherence or well formed checks</p>



<a name="197828754"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/197828754" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#197828754">(May 17 2020 at 03:53)</a>:</h4>
<p>Sorry, that was perhaps too much</p>



<a name="197828755"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/197828755" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#197828755">(May 17 2020 at 03:53)</a>:</h4>
<p>I rambled a bit</p>



<a name="197836161"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/197836161" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Ross <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#197836161">(May 17 2020 at 07:49)</a>:</h4>
<p>It's all good! I think that hardcoding the logger as a field sounds workable. It feels a little icky, but I guess not as much if I think if <code>ChalkDatabase</code> as a program implementation detail rather than as an API</p>
<p>the main reason we wanted to use <code>ChalkDatabase</code> rather than not, though, was so we could hook into existing tests &amp; just add it as a tests pass. But I get the feeling that might not be great</p>



<a name="197836330"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/197836330" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Ross <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#197836330">(May 17 2020 at 07:54)</a>:</h4>
<p>If you happen to have more time to review it in the near future, do you think you could also see what you think of this post? <a href="#narrow/stream/144729-wg-traits/topic/.2Echalk.20file.20writer/near/197021015">https://rust-lang.zulipchat.com/#narrow/stream/144729-wg-traits/topic/.2Echalk.20file.20writer/near/197021015</a></p>
<p>I think that's one the main remaining decision remaining. The others being the logger tests, and the possibility of extending to include solver goals (though I think that could end up reasonably in a future PR?)</p>



<a name="197859369"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/197859369" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#197859369">(May 17 2020 at 17:21)</a>:</h4>
<p><span class="user-mention" data-user-id="218710">@David Ross</span> sorry, what's the question? That link just goes in the middle of my rambling</p>



<a name="197859453"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/197859453" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#197859453">(May 17 2020 at 17:23)</a>:</h4>
<p>Like I said, it's probably just easiest to not use <code>ChalkDatabase</code> for logging tests. (For now at least. Its already a big PR)</p>



<a name="197871559"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/197871559" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Ross <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#197871559">(May 17 2020 at 22:11)</a>:</h4>
<p>Sounds good</p>



<a name="197871716"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/197871716" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Ross <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#197871716">(May 17 2020 at 22:14)</a>:</h4>
<p>With the link, weird. I was trying to point to my post from the 9th about using debug methods vs. adding name methods to RustIrDatabase. After research, both methods seem possible, so we were wondering if your earlier opinion still stood?</p>



<a name="197884078"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/197884078" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#197884078">(May 18 2020 at 03:06)</a>:</h4>
<p>Hmm, so if it's possible to have the name methods with a default implementation that falls back to the "debug-like" representation, that would be "best"</p>



<a name="197884083"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/197884083" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#197884083">(May 18 2020 at 03:06)</a>:</h4>
<p>though, I'm not <em>super</em> worried about just adding the name methods and having no fallback</p>



<a name="197980132"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/197980132" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#197980132">(May 18 2020 at 18:52)</a>:</h4>
<p>I'm not sure I understood the salsa problem yet</p>



<a name="197980149"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/197980149" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#197980149">(May 18 2020 at 18:52)</a>:</h4>
<p>Well I'm sure I didn't :)</p>



<a name="197980182"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/197980182" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#197980182">(May 18 2020 at 18:53)</a>:</h4>
<p>I guess I better read the PR</p>



<a name="197980205"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/197980205" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#197980205">(May 18 2020 at 18:53)</a>:</h4>
<p>My opinion on names:</p>
<p>I don't think the exact names matter. I would tend to prefer simplified names. I think leveraging the <code>debug!</code> output is a fine place to start.</p>



<a name="198560368"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/198560368" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Ross <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#198560368">(May 24 2020 at 01:26)</a>:</h4>
<p>Sounds good - we can implement a fallback. Having the name methods there and optional seems like a good compromise. It'd allow us to keep the tests nice (comparing Program is a lot easier if the names match), and at the same time not place a huge burden on all RustIrDatabase implementors</p>



<a name="198560888"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/198560888" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Ross <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#198560888">(May 24 2020 at 01:47)</a>:</h4>
<p>On a different note, do you have any good ideas for dealing with const values in debug programs?</p>
<p>We're at a loss trying to figure out the any good way to output <code>ConcreteConst</code> that's correct for general rust programs.</p>
<p>The main thing chalk seems to expose is <code>const_eq</code>. We were thinking of trying to add a "const_value" method, and an implementation for that for <code>chalk-integration</code> doesn't sound hard. However, if I recall correctly, const values can in general be arbitrary rust expression.</p>
<p>We were also thinking of possibly building up a map of consts to integers we can just insert into the .chalk file source, but building such a map accurately using only <code>const_eq</code> would be <code>O(n^2)</code>, and it seems like there might be cases where even that's technically incorrect or doesn't capture the full nature of the program.</p>
<p>For instance, how should we output a program like this into a <code>.chalk</code> file?</p>
<div class="codehilite"><pre><span></span><code><span class="k">trait</span><span class="w"> </span><span class="n">Foo</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">T</span>: <span class="kt">usize</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="k">struct</span> <span class="nc">Bar</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">U</span>: <span class="kt">usize</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="k">impl</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">T</span>: <span class="kt">usize</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Foo</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Bar</span><span class="o">&lt;</span><span class="p">{</span><span class="n">T</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="p">}</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
</code></pre></div>



<a name="198563597"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/198563597" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#198563597">(May 24 2020 at 03:17)</a>:</h4>
<p>For now, I would say let's get the most simple case working for now</p>



<a name="198563638"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/198563638" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#198563638">(May 24 2020 at 03:18)</a>:</h4>
<p>Right now, we're only accepting something like <code>2</code> or <code>T</code> for const</p>



<a name="198563639"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/198563639" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#198563639">(May 24 2020 at 03:18)</a>:</h4>
<p>not more complicated expressions</p>



<a name="198566058"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/198566058" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Ross <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#198566058">(May 24 2020 at 04:42)</a>:</h4>
<p>OK - we can add simple support. For that case, do you think it'd be alright to add a new method to get the u32 value? Or if not, is the <code>O(n^2)</code> solution the best one?</p>



<a name="198566335"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/198566335" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Ross <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#198566335">(May 24 2020 at 04:49)</a>:</h4>
<p>Another issues has also popped up: when recording only the calls that are made, we miss a lot of information needed for everything to be well formed.</p>
<p>For instance, if we have the goal <code>S: Child</code> and the input</p>
<div class="codehilite"><pre><span></span><code><span class="k">struct</span> <span class="nc">S</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="k">trait</span><span class="w"> </span><span class="n">Parent</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="k">trait</span><span class="w"> </span><span class="n">Child</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="bp">Self</span>: <span class="nc">Parent</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="k">impl</span><span class="w"> </span><span class="n">Parent</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">S</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="k">impl</span><span class="w"> </span><span class="n">Child</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">S</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
</code></pre></div>


<p>We completely miss the <code>impl Parent for S</code> (as well as <code>Parent</code>)</p>



<a name="198566394"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/198566394" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Ross <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#198566394">(May 24 2020 at 04:51)</a>:</h4>
<p>We were thinking of possibly recursing through everything mentioned by the printing as well, and that would fix missing <code>Parent</code>, but there doesn't seem an obvious way to get <code>impl Parent for S {}</code> without picking up the universe.</p>



<a name="198566435"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/198566435" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#198566435">(May 24 2020 at 04:52)</a>:</h4>
<p>Hmm, I think I'm missing the problem with const</p>



<a name="198566438"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/198566438" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#198566438">(May 24 2020 at 04:52)</a>:</h4>
<p>I think maybe <span class="user-mention" data-user-id="251766">@Areredify</span> or <span class="user-mention" data-user-id="116009">@nikomatsakis</span> can better answer that</p>



<a name="198566448"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/198566448" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#198566448">(May 24 2020 at 04:53)</a>:</h4>
<p><span class="user-mention silent" data-user-id="218710">David Ross</span> <a href="#narrow/stream/144729-wg-traits/topic/.2Echalk.20file.20writer/near/198566058">said</a>:</p>
<blockquote>
<p>OK - we can add simple support. For that case, do you think it'd be alright to add a new method to get the u32 value? Or if not, is the <code>O(n^2)</code> solution the best one?</p>
</blockquote>
<p>What <code>u32</code> value?</p>



<a name="198566501"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/198566501" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#198566501">(May 24 2020 at 04:54)</a>:</h4>
<p>As far as well formed. I think it depends. If we are logging in a single-goal kind of view, we don't really even <em>need</em> those</p>



<a name="198566508"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/198566508" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#198566508">(May 24 2020 at 04:54)</a>:</h4>
<p>But if we are logging a <em>series</em> of goals, then we <em>should</em> see a well-formed check somewhere in there</p>



<a name="198566583"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/198566583" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Ross <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#198566583">(May 24 2020 at 04:56)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232957">Jack Huey</span> <a href="#narrow/stream/144729-wg-traits/topic/.2Echalk.20file.20writer/near/198566501">said</a>:</p>
<blockquote>
<p>As far as well formed. I think it depends. If we are logging in a single-goal kind of view, we don't really even <em>need</em> those</p>
</blockquote>
<p>But if there's a bug in the code we're logging for, don't we need to pass the well-formedness check in order to get to the point of reproducing it?</p>



<a name="198566651"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/198566651" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Ross <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#198566651">(May 24 2020 at 04:58)</a>:</h4>
<p>Or I might be misunderstanding the goal here</p>



<a name="198566772"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/198566772" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Super Tuple <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#198566772">(May 24 2020 at 05:02)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232957">Jack Huey</span> <a href="#narrow/stream/144729-wg-traits/topic/.2Echalk.20file.20writer/near/198566448">said</a>:</p>
<blockquote>
<p>What <code>u32</code> value?</p>
</blockquote>
<p>We were unable to find a way to obtain the input value for a const generic. So we can't display the three below:</p>
<div class="codehilite"><pre><span></span><code>struct Foo&lt;const T: u32&gt; {}
impl Bar for Foo&lt;3&gt; {}
</code></pre></div>



<a name="198574486"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/198574486" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Areredify <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#198574486">(May 24 2020 at 09:14)</a>:</h4>
<p>So the question is how to serialize consts for general rust programs?</p>



<a name="198574775"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/198574775" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Areredify <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#198574775">(May 24 2020 at 09:21)</a>:</h4>
<p>Uhh I think just making <code>Interner::InternedConst</code> to have a <code>Serialize + Deserialize</code> bounds and let the implementor deal with this is one option</p>



<a name="198574831"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/198574831" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Areredify <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#198574831">(May 24 2020 at 09:22)</a>:</h4>
<p>In parser we would <code>Deserialize</code> from the contents of <code>{ ... }</code></p>



<a name="198574969"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/198574969" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Areredify <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#198574969">(May 24 2020 at 09:27)</a>:</h4>
<p>Or make interner methods to do that (which is probably more in the spirit of what we already have)</p>



<a name="198574973"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/198574973" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Ross <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#198574973">(May 24 2020 at 09:27)</a>:</h4>
<p>this might be playing devil's advocate a bit - but I think the point is to be able to reproduce chalk problems purely in chalk, without the rustc integration.</p>
<p>If we have that goal, how could we produce valid chalk syntax from the arbitrary rust expressions?</p>



<a name="198575021"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/198575021" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Ross <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#198575021">(May 24 2020 at 09:28)</a>:</h4>
<p>what would the Serialize / Deserialize go _into_...</p>
<p>Or maybe it could be like json or something within .chalk files and then it'd use Serialize / Deserialize to go to that?</p>



<a name="198575197"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/198575197" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Ross <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#198575197">(May 24 2020 at 09:34)</a>:</h4>
<p>actually though I think I see it now more than I did initially! It could push the problem to whoever's writing it, and then we could potentially expand .chalk syntax if we ever want to be able to handle and test more complicated situations than just data which can serialize to something unique?</p>



<a name="198575200"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/198575200" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Ross <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#198575200">(May 24 2020 at 09:34)</a>:</h4>
<p>Sorry for being negative initially / not seeing that initially</p>



<a name="198575213"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/198575213" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Areredify <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#198575213">(May 24 2020 at 09:35)</a>:</h4>
<p>So hmm</p>



<a name="198575221"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/198575221" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Areredify <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#198575221">(May 24 2020 at 09:35)</a>:</h4>
<p>Is chalk file writer interner-agnostic?</p>



<a name="198575270"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/198575270" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Ross <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#198575270">(May 24 2020 at 09:36)</a>:</h4>
<p>Yes; it works over any impl of Interner and RustIrDatabase</p>



<a name="198575339"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/198575339" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Areredify <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#198575339">(May 24 2020 at 09:38)</a>:</h4>
<p>In that case yeah, delegating to rustc to [de-]serialize mir bodies or whatever is the way to go</p>



<a name="198575349"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/198575349" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Areredify <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#198575349">(May 24 2020 at 09:38)</a>:</h4>
<p>No way chalk is going to know how to parse an arbitrary rust experssion</p>



<a name="198575358"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/198575358" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Ross <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#198575358">(May 24 2020 at 09:39)</a>:</h4>
<p>hm - so would that mean we just don't support re-loading the file without doing so from within rustc?</p>



<a name="198575427"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/198575427" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Areredify <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#198575427">(May 24 2020 at 09:40)</a>:</h4>
<p>We won't support re-loading the file unless it was written with the same interner it is being read with</p>



<a name="198575441"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/198575441" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Ross <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#198575441">(May 24 2020 at 09:41)</a>:</h4>
<p>I thought part of the motivation was to reproduce a bug from rustc in chalk - but if that's not a possibility for const generics, then it does seem still useful to be able to reproduce it using rustc</p>



<a name="198575452"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/198575452" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Ross <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#198575452">(May 24 2020 at 09:41)</a>:</h4>
<p>right now everything else in our code is aimed towards re-loading the file with chalk-integration, regardless of where it comes from</p>



<a name="198575572"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/198575572" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Areredify <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#198575572">(May 24 2020 at 09:44)</a>:</h4>
<p>Hmm, alternatively, we could require both the original file and the chalk file, so we can just reference mir bodies inside it</p>



<a name="198575641"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/198575641" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Areredify <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#198575641">(May 24 2020 at 09:46)</a>:</h4>
<p>I think <span class="user-mention" data-user-id="116009">@nikomatsakis</span> and <span class="user-mention" data-user-id="119009">@eddyb</span> can make a more informed decision here than I can</p>



<a name="198577074"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/198577074" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#198577074">(May 24 2020 at 10:30)</a>:</h4>
<p>the whole point is to produce a file that can be used as a test in <code>chalk-integration</code>, yeah. Considering other interners have complete control over the representation of consts, I don't think it's possible to faithfully represent all possible consts from all possible interners (unless chalk-integration switches to allowing arbitrary-size integers or byte slices as consts), but it's probably not necessary either. I'd think it's probably fine to make a 'best effort' for now, e.g. by just debug-printing the interned const, or by adding a default-implemented method to <code>Interner</code> that does that</p>



<a name="198577258"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/198577258" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#198577258">(May 24 2020 at 10:37)</a>:</h4>
<p>basically, I think the operation you would need is mapping from the interner's const representation to <code>u32</code> in an injective way (i.e. respecting the <code>const_eq</code> equality), which is likely not possible in general, can only be done by the interner, and is not a thing that exists "naturally" already</p>



<a name="198577299"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/198577299" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#198577299">(May 24 2020 at 10:38)</a>:</h4>
<p>but an approximation that works correctly for most integer constants would be easy to implement by the interner, of course</p>



<a name="198578660"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/198578660" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Areredify <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#198578660">(May 24 2020 at 11:19)</a>:</h4>
<p>The problem is with unevaluated consts, not with the evaluated ones, we can of course sort evaluated consts into equivalency classes, n^2 for debug is more than enough</p>



<a name="198578781"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/198578781" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Areredify <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#198578781">(May 24 2020 at 11:23)</a>:</h4>
<p>Making a best-effort representation and supporting only evaluated consts is fine, I just think that we have to take unevaluated consts into account early so we won't have to make drastic rewrites later</p>



<a name="198580078"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/198580078" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#198580078">(May 24 2020 at 12:00)</a>:</h4>
<p>as long as chalk-integration doesn't have a way of representing unevaluated consts, that seems to be the best we can do. It won't be possible to use the chalk file writer to create tests for problems that only occur with unevaluated consts, but chalk-integration won't be able to represent those problems anyway</p>



<a name="198581266"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/198581266" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Areredify <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#198581266">(May 24 2020 at 12:32)</a>:</h4>
<p>I don't know about the extent const stuff uses unevaluated consts, it very well might be so virtually all const-related type checking uses it. For example (if I understand const rfc correctly), <code>let x: [u32; N]</code> is in reality <code>let x: [u32; { N }]</code>.</p>



<a name="198582242"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/198582242" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#198582242">(May 24 2020 at 12:57)</a>:</h4>
<p>well, the interner (i.e. rustc) will have to deal with that <em>somehow</em>, because even if chalk-integration did model unevaluated consts, I imagine it would do so in an extremely simplified way (maybe by having <code>const X = 1</code> declarations instead of just inline consts). Though I have no idea if that's actually worth having in chalk-integration <span aria-label="shrug" class="emoji emoji-1f937" role="img" title="shrug">:shrug:</span></p>



<a name="198582632"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/198582632" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Areredify <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#198582632">(May 24 2020 at 13:06)</a>:</h4>
<p>So far I am inclined to have lowering be dependent on the interner that produced that particular file and knows how to parse mir bodies or w/e</p>



<a name="198582644"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/198582644" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Areredify <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#198582644">(May 24 2020 at 13:06)</a>:</h4>
<p>Anyway Im interested what niko and eddyb have to say first</p>



<a name="202036078"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/202036078" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#202036078">(Jun 25 2020 at 23:05)</a>:</h4>
<p>why are MIR bodies under discussion? I don't think there is any way of deserializing them? (feel free to PM me if you are working on that, I have opinions :P. I've mostly discussed it with <span class="user-mention" data-user-id="228912">@James Munns</span>)</p>



<a name="202144889"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/202144889" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#202144889">(Jun 26 2020 at 21:29)</a>:</h4>
<p>we're building a tool that lets chalk dump out isolated tests, so if you are running e.g. rustc and you want to debug a chalk problem, you can reproduce it in standalone chalk. And it will ultimately have to interact with constants and things, though opaquely.</p>



<a name="202144905"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/202144905" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#202144905">(Jun 26 2020 at 21:29)</a>:</h4>
<p>I don't think the solution will involve deserializing MIR bodies, though..</p>



<a name="202865409"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/202865409" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> detrumi <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#202865409">(Jul 04 2020 at 09:24)</a>:</h4>
<p>I'm experimenting a bit with integrating the .chalk writer into rust-analyzer, and overall it seems to work pretty well. One unexpected thing was that there's placeholders in the output:</p>
<div class="codehilite"><pre><span></span><code>#[upstream]
#[non_enumerable]
#[object_safe]
trait IterMutTrait&lt;_1_1&gt;
where
  Self: DoubleEndedIterator,
  Self: Iterator&lt;Assoc_type_4909=&amp;&lt;placeholder(!0_18446744073709551615)&gt; mut _1_1&gt;,
  Self: ExactSizeIterator,
  Self: Iterator&lt;Assoc_type_4909=&amp;&lt;placeholder(!0_18446744073709551615)&gt; mut _1_1&gt;
{}
</code></pre></div>


<p>(ignore the <code>Assoc_type_4909</code>, I haven't found a way to display <code>AssocTypeId</code> values properly yet)<br>
The <code>&lt;placeholder(..)&gt;</code> part is where it would normally crash with "cannot print placeholder variables; these should only be in goals not programs".</p>



<a name="202865556"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/202865556" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> detrumi <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#202865556">(Jul 04 2020 at 09:29)</a>:</h4>
<p>Ah, looks like it has to do with lifetimes, since it's the <code>'a</code> in this trait:</p>
<div class="codehilite"><pre><span></span><code>trait IterMutTrait&lt;&#39;a, T: &#39;a&gt;:
    DoubleEndedIterator&lt;Item = &amp;&#39;a mut T&gt; + ExactSizeIterator&lt;Item = &amp;&#39;a mut T&gt;
{
}
</code></pre></div>



<a name="202865723"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/202865723" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#202865723">(Jul 04 2020 at 09:35)</a>:</h4>
<p>yeah, we use a placeholder when we have to provide lifetimes because we don't handle them at all yet</p>



<a name="202865776"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/202865776" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#202865776">(Jul 04 2020 at 09:36)</a>:</h4>
<p><a href="https://github.com/rust-analyzer/rust-analyzer/blob/9f754e0518e7f2860891079a117a3e4bc6f4a8fd/crates/ra_hir_ty/src/traits/chalk/mapping.rs#L141">https://github.com/rust-analyzer/rust-analyzer/blob/9f754e0518e7f2860891079a117a3e4bc6f4a8fd/crates/ra_hir_ty/src/traits/chalk/mapping.rs#L141</a></p>



<a name="202865788"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/202865788" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> detrumi <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#202865788">(Jul 04 2020 at 09:37)</a>:</h4>
<p>Cool. We probably shouldn't crash when trying to display a placeholder then, for now</p>



<a name="202866221"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/202866221" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> detrumi <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#202866221">(Jul 04 2020 at 09:50)</a>:</h4>
<p>Ah, and there's some <code>{error}</code>parts in some places, but that's probably also expected:</p>
<div class="codehilite"><pre><span></span><code>trait RcEqIdent&lt;_1_1&gt;
where
  _1_1: PartialEq&lt;{error}&gt;
{}
</code></pre></div>



<a name="202868901"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/.chalk%20file%20writer/near/202868901" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://rust-lang.github.io/zulip_archive/stream/144729-wg-traits/topic/.2Echalk.20file.20writer.html#202868901">(Jul 04 2020 at 11:07)</a>:</h4>
<p>it'd probably be good if the error type could be represented in some way in Chalk tests</p>



<hr><p>Last updated: Aug 07 2021 at 22:04 UTC</p>
</html>