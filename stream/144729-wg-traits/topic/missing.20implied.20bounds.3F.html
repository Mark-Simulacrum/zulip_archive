<html>
<head><meta charset="utf-8"><title>missing implied bounds? · wg-traits · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/index.html">wg-traits</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/missing.20implied.20bounds.3F.html">missing implied bounds?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="278146342"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/missing%20implied%20bounds%3F/near/278146342" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/missing.20implied.20bounds.3F.html#278146342">(Apr 07 2022 at 11:01)</a>:</h4>
<p>trying to fix <a href="https://github.com/rust-lang/rust/issues/95275">#95275</a> I changed mir typeck to always require wf bounds: <a href="https://github.com/rust-lang/rust/pull/95763/commits/38b5a0a1c88c62eacb068fbd7b287e968a2bf382">https://github.com/rust-lang/rust/pull/95763/commits/38b5a0a1c88c62eacb068fbd7b287e968a2bf382</a></p>



<a name="278146429"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/missing%20implied%20bounds%3F/near/278146429" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/missing.20implied.20bounds.3F.html#278146429">(Apr 07 2022 at 11:02)</a>:</h4>
<p>this causes us to need some additional bounds which really shouldn't be happening <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="278146605"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/missing%20implied%20bounds%3F/near/278146605" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/missing.20implied.20bounds.3F.html#278146605">(Apr 07 2022 at 11:04)</a>:</h4>
<p>also, <code>rustc-demangle</code> does something with lifetime we don't check in any test</p>



<a name="278146685"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/missing%20implied%20bounds%3F/near/278146685" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/missing.20implied.20bounds.3F.html#278146685">(Apr 07 2022 at 11:05)</a>:</h4>
<p>cause that actually broke when checking that all locals are wf when used</p>



<a name="278146763"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/missing%20implied%20bounds%3F/near/278146763" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/missing.20implied.20bounds.3F.html#278146763">(Apr 07 2022 at 11:06)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/pull/95519#discussion_r843918947">https://github.com/rust-lang/rust/pull/95519#discussion_r843918947</a> had a similar problem for associated type alias impl trait</p>



<a name="278155434"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/missing%20implied%20bounds%3F/near/278155434" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/missing.20implied.20bounds.3F.html#278155434">(Apr 07 2022 at 12:24)</a>:</h4>
<p>i don't get the error for <code>rustc-demangle</code>, it's caused by</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#![feature(nll)]</span><span class="w"></span>
<span class="k">struct</span> <span class="nc">Printer</span><span class="o">&lt;'</span><span class="na">a</span><span class="p">,</span><span class="w"> </span><span class="o">'</span><span class="na">s</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">parser</span>: <span class="kp">&amp;</span><span class="o">'</span><span class="na">s</span> <span class="p">(),</span><span class="w"></span>
<span class="w">    </span><span class="n">out</span>: <span class="kp">&amp;</span><span class="o">'</span><span class="na">a</span> <span class="p">(),</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="k">impl</span><span class="o">&lt;'</span><span class="na">a</span><span class="p">,</span><span class="w"> </span><span class="o">'</span><span class="na">s</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Printer</span><span class="o">&lt;'</span><span class="na">a</span><span class="p">,</span><span class="w"> </span><span class="o">'</span><span class="na">s</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">in_binder</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">_</span>: <span class="nc">impl</span><span class="w"> </span><span class="nb">FnOnce</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">Self</span><span class="p">))</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="w">    </span><span class="k">fn</span> <span class="nf">print_type</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="n">in_binder</span><span class="p">(</span><span class="o">|</span><span class="n">this</span><span class="o">|</span><span class="w"> </span><span class="bp">Self</span>::<span class="n">print_type</span><span class="p">(</span><span class="n">this</span><span class="p">))</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="278156807"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/missing%20implied%20bounds%3F/near/278156807" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/missing.20implied.20bounds.3F.html#278156807">(Apr 07 2022 at 12:34)</a>:</h4>
<p><code>rustc_mir_dataflow</code> hitting me with the</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">fmt_with</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">_ctxt</span>: <span class="kp">&amp;</span><span class="nc">C</span><span class="p">,</span><span class="w"> </span><span class="n">_f</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">fmt</span>::<span class="n">Formatter</span><span class="o">&lt;'</span><span class="nb">_</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">fmt</span>::<span class="nb">Result</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="fm">unimplemented!</span><span class="p">(</span><span class="s">"implement when/if needed"</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="278158756"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/missing%20implied%20bounds%3F/near/278158756" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/missing.20implied.20bounds.3F.html#278158756">(Apr 07 2022 at 12:50)</a>:</h4>
<p>I have no idea :( <span class="user-mention" data-user-id="116009">@nikomatsakis</span> can I get you to look at <a href="https://github.com/rust-lang/rust/issues/95275">#95275</a> given this minimization? Preferably in sync because I want to know how to efficiently debug stuff like that and have pretty much no idea <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="278158972"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/missing%20implied%20bounds%3F/near/278158972" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/missing.20implied.20bounds.3F.html#278158972">(Apr 07 2022 at 12:51)</a>:</h4>
<p>the error is</p>
<div class="codehilite" data-code-language="Text only"><pre><span></span><code>error: lifetime may not live long enough
  --&gt; src/lib.rs:10:9
   |
6  | impl&lt;'a, 's&gt; Printer&lt;'a, 's&gt; {
   |      --  -- lifetime `'s` defined here
   |      |
   |      lifetime `'a` defined here
...
10 |         self.in_binder(|this| Self::print_type(this))
   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ argument requires that `'a` must outlive `'s`
   |
   = help: consider adding the following bound: `'a: 's`
   = note: requirement occurs because of a mutable reference to `Printer&lt;'_#11r, '_#12r&gt;`
   = note: mutable references are invariant over their type parameter
   = help: see &lt;https://doc.rust-lang.org/nomicon/subtyping.html&gt; for more information about variance

error: lifetime may not live long enough
  --&gt; src/lib.rs:10:9
   |
6  | impl&lt;'a, 's&gt; Printer&lt;'a, 's&gt; {
   |      --  -- lifetime `'s` defined here
   |      |
   |      lifetime `'a` defined here
...
10 |         self.in_binder(|this| Self::print_type(this))
   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ argument requires that `'s` must outlive `'a`
   |
   = help: consider adding the following bound: `'s: 'a`
   = note: requirement occurs because of a mutable reference to `Printer&lt;'_#11r, '_#12r&gt;`
   = note: mutable references are invariant over their type parameter
   = help: see &lt;https://doc.rust-lang.org/nomicon/subtyping.html&gt; for more information about variance

help: `'a` and `'s` must be the same: replace one with the other
</code></pre></div>
<p>I have no idea why these 2 errors don't get deduplicated (probably because the second one has "help: <code>'a</code> and <code>'s</code> must be the same: replace one with the other"? <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>