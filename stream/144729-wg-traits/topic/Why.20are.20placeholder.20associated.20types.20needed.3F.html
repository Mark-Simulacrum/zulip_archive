<html>
<head><meta charset="utf-8"><title>Why are placeholder associated types needed? · wg-traits · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/index.html">wg-traits</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html">Why are placeholder associated types needed?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="275008182"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275008182" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275008182">(Mar 11 2022 at 17:45)</a>:</h4>
<p>What's exactly the purpose of the "placeholder associated types" in chalk/rustc? </p>
<p>It seems to me they can always be replaced with type variables, like this for example: </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">Foo</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">t</span>: <span class="nc">T</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="o">&lt;</span><span class="n">T</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Trait</span><span class="o">&gt;</span>::<span class="n">Assoc</span><span class="w"></span>
<span class="w">   </span><span class="k">where</span><span class="w"> </span><span class="n">T</span>: <span class="nc">Trait</span><span class="p">;</span><span class="w"></span>

<span class="o">-</span>-&gt;

<span class="nc">fn</span><span class="w"> </span><span class="n">Foo</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">U</span><span class="o">&gt;</span><span class="p">(</span><span class="n">t</span>: <span class="nc">T</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">U</span><span class="w"></span>
<span class="w">   </span><span class="k">where</span><span class="w"> </span><span class="n">T</span>: <span class="nc">Trait</span><span class="p">,</span><span class="w"></span>
<span class="w">       </span><span class="n">U</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="n">T</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Trait</span><span class="o">&gt;</span>::<span class="n">Assoc</span><span class="p">;</span><span class="w"> </span><span class="c1">// ProjectionEq(&lt;T as Trait&gt;::Assoc = U)</span>
</code></pre></div>



<a name="275008344"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275008344" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275008344">(Mar 11 2022 at 17:47)</a>:</h4>
<p>like, never have <code>&lt;T as Trait&gt;::Assoc</code> as a <em>type</em>, just as <em>constraints</em> on types, what Chalk calls <code>ProjectionEq</code></p>



<a name="275008386"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275008386" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275008386">(Mar 11 2022 at 17:47)</a>:</h4>
<p>this would get rid of the ambiguity of <a href="https://github.com/rust-lang/chalk/issues/234">chalk#234</a>, wouldn't it?</p>



<a name="275010831"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275010831" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275010831">(Mar 11 2022 at 18:04)</a>:</h4>
<p>This is actually a really good question</p>



<a name="275010917"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275010917" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275010917">(Mar 11 2022 at 18:05)</a>:</h4>
<p>So, let's start with Chalk</p>



<a name="275011168"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275011168" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275011168">(Mar 11 2022 at 18:07)</a>:</h4>
<p>First, there are two "forms" of associated types. Either a <a href="https://github.com/rust-lang/chalk/blob/f470f2f493203f58d493c7221863bca2ce1a6dad/chalk-ir/src/lib.rs#L651"><code>AliasTy::Projection</code></a> or as an <a href="https://github.com/rust-lang/chalk/blob/f470f2f493203f58d493c7221863bca2ce1a6dad/chalk-ir/src/lib.rs#L585">associated type placeholder</a></p>



<a name="275011277"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275011277" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275011277">(Mar 11 2022 at 18:08)</a>:</h4>
<p>The former is "unnormalized", whereas the latter is somewhat of a "fallback" when there isn't enough info to normalize</p>



<a name="275011452"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275011452" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275011452">(Mar 11 2022 at 18:09)</a>:</h4>
<p>Somewhat interestingly, we do something like you suggest above when we <em>relate</em> alias types</p>



<a name="275011461"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275011461" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275011461">(Mar 11 2022 at 18:09)</a>:</h4>
<p><a href="https://github.com/rust-lang/chalk/blob/f470f2f493203f58d493c7221863bca2ce1a6dad/chalk-solve/src/infer/unify.rs#L455">https://github.com/rust-lang/chalk/blob/f470f2f493203f58d493c7221863bca2ce1a6dad/chalk-solve/src/infer/unify.rs#L455</a></p>



<a name="275011674"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275011674" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275011674">(Mar 11 2022 at 18:10)</a>:</h4>
<p>I think when I was playing around with <a href="https://github.com/rust-lang/chalk/issues/234">chalk#234</a> a while ago, I <em>did</em> try to essentially do something to this effect, where we sort of "always" treat associated types as "inference variables" of sort</p>



<a name="275011780"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275011780" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275011780">(Mar 11 2022 at 18:11)</a>:</h4>
<p>The issue I ran into, IIRC, was we still want to give some kind of meaningful answer when all we know is <code>&lt;T as Trait&gt;::Assoc</code></p>



<a name="275011863"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275011863" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275011863">(Mar 11 2022 at 18:12)</a>:</h4>
<p>Now, let's switch to rustc for a second.</p>



<a name="275011907"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275011907" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275011907">(Mar 11 2022 at 18:12)</a>:</h4>
<p>Now, rustc <em>doesn't</em> have the associated type placeholder, only the equivalent of <code>AliasTy::Projection</code></p>



<a name="275011984"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275011984" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275011984">(Mar 11 2022 at 18:13)</a>:</h4>
<p>when normalizing it either 1) fully normalizes or 2) Creates a <code>ProjectionEq</code> obligation and returns that inference var</p>



<a name="275012032"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275012032" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275012032">(Mar 11 2022 at 18:13)</a>:</h4>
<p>Well <em>or</em> it just doesn't do anything (this was pretty recent and only in fulfill)</p>



<a name="275012136"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275012136" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275012136">(Mar 11 2022 at 18:14)</a>:</h4>
<p>But, sort of importantly, when relating types, rustc doesn't know what to do with "unnormalized" projections</p>



<a name="275012271"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275012271" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275012271">(Mar 11 2022 at 18:15)</a>:</h4>
<p>Now, it's quite interesting. Because <span class="user-mention" data-user-id="116009">@nikomatsakis</span> and I just had a short chat the other day about this. His revelation was "what if we never actually normalize" - of course a bit more nuanced</p>



<a name="275012410"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275012410" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275012410">(Mar 11 2022 at 18:16)</a>:</h4>
<p>Noting that this is sort of how <span class="user-mention" data-user-id="124288">@oli</span>'s TAIT work does things</p>



<a name="275012454"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275012454" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275012454">(Mar 11 2022 at 18:16)</a>:</h4>
<p>Imo, this <em>is</em> eventually going to be the right path</p>



<a name="275012468"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275012468" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275012468">(Mar 11 2022 at 18:17)</a>:</h4>
<p>But there is a bit of nuance to it</p>



<a name="275012685"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275012685" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275012685">(Mar 11 2022 at 18:18)</a>:</h4>
<p>Once case Niko brought up is</p>
<div class="codehilite"><pre><span></span><code>trait Mirror&lt;&#39;a&gt; { type Me = Self; }
exists&lt;T&gt; { forall&lt;&#39;a&gt; { &lt;i32 as Mirror&lt;&#39;a&gt;&gt;::Me = T } }
</code></pre></div>



<a name="275012919"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275012919" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275012919">(Mar 11 2022 at 18:20)</a>:</h4>
<p>Does that help any? It doesn't necessarily answer your question (mostly because I don't have an answer). But it does give some background.</p>



<a name="275013244"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275013244" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275013244">(Mar 11 2022 at 18:23)</a>:</h4>
<p>I.. don't know, that's a lot to take in <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="275013482"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275013482" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275013482">(Mar 11 2022 at 18:25)</a>:</h4>
<p>so, it could work?</p>



<a name="275013562"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275013562" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275013562">(Mar 11 2022 at 18:25)</a>:</h4>
<p>Maybe :)</p>



<a name="275013678"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275013678" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275013678">(Mar 11 2022 at 18:26)</a>:</h4>
<p>one issue is, in my example above, if rustc asks "what is U" chalk will answer "I don't know", but rustc wants "I know, it's &lt;T as Trait&gt;::Assoc"?</p>



<a name="275013761"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275013761" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275013761">(Mar 11 2022 at 18:27)</a>:</h4>
<p>Correct</p>



<a name="275013817"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275013817" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275013817">(Mar 11 2022 at 18:27)</a>:</h4>
<p>but that's due to how rustc is implemented <em>today</em> isn't it?</p>



<a name="275013909"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275013909" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275013909">(Mar 11 2022 at 18:28)</a>:</h4>
<p>like, if this "lower projection to inference vars" was done much earlier, in rustc instead of chalk, this wouldn't be an issue?</p>



<a name="275013910"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275013910" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275013910">(Mar 11 2022 at 18:28)</a>:</h4>
<p>Mmm, not necessarily</p>



<a name="275013973"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275013973" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275013973">(Mar 11 2022 at 18:28)</a>:</h4>
<p>But maybe</p>



<a name="275014162"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275014162" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275014162">(Mar 11 2022 at 18:30)</a>:</h4>
<p>I guess it depends on what is being solved</p>



<a name="275014515"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275014515" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275014515">(Mar 11 2022 at 18:32)</a>:</h4>
<p>maybe chalk could do the "lower into inference var", then solve, then if it can't infer what U is, check whether it managed to prove <code>ProjectionEq(&lt;T as Trait&gt;::Assoc = U)</code> then "reverse engineer" that back into "I know, U is  &lt;T as Trait&gt;::Assoc"?</p>



<a name="275014539"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275014539" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275014539">(Mar 11 2022 at 18:33)</a>:</h4>
<p>seems like a hack</p>



<a name="275014949"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275014949" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275014949">(Mar 11 2022 at 18:36)</a>:</h4>
<p>like, make placeholder associated types not exist at all during solving. They would only exist after this final step that "nicely packages up" learned knowledge to feed back into rustc...?</p>



<a name="275015204"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275015204" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275015204">(Mar 11 2022 at 18:38)</a>:</h4>
<p>Hmm</p>



<a name="275015355"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275015355" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275015355">(Mar 11 2022 at 18:39)</a>:</h4>
<p>or alternatively, allow chalk to feed back learned obligations into rustc, like it currently does with lifetime constraints. No idea how that'd work though</p>



<a name="275015446"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275015446" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275015446">(Mar 11 2022 at 18:40)</a>:</h4>
<p>well, there won't be any "learned obligations"</p>



<a name="275015526"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275015526" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275015526">(Mar 11 2022 at 18:41)</a>:</h4>
<p>Really, with both, the entrypoint is one obligation with an enviroment</p>



<a name="275015554"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275015554" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275015554">(Mar 11 2022 at 18:41)</a>:</h4>
<p>And the exit is a "yes", "no", or "yes, with these constraints"</p>



<a name="275015615"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275015615" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275015615">(Mar 11 2022 at 18:42)</a>:</h4>
<p>"learned constraint" then?</p>



<a name="275024169"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275024169" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275024169">(Mar 11 2022 at 19:43)</a>:</h4>
<p>Maybe</p>



<a name="275032592"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275032592" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275032592">(Mar 11 2022 at 20:55)</a>:</h4>
<p>so, just to confirm my understanding. Given this program:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">trait</span><span class="w"> </span><span class="n">Trait</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">Assoc</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">struct</span> <span class="nc">Struct</span><span class="p">{}</span><span class="w"></span>
<span class="k">impl</span><span class="w"> </span><span class="n">Trait</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Struct</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">Assoc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">u8</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="275032628"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275032628" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275032628">(Mar 11 2022 at 20:55)</a>:</h4>
<div class="codehilite"><pre><span></span><code>?- exists&lt;T&gt; { T = &lt;Struct as Trait&gt;::Assoc }
Ambiguous; no inference guidance
</code></pre></div>
<p>we want this to return "Unique, T = u8"</p>



<a name="275032751"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275032751" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275032751">(Mar 11 2022 at 20:56)</a>:</h4>
<div class="codehilite"><pre><span></span><code>?- exists&lt;T, U&gt; { T = &lt;U as Trait&gt;::Assoc }
Ambiguous; no inference guidance
</code></pre></div>
<p>we want this to return "Ambig(Definite), T = &lt;U as Trait&gt;::Assoc"</p>



<a name="275032761"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275032761" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275032761">(Mar 11 2022 at 20:56)</a>:</h4>
<p>is that right?</p>



<a name="275033792"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275033792" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275033792">(Mar 11 2022 at 21:07)</a>:</h4>
<p>(edited the 2nd, had mixed up forall vs exists)</p>



<a name="275034045"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275034045" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275034045">(Mar 11 2022 at 21:09)</a>:</h4>
<p>I think so</p>



<a name="275034346"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275034346" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275034346">(Mar 11 2022 at 21:12)</a>:</h4>
<p>so, I completely removed TyKind::AssociatedType. That makes the first work, but the second break</p>



<a name="275035082"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275035082" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275035082">(Mar 11 2022 at 21:19)</a>:</h4>
<p>I want to make the solver return "Unique; T=T, U=U with the constraint <code>AliasEq(&lt;U as Trait&gt;::Assoc = T)</code>"</p>



<a name="275035197"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275035197" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275035197">(Mar 11 2022 at 21:20)</a>:</h4>
<p>And then transform that into "Unique; T=&lt;U as Trait&gt;::Assoc, U=U" as some "post-processing" step</p>



<a name="275035331"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275035331" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275035331">(Mar 11 2022 at 21:21)</a>:</h4>
<p>kinda like the anti-unifier..??</p>



<a name="275035396"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275035396" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275035396">(Mar 11 2022 at 21:22)</a>:</h4>
<p>Hehe</p>



<a name="275035442"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275035442" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275035442">(Mar 11 2022 at 21:22)</a>:</h4>
<p>So for SLG, the delayed subgoals <em>might</em> be a decent way to handle this</p>



<a name="275035636"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275035636" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275035636">(Mar 11 2022 at 21:24)</a>:</h4>
<p>is there already some way to tell the solver "you can give me back these goals as constraints if you need to"?</p>



<a name="275035812"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275035812" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275035812">(Mar 11 2022 at 21:26)</a>:</h4>
<p>no</p>



<a name="275035827"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275035827" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275035827">(Mar 11 2022 at 21:26)</a>:</h4>
<p>only lifetime constraints</p>



<a name="275035862"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275035862" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275035862">(Mar 11 2022 at 21:26)</a>:</h4>
<p>But SLG does have these "delayed subgoals"</p>



<a name="275035885"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275035885" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275035885">(Mar 11 2022 at 21:26)</a>:</h4>
<p>hmm I'll read to see how the lifetime constraints are handled<br>
these feel very similar to what we want here</p>



<a name="275035891"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275035891" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275035891">(Mar 11 2022 at 21:26)</a>:</h4>
<p>But I don't really think they would work</p>



<a name="275035893"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275035893" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275035893">(Mar 11 2022 at 21:26)</a>:</h4>
<p>But they might</p>



<a name="275035949"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/144729-wg-traits/topic/Why%20are%20placeholder%20associated%20types%20needed%3F/near/275035949" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/144729-wg-traits/topic/Why.20are.20placeholder.20associated.20types.20needed.3F.html#275035949">(Mar 11 2022 at 21:27)</a>:</h4>
<p>I think more likely, we need a way to be able to "bind" an inference variable to multiple types</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>