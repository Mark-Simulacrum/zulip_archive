<html>
<head><meta charset="utf-8"><title>blog post — custom lints · t-lang/roadmap-2024 · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/318377-t-lang/roadmap-2024/index.html">t-lang/roadmap-2024</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/318377-t-lang/roadmap-2024/topic/blog.20post.20.E2.80.94.20custom.20lints.html">blog post — custom lints</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="277823197"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/318377-t-lang/roadmap-2024/topic/blog%20post%20%E2%80%94%20custom%20lints/near/277823197" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/318377-t-lang/roadmap-2024/topic/blog.20post.20.E2.80.94.20custom.20lints.html#277823197">(Apr 05 2022 at 03:22)</a>:</h4>
<p>While it's under "looking forward", I think it's worth mentioning that there was some movement (albeit quite small) on library-provided lints: <a href="https://github.com/rust-linting/design">https://github.com/rust-linting/design</a> decided some of the larger points for the design of custom lints, including a plausible path towards MVP and future possibilities.</p>
<p>Unfortunately no one really had time to drive the effort, so it stalled out. There is still interest in it among the org members, however. I know I would love to do some work here!</p>



<a name="277912911"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/318377-t-lang/roadmap-2024/topic/blog%20post%20%E2%80%94%20custom%20lints/near/277912911" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alice Cecile <a href="https://zulip-archive.rust-lang.org/stream/318377-t-lang/roadmap-2024/topic/blog.20post.20.E2.80.94.20custom.20lints.html#277912911">(Apr 05 2022 at 17:15)</a>:</h4>
<p>Hi! The Bevy team is interested in this, and we can likely find someone to own a design here :)</p>



<a name="277938406"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/318377-t-lang/roadmap-2024/topic/blog%20post%20%E2%80%94%20custom%20lints/near/277938406" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manish Goregaokar <a href="https://zulip-archive.rust-lang.org/stream/318377-t-lang/roadmap-2024/topic/blog.20post.20.E2.80.94.20custom.20lints.html#277938406">(Apr 05 2022 at 20:22)</a>:</h4>
<p>Also, the Clippy team was experimenting with a coccinelle-like custom lints API in <a href="https://github.com/rust-lang/rust-clippy/pull/3875">https://github.com/rust-lang/rust-clippy/pull/3875</a> . It's a solid design, and I think there's a stalled implementation PR out there. There's also a masters thesis on it <a href="https://fkohlgrueber.github.io/thesis.pdf">https://fkohlgrueber.github.io/thesis.pdf</a></p>
<p>I'd _highly_ recommend folks try to build something off of this design.</p>
<p>The basic idea is that lints are written as patterns that _look like rust code_, so you can kinda say "if the code matches <code>&lt;code&gt;</code> then do ..." where <code>&lt;code&gt;</code> is a bit of Rust code with placeholders.</p>
<p>If paired with a good suite of utility functions for dealing with the typesystem, this can be super powerful whilst minimally constraining the internals of rustc (or any future compiler) on implementation.</p>
<p>Happy to talk about this more; and also, happy to have this prototyped in clippy if folks need. Our utils/ module can probably inform y'all on what APIs outside of syntax tree matching are useful.</p>
<p>Our goal was to eventually move over to this model for the bulk of our lints, reducing rust update churn</p>



<a name="277938621"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/318377-t-lang/roadmap-2024/topic/blog%20post%20%E2%80%94%20custom%20lints/near/277938621" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alice Cecile <a href="https://zulip-archive.rust-lang.org/stream/318377-t-lang/roadmap-2024/topic/blog.20post.20.E2.80.94.20custom.20lints.html#277938621">(Apr 05 2022 at 20:25)</a>:</h4>
<p>I really love that idea: the closer we can get to "ordinary Rust syntax" the more accessible this will be.</p>
<p>Prototyping in Clippy first seems like an excellent idea.</p>



<a name="277950460"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/318377-t-lang/roadmap-2024/topic/blog%20post%20%E2%80%94%20custom%20lints/near/277950460" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/318377-t-lang/roadmap-2024/topic/blog.20post.20.E2.80.94.20custom.20lints.html#277950460">(Apr 05 2022 at 22:12)</a>:</h4>
<p>Fwiw we were aware of that RFC during the discussions. If I remember correctly we agreed it wasn't necessary for the minimum viable product, as the primary challenge would be creating a stable API to work with. That would be necessary even with that RFC.</p>



<a name="277950471"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/318377-t-lang/roadmap-2024/topic/blog%20post%20%E2%80%94%20custom%20lints/near/277950471" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/318377-t-lang/roadmap-2024/topic/blog.20post.20.E2.80.94.20custom.20lints.html#277950471">(Apr 05 2022 at 22:13)</a>:</h4>
<p>I haven't seen the thesis, though.</p>



<a name="277975343"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/318377-t-lang/roadmap-2024/topic/blog%20post%20%E2%80%94%20custom%20lints/near/277975343" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/318377-t-lang/roadmap-2024/topic/blog.20post.20.E2.80.94.20custom.20lints.html#277975343">(Apr 06 2022 at 04:48)</a>:</h4>
<p>I would be interested in seeing something writable in terms of type-based matches / Rust-based patterns. I'm a big fan of smatch and coccinelle, and would love to have that capability for Rust built in.</p>



<a name="277975359"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/318377-t-lang/roadmap-2024/topic/blog%20post%20%E2%80%94%20custom%20lints/near/277975359" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/318377-t-lang/roadmap-2024/topic/blog.20post.20.E2.80.94.20custom.20lints.html#277975359">(Apr 06 2022 at 04:49)</a>:</h4>
<p>I definitely don't want to make the perfect the enemy of the good, though, and I'm fine with semantically having matches on Rust code but having to write that out in a more longhand manner at first.</p>



<a name="278364251"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/318377-t-lang/roadmap-2024/topic/blog%20post%20%E2%80%94%20custom%20lints/near/278364251" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/318377-t-lang/roadmap-2024/topic/blog.20post.20.E2.80.94.20custom.20lints.html#278364251">(Apr 08 2022 at 21:24)</a>:</h4>
<p>Super cool -- I've also been thinking about this as I work more on a-mir-formality. One thought I had was to go through the compiler's own lints and suggestions and try to "dogfood" them -- I think it should be possible to pattern match and describe patterns quite effectively. I'll check out <a href="https://github.com/rust-lang/rust-clippy/pull/3875">https://github.com/rust-lang/rust-clippy/pull/3875</a>, <span class="user-mention" data-user-id="132040">@Manish Goregaokar</span>, since it sounds like it's going in a similar direction.</p>



<a name="278364561"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/318377-t-lang/roadmap-2024/topic/blog%20post%20%E2%80%94%20custom%20lints/near/278364561" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manish Goregaokar <a href="https://zulip-archive.rust-lang.org/stream/318377-t-lang/roadmap-2024/topic/blog.20post.20.E2.80.94.20custom.20lints.html#278364561">(Apr 08 2022 at 21:28)</a>:</h4>
<p><span class="user-mention silent" data-user-id="245610">Jacob Pratt</span> <a href="#narrow/stream/318377-t-lang.2Froadmap-2024/topic/blog.20post.20.E2.80.94.20custom.20lints/near/277950460">said</a>:</p>
<blockquote>
<p>Fwiw we were aware of that RFC during the discussions. If I remember correctly we agreed it wasn't necessary for the minimum viable product, as the primary challenge would be creating a stable API to work with. That would be necessary even with that RFC.</p>
</blockquote>
<p>uh, one of the major benefits of that RFC is that it reduces the necessity of an actually stable API for dealing with the AST: you just need a (much narrower) stable API of various utils for checking type stuff, and AST matching is done entirely by macro</p>



<a name="278364635"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/318377-t-lang/roadmap-2024/topic/blog%20post%20%E2%80%94%20custom%20lints/near/278364635" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manish Goregaokar <a href="https://zulip-archive.rust-lang.org/stream/318377-t-lang/roadmap-2024/topic/blog.20post.20.E2.80.94.20custom.20lints.html#278364635">(Apr 08 2022 at 21:29)</a>:</h4>
<p>as someone who has thought way too much about AST stability in the context of clippy; I feel pretty confident in saying that this would likely be an _easier_ approach here</p>



<a name="278385124"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/318377-t-lang/roadmap-2024/topic/blog%20post%20%E2%80%94%20custom%20lints/near/278385124" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/318377-t-lang/roadmap-2024/topic/blog.20post.20.E2.80.94.20custom.20lints.html#278385124">(Apr 09 2022 at 03:34)</a>:</h4>
<p>Hmm, that could be true. It's been a while since the discussions (last August I believe). Our intent was to base it off of syn, as its structure has remained largely unchanged (the missing support can be fixed).</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>