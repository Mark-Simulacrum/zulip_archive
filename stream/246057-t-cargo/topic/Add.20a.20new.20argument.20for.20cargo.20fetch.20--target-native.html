<html>
<head><meta charset="utf-8"><title>Add a new argument for cargo fetch --target-native · t-cargo · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/index.html">t-cargo</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Add.20a.20new.20argument.20for.20cargo.20fetch.20--target-native.html">Add a new argument for cargo fetch --target-native</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="278175208"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Add%20a%20new%20argument%20for%20cargo%20fetch%20--target-native/near/278175208" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Letu Ren <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Add.20a.20new.20argument.20for.20cargo.20fetch.20--target-native.html#278175208">(Apr 07 2022 at 14:50)</a>:</h4>
<p>If I need to use cargo to fetch dependencies of a package which only target the native architecture, I have to manually determine the architecture of the machine for example writing a bash script. If this build script is a general purpose one which aims to fetch dependencies only targeting the native architecture and build off-line then, this scripts will become quite complicated and not portable. So, I wonder whether it is possible for a new argument for cargo fetch because the native architecture is known by cargo.</p>
<p>A real-world example is package script used by Arch Linux, if we have to determine the architecture in every script, it will definitely be a nightmare.</p>



<a name="278180725"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Add%20a%20new%20argument%20for%20cargo%20fetch%20--target-native/near/278180725" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Add.20a.20new.20argument.20for.20cargo.20fetch.20--target-native.html#278180725">(Apr 07 2022 at 15:24)</a>:</h4>
<p><span class="user-mention" data-user-id="492715">@Letu Ren</span> don't know if it helps, but <code>rustc -vV | grep host</code> is pretty reliable at determining the target</p>



<a name="278181170"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Add%20a%20new%20argument%20for%20cargo%20fetch%20--target-native/near/278181170" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Add.20a.20new.20argument.20for.20cargo.20fetch.20--target-native.html#278181170">(Apr 07 2022 at 15:27)</a>:</h4>
<p>for build scripts specifically you also have <code>TARGET</code> available in the environment variables <a href="https://doc.rust-lang.org/cargo/reference/environment-variables.html#environment-variables-cargo-sets-for-build-scripts">https://doc.rust-lang.org/cargo/reference/environment-variables.html#environment-variables-cargo-sets-for-build-scripts</a></p>



<a name="278181994"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Add%20a%20new%20argument%20for%20cargo%20fetch%20--target-native/near/278181994" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Add.20a.20new.20argument.20for.20cargo.20fetch.20--target-native.html#278181994">(Apr 07 2022 at 15:33)</a>:</h4>
<p>You can use <code>rustc -vV | grep host</code> to determine the host architecture. This is also what cargo does.</p>



<a name="278187833"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Add%20a%20new%20argument%20for%20cargo%20fetch%20--target-native/near/278187833" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Letu Ren <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Add.20a.20new.20argument.20for.20cargo.20fetch.20--target-native.html#278187833">(Apr 07 2022 at 16:07)</a>:</h4>
<p>Thanks for reply</p>



<a name="278240479"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Add%20a%20new%20argument%20for%20cargo%20fetch%20--target-native/near/278240479" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jon Gjengset <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Add.20a.20new.20argument.20for.20cargo.20fetch.20--target-native.html#278240479">(Apr 07 2022 at 23:42)</a>:</h4>
<p>I'll add that this has also been requested for <code>cargo metadata --filter-platform</code> (it'd be useful in &lt;<a href="https://github.com/rust-analyzer/rust-analyzer/issues/6908">https://github.com/rust-analyzer/rust-analyzer/issues/6908</a>&gt; for example).</p>



<a name="278257483"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Add%20a%20new%20argument%20for%20cargo%20fetch%20--target-native/near/278257483" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Letu Ren <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Add.20a.20new.20argument.20for.20cargo.20fetch.20--target-native.html#278257483">(Apr 08 2022 at 05:01)</a>:</h4>
<p><span class="user-mention" data-user-id="120054">@Jon Gjengset</span>  Looks like we demand the same thing. Cargo fetch is just like cargo metadata which counter-intuitively defaults to including all targets. That's a bad thing. Add an option will make life of downstream a lot easier.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>