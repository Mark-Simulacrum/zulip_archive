<html>
<head><meta charset="utf-8"><title>removed-versions · t-cargo · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/index.html">t-cargo</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/removed-versions.html">removed-versions</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="260831244"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/removed-versions/near/260831244" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jon Gjengset <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/removed-versions.html#260831244">(Nov 09 2021 at 17:36)</a>:</h4>
<p>I'm digging into what happens with Cargo if a crate version disappears from a registry (not yanked, actually _removed_, like say due to a DMCA or "Right to be Forgotten" request). I did a very brief experiment where I added a dependency on <code>autocfg = "1"</code> to a fresh <code>Cargo.toml</code>, ran <code>cargo check</code>, then manually edited <code>Cargo.lock</code> to change the version number for the <code>autocfg</code> entry to <code>1.0.100</code>, and then re-ran <code>cargo check</code>. To  my slight surprise, I got the error:</p>
<div class="codehilite"><pre><span></span><code>error: failed to select a version for the requirement `autocfg = &quot;=1.0.100&quot;`
candidate versions found which didn&#39;t match: 1.0.1, 1.0.0, 0.1.7, ...
location searched: crates.io index
</code></pre></div>
<p>Given that I didn't pass <code>--locked</code>, I would have expected Cargo to accept 1.0.1 given that it matches the version specifier of <code>= "1"</code> just fine, maybe with a warning, but this is a hard error. Is this expected behavior?</p>



<a name="260832662"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/removed-versions/near/260832662" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/removed-versions.html#260832662">(Nov 09 2021 at 17:44)</a>:</h4>
<p>Now that you say it, I'm not at all surprised.</p>



<a name="260832748"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/removed-versions/near/260832748" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/removed-versions.html#260832748">(Nov 09 2021 at 17:45)</a>:</h4>
<p>but i think a warning and an upgrade would be a more consistent behavior.</p>



<a name="260833259"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/removed-versions/near/260833259" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jon Gjengset <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/removed-versions.html#260833259">(Nov 09 2021 at 17:48)</a>:</h4>
<p>Do note that in this case it would be a _downgrade_ compared to the version from <code>Cargo.lock</code>, but yeah, I agree.</p>



<a name="260833554"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/removed-versions/near/260833554" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/removed-versions.html#260833554">(Nov 09 2021 at 17:50)</a>:</h4>
<p>i suspect that fixing this properly will require a fairly major rewrite of how lock files are interpreted. :-(</p>



<a name="260833581"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/removed-versions/near/260833581" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/removed-versions.html#260833581">(Nov 09 2021 at 17:50)</a>:</h4>
<p>would love to be proven wrong.</p>



<a name="260834140"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/removed-versions/near/260834140" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jon Gjengset <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/removed-versions.html#260834140">(Nov 09 2021 at 17:54)</a>:</h4>
<p>Want me to file an issue for tracking this?</p>



<a name="260834381"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/removed-versions/near/260834381" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/removed-versions.html#260834381">(Nov 09 2021 at 17:55)</a>:</h4>
<p>Go for it!</p>



<a name="260834523"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/removed-versions/near/260834523" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jon Gjengset <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/removed-versions.html#260834523">(Nov 09 2021 at 17:56)</a>:</h4>
<p>I'm specifically worried about this hitting Cargo "out of the blue". Imagine, if you will, if say <code>serde 1.0.130</code> _had_ to get completely pulled from the index. Like, lawsuits, government request, what have you, all insisting it happen _yesterday_.</p>



<a name="260834605"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/removed-versions/near/260834605" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jon Gjengset <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/removed-versions.html#260834605">(Nov 09 2021 at 17:57)</a>:</h4>
<p>Imagine the number of Rust users hitting this error <span aria-label="grimacing" class="emoji emoji-1f62c" role="img" title="grimacing">:grimacing:</span> <br>
Admittedly the fix is simple, but it's still manual.</p>



<a name="260834654"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/removed-versions/near/260834654" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/removed-versions.html#260834654">(Nov 09 2021 at 17:57)</a>:</h4>
<p>Ture.</p>



<a name="260834677"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/removed-versions/near/260834677" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/removed-versions.html#260834677">(Nov 09 2021 at 17:57)</a>:</h4>
<p>I honestly think it'd be appropriate to <em>error</em> (not warning) and require <code>cargo upgrade</code> to make this work.</p>



<a name="260834765"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/removed-versions/near/260834765" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/removed-versions.html#260834765">(Nov 09 2021 at 17:58)</a>:</h4>
<p>It's such a rare situation, and people normally expect that if you have a specific version in your lockfile <em>you get that version</em>.</p>



<a name="260834839"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/removed-versions/near/260834839" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jon Gjengset <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/removed-versions.html#260834839">(Nov 09 2021 at 17:58)</a>:</h4>
<p>Do they? Even without <code>--locked</code>? Then why is <code>--locked</code> even necessary?</p>



<a name="260834843"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/removed-versions/near/260834843" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/removed-versions.html#260834843">(Nov 09 2021 at 17:58)</a>:</h4>
<p>I don't think we should automatically say "oh, I guess that vanished off the face of the earth, I'll try another".</p>



<a name="260834888"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/removed-versions/near/260834888" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/removed-versions.html#260834888">(Nov 09 2021 at 17:58)</a>:</h4>
<p><span class="user-mention silent" data-user-id="120054">Jon Gjengset</span> <a href="#narrow/stream/246057-t-cargo/topic/removed-versions/near/260834839">said</a>:</p>
<blockquote>
<p>Do they? Even without <code>--locked</code>? Then why is <code>--locked</code> even necessary?</p>
</blockquote>
<p>Because Cargo <em>will</em> automatically update the lockfile under other circumstances, such as the .toml file changing.</p>



<a name="260834925"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/removed-versions/near/260834925" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jon Gjengset <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/removed-versions.html#260834925">(Nov 09 2021 at 17:59)</a>:</h4>
<p>(heading off for a meeting — will be back later)</p>



<a name="260839920"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/removed-versions/near/260839920" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jon Gjengset <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/removed-versions.html#260839920">(Nov 09 2021 at 18:32)</a>:</h4>
<p>It does look like <code>cargo update</code> resolves this particular problem, I'm just wondering whether the right call is to require a <code>cargo update</code> under these circumstances. I forget — do we require <code>cargo update</code> if a version is yanked?</p>



<a name="260840080"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/removed-versions/near/260840080" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/removed-versions.html#260840080">(Nov 09 2021 at 18:34)</a>:</h4>
<p>No, it just continues to use the yanked vertion.</p>



<a name="260840518"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/removed-versions/near/260840518" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jon Gjengset <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/removed-versions.html#260840518">(Nov 09 2021 at 18:36)</a>:</h4>
<p>Huh, fascinating. I suppose then requiring <code>cargo update</code> might be valuable, and it'll more be a matter of making the error better (and indicate that <code>cargo update</code> may be the solution).</p>



<a name="260840783"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/removed-versions/near/260840783" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/removed-versions.html#260840783">(Nov 09 2021 at 18:38)</a>:</h4>
<p>Especially if eventually we put a tombstone in place of the version that provides an explanation.</p>



<a name="260840791"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/removed-versions/near/260840791" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/removed-versions.html#260840791">(Nov 09 2021 at 18:38)</a>:</h4>
<p>The error could show that explanation.</p>



<a name="260843403"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/removed-versions/near/260843403" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jon Gjengset <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/removed-versions.html#260843403">(Nov 09 2021 at 18:55)</a>:</h4>
<p><a href="https://github.com/rust-lang/cargo/issues/10063">https://github.com/rust-lang/cargo/issues/10063</a></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>