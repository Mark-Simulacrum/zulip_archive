<html>
<head><meta charset="utf-8"><title>Bug when trying to find a edition 2021 git dep · t-cargo · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/index.html">t-cargo</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Bug.20when.20trying.20to.20find.20a.20edition.202021.20git.20dep.html">Bug when trying to find a edition 2021 git dep</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="262609533"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Bug%20when%20trying%20to%20find%20a%20edition%202021%20git%20dep/near/262609533" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> flip1995 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Bug.20when.20trying.20to.20find.20a.20edition.202021.20git.20dep.html#262609533">(Nov 24 2021 at 16:20)</a>:</h4>
<p>When trying to add a git dependency that is a edition 2021 crate to a edition 2018 crate, you get this error message:</p>
<div class="codehilite"><pre><span></span><code>cargo update -p clippy_lints
    Updating git repository `https://github.com/rust-lang/rust-clippy`
    Updating crates.io index
    Updating git repository `https://github.com/rust-lang/rust-clippy`
error: no matching package named `clippy_lints` found
location searched: https://github.com/rust-lang/rust-clippy?rev=0c8799da5aabf72aee26053075d2bd73ef9f7789
required by package `rls v1.41.0 (/home/pkrones/rust-lang/rls)`
</code></pre></div>
<p><code>0c8799da5aabf72aee26053075d2bd73ef9f7789</code> is the commit the edition of <code>clippy_lints</code> was bumped to 2021. The commit before that works. </p>
<p>I was under the impression, that you should be able to use 2021 dependencies even when your crate uses edition 2018. If I'm mistaken here, then the error message should be improved. I can also open an issue about this, but first wanted to ask here, what this is about.</p>
<p>I found this while trying to update the <code>clippy_lints</code> version in RLS to get our Clippy sync through (<a href="https://github.com/rust-lang/rust/issues/91154">#91154</a>).</p>



<a name="262609942"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Bug%20when%20trying%20to%20find%20a%20edition%202021%20git%20dep/near/262609942" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Bug.20when.20trying.20to.20find.20a.20edition.202021.20git.20dep.html#262609942">(Nov 24 2021 at 16:23)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/commit/0c8799da5aabf72aee26053075d2bd73ef9f7789">https://github.com/rust-lang/rust/commit/0c8799da5aabf72aee26053075d2bd73ef9f7789</a> literally only bumped to 2021.<br>
I don't know why this is not working, but it should work.</p>



<a name="262610065"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Bug%20when%20trying%20to%20find%20a%20edition%202021%20git%20dep/near/262610065" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Bug.20when.20trying.20to.20find.20a.20edition.202021.20git.20dep.html#262610065">(Nov 24 2021 at 16:24)</a>:</h4>
<p>Minimizing the example would be extremely helpful.</p>



<a name="262610099"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Bug%20when%20trying%20to%20find%20a%20edition%202021%20git%20dep/near/262610099" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Bug.20when.20trying.20to.20find.20a.20edition.202021.20git.20dep.html#262610099">(Nov 24 2021 at 16:24)</a>:</h4>
<p>But yes, file a bug!</p>



<a name="262614583"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Bug%20when%20trying%20to%20find%20a%20edition%202021%20git%20dep/near/262614583" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Bug.20when.20trying.20to.20find.20a.20edition.202021.20git.20dep.html#262614583">(Nov 24 2021 at 16:56)</a>:</h4>
<p><span class="user-mention" data-user-id="264664">@flip1995</span> Can you say more about exactly which steps you used?  I'm able to update <code>clippy_lints</code> in the RLS repo.  Did you update both the root and <code>rls-rustc</code>?</p>



<a name="262614876"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Bug%20when%20trying%20to%20find%20a%20edition%202021%20git%20dep/near/262614876" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> flip1995 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Bug.20when.20trying.20to.20find.20a.20edition.202021.20git.20dep.html#262614876">(Nov 24 2021 at 16:58)</a>:</h4>
<p>I just noticed that this only happens when you use an old cargo version: 1.54.0 or 1.55.0 and earlier. I can update it with <code>cargo +stable update -p clippy_lints</code></p>



<a name="262614919"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Bug%20when%20trying%20to%20find%20a%20edition%202021%20git%20dep/near/262614919" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> flip1995 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Bug.20when.20trying.20to.20find.20a.20edition.202021.20git.20dep.html#262614919">(Nov 24 2021 at 16:59)</a>:</h4>
<p>So not sure if there's anything cargo can do here.</p>



<a name="262614982"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Bug%20when%20trying%20to%20find%20a%20edition%202021%20git%20dep/near/262614982" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> flip1995 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Bug.20when.20trying.20to.20find.20a.20edition.202021.20git.20dep.html#262614982">(Nov 24 2021 at 16:59)</a>:</h4>
<p>I guess this is because older cargo versions don't know what <code>edition 2021</code> crates are? <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="262616337"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Bug%20when%20trying%20to%20find%20a%20edition%202021%20git%20dep/near/262616337" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Bug.20when.20trying.20to.20find.20a.20edition.202021.20git.20dep.html#262616337">(Nov 24 2021 at 17:09)</a>:</h4>
<p>Oh, yea.  When cargo scans a git repo, it ignores <code>Cargo.toml</code> files that it can't parse. Older versions can't handle 2021 edition.  I think we can do better with the error message.</p>
<p>I believe this exact same issue is tracked in <a href="https://github.com/rust-lang/cargo/issues/6211">https://github.com/rust-lang/cargo/issues/6211</a></p>



<a name="262616503"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Bug%20when%20trying%20to%20find%20a%20edition%202021%20git%20dep/near/262616503" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> flip1995 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Bug.20when.20trying.20to.20find.20a.20edition.202021.20git.20dep.html#262616503">(Nov 24 2021 at 17:10)</a>:</h4>
<p>So this happens with nightly-2021-09-01 and earlier, but not from 2021-09-02 and onwards. This issue looks like it's the same cause</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>