<html>
<head><meta charset="utf-8"><title>What&#x27;s the background in the timing graph? · t-cargo · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/index.html">t-cargo</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/What&#x27;s.20the.20background.20in.20the.20timing.20graph.3F.html">What&#x27;s the background in the timing graph?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="261300227"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/What%27s%20the%20background%20in%20the%20timing%20graph%3F/near/261300227" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/What&#x27;s.20the.20background.20in.20the.20timing.20graph.3F.html#261300227">(Nov 12 2021 at 19:34)</a>:</h4>
<p><a href="/user_uploads/4715/AuwWTafM3oMX1DVChN1OBOKx/image.png">image.png</a> </p>
<div class="message_inline_image"><a href="/user_uploads/4715/AuwWTafM3oMX1DVChN1OBOKx/image.png" title="image.png"><img src="/user_uploads/4715/AuwWTafM3oMX1DVChN1OBOKx/image.png"></a></div><blockquote>
<p>The second graph shows Cargo's concurrency over time. The three lines are:</p>
<ul>
<li>"Waiting" (red) — This is the number of units waiting for a CPU slot to open.</li>
<li>"Inactive" (blue) — This is the number of units that are waiting for their dependencies to finish.</li>
<li>"Active" (green) — This is the number of units currently running.</li>
</ul>
</blockquote>
<p>What does the background filled area indicate?</p>



<a name="261300372"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/What%27s%20the%20background%20in%20the%20timing%20graph%3F/near/261300372" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/What&#x27;s.20the.20background.20in.20the.20timing.20graph.3F.html#261300372">(Nov 12 2021 at 19:35)</a>:</h4>
<p>I believe it's CPU usage.</p>



<a name="261300998"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/What%27s%20the%20background%20in%20the%20timing%20graph%3F/near/261300998" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/What&#x27;s.20the.20background.20in.20the.20timing.20graph.3F.html#261300998">(Nov 12 2021 at 19:40)</a>:</h4>
<p>Makes me sadder about the complete graph then</p>
<p><a href="/user_uploads/4715/t3Gak4AwGv85JK0Q43EC4Bzm/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/t3Gak4AwGv85JK0Q43EC4Bzm/image.png" title="image.png"><img src="/user_uploads/4715/t3Gak4AwGv85JK0Q43EC4Bzm/image.png"></a></div>



<a name="261301279"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/What%27s%20the%20background%20in%20the%20timing%20graph%3F/near/261301279" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/What&#x27;s.20the.20background.20in.20the.20timing.20graph.3F.html#261301279">(Nov 12 2021 at 19:42)</a>:</h4>
<p>look on the bright side, it just means there's lots of room to make rustc faster. <span aria-label="stuck out tongue wink" class="emoji emoji-1f61c" role="img" title="stuck out tongue wink">:stuck_out_tongue_wink:</span></p>



<a name="261301479"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/What%27s%20the%20background%20in%20the%20timing%20graph%3F/near/261301479" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/What&#x27;s.20the.20background.20in.20the.20timing.20graph.3F.html#261301479">(Nov 12 2021 at 19:44)</a>:</h4>
<p>I'm not actually sure if that's even compiling Rust code, TBH. This project has a number of C dependencies. My finger-crossed idea is that those dependencies are doing single-threaded builds. My multiple-finger-crossed idea is that I can "just" add <code>-j ...</code> to the -sys crates that build them.</p>



<a name="261302097"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/What%27s%20the%20background%20in%20the%20timing%20graph%3F/near/261302097" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/What&#x27;s.20the.20background.20in.20the.20timing.20graph.3F.html#261302097">(Nov 12 2021 at 19:49)</a>:</h4>
<p>The other information on that page should be able to tell you which crates are slow, and where they appear in the timeline. What it one of your C deps in 40-49?</p>



<a name="261302632"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/What%27s%20the%20background%20in%20the%20timing%20graph%3F/near/261302632" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/What&#x27;s.20the.20background.20in.20the.20timing.20graph.3F.html#261302632">(Nov 12 2021 at 19:53)</a>:</h4>
<p>So many slow crates, sadly. Each point is one crate, height corresponds to compilation time:</p>
<p><a href="/user_uploads/4715/76P9hR0Q1qX6C6CjAFpvXrds/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/76P9hR0Q1qX6C6CjAFpvXrds/image.png" title="image.png"><img src="/user_uploads/4715/76P9hR0Q1qX6C6CjAFpvXrds/image.png"></a></div>



<a name="261302829"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/What%27s%20the%20background%20in%20the%20timing%20graph%3F/near/261302829" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/What&#x27;s.20the.20background.20in.20the.20timing.20graph.3F.html#261302829">(Nov 12 2021 at 19:54)</a>:</h4>
<p>During that specific window (40-49) there is the <code>zstd-sys</code> build script running.</p>



<a name="261302912"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/What%27s%20the%20background%20in%20the%20timing%20graph%3F/near/261302912" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/What&#x27;s.20the.20background.20in.20the.20timing.20graph.3F.html#261302912">(Nov 12 2021 at 19:55)</a>:</h4>
<p>Compiling <em>just</em> that crate:</p>
<p><a href="/user_uploads/4715/YFjVKNa6MrpfJU1awg9-ZD2N/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/YFjVKNa6MrpfJU1awg9-ZD2N/image.png" title="image.png"><img src="/user_uploads/4715/YFjVKNa6MrpfJU1awg9-ZD2N/image.png"></a></div>



<a name="261303049"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/What%27s%20the%20background%20in%20the%20timing%20graph%3F/near/261303049" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/What&#x27;s.20the.20background.20in.20the.20timing.20graph.3F.html#261303049">(Nov 12 2021 at 19:56)</a>:</h4>
<p>And it uses the <code>parallel</code> feature from <code>cc</code>, so my guess is that that's linking time of the C library.</p>



<a name="261303169"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/What%27s%20the%20background%20in%20the%20timing%20graph%3F/near/261303169" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/What&#x27;s.20the.20background.20in.20the.20timing.20graph.3F.html#261303169">(Nov 12 2021 at 19:57)</a>:</h4>
<p>While I knew linking tends to be slow, this is the first time I'm realizing that we don't always just link once at the end of the build. When we build C dependencies into intermediate libraries, that has linking involved too.</p>



<a name="261303584"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/What%27s%20the%20background%20in%20the%20timing%20graph%3F/near/261303584" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/What&#x27;s.20the.20background.20in.20the.20timing.20graph.3F.html#261303584">(Nov 12 2021 at 20:00)</a>:</h4>
<p>zstd is statically linked, right? In that case only rustc should invoke the linker. Building libzstd should only produce an archive (<code>.a</code>), which is fast. Maybe one of the source files is big?</p>



<a name="261303717"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/What%27s%20the%20background%20in%20the%20timing%20graph%3F/near/261303717" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/What&#x27;s.20the.20background.20in.20the.20timing.20graph.3F.html#261303717">(Nov 12 2021 at 20:01)</a>:</h4>
<p>Wait a second. <a href="#narrow/stream/246057-t-cargo/topic/What's.20the.20background.20in.20the.20timing.20graph.3F/near/261302912">this graph</a> has a legend for the graph. Why didn't my <a href="#narrow/stream/246057-t-cargo/topic/What's.20the.20background.20in.20the.20timing.20graph.3F/near/261300998">first one</a>?</p>



<a name="261304418"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/What%27s%20the%20background%20in%20the%20timing%20graph%3F/near/261304418" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/What&#x27;s.20the.20background.20in.20the.20timing.20graph.3F.html#261304418">(Nov 12 2021 at 20:07)</a>:</h4>
<p><span class="user-mention silent" data-user-id="133247">bjorn3</span> <a href="#narrow/stream/246057-t-cargo/topic/What's.20the.20background.20in.20the.20timing.20graph.3F/near/261303584">said</a>:</p>
<blockquote>
<p>Building libzstd should only produce an archive (<code>.a</code>), which is fast. Maybe one of the source files is big?</p>
</blockquote>
<p>Ah, good point. Archival does go pretty quick. What appears to be the last file it builds creates a 4MB .o file.</p>



<a name="261304424"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/What%27s%20the%20background%20in%20the%20timing%20graph%3F/near/261304424" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/What&#x27;s.20the.20background.20in.20the.20timing.20graph.3F.html#261304424">(Nov 12 2021 at 20:07)</a>:</h4>
<p>Hm, that is strange.  The spacing also looks a little off, and the graph doesn't look like it finishes.</p>



<a name="261304449"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/What%27s%20the%20background%20in%20the%20timing%20graph%3F/near/261304449" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/What&#x27;s.20the.20background.20in.20the.20timing.20graph.3F.html#261304449">(Nov 12 2021 at 20:07)</a>:</h4>
<p>Perhaps you can share the html file?</p>



<a name="261304462"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/What%27s%20the%20background%20in%20the%20timing%20graph%3F/near/261304462" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/What&#x27;s.20the.20background.20in.20the.20timing.20graph.3F.html#261304462">(Nov 12 2021 at 20:07)</a>:</h4>
<p>No, no.</p>



<a name="261304468"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/What%27s%20the%20background%20in%20the%20timing%20graph%3F/near/261304468" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/What&#x27;s.20the.20background.20in.20the.20timing.20graph.3F.html#261304468">(Nov 12 2021 at 20:07)</a>:</h4>
<p>I'm just dumb</p>



<a name="261304528"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/What%27s%20the%20background%20in%20the%20timing%20graph%3F/near/261304528" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/What&#x27;s.20the.20background.20in.20the.20timing.20graph.3F.html#261304528">(Nov 12 2021 at 20:08)</a>:</h4>
<p>And missed the scrollbar <span aria-label="face palm" class="emoji emoji-1f926" role="img" title="face palm">:face_palm:</span></p>



<a name="261304621"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/What%27s%20the%20background%20in%20the%20timing%20graph%3F/near/261304621" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/What&#x27;s.20the.20background.20in.20the.20timing.20graph.3F.html#261304621">(Nov 12 2021 at 20:09)</a>:</h4>
<p>For posterity: </p>
<p><a href="/user_uploads/4715/-j1KLPFaCYV3AkSjKGgB3HoH/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/-j1KLPFaCYV3AkSjKGgB3HoH/image.png" title="image.png"><img src="/user_uploads/4715/-j1KLPFaCYV3AkSjKGgB3HoH/image.png"></a></div>



<a name="261304731"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/What%27s%20the%20background%20in%20the%20timing%20graph%3F/near/261304731" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/What&#x27;s.20the.20background.20in.20the.20timing.20graph.3F.html#261304731">(Nov 12 2021 at 20:10)</a>:</h4>
<p>Starting at about 62s is when it starts crunching on the final binary (which takes 40 seconds on its own)</p>



<a name="261305593"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/What%27s%20the%20background%20in%20the%20timing%20graph%3F/near/261305593" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/What&#x27;s.20the.20background.20in.20the.20timing.20graph.3F.html#261305593">(Nov 12 2021 at 20:18)</a>:</h4>
<p>I assume the CPU usage isn't "smart" — if I had something outside of cargo burning all my CPU, it'd show in the graph as 100% all the way though?</p>



<a name="261305877"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/What%27s%20the%20background%20in%20the%20timing%20graph%3F/near/261305877" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/What&#x27;s.20the.20background.20in.20the.20timing.20graph.3F.html#261305877">(Nov 12 2021 at 20:21)</a>:</h4>
<p>Yea, I believe it is system load.</p>



<a name="261306620"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/What%27s%20the%20background%20in%20the%20timing%20graph%3F/near/261306620" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/What&#x27;s.20the.20background.20in.20the.20timing.20graph.3F.html#261306620">(Nov 12 2021 at 20:28)</a>:</h4>
<p><span class="user-mention silent" data-user-id="133247">bjorn3</span> <a href="#narrow/stream/246057-t-cargo/topic/What's.20the.20background.20in.20the.20timing.20graph.3F/near/261303584">said</a>:</p>
<blockquote>
<p>Maybe one of the source files is big?</p>
</blockquote>
<p>Seems likely:</p>
<div class="codehilite"><pre><span></span><code> ...
 35K lib/compress/zstd_compress_sequences.o
 42K lib/compress/fse_compress.o
 45K lib/dictBuilder/fastcover.o
 50K lib/compress/zstd_compress_superblock.o
 50K lib/compress/huf_compress.o
 58K lib/common/fse_decompress.o
 59K lib/compress/zstd_ldm.o
 60K lib/dictBuilder/cover.o
 80K lib/compress/zstdmt_compress.o
 93K lib/dictBuilder/zdict.o
101K lib/decompress/zstd_decompress_block.o
103K lib/legacy/zstd_v01.o
125K lib/legacy/zstd_v03.o
129K lib/decompress/zstd_decompress.o
134K lib/dictBuilder/divsufsort.o
141K lib/decompress/huf_decompress.o
142K lib/legacy/zstd_v04.o
157K lib/legacy/zstd_v02.o
171K lib/legacy/zstd_v06.o
179K lib/legacy/zstd_v05.o
209K lib/legacy/zstd_v07.o
269K lib/compress/zstd_fast.o
366K lib/compress/zstd_compress.o
391K lib/compress/zstd_double_fast.o
1.5M lib/compress/zstd_opt.o
4.0M lib/compress/zstd_lazy.o
</code></pre></div>



<a name="261310031"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/What%27s%20the%20background%20in%20the%20timing%20graph%3F/near/261310031" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/What&#x27;s.20the.20background.20in.20the.20timing.20graph.3F.html#261310031">(Nov 12 2021 at 21:01)</a>:</h4>
<p><em>obviously</em> the solution is to RIIR.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>