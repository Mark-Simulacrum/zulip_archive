<html>
<head><meta charset="utf-8"><title>eagerly unifying features in a workspace · t-cargo · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/index.html">t-cargo</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/eagerly.20unifying.20features.20in.20a.20workspace.html">eagerly unifying features in a workspace</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="261989907"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/eagerly%20unifying%20features%20in%20a%20workspace/near/261989907" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/eagerly.20unifying.20features.20in.20a.20workspace.html#261989907">(Nov 18 2021 at 21:00)</a>:</h4>
<p>I have a virtual workspace:</p>
<div class="codehilite" data-code-language="TOML"><pre><span></span><code><span class="k">[workspace]</span>
<span class="n">members</span> <span class="o">=</span> <span class="p">[</span><span class="s">"a"</span><span class="p">,</span> <span class="s">"b"</span><span class="p">]</span>
<span class="n">resolver</span> <span class="o">=</span> <span class="s">"2"</span>
</code></pre></div>
<p><strong>A</strong> has a dependency on Tokio with feature <code>net</code>:</p>
<div class="codehilite" data-code-language="TOML"><pre><span></span><code><span class="k">[dependencies]</span>
<span class="n">tokio</span> <span class="o">=</span> <span class="p">{</span> <span class="n">version</span> <span class="o">=</span> <span class="s">"1.0"</span><span class="p">,</span> <span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="s">"net"</span><span class="p">]</span> <span class="p">}</span>
</code></pre></div>
<p>And <strong>B</strong> has the same dependency on Tokio with feature <code>time</code>:</p>
<div class="codehilite" data-code-language="TOML"><pre><span></span><code><span class="k">[dependencies]</span>
<span class="n">tokio</span> <span class="o">=</span> <span class="p">{</span> <span class="n">version</span> <span class="o">=</span> <span class="s">"1.0"</span><span class="p">,</span> <span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="s">"time"</span><span class="p">]</span> <span class="p">}</span>
</code></pre></div>
<p>When I build each crate, Tokio is rebuilt:</p>
<div class="codehilite"><pre><span></span><code>% cargo build -p a
   Compiling libc v0.2.107
   Compiling log v0.4.14
   Compiling cfg-if v1.0.0
   Compiling autocfg v1.0.1
   Compiling pin-project-lite v0.2.7
   Compiling tokio v1.14.0
   Compiling mio v0.7.14
   Compiling a v0.1.0 (/private/tmp/ws/a)
    Finished dev [unoptimized + debuginfo] target(s) in 1.74s

% cargo build -p b
   Compiling tokio v1.14.0
   Compiling b v0.1.0 (/private/tmp/ws/b)
    Finished dev [unoptimized + debuginfo] target(s) in 0.62s
</code></pre></div>
<p>Is there a way to say "I'd like to build Tokio only once for the workspace, enabling both features"?</p>



<a name="261991001"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/eagerly%20unifying%20features%20in%20a%20workspace/near/261991001" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/eagerly.20unifying.20features.20in.20a.20workspace.html#261991001">(Nov 18 2021 at 21:09)</a>:</h4>
<p>not really. the traditional solution is something like <a href="https://searchfox.org/mozilla-central/source/build/workspace-hack/Cargo.toml">https://searchfox.org/mozilla-central/source/build/workspace-hack/Cargo.toml</a> but</p>



<a name="261991008"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/eagerly%20unifying%20features%20in%20a%20workspace/near/261991008" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/eagerly.20unifying.20features.20in.20a.20workspace.html#261991008">(Nov 18 2021 at 21:09)</a>:</h4>
<p>it's definitely not ideal</p>



<a name="261991233"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/eagerly%20unifying%20features%20in%20a%20workspace/near/261991233" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/eagerly.20unifying.20features.20in.20a.20workspace.html#261991233">(Nov 18 2021 at 21:10)</a>:</h4>
<p>see also <a href="https://github.com/rust-lang/rust/tree/master/src/tools/rustc-workspace-hack">https://github.com/rust-lang/rust/tree/master/src/tools/rustc-workspace-hack</a>, and i think servo has one too? there are definitely other crates as well</p>



<a name="261991559"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/eagerly%20unifying%20features%20in%20a%20workspace/near/261991559" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/eagerly.20unifying.20features.20in.20a.20workspace.html#261991559">(Nov 18 2021 at 21:13)</a>:</h4>
<p>Do you know if there's any tooling to help keep those master lists of features up-to-date as "normal" dependencies change?</p>



<a name="261991563"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/eagerly%20unifying%20features%20in%20a%20workspace/near/261991563" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/eagerly.20unifying.20features.20in.20a.20workspace.html#261991563">(Nov 18 2021 at 21:13)</a>:</h4>
<p>i'd love a way to specify this on the workspace in cargo.toml</p>



<a name="261991692"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/eagerly%20unifying%20features%20in%20a%20workspace/near/261991692" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/eagerly.20unifying.20features.20in.20a.20workspace.html#261991692">(Nov 18 2021 at 21:14)</a>:</h4>
<p>hm, i don't know of any. i think you could get the info you need to build such tooling out of <code>cargo metadata</code>, but i dont know if anybody's done it</p>



<a name="261992030"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/eagerly%20unifying%20features%20in%20a%20workspace/near/261992030" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/eagerly.20unifying.20features.20in.20a.20workspace.html#261992030">(Nov 18 2021 at 21:17)</a>:</h4>
<p>Ah, perhaps <a href="https://crates.io/crates/cargo-hakari">https://crates.io/crates/cargo-hakari</a></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>