<html>
<head><meta charset="utf-8"><title>rls update · t-cargo · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/index.html">t-cargo</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/rls.20update.html">rls update</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="269347145"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/rls%20update/near/269347145" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/rls.20update.html#269347145">(Jan 26 2022 at 00:34)</a>:</h4>
<p><span class="user-mention" data-user-id="424212">@Ed Page</span> (or anyone else), would you be willing to update RLS?  It looks like the <a href="https://github.com/rust-lang/rls/blob/e9bdababa0c7d8739b2bbde8b7a3db26369fd80b/tests/client.rs#L724"><code>client_invalid_toml_manifest</code></a> test is now failing with the new toml changes (I suspect it is just a slight change in the error message).</p>
<p>The process is to bump the git revision <a href="https://github.com/rust-lang/rls/blob/e9bdababa0c7d8739b2bbde8b7a3db26369fd80b/Cargo.toml#L34">here</a> to the latest version on master, and then run <code>cargo test</code> and fix the tests, then submit a PR to rust-lang/rls.  (You might also need to bump the rev for rustfmt.)</p>



<a name="269349369"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/rls%20update/near/269349369" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ed Page <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/rls.20update.html#269349369">(Jan 26 2022 at 01:03)</a>:</h4>
<p>I can take a look at it in the morning.</p>



<a name="269431499"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/rls%20update/near/269431499" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ed Page <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/rls.20update.html#269431499">(Jan 26 2022 at 15:43)</a>:</h4>
<p>Is there another stream or an issue where this is being discussed?  I want to run my proposed fix past people.</p>



<a name="269438517"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/rls%20update/near/269438517" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/rls.20update.html#269438517">(Jan 26 2022 at 16:22)</a>:</h4>
<p><span class="user-mention" data-user-id="424212">@Ed Page</span> No, just here.  When I update cargo in rust-lang/rust, I also run tests that let me know when RLS fails.</p>



<a name="269438551"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/rls%20update/near/269438551" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/rls.20update.html#269438551">(Jan 26 2022 at 16:22)</a>:</h4>
<p>Feel free to ask any questions here.</p>



<a name="269439316"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/rls%20update/near/269439316" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ed Page <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/rls.20update.html#269439316">(Jan 26 2022 at 16:27)</a>:</h4>
<p>Problem: RLS is downcasting an error from cargo to <code>toml::de::Error</code>.  This obviously fails and its falling back the defaults it set for the range.</p>
<p>I could just update it to <code>toml_edit::Error</code> but</p>
<ul>
<li><code>toml_edit</code> isn't at a stable point and if we get toml_edit out of sync between cargo and rls, the downcast will just fail again.  At least the test catches it but thats brittle.</li>
<li><code>toml_edit</code> doesn't expose line/column information in a programmatic format at this time.  It can be added but it will delay getting this fixed.</li>
</ul>
<p>With those reasons, the current maintenance status of RLS with rust-analyzer, and the fact that not all manifest errors currently provide line/column (only parse), I propose we just remove line/column information from parse errors.  The maintenance benefits seem to outweigh the impact from reducing functionality.</p>



<a name="269441346"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/rls%20update/near/269441346" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/rls.20update.html#269441346">(Jan 26 2022 at 16:38)</a>:</h4>
<p>Time-wise, we have about 2 weeks or so.</p>
<p>I'm fine with keeping the versions in sync, that shouldn't be too difficult.  (And hopefully they don't change too often?)</p>
<p>FWIW, I think it would be good to support line/column information long-term. I know it would be great to have that in cargo itself for JSON output.</p>
<p>As for just removing the support in RLS, I'm a little hesitant. However, it isn't my call.  If that is relatively easy to do, then I suggest just go ahead and open a PR with that change.  Then, perhaps in the future, we can revert it if toml_edit errors gain the needed information?</p>
<p>I'm not sure if <span class="user-mention" data-user-id="153740">@Igor Matuszewski</span> is on Zulip much.</p>



<a name="269479752"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/rls%20update/near/269479752" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mati865 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/rls.20update.html#269479752">(Jan 26 2022 at 20:48)</a>:</h4>
<p>I think opening an issue at RLS repo would be more visible than pinging on Zulip.</p>



<a name="269490914"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/rls%20update/near/269490914" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ed Page <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/rls.20update.html#269490914">(Jan 26 2022 at 22:15)</a>:</h4>
<p>Just posted <a href="https://github.com/rust-lang/rls/pull/1764">https://github.com/rust-lang/rls/pull/1764</a>.  It was easier to get <code>line_col</code> than I expected.</p>



<a name="271144390"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/rls%20update/near/271144390" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ed Page <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/rls.20update.html#271144390">(Feb 08 2022 at 15:29)</a>:</h4>
<p>Looks like my PR is stalled.  Recommendations for helping to move it forward?</p>



<a name="271152989"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/rls%20update/near/271152989" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/rls.20update.html#271152989">(Feb 08 2022 at 16:26)</a>:</h4>
<p>Thanks for the heads up, I'll ping some people.</p>



<a name="272983909"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/rls%20update/near/272983909" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/rls.20update.html#272983909">(Feb 23 2022 at 17:40)</a>:</h4>
<p>Can someone volunteer to do another RLS update?</p>
<div class="codehilite"><pre><span></span><code>error[E0599]: no method named `extern_crate_name` found for struct `cargo::core::Resolve` in the current scope
   --&gt; src/tools/rls/rls/src/project_model.rs:106:46
    |
106 |                     let crate_name = resolve.extern_crate_name(pkg_id, dep_id, &amp;lib)?;
    |                                              ^^^^^^^^^^^^^^^^^ method not found in `cargo::core::Resolve`
</code></pre></div>
<p>Presumably this is caused by <a href="https://github.com/rust-lang/cargo/issues/9992">cargo#9992</a>, and should be easy to fix.  The process is mentioned above at <a href="#narrow/stream/246057-t-cargo/topic/rls.20update/near/269347145">https://rust-lang.zulipchat.com/#narrow/stream/246057-t-cargo/topic/rls.20update/near/269347145</a>.</p>



<a name="273081147"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/rls%20update/near/273081147" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Weihang Lo <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/rls.20update.html#273081147">(Feb 24 2022 at 12:17)</a>:</h4>
<p>I will take a look tonight.</p>



<a name="273094010"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/rls%20update/near/273094010" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Weihang Lo <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/rls.20update.html#273094010">(Feb 24 2022 at 14:13)</a>:</h4>
<p>Hey, just submitted <a href="https://github.com/rust-lang/rls/pull/1767">rust-lang/rls#1767</a>. AFAIK it's a tiny function renaming issue.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>