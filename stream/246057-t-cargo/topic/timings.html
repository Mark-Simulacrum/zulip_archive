<html>
<head><meta charset="utf-8"><title>timings · t-cargo · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/index.html">t-cargo</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/timings.html">timings</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="266837912"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/timings/near/266837912" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/timings.html#266837912">(Jan 04 2022 at 17:25)</a>:</h4>
<p>@ehuss <span class="user-mention" data-user-id="116015">@Alex Crichton</span> I did some tests, and removing that clause from <code>rmeta_required</code> doesn't seem to affect anything. PR at <a href="https://github.com/rust-lang/cargo/pull/10254">https://github.com/rust-lang/cargo/pull/10254</a></p>



<a name="266860942"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/timings/near/266860942" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/timings.html#266860942">(Jan 04 2022 at 20:47)</a>:</h4>
<p>I'm trying to figure out the right way to get the correct target directory. I <em>think</em> it makes sense to put the timing file in target/$profile, but as far as I can tell, that directory can technically vary by unit, and by whether the build is for the host or being cross-compiled.</p>



<a name="266860953"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/timings/near/266860953" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/timings.html#266860953">(Jan 04 2022 at 20:47)</a>:</h4>
<p>But the timing file is for the whole build, not for a particular root unit.</p>



<a name="266861738"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/timings/near/266861738" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/timings.html#266861738">(Jan 04 2022 at 20:53)</a>:</h4>
<p>We could, perhaps, emit <code>target/timings/...</code> instead, but it actually does seem useful to put the timing for a release build in <code>target/release</code> and the timing for a debug build in <code>target/debug</code>.</p>



<a name="266864025"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/timings/near/266864025" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/timings.html#266864025">(Jan 04 2022 at 21:12)</a>:</h4>
<p>Yeah I was thinking like <code>target/debug/cargo-timings/the-file.html</code></p>



<a name="266878074"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/timings/near/266878074" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/timings.html#266878074">(Jan 04 2022 at 23:21)</a>:</h4>
<p><span class="user-mention" data-user-id="116015">@Alex Crichton</span> I agree, but I'm not sure how to compute the <code>target/debug</code> there.</p>



<a name="266878134"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/timings/near/266878134" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/timings.html#266878134">(Jan 04 2022 at 23:22)</a>:</h4>
<p>As far as I can tell, it's easy to get <code>target</code>, but getting <code>target/debug</code> requires a unit, and there are multiple root units, and no particular reason to think they'd all have the same value there.</p>



<a name="266954448"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/timings/near/266954448" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/timings.html#266954448">(Jan 05 2022 at 16:10)</a>:</h4>
<p>Oh I haven't done much in the backend recently, so it's probably harder to get at this than I last remember, but throwing something in <code>target/cargo-timings</code> or something like that also seems fine</p>



<a name="266955152"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/timings/near/266955152" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/timings.html#266955152">(Jan 05 2022 at 16:16)</a>:</h4>
<p>Yea, I probably wouldn't bother trying to stick it in a profile-specific directory. <code>target/cargo-timings</code> sounds fine to me. Since it keeps old copies, one can easily look at older runs for different profiles, and the report prominently shows the profile used.</p>



<a name="266968838"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/timings/near/266968838" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/timings.html#266968838">(Jan 05 2022 at 18:04)</a>:</h4>
<p>Fair enough.</p>



<a name="266968844"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/timings/near/266968844" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/timings.html#266968844">(Jan 05 2022 at 18:04)</a>:</h4>
<p>I'll do that then.</p>



<a name="268084973"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/timings/near/268084973" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/timings.html#268084973">(Jan 14 2022 at 22:58)</a>:</h4>
<p>Following up on this: I'm currently reworking the timings stabilization, and I find myself really hesitant to just emit the file unconditionally. I've simplified the existing support and dropped the text-based <code>info</code>, and I'm working on moving the file into <code>target/cargo-timings</code>. I'm wondering if folks would object to keeping the <code>--timings</code> option and just simplifying it.</p>



<a name="268088048"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/timings/near/268088048" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/timings.html#268088048">(Jan 14 2022 at 23:31)</a>:</h4>
<p>I'm also a little hesitant to always generate an HTML report.  I wouldn't want to commit to having that file always available to access directly.  Is that the same concern you have?</p>
<p>I think it would be interesting to always save the data in some internal format, and then support <code>cargo report timings</code> to expose the report to the user.   I'm just trying to think if that ux would be too fussy.</p>
<p>I'm on the fence with adding <code>--timings</code>.  I strongly prefer to avoid adding too many options, but this probably isn't too big of a deal.  I can see how it would be convenient.</p>



<a name="268095868"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/timings/near/268095868" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/timings.html#268095868">(Jan 15 2022 at 01:29)</a>:</h4>
<p><span class="user-mention" data-user-id="120518">@Eric Huss</span> For me, it's less about the interface of always making that file available, and more about not wanting to commit to always doing the work to produce it.</p>



<a name="268095920"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/timings/near/268095920" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/timings.html#268095920">(Jan 15 2022 at 01:30)</a>:</h4>
<p>Given my own interests in optimizing build time, I can imagine optimizing builds to the point where emitting the timings file might be a substantial component of build time.</p>



<a name="268095965"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/timings/near/268095965" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/timings.html#268095965">(Jan 15 2022 at 01:31)</a>:</h4>
<p>Can we make it opt out? Or a config setting?</p>



<a name="268095968"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/timings/near/268095968" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/timings.html#268095968">(Jan 15 2022 at 01:31)</a>:</h4>
<p>I like the <em>concept</em> of <code>cargo report timings</code>, especially because it might allow for things like <code>cargo report timings --diff</code>.</p>



<a name="268095971"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/timings/near/268095971" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/timings.html#268095971">(Jan 15 2022 at 01:31)</a>:</h4>
<p>But I wouldn't want to commit to always measuring and outputting a JSON file, either.</p>



<a name="268096002"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/timings/near/268096002" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/timings.html#268096002">(Jan 15 2022 at 01:31)</a>:</h4>
<p><span class="user-mention" data-user-id="120179">@Eh2406</span> It'd be trivial to make a config setting corresponding to the <code>timings</code> option, if we think folks might want to turn it on and leave it on.</p>



<a name="268096051"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/timings/near/268096051" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/timings.html#268096051">(Jan 15 2022 at 01:32)</a>:</h4>
<p>I was figuring we could always add a config setting later.</p>



<a name="268098815"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/timings/near/268098815" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/timings.html#268098815">(Jan 15 2022 at 02:23)</a>:</h4>
<p>OK, I've rewritten <a href="https://github.com/rust-lang/cargo/pull/10245">https://github.com/rust-lang/cargo/pull/10245</a> .</p>



<a name="268293980"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/timings/near/268293980" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Weihang Lo <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/timings.html#268293980">(Jan 17 2022 at 16:54)</a>:</h4>
<p>It might break things but what if let <code>cargo clean</code> skip <code>target/cargo-timings</code>? I feel like timing data will become more important if cargo eventually optimizes build upon it.</p>



<a name="268296768"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/timings/near/268296768" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matthiaskrgr <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/timings.html#268296768">(Jan 17 2022 at 17:22)</a>:</h4>
<p>there might be tools out there that rely on <code>cargo clean</code> == <code>rm -rf target</code> :/</p>



<a name="268303090"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/timings/near/268303090" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/timings.html#268303090">(Jan 17 2022 at 18:35)</a>:</h4>
<p>I think if we start recording timing information that helps cargo do builds in the right order, we will want to keep that information in <code>CARGO_HOME</code>.</p>



<a name="268304436"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/timings/near/268304436" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/timings.html#268304436">(Jan 17 2022 at 18:51)</a>:</h4>
<p>(bravely invoking the "caching" hard problem of computer science)</p>



<a name="268307355"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/timings/near/268307355" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/timings.html#268307355">(Jan 17 2022 at 19:22)</a>:</h4>
<p><span class="user-mention" data-user-id="138448">@cuviper</span> Absolutely. Which I think is something we should do anyway for many other reasons.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>