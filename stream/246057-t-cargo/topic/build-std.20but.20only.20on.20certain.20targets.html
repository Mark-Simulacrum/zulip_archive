<html>
<head><meta charset="utf-8"><title>build-std but only on certain targets · t-cargo · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/index.html">t-cargo</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/build-std.20but.20only.20on.20certain.20targets.html">build-std but only on certain targets</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="249635927"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/build-std%20but%20only%20on%20certain%20targets/near/249635927" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/build-std.20but.20only.20on.20certain.20targets.html#249635927">(Aug 16 2021 at 19:31)</a>:</h4>
<p>Is it possible to make build-std work only on certain targets?<br>
I've got this currently</p>
<div class="codehilite" data-code-language="TOML"><pre><span></span><code><span class="k">[build]</span>
<span class="n">target</span> <span class="o">=</span> <span class="s">"thumbv4t-none-eabi"</span>

<span class="k">[unstable]</span>
<span class="n">build-std</span> <span class="o">=</span> <span class="k">["core"]</span>

<span class="k">[target.thumbv4t-none-eabi]</span>
<span class="n">rustflags</span> <span class="o">=</span> <span class="k">["-Clink-arg=-Tgba.ld"]</span>
<span class="n">runner</span> <span class="o">=</span> <span class="s">"mgba"</span>
</code></pre></div>
<p>but this prevents normal code that is not embedded specific from also being built/tested for my local windows target.<br>
If I specify <code>cargo test --lib --target x86_64-pc-windows-msvc</code> as my command line it still tries to build the standard library and then there's like a million errors.</p>
<p>I tried to make the build-std usage be target specific like this:</p>
<div class="codehilite" data-code-language="TOML"><pre><span></span><code><span class="k">[build]</span>
<span class="n">target</span> <span class="o">=</span> <span class="s">"thumbv4t-none-eabi"</span>

<span class="k">[target.thumbv4t-none-eabi]</span>
<span class="n">rustflags</span> <span class="o">=</span> <span class="k">["-Clink-arg=-Tgba.ld"]</span>
<span class="n">runner</span> <span class="o">=</span> <span class="s">"mgba"</span>

<span class="k">[target.thumbv4t-none-eabi.unstable]</span>
<span class="n">build-std</span> <span class="o">=</span> <span class="k">["core"]</span>
</code></pre></div>
<p>but it just generates an error:</p>
<blockquote>
<p>error: expected a string, but found a array for <code>build-std</code> in D:\dev\gba-from-scratch\.cargo\config.toml</p>
</blockquote>
<p>Is there some other way I'm not understanding about how to make build-std work only on specific targets and not on normal targets that do already have the standard library?</p>



<a name="249647375"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/build-std%20but%20only%20on%20certain%20targets/near/249647375" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/build-std.20but.20only.20on.20certain.20targets.html#249647375">(Aug 16 2021 at 21:03)</a>:</h4>
<p>There isn't a specific option for that.  The only way is to specify <code>-Zbuild-std</code> on the command-line.  Can you say why it is only specifying <code>core</code>?  It should work to build the full standard library for <code>x86_64-pc-windows-msvc</code>.</p>



<a name="249675711"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/build-std%20but%20only%20on%20certain%20targets/near/249675711" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/build-std.20but.20only.20on.20certain.20targets.html#249675711">(Aug 17 2021 at 03:43)</a>:</h4>
<p>The project is primarily for an old embedded device, I just also want to be able to test the parts of the library that aren't specific to the old embedded device on my windows machine as well.</p>



<a name="249675760"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/build-std%20but%20only%20on%20certain%20targets/near/249675760" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/build-std.20but.20only.20on.20certain.20targets.html#249675760">(Aug 17 2021 at 03:44)</a>:</h4>
<p>So I want:</p>
<ul>
<li>do this build-std=core thing if it's for <code>thumbv4t-none-eabi</code></li>
<li>don't do that build-std thing if it's any normal tier1 target</li>
</ul>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>