<html>
<head><meta charset="utf-8"><title>document lib before bin · t-cargo · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/index.html">t-cargo</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/document.20lib.20before.20bin.html">document lib before bin</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="265037815"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/document%20lib%20before%20bin/near/265037815" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/document.20lib.20before.20bin.html#265037815">(Dec 15 2021 at 16:44)</a>:</h4>
<p>Hey <span class="user-mention" data-user-id="120518">@Eric Huss</span> -- following up on the comment left on <a href="https://github.com/rust-lang/cargo/pull/10172">https://github.com/rust-lang/cargo/pull/10172</a>, I actually think this might've made caches invalidate a little more eagerly than I'd expect.</p>
<div class="codehilite"><pre><span></span><code>[DEBUG collector::execute] &quot;/home/runner/work/rustc-perf/rustc-perf/cache/3ee016ae4d4c6ee4a34faa2eb7fdae2ffa7c9b46/bin/cargo&quot; &quot;rustdoc&quot; &quot;--manifest-path&quot; &quot;Cargo.toml&quot; &quot;-p&quot; &quot;file:///tmp/.tmpfmWtED#token-stream-stress:0.0.0&quot; &quot;--bin&quot; &quot;token-stream-stress-bin&quot; &quot;--&quot; &quot;--wrap-rustc-with&quot; &quot;perf-stat&quot;
[INFO  cargo::core::compiler::fingerprint] fingerprint error for token-stream-stress v0.0.0 (/tmp/.tmpfmWtED)/Doc { deps: false }/TargetInner { name: &quot;token-stream-stress-bin&quot;, doc: true, ..: with_path(&quot;/tmp/.tmpfmWtED/src/main.rs&quot;, Edition2018) }
[INFO  cargo::core::compiler::fingerprint]     err: profile configuration has changed
[INFO  cargo::core::compiler::fingerprint] fingerprint error for token-stream-stress v0.0.0 (/tmp/.tmpfmWtED)/Doc { deps: false }/TargetInner { for_host: true, proc_macro: true, ..: lib_target(&quot;token-stream-stress&quot;, [&quot;proc-macro&quot;], &quot;/tmp/.tmpfmWtED/src/lib.rs&quot;, Edition2018) }
[INFO  cargo::core::compiler::fingerprint]     err: precalculated components have changed: previously 1639580352.195100706s (Cargo.lock), now 1639581289.155776959s (src/main.rs)
 Documenting token-stream-stress v0.0.0 (/tmp/.tmpfmWtED)
&quot;/home/runner/work/rustc-perf/rustc-perf/cache/3ee016ae4d4c6ee4a34faa2eb7fdae2ffa7c9b46/bin/rustdoc&quot; [&quot;--edition=2018&quot;, &quot;--crate-type&quot;, &quot;proc-macro&quot;, &quot;--crate-name&quot;, &quot;token_stream_stress&quot;, &quot;src/lib.rs&quot;, &quot;-o&quot;, &quot;/tmp/.tmpfmWtED/target/doc&quot;, &quot;--error-format=json&quot;, &quot;--json=diagnostic-rendered-ansi,future-incompat&quot;, &quot;-C&quot;, &quot;metadata=49e968af46dd2295&quot;, &quot;-L&quot;, &quot;dependency=/tmp/.tmpfmWtED/target/debug/deps&quot;, &quot;--extern&quot;, &quot;proc_macro&quot;, &quot;--crate-version&quot;, &quot;0.0.0&quot;, &quot;-Adeprecated&quot;, &quot;-Aunknown-lints&quot;]
exiting -- non-wrapped rustc
error: could not document `token-stream-stress`

Caused by:
  process didn&#39;t exit successfully: `/home/runner/work/rustc-perf/rustc-perf/target/debug/rustdoc-fake --edition=2018 --crate-type proc-macro --crate-name token_stream_stress src/lib.rs -o /tmp/.tmpfmWtED/target/doc --error-format=json --json=diagnostic-rendered-ansi,future-incompat -C metadata=49e968af46dd2295 -L dependency=/tmp/.tmpfmWtED/target/debug/deps --extern proc_macro --crate-version 0.0.0` (exit status: 1)
</code></pre></div>
<p>We should only be touching src/main.rs, which previously only rebuilt docs for the binary, but now it looks like that's invalidating the fingerprint for the library as well (note src/main.rs in the <a href="http://lib.rs">lib.rs</a> fingerprint), if I'm reading this log right</p>



<a name="265037899"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/document%20lib%20before%20bin/near/265037899" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/document.20lib.20before.20bin.html#265037899">(Dec 15 2021 at 16:45)</a>:</h4>
<p>Do you think it makes sense to revert that PR for now, perhaps? Not sure if this is an easy thing to patch -- obviously, rustc-perf's insistence on cleanliness is a bit more than most users will care about</p>



<a name="265039118"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/document%20lib%20before%20bin/near/265039118" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/document.20lib.20before.20bin.html#265039118">(Dec 15 2021 at 16:53)</a>:</h4>
<p><span class="user-mention" data-user-id="116122">@simulacrum</span> Hm, sorry that's causing problems for you. We can definitely revert it, but I'd like to better understand what you're running into.</p>
<p>Which commands are you running that are not working as before?</p>



<a name="265040507"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/document%20lib%20before%20bin/near/265040507" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/document.20lib.20before.20bin.html#265040507">(Dec 15 2021 at 17:01)</a>:</h4>
<p>I can try to get a reproduction in a bit</p>



<a name="265043671"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/document%20lib%20before%20bin/near/265043671" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/document.20lib.20before.20bin.html#265043671">(Dec 15 2021 at 17:22)</a>:</h4>
<p>Runs twice:</p>
<div class="codehilite"><pre><span></span><code>$ cargo +3ee016ae4d4c6ee4a34faa2eb7fdae2ffa7c9b46 rustdoc --bin test-doc-repro-bin -vv
 Documenting test-doc-repro v0.1.0 (/home/mark/Edit/test-doc-repro)
   Compiling test-doc-repro v0.1.0 (/home/mark/Edit/test-doc-repro)
     Running `rustdoc --edition=2021 --crate-type proc-macro --crate-name test_doc_repro src/lib.rs -o /home/mark/Edit/test-doc-repro/target/doc --error-format=json --json=diagnostic-rendered-ansi,future-incompat -C metadata=405b54599b8d27d7 -L dependency=/home/mark/Edit/test-doc-repro/target/debug/deps --extern proc_macro --crate-version 0.1.0`
     Running `CARGO=/home/mark/.rustup/toolchains/3ee016ae4d4c6ee4a34faa2eb7fdae2ffa7c9b46/bin/cargo CARGO_CRATE_NAME=test_doc_repro CARGO_MANIFEST_DIR=/home/mark/Edit/test-doc-repro CARGO_PKG_AUTHORS=&#39;&#39; CARGO_PKG_DESCRIPTION=&#39;&#39; CARGO_PKG_HOMEPAGE=&#39;&#39; CARGO_PKG_LICENSE=&#39;&#39; CARGO_PKG_LICENSE_FILE=&#39;&#39; CARGO_PKG_NAME=test-doc-repro CARGO_PKG_REPOSITORY=&#39;&#39; CARGO_PKG_VERSION=0.1.0 CARGO_PKG_VERSION_MAJOR=0 CARGO_PKG_VERSION_MINOR=1 CARGO_PKG_VERSION_PATCH=0 CARGO_PKG_VERSION_PRE=&#39;&#39; CARGO_PRIMARY_PACKAGE=1 LD_LIBRARY_PATH=&#39;/home/mark/Edit/test-doc-repro/target/debug/deps:/home/mark/.rustup/toolchains/3ee016ae4d4c6ee4a34faa2eb7fdae2ffa7c9b46/lib:/home/mark/.rustup/toolchains/3ee016ae4d4c6ee4a34faa2eb7fdae2ffa7c9b46/lib&#39; rustc --crate-name test_doc_repro --edition=2021 src/lib.rs --error-format=json --json=diagnostic-rendered-ansi,future-incompat --crate-type proc-macro --emit=dep-info,link -C prefer-dynamic -C embed-bitcode=no -C debuginfo=2 -C metadata=5820eae4bf36e49f -C extra-filename=-5820eae4bf36e49f --out-dir /home/mark/Edit/test-doc-repro/target/debug/deps -C incremental=/home/mark/Edit/test-doc-repro/target/debug/incremental -L dependency=/home/mark/Edit/test-doc-repro/target/debug/deps --extern proc_macro`
     Running `rustdoc --edition=2021 --crate-type bin --crate-name test_doc_repro_bin src/main.rs -o /home/mark/Edit/test-doc-repro/target/doc --error-format=json --json=diagnostic-rendered-ansi,future-incompat --document-private-items -C metadata=2d3f8ceaa03c64c0 -L dependency=/home/mark/Edit/test-doc-repro/target/debug/deps --extern test_doc_repro=/home/mark/Edit/test-doc-repro/target/debug/deps/libtest_doc_repro-5820eae4bf36e49f.so --crate-version 0.1.0`
    Finished dev [unoptimized + debuginfo] target(s) in 0.71s
$ touch src/main.rs
$ cargo +3ee016ae4d4c6ee4a34faa2eb7fdae2ffa7c9b46 rustdoc --bin test-doc-repro-bin -vv
 Documenting test-doc-repro v0.1.0 (/home/mark/Edit/test-doc-repro)
     Running `rustdoc --edition=2021 --crate-type proc-macro --crate-name test_doc_repro src/lib.rs -o /home/mark/Edit/test-doc-repro/target/doc --error-format=json --json=diagnostic-rendered-ansi,future-incompat -C metadata=405b54599b8d27d7 -L dependency=/home/mark/Edit/test-doc-repro/target/debug/deps --extern proc_macro --crate-version 0.1.0`
     Running `rustdoc --edition=2021 --crate-type bin --crate-name test_doc_repro_bin src/main.rs -o /home/mark/Edit/test-doc-repro/target/doc --error-format=json --json=diagnostic-rendered-ansi,future-incompat --document-private-items -C metadata=2d3f8ceaa03c64c0 -L dependency=/home/mark/Edit/test-doc-repro/target/debug/deps --extern test_doc_repro=/home/mark/Edit/test-doc-repro/target/debug/deps/libtest_doc_repro-5820eae4bf36e49f.so --crate-version 0.1.0`
    Finished dev [unoptimized + debuginfo] target(s) in 0.65s
</code></pre></div>



<a name="265043757"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/document%20lib%20before%20bin/near/265043757" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/document.20lib.20before.20bin.html#265043757">(Dec 15 2021 at 17:23)</a>:</h4>
<p>Runs once:</p>
<div class="codehilite"><pre><span></span><code>$ cargo +nightly rustdoc --bin test-doc-repro-bin -vv
   Compiling test-doc-repro v0.1.0 (/home/mark/Edit/test-doc-repro)
     Running `CARGO=/home/mark/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/bin/cargo CARGO_CRATE_NAME=test_doc_repro CARGO_MANIFEST_DIR=/home/mark/Edit/test-doc-repro CARGO_PKG_AUTHORS=&#39;&#39; CARGO_PKG_DESCRIPTION=&#39;&#39; CARGO_PKG_HOMEPAGE=&#39;&#39; CARGO_PKG_LICENSE=&#39;&#39; CARGO_PKG_LICENSE_FILE=&#39;&#39; CARGO_PKG_NAME=test-doc-repro CARGO_PKG_REPOSITORY=&#39;&#39; CARGO_PKG_VERSION=0.1.0 CARGO_PKG_VERSION_MAJOR=0 CARGO_PKG_VERSION_MINOR=1 CARGO_PKG_VERSION_PATCH=0 CARGO_PKG_VERSION_PRE=&#39;&#39; CARGO_PRIMARY_PACKAGE=1 LD_LIBRARY_PATH=&#39;/home/mark/Edit/test-doc-repro/target/debug/deps:/home/mark/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib:/home/mark/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib&#39; rustc --crate-name test_doc_repro --edition=2021 src/lib.rs --error-format=json --json=diagnostic-rendered-ansi,future-incompat --crate-type proc-macro --emit=dep-info,link -C prefer-dynamic -C embed-bitcode=no -C debuginfo=2 -C metadata=5820eae4bf36e49f -C extra-filename=-5820eae4bf36e49f --out-dir /home/mark/Edit/test-doc-repro/target/debug/deps -C incremental=/home/mark/Edit/test-doc-repro/target/debug/incremental -L dependency=/home/mark/Edit/test-doc-repro/target/debug/deps --extern proc_macro`
 Documenting test-doc-repro v0.1.0 (/home/mark/Edit/test-doc-repro)
     Running `rustdoc --edition=2021 --crate-type bin --crate-name test_doc_repro_bin src/main.rs -o /home/mark/Edit/test-doc-repro/target/doc --error-format=json --json=diagnostic-rendered-ansi,future-incompat --document-private-items -C metadata=abcc0e83e5bf2ef3 -L dependency=/home/mark/Edit/test-doc-repro/target/debug/deps --extern test_doc_repro=/home/mark/Edit/test-doc-repro/target/debug/deps/libtest_doc_repro-5820eae4bf36e49f.so --crate-version 0.1.0`
    Finished dev [unoptimized + debuginfo] target(s) in 0.82s
$ touch src/main.rs
$ cargo +nightly rustdoc --bin test-doc-repro-bin -vv
 Documenting test-doc-repro v0.1.0 (/home/mark/Edit/test-doc-repro)
     Running `rustdoc --edition=2021 --crate-type bin --crate-name test_doc_repro_bin src/main.rs -o /home/mark/Edit/test-doc-repro/target/doc --error-format=json --json=diagnostic-rendered-ansi,future-incompat --document-private-items -C metadata=abcc0e83e5bf2ef3 -L dependency=/home/mark/Edit/test-doc-repro/target/debug/deps --extern test_doc_repro=/home/mark/Edit/test-doc-repro/target/debug/deps/libtest_doc_repro-5820eae4bf36e49f.so --crate-version 0.1.0`
    Finished dev [unoptimized + debuginfo] target(s) in 0.37s
</code></pre></div>



<a name="265043921"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/document%20lib%20before%20bin/near/265043921" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/document.20lib.20before.20bin.html#265043921">(Dec 15 2021 at 17:24)</a>:</h4>
<p>with test-doc-repro being the following, with empty src/lib.rs and hello world <a href="http://main.rs">main.rs</a></p>
<div class="codehilite"><pre><span></span><code>[package]
name = &quot;test-doc-repro&quot;
version = &quot;0.1.0&quot;
edition = &quot;2021&quot;

[lib]
proc-macro = true

[[bin]]
name = &quot;test-doc-repro-bin&quot;
path = &quot;src/main.rs&quot;

[dependencies]
</code></pre></div>



<a name="265043940"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/document%20lib%20before%20bin/near/265043940" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/document.20lib.20before.20bin.html#265043940">(Dec 15 2021 at 17:24)</a>:</h4>
<p><span class="user-mention" data-user-id="120518">@Eric Huss</span> is that helpful?</p>



<a name="265043988"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/document%20lib%20before%20bin/near/265043988" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/document.20lib.20before.20bin.html#265043988">(Dec 15 2021 at 17:24)</a>:</h4>
<p>looks like proc-macro = true isn't actually necessary</p>



<a name="265046214"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/document%20lib%20before%20bin/near/265046214" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/document.20lib.20before.20bin.html#265046214">(Dec 15 2021 at 17:40)</a>:</h4>
<p>So that behavior is somewhat expected. rustdoc does not have a dep-info file, so any change to any file will cause both the bin and lib to rebuild the documentation.</p>
<p>I'm not sure what that benchmark is testing.  Would it be an option to disable documentation for the lib?</p>
<p>Otherwise, I'm not sure if there are any good workarounds. We could consider supporting <code>--emit=dep-info</code> for rustdoc, though I don't know how feasible that is.</p>



<a name="265046727"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/document%20lib%20before%20bin/near/265046727" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/document.20lib.20before.20bin.html#265046727">(Dec 15 2021 at 17:44)</a>:</h4>
<p>Yeah, disabling docs for the lib would work probably, let me check</p>



<a name="265047010"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/document%20lib%20before%20bin/near/265047010" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/document.20lib.20before.20bin.html#265047010">(Dec 15 2021 at 17:46)</a>:</h4>
<p>hm, that seems to still document the library?</p>



<a name="265047253"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/document%20lib%20before%20bin/near/265047253" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/document.20lib.20before.20bin.html#265047253">(Dec 15 2021 at 17:47)</a>:</h4>
<p><span class="user-mention" data-user-id="120518">@Eric Huss</span> so I think disabling docs doesn't work, presuming I've done it right:</p>
<div class="codehilite"><pre><span></span><code>[lib]
doc = false
</code></pre></div>
<p>I still see:</p>
<div class="codehilite"><pre><span></span><code>$ cargo +3ee016ae4d4c6ee4a34faa2eb7fdae2ffa7c9b46 rustdoc --bin test-doc-repro-bin -vv
 Documenting test-doc-repro v0.1.0 (/home/mark/Edit/test-doc-repro)
     Running `rustdoc --edition=2021 --crate-type lib --crate-name test_doc_repro src/lib.rs -o /home/mark/Edit/test-doc-repro/target/doc --error-format=json --json=diagnostic-rendered-ansi,future-incompat -C metadata=315a38cb6ee325d0 -L dependency=/home/mark/Edit/test-doc-repro/target/debug/deps --crate-version 0.1.0`
     Running `rustdoc --edition=2021 --crate-type bin --crate-name test_doc_repro_bin src/main.rs -o /home/mark/Edit/test-doc-repro/target/doc --error-format=json --json=diagnostic-rendered-ansi,future-incompat --document-private-items -C metadata=8fcb5a06523e836d -L dependency=/home/mark/Edit/test-doc-repro/target/debug/deps --extern test_doc_repro=/home/mark/Edit/test-doc-repro/target/debug/deps/libtest_doc_repro-315a38cb6ee325d0.rmeta --crate-version 0.1.0`
    Finished dev [unoptimized + debuginfo] target(s) in 0.64s
</code></pre></div>



<a name="265047473"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/document%20lib%20before%20bin/near/265047473" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/document.20lib.20before.20bin.html#265047473">(Dec 15 2021 at 17:48)</a>:</h4>
<p>this benchmark, token-stream-stress, is likely largely unimportant from a rustdoc perf perspective, but I'm a little on the reluctant side to stop building it... it's not the end of the world</p>



<a name="265049259"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/document%20lib%20before%20bin/near/265049259" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/document.20lib.20before.20bin.html#265049259">(Dec 15 2021 at 18:00)</a>:</h4>
<p>Oh, that's a bug. I can fix that soon. Would that be ok with you?</p>



<a name="265052284"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/document%20lib%20before%20bin/near/265052284" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/document.20lib.20before.20bin.html#265052284">(Dec 15 2021 at 18:19)</a>:</h4>
<p>Yeah, no huge rush</p>



<a name="265052334"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/document%20lib%20before%20bin/near/265052334" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/document.20lib.20before.20bin.html#265052334">(Dec 15 2021 at 18:20)</a>:</h4>
<p>Thanks!</p>



<a name="265079182"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/document%20lib%20before%20bin/near/265079182" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/document.20lib.20before.20bin.html#265079182">(Dec 15 2021 at 21:42)</a>:</h4>
<blockquote>
<p>We could consider supporting --emit=dep-info for rustdoc, though I don't know how feasible that is.</p>
</blockquote>
<p>that seems fine to me - rustdoc can just reuse whatever mechanism rustc uses for it</p>



<a name="265079259"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/document%20lib%20before%20bin/near/265079259" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/document.20lib.20before.20bin.html#265079259">(Dec 15 2021 at 21:43)</a>:</h4>
<p>I'm not sure I understand this bit though:</p>
<blockquote>
<p>So that behavior is somewhat expected. rustdoc does not have a dep-info file, so any change to any file will cause both the bin and lib to rebuild the documentation.</p>
</blockquote>
<p>how would changing <a href="http://main.rs">main.rs</a> cause <a href="http://lib.rs">lib.rs</a> to need to be rebuilt? are you imagining <code>include_str!("main.rs")</code> or something cursed like that?</p>



<a name="265080142"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/document%20lib%20before%20bin/near/265080142" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/document.20lib.20before.20bin.html#265080142">(Dec 15 2021 at 21:46)</a>:</h4>
<p><span class="user-mention" data-user-id="232545">@Joshua Nelson</span> Cargo doesn't know which files belong to the lib or the executable, so it takes a conservative approach of assuming any file can affect the documentation.  It's pretty crude, but without the dep-info tracking, there's not a lot it can do.</p>



<a name="265081922"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/document%20lib%20before%20bin/near/265081922" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/document.20lib.20before.20bin.html#265081922">(Dec 15 2021 at 22:00)</a>:</h4>
<p>Gotcha. Yeah, I do think dep-info is the right way to fix this. Can you open an issue on rust-lang/rust with the info cargo needs? "the same as rustc" is fine if you just give an example or two.</p>



<a name="265091942"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/document%20lib%20before%20bin/near/265091942" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/document.20lib.20before.20bin.html#265091942">(Dec 15 2021 at 23:32)</a>:</h4>
<p><span class="user-mention" data-user-id="232545">@Joshua Nelson</span> Opened <a href="https://github.com/rust-lang/rust/issues/91982">https://github.com/rust-lang/rust/issues/91982</a>.</p>



<a name="265098696"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/document%20lib%20before%20bin/near/265098696" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/document.20lib.20before.20bin.html#265098696">(Dec 16 2021 at 00:49)</a>:</h4>
<p>Thank you!</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>