<html>
<head><meta charset="utf-8"><title>linker-flavor in build scripts · t-cargo · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/index.html">t-cargo</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/linker-flavor.20in.20build.20scripts.html">linker-flavor in build scripts</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="275810081"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/linker-flavor%20in%20build%20scripts/near/275810081" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/linker-flavor.20in.20build.20scripts.html#275810081">(Mar 18 2022 at 14:31)</a>:</h4>
<p>In build scripts, is there a reason that <code>cargo:rustc-flags</code> limits itself to <code>-l</code> and <code>-L</code> flags? In particular I'm actually looking to change the linker flavor, which is unfortunately a <code>-C</code> flag.</p>



<a name="275810610"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/linker-flavor%20in%20build%20scripts/near/275810610" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/linker-flavor.20in.20build.20scripts.html#275810610">(Mar 18 2022 at 14:35)</a>:</h4>
<p>Why not use <code>.cargo/config.toml</code>? Having a build script suddenly change your linker would be confusing I think. And what if two crates try to change the linker to different things?</p>



<a name="275810760"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/linker-flavor%20in%20build%20scripts/near/275810760" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/linker-flavor.20in.20build.20scripts.html#275810760">(Mar 18 2022 at 14:36)</a>:</h4>
<p>Because these are binary crates being built via artifact dependencies, which AFAIK makes that approach a non-starter</p>



<a name="275810804"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/linker-flavor%20in%20build%20scripts/near/275810804" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/linker-flavor.20in.20build.20scripts.html#275810804">(Mar 18 2022 at 14:36)</a>:</h4>
<p>I see.</p>



<a name="275810846"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/linker-flavor%20in%20build%20scripts/near/275810846" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/linker-flavor.20in.20build.20scripts.html#275810846">(Mar 18 2022 at 14:37)</a>:</h4>
<p>and while profile overrides can be used with artifact dependencies, there's no profile option for setting the linker flavor</p>



<a name="275811595"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/linker-flavor%20in%20build%20scripts/near/275811595" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/linker-flavor.20in.20build.20scripts.html#275811595">(Mar 18 2022 at 14:42)</a>:</h4>
<p>I do see that there's a new unstable profile section called rustflags that lets us pass in arbitrary compiler options</p>



<a name="275812370"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/linker-flavor%20in%20build%20scripts/near/275812370" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/linker-flavor.20in.20build.20scripts.html#275812370">(Mar 18 2022 at 14:48)</a>:</h4>
<p>The use case is at the intersection of several unstable options and there interactions have not been fully thought threw.</p>



<a name="275834858"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/linker-flavor%20in%20build%20scripts/near/275834858" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/linker-flavor.20in.20build.20scripts.html#275834858">(Mar 18 2022 at 17:16)</a>:</h4>
<p><span class="user-mention" data-user-id="256342">@bstrie</span> In the past, we have had one overall program link (not counting cdylibs and similar), and we don't want a dependency to be able to affect the link of the overall program.</p>
<p>Now that we have artifact dependencies, several things that didn't make sense before now do make sense at the boundary of an artifact dependency.</p>



<a name="275849386"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/linker-flavor%20in%20build%20scripts/near/275849386" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/linker-flavor.20in.20build.20scripts.html#275849386">(Mar 18 2022 at 19:10)</a>:</h4>
<p>yeah, I'm interested to push the boundaries of artifact dependencies since my company sponsored the work on it, so of all people we should be testing it out :P</p>



<a name="275849439"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/linker-flavor%20in%20build%20scripts/near/275849439" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/linker-flavor.20in.20build.20scripts.html#275849439">(Mar 18 2022 at 19:10)</a>:</h4>
<p>however, in this case the <em>actual</em> solution is to rewrite this linker script so that LLD doesn't choke on it, I was just trying to be lazy :P</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>