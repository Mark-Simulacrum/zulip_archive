<html>
<head><meta charset="utf-8"><title>toml_edit testing · t-cargo · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/index.html">t-cargo</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/toml_edit.20testing.html">toml_edit testing</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="263954437"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/toml_edit%20testing/near/263954437" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/toml_edit.20testing.html#263954437">(Dec 07 2021 at 03:26)</a>:</h4>
<p><span class="user-mention" data-user-id="424212">@Ed Page</span> I forgot to tell you, I tested toml_edit against every TOML file ever published to <a href="http://crates.io">crates.io</a> against the toml crate, and the only issues I found were the two that I opened.</p>
<p>I also wanted to mention that there is now a benchmark suite for cargo. There is documentation at <a href="https://github.com/rust-lang/cargo/tree/master/benches">https://github.com/rust-lang/cargo/tree/master/benches</a> on how to use it.  I think it would be good to use for comparing performance differences with toml_edit.  I think the <code>resolve_ws</code> benchmark would be a reasonable test to see if there is any impact. That runs the resolver and parses every <code>Cargo.toml</code> in the dependency tree, which I think will be the main place where performance changes might show up.</p>



<a name="263993285"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/toml_edit%20testing/near/263993285" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ed Page <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/toml_edit.20testing.html#263993285">(Dec 07 2021 at 12:27)</a>:</h4>
<p>Wow, thanks for that testing! I'm impressed there were no more compliance issues found due to little differences in two implementations. I think thats a s strong testament to toml-rs' testing!</p>
<p>What was your approach, so I can be more ready to do that in the future?</p>



<a name="263993480"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/toml_edit%20testing/near/263993480" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ed Page <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/toml_edit.20testing.html#263993480">(Dec 07 2021 at 12:29)</a>:</h4>
<p>And I'm grateful for the benchmarks! I followed their development closely. Clap 3's rc0 is being released this week which will hopefully free me up to finish getting cargo's tests passing with toml_edit, and then ill get back to performance.</p>



<a name="264034986"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/toml_edit%20testing/near/264034986" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/toml_edit.20testing.html#264034986">(Dec 07 2021 at 17:15)</a>:</h4>
<p>I have a script that downloads every crate file. It is rather primitive, so not worth sharing, but it essentially iterates over every JSON line in the <a href="https://github.com/rust-lang/crates.io-index">crates.io-index</a> and prints the url <a href="https://static.crates.io/crates/{name}/{name}-{version}.crate">https://static.crates.io/crates/{name}/{name}-{version}.crate</a> (skipping ones already downloaded). Then I use wget to download them all.</p>
<p><a href="https://gist.github.com/ehuss/c1e7c263468a469b2079ca658400e630">Here</a> is the comparison script I used.</p>



<a name="264035220"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/toml_edit%20testing/near/264035220" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/toml_edit.20testing.html#264035220">(Dec 07 2021 at 17:16)</a>:</h4>
<p>You should probably test <code>Cargo.toml.orig</code> instead of <code>Cargo.toml</code>. <code>Cargo.toml</code> is normalized and as such unlikely to hit edge cases in parsers.</p>



<a name="264035273"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/toml_edit%20testing/near/264035273" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/toml_edit.20testing.html#264035273">(Dec 07 2021 at 17:17)</a>:</h4>
<p>It should do that: <code>if name.ends_with(".toml") || name.ends_with(".toml.orig") || name == "Cargo.lock" {</code></p>



<a name="264035297"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/toml_edit%20testing/near/264035297" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/toml_edit.20testing.html#264035297">(Dec 07 2021 at 17:17)</a>:</h4>
<p><span class="user-mention" data-user-id="120518">@Eric Huss</span> Roughly how much disk space does the set of all <code>.crate</code> files use? (And, if it's easy to get, how much does the set of all the newest versions alone use?)</p>



<a name="264035387"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/toml_edit%20testing/near/264035387" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/toml_edit.20testing.html#264035387">(Dec 07 2021 at 17:17)</a>:</h4>
<p><span class="user-mention silent" data-user-id="120518">Eric Huss</span> <a href="#narrow/stream/246057-t-cargo/topic/toml_edit.20testing/near/264035273">said</a>:</p>
<blockquote>
<p>It should do that: <code>if name.ends_with(".toml") || name.ends_with(".toml.orig") || name == "Cargo.lock" {</code></p>
</blockquote>
<p>missed that</p>



<a name="264035515"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/toml_edit%20testing/near/264035515" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/toml_edit.20testing.html#264035515">(Dec 07 2021 at 17:18)</a>:</h4>
<p>From what I recall from someone else downloading them all like 50GB I believe for all newest versions.</p>



<a name="264035533"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/toml_edit%20testing/near/264035533" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/toml_edit.20testing.html#264035533">(Dec 07 2021 at 17:18)</a>:</h4>
<p>The current size of all <code>.crate</code> files is 38G.</p>



<a name="264035568"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/toml_edit%20testing/near/264035568" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/toml_edit.20testing.html#264035568">(Dec 07 2021 at 17:18)</a>:</h4>
<p>only the latest ones maybe?</p>



<a name="264035589"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/toml_edit%20testing/near/264035589" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/toml_edit.20testing.html#264035589">(Dec 07 2021 at 17:19)</a>:</h4>
<p>iirc the full set is around 60-70gb nowadays</p>



<a name="264035754"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/toml_edit%20testing/near/264035754" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/toml_edit.20testing.html#264035754">(Dec 07 2021 at 17:20)</a>:</h4>
<p>The size of the latest versions uncompressed is 37G for me.</p>



<a name="264035773"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/toml_edit%20testing/near/264035773" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/toml_edit.20testing.html#264035773">(Dec 07 2021 at 17:20)</a>:</h4>
<p>oh that makes sense, yeah</p>



<a name="264035782"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/toml_edit%20testing/near/264035782" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/toml_edit.20testing.html#264035782">(Dec 07 2021 at 17:20)</a>:</h4>
<p>May <span class="user-mention" data-user-id="121055">@Pietro Albini</span> is referring to crater's size?</p>



<a name="264035819"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/toml_edit%20testing/near/264035819" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/toml_edit.20testing.html#264035819">(Dec 07 2021 at 17:20)</a>:</h4>
<p>crater has a much larger set</p>



<a name="264035837"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/toml_edit%20testing/near/264035837" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/toml_edit.20testing.html#264035837">(Dec 07 2021 at 17:20)</a>:</h4>
<p><em>all</em> of crater with all the git repos is huge, don't even know how large it is <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="264035889"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/toml_edit%20testing/near/264035889" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/toml_edit.20testing.html#264035889">(Dec 07 2021 at 17:21)</a>:</h4>
<p>I was talking about all the <code>.crate</code> compressed tarballs for all the versions ever published</p>



<a name="264035922"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/toml_edit%20testing/near/264035922" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/toml_edit.20testing.html#264035922">(Dec 07 2021 at 17:21)</a>:</h4>
<p>(the equivalent of <code>aws s3 cp s3://crates-io/crates .</code>)</p>



<a name="266575024"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/toml_edit%20testing/near/266575024" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dirkjan Ochtman <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/toml_edit.20testing.html#266575024">(Jan 01 2022 at 21:01)</a>:</h4>
<p><span class="user-mention" data-user-id="424212">@Ed Page</span> BTW I did find recently that <code>cargo upgrade</code> rewrote <code>serde = { version = "1.0.131" }</code> into <code>serde = "1.0.131"</code>. Maybe it'd be better preserving the original to minimize unintended changes in diffs? (On the one hand I usually also prefer the compact spelling -- on the other, I prefer not having unrelated formatting changes creep into dependency upgrade commits.)</p>



<a name="266584338"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/toml_edit%20testing/near/266584338" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ed Page <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/toml_edit.20testing.html#266584338">(Jan 02 2022 at 00:20)</a>:</h4>
<p>That is a bug. Please open an issue if there isn't one.</p>



<a name="266584359"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/toml_edit%20testing/near/266584359" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ed Page <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/toml_edit.20testing.html#266584359">(Jan 02 2022 at 00:20)</a>:</h4>
<p>(against cargo-upgrade)</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>