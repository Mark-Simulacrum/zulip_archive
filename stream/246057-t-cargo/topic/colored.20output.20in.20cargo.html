<html>
<head><meta charset="utf-8"><title>colored output in cargo · t-cargo · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/index.html">t-cargo</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/colored.20output.20in.20cargo.html">colored output in cargo</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="273269539"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/colored%20output%20in%20cargo/near/273269539" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ed Page <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/colored.20output.20in.20cargo.html#273269539">(Feb 25 2022 at 18:53)</a>:</h4>
<p>In cargo-add, I recently added support for displaying all features of the crate being added with a green <code>+</code> for those activated and a red <code>-</code> for those that aren't.  In looking to preserve this, I've been digging into cargo's output handling.</p>
<p>It seems like nearly all cargo output goes through <code>Shell</code> which helps centralize decisions, like log levels and whether to use color.  This allows coloring a status but it doesn't seem like there is much in the way of supporting color in the message.</p>
<p><a href="https://github.com/rust-lang/cargo/pull/10116/files">#10116</a> also looked at adding coloring to messages by baking in search-specific formatting into <code>Shell</code>.</p>
<p>There been any thoughts on exposing more details so people can have richer output?  Or should I just give up for now and not have any coloring besides the built-in status field?</p>



<a name="273272572"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/colored%20output%20in%20cargo/near/273272572" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/colored.20output.20in.20cargo.html#273272572">(Feb 25 2022 at 19:15)</a>:</h4>
<p>I don't think we've had any discussions on that topic. I like the idea of generalizing the mechanism a little. But I also don't think we should block on it.</p>



<a name="273275055"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/colored%20output%20in%20cargo/near/273275055" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ed Page <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/colored.20output.20in.20cargo.html#273275055">(Feb 25 2022 at 19:36)</a>:</h4>
<p>Yeah, I've gone ahead and removed the extra coloring for now so I can continue to make progress.</p>



<a name="273275280"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/colored%20output%20in%20cargo/near/273275280" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ed Page <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/colored.20output.20in.20cargo.html#273275280">(Feb 25 2022 at 19:38)</a>:</h4>
<p>Depending on where we are with supporting older windows, if we just supported ANSI or had an ANSI to old windows API compat filter, we could just have the <code>status</code>, <code>warn</code>, etc functions accepted formatted text and strip the codes.  Kind of a applying  <code>print_ansi_stdout</code> to the rest of the API.</p>



<a name="273279211"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/colored%20output%20in%20cargo/near/273279211" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/colored.20output.20in.20cargo.html#273279211">(Feb 25 2022 at 20:15)</a>:</h4>
<p><span class="user-mention" data-user-id="424212">@Ed Page</span> I <em>personally</em> would be in favor of just supporting the ANSI case, which would allow us to make the assumption that formatting is a thing that can be baked into a string rather than applied at output time.</p>



<a name="273279223"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/colored%20output%20in%20cargo/near/273279223" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/colored.20output.20in.20cargo.html#273279223">(Feb 25 2022 at 20:15)</a>:</h4>
<p>Assuming that makes things simpler.</p>



<a name="273287414"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/colored%20output%20in%20cargo/near/273287414" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/colored.20output.20in.20cargo.html#273287414">(Feb 25 2022 at 21:32)</a>:</h4>
<p><a href="https://github.com/rust-lang/cargo/pull/10116#issuecomment-1010227769">https://github.com/rust-lang/cargo/pull/10116#issuecomment-1010227769</a> contains some thoughts on generalizing the API to better support color.  I think it would be great to have some kind of API to make it easier to display arbitrarily colored output.  I'm reluctant to bring in a separate package to handle it, so if you can come up with a simple API that handles it, that would be preferable. But if it ends up being too awkward, we can definitely consider some external package.  There are a few packages that have much more natural APIs, like <code>colored</code> and a few others.</p>
<p>I'm not sure I follow what you mean about using ANSI formatted text.  If it's possible to just feed the color specs into Shell, then I don't think there would be a need to worry about that.  We can definitely have degraded support for older Windows, but I'm not sure if that is really necessary. </p>
<p>We do have <code>fwdansi</code> (which can do some basic ANSI translations) and <code>strip-ansi-escapes</code> (to remove them entirely). So we can use those if necessary, but that seems a little roundabout to me.</p>



<a name="273288863"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/colored%20output%20in%20cargo/near/273288863" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ed Page <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/colored.20output.20in.20cargo.html#273288863">(Feb 25 2022 at 21:47)</a>:</h4>
<p>A <code>write_stdout</code> isn't all that ergonomic, losing out on our ability to use <code>write!</code> (<code>termcolor</code>is already a bit annoying to work with and it does work with <code>write!</code>).</p>
<p>If we could only support ANSI and drop the old Windows color API (or if it can take the hit of us always using <code>fwdansi</code>), that'd make all of this a lot easier with crates like <a href="https://docs.rs/owo-colors/latest/owo_colors/">owo-colors</a> or yansi.  if not, I can understand and work on <code>write_stdout</code> instead.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>