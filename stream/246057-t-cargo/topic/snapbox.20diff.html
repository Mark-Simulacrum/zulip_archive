<html>
<head><meta charset="utf-8"><title>snapbox diff · t-cargo · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/index.html">t-cargo</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/snapbox.20diff.html">snapbox diff</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="274776991"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/snapbox%20diff/near/274776991" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/snapbox.20diff.html#274776991">(Mar 10 2022 at 01:10)</a>:</h4>
<blockquote>
<p>Without converting all at once, we can switch cargo-test-supports diff to using the same style as snapbox</p>
</blockquote>
<p><span class="user-mention" data-user-id="424212">@Ed Page</span> I'm curious how that might work. When I wrote the existing diff, I found I couldn't use any of the existing libraries because they couldn't handle wildcards.  It also handles unordered output.   How would that work?</p>



<a name="274777339"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/snapbox%20diff/near/274777339" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ed Page <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/snapbox.20diff.html#274777339">(Mar 10 2022 at 01:13)</a>:</h4>
<p>So the diffing itself is wildcard aware?  I hadn't realized that so maybe we can't do that but would have to handle things a step further and switch the match assertion to snapbox.  In snapbox, it uses the expected result as a guide for replacing content in the actual result so that we can jut do a straight diff (and so when we overwrite snapshots, we save it with wildcards)</p>



<a name="274778312"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/snapbox%20diff/near/274778312" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/snapbox.20diff.html#274778312">(Mar 10 2022 at 01:26)</a>:</h4>
<p>We could perhaps consider something like that.  From what I can see from checking the docs, it doesn't seem like snapbox has the same kind of matching support, though.  Are you suggesting to extend it to handle all the same match kinds?</p>



<a name="274785503"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/snapbox%20diff/near/274785503" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ed Page <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/snapbox.20diff.html#274785503">(Mar 10 2022 at 03:32)</a>:</h4>
<p>Unless I missed something in <code>cargo-test-support</code> it is similar though slightly different</p>
<ul>
<li><code>[..]</code> matches like <code>[^\n]*</code></li>
<li><code>\n...\n</code> matches any number of whole lines</li>
<li>User-defined variable with <code>[VAR]</code> which looks the same but there might be some small, rare differences.</li>
</ul>
<p>Unless I missed something, it seems like it'd be relatively easy to switch the tests from one match syntax to the other.</p>



<a name="274786461"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/snapbox%20diff/near/274786461" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/snapbox.20diff.html#274786461">(Mar 10 2022 at 03:53)</a>:</h4>
<p>I was thinking more along with how would <a href="https://github.com/rust-lang/cargo/blob/56ccd1f1c79ebfea331a5b7a2effd210e5c9b4db/crates/cargo-test-support/src/compare.rs#L196-L244"><code>match_unordered</code></a> and the various other variants work?</p>



<a name="274846759"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/snapbox%20diff/near/274846759" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ed Page <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/snapbox.20diff.html#274846759">(Mar 10 2022 at 15:03)</a>:</h4>
<p>I forgot to call otu that case.  I still need to dig into it to understand the motivation and how to be handling it if, in the theoretical case all of cargo switched to snapbox.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>