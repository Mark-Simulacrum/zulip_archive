<html>
<head><meta charset="utf-8"><title>Handling Windows-reserved paths · t-cargo · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/index.html">t-cargo</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Handling.20Windows-reserved.20paths.html">Handling Windows-reserved paths</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="274437425"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Handling%20Windows-reserved%20paths/near/274437425" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eholk <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Handling.20Windows-reserved.20paths.html#274437425">(Mar 07 2022 at 18:35)</a>:</h4>
<p>Hi all (but particularly <span class="user-mention" data-user-id="239881">@Josh Triplett</span> and <span class="user-mention" data-user-id="120518">@Eric Huss</span>), I wanted to start a thread here to discuss two PRs I have open (<a href="https://github.com/rust-lang/rust/issues/10461">#10461</a> and <a href="https://github.com/rust-lang/rust/issues/10322">#10322</a>). Both of them solve the problem I have (the <code>package::reserved_windows_name</code> test fails on recent Windows versions), but they do have rather different implications.</p>
<p><a href="https://github.com/rust-lang/rust/issues/10322">#10322</a> fixes the problem by adding a runtime test on Windows to see whether reserved names are actually allowed and gates the test on that result. This seems consistent with existing behavior, where there are packages that work on most platforms but cannot be unpacked on Windows.</p>
<p><a href="https://github.com/rust-lang/rust/issues/10461">#10461</a> fixes the problem by instead making path names like <code>aux.rs</code> unable to be unpacked on any platform. The advantage of this is that it means Cargo has consistent behavior on all supported platforms. It is also somewhat in the spirit of the warning you current get when you try to create a package with a reserved Windows name.</p>
<p>I can see arguments for both approaches, but overall I'm most in favor of <a href="https://github.com/rust-lang/rust/issues/10322">#10322</a>. It's completely reasonable that a package may not be able to run or supported on Windows, so in that case it seems unnecessary and undesirable to restrict what would otherwise be perfectly valid filenames. There is already a warning, which seems reasonable, but it doesn't seem necessary to make this warning into a hard error given that doing so may break existing packages. It also seems counter-intuitive to make Cargo more restrictive as a result of Windows becoming more permissive.</p>
<p>Anyway, I'm happy to go with whatever the Cargo team thinks is best, but I wanted to at least state my opinion and open the discussion given that it seems there was some disagreement on the right approach here.</p>



<a name="274452413"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Handling%20Windows-reserved%20paths/near/274452413" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Handling.20Windows-reserved.20paths.html#274452413">(Mar 07 2022 at 20:26)</a>:</h4>
<p>My primary reason for originally suggesting the approach of prohibiting it on all platforms was that that would be consistent with what <a href="http://crates.io">crates.io</a> did. My secondary reason was that it had seemed odd to me for a test of that prohibition by the OS to first test that same prohibition empirically; that had seemed circular to me.</p>
<p>However, reconsidering the latter point, it may not actually be circular to do so, as long as the testing of the OS's prohibition is not using the same actually the same as what Cargo uses internally.</p>



<a name="274452501"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Handling%20Windows-reserved%20paths/near/274452501" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Handling.20Windows-reserved.20paths.html#274452501">(Mar 07 2022 at 20:27)</a>:</h4>
<p>I'm not opposed to going back to the original approach and letting cargo unpack these filenames on all platforms that support them.</p>



<a name="274453468"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Handling%20Windows-reserved%20paths/near/274453468" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Handling.20Windows-reserved.20paths.html#274453468">(Mar 07 2022 at 20:35)</a>:</h4>
<p>I've closed the new PR and requested one minor change to the original PR. Does that change sound reasonable?</p>



<a name="274457805"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Handling%20Windows-reserved%20paths/near/274457805" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eholk <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Handling.20Windows-reserved.20paths.html#274457805">(Mar 07 2022 at 21:09)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/246057-t-cargo/topic/Handling.20Windows-reserved.20paths/near/274452413">said</a>:</p>
<blockquote>
<p>However, reconsidering the latter point, it may not actually be circular to do so, as long as the testing of the OS's prohibition is not using the same actually the same as what Cargo uses internally.</p>
</blockquote>
<p>I agree, it did seem weird to be like "if this test will work, then run the test." Ideally I would have done something like <code>#[cfg(windows, version &lt; 11.whatever)]</code>, but we don't really have a way to do that with <code>cfg</code> and I don't think this behavior has a version number associated with it that we could check. I asked the dev who made the change and Windows and this was the approach he recommended for detecting whether the OS had the new or old behavior.</p>



<a name="274457950"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Handling%20Windows-reserved%20paths/near/274457950" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eholk <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Handling.20Windows-reserved.20paths.html#274457950">(Mar 07 2022 at 21:10)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/246057-t-cargo/topic/Handling.20Windows-reserved.20paths/near/274453468">said</a>:</p>
<blockquote>
<p>I've closed the new PR and requested one minor change to the original PR. Does that change sound reasonable?</p>
</blockquote>
<p>Yup, that seems reasonable! I'll make the change and update the PR.</p>



<a name="274465106"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Handling%20Windows-reserved%20paths/near/274465106" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Handling.20Windows-reserved.20paths.html#274465106">(Mar 07 2022 at 22:05)</a>:</h4>
<p>Thanks for articulating that; yeah, "if this test will work, then run the test" was roughly my initial reaction to the original PR. ;)</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>