<html>
<head><meta charset="utf-8"><title>Should cargo suggest .toml  changes based on Cargo.lock ? · t-cargo · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/index.html">t-cargo</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Should.20cargo.20suggest.20.2Etoml.20.20changes.20based.20on.20Cargo.2Elock.20.3F.html">Should cargo suggest .toml  changes based on Cargo.lock ?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="254726429"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Should%20cargo%20suggest%20.toml%20%20changes%20based%20on%20Cargo.lock%20%3F/near/254726429" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Should.20cargo.20suggest.20.2Etoml.20.20changes.20based.20on.20Cargo.2Elock.20.3F.html#254726429">(Sep 24 2021 at 15:53)</a>:</h4>
<p>I don’t know about you all, but a common pattern for me, when I plug in a reference to an external crate in my source (e.g. <code>url</code>) and it ends up unresolved, is I jump right to <code>Cargo.lock</code> to find out what version I <em>already</em> have due to upstream dependencies.</p>



<a name="254726582"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Should%20cargo%20suggest%20.toml%20%20changes%20based%20on%20Cargo.lock%20%3F/near/254726582" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Should.20cargo.20suggest.20.2Etoml.20.20changes.20based.20on.20Cargo.2Elock.20.3F.html#254726582">(Sep 24 2021 at 15:54)</a>:</h4>
<p>This morning I had the thought: Could <code>rustc</code> to do this for me? But that quickly turned into: “Wait, doesn’t a change like this ‘obviously’ belong in <code>cargo</code> ?"</p>



<a name="254726741"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Should%20cargo%20suggest%20.toml%20%20changes%20based%20on%20Cargo.lock%20%3F/near/254726741" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Should.20cargo.20suggest.20.2Etoml.20.20changes.20based.20on.20Cargo.2Elock.20.3F.html#254726741">(Sep 24 2021 at 15:55)</a>:</h4>
<p><code>cargo tree</code> and grep should work.</p>



<a name="254726748"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Should%20cargo%20suggest%20.toml%20%20changes%20based%20on%20Cargo.lock%20%3F/near/254726748" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Should.20cargo.20suggest.20.2Etoml.20.20changes.20based.20on.20Cargo.2Elock.20.3F.html#254726748">(Sep 24 2021 at 15:55)</a>:</h4>
<p>The main issue I could imagine is that <code>cargo</code> would need to infer when to make such suggestions. But we already have precedent for feeding information from <code>rustc</code> up to <code>cargo</code>, such as the report-future-incompat support.  I could see this being implemented as an instance of that.</p>



<a name="254726816"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Should%20cargo%20suggest%20.toml%20%20changes%20based%20on%20Cargo.lock%20%3F/near/254726816" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Should.20cargo.20suggest.20.2Etoml.20.20changes.20based.20on.20Cargo.2Elock.20.3F.html#254726816">(Sep 24 2021 at 15:55)</a>:</h4>
<p><span class="user-mention" data-user-id="120179">@Eh2406</span> right, but I’m saying the UX could be that you get the suggestion straight from <code>cargo build</code> diagnostics.</p>



<a name="254727014"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Should%20cargo%20suggest%20.toml%20%20changes%20based%20on%20Cargo.lock%20%3F/near/254727014" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Should.20cargo.20suggest.20.2Etoml.20.20changes.20based.20on.20Cargo.2Elock.20.3F.html#254727014">(Sep 24 2021 at 15:57)</a>:</h4>
<p>Can someone convince me this is <em>not</em> a good idea? The main counter argument I can imagine is “No, the workflow shouldn’t be to extract it from Cargo.lock. Its important that we encourage the user to visit <code>crates.io</code> and see what versions are available.” ?</p>



<a name="254729965"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Should%20cargo%20suggest%20.toml%20%20changes%20based%20on%20Cargo.lock%20%3F/near/254729965" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Should.20cargo.20suggest.20.2Etoml.20.20changes.20based.20on.20Cargo.2Elock.20.3F.html#254729965">(Sep 24 2021 at 16:14)</a>:</h4>
<p>Hm, I'm a little uncertain -- when you say jump into Cargo.lock, you sort of imply that dep is already there?</p>



<a name="254730067"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Should%20cargo%20suggest%20.toml%20%20changes%20based%20on%20Cargo.lock%20%3F/near/254730067" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Should.20cargo.20suggest.20.2Etoml.20.20changes.20based.20on.20Cargo.2Elock.20.3F.html#254730067">(Sep 24 2021 at 16:14)</a>:</h4>
<p>cargo-edit I think today is the pretty standard solution for "add this crate name at the latest version"</p>



<a name="254735919"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Should%20cargo%20suggest%20.toml%20%20changes%20based%20on%20Cargo.lock%20%3F/near/254735919" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ed Page <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Should.20cargo.20suggest.20.2Etoml.20.20changes.20based.20on.20Cargo.2Elock.20.3F.html#254735919">(Sep 24 2021 at 16:53)</a>:</h4>
<p><a href="https://github.com/killercup/cargo-edit/issues/41">https://github.com/killercup/cargo-edit/issues/41</a> is the issue for using the latest from the lock file, rather than the latest from the registry</p>



<a name="254737866"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Should%20cargo%20suggest%20.toml%20%20changes%20based%20on%20Cargo.lock%20%3F/near/254737866" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Should.20cargo.20suggest.20.2Etoml.20.20changes.20based.20on.20Cargo.2Elock.20.3F.html#254737866">(Sep 24 2021 at 17:04)</a>:</h4>
<p>this sounds like a great idea to me, we could say something like "you could try adding <code>foo = "0.1.3"</code> to your <code>Cargo.lock</code>" and in the future something along the lines of "try running <code>cargo add foo</code>" or something like that</p>



<a name="254737899"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Should%20cargo%20suggest%20.toml%20%20changes%20based%20on%20Cargo.lock%20%3F/near/254737899" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Should.20cargo.20suggest.20.2Etoml.20.20changes.20based.20on.20Cargo.2Elock.20.3F.html#254737899">(Sep 24 2021 at 17:04)</a>:</h4>
<p>I find myself also doing this all the time (rooting around cargo.lock to find the version)</p>



<a name="254778254"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Should%20cargo%20suggest%20.toml%20%20changes%20based%20on%20Cargo.lock%20%3F/near/254778254" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jon Gjengset <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Should.20cargo.20suggest.20.2Etoml.20.20changes.20based.20on.20Cargo.2Elock.20.3F.html#254778254">(Sep 24 2021 at 21:52)</a>:</h4>
<p>I honestly had never thought to look (grep?) in <code>Cargo.lock</code> for the version rather than going to <a href="http://docs.rs/&lt;crate-name">docs.rs/&lt;crate-name</a>&gt; and just writing in the version from there. But may start doing so now to save myself the trip to the browser :p It's not _clear_ it's faster though — in my setup:</p>
<ol>
<li>Alt+1, Ctrl+t, <a href="http://docs.rs/url">docs.rs/url</a> + &lt;enter&gt;</li>
<li><code>rg -A1 'name = "url"' Cargo.lock</code></li>
</ol>
<p>Both in terms of keystrokes and complexity, I think 1) wins out. It does incur a network trip though, which is unfortunate. Could set up a shell alias pretty easily, though that's definitely a power-user thing to do. And in that case I might just make it <code>curl https://crates.io/api/v1/crates/url | jq -r .crate.max_stable_version</code> given that that works even if the crate in question _isn't_ in <code>Cargo.lock</code>.</p>
<p>That's a long way of saying I like the idea of Cargo just telling me what version I should try so I don't have to check it myself. But I would _like_ it to be able to make a suggestion even if the crate _isn't_ in the dependency closure already. I think it may also be worthwhile to have it inform you what the latest version in <code>Cargo.lock</code> is _and_ what the latest version on <a href="http://crates.io">crates.io</a> if they differ, so that you can make an intentional choice about whether to move on to a later major version.</p>



<a name="254812128"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Should%20cargo%20suggest%20.toml%20%20changes%20based%20on%20Cargo.lock%20%3F/near/254812128" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dirkjan Ochtman <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Should.20cargo.20suggest.20.2Etoml.20.20changes.20based.20on.20Cargo.2Elock.20.3F.html#254812128">(Sep 25 2021 at 05:56)</a>:</h4>
<p>I rely on <a href="https://marketplace.visualstudio.com/items?itemName=serayuzgur.crates">https://marketplace.visualstudio.com/items?itemName=serayuzgur.crates</a> a lot</p>



<a name="254970012"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Should%20cargo%20suggest%20.toml%20%20changes%20based%20on%20Cargo.lock%20%3F/near/254970012" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Should.20cargo.20suggest.20.2Etoml.20.20changes.20based.20on.20Cargo.2Elock.20.3F.html#254970012">(Sep 26 2021 at 23:09)</a>:</h4>
<p><span class="user-mention" data-user-id="120054">@Jon Gjengset</span> That sounds like a feature that should be integrated with cargo-add/cargo-upgrade.</p>



<a name="255215942"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Should%20cargo%20suggest%20.toml%20%20changes%20based%20on%20Cargo.lock%20%3F/near/255215942" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Should.20cargo.20suggest.20.2Etoml.20.20changes.20based.20on.20Cargo.2Elock.20.3F.html#255215942">(Sep 28 2021 at 13:28)</a>:</h4>
<p><span class="user-mention" data-user-id="120054">@Jon Gjengset</span> your analysis of  which method is “faster” omits one important detail, I think: Using the version from the <code>Cargo.lock</code> should mean that you can immediately use the source and build products that you already have sitting around. I do agree that it would be good for the system to suggest that I might want to choose a newer version if available, but there are plenty of times where all I care about is the quickest turn-around to a new build of my app.</p>



<a name="255216099"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Should%20cargo%20suggest%20.toml%20%20changes%20based%20on%20Cargo.lock%20%3F/near/255216099" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Should.20cargo.20suggest.20.2Etoml.20.20changes.20based.20on.20Cargo.2Elock.20.3F.html#255216099">(Sep 28 2021 at 13:29)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116122">simulacrum</span> <a href="#narrow/stream/246057-t-cargo/topic/Should.20cargo.20suggest.20.2Etoml.20.20changes.20based.20on.20Cargo.2Elock.20.3F/near/254729965">said</a>:</p>
<blockquote>
<p>Hm, I'm a little uncertain -- when you say jump into Cargo.lock, you sort of imply that dep is already there?</p>
</blockquote>
<p>And to be clear: Yeah, I’m talking about cases where I’m turning an indirect dependency into a direct dependency.</p>



<a name="255266401"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Should%20cargo%20suggest%20.toml%20%20changes%20based%20on%20Cargo.lock%20%3F/near/255266401" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jon Gjengset <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Should.20cargo.20suggest.20.2Etoml.20.20changes.20based.20on.20Cargo.2Elock.20.3F.html#255266401">(Sep 28 2021 at 17:48)</a>:</h4>
<p>Oh, absolutely — though I also wonder how common it is that using the major version of the latest release _isn't_ what you want (and what's already in your dependency closure).</p>



<a name="255274813"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Should%20cargo%20suggest%20.toml%20%20changes%20based%20on%20Cargo.lock%20%3F/near/255274813" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Wagner-Hall <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Should.20cargo.20suggest.20.2Etoml.20.20changes.20based.20on.20Cargo.2Elock.20.3F.html#255274813">(Sep 28 2021 at 18:35)</a>:</h4>
<p>I occasionally do this manually, though it tends to be "grep for the dep used by some other crate in my workspace", and it's not unusual for my workspace to be a release or two behind the latest release</p>



<a name="255274904"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Should%20cargo%20suggest%20.toml%20%20changes%20based%20on%20Cargo.lock%20%3F/near/255274904" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Wagner-Hall <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Should.20cargo.20suggest.20.2Etoml.20.20changes.20based.20on.20Cargo.2Elock.20.3F.html#255274904">(Sep 28 2021 at 18:36)</a>:</h4>
<p>Though maybe that points are wanting a workplace-level dep value</p>



<a name="255275474"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Should%20cargo%20suggest%20.toml%20%20changes%20based%20on%20Cargo.lock%20%3F/near/255275474" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ed Page <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Should.20cargo.20suggest.20.2Etoml.20.20changes.20based.20on.20Cargo.2Elock.20.3F.html#255275474">(Sep 28 2021 at 18:39)</a>:</h4>
<p><a href="https://github.com/rust-lang/cargo/issues/8415">https://github.com/rust-lang/cargo/issues/8415</a> would be real nice for this.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>