<html>
<head><meta charset="utf-8"><title>cargo-api · t-cargo · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/index.html">t-cargo</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/cargo-api.html">cargo-api</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="273278409"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/cargo-api/near/273278409" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jon Gjengset <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/cargo-api.html#273278409">(Feb 25 2022 at 20:07)</a>:</h4>
<p>Writing &lt;<a href="https://github.com/rust-lang/cargo/pull/10414">https://github.com/rust-lang/cargo/pull/10414</a>&gt; got me thinking — is there an at-all-reasonable path towards finding a _stable_ library API for Cargo? It'd obviously be a _lot_ of work, and we may need an escape hatch (something like an <code>unstable</code> sub-module with all the things that haven't been polished yet), but I'm wondering whether the Cargo team thinks it may even be feasible at all?</p>



<a name="273278655"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/cargo-api/near/273278655" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ed Page <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/cargo-api.html#273278655">(Feb 25 2022 at 20:09)</a>:</h4>
<p>Brought this up before.  imo part of this would be breaking things out into smaller libraries but because the cargo repo doesn't have a workspace, relying on the rust workspace, it makes scaling to multiple crates more costly.</p>



<a name="273278738"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/cargo-api/near/273278738" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ed Page <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/cargo-api.html#273278738">(Feb 25 2022 at 20:10)</a>:</h4>
<p>Theres also downsides to using cargo directly (locked into a specific manifest parser version vs calling cargo-metadata).  Seems like the better short term route is to expose programmatic cargo commands.</p>



<a name="273278775"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/cargo-api/near/273278775" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ed Page <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/cargo-api.html#273278775">(Feb 25 2022 at 20:10)</a>:</h4>
<p>My past thread on this<br>
<a href="#narrow/stream/246057-t-cargo/topic/Towards.20a.20modular.20.60cargo.60.20crate">https://rust-lang.zulipchat.com/#narrow/stream/246057-t-cargo/topic/Towards.20a.20modular.20.60cargo.60.20crate</a></p>



<a name="273280429"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/cargo-api/near/273280429" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jon Gjengset <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/cargo-api.html#273280429">(Feb 25 2022 at 20:27)</a>:</h4>
<p>Ah, yet more proof why nested workspaces would be great :p</p>



<a name="273282046"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/cargo-api/near/273282046" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/cargo-api.html#273282046">(Feb 25 2022 at 20:38)</a>:</h4>
<p>Why, are you offering to work on it?</p>



<a name="273283539"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/cargo-api/near/273283539" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ed Page <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/cargo-api.html#273283539">(Feb 25 2022 at 20:52)</a>:</h4>
<p>For my own edification, why is cargo a submodule of and a workspace member of rust rather than being a git dependency or being standalone? Not yet seen those parts of the process.</p>



<a name="273284313"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/cargo-api/near/273284313" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/cargo-api.html#273284313">(Feb 25 2022 at 20:59)</a>:</h4>
<ol>
<li>git dependencies don't work for binaries</li>
<li>git dependencies don't allow running tests</li>
<li>rust can't have git dependencies as all dependencies need to be vendored for the source tarball to be able to compile offline. this doesn't work for git dependencies. (there is a single git dependency at the moment due to cg_clif, but cg_clif is currently only built when using x.py check, not x.py build. still it is something that should be fixed. i'm currently working on this.)</li>
</ol>



<a name="273284699"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/cargo-api/near/273284699" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/cargo-api.html#273284699">(Feb 25 2022 at 21:03)</a>:</h4>
<p>in terms of not being standalone (i.e., submodule but with its own lockfile) -- we want to unify versions with RLS (and clippy?) which depend on cargo to avoid extra CI time. (At least this is my recollection).</p>



<a name="273287726"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/cargo-api/near/273287726" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/cargo-api.html#273287726">(Feb 25 2022 at 21:35)</a>:</h4>
<p>It also not just the nested workspaces, although that is a big part.  If there are more packages, that also means more management in terms of reviewing for breaking API changes and more complicated version bumps.</p>
<p>My opinion is that it is preferable to use the CLI if at all possible. Using cargo as a library is often going to be a bad experience for users and developers.  If the CLI is not providing the information needed, then it would be good to discuss exposing what is needed.</p>



<a name="273290401"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/cargo-api/near/273290401" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jon Gjengset <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/cargo-api.html#273290401">(Feb 25 2022 at 22:01)</a>:</h4>
<p>Yeah, my use-case is probably particularly weird, in that I need to do things like _just_ run the resolver without doing any network downloads to construct a local registry on-the-fly. I'm hoping to make it less weird to the point where I can just lightly wrap the CLI, but it's a bit of a journey to get there.</p>



<a name="273290818"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/cargo-api/near/273290818" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/cargo-api.html#273290818">(Feb 25 2022 at 22:05)</a>:</h4>
<p>Note that the pubgrub project is, in part, to make a reusable library for cargos resolver. Not that that is on a timeline that helps you.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>