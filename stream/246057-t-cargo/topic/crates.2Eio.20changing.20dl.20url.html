<html>
<head><meta charset="utf-8"><title>crates.io changing dl url · t-cargo · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/index.html">t-cargo</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html">crates.io changing dl url</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="265175166"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265175166" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265175166">(Dec 16 2021 at 15:49)</a>:</h4>
<p>hey cargo team!</p>



<a name="265175271"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265175271" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265175271">(Dec 16 2021 at 15:49)</a>:</h4>
<p>the <a href="http://crates.io">crates.io</a> team is making some changes to improve its resiliency to aws or heroku outages (prompted by the recent aws outage), and to add new ways for on-call people to mitigate outages</p>



<a name="265175372"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265175372" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265175372">(Dec 16 2021 at 15:50)</a>:</h4>
<p>the full plan is in <a href="https://github.com/rust-lang/crates.io/issues/4282">https://github.com/rust-lang/crates.io/issues/4282</a> if y'all are curious, but there's a specific piece I'd love feedback from y'all on</p>



<a name="265175469"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265175469" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265175469">(Dec 16 2021 at 15:51)</a>:</h4>
<p>namely, we're adding a way for on-call operators to change the <code>dl</code> key of <code>config.json</code>, allowing them to bypass the faulty piece of infrastructure and keeping downloads going</p>



<a name="265175568"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265175568" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265175568">(Dec 16 2021 at 15:51)</a>:</h4>
<p>(pointing to the cdn if ec2/heroku is down, to the primary s3 bucket if the cdn is down, or the new fallback s3 bucket if the primary s3 bucket and the cdn are both down)</p>



<a name="265175741"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265175741" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265175741">(Dec 16 2021 at 15:52)</a>:</h4>
<p>this shouldn't be a problem for CIs, as they clone a fresh index every time (getting the new <code>config.json</code>), but I'm wondering about developers on their machines</p>



<a name="265176005"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265176005" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265176005">(Dec 16 2021 at 15:54)</a>:</h4>
<p>my understanding is that cargo won't update the index if it just needs to download crates that are already in the index and there's no need to do dependency resolution, is that correct?</p>



<a name="265176096"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265176096" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265176096">(Dec 16 2021 at 15:55)</a>:</h4>
<p>now I'm wondering if and how we can make that experience better for users on the cargo side</p>



<a name="265176121"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265176121" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265176121">(Dec 16 2021 at 15:55)</a>:</h4>
<p>Yes, so in that case it won't notice the change of URL. But it also wouldn't have noticed the outage.</p>



<a name="265176196"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265176196" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265176196">(Dec 16 2021 at 15:55)</a>:</h4>
<p>sorry, with "crates in the index" I meant crates that are referenced in the local copy of the index but are not locally cached</p>



<a name="265176282"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265176282" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265176282">(Dec 16 2021 at 15:56)</a>:</h4>
<p>so it should fail when it tries to download them from <a href="http://crates.io">crates.io</a></p>



<a name="265176331"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265176331" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265176331">(Dec 16 2021 at 15:56)</a>:</h4>
<p>it's correct yeah that the index is not updated in some situations, namely you have <code>Cargo.lock</code> but you haven't downloaded all the packages</p>



<a name="265176354"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265176354" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265176354">(Dec 16 2021 at 15:56)</a>:</h4>
<p>and the current state of the index has all the packages in <code>Cargo.lock</code></p>



<a name="265176554"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265176554" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265176554">(Dec 16 2021 at 15:57)</a>:</h4>
<p>so, whenever we're going to update the <code>dl</code> url we'll also have to update the status page, so we can say "run this command to update the index" in the status page update</p>



<a name="265176740"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265176740" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265176740">(Dec 16 2021 at 15:59)</a>:</h4>
<p>I believe so, yeah, although.... I dunno what that command is</p>



<a name="265176753"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265176753" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265176753">(Dec 16 2021 at 15:59)</a>:</h4>
<p>other than like <code>cargo install nonexistent-package</code></p>



<a name="265176974"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265176974" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265176974">(Dec 16 2021 at 16:00)</a>:</h4>
<p>Or <code>cargo update --dry-run</code>?</p>



<a name="265176981"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265176981" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265176981">(Dec 16 2021 at 16:00)</a>:</h4>
<p>would such a command be feasible to implement?</p>



<a name="265177131"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265177131" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265177131">(Dec 16 2021 at 16:01)</a>:</h4>
<p>oh <code>cargo update --dry-run</code> is good!</p>



<a name="265177171"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265177171" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265177171">(Dec 16 2021 at 16:01)</a>:</h4>
<p>I don't think that works if you don't actually have any <a href="http://crates.io">crates.io</a> dependencies, e.g. if you run that in an empty project it won't do anything</p>



<a name="265177284"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265177284" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265177284">(Dec 16 2021 at 16:02)</a>:</h4>
<p>hmm</p>



<a name="265177363"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265177363" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265177363">(Dec 16 2021 at 16:03)</a>:</h4>
<p>that's true of any solution within cargo, there's not really a great way to say "please go update the <a href="http://crates.io">crates.io</a> index" in cargo's model of interpretation of sources</p>



<a name="265177388"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265177388" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265177388">(Dec 16 2021 at 16:03)</a>:</h4>
<p>We could say that you need to run <code>cargo update --dry-run</code> inside the project which failed to download crates.</p>



<a name="265177556"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265177556" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265177556">(Dec 16 2021 at 16:04)</a>:</h4>
<p>would a <code>cargo update-git-indexes</code> command be feasible to implement?</p>



<a name="265177598"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265177598" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265177598">(Dec 16 2021 at 16:05)</a>:</h4>
<p>(that would also be nice for rustwide btw)</p>



<a name="265177970"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265177970" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265177970">(Dec 16 2021 at 16:07)</a>:</h4>
<p>cargo doesn't really have a notion of "iterate over all the registry sources", it could perhaps have something very specific for <a href="http://crates.io">crates.io</a></p>



<a name="265178047"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265178047" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265178047">(Dec 16 2021 at 16:08)</a>:</h4>
<p>but... again none of this really fits within cargo's model of sources, not to say it can't be done just that it's wierd</p>



<a name="265178333"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265178333" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265178333">(Dec 16 2021 at 16:10)</a>:</h4>
<p>hmm ok</p>



<a name="265178373"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265178373" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265178373">(Dec 16 2021 at 16:10)</a>:</h4>
<p>then I think the best way would be to just recommend people to run <code>cargo install empty-library</code>, noting it's expected it would fail</p>



<a name="265178440"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265178440" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ed Page <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265178440">(Dec 16 2021 at 16:11)</a>:</h4>
<p>What if we generalized the command to be <code>cargo registry</code> with <code>cargo registry --update</code> (updates registry), <code>cargo registry --download pkgid</code> (forces downloading of a package) and <code>cargo registry --locate pkdid</code> (tells where a downloaded package is on disk)</p>
<p>This would give us the option to call <code>cargo registry</code> like <code>cargo metadata</code> instead of having to split out the registry logic for cargo subcommands to reuse.</p>
<p>The download and locate are more for some analysis I want to do and can be added later :)</p>



<a name="265178526"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265178526" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265178526">(Dec 16 2021 at 16:11)</a>:</h4>
<p>I don't really want to make the implementation too complex for this, as I expect we will need to exercise this capability <em>extremely</em> rarely (we never had an aws outage affecting us ever so far)</p>



<a name="265178533"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265178533" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265178533">(Dec 16 2021 at 16:11)</a>:</h4>
<p>(look at how badly I jinxed it now, well, at least <strong><em>I</em></strong> am not on-call during the holidays)</p>



<a name="265178729"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265178729" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265178729">(Dec 16 2021 at 16:13)</a>:</h4>
<p>(watching all these messes and so glad I'm not on call)</p>



<a name="265178769"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265178769" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265178769">(Dec 16 2021 at 16:13)</a>:</h4>
<p>We've had requests like this a number of times.</p>



<a name="265178852"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265178852" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265178852">(Dec 16 2021 at 16:14)</a>:</h4>
<p>Mostly by people who want to be able to do name search without network access.</p>



<a name="265178870"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265178870" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265178870">(Dec 16 2021 at 16:14)</a>:</h4>
<p>Should it be <code>cargo install rustc</code> or another reserved crate? That would avoid someone registering <code>empty-library</code> and eg put a fake rustc executable in it.</p>



<a name="265179227"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265179227" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265179227">(Dec 16 2021 at 16:16)</a>:</h4>
<p><span class="user-mention silent" data-user-id="133247">bjorn3</span> <a href="#narrow/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url/near/265178870">said</a>:</p>
<blockquote>
<p>Should it be <code>cargo install rustc</code> or another reserved crate? That would avoid someone registering <code>empty-library</code> and eg put a fake rustc executable in it.</p>
</blockquote>
<p>empty-library is reserved :)</p>



<a name="265179300"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265179300" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265179300">(Dec 16 2021 at 16:17)</a>:</h4>
<p><span class="user-mention silent" data-user-id="120179">Eh2406</span> <a href="#narrow/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url/near/265178729">said</a>:</p>
<blockquote>
<p>(watching all these messes and so glad I'm not on call)</p>
</blockquote>
<p>hey at least now I'm paid when I'm actually on-call <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span></p>



<a name="265179352"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265179352" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265179352">(Dec 16 2021 at 16:17)</a>:</h4>
<p>it wasn't that much fun when me and justin were doing it completely unpaid</p>



<a name="265179765"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265179765" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265179765">(Dec 16 2021 at 16:20)</a>:</h4>
<p>"If you're getting paged you should be paid."<br>
I said it repeatedly to anyone who would listen (including Shane). Not that I have a lot of influence.</p>



<a name="265179839"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265179839" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265179839">(Dec 16 2021 at 16:21)</a>:</h4>
<p>heh agreed</p>



<a name="265182343"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265182343" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265182343">(Dec 16 2021 at 16:38)</a>:</h4>
<p>It would also be nice if someone tested that cargo works correctly when the <code>dl</code> url changes.<br>
Like:</p>
<ul>
<li>use source replacement too point at a personal copy of the index</li>
<li>build a project with a significant number of dependencies</li>
<li>change the personal copy of the index to have a different <code>dl</code> url .</li>
<li>add 1 dependency to the project. make sure that cargo downloads only the one file, and does not rebuild the world.</li>
</ul>
<p>I think this should work, but we should check.</p>



<a name="265182454"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265182454" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265182454">(Dec 16 2021 at 16:39)</a>:</h4>
<p><span class="user-mention" data-user-id="120179">@Eh2406</span> I landed the infra to change the <code>dl</code> url on the staging index already</p>



<a name="265182542"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265182542" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265182542">(Dec 16 2021 at 16:40)</a>:</h4>
<p>if you want to test with a real index</p>



<a name="265182647"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265182647" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265182647">(Dec 16 2021 at 16:40)</a>:</h4>
<p>(or well, I can test it in the coming days)</p>



<a name="265182976"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265182976" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265182976">(Dec 16 2021 at 16:42)</a>:</h4>
<p>I don't think it's critical, re downloading and rebuilding the world is better then an outage. but it would be nice if somebody checked.</p>



<a name="265210245"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265210245" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265210245">(Dec 16 2021 at 19:52)</a>:</h4>
<p>IIRC (<a href="https://github.com/rust-lang/cargo/issues/7617">https://github.com/rust-lang/cargo/issues/7617</a>), changing <code>config.json</code> doesn't currently work.</p>



<a name="265216788"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265216788" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265216788">(Dec 16 2021 at 20:43)</a>:</h4>
<p>worst case we can recommend to remove the index directory</p>



<a name="265217424"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265217424" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265217424">(Dec 16 2021 at 20:48)</a>:</h4>
<p>Um... <a href="https://www.cloudflarestatus.com/">https://www.cloudflarestatus.com/</a></p>



<a name="265217773"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265217773" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265217773">(Dec 16 2021 at 20:51)</a>:</h4>
<p>(we're on cloudfront, not cloudflare, still, hugops)</p>



<a name="265218110"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265218110" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265218110">(Dec 16 2021 at 20:54)</a>:</h4>
<p>Sorry got my wires crossed.</p>



<a name="265218744"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265218744" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265218744">(Dec 16 2021 at 20:59)</a>:</h4>
<p>that would've been perfect timing tho</p>



<a name="265575684"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265575684" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265575684">(Dec 20 2021 at 15:14)</a>:</h4>
<p><span class="user-mention" data-user-id="121055">@Pietro Albini</span> I think you meant to respond to the changing dl url topic?</p>
<p>If you are referring to <a href="https://github.com/rust-lang/cargo/issues/7617">cargo#7617</a>, that issue is that you have to run cargo twice for it to work (the first time it uses the wrong value).  If you <code>rm -rf</code>, that will also wipe out the cache.</p>



<a name="265575737"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265575737" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265575737">(Dec 20 2021 at 15:14)</a>:</h4>
<p>woops <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="265575771"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265575771" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265575771">(Dec 20 2021 at 15:14)</a>:</h4>
<p>changed topic</p>



<a name="265575809"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265575809" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265575809">(Dec 20 2021 at 15:15)</a>:</h4>
<p>oooh ok I think I know what you mean</p>



<a name="265575862"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265575862" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265575862">(Dec 20 2021 at 15:15)</a>:</h4>
<p>the <code>cargo</code> invocation <em>that updated the index</em> won't reflect the changes in <code>config.json</code></p>



<a name="265575880"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265575880" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265575880">(Dec 20 2021 at 15:15)</a>:</h4>
<p>but any following invocation will</p>



<a name="265575984"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265575984" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265575984">(Dec 20 2021 at 15:16)</a>:</h4>
<p>so if we tell people to run</p>
<div class="codehilite"><pre><span></span><code>cargo install empty-library
</code></pre></div>
<p>that's all good because that command will update the index, fail as expected and then people will be able to use <code>cargo</code> normally</p>



<a name="265576002"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265576002" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265576002">(Dec 20 2021 at 15:16)</a>:</h4>
<p>is my understanding correct?</p>



<a name="265579250"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265579250" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265579250">(Dec 20 2021 at 15:41)</a>:</h4>
<p>I think so? </p>
<p>I'm also a bit confused as to why it isn't working.  It looks like it reloads the config after an update.</p>



<a name="265579463"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265579463" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265579463">(Dec 20 2021 at 15:43)</a>:</h4>
<p>anyway, the current behavior is enough for what we need to handle incidents</p>



<a name="265579486"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crates.io%20changing%20dl%20url/near/265579486" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crates.2Eio.20changing.20dl.20url.html#265579486">(Dec 20 2021 at 15:43)</a>:</h4>
<p>thanks for all the feedback!</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>