<html>
<head><meta charset="utf-8"><title>multiple target feature resolution · t-cargo · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/index.html">t-cargo</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/multiple.20target.20feature.20resolution.html">multiple target feature resolution</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="268437330"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/multiple%20target%20feature%20resolution/near/268437330" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/multiple.20target.20feature.20resolution.html#268437330">(Jan 18 2022 at 18:44)</a>:</h4>
<p>With <a href="https://doc.rust-lang.org/nightly/cargo/reference/unstable.html#multitarget">multitarget</a> where you can specify <code>--target</code> multiple times, do we want features to be unified across those targets, or should they be independent?</p>
<p>I would lean towards being independent.  A drawback is that there isn't a way to say "enable this feature for this target".  That is, <code>--feature</code> would have to enable for all targets.</p>



<a name="268441011"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/multiple%20target%20feature%20resolution/near/268441011" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/multiple.20target.20feature.20resolution.html#268441011">(Jan 18 2022 at 19:11)</a>:</h4>
<p><span class="user-mention" data-user-id="120518">@Eric Huss</span> Having them be independent would be consistent with artifact dependencies.</p>



<a name="268441024"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/multiple%20target%20feature%20resolution/near/268441024" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/multiple.20target.20feature.20resolution.html#268441024">(Jan 18 2022 at 19:11)</a>:</h4>
<p>I can imagine, in the future, wanting them to be consistent.</p>



<a name="268441144"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/multiple%20target%20feature%20resolution/near/268441144" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/multiple.20target.20feature.20resolution.html#268441144">(Jan 18 2022 at 19:12)</a>:</h4>
<p>I think we should default to independent, and then we may find a strong use case in the future for adding a way to say "unify me with this artifact dependency", or "unify everything on my build command line".</p>



<a name="268445887"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/multiple%20target%20feature%20resolution/near/268445887" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/multiple.20target.20feature.20resolution.html#268445887">(Jan 18 2022 at 19:49)</a>:</h4>
<p>I would agree that feature resolution should be target-dependent, my way I think about futures is that "everything linked into one binary is unified" so that'd be per-target</p>



<a name="268446009"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/multiple%20target%20feature%20resolution/near/268446009" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/multiple.20target.20feature.20resolution.html#268446009">(Jan 18 2022 at 19:50)</a>:</h4>
<p>I never thought about the use case of only enabling a feature for one target while also building for multiple targets...</p>



<a name="268446029"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/multiple%20target%20feature%20resolution/near/268446029" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/multiple.20target.20feature.20resolution.html#268446029">(Jan 18 2022 at 19:50)</a>:</h4>
<p>eventually we're gonna need like <code>cargo build --units units.json</code> or something like that where cargo takes in structured input of what to build</p>



<a name="268495776"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/multiple%20target%20feature%20resolution/near/268495776" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/multiple.20target.20feature.20resolution.html#268495776">(Jan 19 2022 at 06:05)</a>:</h4>
<p>FWIW, the most obvious use case I can think of for wanting features unified across targets is that you have a client and server (or host and device) running on different targets and they need the same feature flags enabled for the protocol library they're using.</p>



<a name="268503636"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/multiple%20target%20feature%20resolution/near/268503636" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/multiple.20target.20feature.20resolution.html#268503636">(Jan 19 2022 at 08:11)</a>:</h4>
<p>On the other hand you may have features which are only enabled on some targets and can only comple for said targets. For example wgpu does this for the various graphics apis.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>