<html>
<head><meta charset="utf-8"><title>Add CARGO_CFG_EMIT · t-cargo · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/index.html">t-cargo</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Add.20CARGO_CFG_EMIT.html">Add CARGO_CFG_EMIT</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="261458011"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Add%20CARGO_CFG_EMIT/near/261458011" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manuel Drehwald <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Add.20CARGO_CFG_EMIT.html#261458011">(Nov 15 2021 at 05:12)</a>:</h4>
<p>Based on my understanding there is no hard definition on what is published under CARGO_CFG_X:<br>
<a href="https://doc.rust-lang.org/cargo/reference/environment-variables.html">https://doc.rust-lang.org/cargo/reference/environment-variables.html</a></p>
<p>I have a build script which only works if user adds the flag "--emit=llvm-bc" to cargo rustc.<br>
I'm using a cargo-wrapper to handle it, but as a backup check or for the case that user build the crate manually I want to let them know about this <br>
issue with a specific error message. <br>
Checking the env vars it turned out that the information is not set.<br>
Would a PR to add it be accepted?</p>



<a name="261689308"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Add%20CARGO_CFG_EMIT/near/261689308" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Add.20CARGO_CFG_EMIT.html#261689308">(Nov 16 2021 at 18:57)</a>:</h4>
<p>Can you say more about what env variables you are referring to?  I'm having a hard time trying to understand your question.  What information would the build script need that it doesn't have now?</p>



<a name="261708886"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Add%20CARGO_CFG_EMIT/near/261708886" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manuel Drehwald <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Add.20CARGO_CFG_EMIT.html#261708886">(Nov 16 2021 at 21:24)</a>:</h4>
<p>Sure. So I have a build script where I want to check, if the user called cargo rustc with the flag --emit=llvm-bc.<br>
I know for sure, that the compilation will fail (or worse, miss-behave) if the user missed this flag. <br>
Afaik. I can't just set it from within my build script, so instead of just hoping that the user understands his mistake based on the resulting issues, I rather panic with an useful hint. <br>
In order to do so, I want to check if the --emit flag has been used, and if llvm-bc has been selected.<br>
That's currently not possible, at least neither "emit", nor "llvm-bc" have been shown up in the env variables.<br>
Under CARGO_CFG_X you already publish a lot of other information, including flags passed via cargo to rustc.<br>
So I expect that it is fine if I add a few lines to also publish the emit information, but first I wanted to make sure that you are ok with this.</p>



<a name="262486353"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Add%20CARGO_CFG_EMIT/near/262486353" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Add.20CARGO_CFG_EMIT.html#262486353">(Nov 23 2021 at 17:24)</a>:</h4>
<p>Unfortunately I don't know if that is really feasible. The build script is built for the package as a whole. In order to handle this, it would need to hash the flags in the fingerprint, which would cause the build script to be re-run any time a user ran with <code>cargo rustc</code> with different flags. The build script also doesn't know which cargo target is being built, so the flags wouldn't have specific meaning to the build script (aside from your use case).</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>