<html>
<head><meta charset="utf-8"><title>crate graphs, native libraries, and multiple crate versions · t-cargo · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/index.html">t-cargo</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crate.20graphs.2C.20native.20libraries.2C.20and.20multiple.20crate.20versions.html">crate graphs, native libraries, and multiple crate versions</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="274062077"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crate%20graphs%2C%20native%20libraries%2C%20and%20multiple%20crate%20versions/near/274062077" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crate.20graphs.2C.20native.20libraries.2C.20and.20multiple.20crate.20versions.html#274062077">(Mar 04 2022 at 00:30)</a>:</h4>
<p>With full acknowledgement of the fact that features are <em>supposed</em> to be additive: I ran into a case that I'm not sure it's possible to solve with the language and cargo features we have today.</p>



<a name="274062078"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crate%20graphs%2C%20native%20libraries%2C%20and%20multiple%20crate%20versions/near/274062078" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crate.20graphs.2C.20native.20libraries.2C.20and.20multiple.20crate.20versions.html#274062078">(Mar 04 2022 at 00:30)</a>:</h4>
<p><a href="https://github.com/launchbadge/sqlx/pull/1733">https://github.com/launchbadge/sqlx/pull/1733</a></p>



<a name="274065491"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crate%20graphs%2C%20native%20libraries%2C%20and%20multiple%20crate%20versions/near/274065491" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Kimock (Saethlin) <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crate.20graphs.2C.20native.20libraries.2C.20and.20multiple.20crate.20versions.html#274065491">(Mar 04 2022 at 01:15)</a>:</h4>
<p>IMO this is actually uninteresting because the whole reason you're in this situation is a soundness bug in libgit2-sys.</p>



<a name="274069923"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crate%20graphs%2C%20native%20libraries%2C%20and%20multiple%20crate%20versions/near/274069923" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crate.20graphs.2C.20native.20libraries.2C.20and.20multiple.20crate.20versions.html#274069923">(Mar 04 2022 at 02:14)</a>:</h4>
<p>Soundness bug?</p>



<a name="274070276"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crate%20graphs%2C%20native%20libraries%2C%20and%20multiple%20crate%20versions/near/274070276" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Kimock (Saethlin) <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crate.20graphs.2C.20native.20libraries.2C.20and.20multiple.20crate.20versions.html#274070276">(Mar 04 2022 at 02:20)</a>:</h4>
<p>libgit2 does not have a stable ABI, but libgit2-sys acts like it does with its version requirement in its <a href="http://build.rs">build.rs</a>.</p>
<p>The 1.3.0 release caused runtime errors, 1.4.0 is causing segfaults.</p>



<a name="274070383"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crate%20graphs%2C%20native%20libraries%2C%20and%20multiple%20crate%20versions/near/274070383" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Kimock (Saethlin) <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crate.20graphs.2C.20native.20libraries.2C.20and.20multiple.20crate.20versions.html#274070383">(Mar 04 2022 at 02:22)</a>:</h4>
<p>There are multiple issues open about this on the repo. Here's my comment on one: <a href="https://github.com/rust-lang/git2-rs/issues/746#issuecomment-1012185316">https://github.com/rust-lang/git2-rs/issues/746#issuecomment-1012185316</a><br>
And an issue for the latest one: <a href="https://github.com/rust-lang/git2-rs/issues/813">https://github.com/rust-lang/git2-rs/issues/813</a></p>



<a name="274070541"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crate%20graphs%2C%20native%20libraries%2C%20and%20multiple%20crate%20versions/near/274070541" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crate.20graphs.2C.20native.20libraries.2C.20and.20multiple.20crate.20versions.html#274070541">(Mar 04 2022 at 02:24)</a>:</h4>
<p>Sigh, I see.</p>



<a name="274070618"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crate%20graphs%2C%20native%20libraries%2C%20and%20multiple%20crate%20versions/near/274070618" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crate.20graphs.2C.20native.20libraries.2C.20and.20multiple.20crate.20versions.html#274070618">(Mar 04 2022 at 02:25)</a>:</h4>
<p>I don't think that's actually the root of the build issue in this case, since I think I'd have the same problem if libgit2-sys had a different major version.</p>



<a name="274070691"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crate%20graphs%2C%20native%20libraries%2C%20and%20multiple%20crate%20versions/near/274070691" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crate.20graphs.2C.20native.20libraries.2C.20and.20multiple.20crate.20versions.html#274070691">(Mar 04 2022 at 02:26)</a>:</h4>
<p>But I agree that that's an issue in libgit2-sys.</p>



<a name="274070697"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crate%20graphs%2C%20native%20libraries%2C%20and%20multiple%20crate%20versions/near/274070697" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crate.20graphs.2C.20native.20libraries.2C.20and.20multiple.20crate.20versions.html#274070697">(Mar 04 2022 at 02:26)</a>:</h4>
<p>Sigh. I can't wait to switch to gitoxide...</p>



<a name="274070705"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crate%20graphs%2C%20native%20libraries%2C%20and%20multiple%20crate%20versions/near/274070705" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Kimock (Saethlin) <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crate.20graphs.2C.20native.20libraries.2C.20and.20multiple.20crate.20versions.html#274070705">(Mar 04 2022 at 02:26)</a>:</h4>
<p><em>sigh</em> you're right, the C symbols would still collide, even if you were linking to the right .so</p>



<a name="274070736"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crate%20graphs%2C%20native%20libraries%2C%20and%20multiple%20crate%20versions/near/274070736" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Kimock (Saethlin) <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crate.20graphs.2C.20native.20libraries.2C.20and.20multiple.20crate.20versions.html#274070736">(Mar 04 2022 at 02:27)</a>:</h4>
<p>Maybe I'll just put up the PR and see if they take it</p>



<a name="274070740"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crate%20graphs%2C%20native%20libraries%2C%20and%20multiple%20crate%20versions/near/274070740" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Kimock (Saethlin) <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crate.20graphs.2C.20native.20libraries.2C.20and.20multiple.20crate.20versions.html#274070740">(Mar 04 2022 at 02:27)</a>:</h4>
<p>It's such a small diff</p>



<a name="274071003"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crate%20graphs%2C%20native%20libraries%2C%20and%20multiple%20crate%20versions/near/274071003" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crate.20graphs.2C.20native.20libraries.2C.20and.20multiple.20crate.20versions.html#274071003">(Mar 04 2022 at 02:30)</a>:</h4>
<p>Which PR? For libgit2-sys?</p>



<a name="274071858"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crate%20graphs%2C%20native%20libraries%2C%20and%20multiple%20crate%20versions/near/274071858" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Kimock (Saethlin) <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crate.20graphs.2C.20native.20libraries.2C.20and.20multiple.20crate.20versions.html#274071858">(Mar 04 2022 at 02:40)</a>:</h4>
<p>Yeah. Sorry I'm sidetracking this topic. Pet peeve and all that.</p>



<a name="274144574"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/crate%20graphs%2C%20native%20libraries%2C%20and%20multiple%20crate%20versions/near/274144574" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/crate.20graphs.2C.20native.20libraries.2C.20and.20multiple.20crate.20versions.html#274144574">(Mar 04 2022 at 15:26)</a>:</h4>
<p>Fundamentally I think your optional dependencies on different versions (with links attributes) is actually modeling mutually exclusive features pretty correctly. If you build it as a dependency with one feature it <em>should</em> work. Same if you build it as a dependency with the other feature. You get the confusing error message when you attempt to enable both features. Of course this is an ergonomic nightmare, to build the package itself all features are enabled. <br>
This is the fundamentally difficult part of mutually exclusive features. That in order to develop the package you kind of need to do code generation for both of them.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>