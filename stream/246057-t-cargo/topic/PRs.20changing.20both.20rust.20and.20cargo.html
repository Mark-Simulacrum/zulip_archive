<html>
<head><meta charset="utf-8"><title>PRs changing both rust and cargo · t-cargo · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/index.html">t-cargo</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/PRs.20changing.20both.20rust.20and.20cargo.html">PRs changing both rust and cargo</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="258192029"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/PRs%20changing%20both%20rust%20and%20cargo/near/258192029" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/PRs.20changing.20both.20rust.20and.20cargo.html#258192029">(Oct 19 2021 at 13:15)</a>:</h4>
<p>If I'm making a change to rustc that will necessitate a change to cargo, is it fine to submit a PR that changes both in one go, so that the tests keep passing?</p>



<a name="258192047"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/PRs%20changing%20both%20rust%20and%20cargo/near/258192047" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/PRs.20changing.20both.20rust.20and.20cargo.html#258192047">(Oct 19 2021 at 13:15)</a>:</h4>
<p>Does that get back-merged into the cargo repository?</p>



<a name="258193304"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/PRs%20changing%20both%20rust%20and%20cargo/near/258193304" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/PRs.20changing.20both.20rust.20and.20cargo.html#258193304">(Oct 19 2021 at 13:23)</a>:</h4>
<p>Isn't cargo still a submodule? You can only do that for the ones that switched to subtrees.</p>



<a name="258193346"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/PRs%20changing%20both%20rust%20and%20cargo/near/258193346" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/PRs.20changing.20both.20rust.20and.20cargo.html#258193346">(Oct 19 2021 at 13:23)</a>:</h4>
<p>Hrm.</p>



<a name="258193454"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/PRs%20changing%20both%20rust%20and%20cargo/near/258193454" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/PRs.20changing.20both.20rust.20and.20cargo.html#258193454">(Oct 19 2021 at 13:24)</a>:</h4>
<p>I'm trying to change <code>-Z strip</code> to <code>-C strip</code> as part of stabilizing it, which requires changing cargo's handling of that. I guess since it's an unstable option in Cargo, it's allowed to need a bit of transition before it stabilizes...</p>



<a name="258193495"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/PRs%20changing%20both%20rust%20and%20cargo/near/258193495" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/PRs.20changing.20both.20rust.20and.20cargo.html#258193495">(Oct 19 2021 at 13:24)</a>:</h4>
<p>Remember too that cargo stage0 is used for all of bootstrap</p>



<a name="258193538"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/PRs%20changing%20both%20rust%20and%20cargo/near/258193538" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/PRs.20changing.20both.20rust.20and.20cargo.html#258193538">(Oct 19 2021 at 13:24)</a>:</h4>
<p>Right, but we won't be setting <code>strip</code> within Rust itself.</p>



<a name="258193595"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/PRs%20changing%20both%20rust%20and%20cargo/near/258193595" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/PRs.20changing.20both.20rust.20and.20cargo.html#258193595">(Oct 19 2021 at 13:25)</a>:</h4>
<p>It's more that the nightly only <code>strip</code> option within Cargo profiles will be broken until Cargo is updated to pass the right option to Rust.</p>



<a name="258193638"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/PRs%20changing%20both%20rust%20and%20cargo/near/258193638" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/PRs.20changing.20both.20rust.20and.20cargo.html#258193638">(Oct 19 2021 at 13:25)</a>:</h4>
<p>(As an aside, when we add a new command-line option that's going to become stable one day, we shouldn't add it as a <code>-Z</code>option; we should add a <code>-C</code> option or whatever it's going to end up being, and just gate it on <code>-Z unstable-options</code>.)</p>



<a name="258193885"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/PRs%20changing%20both%20rust%20and%20cargo/near/258193885" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/PRs.20changing.20both.20rust.20and.20cargo.html#258193885">(Oct 19 2021 at 13:26)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/246057-t-cargo/topic/PRs.20changing.20both.20rust.20and.20cargo/near/258193638">said</a>:</p>
<blockquote>
<p>(As an aside, when we add a new command-line option that's going to become stable one day, we shouldn't add it as a <code>-Z</code>option; we should add a <code>-C</code> option or whatever it's going to end up being, and just gate it on <code>-Z unstable-options</code>.)</p>
</blockquote>
<p>FWIW this is generally <em>more</em> painful: you can't easily tell whether the option you're using is unstable, particularly when you <em>already</em> have -Zunstable-options. OTOH, there's no reason we can't (temporarily, even for multiple cycles) support -Zstrip and -Cstrip as aliases.</p>



<a name="258193956"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/PRs%20changing%20both%20rust%20and%20cargo/near/258193956" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/PRs.20changing.20both.20rust.20and.20cargo.html#258193956">(Oct 19 2021 at 13:27)</a>:</h4>
<p>It's also a pain to pass -Zunstable-options and some other option in rustflags and the like, especially since some tools will error on the option being set twice</p>



<a name="258194675"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/PRs%20changing%20both%20rust%20and%20cargo/near/258194675" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/PRs.20changing.20both.20rust.20and.20cargo.html#258194675">(Oct 19 2021 at 13:32)</a>:</h4>
<blockquote>
<p>you can't easily tell whether the option you're using is unstable, particularly when you already have -Zunstable-options</p>
</blockquote>
<p>Perhaps we should have something like <code>-Zunstable-options=x,y,z</code>, then, similar to feature flags?</p>



<a name="258194731"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/PRs%20changing%20both%20rust%20and%20cargo/near/258194731" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/PRs.20changing.20both.20rust.20and.20cargo.html#258194731">(Oct 19 2021 at 13:32)</a>:</h4>
<p>Still seems preferable to changing the nature of the feature when stabilizing it.</p>



<a name="258194774"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/PRs%20changing%20both%20rust%20and%20cargo/near/258194774" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/PRs.20changing.20both.20rust.20and.20cargo.html#258194774">(Oct 19 2021 at 13:32)</a>:</h4>
<p>(Analogously, we don't typically change a language feature's syntax, or a library function's semantics, <em>right before</em> stabilizing it; that'd be error-prone.)</p>



<a name="258195465"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/PRs%20changing%20both%20rust%20and%20cargo/near/258195465" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/PRs.20changing.20both.20rust.20and.20cargo.html#258195465">(Oct 19 2021 at 13:37)</a>:</h4>
<p>~None of the code needs to change between -Z and -C though, so not sure that the situation is "alike". It seems similar to moving the feature gate from unstable to stable or <a href="http://active.rs">active.rs</a> to <a href="http://accepted.rs">accepted.rs</a> for lang features.</p>



<a name="258196039"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/PRs%20changing%20both%20rust%20and%20cargo/near/258196039" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/PRs.20changing.20both.20rust.20and.20cargo.html#258196039">(Oct 19 2021 at 13:40)</a>:</h4>
<p>Cargo currently passes -Z strip, and has to be changed to pass -C strip.</p>



<a name="258196675"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/PRs%20changing%20both%20rust%20and%20cargo/near/258196675" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/PRs.20changing.20both.20rust.20and.20cargo.html#258196675">(Oct 19 2021 at 13:45)</a>:</h4>
<p>Cargo supports both the current stable and nightly AFAIK, so it already has to featute detect if certain things are allowed. You could land a PR to cargo first teaching it to use -Cstrip if it doesn't error and -Zstrip otherwise (or even skip -Zstrip, temporarily breaking it on current nightly). After that you could land a rustc PR to change -Zstrip to -Cstrip I think.</p>



<a name="258196903"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/PRs%20changing%20both%20rust%20and%20cargo/near/258196903" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/PRs.20changing.20both.20rust.20and.20cargo.html#258196903">(Oct 19 2021 at 13:46)</a>:</h4>
<p>I think I'll just leave <code>-Z strip</code> working temporarily, land a patch <em>adding</em> <code>-C strip</code>, and then Cargo can switch over so that it works on stable.</p>



<a name="258200562"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/PRs%20changing%20both%20rust%20and%20cargo/near/258200562" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/PRs.20changing.20both.20rust.20and.20cargo.html#258200562">(Oct 19 2021 at 14:09)</a>:</h4>
<p>Hmmm. Apparently it isn't straightforward to have a -Z and -C option with the same name.</p>



<a name="258200596"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/PRs%20changing%20both%20rust%20and%20cargo/near/258200596" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/PRs.20changing.20both.20rust.20and.20cargo.html#258200596">(Oct 19 2021 at 14:09)</a>:</h4>
<p>Submitted <a href="https://github.com/rust-lang/rust/pull/90058">https://github.com/rust-lang/rust/pull/90058</a> , got errors because the macros define functions with the same name.</p>



<a name="258208414"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/PRs%20changing%20both%20rust%20and%20cargo/near/258208414" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/PRs.20changing.20both.20rust.20and.20cargo.html#258208414">(Oct 19 2021 at 14:51)</a>:</h4>
<p>It is typical to just break cargo in this scenario and follow up with a PR on the cargo side after the change lands.</p>



<a name="258208585"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/PRs%20changing%20both%20rust%20and%20cargo/near/258208585" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/PRs.20changing.20both.20rust.20and.20cargo.html#258208585">(Oct 19 2021 at 14:52)</a>:</h4>
<p>Cargo's testsuite is set up so that unstable things aren't tested on rust-lang/rust, so it shouldn't impact landing the change.  It'll disrupt Cargo's CI, but it's not a big deal.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>