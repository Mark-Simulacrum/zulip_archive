<html>
<head><meta charset="utf-8"><title>RFC 3074 · t-cargo · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/index.html">t-cargo</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/RFC.203074.html">RFC 3074</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="251638783"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/RFC%203074/near/251638783" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/RFC.203074.html#251638783">(Sep 01 2021 at 22:25)</a>:</h4>
<p>Add named path bases to cargo <a href="https://github.com/rust-lang/rfcs/pull/3074">https://github.com/rust-lang/rfcs/pull/3074</a></p>



<a name="251638952"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/RFC%203074/near/251638952" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/RFC.203074.html#251638952">(Sep 01 2021 at 22:26)</a>:</h4>
<p>Hi! Some folk at Microsoft are interested in this RFC. Discussion seems to have stalled a while back, and I'm not sure from the thread if the team considered it</p>



<a name="251638975"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/RFC%203074/near/251638975" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/RFC.203074.html#251638975">(Sep 01 2021 at 22:26)</a>:</h4>
<p>How is sentiment towards the idea?</p>



<a name="251639049"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/RFC%203074/near/251639049" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/RFC.203074.html#251639049">(Sep 01 2021 at 22:27)</a>:</h4>
<p>If we were to implement the feature (or part of it) behind a feature flag, could that land while the RFC was still being discussed?</p>



<a name="251639124"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/RFC%203074/near/251639124" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/RFC.203074.html#251639124">(Sep 01 2021 at 22:28)</a>:</h4>
<p>(cc <a href="https://github.com/rust-lang/cargo/pull/9855">https://github.com/rust-lang/cargo/pull/9855</a>)</p>



<a name="251639534"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/RFC%203074/near/251639534" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/RFC.203074.html#251639534">(Sep 01 2021 at 22:32)</a>:</h4>
<p>Oh yes, that was our minimal solution to the problem we're having. RFC 3074 seems better all round really</p>



<a name="251643057"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/RFC%203074/near/251643057" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jon Gjengset <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/RFC.203074.html#251643057">(Sep 01 2021 at 23:14)</a>:</h4>
<p>I think conversation partially stopped because I ended up pursuing <code>patch-in-config</code> instead, which solved my use-case better, and therefore didn't continue to drive the RFC forward. Happy for someone with a concrete need to take it over!</p>



<a name="251645279"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/RFC%203074/near/251645279" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/RFC.203074.html#251645279">(Sep 01 2021 at 23:37)</a>:</h4>
<p>There is a lot to balance here. On one hand I do want cargo to work ergonomically with big build systems. On the other hand I am nervous about adding a special way to break into cargoes mental model for each one that comes along. How do we adequately test all the permutations of workspaces with version inheritance, and Source replacement, and patch in config, ... and that's just the ships that have sailed.</p>



<a name="251645383"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/RFC%203074/near/251645383" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/RFC.203074.html#251645383">(Sep 01 2021 at 23:38)</a>:</h4>
<p>If there is any way to solve your problem without adding another; that would be amazing.</p>



<a name="251645520"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/RFC%203074/near/251645520" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/RFC.203074.html#251645520">(Sep 01 2021 at 23:40)</a>:</h4>
<p>If we do have to add another one I want it to minimize that complexity and have a high probability of fixing the next person's problem to.</p>



<a name="251645591"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/RFC%203074/near/251645591" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/RFC.203074.html#251645591">(Sep 01 2021 at 23:41)</a>:</h4>
<p>But of course everyone here already knew that. I'll get off my soapbox.</p>



<a name="251646166"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/RFC%203074/near/251646166" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/RFC.203074.html#251646166">(Sep 01 2021 at 23:48)</a>:</h4>
<p>It's an important soapbox. :)</p>



<a name="251652062"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/RFC%203074/near/251652062" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/RFC.203074.html#251652062">(Sep 02 2021 at 01:06)</a>:</h4>
<p>Totally agree there is a lot of complexity to balance, and their are always costs to adding this kind of complexity. I guess the more interesting question to me is how to make decisions about the trade-off. Are there known long term goals for Cargo in this area to evaluate against? Or are there principals (explicit or implicit) we can use to decide if the added complexity is good or bad?</p>



<a name="251652132"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/RFC%203074/near/251652132" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/RFC.203074.html#251652132">(Sep 02 2021 at 01:07)</a>:</h4>
<p>IMO, working well with 'large' build systems is a really important goal for Cargo, but I don't know how the Cargo team and other more experienced folk want to accomplish that (assuming you all do want to accomplish it)</p>



<a name="251652212"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/RFC%203074/near/251652212" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/RFC.203074.html#251652212">(Sep 02 2021 at 01:09)</a>:</h4>
<p>AFAICT, there isn't an existing mechanism which solves the problem here (or problems, if looking at the RFC use cases)</p>



<a name="251652239"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/RFC%203074/near/251652239" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/RFC.203074.html#251652239">(Sep 02 2021 at 01:09)</a>:</h4>
<p>Maybe it's worth trying to abstract the problem a little bit to try and see if there is a more general problem we're trying to solve a part of?</p>



<a name="251652678"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/RFC%203074/near/251652678" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/RFC.203074.html#251652678">(Sep 02 2021 at 01:16)</a>:</h4>
<p>I don't think we have well articulated rules for making decisions. ( I acknowledge that that makes it hard for other people to help. ) We accepted patch-in-config after John had made it clear that he had tried every existing tool, and had suggested all of the alternatives he could think of.  It had advantage of being the intersection of two existing features, so in some ways it did not add to the matrix of complexity. On the other hand it broke one of the "implicit principals" that pure rust building code should not depend on uncommitted configuration.</p>



<a name="251653202"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/RFC%203074/near/251653202" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/RFC.203074.html#251653202">(Sep 02 2021 at 01:24)</a>:</h4>
<p>That's an interesting principal! Does that mean that nothing in config.toml should affect builds, or is it more subtle than that?</p>



<a name="251654095"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/RFC%203074/near/251654095" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/RFC.203074.html#251654095">(Sep 02 2021 at 01:39)</a>:</h4>
<p>The intent is that the config files are specific to a user's environment.  Like, the proxy to access the network might be different for different users, so you probably don't want to commit that.  In practice, that doesn't always hold because some settings like <code>linker</code> might be <em>required</em> to cross-compile and by convention <em>everyone</em> uses the same linker by name like <code>arm-linux-gnueabihf-gcc</code>, so people do tend to commit config files with the linker setting.  (I think ideally it would be nice if that wasn't required.)</p>



<a name="251654762"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/RFC%203074/near/251654762" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/RFC.203074.html#251654762">(Sep 02 2021 at 01:48)</a>:</h4>
<p>It is an "implicit principals" so not precisely defined. And sometimes you have to compromise for other benefits. But cargo seems to have worked really hard to make the standard workflow for all rust projects:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="o">&gt;</span><span class="w"> </span><span class="n">git</span><span class="w"> </span><span class="n">checkout</span><span class="w"> </span><span class="n">foo</span><span class="w"></span>
<span class="o">&gt;</span><span class="w"> </span><span class="n">cd</span><span class="w"> </span><span class="n">foo</span><span class="w"></span>
<span class="o">&gt;</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">build</span><span class="w"></span>
</code></pre></div>
<p>This was achieved by limiting the ability for <code>cargo build</code> to require a particular <code>.cargo/contig</code> or <code>ENV</code>s to work.</p>



<a name="251654796"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/RFC%203074/near/251654796" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/RFC.203074.html#251654796">(Sep 02 2021 at 01:49)</a>:</h4>
<p>Eric has listed some of the existing exceptions.</p>



<a name="251656145"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/RFC%203074/near/251656145" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/RFC.203074.html#251656145">(Sep 02 2021 at 02:10)</a>:</h4>
<p>IMO, one of the reasons I'm comfortable with patch-in-config now is that that pattern is so well established. That even though we have now given you a way to break it, it is not going to change the norm. Between that and it being a confluence of existing functionality and really wanting to support large build system, it seemed like a worthwhile trait off.</p>



<a name="251660022"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/RFC%203074/near/251660022" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/RFC.203074.html#251660022">(Sep 02 2021 at 03:13)</a>:</h4>
<p>To try and think about features with overlap or potentially more general features, I was thinking about what 3074 is doing in more abstract terms. My model is that a dependency declaration is a mechanism for specifying the location of source code for a dep. Git and path are location literals. Version specs are input into a function (loosely, the version resolver) which produces a source location of a URL in a registry. One could think of multiple locations as a function which depends on the context to choose which location to use (where context here means just local vs on <a href="http://crates.io">crates.io</a>). We might understand 3074 (or the env var proposal) as turning the path literal into a function (context, path, base) -&gt; location. Where context here comes from config.toml (or env vars).</p>



<a name="251660048"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/RFC%203074/near/251660048" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/RFC.203074.html#251660048">(Sep 02 2021 at 03:13)</a>:</h4>
<p>Under this model, it seems like we are definitely proposing something new, there is no other mechanism to abstract path specifications in this way</p>



<a name="251660139"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/RFC%203074/near/251660139" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/RFC.203074.html#251660139">(Sep 02 2021 at 03:15)</a>:</h4>
<p>I was thinking about if there are other possible inputs which we might like to use to customise the location</p>



<a name="251660156"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/RFC%203074/near/251660156" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/RFC.203074.html#251660156">(Sep 02 2021 at 03:15)</a>:</h4>
<p><code>registry</code> is an obvious analogue</p>



<a name="251660249"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/RFC%203074/near/251660249" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/RFC.203074.html#251660249">(Sep 02 2021 at 03:17)</a>:</h4>
<p>I wonder if it might be useful to have path change depending on features, but since these are boolean in nature, it seems not very useful</p>



<a name="251660273"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/RFC%203074/near/251660273" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/RFC.203074.html#251660273">(Sep 02 2021 at 03:17)</a>:</h4>
<p>one could consider the default base path (the location of Cargo.toml) as an input of this kind</p>



<a name="251660336"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/RFC%203074/near/251660336" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/RFC.203074.html#251660336">(Sep 02 2021 at 03:18)</a>:</h4>
<p>in which case specifying a path base is not adding a category of abstraction, it</p>



<a name="251660342"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/RFC%203074/near/251660342" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/RFC.203074.html#251660342">(Sep 02 2021 at 03:18)</a>:</h4>
<p>'s just extending the range of inputs</p>



<a name="251660363"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/RFC%203074/near/251660363" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/RFC.203074.html#251660363">(Sep 02 2021 at 03:19)</a>:</h4>
<p>(similar to how specifying the <code>registry</code> extends the range of registries beyond <a href="http://crates.io">crates.io</a>)</p>



<a name="251660382"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/RFC%203074/near/251660382" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/RFC.203074.html#251660382">(Sep 02 2021 at 03:20)</a>:</h4>
<p><span class="user-mention" data-user-id="256841">@Nick Cameron</span> One other thing I'd love to feed in as an input: a mirror, from which cargo could obtain packages by hash, having gotten the hashes from a trusted source.</p>



<a name="251660827"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/RFC%203074/near/251660827" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/RFC.203074.html#251660827">(Sep 02 2021 at 03:27)</a>:</h4>
<p>A mirror of a registry?</p>



<a name="251665376"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/RFC%203074/near/251665376" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/RFC.203074.html#251665376">(Sep 02 2021 at 04:44)</a>:</h4>
<p>Yeah.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>