<html>
<head><meta charset="utf-8"><title>Stabilize target-applies-to-host · t-cargo · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/index.html">t-cargo</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Stabilize.20target-applies-to-host.html">Stabilize target-applies-to-host</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="269202222"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Stabilize%20target-applies-to-host/near/269202222" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Hilliard <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Stabilize.20target-applies-to-host.html#269202222">(Jan 25 2022 at 02:44)</a>:</h4>
<p>Is there something I need to do to push this(<a href="https://github.com/rust-lang/cargo/pull/9753">https://github.com/rust-lang/cargo/pull/9753</a>) forward? It's unclear what exactly needs to be done here to get this fix stabilized so that downstreams don't have to keep setting env variable hacks(<a href="https://github.com/buildroot/buildroot/blob/ac573c55aac3cbb4257f5388c91321c81095c654/package/pkg-cargo.mk#L26-L50">https://github.com/buildroot/buildroot/blob/ac573c55aac3cbb4257f5388c91321c81095c654/package/pkg-cargo.mk#L26-L50</a>) to make their cross builds work.</p>



<a name="269283681"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Stabilize%20target-applies-to-host/near/269283681" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Stabilize.20target-applies-to-host.html#269283681">(Jan 25 2022 at 16:36)</a>:</h4>
<p>So, the comment from Alex back in August still seems to apply: for compatibility, such a build needs to be compatible with the target paths used for a non-cross-compile build.</p>



<a name="269283704"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Stabilize%20target-applies-to-host/near/269283704" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Stabilize.20target-applies-to-host.html#269283704">(Jan 25 2022 at 16:37)</a>:</h4>
<p>That hasn't been fixed, and would need to be.</p>



<a name="269285485"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Stabilize%20target-applies-to-host/near/269285485" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Stabilize.20target-applies-to-host.html#269285485">(Jan 25 2022 at 16:48)</a>:</h4>
<p>More generally, we need to feel confident in backwards compatibility, and based on discussion in today's Cargo meeting, we don't feel like the design has taken backwards compatibility into account, and we don't have the bandwidth to do that design work ourselves.</p>



<a name="269369044"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Stabilize%20target-applies-to-host/near/269369044" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Hilliard <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Stabilize.20target-applies-to-host.html#269369044">(Jan 26 2022 at 06:33)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/246057-t-cargo/topic/Stabilize.20target-applies-to-host/near/269283681">said</a>:</p>
<blockquote>
<p>So, the comment from Alex back in August still seems to apply: for compatibility, such a build needs to be compatible with the target paths used for a non-cross-compile build.</p>
</blockquote>
<p>I still don't understand how this is an issue for stabilizing <code>target-applies-to-host</code> at all since stabilizing <code>target-applies-to-host</code> would not break compatibility anywhere due to it not actually changing any default behavior whatsoever AFAIU, it only makes available the <code>target-applies-to-host</code> setting. The default change which has the potential to cause breakage was part of the <code>host-config</code> feature which was planned to be stabilized well after <code>target-applies-to-host</code>.</p>



<a name="269369475"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Stabilize%20target-applies-to-host/near/269369475" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Hilliard <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Stabilize.20target-applies-to-host.html#269369475">(Jan 26 2022 at 06:40)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/246057-t-cargo/topic/Stabilize.20target-applies-to-host/near/269285485">said</a>:</p>
<blockquote>
<p>More generally, we need to feel confident in backwards compatibility, and based on discussion in today's Cargo meeting, we don't feel like the design has taken backwards compatibility into account, and we don't have the bandwidth to do that design work ourselves.</p>
</blockquote>
<p>Backwards compatibility was from my understanding already addressed in the design of this feature by first providing the <code>target-applies-to-host</code> flag so that projects can set their desired behavior well before any defaults get changed(since we eventually wanted to deprecate the default broken for cross compilation behavior). Any project that actually needs to preserve the existing behavior would simply apply <code>CARGO_TARGET_APPLIES_TO_HOST="true"</code> before the default change to retain the existing behavior, but in any case the default change is separate from the <code>target-applies-to-host</code> stabilization and I don't see what's blocking simply making <code>CARGO_TARGET_APPLIES_TO_HOST</code> available in stable.</p>



<a name="269369677"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Stabilize%20target-applies-to-host/near/269369677" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Hilliard <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Stabilize.20target-applies-to-host.html#269369677">(Jan 26 2022 at 06:44)</a>:</h4>
<p>This isn't some unimportant feature either as <code>CARGO_TARGET_APPLIES_TO_HOST="false"</code> behavior is effectively mandatory for making cross compilation work with build-scripts since the existing logic is broken for target==host triple builds.</p>



<a name="269370911"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Stabilize%20target-applies-to-host/near/269370911" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Stabilize.20target-applies-to-host.html#269370911">(Jan 26 2022 at 07:08)</a>:</h4>
<p><span class="user-mention" data-user-id="399686">@James Hilliard</span> Thank you for clarifying. From the PR description I got the (apparently incorrect) impression that you wanted to change the default, rather than just stabilize the <em>option</em> without changing the default.</p>



<a name="269371019"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Stabilize%20target-applies-to-host/near/269371019" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Hilliard <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Stabilize.20target-applies-to-host.html#269371019">(Jan 26 2022 at 07:10)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/246057-t-cargo/topic/Stabilize.20target-applies-to-host/near/269370911">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="399686">James Hilliard</span> Thank you for clarifying. From the PR description I got the (apparently incorrect) impression that you wanted to change the default, rather than just stabilize the <em>option</em> without changing the default.</p>
</blockquote>
<p>Right, the PR doesn't change any defaults, just makes available the option, the default was not going to be changed until well after the option(since the option can allows one to preserve the existing behavior as well).</p>



<a name="270599632"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Stabilize%20target-applies-to-host/near/270599632" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Hilliard <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Stabilize.20target-applies-to-host.html#270599632">(Feb 03 2022 at 18:58)</a>:</h4>
<p>So does stabilizing the option look like in the PR look fine or do I need to do something still?</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>