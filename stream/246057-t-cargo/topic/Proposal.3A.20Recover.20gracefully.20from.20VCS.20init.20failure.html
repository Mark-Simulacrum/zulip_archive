<html>
<head><meta charset="utf-8"><title>Proposal: Recover gracefully from VCS init failure · t-cargo · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/index.html">t-cargo</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Proposal.3A.20Recover.20gracefully.20from.20VCS.20init.20failure.html">Proposal: Recover gracefully from VCS init failure</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="263923733"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Proposal%3A%20Recover%20gracefully%20from%20VCS%20init%20failure/near/263923733" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Wrenn <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Proposal.3A.20Recover.20gracefully.20from.20VCS.20init.20failure.html#263923733">(Dec 06 2021 at 21:00)</a>:</h4>
<p>At <span class="user-mention" data-user-id="116083">@pnkfelix</span>'s re:Invent workshop, a new-to-Rust participant was stymied by <code>cargo new</code> and <code>cargo init</code> failing with an obtuse error message. </p>
<p><strong>The cause:</strong> they had a broken <a href="https://git-template.readthedocs.io/en/latest/">Git Template</a> install. This issue presumably would have surfaced if they had run <code>git init</code> in any context, but I imagine the participant was mostly cloning repos for work, not init-ing them.</p>
<p><strong>The immediate solution:</strong> We had them run <code>cargo init --vcs none</code>.</p>
<p>Had we not been there and able to help so quickly, I think this participant might have just given up. Nothing about <code>cargo new</code> screams "I'm calling <code>git</code>", so it's not obvious to new-to-rust users that git would be involved at all; this made the hard error all-the-more confusing.</p>
<p><strong>Proposal 1:</strong> <em>The error message should advise the user to run <code>cargo init --vcs none</code>.</em></p>
<p><strong>Proposal 2:</strong> <em>VCS init failures should be a warning.</em></p>



<a name="263923881"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Proposal%3A%20Recover%20gracefully%20from%20VCS%20init%20failure/near/263923881" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Wrenn <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Proposal.3A.20Recover.20gracefully.20from.20VCS.20init.20failure.html#263923881">(Dec 06 2021 at 21:00)</a>:</h4>
<p><em>Proposal 2</em> is my preferred fix, because:</p>
<ol>
<li>cargo inits VCS as a convenience (so it should rarely be an <em>inconvenience</em>)</li>
<li>​if the programmer <em>really</em> wants VCS to work, they'll confront it the first time they try to commit, anyways (which doesn't involve cargo).</li>
</ol>



<a name="263923916"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Proposal%3A%20Recover%20gracefully%20from%20VCS%20init%20failure/near/263923916" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Wrenn <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Proposal.3A.20Recover.20gracefully.20from.20VCS.20init.20failure.html#263923916">(Dec 06 2021 at 21:00)</a>:</h4>
<p>Thoughts?</p>



<a name="263924456"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Proposal%3A%20Recover%20gracefully%20from%20VCS%20init%20failure/near/263924456" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Proposal.3A.20Recover.20gracefully.20from.20VCS.20init.20failure.html#263924456">(Dec 06 2021 at 21:04)</a>:</h4>
<p>Always +1 for better error messages!</p>



<a name="263930325"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Proposal%3A%20Recover%20gracefully%20from%20VCS%20init%20failure/near/263930325" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Proposal.3A.20Recover.20gracefully.20from.20VCS.20init.20failure.html#263930325">(Dec 06 2021 at 21:56)</a>:</h4>
<p>As long as <code>cargo</code> exits with a non-zero status (so that careful scripts written with <code>set -e</code> do fail), making it a warning seems OK.</p>



<a name="263932509"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Proposal%3A%20Recover%20gracefully%20from%20VCS%20init%20failure/near/263932509" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jon Gjengset <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Proposal.3A.20Recover.20gracefully.20from.20VCS.20init.20failure.html#263932509">(Dec 06 2021 at 22:14)</a>:</h4>
<p>I had a related situation come up where a user had a <code>.gitconfig</code> with the result of running</p>
<div class="codehilite"><pre><span></span><code>git config --global url.&quot;git@github.com:&quot;.insteadOf https://github.com/
</code></pre></div>
<p>(see also &lt;<a href="https://www.jvt.me/posts/2019/03/20/git-rewrite-url-https-ssh/">https://www.jvt.me/posts/2019/03/20/git-rewrite-url-https-ssh/</a>&gt;).</p>
<p>This had the awful impact that when Cargo tries to clone crates.io-index, it fails with a permission denied error from git saying that <code>git@github.com/rust-lang/crates.io-index</code> can't be cloned. Now, to me this configuration is absolutely insane, but it seems like it's a thing people use to avoid having to remember the distinction between <code>git@</code> and <code>https://</code> when cloning GitHub repositories. It'd be nice if Cargo could detect this, or at least give a nicer error.</p>



<a name="263933284"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Proposal%3A%20Recover%20gracefully%20from%20VCS%20init%20failure/near/263933284" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Proposal.3A.20Recover.20gracefully.20from.20VCS.20init.20failure.html#263933284">(Dec 06 2021 at 22:20)</a>:</h4>
<p><span class="user-mention" data-user-id="120054">@Jon Gjengset</span> FWIW, we've had this <em>exact</em> issue come up before.</p>



<a name="263933332"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Proposal%3A%20Recover%20gracefully%20from%20VCS%20init%20failure/near/263933332" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Proposal.3A.20Recover.20gracefully.20from.20VCS.20init.20failure.html#263933332">(Dec 06 2021 at 22:20)</a>:</h4>
<p>With pretty much that exact config.</p>



<a name="263933340"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Proposal%3A%20Recover%20gracefully%20from%20VCS%20init%20failure/near/263933340" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Proposal.3A.20Recover.20gracefully.20from.20VCS.20init.20failure.html#263933340">(Dec 06 2021 at 22:20)</a>:</h4>
<p>In terms of how to fix configurations, I would generally suggest that people use <code>pushInsteadOf</code> rather than <code>insteadOf</code>.</p>



<a name="263933352"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Proposal%3A%20Recover%20gracefully%20from%20VCS%20init%20failure/near/263933352" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jon Gjengset <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Proposal.3A.20Recover.20gracefully.20from.20VCS.20init.20failure.html#263933352">(Dec 06 2021 at 22:20)</a>:</h4>
<p>It was _really_ confusing to try to debug, that's for sure!</p>



<a name="263933376"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Proposal%3A%20Recover%20gracefully%20from%20VCS%20init%20failure/near/263933376" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Proposal.3A.20Recover.20gracefully.20from.20VCS.20init.20failure.html#263933376">(Dec 06 2021 at 22:21)</a>:</h4>
<p>(FWIW, I'm the one who added <code>pushInsteadOf</code> to git, for just such purposes. :) )</p>



<a name="263933397"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Proposal%3A%20Recover%20gracefully%20from%20VCS%20init%20failure/near/263933397" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Proposal.3A.20Recover.20gracefully.20from.20VCS.20init.20failure.html#263933397">(Dec 06 2021 at 22:21)</a>:</h4>
<p>That said, there are <em>valid</em> reasons to want to use <code>insteadOf</code> here.</p>



<a name="263933427"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Proposal%3A%20Recover%20gracefully%20from%20VCS%20init%20failure/near/263933427" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Proposal.3A.20Recover.20gracefully.20from.20VCS.20init.20failure.html#263933427">(Dec 06 2021 at 22:21)</a>:</h4>
<p>For instance, it'd mean that cloning private repositories works with just copy-paste.</p>



<a name="263933481"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Proposal%3A%20Recover%20gracefully%20from%20VCS%20init%20failure/near/263933481" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jon Gjengset <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Proposal.3A.20Recover.20gracefully.20from.20VCS.20init.20failure.html#263933481">(Dec 06 2021 at 22:22)</a>:</h4>
<p>Oh, absolutely! My _only_ concern here is that Cargo should make it easier to identify that that's what went wrong.</p>



<a name="263933494"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Proposal%3A%20Recover%20gracefully%20from%20VCS%20init%20failure/near/263933494" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Proposal.3A.20Recover.20gracefully.20from.20VCS.20init.20failure.html#263933494">(Dec 06 2021 at 22:22)</a>:</h4>
<p>(Since you can't clone a private repo without authentication, and SSH authentication Just Works but HTTPS authentication requires configuration.)</p>



<a name="263933499"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Proposal%3A%20Recover%20gracefully%20from%20VCS%20init%20failure/near/263933499" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Proposal.3A.20Recover.20gracefully.20from.20VCS.20init.20failure.html#263933499">(Dec 06 2021 at 22:22)</a>:</h4>
<p><span class="user-mention silent" data-user-id="120054">Jon Gjengset</span> <a href="#narrow/stream/246057-t-cargo/topic/Proposal.3A.20Recover.20gracefully.20from.20VCS.20init.20failure/near/263933481">said</a>:</p>
<blockquote>
<p>Oh, absolutely! My _only_ concern here is that Cargo should make it easier to identify that that's what went wrong.</p>
</blockquote>
<p>Yeah, I agree entirely.</p>



<a name="263933563"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Proposal%3A%20Recover%20gracefully%20from%20VCS%20init%20failure/near/263933563" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Proposal.3A.20Recover.20gracefully.20from.20VCS.20init.20failure.html#263933563">(Dec 06 2021 at 22:23)</a>:</h4>
<p>So, libgit2 and by extension git2-rs <em>should</em> make it possible to detect when configuration is remapping the URL.</p>



<a name="263933589"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Proposal%3A%20Recover%20gracefully%20from%20VCS%20init%20failure/near/263933589" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Proposal.3A.20Recover.20gracefully.20from.20VCS.20init.20failure.html#263933589">(Dec 06 2021 at 22:23)</a>:</h4>
<p>And anytime the URL for the index gets remapped, we might want to print a warning.</p>



<a name="263933717"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Proposal%3A%20Recover%20gracefully%20from%20VCS%20init%20failure/near/263933717" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Proposal.3A.20Recover.20gracefully.20from.20VCS.20init.20failure.html#263933717">(Dec 06 2021 at 22:24)</a>:</h4>
<p>Is <code>git@github.com/rust-lang/crates.io-index</code> failing because the user doesn't actually have SSH authentication configured, or because that configuration isn't picked up by Cargo?</p>



<a name="263933963"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Proposal%3A%20Recover%20gracefully%20from%20VCS%20init%20failure/near/263933963" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jon Gjengset <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Proposal.3A.20Recover.20gracefully.20from.20VCS.20init.20failure.html#263933963">(Dec 06 2021 at 22:26)</a>:</h4>
<p>This was about a week ago at a workshop, so don't have the actual configuration available. It seems likely they had GitHub configuration set up (given that they had that rule)</p>



<a name="263935359"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Proposal%3A%20Recover%20gracefully%20from%20VCS%20init%20failure/near/263935359" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Proposal.3A.20Recover.20gracefully.20from.20VCS.20init.20failure.html#263935359">(Dec 06 2021 at 22:42)</a>:</h4>
<p>Right, but I'm wondering if it was set up in a way that git would use but libgit2 wouldn't.</p>



<a name="263935389"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Proposal%3A%20Recover%20gracefully%20from%20VCS%20init%20failure/near/263935389" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Proposal.3A.20Recover.20gracefully.20from.20VCS.20init.20failure.html#263935389">(Dec 06 2021 at 22:42)</a>:</h4>
<p>For instance, libgit2 can use git configuration, but libgit2 uses libssh2 and libssh2 doesn't use SSH configuration.</p>



<a name="263938558"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Proposal%3A%20Recover%20gracefully%20from%20VCS%20init%20failure/near/263938558" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Proposal.3A.20Recover.20gracefully.20from.20VCS.20init.20failure.html#263938558">(Dec 06 2021 at 23:14)</a>:</h4>
<p><span class="user-mention" data-user-id="219211">@Jack Wrenn</span> Do you know the exact error message that they received?  If the template was simply missing, then that has been fixed, but will be waiting for a new release of libgit2.</p>
<p>Also, feel free to post suggestions for things like this as an issue at <a href="https://github.com/rust-lang/cargo/issues/">https://github.com/rust-lang/cargo/issues/</a>.  It is easy for things to get lost on chat.</p>



<a name="263945245"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Proposal%3A%20Recover%20gracefully%20from%20VCS%20init%20failure/near/263945245" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Wrenn <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Proposal.3A.20Recover.20gracefully.20from.20VCS.20init.20failure.html#263945245">(Dec 07 2021 at 00:42)</a>:</h4>
<p><span class="user-mention" data-user-id="120518">@Eric Huss</span> IIRC, the error was something like "could not stat ~/.git_template", because it didn't exist. My memory is a little hazy.</p>



<a name="263947704"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Proposal%3A%20Recover%20gracefully%20from%20VCS%20init%20failure/near/263947704" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Proposal.3A.20Recover.20gracefully.20from.20VCS.20init.20failure.html#263947704">(Dec 07 2021 at 01:18)</a>:</h4>
<p>Yea, then I believe that is <a href="https://github.com/rust-lang/cargo/issues/10038">https://github.com/rust-lang/cargo/issues/10038</a>.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>