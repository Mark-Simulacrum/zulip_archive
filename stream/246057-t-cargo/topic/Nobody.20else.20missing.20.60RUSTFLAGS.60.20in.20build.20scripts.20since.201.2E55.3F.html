<html>
<head><meta charset="utf-8"><title>Nobody else missing `RUSTFLAGS` in build scripts since 1.55? · t-cargo · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/index.html">t-cargo</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Nobody.20else.20missing.20.60RUSTFLAGS.60.20in.20build.20scripts.20since.201.2E55.3F.html">Nobody else missing `RUSTFLAGS` in build scripts since 1.55?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="269120941"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Nobody%20else%20missing%20%60RUSTFLAGS%60%20in%20build%20scripts%20since%201.55%3F/near/269120941" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colin Finck <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Nobody.20else.20missing.20.60RUSTFLAGS.60.20in.20build.20scripts.20since.201.2E55.3F.html#269120941">(Jan 24 2022 at 15:22)</a>:</h4>
<p>Hey all! I've reported <a href="https://github.com/rust-lang/cargo/issues/10321">https://github.com/rust-lang/cargo/issues/10321</a> today, along with the guilty commit and a one-liner change that would bring back the missing <code>RUSTFLAGS</code> for me.<br>
I'm surprised though that I'm apparently the first one to hit this problem.</p>
<p>Hasn't anyone else missed <code>RUSTFLAGS</code> in build scripts since Cargo 1.55.0? Am I overlooking something here?<br>
And would my fix work or does it break something else?</p>



<a name="269121397"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Nobody%20else%20missing%20%60RUSTFLAGS%60%20in%20build%20scripts%20since%201.55%3F/near/269121397" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Weihang Lo <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Nobody.20else.20missing.20.60RUSTFLAGS.60.20in.20build.20scripts.20since.201.2E55.3F.html#269121397">(Jan 24 2022 at 15:25)</a>:</h4>
<p>Just FYI. Here is an similar issue: <a href="https://github.com/rust-lang/cargo/issues/10111">https://github.com/rust-lang/cargo/issues/10111</a></p>



<a name="269123724"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Nobody%20else%20missing%20%60RUSTFLAGS%60%20in%20build%20scripts%20since%201.55%3F/near/269123724" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colin Finck <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Nobody.20else.20missing.20.60RUSTFLAGS.60.20in.20build.20scripts.20since.201.2E55.3F.html#269123724">(Jan 24 2022 at 15:40)</a>:</h4>
<p>Thanks! I'll update my issue with that information</p>



<a name="269133803"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Nobody%20else%20missing%20%60RUSTFLAGS%60%20in%20build%20scripts%20since%201.55%3F/near/269133803" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Nobody.20else.20missing.20.60RUSTFLAGS.60.20in.20build.20scripts.20since.201.2E55.3F.html#269133803">(Jan 24 2022 at 16:46)</a>:</h4>
<p>I'll try to tend to autocfg for that this week</p>



<a name="269133825"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Nobody%20else%20missing%20%60RUSTFLAGS%60%20in%20build%20scripts%20since%201.55%3F/near/269133825" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Nobody.20else.20missing.20.60RUSTFLAGS.60.20in.20build.20scripts.20since.201.2E55.3F.html#269133825">(Jan 24 2022 at 16:46)</a>:</h4>
<p>I think I even had a WIP branch somewhere...</p>



<a name="269134627"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Nobody%20else%20missing%20%60RUSTFLAGS%60%20in%20build%20scripts%20since%201.55%3F/near/269134627" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Nobody.20else.20missing.20.60RUSTFLAGS.60.20in.20build.20scripts.20since.201.2E55.3F.html#269134627">(Jan 24 2022 at 16:51)</a>:</h4>
<p>TLDR Using <code>RUSTFLAGS</code> is unreliable and incomplete. Switching to <code>CARGO_ENCODED_RUSTFLAGS</code> is the correct solution. (Maybe with a fallback to <code>RUSTFLAGS</code> for older Cargo support.)<br>
We probably should have thought more carefully about the upgrade path, but by the time we noticed it it had been out for two releases so we double down on making people to upgrade.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>