<html>
<head><meta charset="utf-8"><title>Securely publish packages from CI/CD without secrets · t-cargo · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/index.html">t-cargo</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Securely.20publish.20packages.20from.20CI.2FCD.20without.20secrets.html">Securely publish packages from CI/CD without secrets</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="274618147"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Securely%20publish%20packages%20from%20CI/CD%20without%20secrets/near/274618147" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Erickson <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Securely.20publish.20packages.20from.20CI.2FCD.20without.20secrets.html#274618147">(Mar 08 2022 at 22:39)</a>:</h4>
<p>Securely publish packages from CI/CD without secrets</p>
<p><strong>Background:</strong><br>
There are a significant number of attacks on the authentication of popular package owners.  Attackers gain access to the account of the package owner and publish a malicious version of the package to a public package repository.<br>
<strong>Existing mitigation:</strong><br>
Require strong authentication for the package owners. The most common example of this is multi-factor authentication.  However, integrating 2FA into CI/CD has always been painful and generally involves “use 2FA to create a bearer token that doesn’t need 2FA”.<br>
<strong>A new tool in the toolbox:</strong><br>
There is a recent push to allow GitHub Actions perform secure and trusted operations directly against major cloud providers: About security hardening with OpenID Connect - GitHub Docs. Other CI providers could also do this - GitLab already does.</p>
<p>At a high-level, in addition to cloud resources (e.g S3) allowing access to specific individuals (e.g. <a href="mailto:jerick@microsoft.com">jerick@microsoft.com</a>), they can also be configured to allow specific accesses to specific subsets of GitHub Actions runs themselves.  That is, you can think of “Actions runs of the <code>main</code> branch of <a href="https://github.com/johnterickson/actions-oidc-demo”">https://github.com/johnterickson/actions-oidc-demo”</a> being an identity itself independent of any person.  Moreover, this is done in a way that no secrets are needed in the Actions run.<br>
<strong>Proposal:</strong><br>
Connecting this with the issue of package ownership hijacking, we could imagine a setup where popular packages (e.g. <a href="https://www.npmjs.com/package/coa">https://www.npmjs.com/package/coa</a> ) are configured to only allow publishes from either 1) interactive 2FA login (e.g. with TOTP) or 2) Actions runs of the <code>main</code> branch of <a href="https://github.com/veged/coa">https://github.com/veged/coa</a>.  We would encourage the later because 1) it doesn’t involve secrets or unwieldy 2FA and 2) it would also provide <a href="http://npmjs.com">npmjs.com</a> cryptographic chain-of-custody proof that the package was actually a build of <a href="https://github.com/veged/coa">https://github.com/veged/coa</a> at commit XYZ because that information is embedded in the token that Actions uses.</p>



<a name="274619504"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Securely%20publish%20packages%20from%20CI/CD%20without%20secrets/near/274619504" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Erickson <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Securely.20publish.20packages.20from.20CI.2FCD.20without.20secrets.html#274619504">(Mar 08 2022 at 22:53)</a>:</h4>
<p>[spinning off this discussion from <a href="#narrow/stream/246057-t-cargo/topic/Cargo.20.3C-.3E.20credential.20manager.20protocol/near/274610999]">https://rust-lang.zulipchat.com/#narrow/stream/246057-t-cargo/topic/Cargo.20.3C-.3E.20credential.20manager.20protocol/near/274610999]</a></p>



<a name="274619877"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Securely%20publish%20packages%20from%20CI/CD%20without%20secrets/near/274619877" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Securely.20publish.20packages.20from.20CI.2FCD.20without.20secrets.html#274619877">(Mar 08 2022 at 22:57)</a>:</h4>
<p>I Love the idea. Of course, the devils' in the details.</p>



<a name="274620097"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Securely%20publish%20packages%20from%20CI/CD%20without%20secrets/near/274620097" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Erickson <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Securely.20publish.20packages.20from.20CI.2FCD.20without.20secrets.html#274620097">(Mar 08 2022 at 22:59)</a>:</h4>
<p>I had thrown the idea "over the fence" to <a href="http://nuget.org">nuget.org</a> and <a href="http://npmjs.com">npmjs.com</a> before the winter holidays.  I'm checking in with them to see if anything went from that.  If <code>npmjs</code> is onboard then, hopefully,  <code>crates</code> can just say "me too"</p>



<a name="274621585"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Securely%20publish%20packages%20from%20CI/CD%20without%20secrets/near/274621585" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Securely.20publish.20packages.20from.20CI.2FCD.20without.20secrets.html#274621585">(Mar 08 2022 at 23:14)</a>:</h4>
<p>So one big question about this is does this need cargo support or does it just need <a href="http://crates.io">crates.io</a> support?</p>



<a name="274621658"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Securely%20publish%20packages%20from%20CI/CD%20without%20secrets/near/274621658" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Securely.20publish.20packages.20from.20CI.2FCD.20without.20secrets.html#274621658">(Mar 08 2022 at 23:15)</a>:</h4>
<p>(note that <a href="http://crates.io">crates.io</a> is maintained by a different team <a href="https://www.rust-lang.org/governance/teams/crates-io">https://www.rust-lang.org/governance/teams/crates-io</a>)</p>



<a name="274622560"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Securely%20publish%20packages%20from%20CI/CD%20without%20secrets/near/274622560" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Erickson <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Securely.20publish.20packages.20from.20CI.2FCD.20without.20secrets.html#274622560">(Mar 08 2022 at 23:25)</a>:</h4>
<p>Great point! I think <a href="http://crates.io">crates.io</a> is the better team to discuss with</p>



<a name="274622914"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Securely%20publish%20packages%20from%20CI/CD%20without%20secrets/near/274622914" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Securely.20publish.20packages.20from.20CI.2FCD.20without.20secrets.html#274622914">(Mar 08 2022 at 23:29)</a>:</h4>
<p>Would love to see a proof of concept based on a <code>credential provider</code> or an environment variable, and when it's working well we can figure out how cargo could make it first class!</p>



<a name="274624967"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Securely%20publish%20packages%20from%20CI/CD%20without%20secrets/near/274624967" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Securely.20publish.20packages.20from.20CI.2FCD.20without.20secrets.html#274624967">(Mar 08 2022 at 23:53)</a>:</h4>
<p>I like the concept here, but I think this still needs some degree of OpenID Connect support directly in cargo.</p>



<a name="274624987"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Securely%20publish%20packages%20from%20CI/CD%20without%20secrets/near/274624987" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Securely.20publish.20packages.20from.20CI.2FCD.20without.20secrets.html#274624987">(Mar 08 2022 at 23:53)</a>:</h4>
<p>It's more a <a href="http://crates.io">crates.io</a> thing than a cargo thing, but you'd need Cargo support for the delegated authentication via GHA.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>