<html>
<head><meta charset="utf-8"><title>Git deps and shalow clones · t-cargo · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/index.html">t-cargo</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Git.20deps.20and.20shalow.20clones.html">Git deps and shalow clones</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="256092645"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Git%20deps%20and%20shalow%20clones/near/256092645" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Git.20deps.20and.20shalow.20clones.html#256092645">(Oct 04 2021 at 16:54)</a>:</h4>
<p>When Cargo downloads a git dep, does it do a shallow clone? What if it is a git dep on a Tag?<br>
Looking <a href="https://github.com/rust-lang/cargo/blob/58a961314437258065e23cb6316dfc121d96fb71/src/cargo/sources/git/source.rs#L154">here</a> and <a href="https://github.com/rust-lang/cargo/blob/7d7c37089d6028bd3a96161ed7cf8e53bda80664/src/cargo/sources/git/utils.rs#L83">here</a> it looks like the answer is no. Did I miss something? If not is there a reason it can't be a shallow clone?</p>



<a name="256093248"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Git%20deps%20and%20shalow%20clones/near/256093248" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Git.20deps.20and.20shalow.20clones.html#256093248">(Oct 04 2021 at 16:58)</a>:</h4>
<p>When updating a shallow clone, a lot more processing power is necessary on the server than for a deep clone to determine which objects need to be sent. Homebrew used to do them, but github requested it to be changed: <a href="https://github.com/Homebrew/brew/pull/9383">https://github.com/Homebrew/brew/pull/9383</a></p>



<a name="256093940"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Git%20deps%20and%20shalow%20clones/near/256093940" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Git.20deps.20and.20shalow.20clones.html#256093940">(Oct 04 2021 at 17:02)</a>:</h4>
<p>Right, but I don't think Cargo does updates on deps. I think it starts over and re downlowads the hole thing.</p>



<a name="256093980"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Git%20deps%20and%20shalow%20clones/near/256093980" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Git.20deps.20and.20shalow.20clones.html#256093980">(Oct 04 2021 at 17:02)</a>:</h4>
<p>If the tag changes.</p>



<a name="256094355"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Git%20deps%20and%20shalow%20clones/near/256094355" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Git.20deps.20and.20shalow.20clones.html#256094355">(Oct 04 2021 at 17:04)</a>:</h4>
<p>I believe it does update. At least when using <code>cargo update</code> without pinning a specific commit or tag.</p>



<a name="256095248"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Git%20deps%20and%20shalow%20clones/near/256095248" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Git.20deps.20and.20shalow.20clones.html#256095248">(Oct 04 2021 at 17:10)</a>:</h4>
<p>Ok, so probably this should only be when there is a specific commit or tag.</p>



<a name="256095919"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Git%20deps%20and%20shalow%20clones/near/256095919" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Git.20deps.20and.20shalow.20clones.html#256095919">(Oct 04 2021 at 17:14)</a>:</h4>
<p>I am not sure github allows you to do a shallow clone of a specific commit instead of specific branch.</p>



<a name="256095972"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Git%20deps%20and%20shalow%20clones/near/256095972" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Git.20deps.20and.20shalow.20clones.html#256095972">(Oct 04 2021 at 17:14)</a>:</h4>
<p>Github does have a way to download a zip file of a specific commit though.</p>



<a name="256100558"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Git%20deps%20and%20shalow%20clones/near/256100558" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Git.20deps.20and.20shalow.20clones.html#256100558">(Oct 04 2021 at 17:42)</a>:</h4>
<p><span class="user-mention" data-user-id="120179">@Eh2406</span> libgit2 does not support shallow clones.</p>
<p>Also, when you update the dependency, it shouldn't redownload the whole thing, it should do an incremental fetch.  Cargo does make a complete copy of the repo, but that is a local copy (similar to a git workspace).</p>



<a name="256101358"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Git%20deps%20and%20shalow%20clones/near/256101358" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Git.20deps.20and.20shalow.20clones.html#256101358">(Oct 04 2021 at 17:48)</a>:</h4>
<p><span class="user-mention" data-user-id="120518">@Eric Huss</span> Thank you! That makes sense!</p>



<a name="256315675"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/Git%20deps%20and%20shalow%20clones/near/256315675" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Seppanen <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/Git.20deps.20and.20shalow.20clones.html#256315675">(Oct 05 2021 at 20:41)</a>:</h4>
<p><span class="user-mention silent" data-user-id="133247">bjorn3</span> <a href="#narrow/stream/246057-t-cargo/topic/Git.20deps.20and.20shalow.20clones/near/256095919">said</a>:</p>
<blockquote>
<p>I am not sure github allows you to do a shallow clone of a specific commit instead of specific branch.</p>
</blockquote>
<p>I am able to get a shallow clone of a specific commit like this:</p>
<div class="codehilite"><pre><span></span><code>shallow-test$ git init .
shallow-test$ git remote add origin https://github.com/rust-lang/cargo.git
shallow-test$ git fetch --depth=1 origin 4532d20a6bcca226201ae9b8fc17520ee1bf3ec3
</code></pre></div>
<p>The stdout chatter tells me it downloaded 763 objects (versus 88353 for a full clone)</p>
<p>That may not be very ergonomic, but it seems to be possible at the git + github level.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>