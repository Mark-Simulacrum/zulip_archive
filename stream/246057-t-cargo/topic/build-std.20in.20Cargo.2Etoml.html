<html>
<head><meta charset="utf-8"><title>build-std in Cargo.toml · t-cargo · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/index.html">t-cargo</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/build-std.20in.20Cargo.2Etoml.html">build-std in Cargo.toml</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="268603472"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/build-std%20in%20Cargo.toml/near/268603472" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/build-std.20in.20Cargo.2Etoml.html#268603472">(Jan 19 2022 at 21:06)</a>:</h4>
<p>I was reading over  <a href="https://github.com/rust-lang/cargo/pull/10308">https://github.com/rust-lang/cargo/pull/10308</a> today which points to <a href="https://internals.rust-lang.org/t/proposal-move-some-cargo-config-settings-to-cargo-toml/13336/14?u=fee1-dead">https://internals.rust-lang.org/t/proposal-move-some-cargo-config-settings-to-cargo-toml/13336/14?u=fee1-dead</a> saying that we decided in a meeting that this was ok to implement. I may have missed that meeting or I guess I've forgotten, but I recall that we specifically didn't put this setting in the manifest because it's a build-time configuration thing rather than a global configuration thing on the workspace?</p>
<p>Additionally this PR also claims to fix <a href="https://github.com/rust-lang/cargo/issues/9451">https://github.com/rust-lang/cargo/issues/9451</a> but I'm not sure how moving the configuration around would do that...</p>



<a name="268604676"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/build-std%20in%20Cargo.toml/near/268604676" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/build-std.20in.20Cargo.2Etoml.html#268604676">(Jan 19 2022 at 21:17)</a>:</h4>
<p>As I recall the meeting we were OK with the idea of moving them in general, but wanted them in small chunks so that we could review for exactly this kind of thing. I would not read that comment as saying "we looked over the list and were totally OK with everything you said".  If there are reasons this one should not move, we don't need to move it. imo.</p>



<a name="268604888"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/build-std%20in%20Cargo.toml/near/268604888" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/build-std.20in.20Cargo.2Etoml.html#268604888">(Jan 19 2022 at 21:19)</a>:</h4>
<p>This, exactly. The general concept of "go ahead and do this in reasonable chunks" was something we had consensus on, but the specifics of any one item we didn't necessarily have <em>complete</em> consensus on.</p>



<a name="268604972"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/build-std%20in%20Cargo.toml/near/268604972" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/build-std.20in.20Cargo.2Etoml.html#268604972">(Jan 19 2022 at 21:20)</a>:</h4>
<p>hm I may still be forgetting what we talked about, what is there to move other than the <code>build-std</code> configuration itself? Right now there's not really any other configuration and it's just lots of stuff within Cargo that gets tweaked</p>



<a name="268604987"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/build-std%20in%20Cargo.toml/near/268604987" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/build-std.20in.20Cargo.2Etoml.html#268604987">(Jan 19 2022 at 21:20)</a>:</h4>
<p>so I'm not sure what it means to incrementally move from <code>.cargo/config.toml</code> to <code>Cargo.toml</code></p>



<a name="268605200"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/build-std%20in%20Cargo.toml/near/268605200" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/build-std.20in.20Cargo.2Etoml.html#268605200">(Jan 19 2022 at 21:22)</a>:</h4>
<p><span class="user-mention" data-user-id="116015">@Alex Crichton</span> This wasn't just about build-std, it was about all sorts of settings from <code>.cargo/config.toml</code>.</p>



<a name="268605204"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/build-std%20in%20Cargo.toml/near/268605204" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/build-std.20in.20Cargo.2Etoml.html#268605204">(Jan 19 2022 at 21:22)</a>:</h4>
<p>The internal thread was about lots of things not just bild std</p>



<a name="268605221"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/build-std%20in%20Cargo.toml/near/268605221" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/build-std.20in.20Cargo.2Etoml.html#268605221">(Jan 19 2022 at 21:22)</a>:</h4>
<p>aha</p>



<a name="268605236"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/build-std%20in%20Cargo.toml/near/268605236" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/build-std.20in.20Cargo.2Etoml.html#268605236">(Jan 19 2022 at 21:23)</a>:</h4>
<p>wow I'm blind and can't read the title</p>



<a name="268606208"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/build-std%20in%20Cargo.toml/near/268606208" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/build-std.20in.20Cargo.2Etoml.html#268606208">(Jan 19 2022 at 21:31)</a>:</h4>
<p>I don't really remember the discussion.   Just a quick peek, I would prefer to not make build-std part of <code>Cargo.toml</code> at this time.  I think it is a global setting, and doesn't make sense to be per-package.</p>
<p>It's hard to see if it addresses <a href="https://github.com/rust-lang/cargo/issues/9451">cargo#9451</a>, as I think per-package-target is essentially unfinished (unrelated to build-std).</p>
<p>I would prefer not to move forward with big changes to this section of cargo while <a href="https://github.com/rust-lang/cargo/issues/9992">cargo#9992</a> is in flight.</p>



<a name="268679361"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/build-std%20in%20Cargo.toml/near/268679361" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fee1-dead <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/build-std.20in.20Cargo.2Etoml.html#268679361">(Jan 20 2022 at 11:39)</a>:</h4>
<blockquote>
<p>It's hard to see if it addresses <a href="https://github.com/rust-lang/cargo/issues/9451">cargo#9451</a>, as I think per-package-target is essentially unfinished (unrelated to build-std).</p>
</blockquote>
<p>I'm the author of the PR, and it resolves that issue because the build-std handling logic is now for each package instead of the entire build. I just abstracted simple logic that retrieves the CompileKinds for a package (which respects per-package-target). FYI I added a test for build-std interacting with per-package-target and it passed CI (<a href="https://github.com/rust-lang/cargo/pull/10308/commits/51aa5510c96d3435d72b09d1033f4d998be7472c">https://github.com/rust-lang/cargo/pull/10308/commits/51aa5510c96d3435d72b09d1033f4d998be7472c</a>).</p>
<blockquote>
<p>I think it is a global setting, and doesn't make sense to be per-package.</p>
</blockquote>
<p>It would perhaps make sense for build-std to specify a target-triple to build-std-crates-and-features map, because the problem is users want to use build-std in workspaces and it is annoying to force using cli options when building a bare-metal crate (custom alias could help but simply <code>cargo build</code>/ <code>cargo check</code> wouldn't work)</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>