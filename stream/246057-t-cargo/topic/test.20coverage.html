<html>
<head><meta charset="utf-8"><title>test coverage · t-cargo · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/index.html">t-cargo</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/test.20coverage.html">test coverage</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="274188323"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/test%20coverage/near/274188323" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/test.20coverage.html#274188323">(Mar 04 2022 at 21:06)</a>:</h4>
<p>In <a href="https://github.com/rust-lang/cargo/pull/10449">https://github.com/rust-lang/cargo/pull/10449</a> I was reminded about how badly our tests cover the resolver error messages. (I added one test witch covers some more, but coverage is not good yet.) Today I was looking into how we test <code>cargo login</code> with the token being passed on stdin, but replacing <a href="https://github.com/rust-lang/cargo/blob/9d754ed085a97d486cda45308a3c749c818305a5/src/cargo/ops/registry.rs#L700-L713">the code</a> with <code>todo!()</code>, did not make any test fail.<br>
Is there some way for us to run some kind of test coverage report, given how our tests work?</p>



<a name="274188825"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/test%20coverage/near/274188825" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/test.20coverage.html#274188825">(Mar 04 2022 at 21:11)</a>:</h4>
<p>I don't want to run it on CI and end up gamifying the number.</p>



<a name="274188939"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/test%20coverage/near/274188939" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/test.20coverage.html#274188939">(Mar 04 2022 at 21:12)</a>:</h4>
<p>Long ago, I was able to get the llvm code coverage to work with our tests.</p>



<a name="274188951"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/test%20coverage/near/274188951" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/test.20coverage.html#274188951">(Mar 04 2022 at 21:12)</a>:</h4>
<p>The documentation is at <a href="https://doc.rust-lang.org/nightly/rustc/instrument-coverage.html">https://doc.rust-lang.org/nightly/rustc/instrument-coverage.html</a></p>



<a name="274188971"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/test%20coverage/near/274188971" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/test.20coverage.html#274188971">(Mar 04 2022 at 21:12)</a>:</h4>
<p>I think the only special thing was to include <code>%m</code> in the environment variable</p>



<a name="274189047"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/test%20coverage/near/274189047" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/test.20coverage.html#274189047">(Mar 04 2022 at 21:13)</a>:</h4>
<p>If we can get to the point where it is documented how to do this for cargo that would be amazing.</p>



<a name="274189082"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/test%20coverage/near/274189082" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/test.20coverage.html#274189082">(Mar 04 2022 at 21:13)</a>:</h4>
<p>But even if we can just do it as a one-off and open issues for under tested code that would be great.</p>



<a name="274189259"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/test%20coverage/near/274189259" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/test.20coverage.html#274189259">(Mar 04 2022 at 21:15)</a>:</h4>
<p>Ah, here's the commands that I ran:  <a href="#narrow/stream/246057-t-cargo/topic/meeting/near/216405039">https://rust-lang.zulipchat.com/#narrow/stream/246057-t-cargo/topic/meeting/near/216405039</a></p>



<a name="274189452"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/test%20coverage/near/274189452" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/test.20coverage.html#274189452">(Mar 04 2022 at 21:17)</a>:</h4>
<p>Give it a shot and let us know how it goes!  I seem to recall not seeing anything too surprising.  Mostly I saw things not covered were some error cases, a lot of networking code, and a few old commands that never got any tests.</p>



<a name="274189512"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/test%20coverage/near/274189512" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/test.20coverage.html#274189512">(Mar 04 2022 at 21:17)</a>:</h4>
<p><code>-Z instrument-coverage</code> is now <code>-C instrument-coverage</code> on nightly, as it has recently been stabilized.</p>



<a name="274193516"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/test%20coverage/near/274193516" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/test.20coverage.html#274193516">(Mar 04 2022 at 21:52)</a>:</h4>
<p><a href="/user_uploads/4715/1AjgZ2xPgYdLgepm_DTkTa5U/coverage.zip">coverage.zip</a> <br>
comforting in in that the gaps in coverage that inspired this thread are marked read, and lots of other code is covered!</p>



<a name="274195589"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/test%20coverage/near/274195589" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/test.20coverage.html#274195589">(Mar 04 2022 at 22:12)</a>:</h4>
<p>Nice!  I feel the desire to get a little bit better coverage in some places.  I see a few surprising bits in the resolver.</p>



<a name="274195655"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/test%20coverage/near/274195655" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/test.20coverage.html#274195655">(Mar 04 2022 at 22:13)</a>:</h4>
<p>Yes! And some of the error cases do matter!</p>



<a name="274196118"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/test%20coverage/near/274196118" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/test.20coverage.html#274196118">(Mar 04 2022 at 22:18)</a>:</h4>
<p>I ran your instructions. Witch basically worked! But dose not include running <a href="https://github.com/rust-lang/cargo/tree/9d754ed085a97d486cda45308a3c749c818305a5/crates/resolver-tests">crates/resolver-tests</a>, so some of the gaps may be related to that.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>