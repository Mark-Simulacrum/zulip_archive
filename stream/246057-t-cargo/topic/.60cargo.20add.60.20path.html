<html>
<head><meta charset="utf-8"><title>`cargo add` path · t-cargo · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/index.html">t-cargo</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/.60cargo.20add.60.20path.html">`cargo add` path</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="276750770"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/%60cargo%20add%60%20path/near/276750770" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/.60cargo.20add.60.20path.html#276750770">(Mar 26 2022 at 23:00)</a>:</h4>
<p><span class="user-mention" data-user-id="424212">@Ed Page</span> One thing I was thinking about is how the auto-path detection works. It seems like it is a little risky for a few reasons:</p>
<ul>
<li>Slash could interfere with something like <a href="https://github.com/rust-lang/rfcs/issues/3243">rfc#3243</a> (namespaced registry), if that decides to switch back.</li>
<li>It can cause conflicts with paths that aren't packages. For example, <code>cargo add foo</code> and there is a <code>foo</code> directory, but you really wanted <code>foo</code> from <a href="http://crates.io">crates.io</a>.</li>
<li>The error message isn't really great in the previous example.</li>
</ul>
<p>I'm wondering if it could maybe be made a little more robust by only assuming it is a path dependency if the given path includes a <code>Cargo.toml</code>?</p>



<a name="276761535"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/%60cargo%20add%60%20path/near/276761535" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/.60cargo.20add.60.20path.html#276761535">(Mar 27 2022 at 03:30)</a>:</h4>
<p>maybe require <code>./foo</code> for path dependencies, to remove the ambiguity?</p>



<a name="276761548"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/%60cargo%20add%60%20path/near/276761548" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/.60cargo.20add.60.20path.html#276761548">(Mar 27 2022 at 03:30)</a>:</h4>
<p>or require <code>--path</code>, the same way <code>cargo install </code>does</p>



<a name="276909760"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/%60cargo%20add%60%20path/near/276909760" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ed Page <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/.60cargo.20add.60.20path.html#276909760">(Mar 28 2022 at 17:56)</a>:</h4>
<p>So many small decisions; hard to remember what all to explicitly call out :)</p>
<p>cargo-edit originally overloaded the positional argument with</p>
<ul>
<li>name</li>
<li>name:version (see also <code>--vers</code>)</li>
<li>path (see also <code>--path</code>)</li>
<li>git url (see also <code>--git</code>)</li>
</ul>
<p>I was concerned about ambiguity.  This is part of the reason I made git support unstable; I like the idea of the positional argument but didn't like the ambiguity.  Personally, if positional git support came back, I'd have it require <code>git+&lt;url&gt;</code>.</p>
<p>I considered paths and felt that the current approach struck a fairly good balance  At the time, I was not aware of any talk of adding <code>/</code> to package names and the likelihood of a package name conflicting with a file name seemed very low based on the projects I have browsed the code of in the past.  My hope is <a href="https://github.com/rust-lang/rfcs/issues/3243">rfc#3243</a> never goes back to <code>/</code> because the <code>::</code> design fits so well.  I get the impression <span class="user-mention" data-user-id="239881">@Josh Triplett</span> is in a similar boat as he advised me on internals to ignore the RFC.</p>
<p>In reflecting more on it,  the options I see</p>
<ul>
<li>Check if <code>foo</code> exists (today) and improve the error message (always assume params with <code>/</code> are paths)</li>
<li>Check if <code>foo</code> is a directory</li>
<li>Check if <code>foo/Cargo.toml</code> exists</li>
<li>Only if <code>foo</code> is an invalid package name, check do one of the above (at least tab completion on my system adds a trailing <code>/</code> on directories which will probably be a common case)</li>
<li>Check if <code>foo</code> package exists and then fallback to a directory check</li>
<li>Require <code>--path</code></li>
</ul>
<p>In my ideal solution, the CLI wouldn't be modal.  This is one of the factors for me to avoid arguments like <code>--path</code> (another is low-effort so it gets used).  However, the CLI as-is requires modality (<code>--features</code>,  etc).  The multi-add case is also most targeted at documentation which is less likely to happen for path and git dependencies. </p>
<p>Other reasons against <code>--path</code></p>
<ul>
<li>Lower friction for use</li>
<li>Last implementation required still specifying the crate name with it <code>cargo add foo --path ./crates/foo</code>).  This most fits within how cargo-add works but makes things even worse for usability (might as well only do <code>cargo add foo</code> and have cargo-add find the path).</li>
</ul>
<p>My concerns with being smart about path detection by checking if it exists and then assuming its a crate is that could hurt error reporting if the person chose the wrong path (for typos, I'm assuming most people rely on tab completion).</p>
<p>I kind of like the "if its a valid package name, treat it as such" and "check if its a package first" but that requires some decent re-work to defer some decision making.</p>
<p><strong>So my preferences</strong></p>
<ul>
<li>Existing behavior but double check and improve some error reporting</li>
<li>Only treat as path if <code>goo</code> is an invaid package name</li>
<li>Check if <code>foo</code> package exists though this will require some re-work.</li>
</ul>
<p>Thoughts?</p>



<a name="276911163"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/%60cargo%20add%60%20path/near/276911163" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/.60cargo.20add.60.20path.html#276911163">(Mar 28 2022 at 18:08)</a>:</h4>
<p>I agree that we shouldn't require --path. I do think we need disambiguation for git urls (since a git repo can also be a path or some other kind of url).</p>



<a name="276916033"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/%60cargo%20add%60%20path/near/276916033" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Johnson <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/.60cargo.20add.60.20path.html#276916033">(Mar 28 2022 at 18:51)</a>:</h4>
<p>requiring a trailing slash could also work to disambiguate, like <code>foo/</code>, although that is definitely strange. It's clear to me that <code>foo/</code> represents a path, and normal tab completion on my system adds the trailing slash, but I'm not sure it would be easy to remember to do that</p>



<a name="276916191"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/%60cargo%20add%60%20path/near/276916191" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/.60cargo.20add.60.20path.html#276916191">(Mar 28 2022 at 18:53)</a>:</h4>
<p>I think if we require disambiguation it should be a leading <code>./</code> . But I'm not sure if we need disambiguation for that case.</p>



<a name="276920279"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/%60cargo%20add%60%20path/near/276920279" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/.60cargo.20add.60.20path.html#276920279">(Mar 28 2022 at 19:28)</a>:</h4>
<p>I don't think it is really important to have a distinguishing mark.  Just check that the given value <code>foo</code> is a directory with <code>foo/Cargo.toml</code>. Currently it just checks if <code>foo</code> exists.</p>



<a name="276921753"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/%60cargo%20add%60%20path/near/276921753" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ed Page <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/.60cargo.20add.60.20path.html#276921753">(Mar 28 2022 at 19:42)</a>:</h4>
<p>What about if the user chose the wrong directory?  The error message (or behavior) in that case will be a bit unexpected.</p>
<p>Granted, assuming tab completion, there will be a <code>/</code> so maybe this isn't that big of an issue?</p>



<a name="276944165"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/%60cargo%20add%60%20path/near/276944165" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robin Moussu <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/.60cargo.20add.60.20path.html#276944165">(Mar 28 2022 at 23:54)</a>:</h4>
<p>I would expect <code>cargo add -- foo</code> to add the local package foo and <code>cargo add foo --</code> to add the package <code>foo</code> from <a href="http://crates.io">crates.io</a> like many other commands (like <code>git</code>). Using <code>--</code> would be required only when there is ambiguity, and an error would be printed in case of ambiguity (like what <code>git</code> does with tags/branches/sha1 and paths).</p>



<a name="276946131"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/%60cargo%20add%60%20path/near/276946131" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/.60cargo.20add.60.20path.html#276946131">(Mar 29 2022 at 00:30)</a>:</h4>
<p><code>--</code> is usually only for separating non-option args that may look like options. I'd be surprised to have it affect a local/remote choice.</p>



<a name="276976564"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/%60cargo%20add%60%20path/near/276976564" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/.60cargo.20add.60.20path.html#276976564">(Mar 29 2022 at 09:05)</a>:</h4>
<p><span class="user-mention silent" data-user-id="138448">cuviper</span> <a href="#narrow/stream/246057-t-cargo/topic/.60cargo.20add.60.20path/near/276946131">said</a>:</p>
<blockquote>
<p><code>--</code> is usually only for separating non-option args that may look like options. I'd be surprised to have it affect a local/remote choice.</p>
</blockquote>
<p>Likewise.</p>



<a name="277137185"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/%60cargo%20add%60%20path/near/277137185" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/.60cargo.20add.60.20path.html#277137185">(Mar 30 2022 at 12:38)</a>:</h4>
<blockquote>
<p>What about if the user chose the wrong directory?  The error message (or behavior) in that case will be a bit unexpected.</p>
</blockquote>
<blockquote>
<p>Granted, assuming tab completion, there will be a <code>/</code> so maybe this isn't that big of an issue?</p>
</blockquote>
<p>You're relying pretty heavily on tab completion there :/ note that if <code>./foo</code> is a symbolic link, bash will <em>not</em> add a trailing slash in completion.</p>



<a name="277159937"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/246057-t-cargo/topic/%60cargo%20add%60%20path/near/277159937" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Macleod <a href="https://zulip-archive.rust-lang.org/stream/246057-t-cargo/topic/.60cargo.20add.60.20path.html#277159937">(Mar 30 2022 at 15:11)</a>:</h4>
<p>In zsh a normal directory wouldn't get a trailing / either, it only adds the / if you type some non-whitespace</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>