<html>
<head><meta charset="utf-8"><title>Additional context needed for error formatting · project-error-handling · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/index.html">project-error-handling</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting.html">Additional context needed for error formatting</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="249626901"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Additional%20context%20needed%20for%20error%20formatting/near/249626901" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dzmitry Malyshau <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting.html#249626901">(Aug 16 2021 at 18:22)</a>:</h4>
<p>Hi all! In wgpu and naga, we have this common problem that the <code>enum Error</code> contains a bunch of things that are internal to the crate. Like the handles to objects. Displaying them directly is not very useful (just numbers), and we'd need extra context in order to get the descriptions.<br>
Perhaps, somebody could say if this problem has been solved before? We have a rather verbose solution that I'm not happy with.</p>



<a name="249630743"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Additional%20context%20needed%20for%20error%20formatting/near/249630743" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting.html#249630743">(Aug 16 2021 at 18:51)</a>:</h4>
<p><span class="user-mention" data-user-id="247620">@Dzmitry Malyshau</span> can you give more details on what you would like to do that is currently difficult / impossible? I'm not entirely understanding the issue</p>



<a name="249630875"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Additional%20context%20needed%20for%20error%20formatting/near/249630875" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting.html#249630875">(Aug 16 2021 at 18:52)</a>:</h4>
<p>like, is it that you need access to external context when reporting errors in order to properly display the extra context stored in the errors or is it that you want to be able to extract these extra fields from the errors when reporting?</p>



<a name="249630889"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Additional%20context%20needed%20for%20error%20formatting/near/249630889" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting.html#249630889">(Aug 16 2021 at 18:52)</a>:</h4>
<p>or something else entirely</p>



<a name="249631169"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Additional%20context%20needed%20for%20error%20formatting/near/249631169" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dzmitry Malyshau <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting.html#249631169">(Aug 16 2021 at 18:54)</a>:</h4>
<p>yes, pretty much. For example, <code>Error</code> variants contain byte ranges into some input. In order to cite the input chunks, the <code>impl Display</code> needs to have access to that input in addition to the error itself.</p>



<a name="249631864"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Additional%20context%20needed%20for%20error%20formatting/near/249631864" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting.html#249631864">(Aug 16 2021 at 18:59)</a>:</h4>
<p>aah yea</p>



<a name="249632115"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Additional%20context%20needed%20for%20error%20formatting/near/249632115" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting.html#249632115">(Aug 16 2021 at 19:00)</a>:</h4>
<p>so this is related to a lot of the stuff I've worked on for error handling, between eyre and generic member access, so I can explain how I'd solve this though it's not super helpful because a major piece of this is currently missing in the <code>Error</code> trait still</p>



<a name="249632209"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Additional%20context%20needed%20for%20error%20formatting/near/249632209" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting.html#249632209">(Aug 16 2021 at 19:01)</a>:</h4>
<p>but basically, the way I would want to model this is as context you can extract from an arbitrary error, such as your range of bytes which I assume is essentially a <code>Span</code> in your input</p>



<a name="249632330"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Additional%20context%20needed%20for%20error%20formatting/near/249632330" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting.html#249632330">(Aug 16 2021 at 19:02)</a>:</h4>
<p>then a reporter that has access to the additional context such as the input file itself so that it can highlight the span and the snippet of relevant input or w/e</p>



<a name="249632387"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Additional%20context%20needed%20for%20error%20formatting/near/249632387" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting.html#249632387">(Aug 16 2021 at 19:02)</a>:</h4>
<p>so <a href="https://github.com/rust-lang/rfcs/pull/2895">this RFC</a> is supposed to make it so you can extract arbitrary types from errors</p>



<a name="249632439"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Additional%20context%20needed%20for%20error%20formatting/near/249632439" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting.html#249632439">(Aug 16 2021 at 19:03)</a>:</h4>
<p>so you could do something like <code>if let Some(span) = error.context::&lt;MySpanType&gt;() { ... }</code></p>



<a name="249632726"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Additional%20context%20needed%20for%20error%20formatting/near/249632726" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting.html#249632726">(Aug 16 2021 at 19:05)</a>:</h4>
<p>then you could use something like <code>eyre</code> to write your own <a href="https://docs.rs/eyre/0.6.5/eyre/trait.EyreHandler.html">reporting context</a> which would do the job of iterating over the errors through the error trait when reporting, looking for spans, and then displaying them with the additional context as well as including their error messages from their <code>Display</code> impls</p>



<a name="249632752"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Additional%20context%20needed%20for%20error%20formatting/near/249632752" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting.html#249632752">(Aug 16 2021 at 19:05)</a>:</h4>
<p>this assumes that you're type erasing your errors though</p>



<a name="249632758"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Additional%20context%20needed%20for%20error%20formatting/near/249632758" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting.html#249632758">(Aug 16 2021 at 19:05)</a>:</h4>
<p>which may not be a constraint you have</p>



<a name="249632760"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Additional%20context%20needed%20for%20error%20formatting/near/249632760" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting.html#249632760">(Aug 16 2021 at 19:05)</a>:</h4>
<p>I'm not sure</p>



<a name="249632929"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Additional%20context%20needed%20for%20error%20formatting/near/249632929" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting.html#249632929">(Aug 16 2021 at 19:06)</a>:</h4>
<p>if you're reporting a concrete top level error type and you can access your context directly then I'd skip all the generic member access and dyn reporter stuff and write this all by hand</p>



<a name="249632936"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Additional%20context%20needed%20for%20error%20formatting/near/249632936" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting.html#249632936">(Aug 16 2021 at 19:06)</a>:</h4>
<p>since it would be much simpler</p>



<a name="249633137"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Additional%20context%20needed%20for%20error%20formatting/near/249633137" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting.html#249633137">(Aug 16 2021 at 19:08)</a>:</h4>
<p>does that help or am I still misunderstanding?</p>



<a name="249638424"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Additional%20context%20needed%20for%20error%20formatting/near/249638424" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dzmitry Malyshau <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting.html#249638424">(Aug 16 2021 at 19:51)</a>:</h4>
<p>(just finishing a meeting, sorry about the delay)</p>
<blockquote>
<p>if let Some(span) = error.context::&lt;MySpanType&gt;()</p>
</blockquote>
<p>this assumes a single span for the whole error. Our errors may refer to multiple different things (like. "a + b" expression failing would want to refer to the locations where "a" and "b" are defined). So this API doesn't appear to be solving our issue.</p>



<a name="249638666"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Additional%20context%20needed%20for%20error%20formatting/near/249638666" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting.html#249638666">(Aug 16 2021 at 19:53)</a>:</h4>
<p>It's generic so you should be able to represent it however you like. You could extract it as a slice of spans, some other type that contextualizes the spans, an iterator, etc</p>



<a name="249639053"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Additional%20context%20needed%20for%20error%20formatting/near/249639053" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting.html#249639053">(Aug 16 2021 at 19:56)</a>:</h4>
<p>The API is designed to be as flexible as possible and will support owned values, references, DSTs, and even types that contain references, such as a mutable closure which happens to be relevant to executors where you want to be able to pass out a callback that can modify the executors state</p>



<a name="249639800"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Additional%20context%20needed%20for%20error%20formatting/near/249639800" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dzmitry Malyshau <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting.html#249639800">(Aug 16 2021 at 20:01)</a>:</h4>
<blockquote>
<p>if you're reporting a concrete top level error type and you can access your context directly then I'd skip all the generic member access and dyn reporter stuff and write this all by hand</p>
</blockquote>
<p>we have a chain of errors. Supposedly, we have the context, and we can just implement something like <code>fn display(Error, Context, Formatter)</code>.</p>



<a name="249639888"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Additional%20context%20needed%20for%20error%20formatting/near/249639888" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dzmitry Malyshau <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting.html#249639888">(Aug 16 2021 at 20:02)</a>:</h4>
<p>this would mean we can't benefit from <code>thiserror</code> crate any more (but that's ok)</p>



<a name="249639937"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Additional%20context%20needed%20for%20error%20formatting/near/249639937" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dzmitry Malyshau <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting.html#249639937">(Aug 16 2021 at 20:02)</a>:</h4>
<p>I think I'll need to read your RFC carefully. Thank you for pointing to it!</p>



<a name="249639970"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Additional%20context%20needed%20for%20error%20formatting/near/249639970" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting.html#249639970">(Aug 16 2021 at 20:02)</a>:</h4>
<p><span class="user-mention silent" data-user-id="247620">Dzmitry Malyshau</span> <a href="#narrow/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting/near/249639888">said</a>:</p>
<blockquote>
<p>this would mean we can't benefit from <code>thiserror</code> crate any more (but that's ok)</p>
</blockquote>
<p>I'm confused, how would this interact negatively with thiserror?</p>



<a name="249640097"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Additional%20context%20needed%20for%20error%20formatting/near/249640097" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dzmitry Malyshau <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting.html#249640097">(Aug 16 2021 at 20:03)</a>:</h4>
<p>with <code>thiserror</code>, we already put stuff like <code>#[error("blabla")]</code> on each variant. So this will need to go away</p>



<a name="249640148"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Additional%20context%20needed%20for%20error%20formatting/near/249640148" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dzmitry Malyshau <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting.html#249640148">(Aug 16 2021 at 20:04)</a>:</h4>
<p>i.e. if we are manually implementing it, then we no longer use <code>thiserror</code></p>



<a name="249640212"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Additional%20context%20needed%20for%20error%20formatting/near/249640212" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting.html#249640212">(Aug 16 2021 at 20:04)</a>:</h4>
<p>I think there's a disconnect. Are we talking about reporting errors to users as in when you control the entire application</p>



<a name="249640227"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Additional%20context%20needed%20for%20error%20formatting/near/249640227" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting.html#249640227">(Aug 16 2021 at 20:04)</a>:</h4>
<p>or is this designing an error API for a library to be consumed by your users?</p>



<a name="249640291"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Additional%20context%20needed%20for%20error%20formatting/near/249640291" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dzmitry Malyshau <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting.html#249640291">(Aug 16 2021 at 20:05)</a>:</h4>
<p>our case is more of a former</p>



<a name="249640298"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Additional%20context%20needed%20for%20error%20formatting/near/249640298" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting.html#249640298">(Aug 16 2021 at 20:05)</a>:</h4>
<p>because I was assuming the former case where the <code>fn display</code> would just be the last step when printing a chain of errors, and the errors themselves could still have display impls created with derives</p>



<a name="249640391"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Additional%20context%20needed%20for%20error%20formatting/near/249640391" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dzmitry Malyshau <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting.html#249640391">(Aug 16 2021 at 20:06)</a>:</h4>
<p>you are saying <code>fn display</code> would be the last step. What would be the first steps?</p>



<a name="249640398"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Additional%20context%20needed%20for%20error%20formatting/near/249640398" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting.html#249640398">(Aug 16 2021 at 20:06)</a>:</h4>
<p>so i would still expect you to use <code>thiserror</code> for the error messages themselves, but I would expect those error messages to be pieces of the final error report you create at the end that does the last step of contextualizing the spans</p>



<a name="249640520"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Additional%20context%20needed%20for%20error%20formatting/near/249640520" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting.html#249640520">(Aug 16 2021 at 20:07)</a>:</h4>
<p>so the first step would be defining the error types and messages, and then constructing them. The error messages would be simple things like "invalid expression" and then you'd have a report that when it hits that invalid expression error in the chain knows to go look for the spans and add an additional bit of information after the error message itself sort of like rustc errors</p>



<a name="249640550"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Additional%20context%20needed%20for%20error%20formatting/near/249640550" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting.html#249640550">(Aug 16 2021 at 20:07)</a>:</h4>
<p>and that reporting happens in one function at the end when you're handling a concrete error at runtime</p>



<a name="249640663"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Additional%20context%20needed%20for%20error%20formatting/near/249640663" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting.html#249640663">(Aug 16 2021 at 20:08)</a>:</h4>
<p>and that takes the error (chain of errors), the context with the file content and what not, and the Formatter that we're writing the full report back out too</p>



<a name="249640676"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Additional%20context%20needed%20for%20error%20formatting/near/249640676" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting.html#249640676">(Aug 16 2021 at 20:08)</a>:</h4>
<p>and doing all of that is the job of <code>eyre</code></p>



<a name="249640698"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Additional%20context%20needed%20for%20error%20formatting/near/249640698" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting.html#249640698">(Aug 16 2021 at 20:08)</a>:</h4>
<p>but eyre works on <code>dyn Errors</code></p>



<a name="249640725"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Additional%20context%20needed%20for%20error%20formatting/near/249640725" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting.html#249640725">(Aug 16 2021 at 20:08)</a>:</h4>
<p>so it needs generic member access to get the context out of an error type after it has been type erased</p>



<a name="249640736"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Additional%20context%20needed%20for%20error%20formatting/near/249640736" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting.html#249640736">(Aug 16 2021 at 20:08)</a>:</h4>
<p>though if you know the types you can always just downcast</p>



<a name="249640757"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Additional%20context%20needed%20for%20error%20formatting/near/249640757" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting.html#249640757">(Aug 16 2021 at 20:09)</a>:</h4>
<p>so eyre may still be a good call here</p>



<a name="249640957"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Additional%20context%20needed%20for%20error%20formatting/near/249640957" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dzmitry Malyshau <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting.html#249640957">(Aug 16 2021 at 20:10)</a>:</h4>
<p>I don't think I understand very well, yet. You are saying we can look at the error, and report additionally what stuff is in the error. Like if the error is "Unable to add [1] and [2]", we'd report on separate lines something like: "[1]: 'let x = 2'", and "[2]: 'let y = 2*x;'". Right?</p>



<a name="249641182"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Additional%20context%20needed%20for%20error%20formatting/near/249641182" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting.html#249641182">(Aug 16 2021 at 20:12)</a>:</h4>
<p>yea, basically, though you have to add an extra interface to expose this additional information that needs to be reported after the main error message</p>



<a name="249641191"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Additional%20context%20needed%20for%20error%20formatting/near/249641191" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting.html#249641191">(Aug 16 2021 at 20:12)</a>:</h4>
<p><a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_errors/struct.Diagnostic.html">https://doc.rust-lang.org/nightly/nightly-rustc/rustc_errors/struct.Diagnostic.html</a></p>



<a name="249641198"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Additional%20context%20needed%20for%20error%20formatting/near/249641198" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting.html#249641198">(Aug 16 2021 at 20:13)</a>:</h4>
<p>I think this is how rustc does it for their error messages</p>



<a name="249641217"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Additional%20context%20needed%20for%20error%20formatting/near/249641217" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dzmitry Malyshau <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting.html#249641217">(Aug 16 2021 at 20:13)</a>:</h4>
<p>ok, and then what do we do with the chain? are you suggesting to try downcasting the errors in the chain?</p>



<a name="249641354"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Additional%20context%20needed%20for%20error%20formatting/near/249641354" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting.html#249641354">(Aug 16 2021 at 20:14)</a>:</h4>
<p>I don't know enough about your specific constraints to know if that would be applicable, but if you can then that's the best way to get additional context out of errors right now if you want to report more than just an error message at each step in a chain of errors</p>



<a name="249641366"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Additional%20context%20needed%20for%20error%20formatting/near/249641366" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting.html#249641366">(Aug 16 2021 at 20:14)</a>:</h4>
<p>there are some other patterns you can use</p>



<a name="249641429"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Additional%20context%20needed%20for%20error%20formatting/near/249641429" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting.html#249641429">(Aug 16 2021 at 20:15)</a>:</h4>
<p>like a context wrapper type where you can go <code>ErrorContext&lt;MyError&gt;</code> and the <code>ErrorContext</code> stores all the extra information, then you transform the inner error type with a <code>map</code> function, though that doesn't map well to having some context at each step in the chain</p>



<a name="249641484"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Additional%20context%20needed%20for%20error%20formatting/near/249641484" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dzmitry Malyshau <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting.html#249641484">(Aug 16 2021 at 20:15)</a>:</h4>
<p>this sounds close to what we currently have - <a href="https://github.com/gfx-rs/wgpu/blob/ee3b85928e99f44194d0d4abedd88bf65a3a2614/wgpu-core/src/error.rs#L102">https://github.com/gfx-rs/wgpu/blob/ee3b85928e99f44194d0d4abedd88bf65a3a2614/wgpu-core/src/error.rs#L102</a><br>
and I don't like it :(</p>



<a name="249641575"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Additional%20context%20needed%20for%20error%20formatting/near/249641575" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting.html#249641575">(Aug 16 2021 at 20:16)</a>:</h4>
<p>yea :/</p>



<a name="249641586"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Additional%20context%20needed%20for%20error%20formatting/near/249641586" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting.html#249641586">(Aug 16 2021 at 20:16)</a>:</h4>
<p>hence generic member access</p>



<a name="249641616"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Additional%20context%20needed%20for%20error%20formatting/near/249641616" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting.html#249641616">(Aug 16 2021 at 20:16)</a>:</h4>
<p>then you can type erase all the errors and just have a couple common types you're extracting at every step in the chain to get the extra info to report</p>



<a name="249641618"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Additional%20context%20needed%20for%20error%20formatting/near/249641618" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dzmitry Malyshau <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting.html#249641618">(Aug 16 2021 at 20:16)</a>:</h4>
<p>first, because effectively there are 2 places that match the errors: one for the <code>fn display</code> and another for resolving those extra things that need contexts. And secondly, because of downcasts are easy to miss/forget when messing with the error enum.</p>



<a name="249641643"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Additional%20context%20needed%20for%20error%20formatting/near/249641643" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting.html#249641643">(Aug 16 2021 at 20:17)</a>:</h4>
<p>yea, its a mess</p>



<a name="249641702"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Additional%20context%20needed%20for%20error%20formatting/near/249641702" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dzmitry Malyshau <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting.html#249641702">(Aug 16 2021 at 20:17)</a>:</h4>
<p>it sounds like, what we are doing is already not the worst of what we can do today, and in the future I should keep an eye on your RFC</p>



<a name="249641812"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Additional%20context%20needed%20for%20error%20formatting/near/249641812" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dzmitry Malyshau <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting.html#249641812">(Aug 16 2021 at 20:18)</a>:</h4>
<p>Alright, thank you for your time explaining things to me, and good luck with this RFC!</p>



<a name="249641817"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Additional%20context%20needed%20for%20error%20formatting/near/249641817" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting.html#249641817">(Aug 16 2021 at 20:18)</a>:</h4>
<p>ty!</p>



<a name="249641821"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Additional%20context%20needed%20for%20error%20formatting/near/249641821" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Additional.20context.20needed.20for.20error.20formatting.html#249641821">(Aug 16 2021 at 20:18)</a>:</h4>
<p>and my pleasure</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>