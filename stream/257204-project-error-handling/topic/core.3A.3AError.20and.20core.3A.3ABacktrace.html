<html>
<head><meta charset="utf-8"><title>core::Error and core::Backtrace · project-error-handling · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/index.html">project-error-handling</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html">core::Error and core::Backtrace</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="246184217"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246184217" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246184217">(Jul 16 2021 at 04:44)</a>:</h4>
<p>I've been trying to get a handle on the work to move <code>Error</code> and <code>Backtrace</code> from std to core. I have many questions! But before I ask them, I thought it would be useful to write down my understanding as somebody new to the work and leave the links that I think are important, hopefully this will make it easier for others to get involved.</p>



<a name="246184963"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246184963" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246184963">(Jul 16 2021 at 05:00)</a>:</h4>
<p>Big picture, we want to move the <code>Error</code> trait (<a href="https://doc.rust-lang.org/nightly/std/error/trait.Error.html">https://doc.rust-lang.org/nightly/std/error/trait.Error.html</a>) into core. The motivation is to allow integrating <code>Error</code> with the panic infrastructure, make error handling more uniform (e.g., for no-std crates), and facilitate moving other traits to core (I can't find the reference again, but iirc some io traits like Read or Write). This is blocked on two things: the use of <code>Box</code> in <code>downcast()</code> and the use of <code>Backtrace</code> in <code>backtrace()</code>. The former can be solved by moving <code>downcast</code> to an impl on <code>Box&lt;Error&gt;</code> in alloc or std, rather than being an inherent method (see <a href="https://github.com/rust-lang/rust/pull/72981#issuecomment-662143462">https://github.com/rust-lang/rust/pull/72981#issuecomment-662143462</a>). The latter is solved by moving <code>Backtrace</code> to core too. Moving <code>Bactrace</code> to core is blocking its stabilisation (<a href="https://github.com/rust-lang/rust/pull/72981">https://github.com/rust-lang/rust/pull/72981</a>).</p>
<p>Question: is moving <code>Backtrace</code> to core a desire in its own right? E.g., do no-std crates want to use <code>Backtrace</code>?</p>



<a name="246185094"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246185094" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246185094">(Jul 16 2021 at 05:03)</a>:</h4>
<p>Some links:</p>
<ul>
<li>A prototype implementation of <code>Backtrace</code> in core: <a href="https://github.com/rust-lang/rust/pull/77384">https://github.com/rust-lang/rust/pull/77384</a>, work is paused in favour of an RFC</li>
<li>A WIP RFC for <code>Backtrace</code> in core: <a href="https://github.com/JDuchniewicz/rfcs/blob/backtrace-in-core/0000-backtrace-in-core.md">https://github.com/JDuchniewicz/rfcs/blob/backtrace-in-core/0000-backtrace-in-core.md</a></li>
<li>RFC 2504 which proposed <code>Backtrace</code>: <a href="https://github.com/rust-lang/rfcs/blob/master/text/2504-fix-error.md">https://github.com/rust-lang/rfcs/blob/master/text/2504-fix-error.md</a></li>
<li>Tracking issue for the above RFC with some discussion of the core issue: <a href="https://github.com/rust-lang/rust/issues/53487">https://github.com/rust-lang/rust/issues/53487</a></li>
<li>project group issue: <a href="https://github.com/rust-lang/project-error-handling/issues/3">https://github.com/rust-lang/project-error-handling/issues/3</a></li>
<li><code>Backtrace</code> docs: <a href="https://doc.rust-lang.org/nightly/std/backtrace/struct.Backtrace.html">https://doc.rust-lang.org/nightly/std/backtrace/struct.Backtrace.html</a></li>
</ul>



<a name="246185395"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246185395" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246185395">(Jul 16 2021 at 05:10)</a>:</h4>
<p>AIUI, the reason it is non-trivial to move <code>Backtrace</code> into core is that a real, captured  backtrace uses lots of std (or at least alloc) types, so we want the version in core to be somewhat abstract and only provide concrete versions for 'dummy' backtraces, such as those created when capturing a backtrace is disabled. The obvious way to do that is using a trait, but then to pass around a trait object we need to use a pointer type and we can't use <code>Box</code> from core. Furthermore, we want std to extend <code>core::Backtrace</code> with a real backtrace (currently a <code>LazilyResolvedCapture</code>), which means we want <code>Error::backtrace</code> (or some global function which it delegates to) to do something different depending on whether or not std is linked. (Is this correct?)</p>



<a name="246185698"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246185698" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246185698">(Jul 16 2021 at 05:18)</a>:</h4>
<p>That all seems quite accurate</p>



<a name="246185711"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246185711" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246185711">(Jul 16 2021 at 05:18)</a>:</h4>
<p>The source for the read and write traits wanting an error trait in core is another thread I believe in t-libs suggesting having a core::io::Write trait and an associated internals thread by the same author</p>



<a name="246185731"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246185731" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246185731">(Jul 16 2021 at 05:19)</a>:</h4>
<p>That's not a strong motivator at the moment though, since that work is fairly early in the process and we're not sure we can or should do that yet</p>



<a name="246185739"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246185739" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246185739">(Jul 16 2021 at 05:19)</a>:</h4>
<p>As for motivations for a backtrace in core, I don't have concrete examples of people wanting it</p>



<a name="246185786"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246185786" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246185786">(Jul 16 2021 at 05:20)</a>:</h4>
<p>But I know <span class="user-mention" data-user-id="239881">@Josh Triplett</span> and some others have talked about wanting to customize backtrace functionality</p>



<a name="246185789"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246185789" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246185789">(Jul 16 2021 at 05:20)</a>:</h4>
<p>Or it being potentially useful</p>



<a name="246185802"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246185802" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246185802">(Jul 16 2021 at 05:20)</a>:</h4>
<p>So I suspect that there would be value to backtrace in core but I'm not positive it will be useful in its own right</p>



<a name="246185871"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246185871" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246185871">(Jul 16 2021 at 05:22)</a>:</h4>
<p>Also I'd point out that there at least one more alternative to the backtrace dependency blocking Error in core, namely removing the backtrace accessor method on the error trait in favor of the generic member access RFC</p>



<a name="246185943"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246185943" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246185943">(Jul 16 2021 at 05:24)</a>:</h4>
<p>I'm least clear on the possible solutions (there is lots of discussion in lots of places, but I can't figure out what is current and what is obsolete). The RFC doesn't yet specify the solution. The PoC implementation uses a trait for the kind of backtrace, using a raw pointer trait object in <code>Backtrace</code>. There are 'dummy' concrete backtrace types in core, and <code>StdBacktrace</code> in std which has can contain a real backtrace. There are functions for checking if backtraces are enabled and creating one, and these are lang items defined in both core and std. I'm not sure how the compiler knows which one to call, perhaps this is the open question about linking discussed in the comments? std uses a Box to back the raw pointer trait object. There is a fair amount of unsafe code around to facilitate this and some <code>todo!</code>s, I didn't delve into it so I'm not sure if this just requires filling in the gaps or if there are open questions around safety.</p>
<p>I'm not clear if the PoC as implemented is what will be described in the RFC or whether there have been improvements discussed.</p>



<a name="246185970"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246185970" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246185970">(Jul 16 2021 at 05:25)</a>:</h4>
<p>There could very well be safety issues</p>



<a name="246186024"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246186024" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246186024">(Jul 16 2021 at 05:26)</a>:</h4>
<blockquote>
<p>in favor of the generic member access RFC</p>
</blockquote>
<p>For completeness, this is <a href="https://github.com/rust-lang/rfcs/pull/2895">https://github.com/rust-lang/rfcs/pull/2895</a>. AIUI, that is blocked on pulling out some of the more generic mechanisms into a new RFC?</p>



<a name="246186031"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246186031" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246186031">(Jul 16 2021 at 05:26)</a>:</h4>
<p>The PoC is going to be the basis of the RFC, which will then possibly lead to a cleaned up version assuming the lang item route seems best</p>



<a name="246186037"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246186037" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246186037">(Jul 16 2021 at 05:26)</a>:</h4>
<p>Correct</p>



<a name="246186043"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246186043" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246186043">(Jul 16 2021 at 05:26)</a>:</h4>
<p>I need to follow up with <span class="user-mention" data-user-id="263805">@Plecra</span> to see if they're still planning on working on that</p>



<a name="246204958"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246204958" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246204958">(Jul 16 2021 at 10:03)</a>:</h4>
<p>I should probably read the rfc again, but isn’t the backtrace case different to the generic context case because we want to implement backtrace() once for all errors, not implement it each time for individual error types?</p>



<a name="246205235"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246205235" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246205235">(Jul 16 2021 at 10:07)</a>:</h4>
<p>Spitballing an idea, could we have an extension trait ErrorWithBacktrace with the backtrace method on it in std and a blanket impl for all implementers of Error? You’d have to import the trait to get a backtrace so marginally less ergonomic, but it would statically prevent you trying to get a backtrace if you didn’t use std</p>



<a name="246205264"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246205264" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246205264">(Jul 16 2021 at 10:07)</a>:</h4>
<p>(I’m sure there must be a problem with that)</p>



<a name="246226537"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246226537" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246226537">(Jul 16 2021 at 14:01)</a>:</h4>
<p>To answer one question you had Nick: Having the ability to walk a backtrace with an iterator and immediately print it out to whatever sink in a <code>no_std</code> situation without actually allocating would be good to have.</p>



<a name="246227281"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246227281" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246227281">(Jul 16 2021 at 14:06)</a>:</h4>
<p>I'm not sure I understand what you mean <span class="user-mention" data-user-id="256841">@Nick Cameron</span>. As I understand it you can't have a default impl for fn backtrace, you have to manually specify which member you're using as the source of the Backtrace and implement the method per Error type.</p>



<a name="246259596"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246259596" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246259596">(Jul 16 2021 at 18:12)</a>:</h4>
<p>Sorry, I think I was confusing the backtrace method on Error with the methods on Backtrace</p>



<a name="246259782"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246259782" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246259782">(Jul 16 2021 at 18:14)</a>:</h4>
<p>So, is there a reason that backtrace are more privileged than other context info? Ie why do they have their own method rather than being accessed via the context mechanism?</p>



<a name="246259843"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246259843" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246259843">(Jul 16 2021 at 18:15)</a>:</h4>
<p>the argument that was made way back before I started the error handling project group was that <code>Backtrace</code> is the context most people will want to use</p>



<a name="246259986"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246259986" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246259986">(Jul 16 2021 at 18:16)</a>:</h4>
<p>Hmmm</p>



<a name="246260094"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246260094" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246260094">(Jul 16 2021 at 18:17)</a>:</h4>
<p>What about having an ErrorWithBacktrace trait in std which extends the core::Error trait with the backtrace method?</p>



<a name="246260164"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246260164" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246260164">(Jul 16 2021 at 18:17)</a>:</h4>
<p>I'd be worried about people wanting to use that instead of the <code>Error</code> trait and ending up in a similar situation with the <code>Fail</code> trait</p>



<a name="246260239"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246260239" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246260239">(Jul 16 2021 at 18:18)</a>:</h4>
<p>where you have lots of incompatibilities because you need to compose errors one way but they're implemented the other way</p>



<a name="246260281"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246260281" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246260281">(Jul 16 2021 at 18:18)</a>:</h4>
<p>It wouldn’t be quite that bad because you could always upcast to Error</p>



<a name="246260943"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246260943" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246260943">(Jul 16 2021 at 18:24)</a>:</h4>
<p>Another idea which you’ve probably already thought about, the backtrace returns a reference to a Backtrace, so either Backtrace could be a trait, rather than a struct wrapping a trait, or the Backtrace struct could be unsized, either way it means you can’t pass a Backtrace by value, but you don’t need the raw pointer and explicit destructor</p>



<a name="246261362"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246261362" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246261362">(Jul 16 2021 at 18:28)</a>:</h4>
<p>so <code>std</code>'s public API would just be <code>Box&lt;dyn Backtrace&gt;</code> or something?</p>



<a name="246261415"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246261415" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246261415">(Jul 16 2021 at 18:29)</a>:</h4>
<p>So for what?</p>



<a name="246261428"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246261428" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246261428">(Jul 16 2021 at 18:29)</a>:</h4>
<p>sounds much better to me!</p>



<a name="246261433"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246261433" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246261433">(Jul 16 2021 at 18:29)</a>:</h4>
<p>Sorry, api for what?</p>



<a name="246261459"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246261459" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246261459">(Jul 16 2021 at 18:29)</a>:</h4>
<p><span class="user-mention silent" data-user-id="256841">Nick Cameron</span> <a href="#narrow/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace/near/246260281">said</a>:</p>
<blockquote>
<p>It wouldn’t be quite that bad because you could always upcast to Error</p>
</blockquote>
<p>I think it might still fall over when you want to have the <code>ErrorWithBacktrace</code> type be a source error, rather than the outermost error. Now you need to downcast from a <code>dyn Error</code> to a <code>dyn ErrorWithBacktrace</code> or have an alternate <code>source</code> method on <code>ErrorWithBacktrace</code> that returns it as a <code>dyn ErrorWithBacktrace</code>, then you need to check both source methods at each step to iterate fully through a chain of errors</p>



<a name="246261570"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246261570" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246261570">(Jul 16 2021 at 18:30)</a>:</h4>
<p>it might be possible but from experience we know this direction is fraught</p>



<a name="246261647"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246261647" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246261647">(Jul 16 2021 at 18:32)</a>:</h4>
<p>if we had generic member access we could have an extension trait implemented for all <code>E: Error</code> types that just wraps a call to <code>self.context::&lt;Backtrace&gt;()</code> and re-exports that as an <code>fn backtrace()</code></p>



<a name="246261702"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246261702" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246261702">(Jul 16 2021 at 18:32)</a>:</h4>
<p>And another question: why have the methods for capturing a backtrace in core? Could we not have the Backtrace type in core just as an abstraction with no way to capture one, then the capturing functions in a module in std?</p>



<a name="246261703"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246261703" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246261703">(Jul 16 2021 at 18:32)</a>:</h4>
<p>though you'd still have to expose that backtrace internally in the provide method from generic member access</p>



<a name="246261718"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246261718" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246261718">(Jul 16 2021 at 18:32)</a>:</h4>
<p>so <code>fn std::backtrace::capture() -&gt; Box&lt;dyn core::backtrace::Backtrace&gt;</code> (excuse my syntax)</p>



<a name="246261803"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246261803" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246261803">(Jul 16 2021 at 18:33)</a>:</h4>
<p><span class="user-mention silent" data-user-id="256841">Nick Cameron</span> <a href="#narrow/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace/near/246261702">said</a>:</p>
<blockquote>
<p>And another question: why have the methods for capturing a backtrace in core? Could we not have the Backtrace type in core just as an abstraction with no way to capture one, then the capturing functions in a module in std?</p>
</blockquote>
<p>I kinda came at it trying to emulate the way we handle panics</p>



<a name="246261826"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246261826" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246261826">(Jul 16 2021 at 18:33)</a>:</h4>
<p>so I figured if someone writes some <code>no_std</code> code that calls <code>Backtrace::capture</code> but std is actually linked in they'd want to get a full backtrace</p>



<a name="246261839"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246261839" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246261839">(Jul 16 2021 at 18:33)</a>:</h4>
<p>kinda like how you can core panic and have it hit the std panic handler</p>



<a name="246261856"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246261856" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246261856">(Jul 16 2021 at 18:34)</a>:</h4>
<p>Ah, I see, thanks</p>



<a name="246261861"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246261861" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246261861">(Jul 16 2021 at 18:34)</a>:</h4>
<p>but I'm not sure we _need_ it to have a capture interface in core</p>



<a name="246261944"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246261944" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246261944">(Jul 16 2021 at 18:34)</a>:</h4>
<p>Could source return Self rather than Error or is it too late to change that?</p>



<a name="246261955"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246261955" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246261955">(Jul 16 2021 at 18:34)</a>:</h4>
<p><span class="user-mention silent" data-user-id="229517">Jacob Lifshay</span> <a href="#narrow/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace/near/246261362">said</a>:</p>
<blockquote>
<p>so <code>std</code>'s public API would just be <code>Box&lt;dyn Backtrace&gt;</code> or something?</p>
</blockquote>
<p>one of the proposals was to add a Backtrace trait to core and have the type still live in std</p>



<a name="246261979"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246261979" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246261979">(Jul 16 2021 at 18:35)</a>:</h4>
<p>though back when we first discussed that the option of using hooks was preferred</p>



<a name="246261994"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246261994" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246261994">(Jul 16 2021 at 18:35)</a>:</h4>
<p>i think because of the larger repr of a trait object</p>



<a name="246262015"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246262015" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246262015">(Jul 16 2021 at 18:35)</a>:</h4>
<p>and because it would require changing the backtrace fn's interface</p>



<a name="246262020"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246262020" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246262020">(Jul 16 2021 at 18:35)</a>:</h4>
<p>we could always add the <code>fn capture()</code> to <code>alloc</code> later, that way it won't block moving <code>Error</code> to <code>core</code></p>



<a name="246262056"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246262056" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246262056">(Jul 16 2021 at 18:36)</a>:</h4>
<p><span class="user-mention silent" data-user-id="256841">Nick Cameron</span> <a href="#narrow/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace/near/246261944">said</a>:</p>
<blockquote>
<p>Could source return Self rather than Error or is it too late to change that?</p>
</blockquote>
<p>Self as in the concrete type of the error? wouldnt that break object safety or am I misunderstanding?</p>



<a name="246262139"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246262139" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246262139">(Jul 16 2021 at 18:36)</a>:</h4>
<p>Don’t we already pay the larger repr of the trait object because wit is embedded in the Backtrace struct?</p>



<a name="246262182"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246262182" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246262182">(Jul 16 2021 at 18:36)</a>:</h4>
<p>Oh yeah, pesky object safety <span aria-label="frown" class="emoji emoji-1f641" role="img" title="frown">:frown:</span></p>



<a name="246262258"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246262258" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246262258">(Jul 16 2021 at 18:37)</a>:</h4>
<p><span class="user-mention silent" data-user-id="256841">Nick Cameron</span> <a href="#narrow/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace/near/246262139">said</a>:</p>
<blockquote>
<p>Don’t we already pay the larger repr of the trait object because wit is embedded in the Backtrace struct?</p>
</blockquote>
<p>In the PoC impl? uuuh, yea I think you're right <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="246262310"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246262310" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246262310">(Jul 16 2021 at 18:38)</a>:</h4>
<p>that might be a fucky wucky on my part</p>



<a name="246262426"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246262426" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246262426">(Jul 16 2021 at 18:39)</a>:</h4>
<p>Given that there doesn’t seem much motivation to have Backtrace in core other than to support Error, I’d be keen to consider keeping capturing in std if it spares us a lot of complications</p>



<a name="246535904"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246535904" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246535904">(Jul 20 2021 at 01:39)</a>:</h4>
<blockquote>
<p>To answer one question you had Nick: Having the ability to walk a backtrace with an iterator and immediately print it out to whatever sink in a no_std situation without actually allocating would be good to have.</p>
</blockquote>
<p><span class="user-mention" data-user-id="224471">@Lokathor</span> aiui, it will not be possible to collect a backtrace in a no-std crate, so the only way this could happen is if a no-std crate is used by another crate which does use std, and that crate passes an error with a backtrace to the no-std crate, which seems like something which won't happen too often. Did you have another scenario in mind?</p>



<a name="246536009"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246536009" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246536009">(Jul 20 2021 at 01:41)</a>:</h4>
<p>i don't want to collect it to a vec or anything, i want to print it directly right there</p>



<a name="246536181"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246536181" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246536181">(Jul 20 2021 at 01:44)</a>:</h4>
<p>In that case, it seems like you would have to collect the backtrace yourself (since core doesn't give you the OS stuff required to collect the backtrace), so is there any advantage to using a standardised Backtrace type rather than it being a completely custom type?</p>



<a name="246536192"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246536192" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246536192">(Jul 20 2021 at 01:44)</a>:</h4>
<p>(If it even makes sense for there to be a type at all if the data is not being stored)</p>



<a name="246536300"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246536300" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246536300">(Jul 20 2021 at 01:46)</a>:</h4>
<p>In truth I have not been following the full discussion, but I was at one point lead to believe that it would be possible to get an iterator over the backtrace frames, even from within <code>core</code> code. I would want to have a panic handler that could do something like <code>for frame in get_core_backtrace_iterator() { my_embedded_print_fn(frame) }</code></p>



<a name="246536319"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246536319" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246536319">(Jul 20 2021 at 01:47)</a>:</h4>
<p>but if that is not possible, then nevermind</p>



<a name="246536380"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246536380" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246536380">(Jul 20 2021 at 01:48)</a>:</h4>
<p>Heh, I'm new to this, so I may be completely wrong :-) My impression is that that would not be possible, but I'm probably wrong</p>



<a name="246536723"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246536723" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246536723">(Jul 20 2021 at 01:54)</a>:</h4>
<p>is there anything you can do with backtrace frames other than print them? The API seems a little thin</p>



<a name="246536963"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246536963" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246536963">(Jul 20 2021 at 01:59)</a>:</h4>
<p>I think "print them" is non-trivial in this case, you might want to process them to be user friendly or in a specific log format or something. I can imagine some programs might want to make statistical info from them (90% of errors originated from X module or something) or maybe influence recovery (Y was in the backtrace, so there is no point in trying recovery mechanism Z). I'm just guessing what people might do, I have no data</p>



<a name="246536986"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246536986" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246536986">(Jul 20 2021 at 01:59)</a>:</h4>
<p>What do you mean by "pretty thin"? Do you think it should be bigger? Or that it is not worth having at all? Or...?</p>



<a name="246540252"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246540252" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246540252">(Jul 20 2021 at 03:05)</a>:</h4>
<p>If we were to leave the backtrace collection functions in std, could we move them to core later? Since it seems that the std ones would 'override' the core ones anyway?</p>



<a name="246540714"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246540714" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246540714">(Jul 20 2021 at 03:16)</a>:</h4>
<p>So, at a high level the solution space to the Backtrace in std problem seems to be either a) move Backtrace to core, or b) use generic access to get the backtrace from an Error type. In (a), Backtrace would become a trait rather than an enum, and either backtrace returns a trait object, or there is a wrapper type around the trait (as in the current PoC impl). In case (b), we could make things more ergonomic by having an extension trait of Error in std to provide a backtrace method which delegates to the generic access. Obviously, approach (b) is blocked on the generic access work itself.</p>



<a name="246540785"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246540785" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246540785">(Jul 20 2021 at 03:17)</a>:</h4>
<p>In case (a) we could consider the backtrace collection functions too (in case b, I think they just stay in std). We could either leave them in std only, move them to core (as in the current PoC) or leave them in std for now with the option of moving to core/using hooks later.</p>



<a name="246540790"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246540790" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246540790">(Jul 20 2021 at 03:17)</a>:</h4>
<p>Have I missed any alternatives?</p>



<a name="246540874"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246540874" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246540874">(Jul 20 2021 at 03:19)</a>:</h4>
<p><span class="user-mention silent" data-user-id="256841">Nick Cameron</span> <a href="#narrow/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace/near/246536986">said</a>:</p>
<blockquote>
<p>What do you mean by "pretty thin"? Do you think it should be bigger? Or that it is not worth having at all? Or...?</p>
</blockquote>
<p>I think you should be able to programmatically query information about the backtrace: what function it was, what module it was in, maybe the actual code address - any information that can be provided on most platforms. If the only public method is to print it then that means I have to parse the output of the formatter to figure out what's going on, which is exactly the kind of stringly typed API we want to avoid</p>



<a name="246540875"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246540875" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246540875">(Jul 20 2021 at 03:19)</a>:</h4>
<p>From the above solutions, I prefer case (a) since it is not blocked by the generic access work, though if we think the generic access work and moving Error to core are on similar timelines, then (b) is more attractive. If we go with (a), my preference would be to have a Backtrace trait without wrapping it in a concrete type, and to leave the collection functions in std with an open question for moving to core later (if we think that is possible).</p>



<a name="246540958"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246540958" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246540958">(Jul 20 2021 at 03:21)</a>:</h4>
<p><span class="user-mention" data-user-id="271719">@Mario Carneiro</span> agree! My understanding (possibly incorrect, since I am just getting the feel of things) is that Backtrace and BacktraceFrame will have methods added over the long run to support this kind of thing, and that the 'print only' API is just a minimal starting place.</p>



<a name="246540972"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246540972" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246540972">(Jul 20 2021 at 03:21)</a>:</h4>
<p>By "print" we all mean <code>Display::fmt</code> right?</p>



<a name="246540974"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246540974" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246540974">(Jul 20 2021 at 03:21)</a>:</h4>
<p>yes</p>



<a name="246540980"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246540980" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246540980">(Jul 20 2021 at 03:21)</a>:</h4>
<p>I think it has a debug formatter too</p>



<a name="246558246"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246558246" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246558246">(Jul 20 2021 at 08:33)</a>:</h4>
<p>Very stimulating discussion going on here. I will update the RFC with different approaches we can take. As I understood it, we <em>need</em> to move <code>Error</code> to <code>core</code> or at least <code>alloc</code>?</p>



<a name="246558463"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246558463" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246558463">(Jul 20 2021 at 08:35)</a>:</h4>
<p>Also, since <code>no_std</code> users might want the <code>Backtrace</code> to be available, the idea a) as <span class="user-mention" data-user-id="256841">@Nick Cameron</span>  stated, will allow them to write their own impls as they have to write <code>panic</code> fn's themselves</p>



<a name="246558763"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246558763" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246558763">(Jul 20 2021 at 08:38)</a>:</h4>
<p>Not sure about the allocating part of the <code>Backtrace</code> when it is in <code>core</code>. It may be possible to have some preallocated (static) memory we will be filling with out backtrace log and do whatever we need with it. Probably this could be a part of <code>Backtrace</code> API.</p>



<a name="246559142"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246559142" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246559142">(Jul 20 2021 at 08:43)</a>:</h4>
<p>What other methods would you envision in the API? In my opinion simply returning the frames to the user is enough, as people can do whatever they require afterwards.</p>



<a name="246562130"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246562130" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246562130">(Jul 20 2021 at 09:22)</a>:</h4>
<blockquote>
<p>we need to move Error to core</p>
</blockquote>
<p>That is my understanding too</p>



<a name="246562287"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246562287" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246562287">(Jul 20 2021 at 09:24)</a>:</h4>
<blockquote>
<p>Not sure about the allocating part of the Backtrace when it is in core. It may be possible to have some preallocated (static) memory we will be filling with out backtrace log and do whatever we need with it. Probably this could be a part of Backtrace API.</p>
</blockquote>
<p>I guess if we let people implement their own Backtrace types (implementing a Backtrace trait) then they would be free to do this and it shouldn't affect the API too much? As long as we e.g., return references to frames rather than Box or whatever</p>



<a name="246562482"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246562482" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246562482">(Jul 20 2021 at 09:26)</a>:</h4>
<blockquote>
<p>What other methods would you envision in the API? In my opinion simply returning the frames to the user is enough, as people can do whatever they require afterwards.</p>
</blockquote>
<p>I think we can leave this for later? AIUI, we aim to stabilise a minimal Backtrace API for now (just a Display impl, etc) and we can add API for iterating frames later. Having said that, my assumption was that the interesting question is what a Frame object looks like and the Backtrace API would be quite simple, just providing a FrameIterator or something similar</p>



<a name="246907727"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246907727" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246907727">(Jul 22 2021 at 21:21)</a>:</h4>
<p><span class="user-mention" data-user-id="344196">@Jakub Duchniewicz</span> did you get a chance to update the RFC? Is there anything I can help with?</p>



<a name="246959623"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/246959623" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#246959623">(Jul 23 2021 at 10:01)</a>:</h4>
<p><span class="user-mention" data-user-id="256841">@Nick Cameron</span> will be doing it today and during the weekend, I will ask here for clarifications and update my progress</p>



<a name="247186115"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/247186115" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#247186115">(Jul 26 2021 at 10:38)</a>:</h4>
<p>Sorry got bogged down with other work during the weekend. Got to it finally today <span aria-label="east" class="emoji emoji-27a1" role="img" title="east">:east:</span>  (<em>summer is hard to push things through :)</em>)</p>



<a name="247405954"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/247405954" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#247405954">(Jul 27 2021 at 23:25)</a>:</h4>
<p><span class="user-mention" data-user-id="344196">@Jakub Duchniewicz</span> how did the RFC work go? Did you have any questions or do you want a round of feedback?</p>



<a name="247481965"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/247481965" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#247481965">(Jul 28 2021 at 16:28)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="256841">@Nick Cameron</span> I filled out the <a href="https://github.com/JDuchniewicz/rfcs/blob/backtrace-in-core/0000-backtrace-in-core.md">RFC</a> slightly, I would love to get some comments to get me going</p>



<a name="247482034"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/247482034" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#247482034">(Jul 28 2021 at 16:29)</a>:</h4>
<p>summer time is not the easiest time to work on such things for me (a lot of moving around and other commitments :))</p>



<a name="247482073"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/247482073" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#247482073">(Jul 28 2021 at 16:29)</a>:</h4>
<p>hence it does not go as rapidly as I would like it to go</p>



<a name="247482154"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/247482154" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#247482154">(Jul 28 2021 at 16:30)</a>:</h4>
<p>I am not sure how long the RFC should be, as some of them are very lenghty and some are brief</p>



<a name="247482174"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/247482174" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#247482174">(Jul 28 2021 at 16:30)</a>:</h4>
<p>it seems like this is somewhere in between</p>



<a name="247482247"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/247482247" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#247482247">(Jul 28 2021 at 16:30)</a>:</h4>
<p>and I need to include a reference-level explanation in which I will explain how a user might make use of this after its implementation (provide their custom backtrace hooks etc)</p>



<a name="247482312"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/247482312" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#247482312">(Jul 28 2021 at 16:31)</a>:</h4>
<p>not sure what to include in prior art as I think that no-one moved traits in such a way before</p>



<a name="247483744"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/247483744" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#247483744">(Jul 28 2021 at 16:41)</a>:</h4>
<p>Also <span class="user-mention" data-user-id="220273">@Jane Lusby</span> you could take a look and tell me if I am going in the good direction</p>



<a name="247483814"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/247483814" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#247483814">(Jul 28 2021 at 16:41)</a>:</h4>
<p>it is my first RFC so it will for sure require many iterations to get it right <span aria-label="grinning" class="emoji emoji-1f600" role="img" title="grinning">:grinning:</span></p>



<a name="247483901"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/247483901" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#247483901">(Jul 28 2021 at 16:42)</a>:</h4>
<p>hopefully I included all points of view from this discussion along with some of my own</p>



<a name="247493097"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/247493097" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#247493097">(Jul 28 2021 at 17:52)</a>:</h4>
<p><span class="user-mention silent" data-user-id="344196">Jakub Duchniewicz</span> <a href="#narrow/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace/near/247483744">said</a>:</p>
<blockquote>
<p>Also <span class="user-mention silent" data-user-id="220273">Jane Lusby</span> you could take a look and tell me if I am going in the good direction</p>
</blockquote>
<p><span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="247493121"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/247493121" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#247493121">(Jul 28 2021 at 17:53)</a>:</h4>
<p>ill take a look right after the libs meetings</p>



<a name="247498451"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/247498451" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#247498451">(Jul 28 2021 at 18:32)</a>:</h4>
<p>I probably missed the discussion: why can't core's Backtrace implement Display and Debug, which are also in core?</p>



<a name="247520708"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/247520708" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#247520708">(Jul 28 2021 at 21:37)</a>:</h4>
<p>Jakub is there an associated PR for your RFC?</p>



<a name="247520718"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/247520718" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#247520718">(Jul 28 2021 at 21:38)</a>:</h4>
<p>I need somewhere to leave comments</p>



<a name="247549509"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/247549509" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#247549509">(Jul 29 2021 at 06:43)</a>:</h4>
<p>I will open a PR right now</p>



<a name="247549523"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/247549523" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#247549523">(Jul 29 2021 at 06:43)</a>:</h4>
<p>did not want to jump the gun with the WiP state of the RFC</p>



<a name="247549852"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/247549852" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#247549852">(Jul 29 2021 at 06:50)</a>:</h4>
<p>here is the <a href="https://github.com/rust-lang/rfcs/pull/3156">PR</a></p>



<a name="247552366"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/247552366" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#247552366">(Jul 29 2021 at 07:31)</a>:</h4>
<p>a good question <span class="user-mention" data-user-id="229517">@Jacob Lifshay</span> , maybe Jane has a reason in her implementation. I will poke around it to see if it is justified or just a decision</p>



<a name="247553457"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/247553457" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#247553457">(Jul 29 2021 at 07:46)</a>:</h4>
<p>I don't recall not having a display and debug impl</p>



<a name="247553563"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/247553563" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#247553563">(Jul 29 2021 at 07:48)</a>:</h4>
<p>I think I remember <span class="user-mention" data-user-id="256841">@Nick Cameron</span> suggesting not including a capturing API in core to keep the implementation simpler, but also I gave reasoning based on panic for why I implemented it the way it is currently and so I wouldn't be surprised if we want pretty much feature parity with the current API</p>



<a name="247589962"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/247589962" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#247589962">(Jul 29 2021 at 14:23)</a>:</h4>
<p>yes, my bad. Just a quick glance at the code and there they are :)</p>



<a name="247590101"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/247590101" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#247590101">(Jul 29 2021 at 14:24)</a>:</h4>
<p>what could we do with the backtrace frame if we did not capture it?</p>



<a name="247607742"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/247607742" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#247607742">(Jul 29 2021 at 16:33)</a>:</h4>
<p>presumably we could still print it if it was passed in from some code that has access to <code>std</code></p>



<a name="247607876"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/247607876" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#247607876">(Jul 29 2021 at 16:34)</a>:</h4>
<p>so we could have a no_std library that has a fn like <code>fn print_backtrace(backtrace: &amp;core::backtrace::Backtrace)</code>  and then have another crate that depends on this and has access to <code>std</code> which then captures a backtrace and calls our fn</p>



<a name="247614628"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/247614628" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#247614628">(Jul 29 2021 at 17:26)</a>:</h4>
<p>"core only" code might also have "printing" systems even without <code>std</code>, including something as basic as writing the panic message to a known static buffer before the device locks up, and the person debugging can go check the buffer</p>



<a name="247616731"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/247616731" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#247616731">(Jul 29 2021 at 17:40)</a>:</h4>
<p>that's assuming we also include the capture API in core right? otherwise there would be nothing to print backtrace wise</p>



<a name="247619665"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/247619665" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#247619665">(Jul 29 2021 at 18:02)</a>:</h4>
<p>yes, you do need to be able to iterate/inspect/whatever the stack frames in core to be able to do that.</p>



<a name="247622110"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/247622110" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#247622110">(Jul 29 2021 at 18:23)</a>:</h4>
<p>For example, with the <code>gba</code> crate we provide core::fmt::Write impls for the debug output streams in the two most commonly used emulators. and then the panic handler can spit the error message out there</p>



<a name="247622179"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/247622179" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#247622179">(Jul 29 2021 at 18:24)</a>:</h4>
<p>displaying a backtrace seems essentially the same, assuming it's available</p>



<a name="247625969"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/247625969" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#247625969">(Jul 29 2021 at 18:56)</a>:</h4>
<p>For sure</p>



<a name="247630138"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/247630138" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#247630138">(Jul 29 2021 at 19:31)</a>:</h4>
<p>Aiui, for at least some use cases, being no std doesn’t mean the program can’t capture or print, etc, but that the program will provide these facilities not std (not entirely sure if there is any point of using the Backtrace trait at all in this case, but interoperability maybe?)</p>



<a name="247637749"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/247637749" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#247637749">(Jul 29 2021 at 20:35)</a>:</h4>
<p>The issue is one of knowledge.</p>
<ul>
<li>I know how to take a PanicInfo someone hands to me and write it out to an impl of <code>core::fmt::Write</code>. That's easy.</li>
<li>I wouldn't have the <em>slightest idea</em> of where to begin writing code to somehow examine the callstack and show a backtrace.</li>
</ul>
<p>And I think that for most Rust programmers those two facts hold true.</p>



<a name="247659837"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/247659837" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#247659837">(Jul 30 2021 at 00:54)</a>:</h4>
<p>You wouldn’t necessarily implement it yourself, you might depend on a library to do it, just not std. my assumption is that if you’re doing no std work that’s either because you’re implementing a kernel and you do know how to examine the call stack, you’re on some exotic platform with no std support but there are libraries for it, or you’re doing embedded work and either there’s a library or it’s impractical to get a backtrace at all.</p>



<a name="247659921"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/247659921" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#247659921">(Jul 30 2021 at 00:56)</a>:</h4>
<p>Are there no std use cases where it is reasonable to assume we can provide a backtrace some how?</p>



<a name="247659943"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/247659943" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#247659943">(Jul 30 2021 at 00:56)</a>:</h4>
<p>Or are you thinking of the case where a no std crate is linked in to a program using std?</p>



<a name="247662673"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/247662673" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#247662673">(Jul 30 2021 at 01:54)</a>:</h4>
<p>But Nick, I <em>am</em> the library author.</p>
<p><span class="user-mention silent" data-user-id="256841">Nick Cameron</span> <a href="#narrow/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace/near/247659921">said</a>:</p>
<blockquote>
<p>Are there no std use cases where it is reasonable to assume we can provide a backtrace some how?</p>
</blockquote>
<p>I don't know enough about backtraces to even say Yes or No to this question.</p>
<p>I <em>can</em> say that the GBA is an ARMv4T arch CPU that LLVM already had a target profile for, basically since forever, the arch was designed in like 1993. The amount of effort to make this "exotic platform" work with Rust is essentially none at all, just the basic amount that all embedded devices have (an assembly code startup before you jump to <code>main</code>, and you need a linker script).</p>
<p>So though I am the maintainer of the GBA library, I have never once been called upon to examine my own stack frames, nor would I have any idea of how to do so.</p>



<a name="247664592"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/247664592" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#247664592">(Jul 30 2021 at 02:33)</a>:</h4>
<p>Heh, fair enough. Do you know how a backtrace collector in core would work for such a platform? I thought that it was specific to the platform and therefore we couldn’t possibly implement it in core? (My understanding here is not good)</p>



<a name="247664826"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/247664826" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#247664826">(Jul 30 2021 at 02:38)</a>:</h4>
<p>I kinda assumed that somehow... debug symbols... something something... magic? I'm so unaware of how making a backtrace works that I don't even know what would be different on an old arch CPU without an OS.</p>



<a name="247665880"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/247665880" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#247665880">(Jul 30 2021 at 03:01)</a>:</h4>
<p>We can look into this. AFAIK, it depends on the calling convention which is a dependent on the combination of processor, compiler, and OS, which is why we can’t do it in core. But it’s possible there are cross platform standards which would work in at least some cases and which I don’t know about</p>



<a name="247677417"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/247677417" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#247677417">(Jul 30 2021 at 07:20)</a>:</h4>
<p>In my experience with embedded platforms (microcontrollers), debug info is generally not available on the target cpu, since it is stripped when flashing the binary. If debug info is needed, backtraces can't be captured, unless you can cheat and ask a host system (semi-hosting) for either the debug info or to get a backtrace for you.</p>



<a name="247723177"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/247723177" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#247723177">(Jul 30 2021 at 15:28)</a>:</h4>
<p><span class="user-mention silent" data-user-id="224471">Lokathor</span> <a href="#narrow/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace/near/247664826">said</a>:</p>
<blockquote>
<p>I kinda assumed that somehow... debug symbols... something something... magic? I'm so unaware of how making a backtrace works that I don't even know what would be different on an old arch CPU without an OS.</p>
</blockquote>
<p>i think its fairly os specific but I'm definitely not an expert on backtrace implementations</p>



<a name="247882135"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/247882135" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#247882135">(Aug 01 2021 at 23:22)</a>:</h4>
<p>I left a bunch of comments on the RFC PR: <a href="https://github.com/rust-lang/rfcs/pull/3156#pullrequestreview-719704831">https://github.com/rust-lang/rfcs/pull/3156#pullrequestreview-719704831</a></p>



<a name="247882199"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/247882199" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#247882199">(Aug 01 2021 at 23:24)</a>:</h4>
<p>I think we should go for the simplest solution which works and unblocks the Error -&gt; core work, then expand on the alternatives/extensions in the  alternatives section</p>



<a name="248240995"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/248240995" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#248240995">(Aug 03 2021 at 15:56)</a>:</h4>
<p>as for the backtrace on embedded devices, <span class="user-mention" data-user-id="229517">@Jacob Lifshay</span>  has a valid point - debug symbols are usually stripped to conserve memory on the target platform. Why and how one would want a standalone backtrace for examining is unclear to me (probably on a intermediary step in development when the target is running some kind of smoke tests or something similar and is running standalone and can write the backtrace to a buffer)</p>



<a name="248241074"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/248241074" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#248241074">(Aug 03 2021 at 15:57)</a>:</h4>
<p>Though I cannot fathom other cases where it would be useful (I might ask on the Embedded Rust matrix channel about this)</p>



<a name="248241106"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/248241106" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#248241106">(Aug 03 2021 at 15:57)</a>:</h4>
<p>they would have most experience with these matters</p>



<a name="248241165"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/248241165" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#248241165">(Aug 03 2021 at 15:57)</a>:</h4>
<p>I am working through your comments <span class="user-mention" data-user-id="256841">@Nick Cameron</span>, leaving comments where something is unclear</p>



<a name="248241264"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/248241264" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#248241264">(Aug 03 2021 at 15:58)</a>:</h4>
<p>I think the simplest solution is <span class="user-mention" data-user-id="220273">@Jane Lusby</span>'s PR which the RFC is based upon mostly</p>



<a name="248241427"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/248241427" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#248241427">(Aug 03 2021 at 15:58)</a>:</h4>
<p>with the rest of ideas being extensions and alternatives</p>



<a name="248241488"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/248241488" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#248241488">(Aug 03 2021 at 15:59)</a>:</h4>
<p>not sure if it is the simplest(compared to waiting for stabilization of generic member access RFC)</p>



<a name="248241563"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/248241563" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#248241563">(Aug 03 2021 at 16:00)</a>:</h4>
<p>i expect just doing generic access would be easiest but I'm not confident the API will pass muster</p>



<a name="248245055"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/248245055" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#248245055">(Aug 03 2021 at 16:27)</a>:</h4>
<p>not sure if I should write <code>core</code> or core or <em>core</em> :)</p>



<a name="248245069"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/248245069" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#248245069">(Aug 03 2021 at 16:27)</a>:</h4>
<p>usually it is the middle one</p>



<a name="248245107"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/248245107" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#248245107">(Aug 03 2021 at 16:28)</a>:</h4>
<p>however it strikes me as indistinguishable from the rest of the text usually</p>



<a name="248254129"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/248254129" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#248254129">(Aug 03 2021 at 17:42)</a>:</h4>
<p>I usually write plain core or use ‘the core library’ and only use backticks if it is actually code, e.g., in core::error::Backtrace</p>



<a name="248305304"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/248305304" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#248305304">(Aug 04 2021 at 02:41)</a>:</h4>
<p>(deleted)</p>



<a name="248316014"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/248316014" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#248316014">(Aug 04 2021 at 06:49)</a>:</h4>
<p>sure, will stick to the regular naming conventions</p>



<a name="248318023"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/248318023" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#248318023">(Aug 04 2021 at 07:21)</a>:</h4>
<p>one case where a backtrace on an embedded system would be useful is for automated bug reporting.</p>



<a name="248318737"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/248318737" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#248318737">(Aug 04 2021 at 07:32)</a>:</h4>
<p>but here we are talking about bigger embedded platforms which can afford to have networking and debug symbols for these kinds of reporting (probably even a full-blown linux with std support)</p>



<a name="248322528"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/248322528" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#248322528">(Aug 04 2021 at 08:22)</a>:</h4>
<p>having networking doesn't mean there's enough space for debug symbols, a good example is Arduino, which has networking with only 2kB of ram: <a href="https://www.arduino.cc/en/Reference/Ethernet">https://www.arduino.cc/en/Reference/Ethernet</a></p>



<a name="248322662"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/248322662" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#248322662">(Aug 04 2021 at 08:24)</a>:</h4>
<p>(admittedly you'd probably want more ram to bother with automated bug reporting...maybe 8kB?)</p>



<a name="248323970"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/248323970" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#248323970">(Aug 04 2021 at 08:40)</a>:</h4>
<p>ah yes, just generally speaking that we need a more powerful platform for this</p>



<a name="248324015"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/248324015" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#248324015">(Aug 04 2021 at 08:41)</a>:</h4>
<p>asked on the embedded rust matrix chat</p>



<a name="248333459"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/248333459" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#248333459">(Aug 04 2021 at 10:36)</a>:</h4>
<p>backtraces can be symbolized after transmission, doesn't necessarily need to happen on device.</p>



<a name="248333513"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/248333513" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#248333513">(Aug 04 2021 at 10:37)</a>:</h4>
<p>debug symbols could also be stored on an external flash chip rather than on the SoC memory.</p>



<a name="248334082"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/248334082" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#248334082">(Aug 04 2021 at 10:44)</a>:</h4>
<p>one thing that gets me thinking is how heavy would be unwinding code</p>



<a name="248334213"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/248334213" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#248334213">(Aug 04 2021 at 10:46)</a>:</h4>
<p>not fluent in how they are unwound, so just speculating here</p>



<a name="248336433"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/248336433" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#248336433">(Aug 04 2021 at 11:13)</a>:</h4>
<p>With frame pointers enabled (which I believe is typically true on thumb) the unwinding is just chasing a pointer in a linked list. Along with storing the chain somewhere else that'd be a couple hundred bytes if written with care.</p>



<a name="248337543"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/248337543" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#248337543">(Aug 04 2021 at 11:26)</a>:</h4>
<p>great, so it seems to be not that heavy. Curious what embedded folks think about it</p>



<a name="248429257"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/248429257" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#248429257">(Aug 05 2021 at 01:36)</a>:</h4>
<p>You don't even need to necessarily store the chain. You can possibly print/transmit one frame at a time as you iterate the call stack.</p>



<a name="248443824"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/248443824" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#248443824">(Aug 05 2021 at 06:51)</a>:</h4>
<p>not much feedback on embedded matrix, they told me to ask around their next meeting on Tuesday 20:00 CEST</p>



<a name="248463597"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/248463597" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#248463597">(Aug 05 2021 at 11:15)</a>:</h4>
<p><span class="user-mention silent" data-user-id="224471">Lokathor</span> <a href="#narrow/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace/near/248429257">said</a>:</p>
<blockquote>
<p>You don't even need to necessarily store the chain. You can possibly print/transmit one frame at a time as you iterate the call stack.</p>
</blockquote>
<p>Yeah, I meant that the code to store the addresses somewhere would be included into the byte estimation ^^</p>



<a name="249811257"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/249811257" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#249811257">(Aug 18 2021 at 06:05)</a>:</h4>
<p>I talked yesterday with the embedded folks and they added a lot of valuable input to the discussion</p>



<a name="249811315"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/249811315" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#249811315">(Aug 18 2021 at 06:06)</a>:</h4>
<p>The gist of it is that they think that Error in core is a great idea whereas backtrace is not _that_ useful but they would welcome it if it did not induce code bloat</p>



<a name="249811416"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/249811416" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#249811416">(Aug 18 2021 at 06:08)</a>:</h4>
<p>So the idea is to provide a default implementation of the capture API which is just an iterator over the frames and each microcontroller crate like cortex-m would add their own implementation of this API</p>



<a name="249811459"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/249811459" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#249811459">(Aug 18 2021 at 06:09)</a>:</h4>
<p>I can paste some quotations later if you are interested (or maybe a chat log from yesterday)</p>



<a name="249811551"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/249811551" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#249811551">(Aug 18 2021 at 06:11)</a>:</h4>
<p>They also mentioned what was already discussed before, that in some cases it is worth capturing just the several PC addresses</p>



<a name="249811619"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/249811619" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#249811619">(Aug 18 2021 at 06:12)</a>:</h4>
<p>And I still need to address comments to the RFC which I will be doing over the weekend + address new concerns from the embedded community</p>



<a name="249812009"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/249812009" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#249812009">(Aug 18 2021 at 06:20)</a>:</h4>
<p>That sounds amazing</p>



<a name="249812015"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/249812015" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#249812015">(Aug 18 2021 at 06:21)</a>:</h4>
<p>And yeah any quotes or chat logs you want to share would be great</p>



<a name="249812022"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/249812022" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#249812022">(Aug 18 2021 at 06:21)</a>:</h4>
<p>Or if it's all just going to go into the RFC happy to wait</p>



<a name="249812453"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/249812453" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#249812453">(Aug 18 2021 at 06:28)</a>:</h4>
<p>I will send the logs and pinpoint relevant comments + add some of it to the RFC</p>



<a name="250329591"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/250329591" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#250329591">(Aug 23 2021 at 09:43)</a>:</h4>
<p>logs here (start about 18:22): <a href="https://libera.irclog.whitequark.org/rust-embedded/2021-08-17">https://libera.irclog.whitequark.org/rust-embedded/2021-08-17</a></p>



<a name="250342760"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/250342760" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#250342760">(Aug 23 2021 at 12:16)</a>:</h4>
<p>Added more details to the RFC and closed several comments</p>



<a name="250342778"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/250342778" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#250342778">(Aug 23 2021 at 12:16)</a>:</h4>
<p>Please check if I am heading in the proper direction</p>



<a name="250342810"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/250342810" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#250342810">(Aug 23 2021 at 12:16)</a>:</h4>
<p>Not sure if I should rethink the implementation itself <span class="user-mention" data-user-id="256841">@Nick Cameron</span></p>



<a name="250342821"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/250342821" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#250342821">(Aug 23 2021 at 12:17)</a>:</h4>
<p>as you mentioned with the RawBacktrace</p>



<a name="250342894"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/250342894" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#250342894">(Aug 23 2021 at 12:17)</a>:</h4>
<p>Also probably some structural changes should be made (not sure if drawbacks should be addressed just to the proposed impl or to alternatives as well)</p>



<a name="250709154"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/250709154" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#250709154">(Aug 26 2021 at 01:58)</a>:</h4>
<p><span class="user-mention" data-user-id="344196">@Jakub Duchniewicz</span>  I reviewed the RFC. I think that it would be better to have a Backtrace trait than a struct + RawBacktrace trait - or at least describe why that isn't possible. I also think that the RFC should cover the alternative of defining Backtrace in core and backtrace capture in std only and describe why that is less desirable (IMO it is actually more desirable because the simplification outweighs the loss of benefits, but I haven't followed some of the most recent discussion, in any case I think it is an alternative that should be described and the trade-offs discussed).</p>



<a name="250908209"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/250908209" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#250908209">(Aug 27 2021 at 09:55)</a>:</h4>
<p>I addressed the comments for the RFC. Not sure if we could do the Backtrace trait TBH. Why did <span class="user-mention" data-user-id="220273">@Jane Lusby</span> decide to do such a split?</p>



<a name="250908353"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/250908353" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#250908353">(Aug 27 2021 at 09:57)</a>:</h4>
<p>Also doing the second thing you mentioned <span class="user-mention" data-user-id="256841">@Nick Cameron</span> seems to be doable but we would require changes in how we use the API (which is not a problem since it is unstable?)</p>



<a name="250920018"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/250920018" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#250920018">(Aug 27 2021 at 11:53)</a>:</h4>
<p>The split was added for API stability reasons</p>



<a name="250920043"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/250920043" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#250920043">(Aug 27 2021 at 11:53)</a>:</h4>
<p>The worry was that a public trait would restrict how we could evolve the backtrace API over time</p>



<a name="250920614"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/250920614" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#250920614">(Aug 27 2021 at 11:59)</a>:</h4>
<p>I think it is a good concern, we hide all the impl details this way and just give 3 functions to the users</p>



<a name="251016881"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/251016881" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#251016881">(Aug 28 2021 at 01:22)</a>:</h4>
<p>How would it restrict things? Usually libraries just make a trait available, it doesn't need wrapping.</p>



<a name="251016905"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/251016905" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#251016905">(Aug 28 2021 at 01:22)</a>:</h4>
<p>"we hide all the impl details this way and just give 3 functions to the users" - hiding impl details and only exposing a few functions is exactly what traits are designed for :-)</p>



<a name="251018000"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/251018000" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Charles Ellis O&#x27;Riley Jr. <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#251018000">(Aug 28 2021 at 01:44)</a>:</h4>
<p>"we hide all the impl details this way and just give 3 functions to the users" - hiding impl details and only exposing a few functions is exactly what traits are designed for :-). Very nice <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="251046770"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/251046770" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#251046770">(Aug 28 2021 at 10:37)</a>:</h4>
<p>I think Jane meant that if we would be needing changes to this trait we would have to consider its existing users</p>



<a name="251046772"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/251046772" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#251046772">(Aug 28 2021 at 10:37)</a>:</h4>
<p>but I might be wrong here</p>



<a name="251060573"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/251060573" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#251060573">(Aug 28 2021 at 14:43)</a>:</h4>
<p>Thats correct</p>



<a name="251060618"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/251060618" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#251060618">(Aug 28 2021 at 14:44)</a>:</h4>
<p>Depending on how exposed the trait is</p>



<a name="251060674"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/251060674" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#251060674">(Aug 28 2021 at 14:45)</a>:</h4>
<p>If it's used as a return type in the error trait and it's publicly exported as part of our API and unsealed then it's a forward compatibility Hazzard and makes it much harder to add functions to backtrace interface</p>



<a name="251060685"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/251060685" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#251060685">(Aug 28 2021 at 14:45)</a>:</h4>
<p>We could seal the trait and avoid that though</p>



<a name="251097462"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/core%3A%3AError%20and%20core%3A%3ABacktrace/near/251097462" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/core.3A.3AError.20and.20core.3A.3ABacktrace.html#251097462">(Aug 29 2021 at 02:02)</a>:</h4>
<p>I think that is true of any trait in core/std. We're not proposing stabilising Backtrace, only moving it, so we can still change it for a while until it is stabilised. And even then, it only means we can't add required methods without a default.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>