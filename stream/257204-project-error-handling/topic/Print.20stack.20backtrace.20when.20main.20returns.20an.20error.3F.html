<html>
<head><meta charset="utf-8"><title>Print stack backtrace when main returns an error? · project-error-handling · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/index.html">project-error-handling</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Print.20stack.20backtrace.20when.20main.20returns.20an.20error.3F.html">Print stack backtrace when main returns an error?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="251740932"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Print%20stack%20backtrace%20when%20main%20returns%20an%20error%3F/near/251740932" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Print.20stack.20backtrace.20when.20main.20returns.20an.20error.3F.html#251740932">(Sep 02 2021 at 16:11)</a>:</h4>
<p>So, I just wrote this code for work:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">main_handling_errors</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">format!</span><span class="p">(</span><span class="s">"Error: {}"</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">cause</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">err</span><span class="p">.</span><span class="n">chain</span><span class="p">().</span><span class="n">skip</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="fm">write!</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="s">"</span><span class="se">\n\n</span><span class="s">Caused by:</span><span class="se">\n</span><span class="s">    {}"</span><span class="p">,</span><span class="w"> </span><span class="n">cause</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="fm">eprintln!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">backtrace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">err</span><span class="p">.</span><span class="n">backtrace</span><span class="p">().</span><span class="n">to_string</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">backtrace</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">"disabled backtrace"</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">backtrace</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">"unsupported backtrace"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="fm">eprintln!</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">Stack backtrace:</span><span class="se">\n</span><span class="s">{}"</span><span class="p">,</span><span class="w"> </span><span class="n">backtrace</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span>::<span class="n">process</span>::<span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>It was just using <code>fn main() -&gt; anyhow::Result&lt;()&gt;</code> before, but that doesn't print a backtrace or the causes. Is there a way to make this the default for errors somehow? I know libstd can't depend on <code>anyhow</code>, but it should still be able to use the backtrace() method even though it's unstable, right? I tried adding it just now but I don't understand specialization at all:</p>
<div class="codehilite" data-code-language="Diff"><pre><span></span><code><span class="gh">diff --git a/library/std/src/lib.rs b/library/std/src/lib.rs</span>
<span class="gh">index 43c7ec5fad3..1a76584b612 100644</span>
<span class="gd">--- a/library/std/src/lib.rs</span>
<span class="gi">+++ b/library/std/src/lib.rs</span>
<span class="gu">@@ -316,6 +316,7 @@</span>
 #![feature(slice_internals)]
 #![feature(slice_ptr_get)]
 #![feature(slice_ptr_len)]
<span class="gi">+#![feature(specialization)]</span>
 #![feature(staged_api)]
 #![feature(std_internals)]
 #![feature(stdsimd)]
<span class="gh">diff --git a/library/std/src/process.rs b/library/std/src/process.rs</span>
<span class="gh">index c9b21fcf9c6..6d336c266c6 100644</span>
<span class="gd">--- a/library/std/src/process.rs</span>
<span class="gi">+++ b/library/std/src/process.rs</span>
<span class="gu">@@ -2043,7 +2043,15 @@ fn report(self) -&gt; i32 {</span>
 }

 #[unstable(feature = "termination_trait_lib", issue = "43301")]
<span class="gd">-impl&lt;E: fmt::Debug&gt; Termination for Result&lt;!, E&gt; {</span>
<span class="gi">+default impl&lt;E: fmt::Debug&gt; Termination for Result&lt;!, E&gt; {</span>
<span class="gi">+    fn report(self) -&gt; i32 {</span>
<span class="gi">+        let Err(err) = self;</span>
<span class="gi">+        eprintln!("Error: {:?}", err);</span>
<span class="gi">+        ExitCode::FAILURE.report()</span>
<span class="gi">+    }</span>
<span class="gi">+}</span>
<span class="gi">+</span>
<span class="gi">+impl&lt;E: fmt::Debug + crate::error::Error&gt; Termination for Result&lt;!, E&gt; {</span>
     fn report(self) -&gt; i32 {
         let Err(err) = self;
         eprintln!("Error: {:?}", err);
</code></pre></div>
<div class="codehilite"><pre><span></span><code>error[E0275]: overflow evaluating the requirement `core::result::Result&lt;!, _&gt;: Termination`
  |
  = help: consider adding a `#![recursion_limit=&quot;256&quot;]` attribute to your crate (`std`)
  = note: required because of the requirements on the impl of `Termination` for `core::result::Result&lt;!, _&gt;`
  = note: 127 redundant requirements hidden
  = note: required because of the requirements on the impl of `Termination` for `core::result::Result&lt;!, _&gt;`
</code></pre></div>
<p>so I thought I'd get feedback on the general idea first</p>



<a name="251741276"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Print%20stack%20backtrace%20when%20main%20returns%20an%20error%3F/near/251741276" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Print.20stack.20backtrace.20when.20main.20returns.20an.20error.3F.html#251741276">(Sep 02 2021 at 16:13)</a>:</h4>
<p>(I'm aware that depending on "disabled backtrace" and "unsupported backtrace" is a bad idea, but I didn't see a stable way to get that info)</p>



<a name="251746992"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Print%20stack%20backtrace%20when%20main%20returns%20an%20error%3F/near/251746992" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Print.20stack.20backtrace.20when.20main.20returns.20an.20error.3F.html#251746992">(Sep 02 2021 at 16:51)</a>:</h4>
<p>Have you tried <code>default fn</code> instead of <code>default impl</code>?</p>



<a name="251747260"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Print%20stack%20backtrace%20when%20main%20returns%20an%20error%3F/near/251747260" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Print.20stack.20backtrace.20when.20main.20returns.20an.20error.3F.html#251747260">(Sep 02 2021 at 16:52)</a>:</h4>
<p>with just that change and nothing else it compiles:</p>
<div class="codehilite" data-code-language="Diff"><pre><span></span><code><span class="gh">diff --git a/library/std/src/process.rs b/library/std/src/process.rs</span>
<span class="gh">index c9b21fcf9c6..542c541d74f 100644</span>
<span class="gd">--- a/library/std/src/process.rs</span>
<span class="gi">+++ b/library/std/src/process.rs</span>
<span class="gu">@@ -2044,13 +2044,22 @@ fn report(self) -&gt; i32 {</span>

 #[unstable(feature = "termination_trait_lib", issue = "43301")]
 impl&lt;E: fmt::Debug&gt; Termination for Result&lt;!, E&gt; {
<span class="gd">-    fn report(self) -&gt; i32 {</span>
<span class="gi">+    default fn report(self) -&gt; i32 {</span>
         let Err(err) = self;
         eprintln!("Error: {:?}", err);
         ExitCode::FAILURE.report()
     }
 }
</code></pre></div>
<p>but adding the second impl gives <code>error: cannot specialize on trait `error::Error` </code></p>



<a name="251747406"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Print%20stack%20backtrace%20when%20main%20returns%20an%20error%3F/near/251747406" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Print.20stack.20backtrace.20when.20main.20returns.20an.20error.3F.html#251747406">(Sep 02 2021 at 16:53)</a>:</h4>
<p>adding <code>default impl</code> and <code>default fn</code>, but not the second impl gives a really strange error:</p>
<div class="codehilite"><pre><span></span><code>error[E0599]: the method `report` exists for enum `core::result::Result&lt;!, E&gt;`, but its trait bounds were not satisfied
    --&gt; library/std/src/process.rs:2033:42
     |
2033 |             Err(err) =&gt; Err::&lt;!, _&gt;(err).report(),
     |                                          ^^^^^^ method cannot be called on `core::result::Result&lt;!, E&gt;` due to unsatisfied trait bounds
     |
    ::: /home/jnelson/src/rust/library/core/src/result.rs:503:1
     |
503  | pub enum Result&lt;T, E&gt; {
     | --------------------- doesn&#39;t satisfy `core::result::Result&lt;!, E&gt;: Termination`
     |
     = note: the following trait bounds were not satisfied:
             `core::result::Result&lt;!, E&gt;: Termination`
</code></pre></div>



<a name="251748059"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Print%20stack%20backtrace%20when%20main%20returns%20an%20error%3F/near/251748059" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Print.20stack.20backtrace.20when.20main.20returns.20an.20error.3F.html#251748059">(Sep 02 2021 at 16:58)</a>:</h4>
<p>If you add <code>#![feature(specialization)]</code>, you should be able to add a second impl.</p>



<a name="251748072"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Print%20stack%20backtrace%20when%20main%20returns%20an%20error%3F/near/251748072" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Print.20stack.20backtrace.20when.20main.20returns.20an.20error.3F.html#251748072">(Sep 02 2021 at 16:58)</a>:</h4>
<p>But that's unsound.</p>



<a name="251748459"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Print%20stack%20backtrace%20when%20main%20returns%20an%20error%3F/near/251748459" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Print.20stack.20backtrace.20when.20main.20returns.20an.20error.3F.html#251748459">(Sep 02 2021 at 17:00)</a>:</h4>
<p>I wonder if <code>impl&lt;E: Debug + Error + 'static&gt;</code> specialization would be sound (it's okay to use non-specialized impl if any lifetime is involved). But I am not an expert on soundness.</p>



<a name="251748784"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Print%20stack%20backtrace%20when%20main%20returns%20an%20error%3F/near/251748784" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Print.20stack.20backtrace.20when.20main.20returns.20an.20error.3F.html#251748784">(Sep 02 2021 at 17:01)</a>:</h4>
<p>oh, this is with <code>feature(specialization)</code> lol</p>



<a name="251759145"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Print%20stack%20backtrace%20when%20main%20returns%20an%20error%3F/near/251759145" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Print.20stack.20backtrace.20when.20main.20returns.20an.20error.3F.html#251759145">(Sep 02 2021 at 18:05)</a>:</h4>
<p><span class="user-mention" data-user-id="232545">@Joshua Nelson</span> using anyhow::Error in main should print the backtrace and sources</p>



<a name="251759581"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Print%20stack%20backtrace%20when%20main%20returns%20an%20error%3F/near/251759581" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Print.20stack.20backtrace.20when.20main.20returns.20an.20error.3F.html#251759581">(Sep 02 2021 at 18:08)</a>:</h4>
<blockquote>
<p>Is there a way to make this the default for errors somehow?</p>
</blockquote>
<p>so the issue is that the <code>Termination</code> impl in std for <code>Result</code> depends on <code>Debug</code> when it prints the <code>Err</code> variant</p>



<a name="251759748"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Print%20stack%20backtrace%20when%20main%20returns%20an%20error%3F/near/251759748" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Print.20stack.20backtrace.20when.20main.20returns.20an.20error.3F.html#251759748">(Sep 02 2021 at 18:09)</a>:</h4>
<p>and that impl isn't a universally applicable impl</p>



<a name="251759930"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Print%20stack%20backtrace%20when%20main%20returns%20an%20error%3F/near/251759930" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Print.20stack.20backtrace.20when.20main.20returns.20an.20error.3F.html#251759930">(Sep 02 2021 at 18:10)</a>:</h4>
<p>I can't remember the exact explanation I got from Niko before but the current implementation of specialization can't specialize a generic impl with another generic impl</p>



<a name="251760021"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Print%20stack%20backtrace%20when%20main%20returns%20an%20error%3F/near/251760021" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Print.20stack.20backtrace.20when.20main.20returns.20an.20error.3F.html#251760021">(Sep 02 2021 at 18:10)</a>:</h4>
<p>the issue being that these trait impls can depend on lifetimes</p>



<a name="251760045"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Print%20stack%20backtrace%20when%20main%20returns%20an%20error%3F/near/251760045" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Print.20stack.20backtrace.20when.20main.20returns.20an.20error.3F.html#251760045">(Sep 02 2021 at 18:11)</a>:</h4>
<p>and that causes soundness issues when specializing</p>



<a name="251760083"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Print%20stack%20backtrace%20when%20main%20returns%20an%20error%3F/near/251760083" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Print.20stack.20backtrace.20when.20main.20returns.20an.20error.3F.html#251760083">(Sep 02 2021 at 18:11)</a>:</h4>
<p>so we cannot specialize <code>Termination</code> until we have a work around for that issue</p>



<a name="251760161"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Print%20stack%20backtrace%20when%20main%20returns%20an%20error%3F/near/251760161" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Print.20stack.20backtrace.20when.20main.20returns.20an.20error.3F.html#251760161">(Sep 02 2021 at 18:11)</a>:</h4>
<p><a href="https://smallcultfollowing.com/babysteps/blog/2018/02/09/maximally-minimal-specialization-always-applicable-impls/#the-soundness-problem">https://smallcultfollowing.com/babysteps/blog/2018/02/09/maximally-minimal-specialization-always-applicable-impls/#the-soundness-problem</a> goes in detail on the problem</p>



<a name="251760279"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Print%20stack%20backtrace%20when%20main%20returns%20an%20error%3F/near/251760279" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Print.20stack.20backtrace.20when.20main.20returns.20an.20error.3F.html#251760279">(Sep 02 2021 at 18:12)</a>:</h4>
<p>but despite this <code>anyhow::Error</code> _should_ do exactly what you want</p>



<a name="251760306"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Print%20stack%20backtrace%20when%20main%20returns%20an%20error%3F/near/251760306" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Print.20stack.20backtrace.20when.20main.20returns.20an.20error.3F.html#251760306">(Sep 02 2021 at 18:12)</a>:</h4>
<p>it's <code>Debug</code> impl prints the actual error report</p>



<a name="251760331"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Print%20stack%20backtrace%20when%20main%20returns%20an%20error%3F/near/251760331" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Print.20stack.20backtrace.20when.20main.20returns.20an.20error.3F.html#251760331">(Sep 02 2021 at 18:12)</a>:</h4>
<p>including the backtrace and sources</p>



<a name="251760417"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Print%20stack%20backtrace%20when%20main%20returns%20an%20error%3F/near/251760417" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Print.20stack.20backtrace.20when.20main.20returns.20an.20error.3F.html#251760417">(Sep 02 2021 at 18:13)</a>:</h4>
<p>so all you have to do is use a type that prints the actual report you want to see as it's <code>Debug</code> impl or you need to replace the <code>Result</code> in the return type to your own custom Result alternative that doesn't depend on <code>Debug</code></p>



<a name="251761298"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Print%20stack%20backtrace%20when%20main%20returns%20an%20error%3F/near/251761298" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Print.20stack.20backtrace.20when.20main.20returns.20an.20error.3F.html#251761298">(Sep 02 2021 at 18:17)</a>:</h4>
<p>Just to confirm something, is the goal here to make it <em>possible</em> to arrange for the backtrace to be printed from the error returned from main, or to do so by default? The latter seems problematic, as it would make default error handling much noisier; sometimes people want to return an error from main as their primary error handling for a CLI program, and those errors aren't programming errors that need a backtrace.</p>



<a name="251761786"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Print%20stack%20backtrace%20when%20main%20returns%20an%20error%3F/near/251761786" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Print.20stack.20backtrace.20when.20main.20returns.20an.20error.3F.html#251761786">(Sep 02 2021 at 18:20)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/257204-project-error-handling/topic/Print.20stack.20backtrace.20when.20main.20returns.20an.20error.3F/near/251761298">said</a>:</p>
<blockquote>
<p>Just to confirm something, is the goal here to make it <em>possible</em> to arrange for the backtrace to be printed from the error returned from main, or to do so by default? The latter seems problematic, as it would make default error handling much noisier; sometimes people want to return an error from main as their primary error handling for a CLI program, and those errors aren't programming errors that need a backtrace.</p>
</blockquote>
<p>i don't think it could even be enabled by default, since the backtrace captured from after main isn't going to have any useful context</p>



<a name="251761829"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Print%20stack%20backtrace%20when%20main%20returns%20an%20error%3F/near/251761829" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Print.20stack.20backtrace.20when.20main.20returns.20an.20error.3F.html#251761829">(Sep 02 2021 at 18:20)</a>:</h4>
<p>at most we could enable displaying backtraces available through the <code>Error</code> trait when available</p>



<a name="251761864"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Print%20stack%20backtrace%20when%20main%20returns%20an%20error%3F/near/251761864" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Print.20stack.20backtrace.20when.20main.20returns.20an.20error.3F.html#251761864">(Sep 02 2021 at 18:20)</a>:</h4>
<p>which I think could still be argued against</p>



<a name="251761921"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Print%20stack%20backtrace%20when%20main%20returns%20an%20error%3F/near/251761921" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Print.20stack.20backtrace.20when.20main.20returns.20an.20error.3F.html#251761921">(Sep 02 2021 at 18:21)</a>:</h4>
<p>since arguably return from main is almost always intended to be user facing rather than developer facing</p>



<a name="251761961"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Print%20stack%20backtrace%20when%20main%20returns%20an%20error%3F/near/251761961" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Print.20stack.20backtrace.20when.20main.20returns.20an.20error.3F.html#251761961">(Sep 02 2021 at 18:21)</a>:</h4>
<p>and backtraces aren't necessarily the most helpful information to show to users</p>



<a name="251767645"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Print%20stack%20backtrace%20when%20main%20returns%20an%20error%3F/near/251767645" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Print.20stack.20backtrace.20when.20main.20returns.20an.20error.3F.html#251767645">(Sep 02 2021 at 18:56)</a>:</h4>
<p>Ideally it would be on if RUST_BACKTRACE is set in the environment, without the developer having to opt in. I agree it shouldn't be on by default.</p>



<a name="251767785"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Print%20stack%20backtrace%20when%20main%20returns%20an%20error%3F/near/251767785" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Print.20stack.20backtrace.20when.20main.20returns.20an.20error.3F.html#251767785">(Sep 02 2021 at 18:57)</a>:</h4>
<blockquote>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> using anyhow::Error in main should print the backtrace and sources</p>
</blockquote>
<p>That was not happening for me. I'm not sure why not.</p>



<a name="251768063"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Print%20stack%20backtrace%20when%20main%20returns%20an%20error%3F/near/251768063" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Print.20stack.20backtrace.20when.20main.20returns.20an.20error.3F.html#251768063">(Sep 02 2021 at 18:58)</a>:</h4>
<p>Oh, I may have needed to enable the backtrace feature in anyhow.</p>



<a name="251770033"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Print%20stack%20backtrace%20when%20main%20returns%20an%20error%3F/near/251770033" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gus Wynn <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Print.20stack.20backtrace.20when.20main.20returns.20an.20error.3F.html#251770033">(Sep 02 2021 at 19:11)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/257204-project-error-handling/topic/Print.20stack.20backtrace.20when.20main.20returns.20an.20error.3F/near/251767785">said</a>:</p>
<blockquote>
<blockquote>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> using anyhow::Error in main should print the backtrace and sources</p>
</blockquote>
<p>That was not happening for me. I'm not sure why not.</p>
</blockquote>
<p>Last I checked, I believe you have to be on nightly (or BOOTSTRAP), and have <code>RUST_LIB_BACKTRACE=1</code> or <code>RUST_BACKTRACE=1</code></p>



<a name="251770460"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Print%20stack%20backtrace%20when%20main%20returns%20an%20error%3F/near/251770460" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gus Wynn <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Print.20stack.20backtrace.20when.20main.20returns.20an.20error.3F.html#251770460">(Sep 02 2021 at 19:14)</a>:</h4>
<p>oh wait, the backtrace feature uses <code>backtrace-rs</code>? I didnt know <code>backtrace-rs</code> worked on non-nightly rust</p>



<a name="251770780"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/257204-project-error-handling/topic/Print%20stack%20backtrace%20when%20main%20returns%20an%20error%3F/near/251770780" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gus Wynn <a href="https://zulip-archive.rust-lang.org/stream/257204-project-error-handling/topic/Print.20stack.20backtrace.20when.20main.20returns.20an.20error.3F.html#251770780">(Sep 02 2021 at 19:16)</a>:</h4>
<p>I was under the understanding that once backtrace was stabilized, that all errors would act like anyhow (when RUST_BACKTRACE=1), but reading the docs, upon reading the docs that is not true, hmm interesting</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>