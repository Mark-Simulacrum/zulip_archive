<html>
<head><meta charset="utf-8"><title>Rebase on newer rayon · t-compiler/wg-parallel-rustc · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/index.html">t-compiler/wg-parallel-rustc</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html">Rebase on newer rayon</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="169062009"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/169062009" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#169062009">(Jun 26 2019 at 17:46)</a>:</h4>
<p>FWIW, I rebased rustc-rayon here: <a href="https://github.com/rust-lang/rustc-rayon/pull/3" target="_blank" title="https://github.com/rust-lang/rustc-rayon/pull/3">https://github.com/rust-lang/rustc-rayon/pull/3</a></p>



<a name="175360498"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/175360498" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#175360498">(Sep 10 2019 at 17:40)</a>:</h4>
<p>I rebased on 1.2 now, and opened a draft PR: <a href="https://github.com/rust-lang/rust/pull/64358/" target="_blank" title="https://github.com/rust-lang/rust/pull/64358/">https://github.com/rust-lang/rust/pull/64358/</a></p>



<a name="177553388"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/177553388" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#177553388">(Oct 07 2019 at 19:50)</a>:</h4>
<p><span class="user-mention" data-user-id="138448">@cuviper</span> this is what you want me to land, right?</p>



<a name="177553837"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/177553837" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#177553837">(Oct 07 2019 at 19:56)</a>:</h4>
<p>Yes, thanks</p>



<a name="177553888"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/177553888" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#177553888">(Oct 07 2019 at 19:56)</a>:</h4>
<p><span class="user-mention" data-user-id="138448">@cuviper</span>  the panic forwarding <a href="https://github.com/rayon-rs/rayon/compare/master...cuviper:rustc#diff-f42c354e8416b0ad30f65243a93d84a0R328" target="_blank" title="https://github.com/rayon-rs/rayon/compare/master...cuviper:rustc#diff-f42c354e8416b0ad30f65243a93d84a0R328">here</a> is interesting</p>



<a name="177553898"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/177553898" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#177553898">(Oct 07 2019 at 19:56)</a>:</h4>
<p>any idea what's going on there?</p>



<a name="177553901"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/177553901" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#177553901">(Oct 07 2019 at 19:56)</a>:</h4>
<p>seems like something we could plausibly want on master?</p>



<a name="177554000"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/177554000" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#177554000">(Oct 07 2019 at 19:57)</a>:</h4>
<p>Also, any idea why we made <code>registry</code> method <a href="https://github.com/rayon-rs/rayon/compare/master...cuviper:rustc#diff-19c860748b8faafc557a11db2d185bd9R284" target="_blank" title="https://github.com/rayon-rs/rayon/compare/master...cuviper:rustc#diff-19c860748b8faafc557a11db2d185bd9R284">fully public here</a>?</p>



<a name="177554424"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/177554424" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#177554424">(Oct 07 2019 at 20:00)</a>:</h4>
<p>normally the panic would forward naturally, but in this case it needs to <code>wait_until_stopped</code> so the acquire/release handlers will be called and yield its token to the jobserver.</p>



<a name="177554452"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/177554452" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#177554452">(Oct 07 2019 at 20:00)</a>:</h4>
<p>I'm not really keen on this, but it maintains the status quo of how the old scoped threadpool was working too</p>



<a name="177554493"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/177554493" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#177554493">(Oct 07 2019 at 20:01)</a>:</h4>
<blockquote>
<p>normally the panic would forward naturally, but in this case it needs to <code>wait_until_stopped</code> so the acquire/release handlers will be called and yield its token to the jobserver.</p>
</blockquote>
<p>hmm ok. we could use a drop or something for this too I guess</p>



<a name="177554503"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/177554503" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#177554503">(Oct 07 2019 at 20:01)</a>:</h4>
<p>maybe you can add a comment there, in any case ?</p>



<a name="177554508"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/177554508" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#177554508">(Oct 07 2019 at 20:01)</a>:</h4>
<p>(hard to leave comments on the PR owing to the funky diff)</p>



<a name="177554509"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/177554509" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#177554509">(Oct 07 2019 at 20:01)</a>:</h4>
<p>yeah, or scope-guard, etc.</p>



<a name="177554535"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/177554535" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#177554535">(Oct 07 2019 at 20:01)</a>:</h4>
<p>I took <a href="https://hackmd.io/864iA9UZSseobN_Apyam1A" target="_blank" title="https://hackmd.io/864iA9UZSseobN_Apyam1A">some quick notes</a> as I reviewed -- these seems to be the main changes in the rustc-rayon fork</p>



<a name="177554545"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/177554545" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#177554545">(Oct 07 2019 at 20:02)</a>:</h4>
<p>I guess the next question then is, from the rustc side, to take some notes on how they are used</p>



<a name="177554588"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/177554588" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#177554588">(Oct 07 2019 at 20:02)</a>:</h4>
<p>feel free to edit</p>



<a name="177554598"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/177554598" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#177554598">(Oct 07 2019 at 20:02)</a>:</h4>
<p>I guess <em>now</em> the question is how to manage the revisions</p>



<a name="177554622"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/177554622" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#177554622">(Oct 07 2019 at 20:02)</a>:</h4>
<p>on the pub <code>Registry</code>, there are a few uses in librustc, but I haven't really reviewed them</p>



<a name="177554642"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/177554642" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#177554642">(Oct 07 2019 at 20:02)</a>:</h4>
<p>ok</p>



<a name="177554647"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/177554647" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#177554647">(Oct 07 2019 at 20:02)</a>:</h4>
<p>seems bad</p>



<a name="177554651"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/177554651" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#177554651">(Oct 07 2019 at 20:03)</a>:</h4>
<p>yeah</p>



<a name="177554668"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/177554668" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#177554668">(Oct 07 2019 at 20:03)</a>:</h4>
<p>I didn't try to solve everything ;)</p>



<a name="177554672"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/177554672" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#177554672">(Oct 07 2019 at 20:03)</a>:</h4>
<p>(just because <code>Registry</code> wasn't previously exposed)</p>



<a name="177554680"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/177554680" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#177554680">(Oct 07 2019 at 20:03)</a>:</h4>
<p>yeah no that's fine</p>



<a name="177554710"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/177554710" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#177554710">(Oct 07 2019 at 20:03)</a>:</h4>
<p>I guess I'll make a "merge commit" but I'll just get the <em>contents</em> from your branch in all conflicts</p>



<a name="177554713"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/177554713" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#177554713">(Oct 07 2019 at 20:03)</a>:</h4>
<p>or something..?</p>



<a name="177554718"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/177554718" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#177554718">(Oct 07 2019 at 20:03)</a>:</h4>
<p>(I want to not destroy history)</p>



<a name="177554823"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/177554823" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#177554823">(Oct 07 2019 at 20:05)</a>:</h4>
<p>there are crate-VERSION branches where you can leave the history</p>



<a name="177554852"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/177554852" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#177554852">(Oct 07 2019 at 20:05)</a>:</h4>
<p>I believe zoxc has rebased several times this way</p>



<a name="177554999"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/177554999" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#177554999">(Oct 07 2019 at 20:06)</a>:</h4>
<blockquote>
<p>there are crate-VERSION branches where you can leave the history</p>
</blockquote>
<p>ok, that was the alternate approach I was considering</p>



<a name="177555070"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/177555070" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#177555070">(Oct 07 2019 at 20:07)</a>:</h4>
<p>I'll add a comment on that <code>wait_until_stopped</code> -- anything else?</p>



<a name="177555525"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/177555525" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#177555525">(Oct 07 2019 at 20:12)</a>:</h4>
<p>oh, you just pushed already</p>



<a name="177555661"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/177555661" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#177555661">(Oct 07 2019 at 20:13)</a>:</h4>
<p>oh sorry</p>



<a name="177555664"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/177555664" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#177555664">(Oct 07 2019 at 20:13)</a>:</h4>
<p>I forgot</p>



<a name="177555669"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/177555669" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#177555669">(Oct 07 2019 at 20:13)</a>:</h4>
<p>:)</p>



<a name="177555674"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/177555674" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#177555674">(Oct 07 2019 at 20:13)</a>:</h4>
<p><span aria-label="shrug" class="emoji emoji-1f937" role="img" title="shrug">:shrug:</span></p>



<a name="177555677"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/177555677" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#177555677">(Oct 07 2019 at 20:13)</a>:</h4>
<p>not important</p>



<a name="177555695"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/177555695" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#177555695">(Oct 07 2019 at 20:13)</a>:</h4>
<p>I'm publishing 0.3.0</p>



<a name="177555805"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/177555805" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#177555805">(Oct 07 2019 at 20:14)</a>:</h4>
<p>crate-0.3.0 branch created, published</p>



<a name="177555840"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/177555840" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#177555840">(Oct 07 2019 at 20:15)</a>:</h4>
<p>I guess you want <a href="https://github.com/rust-lang/rust/pull/64358/" target="_blank" title="https://github.com/rust-lang/rust/pull/64358/">https://github.com/rust-lang/rust/pull/64358/</a> reviewed, too?</p>



<a name="177555877"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/177555877" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#177555877">(Oct 07 2019 at 20:15)</a>:</h4>
<p>yeah, but let me update for 0.3 first</p>



<a name="177556132"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/177556132" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#177556132">(Oct 07 2019 at 20:18)</a>:</h4>
<p>uh, how is rustc-ap-rustc_data_structures managed? that's holding rustc-rayon 0.2 too</p>



<a name="177556216"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/177556216" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#177556216">(Oct 07 2019 at 20:19)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> do we land without that first, and then it can update and circle back independently?</p>



<a name="177556357"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/177556357" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#177556357">(Oct 07 2019 at 20:20)</a>:</h4>
<p>afaik that's done by some script?</p>



<a name="177556384"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/177556384" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#177556384">(Oct 07 2019 at 20:20)</a>:</h4>
<p>we don't depend on it, I don't think?</p>



<a name="177556397"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/177556397" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#177556397">(Oct 07 2019 at 20:20)</a>:</h4>
<p>it's in <code>Cargo.lock</code> though</p>



<a name="177556421"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/177556421" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#177556421">(Oct 07 2019 at 20:21)</a>:</h4>
<p>I was trying to see why the old stuff didn't go away yet</p>



<a name="177556428"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/177556428" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#177556428">(Oct 07 2019 at 20:21)</a>:</h4>
<p>maybe <span class="user-mention" data-user-id="116015">@Alex Crichton</span> knows what's going on there</p>



<a name="177556468"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/177556468" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#177556468">(Oct 07 2019 at 20:21)</a>:</h4>
<p>anyway, just doing a quick <code>./x.py check</code> and then I'll be ready</p>



<a name="177557948"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/177557948" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#177557948">(Oct 07 2019 at 20:35)</a>:</h4>
<p>ready</p>



<a name="177558306"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/177558306" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#177558306">(Oct 07 2019 at 20:39)</a>:</h4>
<p>eh, crossbeam-queue failed the whitelist, hold on</p>



<a name="177558514"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/177558514" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#177558514">(Oct 07 2019 at 20:41)</a>:</h4>
<p>you can r=nikomatsakis whenever you're ready</p>



<a name="177558553"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/177558553" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#177558553">(Oct 07 2019 at 20:41)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> you're good with whitelisting <code>crossbeam-queue</code>, I hope?</p>



<a name="177558656"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/177558656" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#177558656">(Oct 07 2019 at 20:42)</a>:</h4>
<p>seems fine</p>



<a name="177558681"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/177558681" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#177558681">(Oct 07 2019 at 20:43)</a>:</h4>
<p>presuambly we already whitelist other crossbeam crates</p>



<a name="177558690"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/177558690" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#177558690">(Oct 07 2019 at 20:43)</a>:</h4>
<p>yep</p>



<a name="177558737"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/177558737" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#177558737">(Oct 07 2019 at 20:43)</a>:</h4>
<p>I'm going to update the few "real" <code>rayon</code> uses to 1.2 too, for consistency</p>



<a name="177558745"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/177558745" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#177558745">(Oct 07 2019 at 20:43)</a>:</h4>
<p>(like in the installer tool)</p>



<a name="177560818"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/177560818" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#177560818">(Oct 07 2019 at 21:05)</a>:</h4>
<p><span class="user-mention" data-user-id="138448">@cuviper</span> that's on a cron job on Alex's computer, it'll auto update when we land changes in master in ~24 hours I believe</p>



<a name="177560867"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/177560867" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#177560867">(Oct 07 2019 at 21:06)</a>:</h4>
<p>re: ap stuff</p>



<a name="177560880"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase%20on%20newer%20rayon/near/177560880" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/187679-t-compiler/wg-parallel-rustc/topic/Rebase.20on.20newer.20rayon.html#177560880">(Oct 07 2019 at 21:06)</a>:</h4>
<p>cool, thanks</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>