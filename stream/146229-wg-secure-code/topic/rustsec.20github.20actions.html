<html>
<head><meta charset="utf-8"><title>rustsec github actions · wg-secure-code · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/146229-wg-secure-code/index.html">wg-secure-code</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/146229-wg-secure-code/topic/rustsec.20github.20actions.html">rustsec github actions</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="255310432"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146229-wg-secure-code/topic/rustsec%20github%20actions/near/255310432" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Gaynor <a href="https://zulip-archive.rust-lang.org/stream/146229-wg-secure-code/topic/rustsec.20github.20actions.html#255310432">(Sep 28 2021 at 22:25)</a>:</h4>
<p>Can someone with admin on rustsec go into the settings on github and change the actions from "require approval for all new contributors" tio only requiring it for people who are new to GH?</p>



<a name="255310678"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146229-wg-secure-code/topic/rustsec%20github%20actions/near/255310678" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tony Arcieri <a href="https://zulip-archive.rust-lang.org/stream/146229-wg-secure-code/topic/rustsec.20github.20actions.html#255310678">(Sep 28 2021 at 22:27)</a>:</h4>
<p>that's a little scary because <code>GITHUB_TOKEN</code> has write perms to open PRs and publish the web site</p>



<a name="255310768"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146229-wg-secure-code/topic/rustsec%20github%20actions/near/255310768" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Gaynor <a href="https://zulip-archive.rust-lang.org/stream/146229-wg-secure-code/topic/rustsec.20github.20actions.html#255310768">(Sep 28 2021 at 22:28)</a>:</h4>
<p>I don't think GITHUB_TOKEN is exposed in PRs from folks outside the org?</p>



<a name="255310817"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146229-wg-secure-code/topic/rustsec%20github%20actions/near/255310817" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tony Arcieri <a href="https://zulip-archive.rust-lang.org/stream/146229-wg-secure-code/topic/rustsec.20github.20actions.html#255310817">(Sep 28 2021 at 22:28)</a>:</h4>
<p>would be good to get confirmation on that...</p>



<a name="255310833"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146229-wg-secure-code/topic/rustsec%20github%20actions/near/255310833" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Gaynor <a href="https://zulip-archive.rust-lang.org/stream/146229-wg-secure-code/topic/rustsec.20github.20actions.html#255310833">(Sep 28 2021 at 22:28)</a>:</h4>
<p>If "first time contributor" was the only security control, that'd be a big problem -- it's easy to send one PR that gets approved and then you put your malicious code in teh second.</p>



<a name="255310907"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146229-wg-secure-code/topic/rustsec%20github%20actions/near/255310907" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tony Arcieri <a href="https://zulip-archive.rust-lang.org/stream/146229-wg-secure-code/topic/rustsec.20github.20actions.html#255310907">(Sep 28 2021 at 22:29)</a>:</h4>
<p>those tokens are so much ambient authority <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span></p>



<a name="255311069"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146229-wg-secure-code/topic/rustsec%20github%20actions/near/255311069" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tony Arcieri <a href="https://zulip-archive.rust-lang.org/stream/146229-wg-secure-code/topic/rustsec.20github.20actions.html#255311069">(Sep 28 2021 at 22:30)</a>:</h4>
<p>if the tokens have no authority for outside contributors, why approve their PR runs? just to reduce the number of CI jobs?</p>



<a name="255311116"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146229-wg-secure-code/topic/rustsec%20github%20actions/near/255311116" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Gaynor <a href="https://zulip-archive.rust-lang.org/stream/146229-wg-secure-code/topic/rustsec.20github.20actions.html#255311116">(Sep 28 2021 at 22:31)</a>:</h4>
<p>GH added that features to deal with <span aria-label="tulip" class="emoji emoji-1f337" role="img" title="tulip">:tulip:</span>-spam</p>



<a name="255313099"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146229-wg-secure-code/topic/rustsec%20github%20actions/near/255313099" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shnatsel <a href="https://zulip-archive.rust-lang.org/stream/146229-wg-secure-code/topic/rustsec.20github.20actions.html#255313099">(Sep 28 2021 at 22:49)</a>:</h4>
<p>I imagine it is protection from imposing costs on us via running a great many CI jobs</p>



<a name="255313156"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146229-wg-secure-code/topic/rustsec%20github%20actions/near/255313156" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shnatsel <a href="https://zulip-archive.rust-lang.org/stream/146229-wg-secure-code/topic/rustsec.20github.20actions.html#255313156">(Sep 28 2021 at 22:49)</a>:</h4>
<p>This is something I definitely looked up, and didn't contemplate this kind of attack by myself at all</p>



<a name="255313366"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146229-wg-secure-code/topic/rustsec%20github%20actions/near/255313366" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/146229-wg-secure-code/topic/rustsec.20github.20actions.html#255313366">(Sep 28 2021 at 22:51)</a>:</h4>
<p>yeah the only reason this was added is because people were opening a bunch of PRs in repositories to mine cryptocurrency</p>



<a name="255313605"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146229-wg-secure-code/topic/rustsec%20github%20actions/near/255313605" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shnatsel <a href="https://zulip-archive.rust-lang.org/stream/146229-wg-secure-code/topic/rustsec.20github.20actions.html#255313605">(Sep 28 2021 at 22:53)</a>:</h4>
<p>Tony does raise a good point though. If the CI builds arbitrary Rust code, then that automatically means arbitrary code execution on CI, which seems to have access to the token. And we really do need the token in CI on advisory-db repo</p>



<a name="255313729"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146229-wg-secure-code/topic/rustsec%20github%20actions/near/255313729" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shnatsel <a href="https://zulip-archive.rust-lang.org/stream/146229-wg-secure-code/topic/rustsec.20github.20actions.html#255313729">(Sep 28 2021 at 22:54)</a>:</h4>
<p>But the advisory-db repo does not run arbitrary code, just ingests arbitrary data... hmm. I wonder if CI config is read from master or from the fork when running the jobs?</p>



<a name="255347968"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146229-wg-secure-code/topic/rustsec%20github%20actions/near/255347968" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/146229-wg-secure-code/topic/rustsec.20github.20actions.html#255347968">(Sep 29 2021 at 06:19)</a>:</h4>
<p>It is read from forks. AFAIK pull requests from forks get a read-only token, but PRs from the same repo get write tokens.</p>



<a name="255348140"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146229-wg-secure-code/topic/rustsec%20github%20actions/near/255348140" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/146229-wg-secure-code/topic/rustsec.20github.20actions.html#255348140">(Sep 29 2021 at 06:21)</a>:</h4>
<p>If you need a write token for PRs from forks you need to use <code>pull_request_target:</code> which runs with the definition from the default branch and not the PR.</p>



<a name="255348186"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146229-wg-secure-code/topic/rustsec%20github%20actions/near/255348186" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/146229-wg-secure-code/topic/rustsec.20github.20actions.html#255348186">(Sep 29 2021 at 06:22)</a>:</h4>
<p><a href="https://github.blog/2020-08-03-github-actions-improvements-for-fork-and-pull-request-workflows/">https://github.blog/2020-08-03-github-actions-improvements-for-fork-and-pull-request-workflows/</a></p>



<a name="258013431"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146229-wg-secure-code/topic/rustsec%20github%20actions/near/258013431" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tamme Schichler <a href="https://zulip-archive.rust-lang.org/stream/146229-wg-secure-code/topic/rustsec.20github.20actions.html#258013431">(Oct 18 2021 at 11:27)</a>:</h4>
<p><span class="user-mention silent" data-user-id="133247">bjorn3</span> <a href="#narrow/stream/146229-wg-secure-code/topic/rustsec.20github.20actions/near/255347968">said</a>:</p>
<blockquote>
<p>It is read from forks. AFAIK pull requests from forks get a read-only token, but PRs from the same repo get write tokens.</p>
</blockquote>
<p>Yes, it's documented here: <a href="https://docs.github.com/en/actions/security-guides/automatic-token-authentication#permissions-for-the-github_token">https://docs.github.com/en/actions/security-guides/automatic-token-authentication#permissions-for-the-github_token</a></p>



<a name="258013753"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146229-wg-secure-code/topic/rustsec%20github%20actions/near/258013753" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tamme Schichler <a href="https://zulip-archive.rust-lang.org/stream/146229-wg-secure-code/topic/rustsec.20github.20actions.html#258013753">(Oct 18 2021 at 11:30)</a>:</h4>
<p>Also, while not directly related to PRs, you can limit <code>GITHUB_TOKEN</code> permissions for individual workflows <a href="https://github.blog/changelog/2021-04-20-github-actions-control-permissions-for-github_token/">since a few months ago</a>. (I found out about this only a few days ago, and started using it on my repos since I'm a bit laisser-faire with workflow dependency updates.)</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>