<html>
<head><meta charset="utf-8"><title>advisory on feature flags? · wg-secure-code · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/146229-wg-secure-code/index.html">wg-secure-code</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/146229-wg-secure-code/topic/advisory.20on.20feature.20flags.3F.html">advisory on feature flags?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="258033111"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146229-wg-secure-code/topic/advisory%20on%20feature%20flags%3F/near/258033111" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jorge Leitao <a href="https://zulip-archive.rust-lang.org/stream/146229-wg-secure-code/topic/advisory.20on.20feature.20flags.3F.html#258033111">(Oct 18 2021 at 14:00)</a>:</h4>
<p>Hi!</p>
<p>Is cargo audit sensible to feature flags? I.e. is it possible to limit an advisory to a set of feature flags? (or is this not possible even in theory?</p>



<a name="258033549"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146229-wg-secure-code/topic/advisory%20on%20feature%20flags%3F/near/258033549" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tony Arcieri <a href="https://zulip-archive.rust-lang.org/stream/146229-wg-secure-code/topic/advisory.20on.20feature.20flags.3F.html#258033549">(Oct 18 2021 at 14:03)</a>:</h4>
<p><span class="user-mention" data-user-id="399416">@Jorge Leitao</span> it only parses <code>Cargo.lock</code> so it can't be aware of feature flags</p>



<a name="258033572"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146229-wg-secure-code/topic/advisory%20on%20feature%20flags%3F/near/258033572" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tony Arcieri <a href="https://zulip-archive.rust-lang.org/stream/146229-wg-secure-code/topic/advisory.20on.20feature.20flags.3F.html#258033572">(Oct 18 2021 at 14:03)</a>:</h4>
<p>there's been a lot of discussion about call graph analysis, however</p>



<a name="258034441"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146229-wg-secure-code/topic/advisory%20on%20feature%20flags%3F/near/258034441" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jorge Leitao <a href="https://zulip-archive.rust-lang.org/stream/146229-wg-secure-code/topic/advisory.20on.20feature.20flags.3F.html#258034441">(Oct 18 2021 at 14:08)</a>:</h4>
<p>that would be awesome - I assume a _bit_ more difficult though. Is considering feature flags in scope atm, or the plan is to move to call graph analysis directly?</p>



<a name="258034984"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146229-wg-secure-code/topic/advisory%20on%20feature%20flags%3F/near/258034984" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tony Arcieri <a href="https://zulip-archive.rust-lang.org/stream/146229-wg-secure-code/topic/advisory.20on.20feature.20flags.3F.html#258034984">(Oct 18 2021 at 14:12)</a>:</h4>
<p>call graph analysis has been discussed for years. it's been a perpetual data source problem though</p>



<a name="258035056"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146229-wg-secure-code/topic/advisory%20on%20feature%20flags%3F/near/258035056" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tony Arcieri <a href="https://zulip-archive.rust-lang.org/stream/146229-wg-secure-code/topic/advisory.20on.20feature.20flags.3F.html#258035056">(Oct 18 2021 at 14:13)</a>:</h4>
<p>I'm not sure how you would even go about building a feature flag-aware false positive detection without using call graph analysis, as it were</p>



<a name="258035709"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146229-wg-secure-code/topic/advisory%20on%20feature%20flags%3F/near/258035709" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jorge Leitao <a href="https://zulip-archive.rust-lang.org/stream/146229-wg-secure-code/topic/advisory.20on.20feature.20flags.3F.html#258035709">(Oct 18 2021 at 14:17)</a>:</h4>
<p>ok, then I likely do not know what call graph analysis means. I was thinking it terms of an optional field in the advisoty with the set of features that are affected. If nothing is provided, all of them are affected. If one is provided, the advisory is only correspondent to that feature (or something like that)</p>



<a name="258035821"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146229-wg-secure-code/topic/advisory%20on%20feature%20flags%3F/near/258035821" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jorge Leitao <a href="https://zulip-archive.rust-lang.org/stream/146229-wg-secure-code/topic/advisory.20on.20feature.20flags.3F.html#258035821">(Oct 18 2021 at 14:18)</a>:</h4>
<p>your point is that we can't identify on the checking side whether the lib is using a given feature flag?</p>



<a name="258036808"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146229-wg-secure-code/topic/advisory%20on%20feature%20flags%3F/near/258036808" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tony Arcieri <a href="https://zulip-archive.rust-lang.org/stream/146229-wg-secure-code/topic/advisory.20on.20feature.20flags.3F.html#258036808">(Oct 18 2021 at 14:24)</a>:</h4>
<p>detecting feature activation through transitive dependencies is a tricky problem, short of doing a full call graph analysis</p>



<a name="258036866"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146229-wg-secure-code/topic/advisory%20on%20feature%20flags%3F/near/258036866" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tony Arcieri <a href="https://zulip-archive.rust-lang.org/stream/146229-wg-secure-code/topic/advisory.20on.20feature.20flags.3F.html#258036866">(Oct 18 2021 at 14:25)</a>:</h4>
<p>we do collect what functions are impacted by an advisory, with the goal of eventually using that for call graph analysis</p>



<a name="258038429"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146229-wg-secure-code/topic/advisory%20on%20feature%20flags%3F/near/258038429" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jorge Leitao <a href="https://zulip-archive.rust-lang.org/stream/146229-wg-secure-code/topic/advisory.20on.20feature.20flags.3F.html#258038429">(Oct 18 2021 at 14:34)</a>:</h4>
<p>thanks a lot for the explanation. Could you elaborate where is it tricky? Is the issue that <code>Cargo.lock</code> has no information over features, because they are resolved at a later level? Wouldn't it be possible to combine both Cargo.toml (features) and Cargo.lock (dependency tree and versions)?</p>



<a name="258039564"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146229-wg-secure-code/topic/advisory%20on%20feature%20flags%3F/near/258039564" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tony Arcieri <a href="https://zulip-archive.rust-lang.org/stream/146229-wg-secure-code/topic/advisory.20on.20feature.20flags.3F.html#258039564">(Oct 18 2021 at 14:42)</a>:</h4>
<p>any dependency can activate any feature of any other dependency</p>



<a name="258039609"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146229-wg-secure-code/topic/advisory%20on%20feature%20flags%3F/near/258039609" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tony Arcieri <a href="https://zulip-archive.rust-lang.org/stream/146229-wg-secure-code/topic/advisory.20on.20feature.20flags.3F.html#258039609">(Oct 18 2021 at 14:42)</a>:</h4>
<p>and feature activation is unified across all dependencies</p>



<a name="258039730"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146229-wg-secure-code/topic/advisory%20on%20feature%20flags%3F/near/258039730" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tony Arcieri <a href="https://zulip-archive.rust-lang.org/stream/146229-wg-secure-code/topic/advisory.20on.20feature.20flags.3F.html#258039730">(Oct 18 2021 at 14:43)</a>:</h4>
<p>so even if a toplevel crate doesn't activate a feature of a crate it depends on explicitly, it can still be activated implicitly by another dependency</p>



<a name="258040543"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146229-wg-secure-code/topic/advisory%20on%20feature%20flags%3F/near/258040543" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tony Arcieri <a href="https://zulip-archive.rust-lang.org/stream/146229-wg-secure-code/topic/advisory.20on.20feature.20flags.3F.html#258040543">(Oct 18 2021 at 14:49)</a>:</h4>
<p>also features are just one instance of conditional compilation. call graph analysis would work with all of them in a way that's (hopefully!) reliable</p>



<a name="258767017"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146229-wg-secure-code/topic/advisory%20on%20feature%20flags%3F/near/258767017" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shnatsel <a href="https://zulip-archive.rust-lang.org/stream/146229-wg-secure-code/topic/advisory.20on.20feature.20flags.3F.html#258767017">(Oct 22 2021 at 20:07)</a>:</h4>
<p><span class="user-mention silent" data-user-id="132721">Tony Arcieri</span> <a href="#narrow/stream/146229-wg-secure-code/topic/advisory.20on.20feature.20flags.3F/near/258036808">said</a>:</p>
<blockquote>
<p>detecting feature activation through transitive dependencies is a tricky problem, short of doing a full call graph analysis</p>
</blockquote>
<p>We can just call out to <code>cargo metadata</code> to get the info on the call graph and activated features. That's reliable because it uses the exact same algorithm as Cargo.</p>



<a name="258772653"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146229-wg-secure-code/topic/advisory%20on%20feature%20flags%3F/near/258772653" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tony Arcieri <a href="https://zulip-archive.rust-lang.org/stream/146229-wg-secure-code/topic/advisory.20on.20feature.20flags.3F.html#258772653">(Oct 22 2021 at 20:50)</a>:</h4>
<p>please implement it then <span aria-label="stuck out tongue wink" class="emoji emoji-1f61c" role="img" title="stuck out tongue wink">:stuck_out_tongue_wink:</span></p>



<a name="258775607"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146229-wg-secure-code/topic/advisory%20on%20feature%20flags%3F/near/258775607" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tony Arcieri <a href="https://zulip-archive.rust-lang.org/stream/146229-wg-secure-code/topic/advisory.20on.20feature.20flags.3F.html#258775607">(Oct 22 2021 at 21:14)</a>:</h4>
<p>I don't think <code>cargo metadata</code> provides unified feature activation</p>



<a name="258775622"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146229-wg-secure-code/topic/advisory%20on%20feature%20flags%3F/near/258775622" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tony Arcieri <a href="https://zulip-archive.rust-lang.org/stream/146229-wg-secure-code/topic/advisory.20on.20feature.20flags.3F.html#258775622">(Oct 22 2021 at 21:14)</a>:</h4>
<p>I think you can compute unified feature activation from it</p>



<a name="258775630"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146229-wg-secure-code/topic/advisory%20on%20feature%20flags%3F/near/258775630" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tony Arcieri <a href="https://zulip-archive.rust-lang.org/stream/146229-wg-secure-code/topic/advisory.20on.20feature.20flags.3F.html#258775630">(Oct 22 2021 at 21:14)</a>:</h4>
<p>but at the very least it's an extra step</p>



<a name="258775814"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146229-wg-secure-code/topic/advisory%20on%20feature%20flags%3F/near/258775814" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tony Arcieri <a href="https://zulip-archive.rust-lang.org/stream/146229-wg-secure-code/topic/advisory.20on.20feature.20flags.3F.html#258775814">(Oct 22 2021 at 21:16)</a>:</h4>
<p>someone should probably write up an issue about it. hopefully you're volunteering there <span class="user-mention" data-user-id="127617">@Shnatsel</span></p>



<a name="258775822"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146229-wg-secure-code/topic/advisory%20on%20feature%20flags%3F/near/258775822" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tony Arcieri <a href="https://zulip-archive.rust-lang.org/stream/146229-wg-secure-code/topic/advisory.20on.20feature.20flags.3F.html#258775822">(Oct 22 2021 at 21:16)</a>:</h4>
<p>but it seems nontrivial to me</p>



<a name="258776317"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146229-wg-secure-code/topic/advisory%20on%20feature%20flags%3F/near/258776317" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shnatsel <a href="https://zulip-archive.rust-lang.org/stream/146229-wg-secure-code/topic/advisory.20on.20feature.20flags.3F.html#258776317">(Oct 22 2021 at 21:19)</a>:</h4>
<p>I have done most of the work in <code>rust-audit</code> already, should be fairly easy to adapt that. Although that was before the v2 resolver.</p>



<a name="258776464"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146229-wg-secure-code/topic/advisory%20on%20feature%20flags%3F/near/258776464" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shnatsel <a href="https://zulip-archive.rust-lang.org/stream/146229-wg-secure-code/topic/advisory.20on.20feature.20flags.3F.html#258776464">(Oct 22 2021 at 21:20)</a>:</h4>
<p>A potential problem I see is that you want to audit <em>your</em> app with all features enabled, but some of the features might be mutually exclusive. I'm not sure if <code>cargo-metadata</code> would still work or not if the code fails to compile.</p>



<a name="258776519"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146229-wg-secure-code/topic/advisory%20on%20feature%20flags%3F/near/258776519" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shnatsel <a href="https://zulip-archive.rust-lang.org/stream/146229-wg-secure-code/topic/advisory.20on.20feature.20flags.3F.html#258776519">(Oct 22 2021 at 21:21)</a>:</h4>
<p>That would also potentially mean that we're running build scripts...</p>



<a name="258776877"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146229-wg-secure-code/topic/advisory%20on%20feature%20flags%3F/near/258776877" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shnatsel <a href="https://zulip-archive.rust-lang.org/stream/146229-wg-secure-code/topic/advisory.20on.20feature.20flags.3F.html#258776877">(Oct 22 2021 at 21:24)</a>:</h4>
<p>For <code>rust-audit</code> that was not a problem because it only embedded info about the <em>current</em> feature configuration.</p>



<a name="258777873"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146229-wg-secure-code/topic/advisory%20on%20feature%20flags%3F/near/258777873" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tony Arcieri <a href="https://zulip-archive.rust-lang.org/stream/146229-wg-secure-code/topic/advisory.20on.20feature.20flags.3F.html#258777873">(Oct 22 2021 at 21:33)</a>:</h4>
<p>yeah I mean, that's the biggest difference: the current analysis is of <code>Cargo.lock</code></p>



<a name="258777895"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146229-wg-secure-code/topic/advisory%20on%20feature%20flags%3F/near/258777895" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tony Arcieri <a href="https://zulip-archive.rust-lang.org/stream/146229-wg-secure-code/topic/advisory.20on.20feature.20flags.3F.html#258777895">(Oct 22 2021 at 21:33)</a>:</h4>
<p><code>cargo-metadata</code> is trying to take on a whole world of information beyond that</p>



<a name="260201966"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146229-wg-secure-code/topic/advisory%20on%20feature%20flags%3F/near/260201966" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pinkforest(she/her) <a href="https://zulip-archive.rust-lang.org/stream/146229-wg-secure-code/topic/advisory.20on.20feature.20flags.3F.html#260201966">(Nov 03 2021 at 21:45)</a>:</h4>
<p>hi, is this where all the dead bodies are? :)</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>