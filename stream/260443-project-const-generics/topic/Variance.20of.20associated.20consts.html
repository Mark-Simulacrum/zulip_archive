<html>
<head><meta charset="utf-8"><title>Variance of associated consts · project-const-generics · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/260443-project-const-generics/index.html">project-const-generics</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/260443-project-const-generics/topic/Variance.20of.20associated.20consts.html">Variance of associated consts</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="256705635"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/260443-project-const-generics/topic/Variance%20of%20associated%20consts/near/256705635" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dominik Stolz <a href="https://zulip-archive.rust-lang.org/stream/260443-project-const-generics/topic/Variance.20of.20associated.20consts.html#256705635">(Oct 08 2021 at 08:28)</a>:</h4>
<p>Hi,  I'm Dominik.<br>
I have been looking into issues with using associated constants as const generics (<a href="https://github.com/rust-lang/rust/issues/60551">#60551</a>). One of those issues is that using a type parameter only for its associated constant will trigger error E0392 <em>"parameter <code>T</code> is never used"</em> (<a href="https://github.com/rust-lang/rust/issues/80977">#80977</a>).<br>
Here is a short example:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">trait</span><span class="w"> </span><span class="n">Foo</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">N</span>: <span class="kt">usize</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">struct</span> <span class="nc">Bar</span><span class="o">&lt;</span><span class="n">T</span>: <span class="nc">Foo</span><span class="o">&gt;</span><span class="p">([</span><span class="kt">u8</span><span class="p">;</span><span class="w"> </span><span class="n">T</span>::<span class="n">N</span><span class="p">])</span><span class="w"></span>
<span class="k">where</span><span class="w"> </span><span class="p">[();</span><span class="w"> </span><span class="n">T</span>::<span class="n">N</span><span class="p">]</span>:<span class="p">;</span><span class="w"></span>
</code></pre></div>
<p>(<a href="https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2015&amp;gist=b51a272853f75925e72efc1597478aa5">playgound</a>)</p>
<p>I was able to prevent the error by adding variance constraints for the substs of unevaluated constants (<a href="https://github.com/voidc/rust/commit/8b141a24d05c86b4c074715803f0c29783f8f9bc">commit</a>). However, I'm quite new to rustc and unsure whether this is the right approach. It would be great to hear your opinions on this matter!</p>



<a name="256732587"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/260443-project-const-generics/topic/Variance%20of%20associated%20consts/near/256732587" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dominik Stolz <a href="https://zulip-archive.rust-lang.org/stream/260443-project-const-generics/topic/Variance.20of.20associated.20consts.html#256732587">(Oct 08 2021 at 12:34)</a>:</h4>
<p>Originally, variance constraints were added for consts (<a href="https://github.com/voidc/rust/commit/f7f60eef500cbba168bec1034a087a6feb625982">commit</a>) but then reverted later (<a href="https://github.com/voidc/rust/commit/15033a9ba74fbe585f5571cd82a1241cc2e865c2">commit</a>) to resolve <a href="https://github.com/rust-lang/rust/issues/60047">#60047</a>. However, in the old implementation constraints were added for const params while the new implementation adds constraints for the substs of unevaluated consts.</p>



<a name="256817699"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/260443-project-const-generics/topic/Variance%20of%20associated%20consts/near/256817699" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/260443-project-const-generics/topic/Variance.20of.20associated.20consts.html#256817699">(Oct 08 2021 at 23:01)</a>:</h4>
<p>This does not seem like a const generics issue imo</p>



<a name="256817716"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/260443-project-const-generics/topic/Variance%20of%20associated%20consts/near/256817716" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/260443-project-const-generics/topic/Variance.20of.20associated.20consts.html#256817716">(Oct 08 2021 at 23:01)</a>:</h4>
<p>you would get the same thing even with an associated type wouldn't you?</p>



<a name="256817849"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/260443-project-const-generics/topic/Variance%20of%20associated%20consts/near/256817849" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/260443-project-const-generics/topic/Variance.20of.20associated.20consts.html#256817849">(Oct 08 2021 at 23:03)</a>:</h4>
<p>oh it seems not :O</p>



<a name="257242205"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/260443-project-const-generics/topic/Variance%20of%20associated%20consts/near/257242205" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dominik Stolz <a href="https://zulip-archive.rust-lang.org/stream/260443-project-const-generics/topic/Variance.20of.20associated.20consts.html#257242205">(Oct 12 2021 at 17:37)</a>:</h4>
<p>Does anyone have comments on this or would it be better to just open a (draft) PR and get feedback there?</p>



<a name="257251391"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/260443-project-const-generics/topic/Variance%20of%20associated%20consts/near/257251391" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/260443-project-const-generics/topic/Variance.20of.20associated.20consts.html#257251391">(Oct 12 2021 at 18:39)</a>:</h4>
<p>It'll be better to open a draft PR for feedback. You can use <code>r? @ghost</code> to prevent a reviewer from being assigned while you're still working on it.</p>



<a name="257270413"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/260443-project-const-generics/topic/Variance%20of%20associated%20consts/near/257270413" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dominik Stolz <a href="https://zulip-archive.rust-lang.org/stream/260443-project-const-generics/topic/Variance.20of.20associated.20consts.html#257270413">(Oct 12 2021 at 20:52)</a>:</h4>
<p>Okay, I opened <a href="https://github.com/rust-lang/rust/pull/89829">#89829</a>.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>