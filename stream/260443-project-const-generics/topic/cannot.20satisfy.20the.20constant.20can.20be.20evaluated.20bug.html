<html>
<head><meta charset="utf-8"><title>cannot satisfy the constant can be evaluated bug · project-const-generics · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/260443-project-const-generics/index.html">project-const-generics</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/260443-project-const-generics/topic/cannot.20satisfy.20the.20constant.20can.20be.20evaluated.20bug.html">cannot satisfy the constant can be evaluated bug</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="270740541"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/260443-project-const-generics/topic/cannot%20satisfy%20the%20constant%20can%20be%20evaluated%20bug/near/270740541" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joeyh021 <a href="https://zulip-archive.rust-lang.org/stream/260443-project-const-generics/topic/cannot.20satisfy.20the.20constant.20can.20be.20evaluated.20bug.html#270740541">(Feb 04 2022 at 16:43)</a>:</h4>
<p>Hey all, I've run into a weird error when playing around with both <code>feature(adt_const_params)</code> and <code>feature(generic_const_exprs)</code> enabled:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#![feature(adt_const_params)]</span><span class="w"></span>
<span class="cp">#![feature(generic_const_exprs)]</span><span class="w"></span>

<span class="cp">#[derive(PartialEq, Eq)]</span><span class="w"></span>
<span class="k">enum</span> <span class="nc">Colour</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">R</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">G</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">B</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">W</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">Off</span><span class="p">,</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">struct</span> <span class="nc">Led</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">C</span>: <span class="nc">Colour</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="k">impl</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">C</span>: <span class="nc">Colour</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Led</span><span class="o">&lt;</span><span class="n">C</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">new</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">Led</span><span class="o">&lt;</span><span class="p">{</span><span class="w"> </span><span class="n">Colour</span>::<span class="n">Off</span><span class="w"> </span><span class="p">}</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">Led</span>::<span class="o">&lt;</span><span class="p">{</span><span class="w"> </span><span class="n">Colour</span>::<span class="n">Off</span><span class="w"> </span><span class="p">}</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Led</span>::<span class="n">new</span><span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>The compiler gives me this error<br>
<a href="/user_uploads/4715/Q8u3rjWocT1K9wnipswnrvKe/image.png">image.png</a> <br>
This looks like a bug, im not sure</p>
<div class="message_inline_image"><a href="/user_uploads/4715/Q8u3rjWocT1K9wnipswnrvKe/image.png" title="image.png"><img src="/user_uploads/4715/Q8u3rjWocT1K9wnipswnrvKe/image.png"></a></div>



<a name="270814937"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/260443-project-const-generics/topic/cannot%20satisfy%20the%20constant%20can%20be%20evaluated%20bug/near/270814937" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/260443-project-const-generics/topic/cannot.20satisfy.20the.20constant.20can.20be.20evaluated.20bug.html#270814937">(Feb 05 2022 at 08:46)</a>:</h4>
<p>it is mostly a diagnostic bug <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span> note that the <code>new</code> call is actually <code>Led&lt;_&gt;::new()</code></p>



<a name="270814948"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/260443-project-const-generics/topic/cannot%20satisfy%20the%20constant%20can%20be%20evaluated%20bug/near/270814948" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/260443-project-const-generics/topic/cannot.20satisfy.20the.20constant.20can.20be.20evaluated.20bug.html#270814948">(Feb 05 2022 at 08:47)</a>:</h4>
<p>because of this the anonymous constant in <code>{ Colour::Off }</code> is internally represented as <code>const ANON_CONST_0&lt;const C: Colour&gt; = ...</code></p>



<a name="270814953"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/260443-project-const-generics/topic/cannot%20satisfy%20the%20constant%20can%20be%20evaluated%20bug/near/270814953" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/260443-project-const-generics/topic/cannot.20satisfy.20the.20constant.20can.20be.20evaluated.20bug.html#270814953">(Feb 05 2022 at 08:47)</a>:</h4>
<p>we don't evaluate anonymous constants if their generic arguments contain an inference variable</p>



<a name="270814999"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/260443-project-const-generics/topic/cannot%20satisfy%20the%20constant%20can%20be%20evaluated%20bug/near/270814999" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/260443-project-const-generics/topic/cannot.20satisfy.20the.20constant.20can.20be.20evaluated.20bug.html#270814999">(Feb 05 2022 at 08:48)</a>:</h4>
<p>so we never actually try to evaluate this constant as we can't infer <code>C</code>, even though it doesn't use <code>C</code></p>



<a name="270815014"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/260443-project-const-generics/topic/cannot%20satisfy%20the%20constant%20can%20be%20evaluated%20bug/near/270815014" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/260443-project-const-generics/topic/cannot.20satisfy.20the.20constant.20can.20be.20evaluated.20bug.html#270815014">(Feb 05 2022 at 08:48)</a>:</h4>
<p>i am a bit unhappy with how the error is emitted, so it probably makes sense to open a diagnostics issue on <a href="https://github.com/rust-lang/rust">https://github.com/rust-lang/rust</a> for this</p>



<a name="271057307"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/260443-project-const-generics/topic/cannot%20satisfy%20the%20constant%20can%20be%20evaluated%20bug/near/271057307" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joeyh021 <a href="https://zulip-archive.rust-lang.org/stream/260443-project-const-generics/topic/cannot.20satisfy.20the.20constant.20can.20be.20evaluated.20bug.html#271057307">(Feb 07 2022 at 23:12)</a>:</h4>
<p>How come <code>Led</code> requires generic arguments on the new call though. Other generic types such as <code>Vec&lt;T&gt;</code> have <code>::new()</code> which works without specifying the generics at that point<br>
Is this a restriction of const generics?</p>



<a name="271058666"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/260443-project-const-generics/topic/cannot%20satisfy%20the%20constant%20can%20be%20evaluated%20bug/near/271058666" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joeyh021 <a href="https://zulip-archive.rust-lang.org/stream/260443-project-const-generics/topic/cannot.20satisfy.20the.20constant.20can.20be.20evaluated.20bug.html#271058666">(Feb 07 2022 at 23:26)</a>:</h4>
<p><span class="user-mention silent" data-user-id="216206">lcnr</span> <a href="#narrow/stream/260443-project-const-generics/topic/cannot.20satisfy.20the.20constant.20can.20be.20evaluated.20bug/near/270815014">said</a>:</p>
<blockquote>
<p>i am a bit unhappy with how the error is emitted, so it probably makes sense to open a diagnostics issue on <a href="https://github.com/rust-lang/rust">https://github.com/rust-lang/rust</a> for this</p>
</blockquote>
<p><a href="https://github.com/rust-lang/rust/issues/93750">https://github.com/rust-lang/rust/issues/93750</a> opened. thanks for the help</p>



<a name="271084184"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/260443-project-const-generics/topic/cannot%20satisfy%20the%20constant%20can%20be%20evaluated%20bug/near/271084184" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/260443-project-const-generics/topic/cannot.20satisfy.20the.20constant.20can.20be.20evaluated.20bug.html#271084184">(Feb 08 2022 at 05:49)</a>:</h4>
<p>you are using</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">impl</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">C</span>: <span class="nc">Colour</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Led</span><span class="o">&lt;</span><span class="n">C</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">new</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">Led</span><span class="o">&lt;</span><span class="p">{</span><span class="w"> </span><span class="n">Colour</span>::<span class="n">Off</span><span class="w"> </span><span class="p">}</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">Led</span>::<span class="o">&lt;</span><span class="p">{</span><span class="w"> </span><span class="n">Colour</span>::<span class="n">Off</span><span class="w"> </span><span class="p">}</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>instead of</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">impl</span><span class="w"> </span><span class="n">Led</span><span class="o">&lt;</span><span class="p">{</span><span class="w"> </span><span class="n">Colour</span>::<span class="n">Off</span><span class="w"> </span><span class="p">}</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">new</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">Led</span><span class="o">&lt;</span><span class="p">{</span><span class="w"> </span><span class="n">Colour</span>::<span class="n">Off</span><span class="w"> </span><span class="p">}</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">Led</span>::<span class="o">&lt;</span><span class="p">{</span><span class="w"> </span><span class="n">Colour</span>::<span class="n">Off</span><span class="w"> </span><span class="p">}</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>or</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">impl</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">C</span>: <span class="nc">Colour</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Led</span><span class="o">&lt;</span><span class="n">C</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">new</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">Led</span><span class="o">&lt;</span><span class="n">C</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">Led</span>::<span class="o">&lt;</span><span class="n">C</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>the first one doesn't have any generic arguments while the second <code>new</code> function can infer its generic arguments through the return type</p>



<a name="271084321"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/260443-project-const-generics/topic/cannot%20satisfy%20the%20constant%20can%20be%20evaluated%20bug/near/271084321" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/260443-project-const-generics/topic/cannot.20satisfy.20the.20constant.20can.20be.20evaluated.20bug.html#271084321">(Feb 08 2022 at 05:51)</a>:</h4>
<p>so while the way this errors is a current shortcoming/bug of <code>feature(generic_const_exprs)</code>, it is expected and intended that your example fails to compile</p>



<a name="271101623"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/260443-project-const-generics/topic/cannot%20satisfy%20the%20constant%20can%20be%20evaluated%20bug/near/271101623" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joeyh021 <a href="https://zulip-archive.rust-lang.org/stream/260443-project-const-generics/topic/cannot.20satisfy.20the.20constant.20can.20be.20evaluated.20bug.html#271101623">(Feb 08 2022 at 09:33)</a>:</h4>
<p><span class="user-mention silent" data-user-id="216206">lcnr</span> <a href="#narrow/stream/260443-project-const-generics/topic/cannot.20satisfy.20the.20constant.20can.20be.20evaluated.20bug/near/271084184">said</a>:</p>
<blockquote>
<p>you are using</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">impl</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">C</span>: <span class="nc">Colour</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Led</span><span class="o">&lt;</span><span class="n">C</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">new</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">Led</span><span class="o">&lt;</span><span class="p">{</span><span class="w"> </span><span class="n">Colour</span>::<span class="n">Off</span><span class="w"> </span><span class="p">}</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">Led</span>::<span class="o">&lt;</span><span class="p">{</span><span class="w"> </span><span class="n">Colour</span>::<span class="n">Off</span><span class="w"> </span><span class="p">}</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>instead of</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">impl</span><span class="w"> </span><span class="n">Led</span><span class="o">&lt;</span><span class="p">{</span><span class="w"> </span><span class="n">Colour</span>::<span class="n">Off</span><span class="w"> </span><span class="p">}</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">new</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">Led</span><span class="o">&lt;</span><span class="p">{</span><span class="w"> </span><span class="n">Colour</span>::<span class="n">Off</span><span class="w"> </span><span class="p">}</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">Led</span>::<span class="o">&lt;</span><span class="p">{</span><span class="w"> </span><span class="n">Colour</span>::<span class="n">Off</span><span class="w"> </span><span class="p">}</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>or</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">impl</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">C</span>: <span class="nc">Colour</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Led</span><span class="o">&lt;</span><span class="n">C</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">new</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">Led</span><span class="o">&lt;</span><span class="n">C</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">Led</span>::<span class="o">&lt;</span><span class="n">C</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>the first one doesn't have any generic arguments while the second <code>new</code> function can infer its generic arguments through the return type</p>
</blockquote>
<p>I see, i see my misunderstanding here. Thanks for the help!</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>