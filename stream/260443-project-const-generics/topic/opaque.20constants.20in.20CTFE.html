<html>
<head><meta charset="utf-8"><title>opaque constants in CTFE · project-const-generics · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/260443-project-const-generics/index.html">project-const-generics</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/260443-project-const-generics/topic/opaque.20constants.20in.20CTFE.html">opaque constants in CTFE</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="276437401"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/260443-project-const-generics/topic/opaque%20constants%20in%20CTFE/near/276437401" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/260443-project-const-generics/topic/opaque.20constants.20in.20CTFE.html#276437401">(Mar 24 2022 at 06:39)</a>:</h4>
<p><a href="https://github.com/rust-lang/project-const-generics/issues/39">https://github.com/rust-lang/project-const-generics/issues/39</a> talks about opaque constants, but it is unclear to me how we'll prevent leaking one as non-opaque via CTFE.</p>
<p>You can always create an intermediate constant that (accidentally or not ) returns the value of a size_of call. Should CTFE automatically track this and magically make that return value opaque, too?</p>



<a name="276437480"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/260443-project-const-generics/topic/opaque%20constants%20in%20CTFE/near/276437480" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/260443-project-const-generics/topic/opaque.20constants.20in.20CTFE.html#276437480">(Mar 24 2022 at 06:40)</a>:</h4>
<p>Or even more generally, how do we handle <code>const fn moo&lt;T&gt;() -&gt; usize { size_of::&lt;T&gt;() }</code></p>



<a name="276437735"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/260443-project-const-generics/topic/opaque%20constants%20in%20CTFE/near/276437735" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/260443-project-const-generics/topic/opaque.20constants.20in.20CTFE.html#276437735">(Mar 24 2022 at 06:46)</a>:</h4>
<blockquote>
<p>Should CTFE automatically track this and magically make that return value opaque, too?</p>
</blockquote>
<p>that was my idea yeah, we add  a tag to allocations or even just the current ctfe context, which gets set once it uses something opaque</p>



<a name="276438386"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/260443-project-const-generics/topic/opaque%20constants%20in%20CTFE/near/276438386" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/260443-project-const-generics/topic/opaque.20constants.20in.20CTFE.html#276438386">(Mar 24 2022 at 07:00)</a>:</h4>
<p>Oh, that is easier than what I had in mind (taint tracking)</p>



<a name="276438459"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/260443-project-const-generics/topic/opaque%20constants%20in%20CTFE/near/276438459" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/260443-project-const-generics/topic/opaque.20constants.20in.20CTFE.html#276438459">(Mar 24 2022 at 07:02)</a>:</h4>
<p>We would need to adjust our static analyses, too, as otherwise it becomes real easy to introduce breaking changes where a constant or const fn goes from transparent to opaque without the library author realizing</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>