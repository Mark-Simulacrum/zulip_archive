<html>
<head><meta charset="utf-8"><title>Should negative_coherence allow this · wg-traits/negative-impls · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/index.html">wg-traits/negative-impls</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/Should.20negative_coherence.20allow.20this.html">Should negative_coherence allow this</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="272521185"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/Should%20negative_coherence%20allow%20this/near/272521185" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/Should.20negative_coherence.20allow.20this.html#272521185">(Feb 19 2022 at 14:21)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116266">Santiago Pastorino</span> <a href="#narrow/stream/315151-wg-traits.2Fnegative-impls/topic/PR.20.2393652/near/272460862">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="232018">Daniel Henry-Mantilla</span> I think your case is a case where the feature flag is making diagnostics regress, right?</p>
</blockquote>
<p>I don't know exactly <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span>  hence my asking around here before posting issues:</p>
<ul>
<li>
<p>is that "just" a diagnostic regression (<em>w.r.t.</em> something nonetheless denied by coherence)?</p>
</li>
<li>
<p>or should a <code>with_negative_coherence</code>-aware coherence checker allow such an impl?</p>
</li>
</ul>
<div class="spoiler-block"><div class="spoiler-header">
<p>original snippet</p>
</div><div class="spoiler-content" aria-hidden="true">
<p><span class="user-mention silent" data-user-id="232018">Daniel Henry-Mantilla</span> <a href="#narrow/stream/315151-wg-traits.2Fnegative-impls/topic/PR.20.2393652/near/272433217">said</a>:</p>
<blockquote>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#![feature(trivial_bounds, with_negative_coherence)]</span><span class="w"></span>

<span class="k">trait</span><span class="w"> </span><span class="n">Trait</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="k">impl</span><span class="w"> </span><span class="n">Trait</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="k">impl</span><span class="w"> </span><span class="n">Trait</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">()</span><span class="w"></span>
<span class="k">where</span><span class="w"></span>
<span class="w">    </span>::<span class="n">core</span>::<span class="n">marker</span>::<span class="n">PhantomPinned</span><span class="w"> </span>: <span class="nb">Unpin</span><span class="p">,</span><span class="w"></span>
<span class="p">{}</span><span class="w"></span>
</code></pre></div>
<p>complaining about:</p>
<div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="go">9  | impl Trait for ()</span>
<span class="go">   |      ^^^^^ cannot infer type for `()`</span>
</code></pre></div>
<ul>
<li>(trivial bounds is here to make the example simpler, but is not necessary).</li>
</ul>
</blockquote>
</div></div>



<a name="272736434"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/Should%20negative_coherence%20allow%20this/near/272736434" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/Should.20negative_coherence.20allow.20this.html#272736434">(Feb 21 2022 at 21:24)</a>:</h4>
<p>but there are no negative impls, right?</p>



<a name="272749746"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/Should%20negative_coherence%20allow%20this/near/272749746" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/Should.20negative_coherence.20allow.20this.html#272749746">(Feb 22 2022 at 01:03)</a>:</h4>
<p>I was thinking of the <a href="https://doc.rust-lang.org/1.58.1/src/core/marker.rs.html#781"><code>impl !Unpin for PhantomPinned</code> in <code>::core</code></a></p>



<a name="272849038"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/Should%20negative_coherence%20allow%20this/near/272849038" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/Should.20negative_coherence.20allow.20this.html#272849038">(Feb 22 2022 at 18:48)</a>:</h4>
<p>cc <span class="user-mention" data-user-id="116009">@nikomatsakis</span></p>



<a name="272849240"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/Should%20negative_coherence%20allow%20this/near/272849240" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/Should.20negative_coherence.20allow.20this.html#272849240">(Feb 22 2022 at 18:49)</a>:</h4>
<p>want to hear Niko's thoughts but my understanding is that this shouldn't work</p>



<a name="272849304"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/Should%20negative_coherence%20allow%20this/near/272849304" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/Should.20negative_coherence.20allow.20this.html#272849304">(Feb 22 2022 at 18:50)</a>:</h4>
<p>although, the error message is bad</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>