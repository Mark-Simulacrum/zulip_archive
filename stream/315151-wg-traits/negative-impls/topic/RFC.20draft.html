<html>
<head><meta charset="utf-8"><title>RFC draft · wg-traits/negative-impls · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/index.html">wg-traits/negative-impls</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html">RFC draft</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="275712600"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/275712600" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#275712600">(Mar 17 2022 at 19:21)</a>:</h4>
<p><span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> where is the RFC draft you were working on?</p>



<a name="275717757"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/275717757" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#275717757">(Mar 17 2022 at 20:02)</a>:</h4>
<p><a href="https://hackmd.io/ZmpF0ITPRWKx6jYxgCWS7g?both">https://hackmd.io/ZmpF0ITPRWKx6jYxgCWS7g?both</a></p>



<a name="275717816"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/275717816" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#275717816">(Mar 17 2022 at 20:02)</a>:</h4>
<p>it's mosly unfilled</p>



<a name="276473051"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276473051" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276473051">(Mar 24 2022 at 13:11)</a>:</h4>
<p>I guess here, if we're talking about the RFC</p>



<a name="276473065"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276473065" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276473065">(Mar 24 2022 at 13:11)</a>:</h4>
<p>let me take a look</p>



<a name="276473079"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276473079" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276473079">(Mar 24 2022 at 13:11)</a>:</h4>
<p>I think the motivations for this...</p>



<a name="276473102"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276473102" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276473102">(Mar 24 2022 at 13:11)</a>:</h4>
<p>I remember us talking about it, not sure if we took notes on that conversation</p>



<a name="276473108"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276473108" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276473108">(Mar 24 2022 at 13:11)</a>:</h4>
<p>I would say...</p>



<a name="276473114"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276473114" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276473114">(Mar 24 2022 at 13:11)</a>:</h4>
<p>again, remember that I didn't do much on the RFC :)</p>



<a name="276473125"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276473125" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276473125">(Mar 24 2022 at 13:11)</a>:</h4>
<p>just throw a couple of motivations there</p>



<a name="276473142"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276473142" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276473142">(Mar 24 2022 at 13:11)</a>:</h4>
<ul>
<li><strong>Soundness</strong> -- some things, like pin, have to reason about the fact that an impl does NOT exist. Previous attempts to lean on the coherence rules for this were problematic. Negative impls solve this.</li>
</ul>



<a name="276473201"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276473201" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276473201">(Mar 24 2022 at 13:12)</a>:</h4>
<ul>
<li><strong>Coherence</strong> -- not a general fix, but we can solve some coherence problems if you can make negative impls.</li>
</ul>



<a name="276473228"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276473228" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276473228">(Mar 24 2022 at 13:12)</a>:</h4>
<ul>
<li><strong>Auto traits</strong> -- they have always required an opt-out mechanism, and negative impls are good for this &lt;-- note that we have to finish this part so make them <em>fully</em> opt out</li>
</ul>



<a name="276473286"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276473286" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276473286">(Mar 24 2022 at 13:13)</a>:</h4>
<p>There is one more thing I just realized we should evaluate, it's possible that negative impls could serve as a replacement for one aspect of <code>#[fundamental]</code></p>



<a name="276473290"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276473290" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276473290">(Mar 24 2022 at 13:13)</a>:</h4>
<p>we should actually test that</p>



<a name="276473311"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276473311" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276473311">(Mar 24 2022 at 13:13)</a>:</h4>
<p>basically see if can remove the concept of <em>fundamental traits</em></p>



<a name="276473319"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276473319" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276473319">(Mar 24 2022 at 13:13)</a>:</h4>
<p>(we still need <em>fundamental types</em>)</p>



<a name="276473324"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276473324" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276473324">(Mar 24 2022 at 13:13)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/315151-wg-traits.2Fnegative-impls/topic/RFC.20draft/near/276473286">said</a>:</p>
<blockquote>
<p>There is one more thing I just realized we should evaluate, it's possible that negative impls could serve as a replacement for one aspect of <code>#[fundamental]</code></p>
</blockquote>
<p>yes, I have this in my todo list</p>



<a name="276473373"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276473373" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276473373">(Mar 24 2022 at 13:14)</a>:</h4>
<p>that would fit under the "coherence" motivation though</p>



<a name="276473469"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276473469" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276473469">(Mar 24 2022 at 13:14)</a>:</h4>
<p>do all of those motiations make sense to you? I imagine you might want to know more about the soundness one</p>



<a name="276473530"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276473530" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276473530">(Mar 24 2022 at 13:15)</a>:</h4>
<p>make sense</p>



<a name="276473558"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276473558" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276473558">(Mar 24 2022 at 13:15)</a>:</h4>
<p>I understand the soundness one too</p>



<a name="276473621"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276473621" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276473621">(Mar 24 2022 at 13:15)</a>:</h4>
<p>I wonder, may how do we explain these things on an RFC</p>



<a name="276473666"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276473666" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276473666">(Mar 24 2022 at 13:15)</a>:</h4>
<p>but I guess I can check other RFCs, try to come up with something and then we can iterate my writings</p>



<a name="276473675"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276473675" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276473675">(Mar 24 2022 at 13:16)</a>:</h4>
<p>I think I would mostly reference the issue</p>



<a name="276473719"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276473719" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276473719">(Mar 24 2022 at 13:16)</a>:</h4>
<p>I imagine something like</p>



<a name="276473787"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276473787" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276473787">(Mar 24 2022 at 13:16)</a>:</h4>
<p>The <code>Pin</code> API, when originally designed, included this impl</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">impl</span><span class="w"> </span><span class="n">SomethingOrOther</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">&amp;</span><span class="n">T</span><span class="w"></span>
</code></pre></div>
<p>The assumption was that <code>&amp;T: DerefMut</code> would never be true. But in Issue <a href="https://github.com/rust-lang/rust/issues/123">#123</a>, it was found that the coherence rules <em>did</em> permit such an impl, admittedly in a roundabout way:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="o">..</span><span class="p">.</span><span class="w"></span>
</code></pre></div>
<p>To fix this, we introduced an explicit <strong>negative impl</strong> of <code>DerefMut</code> for <code>&amp;T</code>, effectively committing to the idea that it would never be implemented:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">impl</span><span class="w"> </span><span class="o">!</span><span class="n">DerefMut</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">&amp;</span><span class="n">T</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>This establishes a general principle: unsafe code should never rely on "this impl hasn't been added" or "doesn't exist", as such logic is easily broken. Instead, it should rely on <strong>explicit negative impls</strong>.</p>



<a name="276473886"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276473886" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276473886">(Mar 24 2022 at 13:17)</a>:</h4>
<p>you meant <a href="https://github.com/rust-lang/rust/issues/123">#123</a> as a placeholder, I guess</p>



<a name="276473897"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276473897" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276473897">(Mar 24 2022 at 13:17)</a>:</h4>
<p>checking the issue :)</p>



<a name="276473946"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276473946" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276473946">(Mar 24 2022 at 13:18)</a>:</h4>
<p>Yes... I don't remember the number :)</p>



<a name="276474019"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276474019" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276474019">(Mar 24 2022 at 13:18)</a>:</h4>
<p>I can find it out</p>



<a name="276474120"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276474120" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276474120">(Mar 24 2022 at 13:19)</a>:</h4>
<p>what about rationale and alternatives?</p>



<a name="276474192"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276474192" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276474192">(Mar 24 2022 at 13:20)</a>:</h4>
<p>because it's obviously the best idea :P</p>



<a name="276474357"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276474357" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276474357">(Mar 24 2022 at 13:21)</a>:</h4>
<p>Well, I would probably talk more about the limitations there</p>



<a name="276474366"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276474366" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276474366">(Mar 24 2022 at 13:21)</a>:</h4>
<p>I tend to replace that section with Frequently Asked Questions tbh :)</p>



<a name="276474372"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276474372" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276474372">(Mar 24 2022 at 13:21)</a>:</h4>
<p>I find it a better structure</p>



<a name="276474427"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276474427" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276474427">(Mar 24 2022 at 13:22)</a>:</h4>
<p>I think one FAQ would be "Why are we not adding negative where clauses?"</p>



<a name="276474432"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276474432" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276474432">(Mar 24 2022 at 13:22)</a>:</h4>
<p>e.g., why can't I do <code>where Foo: !Bar</code></p>



<a name="276474566"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276474566" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276474566">(Mar 24 2022 at 13:23)</a>:</h4>
<p>the answer is... (a) we don't need that to meet these motivations and (b) it raises some questions about whether we can deduce that <code>Foo: !Trait</code> for local types just from the lack of an impl. On that last point, introducing "failure to prove == not true" is not something we want to do because it makes the logic solver much more complex, and is a bit dubious</p>



<a name="276474585"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276474585" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276474585">(Mar 24 2022 at 13:23)</a>:</h4>
<p>so it's not to say we could <em>never</em> do it, but if we did it, it would only be true if there was an explicit negative impl</p>



<a name="276474610"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276474610" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276474610">(Mar 24 2022 at 13:24)</a>:</h4>
<p><span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="276474656"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276474656" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276474656">(Mar 24 2022 at 13:24)</a>:</h4>
<p>and the main use case is being able to do things like "exclusive traits" (e.g., at most one of these traits is implemented), and it might be better to model that explicitly</p>



<a name="276474688"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276474688" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276474688">(Mar 24 2022 at 13:24)</a>:</h4>
<p>I'm not sure what other FAQ to add, but we can see what questions people ask :)</p>



<a name="276474706"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276474706" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276474706">(Mar 24 2022 at 13:24)</a>:</h4>
<p>that's one nice thing about calling it FAQ, you can update it with questions from the thread very easily</p>



<a name="276474806"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276474806" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276474806">(Mar 24 2022 at 13:25)</a>:</h4>
<p>yes, that's cool</p>



<a name="276474818"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276474818" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276474818">(Mar 24 2022 at 13:25)</a>:</h4>
<p>thanks Niko</p>



<a name="276474872"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276474872" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276474872">(Mar 24 2022 at 13:26)</a>:</h4>
<p>unsure if you have more comments or things?</p>



<a name="276475161"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276475161" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276475161">(Mar 24 2022 at 13:28)</a>:</h4>
<p>that's about it for now :) I can help draft some text later if you want</p>



<a name="276475172"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276475172" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276475172">(Mar 24 2022 at 13:28)</a>:</h4>
<p>we oughta spell out the semantics etc</p>



<a name="276475192"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276475192" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276475192">(Mar 24 2022 at 13:29)</a>:</h4>
<p>but we have some notes on that stuff in the hackmds</p>



<a name="276475876"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276475876" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mejrs <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276475876">(Mar 24 2022 at 13:35)</a>:</h4>
<p>One thing that I like most about negative impls is that it might lead to better error messages. I often help rust newbies, and they tend to struggle with errors like <code>move occurs because </code>s<code> has type </code>String<code>, which does not implement the </code>Copy<code> trait</code>. So perhaps impls like <code>impl !Copy for String {}</code> could help with this.</p>



<a name="276475911"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276475911" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mejrs <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276475911">(Mar 24 2022 at 13:35)</a>:</h4>
<p>Perhaps this is best mentioned in "future possibilities" rather than a motivation.</p>



<a name="276528887"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276528887" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276528887">(Mar 24 2022 at 19:36)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> about the test case you've mentioned on the PR</p>



<a name="276528892"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276528892" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276528892">(Mar 24 2022 at 19:36)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="c1">// check-pass</span>

<span class="cp">#![feature(negative_impls)]</span><span class="w"></span>
<span class="cp">#![feature(rustc_attrs)]</span><span class="w"></span>
<span class="cp">#![feature(with_negative_coherence)]</span><span class="w"></span>

<span class="cp">#[rustc_strict_coherence]</span><span class="w"></span>
<span class="k">trait</span><span class="w"> </span><span class="n">Foo</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="k">impl</span><span class="w"> </span><span class="o">!</span><span class="n">Foo</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="kt">u32</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="k">struct</span> <span class="nc">MyStruct</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">T</span><span class="p">);</span><span class="w"></span>

<span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">MyStruct</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"></span>
<span class="k">where</span><span class="w"></span>
<span class="w">    </span><span class="n">T</span>: <span class="nc">Foo</span><span class="p">,</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">method</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">impl</span><span class="w"> </span><span class="n">MyStruct</span><span class="o">&lt;</span><span class="kt">u32</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">method</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
</code></pre></div>



<a name="276528916"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276528916" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276528916">(Mar 24 2022 at 19:37)</a>:</h4>
<p>I thought that that may have reproduced the problem you were suggesting but it's not</p>



<a name="276529135"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276529135" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276529135">(Mar 24 2022 at 19:39)</a>:</h4>
<p>it ends as an specialization case I guess</p>



<a name="276530212"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276530212" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276530212">(Mar 24 2022 at 19:48)</a>:</h4>
<p>trying to come up with an example maybe like ...</p>



<a name="276530217"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276530217" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276530217">(Mar 24 2022 at 19:49)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#![feature(negative_impls)]</span><span class="w"></span>
<span class="cp">#![feature(rustc_attrs)]</span><span class="w"></span>
<span class="cp">#![feature(with_negative_coherence)]</span><span class="w"></span>

<span class="cp">#[rustc_strict_coherence]</span><span class="w"></span>
<span class="k">trait</span><span class="w"> </span><span class="n">Foo</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">Foo</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">&amp;</span><span class="n">T</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">T</span>: <span class="o">'</span><span class="nb">static</span> <span class="p">{}</span><span class="w"></span>

<span class="k">struct</span> <span class="nc">MyStruct</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">T</span><span class="p">);</span><span class="w"></span>

<span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">MyStruct</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">T</span>: <span class="nc">Foo</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">'</span><span class="nb">static</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
</code></pre></div>



<a name="276531352"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276531352" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276531352">(Mar 24 2022 at 19:57)</a>:</h4>
<p>hmm</p>



<a name="276531372"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276531372" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276531372">(Mar 24 2022 at 19:57)</a>:</h4>
<p>out of curiosity, <span class="user-mention" data-user-id="116266">@Santiago Pastorino</span>, try reordering the impls :)</p>



<a name="276531380"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276531380" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276531380">(Mar 24 2022 at 19:57)</a>:</h4>
<p>in the first example</p>



<a name="276531541"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276531541" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276531541">(Mar 24 2022 at 19:58)</a>:</h4>
<p>let me see</p>



<a name="276531589"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276531589" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276531589">(Mar 24 2022 at 19:59)</a>:</h4>
<p>talking about ...</p>



<a name="276531600"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276531600" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276531600">(Mar 24 2022 at 19:59)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="c1">// check-pass</span>

<span class="cp">#![feature(negative_impls)]</span><span class="w"></span>
<span class="cp">#![feature(rustc_attrs)]</span><span class="w"></span>
<span class="cp">#![feature(with_negative_coherence)]</span><span class="w"></span>

<span class="cp">#[rustc_strict_coherence]</span><span class="w"></span>
<span class="k">trait</span><span class="w"> </span><span class="n">Foo</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="k">impl</span><span class="w"> </span><span class="o">!</span><span class="n">Foo</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="kt">u32</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="k">struct</span> <span class="nc">MyStruct</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">T</span><span class="p">);</span><span class="w"></span>

<span class="k">impl</span><span class="w"> </span><span class="n">MyStruct</span><span class="o">&lt;</span><span class="kt">u32</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">method</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">MyStruct</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"></span>
<span class="k">where</span><span class="w"></span>
<span class="w">    </span><span class="n">T</span>: <span class="nc">Foo</span><span class="p">,</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">method</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
</code></pre></div>



<a name="276531603"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276531603" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276531603">(Mar 24 2022 at 19:59)</a>:</h4>
<p>I guess</p>



<a name="276531618"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276531618" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276531618">(Mar 24 2022 at 19:59)</a>:</h4>
<p>if so, that passes tests too</p>



<a name="276531664"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276531664" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276531664">(Mar 24 2022 at 19:59)</a>:</h4>
<p>not sure what would change by doing that :/</p>



<a name="276531690"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276531690" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276531690">(Mar 24 2022 at 19:59)</a>:</h4>
<p>I was wondering it might affect which impl is impl1 vs impl2</p>



<a name="276531703"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276531703" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276531703">(Mar 24 2022 at 20:00)</a>:</h4>
<p>I have to look at the code a bit more closely</p>



<a name="276531769"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276531769" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276531769">(Mar 24 2022 at 20:00)</a>:</h4>
<p>ahh ok</p>



<a name="276531866"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276531866" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276531866">(Mar 24 2022 at 20:00)</a>:</h4>
<p>the thing I was trying to say is ... the bound may be ignored as you noted but still the code compiles if the bound is ignored so this is not a good example</p>



<a name="276532006"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276532006" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276532006">(Mar 24 2022 at 20:01)</a>:</h4>
<p>well, if you remove the where clause, I think it will error?</p>



<a name="276532009"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276532009" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276532009">(Mar 24 2022 at 20:01)</a>:</h4>
<p>worth a test :)</p>



<a name="276532149"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276532149" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276532149">(Mar 24 2022 at 20:02)</a>:</h4>
<p>I get <code>duplicate method</code> error</p>



<a name="276532184"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276532184" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276532184">(Mar 24 2022 at 20:03)</a>:</h4>
<p>I meant that the test pass without the negative impl</p>



<a name="276532274"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276532274" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276532274">(Mar 24 2022 at 20:04)</a>:</h4>
<p>so I guess this is not properly testing negative impls' where bounds on inherent impls</p>



<a name="276532447"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276532447" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276532447">(Mar 24 2022 at 20:05)</a>:</h4>
<p>my reasoning is ...</p>



<a name="276532533"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276532533" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276532533">(Mar 24 2022 at 20:06)</a>:</h4>
<p>given that the code fails without the where bound and pass with the bound, I guess negative impls are considering where bounds already?</p>



<a name="276532567"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276532567" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276532567">(Mar 24 2022 at 20:06)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116266">Santiago Pastorino</span> <a href="#narrow/stream/315151-wg-traits.2Fnegative-impls/topic/RFC.20draft/near/276532184">said</a>:</p>
<blockquote>
<p>I meant that the test pass without the negative impl</p>
</blockquote>
<p><em>oh</em></p>



<a name="276532579"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276532579" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276532579">(Mar 24 2022 at 20:06)</a>:</h4>
<p>it's because <code>#[rustc_strict_coherence]</code> is in the wrong place</p>



<a name="276532589"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276532589" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276532589">(Mar 24 2022 at 20:06)</a>:</h4>
<p>i.e., it's supposed to be on the <em>trait</em> that has conflicting impls</p>



<a name="276532593"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276532593" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276532593">(Mar 24 2022 at 20:06)</a>:</h4>
<p>but here there is no trait</p>



<a name="276532623"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276532623" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276532623">(Mar 24 2022 at 20:07)</a>:</h4>
<p>oh oh</p>



<a name="276532640"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276532640" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276532640">(Mar 24 2022 at 20:07)</a>:</h4>
<p>there's no <em>right</em> place to put it</p>



<a name="276532657"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276532657" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276532657">(Mar 24 2022 at 20:07)</a>:</h4>
<p>maybe on <code>MyStruct</code></p>



<a name="276532795"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276532795" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276532795">(Mar 24 2022 at 20:08)</a>:</h4>
<p>ok now yes</p>



<a name="276532805"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276532805" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276532805">(Mar 24 2022 at 20:08)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#![feature(negative_impls)]</span><span class="w"></span>
<span class="cp">#![feature(rustc_attrs)]</span><span class="w"></span>
<span class="cp">#![feature(with_negative_coherence)]</span><span class="w"></span>

<span class="k">trait</span><span class="w"> </span><span class="n">Foo</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="k">impl</span><span class="w"> </span><span class="o">!</span><span class="n">Foo</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="kt">u32</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="cp">#[rustc_strict_coherence]</span><span class="w"></span>
<span class="k">struct</span> <span class="nc">MyStruct</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">T</span><span class="p">);</span><span class="w"></span>

<span class="k">impl</span><span class="w"> </span><span class="n">MyStruct</span><span class="o">&lt;</span><span class="kt">u32</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">method</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">MyStruct</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"></span>
<span class="k">where</span><span class="w"></span>
<span class="w">    </span><span class="n">T</span>: <span class="nc">Foo</span><span class="p">,</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">method</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
</code></pre></div>



<a name="276532815"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276532815" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276532815">(Mar 24 2022 at 20:08)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">error</span><span class="p">[</span><span class="n">E0592</span><span class="p">]</span>: <span class="nc">duplicate</span><span class="w"> </span><span class="n">definitions</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="err">`</span><span class="n">method</span><span class="err">`</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span>-&gt; <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">spastorino</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">oss</span><span class="o">/</span><span class="n">rust1</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">ui</span><span class="o">/</span><span class="n">coherence</span><span class="o">/</span><span class="n">coherence</span><span class="o">-</span><span class="n">negative</span><span class="o">-</span><span class="n">inherent</span><span class="o">-</span><span class="k">where</span><span class="o">-</span><span class="n">bounds</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">15</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="n">LL</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="k">fn</span> <span class="nf">method</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w">     </span><span class="o">^^^^^^^^^^^^^^^^</span><span class="w"> </span><span class="n">duplicate</span><span class="w"> </span><span class="n">definitions</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="err">`</span><span class="n">method</span><span class="err">`</span><span class="w"></span>
<span class="o">..</span><span class="p">.</span><span class="w"></span>
<span class="n">LL</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="k">fn</span> <span class="nf">method</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w">     </span><span class="o">----------------</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">definition</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="err">`</span><span class="n">method</span><span class="err">`</span><span class="w"></span>
</code></pre></div>



<a name="276533621"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276533621" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276533621">(Mar 24 2022 at 20:15)</a>:</h4>
<p><span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> do you know how to fix?</p>



<a name="276534742"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276534742" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276534742">(Mar 24 2022 at 20:25)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> sorry, was brewing coffee :)</p>



<a name="276534841"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276534841" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276534841">(Mar 24 2022 at 20:26)</a>:</h4>
<p>I never know :P</p>



<a name="276534864"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276534864" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276534864">(Mar 24 2022 at 20:26)</a>:</h4>
<p>I guess I can figure it out</p>



<a name="276534889"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276534889" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276534889">(Mar 24 2022 at 20:26)</a>:</h4>
<p>we need to get the obligations given an impl header</p>



<a name="276534894"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276534894" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276534894">(Mar 24 2022 at 20:27)</a>:</h4>
<p>there should be a way</p>



<a name="276534919"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276534919" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276534919">(Mar 24 2022 at 20:27)</a>:</h4>
<p>whatever is done in <code>impl_trait_ref_and_oblig</code> should help, I guess</p>



<a name="276535785"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276535785" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276535785">(Mar 24 2022 at 20:34)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> actually don't we need to do the same thing we are doing in that function but instead of doing it trait_ref doing it for ty (tcx.type_of(def_id))?</p>



<a name="276537265"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276537265" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276537265">(Mar 24 2022 at 20:46)</a>:</h4>
<p>fixed</p>



<a name="276538143"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276538143" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276538143">(Mar 24 2022 at 20:54)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> <a href="https://github.com/rust-lang/rust/blob/master/compiler/rustc_trait_selection/src/traits/util.rs#L196">https://github.com/rust-lang/rust/blob/master/compiler/rustc_trait_selection/src/traits/util.rs#L196</a></p>



<a name="276538159"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276538159" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276538159">(Mar 24 2022 at 20:54)</a>:</h4>
<p>that link doesn't work</p>



<a name="276538221"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276538221" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276538221">(Mar 24 2022 at 20:55)</a>:</h4>
<p>I meant to say, basically we need to do that for both trait ref and inherent impls</p>



<a name="276538241"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276538241" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276538241">(Mar 24 2022 at 20:55)</a>:</h4>
<p>I've just copied the impl and the test now passes</p>



<a name="276538253"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276538253" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276538253">(Mar 24 2022 at 20:55)</a>:</h4>
<p>I guess this method should now handle <code>ImplSubject</code></p>



<a name="276538306"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276538306" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276538306">(Mar 24 2022 at 20:56)</a>:</h4>
<p>so <code>subst</code> should probably be implemented to <code>ImplSubject</code></p>



<a name="276538311"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276538311" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276538311">(Mar 24 2022 at 20:56)</a>:</h4>
<p>and so on</p>



<a name="276538350"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276538350" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276538350">(Mar 24 2022 at 20:56)</a>:</h4>
<p>and then we would also want to make a deeper refactor <a href="https://github.com/rust-lang/rust/blob/master/compiler/rustc_trait_selection/src/traits/specialize/mod.rs#L192">https://github.com/rust-lang/rust/blob/master/compiler/rustc_trait_selection/src/traits/specialize/mod.rs#L192</a></p>



<a name="276538365"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276538365" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276538365">(Mar 24 2022 at 20:57)</a>:</h4>
<p>the code there is almost the same we have in negative impls</p>



<a name="276543172"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276543172" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276543172">(Mar 24 2022 at 21:42)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> just pushed the test, the fix and a little change to make this function use <code>ImplSubject</code></p>



<a name="276543193"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276543193" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276543193">(Mar 24 2022 at 21:42)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116266">Santiago Pastorino</span> <a href="#narrow/stream/315151-wg-traits.2Fnegative-impls/topic/RFC.20draft/near/276538350">said</a>:</p>
<blockquote>
<p>and then we would also want to make a deeper refactor <a href="https://github.com/rust-lang/rust/blob/master/compiler/rustc_trait_selection/src/traits/specialize/mod.rs#L192">https://github.com/rust-lang/rust/blob/master/compiler/rustc_trait_selection/src/traits/specialize/mod.rs#L192</a></p>
</blockquote>
<p>I didn't do the deeper refactor mentioned here <span aria-label="point up" class="emoji emoji-1f446" role="img" title="point up">:point_up:</span></p>



<a name="276557219"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/RFC%20draft/near/276557219" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/RFC.20draft.html#276557219">(Mar 25 2022 at 00:26)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116266">Santiago Pastorino</span> <a href="#narrow/stream/315151-wg-traits.2Fnegative-impls/topic/RFC.20draft/near/276538306">said</a>:</p>
<blockquote>
<p>so <code>subst</code> should probably be implemented to <code>ImplSubject</code></p>
</blockquote>
<p>if you implement "type foldable" you'll get all that "for free"</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>