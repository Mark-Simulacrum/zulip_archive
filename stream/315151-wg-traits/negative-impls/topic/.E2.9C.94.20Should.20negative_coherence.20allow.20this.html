<html>
<head><meta charset="utf-8"><title>✔ Should negative_coherence allow this · wg-traits/negative-impls · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/index.html">wg-traits/negative-impls</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/.E2.9C.94.20Should.20negative_coherence.20allow.20this.html">✔ Should negative_coherence allow this</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="272958145"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/%E2%9C%94%20Should%20negative_coherence%20allow%20this/near/272958145" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/.E2.9C.94.20Should.20negative_coherence.20allow.20this.html#272958145">(Feb 23 2022 at 14:50)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116266">Santiago Pastorino</span> <a href="#narrow/stream/315151-wg-traits.2Fnegative-impls/topic/Should.20negative_coherence.20allow.20this/near/272849240">said</a>:</p>
<blockquote>
<p>want to hear Niko's thoughts but my understanding is that this shouldn't work</p>
</blockquote>
<p>Hmm, after some more testing you're right, I manage to reproduce this without <code>negative_coherence</code>, my bad! (it's thus more like an issue of <code>trivial_bounds</code>, one that technically affects stable Rust due to there being a workaround for that).</p>



<a name="272958189"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/%E2%9C%94%20Should%20negative_coherence%20allow%20this/near/272958189" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/.E2.9C.94.20Should.20negative_coherence.20allow.20this.html#272958189">(Feb 23 2022 at 14:50)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232018">Daniel Henry-Mantilla</span> has marked this topic as resolved.</p>



<a name="272958305"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/%E2%9C%94%20Should%20negative_coherence%20allow%20this/near/272958305" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/.E2.9C.94.20Should.20negative_coherence.20allow.20this.html#272958305">(Feb 23 2022 at 14:50)</a>:</h4>
<p>So, for the sake of completeness, the actually correct snippet would be:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#![feature(with_negative_coherence)]</span><span class="w"></span>

<span class="k">use</span><span class="w"> </span>::<span class="n">core</span>::<span class="n">marker</span>::<span class="p">{</span><span class="n">PhantomPinned</span><span class="p">,</span><span class="w"> </span><span class="nb">Unpin</span><span class="p">};</span><span class="w"></span>
<span class="c1">// trait Unpin {} enum PhantomPinned {} /* use local reasoning instead */</span>
<span class="k">trait</span><span class="w"> </span><span class="n">Trait</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="k">impl</span><span class="o">&lt;</span><span class="n">NotPhantomPinned</span><span class="w"> </span>: <span class="nb">Unpin</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Trait</span><span class="o">&lt;</span><span class="n">NotPhantomPinned</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">()</span><span class="w"></span>
<span class="p">{}</span><span class="w"></span>

<span class="k">impl</span><span class="w"> </span><span class="n">Trait</span><span class="o">&lt;</span><span class="n">PhantomPinned</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">()</span><span class="w"></span>
<span class="p">{}</span><span class="w"></span>
</code></pre></div>
<p>which does work <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span> <span aria-label="ok" class="emoji emoji-1f44c" role="img" title="ok">:ok:</span></p>
<p>Sorry for the inconvenience <span aria-label="bow" class="emoji emoji-1f647" role="img" title="bow">:bow:</span></p>



<a name="272996749"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/%E2%9C%94%20Should%20negative_coherence%20allow%20this/near/272996749" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/.E2.9C.94.20Should.20negative_coherence.20allow.20this.html#272996749">(Feb 23 2022 at 19:07)</a>:</h4>
<p>no worries, sorry for the slow replies</p>



<a name="272996830"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/%E2%9C%94%20Should%20negative_coherence%20allow%20this/near/272996830" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/.E2.9C.94.20Should.20negative_coherence.20allow.20this.html#272996830">(Feb 23 2022 at 19:07)</a>:</h4>
<p>anyway, we should open an issue about the diagnostic problem, if you will :)</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>