<html>
<head><meta charset="utf-8"><title>PR #93652 · wg-traits/negative-impls · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/index.html">wg-traits/negative-impls</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html">PR #93652</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="271447240"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/271447240" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#271447240">(Feb 10 2022 at 15:28)</a>:</h4>
<p><span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> left a <a href="https://github.com/rust-lang/rust/pull/93652#pullrequestreview-878978114">review</a></p>



<a name="271451815"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/271451815" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#271451815">(Feb 10 2022 at 15:59)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> there's no derive clone for <code>InferCtxt</code></p>



<a name="271451849"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/271451849" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#271451849">(Feb 10 2022 at 15:59)</a>:</h4>
<p><span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> then how it is calling <code>clone</code>?</p>



<a name="271451870"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/271451870" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#271451870">(Feb 10 2022 at 15:59)</a>:</h4>
<p>why I'm not able to find any impl of clone?</p>



<a name="271451898"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/271451898" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#271451898">(Feb 10 2022 at 16:00)</a>:</h4>
<p>no, I mena, the <code>fork</code> code was calling <code>clone</code></p>



<a name="271451944"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/271451944" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#271451944">(Feb 10 2022 at 16:00)</a>:</h4>
<p>it's really happening on <code>&amp;InferCtxt</code></p>



<a name="271451963"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/271451963" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#271451963">(Feb 10 2022 at 16:00)</a>:</h4>
<p>how did that work?</p>



<a name="271452000"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/271452000" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#271452000">(Feb 10 2022 at 16:00)</a>:</h4>
<p>/me confused</p>



<a name="271452050"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/271452050" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#271452050">(Feb 10 2022 at 16:00)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/315151-wg-traits.2Fnegative-impls/topic/PR.20.2393652/near/271451898">said</a>:</p>
<blockquote>
<p>no, I mena, the <code>fork</code> code was calling <code>clone</code></p>
</blockquote>
<p>yes, that's what I'm not sure about</p>



<a name="271452053"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/271452053" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#271452053">(Feb 10 2022 at 16:00)</a>:</h4>
<p>oh, i see</p>



<a name="271452069"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/271452069" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#271452069">(Feb 10 2022 at 16:00)</a>:</h4>
<p>that seems buggy :)</p>



<a name="271452080"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/271452080" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#271452080">(Feb 10 2022 at 16:00)</a>:</h4>
<p>I think it should return <code>-&gt; Self</code></p>



<a name="271452081"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/271452081" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#271452081">(Feb 10 2022 at 16:00)</a>:</h4>
<p>maybe defined in a macro or something?</p>



<a name="271452095"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/271452095" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#271452095">(Feb 10 2022 at 16:00)</a>:</h4>
<p>not <code>-&gt; &amp;Self</code></p>



<a name="271452121"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/271452121" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#271452121">(Feb 10 2022 at 16:00)</a>:</h4>
<p>you're just copying the pointer</p>



<a name="271452265"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/271452265" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#271452265">(Feb 10 2022 at 16:01)</a>:</h4>
<p>yeah but why cloning is doing that on <code>InferCtxt</code>?</p>



<a name="271452286"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/271452286" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#271452286">(Feb 10 2022 at 16:01)</a>:</h4>
<p>I'm a bit confused on what's going on</p>



<a name="271452378"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/271452378" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#271452378">(Feb 10 2022 at 16:02)</a>:</h4>
<p>and also, why is this working? if we're not even cloning?</p>



<a name="271452432"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/271452432" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#271452432">(Feb 10 2022 at 16:02)</a>:</h4>
<p>clone on <code>InferCtxt</code> is returning <code>&amp;InferCtxt</code></p>



<a name="271452447"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/271452447" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#271452447">(Feb 10 2022 at 16:02)</a>:</h4>
<p>and no idea where is defined</p>



<a name="271452823"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/271452823" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#271452823">(Feb 10 2022 at 16:05)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116266">Santiago Pastorino</span> <a href="#narrow/stream/315151-wg-traits.2Fnegative-impls/topic/PR.20.2393652/near/271452432">said</a>:</p>
<blockquote>
<p>clone on <code>InferCtxt</code> is returning <code>&amp;InferCtxt</code></p>
</blockquote>
<p>no</p>



<a name="271452838"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/271452838" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#271452838">(Feb 10 2022 at 16:05)</a>:</h4>
<p>clone in <code>&amp;InferCtxt</code> is returning <code>&amp;InferCtxt</code> :)</p>



<a name="271452902"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/271452902" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#271452902">(Feb 10 2022 at 16:05)</a>:</h4>
<p>ohh I see</p>



<a name="271453035"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/271453035" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#271453035">(Feb 10 2022 at 16:06)</a>:</h4>
<p>but then I'm not sure what/how do we want to clone</p>



<a name="271453087"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/271453087" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#271453087">(Feb 10 2022 at 16:06)</a>:</h4>
<p>I meant, my first question is ...</p>



<a name="271453118"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/271453118" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#271453118">(Feb 10 2022 at 16:07)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">fork</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="bp">Self</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">foo</span>: <span class="nc">self</span><span class="p">.</span><span class="n">foo</span><span class="p">.</span><span class="n">clone</span><span class="p">(),</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="271453135"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/271453135" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#271453135">(Feb 10 2022 at 16:07)</a>:</h4>
<p>given that we are not cloning anything and this is working, do we really need fork?</p>



<a name="271453155"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/271453155" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#271453155">(Feb 10 2022 at 16:07)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/315151-wg-traits.2Fnegative-impls/topic/PR.20.2393652/near/271453118">said</a>:</p>
<blockquote>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">fork</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="bp">Self</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">....</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
</code></pre></div><br>
</p>
</blockquote>
<p>yes yes :)</p>



<a name="271453210"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/271453210" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#271453210">(Feb 10 2022 at 16:07)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116266">Santiago Pastorino</span> <a href="#narrow/stream/315151-wg-traits.2Fnegative-impls/topic/PR.20.2393652/near/271453135">said</a>:</p>
<blockquote>
<p>given that we are not cloning anything and this is working, do we really need fork?</p>
</blockquote>
<p>but <span aria-label="point up" class="emoji emoji-1f446" role="img" title="point up">:point_up:</span>, why? if we are not doing it and all this works</p>



<a name="271453247"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/271453247" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#271453247">(Feb 10 2022 at 16:07)</a>:</h4>
<p>can't answer a lot more just now :)</p>



<a name="271453254"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/271453254" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#271453254">(Feb 10 2022 at 16:07)</a>:</h4>
<p>will write more later</p>



<a name="271453299"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/271453299" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#271453299">(Feb 10 2022 at 16:08)</a>:</h4>
<p>but yes, I think we want it ...</p>



<a name="271453346"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/271453346" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#271453346">(Feb 10 2022 at 16:08)</a>:</h4>
<p><span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="271477964"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/271477964" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#271477964">(Feb 10 2022 at 19:00)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> back, can't clone because it requires clone on things from ena crate</p>



<a name="271478030"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/271478030" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#271478030">(Feb 10 2022 at 19:00)</a>:</h4>
<p>hmm</p>



<a name="271478048"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/271478048" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#271478048">(Feb 10 2022 at 19:00)</a>:</h4>
<p>ok :) we can add that I suppose</p>



<a name="271478065"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/271478065" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#271478065">(Feb 10 2022 at 19:00)</a>:</h4>
<p>sounds like we were never cloning <em>before</em></p>



<a name="271478081"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/271478081" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#271478081">(Feb 10 2022 at 19:00)</a>:</h4>
<p>we were just cloning the reference?</p>



<a name="271478105"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/271478105" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#271478105">(Feb 10 2022 at 19:00)</a>:</h4>
<p>yeah</p>



<a name="271478140"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/271478140" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#271478140">(Feb 10 2022 at 19:01)</a>:</h4>
<p>maybe we can re-create things in some way</p>



<a name="271478158"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/271478158" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#271478158">(Feb 10 2022 at 19:01)</a>:</h4>
<p>without calling clone</p>



<a name="271478617"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/271478617" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#271478617">(Feb 10 2022 at 19:04)</a>:</h4>
<p>in particular this <a href="https://github.com/rust-lang/rust/blob/0232de964997bf8dd3a96372802401722fbfa384/compiler/rustc_infer/src/infer/type_variable.rs#L17">https://github.com/rust-lang/rust/blob/0232de964997bf8dd3a96372802401722fbfa384/compiler/rustc_infer/src/infer/type_variable.rs#L17</a></p>



<a name="271478667"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/271478667" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#271478667">(Feb 10 2022 at 19:04)</a>:</h4>
<p>would require <code>sv::UndoLog</code> from <code>ena</code> to be <code>Clone</code></p>



<a name="271481822"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/271481822" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#271481822">(Feb 10 2022 at 19:27)</a>:</h4>
<p>so I guess I can place a PR on the crate, wait for it to be merged, released and then in this same PR bump the dependency and finish the clone impl, which is ready modulo that thing</p>



<a name="271482645"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/271482645" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#271482645">(Feb 10 2022 at 19:32)</a>:</h4>
<p>I'm wrong, we don't need to implement it because it's already done, there were some inner bounds that were not <code>Clone</code></p>



<a name="271483669"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/271483669" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#271483669">(Feb 10 2022 at 19:41)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> should be now ready for review</p>



<a name="271492082"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/271492082" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#271492082">(Feb 10 2022 at 20:50)</a>:</h4>
<p><span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> excellent!</p>



<a name="271493068"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/271493068" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#271493068">(Feb 10 2022 at 20:57)</a>:</h4>
<p>OK, I opened <a href="https://github.com/rust-lang/rust/issues/93875">https://github.com/rust-lang/rust/issues/93875</a> and r+'d</p>



<a name="271493112"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/271493112" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#271493112">(Feb 10 2022 at 20:57)</a>:</h4>
<p>great, was going to ask if you did create the issue <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="272404175"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272404175" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272404175">(Feb 18 2022 at 13:56)</a>:</h4>
<p>Hey, it seems the latest patch broke the <code>impl Termination for T where T: Future</code> example.</p>
<ul>
<li><a href="https://gist.github.com/yoshuawuyts/81aac115e284d9cc57954720c7e72ef7">py ./x.py build output</a></li>
<li><a href="https://github.com/yoshuawuyts/rust/tree/future-for-termination-3">rust-lang/rust repro branch</a></li>
</ul>



<a name="272404259"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272404259" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272404259">(Feb 18 2022 at 13:57)</a>:</h4>
<p><span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span></p>



<a name="272404284"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272404284" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272404284">(Feb 18 2022 at 13:57)</a>:</h4>
<p>from what I see it's missing the feature flag</p>



<a name="272404285"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272404285" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272404285">(Feb 18 2022 at 13:57)</a>:</h4>
<p>I might have forgotten to enable new features</p>



<a name="272404291"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272404291" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272404291">(Feb 18 2022 at 13:57)</a>:</h4>
<p>ah!</p>



<a name="272404301"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272404301" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272404301">(Feb 18 2022 at 13:57)</a>:</h4>
<p>let me point you to an example</p>



<a name="272404471"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272404471" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272404471">(Feb 18 2022 at 13:59)</a>:</h4>
<p>you basically need <code>#![feature(with_negative_coherence)]</code></p>



<a name="272404499"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272404499" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272404499">(Feb 18 2022 at 13:59)</a>:</h4>
<p>but you can check the tests added in the PR starting from here <a href="https://github.com/rust-lang/rust/pull/93652/files#diff-609bf3b33f89c7ceadd17b6309e6eae1f3efb71f56423934235ce921f26058c6">https://github.com/rust-lang/rust/pull/93652/files#diff-609bf3b33f89c7ceadd17b6309e6eae1f3efb71f56423934235ce921f26058c6</a></p>



<a name="272405048"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272405048" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272405048">(Feb 18 2022 at 14:03)</a>:</h4>
<p>(brb)</p>



<a name="272407108"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272407108" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272407108">(Feb 18 2022 at 14:21)</a>:</h4>
<p>(back)</p>



<a name="272407172"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272407172" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272407172">(Feb 18 2022 at 14:21)</a>:</h4>
<p>sorry, there's a hurricane starting here. Had to rush to move all of our things on the balconies inside.</p>



<a name="272407425"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272407425" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272407425">(Feb 18 2022 at 14:23)</a>:</h4>
<p>oh oh, hope everything is ok</p>



<a name="272407764"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272407764" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272407764">(Feb 18 2022 at 14:26)</a>:</h4>
<p>heh, yeah it's all good now (:</p>



<a name="272407834"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272407834" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272407834">(Feb 18 2022 at 14:27)</a>:</h4>
<p>yay!</p>



<a name="272407853"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272407853" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272407853">(Feb 18 2022 at 14:27)</a>:</h4>
<p>so hmm, I expected the feature to be enabled already in <code>library/src/std/lib.rs</code>, just like all other features. But it wasn't. And when I try and enable it, I get:</p>
<div class="codehilite" data-code-language="txt"><pre><span></span><code>error[E0635]: unknown feature `with_negative_coherence`
   --&gt; library\std\src\lib.rs:343:12
    |
343 | #![feature(with_negative_coherence)]
    |            ^^^^^^^^^^^^^^^^^^^^^^^

For more information about this error, try `rustc --explain E0635`.
error: could not compile `std` due to previous error
</code></pre></div>



<a name="272407900"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272407900" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272407900">(Feb 18 2022 at 14:27)</a>:</h4>
<p>I feel like I'm missing something?</p>



<a name="272407914"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272407914" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272407914">(Feb 18 2022 at 14:28)</a>:</h4>
<p>that may be because of bootstrapping</p>



<a name="272407954"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272407954" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272407954">(Feb 18 2022 at 14:28)</a>:</h4>
<p><code>#![feature(negative_impls)]</code> is in there</p>



<a name="272407968"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272407968" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272407968">(Feb 18 2022 at 14:28)</a>:</h4>
<p>when it's failing like that?</p>



<a name="272407983"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272407983" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272407983">(Feb 18 2022 at 14:28)</a>:</h4>
<p><code>x.py check</code></p>



<a name="272408018"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272408018" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272408018">(Feb 18 2022 at 14:28)</a>:</h4>
<p>oh yeah I guess that makes sense!</p>



<a name="272408023"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272408023" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272408023">(Feb 18 2022 at 14:28)</a>:</h4>
<p>but I meant, it's when it's using stage 0 compiler or when?</p>



<a name="272408044"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272408044" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272408044">(Feb 18 2022 at 14:29)</a>:</h4>
<p>in any case you can just try ...</p>



<a name="272408057"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272408057" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272408057">(Feb 18 2022 at 14:29)</a>:</h4>
<p>Ahh, yeah:</p>
<div class="codehilite"><pre><span></span><code>Checking stage0 std artifacts (x86_64-pc-windows-msvc -&gt; x86_64-pc-windows-msvc)
</code></pre></div>



<a name="272408285"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272408285" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272408285">(Feb 18 2022 at 14:31)</a>:</h4>
<p>you want this ...</p>



<a name="272408290"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272408290" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272408290">(Feb 18 2022 at 14:31)</a>:</h4>
<p>Oh, do I need to do a <code>cfg_attr</code> to set the attribute?</p>



<a name="272408305"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272408305" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272408305">(Feb 18 2022 at 14:31)</a>:</h4>
<p><code>#![cfg_attr(not(bootstrap), feature(with_negative_coherence))]</code></p>



<a name="272408371"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272408371" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272408371">(Feb 18 2022 at 14:31)</a>:</h4>
<p>yesssss, trying that now!</p>



<a name="272408421"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272408421" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272408421">(Feb 18 2022 at 14:32)</a>:</h4>
<p>and you would also need to wrap the code you're adding with a <code>cfg_attr</code> too</p>



<a name="272408480"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272408480" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272408480">(Feb 18 2022 at 14:32)</a>:</h4>
<p>yes yes yes, already have that</p>



<a name="272408491"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272408491" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272408491">(Feb 18 2022 at 14:33)</a>:</h4>
<p>sorry but I'm lacking some context on what you were working on, just curious, are you opening a PR? about what exactly?</p>



<a name="272408492"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272408492" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272408492">(Feb 18 2022 at 14:33)</a>:</h4>
<p>I think last time I tried this this was also very new</p>



<a name="272408542"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272408542" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272408542">(Feb 18 2022 at 14:33)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116266">Santiago Pastorino</span> <a href="#narrow/stream/315151-wg-traits.2Fnegative-impls/topic/PR.20.2393652/near/272408491">said</a>:</p>
<blockquote>
<p>sorry but I'm lacking some context on what you were working on, just curious, are you opening a PR? about what exactly?</p>
</blockquote>
<p>are you asking what the code that I wrote does, and what the plan for it is?</p>



<a name="272408622"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272408622" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272408622">(Feb 18 2022 at 14:34)</a>:</h4>
<p>yes, kind of :)</p>



<a name="272408645"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272408645" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272408645">(Feb 18 2022 at 14:34)</a>:</h4>
<p>I didn't pay a lot of attention to the code but I was guessing that was part of some bigger plans</p>



<a name="272408717"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272408717" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272408717">(Feb 18 2022 at 14:35)</a>:</h4>
<p>I meant, I guess you're trying to add async support on main functions or something like that?</p>



<a name="272408768"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272408768" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272408768">(Feb 18 2022 at 14:35)</a>:</h4>
<p>So, initially I wrote this just as a proof of concept. I'd been theorizing for a couple of years that the <code>async fn main</code> could be enabled if we resolved one of two blockers:</p>
<ol>
<li>Implement negative coherence in the compiler.</li>
<li>Unify <code>core</code> and <code>std</code> into a single library.</li>
</ol>
<p>But that was just the theory, not the practice. So I kind of let it sit and waited for either one of those to be done. And negative coherence was implemented first.</p>



<a name="272408804"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272408804" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272408804">(Feb 18 2022 at 14:35)</a>:</h4>
<p>So I wrote this to _validate_ that that is indeed the case. And it turns out it indeed worked! -- which is great</p>



<a name="272408877"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272408877" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272408877">(Feb 18 2022 at 14:36)</a>:</h4>
<p>right</p>



<a name="272408882"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272408882" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272408882">(Feb 18 2022 at 14:36)</a>:</h4>
<p>cool :)</p>



<a name="272408896"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272408896" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272408896">(Feb 18 2022 at 14:36)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116266">Santiago Pastorino</span> <a href="#narrow/stream/315151-wg-traits.2Fnegative-impls/topic/PR.20.2393652/near/272408717">said</a>:</p>
<blockquote>
<p>I meant, I guess you're trying to add async support on main functions or something like that?</p>
</blockquote>
<p>That's exactly right. Right now the stdlib has all sorts of async functionality, and no way of actually running it.</p>



<a name="272408903"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272408903" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272408903">(Feb 18 2022 at 14:36)</a>:</h4>
<p>so are you opening a PR with this or what's the plan?</p>



<a name="272408956"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272408956" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272408956">(Feb 18 2022 at 14:37)</a>:</h4>
<p>That's a good question! I haven't completely made up my mind yet, but I'm starting to think we just should make it a PR.</p>



<a name="272408962"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272408962" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272408962">(Feb 18 2022 at 14:37)</a>:</h4>
<p>Probably should write a post for it first.</p>



<a name="272408991"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272408991" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272408991">(Feb 18 2022 at 14:37)</a>:</h4>
<p>cool, please share all the stuff you do and if you open a PR cc me :)</p>



<a name="272409001"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272409001" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272409001">(Feb 18 2022 at 14:37)</a>:</h4>
<p>just interested in this :)</p>



<a name="272409019"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272409019" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272409019">(Feb 18 2022 at 14:38)</a>:</h4>
<p>it's cool</p>



<a name="272409021"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272409021" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272409021">(Feb 18 2022 at 14:38)</a>:</h4>
<p>There's a few considerations, where we would like to allow custom runtimes to override the implementation backing <code>async fn main</code>. But that's ways off, and I think we could add that capability in a backwards-compatible way later on.</p>



<a name="272409107"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272409107" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272409107">(Feb 18 2022 at 14:38)</a>:</h4>
<p>I see</p>



<a name="272409122"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272409122" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272409122">(Feb 18 2022 at 14:38)</a>:</h4>
<p>So yeah, this would give the stdlib a way to actually start writing examples using futures _which can be run_. And that seems useful, so I'm contemplating just pushing for it.</p>



<a name="272409177"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272409177" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272409177">(Feb 18 2022 at 14:39)</a>:</h4>
<p>Likely first step: write a blog post. I'll share it once I have something.</p>



<a name="272409208"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272409208" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272409208">(Feb 18 2022 at 14:39)</a>:</h4>
<p>PR is likely a step after that (:</p>



<a name="272409351"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272409351" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272409351">(Feb 18 2022 at 14:40)</a>:</h4>
<p>very cool <span aria-label="heart" class="emoji emoji-2764" role="img" title="heart">:heart:</span></p>



<a name="272412640"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272412640" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272412640">(Feb 18 2022 at 15:07)</a>:</h4>
<p><span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> I think I found a possible bug? <a href="https://gist.github.com/yoshuawuyts/4651d37bd4b94dc926b6a6deeaaa68fd">https://gist.github.com/yoshuawuyts/4651d37bd4b94dc926b6a6deeaaa68fd</a></p>



<a name="272412671"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272412671" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272412671">(Feb 18 2022 at 15:07)</a>:</h4>
<p>Enabled all features, but getting a panic during compilation now</p>



<a name="272412909"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272412909" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272412909">(Feb 18 2022 at 15:09)</a>:</h4>
<p>Pushed the branch: <a href="https://github.com/yoshuawuyts/rust/tree/future-for-termination-3">https://github.com/yoshuawuyts/rust/tree/future-for-termination-3</a></p>



<a name="272412944"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272412944" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272412944">(Feb 18 2022 at 15:09)</a>:</h4>
<p>This crashed when running: <code>py ./x.py build --stage 2</code></p>



<a name="272414016"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272414016" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272414016">(Feb 18 2022 at 15:18)</a>:</h4>
<p><span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="272415885"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272415885" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272415885">(Feb 18 2022 at 15:33)</a>:</h4>
<p><span class="user-mention" data-user-id="211722">@Yoshua Wuyts [he/they]</span> that started to happen when you made this change <a href="https://github.com/yoshuawuyts/rust/commit/859fa268c643ffff2efb4321aae4004445f58401#diff-ce8cd7d0ae24d8c6503198eeb502052175fc9c47d15fbc85258236b53e312ba0R135">https://github.com/yoshuawuyts/rust/commit/859fa268c643ffff2efb4321aae4004445f58401#diff-ce8cd7d0ae24d8c6503198eeb502052175fc9c47d15fbc85258236b53e312ba0R135</a> ?</p>



<a name="272415916"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272415916" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272415916">(Feb 18 2022 at 15:33)</a>:</h4>
<p>ooooopsssssss</p>



<a name="272415926"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272415926" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272415926">(Feb 18 2022 at 15:34)</a>:</h4>
<p><span class="user-mention silent" data-user-id="211722">Yoshua Wuyts [he/they]</span> <a href="#narrow/stream/315151-wg-traits.2Fnegative-impls/topic/PR.20.2393652/near/272412944">said</a>:</p>
<blockquote>
<p>This crashed when running: <code>py ./x.py build --stage 2</code></p>
</blockquote>
<p>are you saying that this works if you build with <code>--stage 1</code> but doens't with<code>--stage 2</code>?</p>



<a name="272416033"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272416033" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272416033">(Feb 18 2022 at 15:34)</a>:</h4>
<p>I thought <code>--stage 1</code> doesn't build a bootstrap compiler first? And we need that in order to try this feature because we have <code>#[cfg(not(bootstrap))]</code> everywhere</p>



<a name="272416254"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272416254" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272416254">(Feb 18 2022 at 15:36)</a>:</h4>
<p>(rebuilding now without that change. That's totally on me, sorry)</p>



<a name="272416268"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272416268" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272416268">(Feb 18 2022 at 15:36)</a>:</h4>
<p>Though I guess I still wouldn't have expected it to ICE?</p>



<a name="272417110"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272417110" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272417110">(Feb 18 2022 at 15:43)</a>:</h4>
<p>yeah, it shouldn't ICE, I was wondering what's the case that makes it ICE</p>



<a name="272417152"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272417152" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272417152">(Feb 18 2022 at 15:43)</a>:</h4>
<p>it's not being able to retrieve a trait ref from an impl header</p>



<a name="272417157"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272417157" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272417157">(Feb 18 2022 at 15:43)</a>:</h4>
<p>unsure why</p>



<a name="272417650"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272417650" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272417650">(Feb 18 2022 at 15:47)</a>:</h4>
<p>Even if I revert the change to <code>Infallible</code> I still get the same ICE</p>



<a name="272417730"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272417730" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272417730">(Feb 18 2022 at 15:47)</a>:</h4>
<p>You're right that I shouldn't have changed that in that test run, but it also doesn't seem to have been the cause.</p>



<a name="272420237"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272420237" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272420237">(Feb 18 2022 at 16:07)</a>:</h4>
<p>it works if you build <code>--stage 1</code>?</p>



<a name="272420266"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272420266" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272420266">(Feb 18 2022 at 16:07)</a>:</h4>
<p>I'd be surprised by that</p>



<a name="272433217"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272433217" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272433217">(Feb 18 2022 at 17:47)</a>:</h4>
<p>Two questions related to this feature <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span> </p>
<p>First, the following currently fails but with a weird message:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#![feature(trivial_bounds, with_negative_coherence)]</span><span class="w"></span>

<span class="k">use</span><span class="w"> </span>::<span class="n">core</span>::<span class="n">marker</span>::<span class="n">PhantomPinned</span><span class="p">;</span><span class="w"></span>

<span class="k">trait</span><span class="w"> </span><span class="n">Trait</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="k">enum</span> <span class="nc">Foo</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="k">impl</span><span class="w"> </span><span class="n">Trait</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Foo</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="k">impl</span><span class="w"> </span><span class="n">Trait</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Foo</span><span class="w"></span>
<span class="k">where</span><span class="w"></span>
<span class="w">    </span><span class="n">PhantomPinned</span><span class="w"> </span>: <span class="nb">Unpin</span><span class="p">,</span><span class="w"></span>
<span class="p">{}</span><span class="w"></span>
</code></pre></div>
<p>complaining about:</p>
<div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="go">9  | impl Trait for Foo</span>
<span class="go">   |      ^^^^^ cannot infer type for enum `Foo`</span>
</code></pre></div>
<ul>
<li>(trivial bounds is here to make the example simpler, but is not necessary).</li>
</ul>
<p>Also, if this were to work, I suspect it could cause problems with <code>pin_project</code>, like hinted <a href="#narrow/stream/213817-t-lang/topic/design.20meeting.3A.20backlog.20bonanza/near/269471299">over here</a></p>



<a name="272460673"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272460673" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272460673">(Feb 18 2022 at 21:35)</a>:</h4>
<p><span class="user-mention" data-user-id="211722">@Yoshua Wuyts [he/they]</span> can you open an issue with the stuff you've mentioned? so I can give it a shoot next week</p>



<a name="272460739"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272460739" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272460739">(Feb 18 2022 at 21:36)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232018">Daniel Henry-Mantilla</span> <a href="#narrow/stream/315151-wg-traits.2Fnegative-impls/topic/PR.20.2393652/near/272433217">said</a>:</p>
<blockquote>
<p>Two questions related to this feature <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span> </p>
<p>First, the following currently fails but with a weird message:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#![feature(trivial_bounds, with_negative_coherence)]</span><span class="w"></span>

<span class="k">use</span><span class="w"> </span>::<span class="n">core</span>::<span class="n">marker</span>::<span class="n">PhantomPinned</span><span class="p">;</span><span class="w"></span>

<span class="k">trait</span><span class="w"> </span><span class="n">Trait</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="k">enum</span> <span class="nc">Foo</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="k">impl</span><span class="w"> </span><span class="n">Trait</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Foo</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="k">impl</span><span class="w"> </span><span class="n">Trait</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Foo</span><span class="w"></span>
<span class="k">where</span><span class="w"></span>
<span class="w">    </span><span class="n">PhantomPinned</span><span class="w"> </span>: <span class="nb">Unpin</span><span class="p">,</span><span class="w"></span>
<span class="p">{}</span><span class="w"></span>
</code></pre></div>
<p>complaining about:</p>
<div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="go">9  | impl Trait for Foo</span>
<span class="go">   |      ^^^^^ cannot infer type for enum `Foo`</span>
</code></pre></div>
<ul>
<li>(trivial bounds is here to make the example simpler, but is not necessary).</li>
</ul>
<p>Also, if this were to work, I suspect it could cause problems with <code>pin_project</code>, like hinted <a href="#narrow/stream/213817-t-lang/topic/design.20meeting.3A.20backlog.20bonanza/near/269471299">over here</a></p>
</blockquote>
<p>same :), can you open an issue?</p>



<a name="272460745"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272460745" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272460745">(Feb 18 2022 at 21:36)</a>:</h4>
<p>please cc me</p>



<a name="272460862"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272460862" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272460862">(Feb 18 2022 at 21:37)</a>:</h4>
<p><span class="user-mention" data-user-id="232018">@Daniel Henry-Mantilla</span> I think your case is a case where the feature flag is making diagnostics regress, right?</p>



<a name="272461043"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272461043" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272461043">(Feb 18 2022 at 21:39)</a>:</h4>
<p>we could create issues here <a href="https://github.com/rust-lang/negative-impls-initiative/">https://github.com/rust-lang/negative-impls-initiative/</a></p>



<a name="272465582"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272465582" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272465582">(Feb 18 2022 at 22:16)</a>:</h4>
<p><span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> regarding the ICE here:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">impl1_trait_ref</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tcx</span><span class="p">.</span><span class="n">impl_trait_ref</span><span class="p">(</span><span class="n">impl1_def_id</span><span class="p">).</span><span class="n">unwrap</span><span class="p">()</span><span class="w"></span>
</code></pre></div>
<p>that's kind of weird. AFAIK, that thing only returns <code>None</code> for inherent impls, and this should not be an inherent impl.</p>



<a name="272466521"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272466521" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272466521">(Feb 18 2022 at 22:25)</a>:</h4>
<p>Do you have a reproduction?</p>



<a name="272484936"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272484936" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272484936">(Feb 19 2022 at 02:18)</a>:</h4>
<p><span class="user-mention silent" data-user-id="211722">Yoshua Wuyts [he/they]</span> <a href="#narrow/stream/315151-wg-traits.2Fnegative-impls/topic/PR.20.2393652/near/272412909">said</a>:</p>
<blockquote>
<p>Pushed the branch: <a href="https://github.com/yoshuawuyts/rust/tree/future-for-termination-3">https://github.com/yoshuawuyts/rust/tree/future-for-termination-3</a></p>
</blockquote>
<p>it's this <span aria-label="point up" class="emoji emoji-1f446" role="img" title="point up">:point_up:</span>, would be nice if we extract a test case for rustc</p>



<a name="272484979"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/272484979" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#272484979">(Feb 19 2022 at 02:18)</a>:</h4>
<p>didn't do that yet</p>



<a name="273824561"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/273824561" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#273824561">(Mar 02 2022 at 15:34)</a>:</h4>
<p><span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> opened an issue: <a href="https://github.com/rust-lang/rust/issues/94526">https://github.com/rust-lang/rust/issues/94526</a></p>



<a name="273826135"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315151-wg-traits/negative-impls/topic/PR%20%2393652/near/273826135" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/315151-wg-traits/negative-impls/topic/PR.20.2393652.html#273826135">(Mar 02 2022 at 15:43)</a>:</h4>
<p><span class="user-mention" data-user-id="211722">@Yoshua Wuyts [he/they]</span> <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>