<html>
<head><meta charset="utf-8"><title>transfer github issue to r-l/rust · t-infra · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/index.html">t-infra</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/transfer.20github.20issue.20to.20r-l.2Frust.html">transfer github issue to r-l/rust</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="278382440"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/transfer%20github%20issue%20to%20r-l/rust/near/278382440" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Cartwright <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/transfer.20github.20issue.20to.20r-l.2Frust.html#278382440">(Apr 09 2022 at 02:24)</a>:</h4>
<p>We received an <a href="https://github.com/rust-lang/rustfmt/issues/5303">issue report</a> in the rustfmt repo about someone experiencing a malloc-related error when running x.py, so my sense is that issue should be transferred to the r-l/rust repo by someone with access to do so</p>



<a name="278383434"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/transfer%20github%20issue%20to%20r-l/rust/near/278383434" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/transfer.20github.20issue.20to.20r-l.2Frust.html#278383434">(Apr 09 2022 at 02:48)</a>:</h4>
<p><span class="user-mention" data-user-id="320317">@Caleb Cartwright</span> this is <a href="https://github.com/rust-lang/rust-clippy/issues/8470">https://github.com/rust-lang/rust-clippy/issues/8470</a> which is unclear whether it is a tool bug or a compiler bug. It happens because the pointer is allocated by jemalloc but freed by the system allocator.</p>



<a name="278385983"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/transfer%20github%20issue%20to%20r-l/rust/near/278385983" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Cartwright <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/transfer.20github.20issue.20to.20r-l.2Frust.html#278385983">(Apr 09 2022 at 03:57)</a>:</h4>
<p>the user in the report we received mentioned they were on an M1, but it looks like an x86_64-apple-darwin artifact is being used (<code>rust/build/x86_64-apple-darwin/stage0/bin/rustfmt</code>) is that expected? i'm not a mac user myself and x.py is mostly magic to me, but should it not be an aarch64 target or something non x86?</p>



<a name="278386044"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/transfer%20github%20issue%20to%20r-l/rust/near/278386044" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/transfer.20github.20issue.20to.20r-l.2Frust.html#278386044">(Apr 09 2022 at 03:58)</a>:</h4>
<p>Not sure, but m1s can run x86 natively using hardware emulation</p>



<a name="278386054"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/transfer%20github%20issue%20to%20r-l/rust/near/278386054" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/transfer.20github.20issue.20to.20r-l.2Frust.html#278386054">(Apr 09 2022 at 03:59)</a>:</h4>
<p>So it's basically "whatever x.py detected" which is uhhh complicated</p>



<a name="278386067"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/transfer%20github%20issue%20to%20r-l/rust/near/278386067" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Cartwright <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/transfer.20github.20issue.20to.20r-l.2Frust.html#278386067">(Apr 09 2022 at 03:59)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/242791-t-infra/topic/transfer.20github.20issue.20to.20r-l.2Frust/near/278386044">said</a>:</p>
<blockquote>
<p>Not sure, but m1s can run x86 natively using hardware emulation</p>
</blockquote>
<p>i didn't realize this but makes sense. apple ecosystem probably would've broken overnight if they couldn't</p>



<a name="278386195"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/transfer%20github%20issue%20to%20r-l/rust/near/278386195" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Cartwright <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/transfer.20github.20issue.20to.20r-l.2Frust.html#278386195">(Apr 09 2022 at 04:01)</a>:</h4>
<p>i'm happy to be proven wrong, but i still feel like the issue is just surfacing in the tools as opposed to a programming error in the tools' source</p>



<a name="278386198"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/transfer%20github%20issue%20to%20r-l/rust/near/278386198" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/transfer.20github.20issue.20to.20r-l.2Frust.html#278386198">(Apr 09 2022 at 04:01)</a>:</h4>
<p><span class="user-mention" data-user-id="320317">@Caleb Cartwright</span> I would point them to <a href="https://github.com/rust-lang/rust/issues/92173">#92173</a> and close the issue.  You can recommend that they enable jemalloc in config.toml.</p>



<a name="278386203"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/transfer%20github%20issue%20to%20r-l/rust/near/278386203" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Caleb Cartwright <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/transfer.20github.20issue.20to.20r-l.2Frust.html#278386203">(Apr 09 2022 at 04:01)</a>:</h4>
<p>works for me, thank you both!</p>



<a name="278386213"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/transfer%20github%20issue%20to%20r-l/rust/near/278386213" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/transfer.20github.20issue.20to.20r-l.2Frust.html#278386213">(Apr 09 2022 at 04:01)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/242791-t-infra/topic/transfer.20github.20issue.20to.20r-l.2Frust/near/278383434">said</a>:</p>
<blockquote>
<p>It happens because the pointer is allocated by jemalloc but freed by the system allocator.</p>
</blockquote>
<p>I don't believe that is what is happening here.  jemalloc isn't being used at all.</p>



<a name="278386713"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/transfer%20github%20issue%20to%20r-l/rust/near/278386713" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/transfer.20github.20issue.20to.20r-l.2Frust.html#278386713">(Apr 09 2022 at 04:15)</a>:</h4>
<p>(M1 emulates x86 using Rosetta -- binary translation)</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>