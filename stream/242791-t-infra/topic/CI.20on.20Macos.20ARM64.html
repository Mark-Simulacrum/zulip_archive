<html>
<head><meta charset="utf-8"><title>CI on Macos ARM64 · t-infra · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/index.html">t-infra</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/CI.20on.20Macos.20ARM64.html">CI on Macos ARM64</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="250081870"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/CI%20on%20Macos%20ARM64/near/250081870" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hans Kratz <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/CI.20on.20Macos.20ARM64.html#250081870">(Aug 20 2021 at 06:11)</a>:</h4>
<p>I have been testing  a butchered Rust CI using a modified GHA Runner locally and want to share some observations in the hope that they are useful:</p>
<ul>
<li>It will likely be quite some time before there is official support in the GHA Runner for Macos ARM64, because they currently target .NET Core 3.1 and Macos ARM64 will only be supported in .NET 6.0, which is currently in preview.</li>
<li>My patchset for the GHA runner is here: <a href="https://github.com/hkratz/gha-runner-osx-arm64/pull/2">https://github.com/hkratz/gha-runner-osx-arm64/pull/2</a></li>
<li><code>x.py --stage 2 test</code> takes about 35 min. on my Macbook Air 8GB in the background while I do other light-weight stuff (w/ local sccache), see e.g. <a href="https://github.com/rusticstuff/rust/runs/3378970791?check_suite_focus=true">https://github.com/rusticstuff/rust/runs/3378970791?check_suite_focus=true</a></li>
<li>Haven't tested if running the x86_64 build and tests is faster with Rosetta than current GHA runs on GH VMs.</li>
<li>Bugs found so far through the CI: the sanitizers are not working properly on Macos ARM64 (issues <a href="https://github.com/rust-lang/rust/issues/88131">#88131</a> and <a href="https://github.com/rust-lang/rust/issues/88132">#88132</a>).</li>
<li>Macos <code>/usr/bin/tidy</code> is ancient. ;-)</li>
</ul>



<a name="250140499"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/CI%20on%20Macos%20ARM64/near/250140499" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/CI.20on.20Macos.20ARM64.html#250140499">(Aug 20 2021 at 16:27)</a>:</h4>
<blockquote>
<p>Macos /usr/bin/tidy is ancient. ;-)</p>
</blockquote>
<p>you mean for rustdoc tests? it shouldn't be strictly necessary for tests, I don't think it's installed at all on linux</p>



<a name="250157601"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/CI%20on%20Macos%20ARM64/near/250157601" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hans Kratz <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/CI.20on.20Macos.20ARM64.html#250157601">(Aug 20 2021 at 18:49)</a>:</h4>
<p>As far as I can see it is run as part of <code>HtmlCheck</code>step if <code>tidy --version</code> completes with a zero exit code: <a href="https://github.com/rust-lang/rust/blob/ad1eaffc7e24f497e969c47f400ad20ae383f9aa/src/bootstrap/test.rs#L164">https://github.com/rust-lang/rust/blob/ad1eaffc7e24f497e969c47f400ad20ae383f9aa/src/bootstrap/test.rs#L164</a>  The homebrew version works fine though.</p>



<a name="250172347"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/CI%20on%20Macos%20ARM64/near/250172347" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/CI.20on.20Macos.20ARM64.html#250172347">(Aug 20 2021 at 21:04)</a>:</h4>
<p>Oh I see, you had an old version installed already</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>