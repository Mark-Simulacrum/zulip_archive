<html>
<head><meta charset="utf-8"><title>apple jobs hanging · t-infra · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/index.html">t-infra</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/apple.20jobs.20hanging.html">apple jobs hanging</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="267758806"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/apple%20jobs%20hanging/near/267758806" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matthiaskrgr <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/apple.20jobs.20hanging.html#267758806">(Jan 12 2022 at 17:34)</a>:</h4>
<p>(no pun intended)<br>
seems like the apple runners are hanging in recent builds<br>
<a href="https://github.com/rust-lang-ci/rust/runs/4789456877?check_suite_focus=true">https://github.com/rust-lang-ci/rust/runs/4789456877?check_suite_focus=true</a><br>
<a href="https://github.com/rust-lang-ci/rust/runs/4790031583?check_suite_focus=true">https://github.com/rust-lang-ci/rust/runs/4790031583?check_suite_focus=true</a><br>
<a href="https://github.com/rust-lang-ci/rust/runs/4789456877?check_suite_focus=true">https://github.com/rust-lang-ci/rust/runs/4789456877?check_suite_focus=true</a></p>
<p>it looks like they are still running but there is no output shown <br>
Can someone please have a look at that? Thanks! &lt;3</p>



<a name="267759595"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/apple%20jobs%20hanging/near/267759595" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/apple.20jobs.20hanging.html#267759595">(Jan 12 2022 at 17:41)</a>:</h4>
<p>The apple jobs on the current PR seem fine, although it looks like dist-x86_64-msvc-alt is hung.</p>



<a name="267759954"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/apple%20jobs%20hanging/near/267759954" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matthiaskrgr <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/apple.20jobs.20hanging.html#267759954">(Jan 12 2022 at 17:43)</a>:</h4>
<p>sometimes they just don't post any logs but are still running, so it's hard to say from what I have seen :/</p>



<a name="267760159"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/apple%20jobs%20hanging/near/267760159" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/apple.20jobs.20hanging.html#267760159">(Jan 12 2022 at 17:45)</a>:</h4>
<p>that job normally finishes in 1h20m, but it has been over 3h now. from what I've seen, that means it probably isn't going to finish.</p>



<a name="267760210"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/apple%20jobs%20hanging/near/267760210" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/apple.20jobs.20hanging.html#267760210">(Jan 12 2022 at 17:45)</a>:</h4>
<p>it's really unfortunate you can't see the logs until it's done</p>



<a name="267761929"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/apple%20jobs%20hanging/near/267761929" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/apple.20jobs.20hanging.html#267761929">(Jan 12 2022 at 17:58)</a>:</h4>
<p>I went ahead and restarted it, just to avoid wasting another hour.</p>



<a name="267762013"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/apple%20jobs%20hanging/near/267762013" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matthiaskrgr <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/apple.20jobs.20hanging.html#267762013">(Jan 12 2022 at 17:59)</a>:</h4>
<p><a href="https://github.com/rust-lang-ci/rust/runs/4790664691?check_suite_focus=true#step:25:11553">https://github.com/rust-lang-ci/rust/runs/4790664691?check_suite_focus=true#step:25:11553</a></p>



<a name="267762297"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/apple%20jobs%20hanging/near/267762297" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/apple.20jobs.20hanging.html#267762297">(Jan 12 2022 at 18:00)</a>:</h4>
<p>looks like it hung while building rust_analyzer <span aria-label="frown" class="emoji emoji-1f641" role="img" title="frown">:frown:</span></p>



<a name="267762591"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/apple%20jobs%20hanging/near/267762591" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matthiaskrgr <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/apple.20jobs.20hanging.html#267762591">(Jan 12 2022 at 18:02)</a>:</h4>
<p>It might have been still running normally, sometimes jobs dont print anything until they are done, it's crazy.<br>
I also only know because <code>Hans Kratz</code> drew my attention to it :)</p>



<a name="267762728"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/apple%20jobs%20hanging/near/267762728" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matthiaskrgr <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/apple.20jobs.20hanging.html#267762728">(Jan 12 2022 at 18:03)</a>:</h4>
<p>so apparently we can't be sure if a runner is frozen or not until it reaches its final timeout and shows some logs &gt;.&lt;</p>



<a name="267762995"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/apple%20jobs%20hanging/near/267762995" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/apple.20jobs.20hanging.html#267762995">(Jan 12 2022 at 18:05)</a>:</h4>
<p>In this case, I think it was really hung because the timestamps in the log:</p>
<div class="codehilite"><pre><span></span><code>2022-01-12T15:43:29.8212114Z [RUSTC-TIMING] rust_analyzer test:false 65.062
2022-01-12T17:58:37.9676507Z ##[error]The operation was canceled.
</code></pre></div>
<p>It didn't have any output for the last 2 hours.</p>
<p>I think if a job is taking 3x longer than normal, and isn't displaying anything, it's pretty safe to say it is hung.</p>



<a name="267763001"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/apple%20jobs%20hanging/near/267763001" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/apple.20jobs.20hanging.html#267763001">(Jan 12 2022 at 18:05)</a>:</h4>
<p>We probably should have some kind of watchdog in this case.</p>



<a name="267763169"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/apple%20jobs%20hanging/near/267763169" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/apple.20jobs.20hanging.html#267763169">(Jan 12 2022 at 18:06)</a>:</h4>
<p>Travis CI would time out based on last output, but I'm pretty sure GitHub Actions are just a flat timeout from the time it starts.</p>



<a name="267763188"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/apple%20jobs%20hanging/near/267763188" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matthiaskrgr <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/apple.20jobs.20hanging.html#267763188">(Jan 12 2022 at 18:06)</a>:</h4>
<p>ooh then I take everything back :)<br>
Ididn't see you could enable timestamps :)</p>



<a name="267763334"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/apple%20jobs%20hanging/near/267763334" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matthiaskrgr <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/apple.20jobs.20hanging.html#267763334">(Jan 12 2022 at 18:07)</a>:</h4>
<p>well might be a good idea to have some kind of 30-minute output timeout given the current situation.. :/</p>



<a name="267914613"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/apple%20jobs%20hanging/near/267914613" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Poitras <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/apple.20jobs.20hanging.html#267914613">(Jan 13 2022 at 19:01)</a>:</h4>
<p>For what it's worth, I have looked at the CI from the last month, and the highest time for a PR that passed CI is around 3h30m. Failed builds can reach around 4h30. There could be an argument for a 4h cutoff (or even a 3h45m cutoff, if necessary) for manually requeuing stuff</p>



<a name="267920639"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/apple%20jobs%20hanging/near/267920639" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/apple.20jobs.20hanging.html#267920639">(Jan 13 2022 at 19:47)</a>:</h4>
<p>well... builds that invalidate caches take longer than that. they just fail after partially populating caches and then the next try passes.</p>



<a name="267920818"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/apple%20jobs%20hanging/near/267920818" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/apple.20jobs.20hanging.html#267920818">(Jan 13 2022 at 19:48)</a>:</h4>
<p>preemptive scheduling <span aria-label="grimacing" class="emoji emoji-1f62c" role="img" title="grimacing">:grimacing:</span></p>



<a name="267974861"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/apple%20jobs%20hanging/near/267974861" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matthiaskrgr <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/apple.20jobs.20hanging.html#267974861">(Jan 14 2022 at 05:45)</a>:</h4>
<p>4.5h is brutal... thats like at most 5 merges a day :/</p>



<a name="267974984"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/apple%20jobs%20hanging/near/267974984" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matthiaskrgr <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/apple.20jobs.20hanging.html#267974984">(Jan 14 2022 at 05:48)</a>:</h4>
<p>what kind of caches do we have anyway?<br>
Couldn't we use sccache for the entire first stage in theory? (i think its already used for building llvm?)</p>



<a name="267976818"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/apple%20jobs%20hanging/near/267976818" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hans Kratz <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/apple.20jobs.20hanging.html#267976818">(Jan 14 2022 at 06:29)</a>:</h4>
<p>For Apple the problem is the LLVM rebuilds IMHO. They are already cached with sccache but if the llvm submodule it bumped usually a sizable part has to be rebuilt, almost always pushing the Apple CI builds over the 4h15min homu timeout once.</p>



<a name="268086587"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/apple%20jobs%20hanging/near/268086587" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matthiaskrgr <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/apple.20jobs.20hanging.html#268086587">(Jan 14 2022 at 23:15)</a>:</h4>
<p>had look at some of the apple logs now, it seems that documentation is skipped entirely and the tools (cargo, rustfmt, clippy, rls, rla) are split into a separate builder already, we are running without pgo (so only a single llvm build), mmh :/</p>



<a name="269805233"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/apple%20jobs%20hanging/near/269805233" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/apple.20jobs.20hanging.html#269805233">(Jan 28 2022 at 21:29)</a>:</h4>
<p><span class="user-mention" data-user-id="121055">@Pietro Albini</span> r? <a href="https://github.com/rust-lang/rust/pull/93434">https://github.com/rust-lang/rust/pull/93434</a> (should be quick) to try and get CI times down</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>