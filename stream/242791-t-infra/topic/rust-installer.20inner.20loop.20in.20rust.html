<html>
<head><meta charset="utf-8"><title>rust-installer inner loop in rust · t-infra · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/index.html">t-infra</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/rust-installer.20inner.20loop.20in.20rust.html">rust-installer inner loop in rust</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="228235999"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/rust-installer%20inner%20loop%20in%20rust/near/228235999" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/rust-installer.20inner.20loop.20in.20rust.html#228235999">(Mar 01 2021 at 14:12)</a>:</h4>
<p>also while I have your attention - I'm interested in speeding up <code>rust-installer</code>, what do you think of <a href="https://github.com/rust-lang/rust/issues/80684#issuecomment-778805164">https://github.com/rust-lang/rust/issues/80684#issuecomment-778805164</a> ?</p>



<a name="228236489"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/rust-installer%20inner%20loop%20in%20rust/near/228236489" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/rust-installer.20inner.20loop.20in.20rust.html#228236489">(Mar 01 2021 at 14:15)</a>:</h4>
<p>that'd be very tricky to do in a cross-platform way</p>



<a name="228236696"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/rust-installer%20inner%20loop%20in%20rust/near/228236696" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/rust-installer.20inner.20loop.20in.20rust.html#228236696">(Mar 01 2021 at 14:16)</a>:</h4>
<p>I don't follow - haven't we already built a rust compiler at this point? Why would rust be any less cross-platform than bash?</p>



<a name="228236788"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/rust-installer%20inner%20loop%20in%20rust/near/228236788" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/rust-installer.20inner.20loop.20in.20rust.html#228236788">(Mar 01 2021 at 14:17)</a>:</h4>
<p>because for example you can install the <code>rust-std-x86_64-pc-windows-msvc.tar.xz</code> on a linux system</p>



<a name="228236815"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/rust-installer%20inner%20loop%20in%20rust/near/228236815" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/rust-installer.20inner.20loop.20in.20rust.html#228236815">(Mar 01 2021 at 14:17)</a>:</h4>
<p>for what target would that inner loop be compiled?</p>



<a name="228236834"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/rust-installer%20inner%20loop%20in%20rust/near/228236834" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/rust-installer.20inner.20loop.20in.20rust.html#228236834">(Mar 01 2021 at 14:17)</a>:</h4>
<p>the host target always</p>



<a name="228236855"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/rust-installer%20inner%20loop%20in%20rust/near/228236855" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/rust-installer.20inner.20loop.20in.20rust.html#228236855">(Mar 01 2021 at 14:17)</a>:</h4>
<p>since otherwise you can't run it <span aria-label="wink" class="emoji emoji-1f609" role="img" title="wink">:wink:</span></p>



<a name="228236902"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/rust-installer%20inner%20loop%20in%20rust/near/228236902" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/rust-installer.20inner.20loop.20in.20rust.html#228236902">(Mar 01 2021 at 14:17)</a>:</h4>
<p>you can install <code>rust-std</code> for any combination of targets</p>



<a name="228236961"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/rust-installer%20inner%20loop%20in%20rust/near/228236961" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/rust-installer.20inner.20loop.20in.20rust.html#228236961">(Mar 01 2021 at 14:18)</a>:</h4>
<p>for example if you need to cross-compile</p>



<a name="228237042"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/rust-installer%20inner%20loop%20in%20rust/near/228237042" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/rust-installer.20inner.20loop.20in.20rust.html#228237042">(Mar 01 2021 at 14:18)</a>:</h4>
<p>but rust-installer isn't distributed with the rust-std component, is it?</p>



<a name="228237062"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/rust-installer%20inner%20loop%20in%20rust/near/228237062" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/rust-installer.20inner.20loop.20in.20rust.html#228237062">(Mar 01 2021 at 14:18)</a>:</h4>
<p>I thought it's only used in-tree?</p>



<a name="228237445"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/rust-installer%20inner%20loop%20in%20rust/near/228237445" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/rust-installer.20inner.20loop.20in.20rust.html#228237445">(Mar 01 2021 at 14:20)</a>:</h4>
<p>the problem that issue raises is that the bash script contained in the tarballs, used to install the files in the proper place, is too slow</p>



<a name="228237562"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/rust-installer%20inner%20loop%20in%20rust/near/228237562" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/rust-installer.20inner.20loop.20in.20rust.html#228237562">(Mar 01 2021 at 14:21)</a>:</h4>
<p>so this affects people downloading the tarballs and installing them in their local system</p>



<a name="228237598"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/rust-installer%20inner%20loop%20in%20rust/near/228237598" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/rust-installer.20inner.20loop.20in.20rust.html#228237598">(Mar 01 2021 at 14:21)</a>:</h4>
<p>and you can install a <code>rust-std</code> tarball on any target</p>



<a name="228237712"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/rust-installer%20inner%20loop%20in%20rust/near/228237712" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/rust-installer.20inner.20loop.20in.20rust.html#228237712">(Mar 01 2021 at 14:22)</a>:</h4>
<p><span class="user-mention silent" data-user-id="121055">Pietro Albini</span> <a href="#narrow/stream/242791-t-infra/topic/rust-installer.20inner.20loop.20in.20rust/near/228237445">said</a>:</p>
<blockquote>
<p>the problem that issue raises is that the bash script contained in the tarballs, used to install the files in the proper place, is too slow</p>
</blockquote>
<p>Maybe I'm misunderstanding but that's not what I thought at all. I thought <em>packaging</em> the script into the tarball was slow</p>



<a name="228237770"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/rust-installer%20inner%20loop%20in%20rust/near/228237770" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/rust-installer.20inner.20loop.20in.20rust.html#228237770">(Mar 01 2021 at 14:22)</a>:</h4>
<p>@vext01 specifically mentions <code>x.py install</code></p>



<a name="228237955"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/rust-installer%20inner%20loop%20in%20rust/near/228237955" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/rust-installer.20inner.20loop.20in.20rust.html#228237955">(Mar 01 2021 at 14:23)</a>:</h4>
<p>yes, because <code>./x.py install</code> calls the <code>install.sh</code> script included in the tarball: <a href="https://github.com/rust-lang/rust/blob/d2731d8e9338d8fe844e19d3fbb39617753e65f4/src/bootstrap/install.rs#L20">https://github.com/rust-lang/rust/blob/d2731d8e9338d8fe844e19d3fbb39617753e65f4/src/bootstrap/install.rs#L20</a></p>



<a name="228238164"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/rust-installer%20inner%20loop%20in%20rust/near/228238164" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/rust-installer.20inner.20loop.20in.20rust.html#228238164">(Mar 01 2021 at 14:24)</a>:</h4>
<p>oh hmm ok</p>



<a name="228238208"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/rust-installer%20inner%20loop%20in%20rust/near/228238208" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/rust-installer.20inner.20loop.20in.20rust.html#228238208">(Mar 01 2021 at 14:24)</a>:</h4>
<p>then there are several things that are slow, because just the <code>Dist</code> steps take forever for me</p>



<a name="228238375"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/rust-installer%20inner%20loop%20in%20rust/near/228238375" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/rust-installer.20inner.20loop.20in.20rust.html#228238375">(Mar 01 2021 at 14:25)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/blob/d2731d8e9338d8fe844e19d3fbb39617753e65f4/src/bootstrap/tarball.rs#L285">https://github.com/rust-lang/rust/blob/d2731d8e9338d8fe844e19d3fbb39617753e65f4/src/bootstrap/tarball.rs#L285</a></p>



<a name="228238488"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/rust-installer%20inner%20loop%20in%20rust/near/228238488" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/rust-installer.20inner.20loop.20in.20rust.html#228238488">(Mar 01 2021 at 14:26)</a>:</h4>
<p>that's <a href="https://github.com/rust-lang/rust-installer/blob/master/src/tarballer.rs">https://github.com/rust-lang/rust-installer/blob/master/src/tarballer.rs</a></p>



<a name="228238549"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/rust-installer%20inner%20loop%20in%20rust/near/228238549" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/rust-installer.20inner.20loop.20in.20rust.html#228238549">(Mar 01 2021 at 14:26)</a>:</h4>
<p>I'm pretty sure it's slow because we compress with the highest quality possible</p>



<a name="228238652"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/rust-installer%20inner%20loop%20in%20rust/near/228238652" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/rust-installer.20inner.20loop.20in.20rust.html#228238652">(Mar 01 2021 at 14:27)</a>:</h4>
<p>I don't know, 204 seconds seems overkill</p>
<div class="codehilite"><pre><span></span><code>Building stage0 tool fabricate (x86_64-unknown-linux-gnu)
    Finished release [optimized] target(s) in 0.17s
Dist rustc-1.52.0-dev-src
    finished in 203.805 seconds
Dist rust-src-1.52.0-dev
    finished in 8.127 seconds
</code></pre></div>



<a name="228238685"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/rust-installer%20inner%20loop%20in%20rust/near/228238685" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/rust-installer.20inner.20loop.20in.20rust.html#228238685">(Mar 01 2021 at 14:27)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust-installer/blob/5254dbfd25d5284728ab624dca1969d61427a0db/src/compression.rs#L40-L44">https://github.com/rust-lang/rust-installer/blob/5254dbfd25d5284728ab624dca1969d61427a0db/src/compression.rs#L40-L44</a></p>



<a name="228238692"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/rust-installer%20inner%20loop%20in%20rust/near/228238692" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/rust-installer.20inner.20loop.20in.20rust.html#228238692">(Mar 01 2021 at 14:27)</a>:</h4>
<p><span class="user-mention silent" data-user-id="121055">Pietro Albini</span> <a href="#narrow/stream/242791-t-infra/topic/rust-installer.20inner.20loop.20in.20rust/near/228238549">said</a>:</p>
<blockquote>
<p>I'm pretty sure it's slow because we compress with the highest quality possible</p>
</blockquote>
<p>is there a setting to turn this down?</p>



<a name="228238788"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/rust-installer%20inner%20loop%20in%20rust/near/228238788" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/rust-installer.20inner.20loop.20in.20rust.html#228238788">(Mar 01 2021 at 14:27)</a>:</h4>
<p><span class="user-mention" data-user-id="232545">@Joshua Nelson</span> a quick thing you can do to speed it up is to set <code>dist.compression-formats = ["xz"]</code> in <code>config.toml</code></p>



<a name="228238860"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/rust-installer%20inner%20loop%20in%20rust/near/228238860" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/rust-installer.20inner.20loop.20in.20rust.html#228238860">(Mar 01 2021 at 14:28)</a>:</h4>
<p>which will skip compressing <code>.gz</code> tarballs</p>



<a name="228239092"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/rust-installer%20inner%20loop%20in%20rust/near/228239092" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/rust-installer.20inner.20loop.20in.20rust.html#228239092">(Mar 01 2021 at 14:29)</a>:</h4>
<p>I guess we could have a <code>dist.optimize-compression = "speed|size"</code> if we implement it</p>



<a name="228239255"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/rust-installer%20inner%20loop%20in%20rust/near/228239255" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/rust-installer.20inner.20loop.20in.20rust.html#228239255">(Mar 01 2021 at 14:30)</a>:</h4>
<p>let's not :)</p>



<a name="228239328"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/rust-installer%20inner%20loop%20in%20rust/near/228239328" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/rust-installer.20inner.20loop.20in.20rust.html#228239328">(Mar 01 2021 at 14:30)</a>:</h4>
<p>I think I've heard that zstd should just be all around better though on both metrics so we might go for that soon</p>



<a name="228239389"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/rust-installer%20inner%20loop%20in%20rust/near/228239389" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/rust-installer.20inner.20loop.20in.20rust.html#228239389">(Mar 01 2021 at 14:31)</a>:</h4>
<p>yes, but zstd can still become slow if you increase the compression level</p>



<a name="228239450"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/rust-installer%20inner%20loop%20in%20rust/near/228239450" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/rust-installer.20inner.20loop.20in.20rust.html#228239450">(Mar 01 2021 at 14:31)</a>:</h4>
<p>which we probably want to do in CI, as right now releases storage is forever</p>



<a name="228239530"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/rust-installer%20inner%20loop%20in%20rust/near/228239530" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/rust-installer.20inner.20loop.20in.20rust.html#228239530">(Mar 01 2021 at 14:31)</a>:</h4>
<p><code>optimize-compression = "speed|size"</code> is probably overkill unless someone works on dist code that much</p>



<a name="228239646"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/rust-installer%20inner%20loop%20in%20rust/near/228239646" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/rust-installer.20inner.20loop.20in.20rust.html#228239646">(Mar 01 2021 at 14:32)</a>:</h4>
<p><span class="user-mention silent" data-user-id="121055">Pietro Albini</span> <a href="#narrow/stream/242791-t-infra/topic/rust-installer.20inner.20loop.20in.20rust/near/228239450">said</a>:</p>
<blockquote>
<p>which we probably want to do in CI, as right now releases storage is forever</p>
</blockquote>
<p>could you only do it for releases and not normal CI artifacts?</p>



<a name="228239926"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/rust-installer%20inner%20loop%20in%20rust/near/228239926" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/rust-installer.20inner.20loop.20in.20rust.html#228239926">(Mar 01 2021 at 14:33)</a>:</h4>
<p>we don't know whether a CI artifact will become a release or not</p>



<a name="228240794"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/rust-installer%20inner%20loop%20in%20rust/near/228240794" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/rust-installer.20inner.20loop.20in.20rust.html#228240794">(Mar 01 2021 at 14:38)</a>:</h4>
<p>hmm, ok</p>



<a name="228240847"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/rust-installer%20inner%20loop%20in%20rust/near/228240847" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/rust-installer.20inner.20loop.20in.20rust.html#228240847">(Mar 01 2021 at 14:39)</a>:</h4>
<p>tangentially related: what do you think about caching dist steps? I'm running <code>distcheck</code> over and over and it's just as slow each time</p>



<a name="228240918"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/rust-installer%20inner%20loop%20in%20rust/near/228240918" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/rust-installer.20inner.20loop.20in.20rust.html#228240918">(Mar 01 2021 at 14:39)</a>:</h4>
<p>if there's a setting to just update the tarball instead of wiping it and making a new one from scratch that would be ideal</p>



<a name="228241057"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/rust-installer%20inner%20loop%20in%20rust/near/228241057" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/rust-installer.20inner.20loop.20in.20rust.html#228241057">(Mar 01 2021 at 14:40)</a>:</h4>
<p>in particular <code>rustc-dev</code> and <code>rust-dev</code> can be cached even if I make changes to bootstrap</p>



<a name="228241612"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/rust-installer%20inner%20loop%20in%20rust/near/228241612" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/rust-installer.20inner.20loop.20in.20rust.html#228241612">(Mar 01 2021 at 14:43)</a>:</h4>
<p>I don't want to add complexity if it can at all be avoided for the dist code, it's already pretty complicated and not well-tested currently beyond nightly releases, and caching sounds like it'd easily lead to pain.</p>



<a name="228241711"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/rust-installer%20inner%20loop%20in%20rust/near/228241711" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/rust-installer.20inner.20loop.20in.20rust.html#228241711">(Mar 01 2021 at 14:43)</a>:</h4>
<p>not enough people change that code that it's worth the added complexity imo of supporting patching tarballs</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>