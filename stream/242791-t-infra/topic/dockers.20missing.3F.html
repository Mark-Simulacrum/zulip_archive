<html>
<head><meta charset="utf-8"><title>dockers missing? · t-infra · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/index.html">t-infra</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html">dockers missing?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="203240339"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/dockers%20missing%3F/near/203240339" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Silverstone <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html#203240339">(Jul 08 2020 at 07:54)</a>:</h4>
<p>Hi, I'm trying to get a <code>rustup</code> release built, but some dockers are failing to fetch, such as <a href="https://github.com/rust-lang/rustup/runs/848824980">https://github.com/rust-lang/rustup/runs/848824980</a> - has something gone squiffy with those, or are they no longer supported (i.e. should I remove them from rustup releases for now?)</p>



<a name="203242180"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/dockers%20missing%3F/near/203242180" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Silverstone <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html#203242180">(Jul 08 2020 at 08:18)</a>:</h4>
<p>FYI the missing? dockers are the <code>powerpc64-unknown-linux-gnu</code>, <code>x86_64-unknown-freebsd</code>, <code>x86_64-unknown-netbsd</code>, and <code>mips64el-unknown-linux-gnuabi64</code></p>



<a name="203242749"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/dockers%20missing%3F/near/203242749" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html#203242749">(Jul 08 2020 at 08:27)</a>:</h4>
<p>well we had some docker changes</p>



<a name="203242759"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/dockers%20missing%3F/near/203242759" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html#203242759">(Jul 08 2020 at 08:27)</a>:</h4>
<p>but they shouldn't have broken you</p>



<a name="203242774"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/dockers%20missing%3F/near/203242774" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html#203242774">(Jul 08 2020 at 08:27)</a>:</h4>
<p>let me take a look at the script you're using</p>



<a name="203242881"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/dockers%20missing%3F/near/203242881" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Silverstone <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html#203242881">(Jul 08 2020 at 08:28)</a>:</h4>
<p>Thanks.  What we have worked last week when we built 1.22.0</p>



<a name="203246234"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/dockers%20missing%3F/near/203246234" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html#203246234">(Jul 08 2020 at 09:13)</a>:</h4>
<p><span class="user-mention" data-user-id="223910">@Daniel Silverstone</span> WTF</p>



<a name="203246238"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/dockers%20missing%3F/near/203246238" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html#203246238">(Jul 08 2020 at 09:13)</a>:</h4>
<div class="codehilite"><pre><span></span><code>bash ci/fetch-rust-docker.bash powerpc64-unknown-linux-gnu
</code></pre></div>



<a name="203246243"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/dockers%20missing%3F/near/203246243" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html#203246243">(Jul 08 2020 at 09:13)</a>:</h4>
<p>it works locally</p>



<a name="203246280"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/dockers%20missing%3F/near/203246280" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Silverstone <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html#203246280">(Jul 08 2020 at 09:13)</a>:</h4>
<p>Could it be a strange docker proxy in github actions or something?</p>



<a name="203246324"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/dockers%20missing%3F/near/203246324" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html#203246324">(Jul 08 2020 at 09:14)</a>:</h4>
<p>it shouldn't</p>



<a name="203246328"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/dockers%20missing%3F/near/203246328" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html#203246328">(Jul 08 2020 at 09:14)</a>:</h4>
<p>...try starting it again?</p>



<a name="203246340"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/dockers%20missing%3F/near/203246340" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Silverstone <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html#203246340">(Jul 08 2020 at 09:14)</a>:</h4>
<p>I've done it a number of times, but I'll try now again.</p>



<a name="203247553"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/dockers%20missing%3F/near/203247553" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html#203247553">(Jul 08 2020 at 09:32)</a>:</h4>
<p>ok I can repro it locally with mips64el-unknown-linux-gnuabi64</p>



<a name="203247555"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/dockers%20missing%3F/near/203247555" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html#203247555">(Jul 08 2020 at 09:32)</a>:</h4>
<p>wut</p>



<a name="203247903"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/dockers%20missing%3F/near/203247903" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Silverstone <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html#203247903">(Jul 08 2020 at 09:37)</a>:</h4>
<p>I'm glad you can reproduce, but sad it's broken.</p>



<a name="203248141"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/dockers%20missing%3F/near/203248141" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html#203248141">(Jul 08 2020 at 09:40)</a>:</h4>
<p><a href="/user_uploads/4715/_7Q60I9aLhjeJzNTz8wdvu5e/2020-07-08-11-40-39.png">2020-07-08-11-40-39.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/_7Q60I9aLhjeJzNTz8wdvu5e/2020-07-08-11-40-39.png" title="2020-07-08-11-40-39.png"><img src="/user_uploads/4715/_7Q60I9aLhjeJzNTz8wdvu5e/2020-07-08-11-40-39.png"></a></div>



<a name="203248155"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/dockers%20missing%3F/near/203248155" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html#203248155">(Jul 08 2020 at 09:40)</a>:</h4>
<p>CI said it built the image d348b6</p>



<a name="203248173"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/dockers%20missing%3F/near/203248173" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Silverstone <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html#203248173">(Jul 08 2020 at 09:41)</a>:</h4>
<p>Hmm missing an intermediate layer on the server?</p>



<a name="203248179"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/dockers%20missing%3F/near/203248179" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html#203248179">(Jul 08 2020 at 09:41)</a>:</h4>
<p>but the hash it included in <a href="https://ci-artifacts.rust-lang.org/rustc-builds/8ac1525e091d3db28e67adcbbd6db1e1deaa37fb/image-dist-mips64el-linux.txt">https://ci-artifacts.rust-lang.org/rustc-builds/8ac1525e091d3db28e67adcbbd6db1e1deaa37fb/image-dist-mips64el-linux.txt</a> is different</p>



<a name="203248215"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/dockers%20missing%3F/near/203248215" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html#203248215">(Jul 08 2020 at 09:41)</a>:</h4>
<p><span class="user-mention" data-user-id="223910">@Daniel Silverstone</span> nope that layer is downloaded by rustup's script</p>



<a name="203248278"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/dockers%20missing%3F/near/203248278" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Silverstone <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html#203248278">(Jul 08 2020 at 09:42)</a>:</h4>
<p>Urgh</p>



<a name="203248308"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/dockers%20missing%3F/near/203248308" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html#203248308">(Jul 08 2020 at 09:43)</a>:</h4>
<p>wtf no I was looking at the wrong commit</p>



<a name="203248565"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/dockers%20missing%3F/near/203248565" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html#203248565">(Jul 08 2020 at 09:46)</a>:</h4>
<p>...oh</p>



<a name="203248576"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/dockers%20missing%3F/near/203248576" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html#203248576">(Jul 08 2020 at 09:47)</a>:</h4>
<p>one sec</p>



<a name="203249969"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/dockers%20missing%3F/near/203249969" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html#203249969">(Jul 08 2020 at 10:05)</a>:</h4>
<p><span class="user-mention" data-user-id="223910">@Daniel Silverstone</span> can you start another build in like 5 minutes?</p>



<a name="203250045"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/dockers%20missing%3F/near/203250045" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html#203250045">(Jul 08 2020 at 10:06)</a>:</h4>
<p>so, today around midnight utc for some reason the container image was rebuilt, but the "rust ci caching hash" stayed the same</p>



<a name="203250086"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/dockers%20missing%3F/near/203250086" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html#203250086">(Jul 08 2020 at 10:06)</a>:</h4>
<p>my current theory is the CDN cached the old image, so you were looking for the new layers in the old cache</p>



<a name="203250099"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/dockers%20missing%3F/near/203250099" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html#203250099">(Jul 08 2020 at 10:07)</a>:</h4>
<p>I started a CDN invalidation of all <a href="http://ci-caches.rust-lang.org">ci-caches.rust-lang.org</a></p>



<a name="203250122"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/dockers%20missing%3F/near/203250122" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html#203250122">(Jul 08 2020 at 10:07)</a>:</h4>
<p>ok no tested locally and it still doesn't work</p>



<a name="203250127"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/dockers%20missing%3F/near/203250127" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html#203250127">(Jul 08 2020 at 10:07)</a>:</h4>
<p>#!@</p>



<a name="203250203"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/dockers%20missing%3F/near/203250203" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Silverstone <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html#203250203">(Jul 08 2020 at 10:08)</a>:</h4>
<p>Oh dear.</p>



<a name="203250771"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/dockers%20missing%3F/near/203250771" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html#203250771">(Jul 08 2020 at 10:15)</a>:</h4>
<p>ok I found what's wrong</p>



<a name="203250779"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/dockers%20missing%3F/near/203250779" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html#203250779">(Jul 08 2020 at 10:15)</a>:</h4>
<p><span class="user-mention" data-user-id="223910">@Daniel Silverstone</span> hardcode <code>6de63b2d8084123ff1471f5cf1c89f77b362427b</code> as the hash for now</p>



<a name="203250790"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/dockers%20missing%3F/near/203250790" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html#203250790">(Jul 08 2020 at 10:15)</a>:</h4>
<p>it will get fixed once the next PR lands on master</p>



<a name="203250798"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/dockers%20missing%3F/near/203250798" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html#203250798">(Jul 08 2020 at 10:15)</a>:</h4>
<p>*as the rustc commit</p>



<a name="203250910"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/dockers%20missing%3F/near/203250910" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html#203250910">(Jul 08 2020 at 10:17)</a>:</h4>
<p>so, the script rustup uses to fetch the docker images is a bit brittle, and doesn't handle when a <em>single</em> build succeedes but the merge as a whole fails</p>



<a name="203250935"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/dockers%20missing%3F/near/203250935" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Silverstone <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html#203250935">(Jul 08 2020 at 10:17)</a>:</h4>
<p>Are we thinking a PR might hit rustc master in the next few hours?  I'm going to be unavailable until about 1400UYC, so if so, we can wait then we can do it that way.</p>



<a name="203250952"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/dockers%20missing%3F/near/203250952" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Silverstone <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html#203250952">(Jul 08 2020 at 10:17)</a>:</h4>
<p>Making the script more robust would be good if there's a way to do that?</p>



<a name="203251074"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/dockers%20missing%3F/near/203251074" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html#203251074">(Jul 08 2020 at 10:18)</a>:</h4>
<p>what happened today is, <code>8ac1525e</code> is the latest build on master, but the next tested PR <code>6de63b2d</code> changed the container image and uploaded it</p>



<a name="203251093"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/dockers%20missing%3F/near/203251093" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html#203251093">(Jul 08 2020 at 10:18)</a>:</h4>
<p>but <code>6de63b2d</code> was never merged to master</p>



<a name="203251119"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/dockers%20missing%3F/near/203251119" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html#203251119">(Jul 08 2020 at 10:19)</a>:</h4>
<p>so your script was fetching the metadata for the wrong commit</p>



<a name="203251146"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/dockers%20missing%3F/near/203251146" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html#203251146">(Jul 08 2020 at 10:19)</a>:</h4>
<p><span class="user-mention silent" data-user-id="223910">Daniel Silverstone</span> <a href="#narrow/stream/242791-t-infra/topic/dockers.20missing.3F/near/203250935">said</a>:</p>
<blockquote>
<p>Are we thinking a PR might hit rustc master in the next few hours?  I'm going to be unavailable until about 1400UYC, so if so, we can wait then we can do it that way.</p>
</blockquote>
<p>it's CI, dunno <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="203251238"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/dockers%20missing%3F/near/203251238" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Silverstone <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html#203251238">(Jul 08 2020 at 10:20)</a>:</h4>
<p>So PRs upload dockers?  That feels dangerous.</p>



<a name="203251251"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/dockers%20missing%3F/near/203251251" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html#203251251">(Jul 08 2020 at 10:20)</a>:</h4>
<p>no, the next auto build</p>



<a name="203251261"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/dockers%20missing%3F/near/203251261" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Silverstone <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html#203251261">(Jul 08 2020 at 10:20)</a>:</h4>
<p>Oh phew</p>



<a name="203251270"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/dockers%20missing%3F/near/203251270" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html#203251270">(Jul 08 2020 at 10:21)</a>:</h4>
<p>but that auto build failed, so it was not merged on master</p>



<a name="203251292"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/dockers%20missing%3F/near/203251292" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html#203251292">(Jul 08 2020 at 10:21)</a>:</h4>
<p><span class="user-mention silent" data-user-id="223910">Daniel Silverstone</span> <a href="#narrow/stream/242791-t-infra/topic/dockers.20missing.3F/near/203250952">said</a>:</p>
<blockquote>
<p>Making the script more robust would be good if there's a way to do that?</p>
</blockquote>
<p><em>maybe</em> by extracting rustc's hash calculation into a standalone script and changing rustup's script to clone rustc and calling the script inside the rustc clone</p>



<a name="203251318"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/dockers%20missing%3F/near/203251318" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html#203251318">(Jul 08 2020 at 10:21)</a>:</h4>
<p>but that might lead to the wrong hash being produced if the environment is not exactly the same as rustc's CI</p>



<a name="203251385"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/dockers%20missing%3F/near/203251385" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html#203251385">(Jul 08 2020 at 10:22)</a>:</h4>
<p>I guess another option is to stop uploading the <code>image-FOO.txt</code> in <code>rustc-builds/SHA/</code> and upload them in <code>docker/</code></p>



<a name="203251413"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/dockers%20missing%3F/near/203251413" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html#203251413">(Jul 08 2020 at 10:22)</a>:</h4>
<p>which is probably more robust in general</p>



<a name="203252847"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/dockers%20missing%3F/near/203252847" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Silverstone <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html#203252847">(Jul 08 2020 at 10:41)</a>:</h4>
<p>Okay, so I'll hardcode <code>6de63b2d8084123ff1471f5cf1c89f77b362427b</code> and push a stable build in the meantime</p>



<a name="203253291"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/dockers%20missing%3F/near/203253291" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Silverstone <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html#203253291">(Jul 08 2020 at 10:47)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Temporary override</span>
<span class="c1"># master=$(git ls-remote &quot;$RUST_REPO&quot; refs/heads/master | cut -f1)</span>
<span class="nv">master</span><span class="o">=</span><span class="s2">&quot;6de63b2d8084123ff1471f5cf1c89f77b362427b&quot;</span>
</code></pre></div>


<p>Does that look right?</p>



<a name="203253306"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/dockers%20missing%3F/near/203253306" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Silverstone <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html#203253306">(Jul 08 2020 at 10:47)</a>:</h4>
<p>(in fetch-rust-docker.bash)</p>



<a name="203253769"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/dockers%20missing%3F/near/203253769" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Silverstone <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html#203253769">(Jul 08 2020 at 10:53)</a>:</h4>
<p>Apart from my shellcheck complaining now (which I don't care about) I think that's allowing the build to proceed.</p>



<a name="203254302"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/dockers%20missing%3F/near/203254302" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html#203254302">(Jul 08 2020 at 11:00)</a>:</h4>
<p>yeah</p>



<a name="203281018"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/dockers%20missing%3F/near/203281018" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Silverstone <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html#203281018">(Jul 08 2020 at 15:22)</a>:</h4>
<p>Has anything landed which would mean I can drop that temporary commit from rustup?</p>



<a name="203284367"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/dockers%20missing%3F/near/203284367" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html#203284367">(Jul 08 2020 at 15:47)</a>:</h4>
<p><span class="user-mention" data-user-id="223910">@Daniel Silverstone</span> it should be fixed!</p>



<a name="203285072"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/dockers%20missing%3F/near/203285072" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Silverstone <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html#203285072">(Jul 08 2020 at 15:52)</a>:</h4>
<p>Cool, when I update master in a bit, I'll not update with that commit then.</p>



<a name="203285086"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/dockers%20missing%3F/near/203285086" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Silverstone <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/dockers.20missing.3F.html#203285086">(Jul 08 2020 at 15:52)</a>:</h4>
<p>Or rather, I'll revert it too.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>