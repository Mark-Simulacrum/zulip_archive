<html>
<head><meta charset="utf-8"><title>zlib dependency (and subsequent NixOS breakage) · t-infra · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rust-lang.github.io/zulip_archive/stream/242791-t-infra/index.html">t-infra</a></h2>
<h3>Topic: <a href="https://rust-lang.github.io/zulip_archive/stream/242791-t-infra/topic/zlib.20dependency.20(and.20subsequent.20NixOS.20breakage).html">zlib dependency (and subsequent NixOS breakage)</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://rust-lang.github.io/zulip_archive/style.css" rel="stylesheet"></head>

<a name="204182332"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20dependency%20%28and%20subsequent%20NixOS%20breakage%29/near/204182332" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/242791-t-infra/topic/zlib.20dependency.20(and.20subsequent.20NixOS.20breakage).html#204182332">(Jul 17 2020 at 08:33)</a>:</h4>
<p>not sure this is the right place, but while the newly added system zlib dependency was on my radar, I'd forgotten about it and then beta promotion happened and broke at least NixOS builds <a href="https://github.com/rust-lang/rust/pull/74395#issuecomment-659957208">https://github.com/rust-lang/rust/pull/74395#issuecomment-659957208</a></p>



<a name="204182344"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20dependency%20%28and%20subsequent%20NixOS%20breakage%29/near/204182344" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/242791-t-infra/topic/zlib.20dependency.20(and.20subsequent.20NixOS.20breakage).html#204182344">(Jul 17 2020 at 08:33)</a>:</h4>
<p>(which we could've seen coming, ofc)</p>



<a name="204182414"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20dependency%20%28and%20subsequent%20NixOS%20breakage%29/near/204182414" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/242791-t-infra/topic/zlib.20dependency.20(and.20subsequent.20NixOS.20breakage).html#204182414">(Jul 17 2020 at 08:34)</a>:</h4>
<p>is there an issue for tracking removing the system dependency on beta? (by static linking presumably)</p>



<a name="204182425"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20dependency%20%28and%20subsequent%20NixOS%20breakage%29/near/204182425" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/242791-t-infra/topic/zlib.20dependency.20(and.20subsequent.20NixOS.20breakage).html#204182425">(Jul 17 2020 at 08:34)</a>:</h4>
<p>I saw it discussed on that PR (mostly CI-related details) but nothing else</p>



<a name="204182455"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20dependency%20%28and%20subsequent%20NixOS%20breakage%29/near/204182455" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/242791-t-infra/topic/zlib.20dependency.20(and.20subsequent.20NixOS.20breakage).html#204182455">(Jul 17 2020 at 08:35)</a>:</h4>
<p>also maybe NixOS CI would be overkill but it would catch some changes in system requirements, especially if using <code>nix-shell --pure</code></p>



<a name="204182485"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20dependency%20%28and%20subsequent%20NixOS%20breakage%29/near/204182485" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/242791-t-infra/topic/zlib.20dependency.20(and.20subsequent.20NixOS.20breakage).html#204182485">(Jul 17 2020 at 08:35)</a>:</h4>
<p>(you start with an unusable system, maybe some coreutils and a shell, but you have to list every other dependency you need yourself)</p>



<a name="204184646"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20dependency%20%28and%20subsequent%20NixOS%20breakage%29/near/204184646" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/242791-t-infra/topic/zlib.20dependency.20(and.20subsequent.20NixOS.20breakage).html#204184646">(Jul 17 2020 at 09:00)</a>:</h4>
<p>(I believe <span class="user-mention silent" data-user-id="119009">eddyb</span> , <span class="user-mention silent" data-user-id="124288">oli</span>, <span class="user-mention silent" data-user-id="123586">nagisa</span>, <span class="user-mention silent" data-user-id="133169">matklad</span>  and myself are NixOS users, IIRC - maybe <span class="user-mention silent" data-user-id="211727">Jonas Schievink</span> too who mentioned NixOS earlier in the thread)</p>



<a name="204185453"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20dependency%20%28and%20subsequent%20NixOS%20breakage%29/near/204185453" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/242791-t-infra/topic/zlib.20dependency.20(and.20subsequent.20NixOS.20breakage).html#204185453">(Jul 17 2020 at 09:09)</a>:</h4>
<p><span class="user-mention silent" data-user-id="119009">eddyb</span> <a href="#narrow/stream/242791-t-infra/topic/zlib.20dependency/near/204182414">said</a>:</p>
<blockquote>
<p>is there an issue for tracking removing the system dependency on beta? (by static linking presumably)</p>
</blockquote>
<p>Found <a href="https://github.com/rust-lang/rust/issues/74420">#74420</a></p>



<a name="204204367"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20dependency%20%28and%20subsequent%20NixOS%20breakage%29/near/204204367" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://rust-lang.github.io/zulip_archive/stream/242791-t-infra/topic/zlib.20dependency.20(and.20subsequent.20NixOS.20breakage).html#204204367">(Jul 17 2020 at 13:18)</a>:</h4>
<p>Hmm, maybe <em>that</em> explains why I had to add <code>-lz</code> for the macOS ARM cross-compile builds.</p>



<a name="204204435"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20dependency%20%28and%20subsequent%20NixOS%20breakage%29/near/204204435" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/242791-t-infra/topic/zlib.20dependency.20(and.20subsequent.20NixOS.20breakage).html#204204435">(Jul 17 2020 at 13:19)</a>:</h4>
<p>almost certainly :P</p>



<a name="204204450"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20dependency%20%28and%20subsequent%20NixOS%20breakage%29/near/204204450" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/242791-t-infra/topic/zlib.20dependency.20(and.20subsequent.20NixOS.20breakage).html#204204450">(Jul 17 2020 at 13:19)</a>:</h4>
<p>okay I think I have a NixOS fix, moment of truth :D</p>



<a name="204205016"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20dependency%20%28and%20subsequent%20NixOS%20breakage%29/near/204205016" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/242791-t-infra/topic/zlib.20dependency.20(and.20subsequent.20NixOS.20breakage).html#204205016">(Jul 17 2020 at 13:24)</a>:</h4>
<p>(yes it works :D. and I fixed another longstanding bug in the process)</p>



<a name="204207352"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20dependency%20%28and%20subsequent%20NixOS%20breakage%29/near/204207352" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/242791-t-infra/topic/zlib.20dependency.20(and.20subsequent.20NixOS.20breakage).html#204207352">(Jul 17 2020 at 13:46)</a>:</h4>
<p>here we go: <a href="https://github.com/rust-lang/rust/issues/74441">#74441</a></p>



<a name="204207516"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20dependency%20%28and%20subsequent%20NixOS%20breakage%29/near/204207516" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://rust-lang.github.io/zulip_archive/stream/242791-t-infra/topic/zlib.20dependency.20(and.20subsequent.20NixOS.20breakage).html#204207516">(Jul 17 2020 at 13:47)</a>:</h4>
<p>Oh, it's only a nix fix</p>



<a name="204207659"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20dependency%20%28and%20subsequent%20NixOS%20breakage%29/near/204207659" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://rust-lang.github.io/zulip_archive/stream/242791-t-infra/topic/zlib.20dependency.20(and.20subsequent.20NixOS.20breakage).html#204207659">(Jul 17 2020 at 13:48)</a>:</h4>
<p>I was hoping for a magic "fix everything" <span aria-label="wink" class="emoji emoji-1f609" role="img" title="wink">:wink:</span></p>



<a name="204208071"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20dependency%20%28and%20subsequent%20NixOS%20breakage%29/near/204208071" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/242791-t-infra/topic/zlib.20dependency.20(and.20subsequent.20NixOS.20breakage).html#204208071">(Jul 17 2020 at 13:52)</a>:</h4>
<p>This is the third Nix-related fix for this (addition of zlib) that I've seen - <a href="https://github.com/NixOS/nixpkgs/issues/91327">NixOS/nixpkgs#91327</a> and <a class="stream-topic" data-stream-id="217417" href="/#narrow/stream/217417-t-compiler.2Fcargo-bisect-rustc/topic/nixos.20support">#t-compiler/cargo-bisect-rustc &gt; nixos support</a>.</p>



<a name="204209393"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20dependency%20%28and%20subsequent%20NixOS%20breakage%29/near/204209393" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/242791-t-infra/topic/zlib.20dependency.20(and.20subsequent.20NixOS.20breakage).html#204209393">(Jul 17 2020 at 14:03)</a>:</h4>
<p><span class="user-mention" data-user-id="116155">@Jake Goulding</span> well it's not <em>broken</em> on other platforms</p>



<a name="204209561"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20dependency%20%28and%20subsequent%20NixOS%20breakage%29/near/204209561" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/242791-t-infra/topic/zlib.20dependency.20(and.20subsequent.20NixOS.20breakage).html#204209561">(Jul 17 2020 at 14:05)</a>:</h4>
<p>on NixOS the downloaded beta just doesn't run because of the <code>libz.so</code> dependency, even if e.g. linking zlib during the build works fine</p>



<a name="204209821"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20dependency%20%28and%20subsequent%20NixOS%20breakage%29/near/204209821" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://rust-lang.github.io/zulip_archive/stream/242791-t-infra/topic/zlib.20dependency.20(and.20subsequent.20NixOS.20breakage).html#204209821">(Jul 17 2020 at 14:07)</a>:</h4>
<p><span class="user-mention" data-user-id="119009">@eddyb</span> you are correct as usual. I apologize.</p>



<a name="204209952"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20dependency%20%28and%20subsequent%20NixOS%20breakage%29/near/204209952" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/242791-t-infra/topic/zlib.20dependency.20(and.20subsequent.20NixOS.20breakage).html#204209952">(Jul 17 2020 at 14:08)</a>:</h4>
<p>sorry q_q</p>



<a name="204210390"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20dependency%20%28and%20subsequent%20NixOS%20breakage%29/near/204210390" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/242791-t-infra/topic/zlib.20dependency.20(and.20subsequent.20NixOS.20breakage).html#204210390">(Jul 17 2020 at 14:12)</a>:</h4>
<p>what I mean is that only NixOS people stopped being able to build Rust as of today. for everyone else this is more of an suboptimal situation, although I guess there may be non-linux UNIX platforms where it's a problem</p>



<a name="204210493"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20dependency%20%28and%20subsequent%20NixOS%20breakage%29/near/204210493" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/242791-t-infra/topic/zlib.20dependency.20(and.20subsequent.20NixOS.20breakage).html#204210493">(Jul 17 2020 at 14:13)</a>:</h4>
<p><span class="user-mention" data-user-id="119009">@eddyb</span> does your PR only run on NixOS or will it fail for people w/out <code>nix-build</code> locally?</p>



<a name="204210517"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20dependency%20%28and%20subsequent%20NixOS%20breakage%29/near/204210517" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/242791-t-infra/topic/zlib.20dependency.20(and.20subsequent.20NixOS.20breakage).html#204210517">(Jul 17 2020 at 14:13)</a>:</h4>
<p>Oh, GitHub had collapsed that part of the source.</p>



<a name="204210522"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20dependency%20%28and%20subsequent%20NixOS%20breakage%29/near/204210522" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/242791-t-infra/topic/zlib.20dependency.20(and.20subsequent.20NixOS.20breakage).html#204210522">(Jul 17 2020 at 14:13)</a>:</h4>
<p>Nevermind.</p>



<a name="204210535"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20dependency%20%28and%20subsequent%20NixOS%20breakage%29/near/204210535" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/242791-t-infra/topic/zlib.20dependency.20(and.20subsequent.20NixOS.20breakage).html#204210535">(Jul 17 2020 at 14:14)</a>:</h4>
<p>what's the usecase you're thinking of?</p>



<a name="204210583"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20dependency%20%28and%20subsequent%20NixOS%20breakage%29/near/204210583" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/242791-t-infra/topic/zlib.20dependency.20(and.20subsequent.20NixOS.20breakage).html#204210583">(Jul 17 2020 at 14:14)</a>:</h4>
<p>that function early-exits if <code>/lib</code> exists</p>



<a name="204210591"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20dependency%20%28and%20subsequent%20NixOS%20breakage%29/near/204210591" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/242791-t-infra/topic/zlib.20dependency.20(and.20subsequent.20NixOS.20breakage).html#204210591">(Jul 17 2020 at 14:14)</a>:</h4>
<p>Just checking it wasn't going to fail for everyone but us.</p>



<a name="204210615"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20dependency%20%28and%20subsequent%20NixOS%20breakage%29/near/204210615" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/242791-t-infra/topic/zlib.20dependency.20(and.20subsequent.20NixOS.20breakage).html#204210615">(Jul 17 2020 at 14:14)</a>:</h4>
<p>ah no I didn't change the preconditions</p>



<a name="204210631"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20dependency%20%28and%20subsequent%20NixOS%20breakage%29/near/204210631" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/242791-t-infra/topic/zlib.20dependency.20(and.20subsequent.20NixOS.20breakage).html#204210631">(Jul 17 2020 at 14:14)</a>:</h4>
<p>Yeah, I just hadn't seen those because of the way GitHub collapsed it</p>



<a name="204210633"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20dependency%20%28and%20subsequent%20NixOS%20breakage%29/near/204210633" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/242791-t-infra/topic/zlib.20dependency.20(and.20subsequent.20NixOS.20breakage).html#204210633">(Jul 17 2020 at 14:14)</a>:</h4>
<p>it will run <code>nix-build</code> when it would've ran <code>patchelf</code> before</p>



<a name="204210663"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20dependency%20%28and%20subsequent%20NixOS%20breakage%29/near/204210663" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/242791-t-infra/topic/zlib.20dependency.20(and.20subsequent.20NixOS.20breakage).html#204210663">(Jul 17 2020 at 14:14)</a>:</h4>
<p>note that <code>patchelf</code> isn't even "installed by default" on NixOS lol</p>



<a name="204210694"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20dependency%20%28and%20subsequent%20NixOS%20breakage%29/near/204210694" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/242791-t-infra/topic/zlib.20dependency.20(and.20subsequent.20NixOS.20breakage).html#204210694">(Jul 17 2020 at 14:15)</a>:</h4>
<p>it's more of a build tool than dev tool</p>



<a name="204210751"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20dependency%20%28and%20subsequent%20NixOS%20breakage%29/near/204210751" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/242791-t-infra/topic/zlib.20dependency.20(and.20subsequent.20NixOS.20breakage).html#204210751">(Jul 17 2020 at 14:15)</a>:</h4>
<p><span class="user-mention" data-user-id="116107">@davidtwco</span> also all the command execution failures are just warnings and the patching is skipped</p>



<a name="204210896"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20dependency%20%28and%20subsequent%20NixOS%20breakage%29/near/204210896" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://rust-lang.github.io/zulip_archive/stream/242791-t-infra/topic/zlib.20dependency.20(and.20subsequent.20NixOS.20breakage).html#204210896">(Jul 17 2020 at 14:16)</a>:</h4>
<p><span class="user-mention silent" data-user-id="119009">eddyb</span> <a href="#narrow/stream/242791-t-infra/topic/zlib.20dependency.20breaks.20NixOS/near/204210390">said</a>:</p>
<blockquote>
<p>what I mean is that only NixOS people stopped being able to build Rust as of today. for everyone else this is more of an suboptimal situation, although I guess there may be non-linux UNIX platforms where it's a problem</p>
</blockquote>
<p>Based on the thread title, I thought this was more general, thus why I thought that my feedback would be relevant. I've changed the title to be more specific to the discussion.</p>



<a name="204211335"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20dependency%20%28and%20subsequent%20NixOS%20breakage%29/near/204211335" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/242791-t-infra/topic/zlib.20dependency.20(and.20subsequent.20NixOS.20breakage).html#204211335">(Jul 17 2020 at 14:21)</a>:</h4>
<p><span class="user-mention" data-user-id="116155">@Jake Goulding</span> that's my fault, I started the thread about the zlib dependency in general (hence the title not mentioning NixOS) then said a bunch of things about NixOS</p>



<a name="204211469"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20dependency%20%28and%20subsequent%20NixOS%20breakage%29/near/204211469" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/242791-t-infra/topic/zlib.20dependency.20(and.20subsequent.20NixOS.20breakage).html#204211469">(Jul 17 2020 at 14:22)</a>:</h4>
<p><span class="user-mention silent" data-user-id="119009">eddyb</span> <a href="#narrow/stream/242791-t-infra/topic/zlib.20dependency.20breaks.20NixOS/near/204204450">said</a>:</p>
<blockquote>
<p>okay I think I have a NixOS fix, moment of truth :D</p>
</blockquote>
<p>I did say it was a NixOS fix tho :P</p>



<a name="204211487"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20dependency%20%28and%20subsequent%20NixOS%20breakage%29/near/204211487" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/242791-t-infra/topic/zlib.20dependency.20(and.20subsequent.20NixOS.20breakage).html#204211487">(Jul 17 2020 at 14:22)</a>:</h4>
<p>anyway ideally we'd just remove the dependency by static linking</p>



<a name="204211538"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20dependency%20%28and%20subsequent%20NixOS%20breakage%29/near/204211538" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/242791-t-infra/topic/zlib.20dependency.20(and.20subsequent.20NixOS.20breakage).html#204211538">(Jul 17 2020 at 14:22)</a>:</h4>
<p>NixOS is just the canary in the coalmine (no good design goes unpunished...)</p>



<a name="204211595"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20dependency%20%28and%20subsequent%20NixOS%20breakage%29/near/204211595" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://rust-lang.github.io/zulip_archive/stream/242791-t-infra/topic/zlib.20dependency.20(and.20subsequent.20NixOS.20breakage).html#204211595">(Jul 17 2020 at 14:23)</a>:</h4>
<p>A fix for a problem experienced on NixOS doesn't mean that that it's a fix for <em>only</em> NixOS, as you say yourself:</p>
<blockquote>
<p>we'd just remove the dependency by static linking</p>
</blockquote>
<p>If someone statically linked it, then your problem would be fixed.</p>



<a name="204211831"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20dependency%20%28and%20subsequent%20NixOS%20breakage%29/near/204211831" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://rust-lang.github.io/zulip_archive/stream/242791-t-infra/topic/zlib.20dependency.20(and.20subsequent.20NixOS.20breakage).html#204211831">(Jul 17 2020 at 14:25)</a>:</h4>
<p>So I clicked the link, saw it wasn't, and reported that back here in case anyone else happened to be confused in the same manner I was. I'm aware that it's unlikely that anyone would make the same level of basic literacy mistakes as I do, but I figured it was worth a shot. I'll try to avoid wasting your time in similar fashion in the future.</p>



<a name="204211836"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20dependency%20%28and%20subsequent%20NixOS%20breakage%29/near/204211836" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/242791-t-infra/topic/zlib.20dependency.20(and.20subsequent.20NixOS.20breakage).html#204211836">(Jul 17 2020 at 14:25)</a>:</h4>
<p>well it's a NixOS fix, not a fix that happens to also help NixOS. not to mention that I can't exactly fix the static linking thing myself, given that it requires releasing a new beta :P</p>



<hr><p>Last updated: Aug 07 2021 at 22:04 UTC</p>
</html>