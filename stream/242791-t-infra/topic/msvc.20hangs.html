<html>
<head><meta charset="utf-8"><title>msvc hangs · t-infra · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/index.html">t-infra</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc.20hangs.html">msvc hangs</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="270913905"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%20hangs/near/270913905" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matthiaskrgr <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc.20hangs.html#270913905">(Feb 06 2022 at 21:52)</a>:</h4>
<p>Hi, does it make sense to nominate this for the next infra meeting?<br>
<a href="https://github.com/rust-lang/rust/issues/93329">https://github.com/rust-lang/rust/issues/93329</a><br>
We've had a  bunch of msvc hangs on ci (they always seem to happen while building the <code>rustc_macros</code> crate), maybe someone has an idea what could be going on there. :)</p>



<a name="270914173"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%20hangs/near/270914173" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc.20hangs.html#270914173">(Feb 06 2022 at 21:58)</a>:</h4>
<p>you can add t-infra + i-nominated and it will be picked up at the meeting tomorrow</p>



<a name="270915653"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%20hangs/near/270915653" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matthiaskrgr <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc.20hangs.html#270915653">(Feb 06 2022 at 22:30)</a>:</h4>
<p>will do, thanks!</p>



<a name="271019934"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%20hangs/near/271019934" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc.20hangs.html#271019934">(Feb 07 2022 at 18:15)</a>:</h4>
<p>I've tried to reproduce it locally without any luck. <span aria-label="frown" class="emoji emoji-1f641" role="img" title="frown">:frown:</span>  Running <code>x.py test --stage=2 compiler/rustc_macros ; ./x.py clean</code> in a loop for several hours with the same config as CI.  The only other idea I have is to try to debug within GitHub Actions, but that can be quite challenging.</p>



<a name="271020098"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%20hangs/near/271020098" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc.20hangs.html#271020098">(Feb 07 2022 at 18:16)</a>:</h4>
<p>How long do these tests typically take on other builders? Is there a chance this is just GitHub hanging but our builders actually doing fine (i.e., unrelated to this specific compilation) - do we see other similar hang/timeouts elsewhere?</p>



<a name="271020524"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%20hangs/near/271020524" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc.20hangs.html#271020524">(Feb 07 2022 at 18:20)</a>:</h4>
<p>You mean compiling and running the rustc_macros test?  I think it's on the order of 10 seconds or so.</p>



<a name="271020610"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%20hangs/near/271020610" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc.20hangs.html#271020610">(Feb 07 2022 at 18:20)</a>:</h4>
<p>I think all the other hangs we've seen have been resolved, this is the only one I'm aware of that is consistently happening right now.</p>



<a name="271020852"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%20hangs/near/271020852" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc.20hangs.html#271020852">(Feb 07 2022 at 18:22)</a>:</h4>
<p>I was hoping the LLVM crash dialog fix in <a href="https://github.com/rust-lang/rust/issues/93402">#93402</a> would have illuminated this issue, but that PR ran into this very same problem.</p>
<p>(It also hit a hang in compiletest, but I haven't seen that since the readdir issue.)</p>



<a name="271021637"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%20hangs/near/271021637" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc.20hangs.html#271021637">(Feb 07 2022 at 18:28)</a>:</h4>
<p>@matthiaskrgr It looks like there have been a large number of errors recently with <code>rustdoc-gui</code> tests failing. Is there an issue for that? Is the rustdoc team aware that is happening?</p>



<a name="271022907"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%20hangs/near/271022907" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc.20hangs.html#271022907">(Feb 07 2022 at 18:37)</a>:</h4>
<p><span class="user-mention" data-user-id="217864">@matthiaskrgr</span> ^ (looks like it didn't linkify/ping in your message)</p>



<a name="271022943"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%20hangs/near/271022943" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc.20hangs.html#271022943">(Feb 07 2022 at 18:37)</a>:</h4>
<p>Given that there are tests in rustc_macros I'm tempted to not ignore them</p>



<a name="271023182"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%20hangs/near/271023182" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matthiaskrgr <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc.20hangs.html#271023182">(Feb 07 2022 at 18:39)</a>:</h4>
<p><span class="user-mention" data-user-id="120518">@Eric Huss</span>  i don't think there is an issue for that</p>



<a name="271023278"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%20hangs/near/271023278" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matthiaskrgr <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc.20hangs.html#271023278">(Feb 07 2022 at 18:40)</a>:</h4>
<p>but I'm also not <span aria-label="100" class="emoji emoji-1f4af" role="img" title="100">:100:</span> sure what you mean</p>



<a name="271023310"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%20hangs/near/271023310" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matthiaskrgr <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc.20hangs.html#271023310">(Feb 07 2022 at 18:40)</a>:</h4>
<p><span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="271023464"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%20hangs/near/271023464" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc.20hangs.html#271023464">(Feb 07 2022 at 18:41)</a>:</h4>
<div class="codehilite"><pre><span></span><code>2022-02-07T13:28:49.5981337Z Testing rustc_macros stage1 (x86_64-pc-windows-msvc -&gt; x86_64-pc-windows-msvc)
2022-02-07T13:28:50.1790881Z [RUSTC-TIMING] build_script_build test:false 0.681
2022-02-07T13:28:50.1791355Z [RUSTC-TIMING] unicode_xid test:false 0.156
2022-02-07T13:28:50.1792067Z [RUSTC-TIMING] build_script_build test:false 0.591
2022-02-07T13:28:50.1794322Z [RUSTC-TIMING] proc_macro2 test:false 1.752
2022-02-07T13:28:50.1795355Z [RUSTC-TIMING] quote test:false 0.747
2022-02-07T13:28:50.1796347Z [RUSTC-TIMING] syn test:false 12.510
2022-02-07T13:28:50.1797353Z [RUSTC-TIMING] synstructure test:false 1.972
2022-02-07T13:28:50.1798371Z [RUSTC-TIMING] rustc_macros test:false 4.130
2022-02-07T13:28:50.1800148Z [0m[0m[1m[32m   Compiling[0m rustc_macros v0.1.0 (D:\a\rust\rust\compiler\rustc_macros)
2022-02-07T13:28:57.1538353Z [RUSTC-TIMING] rustc_macros test:true 6.966
2022-02-07T13:28:57.1586216Z [0m[0m[1m[32m    Finished[0m release [optimized] target(s) in 7.54s
2022-02-07T13:28:57.1662601Z [0m[0m[1m[32m     Running[0m unittests (build\x86_64-pc-windows-msvc\stage1-rustc\release\deps\rustc_macros-f5834e6eecb3f7e7.exe)
2022-02-07T13:28:57.1761117Z
2022-02-07T13:28:57.1761567Z running 5 tests
2022-02-07T13:28:57.1809935Z test symbols::tests::check_dup_symbol ... ok
2022-02-07T13:28:57.1810317Z test symbols::tests::check_dup_keywords ... ok
2022-02-07T13:28:57.1810681Z test symbols::tests::check_dup_symbol_and_keyword ... ok
2022-02-07T13:28:57.1811026Z test symbols::tests::check_symbol_order ... ok
2022-02-07T13:28:57.4308113Z test symbols::tests::test_symbols ... ok
2022-02-07T13:28:57.4308364Z
2022-02-07T13:28:57.4308631Z test result: ok. 5 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.25s
2022-02-07T13:28:57.4308964Z
2022-02-07T13:28:57.4331582Z [0m[0m[1m[32m   Doc-tests[0m rustc_macros
2022-02-07T13:28:57.7894201Z
2022-02-07T13:28:57.7894696Z running 4 tests
2022-02-07T13:28:57.7928794Z test src\session_diagnostic.rs - session_diagnostic::SessionDiagnosticDeriveBuilder::build_format (line 564) ... ignored
2022-02-07T13:28:57.7929576Z test src\session_diagnostic.rs - session_diagnostic::SessionDiagnosticDeriveBuilder::build_format (line 573) ... ignored
2022-02-07T13:28:57.7930207Z test src\session_diagnostic.rs - session_diagnostic::session_diagnostic_derive (line 10) ... ignored
2022-02-07T13:28:57.7930807Z test src\session_diagnostic.rs - session_diagnostic::session_diagnostic_derive (line 33) ... ignored
2022-02-07T13:28:57.7931112Z
2022-02-07T13:28:57.7931385Z test result: ok. 0 passed; 0 failed; 4 ignored; 0 measured; 0 filtered out; finished in 0.00s
2022-02-07T13:28:57.7931671Z
2022-02-07T13:28:57.8078023Z    finished in 8.209 seconds
2022-02-07T13:28:57.8078702Z [TIMING] Crate { compiler: Compiler { stage: 2, host: TargetSelection { triple: &quot;x86_64-pc-windows-msvc&quot;, file: None } }, target: TargetSelection { triple: &quot;x86_64-pc-windows-msvc&quot;, file: None }, mode: Rustc, test_kind: Test, krate: &quot;rustc_macros&quot; } -- 8.211
</code></pre></div>
<p>so it looks like it does take a bit of time to build, but tests themselves are fast</p>



<a name="271023708"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%20hangs/near/271023708" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc.20hangs.html#271023708">(Feb 07 2022 at 18:43)</a>:</h4>
<p>we could try to detect this particular compilation in CI and get a backtrace perhaps?</p>



<a name="271023710"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%20hangs/near/271023710" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc.20hangs.html#271023710">(Feb 07 2022 at 18:43)</a>:</h4>
<p>7s seems pretty fast to me?</p>



<a name="271023722"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%20hangs/near/271023722" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc.20hangs.html#271023722">(Feb 07 2022 at 18:44)</a>:</h4>
<p>yeah, sure, I just mean not instant</p>



<a name="271023800"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%20hangs/near/271023800" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc.20hangs.html#271023800">(Feb 07 2022 at 18:44)</a>:</h4>
<p>What do you think about adding a timeout/watchdog to rustbuild?</p>



<a name="271023828"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%20hangs/near/271023828" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc.20hangs.html#271023828">(Feb 07 2022 at 18:44)</a>:</h4>
<p>yeah, I was just thinking about that</p>



<a name="271023843"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%20hangs/near/271023843" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc.20hangs.html#271023843">(Feb 07 2022 at 18:44)</a>:</h4>
<p>it's not out of the question -- I'd like to do something more useful than just abort</p>



<a name="271023903"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%20hangs/near/271023903" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc.20hangs.html#271023903">(Feb 07 2022 at 18:45)</a>:</h4>
<p>how easy is it to get a backtrace from a child process? Is there a way to do that without killing it maybe?</p>



<a name="271024364"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%20hangs/near/271024364" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc.20hangs.html#271024364">(Feb 07 2022 at 18:48)</a>:</h4>
<p>I'm not sure.  One way would be to use gdb maybe?</p>



<a name="271024491"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%20hangs/near/271024491" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc.20hangs.html#271024491">(Feb 07 2022 at 18:49)</a>:</h4>
<p>One option that might be a little easier is to detect CI and run with RUSTC_LOG=info or -Ztime-passes or something</p>



<a name="271035027"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%20hangs/near/271035027" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc.20hangs.html#271035027">(Feb 07 2022 at 20:08)</a>:</h4>
<blockquote>
<p>how easy is it to get a backtrace from a child process? Is there a way to do that without killing it maybe?</p>
</blockquote>
<p><code>eu-stack -p &lt;pid&gt;</code> gives symbols at least. gdb in batch mode should work too.</p>



<a name="271037475"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%20hangs/near/271037475" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc.20hangs.html#271037475">(Feb 07 2022 at 20:28)</a>:</h4>
<p>Unfortunately this is msvc, which I think makes things harder. Also, rustbuild only knows about the cargo process. It would need to do something like walk the process tree to find <code>rustc</code> (assuming it is not cargo that is hung), which I'm not sure how easy that is to do on windows.  </p>
<p>Wish it was feasible to use something like rdp.</p>



<a name="271038557"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%20hangs/near/271038557" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc.20hangs.html#271038557">(Feb 07 2022 at 20:38)</a>:</h4>
<p>windows has ssh these days. maybe install the component and keep the runner running on error? do they have public IPs</p>



<a name="271038649"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%20hangs/near/271038649" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc.20hangs.html#271038649">(Feb 07 2022 at 20:38)</a>:</h4>
<p><a href="https://github.com/marketplace/actions/debugging-with-ssh">https://github.com/marketplace/actions/debugging-with-ssh</a></p>
<blockquote>
<p>Windows is not supported.</p>
</blockquote>
<p>Heh.</p>



<a name="271038705"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%20hangs/near/271038705" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc.20hangs.html#271038705">(Feb 07 2022 at 20:39)</a>:</h4>
<p>Yea, there is no public access.</p>



<a name="271038740"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%20hangs/near/271038740" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc.20hangs.html#271038740">(Feb 07 2022 at 20:39)</a>:</h4>
<p>All of these remote access services seem sketchy to me.</p>



<a name="271038914"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%20hangs/near/271038914" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc.20hangs.html#271038914">(Feb 07 2022 at 20:41)</a>:</h4>
<p>I've even noticed some have been shut down by GitHub for violating terms.</p>



<a name="271038965"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%20hangs/near/271038965" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc.20hangs.html#271038965">(Feb 07 2022 at 20:41)</a>:</h4>
<p>Another option would be establishing an outgoing ssh session to a trusted machine and then tunneling a session in reverse over it.</p>



<a name="271039025"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%20hangs/near/271039025" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc.20hangs.html#271039025">(Feb 07 2022 at 20:42)</a>:</h4>
<p>But if GH doesn't like runners being kept alive then that would be an issue. Or is it just the 3rd party services?</p>



<a name="271039232"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%20hangs/near/271039232" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc.20hangs.html#271039232">(Feb 07 2022 at 20:44)</a>:</h4>
<p>great QoL feature: <a href="https://drewdevault.com/2019/08/19/Introducing-shell-access-for-builds.html">https://drewdevault.com/2019/08/19/Introducing-shell-access-for-builds.html</a></p>



<a name="271039447"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%20hangs/near/271039447" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc.20hangs.html#271039447">(Feb 07 2022 at 20:46)</a>:</h4>
<p>I'm not sure.  GitHub seems generally pretty generous with what they allow.</p>



<a name="271039494"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%20hangs/near/271039494" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc.20hangs.html#271039494">(Feb 07 2022 at 20:47)</a>:</h4>
<p>Travis had ssh access, too.  But it wasn't secure (it printed the access key in the logs).</p>



<a name="271058573"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%20hangs/near/271058573" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc.20hangs.html#271058573">(Feb 07 2022 at 23:25)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116122">simulacrum</span> <a href="#narrow/stream/242791-t-infra/topic/msvc.20hangs/near/271023903">said</a>:</p>
<blockquote>
<p>how easy is it to get a backtrace from a child process? Is there a way to do that without killing it maybe?</p>
</blockquote>
<p>If you can find the PID, you should be able to attach cdb (the command line Windows debugger), dump a backtrace of all threads and detach without killing the process. </p>
<p><a href="https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/cdb-command-line-options">https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/cdb-command-line-options</a></p>



<a name="271062082"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%20hangs/near/271062082" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc.20hangs.html#271062082">(Feb 08 2022 at 00:03)</a>:</h4>
<p>Ok, then I think we should probably get the code for that in bootstrap/bin/rustc.rs and in CI always start dumping backtraces if we're running &gt;600 seconds or so, every second (as a start).</p>
<p>I can take a stab at an initial impl, though debugging will probably be a bit hard without a windows machine (maybe I can figure out a vm...).</p>



<a name="271137650"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%20hangs/near/271137650" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc.20hangs.html#271137650">(Feb 08 2022 at 14:43)</a>:</h4>
<p>Trying with a random (Edge) process on my machine, it looks like this command does what we want:</p>
<div class="codehilite"><pre><span></span><code>PS C:\Users\wesleywiser&gt; &amp; &#39;C:\Program Files (x86)\Windows Kits\10\Debuggers\x64\cdb.exe&#39; -c &quot;~*k;qd&quot; -p 22156
</code></pre></div>
<div class="spoiler-block"><div class="spoiler-header">
<p>output</p>
</div><div class="spoiler-content" aria-hidden="true">
<p>Microsoft (R) Windows Debugger Version 10.0.22000.1 AMD64<br>
Copyright (c) Microsoft Corporation. All rights reserved.</p>
<p>*** wait with pending attach</p>
<p><strong>*</strong><strong>*</strong><strong>* Path validation summary </strong><strong>*</strong><strong>*</strong>**<br>
Response                         Time (ms)     Location<br>
Deferred                                       srv*<br>
Symbol search path is: srv*<br>
Executable search path is:<br>
ModLoad: 00007ff6<code>bba20000 00007ff6</code>bbd93000   C:\Program Files (x86)\Microsoft\Edge\Application\msedge.exe<br>
ModLoad: 00007fff<code>71ec0000 00007fff</code>720c7000   C:\WINDOWS\SYSTEM32\ntdll.dll<br>
ModLoad: 00007fff<code>70860000 00007fff</code>7091d000   C:\WINDOWS\System32\KERNEL32.DLL<br>
{more of this omitted}<br>
(568c.3a0c): Break instruction exception - code 80000003 (first chance)<br>
ntdll!DbgBreakPoint:<br>
00007fff`71f66f70 cc              int     3<br>
0:008&gt; cdb: Reading initial command '~*k;qd'</p>
<p>0  Id: 568c.5944 Suspend: 1 Teb: 0000001f<code>398da000 Unfrozen "CrUtilityMain"
Child-SP          RetAddr               Call Site
0000001f</code>3a1fe858 00007fff<code>6f9b2a4e     ntdll!ZwWaitForSingleObject+0x14
0000001f</code>3a1fe860 00007fff<code>01f20c3e     KERNELBASE!WaitForSingleObjectEx+0x8e
0000001f</code>3a1fe900 00007fff<code>03296255     msedge!base::WaitableEvent::TimedWait+0x25e
0000001f</code>3a1fea60 00007fff<code>01d9f2ec     msedge!base::MessagePumpDefault::Run+0xc5
0000001f</code>3a1feb10 00007fff<code>03fb1cc3     msedge!base::sequence_manager::internal::ThreadControllerWithMessagePumpImpl::Run+0xec
0000001f</code>3a1feb80 00007fff<code>024a2da2     msedge!base::RunLoop::Run+0xc3
0000001f</code>3a1fec60 00007fff<code>03df0a1f     msedge!content::UtilityMain+0x7b2
0000001f</code>3a1fef80 00007fff<code>03fb4b4a     msedge!content::RunOtherNamedProcessTypeMain+0x126
0000001f</code>3a1ff090 00007fff<code>03faf811     msedge!content::ContentMainRunnerImpl::Run+0x15a
0000001f</code>3a1ff1b0 00007fff<code>05162244     msedge!content::RunContentProcess+0x141
0000001f</code>3a1ff3e0 00007fff<code>051a245f     msedge!content::ContentMain+0x4c
0000001f</code>3a1ff460 00007ff6<code>bbb4e4f6     msedge!ChromeMain+0x23f
0000001f</code>3a1ff620 00007ff6<code>bba71733     msedge_exe!MainDllLoader::Launch+0x17c
0000001f</code>3a1ff830 00007ff6<code>bbaff782     msedge_exe!wWinMain+0x1337
0000001f</code>3a1ffd00 00007fff<code>708754e0     msedge_exe!__scrt_common_main_seh+0x106
0000001f</code>3a1ffd40 00007fff<code>71ec485b     KERNEL32!BaseThreadInitThunk+0x10
0000001f</code>3a1ffd70 00000000`00000000     ntdll!RtlUserThreadStart+0x2b</p>
<p>1  Id: 568c.1238 Suspend: 1 Teb: 0000001f<code>398dc000 Unfrozen "LoaderLockSampler"
Child-SP          RetAddr               Call Site
0000001f</code>3a9ff328 00007fff<code>6f9b2a4e     ntdll!ZwWaitForSingleObject+0x14
0000001f</code>3a9ff330 00007fff<code>0384c4a5     KERNELBASE!WaitForSingleObjectEx+0x8e
0000001f</code>3a9ff3d0 00007fff<code>03296281     msedge!base::WaitableEvent::Wait+0x185
0000001f</code>3a9ff520 00007fff<code>01d9f2ec     msedge!base::MessagePumpDefault::Run+0xf1
0000001f</code>3a9ff5d0 00007fff<code>03fb1cc3     msedge!base::sequence_manager::internal::ThreadControllerWithMessagePumpImpl::Run+0xec
0000001f</code>3a9ff640 00007fff<code>048625b4     msedge!base::RunLoop::Run+0xc3
0000001f</code>3a9ff720 00007fff<code>03fb0be5     msedge!base::Thread::Run+0x44
0000001f</code>3a9ff780 00007fff<code>03b42259     msedge!base::Thread::ThreadMain+0x125
0000001f</code>3a9ff810 00007fff<code>708754e0     msedge!base::</code>anonymous namespace'::ThreadFunc+0x189<br>
0000001f<code>3a9ff8b0 00007fff</code>71ec485b     KERNEL32!BaseThreadInitThunk+0x10<br>
0000001f<code>3a9ff8e0 00000000</code>00000000     ntdll!RtlUserThreadStart+0x2b</p>
<p>2  Id: 568c.5c40 Suspend: 1 Teb: 0000001f<code>398de000 Unfrozen "ThreadPoolServiceThread"
Child-SP          RetAddr               Call Site
0000001f</code>3b1ff1e8 00007fff<code>6f9b2a4e     ntdll!ZwWaitForSingleObject+0x14
0000001f</code>3b1ff1f0 00007fff<code>0384c4a5     KERNELBASE!WaitForSingleObjectEx+0x8e
0000001f</code>3b1ff290 00007fff<code>03296281     msedge!base::WaitableEvent::Wait+0x185
0000001f</code>3b1ff3e0 00007fff<code>01d9f2ec     msedge!base::MessagePumpDefault::Run+0xf1
0000001f</code>3b1ff490 00007fff<code>03fb1cc3     msedge!base::sequence_manager::internal::ThreadControllerWithMessagePumpImpl::Run+0xec
0000001f</code>3b1ff500 00007fff<code>048625b4     msedge!base::RunLoop::Run+0xc3
0000001f</code>3b1ff5e0 00007fff<code>04862548     msedge!base::Thread::Run+0x44
0000001f</code>3b1ff640 00007fff<code>03fb0be5     msedge!base::internal::ServiceThread::Run+0x18
0000001f</code>3b1ff680 00007fff<code>03b42259     msedge!base::Thread::ThreadMain+0x125
0000001f</code>3b1ff710 00007fff<code>708754e0     msedge!base::</code>anonymous namespace'::ThreadFunc+0x189<br>
0000001f<code>3b1ff7b0 00007fff</code>71ec485b     KERNEL32!BaseThreadInitThunk+0x10<br>
0000001f<code>3b1ff7e0 00000000</code>00000000     ntdll!RtlUserThreadStart+0x2b</p>
<p>3  Id: 568c.634 Suspend: 1 Teb: 0000001f<code>398e0000 Unfrozen "ThreadPoolForegroundWorker"
Child-SP          RetAddr               Call Site
0000001f</code>3b9ff448 00007fff<code>6f9b2a4e     ntdll!ZwWaitForSingleObject+0x14
0000001f</code>3b9ff450 00007fff<code>01f20c3e     KERNELBASE!WaitForSingleObjectEx+0x8e
0000001f</code>3b9ff4f0 00007fff<code>030ac296     msedge!base::WaitableEvent::TimedWait+0x25e
0000001f</code>3b9ff650 00007fff<code>01ef1f2e     msedge!base::internal::WorkerThread::Delegate::WaitForWork+0x106
0000001f</code>3b9ff6a0 00007fff<code>049c6838     msedge!base::internal::WorkerThread::RunWorker+0x3fe
0000001f</code>3b9ff7f0 00007fff<code>03b42259     msedge!base::internal::WorkerThread::RunPooledWorker+0x18
0000001f</code>3b9ff830 00007fff<code>708754e0     msedge!base::</code>anonymous namespace'::ThreadFunc+0x189<br>
0000001f<code>3b9ff8d0 00007fff</code>71ec485b     KERNEL32!BaseThreadInitThunk+0x10<br>
0000001f<code>3b9ff900 00000000</code>00000000     ntdll!RtlUserThreadStart+0x2b</p>
<p>4  Id: 568c.3574 Suspend: 1 Teb: 0000001f<code>398e2000 Unfrozen "ThreadPoolBackgroundWorker"
Child-SP          RetAddr               Call Site
0000001f</code>3c1ff348 00007fff<code>6f9b2a4e     ntdll!ZwWaitForSingleObject+0x14
0000001f</code>3c1ff350 00007fff<code>01f20c3e     KERNELBASE!WaitForSingleObjectEx+0x8e
0000001f</code>3c1ff3f0 00007fff<code>030ac296     msedge!base::WaitableEvent::TimedWait+0x25e
0000001f</code>3c1ff550 00007fff<code>01ef1f2e     msedge!base::internal::WorkerThread::Delegate::WaitForWork+0x106
0000001f</code>3c1ff5a0 00007fff<code>049c6878     msedge!base::internal::WorkerThread::RunWorker+0x3fe
0000001f</code>3c1ff6f0 00007fff<code>03b42259     msedge!base::internal::WorkerThread::RunBackgroundPooledWorker+0x18
0000001f</code>3c1ff730 00007fff<code>708754e0     msedge!base::</code>anonymous namespace'::ThreadFunc+0x189<br>
0000001f<code>3c1ff7d0 00007fff</code>71ec485b     KERNEL32!BaseThreadInitThunk+0x10<br>
0000001f<code>3c1ff800 00000000</code>00000000     ntdll!RtlUserThreadStart+0x2b</p>
<p>5  Id: 568c.1f40 Suspend: 1 Teb: 0000001f<code>398e4000 Unfrozen "Chrome_ChildIOThread"
Child-SP          RetAddr               Call Site
0000001f</code>3c9ff058 00007fff<code>6f9c0a33     ntdll!ZwRemoveIoCompletion+0x14
0000001f</code>3c9ff060 00007fff<code>030b2c36     KERNELBASE!GetQueuedCompletionStatus+0x53
0000001f</code>3c9ff0c0 00007fff<code>030b10f0     msedge!base::MessagePumpForIO::WaitForWork+0x136
0000001f</code>3c9ff380 00007fff<code>03fd4dc1     msedge!base::MessagePumpForIO::DoRunLoop+0x100
0000001f</code>3c9ff6e0 00007fff<code>01d9f2ec     msedge!base::MessagePumpWin::Run+0x71
0000001f</code>3c9ff740 00007fff<code>03fb1cc3     msedge!base::sequence_manager::internal::ThreadControllerWithMessagePumpImpl::Run+0xec
0000001f</code>3c9ff7b0 00007fff<code>048625b4     msedge!base::RunLoop::Run+0xc3
0000001f</code>3c9ff890 00007fff<code>03fb0be5     msedge!base::Thread::Run+0x44
0000001f</code>3c9ff8f0 00007fff<code>03b42259     msedge!base::Thread::ThreadMain+0x125
0000001f</code>3c9ff980 00007fff<code>708754e0     msedge!base::</code>anonymous namespace'::ThreadFunc+0x189<br>
0000001f<code>3c9ffa20 00007fff</code>71ec485b     KERNEL32!BaseThreadInitThunk+0x10<br>
0000001f<code>3c9ffa50 00000000</code>00000000     ntdll!RtlUserThreadStart+0x2b</p>
<p>6  Id: 568c.35a0 Suspend: 1 Teb: 0000001f<code>398ea000 Unfrozen "MemoryInfra"
Child-SP          RetAddr               Call Site
0000001f</code>3d1ff218 00007fff<code>6f9b2a4e     ntdll!ZwWaitForSingleObject+0x14
0000001f</code>3d1ff220 00007fff<code>0384c4a5     KERNELBASE!WaitForSingleObjectEx+0x8e
0000001f</code>3d1ff2c0 00007fff<code>03296281     msedge!base::WaitableEvent::Wait+0x185
0000001f</code>3d1ff410 00007fff<code>01d9f2ec     msedge!base::MessagePumpDefault::Run+0xf1
0000001f</code>3d1ff4c0 00007fff<code>03fb1cc3     msedge!base::sequence_manager::internal::ThreadControllerWithMessagePumpImpl::Run+0xec
0000001f</code>3d1ff530 00007fff<code>048625b4     msedge!base::RunLoop::Run+0xc3
0000001f</code>3d1ff610 00007fff<code>03fb0be5     msedge!base::Thread::Run+0x44
0000001f</code>3d1ff670 00007fff<code>03b42259     msedge!base::Thread::ThreadMain+0x125
0000001f</code>3d1ff700 00007fff<code>708754e0     msedge!base::</code>anonymous namespace'::ThreadFunc+0x189<br>
0000001f<code>3d1ff7a0 00007fff</code>71ec485b     KERNEL32!BaseThreadInitThunk+0x10<br>
0000001f<code>3d1ff7d0 00000000</code>00000000     ntdll!RtlUserThreadStart+0x2b</p>
<p>7  Id: 568c.623c Suspend: 1 Teb: 0000001f<code>398f0000 Unfrozen "ThreadPoolForegroundWorker"
Child-SP          RetAddr               Call Site
0000001f</code>3d9ff7a8 00007fff<code>6f9b2a4e     ntdll!ZwWaitForSingleObject+0x14
0000001f</code>3d9ff7b0 00007fff<code>01f20c3e     KERNELBASE!WaitForSingleObjectEx+0x8e
0000001f</code>3d9ff850 00007fff<code>030ac296     msedge!base::WaitableEvent::TimedWait+0x25e
0000001f</code>3d9ff9b0 00007fff<code>01ef1c4b     msedge!base::internal::WorkerThread::Delegate::WaitForWork+0x106
0000001f</code>3d9ffa00 00007fff<code>049c6838     msedge!base::internal::WorkerThread::RunWorker+0x11b
0000001f</code>3d9ffb50 00007fff<code>03b42259     msedge!base::internal::WorkerThread::RunPooledWorker+0x18
0000001f</code>3d9ffb90 00007fff<code>708754e0     msedge!base::</code>anonymous namespace'::ThreadFunc+0x189<br>
0000001f<code>3d9ffc30 00007fff</code>71ec485b     KERNEL32!BaseThreadInitThunk+0x10<br>
0000001f<code>3d9ffc60 00000000</code>00000000     ntdll!RtlUserThreadStart+0x2b</p>
<h1>8  Id: 568c.3a0c Suspend: 1 Teb: 0000001f`398f2000 Unfrozen</h1>
<p>Child-SP          RetAddr               Call Site<br>
0000001f<code>3e1ffc48 00007fff</code>71f980fe     ntdll!DbgBreakPoint<br>
0000001f<code>3e1ffc50 00007fff</code>708754e0     ntdll!DbgUiRemoteBreakin+0x4e<br>
0000001f<code>3e1ffc80 00007fff</code>71ec485b     KERNEL32!BaseThreadInitThunk+0x10<br>
0000001f<code>3e1ffcb0 00000000</code>00000000     ntdll!RtlUserThreadStart+0x2b<br>
quit:</p>
</div></div>



<a name="271198133"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%20hangs/near/271198133" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc.20hangs.html#271198133">(Feb 08 2022 at 22:05)</a>:</h4>
<p><span class="user-mention" data-user-id="116122">@simulacrum</span> Any objection if I run some tests on the <code>rust-lang/rust</code> repo using windows-latest-xl to try to investigate this?</p>



<a name="271198144"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%20hangs/near/271198144" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc.20hangs.html#271198144">(Feb 08 2022 at 22:05)</a>:</h4>
<p>no, should be fine</p>



<a name="271198193"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%20hangs/near/271198193" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc.20hangs.html#271198193">(Feb 08 2022 at 22:06)</a>:</h4>
<p>Builds using my personal account take way too long.</p>



<a name="272055234"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%20hangs/near/272055234" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc.20hangs.html#272055234">(Feb 15 2022 at 23:56)</a>:</h4>
<p>I'm not having much luck reproducing.  Other than <a href="https://github.com/rust-lang/rust/blob/09cb29c64c2a0e15debf2d6fca2bc7c71a682033/src/ci/run.sh#L46-L48">this <code>isCiBranch</code> check</a>, can anyone think of anything that is special about <code>auto</code> builds?  </p>
<p>I'm working under the assumption that the <code>windows-latest-xl</code> runners are from the same pool on rust-lang vs rust-lang-ci.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>