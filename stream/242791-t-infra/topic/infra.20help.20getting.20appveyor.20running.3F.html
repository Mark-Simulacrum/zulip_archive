<html>
<head><meta charset="utf-8"><title>infra help getting appveyor running? · t-infra · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/index.html">t-infra</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html">infra help getting appveyor running?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="207054085"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207054085" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207054085">(Aug 16 2020 at 04:21)</a>:</h4>
<p>I'd like to get appveyor running on <a href="https://github.com/rust-lang/libz-sys">https://github.com/rust-lang/libz-sys</a>, and it doesn't currently appear to be. (I don't think it's been working since the repository was moved from <a href="https://github.com/alexcrichton/libz-sys">https://github.com/alexcrichton/libz-sys</a> .)</p>



<a name="207054571"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207054571" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207054571">(Aug 16 2020 at 04:36)</a>:</h4>
<p>This topic was moved here from <a class="stream-topic" data-stream-id="217588" href="/#narrow/stream/217588-project-leads-.28public.29/topic/infra.20help.20getting.20appveyor.20running.3F">#project leads (public) &gt; infra help getting appveyor running?</a> by <span class="user-mention silent" data-user-id="239881">Josh Triplett</span></p>



<a name="207054592"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207054592" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207054592">(Aug 16 2020 at 04:37)</a>:</h4>
<p>The project has an <code>appveyor.yml</code> already, but appveyor doesn't check each commit or PR.</p>



<a name="207055345"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207055345" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207055345">(Aug 16 2020 at 05:01)</a>:</h4>
<p>(Separate from that, I'd certainly welcome PRs switching away from appveyor to the preferred Windows CI solution, but for now, there's a working appveyor configuration I'd like to use.)</p>



<a name="207061394"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207061394" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> XAMPPRocky <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207061394">(Aug 16 2020 at 08:24)</a>:</h4>
<p><span class="user-mention" data-user-id="239881">@Josh Triplett</span> I can write a PR switching to GitHub actions.</p>



<a name="207075005"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207075005" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> XAMPPRocky <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207075005">(Aug 16 2020 at 15:05)</a>:</h4>
<p><a href="https://github.com/rust-lang/libz-sys/pull/67">https://github.com/rust-lang/libz-sys/pull/67</a></p>



<a name="207076831"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207076831" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207076831">(Aug 16 2020 at 15:55)</a>:</h4>
<p>Thanks! That will need some tweaking, because the vcpkg stuff is supposed to be a different variant in the matrix for Windows, tested separately from the non-vcpkg case.</p>



<a name="207076836"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207076836" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207076836">(Aug 16 2020 at 15:55)</a>:</h4>
<p>But that looks great, thank you!</p>



<a name="207076844"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207076844" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207076844">(Aug 16 2020 at 15:55)</a>:</h4>
<p>Also, the failure on Windows is legitimate.</p>



<a name="207076889"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207076889" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207076889">(Aug 16 2020 at 15:56)</a>:</h4>
<p>That's why I needed to CI working for windows, and why I'm glad I didn't ship a release until then.</p>



<a name="207080008"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207080008" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> XAMPPRocky <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207080008">(Aug 16 2020 at 17:20)</a>:</h4>
<p>Yeah, I wanted to make sure MSVC worked before adding variants.  <span class="user-mention" data-user-id="239881">@Josh Triplett</span> Let me know once it's fixed and I can update the PR.</p>



<a name="207080020"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207080020" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207080020">(Aug 16 2020 at 17:21)</a>:</h4>
<p><span class="user-mention" data-user-id="219696">@XAMPPRocky</span> Will do, and thanks! Shouldn't take long...</p>



<a name="207084116"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207084116" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207084116">(Aug 16 2020 at 18:56)</a>:</h4>
<p>Currently awaiting the fix in <a href="https://github.com/zlib-ng/zlib-ng/pull/721">https://github.com/zlib-ng/zlib-ng/pull/721</a></p>



<a name="207084761"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207084761" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mati865 <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207084761">(Aug 16 2020 at 19:06)</a>:</h4>
<p>The need for that fix looks unfortunate. IIUC since Windows is LLP64 that PR will reduce input and output files to 4 GiB.</p>



<a name="207084858"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207084858" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207084858">(Aug 16 2020 at 19:08)</a>:</h4>
<p><span class="user-mention" data-user-id="119581">@mati865</span> It is unfortunate, but it's part of the zlib ABI.</p>



<a name="207084949"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207084949" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mati865 <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207084949">(Aug 16 2020 at 19:09)</a>:</h4>
<p>Is zlib-ng ABI compatible with zlib?</p>



<a name="207084971"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207084971" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207084971">(Aug 16 2020 at 19:09)</a>:</h4>
<p>It is when you're in zlib-compat mode.</p>



<a name="207085015"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207085015" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mati865 <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207085015">(Aug 16 2020 at 19:10)</a>:</h4>
<p>Ok, thanks.</p>



<a name="207085018"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207085018" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207085018">(Aug 16 2020 at 19:10)</a>:</h4>
<p>There's a non-zlib-compatible API, and it uses appropriately sized types everywhere.</p>



<a name="207085052"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207085052" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207085052">(Aug 16 2020 at 19:11)</a>:</h4>
<p>Also, it's possible to work with &gt;4GB files in the stock zlib interface. Just avoid the <code>gz*</code> functions entirely, read/write files yourself, and then use inflate/deflate in buffers.</p>



<a name="207085061"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207085061" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207085061">(Aug 16 2020 at 19:11)</a>:</h4>
<p><code>flate2</code> will work just fine with arbitrarily-sized files, for instance.</p>



<a name="207085120"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207085120" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mati865 <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207085120">(Aug 16 2020 at 19:12)</a>:</h4>
<p>Good to know!</p>



<a name="207097600"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207097600" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207097600">(Aug 17 2020 at 00:43)</a>:</h4>
<p><span class="user-mention" data-user-id="219696">@XAMPPRocky</span> I've fixed the issues on Windows. Would you mind updating the PR?</p>



<a name="207110386"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207110386" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> XAMPPRocky <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207110386">(Aug 17 2020 at 06:25)</a>:</h4>
<p>Will do</p>



<a name="207110454"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207110454" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> XAMPPRocky <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207110454">(Aug 17 2020 at 06:26)</a>:</h4>
<p><span class="user-mention" data-user-id="239881">@Josh Triplett</span> Do you also want to test other variants on macOS or Linux too or just Windows?</p>



<a name="207110512"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207110512" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207110512">(Aug 17 2020 at 06:28)</a>:</h4>
<p>Testing other variants on all platforms would be great.</p>



<a name="207110576"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207110576" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207110576">(Aug 17 2020 at 06:29)</a>:</h4>
<p>Each platform should test plain and zlib-ng on stable/beta/nightly. Then there are the few odd cases outside of that matrix, as appear in the current CI files.</p>



<a name="207110876"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207110876" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207110876">(Aug 17 2020 at 06:35)</a>:</h4>
<p>Please let me know if I have to do anything in the repository to enable all this, other than merge your PR. I haven't used GHA before.</p>



<a name="207110918"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207110918" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207110918">(Aug 17 2020 at 06:36)</a>:</h4>
<p><span class="user-mention" data-user-id="219696">@XAMPPRocky</span> Thank you so much for all your help.</p>



<a name="207117641"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207117641" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> XAMPPRocky <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207117641">(Aug 17 2020 at 08:20)</a>:</h4>
<p><span class="user-mention" data-user-id="239881">@Josh Triplett</span> All that should be required is merging the PR.</p>



<a name="207148490"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207148490" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207148490">(Aug 17 2020 at 14:12)</a>:</h4>
<p><span class="user-mention" data-user-id="219696">@XAMPPRocky</span> Around?</p>



<a name="207149926"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207149926" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207149926">(Aug 17 2020 at 14:25)</a>:</h4>
<p>I do not understand what's going on with the windows build now. Cannot find the library to link? That doesn't make sense.</p>



<a name="207152747"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207152747" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> XAMPPRocky <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207152747">(Aug 17 2020 at 14:49)</a>:</h4>
<p>Well I'm getting that error on other platforms too so that makes me think it's just not finding zlib.</p>



<a name="207156792"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207156792" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207156792">(Aug 17 2020 at 15:21)</a>:</h4>
<p>It worked fine in Travis...</p>



<a name="207157986"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207157986" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207157986">(Aug 17 2020 at 15:31)</a>:</h4>
<p>Oh. I see. It appears to be failing primarily in the --all-features build.</p>



<a name="207157987"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207157987" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207157987">(Aug 17 2020 at 15:31)</a>:</h4>
<p>So that's an issue, but not necessarily a new issue.</p>



<a name="207157988"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207157988" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207157988">(Aug 17 2020 at 15:31)</a>:</h4>
<p>That wasn't being tested before.</p>



<a name="207157989"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207157989" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207157989">(Aug 17 2020 at 15:31)</a>:</h4>
<p>I'll give a shot at fixing that.</p>



<a name="207159251"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207159251" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207159251">(Aug 17 2020 at 15:41)</a>:</h4>
<p><span class="user-mention" data-user-id="219696">@XAMPPRocky</span> I saw the invite to your repository. Is that just so I can see the actions logs directly?</p>



<a name="207159479"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207159479" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> XAMPPRocky <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207159479">(Aug 17 2020 at 15:43)</a>:</h4>
<p>Well I figure it would make it easier to test in case. I can fix the all features thing.</p>



<a name="207160065"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207160065" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207160065">(Aug 17 2020 at 15:47)</a>:</h4>
<p>I'm testing a little as well, in joshtriplett/libz-sys on the github-actions-test branch.</p>



<a name="207161696"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207161696" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207161696">(Aug 17 2020 at 16:00)</a>:</h4>
<p>/me continues to be baffled.</p>



<a name="207161958"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207161958" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207161958">(Aug 17 2020 at 16:02)</a>:</h4>
<p>Let's see. All the musl builds are failing for some msyterious reason involving <code>putc</code>, <code>fputc</code>, and similar; I'm going to disable those for now because that wasn't tested before and debugging it isn't a today problem.</p>



<a name="207162456"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207162456" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207162456">(Aug 17 2020 at 16:06)</a>:</h4>
<p>I don't understand why the 32-bit -windows-gnu build fails with an inability to find the compiler.</p>



<a name="207162602"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207162602" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207162602">(Aug 17 2020 at 16:07)</a>:</h4>
<p>rustc ships gcc for linking, but its not necessarily made available for <code>cc</code>-the-crate IIRC?</p>



<a name="207162712"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207162712" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207162712">(Aug 17 2020 at 16:08)</a>:</h4>
<p>I have hit the same issue in the past: <a href="https://github.com/rust-lang/stacker/blob/master/.github/workflows/stacker.yml#L43">https://github.com/rust-lang/stacker/blob/master/.github/workflows/stacker.yml#L43</a></p>



<a name="207162946"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207162946" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207162946">(Aug 17 2020 at 16:10)</a>:</h4>
<p>Sigh.</p>



<a name="207163111"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207163111" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207163111">(Aug 17 2020 at 16:11)</a>:</h4>
<p>The only one I'm really <em>bothered</em> by, as a can't-ship-until-fixed issue, is:</p>
<blockquote>
<p>= note: LINK : fatal error LNK1181: cannot open input file 'z.lib'</p>
</blockquote>



<a name="207163367"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207163367" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207163367">(Aug 17 2020 at 16:14)</a>:</h4>
<p>(The second most important is testing on 32-bit Windows, but if I can't test 32-bit windows-gnu but I <em>can</em> test 32-bit windows-msvc it won't be the end of the world for me.)</p>



<a name="207163443"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207163443" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207163443">(Aug 17 2020 at 16:14)</a>:</h4>
<p>how do you install/build that?</p>



<a name="207163556"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207163556" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207163556">(Aug 17 2020 at 16:15)</a>:</h4>
<p><code>z.lib</code>? In the case that's failing, it's being built with the <code>cmake</code> crate.</p>



<a name="207163609"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207163609" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207163609">(Aug 17 2020 at 16:16)</a>:</h4>
<p><a href="https://github.com/joshtriplett/libz-sys/runs/994352811?check_suite_focus=true">https://github.com/joshtriplett/libz-sys/runs/994352811?check_suite_focus=true</a></p>



<a name="207163665"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207163665" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207163665">(Aug 17 2020 at 16:16)</a>:</h4>
<p>Scroll to the bottom of the failing section.</p>



<a name="207163700"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207163700" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207163700">(Aug 17 2020 at 16:16)</a>:</h4>
<p>Here's the whole function that does the build in that case:</p>
<div class="codehilite"><pre><span></span><code><span class="k">fn</span> <span class="nf">build_zlib_ng</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">install_dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cmake</span>::<span class="n">Config</span>::<span class="n">new</span><span class="p">(</span><span class="s">&quot;src/zlib-ng&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">define</span><span class="p">(</span><span class="s">&quot;BUILD_SHARED_LIBS&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;OFF&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">define</span><span class="p">(</span><span class="s">&quot;ZLIB_COMPAT&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ON&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">define</span><span class="p">(</span><span class="s">&quot;WITH_GZFILEOP&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ON&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">build</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">includedir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">install_dir</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="s">&quot;include&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">libdir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">install_dir</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="s">&quot;lib&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&quot;cargo:rustc-link-search=native={}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">libdir</span><span class="p">.</span><span class="n">to_str</span><span class="p">().</span><span class="n">unwrap</span><span class="p">());</span><span class="w"></span>
<span class="w">    </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&quot;cargo:rustc-link-lib=z&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&quot;cargo:root={}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">install_dir</span><span class="p">.</span><span class="n">to_str</span><span class="p">().</span><span class="n">unwrap</span><span class="p">());</span><span class="w"></span>
<span class="w">    </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&quot;cargo:include={}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">includedir</span><span class="p">.</span><span class="n">to_str</span><span class="p">().</span><span class="n">unwrap</span><span class="p">());</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="207163942"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207163942" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207163942">(Aug 17 2020 at 16:18)</a>:</h4>
<p>...oh.</p>



<a name="207163955"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207163955" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207163955">(Aug 17 2020 at 16:18)</a>:</h4>
<p>Hrm, testing something...</p>



<a name="207164212"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207164212" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207164212">(Aug 17 2020 at 16:20)</a>:</h4>
<p>According to the cmake docs, apparently you're supposed to point rustc-link-search to the directory <code>.build()</code> returns, not a subdirectory of it? Let's see how that goes.</p>



<a name="207164506"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207164506" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207164506">(Aug 17 2020 at 16:23)</a>:</h4>
<p>yeah never had to interact with the <code>cmake</code> crate so far <span aria-label="shrug" class="emoji emoji-1f937" role="img" title="shrug">:shrug:</span></p>



<a name="207164634"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207164634" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207164634">(Aug 17 2020 at 16:24)</a>:</h4>
<p>the only other comment I have is that you want to <code>#[link(name="z")]</code> over the extern block in your actual crate, if you haven’t already, which makes <code>rustc-link-lib</code> superfluous.</p>



<a name="207164671"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207164671" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207164671">(Aug 17 2020 at 16:24)</a>:</h4>
<p><span class="user-mention" data-user-id="123586">@nagisa</span> There are other cases where that won't work, I think.</p>



<a name="207164712"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207164712" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207164712">(Aug 17 2020 at 16:25)</a>:</h4>
<p>Not all branches of <code>build.rs</code> print that line.</p>



<a name="207164933"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207164933" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207164933">(Aug 17 2020 at 16:27)</a>:</h4>
<p><span class="user-mention" data-user-id="219696">@XAMPPRocky</span> x86_64-apple-darwin is doing this:</p>
<div class="codehilite"><pre><span></span><code>Warning: `cross` does not provide a Docker image for target x86_64-apple-darwin, specify a custom image in `Cross.toml`. Falling back to `cargo` on the host.
</code></pre></div>



<a name="207164952"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207164952" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207164952">(Aug 17 2020 at 16:27)</a>:</h4>
<p>hm, I can’t think of the cases where <code>#[link(name)]</code> does not replace <code>rustc-link-lib</code>, but you definitely want former. Without that rustc is unable to track dependencies and you can run into <a href="https://github.com/rust-lang/rust/issues/65610">https://github.com/rust-lang/rust/issues/65610</a></p>



<a name="207164958"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207164958" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207164958">(Aug 17 2020 at 16:27)</a>:</h4>
<p><span class="user-mention" data-user-id="219696">@XAMPPRocky</span> Any idea what that's about? It looks like it's just doing a host build.</p>



<a name="207165122"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207165122" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207165122">(Aug 17 2020 at 16:28)</a>:</h4>
<p>you don’t want to use cross with gha, but ci.yml does attempt it</p>



<a name="207165182"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207165182" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207165182">(Aug 17 2020 at 16:28)</a>:</h4>
<p>Huh. OK. So that bit of the template should just be dropped?</p>



<a name="207165247"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207165247" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207165247">(Aug 17 2020 at 16:29)</a>:</h4>
<p>yeah. I would also probably use the rust_toolchain action instead of installing manually, but that's up to you if you want to spend time cleaning it up.</p>



<a name="207165285"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207165285" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207165285">(Aug 17 2020 at 16:29)</a>:</h4>
<p>(<a href="https://github.com/marketplace/actions/rust-toolchain">https://github.com/marketplace/actions/rust-toolchain</a>)</p>



<a name="207165394"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207165394" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207165394">(Aug 17 2020 at 16:30)</a>:</h4>
<p>/me is not a GHA expert, or even a GHA novice.</p>



<a name="207165534"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207165534" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207165534">(Aug 17 2020 at 16:31)</a>:</h4>
<p>Well, now <em>all</em> of the Windows builds fail, so, consistency? :)</p>



<a name="207165536"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207165536" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207165536">(Aug 17 2020 at 16:31)</a>:</h4>
<blockquote>
<p>error: could not find native static library <code>z</code>, perhaps an -L flag is missing?</p>
</blockquote>



<a name="207165952"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207165952" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mati865 <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207165952">(Aug 17 2020 at 16:35)</a>:</h4>
<p><span class="user-mention" data-user-id="239881">@Josh Triplett</span> GHA decided not to add MinGW compiler to the path by default. See <a href="https://github.com/rust-lang/libz-sys/pull/67#discussion_r471450253">https://github.com/rust-lang/libz-sys/pull/67#discussion_r471450253</a> and also add <code>${msys2Path}/mingw64/bin</code> for 64 bit job and <code>${msys2Path}/mingw32/bin</code> for 32 bit job.</p>



<a name="207165982"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207165982" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> XAMPPRocky <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207165982">(Aug 17 2020 at 16:35)</a>:</h4>
<p><span class="user-mention" data-user-id="123586">@nagisa</span> You can totally use cross with gha, it’s how tokei is tested and deployed.</p>



<a name="207166014"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207166014" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207166014">(Aug 17 2020 at 16:35)</a>:</h4>
<p><span class="user-mention" data-user-id="119581">@mati865</span> Interesting. Why does the 64-bit compiler work out of the box, then, but the 32-bit one doesn't?</p>



<a name="207166117"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207166117" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mati865 <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207166117">(Aug 17 2020 at 16:36)</a>:</h4>
<p>No idea, maybe they have changed their mind and added 64 bit compiler to the PATH only?<br>
Can I see the log?</p>



<a name="207166250"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207166250" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207166250">(Aug 17 2020 at 16:37)</a>:</h4>
<p>Oh, wait. Are you saying that the 64-bit compiler may just be working because of the choco install line (which I hadn't removed yet)?</p>



<a name="207166277"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207166277" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207166277">(Aug 17 2020 at 16:37)</a>:</h4>
<p>Here's the current (experimental) run: <a href="https://github.com/joshtriplett/libz-sys/actions/runs/212344387">https://github.com/joshtriplett/libz-sys/actions/runs/212344387</a></p>



<a name="207166345"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207166345" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mati865 <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207166345">(Aug 17 2020 at 16:38)</a>:</h4>
<p>I don't use choco for installing MSYS2 so I have no idea what it does but yes, sounds possible.</p>



<a name="207166362"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207166362" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> XAMPPRocky <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207166362">(Aug 17 2020 at 16:38)</a>:</h4>
<p><span class="user-mention" data-user-id="239881">@Josh Triplett</span> I mean it’s intentional to fallback to cargo because you wouldn’t need cross for that.</p>



<a name="207166431"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207166431" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207166431">(Aug 17 2020 at 16:39)</a>:</h4>
<p><span class="user-mention" data-user-id="119581">@mati865</span> What's the right way in GHA to add those directories to the PATH? Do you have a sample where you do that?</p>



<a name="207166457"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207166457" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207166457">(Aug 17 2020 at 16:39)</a>:</h4>
<p><span class="user-mention" data-user-id="219696">@XAMPPRocky</span> Then why does it try to use cross for that target?</p>



<a name="207166615"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207166615" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> XAMPPRocky <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207166615">(Aug 17 2020 at 16:40)</a>:</h4>
<p>Because it’s less work in the script to have cross figure that out. <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="207166667"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207166667" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207166667">(Aug 17 2020 at 16:41)</a>:</h4>
<p>Ah.</p>



<a name="207167001"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207167001" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> XAMPPRocky <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207167001">(Aug 17 2020 at 16:44)</a>:</h4>
<p>We could also only support what you can build and test with cargo, it would be simpler.</p>



<a name="207167042"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207167042" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mati865 <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207167042">(Aug 17 2020 at 16:44)</a>:</h4>
<p><span class="user-mention" data-user-id="239881">@Josh Triplett</span> I always use bash (even on Windows) so I'd just <code>export PATH=/c/msys64/mingw32/bin:/c/msys64/usr/bin:$PATH</code> and <code>export PATH=/c/msys64/mingw64/bin:/c/msys64/usr/bin:$PATH</code>.<br>
Rusts CI however does it like that <a href="https://github.com/rust-lang/rust/blob/e8876ae2c11f341565059b900eeae1254a9accf1/src/ci/shared.sh#L107">https://github.com/rust-lang/rust/blob/e8876ae2c11f341565059b900eeae1254a9accf1/src/ci/shared.sh#L107</a>, also the path here is mixed style so <code>"c:/msys64/mingw32/bin"</code>.</p>



<a name="207167115"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207167115" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207167115">(Aug 17 2020 at 16:45)</a>:</h4>
<p><span class="user-mention" data-user-id="219696">@XAMPPRocky</span> That's probably a good idea. I don't think there's much value in cross-compiling for various Linux and BSD targets and similar if they're not actually going to get tested.</p>



<a name="207167139"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207167139" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207167139">(Aug 17 2020 at 16:45)</a>:</h4>
<p>OK, regardless of where I point the search path, I keep getting</p>
<div class="codehilite"><pre><span></span><code>error: could not find native static library `z`, perhaps an -L flag is missing?
</code></pre></div>


<p>on all Windows platforms. That makes me think it was only work before because it found a system library, and now it's failing because it's forced to try to find the <em>static</em> library it was supposed to find, and it never could.</p>



<a name="207167230"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207167230" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> XAMPPRocky <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207167230">(Aug 17 2020 at 16:46)</a>:</h4>
<p>Well some are tested, some are build only.</p>



<a name="207167319"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207167319" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207167319">(Aug 17 2020 at 16:46)</a>:</h4>
<p>Are the non-x86 ones being tested?</p>



<a name="207167326"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207167326" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mati865 <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207167326">(Aug 17 2020 at 16:47)</a>:</h4>
<p>AFAIK in Rust linking static library searches only system default directories, when you use <code>static-nobundle</code> it will take the library from target dir.</p>



<a name="207167389"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207167389" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mati865 <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207167389">(Aug 17 2020 at 16:47)</a>:</h4>
<p>Alternatively you can add search dir if using <code>static</code>.</p>



<a name="207167422"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207167422" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207167422">(Aug 17 2020 at 16:47)</a>:</h4>
<p><span class="user-mention" data-user-id="119581">@mati865</span> I did add a search dir.</p>



<a name="207167505"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207167505" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207167505">(Aug 17 2020 at 16:48)</a>:</h4>
<p>With <code>cargo:rustc-link-search=native=</code>.</p>



<a name="207167533"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207167533" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mati865 <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207167533">(Aug 17 2020 at 16:48)</a>:</h4>
<p>I can test locally on Windows tomorrow.</p>



<a name="207167591"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207167591" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207167591">(Aug 17 2020 at 16:49)</a>:</h4>
<p><span class="user-mention silent" data-user-id="219696">XAMPPRocky</span> <a href="#narrow/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F/near/207165982">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="123586">nagisa</span> You can totally use cross with gha, it’s how tokei is tested and deployed.</p>
</blockquote>
<p>you can but for macOS you don’t need to.</p>



<a name="207167621"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207167621" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> XAMPPRocky <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207167621">(Aug 17 2020 at 16:49)</a>:</h4>
<p>Either way, I’ll simplify the ci setup in a bit.</p>



<a name="207167924"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207167924" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mati865 <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207167924">(Aug 17 2020 at 16:52)</a>:</h4>
<p>Oh, I think I remember now.<br>
Azure Pipelines/GHA had 64 bit MinGW installed by chocolatey. Later on they decided to include full MSYS2 but didn't add it to the PATH.</p>



<a name="207168033"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207168033" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207168033">(Aug 17 2020 at 16:53)</a>:</h4>
<p><span class="user-mention" data-user-id="119581">@mati865</span> I'm becoming increasingly convinced that the best CI system would be one where you get <em>nothing</em> by default that you don't install, so that if something is installed weirdly, it's always your own fault. :)</p>



<a name="207168053"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207168053" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207168053">(Aug 17 2020 at 16:53)</a>:</h4>
<p>I don't want a mysterious CI image that <em>usually</em> has everything I might want.</p>



<a name="207168088"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207168088" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207168088">(Aug 17 2020 at 16:53)</a>:</h4>
<p>I want a system that runs <em>exactly</em> what I tell it to, because the only thing I <em>don't</em> have and need is access to random architectures and OSes.</p>



<a name="207168206"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207168206" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mati865 <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207168206">(Aug 17 2020 at 16:54)</a>:</h4>
<p><span class="user-mention" data-user-id="123586">@nagisa</span> if I don't open PR to tweak stacker CI tomorrow feel free to ping me.<br>
<span class="user-mention" data-user-id="239881">@Josh Triplett</span> we don't live in a perfect world.</p>



<a name="207168395"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207168395" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207168395">(Aug 17 2020 at 16:56)</a>:</h4>
<p>I'm aware. I'm also working on fixing it, and learning a great deal today that'll inform that. :)</p>



<a name="207169363"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207169363" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207169363">(Aug 17 2020 at 17:06)</a>:</h4>
<p><span class="user-mention" data-user-id="219696">@XAMPPRocky</span> I don't think <code>--no-features</code> is an option; it's <code>--no-default-features</code>.</p>



<a name="207169540"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207169540" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> XAMPPRocky <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207169540">(Aug 17 2020 at 17:07)</a>:</h4>
<p><span class="user-mention" data-user-id="239881">@Josh Triplett</span> fwiw they publish the list of software included with the runners. <a href="https://docs.github.com/en/actions/reference/software-installed-on-github-hosted-runners">https://docs.github.com/en/actions/reference/software-installed-on-github-hosted-runners</a></p>



<a name="207170907"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207170907" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207170907">(Aug 17 2020 at 17:20)</a>:</h4>
<p>On the bright side, it <em>does</em> look like musl works.</p>



<a name="207171150"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207171150" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207171150">(Aug 17 2020 at 17:22)</a>:</h4>
<p>I <em>still</em> don't understand what's going on with Windows. I'm going to try getting a directory listing after the failed build.</p>



<a name="207173055"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207173055" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207173055">(Aug 17 2020 at 17:36)</a>:</h4>
<p>...and that explains it.</p>



<a name="207173062"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207173062" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207173062">(Aug 17 2020 at 17:36)</a>:</h4>
<blockquote>
<p>target/x86_64-pc-windows-msvc/debug/build/libz-sys-af4e3d3a8f4ce1a3/out/lib/zlibd.lib</p>
</blockquote>



<a name="207174164"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207174164" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207174164">(Aug 17 2020 at 17:43)</a>:</h4>
<div class="codehilite"><pre><span></span><code>if(WIN32)
    set_target_properties(${ZLIB_INSTALL_LIBRARIES} PROPERTIES OUTPUT_NAME zlib${SUFFIX})
else()
    # On unix-like platforms the library is almost always called libz
    set_target_properties(${ZLIB_INSTALL_LIBRARIES} PROPERTIES OUTPUT_NAME z${SUFFIX})
endif()
</code></pre></div>



<a name="207174222"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207174222" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207174222">(Aug 17 2020 at 17:43)</a>:</h4>
<div class="codehilite"><pre><span></span><code>if(MSVC)
    set(CMAKE_DEBUG_POSTFIX &quot;d&quot;)
</code></pre></div>



<a name="207174314"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207174314" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207174314">(Aug 17 2020 at 17:44)</a>:</h4>
<p>Welp, there's the origin of a substantial amount of wasted time.</p>



<a name="207175562"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207175562" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207175562">(Aug 17 2020 at 17:53)</a>:</h4>
<p>I appreciate all the help from everyone. I'm going to spend some time trying to get the Windows build working.</p>



<a name="207213721"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207213721" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207213721">(Aug 18 2020 at 00:54)</a>:</h4>
<p>Managed to get this working; waiting on the final GHA build to confirm before merging it.</p>



<a name="207213838"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207213838" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207213838">(Aug 18 2020 at 00:57)</a>:</h4>
<p><span class="user-mention" data-user-id="219696">@XAMPPRocky</span> I'd like to squash this down to one commit, rather than the many iterations needed to get this right. I'd also like to give you credit for doing 90% of the work here. Any objection to a commit with you listed as the author, with myself in <code>Co-authored-by</code>? I feel like that's more accurate than the other way around. :)</p>



<a name="207226707"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207226707" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> XAMPPRocky <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207226707">(Aug 18 2020 at 06:16)</a>:</h4>
<p><span class="user-mention" data-user-id="239881">@Josh Triplett</span> That's totally fine with me.</p>



<a name="207231976"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207231976" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207231976">(Aug 18 2020 at 07:48)</a>:</h4>
<p><span class="user-mention" data-user-id="219696">@XAMPPRocky</span> Awesome.</p>



<a name="207232068"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/infra%20help%20getting%20appveyor%20running%3F/near/207232068" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/infra.20help.20getting.20appveyor.20running.3F.html#207232068">(Aug 18 2020 at 07:48)</a>:</h4>
<p>I just shipped libz-sys 1.1.0, with zlib-ng support. Thanks for all the help; the CI was critical to make sure it worked on all platforms.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>