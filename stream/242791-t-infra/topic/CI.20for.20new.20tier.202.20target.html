<html>
<head><meta charset="utf-8"><title>CI for new tier 2 target · t-infra · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/index.html">t-infra</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/CI.20for.20new.20tier.202.20target.html">CI for new tier 2 target</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="276383165"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/CI%20for%20new%20tier%202%20target/near/276383165" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/CI.20for.20new.20tier.202.20target.html#276383165">(Mar 23 2022 at 18:53)</a>:</h4>
<p>I'm looking to propose a new tier 2 target, which includes making a draft PR adding it to the CI. is this the right place to add such a thing? <a href="https://github.com/rust-lang/rust/blob/92804455704cc59d6d8272faf72f442c6125d395/src/ci/docker/host-x86_64/dist-various-1/Dockerfile#L110">https://github.com/rust-lang/rust/blob/92804455704cc59d6d8272faf72f442c6125d395/src/ci/docker/host-x86_64/dist-various-1/Dockerfile#L110</a></p>



<a name="276383231"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/CI%20for%20new%20tier%202%20target/near/276383231" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/CI.20for.20new.20tier.202.20target.html#276383231">(Mar 23 2022 at 18:54)</a>:</h4>
<p>it's a no_std target, so it doesn't need anything fancy</p>



<a name="277908179"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/CI%20for%20new%20tier%202%20target/near/277908179" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/CI.20for.20new.20tier.202.20target.html#277908179">(Apr 05 2022 at 16:42)</a>:</h4>
<p>The compiler team has accepted x86_64-unknown-none for Tier 2, and I'd like to submit the infrastructure PR but I'm still totally clueless as to how the distribution infrastructure works. I don't suppose there's some way of testing it locally to see if my changes actually work? I tried looking at some PRs adding support for other targets and there's very little consistency among them, but at best it seems like I might need to only add a single line to <a href="https://github.com/rust-lang/rust/blob/92804455704cc59d6d8272faf72f442c6125d395/src/ci/docker/host-x86_64/dist-various-1/Dockerfile#L110">https://github.com/rust-lang/rust/blob/92804455704cc59d6d8272faf72f442c6125d395/src/ci/docker/host-x86_64/dist-various-1/Dockerfile#L110</a> , though that seems far too easy. :) <span class="user-mention" data-user-id="239881">@Josh Triplett</span> I recall you being interested in this effort, perhaps you can tell me if I'm on the right track?</p>



<a name="277908495"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/CI%20for%20new%20tier%202%20target/near/277908495" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/CI.20for.20new.20tier.202.20target.html#277908495">(Apr 05 2022 at 16:44)</a>:</h4>
<p>you can at least run the docker file locally</p>



<a name="277908566"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/CI%20for%20new%20tier%202%20target/near/277908566" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/CI.20for.20new.20tier.202.20target.html#277908566">(Apr 05 2022 at 16:45)</a>:</h4>
<p>You can also run <code>@bors try</code> on the PR and use rustup-toolchain-install-master to download the generated artifacts</p>



<a name="277908653"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/CI%20for%20new%20tier%202%20target/near/277908653" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/CI.20for.20new.20tier.202.20target.html#277908653">(Apr 05 2022 at 16:45)</a>:</h4>
<p>try only builds linux, you have to modify the ci.yml it to do more</p>



<a name="277911279"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/CI%20for%20new%20tier%202%20target/near/277911279" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/CI.20for.20new.20tier.202.20target.html#277911279">(Apr 05 2022 at 17:04)</a>:</h4>
<p><span class="user-mention silent" data-user-id="330154">The 8472</span> <a href="#narrow/stream/242791-t-infra/topic/CI.20for.20new.20tier.202.20target/near/277908653">said</a>:</p>
<blockquote>
<p>try only builds linux, you have to modify the ci.yml it to do more</p>
</blockquote>
<p>Right, and people commonly do that and then invoke try.</p>



<a name="277944668"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/CI%20for%20new%20tier%202%20target/near/277944668" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/CI.20for.20new.20tier.202.20target.html#277944668">(Apr 05 2022 at 21:17)</a>:</h4>
<p>is there any principled distinction between targets in <a href="https://github.com/rust-lang/rust/tree/master/src/ci/docker/host-x86_64/dist-various-1">dist-various-1</a> and <a href="https://github.com/rust-lang/rust/tree/master/src/ci/docker/host-x86_64/dist-various-2">dist-various-2</a>, or is it just for the sake of arbitrarily breaking up one long job into two shorter jobs?</p>



<a name="277944862"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/CI%20for%20new%20tier%202%20target/near/277944862" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/CI.20for.20new.20tier.202.20target.html#277944862">(Apr 05 2022 at 21:19)</a>:</h4>
<p>it's to break up the jobs</p>



<a name="277944868"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/CI%20for%20new%20tier%202%20target/near/277944868" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/CI.20for.20new.20tier.202.20target.html#277944868">(Apr 05 2022 at 21:19)</a>:</h4>
<p>just pick the shortest one and add it there</p>



<a name="277956081"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/CI%20for%20new%20tier%202%20target/near/277956081" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/CI.20for.20new.20tier.202.20target.html#277956081">(Apr 05 2022 at 23:06)</a>:</h4>
<p>can someone grant me try privileges on <a href="https://github.com/rust-lang/rust/pull/95705">https://github.com/rust-lang/rust/pull/95705</a> ?</p>



<a name="277957257"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/CI%20for%20new%20tier%202%20target/near/277957257" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Goulet (compiler-errors) <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/CI.20for.20new.20tier.202.20target.html#277957257">(Apr 05 2022 at 23:21)</a>:</h4>
<p>I'll try <code>@bors delegate+</code>, not sure if that lets you do try builds though.</p>



<a name="277957285"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/CI%20for%20new%20tier%202%20target/near/277957285" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Goulet (compiler-errors) <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/CI.20for.20new.20tier.202.20target.html#277957285">(Apr 05 2022 at 23:21)</a>:</h4>
<p>otherwise <span class="user-mention" data-user-id="256342">@bstrie</span> I can start a try-build for you</p>



<a name="277957367"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/CI%20for%20new%20tier%202%20target/near/277957367" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Goulet (compiler-errors) <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/CI.20for.20new.20tier.202.20target.html#277957367">(Apr 05 2022 at 23:22)</a>:</h4>
<p>oh cool it worked</p>



<a name="277957373"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/CI%20for%20new%20tier%202%20target/near/277957373" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/CI.20for.20new.20tier.202.20target.html#277957373">(Apr 05 2022 at 23:22)</a>:</h4>
<p>thanks!</p>



<a name="277965644"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/CI%20for%20new%20tier%202%20target/near/277965644" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/CI.20for.20new.20tier.202.20target.html#277965644">(Apr 06 2022 at 01:37)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/242791-t-infra/topic/CI.20for.20new.20tier.202.20target/near/277908566">said</a>:</p>
<blockquote>
<p>You can also run <code>@bors try</code> on the PR and use rustup-toolchain-install-master to download the generated artifacts</p>
</blockquote>
<p>can you elaborate on this workflow? I have the try toolchain built and can install it, but <code>rustup-toolchain-install-master --targets foo</code> tells me the rust-std component is missing for every target I try, and using <code>rustup target add</code> tells me that this toolchain does not support components because it's a custom toolchain. did I perhaps not modify ci.yml correctly? <a href="https://github.com/rust-lang/rust/pull/95705/files#diff-02518955cdd3915a63d869f6a97b6135b9bb5d0387339e24d42ed73a8cb53c33">https://github.com/rust-lang/rust/pull/95705/files#diff-02518955cdd3915a63d869f6a97b6135b9bb5d0387339e24d42ed73a8cb53c33</a></p>



<a name="277966020"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/CI%20for%20new%20tier%202%20target/near/277966020" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/CI.20for.20new.20tier.202.20target.html#277966020">(Apr 06 2022 at 01:43)</a>:</h4>
<p>Not sure, sorry. I've only ever tried this for host tools, not cross compiling.</p>



<a name="277966505"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/CI%20for%20new%20tier%202%20target/near/277966505" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/CI.20for.20new.20tier.202.20target.html#277966505">(Apr 06 2022 at 01:52)</a>:</h4>
<p>no problem, do you know whether or not my ci.yml changes look correct?</p>



<a name="277967726"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/CI%20for%20new%20tier%202%20target/near/277967726" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/CI.20for.20new.20tier.202.20target.html#277967726">(Apr 06 2022 at 02:14)</a>:</h4>
<p>No idea, sorry. CI confuses me</p>



<a name="277967926"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/CI%20for%20new%20tier%202%20target/near/277967926" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/CI.20for.20new.20tier.202.20target.html#277967926">(Apr 06 2022 at 02:18)</a>:</h4>
<p>I can see in the logs that an artifact was uploaded to s3://rust-lang-ci2/rustc-builds/314bdc0cfdb1d88d21c21aa89639df0c02d349f4/rust-std-nightly-x86_64-unknown-none.tar.xz , which means nothing to me. anyone know how to access an s3 url like that? and then where to manually unpack that to get it to work with the toolchain?</p>



<a name="277968030"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/CI%20for%20new%20tier%202%20target/near/277968030" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/CI.20for.20new.20tier.202.20target.html#277968030">(Apr 06 2022 at 02:20)</a>:</h4>
<p>guess I can always read the rustup-toolchain-install-master source to figure it out :P</p>



<a name="277969129"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/CI%20for%20new%20tier%202%20target/near/277969129" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/CI.20for.20new.20tier.202.20target.html#277969129">(Apr 06 2022 at 02:44)</a>:</h4>
<p><code>rustup-toolchain-install-master 314bdc0cfdb1d88d21c21aa89639df0c02d349f4 --host x86_64-unknown-linux-gnu --targets x86_64-unknown-none</code> should work</p>



<a name="277982818"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/CI%20for%20new%20tier%202%20target/near/277982818" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/CI.20for.20new.20tier.202.20target.html#277982818">(Apr 06 2022 at 07:07)</a>:</h4>
<p>rustup-toolchain-install-master is the way to go</p>



<a name="277982837"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/CI%20for%20new%20tier%202%20target/near/277982837" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/CI.20for.20new.20tier.202.20target.html#277982837">(Apr 06 2022 at 07:07)</a>:</h4>
<p>otherwise, replace <code>s3://rust-lang-ci2</code> with <code>https://ci-artifacts.rust-lang.org</code></p>



<a name="278105559"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/CI%20for%20new%20tier%202%20target/near/278105559" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/CI.20for.20new.20tier.202.20target.html#278105559">(Apr 07 2022 at 00:51)</a>:</h4>
<p>thanks everyone for your help! I've pulled down the toolchain and confirmed that it all works as expected, final CI PR incoming <span aria-label="heart" class="emoji emoji-2764" role="img" title="heart">:heart:</span></p>



<a name="278118556"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/CI%20for%20new%20tier%202%20target/near/278118556" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/CI.20for.20new.20tier.202.20target.html#278118556">(Apr 07 2022 at 05:16)</a>:</h4>
<p>PR ready for review, it's quite simple if anyone has a quick moment: <a href="https://github.com/rust-lang/rust/pull/95705">https://github.com/rust-lang/rust/pull/95705</a></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>