<html>
<head><meta charset="utf-8"><title>ci bugs in bash · t-infra · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/index.html">t-infra</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/ci.20bugs.20in.20bash.html">ci bugs in bash</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="210325007"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/ci%20bugs%20in%20bash/near/210325007" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/ci.20bugs.20in.20bash.html#210325007">(Sep 16 2020 at 21:53)</a>:</h4>
<p>src/ci/run.sh: line 81: !isWindows: command not found</p>



<a name="210325011"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/ci%20bugs%20in%20bash/near/210325011" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/ci.20bugs.20in.20bash.html#210325011">(Sep 16 2020 at 21:53)</a>:</h4>
<p>this... is not good</p>



<a name="210325015"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/ci%20bugs%20in%20bash/near/210325015" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/ci.20bugs.20in.20bash.html#210325015">(Sep 16 2020 at 21:53)</a>:</h4>
<p>how this is not a hard error?!</p>



<a name="210325103"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/ci%20bugs%20in%20bash/near/210325103" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/ci.20bugs.20in.20bash.html#210325103">(Sep 16 2020 at 21:54)</a>:</h4>
<p>maybe I need a space in there?</p>



<a name="210325188"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/ci%20bugs%20in%20bash/near/210325188" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/ci.20bugs.20in.20bash.html#210325188">(Sep 16 2020 at 21:55)</a>:</h4>
<p>seems like it</p>



<a name="210325199"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/ci%20bugs%20in%20bash/near/210325199" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/ci.20bugs.20in.20bash.html#210325199">(Sep 16 2020 at 21:55)</a>:</h4>
<p>/me is really annoyed at bash</p>



<a name="210325260"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/ci%20bugs%20in%20bash/near/210325260" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/ci.20bugs.20in.20bash.html#210325260">(Sep 16 2020 at 21:56)</a>:</h4>
<blockquote>
<p>how this is not a hard error?!</p>
</blockquote>
<p>Maybe you need <code>set -e</code>?</p>



<a name="210325298"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/ci%20bugs%20in%20bash/near/210325298" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/ci.20bugs.20in.20bash.html#210325298">(Sep 16 2020 at 21:56)</a>:</h4>
<p>probably that won't help because it's conditional?</p>



<a name="210325306"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/ci%20bugs%20in%20bash/near/210325306" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/ci.20bugs.20in.20bash.html#210325306">(Sep 16 2020 at 21:56)</a>:</h4>
<p>the line is <code>if !isWindows; then</code> -- that's separate from <code>set -e</code> exits, yes</p>



<a name="210325307"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/ci%20bugs%20in%20bash/near/210325307" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/ci.20bugs.20in.20bash.html#210325307">(Sep 16 2020 at 21:56)</a>:</h4>
<p>maybe set -u or something</p>



<a name="210325344"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/ci%20bugs%20in%20bash/near/210325344" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/ci.20bugs.20in.20bash.html#210325344">(Sep 16 2020 at 21:57)</a>:</h4>
<p><code>set -u</code> is for unknown <code>$PARAM</code></p>



<a name="210325378"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/ci%20bugs%20in%20bash/near/210325378" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/ci.20bugs.20in.20bash.html#210325378">(Sep 16 2020 at 21:58)</a>:</h4>
<p>set -eeeee</p>



<a name="210325441"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/ci%20bugs%20in%20bash/near/210325441" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/ci.20bugs.20in.20bash.html#210325441">(Sep 16 2020 at 21:58)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/pull/76810">https://github.com/rust-lang/rust/pull/76810</a></p>



<a name="210325492"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/ci%20bugs%20in%20bash/near/210325492" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/ci.20bugs.20in.20bash.html#210325492">(Sep 16 2020 at 21:59)</a>:</h4>
<p>I think "command not found" is just considered a legitimate way for a command to fail</p>



<a name="210325534"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/ci%20bugs%20in%20bash/near/210325534" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/ci.20bugs.20in.20bash.html#210325534">(Sep 16 2020 at 22:00)</a>:</h4>
<p>probably, though honestly I'm a bit surprised we even got the error message then</p>



<a name="210325783"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/ci%20bugs%20in%20bash/near/210325783" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/ci.20bugs.20in.20bash.html#210325783">(Sep 16 2020 at 22:02)</a>:</h4>
<p>wait, the fix is <code>! isWindows</code>? so you were getting <code>!isWindows</code> doing history lookup then?</p>



<a name="210325806"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/ci%20bugs%20in%20bash/near/210325806" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/ci.20bugs.20in.20bash.html#210325806">(Sep 16 2020 at 22:02)</a>:</h4>
<p>(that's different than I was thinking)</p>



<a name="210325819"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/ci%20bugs%20in%20bash/near/210325819" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/ci.20bugs.20in.20bash.html#210325819">(Sep 16 2020 at 22:02)</a>:</h4>
<p>I didn't get that from history</p>



<a name="210325829"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/ci%20bugs%20in%20bash/near/210325829" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/ci.20bugs.20in.20bash.html#210325829">(Sep 16 2020 at 22:02)</a>:</h4>
<p>I just, uh, assumed that was okay</p>



<a name="210325840"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/ci%20bugs%20in%20bash/near/210325840" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/ci.20bugs.20in.20bash.html#210325840">(Sep 16 2020 at 22:02)</a>:</h4>
<p>after checking that ! is the right operator</p>



<a name="210325859"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/ci%20bugs%20in%20bash/near/210325859" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/ci.20bugs.20in.20bash.html#210325859">(Sep 16 2020 at 22:02)</a>:</h4>
<p>today I learned that operators are space-sensitive in bash</p>



<a name="210325878"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/ci%20bugs%20in%20bash/near/210325878" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/ci.20bugs.20in.20bash.html#210325878">(Sep 16 2020 at 22:03)</a>:</h4>
<p>no, like, iirc <code>!isWindows</code> looks "isWindows" up in the bash history</p>



<a name="210325882"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/ci%20bugs%20in%20bash/near/210325882" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/ci.20bugs.20in.20bash.html#210325882">(Sep 16 2020 at 22:03)</a>:</h4>
<p>I mean, in an interactive shell you can do <code>!foo</code> to recall your last <code>foo</code> command</p>



<a name="210325883"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/ci%20bugs%20in%20bash/near/210325883" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/ci.20bugs.20in.20bash.html#210325883">(Sep 16 2020 at 22:03)</a>:</h4>
<p>but locally <code>if ! isWindows ; then</code> seems to work</p>



<a name="210325888"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/ci%20bugs%20in%20bash/near/210325888" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/ci.20bugs.20in.20bash.html#210325888">(Sep 16 2020 at 22:03)</a>:</h4>
<p>and executes the last command it finds</p>



<a name="210325900"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/ci%20bugs%20in%20bash/near/210325900" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/ci.20bugs.20in.20bash.html#210325900">(Sep 16 2020 at 22:03)</a>:</h4>
<p>huh I have never done that before</p>



<a name="210325908"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/ci%20bugs%20in%20bash/near/210325908" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/ci.20bugs.20in.20bash.html#210325908">(Sep 16 2020 at 22:03)</a>:</h4>
<p>seems scary</p>



<a name="210325913"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/ci%20bugs%20in%20bash/near/210325913" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/ci.20bugs.20in.20bash.html#210325913">(Sep 16 2020 at 22:03)</a>:</h4>
<p>but I don't think that works in scripts anyway</p>



<a name="210325963"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/ci%20bugs%20in%20bash/near/210325963" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/ci.20bugs.20in.20bash.html#210325963">(Sep 16 2020 at 22:04)</a>:</h4>
<p>I'm not sure what difference the space makes otherwise</p>



<a name="210326031"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/ci%20bugs%20in%20bash/near/210326031" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/ci.20bugs.20in.20bash.html#210326031">(Sep 16 2020 at 22:04)</a>:</h4>
<p>it seems to be parsed as part of the name</p>



<a name="210326041"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/ci%20bugs%20in%20bash/near/210326041" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/ci.20bugs.20in.20bash.html#210326041">(Sep 16 2020 at 22:04)</a>:</h4>
<p>like, we could have a function called <code>!isWindows</code></p>



<a name="210326071"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/ci%20bugs%20in%20bash/near/210326071" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/ci.20bugs.20in.20bash.html#210326071">(Sep 16 2020 at 22:04)</a>:</h4>
<p>ah, ok, that's why the <code>!</code> is part of the error message</p>



<a name="210326097"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/ci%20bugs%20in%20bash/near/210326097" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/ci.20bugs.20in.20bash.html#210326097">(Sep 16 2020 at 22:05)</a>:</h4>
<p>though locally I personally get "event not found"</p>



<a name="210326110"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/ci%20bugs%20in%20bash/near/210326110" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/ci.20bugs.20in.20bash.html#210326110">(Sep 16 2020 at 22:05)</a>:</h4>
<p>but that might be the script vs shell difference</p>



<a name="210326149"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/ci%20bugs%20in%20bash/near/210326149" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/ci.20bugs.20in.20bash.html#210326149">(Sep 16 2020 at 22:05)</a>:</h4>
<p>"event not found" would be a history lookup</p>



<a name="210326377"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/ci%20bugs%20in%20bash/near/210326377" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/ci.20bugs.20in.20bash.html#210326377">(Sep 16 2020 at 22:07)</a>:</h4>
<p>would be great for some to r+ the PR, btw</p>



<a name="210326385"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/ci%20bugs%20in%20bash/near/210326385" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/ci.20bugs.20in.20bash.html#210326385">(Sep 16 2020 at 22:07)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/pull/76810">https://github.com/rust-lang/rust/pull/76810</a></p>



<a name="210326518"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/ci%20bugs%20in%20bash/near/210326518" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/ci.20bugs.20in.20bash.html#210326518">(Sep 16 2020 at 22:08)</a>:</h4>
<p>done</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>