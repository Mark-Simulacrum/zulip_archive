<html>
<head><meta charset="utf-8"><title>expired certificates · t-infra · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/index.html">t-infra</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/expired.20certificates.html">expired certificates</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="260169118"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/expired%20certificates/near/260169118" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/expired.20certificates.html#260169118">(Nov 03 2021 at 17:33)</a>:</h4>
<p>I am no longer able to build the docker image for dist-aarch64-linux due to expired https certificate downloading crosstool stuff.  It looks like ubuntu 16's newest ca-certificates is 20210119~16.04.1.  Is there a preferred strategy to resolve this?</p>
<ul>
<li>Update to a newer version of ubuntu?</li>
<li>Fetch and manually update the certificates through some other means?</li>
<li>Try to download things outside of the image (ala <a href="https://github.com/rust-lang/rust/issues/90457">#90457</a>)? Not sure if that's even possible.</li>
<li>Other options?</li>
</ul>



<a name="260170718"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/expired%20certificates/near/260170718" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/expired.20certificates.html#260170718">(Nov 03 2021 at 17:44)</a>:</h4>
<p>I think generally it probably is OK to bump the minimum version of ubuntu (to the next lts, 18.04, probably)</p>



<a name="260170770"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/expired%20certificates/near/260170770" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/expired.20certificates.html#260170770">(Nov 03 2021 at 17:45)</a>:</h4>
<p>but <a href="https://github.com/rust-lang/rust/pull/90457">https://github.com/rust-lang/rust/pull/90457</a> where possible does seem potentially preferable</p>



<a name="260171423"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/expired%20certificates/near/260171423" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/expired.20certificates.html#260171423">(Nov 03 2021 at 17:50)</a>:</h4>
<p><span class="user-mention" data-user-id="120518">@Eric Huss</span> It's almost certainly safe to just update the ca-certificates package.</p>



<a name="260171477"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/expired%20certificates/near/260171477" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/expired.20certificates.html#260171477">(Nov 03 2021 at 17:50)</a>:</h4>
<p><span class="user-mention" data-user-id="239881">@Josh Triplett</span> How do you do that from ubuntu 16?  The newest ca-certificates it has is too old.</p>



<a name="260171588"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/expired%20certificates/near/260171588" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/expired.20certificates.html#260171588">(Nov 03 2021 at 17:51)</a>:</h4>
<p>It doesn't seem significantly better than <a href="https://github.com/rust-lang/rust/issues/90457">#90457</a> which feels like it probably maps OK to dist-aarch64 too?</p>



<a name="260171997"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/expired%20certificates/near/260171997" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/expired.20certificates.html#260171997">(Nov 03 2021 at 17:54)</a>:</h4>
<p><span class="user-mention silent" data-user-id="120518">Eric Huss</span> <a href="#narrow/stream/242791-t-infra/topic/expired.20certificates/near/260171477">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> How do you do that from ubuntu 16?  The newest ca-certificates it has is too old.</p>
</blockquote>
<p>You'd grab the ca-certificates package from a newer distribution and <code>dpkg -i</code>.</p>



<a name="260174549"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/expired%20certificates/near/260174549" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/expired.20certificates.html#260174549">(Nov 03 2021 at 18:11)</a>:</h4>
<p>how do we check its integrity?</p>



<a name="260180034"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/expired%20certificates/near/260180034" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/expired.20certificates.html#260180034">(Nov 03 2021 at 18:51)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/issues/90457">#90457</a> downloads <code>cacert.pem</code> from <a href="https://curl.se/ca/cacert.pem">https://curl.se/ca/cacert.pem</a>, using ubuntu 20, so it is depending on the certificate validation from there.  Otherwise there isn't any additional verification.  </p>
<p>I tested out that approach and it seems to work.  When I have time later today, I'll try to put together a fix with that approach, and check which images need that.</p>
<p>I tried updating to ubuntu 18, but it requires updating the crosstools config, and I don't feel like digging into that.</p>



<a name="260233046"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/expired%20certificates/near/260233046" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/expired.20certificates.html#260233046">(Nov 04 2021 at 06:13)</a>:</h4>
<p>what's the site you're trying to reach? I'm curious if this is related to the DST Root CA X3 expiration recently. If so there are a couple of other hacks/workarounds, one of which is simply removing (or blocklisting) the expired DST Root CA X3 from your certificate store.</p>
<p><a href="https://letsencrypt.org/2021/10/01/cert-chaining-help.html">https://letsencrypt.org/2021/10/01/cert-chaining-help.html</a><br>
<a href="https://www.openssl.org/blog/blog/2021/09/13/LetsEncryptRootCertExpire/">https://www.openssl.org/blog/blog/2021/09/13/LetsEncryptRootCertExpire/</a></p>



<a name="260273531"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/expired%20certificates/near/260273531" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/expired.20certificates.html#260273531">(Nov 04 2021 at 14:04)</a>:</h4>
<p>Yea, it is connecting to <a href="http://www.kernel.org">www.kernel.org</a>, and getting the X3 cert which expired on Sep 30.</p>



<a name="260344622"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/expired%20certificates/near/260344622" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/expired.20certificates.html#260344622">(Nov 04 2021 at 22:41)</a>:</h4>
<p>So, workaround 1 from the openssl page (blocklist the DST Root CA X3) might wind up being easier to execute than updating the whole ca-certificates package on the docker image.</p>



<a name="260347820"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/expired%20certificates/near/260347820" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hans Kratz <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/expired.20certificates.html#260347820">(Nov 04 2021 at 23:16)</a>:</h4>
<p><span class="user-mention silent" data-user-id="315412">jsha</span> <a href="#narrow/stream/242791-t-infra/topic/expired.20certificates/near/260344622">said</a>:</p>
<blockquote>
<p>So, workaround 1 from the openssl page (blocklist the DST Root CA X3) might wind up being easier to execute than updating the whole ca-certificates package on the docker image.</p>
</blockquote>
<p>At least for the 10-year old Debian Squeeze distribution we use for dist-x86_64 and dist-i686, that was not enough. It needed the new ISRG Root X1 cert and then, when the <a href="http://python.org">python.org</a> certificate was updated, the new GlobalSign Root CA - R3. It is also so old that just installing ca-certificates.deb from the latest Debian would not work  out of the box, because that depends on a recent openssl.</p>



<a name="260354892"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/expired%20certificates/near/260354892" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jsha <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/expired.20certificates.html#260354892">(Nov 05 2021 at 00:58)</a>:</h4>
<p>Good to know! According to <a href="https://letsencrypt.org/docs/certificate-compatibility/">https://letsencrypt.org/docs/certificate-compatibility/</a>, ISRG Root X1 should be present in Ubuntu precise / 12.04 and Debian Jessie / 8 (provided all updates are installed)</p>



<a name="260459577"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/expired%20certificates/near/260459577" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/expired.20certificates.html#260459577">(Nov 05 2021 at 20:21)</a>:</h4>
<p><span class="user-mention" data-user-id="120518">@Eric Huss</span> <a href="http://kernel.org">kernel.org</a>? That definitely shouldn't be serving an expired cert. And they should be able to fix that...</p>



<a name="260461857"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/expired%20certificates/near/260461857" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/expired.20certificates.html#260461857">(Nov 05 2021 at 20:40)</a>:</h4>
<p>Not directly, the root ca</p>



<a name="260466812"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/expired%20certificates/near/260466812" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/expired.20certificates.html#260466812">(Nov 05 2021 at 21:26)</a>:</h4>
<p><span class="user-mention" data-user-id="239881">@Josh Triplett</span> No, I maybe phrased that poorly.  Let's Encrypt certs were cross-signed with the DST Root CA X3 root, which recently expired.  It looks like Ubuntu has a fix that removes the expired cert for their "ESM" release, but that is not public AFAIK?</p>



<a name="260467468"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/expired%20certificates/near/260467468" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/expired.20certificates.html#260467468">(Nov 05 2021 at 21:33)</a>:</h4>
<p>Oh, this is the cross-sign, not the primary signature?</p>



<a name="260467478"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/expired%20certificates/near/260467478" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/expired.20certificates.html#260467478">(Nov 05 2021 at 21:34)</a>:</h4>
<p>Yea.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>