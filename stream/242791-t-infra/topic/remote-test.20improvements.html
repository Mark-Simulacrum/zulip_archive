<html>
<head><meta charset="utf-8"><title>remote-test improvements · t-infra · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/index.html">t-infra</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/remote-test.20improvements.html">remote-test improvements</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="251231494"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/remote-test%20improvements/near/251231494" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/remote-test.20improvements.html#251231494">(Aug 30 2021 at 13:46)</a>:</h4>
<p>hey team! at work I'll need to improve remote-test (remote-test-client and remote-test-server, needed for running compiletests on separate VMs/machines), and since this is something that could be really useful for infra too I'd love to upstream all of the work</p>



<a name="251231609"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/remote-test%20improvements/near/251231609" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/remote-test.20improvements.html#251231609">(Aug 30 2021 at 13:47)</a>:</h4>
<p>namely, the improvements would allow us to easily setup CI for target-only platforms, as right now that's not really feasible with the current remote-test architecture (without authentication nor a way to proxy jobs to multiple servers)</p>



<a name="251231846"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/remote-test%20improvements/near/251231846" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/remote-test.20improvements.html#251231846">(Aug 30 2021 at 13:49)</a>:</h4>
<p>I prepared a doc with the changes I'd like to make, and I plan to bring it up for discussion during today's infra meeting: <a href="https://ferroussystems.hackmd.io/sGmIzJSoQyaRjKQtec0Pwg">https://ferroussystems.hackmd.io/sGmIzJSoQyaRjKQtec0Pwg</a></p>



<a name="251231979"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/remote-test%20improvements/near/251231979" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/remote-test.20improvements.html#251231979">(Aug 30 2021 at 13:50)</a>:</h4>
<p><span class="user-group-mention" data-user-group-id="2943">@T-infra</span> if you want to read it ahead of the meeting today ^</p>



<a name="251232171"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/remote-test%20improvements/near/251232171" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/remote-test.20improvements.html#251232171">(Aug 30 2021 at 13:51)</a>:</h4>
<p>(this would all be impl work I'd be doing, either in a private fork or in rust-lang/rust -- I see a need for it for infra too, and I'd love to upstream it, but if there is nobody with the bandwidth to review the changes I totally understand)</p>



<a name="251232311"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/remote-test%20improvements/near/251232311" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/remote-test.20improvements.html#251232311">(Aug 30 2021 at 13:52)</a>:</h4>
<p>Can we add a section or discussion of why we can't use ssh to proxy the relevant ports (I think TCP?) over to a different machine so we don't need to roll a whole auth scheme? It feels like the problem of "connect two machines with authentication" has sort of already been solved countless times and I'd rather not re-solve authentication in these crates without motivation to do so</p>



<a name="251232601"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/remote-test%20improvements/near/251232601" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kennytm <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/remote-test.20improvements.html#251232601">(Aug 30 2021 at 13:54)</a>:</h4>
<blockquote>
<p>Replace t!() with ?</p>
</blockquote>
<p>nitpick but i thought <code>t!(x)</code> is more like <code>x.unwrap()</code> + <code>#[track_caller]</code> than <code>x?</code> <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="251242110"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/remote-test%20improvements/near/251242110" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/remote-test.20improvements.html#251242110">(Aug 30 2021 at 14:57)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116122">simulacrum</span> <a href="#narrow/stream/242791-t-infra/topic/remote-test.20improvements/near/251232311">said</a>:</p>
<blockquote>
<p>Can we add a section or discussion of why we can't use ssh to proxy the relevant ports (I think TCP?) over to a different machine so we don't need to roll a whole auth scheme? It feels like the problem of "connect two machines with authentication" has sort of already been solved countless times and I'd rather not re-solve authentication in these crates without motivation to do so</p>
</blockquote>
<p>the two main reasons I proposed an auth command and a proxy are:</p>
<ul>
<li>it would remove the need to expose the server machines directly to the internet, as both CI and the servers would connect to the proxy</li>
<li>it would allow jobs from a single CI runner to be spread across multiple servers -- this is especially useful for embedded targets that will require flashing each program onto a physical board</li>
</ul>



<a name="251242382"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/remote-test%20improvements/near/251242382" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/remote-test.20improvements.html#251242382">(Aug 30 2021 at 14:59)</a>:</h4>
<p>(I don't have time to expand the doc before the meeting though)</p>



<a name="251258563"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/remote-test%20improvements/near/251258563" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/remote-test.20improvements.html#251258563">(Aug 30 2021 at 16:53)</a>:</h4>
<p>We can talk in meeting; I'm not opposed to adding multiplexing I think, though it feels like we should look at how this is done elsewhere (e.g., maybe we should switch to something like distcc or sccache or similar which both have remote execution built-in already)</p>



<a name="251364398"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/remote-test%20improvements/near/251364398" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/remote-test.20improvements.html#251364398">(Aug 31 2021 at 10:44)</a>:</h4>
<p><span class="user-mention" data-user-id="116122">@simulacrum</span> added a section on how others are doing it on the doc: <a href="https://ferroussystems.hackmd.io/sGmIzJSoQyaRjKQtec0Pwg">https://ferroussystems.hackmd.io/sGmIzJSoQyaRjKQtec0Pwg</a></p>



<a name="251385809"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/remote-test%20improvements/near/251385809" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/remote-test.20improvements.html#251385809">(Aug 31 2021 at 13:37)</a>:</h4>
<p>Hm, I guess it feels like I'm not considering the use of ssh (or similar) for encryption+auth to be connected to whether there's a proxy server implemented by us</p>



<a name="251385913"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/remote-test%20improvements/near/251385913" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/remote-test.20improvements.html#251385913">(Aug 31 2021 at 13:37)</a>:</h4>
<p>I'm not opposed to a proxy server impl -- it feels likely to be pretty simple to do the basic multiplexing there</p>



<a name="251386022"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/remote-test%20improvements/near/251386022" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/remote-test.20improvements.html#251386022">(Aug 31 2021 at 13:38)</a>:</h4>
<p>but I am hesitant for us to roll our own auth/encryption stack, particularly when it seems unnecessary</p>



<a name="251723069"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/remote-test%20improvements/near/251723069" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/remote-test.20improvements.html#251723069">(Sep 02 2021 at 14:21)</a>:</h4>
<p>hmm, I think wrapping the socket in TLS and adding a simple token authentication (similar to what crater does) is way less complicated than setting up ssh port forwarding, especially because then we need to make sure the ssh user can only perform port forwarding, and not other shell commands</p>



<a name="251723241"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/remote-test%20improvements/near/251723241" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/remote-test.20improvements.html#251723241">(Sep 02 2021 at 14:22)</a>:</h4>
<p>Hm, maybe. I always worry when dealing with hand-rolled encryption/auth, but maybe it's not too bad.</p>



<a name="251723251"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/remote-test%20improvements/near/251723251" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/remote-test.20improvements.html#251723251">(Sep 02 2021 at 14:22)</a>:</h4>
<p>which is not impossibly hard, but it's something that we need to do and anyone who wants to setup something similar needs to reimplement in their environment</p>



<a name="251723343"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/remote-test%20improvements/near/251723343" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/remote-test.20improvements.html#251723343">(Sep 02 2021 at 14:23)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116122">simulacrum</span> <a href="#narrow/stream/242791-t-infra/topic/remote-test.20improvements/near/251723241">said</a>:</p>
<blockquote>
<p>Hm, maybe. I always worry when dealing with hand-rolled encryption/auth, but maybe it's not too bad.</p>
</blockquote>
<p>in general I do too, but at least personally I don't consider "wrap the socket in TLS" to be hand-rolled encryption</p>



<a name="251723663"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/remote-test%20improvements/near/251723663" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/remote-test.20improvements.html#251723663">(Sep 02 2021 at 14:25)</a>:</h4>
<p>(there are still tweakable knobs that could make TLS less stronger to be clear, but those knobs exist for SSH too)</p>



<a name="251724545"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/remote-test%20improvements/near/251724545" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/remote-test.20improvements.html#251724545">(Sep 02 2021 at 14:30)</a>:</h4>
<p>Sure, yeah. I guess it's probably fairly OK -- we already ship a client needing tls in Cargo, so it's not that different.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>