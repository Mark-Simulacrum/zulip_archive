<html>
<head><meta charset="utf-8"><title>async in bootstrap? · t-infra · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/index.html">t-infra</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/async.20in.20bootstrap.3F.html">async in bootstrap?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="254844776"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/async%20in%20bootstrap%3F/near/254844776" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/async.20in.20bootstrap.3F.html#254844776">(Sep 25 2021 at 14:40)</a>:</h4>
<p>Opinions on adding some async runtime to bootstrap? I think there's some potential to execute steps in parallel but getting <code>ensure()</code> to juggle the output values of multiple tasks starts to look a lot like futures. The other option is to handroll it with a blocking thread per step and converting all cells to mutexes.</p>



<a name="254845406"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/async%20in%20bootstrap%3F/near/254845406" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/async.20in.20bootstrap.3F.html#254845406">(Sep 25 2021 at 14:49)</a>:</h4>
<p>I don't think we should be trying to execute steps in parallel at this point -- most of the steps are inherently internally parallel already, though, so the intent is that singlethreaded bootstrap is fine.</p>
<p>Can you say more about why you want to parallelize steps, or which ones?</p>



<a name="254845492"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/async%20in%20bootstrap%3F/near/254845492" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/async.20in.20bootstrap.3F.html#254845492">(Sep 25 2021 at 14:50)</a>:</h4>
<p>well, it's mostly that I see cpu utilization often dropping to 1 or a few cores during builds, leaving throughput on the table where some of the smaller steps could fit in</p>



<a name="254845629"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/async%20in%20bootstrap%3F/near/254845629" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/async.20in.20bootstrap.3F.html#254845629">(Sep 25 2021 at 14:52)</a>:</h4>
<p>Which steps does it drop down to 1 in, and which steps could fill in? Most of the time my expectation is that this happens e.g. during rustc compilation and you <em>could</em> be building compiletest, but that is a pretty rare thing to actually occur in practice</p>



<a name="254845636"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/async%20in%20bootstrap%3F/near/254845636" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/async.20in.20bootstrap.3F.html#254845636">(Sep 25 2021 at 14:52)</a>:</h4>
<p>(since compiletest is cached off bootstrap)</p>



<a name="254845744"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/async%20in%20bootstrap%3F/near/254845744" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/async.20in.20bootstrap.3F.html#254845744">(Sep 25 2021 at 14:54)</a>:</h4>
<p>yeah, building rustc would be one case. rustdoc too iirc or some of the other tools. I haven't made a list.</p>



<a name="254845799"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/async%20in%20bootstrap%3F/near/254845799" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/async.20in.20bootstrap.3F.html#254845799">(Sep 25 2021 at 14:55)</a>:</h4>
<p>but what are you expecting to put in that slot?</p>



<a name="254845812"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/async%20in%20bootstrap%3F/near/254845812" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/async.20in.20bootstrap.3F.html#254845812">(Sep 25 2021 at 14:55)</a>:</h4>
<p>like, just because CPU is not 100% doesn't mean we have something to fill in with, necessarily</p>



<a name="254845907"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/async%20in%20bootstrap%3F/near/254845907" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/async.20in.20bootstrap.3F.html#254845907">(Sep 25 2021 at 14:57)</a>:</h4>
<p>FWIW, we do upload CPU usage metrics from our CI builders, e.g., here are the x86_64-gnu and dist-x86_64-linux builders respectively</p>
<p><a href="/user_uploads/4715/Rv6EDcHK2urRehrZMhdNrtrB/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/Rv6EDcHK2urRehrZMhdNrtrB/image.png" title="image.png"><img src="/user_uploads/4715/Rv6EDcHK2urRehrZMhdNrtrB/image.png"></a></div><p><a href="/user_uploads/4715/HmeQGfNLhuTAE656nR4R9P1b/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/HmeQGfNLhuTAE656nR4R9P1b/image.png" title="image.png"><img src="/user_uploads/4715/HmeQGfNLhuTAE656nR4R9P1b/image.png"></a></div>



<a name="254845984"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/async%20in%20bootstrap%3F/near/254845984" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/async.20in.20bootstrap.3F.html#254845984">(Sep 25 2021 at 14:58)</a>:</h4>
<p>how many cores? amdahl's law gets worse when you have more.</p>



<a name="254845988"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/async%20in%20bootstrap%3F/near/254845988" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/async.20in.20bootstrap.3F.html#254845988">(Sep 25 2021 at 14:58)</a>:</h4>
<p>to some extent, improving these via targeted adjustments in bootstrap is fine -- but I think parallelism on the bootstrap layer would add quite a bit of complexity</p>



<a name="254845995"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/async%20in%20bootstrap%3F/near/254845995" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/async.20in.20bootstrap.3F.html#254845995">(Sep 25 2021 at 14:58)</a>:</h4>
<p>CI I think has 8? Not sure</p>



<a name="254846006"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/async%20in%20bootstrap%3F/near/254846006" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/async.20in.20bootstrap.3F.html#254846006">(Sep 25 2021 at 14:58)</a>:</h4>
<p>that's tiny</p>



<a name="254846048"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/async%20in%20bootstrap%3F/near/254846048" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/async.20in.20bootstrap.3F.html#254846048">(Sep 25 2021 at 14:59)</a>:</h4>
<p><a href="/user_uploads/4715/UecQL1MNsYJN4sQW3jCL5oQy/dist.png">dist.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/UecQL1MNsYJN4sQW3jCL5oQy/dist.png" title="dist.png"><img src="/user_uploads/4715/UecQL1MNsYJN4sQW3jCL5oQy/dist.png"></a></div>



<a name="254846064"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/async%20in%20bootstrap%3F/near/254846064" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/async.20in.20bootstrap.3F.html#254846064">(Sep 25 2021 at 14:59)</a>:</h4>
<p>but the core count doesn't really matter, in theory</p>



<a name="254846077"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/async%20in%20bootstrap%3F/near/254846077" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/async.20in.20bootstrap.3F.html#254846077">(Sep 25 2021 at 14:59)</a>:</h4>
<p>sequential bottlenecks mean lots of CPU-cycles left unused</p>



<a name="254846197"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/async%20in%20bootstrap%3F/near/254846197" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/async.20in.20bootstrap.3F.html#254846197">(Sep 25 2021 at 15:00)</a>:</h4>
<p>Sure? If you have concrete bottlenecks and stuff that can fill them, we can discuss how to avoid that -- my impression historically has been that most of those bottlenecks are not solvable through parallelism (we actually do have a dependency)</p>



<a name="254846239"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/async%20in%20bootstrap%3F/near/254846239" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/async.20in.20bootstrap.3F.html#254846239">(Sep 25 2021 at 15:01)</a>:</h4>
<p>or, if they are, then the parallelism need not be inside rustbuild (e.g., Cargo runs rustdoc --test and libtest "crates" sequentially today, but could in theory do so in parallel if we had jobserver integration inside libtest. But that's not trivial.)</p>



<a name="254846292"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/async%20in%20bootstrap%3F/near/254846292" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/async.20in.20bootstrap.3F.html#254846292">(Sep 25 2021 at 15:02)</a>:</h4>
<p>well, one issue is that when I do a stage 1 benchmark and change RUSTFLAGS it rebuilds everything, so some stage0 stuff could be built while it's doing stage1 rustc</p>



<a name="254846309"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/async%20in%20bootstrap%3F/near/254846309" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/async.20in.20bootstrap.3F.html#254846309">(Sep 25 2021 at 15:02)</a>:</h4>
<p>you mean like compiletest and such?</p>



<a name="254846311"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/async%20in%20bootstrap%3F/near/254846311" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/async.20in.20bootstrap.3F.html#254846311">(Sep 25 2021 at 15:02)</a>:</h4>
<p>Yeah, I mean, that's true</p>



<a name="254846313"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/async%20in%20bootstrap%3F/near/254846313" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/async.20in.20bootstrap.3F.html#254846313">(Sep 25 2021 at 15:02)</a>:</h4>
<p>yeah</p>



<a name="254846358"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/async%20in%20bootstrap%3F/near/254846358" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/async.20in.20bootstrap.3F.html#254846358">(Sep 25 2021 at 15:03)</a>:</h4>
<p>to some extent that's because we don't have a great way to thread rustflags through in a way that doesn't affect compiletest (which you probably don't <em>actually</em> want to recompile)</p>



<a name="254846487"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/async%20in%20bootstrap%3F/near/254846487" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/async.20in.20bootstrap.3F.html#254846487">(Sep 25 2021 at 15:04)</a>:</h4>
<p>but rustbuild already is not the best at managing to keep track of dependency edges in a sequential world, I think parallelism would just make the amount of bugs we have even worse. It'd also make it harder for users to understand what is going on and increase memory requirements, so it's not a win for everyone.</p>



<a name="254846598"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/async%20in%20bootstrap%3F/near/254846598" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/async.20in.20bootstrap.3F.html#254846598">(Sep 25 2021 at 15:06)</a>:</h4>
<p>yeah it would definitely have to be opt in. I tried cobbling something together with threads and it's several screens full of mutex poisons :D</p>



<a name="254846741"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/async%20in%20bootstrap%3F/near/254846741" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/async.20in.20bootstrap.3F.html#254846741">(Sep 25 2021 at 15:08)</a>:</h4>
<p>and I'm very wary of increasing rustbuild compile times, fwiw</p>



<a name="254846748"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/async%20in%20bootstrap%3F/near/254846748" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/async.20in.20bootstrap.3F.html#254846748">(Sep 25 2021 at 15:08)</a>:</h4>
<p>Another case are the tool builds during <code>dist</code>. It doesn't affect me much since I don't do it often but it could speed up CI.</p>



<a name="254847594"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/async%20in%20bootstrap%3F/near/254847594" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/async.20in.20bootstrap.3F.html#254847594">(Sep 25 2021 at 15:21)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116122">simulacrum</span> <a href="#narrow/stream/242791-t-infra/topic/async.20in.20bootstrap.3F/near/254846741">said</a>:</p>
<blockquote>
<p>and I'm very wary of increasing rustbuild compile times, fwiw</p>
</blockquote>
<p>oh speaking of which - I had some ideas about decreasing compile times for rustbuild itself the other day and forgot to write them down. In particular I remember</p>
<ul>
<li>bootstrap.py rebuilds when config.toml changes (maybe it's trying to apply debug assertions to rustbuild itself or something?)</li>
<li>bootstrap.py uses <code>-Cdebuginfo=2</code> which presumably slows things down - do we actually need debug info? and if so, can we bring it down to debuginfo=1 instead?</li>
<li>bootstrap.py applies <code>-Cdebuginfo=2</code> to all dependencies, not just bootstrap itself - this definitely seems unnecessary</li>
</ul>



<a name="254853516"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/async%20in%20bootstrap%3F/near/254853516" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/async.20in.20bootstrap.3F.html#254853516">(Sep 25 2021 at 16:53)</a>:</h4>
<p>only line tables are probably fine</p>



<a name="254853526"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/async%20in%20bootstrap%3F/near/254853526" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/async.20in.20bootstrap.3F.html#254853526">(Sep 25 2021 at 16:53)</a>:</h4>
<p>we added debuginfo because otherwise people seeing panics in the wild is a lost cause to debug</p>



<a name="254853545"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/async%20in%20bootstrap%3F/near/254853545" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/async.20in.20bootstrap.3F.html#254853545">(Sep 25 2021 at 16:53)</a>:</h4>
<p>you mean rustbuild panics? those seem pretty rare</p>



<a name="254853600"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/async%20in%20bootstrap%3F/near/254853600" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/async.20in.20bootstrap.3F.html#254853600">(Sep 25 2021 at 16:54)</a>:</h4>
<p>yeah, they're rarer now, but I think it's worth keeping at least =1</p>



<a name="254853609"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/async%20in%20bootstrap%3F/near/254853609" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/async.20in.20bootstrap.3F.html#254853609">(Sep 25 2021 at 16:54)</a>:</h4>
<p>we also probably want it for build_helper, fwiw</p>



<a name="254853625"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/async%20in%20bootstrap%3F/near/254853625" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/async.20in.20bootstrap.3F.html#254853625">(Sep 25 2021 at 16:54)</a>:</h4>
<p>(mainly to make sure backtraces are ok)</p>



<a name="254853635"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/async%20in%20bootstrap%3F/near/254853635" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/async.20in.20bootstrap.3F.html#254853635">(Sep 25 2021 at 16:54)</a>:</h4>
<p>I wish cargo had an option for "apply these flags to all crates in the workspace"</p>



<a name="254853656"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/async%20in%20bootstrap%3F/near/254853656" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/async.20in.20bootstrap.3F.html#254853656">(Sep 25 2021 at 16:55)</a>:</h4>
<p>the only knobs I know are RUSTFLAGS and <code>cargo rustc</code></p>



<a name="254853660"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/async%20in%20bootstrap%3F/near/254853660" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/async.20in.20bootstrap.3F.html#254853660">(Sep 25 2021 at 16:55)</a>:</h4>
<p>you can do it within Cargo.toml, I believe</p>



<a name="254853667"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/async%20in%20bootstrap%3F/near/254853667" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/async.20in.20bootstrap.3F.html#254853667">(Sep 25 2021 at 16:55)</a>:</h4>
<p>oh good point <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="254853671"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/async%20in%20bootstrap%3F/near/254853671" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/async.20in.20bootstrap.3F.html#254853671">(Sep 25 2021 at 16:55)</a>:</h4>
<p>not sure about workspace, but definitely individual crates</p>



<a name="254853742"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/async%20in%20bootstrap%3F/near/254853742" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/async.20in.20bootstrap.3F.html#254853742">(Sep 25 2021 at 16:56)</a>:</h4>
<p>yeah you can do non-workspace, so by resetting everything can do workspace: <a href="https://doc.rust-lang.org/cargo/reference/profiles.html#overrides">https://doc.rust-lang.org/cargo/reference/profiles.html#overrides</a></p>



<a name="254853754"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/async%20in%20bootstrap%3F/near/254853754" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/async.20in.20bootstrap.3F.html#254853754">(Sep 25 2021 at 16:56)</a>:</h4>
<p>I don't know that those are usable from env variables though, it'd be a bit of a pain otherwise</p>



<a name="254853871"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/async%20in%20bootstrap%3F/near/254853871" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/async.20in.20bootstrap.3F.html#254853871">(Sep 25 2021 at 16:58)</a>:</h4>
<p>nah you're right cargo.toml is a lot simpler, and then we can stop adding so many flags in bootstrap.py</p>



<a name="254859320"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/async%20in%20bootstrap%3F/near/254859320" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/async.20in.20bootstrap.3F.html#254859320">(Sep 25 2021 at 18:17)</a>:</h4>
<p>I think env variables override it but since we're not really doing anything with rustbuild (e.g., no dist) it seems ok for config.toml to not affect it.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>