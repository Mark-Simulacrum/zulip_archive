<html>
<head><meta charset="utf-8"><title>windows ci borked · t-infra · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/index.html">t-infra</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html">windows ci borked</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="252670872"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252670872" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252670872">(Sep 09 2021 at 18:16)</a>:</h4>
<p><span class="user-mention" data-user-id="116122">@simulacrum</span> Does the <code>__umulh</code> error look familiar to you?</p>



<a name="252670997"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252670997" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252670997">(Sep 09 2021 at 18:17)</a>:</h4>
<p>No, seems new</p>



<a name="252671017"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252671017" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252671017">(Sep 09 2021 at 18:17)</a>:</h4>
<p>Maybe an update to the windows runners environment?</p>



<a name="252671753"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252671753" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252671753">(Sep 09 2021 at 18:22)</a>:</h4>
<p>Looks like it was updated yesterday.</p>



<a name="252671821"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252671821" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252671821">(Sep 09 2021 at 18:22)</a>:</h4>
<p>but nothing obvious looks like a culprit</p>



<a name="252671870"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252671870" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252671870">(Sep 09 2021 at 18:22)</a>:</h4>
<p>hm</p>



<a name="252671900"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252671900" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252671900">(Sep 09 2021 at 18:23)</a>:</h4>
<p>I likely won't have time to investigate too much today/tomorrow, unfortunately</p>



<a name="252671956"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252671956" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252671956">(Sep 09 2021 at 18:23)</a>:</h4>
<p>i'll keep looking</p>
<p>Oh, they updated windows 10 sdk</p>



<a name="252671961"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252671961" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252671961">(Sep 09 2021 at 18:23)</a>:</h4>
<p>Microsoft.VisualStudio.Component.Windows10SDK.20348</p>



<a name="252672091"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252672091" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252672091">(Sep 09 2021 at 18:24)</a>:</h4>
<p>we can probably rustbot ping windows on the PR</p>



<a name="252672401"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252672401" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252672401">(Sep 09 2021 at 18:26)</a>:</h4>
<p>Oh, it looks like all PRs are failing, I didn't notice.</p>



<a name="252672414"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252672414" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252672414">(Sep 09 2021 at 18:26)</a>:</h4>
<p>Should probably close the tree.</p>



<a name="252677437"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252677437" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252677437">(Sep 09 2021 at 19:01)</a>:</h4>
<p>haha:</p>
<p>Clang/LLVM for Windows v11 targeting ARM64 is not compatible with the latest winnt.h</p>
<p>As a workaround, use the previous version of the Windows 10 SDK (build 19041), or clang/LLVM for Windows v10 when targeting ARM64 platforms</p>



<a name="252677525"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252677525" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252677525">(Sep 09 2021 at 19:01)</a>:</h4>
<p>Don't suppose anyone happens do know how to control which version of the SDK is used?</p>



<a name="252677957"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252677957" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252677957">(Sep 09 2021 at 19:04)</a>:</h4>
<p>Hm. Not sure we have control of that.</p>



<a name="252678236"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252678236" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252678236">(Sep 09 2021 at 19:06)</a>:</h4>
<p>Are we using clang for windows 11 though?</p>



<a name="252678251"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252678251" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252678251">(Sep 09 2021 at 19:06)</a>:</h4>
<p>I'd... not expect us to be doing that</p>



<a name="252678566"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252678566" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252678566">(Sep 09 2021 at 19:08)</a>:</h4>
<p>I don't know what "LLVM for Windows v11" means specifically.</p>



<a name="252679015"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252679015" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252679015">(Sep 09 2021 at 19:11)</a>:</h4>
<p>For reference, I'm reading the release notes here: <a href="https://developer.microsoft.com/en-us/windows/downloads/windows-10-sdk/#serverdev">https://developer.microsoft.com/en-us/windows/downloads/windows-10-sdk/#serverdev</a></p>



<a name="252679821"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252679821" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252679821">(Sep 09 2021 at 19:17)</a>:</h4>
<p>So I'm thinking that it may need to pass the SDK version to <code>vcvarsall.bat</code> if we were to go the route of downgrading.</p>



<a name="252690250"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252690250" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252690250">(Sep 09 2021 at 20:30)</a>:</h4>
<p>Is there a better place to coordinate the fix for this, and other people to possibly rope in?</p>



<a name="252690268"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252690268" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252690268">(Sep 09 2021 at 20:30)</a>:</h4>
<p>I'm able to reproduce the NatVis error locally.</p>



<a name="252699553"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252699553" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252699553">(Sep 09 2021 at 21:32)</a>:</h4>
<p>I'm going to write up a summary issue, but otherwise I'll probably not be able to investigate more.  Hopefully we can find a way to fix it without using vcvarsall, since running that is awkward.</p>



<a name="252699790"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252699790" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252699790">(Sep 09 2021 at 21:34)</a>:</h4>
<p>also looking into it now, but not sure if i can be of much help</p>



<a name="252699837"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252699837" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252699837">(Sep 09 2021 at 21:35)</a>:</h4>
<p>(staring at <a href="https://github.com/rust-lang/rust/blob/497ee321af3b8496eaccd7af7b437f18bab81abf/library/profiler_builtins/build.rs#L37-L45">these lines</a> now)</p>



<a name="252700708"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252700708" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252700708">(Sep 09 2021 at 21:42)</a>:</h4>
<p>(and <a href="https://bugs.llvm.org/show_bug.cgi?id=51128">this bug report</a>)</p>



<a name="252701252"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252701252" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252701252">(Sep 09 2021 at 21:46)</a>:</h4>
<p>Posted <a href="https://github.com/rust-lang/rust/issues/88796">#88796</a> with a summary.</p>



<a name="252701865"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252701865" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252701865">(Sep 09 2021 at 21:51)</a>:</h4>
<p>oh, the pipeline links have expired</p>



<a name="252702055"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252702055" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252702055">(Sep 09 2021 at 21:53)</a>:</h4>
<p>oh, that's silly</p>



<a name="252702109"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252702109" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252702109">(Sep 09 2021 at 21:53)</a>:</h4>
<p>Randomly, I was looking at some Appveyor runs for rust from <em>3 years ago</em> and the logs were still there, and were like 10x faster than GitHub's UI.</p>



<a name="252703380"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252703380" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252703380">(Sep 09 2021 at 22:05)</a>:</h4>
<p>this looks helpful: &lt;<a href="https://github.com/slurps-mad-rips/VCVars">https://github.com/slurps-mad-rips/VCVars</a>&gt;</p>



<a name="252703930"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252703930" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252703930">(Sep 09 2021 at 22:10)</a>:</h4>
<p>I installed Windows 10 SDK 20348, but for the life of me I can't get it to fail to build aarch64 with profilers enabled.  I'm using msvc build tools instead of Visual Studio Enterprise, so I'm not sure if that is a significant difference.</p>



<a name="252709577"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252709577" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252709577">(Sep 09 2021 at 23:06)</a>:</h4>
<p>trying some stuff here: <a href="https://github.com/rust-lang/rust/pull/88797">https://github.com/rust-lang/rust/pull/88797</a></p>



<a name="252709618"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252709618" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252709618">(Sep 09 2021 at 23:07)</a>:</h4>
<p>(now with help from @slurps-mad-rips)</p>



<a name="252716441"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252716441" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252716441">(Sep 10 2021 at 00:35)</a>:</h4>
<p><span class="user-mention" data-user-id="310399">@Mara</span> Any luck?</p>
<p>I took a quick peek at your experiment.  I <em>think</em> you only need to set the host as amd64, and leave the target unset (or maybe set to amd64).  Those affect the defaults, and cmake and other tools will set the target when needed.  At least, that's how it worked in my local testing building for arm64.</p>



<a name="252716504"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252716504" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252716504">(Sep 10 2021 at 00:36)</a>:</h4>
<p>izzy is saying that we can just use cmake to do this for us instead of using vcvars</p>



<a name="252716516"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252716516" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252716516">(Sep 10 2021 at 00:36)</a>:</h4>
<p>Ah, that would be great.</p>



<a name="252716999"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252716999" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252716999">(Sep 10 2021 at 00:43)</a>:</h4>
<p>the problem is that it first builds a compiler for x64, and then builds a compiler for arm64. if we use vcvars, only one of them will work. (or we'll have to switch in the middle)</p>



<a name="252717009"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252717009" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252717009">(Sep 10 2021 at 00:43)</a>:</h4>
<p>but cmake already supports <code>-D CMAKE_VS_WINDOWS_TARGET_PLATFORM_VERSION</code> for this</p>



<a name="252717010"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252717010" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252717010">(Sep 10 2021 at 00:43)</a>:</h4>
<p>so trying that out now</p>



<a name="252717143"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252717143" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252717143">(Sep 10 2021 at 00:45)</a>:</h4>
<p>Oh, that sounds perfect, I hadn't seen that option.  Hopefully it works.</p>
<p>I would also mention that the debugger tests will still probably fail, and I would suggest just disabling them and open a new issue to track fixing it.</p>



<a name="252717264"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252717264" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252717264">(Sep 10 2021 at 00:47)</a>:</h4>
<p>yeah, not going to try to solve that for now</p>



<a name="252717270"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252717270" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252717270">(Sep 10 2021 at 00:47)</a>:</h4>
<p>once this part passes i'm going to sleep</p>



<a name="252717275"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252717275" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252717275">(Sep 10 2021 at 00:47)</a>:</h4>
<p>almost 3 am here <span aria-label="zzz" class="emoji emoji-1f4a4" role="img" title="zzz">:zzz:</span></p>



<a name="252717386"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252717386" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252717386">(Sep 10 2021 at 00:49)</a>:</h4>
<p>oh bleh. <code>rust/library/profiler_builtins</code> is not built by cmake. but directly with the <code>cc</code> crate.</p>



<a name="252717513"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252717513" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252717513">(Sep 10 2021 at 00:51)</a>:</h4>
<p>okay, i give up for now. time to sleep</p>



<a name="252732745"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252732745" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252732745">(Sep 10 2021 at 04:57)</a>:</h4>
<p>I did a little more poking and understand the situation a little better. profiler_builtins is using LLVM 12.0.0 clang-cl, and AFAIK, <code>clang-cl</code> does not honor the WindowsSDKVersion environment variables set by vcvarsall. Newer versions support setting it in flags via <a href="https://reviews.llvm.org/D95472">https://reviews.llvm.org/D95472</a> (which also nicely added some FIXMEs to add env var support). I'm a bit at a loss on how to set the appropriate paths with 12.0. If I am reading it correctly, it only looks at the registry entry. Maybe ci.yml should try setting the registry entry?</p>



<a name="252762303"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252762303" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252762303">(Sep 10 2021 at 10:08)</a>:</h4>
<p>oh, ugh, yeah. that's a problem. there's almost no way to influence that version of clang-cl to pick another sdk. :/</p>



<a name="252763094"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252763094" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252763094">(Sep 10 2021 at 10:16)</a>:</h4>
<p>i can't find a way to make it stop using it. even if i <code>rm -rf</code> that sdk, it still tries to use it and just fails to find include files.<br>
so now i'm just removing that directory, and renaming the old sdk to the new name so it'll be used instead. super ugly, but it might work :/</p>



<a name="252774650"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252774650" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252774650">(Sep 10 2021 at 11:59)</a>:</h4>
<p><span class="user-mention" data-user-id="116122">@simulacrum</span> <span class="user-mention" data-user-id="121055">@Pietro Albini</span> here's a horrible workaround for unblocking the CI for now: <a href="https://github.com/rust-lang/rust/pull/88797">https://github.com/rust-lang/rust/pull/88797</a></p>



<a name="252774937"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252774937" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252774937">(Sep 10 2021 at 12:00)</a>:</h4>
<p>This topic was moved here from <a class="stream-topic" data-stream-id="241545" href="/#narrow/stream/241545-t-release/topic/beta.20rollup">#t-release &gt; beta rollup</a> by <span class="user-mention silent" data-user-id="310399">Mara</span></p>



<a name="252778336"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252778336" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252778336">(Sep 10 2021 at 12:26)</a>:</h4>
<p>ok approved</p>



<a name="252780790"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252780790" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252780790">(Sep 10 2021 at 12:45)</a>:</h4>
<p>i'm not the right person to try to find a better way to do this though, so someone else will have to follow up to remove the hack. are there any windows experts in the infra team?</p>



<a name="252780852"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252780852" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252780852">(Sep 10 2021 at 12:46)</a>:</h4>
<p>no</p>



<a name="252780897"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252780897" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252780897">(Sep 10 2021 at 12:46)</a>:</h4>
<p>I'll check in after work</p>



<a name="252796958"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252796958" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252796958">(Sep 10 2021 at 14:39)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="310399">@Mara</span> for making a fix!  </p>
<p>It's curious that just removing the directory didn't work completely.  If I am reading <a href="https://github.com/llvm/llvm-project/blob/llvmorg-12.0.0/clang/lib/Driver/ToolChains/MSVC.cpp#L1067-L1093"><code>getWindows10SDKVersionFromPath</code></a> correctly, it <em>should</em> be scanning the <code>Include</code> directory for the largest numbered version.</p>



<a name="252797094"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252797094" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252797094">(Sep 10 2021 at 14:40)</a>:</h4>
<p>yeah,that part probably works but something else probably refers to that directory too</p>



<a name="252797101"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252797101" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252797101">(Sep 10 2021 at 14:40)</a>:</h4>
<p>idk</p>



<a name="252828728"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252828728" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252828728">(Sep 10 2021 at 18:25)</a>:</h4>
<p>oh hey, it was merged. <span aria-label="relieved" class="emoji emoji-1f60c" role="img" title="relieved">:relieved:</span></p>



<a name="252828756"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252828756" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252828756">(Sep 10 2021 at 18:25)</a>:</h4>
<p>hopefully we can have a few succesful big rollups now to get through the huge queue</p>



<a name="252828974"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252828974" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252828974">(Sep 10 2021 at 18:27)</a>:</h4>
<p>I would be cautious -- big rollups sounds like a pain for perf. The queue seems like it'll sort itself out, and we can go for smaller rollups without too much pain.</p>



<a name="252830857"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/windows%20ci%20borked/near/252830857" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/windows.20ci.20borked.html#252830857">(Sep 10 2021 at 18:40)</a>:</h4>
<p>also I would like to get <a href="https://github.com/rust-lang/rust/pull/87073">https://github.com/rust-lang/rust/pull/87073</a> merged soonish and it can't be rolled up</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>