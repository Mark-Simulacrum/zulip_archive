<html>
<head><meta charset="utf-8"><title>Cancelled · t-infra · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/index.html">t-infra</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/Cancelled.html">Cancelled</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="225284404"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/Cancelled/near/225284404" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/Cancelled.html#225284404">(Feb 05 2021 at 10:56)</a>:</h4>
<p>Every single CI run on <code>rust-lang/rust</code> now ends after just seconds with</p>
<div class="codehilite"><pre><span></span><code>Error: The operation was canceled.
</code></pre></div>



<a name="225285502"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/Cancelled/near/225285502" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/Cancelled.html#225285502">(Feb 05 2021 at 11:08)</a>:</h4>
<p>Apparently <code>rust-lang/simpleinfra/github-actions/cancel-outdated-builds</code> is cancelling everything unconditionally: <a href="https://github.com/rust-lang/rust/pull/81783">https://github.com/rust-lang/rust/pull/81783</a></p>



<a name="225285585"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/Cancelled/near/225285585" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/Cancelled.html#225285585">(Feb 05 2021 at 11:09)</a>:</h4>
<p><span class="user-group-mention" data-user-group-id="2943">@T-infra</span> ^</p>



<a name="225285614"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/Cancelled/near/225285614" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/Cancelled.html#225285614">(Feb 05 2021 at 11:10)</a>:</h4>
<p>did CI just batch a month's worth of failures in a day?</p>



<a name="225285617"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/Cancelled/near/225285617" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/Cancelled.html#225285617">(Feb 05 2021 at 11:10)</a>:</h4>
<p>gah</p>



<a name="225285725"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/Cancelled/near/225285725" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/Cancelled.html#225285725">(Feb 05 2021 at 11:10)</a>:</h4>
<p><span class="user-mention" data-user-id="310399">@Mara</span> give me a couple minutes and I'll take a look</p>



<a name="225287075"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/Cancelled/near/225287075" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/Cancelled.html#225287075">(Feb 05 2021 at 11:26)</a>:</h4>
<p>ok I'll try to debug why the cancelling is happening</p>



<a name="225287092"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/Cancelled/near/225287092" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/Cancelled.html#225287092">(Feb 05 2021 at 11:27)</a>:</h4>
<p>disabling that could be really bad for our queue</p>



<a name="225287125"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/Cancelled/near/225287125" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/Cancelled.html#225287125">(Feb 05 2021 at 11:27)</a>:</h4>
<p>did it hit some github rate limit or something?</p>



<a name="225287213"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/Cancelled/near/225287213" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/Cancelled.html#225287213">(Feb 05 2021 at 11:28)</a>:</h4>
<p>it shouldn't cancel if it hit the rate limit, it wouldn't be able to hit the api call to cancel builds</p>



<a name="225287650"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/Cancelled/near/225287650" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/Cancelled.html#225287650">(Feb 05 2021 at 11:33)</a>:</h4>
<p>ok, so, I kinda found why this is happening</p>



<a name="225287711"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/Cancelled/near/225287711" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/Cancelled.html#225287711">(Feb 05 2021 at 11:34)</a>:</h4>
<p>cancel-outdated-builds makes an API call to (for example for your PR) <a href="https://api.github.com/repos/rust-lang/rust/commits/refs/pull/81781/merge">https://api.github.com/repos/rust-lang/rust/commits/refs/pull/81781/merge</a></p>



<a name="225287736"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/Cancelled/near/225287736" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/Cancelled.html#225287736">(Feb 05 2021 at 11:34)</a>:</h4>
<p>which fetches the latest merge commit for that PR</p>



<a name="225287757"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/Cancelled/near/225287757" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/Cancelled.html#225287757">(Feb 05 2021 at 11:34)</a>:</h4>
<p>which is <em>different</em> than the one used by github actions</p>



<a name="225287926"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/Cancelled/near/225287926" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/Cancelled.html#225287926">(Feb 05 2021 at 11:37)</a>:</h4>
<p>haha, yeah, i was just looking at the exact same thing. was about to look up an older succesful CI run to see the results there.</p>



<a name="225288038"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/Cancelled/near/225288038" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/Cancelled.html#225288038">(Feb 05 2021 at 11:38)</a>:</h4>
<p>Here it matches: <a href="https://github.com/rust-lang/rust/pull/81771/checks?check_run_id=1837585503">https://github.com/rust-lang/rust/pull/81771/checks?check_run_id=1837585503</a></p>
<div class="codehilite"><pre><span></span><code>GITHUB_REF=refs/pull/81771/merge
[...]
GITHUB_SHA=acf9c7bb219f0634075a6282f391ed01f1b29a6b
</code></pre></div>
<div class="codehilite"><pre><span></span><code>$ curl  https://api.github.com/repos/rust-lang/rust/commits/refs/pull/81771/merge -H &#39;Accept: application/vnd.github.v3.sha&#39;
acf9c7bb219f0634075a6282f391ed01f1b29a6b
</code></pre></div>



<a name="225288118"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/Cancelled/near/225288118" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/Cancelled.html#225288118">(Feb 05 2021 at 11:39)</a>:</h4>
<p>Did it get fixed? The latest PRs are running just fine now.</p>



<a name="225288172"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/Cancelled/near/225288172" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/Cancelled.html#225288172">(Feb 05 2021 at 11:40)</a>:</h4>
<p>hmm?</p>



<a name="225288185"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/Cancelled/near/225288185" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/Cancelled.html#225288185">(Feb 05 2021 at 11:40)</a>:</h4>
<p>I didn't change anything</p>



<a name="225288234"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/Cancelled/near/225288234" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/Cancelled.html#225288234">(Feb 05 2021 at 11:41)</a>:</h4>
<p>ok so my guess here is that github broke something on their end and they noticed it</p>



<a name="225288246"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/Cancelled/near/225288246" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/Cancelled.html#225288246">(Feb 05 2021 at 11:41)</a>:</h4>
<p>I'd say if it happens again we can disable <code>cancel-outdated-builds</code> for PRs only and ping github support about it</p>



<a name="225288317"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/Cancelled/near/225288317" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/Cancelled.html#225288317">(Feb 05 2021 at 11:42)</a>:</h4>
<p>Re-running <a href="https://github.com/rust-lang/rust/pull/81781/checks?check_run_id=1838449243">https://github.com/rust-lang/rust/pull/81781/checks?check_run_id=1838449243</a> still fails though.</p>
<p>It checks out <a href="https://github.com/rust-lang/rust/commit/573f1c059fe290d719fc444e3a3316f6954af578">573f1c059fe290d719fc444e3a3316f6954af578</a>, but sets <br>
GITHUB_SHA=1680bbb0a0503110e611dd950aa22ee8f62e0236.</p>



<a name="225288348"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/Cancelled/near/225288348" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/Cancelled.html#225288348">(Feb 05 2021 at 11:42)</a>:</h4>
<p>that's probably because re-running uses the same "job definition"</p>



<a name="225288372"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/Cancelled/near/225288372" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/Cancelled.html#225288372">(Feb 05 2021 at 11:43)</a>:</h4>
<p>so it always picks up the commit it was started with originally</p>



<a name="225288465"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/Cancelled/near/225288465" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/Cancelled.html#225288465">(Feb 05 2021 at 11:44)</a>:</h4>
<p>thanks for looking into this!</p>



<a name="225288470"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/Cancelled/near/225288470" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/Cancelled.html#225288470">(Feb 05 2021 at 11:44)</a>:</h4>
<p><code>16...</code> is the merge commit though, and <code>57..</code> is not. so github's merge refs were wrong?</p>



<a name="225289257"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/Cancelled/near/225289257" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/Cancelled.html#225289257">(Feb 05 2021 at 11:54)</a>:</h4>
<p><code>git fetch https://github.com/rust-lang/rust pull/81781/merge</code> locally gives <code>e796cb5e0dfd1d0e33f72d96ce73fec780431ee7</code>, but on CI gives <code>1680bbb0a0503110e611dd950aa22ee8f62e0236</code>.</p>



<a name="225289281"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/Cancelled/near/225289281" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/Cancelled.html#225289281">(Feb 05 2021 at 11:55)</a>:</h4>
<p>caching is hard, i guess.</p>



<a name="225289318"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/Cancelled/near/225289318" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/Cancelled.html#225289318">(Feb 05 2021 at 11:55)</a>:</h4>
<p>both of those have the exact same commit message (generated by github):</p>
<div class="codehilite"><pre><span></span><code>Merge 573f1c059fe290d719fc444e3a3316f6954af578 into 9e5d58fb420a487ae30f38141eccdc8d79fb8d58
</code></pre></div>



<a name="225289393"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/Cancelled/near/225289393" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/Cancelled.html#225289393">(Feb 05 2021 at 11:56)</a>:</h4>
<p>i don't think github is supposed to host two  different commits for the same generated PR merge ref. (:</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>