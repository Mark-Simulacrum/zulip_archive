<html>
<head><meta charset="utf-8"><title>msvc(?) builders running much slower · t-infra · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/index.html">t-infra</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc(.3F).20builders.20running.20much.20slower.html">msvc(?) builders running much slower</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="272615740"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%28%3F%29%20builders%20running%20much%20slower/near/272615740" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc(.3F).20builders.20running.20much.20slower.html#272615740">(Feb 20 2022 at 20:55)</a>:</h4>
<p>I noticed CI times were back up to ~4 hours and after some investigation it seems like the primary culprit is the dist-x86_64-msvc-alt builder, which seems to have somehow lost a bunch of parallelism several times over the last few months:</p>
<p><a href="/user_uploads/4715/qEZ-Q5MHXUG7zaExQq6Lnmqa/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/qEZ-Q5MHXUG7zaExQq6Lnmqa/image.png" title="image.png"><img src="/user_uploads/4715/qEZ-Q5MHXUG7zaExQq6Lnmqa/image.png"></a></div>



<a name="272615790"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%28%3F%29%20builders%20running%20much%20slower/near/272615790" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc(.3F).20builders.20running.20much.20slower.html#272615790">(Feb 20 2022 at 20:56)</a>:</h4>
<p>the -alt builder in particular has really dropped, but the non-alt builder is also not doing too great</p>



<a name="272615814"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%28%3F%29%20builders%20running%20much%20slower/near/272615814" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc(.3F).20builders.20running.20much.20slower.html#272615814">(Feb 20 2022 at 20:56)</a>:</h4>
<p>I'll try to spend some time investigating but wanted to start a thread in case someone has seen this elsewhere and has some immediate thoughts</p>



<a name="272616527"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%28%3F%29%20builders%20running%20much%20slower/near/272616527" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc(.3F).20builders.20running.20much.20slower.html#272616527">(Feb 20 2022 at 21:07)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/pull/93800">https://github.com/rust-lang/rust/pull/93800</a> seems to be the most recent loss -- but that PR doesn't have anything obvious to do with msvc</p>



<a name="272616743"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%28%3F%29%20builders%20running%20much%20slower/near/272616743" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc(.3F).20builders.20running.20much.20slower.html#272616743">(Feb 20 2022 at 21:10)</a>:</h4>
<p><span class="user-mention" data-user-id="121055">@Pietro Albini</span> what was the CI step extraction script/page you had again?</p>



<a name="272616761"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%28%3F%29%20builders%20running%20much%20slower/near/272616761" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc(.3F).20builders.20running.20much.20slower.html#272616761">(Feb 20 2022 at 21:11)</a>:</h4>
<p><a href="https://gist.github.com/pietroalbini/5be40788e4d7c8e44c06121b4da0b0ab">https://gist.github.com/pietroalbini/5be40788e4d7c8e44c06121b4da0b0ab</a></p>



<a name="272616772"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%28%3F%29%20builders%20running%20much%20slower/near/272616772" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc(.3F).20builders.20running.20much.20slower.html#272616772">(Feb 20 2022 at 21:11)</a>:</h4>
<p>thanks</p>



<a name="272616997"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%28%3F%29%20builders%20running%20much%20slower/near/272616997" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc(.3F).20builders.20running.20much.20slower.html#272616997">(Feb 20 2022 at 21:15)</a>:</h4>
<p>both stage 0 and stage 1 rustc step parallelism dropped by ~20% after that PR</p>



<a name="272617083"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%28%3F%29%20builders%20running%20much%20slower/near/272617083" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc(.3F).20builders.20running.20much.20slower.html#272617083">(Feb 20 2022 at 21:17)</a>:</h4>
<p>std build parallelism largely unchanged, so seems like the problem is presumably some kind of pathological code inside rustc in terms of IR verification or so?</p>



<a name="272617166"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%28%3F%29%20builders%20running%20much%20slower/near/272617166" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc(.3F).20builders.20running.20much.20slower.html#272617166">(Feb 20 2022 at 21:18)</a>:</h4>
<p>that is (I guess) msvc specific</p>



<a name="272617207"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%28%3F%29%20builders%20running%20much%20slower/near/272617207" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc(.3F).20builders.20running.20much.20slower.html#272617207">(Feb 20 2022 at 21:19)</a>:</h4>
<p>or at least windows -- it looks like we don't actually have a mingw-alt builder</p>



<a name="272617421"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%28%3F%29%20builders%20running%20much%20slower/near/272617421" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc(.3F).20builders.20running.20much.20slower.html#272617421">(Feb 20 2022 at 21:23)</a>:</h4>
<p>I filed <a href="https://github.com/rust-lang/rust/pull/94195">https://github.com/rust-lang/rust/pull/94195</a> to experiment with a revert</p>



<a name="272617425"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%28%3F%29%20builders%20running%20much%20slower/near/272617425" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc(.3F).20builders.20running.20much.20slower.html#272617425">(Feb 20 2022 at 21:23)</a>:</h4>
<p>going to see if I can figure out <em>which</em> crate caused the increase</p>



<a name="272617534"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%28%3F%29%20builders%20running%20much%20slower/near/272617534" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc(.3F).20builders.20running.20much.20slower.html#272617534">(Feb 20 2022 at 21:25)</a>:</h4>
<div class="codehilite"><pre><span></span><code>$ rg &#39;.*RUSTC-TIMING\] (\S+) test:(false|true) (.*)$&#39; --replace &#39;$3 $2 $1&#39; good.log | sort -rn | head
1240.363 false rustc_driver
1108.160 false rustc_driver
368.223 false rustc_query_impl
341.553 false rustc_middle
340.834 false rustc_query_impl
322.604 false rustc_resolve
308.015 false rustc_passes
306.273 false rustc_trait_selection
298.735 false rustc_metadata
295.064 false rustc_codegen_ssa

$ rg &#39;.*RUSTC-TIMING\] (\S+) test:(false|true) (.*)$&#39; --replace &#39;$3 $2 $1&#39; bad.log | sort -rn | head
4419.596 false rustc_middle
4191.318 false rustc_middle
989.570 false rustc_driver
985.791 false rustc_driver
421.908 false rustc_query_impl
334.079 false rustc_trait_selection
333.512 false rustc_query_impl
327.128 false rustc_passes
309.755 false rustc_resolve
284.912 false rustc_traits
</code></pre></div>



<a name="272617596"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%28%3F%29%20builders%20running%20much%20slower/near/272617596" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc(.3F).20builders.20running.20much.20slower.html#272617596">(Feb 20 2022 at 21:26)</a>:</h4>
<p>rustc_middle seems pretty clearly at the heart of the problem, moving from ~340 -&gt; 4000 seconds</p>



<a name="272617645"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%28%3F%29%20builders%20running%20much%20slower/near/272617645" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc(.3F).20builders.20running.20much.20slower.html#272617645">(Feb 20 2022 at 21:27)</a>:</h4>
<p>That PR did touch some code in rustc_middle, which is at least a positive sign in some senes</p>



<a name="272618038"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%28%3F%29%20builders%20running%20much%20slower/near/272618038" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc(.3F).20builders.20running.20much.20slower.html#272618038">(Feb 20 2022 at 21:34)</a>:</h4>
<p>Any ideas why there are jumps around Jan 1 and Jan 30?</p>



<a name="272618153"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%28%3F%29%20builders%20running%20much%20slower/near/272618153" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc(.3F).20builders.20running.20much.20slower.html#272618153">(Feb 20 2022 at 21:37)</a>:</h4>
<p>no</p>



<a name="272618161"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%28%3F%29%20builders%20running%20much%20slower/near/272618161" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc(.3F).20builders.20running.20much.20slower.html#272618161">(Feb 20 2022 at 21:37)</a>:</h4>
<p>those appear on other builders too, iirc</p>



<a name="272618300"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%28%3F%29%20builders%20running%20much%20slower/near/272618300" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc(.3F).20builders.20running.20much.20slower.html#272618300">(Feb 20 2022 at 21:39)</a>:</h4>
<p>all msvc builders:</p>
<p><a href="/user_uploads/4715/JZdBuKc5nWJLxsdgYhDjNNhz/image.png">image.png</a> </p>
<div class="message_inline_image"><a href="/user_uploads/4715/JZdBuKc5nWJLxsdgYhDjNNhz/image.png" title="image.png"><img src="/user_uploads/4715/JZdBuKc5nWJLxsdgYhDjNNhz/image.png"></a></div><p>looks like drops on those dates in dist-x86_64-msvc, dist-aarch64-msvc, and dist-x86_64-msvc-alt</p>



<a name="272621741"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%28%3F%29%20builders%20running%20much%20slower/near/272621741" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc(.3F).20builders.20running.20much.20slower.html#272621741">(Feb 20 2022 at 22:43)</a>:</h4>
<p>I think the big jump on Jan 30 was due to <a href="https://github.com/rust-lang/rust/issues/93482">#93482</a> which bumped to bootstrap compiler.</p>



<a name="272621920"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%28%3F%29%20builders%20running%20much%20slower/near/272621920" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc(.3F).20builders.20running.20much.20slower.html#272621920">(Feb 20 2022 at 22:46)</a>:</h4>
<p>The big jump on jan 1 started around <a href="https://github.com/rust-lang/rust/issues/92455">#92455</a>.  Not sure if that is a likely culprit.  Being on jan 1 seems conspicuous, as it could just as well be a change on GitHub's side.</p>



<a name="272622709"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%28%3F%29%20builders%20running%20much%20slower/near/272622709" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc(.3F).20builders.20running.20much.20slower.html#272622709">(Feb 20 2022 at 23:00)</a>:</h4>
<p>Deploying something new on Jan 1st wouldn't be my first choice, but I agree it seems plausible, though not really expected</p>



<a name="272622738"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%28%3F%29%20builders%20running%20much%20slower/near/272622738" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc(.3F).20builders.20running.20much.20slower.html#272622738">(Feb 20 2022 at 23:01)</a>:</h4>
<p>(given this is cpu parallelism which in theory shouldn't really be affected by GitHub things)</p>



<a name="272627540"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%28%3F%29%20builders%20running%20much%20slower/near/272627540" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc(.3F).20builders.20running.20much.20slower.html#272627540">(Feb 21 2022 at 00:32)</a>:</h4>
<p>I'm able to reproduce the extreme regression of rustc_middle locally.  From a stack trace, it seems to be busy somewhere in LTO</p>



<a name="272630134"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%28%3F%29%20builders%20running%20much%20slower/near/272630134" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc(.3F).20builders.20running.20much.20slower.html#272630134">(Feb 21 2022 at 01:25)</a>:</h4>
<p>From what I can tell, the only required option is <code>parallel-compiler=true</code></p>



<a name="272630461"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%28%3F%29%20builders%20running%20much%20slower/near/272630461" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc(.3F).20builders.20running.20much.20slower.html#272630461">(Feb 21 2022 at 01:32)</a>:</h4>
<p>Unfortunately building with debuginfo-level=1 seems to unstick it.  That makes it difficult to get a stack trace.</p>



<a name="272630758"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%28%3F%29%20builders%20running%20much%20slower/near/272630758" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc(.3F).20builders.20running.20much.20slower.html#272630758">(Feb 21 2022 at 01:39)</a>:</h4>
<p>Ah interesting</p>



<a name="272630773"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%28%3F%29%20builders%20running%20much%20slower/near/272630773" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc(.3F).20builders.20running.20much.20slower.html#272630773">(Feb 21 2022 at 01:39)</a>:</h4>
<p>Well, hopefully we can just revert the most recent fault patch</p>



<a name="272631322"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%28%3F%29%20builders%20running%20much%20slower/near/272631322" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc(.3F).20builders.20running.20much.20slower.html#272631322">(Feb 21 2022 at 01:50)</a>:</h4>
<p>Here's a backtrace of where I happened to interrupt it after running for several minutes.</p>
<div class="codehilite"><pre><span></span><code>rustc_driver_ee39cd910b981af1!llvm::colorEHFunclets+0x13e
rustc_driver_ee39cd910b981af1!llvm::LoopSafetyInfo::computeBlockColors+0x6c
rustc_driver_ee39cd910b981af1!llvm::LICMPass::run+0x609
rustc_driver_ee39cd910b981af1!llvm::LICMPass::run+0xaa
rustc_driver_ee39cd910b981af1!llvm::detail::PassModel&lt;llvm::Loop,llvm::LICMPass,llvm::PreservedAnalyses,llvm::Analysis Manager&lt;llvm::Loop,llvm::LoopStandardAnalysisResults &amp; __ptr64&gt;,llvm::LoopStandardAnalysisResults &amp; __ptr64,llvm::LPMUpdater &amp; __ptr64&gt;::run+0x1b
rustc_driver_ee39cd910b981af1!llvm::PassManager&lt;llvm::Loop,llvm::AnalysisManager&lt;llvm::Loop,llvm::LoopStandardAnalysis Results &amp; __ptr64&gt;,llvm::LoopStandardAnalysisResults &amp; __ptr64,llvm::LPMUpdater &amp; __ptr64&gt;::runSinglePass&lt;llvm::Loop,std::unique_ptr&lt;llvm::detail::PassConcept&lt;llvm::Loop,llvm::AnalysisManager&lt;llvm::Loop,llvm::LoopStandardAnalysisResults &amp; __ptr64&gt;,llvm::LoopStandardAnalysisResults &amp; __ptr64,llvm::LPMUpdater &amp; __ptr 64&gt;,std::default_delete&lt;llvm::detail::PassConcept&lt;llvm::Loop,llvm::AnalysisManager&lt;llvm::Loop,llvm::LoopStandardAnalysisResults &amp; __ptr64&gt;,llvm::LoopStandardAnalysisResults &amp; __ptr64,llvm::LPMUpdater &amp; __ptr64&gt; &gt; &gt; &gt;+0x15c
rustc_driver_ee39cd910b981af1!llvm::PassManager&lt;llvm::Loop,llvm::AnalysisManager&lt;llvm::Loop,llvm::LoopStandardAnalysis Results &amp; __ptr64&gt;,llvm::LoopStandardAnalysisResults &amp; __ptr64,llvm::LPMUpdater &amp; __ptr64&gt;::runWithoutLoopNestPasses+0x114
rustc_driver_ee39cd910b981af1!llvm::PassManager&lt;llvm::Loop,llvm::AnalysisManager&lt;llvm::Loop,llvm::LoopStandardAnalysis Results &amp; __ptr64&gt;,llvm::LoopStandardAnalysisResults &amp; __ptr64,llvm::LPMUpdater &amp; __ptr64&gt;::run+0x41
rustc_driver_ee39cd910b981af1!llvm::detail::PassModel&lt;llvm::Loop,llvm::PassManager&lt;llvm::Loop,llvm::AnalysisManager&lt;llvm::Loop,llvm::LoopStandardAnalysisResults &amp; __ptr64&gt;,llvm::LoopStandardAnalysisResults &amp; __ptr64,llvm::LPMUpdater &amp; __ptr64&gt;,llvm::PreservedAnalyses,llvm::AnalysisManager&lt;llvm::Loop,llvm::LoopStandardAnalysisResults &amp; __ptr64&gt;,llvm::LoopStandardAnalysisResults &amp; __ptr64,llvm::LPMUpdater &amp; __ptr64&gt;::run+0x1b
rustc_driver_ee39cd910b981af1!llvm::FunctionToLoopPassAdaptor::run+0x5a9
rustc_driver_ee39cd910b981af1!llvm::detail::PassModel&lt;llvm::Function,llvm::FunctionToLoopPassAdaptor,llvm::PreservedAnalyses,llvm::AnalysisManager&lt;llvm::Function&gt; &gt;::run+0x11
rustc_driver_ee39cd910b981af1!llvm::PassManager&lt;llvm::Function,llvm::AnalysisManager&lt;llvm::Function&gt; &gt;::run+0x1b3
rustc_driver_ee39cd910b981af1!llvm::detail::PassModel&lt;llvm::Function,llvm::PassManager&lt;llvm::Function,llvm::AnalysisManager&lt;llvm::Function&gt; &gt;,llvm::PreservedAnalyses,llvm::AnalysisManager&lt;llvm::Function&gt; &gt;::run+0x11
rustc_driver_ee39cd910b981af1!llvm::CGSCCToFunctionPassAdaptor::run+0x34f
rustc_driver_ee39cd910b981af1!llvm::detail::PassModel&lt;llvm::LazyCallGraph::SCC,llvm::CGSCCToFunctionPassAdaptor,llvm::PreservedAnalyses,llvm::AnalysisManager&lt;llvm::LazyCallGraph::SCC,llvm::LazyCallGraph &amp; __ptr64&gt;,llvm::LazyCallGraph &amp; __ptr64,llvm::CGSCCUpdateResult &amp; __ptr64&gt;::run+0x1b
rustc_driver_ee39cd910b981af1!llvm::PassManager&lt;llvm::LazyCallGraph::SCC,llvm::AnalysisManager&lt;llvm::LazyCallGraph::SCC,llvm::LazyCallGraph &amp; __ptr64&gt;,llvm::LazyCallGraph &amp; __ptr64,llvm::CGSCCUpdateResult &amp; __ptr64&gt;::run+0x271
rustc_driver_ee39cd910b981af1!llvm::detail::PassModel&lt;llvm::LazyCallGraph::SCC,llvm::PassManager&lt;llvm::LazyCallGraph::SCC,llvm::AnalysisManager&lt;llvm::LazyCallGraph::SCC,llvm::LazyCallGraph &amp; __ptr64&gt;,llvm::LazyCallGraph &amp; __ptr64,llvm::CGSCCUpdateResult &amp; __ptr64&gt;,llvm::PreservedAnalyses,llvm::AnalysisManager&lt;llvm::LazyCallGraph::SCC,llvm::LazyCallGraph &amp; __ptr64&gt;,llvm::LazyCallGraph &amp; __ptr64,llvm::CGSCCUpdateResult &amp; __ptr64&gt;::run+0x1b
rustc_driver_ee39cd910b981af1!llvm::DevirtSCCRepeatedPass::run+0x13a
rustc_driver_ee39cd910b981af1!llvm::detail::PassModel&lt;llvm::LazyCallGraph::SCC,llvm::DevirtSCCRepeatedPass,llvm::PreservedAnalyses,llvm::AnalysisManager&lt;llvm::LazyCallGraph::SCC,llvm::LazyCallGraph &amp; __ptr64&gt;,llvm::LazyCallGraph &amp; __ptr64,llvm::CGSCCUpdateResult &amp; __ptr64&gt;::run+0x1b
rustc_driver_ee39cd910b981af1!llvm::ModuleToPostOrderCGSCCPassAdaptor::run+0xaf4
rustc_driver_ee39cd910b981af1!llvm::detail::PassModel&lt;llvm::Module,llvm::ModuleToPostOrderCGSCCPassAdaptor,llvm::PreservedAnalyses,llvm::AnalysisManager&lt;llvm::Module&gt; &gt;::run+0x11
rustc_driver_ee39cd910b981af1!llvm::PassManager&lt;llvm::Module,llvm::AnalysisManager&lt;llvm::Module&gt; &gt;::run+0x1dc
rustc_driver_ee39cd910b981af1!llvm::ModuleInlinerWrapperPass::run+0x1ae
rustc_driver_ee39cd910b981af1!llvm::detail::PassModel&lt;llvm::Module,llvm::ModuleInlinerWrapperPass,llvm::PreservedAnalyses,llvm::AnalysisManager&lt;llvm::Module&gt; &gt;::run+0x11
rustc_driver_ee39cd910b981af1!llvm::PassManager&lt;llvm::Module,llvm::AnalysisManager&lt;llvm::Module&gt; &gt;::run+0x1dc
rustc_driver_ee39cd910b981af1!LLVMRustOptimizeWithNewPassManager+0x1f1e
rustc_driver_ee39cd910b981af1!RNvNtNtCs6SNynvbAJdk_18rustc_codegen_llvm4back5write35optimize_with_new_llvm_pass_manager+0x3d3
rustc_driver_ee39cd910b981af1!RNvNtNtCs6SNynvbAJdk_18rustc_codegen_llvm4back3lto16run_pass_manager.llvm.3418372231631649475+0xeb
rustc_driver_ee39cd910b981af1!RNvXs1_Cs6SNynvbAJdk_18rustc_codegen_llvmNtB5_18LlvmCodegenBackendNtNtNtCsbp3SflIICtV_17
rustc_codegen_ssa6traits5write19WriteBackendMethods13optimize_thin+0x1fed
rustc_driver_ee39cd910b981af1!RNvMs_NtNtCsbp3SflIICtV_17rustc_codegen_ssa4back3ltoINtB4_16LtoModuleCodegenNtCs6SNynvbAJdk_18rustc_codegen_llvm18LlvmCodegenBackendE8optimizeB1e_+0x2d
rustc_driver_ee39cd910b981af1!RINvNtNtCsbp3SflIICtV_17rustc_codegen_ssa4back5write17execute_work_itemNtCs6SNynvbAJdk_18rustc_codegen_llvm18LlvmCodegenBackendEB19_+0x2cf
rustc_driver_ee39cd910b981af1!RINvNtNtCs7aJtBMv7B6j_3std10sys_common9backtrace28___rust_begin_short_backtraceNCINvXs0_Cs6SNynvbAJdk_18rustc_codegen_llvmNtB1o_18LlvmCodegenBackendNtNtNtCsbp3SflIICtV_17rustc_codegen_ssa6traits7backend19ExtraBackendMethods18spawn_named_threadNCINvNtNtB2s_4back5write10spawn_workB1W_E0uE0uEB1o_+0x123
rustc_driver_ee39cd910b981af1!RINvNtCs2x5CUVA4D6k_4core3ptr13drop_in_placeINtNtNtCsbp3SflIICtV_17rustc_codegen_ssa4back5write7MessageNtCs6SNynvbAJdk_18rustc_codegen_llvm18LlvmCodegenBackendEEB1F_.llvm.15806222262414795940+0x10a4
std_55fdef28d7a196c8!alloc::boxed::impl$44::call_once+0xb
std_55fdef28d7a196c8!alloc::boxed::impl$44::call_once+0x16
std_55fdef28d7a196c8!std::sys::windows::thread::impl$0::new::thread_start+0x4c
KERNEL32!BaseThreadInitThunk+0x14
ntdll!RtlUserThreadStart+0x21
</code></pre></div>



<a name="272631432"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%28%3F%29%20builders%20running%20much%20slower/near/272631432" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc(.3F).20builders.20running.20much.20slower.html#272631432">(Feb 21 2022 at 01:53)</a>:</h4>
<p>And after a few minutes, it's still in <code>computeBlockColors</code></p>



<a name="272631741"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%28%3F%29%20builders%20running%20much%20slower/near/272631741" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc(.3F).20builders.20running.20much.20slower.html#272631741">(Feb 21 2022 at 01:58)</a>:</h4>
<p>I can dump the temp files if anyone wants to dig into why it is taking so long, otherwise I'm probably not going to look any further.  I don't really know anything about debugging llvm issues.</p>



<a name="272634334"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%28%3F%29%20builders%20running%20much%20slower/near/272634334" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc(.3F).20builders.20running.20much.20slower.html#272634334">(Feb 21 2022 at 02:46)</a>:</h4>
<p>I think we'll revert the PR for now and leave it until someone spends the time to investigate, the try builds indicate that should work</p>



<a name="272635241"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/msvc%28%3F%29%20builders%20running%20much%20slower/near/272635241" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/msvc(.3F).20builders.20running.20much.20slower.html#272635241">(Feb 21 2022 at 03:01)</a>:</h4>
<p>I posted a revert, no particular r? but could use a relatively quick review to get CI times back down -- <a href="https://github.com/rust-lang/rust/pull/94205">https://github.com/rust-lang/rust/pull/94205</a></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>