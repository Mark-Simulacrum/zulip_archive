<html>
<head><meta charset="utf-8"><title>overriding rustc/cargo · t-infra · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/index.html">t-infra</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/overriding.20rustc.2Fcargo.html">overriding rustc/cargo</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="234695883"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/overriding%20rustc/cargo/near/234695883" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/overriding.20rustc.2Fcargo.html#234695883">(Apr 15 2021 at 15:15)</a>:</h4>
<p><span class="user-mention" data-user-id="116122">@simulacrum</span> <a href="https://github.com/rust-lang/rust/pull/76544">https://github.com/rust-lang/rust/pull/76544</a> seems to have changed it so that <code>build.rustc</code> and <code>build.cargo</code> are no longer used during the build. Was that intentional? They seem to only be used on the python side to kickstart the bootstrap.  Previously they would be used for the entire build.</p>



<a name="234695991"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/overriding%20rustc/cargo/near/234695991" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/overriding.20rustc.2Fcargo.html#234695991">(Apr 15 2021 at 15:15)</a>:</h4>
<p>That seems bad.</p>



<a name="234696322"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/overriding%20rustc/cargo/near/234696322" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/overriding.20rustc.2Fcargo.html#234696322">(Apr 15 2021 at 15:17)</a>:</h4>
<p>Yea, I'm a bit confused because I think I would have noticed this a lot sooner, but this change was made a long time ago, so I'm questioning my grip of reality. <span aria-label="smiling face" class="emoji emoji-263a" role="img" title="smiling face">:smiling_face:</span></p>



<a name="234696544"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/overriding%20rustc/cargo/near/234696544" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/overriding.20rustc.2Fcargo.html#234696544">(Apr 15 2021 at 15:18)</a>:</h4>
<p>I think it still works fine. It seems to work fine in cg_clif's ci at least. Why it works fine, I have no idea.</p>



<a name="234697576"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/overriding%20rustc/cargo/near/234697576" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/overriding.20rustc.2Fcargo.html#234697576">(Apr 15 2021 at 15:25)</a>:</h4>
<p>Not intentional</p>



<a name="234697853"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/overriding%20rustc/cargo/near/234697853" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/overriding.20rustc.2Fcargo.html#234697853">(Apr 15 2021 at 15:26)</a>:</h4>
<p>Not sure why this is</p>



<a name="234697864"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/overriding%20rustc/cargo/near/234697864" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/overriding.20rustc.2Fcargo.html#234697864">(Apr 15 2021 at 15:26)</a>:</h4>
<p>not expected, anyway</p>



<a name="234700585"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/overriding%20rustc/cargo/near/234700585" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/overriding.20rustc.2Fcargo.html#234700585">(Apr 15 2021 at 15:40)</a>:</h4>
<p>ok, I think I see what is happening.  bootstrap is built with <code>env!("CARGO")</code> as the initial cargo.  But changing that does not cause bootstrap to be rebuilt.  Madness averted.  I might look at fixing that.</p>



<a name="234710442"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/overriding%20rustc/cargo/near/234710442" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/overriding.20rustc.2Fcargo.html#234710442">(Apr 15 2021 at 16:37)</a>:</h4>
<p>Hm, it should</p>



<a name="234710478"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/overriding%20rustc/cargo/near/234710478" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/overriding.20rustc.2Fcargo.html#234710478">(Apr 15 2021 at 16:37)</a>:</h4>
<p>I thought we emitted a env-dep key in the depinfo</p>



<a name="234710500"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/overriding%20rustc/cargo/near/234710500" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/overriding.20rustc.2Fcargo.html#234710500">(Apr 15 2021 at 16:37)</a>:</h4>
<p>Odd.</p>



<a name="234720617"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/overriding%20rustc/cargo/near/234720617" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/overriding.20rustc.2Fcargo.html#234720617">(Apr 15 2021 at 17:36)</a>:</h4>
<p>Cargo does not check environment variables that itself sets.  Those are supposed to be tracked elsewhere, but "CARGO" is a special case that I don't think we considered.</p>



<a name="234721569"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/overriding%20rustc/cargo/near/234721569" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/overriding.20rustc.2Fcargo.html#234721569">(Apr 15 2021 at 17:42)</a>:</h4>
<p>aha, I see</p>



<a name="234721575"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/overriding%20rustc/cargo/near/234721575" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/overriding.20rustc.2Fcargo.html#234721575">(Apr 15 2021 at 17:42)</a>:</h4>
<p>seems odd!</p>



<a name="234721603"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/overriding%20rustc/cargo/near/234721603" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/overriding.20rustc.2Fcargo.html#234721603">(Apr 15 2021 at 17:43)</a>:</h4>
<p>but I definitely expected it would in rustbuild</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>