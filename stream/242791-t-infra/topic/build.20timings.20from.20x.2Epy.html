<html>
<head><meta charset="utf-8"><title>build timings from x.py · t-infra · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/index.html">t-infra</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/build.20timings.20from.20x.2Epy.html">build timings from x.py</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="270910464"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/build%20timings%20from%20x.py/near/270910464" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/build.20timings.20from.20x.2Epy.html#270910464">(Feb 06 2022 at 20:39)</a>:</h4>
<p><span class="user-mention" data-user-id="116122">@simulacrum</span> I've been wondering whether it makes sense to move all the code we have to track CPU usage and how long each step takes away from separate scripts and parsing log files into x.py</p>



<a name="270910480"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/build%20timings%20from%20x.py/near/270910480" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/build.20timings.20from.20x.2Epy.html#270910480">(Feb 06 2022 at 20:39)</a>:</h4>
<p><a href="/user_uploads/4715/ZsXZdUlMEWmrOXcehI5ndW0z/2022-02-06-21-39-44.png">2022-02-06-21-39-44.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/ZsXZdUlMEWmrOXcehI5ndW0z/2022-02-06-21-39-44.png" title="2022-02-06-21-39-44.png"><img src="/user_uploads/4715/ZsXZdUlMEWmrOXcehI5ndW0z/2022-02-06-21-39-44.png"></a></div>



<a name="270910528"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/build%20timings%20from%20x.py/near/270910528" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/build.20timings.20from.20x.2Epy.html#270910528">(Feb 06 2022 at 20:40)</a>:</h4>
<p>(small prototype I built, which can easily turned into a json blob or an html report)</p>



<a name="270910529"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/build%20timings%20from%20x.py/near/270910529" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/build.20timings.20from.20x.2Epy.html#270910529">(Feb 06 2022 at 20:40)</a>:</h4>
<p>I think probably in general yes</p>



<a name="270910539"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/build%20timings%20from%20x.py/near/270910539" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/build.20timings.20from.20x.2Epy.html#270910539">(Feb 06 2022 at 20:40)</a>:</h4>
<p>but yeah, json blob we write out to a report--..json file or similar seems like a good thing, I'd like to continue sticking them in the S3 bucket</p>



<a name="270910556"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/build%20timings%20from%20x.py/near/270910556" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/build.20timings.20from.20x.2Epy.html#270910556">(Feb 06 2022 at 20:41)</a>:</h4>
<p>I'd probably prefer to stick <em>both</em> a json blob and a nice HTML report</p>



<a name="270910557"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/build%20timings%20from%20x.py/near/270910557" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/build.20timings.20from.20x.2Epy.html#270910557">(Feb 06 2022 at 20:41)</a>:</h4>
<p>hm</p>



<a name="270910560"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/build%20timings%20from%20x.py/near/270910560" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/build.20timings.20from.20x.2Epy.html#270910560">(Feb 06 2022 at 20:41)</a>:</h4>
<p>sure, I guess</p>



<a name="270910563"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/build%20timings%20from%20x.py/near/270910563" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/build.20timings.20from.20x.2Epy.html#270910563">(Feb 06 2022 at 20:41)</a>:</h4>
<p>but yeah</p>



<a name="270910571"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/build%20timings%20from%20x.py/near/270910571" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/build.20timings.20from.20x.2Epy.html#270910571">(Feb 06 2022 at 20:41)</a>:</h4>
<p>I'd probably stick the reporting code separately, so we can update it without editing rust-lang/rust and waiting</p>



<a name="270910578"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/build%20timings%20from%20x.py/near/270910578" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/build.20timings.20from.20x.2Epy.html#270910578">(Feb 06 2022 at 20:41)</a>:</h4>
<p>(similar to <a href="https://github.com/Mark-Simulacrum/rustc-ci-timing">https://github.com/Mark-Simulacrum/rustc-ci-timing</a> being out-of-tree, in some sense)</p>



<a name="270910630"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/build%20timings%20from%20x.py/near/270910630" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/build.20timings.20from.20x.2Epy.html#270910630">(Feb 06 2022 at 20:42)</a>:</h4>
<p>It should be easy enough to stand up a small service to track this stuff, I suspect, or maybe integrating it into <a href="http://perf.rust-lang.org">perf.rust-lang.org</a>.</p>



<a name="270910755"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/build%20timings%20from%20x.py/near/270910755" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/build.20timings.20from.20x.2Epy.html#270910755">(Feb 06 2022 at 20:45)</a>:</h4>
<p><span class="user-mention" data-user-id="121055">@Pietro Albini</span> fwiw, I've long wanted to aggregate which tests ran on which builders (not just suites, but individual tests, ideally). obviously that's even more work but we should try to get the format extensible I think</p>



<a name="270910818"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/build%20timings%20from%20x.py/near/270910818" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/build.20timings.20from.20x.2Epy.html#270910818">(Feb 06 2022 at 20:46)</a>:</h4>
<p>(the reason I like the pre-rendered html report in s3 is that it's nice to be able to just click a link to view a builder's stats, without having to run a tool locally -- I did a similar way in another ci I'm managing, and just having the link available has saved quite a lot of time)</p>



<a name="270910828"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/build%20timings%20from%20x.py/near/270910828" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/build.20timings.20from.20x.2Epy.html#270910828">(Feb 06 2022 at 20:46)</a>:</h4>
<p>100% agree on no local tool</p>



<a name="270910843"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/build%20timings%20from%20x.py/near/270910843" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/build.20timings.20from.20x.2Epy.html#270910843">(Feb 06 2022 at 20:47)</a>:</h4>
<p>or, at least, no <em>need</em> to run it</p>



<a name="270910854"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/build%20timings%20from%20x.py/near/270910854" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/build.20timings.20from.20x.2Epy.html#270910854">(Feb 06 2022 at 20:47)</a>:</h4>
<p>but a small service (triagebot, perf, or something new) gives us a lot of flexibility in terms of how we report the data and potentially e.g. deltas over the previous and such</p>



<a name="270910859"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/build%20timings%20from%20x.py/near/270910859" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/build.20timings.20from.20x.2Epy.html#270910859">(Feb 06 2022 at 20:47)</a>:</h4>
<p>which isn't really achievable in raw reports</p>



<a name="270910863"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/build%20timings%20from%20x.py/near/270910863" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/build.20timings.20from.20x.2Epy.html#270910863">(Feb 06 2022 at 20:47)</a>:</h4>
<p>true</p>



<a name="270910906"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/build%20timings%20from%20x.py/near/270910906" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/build.20timings.20from.20x.2Epy.html#270910906">(Feb 06 2022 at 20:48)</a>:</h4>
<p>(and ultimately should not be that hard to stand up with our current infra, I think)</p>



<a name="270910927"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/build%20timings%20from%20x.py/near/270910927" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/build.20timings.20from.20x.2Epy.html#270910927">(Feb 06 2022 at 20:48)</a>:</h4>
<p>name for the whole thing? :D</p>



<a name="270910935"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/build%20timings%20from%20x.py/near/270910935" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/build.20timings.20from.20x.2Epy.html#270910935">(Feb 06 2022 at 20:48)</a>:</h4>
<p>I came up for now with <code>ci-profile</code>, but I kinda hate that name</p>



<a name="270910940"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/build%20timings%20from%20x.py/near/270910940" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/build.20timings.20from.20x.2Epy.html#270910940">(Feb 06 2022 at 20:49)</a>:</h4>
<p>given the desire to maybe track which tests</p>



<a name="270910948"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/build%20timings%20from%20x.py/near/270910948" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/build.20timings.20from.20x.2Epy.html#270910948">(Feb 06 2022 at 20:49)</a>:</h4>
<p>well, we could just <a href="http://ci.rust-lang.org">ci.rust-lang.org</a>, maybe not entirely misleading</p>



<a name="270911002"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/build%20timings%20from%20x.py/near/270911002" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/build.20timings.20from.20x.2Epy.html#270911002">(Feb 06 2022 at 20:50)</a>:</h4>
<p>I don't have anything better than ci-profile -- agree it's not great</p>



<a name="270911009"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/build%20timings%20from%20x.py/near/270911009" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/build.20timings.20from.20x.2Epy.html#270911009">(Feb 06 2022 at 20:50)</a>:</h4>
<p>maybe <a href="http://faster.rust-lang.org">faster.rust-lang.org</a> :)</p>



<a name="270911011"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/build%20timings%20from%20x.py/near/270911011" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/build.20timings.20from.20x.2Epy.html#270911011">(Feb 06 2022 at 20:50)</a>:</h4>
<p>(even for things like the config.toml flag, right now it's enabled by <code>build.ci-profile = true</code>)</p>



<a name="270911029"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/build%20timings%20from%20x.py/near/270911029" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/build.20timings.20from.20x.2Epy.html#270911029">(Feb 06 2022 at 20:51)</a>:</h4>
<p>let's stick with ci-profile</p>



<a name="270911031"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/build%20timings%20from%20x.py/near/270911031" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/build.20timings.20from.20x.2Epy.html#270911031">(Feb 06 2022 at 20:51)</a>:</h4>
<p>we can always rename even if it's a pain</p>



<a name="270911034"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/build%20timings%20from%20x.py/near/270911034" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/build.20timings.20from.20x.2Epy.html#270911034">(Feb 06 2022 at 20:51)</a>:</h4>
<p>but it seems OK</p>



<a name="270911037"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/build%20timings%20from%20x.py/near/270911037" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/build.20timings.20from.20x.2Epy.html#270911037">(Feb 06 2022 at 20:51)</a>:</h4>
<p><span aria-label="thumbs up" class="emoji emoji-1f44d" role="img" title="thumbs up">:thumbs_up:</span> .</p>



<a name="270911044"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/build%20timings%20from%20x.py/near/270911044" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/build.20timings.20from.20x.2Epy.html#270911044">(Feb 06 2022 at 20:51)</a>:</h4>
<p>I have a branch that does the stats gathering and prints it to terminal ready</p>



<a name="270911048"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/build%20timings%20from%20x.py/near/270911048" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/build.20timings.20from.20x.2Epy.html#270911048">(Feb 06 2022 at 20:51)</a>:</h4>
<p>I'll change it to dump some json and send a PR</p>



<a name="270915460"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/build%20timings%20from%20x.py/near/270915460" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/build.20timings.20from.20x.2Epy.html#270915460">(Feb 06 2022 at 22:25)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/pull/93717">https://github.com/rust-lang/rust/pull/93717</a></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>