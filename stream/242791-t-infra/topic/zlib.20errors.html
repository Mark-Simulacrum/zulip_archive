<html>
<head><meta charset="utf-8"><title>zlib errors · t-infra · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/index.html">t-infra</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html">zlib errors</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="204816139"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/204816139" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#204816139">(Jul 23 2020 at 15:57)</a>:</h4>
<p>Just a heads up, I'm trying to investigate the zlib errors. They seem to be hitting the i686 builders.  Tracking on <a href="https://github.com/rust-lang/cargo/issues/8517">https://github.com/rust-lang/cargo/issues/8517</a></p>



<a name="204819874"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/204819874" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#204819874">(Jul 23 2020 at 16:24)</a>:</h4>
<p>Closing the tree, all PRs seem to be failing.</p>



<a name="204820006"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/204820006" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#204820006">(Jul 23 2020 at 16:25)</a>:</h4>
<p>I'm thinking, this will probably take a while to diagnose and fix.  I'm going to suggest switching the builders to use <code>git-fetch-with-cli</code> temporarily.  I'll look at setting up a PR for that.</p>



<a name="204823917"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/204823917" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#204823917">(Jul 23 2020 at 16:56)</a>:</h4>
<p>Posted <a href="https://github.com/rust-lang/rust/pull/74689">https://github.com/rust-lang/rust/pull/74689</a>.</p>



<a name="204834945"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/204834945" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#204834945">(Jul 23 2020 at 18:25)</a>:</h4>
<p><code>error: gnutls_handshake() failed: A TLS fatal alert has been received. while accessing https://github.com/rust-lang/crates.io-index/info/refs</code></p>
<p>Been searching around, and finding lots of people hitting that error message, but all for different reasons (bad drivers, bad certificates, etc.).  Anyone have any ideas?</p>
<p>I'm able to repro pretty easily on GHA, but I have not been able to repro locally.</p>



<a name="204835310"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/204835310" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#204835310">(Jul 23 2020 at 18:28)</a>:</h4>
<p><span class="user-mention" data-user-id="120518">@Eric Huss</span> one thought I had is that maybe we can patch cargo (or whoever is linked in) to provide our own zlib?</p>



<a name="204835343"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/204835343" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Gaynor <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#204835343">(Jul 23 2020 at 18:28)</a>:</h4>
<p>Hmm, there should be an alert-type that comes with the fatal-error. I guess gnutls/git doesn't log it :-(</p>
<p>If I had to speculate _wildly_, it'd be that it's the TCP stream getting half closed, leading to truncation mid TLS record, leading to an alert that the stream was truncated early.</p>



<a name="204835387"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/204835387" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#204835387">(Jul 23 2020 at 18:28)</a>:</h4>
<p>That error was from git itself (the command-line).  I think this is unrelated to cargo.</p>



<a name="204835457"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/204835457" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#204835457">(Jul 23 2020 at 18:29)</a>:</h4>
<p>I guess it's plausible this is the same failure</p>



<a name="204835517"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/204835517" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Gaynor <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#204835517">(Jul 23 2020 at 18:29)</a>:</h4>
<p>the zlib error you were getting before being caused by early truncation also makes sense to me</p>



<a name="204835520"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/204835520" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#204835520">(Jul 23 2020 at 18:29)</a>:</h4>
<p>just expressed differently</p>



<a name="204837666"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/204837666" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#204837666">(Jul 23 2020 at 18:44)</a>:</h4>
<p>hm, i'm more perplexed, because it only seems to affect i686.  My current theory is that libgit2 is initializing the bare repo in some strange way.  Testing with just <code>git fetch</code> doesn't repro.  I was able to repro with cargo as far back as 1.43.</p>



<a name="204840814"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/204840814" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#204840814">(Jul 23 2020 at 19:07)</a>:</h4>
<p><span class="user-mention" data-user-id="120518">@Eric Huss</span> you've managed to get something deterministically failing?</p>



<a name="204841064"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/204841064" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#204841064">(Jul 23 2020 at 19:09)</a>:</h4>
<p>Yea, just run this on GHA:</p>
<div class="codehilite"><pre><span></span><code>        rustup install beta-i686-unknown-linux-gnu
        cargo new foo
        cd foo
        echo &#39;log = &quot;0.4.11&quot;&#39; &gt;&gt; Cargo.toml
        cargo +beta-i686-unknown-linux-gnu fetch
</code></pre></div>



<a name="204841160"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/204841160" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#204841160">(Jul 23 2020 at 19:10)</a>:</h4>
<p>It doesn't really matter which release, as long as it is i686</p>



<a name="204841260"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/204841260" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Gaynor <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#204841260">(Jul 23 2020 at 19:11)</a>:</h4>
<p>This is on an x86-64 host though?</p>



<a name="204841279"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/204841279" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#204841279">(Jul 23 2020 at 19:11)</a>:</h4>
<p>yea</p>



<a name="204844245"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/204844245" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#204844245">(Jul 23 2020 at 19:37)</a>:</h4>
<p><span class="user-mention" data-user-id="120518">@Eric Huss</span> hm ok something is different for me</p>



<a name="204844249"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/204844249" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#204844249">(Jul 23 2020 at 19:37)</a>:</h4>
<p>that's not failing</p>



<a name="204844266"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/204844266" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#204844266">(Jul 23 2020 at 19:37)</a>:</h4>
<p>if you set <code>CARGO_HOME</code> to a blank dir does it fail?</p>



<a name="204844276"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/204844276" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#204844276">(Jul 23 2020 at 19:38)</a>:</h4>
<p>I'm curious if this only fails on incremental updates</p>



<a name="204844423"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/204844423" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#204844423">(Jul 23 2020 at 19:39)</a>:</h4>
<p>I ran <code>ls -l</code> in <code>~/.cargo/</code>, and the <code>registry</code> directory is empty on GHA.</p>



<a name="204844452"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/204844452" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#204844452">(Jul 23 2020 at 19:39)</a>:</h4>
<p>(that was one of my first ideas)</p>



<a name="204844456"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/204844456" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#204844456">(Jul 23 2020 at 19:39)</a>:</h4>
<p>oh I se, I'm executing locally, not on GHA</p>



<a name="204844471"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/204844471" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#204844471">(Jul 23 2020 at 19:39)</a>:</h4>
<p>Yea, I can't repro locally.</p>



<a name="204844477"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/204844477" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#204844477">(Jul 23 2020 at 19:39)</a>:</h4>
<p>they probably have a different network setup than my home</p>



<a name="204844786"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/204844786" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#204844786">(Jul 23 2020 at 19:42)</a>:</h4>
<p>This is also really strange, I got this from the logs:</p>
<div class="codehilite"><pre><span></span><code>attempting GitHub fast path for https://api.github.com/repos/rust-lang/crates.io-index/commits/HEAD
failed to check github reference &#39;refs/remotes/origin/HEAD&#39; not found; class=Reference (4); code=NotFound (-3)
</code></pre></div>


<p>How can that be "not found"?</p>



<a name="204844895"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/204844895" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Gaynor <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#204844895">(Jul 23 2020 at 19:43)</a>:</h4>
<p>If you're running a 32-bit cargo, when it shells out to <code>git</code>, does it use a 64-bit git? (i.e. invoking git should be identical between i686 and x86-64)</p>



<a name="204844989"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/204844989" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#204844989">(Jul 23 2020 at 19:44)</a>:</h4>
<p><span class="user-mention" data-user-id="120518">@Eric Huss</span> that's an empty checkout, right?</p>



<a name="204845000"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/204845000" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#204845000">(Jul 23 2020 at 19:44)</a>:</h4>
<p>so the ref isn't present locally?</p>



<a name="204845058"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/204845058" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#204845058">(Jul 23 2020 at 19:44)</a>:</h4>
<p><span class="user-mention" data-user-id="120518">@Eric Huss</span> hm this didn't fail on CI for me?</p>



<a name="204845089"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/204845089" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#204845089">(Jul 23 2020 at 19:45)</a>:</h4>
<p><a href="https://github.com/alexcrichton/cfg-if/commit/239e998b97f7a5a725a0bb4d402341fb0f217969">https://github.com/alexcrichton/cfg-if/commit/239e998b97f7a5a725a0bb4d402341fb0f217969</a></p>



<a name="204845327"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/204845327" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mati865 <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#204845327">(Jul 23 2020 at 19:47)</a>:</h4>
<p><span class="user-mention silent" data-user-id="130046">Alex Gaynor</span> <a href="#narrow/stream/242791-t-infra/topic/zlib.20errors/near/204844895">said</a>:</p>
<blockquote>
<p>If you're running a 32-bit cargo, when it shells out to <code>git</code>, does it use a 64-bit git? (i.e. invoking git should be identical between i686 and x86-64)</p>
</blockquote>
<p>It uses bundled libgit.</p>



<a name="204845331"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/204845331" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#204845331">(Jul 23 2020 at 19:47)</a>:</h4>
<p>the failure rate isn't 100%, though for me it is close.</p>



<a name="204845363"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/204845363" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#204845363">(Jul 23 2020 at 19:47)</a>:</h4>
<p>re: git.  <span class="user-mention" data-user-id="119581">@mati865</span> it failed when using git-fetch-with-cli too, so it wasn't libgit in that case.</p>



<a name="204845415"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/204845415" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#204845415">(Jul 23 2020 at 19:48)</a>:</h4>
<p>it just shells out to "git", so whatever is installed on the system (64-bit).</p>



<a name="204845465"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/204845465" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#204845465">(Jul 23 2020 at 19:48)</a>:</h4>
<p>I compared the 32-bit bare repo init with the 64-bit, and it was the same.</p>



<a name="204845498"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/204845498" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Gaynor <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#204845498">(Jul 23 2020 at 19:49)</a>:</h4>
<p>So somehow <code>git</code> is behaving differently depending on if it's being <code>execve</code>'d from a 32-bit or 64-bit process? <span aria-label="explosion" class="emoji emoji-1f4a5" role="img" title="explosion">:explosion:</span>  There's got to be something else going on, because that'd just be too much.</p>



<a name="204845615"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/204845615" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#204845615">(Jul 23 2020 at 19:50)</a>:</h4>
<p>one thing I'm curious to test is <a href="https://github.com/alexcrichton/cfg-if/commit/6039f9d13db313f23b8eafac60d2fa7496a24eec">https://github.com/alexcrichton/cfg-if/commit/6039f9d13db313f23b8eafac60d2fa7496a24eec</a>, but I can't get this to fail on CI :(</p>



<a name="204845645"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/204845645" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#204845645">(Jul 23 2020 at 19:50)</a>:</h4>
<p>3/3 successes so far for me on your repro steps</p>



<a name="204845689"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/204845689" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mati865 <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#204845689">(Jul 23 2020 at 19:50)</a>:</h4>
<p>So it cannot be git if 64 bit binary gives the same error.</p>



<a name="204846980"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/204846980" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#204846980">(Jul 23 2020 at 20:02)</a>:</h4>
<p>hm, it's not failing for me now.  maybe it only fails before noon <span aria-label="rolling on the floor laughing" class="emoji emoji-1f923" role="img" title="rolling on the floor laughing">:rolling_on_the_floor_laughing:</span></p>



<a name="204847104"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/204847104" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#204847104">(Jul 23 2020 at 20:03)</a>:</h4>
<p>so the last issue this came up in was in libgit2 where it had something to do with huge packets and their buffer sizes</p>



<a name="204847162"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/204847162" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#204847162">(Jul 23 2020 at 20:04)</a>:</h4>
<p>it sounded like there was just a bug in how the data from the network was fed in</p>



<a name="204847189"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/204847189" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#204847189">(Jul 23 2020 at 20:04)</a>:</h4>
<p>if that's the case then this could be highly susceptible to network differences, and if it's spurious it could have to do with caching</p>



<a name="204847226"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/204847226" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#204847226">(Jul 23 2020 at 20:04)</a>:</h4>
<p>like at some point their internal network may cache like a huge packet, but then later it caches a smaller version (or something like that)</p>



<a name="204847280"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/204847280" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#204847280">(Jul 23 2020 at 20:05)</a>:</h4>
<p>only 32-bit likely indicates there's more bugs and such in libgit2?</p>



<a name="204847298"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/204847298" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#204847298">(Jul 23 2020 at 20:05)</a>:</h4>
<p>it'll be next-to-impossible to fix unless we can debug though :(</p>



<a name="204847308"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/204847308" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#204847308">(Jul 23 2020 at 20:05)</a>:</h4>
<p>that doesn't really explain why it failed with <code>net.git-fetch-with-cli</code></p>



<a name="204847309"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/204847309" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#204847309">(Jul 23 2020 at 20:05)</a>:</h4>
<p>ideally we'd get like an rr capture and replay that locally</p>



<a name="204847325"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/204847325" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#204847325">(Jul 23 2020 at 20:05)</a>:</h4>
<p>that is also true</p>



<a name="204847331"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/204847331" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#204847331">(Jul 23 2020 at 20:05)</a>:</h4>
<p>was that reproducible?</p>



<a name="204847396"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/204847396" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#204847396">(Jul 23 2020 at 20:06)</a>:</h4>
<p>I only tried once.</p>



<a name="204847436"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/204847436" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#204847436">(Jul 23 2020 at 20:06)</a>:</h4>
<p>I was trying to make a rust program that would simulate calling <code>git</code> as a process, but it's not failing now. <span aria-label="frown" class="emoji emoji-1f641" role="img" title="frown">:frown:</span></p>



<a name="204847509"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/204847509" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#204847509">(Jul 23 2020 at 20:07)</a>:</h4>
<p>this may also just be a bug in github caching?</p>



<a name="204847535"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/204847535" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#204847535">(Jul 23 2020 at 20:07)</a>:</h4>
<p>I'm totally lost</p>



<a name="204847658"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/204847658" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#204847658">(Jul 23 2020 at 20:08)</a>:</h4>
<p>caching oddity seems like a prime suspect</p>



<a name="204847679"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/204847679" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mati865 <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#204847679">(Jul 23 2020 at 20:09)</a>:</h4>
<p>But why it only appears on 32 bit builders <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="204847716"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/204847716" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Gaynor <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#204847716">(Jul 23 2020 at 20:09)</a>:</h4>
<p>There's a seperate cache for each builder, right? Maybe something got corrupted in the 32-bit builder.</p>



<a name="204848003"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/204848003" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#204848003">(Jul 23 2020 at 20:12)</a>:</h4>
<p>strange.  I'm going to reopen the tree, since I can't repro anymore.  If it happens again, I'll try to investigate more.</p>



<a name="205504622"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/205504622" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#205504622">(Jul 30 2020 at 17:02)</a>:</h4>
<p><span class="user-mention" data-user-id="120518">@Eric Huss</span> I just saw this error in backtrace-rs's CI</p>



<a name="205504649"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/205504649" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#205504649">(Jul 30 2020 at 17:02)</a>:</h4>
<p>according to <a href="https://github.com/rust-lang/backtrace-rs/pull/367#issuecomment-666488573">https://github.com/rust-lang/backtrace-rs/pull/367#issuecomment-666488573</a></p>



<a name="205504664"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/205504664" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#205504664">(Jul 30 2020 at 17:02)</a>:</h4>
<p>(I reran the builds though which trumped things)</p>



<a name="205504687"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/205504687" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#205504687">(Jul 30 2020 at 17:02)</a>:</h4>
<p>I believe it was gnu32 having issues</p>



<a name="205505504"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/205505504" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#205505504">(Jul 30 2020 at 17:11)</a>:</h4>
<p>Thanks.  I just reproduced on my test repo using  1.46 beta i686-linux-gnu</p>



<a name="205507040"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/205507040" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#205507040">(Jul 30 2020 at 17:26)</a>:</h4>
<p>Hm, caught a failure with <code>CARGO_HTTP_DEBUG</code>.  Nothing interesting other than the failure was on a different IP.</p>



<a name="205507355"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/205507355" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#205507355">(Jul 30 2020 at 17:29)</a>:</h4>
<p>Out of 10 runs, 2 failed with ip <code>140.82.114.4</code>, 8 succeeded at IPs <code>140.82.112.3 140.82.112.4 140.82.113.3 140.82.113.4</code>.</p>



<a name="205509294"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/205509294" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#205509294">(Jul 30 2020 at 17:46)</a>:</h4>
<p>I'm able to repro locally by redirecting <a href="http://github.com">github.com</a> to that IP.</p>



<a name="205511131"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/205511131" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#205511131">(Jul 30 2020 at 18:01)</a>:</h4>
<p><span class="user-mention" data-user-id="120518">@Eric Huss</span> you were able to reproduce with the CLI locally using that IP?</p>



<a name="205511175"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/205511175" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#205511175">(Jul 30 2020 at 18:01)</a>:</h4>
<p>if that's the case we should probably raise this with some support ticket with them</p>



<a name="205512592"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/205512592" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#205512592">(Jul 30 2020 at 18:11)</a>:</h4>
<p><span class="user-mention" data-user-id="116015">@Alex Crichton</span> Yes.</p>



<a name="205512616"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/205512616" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#205512616">(Jul 30 2020 at 18:11)</a>:</h4>
<p>I'd like to figure out exactly why, it still seems to only fail with i686.</p>



<a name="205512628"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/205512628" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#205512628">(Jul 30 2020 at 18:12)</a>:</h4>
<p>Instrumented libgit2.  The error is Z_BUF_ERROR</p>



<a name="205512731"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/205512731" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#205512731">(Jul 30 2020 at 18:12)</a>:</h4>
<p>The documentation in zlib.h is...nicely verbose, but takes a bit to read it all. <span aria-label="grinning" class="emoji emoji-1f600" role="img" title="grinning">:grinning:</span></p>



<a name="205512833"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/205512833" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#205512833">(Jul 30 2020 at 18:13)</a>:</h4>
<p>heh yeah you're not kidding</p>



<a name="205512863"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/205512863" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#205512863">(Jul 30 2020 at 18:14)</a>:</h4>
<p>this doesn't seem to confirm though about how the x86_64 command line (presumably) failed to clone?</p>



<a name="205513011"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/205513011" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#205513011">(Jul 30 2020 at 18:14)</a>:</h4>
<p>yea, I don't know.  I can't repro with the command-line against that IP, but cargo i686 is very reproducible (100%).</p>



<a name="205513022"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/205513022" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#205513022">(Jul 30 2020 at 18:14)</a>:</h4>
<p>also if you still can, I'd recommend capturing an <code>rr</code> trace</p>



<a name="205513036"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/205513036" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#205513036">(Jul 30 2020 at 18:14)</a>:</h4>
<p>to assist in debugging later</p>



<a name="205513090"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/205513090" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#205513090">(Jul 30 2020 at 18:15)</a>:</h4>
<p>I think you can also share that so others can repro too</p>



<a name="205513652"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/205513652" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#205513652">(Jul 30 2020 at 18:19)</a>:</h4>
<p><span class="user-mention" data-user-id="116015">@Alex Crichton</span> <code>AMD CPUs not supported.</code> for <code>rr</code> <span aria-label="frown" class="emoji emoji-1f641" role="img" title="frown">:frown:</span></p>



<a name="205513680"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/205513680" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#205513680">(Jul 30 2020 at 18:19)</a>:</h4>
<p>got a command line for me?</p>



<a name="205513696"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/205513696" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#205513696">(Jul 30 2020 at 18:19)</a>:</h4>
<p>I can try to capture locally</p>



<a name="205513828"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/205513828" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#205513828">(Jul 30 2020 at 18:20)</a>:</h4>
<p>I run <code>CARGO_HOME=chome cargo +beta-i686-unknown-linux-gnu fetch</code> in a project with a single dependency.</p>



<a name="205513853"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/205513853" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#205513853">(Jul 30 2020 at 18:20)</a>:</h4>
<p>I have <code>140.82.114.4 github.com</code> in <code>/etc/hosts</code></p>



<a name="205513978"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/205513978" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#205513978">(Jul 30 2020 at 18:21)</a>:</h4>
<p>oh right rr chokes for me on 32-bit processes</p>



<a name="205517890"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/205517890" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#205517890">(Jul 30 2020 at 18:54)</a>:</h4>
<p>dang, it has stopped reproducing.  One thing I noticed is that <a href="https://github.com/libgit2/libgit2/blob/a83fd5107879d18b31ff8173ea062136256321be/src/pack.c#L847">this line</a> in libgit2 doesn't check for an error return value.  I'm trying to figure out how that function can end up with the <code>Z_BUF_ERROR</code> state.  <code>Z_BUF_ERROR</code> isn't supposed to be fatal, and this loop looks a little suspicious.</p>



<a name="205541380"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/205541380" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#205541380">(Jul 30 2020 at 22:46)</a>:</h4>
<p><span class="user-mention" data-user-id="116015">@Alex Crichton</span> I think I have a repro!  I found a copy of the troublesome index.  Check out <a href="https://github.com/ehuss/zlib-repro">https://github.com/ehuss/zlib-repro</a> and follow instructions in README.  The index fails to clone on i686, but succeeds with x86_64.</p>



<a name="205544528"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/205544528" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#205544528">(Jul 30 2020 at 23:32)</a>:</h4>
<p>nice! I'll try to help digging in to this tomorrow. This looks like it's probably good enough to send to upstream libgit2/libgit2 as well</p>



<a name="205544536"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/205544536" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#205544536">(Jul 30 2020 at 23:32)</a>:</h4>
<p>(once we reduce it to just C in play and also using the libgit2 build system)</p>



<a name="205973212"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/205973212" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#205973212">(Aug 04 2020 at 23:28)</a>:</h4>
<p>it looks like this was hit again <a href="https://github.com/rust-lang/rust/pull/75037#issuecomment-668840895">here</a></p>



<a name="205973377"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/205973377" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#205973377">(Aug 04 2020 at 23:30)</a>:</h4>
<p><span class="user-mention" data-user-id="116883">@tmandry</span> see the discussion in <a href="#narrow/stream/242791-t-infra/topic/CI">https://rust-lang.zulipchat.com/#narrow/stream/242791-t-infra/topic/CI</a>.  We squashed the index about an hour ago, which should clear it up.</p>



<a name="205973416"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/205973416" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#205973416">(Aug 04 2020 at 23:31)</a>:</h4>
<p>ah I missed that somehow, thanks</p>



<a name="214792282"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/214792282" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#214792282">(Oct 28 2020 at 03:17)</a>:</h4>
<p>It looks like the zlib errors were not fixed, I've noticed a few PRs recently that have failed on 32-bit jobs.  If anyone notices one of these errors, can you ping me right away?  I'd like to try to catch the index in the broken state for further analysis.  I'm really confused, because I double checked that <code>beta-2020-10-16-i686-unknown-linux-gnu</code> had fixed the issue, and it passes the tests that I have.</p>



<a name="214792359"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/214792359" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#214792359">(Oct 28 2020 at 03:19)</a>:</h4>
<p>Specifically, any CI job that displays the error <code>error inflating zlib stream; class=Zlib</code></p>



<a name="214793084"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/214793084" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#214793084">(Oct 28 2020 at 03:33)</a>:</h4>
<p><span class="user-mention silent" data-user-id="120518">Eric Huss</span> <a href="#narrow/stream/242791-t-infra/topic/zlib.20errors/near/214792359">said</a>:</p>
<blockquote>
<p>Specifically, any CI job that displays the error <code>error inflating zlib stream; class=Zlib</code></p>
</blockquote>
<p><a href="https://github.com/rust-lang/rust/pull/75671#issuecomment-717369192">https://github.com/rust-lang/rust/pull/75671#issuecomment-717369192</a></p>



<a name="214794510"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/214794510" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#214794510">(Oct 28 2020 at 04:06)</a>:</h4>
<p><span class="user-mention" data-user-id="232545">@Joshua Nelson</span> Thanks, that's one of the ones I saw earlier. Unfortunately it's a bit too late, as the index changes frequently. The window to catch it is unfortunately kinda small.</p>



<a name="215265181"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/zlib%20errors/near/215265181" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/zlib.20errors.html#215265181">(Nov 01 2020 at 22:16)</a>:</h4>
<p><span class="user-mention" data-user-id="120518">@Eric Huss</span> <a href="#narrow/stream/246057-t-cargo/topic/pinging.20for.20zlib.20error">https://rust-lang.zulipchat.com/#narrow/stream/246057-t-cargo/topic/pinging.20for.20zlib.20error</a></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>