<html>
<head><meta charset="utf-8"><title>playground jobserver · t-infra · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/index.html">t-infra</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/playground.20jobserver.html">playground jobserver</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="271033606"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/playground%20jobserver/near/271033606" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/playground.20jobserver.html#271033606">(Feb 07 2022 at 19:58)</a>:</h4>
<p><span class="user-mention" data-user-id="116155">@Jake Goulding</span> To a first approximation, it might be worth just giving every job both cores on the system, and relying on the scheduler when you have multiple jobs running.</p>



<a name="271033668"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/playground%20jobserver/near/271033668" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/playground.20jobserver.html#271033668">(Feb 07 2022 at 19:58)</a>:</h4>
<p>I don't know if that would be a net win in the conflicting case, but I wouldn't expect it to be a substantial loss if it was a loss, and it'd be a win in the single-job case.</p>



<a name="271033705"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/playground%20jobserver/near/271033705" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/playground.20jobserver.html#271033705">(Feb 07 2022 at 19:59)</a>:</h4>
<p>Seems worth testing at least.</p>



<a name="271033719"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/playground%20jobserver/near/271033719" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/playground.20jobserver.html#271033719">(Feb 07 2022 at 19:59)</a>:</h4>
<p><span class="user-mention" data-user-id="116155">@Jake Goulding</span> Do you have numbers on what percentage of jobs run uncontended?</p>



<a name="271040664"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/playground%20jobserver/near/271040664" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/playground.20jobserver.html#271040664">(Feb 07 2022 at 20:57)</a>:</h4>
<p>Not directly. If you have access — <a href="https://grafana.rust-lang.org/d/BoFKl4CGk/playground-timeouts?orgId=1">https://grafana.rust-lang.org/d/BoFKl4CGk/playground-timeouts?orgId=1</a></p>



<a name="271040709"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/playground%20jobserver/near/271040709" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/playground.20jobserver.html#271040709">(Feb 07 2022 at 20:57)</a>:</h4>
<p>Notably: </p>
<p><a href="/user_uploads/4715/-iP3ypoNq0gi0VUf9hDomXxj/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/-iP3ypoNq0gi0VUf9hDomXxj/image.png" title="image.png"><img src="/user_uploads/4715/-iP3ypoNq0gi0VUf9hDomXxj/image.png"></a></div>



<a name="271040711"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/playground%20jobserver/near/271040711" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/playground.20jobserver.html#271040711">(Feb 07 2022 at 20:57)</a>:</h4>
<p>I don't (and don't have a need-to-know).</p>



<a name="271040807"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/playground%20jobserver/near/271040807" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/playground.20jobserver.html#271040807">(Feb 07 2022 at 20:58)</a>:</h4>
<p>The playground is a 2-core EC2 server, so AFAIK load average should be &lt; 2 ;-)</p>



<a name="271040828"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/playground%20jobserver/near/271040828" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/playground.20jobserver.html#271040828">(Feb 07 2022 at 20:58)</a>:</h4>
<p>22 runnable threads on a 2 core machine? and that's not even peak but smoothed?</p>



<a name="271041436"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/playground%20jobserver/near/271041436" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/playground.20jobserver.html#271041436">(Feb 07 2022 at 21:03)</a>:</h4>
<p>we should probably just bump the specs to alleviate the problem</p>



<a name="271042708"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/playground%20jobserver/near/271042708" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/playground.20jobserver.html#271042708">(Feb 07 2022 at 21:14)</a>:</h4>
<p>From my miscellaneous quotes file:</p>
<blockquote>
<p>We learned that the Linux load average rolls over at 1024. And we actually found this out empirically. -- H. Peter Anvin, about rsync on <a href="http://kernel.org">kernel.org</a></p>
</blockquote>



<a name="271042762"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/playground%20jobserver/near/271042762" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/playground.20jobserver.html#271042762">(Feb 07 2022 at 21:14)</a>:</h4>
<p>(That was a long time ago, I'm sure it doesn't wrap anymore.)</p>



<a name="271042852"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/playground%20jobserver/near/271042852" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/playground.20jobserver.html#271042852">(Feb 07 2022 at 21:15)</a>:</h4>
<p>Part of me is morbidly curious how much more it would cost to run playground on lambda, and whether the scale-up-and-down-with-load would make up for the increased cost per CPU on lambda.</p>



<a name="271042922"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/playground%20jobserver/near/271042922" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/playground.20jobserver.html#271042922">(Feb 07 2022 at 21:16)</a>:</h4>
<p>(But if we <em>did</em> do that, it should still have a hard peak limit, and a queue past that point.)</p>



<a name="271043352"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/playground%20jobserver/near/271043352" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/playground.20jobserver.html#271043352">(Feb 07 2022 at 21:20)</a>:</h4>
<p>it's way harder to sandbox on lambda unfortunately</p>



<a name="271043413"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/playground%20jobserver/near/271043413" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/playground.20jobserver.html#271043413">(Feb 07 2022 at 21:20)</a>:</h4>
<p>(I'm pretty sure if the lambda is warm it's executed in the same container, so a job could affect the other)</p>



<a name="271045830"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/playground%20jobserver/near/271045830" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/playground.20jobserver.html#271045830">(Feb 07 2022 at 21:40)</a>:</h4>
<p><span class="user-mention silent" data-user-id="121055">Pietro Albini</span> <a href="#narrow/stream/242791-t-infra/topic/playground.20jobserver/near/271041436">said</a>:</p>
<blockquote>
<p>we should probably just bump the specs to alleviate the problem</p>
</blockquote>
<p><a href="https://github.com/rust-lang/simpleinfra/pull/78">https://github.com/rust-lang/simpleinfra/pull/78</a></p>



<a name="271047879"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/playground%20jobserver/near/271047879" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/playground.20jobserver.html#271047879">(Feb 07 2022 at 21:54)</a>:</h4>
<p><span class="user-mention silent" data-user-id="330154">The 8472</span> <a href="#narrow/stream/242791-t-infra/topic/playground.20jobserver/near/271040828">said</a>:</p>
<blockquote>
<p>22 runnable threads on a 2 core machine? and that's not even peak but smoothed?</p>
</blockquote>
<p>Just as a double-check, <code>top</code> reports it right now as <code>load average: 2.15, 2.48, 2.24</code>.</p>



<a name="271048030"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/playground%20jobserver/near/271048030" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/playground.20jobserver.html#271048030">(Feb 07 2022 at 21:55)</a>:</h4>
<p><span class="user-mention silent" data-user-id="121055">Pietro Albini</span> <a href="#narrow/stream/242791-t-infra/topic/playground.20jobserver/near/271043413">said</a>:</p>
<blockquote>
<p>(I'm pretty sure if the lambda is warm it's executed in the same container, so a job could affect the other)</p>
</blockquote>
<p>I believe that's addressable with a custom container, but yeah, it's a pain to deal with.</p>



<a name="271048067"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/playground%20jobserver/near/271048067" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/playground.20jobserver.html#271048067">(Feb 07 2022 at 21:55)</a>:</h4>
<p>(I have that problem as well, where I need lambdas to run <em>one</em> job and then exit.)</p>



<a name="271062288"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/playground%20jobserver/near/271062288" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/playground.20jobserver.html#271062288">(Feb 08 2022 at 00:05)</a>:</h4>
<p>Yeah, bumping it is <em>largely</em> waiting on <span class="user-mention" data-user-id="121055">@Pietro Albini</span> your input on the security groups/subnets in AWS (or I can sit down and spend a few hours on figuring it out). I didn't really manage to parse out intent last time I tried (a month ish back now)</p>



<a name="271177190"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/playground%20jobserver/near/271177190" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/playground.20jobserver.html#271177190">(Feb 08 2022 at 19:16)</a>:</h4>
<p>(saw the ping, will respond soonishish)</p>



<a name="272697800"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/playground%20jobserver/near/272697800" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/playground.20jobserver.html#272697800">(Feb 21 2022 at 14:50)</a>:</h4>
<p><span class="user-mention" data-user-id="116155">@Jake Goulding</span> ok merged the ansible/terraform config and deployed all of it</p>



<a name="272697816"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/playground%20jobserver/near/272697816" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/playground.20jobserver.html#272697816">(Feb 21 2022 at 14:50)</a>:</h4>
<p>it's currently failing to start with:</p>
<div class="codehilite"><pre><span></span><code>Feb 21 14:47:09 play-next.infra.rust-lang.org systemd[1]: Started The Rust Playground.
Feb 21 14:47:09 play-next.infra.rust-lang.org systemd[441]: playground.service: Changing to the requested working directory failed: No such file or directory
Feb 21 14:47:09 play-next.infra.rust-lang.org systemd[441]: playground.service: Failed at step CHDIR spawning /home/playground/playground-artifacts/ui: No such file or directory
Feb 21 14:47:09 play-next.infra.rust-lang.org systemd[1]: playground.service: Main process exited, code=exited, status=200/CHDIR
Feb 21 14:47:09 play-next.infra.rust-lang.org systemd[1]: playground.service: Failed with result &#39;exit-code&#39;.
</code></pre></div>



<a name="272697866"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242791-t-infra/topic/playground%20jobserver/near/272697866" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/242791-t-infra/topic/playground.20jobserver.html#272697866">(Feb 21 2022 at 14:51)</a>:</h4>
<p>you should have sudo access to the server, please try to make the changes directly with ansible instead of manually on the server, and then open a PR with the changes you made <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>