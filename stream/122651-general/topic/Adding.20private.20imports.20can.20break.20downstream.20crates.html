<html>
<head><meta charset="utf-8"><title>Adding private imports can break downstream crates ¬∑ general ¬∑ Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Adding.20private.20imports.20can.20break.20downstream.20crates.html">Adding private imports can break downstream crates</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="276933483"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Adding%20private%20imports%20can%20break%20downstream%20crates/near/276933483" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Adding.20private.20imports.20can.20break.20downstream.20crates.html#276933483">(Mar 28 2022 at 21:25)</a>:</h4>
<p>I'd be interested in hearing opinions on <a href="https://github.com/rust-lang/rust/issues/95420">https://github.com/rust-lang/rust/issues/95420</a>; this seems unfortunate :(</p>



<a name="276935785"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Adding%20private%20imports%20can%20break%20downstream%20crates/near/276935785" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Adding.20private.20imports.20can.20break.20downstream.20crates.html#276935785">(Mar 28 2022 at 21:50)</a>:</h4>
<p>Named items take precedence over <code>*</code> glob imports.  I'm not sure what your thoughts are towards how the rules would work instead.  I think it could be quite confusing if that shadowing differed based on visibility.</p>



<a name="276940018"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Adding%20private%20imports%20can%20break%20downstream%20crates/near/276940018" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Adding.20private.20imports.20can.20break.20downstream.20crates.html#276940018">(Mar 28 2022 at 22:49)</a>:</h4>
<p>Different languages make different choices here.  C++ intentionally picked "working code never changes behaviour if you make something public" (see D&amp;E), whereas C# went for "adding private things to a base class can't* break a derived class"</p>
<p>*reflection, of course, can still break</p>



<a name="276962452"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Adding%20private%20imports%20can%20break%20downstream%20crates/near/276962452" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> sgk <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Adding.20private.20imports.20can.20break.20downstream.20crates.html#276962452">(Mar 29 2022 at 06:20)</a>:</h4>
<p>I prefer forbid shadowing <code>pub</code> glob imports with non-<code>pub</code> imports, or at least add a lint/warning against it.</p>



<a name="276962858"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Adding%20private%20imports%20can%20break%20downstream%20crates/near/276962858" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> sgk <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Adding.20private.20imports.20can.20break.20downstream.20crates.html#276962858">(Mar 29 2022 at 06:28)</a>:</h4>
<p>On a second thought. This may be used intentionally to "block off" glob import. So add a clippy lint I guess.</p>



<a name="276983705"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Adding%20private%20imports%20can%20break%20downstream%20crates/near/276983705" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Adding.20private.20imports.20can.20break.20downstream.20crates.html#276983705">(Mar 29 2022 at 10:17)</a>:</h4>
<p>While named items shadowing globs makes sense to make semver more robust, I've always thought that there should be a lint for that, with, therefore, a way to opt out certain items from the blob:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="n">foo</span>::<span class="o">*</span><span class="p">;</span><span class="w"> </span><span class="c1">//~ warning, `Result` item in this blob import is shadowed</span>
<span class="k">type</span> <span class="nb">Result</span> <span class="o">=</span><span class="w"> </span><span class="n">MyResult</span><span class="err">‚Ä¶</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
<p>and when intended:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="n">foo</span>::<span class="p">{</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="nb">Result</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">_</span><span class="p">};</span><span class="w"> </span><span class="c1">// Not only accepted, but it would also not warn üôè</span>
<span class="k">type</span> <span class="nb">Result</span> <span class="o">=</span><span class="w"> </span><span class="n">MyResult</span><span class="err">‚Ä¶</span><span class="p">;</span><span class="w"></span>
</code></pre></div>



<a name="277232446"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Adding%20private%20imports%20can%20break%20downstream%20crates/near/277232446" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Adding.20private.20imports.20can.20break.20downstream.20crates.html#277232446">(Mar 31 2022 at 04:36)</a>:</h4>
<p>I want to cross reference <a href="https://github.com/rust-analyzer/rust-analyzer/issues/11858">https://github.com/rust-analyzer/rust-analyzer/issues/11858</a> here, which is the analogous issue in rust-analyzer, which gets confused when you <code>use foo::*; pub use foo::*;</code>. rustc seems to always prefer the pub use in this case, but it is hard to tell how intentional this is</p>



<a name="277253378"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Adding%20private%20imports%20can%20break%20downstream%20crates/near/277253378" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Adding.20private.20imports.20can.20break.20downstream.20crates.html#277253378">(Mar 31 2022 at 09:18)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232018">Daniel Henry-Mantilla</span> <a href="#narrow/stream/122651-general/topic/Adding.20private.20imports.20can.20break.20downstream.20crates/near/276983705">said</a></p>
<p>(I've just realized that the imaginary syntax I'ver chosen for it happens to be the same as that of importing a trait's methods without importing the trait's type-namespace-name. Since not importing anything from an item and importing the methods would be slightly different semantics, we may need another syntax to avoid this ambiguity, should it be deemed problematic)</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>