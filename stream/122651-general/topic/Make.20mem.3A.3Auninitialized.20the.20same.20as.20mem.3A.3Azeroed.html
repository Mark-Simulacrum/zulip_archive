<html>
<head><meta charset="utf-8"><title>Make mem::uninitialized the same as mem::zeroed · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Make.20mem.3A.3Auninitialized.20the.20same.20as.20mem.3A.3Azeroed.html">Make mem::uninitialized the same as mem::zeroed</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="256492795"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Make%20mem%3A%3Auninitialized%20the%20same%20as%20mem%3A%3Azeroed/near/256492795" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> K.R. Zentner <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Make.20mem.3A.3Auninitialized.20the.20same.20as.20mem.3A.3Azeroed.html#256492795">(Oct 06 2021 at 22:12)</a>:</h4>
<p>Hey, I was wondering if anyone has proposed this change before.<br>
Basically, <code>mem::uninitialized</code> cannot be used correctly. In practice, it usually results in undefined behavior that then breaks the rest of the function where it's used.</p>
<p>It's been deprecated since 1.39, but some crates (especially ones that haven't been updated in a long time), still use it.<br>
In my experience, every such use results in broken behavior on recent Rust versions, but the function can't just be removed because of backwards compatibility.</p>
<p>However, since the function is defined to return memory in any possible state, it should not be a breaking change to replace it with <code>mem::zeroed</code>. This should prevent some behavior from being broken in crates that still use <code>mem::uninitialized</code> (as long as they only use it on types for which zeroed memory is a valid state).</p>
<p>This would also prevent anyone from being tempted to use it, since it won't have any potentially better performance.</p>



<a name="256496259"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Make%20mem%3A%3Auninitialized%20the%20same%20as%20mem%3A%3Azeroed/near/256496259" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Make.20mem.3A.3Auninitialized.20the.20same.20as.20mem.3A.3Azeroed.html#256496259">(Oct 06 2021 at 22:44)</a>:</h4>
<p>This was discussed at some length at <a href="#narrow/stream/219381-t-libs/topic/disarming.20mem.3A.3Auninitialized">https://rust-lang.zulipchat.com/#narrow/stream/219381-t-libs/topic/disarming.20mem.3A.3Auninitialized</a></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>