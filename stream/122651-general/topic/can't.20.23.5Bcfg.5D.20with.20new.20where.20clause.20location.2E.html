<html>
<head><meta charset="utf-8"><title>can&#x27;t #[cfg] with new where clause location. · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/can&#x27;t.20.23.5Bcfg.5D.20with.20new.20where.20clause.20location.2E.html">can&#x27;t #[cfg] with new where clause location.</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="274908401"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/can%27t%20%23%5Bcfg%5D%20with%20new%20where%20clause%20location./near/274908401" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/can&#x27;t.20.23.5Bcfg.5D.20with.20new.20where.20clause.20location.2E.html#274908401">(Mar 10 2022 at 23:01)</a>:</h4>
<p>There's a fun issue with the new <code>where</code> clause location on GATs: you can't use something like <code>#[cfg(feature="nightly")]</code> anymore to gate code to nightly-only because stable still tries to parse it and fails.</p>
<p><a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2021&amp;gist=01c1cc5b8ea9db7c249e05d67f825540">https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2021&amp;gist=01c1cc5b8ea9db7c249e05d67f825540</a></p>



<a name="274909455"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/can%27t%20%23%5Bcfg%5D%20with%20new%20where%20clause%20location./near/274909455" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/can&#x27;t.20.23.5Bcfg.5D.20with.20new.20where.20clause.20location.2E.html#274909455">(Mar 10 2022 at 23:13)</a>:</h4>
<p>which I guess will persist until the code for the location change lands, so in 1.61?</p>



<a name="274909481"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/can%27t%20%23%5Bcfg%5D%20with%20new%20where%20clause%20location./near/274909481" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/can&#x27;t.20.23.5Bcfg.5D.20with.20new.20where.20clause.20location.2E.html#274909481">(Mar 10 2022 at 23:13)</a>:</h4>
<p>could we make 1.60 not error on that case?</p>



<a name="274909510"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/can%27t%20%23%5Bcfg%5D%20with%20new%20where%20clause%20location./near/274909510" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dario Nieuwenhuis <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/can&#x27;t.20.23.5Bcfg.5D.20with.20new.20where.20clause.20location.2E.html#274909510">(Mar 10 2022 at 23:13)</a>:</h4>
<p>it's going to be very painful otherwise...</p>



<a name="274912424"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/can%27t%20%23%5Bcfg%5D%20with%20new%20where%20clause%20location./near/274912424" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/can&#x27;t.20.23.5Bcfg.5D.20with.20new.20where.20clause.20location.2E.html#274912424">(Mar 10 2022 at 23:47)</a>:</h4>
<p>seems worth bringing up in <a class="stream" data-stream-id="131828" href="/#narrow/stream/131828-t-compiler">#t-compiler</a></p>



<a name="274919009"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/can%27t%20%23%5Bcfg%5D%20with%20new%20where%20clause%20location./near/274919009" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/can&#x27;t.20.23.5Bcfg.5D.20with.20new.20where.20clause.20location.2E.html#274919009">(Mar 11 2022 at 01:03)</a>:</h4>
<p>as a workaround, you can put the impl in a cfg'ed macro, and an empty macro for the <code>cfg(not(...))</code> case</p>



<a name="274919253"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/can%27t%20%23%5Bcfg%5D%20with%20new%20where%20clause%20location./near/274919253" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/can&#x27;t.20.23.5Bcfg.5D.20with.20new.20where.20clause.20location.2E.html#274919253">(Mar 11 2022 at 01:06)</a>:</h4>
<p>it also seems to work if you move that into a new module file, and cfg your <code>mod foobar;</code></p>



<a name="274919285"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/can%27t%20%23%5Bcfg%5D%20with%20new%20where%20clause%20location./near/274919285" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/can&#x27;t.20.23.5Bcfg.5D.20with.20new.20where.20clause.20location.2E.html#274919285">(Mar 11 2022 at 01:06)</a>:</h4>
<p>(whereas inline <code>mod foobar { ... }</code> still gets parsed)</p>



<a name="274988696"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/can%27t%20%23%5Bcfg%5D%20with%20new%20where%20clause%20location./near/274988696" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/can&#x27;t.20.23.5Bcfg.5D.20with.20new.20where.20clause.20location.2E.html#274988696">(Mar 11 2022 at 15:17)</a>:</h4>
<p>Even shorter: have an identity macro:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="fm">macro_rules!</span><span class="w"> </span><span class="n">emit</span><span class="w"> </span><span class="p">{(</span><span class="w"> </span><span class="cp">$($tt</span>:<span class="nc">tt</span><span class="p">)</span><span class="o">*</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="cp">$($tt</span><span class="p">)</span><span class="o">*</span><span class="w"> </span><span class="p">)}</span><span class="w"></span>
</code></pre></div>
<p>and then:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#[cfg(/* … */)]</span><span class="w"> </span><span class="n">emit</span><span class="o">!</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">trait</span><span class="w"> </span><span class="c1">// …</span>

<span class="w">    </span><span class="k">impl</span><span class="w"> </span><span class="c1">// …</span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="275143591"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/can%27t%20%23%5Bcfg%5D%20with%20new%20where%20clause%20location./near/275143591" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fee1-dead <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/can&#x27;t.20.23.5Bcfg.5D.20with.20new.20where.20clause.20location.2E.html#275143591">(Mar 13 2022 at 09:23)</a>:</h4>
<p>That's pretty neat! I tried to do something similar but I didn't think it could get simpler than <code>cfg_if!</code></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>