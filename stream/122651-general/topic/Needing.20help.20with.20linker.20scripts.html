<html>
<head><meta charset="utf-8"><title>Needing help with linker scripts · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Needing.20help.20with.20linker.20scripts.html">Needing help with linker scripts</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="263910928"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Needing%20help%20with%20linker%20scripts/near/263910928" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Teln0 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Needing.20help.20with.20linker.20scripts.html#263910928">(Dec 06 2021 at 19:53)</a>:</h4>
<p>Hello ! I'm new here. Sorry if this is the wrong place for this kind of questions.</p>
<p>I'm trying to provide a linker script to the compiler but it seems to just ignore it. Right now it contains nonsense so I'm expecting to get some sort of error telling me that, but instead my crate compiles successfully.</p>
<p>Here's the command I use<br>
<code>cargo rustc -vv -Z build-std=core -Z build-std-features=compiler-builtins-mem --target x86_64-unknown-uefi -- --emit link=$@</code></p>
<p>Here's .cargo/config.toml</p>
<div class="codehilite" data-code-language="TOML"><pre><span></span><code><span class="k">[build]</span>
<span class="n">rustflags</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">"-C"</span><span class="p">,</span> <span class="s">"link-arg=-Tlink.x"</span><span class="p">,</span>
<span class="p">]</span>
</code></pre></div>
<p>Here's the command being actually ran</p>
<div class="codehilite"><pre><span></span><code>Running `CARGO=/home/teln0/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/bin/cargo CARGO_BIN_NAME=syscontrol CARGO_CRATE_NAME=syscontrol CARGO_MANIFEST_DIR=/home/teln0/Documents/SysControl CARGO_PKG_AUTHORS=&#39;&#39; CARGO_PKG_DESCRIPTION=&#39;&#39; CARGO_PKG_HOMEPAGE=&#39;&#39; CARGO_PKG_LICENSE=&#39;&#39; CARGO_PKG_LICENSE_FILE=&#39;&#39; CARGO_PKG_NAME=syscontrol CARGO_PKG_REPOSITORY=&#39;&#39; CARGO_PKG_VERSION=0.1.0 CARGO_PKG_VERSION_MAJOR=0 CARGO_PKG_VERSION_MINOR=1 CARGO_PKG_VERSION_PATCH=0 CARGO_PKG_VERSION_PRE=&#39;&#39; CARGO_PRIMARY_PACKAGE=1 LD_LIBRARY_PATH=&#39;/home/teln0/Documents/SysControl/target/debug/deps:/home/teln0/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib:/home/teln0/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib&#39; rustc --crate-name syscontrol --edition=2018 src/main.rs --error-format=json --json=diagnostic-rendered-ansi --crate-type bin --emit=dep-info,link -C embed-bitcode=no -C debuginfo=2 --emit link=build/syscontrol.efi -C metadata=9674633f429b992a -C extra-filename=-9674633f429b992a --out-dir /home/teln0/Documents/SysControl/target/x86_64-unknown-uefi/debug/deps --target x86_64-unknown-uefi -C incremental=/home/teln0/Documents/SysControl/target/x86_64-unknown-uefi/debug/incremental -L dependency=/home/teln0/Documents/SysControl/target/x86_64-unknown-uefi/debug/deps -L dependency=/home/teln0/Documents/SysControl/target/debug/deps --extern bootloader=/home/teln0/Documents/SysControl/target/x86_64-unknown-uefi/debug/deps/libbootloader-0a1a45f058957690.rlib --extern &#39;noprelude:compiler_builtins=/home/teln0/Documents/SysControl/target/x86_64-unknown-uefi/debug/deps/libcompiler_builtins-5e6b064ad6dc3ae8.rlib&#39; --extern &#39;noprelude:core=/home/teln0/Documents/SysControl/target/x86_64-unknown-uefi/debug/deps/libcore-8104581145f81df1.rlib&#39; -Z unstable-options -C link-arg=-Tlink.x`
</code></pre></div>
<p>As you can see the <code>link-arg=-Tlink.x</code> is there at the end.</p>
<p>I tried :</p>
<ul>
<li>using <code>link-arg=-Wl,-Tlink.x</code> instead</li>
<li>switching to xargo and back</li>
<li>using some other linker but I think I'm only making things worse that way</li>
</ul>
<p>Does this have something to do with my target <code>target x86_64-unknown-uefi</code> ?</p>



<a name="263911087"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Needing%20help%20with%20linker%20scripts/near/263911087" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Teln0 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Needing.20help.20with.20linker.20scripts.html#263911087">(Dec 06 2021 at 19:53)</a>:</h4>
<p>I'm getting kind of desperate, no one could find a solution on the discords</p>



<a name="263918837"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Needing%20help%20with%20linker%20scripts/near/263918837" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Needing.20help.20with.20linker.20scripts.html#263918837">(Dec 06 2021 at 20:20)</a>:</h4>
<p>Here's <a href="https://github.com/shepmaster/rust-arduino-blink-led-no-core-with-cargo/blob/master/avr-atmega328p.json#L27-L35">one way I've specified a linker script</a></p>



<a name="263920848"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Needing%20help%20with%20linker%20scripts/near/263920848" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Teln0 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Needing.20help.20with.20linker.20scripts.html#263920848">(Dec 06 2021 at 20:35)</a>:</h4>
<p>Is there no way to specify one without making a custom target ?</p>



<a name="263930887"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Needing%20help%20with%20linker%20scripts/near/263930887" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Needing.20help.20with.20linker.20scripts.html#263930887">(Dec 06 2021 at 22:00)</a>:</h4>
<p><span class="user-mention" data-user-id="312985">@Teln0</span> Can you try passing <code>-Z print-link-args</code> (in addition to what you're already passing), and see if it shows you the linker command line and if it looks like you expect?</p>



<a name="263930913"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Needing%20help%20with%20linker%20scripts/near/263930913" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Needing.20help.20with.20linker.20scripts.html#263930913">(Dec 06 2021 at 22:01)</a>:</h4>
<p>(Also, I just realized that <code>-Z print-link-args</code> should become a stable <code>-C print-link-args</code>.)</p>



<a name="263932361"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Needing%20help%20with%20linker%20scripts/near/263932361" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Needing.20help.20with.20linker.20scripts.html#263932361">(Dec 06 2021 at 22:13)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/pull/91606">https://github.com/rust-lang/rust/pull/91606</a></p>



<a name="263939785"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Needing%20help%20with%20linker%20scripts/near/263939785" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Teln0 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Needing.20help.20with.20linker.20scripts.html#263939785">(Dec 06 2021 at 23:30)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/122651-general/topic/Needing.20help.20with.20linker.20scripts/near/263930887">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="312985">Teln0</span> Can you try passing <code>-Z print-link-args</code> (in addition to what you're already passing), and see if it shows you the linker command line and if it looks like you expect?</p>
</blockquote>
<p>Here's the output after I added it. I do see -Tlink.x at the end. No idea if that's what I want though</p>
<div class="codehilite"><pre><span></span><code>rust-lld&quot; &quot;-flavor&quot; &quot;link&quot; &quot;/NOLOGO&quot; &quot;/entry:efi_main&quot; &quot;/subsystem:efi_application&quot; &quot;/home/teln0/Documents/SysControl/target/x86_64-unknown-uefi/debug/deps/syscontrol-9674633f429b992a.3vtu2ohhjpaowtlx.rcgu.o&quot; &quot;/LIBPATH:/home/teln0/Documents/SysControl/target/x86_64-unknown-uefi/debug/deps&quot; &quot;/LIBPATH:/home/teln0/Documents/SysControl/target/debug/deps&quot; &quot;/LIBPATH:/home/teln0/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-uefi/lib&quot; &quot;/home/teln0/Documents/SysControl/target/x86_64-unknown-uefi/debug/deps/libbootloader-0a1a45f058957690.rlib&quot; &quot;/home/teln0/Documents/SysControl/target/x86_64-unknown-uefi/debug/deps/librustc_std_workspace_core-27905b76d90a39d7.rlib&quot; &quot;/home/teln0/Documents/SysControl/target/x86_64-unknown-uefi/debug/deps/libcore-8104581145f81df1.rlib&quot; &quot;/home/teln0/Documents/SysControl/target/x86_64-unknown-uefi/debug/deps/libcompiler_builtins-5e6b064ad6dc3ae8.rlib&quot; &quot;/NXCOMPAT&quot; &quot;/LIBPATH:/home/teln0/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-uefi/lib&quot; &quot;/OUT:build/syscontrol.efi&quot; &quot;/OPT:REF,NOICF&quot; &quot;/DEBUG&quot; &quot;/NODEFAULTLIB&quot; &quot;-Tlink.x&quot;
</code></pre></div>



<a name="263940400"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Needing%20help%20with%20linker%20scripts/near/263940400" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Needing.20help.20with.20linker.20scripts.html#263940400">(Dec 06 2021 at 23:38)</a>:</h4>
<p>A fully custom target <em>shouldn't</em> be required. I use a basic <a href="https://github.com/Lokathor/zygravan/blob/main/.cargo/config.toml#L8">rustflags</a> entry similar to yours and a tier3 target (with -Zbuild-std) and the linker uses my script.</p>



<a name="263941279"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Needing%20help%20with%20linker%20scripts/near/263941279" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Teln0 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Needing.20help.20with.20linker.20scripts.html#263941279">(Dec 06 2021 at 23:50)</a>:</h4>
<p><span class="user-mention silent" data-user-id="224471">Lokathor</span> <a href="#narrow/stream/122651-general/topic/Needing.20help.20with.20linker.20scripts/near/263940400">said</a>:</p>
<blockquote>
<p>A fully custom target <em>shouldn't</em> be required. I use a basic <a href="https://github.com/Lokathor/zygravan/blob/main/.cargo/config.toml#L8">rustflags</a> entry similar to yours and a tier3 target (with -Zbuild-std) and the linker uses my script.</p>
</blockquote>
<p>I really don't know why it doesn't work for me. Is -Tlink.x really the right argument to pass in my case ? Like I see every other argument start with / maybe mine should start with / as well ?</p>



<a name="263945281"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Needing%20help%20with%20linker%20scripts/near/263945281" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Needing.20help.20with.20linker.20scripts.html#263945281">(Dec 07 2021 at 00:43)</a>:</h4>
<p><span class="user-mention" data-user-id="312985">@Teln0</span> So, all those arguments <em>look</em> like Windows linker arguments, rather than UNIX linker arguments, but I don't know if that means the linker will be confused about accepting a linker script or not.</p>



<a name="263947866"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Needing%20help%20with%20linker%20scripts/near/263947866" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Needing.20help.20with.20linker.20scripts.html#263947866">(Dec 07 2021 at 01:21)</a>:</h4>
<p>Oh, yeah, if you're using the windows linker then probably <code>-T</code> isn't correct. I've always used <code>-T</code> with gnu / llvm style linkers that use <code>-</code> for arguments.</p>



<a name="263964221"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Needing%20help%20with%20linker%20scripts/near/263964221" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Teln0 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Needing.20help.20with.20linker.20scripts.html#263964221">(Dec 07 2021 at 06:39)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/122651-general/topic/Needing.20help.20with.20linker.20scripts/near/263945281">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="312985">Teln0</span> So, all those arguments <em>look</em> like Windows linker arguments, rather than UNIX linker arguments, but I don't know if that means the linker will be confused about accepting a linker script or not.</p>
</blockquote>
<p>But why does it use windows linker arguments ? I'm running Linux.</p>



<a name="263964241"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Needing%20help%20with%20linker%20scripts/near/263964241" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Teln0 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Needing.20help.20with.20linker.20scripts.html#263964241">(Dec 07 2021 at 06:39)</a>:</h4>
<p><span class="user-mention silent" data-user-id="224471">Lokathor</span> <a href="#narrow/stream/122651-general/topic/Needing.20help.20with.20linker.20scripts/near/263947866">said</a>:</p>
<blockquote>
<p>Oh, yeah, if you're using the windows linker then probably <code>-T</code> isn't correct. I've always used <code>-T</code> with gnu / llvm style linkers that use <code>-</code> for arguments.</p>
</blockquote>
<p>Do you know what would be the windows version by any chance ? Maybe it will work ?</p>



<a name="263964414"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Needing%20help%20with%20linker%20scripts/near/263964414" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Teln0 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Needing.20help.20with.20linker.20scripts.html#263964414">(Dec 07 2021 at 06:42)</a>:</h4>
<p>Do these windows-like arguments have something to do with my target ?</p>



<a name="263965428"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Needing%20help%20with%20linker%20scripts/near/263965428" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Needing.20help.20with.20linker.20scripts.html#263965428">(Dec 07 2021 at 07:03)</a>:</h4>
<p>UEFI uses PE executables and thus needs a windows linker.</p>



<a name="263967314"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Needing%20help%20with%20linker%20scripts/near/263967314" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Teln0 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Needing.20help.20with.20linker.20scripts.html#263967314">(Dec 07 2021 at 07:38)</a>:</h4>
<p><span class="user-mention silent" data-user-id="133247">bjorn3</span> <a href="#narrow/stream/122651-general/topic/Needing.20help.20with.20linker.20scripts/near/263965428">said</a>:</p>
<blockquote>
<p>UEFI uses PE executables and thus needs a windows linker.</p>
</blockquote>
<p>Makes sense. I'll try to find out what the right argument is then and I'll come back to mark this as resolved if it works.</p>



<a name="263970131"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Needing%20help%20with%20linker%20scripts/near/263970131" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Teln0 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Needing.20help.20with.20linker.20scripts.html#263970131">(Dec 07 2021 at 08:22)</a>:</h4>
<p>Update :</p>



<a name="263970156"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Needing%20help%20with%20linker%20scripts/near/263970156" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Teln0 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Needing.20help.20with.20linker.20scripts.html#263970156">(Dec 07 2021 at 08:22)</a>:</h4>
<p>I found an option to switch to lld -C link-arg=-fuse-ld=lld</p>



<a name="263970178"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Needing%20help%20with%20linker%20scripts/near/263970178" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Teln0 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Needing.20help.20with.20linker.20scripts.html#263970178">(Dec 07 2021 at 08:23)</a>:</h4>
<p>I haven't found a way to give linker scripts to windows style linkers</p>



<a name="263970514"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Needing%20help%20with%20linker%20scripts/near/263970514" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Teln0 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Needing.20help.20with.20linker.20scripts.html#263970514">(Dec 07 2021 at 08:27)</a>:</h4>
<p><a href="https://docs.microsoft.com/en-us/cpp/build/reference/base-base-address?view=msvc-170">https://docs.microsoft.com/en-us/cpp/build/reference/base-base-address?view=msvc-170</a></p>
<p>Maybe I could use something like that to achieve the result I want without linker scripts.</p>



<a name="263979312"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Needing%20help%20with%20linker%20scripts/near/263979312" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Needing.20help.20with.20linker.20scripts.html#263979312">(Dec 07 2021 at 10:00)</a>:</h4>
<p>Rustc was already using lld. Just in the windows linker flavor</p>



<a name="263979377"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Needing%20help%20with%20linker%20scripts/near/263979377" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Needing.20help.20with.20linker.20scripts.html#263979377">(Dec 07 2021 at 10:01)</a>:</h4>
<p>What do you want to use the linker script for?</p>



<a name="263987215"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Needing%20help%20with%20linker%20scripts/near/263987215" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Teln0 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Needing.20help.20with.20linker.20scripts.html#263987215">(Dec 07 2021 at 11:23)</a>:</h4>
<p><span class="user-mention silent" data-user-id="133247">bjorn3</span> <a href="#narrow/stream/122651-general/topic/Needing.20help.20with.20linker.20scripts/near/263979377">said</a>:</p>
<blockquote>
<p>What do you want to use the linker script for?</p>
</blockquote>
<p>I wanted to add an offset to addresses in my code</p>



<a name="263988955"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Needing%20help%20with%20linker%20scripts/near/263988955" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Needing.20help.20with.20linker.20scripts.html#263988955">(Dec 07 2021 at 11:40)</a>:</h4>
<p>UEFI executables are relocated by the firmware. If you were to offset everything by say 10 bytes, the firmware is allowed to load the file 10 bytes earlier, thus resulting in every function and static being loaded at exactly the same place.</p>



<a name="263990601"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Needing%20help%20with%20linker%20scripts/near/263990601" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Teln0 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Needing.20help.20with.20linker.20scripts.html#263990601">(Dec 07 2021 at 11:58)</a>:</h4>
<p>Can't I use /FIXED to prevent relocation ? My goal is to have some code with an offset and some code without</p>



<a name="264020984"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Needing%20help%20with%20linker%20scripts/near/264020984" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Needing.20help.20with.20linker.20scripts.html#264020984">(Dec 07 2021 at 15:57)</a>:</h4>
<p>Different UEFI implementations may allocate at different locations. Whatever value you choose for <code>/FIXED</code> there may be a UEFI implementation for which it won't work. You should probably have a bootloader or the binary itself map the kernel in the higher half of the address space after exiting boot services. Before exiting boot services the page tables are managed by the uefi firmware.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>