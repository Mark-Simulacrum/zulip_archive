<html>
<head><meta charset="utf-8"><title>Script for minimizing huge minimal examples · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Script.20for.20minimizing.20huge.20minimal.20examples.html">Script for minimizing huge minimal examples</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="266972944"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Script%20for%20minimizing%20huge%20minimal%20examples/near/266972944" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Poitras <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Script.20for.20minimizing.20huge.20minimal.20examples.html#266972944">(Jan 05 2022 at 18:37)</a>:</h4>
<p>Hello all,</p>
<p>After doing some minimizing of an entire codebase on issue <a href="https://github.com/rust-lang/rust/issues/92537">#92537</a> to get a minimal example of an ice, I've actually found a strategy that works pretty well for removing large swaths of code without losing the bug-behavior. Would there be any interest in me making a script that could generate minimal examples when someone comes in with a bug and just dumps an entire repo as the example?</p>



<a name="266972982"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Script%20for%20minimizing%20huge%20minimal%20examples/near/266972982" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Poitras <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Script.20for.20minimizing.20huge.20minimal.20examples.html#266972982">(Jan 05 2022 at 18:37)</a>:</h4>
<p>Also IDK of a better place to put this, if there's a workgroup for this kind of thing please let me know</p>



<a name="266973793"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Script%20for%20minimizing%20huge%20minimal%20examples/near/266973793" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Script.20for.20minimizing.20huge.20minimal.20examples.html#266973793">(Jan 05 2022 at 18:43)</a>:</h4>
<p>automatic minimization would be extremely difficult to get working in a general case, it would likely need compiler feedback</p>



<a name="266973992"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Script%20for%20minimizing%20huge%20minimal%20examples/near/266973992" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Script.20for.20minimizing.20huge.20minimal.20examples.html#266973992">(Jan 05 2022 at 18:45)</a>:</h4>
<p>See also:</p>
<ul>
<li><a href="http://blog.pnkfx.org/blog/2019/11/18/rust-bug-minimization-patterns/">http://blog.pnkfx.org/blog/2019/11/18/rust-bug-minimization-patterns/</a></li>
<li><a href="https://github.com/jethrogb/rust-reduce">https://github.com/jethrogb/rust-reduce</a> </li>
<li><a href="https://github.com/csmith-project/creduce">https://github.com/csmith-project/creduce</a></li>
</ul>



<a name="266974357"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Script%20for%20minimizing%20huge%20minimal%20examples/near/266974357" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Script.20for.20minimizing.20huge.20minimal.20examples.html#266974357">(Jan 05 2022 at 18:47)</a>:</h4>
<p>What is your strategy, by the way?</p>



<a name="266974734"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Script%20for%20minimizing%20huge%20minimal%20examples/near/266974734" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Script.20for.20minimizing.20huge.20minimal.20examples.html#266974734">(Jan 05 2022 at 18:50)</a>:</h4>
<p>would <em>love</em> to have this!</p>



<a name="266977406"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Script%20for%20minimizing%20huge%20minimal%20examples/near/266977406" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Poitras <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Script.20for.20minimizing.20huge.20minimal.20examples.html#266977406">(Jan 05 2022 at 19:12)</a>:</h4>
<p>The strategy is nothing fancy. I stumbled across it without thinking, so I'm definitely not the first to think of this. Compared to the others linked above, it seems a lot more aggressive. It's essentially a bull in a China shop approach to deal with very large amounts of code. It's also only applicable to bugs that fail to compile, like the ICE in the previous issue.</p>
<p>The approach is (substitution) -&gt; (test), with substitutions like: </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">return_a_number</span><span class="p">(</span><span class="o">..</span><span class="p">.)</span><span class="w"> </span>-&gt; <span class="kt">u32</span> <span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="n">bunch</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">calls</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">other</span><span class="w">  </span><span class="n">things</span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kd">let</span><span class="w"> </span><span class="n">something_else</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">return_a_number</span><span class="p">(</span><span class="o">..</span><span class="p">.);</span><span class="w"></span>
</code></pre></div>
<p>replaced with</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">something_else</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
<p>Functions that return () can be outright deleted and the calls to them are removed entirely. I essentially did that a bunch of times for the easy types, then checked for anything unused, removed that. </p>
<p>Then, the fun starts. I randomly removed entire methods from random structures, fixed up where they were still being called, and then if the test still showed the specific error, I continued with removing a lot of random codes. </p>
<p>I figured that everything before "the fun starts" could be automated easily, and then some more careful approach could be used for the rest. In practice, the large majority of the codebase I did the other day was reduced to around 300 LOC by step 1, and the rest was a lot easier to do.</p>
<p>Being that my method has an sample size of 1, I should probably get on testing it some other very large dumps of code before writing something.</p>



<a name="266977786"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Script%20for%20minimizing%20huge%20minimal%20examples/near/266977786" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Poitras <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Script.20for.20minimizing.20huge.20minimal.20examples.html#266977786">(Jan 05 2022 at 19:15)</a>:</h4>
<p>I'll try out rust-reduce to see if it yields better results. It probably does, considering my approach is essentially smashing things with a hammer until something breaks.</p>



<a name="266979670"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Script%20for%20minimizing%20huge%20minimal%20examples/near/266979670" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Reeves <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Script.20for.20minimizing.20huge.20minimal.20examples.html#266979670">(Jan 05 2022 at 19:30)</a>:</h4>
<p>I've also seen folks mention <a href="https://github.com/perses-project/perses">https://github.com/perses-project/perses</a> in issues</p>



<a name="266981134"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Script%20for%20minimizing%20huge%20minimal%20examples/near/266981134" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Script.20for.20minimizing.20huge.20minimal.20examples.html#266981134">(Jan 05 2022 at 19:43)</a>:</h4>
<p>And my list: <a href="https://github.com/shepmaster/rust-mre">https://github.com/shepmaster/rust-mre</a></p>



<a name="266983970"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Script%20for%20minimizing%20huge%20minimal%20examples/near/266983970" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Script.20for.20minimizing.20huge.20minimal.20examples.html#266983970">(Jan 05 2022 at 20:04)</a>:</h4>
<p>I often find the act of minimizing therapeutic — it can be pleasingly manual and not need much brainpower. <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span></p>



<a name="266984046"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Script%20for%20minimizing%20huge%20minimal%20examples/near/266984046" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> asquared31415 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Script.20for.20minimizing.20huge.20minimal.20examples.html#266984046">(Jan 05 2022 at 20:05)</a>:</h4>
<p>A small problem with that approach of removing functions is that there are cases where even a trivial function needs to exist because lifetimes, even if the function is stubbed with <code>loop{}</code> or <code>todo!()</code> or similar.  I would consider adding some way to have the functions also be checked if they can be replaced with a trivial body if they can't be outright removed.</p>



<a name="267004221"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Script%20for%20minimizing%20huge%20minimal%20examples/near/267004221" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Poitras <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Script.20for.20minimizing.20huge.20minimal.20examples.html#267004221">(Jan 05 2022 at 23:01)</a>:</h4>
<p><span class="user-mention" data-user-id="116155">@Jake Goulding</span> I likewise found it fairly enjoyable, which is why I'm trying to find ways to do more of the fun bits, lol.</p>



<a name="267019746"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Script%20for%20minimizing%20huge%20minimal%20examples/near/267019746" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Tran <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Script.20for.20minimizing.20huge.20minimal.20examples.html#267019746">(Jan 06 2022 at 02:46)</a>:</h4>
<p>Have you considered something like <a href="https://github.com/csmith-project/creduce">https://github.com/csmith-project/creduce</a> ?</p>



<a name="267185650"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Script%20for%20minimizing%20huge%20minimal%20examples/near/267185650" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fee1-dead <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Script.20for.20minimizing.20huge.20minimal.20examples.html#267185650">(Jan 07 2022 at 12:58)</a>:</h4>
<p>I am currently working on a rust rewrite for <a href="https://github.com/perses-project/perses">https://github.com/perses-project/perses</a>. I plan to support using it as a subcommand and it would just work</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>