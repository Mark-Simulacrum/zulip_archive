<html>
<head><meta charset="utf-8"><title>same mod declared multiple times · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/same.20mod.20declared.20multiple.20times.html">same mod declared multiple times</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="276787633"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/same%20mod%20declared%20multiple%20times/near/276787633" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philipp Oppermann <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/same.20mod.20declared.20multiple.20times.html#276787633">(Mar 27 2022 at 13:08)</a>:</h4>
<p>I was just debugging an issue where <a href="https://github.com/phil-opp/blog_os/issues/1098">the value of a <code>static</code> changed in unexpected ways</a>. The problem was that both the <code>lib.rs</code> and the <code>main.rs</code> contained a <code>mod</code> declaration for the same module. Thus, the compiler created two separate copies of the module and the contained <code>static</code>, which led to unexpected behavior.</p>
<p>I imagine that this could be a common error for people that are new to Rust. It's difficult to spot because everything works fine until you use statics. Since the statics are hidden in dependencies, it can lead to all kinds of strange issues.</p>
<p>So perhaps we should print a warning when the same module file is imported from different parent modules. What do you think? Perhaps this was already proposed somewhere?</p>



<a name="276787697"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/same%20mod%20declared%20multiple%20times/near/276787697" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/same.20mod.20declared.20multiple.20times.html#276787697">(Mar 27 2022 at 13:10)</a>:</h4>
<blockquote>
<p>everything works fine </p>
</blockquote>
<p>... until you try to pass _any_ data between those two modules, not just statics. That is, <code>main::foo::Bar</code> and <code>lib::foo::Bar</code> are wholly different types / functions / statics.</p>



<a name="276787704"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/same%20mod%20declared%20multiple%20times/near/276787704" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/same.20mod.20declared.20multiple.20times.html#276787704">(Mar 27 2022 at 13:10)</a>:</h4>
<blockquote>
<p>when the same module file is imported from different parent modules</p>
</blockquote>
<p>But it's from completely different <em>crates</em> in your example, which means completely separate <code>rustc</code> invocations.</p>



<a name="276787712"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/same%20mod%20declared%20multiple%20times/near/276787712" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/same.20mod.20declared.20multiple.20times.html#276787712">(Mar 27 2022 at 13:11)</a>:</h4>
<p>Yes, a warning would be nice, but I'm not inventive enough to see how it could happen.</p>



<a name="276787719"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/same%20mod%20declared%20multiple%20times/near/276787719" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/same.20mod.20declared.20multiple.20times.html#276787719">(Mar 27 2022 at 13:11)</a>:</h4>
<p>In a single crate would be easier, likely.</p>



<a name="276787789"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/same%20mod%20declared%20multiple%20times/near/276787789" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/same.20mod.20declared.20multiple.20times.html#276787789">(Mar 27 2022 at 13:13)</a>:</h4>
<p>The compiler has span info available, it could see what file <code>mod foo</code> resolves to and give a warning if any item from a dependency has that as a source</p>



<a name="276787801"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/same%20mod%20declared%20multiple%20times/near/276787801" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/same.20mod.20declared.20multiple.20times.html#276787801">(Mar 27 2022 at 13:13)</a>:</h4>
<p>Would probably break when --remap-path-prefix is enabled but <span aria-label="shrug" class="emoji emoji-1f937" role="img" title="shrug">:shrug:</span></p>



<a name="276787876"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/same%20mod%20declared%20multiple%20times/near/276787876" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/same.20mod.20declared.20multiple.20times.html#276787876">(Mar 27 2022 at 13:14)</a>:</h4>
<p>And there are times where people do this on purpose (IIRC clap recommended it at one point)</p>



<a name="276787900"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/same%20mod%20declared%20multiple%20times/near/276787900" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philipp Oppermann <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/same.20mod.20declared.20multiple.20times.html#276787900">(Mar 27 2022 at 13:15)</a>:</h4>
<blockquote>
<p>... until you try to pass _any_ data between those two modules, not just statics. That is, main::foo::Bar and lib::foo::Bar are wholly different types / functions / statics.</p>
</blockquote>
<p>Ah yes, I forgot about that. But the resulting error in these situations could also be confusing for people that haven't fully grasped Rust's module system.</p>



<a name="276787901"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/same%20mod%20declared%20multiple%20times/near/276787901" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/same.20mod.20declared.20multiple.20times.html#276787901">(Mar 27 2022 at 13:15)</a>:</h4>
<p>(deleted)</p>



<a name="276788128"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/same%20mod%20declared%20multiple%20times/near/276788128" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/same.20mod.20declared.20multiple.20times.html#276788128">(Mar 27 2022 at 13:20)</a>:</h4>
<p><a href="/user_uploads/4715/zoIKHoOpTCvf15gOFPDksTdf/8ff3db4a-b592-4888-bea5-61ba8bc7d882.png">8ff3db4a-b592-4888-bea5-61ba8bc7d882.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/zoIKHoOpTCvf15gOFPDksTdf/8ff3db4a-b592-4888-bea5-61ba8bc7d882.png" title="8ff3db4a-b592-4888-bea5-61ba8bc7d882.png"><img src="/user_uploads/4715/zoIKHoOpTCvf15gOFPDksTdf/8ff3db4a-b592-4888-bea5-61ba8bc7d882.png"></a></div>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>