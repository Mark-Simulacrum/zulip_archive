<html>
<head><meta charset="utf-8"><title>generating core dump on panic · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/generating.20core.20dump.20on.20panic.html">generating core dump on panic</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="271286298"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/generating%20core%20dump%20on%20panic/near/271286298" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/generating.20core.20dump.20on.20panic.html#271286298">(Feb 09 2022 at 14:33)</a>:</h4>
<p>In training, someone asked if there was a way to generate a core dump when a panic occurs. I don't <em>think</em> there is, other than overriding the panic handler. Are there any other solutions?</p>



<a name="271287477"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/generating%20core%20dump%20on%20panic/near/271287477" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amanieu <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/generating.20core.20dump.20on.20panic.html#271287477">(Feb 09 2022 at 14:40)</a>:</h4>
<p><code>-C panic=abort</code> will do it since it exits with <code>abort()</code> instead of <code>exit(101)</code>.</p>



<a name="271287572"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/generating%20core%20dump%20on%20panic/near/271287572" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amanieu <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/generating.20core.20dump.20on.20panic.html#271287572">(Feb 09 2022 at 14:41)</a>:</h4>
<p>In fact, I wonder if we shouldn't change that <code>exit(101)</code> to <code>abort()</code> so we always get a core dump on panic.</p>



<a name="271291749"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/generating%20core%20dump%20on%20panic/near/271291749" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/generating.20core.20dump.20on.20panic.html#271291749">(Feb 09 2022 at 15:09)</a>:</h4>
<p>+1 from me! There is a crate called <a href="https://crates.io/crates/coredump">coredump</a> which can do this but it's GPL 3 which is hard no-go for a lot of people.</p>



<a name="271310120"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/generating%20core%20dump%20on%20panic/near/271310120" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/generating.20core.20dump.20on.20panic.html#271310120">(Feb 09 2022 at 16:59)</a>:</h4>
<p>Switching between unwind / abort means recompiling the entire dependency graph, right?</p>



<a name="271310438"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/generating%20core%20dump%20on%20panic/near/271310438" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/generating.20core.20dump.20on.20panic.html#271310438">(Feb 09 2022 at 17:00)</a>:</h4>
<p><span class="user-mention silent" data-user-id="143274">Amanieu</span> <a href="#narrow/stream/122651-general/topic/generating.20core.20dump.20on.20panic/near/271287572">said</a>:</p>
<blockquote>
<p>In fact, I wonder if we shouldn't change that <code>exit(101)</code> to <code>abort()</code> so we always get a core dump on panic.</p>
</blockquote>
<p>Wouldn't this cause the core dump to occur at a not-useful location? Like, it's unwound all the way to <code>rust_main</code> or whatever and then generates the core?</p>



<a name="271313221"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/generating%20core%20dump%20on%20panic/near/271313221" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/generating.20core.20dump.20on.20panic.html#271313221">(Feb 09 2022 at 17:17)</a>:</h4>
<p>Yep</p>



<a name="271313403"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/generating%20core%20dump%20on%20panic/near/271313403" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/generating.20core.20dump.20on.20panic.html#271313403">(Feb 09 2022 at 17:19)</a>:</h4>
<p>It's a LLVM limitation that we don't have a way to terminate early upon unwinding, so there's nothing better that we can do.</p>



<a name="271316119"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/generating%20core%20dump%20on%20panic/near/271316119" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/generating.20core.20dump.20on.20panic.html#271316119">(Feb 09 2022 at 17:34)</a>:</h4>
<p>A hacky thing would be to fork and have the child abort <span aria-label="see no evil" class="emoji emoji-1f648" role="img" title="see no evil">:see_no_evil:</span></p>



<a name="271316165"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/generating%20core%20dump%20on%20panic/near/271316165" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/generating.20core.20dump.20on.20panic.html#271316165">(Feb 09 2022 at 17:34)</a>:</h4>
<p><a href="https://doc.rust-lang.org/std/panic/fn.set_hook.html">https://doc.rust-lang.org/std/panic/fn.set_hook.html</a> sigquit in a panic hook?</p>



<a name="271316794"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/generating%20core%20dump%20on%20panic/near/271316794" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/generating.20core.20dump.20on.20panic.html#271316794">(Feb 09 2022 at 17:37)</a>:</h4>
<p><span class="user-mention silent" data-user-id="330154">The 8472</span> <a href="#narrow/stream/122651-general/topic/generating.20core.20dump.20on.20panic/near/271316165">said</a>:</p>
<blockquote>
<p><a href="https://doc.rust-lang.org/std/panic/fn.set_hook.html">https://doc.rust-lang.org/std/panic/fn.set_hook.html</a> sigquit in a panic hook?</p>
</blockquote>
<p>Is that similar to my "other than overriding the panic handler" ?</p>



<a name="271316991"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/generating%20core%20dump%20on%20panic/near/271316991" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/generating.20core.20dump.20on.20panic.html#271316991">(Feb 09 2022 at 17:38)</a>:</h4>
<p>Ah well, I thought you meant <code>#[panic_handler]</code>.</p>



<a name="271317041"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/generating%20core%20dump%20on%20panic/near/271317041" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amanieu <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/generating.20core.20dump.20on.20panic.html#271317041">(Feb 09 2022 at 17:38)</a>:</h4>
<p>Since you're doing a core dump before even attempting unwinding, you might as well just use <code>-C panic=abort</code>.</p>



<a name="271317145"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/generating%20core%20dump%20on%20panic/near/271317145" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/generating.20core.20dump.20on.20panic.html#271317145">(Feb 09 2022 at 17:39)</a>:</h4>
<p>Setting the hook doesn't need recompiling</p>



<a name="271317392"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/generating%20core%20dump%20on%20panic/near/271317392" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/generating.20core.20dump.20on.20panic.html#271317392">(Feb 09 2022 at 17:40)</a>:</h4>
<p><a href="https://man7.org/linux/man-pages/man1/gcore.1.html">https://man7.org/linux/man-pages/man1/gcore.1.html</a></p>



<a name="271318533"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/generating%20core%20dump%20on%20panic/near/271318533" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/generating.20core.20dump.20on.20panic.html#271318533">(Feb 09 2022 at 17:46)</a>:</h4>
<p><code>gcore</code> generates a coredump for a running program the moment you run <code>gcore</code>, right? It doesn't generate one at the precise moment you panic.</p>



<a name="271319074"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/generating%20core%20dump%20on%20panic/near/271319074" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/generating.20core.20dump.20on.20panic.html#271319074">(Feb 09 2022 at 17:49)</a>:</h4>
<p>It doesn't include a time machine, you'd need rr for that.</p>



<a name="271326777"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/generating%20core%20dump%20on%20panic/near/271326777" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/generating.20core.20dump.20on.20panic.html#271326777">(Feb 09 2022 at 18:36)</a>:</h4>
<p>If the constraints are not touching the existing panic machinery and not recompiling then attaching a debugger and setting a break point on something panic-related seems like the next best option.</p>



<a name="271336164"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/generating%20core%20dump%20on%20panic/near/271336164" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/generating.20core.20dump.20on.20panic.html#271336164">(Feb 09 2022 at 19:43)</a>:</h4>
<p>Oh, I don't know that recompiling is right out for them or not, just making sure I frame the potential solutions appropriately.</p>



<a name="271336368"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/generating%20core%20dump%20on%20panic/near/271336368" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/generating.20core.20dump.20on.20panic.html#271336368">(Feb 09 2022 at 19:44)</a>:</h4>
<p>I did mention attaching a debugger or sending the appropriate signal by hand (if that makes sense for their case)</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>