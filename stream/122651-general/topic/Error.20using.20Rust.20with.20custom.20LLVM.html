<html>
<head><meta charset="utf-8"><title>Error using Rust with custom LLVM · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Error.20using.20Rust.20with.20custom.20LLVM.html">Error using Rust with custom LLVM</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="248924399"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Error%20using%20Rust%20with%20custom%20LLVM/near/248924399" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Blacklock <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Error.20using.20Rust.20with.20custom.20LLVM.html#248924399">(Aug 09 2021 at 23:58)</a>:</h4>
<p>I'm not sure if this is right place to ask this, but I built rustc with a custom version of LLVM, and everything works fine until I compile to wasm32-unknown-unknown. I get this error: <code>error: linker 'rust-lld' not found</code>. I can't find practically anything about this error message online. Can anyone help me with this?</p>



<a name="248949843"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Error%20using%20Rust%20with%20custom%20LLVM/near/248949843" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Error.20using.20Rust.20with.20custom.20LLVM.html#248949843">(Aug 10 2021 at 07:51)</a>:</h4>
<p>Linking wasm requires lld. When building llvm inside the rust build system it is normally renamed to rust-lld to prevent conflicts with the native lld version. I think you can solve this by installing lld and then setting the linker for the wasm target to lld in <code>~/.cargo/config</code>.</p>



<a name="249024455"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Error%20using%20Rust%20with%20custom%20LLVM/near/249024455" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Blacklock <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Error.20using.20Rust.20with.20custom.20LLVM.html#249024455">(Aug 10 2021 at 19:26)</a>:</h4>
<p>Thanks for the response! I assumed LLD would not be used for linking Wasm (I'm not actually even sure what "linking Wasm" means) but I will try your suggestion!</p>



<a name="249025895"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Error%20using%20Rust%20with%20custom%20LLVM/near/249025895" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Error.20using.20Rust.20with.20custom.20LLVM.html#249025895">(Aug 10 2021 at 19:36)</a>:</h4>
<p>"linking wasm" =&gt; linking one or more wasm object files to form a single wasm module that can be loaded by your code.</p>



<a name="249034398"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Error%20using%20Rust%20with%20custom%20LLVM/near/249034398" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Blacklock <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Error.20using.20Rust.20with.20custom.20LLVM.html#249034398">(Aug 10 2021 at 20:38)</a>:</h4>
<p>Right, but on the surface it would seem this would be a substantially different process than traditional linking of object code. But obviously I have not done a deep dive into that part of the Wasm compilation process!</p>



<a name="249035475"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Error%20using%20Rust%20with%20custom%20LLVM/near/249035475" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Error.20using.20Rust.20with.20custom.20LLVM.html#249035475">(Aug 10 2021 at 20:47)</a>:</h4>
<p>It turns out that it is pretty similar at least right now. The linking section of the toolchain conventions (<a href="https://github.com/WebAssembly/tool-conventions/blob/main/Linking.md">https://github.com/WebAssembly/tool-conventions/blob/main/Linking.md</a>) describes that wasm object files have an extra section describing how symbols should be imported/exported and where relocations need to happen. The linker only needs to parse the high level structure of wasm object files, not the actual function bodies.</p>



<a name="249035653"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Error%20using%20Rust%20with%20custom%20LLVM/near/249035653" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Error.20using.20Rust.20with.20custom.20LLVM.html#249035653">(Aug 10 2021 at 20:49)</a>:</h4>
<p>Note that these are mere conventions. The LLVM toolchain follows them, but other toolchains are allowed to do their own thing, be it using a different format or be it directly emitting a complete wasm module from the compiler.</p>



<a name="249039102"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Error%20using%20Rust%20with%20custom%20LLVM/near/249039102" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Blacklock <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Error.20using.20Rust.20with.20custom.20LLVM.html#249039102">(Aug 10 2021 at 21:16)</a>:</h4>
<p>That's some great info. Thank you very much!</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>