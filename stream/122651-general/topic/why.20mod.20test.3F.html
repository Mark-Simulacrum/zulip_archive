<html>
<head><meta charset="utf-8"><title>why mod test? · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20mod.20test.3F.html">why mod test?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="277407698"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20mod%20test%3F/near/277407698" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colin Walters <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20mod.20test.3F.html#277407698">(Apr 01 2022 at 12:16)</a>:</h4>
<p>What is the reason that the book uses <code>#[cfg(test)] mod test</code>? <a href="https://github.com/bytecodealliance/cap-std/pull/240">https://github.com/bytecodealliance/cap-std/pull/240</a></p>



<a name="277408809"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20mod%20test%3F/near/277408809" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bram Geron <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20mod.20test.3F.html#277408809">(Apr 01 2022 at 12:25)</a>:</h4>
<p>I think it's a convenient way to put <code>#[cfg(test)]</code> on multiple things.</p>



<a name="277410951"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20mod%20test%3F/near/277410951" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20mod.20test.3F.html#277410951">(Apr 01 2022 at 12:41)</a>:</h4>
<p><code>std</code> puts the test mods into separate files for some performance reasons (incremental compilation I think)</p>



<a name="277411798"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20mod%20test%3F/near/277411798" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colin Walters <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20mod.20test.3F.html#277411798">(Apr 01 2022 at 12:48)</a>:</h4>
<p>Hmm...like if you wanted to factor out a helper function used only by the tests?  But it seems equally easy at early scale to just slap a <code>#[cfg(test)]</code> on that one helper</p>



<a name="277411913"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20mod%20test%3F/near/277411913" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colin Walters <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20mod.20test.3F.html#277411913">(Apr 01 2022 at 12:49)</a>:</h4>
<p>re separate files, sure; that makes sense, but that's a different case than what we're talking about here</p>



<a name="277412813"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20mod%20test%3F/near/277412813" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20mod.20test.3F.html#277412813">(Apr 01 2022 at 12:55)</a>:</h4>
<p>you usually have more than one test for a module, so you don't have to cfg() each individual function you cfg() the whole submodule once</p>



<a name="277413325"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20mod%20test%3F/near/277413325" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colin Walters <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20mod.20test.3F.html#277413325">(Apr 01 2022 at 12:59)</a>:</h4>
<p>But that's just it - <code>#[test]</code> already seems to imply <code>#[cfg(test)]</code> - just try it, add <code>#[test] fn foo() { some_function_that_does_not_exist(); }</code></p>



<a name="277413367"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20mod%20test%3F/near/277413367" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colin Walters <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20mod.20test.3F.html#277413367">(Apr 01 2022 at 12:59)</a>:</h4>
<p><code>cargo b</code> works just fine</p>



<a name="277414864"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20mod%20test%3F/near/277414864" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20mod.20test.3F.html#277414864">(Apr 01 2022 at 13:09)</a>:</h4>
<p>makes  a difference for test-only imports too</p>



<a name="277416490"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20mod%20test%3F/near/277416490" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20mod.20test.3F.html#277416490">(Apr 01 2022 at 13:22)</a>:</h4>
<blockquote>
<p><code>std</code> puts the test mods into separate files for some performance reasons (incremental compilation I think)</p>
</blockquote>
<p>My understanding is that Cargo can’t track that only tests changed when it’s one file and thus rebuilds the library more than is strictly needed. Not quite incremental, but similar areas.</p>



<a name="277416598"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20mod%20test%3F/near/277416598" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20mod.20test.3F.html#277416598">(Apr 01 2022 at 13:23)</a>:</h4>
<p>Test only imports and test only definitions, etc.</p>



<a name="277416605"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20mod%20test%3F/near/277416605" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bram Geron <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20mod.20test.3F.html#277416605">(Apr 01 2022 at 13:23)</a>:</h4>
<p>I guess I don’t see a strong reason for <code>mod test</code> any more…</p>



<a name="277416628"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20mod%20test%3F/near/277416628" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bram Geron <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20mod.20test.3F.html#277416628">(Apr 01 2022 at 13:23)</a>:</h4>
<p>Ah, yes, imports definitely</p>



<a name="277416658"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20mod%20test%3F/near/277416658" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bram Geron <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20mod.20test.3F.html#277416658">(Apr 01 2022 at 13:23)</a>:</h4>
<p>Those would be very annoying to cfg out</p>



<a name="277416775"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20mod%20test%3F/near/277416775" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20mod.20test.3F.html#277416775">(Apr 01 2022 at 13:24)</a>:</h4>
<p><a href="https://github.com/shepmaster/sxd/blob/46ae7480056dd6217a080ed8bdc190b7f2bf5b52/pull-parser/src/lib.rs#L1925">https://github.com/shepmaster/sxd/blob/46ae7480056dd6217a080ed8bdc190b7f2bf5b52/pull-parser/src/lib.rs#L1925</a></p>



<a name="277416827"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20mod%20test%3F/near/277416827" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20mod.20test.3F.html#277416827">(Apr 01 2022 at 13:24)</a>:</h4>
<p>See all the things not marked <code>#[test]</code></p>



<a name="277418341"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20mod%20test%3F/near/277418341" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20mod.20test.3F.html#277418341">(Apr 01 2022 at 13:35)</a>:</h4>
<p>I also sometimes add new test-only impl blocks to existing structs</p>



<a name="277418433"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20mod%20test%3F/near/277418433" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20mod.20test.3F.html#277418433">(Apr 01 2022 at 13:35)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">struct</span> <span class="nc">S</span><span class="p">;</span><span class="w"></span>
<span class="cp">#[cfg(test)]</span><span class="w"></span>
<span class="k">mod</span> <span class="nn">test</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">impl</span><span class="w"> </span><span class="n">S</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">from_mock</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">Self</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="277419426"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20mod%20test%3F/near/277419426" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20mod.20test.3F.html#277419426">(Apr 01 2022 at 13:41)</a>:</h4>
<p>If people want to see an example of that, it’s also in my link above.</p>



<a name="277419521"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20mod%20test%3F/near/277419521" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bram Geron <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20mod.20test.3F.html#277419521">(Apr 01 2022 at 13:42)</a>:</h4>
<p>Joshua, I guess you don’t need <code>mod test</code> for that either</p>



<a name="277420085"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20mod%20test%3F/near/277420085" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20mod.20test.3F.html#277420085">(Apr 01 2022 at 13:46)</a>:</h4>
<p>You <strong>never</strong> <em>need</em> <code>mod test</code></p>



<a name="277420209"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20mod%20test%3F/near/277420209" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20mod.20test.3F.html#277420209">(Apr 01 2022 at 13:47)</a>:</h4>
<p>Or probably any modules (e.g. C doesn’t have them and has quite a lot of usage in the real world)</p>



<a name="277420710"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20mod%20test%3F/near/277420710" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20mod.20test.3F.html#277420710">(Apr 01 2022 at 13:50)</a>:</h4>
<p>Well, C has a very different compilation model - in particular it has forward declarations, which rust doesn't have. Without those you have to declare struct fields inline, which means either <em>everything</em> is public or you have to add privacy to the language itself</p>



<a name="277421018"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20mod%20test%3F/near/277421018" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20mod.20test.3F.html#277421018">(Apr 01 2022 at 13:52)</a>:</h4>
<p>C also treats each file as a separate compilation unit, which helps with not making privacy part of the language itself</p>



<a name="277421242"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20mod%20test%3F/near/277421242" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20mod.20test.3F.html#277421242">(Apr 01 2022 at 13:53)</a>:</h4>
<p>So <code>#[cfg(test)] mod test { … }</code> doesn't really add much, but for a factored out <code>cfg</code> on all the items defined therein, such as imports, extra types, extra impls, as well as a <code>test::</code> prefix on the testing functions (so that they oughtn't need a <code>test_</code> prefix in their name). It's already kind of nice, but nothing super important.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#[cfg(test)]</span><span class="w"></span>
<span class="k">mod</span> <span class="nn">test</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
<p>on the other hand, not only achieves "all of the above", but it does also <strong>improve compilation time of <code>cargo test</code></strong>, as mentioned in this thread, and I cannot stress it enough: it's such a simple way to get a dev-siding QoL improvement, that it would be a pity to miss it.</p>



<a name="277421300"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20mod%20test%3F/near/277421300" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20mod.20test.3F.html#277421300">(Apr 01 2022 at 13:53)</a>:</h4>
<p>Sure, I don’t mean to say that the languages are the same. My point is that you could make working software without modules or privacy or memory safety or a consistent naming style or human readable identifiers. Yet we still do because it makes the code easier to reason about.</p>



<a name="277421458"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20mod%20test%3F/near/277421458" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20mod.20test.3F.html#277421458">(Apr 01 2022 at 13:54)</a>:</h4>
<p>My point is that C does have privacy, just by a different mechanism :P but I agree with your larger point</p>



<a name="277421607"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20mod%20test%3F/near/277421607" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20mod.20test.3F.html#277421607">(Apr 01 2022 at 13:55)</a>:</h4>
<p><span class="user-mention" data-user-id="232018">@Daniel Henry-Mantilla</span> you mean specifically with putting tests in a separate file, right?</p>



<a name="277421669"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20mod%20test%3F/near/277421669" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20mod.20test.3F.html#277421669">(Apr 01 2022 at 13:56)</a>:</h4>
<p>Not just a module.</p>



<a name="277421761"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20mod%20test%3F/near/277421761" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20mod.20test.3F.html#277421761">(Apr 01 2022 at 13:56)</a>:</h4>
<p>Yes, the <code>;</code> in there was the important thing I wanted to highlight <span aria-label="100" class="emoji emoji-1f4af" role="img" title="100">:100:</span></p>



<a name="277421915"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20mod%20test%3F/near/277421915" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20mod.20test.3F.html#277421915">(Apr 01 2022 at 13:57)</a>:</h4>
<p>So it’s akin to my previous comment (“My understanding is that Cargo can’t track that only tests changed…”)?</p>



<a name="277422027"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20mod%20test%3F/near/277422027" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20mod.20test.3F.html#277422027">(Apr 01 2022 at 13:58)</a>:</h4>
<p>Or is it broader in a way I don’t understand?</p>



<a name="277422029"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20mod%20test%3F/near/277422029" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20mod.20test.3F.html#277422029">(Apr 01 2022 at 13:58)</a>:</h4>
<p>Yep, I was just "stressing" that point, since even when mentioned I've noticed people overlook it <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="277422366"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20mod%20test%3F/near/277422366" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20mod.20test.3F.html#277422366">(Apr 01 2022 at 14:00)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/122651-general/topic/why.20mod.20test.3F/near/277421458">said</a>:</p>
<blockquote>
<p>My point is that C does have privacy</p>
</blockquote>
<p>Name a more overloaded word than <code>static</code> in C <span aria-label="sob" class="emoji emoji-1f62d" role="img" title="sob">:sob:</span></p>



<a name="277422404"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20mod%20test%3F/near/277422404" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20mod.20test.3F.html#277422404">(Apr 01 2022 at 14:00)</a>:</h4>
<p>I don’t know how useful it is to most users though. Would need a breakdown of how long the library takes to build vs the tests, how often people make test-only changes, etc.</p>



<a name="277422462"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20mod%20test%3F/near/277422462" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20mod.20test.3F.html#277422462">(Apr 01 2022 at 14:01)</a>:</h4>
<p>True (I ought to make that change where I work, and benchmark the difference, to have more factual visibility on this point)</p>



<a name="277422509"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20mod%20test%3F/near/277422509" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20mod.20test.3F.html#277422509">(Apr 01 2022 at 14:01)</a>:</h4>
<p>The standard library is a special ish case because of the stages.</p>



<a name="277422729"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20mod%20test%3F/near/277422729" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20mod.20test.3F.html#277422729">(Apr 01 2022 at 14:03)</a>:</h4>
<p>It’s definitely a benefit though.</p>
<p>Oh, and you’d have to factor in the annoyance of all the <code>test.rs</code> files. Like we got away from all the <code>mod.rs</code></p>



<a name="277423099"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20mod%20test%3F/near/277423099" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20mod.20test.3F.html#277423099">(Apr 01 2022 at 14:05)</a>:</h4>
<p>Yeah, not all IDEs will lay out <code>foo.rs</code> next to <code>foo/tests.rs</code>, and <em>that</em> can be incredibly annoying. <del>Almost to the point of being tempted to use <code>#[path = "foo_tests.rs"] mod tests;</code> instead <span aria-label="speak no evil" class="emoji emoji-1f64a" role="img" title="speak no evil">:speak_no_evil:</span> </del></p>



<a name="277423253"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20mod%20test%3F/near/277423253" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20mod.20test.3F.html#277423253">(Apr 01 2022 at 14:06)</a>:</h4>
<blockquote>
<p>benchmark the difference</p>
</blockquote>
<p>Please do! I’d be interested. Capture both the time to build the tests and run them. I bet the run time dwarfs the build times.</p>



<a name="277423406"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20mod%20test%3F/near/277423406" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20mod.20test.3F.html#277423406">(Apr 01 2022 at 14:07)</a>:</h4>
<p>I thought about mentioning the path attribute, but the less we talk about it the better for everyone</p>



<a name="277423927"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20mod%20test%3F/near/277423927" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20mod.20test.3F.html#277423927">(Apr 01 2022 at 14:11)</a>:</h4>
<p>I wonder if rust analyzer or Cargo check benefit from the separate file.</p>



<a name="277424586"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20mod%20test%3F/near/277424586" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colin Walters <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20mod.20test.3F.html#277424586">(Apr 01 2022 at 14:16)</a>:</h4>
<p><a href="https://github.com/rust-lang/cargo/pull/10530">https://github.com/rust-lang/cargo/pull/10530</a></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>