<html>
<head><meta charset="utf-8"><title>Utility test modules and dead_code warnings · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Utility.20test.20modules.20and.20dead_code.20warnings.html">Utility test modules and dead_code warnings</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="259755429"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Utility%20test%20modules%20and%20dead_code%20warnings/near/259755429" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ryan Lee <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Utility.20test.20modules.20and.20dead_code.20warnings.html#259755429">(Oct 30 2021 at 22:37)</a>:</h4>
<p>I have a <code>tests/utils/mod.rs</code> module that contains helper functions for my code's tests. I have two integration test files <code>tests/test1.rs</code> and <code>tests/test2.rs</code>, which each use some, but not all, of the helper functions in <code>tests/utils/mod.rs</code>. When I run <code>cargo test</code>, I get dead code warnings for both the functions unused in <code>tests/test1.rs</code> and for the functions unused in <code>tests/test2.rs</code>. This seems like a bug, with the expected behavior being only getting dead_code warnings for functions of <code>tests/utils/mod.rs</code> unused in both <code>tests/test1.rs</code> and <code>tests/test2.rs</code>, but I wanted to confirm this before filing a bug report against the <code>rust-lang/rust</code> repository.</p>



<a name="259763390"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Utility%20test%20modules%20and%20dead_code%20warnings/near/259763390" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Utility.20test.20modules.20and.20dead_code.20warnings.html#259763390">(Oct 31 2021 at 02:16)</a>:</h4>
<p>That is expected behavior.  If you are using <code>mod utils;</code> in two separate integration tests, it is independently compiling that module for each integration test.  Some workarounds: you can use a single integration test (<a href="https://github.com/rust-lang/cargo/blob/master/tests/testsuite/main.rs">example from cargo's uber testsuite</a>) or move the utility code to a separate package (like <a href="https://github.com/rust-lang/cargo/blob/master/crates/cargo-test-support/src/lib.rs">cargo's test support</a>).</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>