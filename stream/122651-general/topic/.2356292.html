<html>
<head><meta charset="utf-8"><title>#56292 · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2356292.html">#56292</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://rust-lang.github.io/zulip_archive/style.css" rel="stylesheet"></head>

<a name="148738386"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%2356292/near/148738386" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2356292.html#148738386">(Nov 28 2018 at 19:52)</a>:</h4>
<p><span class="user-mention" data-user-id="126931">@centril</span> what isn't clear about <a href="https://github.com/rust-lang/rust/issues/56292#issuecomment-442561265" target="_blank" title="https://github.com/rust-lang/rust/issues/56292#issuecomment-442561265">https://github.com/rust-lang/rust/issues/56292#issuecomment-442561265</a> ?<br>
WASM does not have signed or unsigned integers, it just has bag of bits that are integers</p>



<a name="148738425"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%2356292/near/148738425" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2356292.html#148738425">(Nov 28 2018 at 19:53)</a>:</h4>
<p><span class="user-mention" data-user-id="130125">@Dan Gohman</span> explained here <a href="https://github.com/rust-lang/rust/issues/56292#issuecomment-442561265" target="_blank" title="https://github.com/rust-lang/rust/issues/56292#issuecomment-442561265">https://github.com/rust-lang/rust/issues/56292#issuecomment-442561265</a> that WASM checks for overflow using <code>gt_u</code>, which means that this check interprets the bits as an unsigned integer</p>



<a name="148738429"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%2356292/near/148738429" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2356292.html#148738429">(Nov 28 2018 at 19:53)</a>:</h4>
<p>it has signed and unsigned integer <em>operations</em> (for those where it makes a difference)</p>



<a name="148738436"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%2356292/near/148738436" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> centril <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2356292.html#148738436">(Nov 28 2018 at 19:53)</a>:</h4>
<p><span class="user-mention" data-user-id="132920">@gnzlbg</span>  the operational semantics of WASM does not state whether <code>delta &lt; 0</code> is permitted or not</p>



<a name="148738503"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%2356292/near/148738503" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2356292.html#148738503">(Nov 28 2018 at 19:54)</a>:</h4>
<p>If wasm interprets delta as unsigned, then it does not have to state that AFAICT because it always holds ?</p>



<a name="148738556"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%2356292/near/148738556" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> centril <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2356292.html#148738556">(Nov 28 2018 at 19:55)</a>:</h4>
<p><span class="user-mention" data-user-id="132920">@gnzlbg</span>  to frame it in <span class="user-mention" data-user-id="120791">@RalfJ</span>'s terms, I didn't see that it states whether the concatenation is interpreted in terms of signed or unsigned integer operations or not</p>



<a name="148738620"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%2356292/near/148738620" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> centril <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2356292.html#148738620">(Nov 28 2018 at 19:56)</a>:</h4>
<p>I would expect that it is unsigned; but there's doubt here imo</p>



<a name="148738629"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%2356292/near/148738629" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2356292.html#148738629">(Nov 28 2018 at 19:56)</a>:</h4>
<p>I think that's what <span class="user-mention" data-user-id="130125">@Dan Gohman</span> was hinting at when they said <code>gt_u</code> is used.</p>



<a name="148738642"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%2356292/near/148738642" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> centril <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2356292.html#148738642">(Nov 28 2018 at 19:56)</a>:</h4>
<p>in particular the phrasing "grow" and "append" suggest &gt;= but that's not a formal semantics :P</p>



<a name="148738644"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%2356292/near/148738644" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2356292.html#148738644">(Nov 28 2018 at 19:56)</a>:</h4>
<p><code>gt_u</code> is the "greater-than unsigned" operation</p>



<a name="148738661"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%2356292/near/148738661" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> centril <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2356292.html#148738661">(Nov 28 2018 at 19:57)</a>:</h4>
<p><span class="user-mention" data-user-id="132920">@gnzlbg</span> ye; sadly I didn't find the OCaml code well documented or readable</p>



<a name="148738746"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%2356292/near/148738746" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2356292.html#148738746">(Nov 28 2018 at 19:58)</a>:</h4>
<p>FWIW the spec isn't readable either, it's the only spec I actually had to send multiple PRs to because I had no idea what it was trying to say</p>



<a name="148738773"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%2356292/near/148738773" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2356292.html#148738773">(Nov 28 2018 at 19:58)</a>:</h4>
<p>There are multiple sources of truth that sometimes are contradictory, etc.</p>



<a name="148738779"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%2356292/near/148738779" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> centril <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2356292.html#148738779">(Nov 28 2018 at 19:58)</a>:</h4>
<p><span class="user-mention" data-user-id="132920">@gnzlbg</span> the notation wrt. operational semantics is somewhat nonstandard</p>



<a name="148738801"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%2356292/near/148738801" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2356292.html#148738801">(Nov 28 2018 at 19:59)</a>:</h4>
<p>I'm so happy they even have a normative operational semantics</p>



<a name="148738806"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%2356292/near/148738806" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> centril <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2356292.html#148738806">(Nov 28 2018 at 19:59)</a>:</h4>
<p>anyways; by keeping it <code>usize</code>, we at least can rule out some bugs even if WASM permits more</p>



<a name="148738807"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%2356292/near/148738807" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2356292.html#148738807">(Nov 28 2018 at 19:59)</a>:</h4>
<p>Basically, the word of the implementors is worth a bit more than what's on the spec</p>



<a name="148738832"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%2356292/near/148738832" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> centril <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2356292.html#148738832">(Nov 28 2018 at 19:59)</a>:</h4>
<p><span class="user-mention" data-user-id="120791">@RalfJ</span>  this is so true; it's much more than you can usually expect</p>



<a name="148738845"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%2356292/near/148738845" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2356292.html#148738845">(Nov 28 2018 at 19:59)</a>:</h4>
<p>The problem is that, if the spec is ambiguous enough, people might decide to recycle these to allow for shrinking memory in the future</p>



<a name="148738851"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%2356292/near/148738851" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> centril <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2356292.html#148738851">(Nov 28 2018 at 20:00)</a>:</h4>
<p>would be nice to formalize this in Agda</p>



<a name="148738916"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%2356292/near/148738916" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> centril <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2356292.html#148738916">(Nov 28 2018 at 20:00)</a>:</h4>
<p><span class="user-mention" data-user-id="132920">@gnzlbg</span>  we can add another function in such a case can we not?</p>



<a name="148738948"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%2356292/near/148738948" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2356292.html#148738948">(Nov 28 2018 at 20:00)</a>:</h4>
<p>yeah, but honestly, if this is an issue, then we should just file a github issue with the wasm spec</p>



<a name="148738978"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%2356292/near/148738978" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> centril <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2356292.html#148738978">(Nov 28 2018 at 20:01)</a>:</h4>
<p><code>memory_grow_yolo</code></p>



<a name="148738979"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%2356292/near/148738979" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2356292.html#148738979">(Nov 28 2018 at 20:01)</a>:</h4>
<p>they tend to clarify these things pretty quickly and amend the spec as necessary</p>



<a name="148739013"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%2356292/near/148739013" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> centril <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2356292.html#148739013">(Nov 28 2018 at 20:01)</a>:</h4>
<p><span class="user-mention" data-user-id="132920">@gnzlbg</span> this is why I suggested talking to the WASM folks on the issue</p>



<a name="148739069"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%2356292/near/148739069" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> centril <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2356292.html#148739069">(Nov 28 2018 at 20:02)</a>:</h4>
<p>but if I can just file a GitHub issue then ill do that</p>



<a name="148739200"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%2356292/near/148739200" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2356292.html#148739200">(Nov 28 2018 at 20:04)</a>:</h4>
<p>Reading the semantics: they say "Either, try growing mem by n pages:"</p>



<a name="148739225"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%2356292/near/148739225" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2356292.html#148739225">(Nov 28 2018 at 20:05)</a>:</h4>
<p>growing seems to imply that the number of pages before has to be less or equal to the number of pages afterwards</p>



<a name="148739232"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%2356292/near/148739232" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> centril <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2356292.html#148739232">(Nov 28 2018 at 20:05)</a>:</h4>
<p><span class="user-mention" data-user-id="132920">@gnzlbg</span> yes, however, "append" and "grow" are not defined terms</p>



<a name="148739240"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%2356292/near/148739240" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2356292.html#148739240">(Nov 28 2018 at 20:05)</a>:</h4>
<p>in any case, if that fails, this returns -1</p>



<a name="148739243"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%2356292/near/148739243" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> centril <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2356292.html#148739243">(Nov 28 2018 at 20:05)</a>:</h4>
<p><span class="user-mention" data-user-id="132920">@gnzlbg</span> sure, I agree that it implies that; but implication is not certainty</p>



<a name="148739305"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%2356292/near/148739305" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2356292.html#148739305">(Nov 28 2018 at 20:06)</a>:</h4>
<p>still, for Rust this doesn't help much, it still doesn't really tell us whether this has to be a signed or unsigned integer type</p>



<a name="148739336"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%2356292/near/148739336" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2356292.html#148739336">(Nov 28 2018 at 20:07)</a>:</h4>
<p><a href="https://webassembly.github.io/spec/core/exec/modules.html#grow-mem" target="_blank" title="https://webassembly.github.io/spec/core/exec/modules.html#grow-mem">https://webassembly.github.io/spec/core/exec/modules.html#grow-mem</a></p>



<a name="148739370"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%2356292/near/148739370" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2356292.html#148739370">(Nov 28 2018 at 20:07)</a>:</h4>
<blockquote>
<p>If len is larger than 2^16, then fail.</p>
</blockquote>
<p>I guess that's where Dan meant that the ML implementation uses <code>gt_u</code></p>



<a name="148739442"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%2356292/near/148739442" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2356292.html#148739442">(Nov 28 2018 at 20:08)</a>:</h4>
<blockquote>
<p>Let len be n added to the length of meminst.𝖽𝖺𝗍𝖺 divided by the page size 64Ki.</p>
</blockquote>
<p><del>The question is, how is this <code>len</code> added, is it a signed or unsigned add ? I don't remember if there was a difference here.</del> Add works for both signed and unsigned integers the same.</p>



<a name="148739851"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%2356292/near/148739851" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> centril <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2356292.html#148739851">(Nov 28 2018 at 20:12)</a>:</h4>
<p><a href="https://github.com/WebAssembly/spec/issues/924" target="_blank" title="https://github.com/WebAssembly/spec/issues/924">https://github.com/WebAssembly/spec/issues/924</a></p>



<hr><p>Last updated: Aug 07 2021 at 22:04 UTC</p>
</html>