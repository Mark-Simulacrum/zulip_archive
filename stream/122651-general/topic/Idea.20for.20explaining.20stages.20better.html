<html>
<head><meta charset="utf-8"><title>Idea for explaining stages better · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html">Idea for explaining stages better</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="208635443"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/208635443" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#208635443">(Sep 01 2020 at 01:20)</a>:</h4>
<p>I opened <a href="https://github.com/rust-lang/rustc-dev-guide/pull/843">https://github.com/rust-lang/rustc-dev-guide/pull/843</a> trying to explain stages some more. Trying to drum up visibility since it won't go through MCP :) please take a look if you're interested!</p>



<a name="209448740"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/209448740" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#209448740">(Sep 08 2020 at 21:51)</a>:</h4>
<p>trying this again: <a href="https://github.com/rust-lang/rustc-dev-guide/pull/857/">https://github.com/rust-lang/rustc-dev-guide/pull/857/</a></p>



<a name="211977576"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/211977576" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#211977576">(Oct 01 2020 at 21:25)</a>:</h4>
<p>fyi <span class="user-mention" data-user-id="120518">@Eric Huss</span> <a href="https://github.com/rust-lang/rustc-dev-guide/pull/857">https://github.com/rust-lang/rustc-dev-guide/pull/857</a> is getting close to merging, you might be interested in taking a look  :)</p>



<a name="211977613"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/211977613" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#211977613">(Oct 01 2020 at 21:26)</a>:</h4>
<p>(wow, did this really take me a whole month?)</p>



<a name="212125119"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/212125119" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#212125119">(Oct 02 2020 at 20:31)</a>:</h4>
<p>I read through the changes. I don't see any issues, but it's not clear to me how or where people get confused, so it's hard to know what will help.</p>



<a name="212126232"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/212126232" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#212126232">(Oct 02 2020 at 20:40)</a>:</h4>
<blockquote>
<p>it's not clear to me how or where people get confused</p>
</blockquote>
<p>mostly that '--stage 0' builds <em>with</em> the stage0 compiler, not that it gets built: <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/stage1.20compiler.20without.20std">https://rust-lang.zulipchat.com/#narrow/stream/182449-t-compiler.2Fhelp/topic/stage1.20compiler.20without.20std</a></p>



<a name="212127091"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/212127091" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#212127091">(Oct 02 2020 at 20:48)</a>:</h4>
<p>Here's something that confuses me: Does <code>--stage 1</code> build stage 1 or does it build <em>with</em> stage 1?</p>



<a name="212130874"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/212130874" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#212130874">(Oct 02 2020 at 21:26)</a>:</h4>
<p><code>build --stage 1</code> builds with stage 1, except rustdoc which is special</p>



<a name="212130900"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/212130900" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#212130900">(Oct 02 2020 at 21:27)</a>:</h4>
<p>Ah, so <code>--stage 1</code> builds stage 2 (except rustdoc)?</p>



<a name="212130911"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/212130911" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#212130911">(Oct 02 2020 at 21:27)</a>:</h4>
<p>What does it do for rustdoc?</p>



<a name="212130985"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/212130985" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#212130985">(Oct 02 2020 at 21:28)</a>:</h4>
<p><code>--stage 1 compiler/rustc</code> builds stage 2 without assembling it, I wouldn't say <code>--stage 1</code> builds stage 2 in general</p>



<a name="212131032"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/212131032" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#212131032">(Oct 02 2020 at 21:28)</a>:</h4>
<p><code>build --stage 1 src/tools/rustdoc</code> builds with stage 0 and links to stage 1</p>



<a name="212131062"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/212131062" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#212131062">(Oct 02 2020 at 21:29)</a>:</h4>
<p>unlike <code>build --stage 1 src/tools/clippy</code> which builds with stage 1 and links to stage 2</p>



<a name="212131426"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/212131426" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#212131426">(Oct 02 2020 at 21:32)</a>:</h4>
<p>(that's a bug though)</p>



<a name="212131445"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/212131445" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#212131445">(Oct 02 2020 at 21:33)</a>:</h4>
<p>it's just unclear which direction is expected</p>



<a name="212165979"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/212165979" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#212165979">(Oct 03 2020 at 10:56)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116122">simulacrum</span> <a href="#narrow/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better/near/212131426">said</a>:</p>
<blockquote>
<p>(that's a bug though)</p>
</blockquote>
<p>what is a bug? the staging behavior for clippy and miri makes sense, IMO; it is consistent with "build with stage X". so I assume rustdoc in the bug. why would the rustdoc direction be expected when it is not how anything else works?</p>



<a name="212184281"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/212184281" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#212184281">(Oct 03 2020 at 18:34)</a>:</h4>
<p>Wow, so confusing <span aria-label="confused" class="emoji emoji-1f615" role="img" title="confused">:confused:</span></p>



<a name="212184384"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/212184384" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#212184384">(Oct 03 2020 at 18:37)</a>:</h4>
<p>rustdoc's direction is currently the case mostly because people wanted stage 0 rustdoc to point at beta rustdoc. in order for there to not be an awkward hole (where stage 0 is beta and stage 1 is a full 2 compilers later) we shift rustdoc down a stage, matching rustc -- i.e., if we have a hypothetical src/tools/rustc, rustdoc matches that binary). clippy/miri are different in that a stage 0 build for them will still build a full compiler toolchain, iirc</p>



<a name="212184538"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/212184538" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#212184538">(Oct 03 2020 at 18:40)</a>:</h4>
<p><span class="user-mention" data-user-id="116122">@simulacrum</span> would it make sense to keep the current behavior of <code>doc --stage N</code>, but change <code>build</code> to match the other commands?</p>



<a name="212184547"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/212184547" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#212184547">(Oct 03 2020 at 18:41)</a>:</h4>
<p>Then if you're actually working on rustdoc the stages are consistent, but you can document with beta rustdoc if you want to</p>



<a name="212184556"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/212184556" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#212184556">(Oct 03 2020 at 18:41)</a>:</h4>
<p>maybe. not sure. I don't really use either so hard to say; might be more confusing.</p>



<a name="212184593"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/212184593" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#212184593">(Oct 03 2020 at 18:42)</a>:</h4>
<p>That seems more consistent in general with '--stage N runs the stage N compiler'</p>



<a name="212184599"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/212184599" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#212184599">(Oct 03 2020 at 18:42)</a>:</h4>
<p>I think it's a question of whether you treat rustdoc as a library or as a binary</p>



<a name="212184607"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/212184607" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#212184607">(Oct 03 2020 at 18:42)</a>:</h4>
<p>i.e., usually the binaries produced from stage N build will go into stage N+1/bin</p>



<a name="212184617"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/212184617" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#212184617">(Oct 03 2020 at 18:43)</a>:</h4>
<p>I think it should be consistent with compiler/rustc, which my idea does</p>



<a name="212184622"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/212184622" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#212184622">(Oct 03 2020 at 18:43)</a>:</h4>
<p>er, no? at least I think no</p>



<a name="212184623"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/212184623" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#212184623">(Oct 03 2020 at 18:43)</a>:</h4>
<p>As do the rest of the tools</p>



<a name="212184678"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/212184678" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#212184678">(Oct 03 2020 at 18:44)</a>:</h4>
<p>I don't see why not? You build rustdoc the first time with <code>build --stage 0</code> and it goes into stage1/bin</p>



<a name="212184684"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/212184684" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#212184684">(Oct 03 2020 at 18:44)</a>:</h4>
<p>As opposed to the current situation which builds with --stage 1 for the first time</p>



<a name="212184686"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/212184686" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#212184686">(Oct 03 2020 at 18:44)</a>:</h4>
<p>hm maybe</p>



<a name="212184695"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/212184695" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#212184695">(Oct 03 2020 at 18:44)</a>:</h4>
<p>I'd need to look at code and think about it for a bit</p>



<a name="212214783"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/212214783" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#212214783">(Oct 04 2020 at 09:29)</a>:</h4>
<p>I guess I don't see how "which rustdoc is used by <code>--stage 0 doc</code>" is connected with "which rustdoc is built by <code>--stage 0 build</code>".</p>



<a name="212222194"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/212222194" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#212222194">(Oct 04 2020 at 12:55)</a>:</h4>
<p>Well, that's sort of my complaint about bootstrap in general is that this is inconsistent across commands ;)</p>



<a name="212222205"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/212222205" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#212222205">(Oct 04 2020 at 12:55)</a>:</h4>
<p>But I think it should <em>at least</em> be consistently inconsistent and not treat rustdoc differently than other tools</p>



<a name="212222639"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/212222639" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#212222639">(Oct 04 2020 at 13:08)</a>:</h4>
<p>With my lense for "the stage says which compiler is sued to build the thing you are asking to be built", the problem is that with <code>doc</code> nothing really gets built...</p>



<a name="212222642"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/212222642" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#212222642">(Oct 04 2020 at 13:09)</a>:</h4>
<p>but I'd interpret this loosely as "it defines from which stage the rustdoc comes"</p>



<a name="212222653"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/212222653" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#212222653">(Oct 04 2020 at 13:09)</a>:</h4>
<p>so <code>doc --stage 0</code> should use the one from bootstrap and <code>doc --stage 1</code> should <code>build --stage 0 rustdoc</code> and then use that (similar to <code>test --stage 1 src/test/ui</code>)</p>



<a name="212222967"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/212222967" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#212222967">(Oct 04 2020 at 13:16)</a>:</h4>
<p>Yeah, that's my "consistently inconsistent" proposal. I guess that would need another MCP?</p>



<a name="212223315"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/212223315" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#212223315">(Oct 04 2020 at 13:26)</a>:</h4>
<p>also <span class="user-mention" data-user-id="120791">@RalfJ</span> <a href="https://github.com/rust-lang/rust/pull/77489">https://github.com/rust-lang/rust/pull/77489</a> is stalled on forming a consensus <del>even though there was already an MCP a month ago</del> so you might be interested in taking a look</p>



<a name="212223480"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/212223480" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#212223480">(Oct 04 2020 at 13:31)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better/near/212223315">said</a>:</p>
<blockquote>
<p>also <span class="user-mention silent" data-user-id="120791">RalfJ</span> <a href="https://github.com/rust-lang/rust/pull/77489">https://github.com/rust-lang/rust/pull/77489</a> is stalled on forming a consensus <del>even though there was already an MCP a month ago</del> so you might be interested in taking a look</p>
</blockquote>
<p>I don't really have an opinion on this TBH... I basically never use <code>x.py</code> without a filter, and cannot think of any that would be a good default</p>



<a name="212223483"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/212223483" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#212223483">(Oct 04 2020 at 13:31)</a>:</h4>
<p>TBH I'd probably make the filter mandatory if it was up to me^^</p>



<a name="212223601"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/212223601" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#212223601">(Oct 04 2020 at 13:34)</a>:</h4>
<p><span class="user-mention silent" data-user-id="120791">RalfJ</span> <a href="#narrow/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better/near/212222639">said</a>:</p>
<blockquote>
<p>With my lense for "the stage says which compiler is sued to build the thing you are asking to be built", the problem is that with <code>doc</code> nothing really gets built...</p>
</blockquote>
<p>the thing being built is the documentation</p>



<a name="212223608"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/212223608" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#212223608">(Oct 04 2020 at 13:34)</a>:</h4>
<p>so you're using the stage 0 compiler to build the docs, so in that sense <code>doc --stage 0</code> running beta is consistent with the rest of the subcommands</p>



<a name="212223700"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/212223700" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#212223700">(Oct 04 2020 at 13:37)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better/near/212223608">said</a>:</p>
<blockquote>
<p>so you're using the stage 0 compiler to build the docs, so in that sense <code>doc --stage 0</code> running beta is consistent with the rest of the subcommands</p>
</blockquote>
<p>agreed</p>



<a name="212223707"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/212223707" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#212223707">(Oct 04 2020 at 13:37)</a>:</h4>
<p>but <code>build --stage 0 rustdoc</code> is currently <em>not</em> consistent with the rest I'd argue</p>



<a name="212223759"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/212223759" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#212223759">(Oct 04 2020 at 13:38)</a>:</h4>
<p>right, that's the thing I want to change</p>



<a name="212230695"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/212230695" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#212230695">(Oct 04 2020 at 16:48)</a>:</h4>
<p>oh, I remembered I think why I thought we wanted this for other tools as well (or at least other subcommands).</p>
<p>x.py build --stage 1 clippy, ideally, would require only one rustc build. That implies using the <em>stage0</em> compiler to compile clippy, linking it against stage0 compiler artifacts. This would match rustdoc behavior</p>



<a name="212230743"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/212230743" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#212230743">(Oct 04 2020 at 16:48)</a>:</h4>
<p>that would also mean that e.g. x.py test --stage 1 src/test/ui src/tools/clippy is pretty fast, unlike today where I think that means two full rustc builds</p>



<a name="212232017"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/212232017" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#212232017">(Oct 04 2020 at 17:23)</a>:</h4>
<p><span class="user-mention silent" data-user-id="120791">RalfJ</span> <a href="#narrow/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better/near/212222639">said</a>:</p>
<blockquote>
<p>With my lense for "the stage says which compiler is sued to build the thing you are asking to be built", the problem is that with <code>doc</code> nothing really gets built...</p>
</blockquote>
<p>Well, it does end up in <code>build/doc</code>, so the documentation is what's being built.</p>



<a name="212232024"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/212232024" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#212232024">(Oct 04 2020 at 17:23)</a>:</h4>
<p>Oops, <span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> already said that</p>



<a name="212240612"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/212240612" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#212240612">(Oct 04 2020 at 20:36)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116122">simulacrum</span> <a href="#narrow/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better/near/212230743">said</a>:</p>
<blockquote>
<p>that would also mean that e.g. x.py test --stage 1 src/test/ui src/tools/clippy is pretty fast, unlike today where I think that means two full rustc builds</p>
</blockquote>
<p>really the odd one out here is <code>test --stage 1 src/test/ui</code> though -- for testing <code>library/X</code> or <code>src/tools/miri</code>, <code>--stage 0</code> is already what you want to build rustc as few times as possible.</p>



<a name="212240618"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/212240618" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#212240618">(Oct 04 2020 at 20:37)</a>:</h4>
<p>hm, perhaps :)</p>



<a name="212240641"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/212240641" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#212240641">(Oct 04 2020 at 20:37)</a>:</h4>
<p>I do wonder -- testing clippy and UI tests feels like it should not be different, so it would make sense for both to have the same stage, I think</p>



<a name="212240688"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/212240688" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#212240688">(Oct 04 2020 at 20:38)</a>:</h4>
<p>I guess the difference is UI tests only depend on std, unless they're  fulldeps</p>



<a name="212240798"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/212240798" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#212240798">(Oct 04 2020 at 20:40)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116122">simulacrum</span> <a href="#narrow/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better/near/212240688">said</a>:</p>
<blockquote>
<p>I guess the difference is UI tests only depend on std, unless they're  fulldeps</p>
</blockquote>
<p>yeah I think that is the technical reason why <code>test --stage 0 src/test/ui</code> just doesn't work... running ui tests needs a compiler build <em>and a stdlib built with that compiler</em></p>



<a name="266872904"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/266872904" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#266872904">(Jan 04 2022 at 22:25)</a>:</h4>
<p>I ran into this in <a href="https://github.com/rust-lang/rust/issues/92538">https://github.com/rust-lang/rust/issues/92538</a> . It's quite confusing to have rustdoc behave differently than other tools w.r.t the meaning of '--stage N'</p>



<a name="266879413"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/266879413" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#266879413">(Jan 04 2022 at 23:37)</a>:</h4>
<p><span class="user-mention" data-user-id="125294">@Aaron Hill</span> fyi I suspect neither I nor <span class="user-mention" data-user-id="116122">@simulacrum</span> are likely to make a PR for this, but <span class="user-mention silent" data-user-id="116122">simulacrum</span> might be willing to accept a PR changing it to be consistent with the other commands</p>



<a name="266879713"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/266879713" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#266879713">(Jan 04 2022 at 23:40)</a>:</h4>
<p>It's intentional iirc?</p>



<a name="266879758"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/266879758" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#266879758">(Jan 04 2022 at 23:41)</a>:</h4>
<p>Otherwise --stage 0 and --stage 1 will be inconsistent (or there's no way to access strictly bootstrap docs)</p>



<a name="266879892"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/266879892" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#266879892">(Jan 04 2022 at 23:42)</a>:</h4>
<p>But maybe it makes sense to change other tools - the primary reason for being inconsistent is that we currently have stage0/bin/rustdoc but not clippy, etc</p>



<a name="266879983"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/266879983" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#266879983">(Jan 04 2022 at 23:43)</a>:</h4>
<p>But yeah I'm not like 1000% committed to anything here, so a well motivated PR arguing the tradeoff here (or MCP, perhaps) seem reasonable to some extent.</p>



<a name="266880226"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/266880226" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#266880226">(Jan 04 2022 at 23:46)</a>:</h4>
<p>I guess a distinction between build --stage 0 rustdoc and doc --stage 0 std could be drawn (or interpreted in the right way), not sure. It would sort of make sense - stages have sort of different meaning at a conceptual level between use for compiler tools (rustdoc) and use of those tools (building documentation).</p>



<a name="266880380"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/266880380" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#266880380">(Jan 04 2022 at 23:48)</a>:</h4>
<p>I wonder if we should use names rather than numbers to refer to stages? So something like:</p>
<div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="gp">$ </span>x build --with-stage bootstrap rustdoc
</code></pre></div>
<p>Just an idea; it might be more confusing <span aria-label="shrug" class="emoji emoji-1f937" role="img" title="shrug">:shrug:</span></p>



<a name="266880395"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/266880395" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#266880395">(Jan 04 2022 at 23:49)</a>:</h4>
<p>Or just changing <code>--stage</code> to <code>--with-stage</code> or <code>--for-stage</code> depending on the meaning. (I think this has been proposed before though.)</p>



<a name="266880932"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/266880932" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#266880932">(Jan 04 2022 at 23:57)</a>:</h4>
<p>The latter for sure has been talked about, may not be a terrible idea (particularly with only one of those options available for different subcommands).</p>



<a name="266880998"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/266880998" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#266880998">(Jan 04 2022 at 23:58)</a>:</h4>
<p>Names are ... Hard. I have no nice names for these things, beyond bootstrap, and even that sounds a little confusing. Maybe "using=downloaded-rustc" but that has it's own problems.</p>



<a name="266881442"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/266881442" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#266881442">(Jan 05 2022 at 00:03)</a>:</h4>
<blockquote>
<p>Maybe "using=downloaded-rustc" but that has it's own problems.</p>
</blockquote>
<p>Yeah, that's hard because it could mean either bootstrap or stage1 (with <code>download-rustc = true</code>)</p>



<a name="266881561"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/266881561" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#266881561">(Jan 05 2022 at 00:04)</a>:</h4>
<p>I do think it might be good to use <code>--with-stage</code> or <code>--for-stage</code> (better name could be brainstormed) instead of just <code>--stage</code>. We could leave <code>--stage</code> as an alias to the old behavior if people have scripts/muscle memory that they don't want to lose.</p>



<a name="266881753"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/266881753" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#266881753">(Jan 05 2022 at 00:06)</a>:</h4>
<p>It might also be helpful to have "curated flags" since in most cases only a few combinations of commands and flags are actually commonly used.</p>



<a name="266881796"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/266881796" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#266881796">(Jan 05 2022 at 00:07)</a>:</h4>
<p>E.g., <code>x doc --with-bootstrap library/std</code> vs <code>x doc --with-local library/std</code> are the only two versions that are really useful.</p>



<a name="266881838"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/266881838" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#266881838">(Jan 05 2022 at 00:07)</a>:</h4>
<p>And these curated flags could handle the issue of needing to use stage1 rustdoc with download-rustc off but stage2 with it on.</p>



<a name="266882224"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/266882224" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#266882224">(Jan 05 2022 at 00:12)</a>:</h4>
<p>Perhaps, yeah. Not sure.</p>



<a name="266883940"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/266883940" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#266883940">(Jan 05 2022 at 00:37)</a>:</h4>
<p>Even if people keep using <code>--stage</code> just having the <code>--with</code> and <code>--from</code> version could help explaining what they mean in a specific context.</p>



<a name="266884160"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/266884160" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#266884160">(Jan 05 2022 at 00:40)</a>:</h4>
<blockquote>
<p>Otherwise --stage 0 and --stage 1 will be inconsistent (or there's no way to access strictly bootstrap docs)</p>
</blockquote>
<p>Can you elaborate? What prevents clippy from having the same behavior (e.g. stage0 means running with bootstrap)?</p>



<a name="266884347"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/266884347" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#266884347">(Jan 05 2022 at 00:43)</a>:</h4>
<p>We don't have a bootstrap clippy, unless we start downloading it - which isn't impossible but adds difficulty (particularly if it's optional). So currently there's nothing to run with --stage 0.</p>



<a name="266884470"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/266884470" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#266884470">(Jan 05 2022 at 00:45)</a>:</h4>
<p>I think it would be better for that option to just error, then</p>



<a name="266884491"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/266884491" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#266884491">(Jan 05 2022 at 00:45)</a>:</h4>
<p>Instead of changing what stage 0/1 means depending on the command</p>



<a name="266884504"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/266884504" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#266884504">(Jan 05 2022 at 00:45)</a>:</h4>
<p>Sure, changing all the other tools to match current rustdoc behavior may be a viable strategy</p>



<a name="266888304"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/266888304" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ryan Lee <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#266888304">(Jan 05 2022 at 01:48)</a>:</h4>
<p>My two cents (and I may have misunderstood things): the documentation states that passing in <code>--stage=n</code> means using the stage n compiler to build stage n+1 artifacts, so I expected <code>x.py build --stage=2</code> to build up to stage2 rustc and then build a stage3 compiler in <code>stage2-rustc</code>. However, using <code>--stage=2</code> only built the folders <code>stage2</code> and <code>stage2-std</code>, and I had to use <code>--stage=3</code> to get a <code>stage2-rustc</code> folder along with a <code>stage3</code> folder containing a stage3 rustc and associated artifacts. (This was with <code>full-bootstrap = true</code> in <code>config.toml</code> BTW.) Either I'm misunderstanding what that section means or that section's wording should be updated to be clearer.</p>



<a name="266890739"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/266890739" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#266890739">(Jan 05 2022 at 02:33)</a>:</h4>
<p>That particular problem is because we have defaults which didn't match your expectation: iirc, they don't include rustc, just std. There was another thread quite recently about removing defaults entirely in favor of requiring users to specify what they want, which may help address that.</p>



<a name="268443019"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/268443019" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#268443019">(Jan 18 2022 at 19:26)</a>:</h4>
<p>did someone end cooking a PR about this? I'd also love to see some better consistency here</p>



<a name="268460618"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Idea%20for%20explaining%20stages%20better/near/268460618" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Idea.20for.20explaining.20stages.20better.html#268460618">(Jan 18 2022 at 21:48)</a>:</h4>
<p>I have the beginnings of an attempt to rewrite the bootstrapping section. I'm only looking at how <code>x.py build</code> works to start with; I haven't considered <code>x.py test</code>, for example. This is as much to help me improve my own understanding as much as anything</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>