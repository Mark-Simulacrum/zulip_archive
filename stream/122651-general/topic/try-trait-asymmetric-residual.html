<html>
<head><meta charset="utf-8"><title>try-trait-asymmetric-residual · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/try-trait-asymmetric-residual.html">try-trait-asymmetric-residual</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="272465991"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/try-trait-asymmetric-residual/near/272465991" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sawyer Bergeron <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/try-trait-asymmetric-residual.html#272465991">(Feb 18 2022 at 22:20)</a>:</h4>
<p>I'm implementing an error handling system for a recursive descent parser. I have a struct that has generic arguments for whether it is handled in different ways, but when it's "thrown" using the ? operator I want it to revert to the unhandled state. This means I only want ? to exist for one type, and FromResidual to only exist for another. Is this possible? <a href="/user_uploads/4715/VaruVYuOck5oJcuK0NhlvroH/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/VaruVYuOck5oJcuK0NhlvroH/image.png" title="image.png"><img src="/user_uploads/4715/VaruVYuOck5oJcuK0NhlvroH/image.png"></a></div>



<a name="272484756"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/try-trait-asymmetric-residual/near/272484756" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/try-trait-asymmetric-residual.html#272484756">(Feb 19 2022 at 02:14)</a>:</h4>
<p>That's the second unresolved question from the RFC <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span>  <a href="https://github.com/rust-lang/rust/issues/84277">https://github.com/rust-lang/rust/issues/84277</a></p>



<a name="272484884"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/try-trait-asymmetric-residual/near/272484884" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/try-trait-asymmetric-residual.html#272484884">(Feb 19 2022 at 02:16)</a>:</h4>
<p>But yes, for now a <code>Try</code>-implementing type can <em>always</em> be rebuilt after being split up.</p>
<p>(And, in fact, the stable <code>Iterator::try_fold</code> method depends on being able to do that.  Though of course a hypothetical different type could just not support <code>try_fold</code> if we changed the trait structure.)</p>



<a name="272490254"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/try-trait-asymmetric-residual/near/272490254" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sawyer Bergeron <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/try-trait-asymmetric-residual.html#272490254">(Feb 19 2022 at 03:50)</a>:</h4>
<p>Replied to the RFC a little earlier with use case, I don't quite follow what you mean by being able to be rebuilt after being split up though,</p>



<a name="272491030"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/try-trait-asymmetric-residual/near/272491030" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/try-trait-asymmetric-residual.html#272491030">(Feb 19 2022 at 04:03)</a>:</h4>
<p><span class="user-mention silent" data-user-id="298448">Sawyer Bergeron</span> <a href="#narrow/stream/122651-general/topic/try-trait-asymmetric-residual/near/272490254">said</a>:</p>
<blockquote>
<p>rebuilt after being split up though,</p>
</blockquote>
<p>You can think of it like <code>try { x? }</code> being a NOP.</p>
<p>If you can <code>branch</code> it into its parts, you can re-create the original value.</p>



<a name="272491043"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/try-trait-asymmetric-residual/near/272491043" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/try-trait-asymmetric-residual.html#272491043">(Feb 19 2022 at 04:03)</a>:</h4>
<p>Can you elaborate on what you mean by "handled" here?</p>



<a name="272491181"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/try-trait-asymmetric-residual/near/272491181" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/try-trait-asymmetric-residual.html#272491181">(Feb 19 2022 at 04:06)</a>:</h4>
<p>Note that the current design <em>does</em> make it possible to return something that's not <code>?</code>-able while still using <code>?</code> in that method.</p>



<a name="272491187"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/try-trait-asymmetric-residual/near/272491187" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/try-trait-asymmetric-residual.html#272491187">(Feb 19 2022 at 04:06)</a>:</h4>
<p>So you could make <code>foo()?</code> not work but allow <code>foo().handle()?</code> if you wanted.</p>



<a name="272491574"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/try-trait-asymmetric-residual/near/272491574" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sawyer Bergeron <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/try-trait-asymmetric-residual.html#272491574">(Feb 19 2022 at 04:15)</a>:</h4>
<p>So I have the type from above, and two impl blocks near it. One defines <code>join()</code> which only exists for GuardResult&lt;_, Unjoined, _&gt;, and outputs a &lt;...Joined...&gt; type value. That one takes a reference to the current rule context (each function in the parser has one at the top) and aligns its token stream to the point that the GuardResult reached. The other impl block defines <code>catch()</code> which only exists for GuardResult&lt;_, _, Uncaught&gt; and returns one with a param of Caught. That checks if the object is able to be handled by the passed context (i.e. if there is an error inside, that context has the next token in the input stream in the set of tokens it's looking for next). I'd like to prevent the user from calling join or catch twice, but want to force dealing with each of those parts of the process before any function is allowed to ? the result. This prevents just blindly forwarding any error up the chain without putting a little bit of thought into ignoring/accepting stream alignment or how to 'catch' the error</p>



<a name="272491602"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/try-trait-asymmetric-residual/near/272491602" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sawyer Bergeron <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/try-trait-asymmetric-residual.html#272491602">(Feb 19 2022 at 04:15)</a>:</h4>
<p>When I apply the ? operator, I want it to switch those type parameters back to being uncaught and unjoined, so the next function up has to ack them as well</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>