<html>
<head><meta charset="utf-8"><title>why isn&#x27;t AtomicI32 Copy + Clone ? · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20isn&#x27;t.20AtomicI32.20Copy.20.2B.20Clone.20.3F.html">why isn&#x27;t AtomicI32 Copy + Clone ?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="252149750"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20isn%27t%20AtomicI32%20Copy%20%2B%20Clone%20%3F/near/252149750" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hannahE2 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20isn&#x27;t.20AtomicI32.20Copy.20.2B.20Clone.20.3F.html#252149750">(Sep 06 2021 at 09:26)</a>:</h4>
<p>I have a type with an <code>AtomicI32</code> field that can't derive Copy and Clone... but I don't see any reason why AtomicI32 can't be Copy and Clone.</p>



<a name="252149759"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20isn%27t%20AtomicI32%20Copy%20%2B%20Clone%20%3F/near/252149759" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hannahE2 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20isn&#x27;t.20AtomicI32.20Copy.20.2B.20Clone.20.3F.html#252149759">(Sep 06 2021 at 09:26)</a>:</h4>
<p>What's the workaround here?</p>



<a name="252150029"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20isn%27t%20AtomicI32%20Copy%20%2B%20Clone%20%3F/near/252150029" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20isn&#x27;t.20AtomicI32.20Copy.20.2B.20Clone.20.3F.html#252150029">(Sep 06 2021 at 09:29)</a>:</h4>
<p>For Copy an impl would make it too easy to accidentally change a copy instead of the original. For Clone I don't know for sure why it doesn't implement it. Maybe it was deemed too confusing.</p>
<p>You can manually implement Clone for your struct. You can't manually implement Copy though unless all fields are Copy. You probably shouldn't anyway when using interior mutability.</p>



<a name="252150673"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20isn%27t%20AtomicI32%20Copy%20%2B%20Clone%20%3F/near/252150673" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hannahE2 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20isn&#x27;t.20AtomicI32.20Copy.20.2B.20Clone.20.3F.html#252150673">(Sep 06 2021 at 09:35)</a>:</h4>
<p>Makes little sense to me :/</p>



<a name="252150785"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20isn%27t%20AtomicI32%20Copy%20%2B%20Clone%20%3F/near/252150785" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hannahE2 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20isn&#x27;t.20AtomicI32.20Copy.20.2B.20Clone.20.3F.html#252150785">(Sep 06 2021 at 09:36)</a>:</h4>
<p>An <code>AtomicI32</code> is just an <code>i32</code> that requires memory ops to pointers to it to be performed using atomic ops</p>



<a name="252150828"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20isn%27t%20AtomicI32%20Copy%20%2B%20Clone%20%3F/near/252150828" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hannahE2 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20isn&#x27;t.20AtomicI32.20Copy.20.2B.20Clone.20.3F.html#252150828">(Sep 06 2021 at 09:37)</a>:</h4>
<p>And <code>i32</code>s are <code>Copy + Clone</code></p>



<a name="252150903"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20isn%27t%20AtomicI32%20Copy%20%2B%20Clone%20%3F/near/252150903" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hannahE2 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20isn&#x27;t.20AtomicI32.20Copy.20.2B.20Clone.20.3F.html#252150903">(Sep 06 2021 at 09:37)</a>:</h4>
<p>I guess I can just use <code>i32</code> and transmute back and forth when I need to do atomic updates</p>



<a name="252150977"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20isn%27t%20AtomicI32%20Copy%20%2B%20Clone%20%3F/near/252150977" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hannahE2 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20isn&#x27;t.20AtomicI32.20Copy.20.2B.20Clone.20.3F.html#252150977">(Sep 06 2021 at 09:38)</a>:</h4>
<p>Just need to make sure to preserve the alignment</p>



<a name="252151020"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20isn%27t%20AtomicI32%20Copy%20%2B%20Clone%20%3F/near/252151020" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hannahE2 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20isn&#x27;t.20AtomicI32.20Copy.20.2B.20Clone.20.3F.html#252151020">(Sep 06 2021 at 09:39)</a>:</h4>
<p>Do we guarantee the layout of <code>AtomicI32</code> ? (is it sound to transmute <code>&amp;i32</code> to <code>&amp;AtomicI32</code> ?)</p>



<a name="252151034"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20isn%27t%20AtomicI32%20Copy%20%2B%20Clone%20%3F/near/252151034" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20isn&#x27;t.20AtomicI32.20Copy.20.2B.20Clone.20.3F.html#252151034">(Sep 06 2021 at 09:39)</a>:</h4>
<p>Not sure</p>



<a name="252151166"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20isn%27t%20AtomicI32%20Copy%20%2B%20Clone%20%3F/near/252151166" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20isn&#x27;t.20AtomicI32.20Copy.20.2B.20Clone.20.3F.html#252151166">(Sep 06 2021 at 09:40)</a>:</h4>
<p>the documentation for it says</p>
<blockquote>
<p>This type has the same in-memory representation as the underlying integer type, i32.</p>
</blockquote>



<a name="252151171"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20isn%27t%20AtomicI32%20Copy%20%2B%20Clone%20%3F/near/252151171" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20isn&#x27;t.20AtomicI32.20Copy.20.2B.20Clone.20.3F.html#252151171">(Sep 06 2021 at 09:40)</a>:</h4>
<blockquote>
<p>I guess I can just use <code>i32</code> and transmute back and forth when I need to do atomic updates</p>
</blockquote>
<p>No, if you have <code>i32</code> behind an immutable reference updating it is UB. If you have an <code>AtomicI32</code> it isn't UB due to the <code>UnsafeCell</code> wrapper it contains.</p>



<a name="252151198"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20isn%27t%20AtomicI32%20Copy%20%2B%20Clone%20%3F/near/252151198" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hannahE2 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20isn&#x27;t.20AtomicI32.20Copy.20.2B.20Clone.20.3F.html#252151198">(Sep 06 2021 at 09:41)</a>:</h4>
<p>Right, so I need <code>UnsafeCell&lt;i32&gt;</code></p>



<a name="252151244"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20isn%27t%20AtomicI32%20Copy%20%2B%20Clone%20%3F/near/252151244" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hannahE2 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20isn&#x27;t.20AtomicI32.20Copy.20.2B.20Clone.20.3F.html#252151244">(Sep 06 2021 at 09:41)</a>:</h4>
<p>and then transmute <code>&amp;UnsafeCell&lt;i32&gt;</code> to <code>&amp;i32</code> or <code>&amp;AtomicI32</code> as required</p>



<a name="252151315"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20isn%27t%20AtomicI32%20Copy%20%2B%20Clone%20%3F/near/252151315" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20isn&#x27;t.20AtomicI32.20Copy.20.2B.20Clone.20.3F.html#252151315">(Sep 06 2021 at 09:42)</a>:</h4>
<p>I don't think <code>UnsafeCell</code> implements Copy or Clone, for the same reasons that the atomics don't?</p>



<a name="252152458"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20isn%27t%20AtomicI32%20Copy%20%2B%20Clone%20%3F/near/252152458" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hannahE2 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20isn&#x27;t.20AtomicI32.20Copy.20.2B.20Clone.20.3F.html#252152458">(Sep 06 2021 at 09:52)</a>:</h4>
<p>This impacts generics as well</p>



<a name="252152510"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20isn%27t%20AtomicI32%20Copy%20%2B%20Clone%20%3F/near/252152510" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hannahE2 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20isn&#x27;t.20AtomicI32.20Copy.20.2B.20Clone.20.3F.html#252152510">(Sep 06 2021 at 09:53)</a>:</h4>
<p>like <code>struct S&lt;T&gt;(T)</code>, how do I derive Copy for it such that it is Copy when <code>T</code> is <code>AtomicI32</code> ?!</p>



<a name="252152901"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20isn%27t%20AtomicI32%20Copy%20%2B%20Clone%20%3F/near/252152901" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hannahE2 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20isn&#x27;t.20AtomicI32.20Copy.20.2B.20Clone.20.3F.html#252152901">(Sep 06 2021 at 09:57)</a>:</h4>
<p>ok i can just overrie these impls, nice</p>



<a name="252154522"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20isn%27t%20AtomicI32%20Copy%20%2B%20Clone%20%3F/near/252154522" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20isn&#x27;t.20AtomicI32.20Copy.20.2B.20Clone.20.3F.html#252154522">(Sep 06 2021 at 10:12)</a>:</h4>
<p>I don't think you can make it Copy if <code>T</code> is not Copy</p>



<a name="252161009"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20isn%27t%20AtomicI32%20Copy%20%2B%20Clone%20%3F/near/252161009" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20isn&#x27;t.20AtomicI32.20Copy.20.2B.20Clone.20.3F.html#252161009">(Sep 06 2021 at 11:19)</a>:</h4>
<blockquote>
<p>For Copy an impl would make it too easy to accidentally change a copy instead of the original. For Clone I don't know for sure why it doesn't implement it. Maybe it was deemed too confusing.</p>
</blockquote>
<p>Copy has a different reason actually, it would be impossible to implement soundly, as memcpy or a structural copy is non-atomic. If you copy an atomic that's being written to elsewhere without a happens-before relationship, that's a data race and UB.<br>
Clone could be, but as atomic operations can be expensive, and it's generally not necessary to clone atomics (as typically they reside at a well-known memory address), so I assume that's why it's not Clone.</p>



<a name="252171798"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20isn%27t%20AtomicI32%20Copy%20%2B%20Clone%20%3F/near/252171798" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20isn&#x27;t.20AtomicI32.20Copy.20.2B.20Clone.20.3F.html#252171798">(Sep 06 2021 at 12:58)</a>:</h4>
<p><span class="user-mention silent" data-user-id="409057">hannahE2</span> <a href="#narrow/stream/122651-general/topic/why.20isn't.20AtomicI32.20Copy.20.2B.20Clone.20.3F/near/252151020">said</a>:</p>
<blockquote>
<p>Do we guarantee the layout of <code>AtomicI32</code> ? (is it sound to transmute <code>&amp;i32</code> to <code>&amp;AtomicI32</code> ?)</p>
</blockquote>
<p>That seems unsafe since the atomic would allow modifying the value behind the reference while the normal borrow doesn't.</p>



<a name="252183766"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20isn%27t%20AtomicI32%20Copy%20%2B%20Clone%20%3F/near/252183766" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hannahE2 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20isn&#x27;t.20AtomicI32.20Copy.20.2B.20Clone.20.3F.html#252183766">(Sep 06 2021 at 14:32)</a>:</h4>
<blockquote>
<p>Copy has a different reason actually, it would be impossible to implement soundly, as memcpy or a structural copy is non-atomic.</p>
</blockquote>
<p>LLVM has atomic memcpy</p>



<a name="252197838"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20isn%27t%20AtomicI32%20Copy%20%2B%20Clone%20%3F/near/252197838" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20isn&#x27;t.20AtomicI32.20Copy.20.2B.20Clone.20.3F.html#252197838">(Sep 06 2021 at 16:30)</a>:</h4>
<blockquote>
<p><span class="user-mention silent" data-user-id="409057">hannahE2</span> <a href="#narrow/stream/122651-general/topic/why.20isn't.20AtomicI32.20Copy.20.2B.20Clone.20.3F/near/252151020">said</a>:</p>
</blockquote>
<blockquote>
<p>Do we guarantee the layout of <code>AtomicI32</code> ? (is it sound to transmute <code>&amp;i32</code> to <code>&amp;AtomicI32</code> ?)</p>
</blockquote>
<p>That seems unsafe since the atomic would allow modifying the value behind the reference while the normal borrow doesn't.</p>
<p>It's not guaranteed (it may have stricter size or alignment requirements to function on a particular platform), but on platforms where it is, AtomicI32::from_mut exists (unstable, though).</p>



<a name="252209429"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20isn%27t%20AtomicI32%20Copy%20%2B%20Clone%20%3F/near/252209429" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Giacomo Stevanato <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20isn&#x27;t.20AtomicI32.20Copy.20.2B.20Clone.20.3F.html#252209429">(Sep 06 2021 at 18:28)</a>:</h4>
<p><span class="user-mention silent" data-user-id="409057">hannahE2</span> <a href="#narrow/stream/122651-general/topic/why.20isn't.20AtomicI32.20Copy.20.2B.20Clone.20.3F/near/252183766">said</a>:</p>
<blockquote>
<blockquote>
<p>Copy has a different reason actually, it would be impossible to implement soundly, as memcpy or a structural copy is non-atomic.</p>
</blockquote>
<p>LLVM has atomic memcpy</p>
</blockquote>
<p>It would be very hard, or even impossible to enforce that only for atomics though.</p>



<a name="252285365"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20isn%27t%20AtomicI32%20Copy%20%2B%20Clone%20%3F/near/252285365" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20isn&#x27;t.20AtomicI32.20Copy.20.2B.20Clone.20.3F.html#252285365">(Sep 07 2021 at 10:54)</a>:</h4>
<p><span class="user-mention silent" data-user-id="409057">hannahE2</span> <a href="#narrow/stream/122651-general/topic/why.20isn't.20AtomicI32.20Copy.20.2B.20Clone.20.3F/near/252150785">said</a>:</p>
<blockquote>
<p>An <code>AtomicI32</code> is just an <code>i32</code> that requires memory ops to pointers to it to be performed using atomic ops</p>
</blockquote>
<p>Since an <code>AtomicI32</code> may be accessed, and more importantly, <em>mutated</em>, in parallel, a read of it needs to be done in a thread-safe fashion, mainly, an atomic read. <code>Copy</code> is a marker trait for basic bitwise copies, that is, unsynchronized / non-atomic reads.</p>
<p>So <strong><code>Atomic…</code> very much cannot impl <code>Copy</code></strong>!!</p>
<p>It could indeed implement <code>Clone</code> since that allows custom code to be inserted, but then remains the question of atomic memory orderings / memory coherence. Since there is no good default for the atomic memory ordering to be used when cloning, it makes sense that <code>AtomicI32</code> do not impl <code>Clone</code>, and to let people define their own custom wrapper types that implement it with the memory ordering they fancy.</p>
<p>That is, considering a type with no interior padding such as <code>i32</code>, if you wanted something with kind-of-decent defaults (<code>SeqCst</code> ordering…), then you could consider <a href="https://docs.rs/crossbeam/0.8.1/crossbeam/atomic/struct.AtomicCell.html#method.load"><code>AtomicCell</code></a><code>&lt;i32&gt;</code>. For some reason, it doesn't implement <code>Clone</code>, although it would be an excellent candidate for it, especially given how it intends to be a thread-safe equivalent of the <code>Cell</code> type, and how <code>Cell</code> <a href="https://doc.rust-lang.org/stable/std/cell/struct.Cell.html#impl-Clone">does implement <code>Clone</code></a>.</p>
<ul>
<li>Tangentially, if there was a type with interior mutability that could implement <code>Copy</code>, then that would very much be <code>Cell&lt;impl Copy&gt;</code>, and <code>Cell&lt;impl Copy&gt;</code> <em>only</em>. It currently can't since <code>Copy</code> currently comes with unavoidable structural requirements, and <code>UnsafeCell</code> does not implement <code>Copy</code> yet to avoid footguns (similar to it, or raw pointers, not implementing <code>Sync</code>, even though it wouldn't be unsound).</li>
</ul>



<a name="255354181"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20isn%27t%20AtomicI32%20Copy%20%2B%20Clone%20%3F/near/255354181" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philipp Korber <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20isn&#x27;t.20AtomicI32.20Copy.20.2B.20Clone.20.3F.html#255354181">(Sep 29 2021 at 07:24)</a>:</h4>
<blockquote>
<p>LLVM has atomic memcpy</p>
</blockquote>
<p>Copy requires support for "normal" non-arguments memcopy/structural copy.</p>



<a name="255354799"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20isn%27t%20AtomicI32%20Copy%20%2B%20Clone%20%3F/near/255354799" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philipp Korber <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20isn&#x27;t.20AtomicI32.20Copy.20.2B.20Clone.20.3F.html#255354799">(Sep 29 2021 at 07:30)</a>:</h4>
<p>I would describe a <code>AtomicI32</code>:</p>
<p>A memory object (not ptr.) which is at least 4 bytes long but (unstable) platform dependent might be larger which semantically contains <code>UnsafeCell&lt;i32&gt;</code> and provides methods to allow lock-free (and often wait-free) mutable access through shared references in the style of C++20 atomics.</p>



<a name="255574170"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20isn%27t%20AtomicI32%20Copy%20%2B%20Clone%20%3F/near/255574170" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20isn&#x27;t.20AtomicI32.20Copy.20.2B.20Clone.20.3F.html#255574170">(Sep 30 2021 at 13:32)</a>:</h4>
<p>One could also think of it as an especially compact rwlock that comes with some predefined critical sections.</p>



<a name="255607585"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20isn%27t%20AtomicI32%20Copy%20%2B%20Clone%20%3F/near/255607585" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20isn&#x27;t.20AtomicI32.20Copy.20.2B.20Clone.20.3F.html#255607585">(Sep 30 2021 at 16:50)</a>:</h4>
<p>I would like an inherent clone method that takes an ordering.</p>



<a name="255680319"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20isn%27t%20AtomicI32%20Copy%20%2B%20Clone%20%3F/near/255680319" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20isn&#x27;t.20AtomicI32.20Copy.20.2B.20Clone.20.3F.html#255680319">(Oct 01 2021 at 02:26)</a>:</h4>
<p>Isn't that just <code>load</code>?</p>



<a name="255680341"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20isn%27t%20AtomicI32%20Copy%20%2B%20Clone%20%3F/near/255680341" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20isn&#x27;t.20AtomicI32.20Copy.20.2B.20Clone.20.3F.html#255680341">(Oct 01 2021 at 02:27)</a>:</h4>
<p>load into new, ig</p>



<a name="255680381"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20isn%27t%20AtomicI32%20Copy%20%2B%20Clone%20%3F/near/255680381" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20isn&#x27;t.20AtomicI32.20Copy.20.2B.20Clone.20.3F.html#255680381">(Oct 01 2021 at 02:28)</a>:</h4>
<p>I don't understand the distinction, you can do <code>let x = y.load()</code> without a problem</p>



<a name="255680466"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20isn%27t%20AtomicI32%20Copy%20%2B%20Clone%20%3F/near/255680466" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20isn&#x27;t.20AtomicI32.20Copy.20.2B.20Clone.20.3F.html#255680466">(Oct 01 2021 at 02:29)</a>:</h4>
<p>Well, specifically, it's <code>AtomicN::new(y.load(ord));</code></p>



<a name="256259249"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/why%20isn%27t%20AtomicI32%20Copy%20%2B%20Clone%20%3F/near/256259249" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/why.20isn&#x27;t.20AtomicI32.20Copy.20.2B.20Clone.20.3F.html#256259249">(Oct 05 2021 at 14:50)</a>:</h4>
<p>I would like an inherent clone method that takes an ordering.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>