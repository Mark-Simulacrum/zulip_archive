<html>
<head><meta charset="utf-8"><title>Incremental compilation error on beta 1.59 (beta.5) · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Incremental.20compilation.20error.20on.20beta.201.2E59.20(beta.2E5).html">Incremental compilation error on beta 1.59 (beta.5)</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="270601823"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Incremental%20compilation%20error%20on%20beta%201.59%20%28beta.5%29/near/270601823" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Frank Steffahn <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Incremental.20compilation.20error.20on.20beta.201.2E59.20(beta.2E5).html#270601823">(Feb 03 2022 at 19:11)</a>:</h4>
<p>Hey, I just hit an incremental compilation error while trying to hack rustc. I figured out that it was easily reproducible (i.e. I knew exactly what I had changed) which is semi-rare with these kinds of issues, I'm wondering whether this one is already well-known or worth reporting, then minimizing, and so on...; also if anyone would like to confirm that this is <em>indeed</em> reproducible following the instructions below, that would be great!</p>
<p>reproduction:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code><span class="c1"># in any fork of rust-lang/rust</span>

<span class="c1"># configuration</span>
cp config.toml config.toml.safe
rm config.toml
<span class="nb">echo</span> <span class="s2">"changelog-seen = 2\n[llvm]\ndownload-ci-llvm = true\n[build]\ncompiler-docs = true\n[rust]\ndebug = true\nincremental = true\nchannel = \"nightly\"\n"</span> &gt; config.toml

<span class="c1"># execution</span>
./x.py clean
git fetch origin 83967a86c39fb77c7f4190b6d18ec265b23ab228 bafe92b4e5a2f7261ef72d18db7d6573a9678047
git checkout 83967a86c39fb77c7f4190b6d18ec265b23ab228
git submodule update
./x.py check compiler/rustc <span class="c1"># expected compilation error</span>
git checkout bafe92b4e5a2f7261ef72d18db7d6573a9678047
git reset --soft 83967a86c39fb77c7f4190b6d18ec265b23ab228
./x.py check compiler/rustc <span class="c1"># ICEs</span>

<span class="c1"># restore config</span>
rm config.toml
mv config.toml.safe config.toml

<span class="c1"># (optional) restore working directory</span>
git reset --hard
git checkout master <span class="c1"># or your favorite branch</span>
</code></pre></div>



<a name="270601835"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Incremental%20compilation%20error%20on%20beta%201.59%20%28beta.5%29/near/270601835" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Frank Steffahn <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Incremental.20compilation.20error.20on.20beta.201.2E59.20(beta.2E5).html#270601835">(Feb 03 2022 at 19:11)</a>:</h4>
<p>error message</p>
<div class="codehilite"><pre><span></span><code>Checking stage0 compiler artifacts (x86_64-unknown-linux-gnu -&gt; x86_64-unknown-linux-gnu)
    Checking rustc_middle v0.0.0 (/home/frank/forks/rust/compiler/rustc_middle)
    Checking rustc_infer v0.0.0 (/home/frank/forks/rust/compiler/rustc_infer)
    Checking rustc_metadata v0.0.0 (/home/frank/forks/rust/compiler/rustc_metadata)
    Checking rustc_mir_dataflow v0.0.0 (/home/frank/forks/rust/compiler/rustc_mir_dataflow)
    Checking rustc_symbol_mangling v0.0.0 (/home/frank/forks/rust/compiler/rustc_symbol_mangling)
    Checking rustc_incremental v0.0.0 (/home/frank/forks/rust/compiler/rustc_incremental)
    Checking rustc_query_impl v0.0.0 (/home/frank/forks/rust/compiler/rustc_query_impl)
    Checking rustc_passes v0.0.0 (/home/frank/forks/rust/compiler/rustc_passes)
    Checking rustc_monomorphize v0.0.0 (/home/frank/forks/rust/compiler/rustc_monomorphize)
thread &#39;rustc&#39; panicked at &#39;no entry found for key&#39;, compiler/rustc_metadata/src/rmeta/decoder.rs:1617:13
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace

error: internal compiler error: unexpected panic

note: the compiler unexpectedly panicked. this is a bug.

note: we would appreciate a bug report: https://github.com/rust-lang/rust/issues/new?labels=C-bug%2C+I-ICE%2C+T-compiler&amp;template=ice.md

note: rustc 1.59.0-beta.5 (28c8a34e1 2022-01-27) running on x86_64-unknown-linux-gnu

note: compiler flags: -Z macro-backtrace -Z tls-model=initial-exec -Z unstable-options -Z binary-dep-depinfo -Z force-unstable-if-unmarked -C opt-level=3 -C embed-bitcode=no -C debuginfo=1 -C debug-assertions=on -C incremental -C symbol-mangling-version=v0 -C link-args=-Wl,-z,origin -C link-args=-Wl,-rpath,$ORIGIN/../lib -C prefer-dynamic -C llvm-args=-import-instr-limit=10 --crate-type lib

note: some of the compiler flags provided by cargo are hidden

query stack during panic:
#0 [type_of] computing type of `framework::cursor::ResultsCursor::reachable_blocks`
#1 [inferred_outlives_crate] computing the inferred outlives predicates for items in this crate
end of query stack
error: could not compile `rustc_mir_dataflow`
warning: build failed, waiting for other jobs to finish...
thread &#39;rustc&#39; panicked at &#39;no entry found for key&#39;, compiler/rustc_metadata/src/rmeta/decoder.rs:1617:13
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace

error: internal compiler error: unexpected panic

note: the compiler unexpectedly panicked. this is a bug.

note: we would appreciate a bug report: https://github.com/rust-lang/rust/issues/new?labels=C-bug%2C+I-ICE%2C+T-compiler&amp;template=ice.md

note: rustc 1.59.0-beta.5 (28c8a34e1 2022-01-27) running on x86_64-unknown-linux-gnu

note: compiler flags: -Z macro-backtrace -Z tls-model=initial-exec -Z unstable-options -Z binary-dep-depinfo -Z force-unstable-if-unmarked -C opt-level=3 -C embed-bitcode=no -C debuginfo=1 -C debug-assertions=on -C incremental -C symbol-mangling-version=v0 -C link-args=-Wl,-z,origin -C link-args=-Wl,-rpath,$ORIGIN/../lib -C prefer-dynamic -C llvm-args=-import-instr-limit=10 --crate-type lib

note: some of the compiler flags provided by cargo are hidden

query stack during panic:
#0 [typeck] type-checking `v0::&lt;impl at compiler/rustc_symbol_mangling/src/v0.rs:254:1: 846:2&gt;::print_const::{closure#0}`
#1 [mir_built] building MIR for `v0::&lt;impl at compiler/rustc_symbol_mangling/src/v0.rs:254:1: 846:2&gt;::print_const::{closure#0}`
end of query stack
thread &#39;rustc&#39; panicked at &#39;no entry found for key&#39;, compiler/rustc_metadata/src/rmeta/decoder.rs:1617:13
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace

error: internal compiler error: unexpected panic

note: the compiler unexpectedly panicked. this is a bug.

note: we would appreciate a bug report: https://github.com/rust-lang/rust/issues/new?labels=C-bug%2C+I-ICE%2C+T-compiler&amp;template=ice.md

note: rustc 1.59.0-beta.5 (28c8a34e1 2022-01-27) running on x86_64-unknown-linux-gnu

note: compiler flags: -Z macro-backtrace -Z tls-model=initial-exec -Z unstable-options -Z binary-dep-depinfo -Z force-unstable-if-unmarked -C opt-level=3 -C embed-bitcode=no -C debuginfo=1 -C debug-assertions=on -C incremental -C symbol-mangling-version=v0 -C link-args=-Wl,-z,origin -C link-args=-Wl,-rpath,$ORIGIN/../lib -C prefer-dynamic -C llvm-args=-import-instr-limit=10 --crate-type lib

note: some of the compiler flags provided by cargo are hidden

query stack during panic:
#0 [type_of] computing type of `rmeta::LazyTables::promoted_mir`
#1 [inferred_outlives_crate] computing the inferred outlives predicates for items in this crate
end of query stack
thread &#39;rustc&#39; panicked at &#39;no entry found for key&#39;, compiler/rustc_metadata/src/rmeta/decoder.rs:1617:13
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace

error: internal compiler error: unexpected panic

note: the compiler unexpectedly panicked. this is a bug.

note: we would appreciate a bug report: https://github.com/rust-lang/rust/issues/new?labels=C-bug%2C+I-ICE%2C+T-compiler&amp;template=ice.md

note: rustc 1.59.0-beta.5 (28c8a34e1 2022-01-27) running on x86_64-unknown-linux-gnu

note: compiler flags: -Z macro-backtrace -Z tls-model=initial-exec -Z unstable-options -Z binary-dep-depinfo -Z force-unstable-if-unmarked -C opt-level=3 -C embed-bitcode=no -C debuginfo=1 -C debug-assertions=on -C incremental -C symbol-mangling-version=v0 -C link-args=-Wl,-z,origin -C link-args=-Wl,-rpath,$ORIGIN/../lib -C prefer-dynamic -C llvm-args=-import-instr-limit=10 --crate-type lib

note: some of the compiler flags provided by cargo are hidden

query stack during panic:
#0 [typeck] type-checking `collector::&lt;impl at compiler/rustc_monomorphize/src/collector.rs:627:1: 880:2&gt;::visit_local`
#1 [check_mod_liveness] checking liveness of variables in module `collector`
end of query stack
thread &#39;rustc&#39; panicked at &#39;no entry found for key&#39;, compiler/rustc_metadata/src/rmeta/decoder.rs:1617:13
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace

error: internal compiler error: unexpected panic

note: the compiler unexpectedly panicked. this is a bug.

note: we would appreciate a bug report: https://github.com/rust-lang/rust/issues/new?labels=C-bug%2C+I-ICE%2C+T-compiler&amp;template=ice.md

note: rustc 1.59.0-beta.5 (28c8a34e1 2022-01-27) running on x86_64-unknown-linux-gnu

note: compiler flags: -Z macro-backtrace -Z tls-model=initial-exec -Z unstable-options -Z binary-dep-depinfo -Z force-unstable-if-unmarked -C opt-level=3 -C embed-bitcode=no -C debuginfo=1 -C debug-assertions=on -C incremental -C symbol-mangling-version=v0 -C link-args=-Wl,-z,origin -C link-args=-Wl,-rpath,$ORIGIN/../lib -C prefer-dynamic -C llvm-args=-import-instr-limit=10 --crate-type lib

note: some of the compiler flags provided by cargo are hidden

query stack during panic:
#0 [type_of] computing type of `on_disk_cache::&lt;impl at compiler/rustc_query_impl/src/on_disk_cache.rs:765:1: 771:2&gt;`
#1 [trait_impls_of] trait impls of `rustc_serialize::serialize::Decodable`
end of query stack
thread &#39;rustc&#39; panicked at &#39;no entry found for key&#39;, compiler/rustc_metadata/src/rmeta/decoder.rs:1617:13
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace

error: internal compiler error: unexpected panic

note: the compiler unexpectedly panicked. this is a bug.

note: we would appreciate a bug report: https://github.com/rust-lang/rust/issues/new?labels=C-bug%2C+I-ICE%2C+T-compiler&amp;template=ice.md

note: rustc 1.59.0-beta.5 (28c8a34e1 2022-01-27) running on x86_64-unknown-linux-gnu

note: compiler flags: -Z macro-backtrace -Z tls-model=initial-exec -Z unstable-options -Z binary-dep-depinfo -Z force-unstable-if-unmarked -C opt-level=3 -C embed-bitcode=no -C debuginfo=1 -C debug-assertions=on -C incremental -C symbol-mangling-version=v0 -C link-args=-Wl,-z,origin -C link-args=-Wl,-rpath,$ORIGIN/../lib -C prefer-dynamic -C llvm-args=-import-instr-limit=10 --crate-type lib

note: some of the compiler flags provided by cargo are hidden

query stack during panic:
#0 [typeck] type-checking `check_attr::provide`
#1 [mir_built] building MIR for `check_attr::provide`
end of query stack
thread &#39;rustc&#39; panicked at &#39;no entry found for key&#39;, compiler/rustc_metadata/src/rmeta/decoder.rs:1617:13
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace

error: internal compiler error: unexpected panic

note: the compiler unexpectedly panicked. this is a bug.

note: we would appreciate a bug report: https://github.com/rust-lang/rust/issues/new?labels=C-bug%2C+I-ICE%2C+T-compiler&amp;template=ice.md

note: rustc 1.59.0-beta.5 (28c8a34e1 2022-01-27) running on x86_64-unknown-linux-gnu

note: compiler flags: -Z macro-backtrace -Z tls-model=initial-exec -Z unstable-options -Z binary-dep-depinfo -Z force-unstable-if-unmarked -C opt-level=3 -C embed-bitcode=no -C debuginfo=1 -C debug-assertions=on -C incremental -C symbol-mangling-version=v0 -C link-args=-Wl,-z,origin -C link-args=-Wl,-rpath,$ORIGIN/../lib -C prefer-dynamic -C llvm-args=-import-instr-limit=10 --crate-type lib

note: some of the compiler flags provided by cargo are hidden

query stack during panic:
#0 [typeck] type-checking `infer::error_reporting::need_type_info::&lt;impl at compiler/rustc_infer/src/infer/error_reporting/need_type_info.rs:366:1: 919:2&gt;::extract_inference_diagnostics_data::{closure#0}`
#1 [mir_built] building MIR for `infer::error_reporting::need_type_info::&lt;impl at compiler/rustc_infer/src/infer/error_reporting/need_type_info.rs:366:1: 919:2&gt;::extract_inference_diagnostics_data::{closure#0}`
end of query stack
error: build failed
</code></pre></div>



<a name="270602069"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Incremental%20compilation%20error%20on%20beta%201.59%20%28beta.5%29/near/270602069" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Frank Steffahn <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Incremental.20compilation.20error.20on.20beta.201.2E59.20(beta.2E5).html#270602069">(Feb 03 2022 at 19:13)</a>:</h4>
<p>(for context, this is on linux)</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>