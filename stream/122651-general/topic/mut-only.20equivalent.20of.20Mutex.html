<html>
<head><meta charset="utf-8"><title>mut-only equivalent of Mutex · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/mut-only.20equivalent.20of.20Mutex.html">mut-only equivalent of Mutex</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="259510435"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/mut-only%20equivalent%20of%20Mutex/near/259510435" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jethro <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/mut-only.20equivalent.20of.20Mutex.html#259510435">(Oct 29 2021 at 11:19)</a>:</h4>
<p>Is there a type equivalent to Mutex that only implements get_mut(&amp;mut self)? I don't need lock() or any other function that takes &amp;self but I do need a wrapper to make something Sync</p>



<a name="259532638"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/mut-only%20equivalent%20of%20Mutex/near/259532638" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/mut-only.20equivalent.20of.20Mutex.html#259532638">(Oct 29 2021 at 14:31)</a>:</h4>
<p>I don't know any existing types, but you can write a simple wrapper for that. The only unsafe part would be your <code>impl Sync</code>, making sure you never use or expose that inner type via <code>&amp;self</code>.</p>



<a name="259533039"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/mut-only%20equivalent%20of%20Mutex/near/259533039" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jethro <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/mut-only.20equivalent.20of.20Mutex.html#259533039">(Oct 29 2021 at 14:34)</a>:</h4>
<p>Yeah I'd rather have the overhead of Mutex than have to prove the invariants for Sync</p>



<a name="259533455"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/mut-only%20equivalent%20of%20Mutex/near/259533455" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/mut-only.20equivalent.20of.20Mutex.html#259533455">(Oct 29 2021 at 14:37)</a>:</h4>
<p>FWIW mutex should be pretty cheap if you never lock it</p>



<a name="259558049"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/mut-only%20equivalent%20of%20Mutex/near/259558049" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/mut-only.20equivalent.20of.20Mutex.html#259558049">(Oct 29 2021 at 17:34)</a>:</h4>
<p>std Mutex uses pthread and needs boxing so I wouldn't call it cheap.</p>



<a name="259558083"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/mut-only%20equivalent%20of%20Mutex/near/259558083" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/mut-only.20equivalent.20of.20Mutex.html#259558083">(Oct 29 2021 at 17:34)</a>:</h4>
<p>But parking_lot or spin Mutexes are.</p>



<a name="259558638"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/mut-only%20equivalent%20of%20Mutex/near/259558638" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/mut-only.20equivalent.20of.20Mutex.html#259558638">(Oct 29 2021 at 17:38)</a>:</h4>
<p>that makes it non-trivial to create/drop, if you're dealing with short-lived instances, but besides that you'd only interact with <code>Mutex.data</code>, which is still a direct cell</p>



<a name="259558831"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/mut-only%20equivalent%20of%20Mutex/near/259558831" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/mut-only.20equivalent.20of.20Mutex.html#259558831">(Oct 29 2021 at 17:40)</a>:</h4>
<p>well, <code>get_mut</code> will touch <code>poison</code> too, but that's also local</p>



<a name="259569245"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/mut-only%20equivalent%20of%20Mutex/near/259569245" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amanieu <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/mut-only.20equivalent.20of.20Mutex.html#259569245">(Oct 29 2021 at 19:02)</a>:</h4>
<p>Why do you need something that implements <code>get_mut</code> only?</p>



<a name="259569278"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/mut-only%20equivalent%20of%20Mutex/near/259569278" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amanieu <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/mut-only.20equivalent.20of.20Mutex.html#259569278">(Oct 29 2021 at 19:02)</a>:</h4>
<p>If you have a mutable reference to a type, just use it directly?</p>



<a name="259569315"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/mut-only%20equivalent%20of%20Mutex/near/259569315" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amanieu <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/mut-only.20equivalent.20of.20Mutex.html#259569315">(Oct 29 2021 at 19:02)</a>:</h4>
<p>Oh I see, you need something to be <code>Sync</code>.</p>



<a name="259579236"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/mut-only%20equivalent%20of%20Mutex/near/259579236" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kestrer <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/mut-only.20equivalent.20of.20Mutex.html#259579236">(Oct 29 2021 at 20:28)</a>:</h4>
<p><a href="https://docs.rs/sync-wrapper">https://docs.rs/sync-wrapper</a></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>