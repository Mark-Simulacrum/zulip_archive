<html>
<head><meta charset="utf-8"><title>#[cfg(test)] within doc-tests · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.23.5Bcfg(test).5D.20within.20doc-tests.html">#[cfg(test)] within doc-tests</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="224273300"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%23%5Bcfg%28test%29%5D%20within%20doc-tests/near/224273300" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.23.5Bcfg(test).5D.20within.20doc-tests.html#224273300">(Jan 28 2021 at 01:20)</a>:</h4>
<p>(Please move this to a more appropriate stream if one exists.)</p>
<p>Since rustdoc code examples are often used as "doc-tests" unit-like-tests, it would be handy to be able to have <code>#[cfg(test)]</code> be able to be enabled within code examples, particularly those for apis related to tests.</p>
<p>If not automatically, then something like ```test could be handy.</p>
<p>My specific usage is I would like <code>cargo check</code> to run for this example:<br>
<a href="https://docs.rs/preroll/0.2.0/preroll/test_utils/fn.assert_json_error.html">https://docs.rs/preroll/0.2.0/preroll/test_utils/fn.assert_json_error.html</a></p>



<a name="224273613"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%23%5Bcfg%28test%29%5D%20within%20doc-tests/near/224273613" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.23.5Bcfg(test).5D.20within.20doc-tests.html#224273613">(Jan 28 2021 at 01:24)</a>:</h4>
<p><code>#[cfg(test)]</code> is only enabled when building a crate for its unit tests, and setting it in other circumstances can break things (it was a attemped in the past, I believe)</p>



<a name="224274250"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%23%5Bcfg%28test%29%5D%20within%20doc-tests/near/224274250" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.23.5Bcfg(test).5D.20within.20doc-tests.html#224274250">(Jan 28 2021 at 01:33)</a>:</h4>
<p>Could a ```test annotation exist?</p>



<a name="224274372"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%23%5Bcfg%28test%29%5D%20within%20doc-tests/near/224274372" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.23.5Bcfg(test).5D.20within.20doc-tests.html#224274372">(Jan 28 2021 at 01:35)</a>:</h4>
<p>theoretically, but it would require building the base crate twice</p>



<a name="224274562"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%23%5Bcfg%28test%29%5D%20within%20doc-tests/near/224274562" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.23.5Bcfg(test).5D.20within.20doc-tests.html#224274562">(Jan 28 2021 at 01:38)</a>:</h4>
<p>Ok then uh, let me ask this from a different angle.</p>
<p>You can use # to hide lines, is there any way, or would it be possible to use another character to show a "fake" like in docs that isn't actually run?</p>



<a name="224274598"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%23%5Bcfg%28test%29%5D%20within%20doc-tests/near/224274598" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.23.5Bcfg(test).5D.20within.20doc-tests.html#224274598">(Jan 28 2021 at 01:38)</a>:</h4>
<p>I don't think there's any current way to do that</p>



<a name="224274712"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%23%5Bcfg%28test%29%5D%20within%20doc-tests/near/224274712" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.23.5Bcfg(test).5D.20within.20doc-tests.html#224274712">(Jan 28 2021 at 01:40)</a>:</h4>
<p>I am thinking something like so:</p>
<div class="codehilite"><pre><span></span><code>/// # #[async_std::main] // Hidden
/// # async fn main() -&gt; TestResult&lt;()&gt; { // Hidden
/// ! #[async_std::test] // Shown but not run
/// ! async fn test_get_status() -&gt; TestResult&lt;()&gt; { // Shown but not run
</code></pre></div>



<a name="224274724"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%23%5Bcfg%28test%29%5D%20within%20doc-tests/near/224274724" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.23.5Bcfg(test).5D.20within.20doc-tests.html#224274724">(Jan 28 2021 at 01:40)</a>:</h4>
<p>I think there was also talk about <code>cfg(rustdoc)</code> which might help?</p>



<a name="224274745"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%23%5Bcfg%28test%29%5D%20within%20doc-tests/near/224274745" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.23.5Bcfg(test).5D.20within.20doc-tests.html#224274745">(Jan 28 2021 at 01:41)</a>:</h4>
<p>Keep in mind I am trying to provide an accurate example of a test utility.</p>



<a name="224490807"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%23%5Bcfg%28test%29%5D%20within%20doc-tests/near/224490807" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.23.5Bcfg(test).5D.20within.20doc-tests.html#224490807">(Jan 29 2021 at 15:55)</a>:</h4>
<p><span class="user-mention" data-user-id="319552">@Jeremiah Senkpiel</span> you want <code>cfg(doctest)</code></p>



<a name="224490829"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%23%5Bcfg%28test%29%5D%20within%20doc-tests/near/224490829" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.23.5Bcfg(test).5D.20within.20doc-tests.html#224490829">(Jan 29 2021 at 15:55)</a>:</h4>
<p>which is fundamentally broken and there is no plan to make it work</p>



<a name="224490981"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%23%5Bcfg%28test%29%5D%20within%20doc-tests/near/224490981" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.23.5Bcfg(test).5D.20within.20doc-tests.html#224490981">(Jan 29 2021 at 15:56)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/issues/67295">https://github.com/rust-lang/rust/issues/67295</a></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>