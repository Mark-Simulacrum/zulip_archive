<html>
<head><meta charset="utf-8"><title>Detect presence of standard library at compile time · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Detect.20presence.20of.20standard.20library.20at.20compile.20time.html">Detect presence of standard library at compile time</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="261980183"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Detect%20presence%20of%20standard%20library%20at%20compile%20time/near/261980183" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pointerbender <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Detect.20presence.20of.20standard.20library.20at.20compile.20time.html#261980183">(Nov 18 2021 at 19:44)</a>:</h4>
<p>If I'm working in a <code>![no_std]</code> crate, is it somehow possible to detect at compile time whether one of the dependencies in <code>Cargo.toml</code> depends on the standard library? I found that slapping the <code>#![no_std]</code> attribute on my crate does does not prevent other dependencies from pulling in the Rust standard library. I did some research and found that <a href="https://github.com/rust-lang/rust/issues/38509">a lint was once suggested for this</a>, but it was never put into practice. Running <code>cargo tree</code> also doesn't help in my case, because the standard library is not listed between the dependencies. Any solution that detects the presence of the standard library is okay, including using nightly features and crashing the compiler <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="261981900"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Detect%20presence%20of%20standard%20library%20at%20compile%20time/near/261981900" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Detect.20presence.20of.20standard.20library.20at.20compile.20time.html#261981900">(Nov 18 2021 at 19:57)</a>:</h4>
<p>I believe the common approach here is to cross compile to a target that does not have STD.</p>



<a name="261981984"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Detect%20presence%20of%20standard%20library%20at%20compile%20time/near/261981984" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Detect.20presence.20of.20standard.20library.20at.20compile.20time.html#261981984">(Nov 18 2021 at 19:58)</a>:</h4>
<p>Have you tried <code>cargo -Z build-std=core,alloc</code>? I think you should then end up without std and thus the build would fail. Haven't tried it though, maybe it would just build a frankenstd.</p>



<a name="261982862"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Detect%20presence%20of%20standard%20library%20at%20compile%20time/near/261982862" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pointerbender <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Detect.20presence.20of.20standard.20library.20at.20compile.20time.html#261982862">(Nov 18 2021 at 20:04)</a>:</h4>
<p>Thank you for the suggestions, I'll give those a try! <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="262138158"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Detect%20presence%20of%20standard%20library%20at%20compile%20time/near/262138158" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Detect.20presence.20of.20standard.20library.20at.20compile.20time.html#262138158">(Nov 19 2021 at 22:17)</a>:</h4>
<p>build-std will do it. you'll get a message about std being a missing crate if you try to use it when it's not being built.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>