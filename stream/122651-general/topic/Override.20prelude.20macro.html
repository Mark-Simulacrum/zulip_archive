<html>
<head><meta charset="utf-8"><title>Override prelude macro · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Override.20prelude.20macro.html">Override prelude macro</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="250285877"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Override%20prelude%20macro/near/250285877" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chinmay Deshpande <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Override.20prelude.20macro.html#250285877">(Aug 22 2021 at 18:03)</a>:</h4>
<p>Hello all ! Is there a way to override the <code>vec!</code> macro from the std prelude ? I am writing an alternate Vec implementation and would like the user to use the <code>vec!</code> macro but shadow the stdlib macro with mine instead. Thanks !</p>



<a name="250285984"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Override%20prelude%20macro/near/250285984" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chinmay Deshpande <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Override.20prelude.20macro.html#250285984">(Aug 22 2021 at 18:06)</a>:</h4>
<p>This is the error that I am currently getting:</p>
<div class="codehilite"><pre><span></span><code>error[E0659]: `vec` is ambiguous (macro-expanded name vs less macro-expanded name from outer scope during import/macro resolution)
   --&gt; append.rs:5:23
    |
5   |         let mut vec = vec![1, 2, 3];
    |                       ^^^ ambiguous name
    |
    = note: `vec` could refer to a macro from prelude
note: `vec` could also refer to the macro defined here
   --&gt; new_vec.rs:692:1
    |
692 | / macro_rules! vec {
693 | |   ( $val:expr ; $count:expr ) =&gt;
694 | |     ({
695 | |       let mut result = Vec::new();
...   |
711 | |   };
712 | | }
    | |_^
    = help: use `crate::vec` to refer to this macro unambiguously
</code></pre></div>



<a name="250286347"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Override%20prelude%20macro/near/250286347" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Override.20prelude.20macro.html#250286347">(Aug 22 2021 at 18:15)</a>:</h4>
<p>You could use <code>#[no_prelude]</code> maybe, but that gets rid of a lot of other items too</p>



<a name="250286350"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Override%20prelude%20macro/near/250286350" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Override.20prelude.20macro.html#250286350">(Aug 22 2021 at 18:15)</a>:</h4>
<p>I don't know if there's a way to make it unambiguous without crate::</p>



<a name="250286424"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Override%20prelude%20macro/near/250286424" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Override.20prelude.20macro.html#250286424">(Aug 22 2021 at 18:17)</a>:</h4>
<p>If the user explicitly does <code>use ::your_crate::vec;</code> they will shadow the built-in one; I believe it's <code>#[macro_use] extern crate your_crate;</code> which yields an ambiguous <code>vec!</code></p>



<a name="250287989"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Override%20prelude%20macro/near/250287989" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> sjud <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Override.20prelude.20macro.html#250287989">(Aug 22 2021 at 18:55)</a>:</h4>
<p>Hello, I'm using a crate which uses derive_builder which generates a builder struct/set of methods from a given struct at compile time. I can't get autocomplete on the derived builder struct's functions (which are named after the original structs fields and take arguments that would set those fields in the builder). I'd like to be able to autocomplete those method calls, as I assume other people using this library would. I'm an intermediate rust Programmer and I don't really understand the scope of the problem, I'm watching Matklab's youtube series now on rust-analyzer but would this be a hard thing for me to implement?</p>



<a name="250288148"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Override%20prelude%20macro/near/250288148" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Override.20prelude.20macro.html#250288148">(Aug 22 2021 at 18:59)</a>:</h4>
<p><span class="user-mention" data-user-id="425010">@sjud</span>  try asking in <a class="stream" data-stream-id="185405" href="/#narrow/stream/185405-t-compiler.2Frust-analyzer">#t-compiler/rust-analyzer</a>. I don't recall how code using derive_builder looks like. An example might help?</p>



<a name="250289603"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Override%20prelude%20macro/near/250289603" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> sjud <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Override.20prelude.20macro.html#250289603">(Aug 22 2021 at 19:34)</a>:</h4>
<div class="spoiler-block"><div class="spoiler-header">
<p>Struct deriving Builder</p>
</div><div class="spoiler-content" aria-hidden="true">
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#[derive(Debug, Builder)]</span><span class="w"></span>
<span class="cp">#[builder(setter(strip_option))]</span><span class="w"></span>
<span class="k">pub</span><span class="w"> </span><span class="k">struct</span> <span class="nc">CreateMergeRequest</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="sd">/// The project to open the merge requset *from*.</span>
<span class="w">    </span><span class="cp">#[builder(setter(into))]</span><span class="w"></span>
<span class="w">    </span><span class="n">project</span>: <span class="nc">NameOrId</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="sd">/// The name of the source branch for the merge request.</span>
<span class="w">    </span><span class="cp">#[builder(setter(into))]</span><span class="w"></span>
<span class="w">    </span><span class="n">source_branch</span>: <span class="nc">Cow</span><span class="o">&lt;'</span><span class="na">a</span><span class="p">,</span><span class="w"> </span><span class="kt">str</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="sd">/// The name of the target branch for the merge request.</span>
<span class="w">    </span><span class="cp">#[builder(setter(into))]</span><span class="w"></span>
<span class="w">    </span><span class="n">target_branch</span>: <span class="nc">Cow</span><span class="o">&lt;'</span><span class="na">a</span><span class="p">,</span><span class="w"> </span><span class="kt">str</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="sd">/// The title for the merge request.</span>
<span class="w">    </span><span class="cp">#[builder(setter(into))]</span><span class="w"></span>
<span class="w">    </span><span class="n">title</span>: <span class="nc">Cow</span><span class="o">&lt;'</span><span class="na">a</span><span class="p">,</span><span class="w"> </span><span class="kt">str</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="sd">/// The assignee of the merge request.</span>
<span class="w">    </span><span class="cp">#[builder(setter(name = </span><span class="s">"_assignee"</span><span class="cp">), default, private)]</span><span class="w"></span>
<span class="w">    </span><span class="n">assignee</span>: <span class="nb">Option</span><span class="o">&lt;</span><span class="n">Assignee</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="cp">#[builder(setter(name = </span><span class="s">"_reviewer"</span><span class="cp">), default, private)]</span><span class="w"></span>
<span class="w">    </span><span class="n">reviewer</span>: <span class="nb">Option</span><span class="o">&lt;</span><span class="n">Reviewer</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="sd">/// The description of the merge request.</span>
<span class="w">    </span><span class="cp">#[builder(setter(into), default)]</span><span class="w"></span>
<span class="w">    </span><span class="n">description</span>: <span class="nb">Option</span><span class="o">&lt;</span><span class="n">Cow</span><span class="o">&lt;'</span><span class="na">a</span><span class="p">,</span><span class="w"> </span><span class="kt">str</span><span class="o">&gt;&gt;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="sd">/// The ID of the target project for the merge request.</span>
<span class="w">    </span><span class="cp">#[builder(default)]</span><span class="w"></span>
<span class="w">    </span><span class="n">target_project_id</span>: <span class="nb">Option</span><span class="o">&lt;</span><span class="kt">u64</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="sd">/// Labels to add to the merge request.</span>
<span class="w">    </span><span class="cp">#[builder(setter(name = </span><span class="s">"_labels"</span><span class="cp">), default, private)]</span><span class="w"></span>
<span class="w">    </span><span class="n">labels</span>: <span class="nb">Option</span><span class="o">&lt;</span><span class="n">CommaSeparatedList</span><span class="o">&lt;</span><span class="n">Cow</span><span class="o">&lt;'</span><span class="na">a</span><span class="p">,</span><span class="w"> </span><span class="kt">str</span><span class="o">&gt;&gt;&gt;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="sd">/// The ID of the milestone to add the merge request to.</span>
<span class="w">    </span><span class="cp">#[builder(default)]</span><span class="w"></span>
<span class="w">    </span><span class="n">milestone_id</span>: <span class="nb">Option</span><span class="o">&lt;</span><span class="kt">u64</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="sd">/// How many approvals are required before merging will be allowed.</span>
<span class="w">    </span><span class="sd">///</span>
<span class="w">    </span><span class="sd">/// Note that this must be more than the project limit (if present).</span>
<span class="w">    </span><span class="cp">#[builder(default)]</span><span class="w"></span>
<span class="w">    </span><span class="n">approvals_before_merge</span>: <span class="nb">Option</span><span class="o">&lt;</span><span class="kt">u64</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="sd">/// Whether to remove the source branch once merged or not.</span>
<span class="w">    </span><span class="cp">#[builder(default)]</span><span class="w"></span>
<span class="w">    </span><span class="n">remove_source_branch</span>: <span class="nb">Option</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="sd">/// Whether to allow collaboration with maintainers of the target project or not.</span>
<span class="w">    </span><span class="cp">#[builder(default)]</span><span class="w"></span>
<span class="w">    </span><span class="n">allow_collaboration</span>: <span class="nb">Option</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="sd">/// Whether to squash the branch when merging or not.</span>
<span class="w">    </span><span class="cp">#[builder(default)]</span><span class="w"></span>
<span class="w">    </span><span class="n">squash</span>: <span class="nb">Option</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>

<span class="w">    </span><span class="sd">/// Whether to allow collaboration with maintainers of the target project or not.</span>
<span class="w">    </span><span class="cp">#[deprecated(note = </span><span class="s">"use `allow_collaboration` instead"</span><span class="cp">)]</span><span class="w"></span>
<span class="w">    </span><span class="cp">#[builder(default)]</span><span class="w"></span>
<span class="w">    </span><span class="n">allow_maintainer_to_push</span>: <span class="nb">Option</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
</div></div>
<div class="spoiler-block"><div class="spoiler-header">
<p>fn derive for Builder</p>
</div><div class="spoiler-content" aria-hidden="true">
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#[proc_macro_derive(Builder, attributes(builder))]</span><span class="w"></span>
<span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">derive</span><span class="p">(</span><span class="n">input</span>: <span class="nc">TokenStream</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">TokenStream</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="cp">#[cfg(feature = </span><span class="s">"logging"</span><span class="cp">)]</span><span class="w"></span>
<span class="w">    </span><span class="n">INIT_LOGGER</span><span class="p">.</span><span class="n">call_once</span><span class="p">(</span><span class="o">||</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">env_logger</span>::<span class="n">init</span><span class="p">().</span><span class="n">unwrap</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="p">});</span><span class="w"></span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">ast</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parse_macro_input</span><span class="o">!</span><span class="p">(</span><span class="n">input</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">syn</span>::<span class="n">DeriveInput</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="n">builder_for_struct</span><span class="p">(</span><span class="n">ast</span><span class="p">).</span><span class="n">into</span><span class="p">()</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">builder_for_struct</span><span class="p">(</span><span class="n">ast</span>: <span class="nc">syn</span>::<span class="n">DeriveInput</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">proc_macro2</span>::<span class="n">TokenStream</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">debug</span><span class="o">!</span><span class="p">(</span><span class="s">"Deriving Builder for `{}`."</span><span class="p">,</span><span class="w"> </span><span class="n">ast</span><span class="p">.</span><span class="n">ident</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">opts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="n">Options</span>::<span class="n">from_derive_input</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ast</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nb">Ok</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">val</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="nb">Err</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">err</span><span class="p">.</span><span class="n">write_errors</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">};</span><span class="w"></span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">builder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">opts</span><span class="p">.</span><span class="n">as_builder</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">build_fn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">opts</span><span class="p">.</span><span class="n">as_build_method</span><span class="p">();</span><span class="w"></span>

<span class="w">    </span><span class="n">builder</span><span class="p">.</span><span class="n">doc_comment</span><span class="p">(</span><span class="fm">format!</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="fm">include_str!</span><span class="p">(</span><span class="s">"doc_tpl/builder_struct.md"</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="n">struct_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ast</span><span class="p">.</span><span class="n">ident</span><span class="w"></span>
<span class="w">    </span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="n">build_fn</span><span class="p">.</span><span class="n">doc_comment</span><span class="p">(</span><span class="fm">format!</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="fm">include_str!</span><span class="p">(</span><span class="s">"doc_tpl/builder_method.md"</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="n">struct_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ast</span><span class="p">.</span><span class="n">ident</span><span class="w"></span>
<span class="w">    </span><span class="p">));</span><span class="w"></span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">field</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">opts</span><span class="p">.</span><span class="n">fields</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">builder</span><span class="p">.</span><span class="n">push_field</span><span class="p">(</span><span class="n">field</span><span class="p">.</span><span class="n">as_builder_field</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">builder</span><span class="p">.</span><span class="n">push_setter_fn</span><span class="p">(</span><span class="n">field</span><span class="p">.</span><span class="n">as_setter</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">build_fn</span><span class="p">.</span><span class="n">push_initializer</span><span class="p">(</span><span class="n">field</span><span class="p">.</span><span class="n">as_initializer</span><span class="p">());</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="n">builder</span><span class="p">.</span><span class="n">push_build_fn</span><span class="p">(</span><span class="n">build_fn</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="n">quote</span><span class="o">!</span><span class="p">(</span>#<span class="n">builder</span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
</div></div>



<a name="250289694"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Override%20prelude%20macro/near/250289694" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chinmay Deshpande <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Override.20prelude.20macro.html#250289694">(Aug 22 2021 at 19:36)</a>:</h4>
<p>Thanks all for your time and help in debugging this issue. I will try to get it working and update back on this stream.</p>



<a name="250289957"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Override%20prelude%20macro/near/250289957" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Override.20prelude.20macro.html#250289957">(Aug 22 2021 at 19:43)</a>:</h4>
<p>@sjud did you enable attribute proc macros?</p>



<a name="250291054"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Override%20prelude%20macro/near/250291054" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> sjud <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Override.20prelude.20macro.html#250291054">(Aug 22 2021 at 20:08)</a>:</h4>
<p>Not in my <a href="http://main.rs">main.rs</a> file. But, I don't use any macros directly I just call into the gitlab library which does. I'm a little unfamiliar with attribute proc macros in general so I'm not sure to what extent that makes a difference..</p>



<a name="250333429"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Override%20prelude%20macro/near/250333429" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Override.20prelude.20macro.html#250333429">(Aug 23 2021 at 10:29)</a>:</h4>
<p><span class="user-mention" data-user-id="425010">@sjud</span>  Please post a new topic in the other stream and/or file an issue. You can use <code>"rust-analyzer.experimental.procAttrMacros": true</code> to enable attribute proc macros, which <code>derive_builder</code> seems to use.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>