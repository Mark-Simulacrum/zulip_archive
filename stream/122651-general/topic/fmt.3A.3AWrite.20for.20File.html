<html>
<head><meta charset="utf-8"><title>fmt::Write for File · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/fmt.3A.3AWrite.20for.20File.html">fmt::Write for File</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="275313623"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/fmt%3A%3AWrite%20for%20File/near/275313623" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/fmt.3A.3AWrite.20for.20File.html#275313623">(Mar 14 2022 at 23:57)</a>:</h4>
<p>Why doesn't File implement fmt::Write? I want my code to accept both files and strings (through <code>&lt;W: fmt::Write&gt;(mut w: W)</code>) but File doesn't implement fmt::Write.</p>
<p>And I can't switch to io::Write because then it wouldn't work for strings (and I'm only dealing with Unicode anyway).</p>



<a name="275327123"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/fmt%3A%3AWrite%20for%20File/near/275327123" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/fmt.3A.3AWrite.20for.20File.html#275327123">(Mar 15 2022 at 04:00)</a>:</h4>
<p>In theory it could, but if you had both traits important, that would result in ambiguity issues when writing to files.</p>



<a name="275334132"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/fmt%3A%3AWrite%20for%20File/near/275334132" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Conrad Ludgate <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/fmt.3A.3AWrite.20for.20File.html#275334132">(Mar 15 2022 at 06:29)</a>:</h4>
<p>I've never really seen the point in the fmt::Write trait</p>



<a name="275340139"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/fmt%3A%3AWrite%20for%20File/near/275340139" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/fmt.3A.3AWrite.20for.20File.html#275340139">(Mar 15 2022 at 08:07)</a>:</h4>
<p>io::Write can't be used for writing to strings or other utf-8 encoded values. while it could be implemented, it would force utf-8 validation.</p>



<a name="275341523"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/fmt%3A%3AWrite%20for%20File/near/275341523" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Conrad Ludgate <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/fmt.3A.3AWrite.20for.20File.html#275341523">(Mar 15 2022 at 08:24)</a>:</h4>
<p>Right. Could we provide some shim that turns an io::Write into an fmt::Write? Eg <code>Utf8&lt;File&gt;</code></p>



<a name="275341625"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/fmt%3A%3AWrite%20for%20File/near/275341625" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Conrad Ludgate <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/fmt.3A.3AWrite.20for.20File.html#275341625">(Mar 15 2022 at 08:25)</a>:</h4>
<p><del>then replace <code>String</code> with <code>Utf8&lt;Vec&lt;u8&gt;&gt;</code></del></p>



<a name="275386315"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/fmt%3A%3AWrite%20for%20File/near/275386315" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/fmt.3A.3AWrite.20for.20File.html#275386315">(Mar 15 2022 at 15:12)</a>:</h4>
<p>I did exactly that the other day: <a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2021&amp;gist=6067bfa6c5a855a52752bd28f0df2e8e">https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2021&amp;gist=6067bfa6c5a855a52752bd28f0df2e8e</a></p>



<a name="275386356"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/fmt%3A%3AWrite%20for%20File/near/275386356" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/fmt.3A.3AWrite.20for.20File.html#275386356">(Mar 15 2022 at 15:12)</a>:</h4>
<p><a href="https://www.reddit.com/r/rust/comments/t69sld/is_there_a_way_to_allow_either_stdfmtwrite_or/hzafhls/?context=3">https://www.reddit.com/r/rust/comments/t69sld/is_there_a_way_to_allow_either_stdfmtwrite_or/hzafhls/?context=3</a></p>



<a name="275386923"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/fmt%3A%3AWrite%20for%20File/near/275386923" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/fmt.3A.3AWrite.20for.20File.html#275386923">(Mar 15 2022 at 15:16)</a>:</h4>
<p>FWIW I have typically had pretty good success just taking &amp;mut String or returning a String in such cases. Being generic over (File, String) typically isn't worth the extra compile time, IMO.</p>
<p>(You probably want <code>BufWriter&lt;File&gt;</code> if you're using fmt::Write APIs, in any case).</p>



<a name="275607515"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/fmt%3A%3AWrite%20for%20File/near/275607515" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/fmt.3A.3AWrite.20for.20File.html#275607515">(Mar 17 2022 at 04:56)</a>:</h4>
<p>In this case, I think it will be worth it since the code currently concatenates a ton of small strings together before writing them into a file, and doing this would allow writing them incrementally.</p>



<a name="275609060"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/fmt%3A%3AWrite%20for%20File/near/275609060" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/fmt.3A.3AWrite.20for.20File.html#275609060">(Mar 17 2022 at 05:31)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/122651-general/topic/fmt.3A.3AWrite.20for.20File/near/275386315">said</a>:</p>
<blockquote>
<p>I did exactly that the other day: <a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2021&amp;gist=6067bfa6c5a855a52752bd28f0df2e8e">https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2021&amp;gist=6067bfa6c5a855a52752bd28f0df2e8e</a></p>
</blockquote>
<p>Thanks, I think I will do something like this! Especially since the polymorphism between fmt and io is only internal to the library so ergonomics are less important.</p>



<a name="275649230"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/fmt%3A%3AWrite%20for%20File/near/275649230" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/fmt.3A.3AWrite.20for.20File.html#275649230">(Mar 17 2022 at 13:08)</a>:</h4>
<p>You may want to bring this up in <a class="stream" data-stream-id="219381" href="/#narrow/stream/219381-t-libs">#t-libs</a></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>