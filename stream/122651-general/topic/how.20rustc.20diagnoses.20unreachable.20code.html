<html>
<head><meta charset="utf-8"><title>how rustc diagnoses unreachable code · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/how.20rustc.20diagnoses.20unreachable.20code.html">how rustc diagnoses unreachable code</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="257643011"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/how%20rustc%20diagnoses%20unreachable%20code/near/257643011" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> VitalyR <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/how.20rustc.20diagnoses.20unreachable.20code.html#257643011">(Oct 15 2021 at 04:05)</a>:</h4>
<p>Hi! I want to learn how rust diagnoses unreachable code, I found <a href="https://github.com/rust-lang/rust/blob/e1e9319d93aea755c444c8f8ff863b0936d7a4b6/compiler/rustc_lint_defs/src/builtin.rs#L592">https://github.com/rust-lang/rust/blob/e1e9319d93aea755c444c8f8ff863b0936d7a4b6/compiler/rustc_lint_defs/src/builtin.rs#L592</a> and <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_lint/builtin/static.UNREACHABLE_CODE.html">https://doc.rust-lang.org/nightly/nightly-rustc/rustc_lint/builtin/static.UNREACHABLE_CODE.html</a>, but I can't find where the rustc implements the macro <code>unreachable!</code> and the lint <code>unreachable_code</code>. Where should I go?</p>



<a name="257651432"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/how%20rustc%20diagnoses%20unreachable%20code/near/257651432" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> AlexApps99 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/how.20rustc.20diagnoses.20unreachable.20code.html#257651432">(Oct 15 2021 at 06:19)</a>:</h4>
<p>The macro <code>unreachable!</code> does nothing in regards to diagnosing unreachable code, it expands to a <code>panic!</code>.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="fm">macro_rules!</span><span class="w"> </span><span class="n">unreachable</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">({</span><span class="w"></span>
<span class="w">        </span><span class="cp">$crate</span>::<span class="fm">panic!</span><span class="p">(</span><span class="s">"internal error: entered unreachable code"</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">});</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="cp">$msg</span>:<span class="nc">expr</span><span class="w"> </span><span class="cp">$(,</span><span class="p">)</span><span class="o">?</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">({</span><span class="w"></span>
<span class="w">        </span><span class="cp">$crate</span>::<span class="fm">unreachable!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span><span class="w"> </span><span class="cp">$msg</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">});</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="cp">$fmt</span>:<span class="nc">expr</span><span class="p">,</span><span class="w"> </span><span class="cp">$($arg</span>:<span class="nc">tt</span><span class="p">)</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">({</span><span class="w"></span>
<span class="w">        </span><span class="cp">$crate</span>::<span class="fm">panic!</span><span class="p">(</span><span class="cp">$crate</span>::<span class="fm">concat!</span><span class="p">(</span><span class="s">"internal error: entered unreachable code: "</span><span class="p">,</span><span class="w"> </span><span class="cp">$fmt</span><span class="p">),</span><span class="w"> </span><span class="cp">$($arg</span><span class="p">)</span><span class="o">*</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">});</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>You can find the implementation of the macro <a href="https://doc.rust-lang.org/std/macro.unreachable.html">here</a>, by pressing the button <code>[src]</code> (the same applies to any function/macro, on any rustdoc)</p>



<a name="257712424"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/how%20rustc%20diagnoses%20unreachable%20code/near/257712424" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/how.20rustc.20diagnoses.20unreachable.20code.html#257712424">(Oct 15 2021 at 15:04)</a>:</h4>
<p>When you know the name of the lint, you can search for it (in all uppercase) to find where it is implemented.  In this particular case, there are two places <a href="https://github.com/rust-lang/rust/blob/1dafe6d1c328d2f0580763e8438a227e490deb10/compiler/rustc_passes/src/liveness.rs#L1284-L1323">here</a> (and the top of that module contains a description of liveness analysis) and <a href="https://github.com/rust-lang/rust/blob/1dafe6d1c328d2f0580763e8438a227e490deb10/compiler/rustc_typeck/src/check/fn_ctxt/_impl.rs#L50-L80">here</a>.  You can then work backwards to see who calls those functions.</p>



<a name="257784388"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/how%20rustc%20diagnoses%20unreachable%20code/near/257784388" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> VitalyR <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/how.20rustc.20diagnoses.20unreachable.20code.html#257784388">(Oct 16 2021 at 00:15)</a>:</h4>
<p>Thanks!</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>