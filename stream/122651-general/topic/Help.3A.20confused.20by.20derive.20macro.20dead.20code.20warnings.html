<html>
<head><meta charset="utf-8"><title>Help: confused by derive macro dead code warnings · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Help.3A.20confused.20by.20derive.20macro.20dead.20code.20warnings.html">Help: confused by derive macro dead code warnings</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="277658032"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Help%3A%20confused%20by%20derive%20macro%20dead%20code%20warnings/near/277658032" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> João Marcos Bezerra <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Help.3A.20confused.20by.20derive.20macro.20dead.20code.20warnings.html#277658032">(Apr 03 2022 at 19:59)</a>:</h4>
<p>For this code:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#[derive(Clone, Debug)]</span><span class="w"></span>
<span class="k">pub</span><span class="w"> </span><span class="k">struct</span> <span class="nc">Token</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">token_type</span>: <span class="nc">TokenType</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">lexeme</span>: <span class="nb">String</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">literal</span>: <span class="nb">Option</span><span class="o">&lt;</span><span class="n">Literal</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">line</span>: <span class="kt">usize</span><span class="p">,</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>I receive the following warning:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">warning</span>: <span class="nc">field</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">never</span><span class="w"> </span><span class="n">read</span>: <span class="err">`</span><span class="n">line</span><span class="err">`</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">token</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">63</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="mi">63</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">line</span>: <span class="kt">usize</span><span class="p">,</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w">     </span><span class="o">^^^^^^^^^^^</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="err">`</span><span class="cp">#[warn(dead_code)]</span><span class="err">`</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">default</span><span class="w"></span>
<span class="n">note</span>: <span class="err">`</span><span class="n">Token</span><span class="err">`</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">derived</span><span class="w"> </span><span class="n">impls</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">traits</span><span class="w"> </span><span class="err">`</span><span class="n">Debug</span><span class="err">`</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="err">`</span><span class="nb">Clone</span><span class="err">`</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">these</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">intentionally</span><span class="w"> </span><span class="n">ignored</span><span class="w"> </span><span class="n">during</span><span class="w"> </span><span class="n">dead</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="n">analysis</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">token</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">58</span>:<span class="mi">10</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="mi">58</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="cp">#[derive(Clone, Debug)]</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w">          </span><span class="o">^^^^^</span><span class="w">  </span><span class="o">^^^^^</span><span class="w"></span>
<span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">this</span><span class="w"> </span><span class="n">warning</span><span class="w"> </span><span class="n">originates</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">derive</span><span class="w"> </span><span class="kr">macro</span><span class="w"> </span><span class="err">`</span><span class="nb">Clone</span><span class="err">`</span><span class="w"> </span><span class="p">(</span><span class="k">in</span><span class="w"> </span><span class="n">Nightly</span><span class="w"> </span><span class="n">builds</span><span class="p">,</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="o">-</span><span class="n">Z</span><span class="w"> </span><span class="kr">macro</span><span class="o">-</span><span class="n">backtrace</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">info</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<p>Can someone explain to me what this segment means:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">note</span>: <span class="err">`</span><span class="n">Token</span><span class="err">`</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">derived</span><span class="w"> </span><span class="n">impls</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">traits</span><span class="w"> </span><span class="err">`</span><span class="n">Debug</span><span class="err">`</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="err">`</span><span class="nb">Clone</span><span class="err">`</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">these</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">intentionally</span><span class="w"> </span><span class="n">ignored</span><span class="w"> </span><span class="n">during</span><span class="w"> </span><span class="n">dead</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="n">analysis</span><span class="w"></span>
</code></pre></div>



<a name="277658152"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Help%3A%20confused%20by%20derive%20macro%20dead%20code%20warnings/near/277658152" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> João Marcos Bezerra <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Help.3A.20confused.20by.20derive.20macro.20dead.20code.20warnings.html#277658152">(Apr 03 2022 at 20:00)</a>:</h4>
<p>I cannot remove the <code>#[derive(Clone, Debug)]</code> line because Debug and Clone are being used in other parts of the code.</p>



<a name="277659048"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Help%3A%20confused%20by%20derive%20macro%20dead%20code%20warnings/near/277659048" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Help.3A.20confused.20by.20derive.20macro.20dead.20code.20warnings.html#277659048">(Apr 03 2022 at 20:22)</a>:</h4>
<p>The <code>dead_code</code> check ignores <code>Debug</code> and <code>Clone</code> impls for the purpose of determining if fields are ever "used".  If the impl itself is the only thing using the field, then the field is considered unused.  This is done so that the <code>dead_code</code> lint is actually useful. Otherwise, any <code>Debug</code> impl would prevent <code>dead_code</code> from actually detecting unused fields.  </p>
<p>There's a bit more discussion at <a href="https://github.com/rust-lang/rust/issues/85200">#85200</a> why this was done.</p>



<a name="277659093"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Help%3A%20confused%20by%20derive%20macro%20dead%20code%20warnings/near/277659093" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Help.3A.20confused.20by.20derive.20macro.20dead.20code.20warnings.html#277659093">(Apr 03 2022 at 20:22)</a>:</h4>
<p>Is that available to third party derives yet</p>



<a name="277659179"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Help%3A%20confused%20by%20derive%20macro%20dead%20code%20warnings/near/277659179" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> João Marcos Bezerra <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Help.3A.20confused.20by.20derive.20macro.20dead.20code.20warnings.html#277659179">(Apr 03 2022 at 20:24)</a>:</h4>
<p>Let me try it</p>



<a name="277659188"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Help%3A%20confused%20by%20derive%20macro%20dead%20code%20warnings/near/277659188" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Help.3A.20confused.20by.20derive.20macro.20dead.20code.20warnings.html#277659188">(Apr 03 2022 at 20:24)</a>:</h4>
<p>I'm not aware of any movement towards that.</p>



<a name="277659234"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Help%3A%20confused%20by%20derive%20macro%20dead%20code%20warnings/near/277659234" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Help.3A.20confused.20by.20derive.20macro.20dead.20code.20warnings.html#277659234">(Apr 03 2022 at 20:25)</a>:</h4>
<p><span class="user-mention" data-user-id="372058">@João Marcos Bezerra</span> basically it means that no code usefully reads your fields. Try removing them; is anything broken?</p>



<a name="277659318"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Help%3A%20confused%20by%20derive%20macro%20dead%20code%20warnings/near/277659318" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> João Marcos Bezerra <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Help.3A.20confused.20by.20derive.20macro.20dead.20code.20warnings.html#277659318">(Apr 03 2022 at 20:27)</a>:</h4>
<p>It would be "broken" because now I won't see them in my Debug uses</p>
<p>What if I do this <code>log(format!("{token:?}"));</code></p>



<a name="277659332"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Help%3A%20confused%20by%20derive%20macro%20dead%20code%20warnings/near/277659332" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> João Marcos Bezerra <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Help.3A.20confused.20by.20derive.20macro.20dead.20code.20warnings.html#277659332">(Apr 03 2022 at 20:27)</a>:</h4>
<p>currently I'm just outputting it in <code>println!</code></p>



<a name="277659374"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Help%3A%20confused%20by%20derive%20macro%20dead%20code%20warnings/near/277659374" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> João Marcos Bezerra <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Help.3A.20confused.20by.20derive.20macro.20dead.20code.20warnings.html#277659374">(Apr 03 2022 at 20:28)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116155">Jake Goulding</span> <a href="#narrow/stream/122651-general/topic/Help.3A.20confused.20by.20derive.20macro.20dead.20code.20warnings/near/277659093">said</a>:</p>
<blockquote>
<p>Is that available to third party derives yet</p>
</blockquote>
<p>I think no, I tried with Deserialize and it didn't had this <code>note</code> part</p>



<a name="277659465"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Help%3A%20confused%20by%20derive%20macro%20dead%20code%20warnings/near/277659465" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> João Marcos Bezerra <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Help.3A.20confused.20by.20derive.20macro.20dead.20code.20warnings.html#277659465">(Apr 03 2022 at 20:30)</a>:</h4>
<p>I'm trying to come up with a better message from a users perspective for this note.</p>
<p>I think 'dead code analysis' makes more sense from the compiler's point of view.</p>



<a name="277659482"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Help%3A%20confused%20by%20derive%20macro%20dead%20code%20warnings/near/277659482" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Help.3A.20confused.20by.20derive.20macro.20dead.20code.20warnings.html#277659482">(Apr 03 2022 at 20:31)</a>:</h4>
<p>Well, that would only occur if the <code>Deserialize</code> macro opted into using it. The compiler would have to make it available first (which is what my question is).</p>



<a name="277659535"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Help%3A%20confused%20by%20derive%20macro%20dead%20code%20warnings/near/277659535" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Help.3A.20confused.20by.20derive.20macro.20dead.20code.20warnings.html#277659535">(Apr 03 2022 at 20:32)</a>:</h4>
<p><span class="user-mention silent" data-user-id="372058">João Marcos Bezerra</span> <a href="#narrow/stream/122651-general/topic/Help.3A.20confused.20by.20derive.20macro.20dead.20code.20warnings/near/277659318">said</a>:</p>
<blockquote>
<p>It would be "broken" because now I won't see them in my Debug uses</p>
</blockquote>
<p>If that's literally the <strong>only</strong> purpose of the <code>line</code> field, then add an <code>#[allow(..)]</code> on the field</p>



<a name="277659542"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Help%3A%20confused%20by%20derive%20macro%20dead%20code%20warnings/near/277659542" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> João Marcos Bezerra <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Help.3A.20confused.20by.20derive.20macro.20dead.20code.20warnings.html#277659542">(Apr 03 2022 at 20:32)</a>:</h4>
<p>makes sense</p>



<a name="277659547"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Help%3A%20confused%20by%20derive%20macro%20dead%20code%20warnings/near/277659547" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> João Marcos Bezerra <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Help.3A.20confused.20by.20derive.20macro.20dead.20code.20warnings.html#277659547">(Apr 03 2022 at 20:33)</a>:</h4>
<p>thanks for the clarifications</p>



<a name="277659555"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Help%3A%20confused%20by%20derive%20macro%20dead%20code%20warnings/near/277659555" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> João Marcos Bezerra <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Help.3A.20confused.20by.20derive.20macro.20dead.20code.20warnings.html#277659555">(Apr 03 2022 at 20:33)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116155">Jake Goulding</span> <a href="#narrow/stream/122651-general/topic/Help.3A.20confused.20by.20derive.20macro.20dead.20code.20warnings/near/277659482">said</a>:</p>
<blockquote>
<p>Well, that would only occur if the <code>Deserialize</code> macro opted into using it. The compiler would have to make it available first (which is what my question is).</p>
</blockquote>
<p>this line, I think the <code>rustc</code> prefix means it's not available<br>
<code>#[cfg_attr(not(bootstrap), rustc_trivial_field_reads)]</code></p>



<a name="277659572"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Help%3A%20confused%20by%20derive%20macro%20dead%20code%20warnings/near/277659572" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Help.3A.20confused.20by.20derive.20macro.20dead.20code.20warnings.html#277659572">(Apr 03 2022 at 20:34)</a>:</h4>
<p>Something existing <em>only</em> for the purpose of being output in <code>Debug</code> (not even for end-users via <code>Display</code>) is too rare of an occurrence to prevent warnings for the other cases.</p>



<a name="277659603"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Help%3A%20confused%20by%20derive%20macro%20dead%20code%20warnings/near/277659603" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Help.3A.20confused.20by.20derive.20macro.20dead.20code.20warnings.html#277659603">(Apr 03 2022 at 20:34)</a>:</h4>
<p><span class="user-mention silent" data-user-id="372058">João Marcos Bezerra</span> <a href="#narrow/stream/122651-general/topic/Help.3A.20confused.20by.20derive.20macro.20dead.20code.20warnings/near/277659555">said</a>:</p>
<blockquote>
<p>this line, I think the <code>rustc</code> prefix means it's not available<br>
<code>#[cfg_attr(not(bootstrap), rustc_trivial_field_reads)]</code></p>
</blockquote>
<p>Yep, that's what it was last I checked as well. I really want it for SNAFU.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>