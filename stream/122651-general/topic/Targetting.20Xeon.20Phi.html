<html>
<head><meta charset="utf-8"><title>Targetting Xeon Phi · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Targetting.20Xeon.20Phi.html">Targetting Xeon Phi</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="259398403"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Targetting%20Xeon%20Phi/near/259398403" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Forest Anderson [he/him] <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Targetting.20Xeon.20Phi.html#259398403">(Oct 28 2021 at 14:39)</a>:</h4>
<p>A friend of mine is letting me try his Xeon Phi, and I'm trying to figure out if it's possible to target it with Rust. He said that it uses a K1OM architecture, and runs uLinux. What steps can I take to figure out how to compile for it?</p>



<a name="259399271"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Targetting%20Xeon%20Phi/near/259399271" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Targetting.20Xeon.20Phi.html#259399271">(Oct 28 2021 at 14:45)</a>:</h4>
<p>Does LLVM even support that?</p>



<a name="259400067"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Targetting%20Xeon%20Phi/near/259400067" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Forest Anderson [he/him] <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Targetting.20Xeon.20Phi.html#259400067">(Oct 28 2021 at 14:49)</a>:</h4>
<p>It might not, I'm trying to figure out where to look. I suppose it would be good to start looking there <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="259403263"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Targetting%20Xeon%20Phi/near/259403263" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Targetting.20Xeon.20Phi.html#259403263">(Oct 28 2021 at 15:09)</a>:</h4>
<p>You need the right -Ctarget-cpu value I believe.</p>



<a name="259409894"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Targetting%20Xeon%20Phi/near/259409894" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Targetting.20Xeon.20Phi.html#259409894">(Oct 28 2021 at 15:55)</a>:</h4>
<p>Which generation of Phi?</p>



<a name="259413087"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Targetting%20Xeon%20Phi/near/259413087" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Forest Anderson [he/him] <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Targetting.20Xeon.20Phi.html#259413087">(Oct 28 2021 at 16:16)</a>:</h4>
<p>The model is 71s1p I believe</p>



<a name="259413763"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Targetting%20Xeon%20Phi/near/259413763" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Forest Anderson [he/him] <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Targetting.20Xeon.20Phi.html#259413763">(Oct 28 2021 at 16:21)</a>:</h4>
<p>So "Knight's Corner" I think?</p>



<a name="259440364"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Targetting%20Xeon%20Phi/near/259440364" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Targetting.20Xeon.20Phi.html#259440364">(Oct 28 2021 at 19:32)</a>:</h4>
<p>I can find a knl target cpu (knights landing) but that is too new. I can't find any other xeon phi target cpu.</p>



<a name="259440394"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Targetting%20Xeon%20Phi/near/259440394" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Targetting.20Xeon.20Phi.html#259440394">(Oct 28 2021 at 19:33)</a>:</h4>
<p>for reference: <a href="https://github.com/llvm/llvm-project/blob/main/llvm/lib/Target/X86/X86.td">https://github.com/llvm/llvm-project/blob/main/llvm/lib/Target/X86/X86.td</a></p>



<a name="259446564"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Targetting%20Xeon%20Phi/near/259446564" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Forest Anderson [he/him] <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Targetting.20Xeon.20Phi.html#259446564">(Oct 28 2021 at 20:20)</a>:</h4>
<p><span class="user-mention silent" data-user-id="133247">bjorn3</span> <a href="#narrow/stream/122651-general/topic/Targetting.20Xeon.20Phi/near/259440394">said</a>:</p>
<blockquote>
<p>for reference: <a href="https://github.com/llvm/llvm-project/blob/main/llvm/lib/Target/X86/X86.td">https://github.com/llvm/llvm-project/blob/main/llvm/lib/Target/X86/X86.td</a></p>
</blockquote>
<p>cheers, I'll check this out. I'm playing around on it now, so I'm seeing where I can get.</p>



<a name="259486632"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Targetting%20Xeon%20Phi/near/259486632" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Soham Dixit <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Targetting.20Xeon.20Phi.html#259486632">(Oct 29 2021 at 06:13)</a>:</h4>
<p>Hello Everyone <br>
How to write a pass in rust compiler ?<br>
Thanks in Advance.</p>



<a name="260663022"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Targetting%20Xeon%20Phi/near/260663022" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Forest Anderson [he/him] <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Targetting.20Xeon.20Phi.html#260663022">(Nov 08 2021 at 14:24)</a>:</h4>
<p>So my friend has been playing more with the Phi, and has gotten C code to compile for it, and has also compiled Python to run on it. His current technique involves using a custom version of GCC that is designed to target the Phi, and compiling stuff with that. Right now, he's trying to get Rust to compile to it by using the GCC backend instead of LLVM, and is using a project called mrustc as a test. But I'm wondering if it should be possible to swap in GCC as the backend using <code>rustc_codegen_gcc</code>: <a href="https://github.com/rust-lang/compiler-team/issues/442">https://github.com/rust-lang/compiler-team/issues/442</a></p>
<p>He wrote a blog post for more context: <a href="https://aidancrowther.com/project/xeonphi">https://aidancrowther.com/project/xeonphi</a></p>



<a name="260711703"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Targetting%20Xeon%20Phi/near/260711703" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Targetting.20Xeon.20Phi.html#260711703">(Nov 08 2021 at 20:10)</a>:</h4>
<p>cg_gcc requires a couple of patches to libgccjit. It may be possible to backport them to whatever old version of gcc k1om-mpss-linux-gcc is, but I have no idea how hard it will be. The not yet landed patches can be found at <a href="https://github.com/antoyo/gcc">https://github.com/antoyo/gcc</a>. I believe there is also one patch that has already landed upstream. cc <span class="user-mention" data-user-id="404242">@antoyo</span></p>



<a name="260858720"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Targetting%20Xeon%20Phi/near/260858720" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Forest Anderson [he/him] <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Targetting.20Xeon.20Phi.html#260858720">(Nov 09 2021 at 20:50)</a>:</h4>
<p>Update: we have Rust compiled to WASM running on the Phi, we're going to play around with this a bit and see what cool stuff we can do on it</p>



<a name="260859022"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Targetting%20Xeon%20Phi/near/260859022" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Forest Anderson [he/him] <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Targetting.20Xeon.20Phi.html#260859022">(Nov 09 2021 at 20:53)</a>:</h4>
<p>(currently it's just using a WASM interpreter I think, but the proof of concept is going well)</p>



<a name="260939594"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Targetting%20Xeon%20Phi/near/260939594" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aidan Crowther <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Targetting.20Xeon.20Phi.html#260939594">(Nov 10 2021 at 03:15)</a>:</h4>
<p>Just wanted to pipe up to say that I am following this message chain, thanks for all the tips</p>



<a name="262158978"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Targetting%20Xeon%20Phi/near/262158978" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Evan Richter <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Targetting.20Xeon.20Phi.html#262158978">(Nov 20 2021 at 03:17)</a>:</h4>
<p>I also have a Knight's corner xeon phi and was hoping to get rust to target it. There was at one point a fork of llvm that worked for knc and I think it might have been in this repo: <a href="https://github.com/ispc/ispc">https://github.com/ispc/ispc</a> but it's been awhile since investigating.</p>
<p>I would just like to be able to target x86_64 but cut out the instructions that are incompatible with knc like the cmov instruction. I don't know how to make llvm do that however.</p>



<a name="262167092"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Targetting%20Xeon%20Phi/near/262167092" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Targetting.20Xeon.20Phi.html#262167092">(Nov 20 2021 at 06:45)</a>:</h4>
<p>It's not the ideal target, but you could use 486.</p>



<a name="262167304"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Targetting%20Xeon%20Phi/near/262167304" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Targetting.20Xeon.20Phi.html#262167304">(Nov 20 2021 at 06:51)</a>:</h4>
<p>do we have a 486 target or just 586</p>



<a name="262167356"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Targetting%20Xeon%20Phi/near/262167356" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Targetting.20Xeon.20Phi.html#262167356">(Nov 20 2021 at 06:52)</a>:</h4>
<p><code>rustc --print target-list | grep 486</code> is empty</p>



<a name="262167763"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Targetting%20Xeon%20Phi/near/262167763" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hans Kratz <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Targetting.20Xeon.20Phi.html#262167763">(Nov 20 2021 at 07:02)</a>:</h4>
<p>Target spec files for <code>i386-unknown-linux-gnu</code> and <code>i486-unknown-linux-gnu</code> were added in <a href="https://github.com/rust-lang/rust/issues/80662">#80662</a> but never referenced.</p>



<a name="262169087"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Targetting%20Xeon%20Phi/near/262169087" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Targetting.20Xeon.20Phi.html#262169087">(Nov 20 2021 at 07:38)</a>:</h4>
<p>hm, presumably thats a bug?</p>



<a name="262174053"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Targetting%20Xeon%20Phi/near/262174053" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Evan Richter <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Targetting.20Xeon.20Phi.html#262174053">(Nov 20 2021 at 09:42)</a>:</h4>
<p>The downside to i486 is that it can only address 4Gb of the 16Gb of memory available since it's 32 bit. I will definitely try at least and report back.</p>
<p>As long as I can dispatch handwritten knc instructions (the pre avx-512 kind) from a 32-bit process that would be a good start</p>



<a name="262174482"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Targetting%20Xeon%20Phi/near/262174482" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Targetting.20Xeon.20Phi.html#262174482">(Nov 20 2021 at 09:54)</a>:</h4>
<p>Would something silly like 486 + SSE + ... work?</p>



<a name="262188123"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Targetting%20Xeon%20Phi/near/262188123" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Targetting.20Xeon.20Phi.html#262188123">(Nov 20 2021 at 15:08)</a>:</h4>
<p>Why not just x86_64 -cmov?</p>



<a name="262188221"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Targetting%20Xeon%20Phi/near/262188221" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Targetting.20Xeon.20Phi.html#262188221">(Nov 20 2021 at 15:11)</a>:</h4>
<p>(You'll need cargo <code>-Zbuild-std</code> to remove the feature everywhere.)</p>



<a name="262188222"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Targetting%20Xeon%20Phi/near/262188222" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Evan Richter <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Targetting.20Xeon.20Phi.html#262188222">(Nov 20 2021 at 15:11)</a>:</h4>
<blockquote>
<p>Would something silly like 486 + SSE + ... work?</p>
</blockquote>
<p>Not for the 512 bit instructions, since the encodings differ from avx-512. And I think usize will be u32 and not u64.</p>
<blockquote>
<p>Why not just x86_64 -cmov?</p>
</blockquote>
<p>Might have been an llvm bug I experienced ~ a year ago, but that never actually disabled cmov. Might have been because cmov is part of the base x64 spec</p>



<a name="262188281"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Targetting%20Xeon%20Phi/near/262188281" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Evan Richter <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Targetting.20Xeon.20Phi.html#262188281">(Nov 20 2021 at 15:12)</a>:</h4>
<p>It's certainly worth another shot since rustc has upgraded llvm a few times since last I tried</p>



<a name="262188284"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Targetting%20Xeon%20Phi/near/262188284" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Targetting.20Xeon.20Phi.html#262188284">(Nov 20 2021 at 15:12)</a>:</h4>
<p>Ah, I only checked that it's accepted as a feature, not whether it works. <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>