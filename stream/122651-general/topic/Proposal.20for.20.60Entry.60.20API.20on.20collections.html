<html>
<head><meta charset="utf-8"><title>Proposal for `Entry` API on collections · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Proposal.20for.20.60Entry.60.20API.20on.20collections.html">Proposal for `Entry` API on collections</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="275318895"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Proposal%20for%20%60Entry%60%20API%20on%20collections/near/275318895" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Boeman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Proposal.20for.20.60Entry.60.20API.20on.20collections.html#275318895">(Mar 15 2022 at 01:20)</a>:</h4>
<p>Hello! I was looking at the API for the entry related items in std::collections::HashMap and saw some inconsistencies and room for improvement. I threw together a crate of what I think this API should look like, and was hoping people would be interested in taking a look!</p>



<a name="275318907"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Proposal%20for%20%60Entry%60%20API%20on%20collections/near/275318907" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Boeman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Proposal.20for.20.60Entry.60.20API.20on.20collections.html#275318907">(Mar 15 2022 at 01:21)</a>:</h4>
<p>Existing discussion:</p>
<p><a href="https://github.com/rust-lang/rust/issues/65225">https://github.com/rust-lang/rust/issues/65225</a></p>



<a name="275318920"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Proposal%20for%20%60Entry%60%20API%20on%20collections/near/275318920" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Boeman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Proposal.20for.20.60Entry.60.20API.20on.20collections.html#275318920">(Mar 15 2022 at 01:21)</a>:</h4>
<p>Repo:</p>
<p><a href="https://github.com/maboesanman/InPlace">https://github.com/maboesanman/InPlace</a></p>



<a name="275318934"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Proposal%20for%20%60Entry%60%20API%20on%20collections/near/275318934" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Boeman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Proposal.20for.20.60Entry.60.20API.20on.20collections.html#275318934">(Mar 15 2022 at 01:21)</a>:</h4>
<p>Docs:</p>
<p><a href="https://maboesanman.github.io/InPlace/in_place/">https://maboesanman.github.io/InPlace/in_place/</a></p>



<a name="275334353"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Proposal%20for%20%60Entry%60%20API%20on%20collections/near/275334353" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Conrad Ludgate <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Proposal.20for.20.60Entry.60.20API.20on.20collections.html#275334353">(Mar 15 2022 at 06:33)</a>:</h4>
<p>On the topic of Entry, I wish it didn't require owning the key, but instead accepted a <code>Cow&lt;'_, KeyRef&gt;</code> somehow.<br>
It only needs ownership in the event that the entry is vacant, so requiring ownership all the time might be wasteful, but always forcing a clone inside is also not great because you might already have ownership that you no longer need</p>



<a name="275337617"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Proposal%20for%20%60Entry%60%20API%20on%20collections/near/275337617" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Boeman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Proposal.20for.20.60Entry.60.20API.20on.20collections.html#275337617">(Mar 15 2022 at 07:30)</a>:</h4>
<p>I was trying to use ToOwned, among a few other ideas, but ToOwned doesn’t actually do what I want. As of now I have two functions on the InPlace trait for getting entries: one that takes key by value, and one that takes it by reference and clones if needed. I’m not a huge fan of that approach though.</p>



<a name="275614718"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Proposal%20for%20%60Entry%60%20API%20on%20collections/near/275614718" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Boeman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Proposal.20for.20.60Entry.60.20API.20on.20collections.html#275614718">(Mar 17 2022 at 07:21)</a>:</h4>
<p>I’ve made a bunch of updates to my mock api! Now it really feels like the correct abstraction over data structures for manipulating data in them. Without having to re-query</p>
<p>Check out the changes in the repo:</p>
<p><a href="https://github.com/maboesanman/InPlace">https://github.com/maboesanman/InPlace</a></p>



<a name="275614941"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Proposal%20for%20%60Entry%60%20API%20on%20collections/near/275614941" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Boeman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Proposal.20for.20.60Entry.60.20API.20on.20collections.html#275614941">(Mar 17 2022 at 07:25)</a>:</h4>
<p>My GitHub actions deployment for the docs is borked so unfortunately I’ll have to fix that tomorrow, but if you’re curious about my take on the Entry API for hashmap and btreemap (and LinkedList and [T]). I’ll be adding tons of documentation and writing a proper RFC shortly</p>



<a name="275686116"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Proposal%20for%20%60Entry%60%20API%20on%20collections/near/275686116" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Proposal.20for.20.60Entry.60.20API.20on.20collections.html#275686116">(Mar 17 2022 at 16:33)</a>:</h4>
<p>I cant find you links at the moment, but there have bean (pre-)RFC's about this in the past. The <a href="https://docs.rs/hashbrown/latest/hashbrown/raw/index.html">https://docs.rs/hashbrown/latest/hashbrown/raw/index.html</a> is one of the things that came out of it. Please make shore to find them and link them in your RFC. How dose yours address all of the concerns that have come up on previous (pre-)RFC's.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>