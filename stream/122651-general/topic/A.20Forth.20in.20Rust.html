<html>
<head><meta charset="utf-8"><title>A Forth in Rust · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/A.20Forth.20in.20Rust.html">A Forth in Rust</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="262315555"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/A%20Forth%20in%20Rust/near/262315555" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Munns <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/A.20Forth.20in.20Rust.html#262315555">(Nov 22 2021 at 13:04)</a>:</h4>
<p>Hey <span class="user-mention" data-user-id="133169">@matklad</span>! I have an off-topic compiler/parser question for you, if you have a minute :)</p>



<a name="262315595"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/A%20Forth%20in%20Rust/near/262315595" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/A.20Forth.20in.20Rust.html#262315595">(Nov 22 2021 at 13:04)</a>:</h4>
<p>I don't but I also can't resist :)</p>



<a name="262315606"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/A%20Forth%20in%20Rust/near/262315606" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Munns <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/A.20Forth.20in.20Rust.html#262315606">(Nov 22 2021 at 13:04)</a>:</h4>
<p>I currently have a (very bad, no good) forth compiler here: <a href="https://github.com/anachro-rs/anachro-forth/blob/8294f004bdab6a0dee2ff905146f30deef28264d/core/src/compiler.rs#L109-L264">https://github.com/anachro-rs/anachro-forth/blob/8294f004bdab6a0dee2ff905146f30deef28264d/core/src/compiler.rs#L109-L264</a></p>



<a name="262315640"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/A%20Forth%20in%20Rust/near/262315640" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Munns <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/A.20Forth.20in.20Rust.html#262315640">(Nov 22 2021 at 13:05)</a>:</h4>
<p>I'm planning to rewrite it to use an AST, to make sure that I have things like nested constructs working (they don't currently)</p>



<a name="262315692"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/A%20Forth%20in%20Rust/near/262315692" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Munns <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/A.20Forth.20in.20Rust.html#262315692">(Nov 22 2021 at 13:05)</a>:</h4>
<p>Do you have an off the cuff "just do it like this, silly" approach that I should use for a line-oriented parser/compiler?</p>



<a name="262316024"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/A%20Forth%20in%20Rust/near/262316024" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/A.20Forth.20in.20Rust.html#262316024">(Nov 22 2021 at 13:08)</a>:</h4>
<p>Not really. I guess, if it is <em>really</em> line oriented, then you shouldn't have nesting at all. If however you do have nesting, then, well, just write the parser :)</p>



<a name="262316249"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/A%20Forth%20in%20Rust/near/262316249" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Munns <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/A.20Forth.20in.20Rust.html#262316249">(Nov 22 2021 at 13:10)</a>:</h4>
<p>Yeah, for example I might have something like:</p>
<div class="codehilite"><pre><span></span><code>: test 10 0 do if star then 5 0 do star loop loop ;
</code></pre></div>
<p>Which should be roughly parsed as:</p>
<div class="codehilite"><pre><span></span><code>: test
  10 0 do
    if
      star
    then
    5 0 do
      star
    loop
  loop
;
</code></pre></div>



<a name="262316472"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/A%20Forth%20in%20Rust/near/262316472" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Munns <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/A.20Forth.20in.20Rust.html#262316472">(Nov 22 2021 at 13:13)</a>:</h4>
<p>I was thinking about making one pass that generates an AST, basically globbing up the matched scope, then compiling it recursively</p>



<a name="262316899"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/A%20Forth%20in%20Rust/near/262316899" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Munns <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/A.20Forth.20in.20Rust.html#262316899">(Nov 22 2021 at 13:17)</a>:</h4>
<p>BTW, I'm asking you, because the <code>calc</code> exercise we wrote for training is basically what pushed me towards building a Forth :D</p>



<a name="262317390"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/A%20Forth%20in%20Rust/near/262317390" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Munns <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/A.20Forth.20in.20Rust.html#262317390">(Nov 22 2021 at 13:22)</a>:</h4>
<p>Let me know if any magical thoughts/patterns come to mind, otherwise I'm gunna go blindly try and write a parser :)</p>



<a name="262319074"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/A%20Forth%20in%20Rust/near/262319074" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/A.20Forth.20in.20Rust.html#262319074">(Nov 22 2021 at 13:37)</a>:</h4>
<p>I guess just try writing recusive descent parser? <a href="https://compilers.iecc.com/crenshaw/">https://compilers.iecc.com/crenshaw/</a> if you want the quickest and dirtiest way to get there</p>



<a name="262323216"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/A%20Forth%20in%20Rust/near/262323216" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/A.20Forth.20in.20Rust.html#262323216">(Nov 22 2021 at 14:10)</a>:</h4>
<p><a href="https://craftinginterpreters.com/">https://craftinginterpreters.com/</a> is good too</p>



<a name="262347668"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/A%20Forth%20in%20Rust/near/262347668" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Charles Lew <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/A.20Forth.20in.20Rust.html#262347668">(Nov 22 2021 at 17:02)</a>:</h4>
<p>I think you might already know it, but "real" Forth systems (or ANS Forth systems) doesn't really use an AST. Instead it has interpretation / compilation/ runtime semantics for each word, and can switch between them. Parsing full text without interpretation is not really possible for complex cases...</p>



<a name="262347724"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/A%20Forth%20in%20Rust/near/262347724" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Charles Lew <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/A.20Forth.20in.20Rust.html#262347724">(Nov 22 2021 at 17:02)</a>:</h4>
<p>Here's the draft standard full text for reference: <a href="https://www.taygeta.com/forth/dpans.html">https://www.taygeta.com/forth/dpans.html</a></p>



<a name="262349439"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/A%20Forth%20in%20Rust/near/262349439" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/A.20Forth.20in.20Rust.html#262349439">(Nov 22 2021 at 17:15)</a>:</h4>
<p>that sounds not great for IDE stuff</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>