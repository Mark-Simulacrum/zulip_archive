<html>
<head><meta charset="utf-8"><title>Is parallel-rustc enabled by default? · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html">Is parallel-rustc enabled by default?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="219379092"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219379092" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219379092">(Dec 09 2020 at 18:39)</a>:</h4>
<p>SO question for context: <a href="https://stackoverflow.com/q/65222827/155423">How can I use multiple cores for compiling a single crate?</a></p>
<p>parallel-rustc is on-by-default now, right?</p>



<a name="219379196"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219379196" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219379196">(Dec 09 2020 at 18:40)</a>:</h4>
<p>No, parallel-rustc is not enabled by default. You will have to recompile rustc to enable it.</p>



<a name="219379220"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219379220" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219379220">(Dec 09 2020 at 18:40)</a>:</h4>
<p>Oh, it's not even a -Z flag?</p>



<a name="219379322"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219379322" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219379322">(Dec 09 2020 at 18:41)</a>:</h4>
<p>Now I see why "fearless concurrency" was removed from the web page <span aria-label="smiling devil" class="emoji emoji-1f608" role="img" title="smiling devil">:smiling_devil:</span></p>



<a name="219379493"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219379493" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219379493">(Dec 09 2020 at 18:42)</a>:</h4>
<p>No, it requires replacing a lot of <code>RefCell</code> with <code>Mutex</code> and <code>Rc</code> with <code>Arc</code>. In addition it drastically changes the query system to handle multiple threads. This is still a regression in the single thread case. See <a href="https://github.com/rust-lang/rust/issues/79706">#79706</a> for the latest benchmarks. The first perf run is with <code>-Zthreads=12</code> as default. The second with <code>-Zthreads=1</code> as default.</p>



<a name="219379495"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219379495" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219379495">(Dec 09 2020 at 18:42)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/blob/master/config.toml.example#L437">https://github.com/rust-lang/rust/blob/master/config.toml.example#L437</a> if you want to have a go</p>



<a name="219379836"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219379836" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219379836">(Dec 09 2020 at 18:45)</a>:</h4>
<p>The comments on that PR seem cautiously optimistic.</p>



<a name="219379955"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219379955" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219379955">(Dec 09 2020 at 18:46)</a>:</h4>
<p>Too bad we don't have statistics on "number of cores available to use when rustc was invoked somewhere"</p>



<a name="219379977"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219379977" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219379977">(Dec 09 2020 at 18:46)</a>:</h4>
<p>the bootstrap measurements are still somewhat unexpected</p>



<a name="219380087"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219380087" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219380087">(Dec 09 2020 at 18:47)</a>:</h4>
<p>E.g if 90% of builds had idle cores and only a small percentage was restricted to a single core, then we'd be able to say that the single-digit regression was "OK".</p>



<a name="219380180"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219380180" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219380180">(Dec 09 2020 at 18:48)</a>:</h4>
<p>could be interesting to try on the M1 :)</p>



<a name="219380224"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219380224" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219380224">(Dec 09 2020 at 18:48)</a>:</h4>
<p>what kind of try? I don't have the M1, but do have the DTK. It's just idling there.</p>



<a name="219380472"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219380472" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219380472">(Dec 09 2020 at 18:50)</a>:</h4>
<p>just a random thought, a bootstrap with parallel queries on M1 could have interesting numbers</p>



<a name="219380543"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219380543" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219380543">(Dec 09 2020 at 18:51)</a>:</h4>
<p>to compare with my 2010 macbook air <span aria-label="joy" class="emoji emoji-1f602" role="img" title="joy">:joy:</span></p>



<a name="219380611"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219380611" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219380611">(Dec 09 2020 at 18:51)</a>:</h4>
<p>So, do <code>x.py clean</code> and then what should I run?</p>



<a name="219380726"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219380726" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219380726">(Dec 09 2020 at 18:52)</a>:</h4>
<p>Toggle <a href="https://github.com/rust-lang/rust/blob/master/config.toml.example#L437">https://github.com/rust-lang/rust/blob/master/config.toml.example#L437</a> and then build</p>



<a name="219380839"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219380839" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219380839">(Dec 09 2020 at 18:53)</a>:</h4>
<p>what kind of cpu does the DTK have ? wasn't that mostly to check the aarch64 target ?</p>



<a name="219381169"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219381169" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219381169">(Dec 09 2020 at 18:55)</a>:</h4>
<p>So I'm going to type <code>x.py build</code> and wait 50 minutes and then that will tell you everything you want to know?</p>



<a name="219381376"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219381376" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219381376">(Dec 09 2020 at 18:57)</a>:</h4>
<p><span class="user-mention" data-user-id="116113">@lqd</span> it's more-or-less an A14X</p>



<a name="219381465"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219381465" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219381465">(Dec 09 2020 at 18:57)</a>:</h4>
<p>if one had a way to compare to the regular bootstrap times</p>



<a name="219381545"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219381545" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219381545">(Dec 09 2020 at 18:58)</a>:</h4>
<p>but yeah it's probably too annoying to do that don't bother ^^</p>



<a name="219381576"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219381576" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219381576">(Dec 09 2020 at 18:58)</a>:</h4>
<p>like trying to run the perf.rlo collector and so on</p>



<a name="219381644"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219381644" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219381644">(Dec 09 2020 at 18:59)</a>:</h4>
<p>I mean, the machine is literally sitting there doing nothing at the moment. I'm doing a build because I haven't in a while.</p>



<a name="219384579"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219384579" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219384579">(Dec 09 2020 at 19:20)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116155">Jake Goulding</span> <a href="#narrow/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F/near/219381169">said</a>:</p>
<blockquote>
<p>So I'm going to type <code>x.py build</code> and wait 50 minutes and then that will tell you everything you want to know?</p>
</blockquote>
<p>make sure to set <code>parallel-compiler = true</code> first</p>



<a name="219384584"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219384584" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219384584">(Dec 09 2020 at 19:20)</a>:</h4>
<p>otherwise you'll have to recompile</p>



<a name="219385193"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219385193" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219385193">(Dec 09 2020 at 19:25)</a>:</h4>
<p>Yes, I gathered that from the <a href="#narrow/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F/near/219380726">1</a> <a href="#narrow/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F/near/219379495">2</a> previous suggestions <span aria-label="wink" class="emoji emoji-1f609" role="img" title="wink">:wink:</span></p>



<a name="219385337"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219385337" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219385337">(Dec 09 2020 at 19:26)</a>:</h4>
<p>ok you should be fine then, the line you're looking for is 'Building stage 2 artifacts' and then the time cargo outputs when that finishes</p>



<a name="219385400"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219385400" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219385400">(Dec 09 2020 at 19:26)</a>:</h4>
<p>the difference between that and the time for stage1 artifacts is roughly the improvement from the parallel compiler (modulo improvements since the beta bump)</p>



<a name="219386938"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219386938" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219386938">(Dec 09 2020 at 19:36)</a>:</h4>
<p>hmmph</p>
<div class="codehilite"><pre><span></span><code>  thread &#39;main&#39; panicked at &#39;command did not execute successfully: &quot;/Users/shepmaster/Projects/rust/full/build/aarch64-apple-darwin/llvm/build/bin/llvm-config&quot; &quot;--version&quot;
  expected success, got: signal: 9&#39;, src/build_helper/lib.rs:139:9
</code></pre></div>



<a name="219387061"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219387061" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219387061">(Dec 09 2020 at 19:37)</a>:</h4>
<p>9 is SIGKILL, right?</p>



<a name="219387094"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219387094" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219387094">(Dec 09 2020 at 19:37)</a>:</h4>
<p>maybe you ran out of ram or something? what does <code>llvm-config --verrsion</code> say?</p>



<a name="219387398"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219387398" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219387398">(Dec 09 2020 at 19:39)</a>:</h4>
<p>Nah, this is a "known issue" on macOS/arm. It means that something ran in x86_64 mode and improperly code signed that executable.</p>



<a name="219387675"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219387675" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219387675">(Dec 09 2020 at 19:41)</a>:</h4>
<p>The quick hack is </p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>cp program<span class="o">{</span>,2<span class="o">}</span>
codesign -s - program2
mv program<span class="o">{</span><span class="m">2</span>,<span class="o">}</span>
</code></pre></div>



<a name="219387793"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219387793" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219387793">(Dec 09 2020 at 19:42)</a>:</h4>
<p>In this case, "something" is most likely ninja</p>



<a name="219387839"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219387839" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219387839">(Dec 09 2020 at 19:43)</a>:</h4>
<p>See also <a href="https://stackoverflow.com/q/64830671/155423">Why does my native arm64 application built using an x86_64 build system fail to be code signed unless I remove the previous executable?</a></p>



<a name="219387854"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219387854" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219387854">(Dec 09 2020 at 19:43)</a>:</h4>
<p>ninja can be disabled in config.toml if you really want to</p>



<a name="219387883"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219387883" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219387883">(Dec 09 2020 at 19:43)</a>:</h4>
<p>Disabled in favor of make, right?</p>



<a name="219387908"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219387908" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219387908">(Dec 09 2020 at 19:43)</a>:</h4>
<p>probably cmake but yeah one of those</p>



<a name="219387925"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219387925" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219387925">(Dec 09 2020 at 19:44)</a>:</h4>
<p>well, cmake would also be bad ;-)</p>



<a name="219388069"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219388069" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219388069">(Dec 09 2020 at 19:44)</a>:</h4>
<div class="codehilite"><pre><span></span><code>% file $(which make)
/usr/bin/make: Mach-O universal binary with 2 architectures: [x86_64:Mach-O 64-bit executable x86_64] [arm64e:Mach-O 64-bit executable arm64e]
/usr/bin/make (for architecture x86_64):        Mach-O 64-bit executable x86_64
/usr/bin/make (for architecture arm64e):        Mach-O 64-bit executable arm64e

% file $(which cmake)
/Users/shepmaster/bin/cmake: Mach-O 64-bit executable x86_64
</code></pre></div>



<a name="219388136"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219388136" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219388136">(Dec 09 2020 at 19:45)</a>:</h4>
<p>I can also work around it by specifying a shim <code>cc</code> that switches back to the arm64 <code>cc</code></p>



<a name="219388203"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219388203" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219388203">(Dec 09 2020 at 19:45)</a>:</h4>
<p>But I'm guessing that llvm-config is the only LLVM binary created / we care about.</p>



<a name="219388259"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219388259" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219388259">(Dec 09 2020 at 19:46)</a>:</h4>
<p>Until I try to use bugpoint or llc in a week or two.</p>



<a name="219396486"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219396486" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219396486">(Dec 09 2020 at 20:56)</a>:</h4>
<p>So, as requested:</p>
<div class="codehilite"><pre><span></span><code>% ../x.py build
Build completed successfully in 0:10:54
</code></pre></div>



<a name="219396982"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219396982" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219396982">(Dec 09 2020 at 21:00)</a>:</h4>
<p>that is a <em>fast</em> computer, wow <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="219397035"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219397035" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219397035">(Dec 09 2020 at 21:00)</a>:</h4>
<p>That doesn't count LLVM, FWIW.</p>



<a name="219397352"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219397352" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219397352">(Dec 09 2020 at 21:03)</a>:</h4>
<blockquote>
<p>the line you're looking for is 'Building stage 2 artifacts'</p>
</blockquote>
<p>This line does not occur in the build command I was instructed to run.</p>



<a name="219398045"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219398045" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219398045">(Dec 09 2020 at 21:08)</a>:</h4>
<p>oh I probably got the numbering wrong lol</p>



<a name="219398068"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219398068" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219398068">(Dec 09 2020 at 21:08)</a>:</h4>
<p>do you see 'building stage 0 artifacts' and 'building stage 1 artifacts'?</p>



<a name="219399720"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219399720" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219399720">(Dec 09 2020 at 21:21)</a>:</h4>
<p>Not exactly, no.</p>
<div class="codehilite"><pre><span></span><code>Building stage0 std artifacts (aarch64-apple-darwin -&gt; aarch64-apple-darwin)
    Finished release [optimized] target(s) in 29.90s

Building stage0 compiler artifacts (aarch64-apple-darwin -&gt; aarch64-apple-darwin)
    Finished release [optimized] target(s) in 8m 33s

Building stage1 std artifacts (aarch64-apple-darwin -&gt; aarch64-apple-darwin)
    Finished release [optimized] target(s) in 32.76s
</code></pre></div>



<a name="219401150"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219401150" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219401150">(Dec 09 2020 at 21:31)</a>:</h4>
<p>well that explains why it didn't take very long - try <code>x.py build --stage 2</code></p>



<a name="219401208"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219401208" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219401208">(Dec 09 2020 at 21:32)</a>:</h4>
<p>default stages strike again <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span></p>



<a name="219401257"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219401257" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219401257">(Dec 09 2020 at 21:32)</a>:</h4>
<p>8 minutes is still really fast though</p>



<a name="219404469"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219404469" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219404469">(Dec 09 2020 at 21:55)</a>:</h4>
<p>Is <code>x.py clean</code> the right way to get things reset between runs?  Now I'm tempted to try it.</p>



<a name="219404541"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219404541" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219404541">(Dec 09 2020 at 21:56)</a>:</h4>
<p>you shouldn't need to run clean at all, x.py knows it needs to invalidate the cache when you change the config</p>



<a name="219404692"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219404692" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219404692">(Dec 09 2020 at 21:57)</a>:</h4>
<div class="codehilite"><pre><span></span><code>Building stage1 compiler artifacts (aarch64-apple-darwin -&gt; aarch64-apple-darwin)
    Finished release [optimized] target(s) in 9m 05s
</code></pre></div>



<a name="219404717"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219404717" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219404717">(Dec 09 2020 at 21:58)</a>:</h4>
<p>no go fast :-(</p>



<a name="219404792"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219404792" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219404792">(Dec 09 2020 at 21:58)</a>:</h4>
<p>right, now try with <code>RUSTFLAGS_NOT_BOOTSTRAP=-Zthreads=16</code></p>



<a name="219404799"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219404799" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219404799">(Dec 09 2020 at 21:58)</a>:</h4>
<p>or however many cores you have</p>



<a name="219404829"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219404829" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219404829">(Dec 09 2020 at 21:58)</a>:</h4>
<p>(physical core or hyperthreads?)</p>



<a name="219404833"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219404833" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219404833">(Dec 09 2020 at 21:58)</a>:</h4>
<p>That's a tricky question for big.LITTLE machines :-)</p>



<a name="219404853"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219404853" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219404853">(Dec 09 2020 at 21:59)</a>:</h4>
<p>not sure, however many you normally run <code>-j</code> with</p>



<a name="219404913"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219404913" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219404913">(Dec 09 2020 at 21:59)</a>:</h4>
<p>probably hyperthreads?</p>



<a name="219408894"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219408894" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219408894">(Dec 09 2020 at 22:30)</a>:</h4>
<p>You almost always want to treat hyperthreads as CPUs, yeah.</p>



<a name="219408912"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219408912" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219408912">(Dec 09 2020 at 22:30)</a>:</h4>
<p>For parallel compilation you definitely do.</p>



<a name="219408952"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219408952" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219408952">(Dec 09 2020 at 22:31)</a>:</h4>
<p>Oh, right, because they'll so often be waiting on hashtable memory or whatever anyway</p>



<a name="219409742"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219409742" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219409742">(Dec 09 2020 at 22:38)</a>:</h4>
<p>Hmm, my "stage1 compiler artifacts" time was only 0.1 Np faster with upping the -Zthreads :(</p>



<a name="219410070"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219410070" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219410070">(Dec 09 2020 at 22:41)</a>:</h4>
<p><span class="user-mention" data-user-id="125270">@scottmcm</span> are you sure you set parallel-compiler = true? how many threads was it set to before?</p>



<a name="219410186"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219410186" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219410186">(Dec 09 2020 at 22:42)</a>:</h4>
<p>Whatever the default is.  parallel-compiler=true is definitely set, since it got slower when I set that.</p>
<p>Hmm, I might be setting it wrong.  16 vs 32 didn't make a material difference; I'll try 1, which ought to matter.</p>



<a name="219410358"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219410358" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219410358">(Dec 09 2020 at 22:44)</a>:</h4>
<p>if you have 16 cores I would expect bumping the threads past that not to have much effect</p>



<a name="219411364"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219411364" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> andjo403 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219411364">(Dec 09 2020 at 22:53)</a>:</h4>
<p>think that I remember that last time this was tested -Zthreads set to more then 4 did not give that good results, sometimes even longer compile time then default</p>



<a name="219411611"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219411611" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219411611">(Dec 09 2020 at 22:54)</a>:</h4>
<p>4m 10s vs 3m 42s between 1 and 16 threads, assuming I set things properly <span aria-label="shrug" class="emoji emoji-1f937" role="img" title="shrug">:shrug:</span></p>
<p>EDIT: And about the same for 4.  Maybe I'm just setting it wrong -- I'm on windows so something might be weird.</p>



<a name="219411681"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219411681" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219411681">(Dec 09 2020 at 22:55)</a>:</h4>
<p>You might try some intermediate points like 4 or 8. But there may be a scaling issue still.</p>



<a name="219422975"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20parallel-rustc%20enabled%20by%20default%3F/near/219422975" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20parallel-rustc.20enabled.20by.20default.3F.html#219422975">(Dec 10 2020 at 01:29)</a>:</h4>
<div class="codehilite"><pre><span></span><code>RUSTFLAGS_NOT_BOOTSTRAP=-Zthreads=8 ../x.py build --stage 2

Building stage1 std artifacts (aarch64-apple-darwin -&gt; aarch64-apple-darwin)
    Finished release [optimized] target(s) in 26.74s

Building stage1 compiler artifacts (aarch64-apple-darwin -&gt; aarch64-apple-darwin)
    Finished release [optimized] target(s) in 9m 04s
</code></pre></div>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>