<html>
<head><meta charset="utf-8"><title>cfg an included feature gate? · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cfg.20an.20included.20feature.20gate.3F.html">cfg an included feature gate?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="266477431"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cfg%20an%20included%20feature%20gate%3F/near/266477431" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rodzilla <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cfg.20an.20included.20feature.20gate.3F.html#266477431">(Dec 31 2021 at 03:07)</a>:</h4>
<p>If I have the following setup in my Cargo.toml file:</p>
<div class="codehilite" data-code-language="TOML"><pre><span></span><code><span class="k">[features]</span>
<span class="n">feature_a</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">feature_b</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">combined_a</span> <span class="o">=</span> <span class="p">[</span><span class="s">"feature_a"</span><span class="p">,</span> <span class="s">"some_dependency"</span><span class="p">]</span>
<span class="n">combined_b</span> <span class="o">=</span> <span class="p">[</span><span class="s">"feature_b"</span><span class="p">,</span> <span class="s">"some_other_dependency"</span><span class="p">]</span>

<span class="k">[dependencies]</span>
<span class="n">some_dependency</span> <span class="o">=</span> <span class="s">"version 1.0"</span>
<span class="n">some_other_dependency</span> <span class="o">=</span> <span class="s">"version 1.0"</span>
</code></pre></div>
<p>and then if I run the application with <code>--features combined_a</code> then <code>#[cfg(feature = "feature_a")] </code> does not get picked up in my source code, only <code>#[cfg(feature = "combined_a")]</code>.<br>
Is there some way to let my source code know that it should recognize that when <code>combined_a</code> is used, cfg's for feature_a should be recognized as well?</p>



<a name="266479633"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cfg%20an%20included%20feature%20gate%3F/near/266479633" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cfg.20an.20included.20feature.20gate.3F.html#266479633">(Dec 31 2021 at 04:04)</a>:</h4>
<p>A depended-on feature <em>should</em> get enabled like that. Investigating...</p>



<a name="266479733"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cfg%20an%20included%20feature%20gate%3F/near/266479733" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cfg.20an.20included.20feature.20gate.3F.html#266479733">(Dec 31 2021 at 04:07)</a>:</h4>
<p><span class="user-mention" data-user-id="463151">@rodzilla</span> I just wrote a quick test crate and confirmed that <code>cargo run --features combined_a</code> does enable an item with attribute <code>#[cfg(feature = "feature_a")]</code>.</p>



<a name="266479787"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cfg%20an%20included%20feature%20gate%3F/near/266479787" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cfg.20an.20included.20feature.20gate.3F.html#266479787">(Dec 31 2021 at 04:08)</a>:</h4>
<p>Cargo.toml:</p>
<div class="codehilite" data-code-language="TOML"><pre><span></span><code><span class="k">[package]</span>
<span class="n">name</span> <span class="o">=</span> <span class="s">"foo"</span>
<span class="n">version</span> <span class="o">=</span> <span class="s">"0.1.0"</span>
<span class="n">edition</span> <span class="o">=</span> <span class="s">"2021"</span>

<span class="k">[dependencies]</span>
<span class="n">some_dependency</span> <span class="o">=</span> <span class="p">{</span> <span class="n">package</span> <span class="o">=</span> <span class="s">"anyhow"</span><span class="p">,</span> <span class="n">version</span> <span class="o">=</span> <span class="s">"*"</span><span class="p">,</span> <span class="n">optional</span> <span class="o">=</span> <span class="n">true</span> <span class="p">}</span>

<span class="k">[features]</span>
<span class="n">feature_a</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">feature_b</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">combined_a</span> <span class="o">=</span> <span class="p">[</span><span class="s">"feature_a"</span><span class="p">,</span> <span class="s">"some_dependency"</span><span class="p">]</span>
</code></pre></div>
<p>src/main.rs:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#[cfg(feature = </span><span class="s">"feature_a"</span><span class="cp">)]</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"feature_a is enabled"</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="cp">#[cfg(not(feature = </span><span class="s">"feature_a"</span><span class="cp">))]</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"feature_a is not enabled"</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">func</span><span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="266479795"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cfg%20an%20included%20feature%20gate%3F/near/266479795" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cfg.20an.20included.20feature.20gate.3F.html#266479795">(Dec 31 2021 at 04:09)</a>:</h4>
<div class="codehilite"><pre><span></span><code>$ cargo run
    Updating crates.io index
   Compiling foo v0.1.0 (/tmp/foo)
    Finished dev [unoptimized + debuginfo] target(s) in 2.94s
     Running `target/debug/foo`
feature_a is not enabled
$ cargo run --features combined_a
  Downloaded anyhow v1.0.52
  Downloaded 1 crate (44.2 KB) in 0.29s
   Compiling anyhow v1.0.52
   Compiling foo v0.1.0 (/tmp/foo)
    Finished dev [unoptimized + debuginfo] target(s) in 1.03s
     Running `target/debug/foo`
feature_a is enabled
</code></pre></div>



<a name="266481011"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cfg%20an%20included%20feature%20gate%3F/near/266481011" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rodzilla <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cfg.20an.20included.20feature.20gate.3F.html#266481011">(Dec 31 2021 at 04:40)</a>:</h4>
<p>Well wtf. Clearly I’ve screwed up somewhere. Thanks for confirming that <span class="user-mention" data-user-id="239881">@Josh Triplett</span> <br>
I’ll go hunt down what I’m doing wrong and report back to the group what silliness ensued on my behalf.  Thanks again!</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>