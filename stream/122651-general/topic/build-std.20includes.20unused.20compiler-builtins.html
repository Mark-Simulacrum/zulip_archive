<html>
<head><meta charset="utf-8"><title>build-std includes unused compiler-builtins · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/build-std.20includes.20unused.20compiler-builtins.html">build-std includes unused compiler-builtins</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="276433510"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/build-std%20includes%20unused%20compiler-builtins/near/276433510" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Denton <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/build-std.20includes.20unused.20compiler-builtins.html#276433510">(Mar 24 2022 at 05:16)</a>:</h4>
<p>I'm trying to use Cargo's build-std feature to build a minimal staticlib. It works great for the most part except that it appears to include a lot of compiler_builtins, regardless of if they're used or not. For example, I'm seeing symbols for float operations but I'm not using any floats.</p>
<p>Is there any way to exclude unused builtins?</p>



<a name="276435676"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/build-std%20includes%20unused%20compiler-builtins/near/276435676" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tm <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/build-std.20includes.20unused.20compiler-builtins.html#276435676">(Mar 24 2022 at 06:01)</a>:</h4>
<p>The following might help:</p>
<div class="codehilite" data-code-language="TOML"><pre><span></span><code><span class="k">[profile.release.package.compiler_builtins]</span><span class="w"></span>
<span class="n">debug-assertions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="w"></span>
<span class="n">overflow-checks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="w"></span>
<span class="n">codegen-units</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10000</span><span class="w"></span>
</code></pre></div>



<a name="276436573"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/build-std%20includes%20unused%20compiler-builtins/near/276436573" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Denton <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/build-std.20includes.20unused.20compiler-builtins.html#276436573">(Mar 24 2022 at 06:20)</a>:</h4>
<p>Hm, that did split up the compiler_builtins into separate object files but they all ended up getting linked into the final staticlib.</p>



<a name="276437638"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/build-std%20includes%20unused%20compiler-builtins/near/276437638" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/build-std.20includes.20unused.20compiler-builtins.html#276437638">(Mar 24 2022 at 06:44)</a>:</h4>
<p>That is fine. Archive members are only extracted if they are used in the first place.</p>



<a name="276437882"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/build-std%20includes%20unused%20compiler-builtins/near/276437882" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Denton <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/build-std.20includes.20unused.20compiler-builtins.html#276437882">(Mar 24 2022 at 06:50)</a>:</h4>
<p>That is indeed better. The unused bits do greatly increases the size of the lib. Though I gueas it's not a lot in the grand scheme of things.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>