<html>
<head><meta charset="utf-8"><title>`&amp;mut` in const · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60.26mut.60.20in.20const.html">`&amp;mut` in const</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="180954619"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60%26mut%60%20in%20const/near/180954619" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60.26mut.60.20in.20const.html#180954619">(Nov 17 2019 at 11:49)</a>:</h4>
<blockquote>
<p>doing this "right" is blocked on <code>&amp;mut</code>-in-const</p>
</blockquote>
<p>cc <span class="user-mention" data-user-id="132916">@Christian Poveda</span> fun coincidence</p>



<a name="180957401"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60%26mut%60%20in%20const/near/180957401" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christian Poveda <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60.26mut.60.20in.20const.html#180957401">(Nov 17 2019 at 13:14)</a>:</h4>
<p>I'll get this done ASAP</p>



<a name="180958094"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60%26mut%60%20in%20const/near/180958094" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60.26mut.60.20in.20const.html#180958094">(Nov 17 2019 at 13:37)</a>:</h4>
<p>There's no rush! I just found it funny</p>



<a name="180958136"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60%26mut%60%20in%20const/near/180958136" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60.26mut.60.20in.20const.html#180958136">(Nov 17 2019 at 13:38)</a>:</h4>
<p>Also I forgot to link to the post: <a href="#narrow/stream/122651-general/topic/const.20fn.20wishlist/near/180904827" title="#narrow/stream/122651-general/topic/const.20fn.20wishlist/near/180904827">https://rust-lang.zulipchat.com/#narrow/stream/122651-general/topic/const.20fn.20wishlist/near/180904827</a></p>



<a name="180959834"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60%26mut%60%20in%20const/near/180959834" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christian Poveda <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60.26mut.60.20in.20const.html#180959834">(Nov 17 2019 at 14:38)</a>:</h4>
<p>does this feature has an RFC or something?</p>



<a name="180959836"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60%26mut%60%20in%20const/near/180959836" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christian Poveda <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60.26mut.60.20in.20const.html#180959836">(Nov 17 2019 at 14:38)</a>:</h4>
<p>to give it a proper name</p>



<a name="180961336"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60%26mut%60%20in%20const/near/180961336" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60.26mut.60.20in.20const.html#180961336">(Nov 17 2019 at 15:26)</a>:</h4>
<p>nope</p>



<a name="180961337"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60%26mut%60%20in%20const/near/180961337" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60.26mut.60.20in.20const.html#180961337">(Nov 17 2019 at 15:26)</a>:</h4>
<p><code>const_mut_refs</code> or sth</p>



<a name="180961341"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60%26mut%60%20in%20const/near/180961341" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60.26mut.60.20in.20const.html#180961341">(Nov 17 2019 at 15:26)</a>:</h4>
<p>idk, be creative :D</p>



<a name="180963352"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60%26mut%60%20in%20const/near/180963352" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christian Poveda <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60.26mut.60.20in.20const.html#180963352">(Nov 17 2019 at 16:32)</a>:</h4>
<p>unleash-the-const-mut-ref-inside-you?</p>



<a name="180963353"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60%26mut%60%20in%20const/near/180963353" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christian Poveda <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60.26mut.60.20in.20const.html#180963353">(Nov 17 2019 at 16:32)</a>:</h4>
<p>:P</p>



<a name="180996723"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60%26mut%60%20in%20const/near/180996723" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60.26mut.60.20in.20const.html#180996723">(Nov 18 2019 at 08:42)</a>:</h4>
<p>heh</p>



<a name="181007558"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60%26mut%60%20in%20const/near/181007558" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christian Poveda <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60.26mut.60.20in.20const.html#181007558">(Nov 18 2019 at 11:31)</a>:</h4>
<p>I'll submit a PR later today</p>



<a name="181013144"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60%26mut%60%20in%20const/near/181013144" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christian Poveda <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60.26mut.60.20in.20const.html#181013144">(Nov 18 2019 at 12:59)</a>:</h4>
<p>where should the tests go?</p>



<a name="181017195"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60%26mut%60%20in%20const/near/181017195" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60.26mut.60.20in.20const.html#181017195">(Nov 18 2019 at 13:58)</a>:</h4>
<p>mir-opt</p>



<a name="181017209"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60%26mut%60%20in%20const/near/181017209" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60.26mut.60.20in.20const.html#181017209">(Nov 18 2019 at 13:58)</a>:</h4>
<p>I'd wager some mir opt tests will be affected even without you adding a test</p>



<a name="181017221"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60%26mut%60%20in%20const/near/181017221" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60.26mut.60.20in.20const.html#181017221">(Nov 18 2019 at 13:59)</a>:</h4>
<p>if that is the case... just don't add a test</p>



<a name="181017230"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60%26mut%60%20in%20const/near/181017230" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60.26mut.60.20in.20const.html#181017230">(Nov 18 2019 at 13:59)</a>:</h4>
<p>the other tests are covering you</p>



<a name="181017238"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60%26mut%60%20in%20const/near/181017238" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60.26mut.60.20in.20const.html#181017238">(Nov 18 2019 at 13:59)</a>:</h4>
<p>unfortunately these tests don't know about <code>--bless</code></p>



<a name="181017243"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60%26mut%60%20in%20const/near/181017243" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60.26mut.60.20in.20const.html#181017243">(Nov 18 2019 at 13:59)</a>:</h4>
<p>so they are a pain to adjust</p>



<a name="181022445"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60%26mut%60%20in%20const/near/181022445" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christian Poveda <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60.26mut.60.20in.20const.html#181022445">(Nov 18 2019 at 14:59)</a>:</h4>
<p>also using the <code>const_fn</code> feature allows to use <code>&amp;mut</code> in const fns. So currently the error indicates that the user should enable the<code>const_fn</code>feature</p>



<a name="181022464"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60%26mut%60%20in%20const/near/181022464" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christian Poveda <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60.26mut.60.20in.20const.html#181022464">(Nov 18 2019 at 14:59)</a>:</h4>
<p>should I change it so it suggests to enable the new feature?</p>



<a name="181025143"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60%26mut%60%20in%20const/near/181025143" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christian Poveda <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60.26mut.60.20in.20const.html#181025143">(Nov 18 2019 at 15:27)</a>:</h4>
<blockquote>
<p>I'd wager some mir opt tests will be affected even without you adding a test</p>
</blockquote>
<p>none of the tests in <code>./x.py test --stage 1 src/test/mir-opt/</code> failed</p>



<a name="181097159"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60%26mut%60%20in%20const/near/181097159" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60.26mut.60.20in.20const.html#181097159">(Nov 19 2019 at 10:09)</a>:</h4>
<p><span aria-label="face palm" class="emoji emoji-1f926" role="img" title="face palm">:face_palm:</span> oh, sorry I didn't read the thread topic, yea you should add some tests in <code>src/test/ui/consts</code></p>



<a name="181102898"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60%26mut%60%20in%20const/near/181102898" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> centril <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60.26mut.60.20in.20const.html#181102898">(Nov 19 2019 at 11:31)</a>:</h4>
<p>(in a subdirectory please, not immediately in the <code>ui/consts/</code>)</p>



<a name="181123303"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60%26mut%60%20in%20const/near/181123303" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christian Poveda <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60.26mut.60.20in.20const.html#181123303">(Nov 19 2019 at 15:42)</a>:</h4>
<p>and those should be the tests checking that the feature works right?</p>



<a name="181123333"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60%26mut%60%20in%20const/near/181123333" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christian Poveda <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60.26mut.60.20in.20const.html#181123333">(Nov 19 2019 at 15:42)</a>:</h4>
<p>(not the test checking that using this is forbidden without the gate)</p>



<a name="181199164"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60%26mut%60%20in%20const/near/181199164" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60.26mut.60.20in.20const.html#181199164">(Nov 20 2019 at 11:37)</a>:</h4>
<p>yes</p>



<a name="181305806"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60%26mut%60%20in%20const/near/181305806" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christian Poveda <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60.26mut.60.20in.20const.html#181305806">(Nov 21 2019 at 13:53)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/issues/66556" target="_blank" title="https://github.com/rust-lang/rust/issues/66556">https://github.com/rust-lang/rust/issues/66556</a></p>



<a name="181305832"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60%26mut%60%20in%20const/near/181305832" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christian Poveda <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60.26mut.60.20in.20const.html#181305832">(Nov 21 2019 at 13:53)</a>:</h4>
<p>Oh shoo, I forgot about tidy</p>



<a name="181305847"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60%26mut%60%20in%20const/near/181305847" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christian Poveda <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60.26mut.60.20in.20const.html#181305847">(Nov 21 2019 at 13:53)</a>:</h4>
<p>does this have an open issue?</p>



<a name="181305912"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60%26mut%60%20in%20const/near/181305912" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christian Poveda <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60.26mut.60.20in.20const.html#181305912">(Nov 21 2019 at 13:54)</a>:</h4>
<div class="codehilite"><pre><span></span>tidy check
* 588 error codes
* highest error code: E0744
tidy error: /home/christian/Workspace/contrib/rust/src/libsyntax/feature_gate/active.rs:533: no tracking issue for feature const_fn_mut_refs
Checking which error codes lack tests...
Found 441 error codes
Found 0 error codes with no tests
Done!
some tidy checks failed
</pre></div>



<a name="181307095"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60%26mut%60%20in%20const/near/181307095" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60.26mut.60.20in.20const.html#181307095">(Nov 21 2019 at 14:08)</a>:</h4>
<p>idk, check the const fn meta issue, and if there's no issue for mutable references, you can open one and point to it from the meta issue</p>



<a name="181307328"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60%26mut%60%20in%20const/near/181307328" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> centril <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60.26mut.60.20in.20const.html#181307328">(Nov 21 2019 at 14:10)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/issues/57349" target="_blank" title="https://github.com/rust-lang/rust/issues/57349">https://github.com/rust-lang/rust/issues/57349</a></p>



<a name="181603900"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60%26mut%60%20in%20const/near/181603900" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christian Poveda <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60.26mut.60.20in.20const.html#181603900">(Nov 22 2019 at 01:53)</a>:</h4>
<p>Hmm now I'm a little confused about what to do with assignments like <code>*x = y</code>. Not allowing them restricts a lot what can be done with mutable references but I'm not sure about all the implications of allowing them.</p>



<a name="181603986"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60%26mut%60%20in%20const/near/181603986" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christian Poveda <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60.26mut.60.20in.20const.html#181603986">(Nov 22 2019 at 01:55)</a>:</h4>
<p>I mean, without them we can still do stuff like:</p>
<div class="codehilite"><pre><span></span><span class="k">const</span><span class="w"> </span><span class="k">fn</span> <span class="nf">bar</span><span class="p">(</span><span class="n">foo</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">Foo</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">usize</span> <span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">x</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">x</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>



<a name="181636351"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60%26mut%60%20in%20const/near/181636351" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60.26mut.60.20in.20const.html#181636351">(Nov 22 2019 at 13:19)</a>:</h4>
<p>yea, <code>*x = y</code> should be under the same feature gate</p>



<a name="181641367"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60%26mut%60%20in%20const/near/181641367" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christian Poveda <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60.26mut.60.20in.20const.html#181641367">(Nov 22 2019 at 14:17)</a>:</h4>
<p>Ok</p>



<a name="181654062"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60%26mut%60%20in%20const/near/181654062" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christian Poveda <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60.26mut.60.20in.20const.html#181654062">(Nov 22 2019 at 16:32)</a>:</h4>
<p>what should I do with the broken <code>unleash-the-miri-inside-of-you</code> tests?</p>



<a name="181686303"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60%26mut%60%20in%20const/near/181686303" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christian Poveda <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60.26mut.60.20in.20const.html#181686303">(Nov 22 2019 at 23:12)</a>:</h4>
<blockquote>
<p>yea, <code>*x = y</code> should be under the same feature gate</p>
</blockquote>
<p>Also, I'm thorn about how mutable borrows should behave outside constant contexts. So for example</p>
<div class="codehilite"><pre><span></span><span class="k">struct</span> <span class="nc">Foo</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">x</span>: <span class="kt">usize</span>
<span class="p">}</span><span class="w"></span>

<span class="k">const</span><span class="w"> </span><span class="k">fn</span> <span class="nf">bar</span><span class="p">(</span><span class="n">foo</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">Foo</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">usize</span> <span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">x</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="o">*</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="o">*</span><span class="n">x</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">_</span>: <span class="p">[();</span><span class="w"> </span><span class="n">bar</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">Foo</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span>: <span class="mi">0</span><span class="w"> </span><span class="p">})]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[();</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>


<p>Will work after enabling mutable dereferences. But at the same time stuff like</p>
<div class="codehilite"><pre><span></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">FOO</span>: <span class="nc">Foo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Foo</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span>: <span class="mi">0</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
<span class="w">    </span><span class="n">bar</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">FOO</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="n">FOO</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>


<p>will succeed because mutation only happens inside constants. Is that OK?</p>



<a name="181687110"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60%26mut%60%20in%20const/near/181687110" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> centril <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60.26mut.60.20in.20const.html#181687110">(Nov 22 2019 at 23:26)</a>:</h4>
<p>The second <code>fn main</code> example looks correct. The final value of a constant is frozen/immutable - it would be unsound if you could actually make the value <code>FOO.x == 1</code></p>



<a name="181692076"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60%26mut%60%20in%20const/near/181692076" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christian Poveda <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60.26mut.60.20in.20const.html#181692076">(Nov 23 2019 at 00:59)</a>:</h4>
<p>ok then, I'll push the changes.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>