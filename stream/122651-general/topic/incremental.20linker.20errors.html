<html>
<head><meta charset="utf-8"><title>incremental linker errors · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/incremental.20linker.20errors.html">incremental linker errors</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://rust-lang.github.io/zulip_archive/style.css" rel="stylesheet"></head>

<a name="194431762"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/incremental%20linker%20errors/near/194431762" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/incremental.20linker.20errors.html#194431762">(Apr 17 2020 at 12:28)</a>:</h4>
<p>I currently run <code>./x.py test src/test/ui --stage 1</code> with incremental set to <code>true</code>.</p>
<p>Compilation of state <code>1</code> currently fails with :</p>
<div class="codehilite"><pre><span></span><span class="o">**</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">ld</span>: <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">programming</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">stage0</span><span class="o">-</span><span class="n">rustc</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">deps</span><span class="o">/</span><span class="n">rustc_driver</span><span class="o">-</span><span class="mi">4</span><span class="n">b7368d0b3ef4ef3</span><span class="p">.</span><span class="n">ec335kezqqkxkzb</span><span class="p">.</span><span class="n">rcgu</span><span class="p">.</span><span class="n">o</span>: <span class="nc">in</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="err">`</span><span class="o">&lt;</span><span class="n">T</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">rustc_query_system</span>::<span class="n">dep_graph</span>::<span class="n">dep_node</span>::<span class="n">DepNodeParams</span><span class="o">&lt;</span><span class="n">Ctxt</span><span class="o">&gt;&gt;</span>::<span class="n">to_fingerprint</span><span class="err">&#39;</span>:
          <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">programming</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">librustc_query_system</span><span class="o">/</span><span class="n">dep_graph</span><span class="o">/</span><span class="n">dep_node</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">111</span>: <span class="nc">undefined</span><span class="w"> </span><span class="n">reference</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="err">`</span><span class="n">rustc_data_structures</span>::<span class="n">stable_hasher</span>::<span class="n">StableHasher</span>::<span class="n">finish</span><span class="err">&#39;</span><span class="w"></span>
<span class="w">          </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">ld</span>: <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">rustc8N4mne</span><span class="o">/</span><span class="n">librustc_metadata</span><span class="o">-</span><span class="mi">1</span><span class="n">a1dc83ff22fdc9d</span><span class="p">.</span><span class="n">rlib</span><span class="p">(</span><span class="n">rustc_metadata</span><span class="o">-</span><span class="mi">1</span><span class="n">a1dc83ff22fdc9d</span><span class="p">.</span><span class="mi">4</span><span class="n">aiayopt0r9irehb</span><span class="p">.</span><span class="n">rcgu</span><span class="p">.</span><span class="n">o</span><span class="p">)</span>: <span class="nc">in</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="err">`</span><span class="o">&lt;</span><span class="n">T</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">rustc_query_system</span>::<span class="n">dep_graph</span>::<span class="n">dep_node</span>::<span class="n">DepNodeParams</span><span class="o">&lt;</span><span class="n">Ctxt</span><span class="o">&gt;&gt;</span>::<span class="n">to_fingerprint</span><span class="err">&#39;</span>:
          <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">programming</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">librustc_query_system</span><span class="o">/</span><span class="n">dep_graph</span><span class="o">/</span><span class="n">dep_node</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">111</span>: <span class="nc">undefined</span><span class="w"> </span><span class="n">reference</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="err">`</span><span class="n">rustc_data_structures</span>::<span class="n">stable_hasher</span>::<span class="n">StableHasher</span>::<span class="n">finish</span><span class="err">&#39;</span><span class="w"></span>
<span class="w">          </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">ld</span>: <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">programming</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">stage0</span><span class="o">-</span><span class="n">rustc</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">deps</span><span class="o">/</span><span class="n">librustc_driver</span><span class="o">-</span><span class="mi">4</span><span class="n">b7368d0b3ef4ef3</span><span class="p">.</span><span class="n">so</span>: <span class="nc">hidden</span><span class="w"> </span><span class="n">symbol</span><span class="w"> </span><span class="err">`</span><span class="n">_ZN21rustc_data_structures13stable_hasher12StableHasher6finish17hf220c72329c4c00cE</span><span class="err">&#39;</span><span class="w"> </span><span class="n">isn</span><span class="na">&#39;t</span><span class="w"> </span><span class="n">defined</span><span class="w"></span>
<span class="w">          </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">ld</span>: <span class="nc">final</span><span class="w"> </span><span class="n">link</span><span class="w"> </span><span class="n">failed</span>: <span class="nc">bad</span><span class="w"> </span><span class="n">value</span><span class="w"></span>
<span class="w">          </span><span class="n">collect2</span>: <span class="nc">error</span>: <span class="nc">ld</span><span class="w"> </span><span class="n">returned</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">exit</span><span class="w"> </span><span class="n">status</span><span class="o">**</span><span class="w"></span>
</pre></div>


<p>Is this a known issue?</p>



<a name="194463517"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/incremental%20linker%20errors/near/194463517" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/incremental.20linker.20errors.html#194463517">(Apr 17 2020 at 16:07)</a>:</h4>
<p><span class="user-mention" data-user-id="216206">@Bastian Kauschke</span> no, that's strange. it works for me.</p>



<a name="194463587"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/incremental%20linker%20errors/near/194463587" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/incremental.20linker.20errors.html#194463587">(Apr 17 2020 at 16:07)</a>:</h4>
<p>could your incremental cache be broken? you could try deleting the <code>build/stage*</code> dirs to rebuild that.</p>



<a name="194463613"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/incremental%20linker%20errors/near/194463613" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/incremental.20linker.20errors.html#194463613">(Apr 17 2020 at 16:08)</a>:</h4>
<p>It is fixed after <code>./x.py clean</code></p>



<a name="194463712"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/incremental%20linker%20errors/near/194463712" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/incremental.20linker.20errors.html#194463712">(Apr 17 2020 at 16:08)</a>:</h4>
<blockquote>
<p>could your incremental cache be broken?</p>
</blockquote>
<p>I think so</p>



<a name="194463721"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/incremental%20linker%20errors/near/194463721" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/incremental.20linker.20errors.html#194463721">(Apr 17 2020 at 16:08)</a>:</h4>
<p>maybe I dont see it because I tend to aggressively <code>clean</code></p>



<a name="194464906"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/incremental%20linker%20errors/near/194464906" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/incremental.20linker.20errors.html#194464906">(Apr 17 2020 at 16:18)</a>:</h4>
<p>how long does a clean build take for you? <span aria-label="ping pong" class="emoji emoji-1f3d3" role="img" title="ping pong">:ping_pong:</span></p>



<a name="194466625"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/incremental%20linker%20errors/near/194466625" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/incremental.20linker.20errors.html#194466625">(Apr 17 2020 at 16:32)</a>:</h4>
<p>stage 1? hm, I think around 20min... plus 30min extra if it needs to build LLVM</p>



<a name="194466663"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/incremental%20linker%20errors/near/194466663" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/incremental.20linker.20errors.html#194466663">(Apr 17 2020 at 16:32)</a>:</h4>
<p>by "aggressively" I mean I clean when switching branches or pulling</p>



<a name="194466695"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/incremental%20linker%20errors/near/194466695" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/incremental.20linker.20errors.html#194466695">(Apr 17 2020 at 16:33)</a>:</h4>
<p>basically, when libstd changes, incremental doesnt help anyway, so I clean first and then build</p>



<a name="194466921"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/incremental%20linker%20errors/near/194466921" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/incremental.20linker.20errors.html#194466921">(Apr 17 2020 at 16:35)</a>:</h4>
<blockquote>
<p>stage 1? hm, I think around 20min... plus 30min extra if it needs to build LLVM</p>
</blockquote>
<p>uff, seems like my setup kinda sucks then <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="194467080"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/incremental%20linker%20errors/near/194467080" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/incremental.20linker.20errors.html#194467080">(Apr 17 2020 at 16:36)</a>:</h4>
<blockquote>
<p>by "aggressively" I mean I clean when switching branches or pulling</p>
</blockquote>
<p>Jup, this bug came without any changes to libs though. Just between two builds with slight changes in <code>rustc_middle</code></p>



<a name="194467450"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/incremental%20linker%20errors/near/194467450" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/incremental.20linker.20errors.html#194467450">(Apr 17 2020 at 16:39)</a>:</h4>
<p><span class="user-mention silent" data-user-id="216206">Bastian Kauschke</span> <a href="#narrow/stream/122651-general/topic/incremental.20linker.20errors/near/194467080" title="#narrow/stream/122651-general/topic/incremental.20linker.20errors/near/194467080">said</a>:</p>
<blockquote>
<blockquote>
<p>by "aggressively" I mean I clean when switching branches or pulling</p>
</blockquote>
<p>Jup, this bug came without any changes to libs though. Just between two builds with slight changes in <code>rustc_middle</code></p>
</blockquote>
<p>that should never happen...</p>



<a name="194468522"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/incremental%20linker%20errors/near/194468522" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/incremental.20linker.20errors.html#194468522">(Apr 17 2020 at 16:48)</a>:</h4>
<p>^ that's why I've asked this here :)</p>



<hr><p>Last updated: Aug 07 2021 at 22:04 UTC</p>
</html>