<html>
<head><meta charset="utf-8"><title>Looking for someone on Windows to try code · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Looking.20for.20someone.20on.20Windows.20to.20try.20code.html">Looking for someone on Windows to try code</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="266761072"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Looking%20for%20someone%20on%20Windows%20to%20try%20code/near/266761072" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Poitras <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Looking.20for.20someone.20on.20Windows.20to.20try.20code.html#266761072">(Jan 04 2022 at 01:57)</a>:</h4>
<p>I have some ICE that I've whittled to a minimal example, but it seems to only throw an error in the type checking when it's run on Windows. Can someone on Windows try this and tell me if it ICEs for them as well? (Issue <a href="https://github.com/rust-lang/rust/issues/92537">#92537</a>)</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">mem</span><span class="p">;</span><span class="w"></span>
<span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">marker</span>::<span class="n">PhantomData</span><span class="p">;</span><span class="w"></span>

<span class="k">struct</span> <span class="nc">LazyStack</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="k">impl</span><span class="w"> </span><span class="nb">Drop</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">LazyStack</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">drop</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">g</span>: <span class="o">*</span><span class="k">mut</span><span class="w"> </span><span class="k">dyn</span><span class="w"> </span><span class="nb">FnMut</span><span class="p">(</span><span class="nb">Option</span><span class="o">&lt;</span><span class="n">NodeFactory</span><span class="o">&lt;'</span><span class="nb">_</span><span class="o">&gt;&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Option</span><span class="o">&lt;</span><span class="n">VNode</span><span class="o">&lt;'</span><span class="nb">_</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">            </span><span class="k">unsafe</span><span class="w"> </span><span class="p">{</span><span class="n">make_fat_ptr</span><span class="p">()};</span><span class="w"></span>

<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">clos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">unsafe</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="o">*</span><span class="n">g</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
<span class="w">        </span><span class="n">clos</span><span class="p">(</span><span class="nb">None</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">unsafe</span><span class="w"> </span><span class="k">fn</span> <span class="nf">make_fat_ptr</span><span class="o">&lt;</span><span class="n">T</span>: <span class="o">?</span><span class="nb">Sized</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="o">*</span><span class="k">mut</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">mem</span>::<span class="n">MaybeUninit</span>::<span class="o">&lt;*</span><span class="k">mut</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span>::<span class="n">uninit</span><span class="p">().</span><span class="n">assume_init</span><span class="p">()</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">enum</span> <span class="nc">VNode</span><span class="o">&lt;'</span><span class="na">src</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">Fragment</span><span class="p">(</span><span class="o">&amp;'</span><span class="na">src</span><span class="w"> </span><span class="p">[</span><span class="n">VNode</span><span class="o">&lt;'</span><span class="na">src</span><span class="o">&gt;</span><span class="p">]),</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">struct</span> <span class="nc">NodeFactory</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">_x</span><span class="w"> </span>: <span class="kp">&amp;</span><span class="o">'</span><span class="na">a</span> <span class="nc">PhantomData</span><span class="o">&lt;</span><span class="kt">u32</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LazyStack</span><span class="p">{};</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="266761291"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Looking%20for%20someone%20on%20Windows%20to%20try%20code/near/266761291" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Poitras <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Looking.20for.20someone.20on.20Windows.20to.20try.20code.html#266761291">(Jan 04 2022 at 02:00)</a>:</h4>
<p>If it's only running on some systems and Icing on others, I reckon the problem is in differing implementations of mem for different OSes? Everything else should stay the same across targets?</p>



<a name="266764569"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Looking%20for%20someone%20on%20Windows%20to%20try%20code/near/266764569" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Looking.20for.20someone.20on.20Windows.20to.20try.20code.html#266764569">(Jan 04 2022 at 03:08)</a>:</h4>
<p>I can confirm it only ICEs on Windows.</p>



<a name="266764583"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Looking%20for%20someone%20on%20Windows%20to%20try%20code/near/266764583" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Looking.20for.20someone.20on.20Windows.20to.20try.20code.html#266764583">(Jan 04 2022 at 03:08)</a>:</h4>
<p>hm, msvc only</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>