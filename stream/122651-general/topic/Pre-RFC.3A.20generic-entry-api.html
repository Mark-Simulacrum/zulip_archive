<html>
<head><meta charset="utf-8"><title>Pre-RFC: generic-entry-api · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html">Pre-RFC: generic-entry-api</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="276573257"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276573257" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Boeman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276573257">(Mar 25 2022 at 03:41)</a>:</h4>
<p>Hello! I've been putting together an RFC, and was hoping to get some eyes on it before going ahead and making a PR</p>
<p><a href="https://github.com/maboesanman/rfcs/blob/generic-entry-api/text/0000-generic-entry-api.md">here's the rfc</a></p>
<p>and the quick summary:</p>
<p>There are parallel features for “entries” in <code>std::collections::HashMap</code> and <code>std::collections::BTreeMap</code>, but as of now they are both incomplete and inconsistent. This RFC is an effort to make the two consistent, and to extend the pattern other collections by adding two new traits: <code>OccupiedEntry</code> and <code>VacantEntry</code>, and many more subtraits providing additional specific behaviors that are common among collections.</p>



<a name="276573890"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276573890" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> sgk <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276573890">(Mar 25 2022 at 03:53)</a>:</h4>
<p>Apart from the complexity, my main concern would restricting implementations. And iirc, we are still adding methods to <code>HashMap::Entry</code>.</p>



<a name="276574044"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276574044" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Boeman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276574044">(Mar 25 2022 at 03:56)</a>:</h4>
<p>could you elaborate on "restricting implementations"?</p>



<a name="276575427"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276575427" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Boeman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276575427">(Mar 25 2022 at 04:25)</a>:</h4>
<p>And as for continued efforts on existing entries, the intention is that all current and in progress methods on Entry be ported to the new traits/enums, and made generic where appropriate. Mostly the actual code changes here are defining new traits and moving logic from methods to trait implementations</p>



<a name="276575941"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276575941" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276575941">(Mar 25 2022 at 04:37)</a>:</h4>
<p>My initial feedback is that std is generally light on traits, so adding <em>nine</em> more just for this is something I'd not expect to be accepted.</p>
<p>How critical are all the traits?  Could everything just be concrete instead?  If they're concrete now, is there any reason traits couldn't be added later if so desired?</p>
<p>Also, it seems a shame to have to deprecate so many things.  Telling a substantial fraction of HashMap users to change to a new thing is pretty high impact.</p>



<a name="276576754"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276576754" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276576754">(Mar 25 2022 at 04:59)</a>:</h4>
<p>I'm already grumpy about having to <code>use std::collections::hash_map::Entry</code> in order to use the entry api (which is otherwise very nice). I use the entry API rarely enough that it is usually my first use in the file, so there is added friction in using the method for this reason. None of the other hashmap methods require that, and if everything was in traits I would expect this problem to be much worse.</p>
<p>I'm also not clear on why the  entry API is being deprecated in the first place, if all you are doing is adding another way to access it. (Is that all you are doing? I can't see any new <em>functionality</em> being proposed.)</p>



<a name="276576974"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276576974" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276576974">(Mar 25 2022 at 05:03)</a>:</h4>
<p>Also, why can't this be implemented in a separate library if it's just traits over existing functions? Your MVP implements the traits on <code>DummyHashMap</code> instead of <code>HashMap</code> and I'm not sure why.</p>



<a name="276577949"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276577949" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Boeman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276577949">(Mar 25 2022 at 05:24)</a>:</h4>
<p>You need access to the internals, so it can’t really be an external crate completely. Maybe if the concrete entries had a few more features it would be possible to just implement on top of existing entries as an external crate, which could still be useful.</p>
<p>Is it a breaking change to move a method from a concrete type to a trait impl on that concrete type? I would think yes right?</p>
<p>As far as deprecations go, you’re probably right that this could be lighter touch, but this is really only deprecating the entry methods on HashMap and BTreeMap, as all the other types just support those.</p>



<a name="276578134"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276578134" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Boeman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276578134">(Mar 25 2022 at 05:28)</a>:</h4>
<p>One of the frustrating things about the current design is that so many of the methods on entries return things that might not be expected. I do think if none of the trait stuff makes it in, that the pattern of <code>*_entry</code> returning an entry, <code>*_vacate</code> returning a vacant entry, and <code>*_occupy</code> returning an occupied entry is one that’s worth adding.</p>



<a name="276578354"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276578354" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jak{e,ob} Degen <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276578354">(Mar 25 2022 at 05:33)</a>:</h4>
<p>Yeah, I think that the issue of "entry APIs are inconsistent" is well motivated, but the traits less so. I think a version of this RFC that just proposes a consistent API for Entry types across collections only would be better - we could then experiment with that and re-evaluate the need for traits at that point</p>



<a name="276578709"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276578709" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276578709">(Mar 25 2022 at 05:41)</a>:</h4>
<blockquote>
<p>You need access to the internals, so it can’t really be an external crate completely.</p>
</blockquote>
<p>But the trait would be exposing any such internals, right? So I think one way to cut this PR would be to determine what concrete "internals" you would need to implement the trait hierarchy in an external crate, and propose those instead of the traits themselves</p>



<a name="276578715"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276578715" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Boeman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276578715">(Mar 25 2022 at 05:41)</a>:</h4>
<p>Yeah, I also don’t mind so much having this trait stuff live in a crate. I’ll take some more time this weekend to pare down the changes I feel are important. </p>
<p>By far the biggest thing I have a problem with is this: OccupiedEntries have an optional key, which really confuses the model. They should have no key and the collections should have a get_entry method which takes a borrow&lt;K&gt;, cloning if needed for occupied entries.</p>



<a name="276578865"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276578865" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276578865">(Mar 25 2022 at 05:44)</a>:</h4>
<blockquote>
<p>By far the biggest thing I have a problem with is this: OccupiedEntries have an optional key, which really confuses the model.</p>
</blockquote>
<p>What do you mean by that? <code>key()</code> returns a <code>&amp;K</code> so I don't see how the key could be optional</p>



<a name="276578892"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276578892" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Boeman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276578892">(Mar 25 2022 at 05:44)</a>:</h4>
<p>An occupied entry can own a key which matches the key in the collectikn</p>



<a name="276578899"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276578899" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Boeman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276578899">(Mar 25 2022 at 05:45)</a>:</h4>
<p>That reference is a reference into the collection</p>



<a name="276578971"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276578971" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Boeman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276578971">(Mar 25 2022 at 05:46)</a>:</h4>
<p>Look at the <code>replace_key</code> method. I really don’t like that method as it relies on some key being there from the initial insert</p>



<a name="276579002"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276579002" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276579002">(Mar 25 2022 at 05:47)</a>:</h4>
<p>Right, you had to give it a key when you called <code>entry()</code></p>



<a name="276579016"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276579016" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276579016">(Mar 25 2022 at 05:47)</a>:</h4>
<p>I guess it always has that key though, it's not optional</p>



<a name="276579023"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276579023" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276579023">(Mar 25 2022 at 05:47)</a>:</h4>
<p>and it would be unergonomic to ask for the key twice</p>



<a name="276579090"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276579090" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276579090">(Mar 25 2022 at 05:48)</a>:</h4>
<p>the current API also does not require any cloning of keys. In fact I don't think any of the hashmap API requires K: Clone</p>



<a name="276579131"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276579131" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276579131">(Mar 25 2022 at 05:49)</a>:</h4>
<p>I think that changes here are reasonable but not obviously a win</p>



<a name="276579197"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276579197" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jak{e,ob} Degen <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276579197">(Mar 25 2022 at 05:50)</a>:</h4>
<p><span class="user-mention silent" data-user-id="461427">Mason Boeman</span> <a href="#narrow/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api/near/276578715">said</a>:</p>
<blockquote>
<p>Yeah, I also don’t mind so much having this trait stuff live in a crate. I’ll take some more time this weekend to pare down the changes I feel are important. </p>
<p>By far the biggest thing I have a problem with is this: OccupiedEntries have an optional key, which really confuses the model. They should have no key and the collections should have a get_entry method which takes a borrow&lt;K&gt;, cloning if needed for occupied entries.</p>
</blockquote>
<p>Hmm, right now <code>OccupiedEntry</code>s have a non-optional key. This was almost accidentally changed, but the change was de-stabilized last minute specifically for this reason. What is the problem with the mandatory key on <code>OccupiedEntry</code>?</p>



<a name="276579207"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276579207" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Boeman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276579207">(Mar 25 2022 at 05:51)</a>:</h4>
<p>The point is once you have an occupied entry you don’t need that key. You want two methods: one that takes the key by ownership, searches, and throws the search key away if it doesn’t find anything, and another which takes a borrow of a key, and clones if needed</p>



<a name="276579278"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276579278" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jak{e,ob} Degen <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276579278">(Mar 25 2022 at 05:52)</a>:</h4>
<p><span class="user-mention silent" data-user-id="461427">Mason Boeman</span> <a href="#narrow/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api/near/276579207">said</a>:</p>
<blockquote>
<p>The point is once you have an occupied entry you don’t need that key. You want two methods: one that takes the key by ownership, searches, and throws the search key away if it doesn’t find anything, and another which takes a borrow of a key, and clones if needed</p>
</blockquote>
<p>Neither of these cover the possibility of me deciding later if I want to keep a copy of the key or if the HashMap can have it</p>



<a name="276579318"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276579318" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Boeman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276579318">(Mar 25 2022 at 05:53)</a>:</h4>
<p>In my RFC there is a EntryWithSearchKey enum for this purpose</p>



<a name="276579326"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276579326" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Boeman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276579326">(Mar 25 2022 at 05:53)</a>:</h4>
<p>Or maybe I don’t understand your scenario</p>



<a name="276579415"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276579415" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Boeman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276579415">(Mar 25 2022 at 05:55)</a>:</h4>
<p>You want the key to be used for insertion if vacant, and returned to you if occupied.</p>



<a name="276579483"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276579483" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Boeman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276579483">(Mar 25 2022 at 05:56)</a>:</h4>
<p>Or you want the key to be cloned for vacant</p>



<a name="276579579"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276579579" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jak{e,ob} Degen <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276579579">(Mar 25 2022 at 05:58)</a>:</h4>
<p>Ah, yeah, that is what I meant. I was just responding to the two options you had given in the message, not the RFC itself</p>



<a name="276579613"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276579613" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Boeman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276579613">(Mar 25 2022 at 05:59)</a>:</h4>
<p>If you ignore the collection methods and just look at the entry methods, moving from vacant to occupied is clearly problematic if occupied is required to own a key. You give your vacant entry a value, and it suddenly needs to clone it’s key because it needs to put one owned key in the occupied entry, and another in the collection with the new value.</p>



<a name="276579702"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276579702" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Boeman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276579702">(Mar 25 2022 at 06:00)</a>:</h4>
<p>But moving back and forth from occupied to vacant is actually a really useful thing to be able to do</p>



<a name="276579844"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276579844" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jak{e,ob} Degen <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276579844">(Mar 25 2022 at 06:02)</a>:</h4>
<p>Good point, and solving this problem would be wonderful - the scope of this RFC just feels like it goes significantly too far beyond that for me</p>



<a name="276580019"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276580019" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Boeman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276580019">(Mar 25 2022 at 06:06)</a>:</h4>
<p>The only method that is impossible to fix here is the key method on occupied entry. For these entries to be ideologically consistent that would have to return a reference into the collection, not the entry.</p>
<p>This is why I wanted to just make fully new entry types. The abstraction for entries as they stand now is wrong, and I don’t think it’s possible to correct it without breaking stuff.</p>



<a name="276580030"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276580030" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276580030">(Mar 25 2022 at 06:07)</a>:</h4>
<p>I think that's an argument for adding a <code>entry_ref()</code> function which maps to different types</p>



<a name="276580087"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276580087" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Boeman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276580087">(Mar 25 2022 at 06:08)</a>:</h4>
<p>The problem with that is it gets really confusing what the difference between Entry and EntryRef is</p>



<a name="276580091"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276580091" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276580091">(Mar 25 2022 at 06:08)</a>:</h4>
<p>one takes a <code>&amp;K</code> the other takes a <code>K</code></p>



<a name="276580100"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276580100" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276580100">(Mar 25 2022 at 06:08)</a>:</h4>
<p>and otherwise they have roughly equivalent methods</p>



<a name="276581111"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276581111" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Boeman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276581111">(Mar 25 2022 at 06:33)</a>:</h4>
<p>I think everything would be resolved by adding an OccupiedEntryRef, and an EntryRef</p>
<p>Both would impl <code>From</code> the non ref variants.</p>
<p>The insert_entry on VacantEntry should then also be changed to return an OccupiedEntryRef</p>
<p>OccupiedEntry would then just be an artifact of searching with an owned key.</p>



<a name="276586175"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276586175" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276586175">(Mar 25 2022 at 08:01)</a>:</h4>
<p>I agree with scott that while I can see a few traits being added (arguably, <code>std</code> is trait-light to the point of crying out for them) I doubt a design which requires 9 will get through. As someone who has advocated for more traits before, I have come face to face with the fact that there are design pressures making traits <strong>much</strong> less of a good idea for <code>std</code>.</p>



<a name="276616429"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276616429" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Boeman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276616429">(Mar 25 2022 at 13:14)</a>:</h4>
<p>I’ve been looking around for some info on this EntryRef api. Does anyone have an RFC link? Or any links to discussions?</p>



<a name="276628980"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276628980" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276628980">(Mar 25 2022 at 14:46)</a>:</h4>
<blockquote>
<p>The point is once you have an occupied entry you don’t need that key. You want two methods: one that takes the key by ownership, searches, and throws the search key away if it doesn’t find anything, and another which takes a borrow of a key, and clones if needed</p>
</blockquote>
<p>There have been previous RFC's about the fact that the entry API takes an owned value even though it only needs it for insertion. As I recall they went through several iterations with hundreds of comments both on the RFC's repo and internals. These previous discussions should be linked in your prior art. I don't remember the details, but a bunch of things turned out to be unsafe and other things turned out to have hidden costs. The outcome was that we should have a "raw API" that allowed for zero cost interactions at the risk of unsafety, and that this API should be prototyped outside of STD. In the interim HashBrown, the outside crate where it was being prototyped, became STDs HashMap implementation.</p>



<a name="276630914"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276630914" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Boeman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276630914">(Mar 25 2022 at 14:58)</a>:</h4>
<p>I really have looked around and all I can find are mentions. Do you have any suggestions for keywords to include in my search? Or other advice for locating these threads?</p>



<a name="276631846"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276631846" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276631846">(Mar 25 2022 at 15:04)</a>:</h4>
<p>I will look.</p>



<a name="276635148"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276635148" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Boeman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276635148">(Mar 25 2022 at 15:25)</a>:</h4>
<p>Thanks I appreciate it!</p>



<a name="276635650"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276635650" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276635650">(Mar 25 2022 at 15:28)</a>:</h4>
<ul>
<li>May '15 <a href="https://internals.rust-lang.org/t/head-desking-on-entry-api-4-0/2156">https://internals.rust-lang.org/t/head-desking-on-entry-api-4-0/2156</a> Head-Desking on Entry API 4.0</li>
<li>Mar '18 <a href="https://internals.rust-lang.org/t/pre-rfc-abandonning-morals-in-the-name-of-performance-the-raw-entry-api/7043">https://internals.rust-lang.org/t/pre-rfc-abandonning-morals-in-the-name-of-performance-the-raw-entry-api/7043</a> [Pre-RFC] Abandonning Morals In The Name Of Performance: The Raw Entry API</li>
</ul>



<a name="276636010"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276636010" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276636010">(Mar 25 2022 at 15:30)</a>:</h4>
<p>There are links in the second thread.</p>



<a name="276636653"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276636653" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276636653">(Mar 25 2022 at 15:35)</a>:</h4>
<p>Some of the discussions hinged on "can we find a solution's before GAT ship?". Apparently the answer is "No!".<br>
But now that we have GAT, some of the older options may work fine.</p>



<a name="276637122"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276637122" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Boeman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276637122">(Mar 25 2022 at 15:38)</a>:</h4>
<p>I am actually pretty confident GAT are not required. Will hack on this a bit, and make a new, much more stripped down RFC.</p>



<a name="276637218"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276637218" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Boeman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276637218">(Mar 25 2022 at 15:39)</a>:</h4>
<p>But thanks for the links! I really appreciate the help. Time for me to do some reading</p>



<a name="276638163"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276638163" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276638163">(Mar 25 2022 at 15:46)</a>:</h4>
<p>The project was a lot smaller then. So people did not provide links as often. As everyone was reading all the discussions anyway.<br>
Like "Entry API 4.0" implies at leased 3 earlier discussions, but they are not linked. It may require follow up searching.</p>



<a name="276672104"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276672104" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Boeman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276672104">(Mar 25 2022 at 20:05)</a>:</h4>
<p>I think I have something pretty compelling for users of the regular and raw entry apis. Going to finish writing it up tonight and see what people think. It adds 4 new structs and removes the raw api structs, so the actual number of types goes down, while not losing any power.</p>
<p>The only unfortunate thing is that it can’t be done using the original Entry and OccupiedEntry, so it adds new types EntryRef and OccupiedEntryRef.</p>
<p>I’m pretty happy with the RawEntry changes, because I think it gets a lot easier to think about.</p>



<a name="276690770"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276690770" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Boeman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276690770">(Mar 25 2022 at 23:15)</a>:</h4>
<p>Hmmm I think I’m discovering that one of the problems with making this api useful is that the various entry types are not generic over the BuildHasher. Idk if much growth of old apis is actually possible without that parameter</p>



<a name="276691981"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276691981" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276691981">(Mar 25 2022 at 23:36)</a>:</h4>
<p><span class="user-mention silent" data-user-id="461427">Mason Boeman</span> <a href="#narrow/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api/near/276616429">said</a>:</p>
<blockquote>
<p>I’ve been looking around for some info on this EntryRef api. Does anyone have an RFC link? Or any links to discussions?</p>
</blockquote>
<p><code>hashbrown</code> has it: <a href="https://docs.rs/hashbrown/latest/hashbrown/hash_map/enum.EntryRef.html">https://docs.rs/hashbrown/latest/hashbrown/hash_map/enum.EntryRef.html</a></p>



<a name="276692019"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276692019" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276692019">(Mar 25 2022 at 23:37)</a>:</h4>
<p>(and quite the generic alphabet soup, <code>&lt;'a, 'b, K, Q, V, S, A&gt;</code>)</p>



<a name="276692074"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276692074" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Boeman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276692074">(Mar 25 2022 at 23:38)</a>:</h4>
<p>Yeah I’m looking at hashbrown’s mechanism and it still feels off</p>



<a name="276692089"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276692089" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Boeman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276692089">(Mar 25 2022 at 23:39)</a>:</h4>
<p>It doesn’t seem like there should be much reason to keep Q around in the entry</p>



<a name="276692099"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276692099" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Boeman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276692099">(Mar 25 2022 at 23:39)</a>:</h4>
<p>KVSA are unavoidable cause its a hashmap</p>



<a name="276692108"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276692108" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Boeman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276692108">(Mar 25 2022 at 23:39)</a>:</h4>
<p>Also b goes away if you don’t need to hold onto Q</p>



<a name="276692124"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276692124" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276692124">(Mar 25 2022 at 23:39)</a>:</h4>
<p><code>insert</code> uses <code>K: From&lt;&amp;Q&gt;</code></p>



<a name="276692188"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276692188" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Boeman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276692188">(Mar 25 2022 at 23:40)</a>:</h4>
<p>Right but if you passed in a &amp;Q, you could just pass it in again at insert time</p>



<a name="276692197"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276692197" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Boeman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276692197">(Mar 25 2022 at 23:40)</a>:</h4>
<p>Cause the lifetime will still be valid if your entry is valid</p>



<a name="276692212"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276692212" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Boeman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276692212">(Mar 25 2022 at 23:40)</a>:</h4>
<p>And it’s a shared reference, so you can alias them</p>



<a name="276692228"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276692228" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Boeman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276692228">(Mar 25 2022 at 23:41)</a>:</h4>
<p>Not much reason to hold onto it in the entry</p>



<a name="276692236"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276692236" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Boeman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276692236">(Mar 25 2022 at 23:41)</a>:</h4>
<p>Maybe I’m just not being imaginative enough</p>



<a name="276692296"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276692296" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276692296">(Mar 25 2022 at 23:42)</a>:</h4>
<p>I think not many types impl <code>From&lt;&amp;_&gt;</code> anyway, maybe just some <code>From&lt;&amp;str&gt;</code> and <code>From&lt;&amp;[_]&gt;</code></p>



<a name="276693153"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276693153" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276693153">(Mar 25 2022 at 23:56)</a>:</h4>
<p>I'm guessing the real reason is so you don't smuggle a totally different <code>&amp;Q</code> in its place.</p>



<a name="276693168"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276693168" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276693168">(Mar 25 2022 at 23:57)</a>:</h4>
<p>that would still be <em>memory safe</em>, but would otherwise break the map</p>



<a name="276693173"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276693173" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Boeman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276693173">(Mar 25 2022 at 23:57)</a>:</h4>
<p>But that’s already possible all over the place in this api</p>



<a name="276693196"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276693196" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276693196">(Mar 25 2022 at 23:57)</a>:</h4>
<p>other than interior-mutable keys?</p>



<a name="276693252"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276693252" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Boeman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276693252">(Mar 25 2022 at 23:58)</a>:</h4>
<p>You can get mutable references to keys</p>



<a name="276693254"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276693254" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Boeman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276693254">(Mar 25 2022 at 23:58)</a>:</h4>
<p>I’m the collections</p>



<a name="276693256"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276693256" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Boeman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276693256">(Mar 25 2022 at 23:58)</a>:</h4>
<p>At which point all bets are off</p>



<a name="276693265"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276693265" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276693265">(Mar 25 2022 at 23:58)</a>:</h4>
<p>where do you get mutable keys?</p>



<a name="276693305"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276693305" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Boeman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276693305">(Mar 25 2022 at 23:59)</a>:</h4>
<p>Sorry that was the raw api.</p>



<a name="276693308"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276693308" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Boeman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276693308">(Mar 25 2022 at 23:59)</a>:</h4>
<p><a href="https://doc.rust-lang.org/std/collections/hash_map/struct.OccupiedEntry.html#method.replace_entry">https://doc.rust-lang.org/std/collections/hash_map/struct.OccupiedEntry.html#method.replace_entry</a></p>



<a name="276693319"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276693319" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Boeman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276693319">(Mar 25 2022 at 23:59)</a>:</h4>
<p>but this does it kinda. i guess this method checks the hash?</p>



<a name="276693397"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276693397" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276693397">(Mar 26 2022 at 00:00)</a>:</h4>
<p>that checks hash and equality</p>



<a name="276693455"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276693455" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Boeman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276693455">(Mar 26 2022 at 00:00)</a>:</h4>
<p>well the raw api certainly doesn't check<br>
<a href="https://doc.rust-lang.org/std/collections/hash_map/struct.RawOccupiedEntryMut.html#method.into_key">https://doc.rust-lang.org/std/collections/hash_map/struct.RawOccupiedEntryMut.html#method.into_key</a></p>



<a name="276693474"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276693474" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276693474">(Mar 26 2022 at 00:01)</a>:</h4>
<p>there are many reasons the raw api is still unstable</p>



<a name="276693545"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276693545" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Boeman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276693545">(Mar 26 2022 at 00:02)</a>:</h4>
<p>indeed</p>



<a name="276693584"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Pre-RFC%3A%20generic-entry-api/near/276693584" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Pre-RFC.3A.20generic-entry-api.html#276693584">(Mar 26 2022 at 00:03)</a>:</h4>
<p>at least "raw" kind of indicates that something pseudo-unsafe is happening</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>