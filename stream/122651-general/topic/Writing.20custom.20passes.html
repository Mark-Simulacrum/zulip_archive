<html>
<head><meta charset="utf-8"><title>Writing custom passes · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Writing.20custom.20passes.html">Writing custom passes</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="259516381"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Writing%20custom%20passes/near/259516381" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Writing.20custom.20passes.html#259516381">(Oct 29 2021 at 12:22)</a>:</h4>
<p><span class="user-mention" data-user-id="453933">@Soham Dixit</span> What kind of pass? An AST lint pass, a HIR lint pass or a MIR optimization pass? Also you may want to ask in <a class="stream" data-stream-id="182449" href="/#narrow/stream/182449-t-compiler.2Fhelp">#t-compiler/help</a> instead.</p>



<a name="259520632"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Writing%20custom%20passes/near/259520632" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Soham Dixit <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Writing.20custom.20passes.html#259520632">(Oct 29 2021 at 13:03)</a>:</h4>
<p><span class="user-mention silent" data-user-id="133247">bjorn3</span> <a href="#narrow/stream/122651-general/topic/Writing.20custom.20passes/near/259516381">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="453933">Soham Dixit</span> What kind of pass? An AST lint pass, a HIR lint pass or a MIR optimization pass? Also you may want to ask in <a class="stream" data-stream-id="182449" href="/#narrow/stream/182449-t-compiler.2Fhelp">#t-compiler/help</a> instead.</p>
</blockquote>
<p><span class="user-mention silent" data-user-id="133247">bjorn3</span>  I have written in  LLVM IR. it converts call by value to call by reference, but where should I store it?</p>



<a name="259526494"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Writing%20custom%20passes/near/259526494" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Writing.20custom.20passes.html#259526494">(Oct 29 2021 at 13:49)</a>:</h4>
<p>An LLVM pass will need to be added to LLVM (<code>src/llvm-project</code>). Or you need to write it as LLVM plugin and pass it to <code>-Zllvm-plugins</code>. This only works for rustc versions that dynamically link to LLVM though. I believe the Linux versions are but not the Windows versions.</p>



<a name="259556490"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Writing%20custom%20passes/near/259556490" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Soham Dixit <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Writing.20custom.20passes.html#259556490">(Oct 29 2021 at 17:22)</a>:</h4>
<p>Thankyou <span class="user-mention" data-user-id="133247">@bjorn3</span>  for valuable reply it really helped me</p>
<p>There is one another problem</p>
<p>I was building rust from here:-<br>
<a href="https://github.com/rust-lang/rust">https://github.com/rust-lang/rust</a></p>
<p>Clone got successful, but while building it I was getting this error :-<br>
invalid checksum:<br>
    found:    e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855<br>
    expected: 7692b0b44eea139874fb8c6cbaca46b8f156ce392454ee4891daad532a5c6baa<br>
Traceback (most recent call last):<br>
  File "x.py", line 27, in &lt;module&gt;<br>
    bootstrap.main()<br>
 RuntimeError("failed verification")<br>
RuntimeError: failed verification</p>
<p>I have also tired from here:-<br>
<a href="https://rustc-dev-guide.rust-lang.org/getting-started.html#cloning-and-building">https://rustc-dev-guide.rust-lang.org/getting-started.html#cloning-and-building</a></p>
<p>Can you please help me to solve the error</p>



<a name="259556702"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Writing%20custom%20passes/near/259556702" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Writing.20custom.20passes.html#259556702">(Oct 29 2021 at 17:24)</a>:</h4>
<p>That seems to be a downloaded file getting corrupt.</p>



<a name="259556743"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Writing%20custom%20passes/near/259556743" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Writing.20custom.20passes.html#259556743">(Oct 29 2021 at 17:24)</a>:</h4>
<p>The specific file that got corrupt is <code>rust-std-beta-x86_64-unknown-linux-gnu.tar.xz</code>.</p>



<a name="259556848"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Writing%20custom%20passes/near/259556848" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Writing.20custom.20passes.html#259556848">(Oct 29 2021 at 17:25)</a>:</h4>
<p>You should be able to find it in <code>build/cache/2021-10-22</code>. Try removing it and then try building it again.</p>



<a name="259712016"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Writing%20custom%20passes/near/259712016" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Soham Dixit <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Writing.20custom.20passes.html#259712016">(Oct 30 2021 at 05:31)</a>:</h4>
<p><span class="user-mention silent" data-user-id="133247">bjorn3</span> <a href="#narrow/stream/122651-general/topic/Writing.20custom.20passes/near/259556702">said</a>:</p>
<blockquote>
<p>That seems to be a downloaded file getting corrupt.</p>
</blockquote>
<p>I tried removing it and re-build it but the same issue occurs<br>
The Error is:</p>
<p>/rust$ ./x.py build <br>
Updating only changed submodules<br>
Submodules updated in 0.01 seconds<br>
downloading <a href="https://static.rust-lang.org/dist/2021-10-22/rust-std-beta-x86_64-unknown-linux-gnu.tar.xz">https://static.rust-lang.org/dist/2021-10-22/rust-std-beta-x86_64-unknown-linux-gnu.tar.xz</a><br>
######################################################################### 100.0%<br>
invalid checksum:<br>
    found:    e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855<br>
    expected: 7692b0b44eea139874fb8c6cbaca46b8f156ce392454ee4891daad532a5c6baa<br>
Traceback (most recent call last):<br>
  File "./x.py", line 27, in &lt;module&gt;<br>
    bootstrap.main()<br>
  File "/home/soham/rust/src/bootstrap/bootstrap.py", line 1252, in main<br>
    bootstrap(help_triggered)<br>
  File "/home/soham/rust/src/bootstrap/bootstrap.py", line 1218, in bootstrap<br>
    build.download_toolchain()<br>
  File "/home/soham/rust/src/bootstrap/bootstrap.py", line 412, in download_toolchain<br>
    self._download_component_helper(filename, pattern, tarball_suffix, stage0)<br>
  File "/home/soham/rust/src/bootstrap/bootstrap.py", line 553, in _download_component_helper<br>
    get(<br>
  File "/home/soham/rust/src/bootstrap/bootstrap.py", line 49, in get<br>
    raise RuntimeError("failed verification")<br>
RuntimeError: failed verification</p>



<a name="259713757"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Writing%20custom%20passes/near/259713757" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Writing.20custom.20passes.html#259713757">(Oct 30 2021 at 06:23)</a>:</h4>
<p><span class="user-mention" data-user-id="121055">@Pietro Albini</span> Any idea what could be going on here?</p>



<a name="259717556"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Writing%20custom%20passes/near/259717556" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Writing.20custom.20passes.html#259717556">(Oct 30 2021 at 08:06)</a>:</h4>
<p>wtf downloading the file on my computer gives the correct hash</p>



<a name="259717565"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Writing%20custom%20passes/near/259717565" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Writing.20custom.20passes.html#259717565">(Oct 30 2021 at 08:07)</a>:</h4>
<p><span class="user-mention" data-user-id="453933">@Soham Dixit</span> do you happen to have any software monitoring your network connection?</p>



<a name="259717574"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Writing%20custom%20passes/near/259717574" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Writing.20custom.20passes.html#259717574">(Oct 30 2021 at 08:07)</a>:</h4>
<p>otherwise, could you download that link and upload it somewhere so that we can analyze it?</p>



<a name="259717833"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Writing%20custom%20passes/near/259717833" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Soham Dixit <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Writing.20custom.20passes.html#259717833">(Oct 30 2021 at 08:14)</a>:</h4>
<p>No I don't have any software monitoring</p>



<a name="259717851"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Writing%20custom%20passes/near/259717851" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Soham Dixit <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Writing.20custom.20passes.html#259717851">(Oct 30 2021 at 08:15)</a>:</h4>
<p>Where to upload?</p>



<a name="259721336"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Writing%20custom%20passes/near/259721336" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Writing.20custom.20passes.html#259721336">(Oct 30 2021 at 09:45)</a>:</h4>
<p><span class="user-mention" data-user-id="453933">@Soham Dixit</span> dunno... just any place where you can upload a 25mb file</p>



<a name="259722638"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Writing%20custom%20passes/near/259722638" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Soham Dixit <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Writing.20custom.20passes.html#259722638">(Oct 30 2021 at 10:15)</a>:</h4>
<p><span class="user-mention silent" data-user-id="121055">Pietro Albini</span> <a href="#narrow/stream/122651-general/topic/Writing.20custom.20passes/near/259721336">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="453933">Soham Dixit</span> dunno... just any place where you can upload a 25mb file</p>
</blockquote>
<p>Sure I will upload it and share you the link<br>
Thank You</p>



<a name="259722730"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Writing%20custom%20passes/near/259722730" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Soham Dixit <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Writing.20custom.20passes.html#259722730">(Oct 30 2021 at 10:17)</a>:</h4>
<p><span class="user-mention" data-user-id="121055">@Pietro Albini</span>  <span class="user-mention" data-user-id="133247">@bjorn3</span>  <br>
Is there any example of How to write rust pass &amp; How to run the pass in rust compiler?</p>



<a name="259726962"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Writing%20custom%20passes/near/259726962" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Writing.20custom.20passes.html#259726962">(Oct 30 2021 at 12:00)</a>:</h4>
<p><a href="https://llvm.org/docs/WritingAnLLVMPass.html#basic-code-required">https://llvm.org/docs/WritingAnLLVMPass.html#basic-code-required</a> has documentation on how to write llvm passes in a way that works as an llvm plugin. It seems the actual registration of the pass at this page is with the legacy pass manager though, which rustc doesn't use anymore since recently.</p>



<a name="259730508"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Writing%20custom%20passes/near/259730508" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Soham Dixit <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Writing.20custom.20passes.html#259730508">(Oct 30 2021 at 13:16)</a>:</h4>
<p><span class="user-mention silent" data-user-id="133247">bjorn3</span> <a href="#narrow/stream/122651-general/topic/Writing.20custom.20passes/near/259726962">said</a>:</p>
<blockquote>
<p><a href="https://llvm.org/docs/WritingAnLLVMPass.html#basic-code-required">https://llvm.org/docs/WritingAnLLVMPass.html#basic-code-required</a> has documentation on how to write llvm passes in a way that works as an llvm plugin. It seems the actual registration of the pass at this page is with the legacy pass manager though, which rustc doesn't use anymore since recently.</p>
</blockquote>
<p>Thanks</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>