<html>
<head><meta charset="utf-8"><title>Type inference issue when associated type is also generic · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Type.20inference.20issue.20when.20associated.20type.20is.20also.20generic.html">Type inference issue when associated type is also generic</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="249323970"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Type%20inference%20issue%20when%20associated%20type%20is%20also%20generic/near/249323970" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Duncan <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Type.20inference.20issue.20when.20associated.20type.20is.20also.20generic.html#249323970">(Aug 13 2021 at 05:25)</a>:</h4>
<p>I'm surprised by this difference in behavior:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">trait</span><span class="w"> </span><span class="n">Foo</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">Bar</span>: <span class="nb">Clone</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// Works.</span>
<span class="k">fn</span> <span class="nf">clone_bar1</span><span class="o">&lt;</span><span class="n">T</span>: <span class="nc">Foo</span><span class="o">&gt;</span><span class="p">(</span><span class="n">b</span>: <span class="nc">T</span>::<span class="n">Bar</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">T</span>::<span class="n">Bar</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">b</span><span class="p">.</span><span class="n">clone</span><span class="p">()</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// Does not work.</span>
<span class="k">fn</span> <span class="nf">clone_bar2</span><span class="o">&lt;</span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">T</span>: <span class="nc">Foo</span><span class="o">&lt;</span><span class="n">Bar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">B</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">b</span>: <span class="nc">B</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">B</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">b</span><span class="p">.</span><span class="n">clone</span><span class="p">()</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>Is this a known issue?</p>



<a name="249386365"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Type%20inference%20issue%20when%20associated%20type%20is%20also%20generic/near/249386365" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fee1-dead <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Type.20inference.20issue.20when.20associated.20type.20is.20also.20generic.html#249386365">(Aug 13 2021 at 17:11)</a>:</h4>
<p><a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=b5d7342796874dc9dc085e6e7722d85d">playground</a></p>
<p>I think this should be left as is, because otherwise the second example can be pretty bad in terms of readability. Anyone reading the code might not be able know which trait the function comes from if another trait is used instead of <code>Clone</code>.</p>



<a name="249400284"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Type%20inference%20issue%20when%20associated%20type%20is%20also%20generic/near/249400284" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Type.20inference.20issue.20when.20associated.20type.20is.20also.20generic.html#249400284">(Aug 13 2021 at 19:07)</a>:</h4>
<p>Even <code>&lt;&lt;T as Foo&gt;::Bar as Clone&gt;::clone(&amp;b)</code> complains about missing <code>B: Clone</code></p>



<a name="249407712"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Type%20inference%20issue%20when%20associated%20type%20is%20also%20generic/near/249407712" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Type.20inference.20issue.20when.20associated.20type.20is.20also.20generic.html#249407712">(Aug 13 2021 at 20:09)</a>:</h4>
<p>I think this is just <a href="https://github.com/rust-lang/rust/issues/20671">https://github.com/rust-lang/rust/issues/20671</a>? Seems a bit odd that it works for <code>T::Bar</code> though</p>



<a name="249409942"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Type%20inference%20issue%20when%20associated%20type%20is%20also%20generic/near/249409942" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Duncan <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Type.20inference.20issue.20when.20associated.20type.20is.20also.20generic.html#249409942">(Aug 13 2021 at 20:27)</a>:</h4>
<p>Wow if I could put where clauses in my traits and have them actually evaluated when used elsewhere, that would simplify my code sooooo much</p>



<a name="249411255"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Type%20inference%20issue%20when%20associated%20type%20is%20also%20generic/near/249411255" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pointerbender <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Type.20inference.20issue.20when.20associated.20type.20is.20also.20generic.html#249411255">(Aug 13 2021 at 20:38)</a>:</h4>
<p>I'm surprised that the compiler doesn't complain about the missing trait bound <code>B: Clone</code>, due to this bound being required by <code>&lt;T as Foo&gt;::Bar: Clone</code>. This works, but I guess this isn't what you're after: <a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=09be14a435df9a930fe9cb5284043996">https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=09be14a435df9a930fe9cb5284043996</a></p>



<a name="249432982"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Type%20inference%20issue%20when%20associated%20type%20is%20also%20generic/near/249432982" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Duncan <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Type.20inference.20issue.20when.20associated.20type.20is.20also.20generic.html#249432982">(Aug 14 2021 at 02:01)</a>:</h4>
<p><span class="user-mention silent" data-user-id="400735">Pointerbender</span> <a href="#narrow/stream/122651-general/topic/Type.20inference.20issue.20when.20associated.20type.20is.20also.20generic/near/249411255">said</a>:</p>
<blockquote>
<p>I'm surprised that the compiler doesn't complain about the missing trait bound <code>B: Clone</code>, due to this bound being required by <code>&lt;T as Foo&gt;::Bar: Clone</code>. This works, but I guess this isn't what you're after: <a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=09be14a435df9a930fe9cb5284043996">https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=09be14a435df9a930fe9cb5284043996</a></p>
</blockquote>
<p>I would expect that <code>T: Foo</code> should imply <code>T::Bar: Clone</code> regardless of the context. But maybe I don't understand how associated type bounds are supposed to work.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>