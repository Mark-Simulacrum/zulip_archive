<html>
<head><meta charset="utf-8"><title>Rust and Valgrind · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Rust.20and.20Valgrind.html">Rust and Valgrind</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="266868699"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Rust%20and%20Valgrind/near/266868699" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Rust.20and.20Valgrind.html#266868699">(Jan 04 2022 at 21:50)</a>:</h4>
<p>I just published a <a href="https://nnethercote.github.io/2022/01/05/rust-and-valgrind.html">blog post</a> about Rust and Valgrind that may be of interest to people here.</p>



<a name="266949811"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Rust%20and%20Valgrind/near/266949811" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Rust.20and.20Valgrind.html#266949811">(Jan 05 2022 at 15:34)</a>:</h4>
<p>Unfortunately this doesn't actually tell me how to use valgrind with rust. If I have a rust project, what special flags do I pass to cargo, or what environment variables do I set, or whatever, to make valgrind go? And how should I install valgrind to begin with?</p>



<a name="266951066"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Rust%20and%20Valgrind/near/266951066" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Rust.20and.20Valgrind.html#266951066">(Jan 05 2022 at 15:44)</a>:</h4>
<p>You can run <code>valgrind /path/to/executable</code>. For example <code>valgrind target/debug/foo</code>. Installing valgrind on linux can be done through your package manager. I think you have to compile it from source for macOS. <a href="https://valgrind.org/downloads/current.html">https://valgrind.org/downloads/current.html</a></p>



<a name="266951175"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Rust%20and%20Valgrind/near/266951175" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Rust.20and.20Valgrind.html#266951175">(Jan 05 2022 at 15:45)</a>:</h4>
<p>macOS support tends to lag behind the current OS version. I almost always use it in a Linux VM.</p>



<a name="266951205"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Rust%20and%20Valgrind/near/266951205" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Rust.20and.20Valgrind.html#266951205">(Jan 05 2022 at 15:45)</a>:</h4>
<p>And to specify which valgrind tool you want to use instead of memcheck you can pass for example <code>--tool=cachegrind</code> just after <code>valgrind</code>.</p>



<a name="266951349"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Rust%20and%20Valgrind/near/266951349" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Rust.20and.20Valgrind.html#266951349">(Jan 05 2022 at 15:46)</a>:</h4>
<blockquote>
<p>{x86,amd64}-darwin (Mac OS X 10.13).</p>
</blockquote>
<p>Yeah, not gonna work great on macOS aarch64 12.1 <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="266952733"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Rust%20and%20Valgrind/near/266952733" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Rust.20and.20Valgrind.html#266952733">(Jan 05 2022 at 15:57)</a>:</h4>
<p>ah, so as a Windows user I can expect it'll never work for me at all then ;P</p>



<a name="266983780"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Rust%20and%20Valgrind/near/266983780" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Rust.20and.20Valgrind.html#266983780">(Jan 05 2022 at 20:03)</a>:</h4>
<p>Linux is one bootable USB drive or WSL VM away</p>



<a name="266986022"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Rust%20and%20Valgrind/near/266986022" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Rust.20and.20Valgrind.html#266986022">(Jan 05 2022 at 20:22)</a>:</h4>
<p>last time i tried WSL it made my boot time 20 minutes and i have ptsd from that occurance</p>



<a name="266987372"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Rust%20and%20Valgrind/near/266987372" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Rust.20and.20Valgrind.html#266987372">(Jan 05 2022 at 20:33)</a>:</h4>
<p>Conversely, I use my Windows gaming machine for Rust performance tests via SSH / WSL<em>2</em> and it takes seconds to come out of sleep and be ready to go.</p>



<a name="266987592"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Rust%20and%20Valgrind/near/266987592" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Rust.20and.20Valgrind.html#266987592">(Jan 05 2022 at 20:35)</a>:</h4>
<p>But I don't really want to make linux apps, my stuff starts by initializing WGL and then asking User32 to make me a window and gimme the HWND and I think you can tell where things go from there.</p>



<a name="266987804"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Rust%20and%20Valgrind/near/266987804" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Rust.20and.20Valgrind.html#266987804">(Jan 05 2022 at 20:36)</a>:</h4>
<p>While I'm not a Windows developer, my understanding is that Windows has a robust set of developer tools already, sometimes outclassing what you can get elsewhere. I bet there's an equal or better alternative.</p>



<a name="266987907"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Rust%20and%20Valgrind/near/266987907" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Rust.20and.20Valgrind.html#266987907">(Jan 05 2022 at 20:37)</a>:</h4>
<p>And if you can isolate subcrates to be non-platform-specific, you can always run those parts through Valgrind.</p>



<a name="266988038"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Rust%20and%20Valgrind/near/266988038" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Rust.20and.20Valgrind.html#266988038">(Jan 05 2022 at 20:39)</a>:</h4>
<p>Sure, and that's all fine. My initial comments were more editors notes than real questions for the wider world.</p>
<p>I don't want <em>this thread</em> to say how to use Valgrind, I want <em>the blog post</em> to say how.</p>



<a name="266988731"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Rust%20and%20Valgrind/near/266988731" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Rust.20and.20Valgrind.html#266988731">(Jan 05 2022 at 20:45)</a>:</h4>
<p><span class="user-mention" data-user-id="116155">@Jake Goulding</span> the only thing i havent been able to find a replacement for is heaptrack</p>



<a name="266988747"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Rust%20and%20Valgrind/near/266988747" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Rust.20and.20Valgrind.html#266988747">(Jan 05 2022 at 20:45)</a>:</h4>
<p>i found an awesome profiler but nothing for memory :(</p>



<a name="267029164"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Rust%20and%20Valgrind/near/267029164" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Rust.20and.20Valgrind.html#267029164">(Jan 06 2022 at 06:14)</a>:</h4>
<p>There's Application Verifier, but I didn't use it too much, and it's not quite Valgrind.</p>



<a name="267029180"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Rust%20and%20Valgrind/near/267029180" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Rust.20and.20Valgrind.html#267029180">(Jan 06 2022 at 06:14)</a>:</h4>
<p>And I've heard good things about <a href="https://drmemory.org/">https://drmemory.org/</a></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>