<html>
<head><meta charset="utf-8"><title>.cargo/config clarification · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2Ecargo.2Fconfig.20clarification.html">.cargo/config clarification</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://rust-lang.github.io/zulip_archive/style.css" rel="stylesheet"></head>

<a name="228875055"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/.cargo/config%20clarification/near/228875055" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2Ecargo.2Fconfig.20clarification.html#228875055">(Mar 05 2021 at 00:20)</a>:</h4>
<p><code>.cargo/config.toml</code> isn't published to <a href="http://crates.io">crates.io</a>, right, or isn't used if it is?</p>
<p>E.g. it's untrue that packages on <a href="http://crates.io">crates.io</a> can set properties here and their dependencies get them.</p>
<p>I'm pretty sure about this, but someone in an issue is very confidently asserting otherwise...</p>



<a name="228875286"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/.cargo/config%20clarification/near/228875286" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2Ecargo.2Fconfig.20clarification.html#228875286">(Mar 05 2021 at 00:22)</a>:</h4>
<p>I agree with you, but I guess you could ask them to confidently point to the cargo code that does what they suggest :)</p>



<a name="228875934"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/.cargo/config%20clarification/near/228875934" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2Ecargo.2Fconfig.20clarification.html#228875934">(Mar 05 2021 at 00:29)</a>:</h4>
<p>Well, they're claiming it works for them, so it's sort of on me to come up with evidence it doesn't.</p>
<p>The situation that it apparently works in is a git dep, and I'm surprised that it would work in a git dep since that's not listed in <a href="https://doc.rust-lang.org/cargo/reference/config.html">https://doc.rust-lang.org/cargo/reference/config.html</a>. </p>
<p>i wouldn't be that surprised if it works for a path dep, since thats part of the workspace, although this isn't listed in the docs there either.</p>
<p>EDIT: reading their comment again, perhaps they are using a path dep...</p>



<a name="228878396"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/.cargo/config%20clarification/near/228878396" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2Ecargo.2Fconfig.20clarification.html#228878396">(Mar 05 2021 at 00:54)</a>:</h4>
<p><span class="user-mention silent" data-user-id="209168">Thom Chiovoloni</span> <a href="#narrow/stream/122651-general/topic/.2Ecargo.2Fconfig.20clarification/near/228875055">said</a>:</p>
<blockquote>
<p><code>.cargo/config.toml</code> isn't published to <a href="http://crates.io">crates.io</a>, right, or isn't used if it is?</p>
<p>E.g. it's untrue that packages on <a href="http://crates.io">crates.io</a> can set properties here and their dependencies get them.</p>
<p>I'm pretty sure about this, but someone in an issue is very confidently asserting otherwise...</p>
</blockquote>
<p>it's published, <a href="http://docs.rs">docs.rs</a> got a bug a while back that it was compiling for the wrong target because of it</p>



<a name="228878408"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/.cargo/config%20clarification/near/228878408" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2Ecargo.2Fconfig.20clarification.html#228878408">(Mar 05 2021 at 00:54)</a>:</h4>
<p><a href="https://github.com/rust-lang/docs.rs/issues/650">https://github.com/rust-lang/docs.rs/issues/650#</a></p>



<a name="228878621"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/.cargo/config%20clarification/near/228878621" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2Ecargo.2Fconfig.20clarification.html#228878621">(Mar 05 2021 at 00:57)</a>:</h4>
<p>My understanding is that it's used anytime the current crate is the root crate (lib / bin / example / test / bench) but it's not used when the crate is used as a dependency.</p>



<a name="228878738"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/.cargo/config%20clarification/near/228878738" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2Ecargo.2Fconfig.20clarification.html#228878738">(Mar 05 2021 at 00:58)</a>:</h4>
<p>For example, in <code>safe_arch</code> I have <code>-Ctarget-cpu=native</code> permanently set for rustflags and rustdocflags, but that doesn't mess with any downstream users</p>



<a name="228878829"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/.cargo/config%20clarification/near/228878829" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2Ecargo.2Fconfig.20clarification.html#228878829">(Mar 05 2021 at 00:59)</a>:</h4>
<p>that sounds right, yeah</p>



<a name="228878844"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/.cargo/config%20clarification/near/228878844" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2Ecargo.2Fconfig.20clarification.html#228878844">(Mar 05 2021 at 00:59)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/122651-general/topic/.2Ecargo.2Fconfig.20clarification/near/228878396">said</a>:</p>
<blockquote>
<p>it's published, <a href="http://docs.rs">docs.rs</a> got a bug a while back that it was compiling for the wrong target because of it</p>
</blockquote>
<p>Hmm, I tried locally with --dry-run (and with <code>cargo package</code> and it doesnt end up in the package. Or did these cases manually publish it using <code>package.include</code></p>



<a name="228878881"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/.cargo/config%20clarification/near/228878881" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2Ecargo.2Fconfig.20clarification.html#228878881">(Mar 05 2021 at 01:00)</a>:</h4>
<p>that I'm not sure about, sorry</p>



<a name="228879843"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/.cargo/config%20clarification/near/228879843" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2Ecargo.2Fconfig.20clarification.html#228879843">(Mar 05 2021 at 01:09)</a>:</h4>
<p>Hm, actually, it seems like cargo package does include it.</p>



<a name="228879887"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/.cargo/config%20clarification/near/228879887" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2Ecargo.2Fconfig.20clarification.html#228879887">(Mar 05 2021 at 01:09)</a>:</h4>
<p>Would the <a href="http://docs.rs">docs.rs</a> issue have happened if it's just published, but not used?</p>



<a name="228879953"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/.cargo/config%20clarification/near/228879953" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2Ecargo.2Fconfig.20clarification.html#228879953">(Mar 05 2021 at 01:10)</a>:</h4>
<p><span class="user-mention silent" data-user-id="209168">Thom Chiovoloni</span> <a href="#narrow/stream/122651-general/topic/.2Ecargo.2Fconfig.20clarification/near/228879887">said</a>:</p>
<blockquote>
<p>Would the <a href="http://docs.rs">docs.rs</a> issue have happened if it's just published, but not used?</p>
</blockquote>
<p>I'm not sure what you mean by not used</p>



<a name="228879978"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/.cargo/config%20clarification/near/228879978" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2Ecargo.2Fconfig.20clarification.html#228879978">(Mar 05 2021 at 01:10)</a>:</h4>
<p>cargo doesn't have a setting to ignore .cargo/config AFAIK</p>



<a name="228880723"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/.cargo/config%20clarification/near/228880723" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2Ecargo.2Fconfig.20clarification.html#228880723">(Mar 05 2021 at 01:17)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/122651-general/topic/.2Ecargo.2Fconfig.20clarification/near/228879978">said</a>:</p>
<blockquote>
<p>cargo doesn't have a setting to ignore .cargo/config AFAIK</p>
</blockquote>
<p>yeah, but what loka said above is true. I just checked: if i depend on <code>safe_arch</code>, and then do a <code>cargo build --verbose</code>, I don't have target-cpu=native in my rustflags.</p>



<a name="228880845"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/.cargo/config%20clarification/near/228880845" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2Ecargo.2Fconfig.20clarification.html#228880845">(Mar 05 2021 at 01:18)</a>:</h4>
<p>oh right - this was when documenting the crate with a .cargo/config</p>



<a name="228880859"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/.cargo/config%20clarification/near/228880859" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2Ecargo.2Fconfig.20clarification.html#228880859">(Mar 05 2021 at 01:18)</a>:</h4>
<p>not a crate that depended on it</p>



<a name="228880880"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/.cargo/config%20clarification/near/228880880" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2Ecargo.2Fconfig.20clarification.html#228880880">(Mar 05 2021 at 01:18)</a>:</h4>
<p>So it's clear that the stuff in .cargo/config.toml of dependencies isn't considered. This tracks with what's described <a href="https://doc.rust-lang.org/cargo/reference/config.html#hierarchical-structure">https://doc.rust-lang.org/cargo/reference/config.html#hierarchical-structure</a></p>



<a name="228881510"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/.cargo/config%20clarification/near/228881510" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2Ecargo.2Fconfig.20clarification.html#228881510">(Mar 05 2021 at 01:23)</a>:</h4>
<p>but, supposedly it works for them so, idk. some form of documentation (even loose "docs" like github discussions in an official repo), that says that this is the case would be nice.</p>
<p>(It's not my repository, and I'm arguing that a patch that sets this won't fix a bug)</p>
<p>EDIT: I convinced them, but it's probably worth documenting this <em>somewhere</em></p>



<a name="228892775"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/.cargo/config%20clarification/near/228892775" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2Ecargo.2Fconfig.20clarification.html#228892775">(Mar 05 2021 at 03:37)</a>:</h4>
<p>document that... config.toml can become transitive if the dep is used through a path dependency?</p>



<a name="228893464"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/.cargo/config%20clarification/near/228893464" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2Ecargo.2Fconfig.20clarification.html#228893464">(Mar 05 2021 at 03:47)</a>:</h4>
<p>specifically document when (if ever) .cargo/config.toml from a dependency is used. if it's never used, document that.</p>
<p>AFAICT it definitely isn't used for stuff from <a href="http://crates.io">crates.io</a>. Supposedly it might be used for <code>git</code> and <code>path</code> dependencies, which should be documented if so.</p>



<a name="228893495"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/.cargo/config%20clarification/near/228893495" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2Ecargo.2Fconfig.20clarification.html#228893495">(Mar 05 2021 at 03:48)</a>:</h4>
<p>Hrm, i probably should have opened this in t-cargo, but i was hoping it was a case of "you just arent looking in the right place for the docs"</p>



<a name="228894520"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/.cargo/config%20clarification/near/228894520" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/.2Ecargo.2Fconfig.20clarification.html#228894520">(Mar 05 2021 at 04:02)</a>:</h4>
<p><span class="user-mention silent" data-user-id="209168">Thom Chiovoloni</span> <a href="#narrow/stream/122651-general/topic/.2Ecargo.2Fconfig.20clarification/near/228893464">said</a>:</p>
<blockquote>
<p>specifically document when (if ever) .cargo/config.toml from a dependency is used. if it's never used, document that.</p>
<p>AFAICT it definitely isn't used for stuff from <a href="http://crates.io">crates.io</a>. Supposedly it might be used for <code>git</code> and <code>path</code> dependencies, which should be documented if so.</p>
</blockquote>
<p>I just tried it with both path deps and git deps (<a href="https://github.com/thomcc/test-cargo-config-deps">https://github.com/thomcc/test-cargo-config-deps</a> and <a href="https://github.com/thomcc/test-cargo-config-gitdep">https://github.com/thomcc/test-cargo-config-gitdep</a>) and it doesn't work like the person in the issue is (still, actually) insisting. AFAICT there's no way for a dependency to modify the cargo configuration.</p>
<p>This should be documented, that .cargo/config.toml is essentially local config only.</p>



<hr><p>Last updated: Aug 07 2021 at 22:04 UTC</p>
</html>