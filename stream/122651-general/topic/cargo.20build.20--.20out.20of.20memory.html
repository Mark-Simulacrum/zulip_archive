<html>
<head><meta charset="utf-8"><title>cargo build -- out of memory · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cargo.20build.20--.20out.20of.20memory.html">cargo build -- out of memory</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="253102997"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20build%20--%20out%20of%20memory/near/253102997" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Speare <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cargo.20build.20--.20out.20of.20memory.html#253102997">(Sep 13 2021 at 14:53)</a>:</h4>
<p>Hey all, I am attempting to build a rust application (not my code) using <code>cargo build --release</code>. The build machine is 8 cores, 16gb. The behavior I am seeing is that all RAM is slowly chewed up over the course of about an hour before it dies with exit code 137 (out of memory). What changes can I make to improve/prevent this behavior?</p>



<a name="253103161"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20build%20--%20out%20of%20memory/near/253103161" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cargo.20build.20--.20out.20of.20memory.html#253103161">(Sep 13 2021 at 14:54)</a>:</h4>
<p>You can pass <code>-j 4</code> to cargo to limit the number of parallel jobs</p>



<a name="253104154"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20build%20--%20out%20of%20memory/near/253104154" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Speare <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cargo.20build.20--.20out.20of.20memory.html#253104154">(Sep 13 2021 at 15:00)</a>:</h4>
<p>Thanks Jonas. That is actually related to another question I have, which is that it only ever seems to be running on one of the 8 cores.</p>



<a name="253104396"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20build%20--%20out%20of%20memory/near/253104396" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cargo.20build.20--.20out.20of.20memory.html#253104396">(Sep 13 2021 at 15:01)</a>:</h4>
<p>Ah, then the issue might be with how a single crate is structured</p>



<a name="253105123"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20build%20--%20out%20of%20memory/near/253105123" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Emil Gardström <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cargo.20build.20--.20out.20of.20memory.html#253105123">(Sep 13 2021 at 15:05)</a>:</h4>
<p>What version of rust are you using? <span class="user-mention" data-user-id="439929">@Nick Speare</span> </p>
<p><code>cargo -Vv</code></p>



<a name="253105202"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20build%20--%20out%20of%20memory/near/253105202" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Speare <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cargo.20build.20--.20out.20of.20memory.html#253105202">(Sep 13 2021 at 15:05)</a>:</h4>
<p>rust:1.41</p>



<a name="253106730"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20build%20--%20out%20of%20memory/near/253106730" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Speare <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cargo.20build.20--.20out.20of.20memory.html#253106730">(Sep 13 2021 at 15:15)</a>:</h4>
<p>i'll test with rust:latest and see if the behavior improves</p>



<a name="253109478"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20build%20--%20out%20of%20memory/near/253109478" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Speare <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cargo.20build.20--.20out.20of.20memory.html#253109478">(Sep 13 2021 at 15:31)</a>:</h4>
<p>No change in behavior with rust 1.55. <code>cargo build --release -j4</code> still only utilizes one core at a time, and still slowly consumes all memory until SIGKILL</p>



<a name="253111835"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20build%20--%20out%20of%20memory/near/253111835" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cargo.20build.20--.20out.20of.20memory.html#253111835">(Sep 13 2021 at 15:43)</a>:</h4>
<p>If it only uses a single core it is likely still running in the frontend. Codegen and optimizations happen on multiple threads, the frontend is currently limited to a single thread.</p>



<a name="253123359"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20build%20--%20out%20of%20memory/near/253123359" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cargo.20build.20--.20out.20of.20memory.html#253123359">(Sep 13 2021 at 16:55)</a>:</h4>
<p>does it compile for other people?</p>



<a name="253125260"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20build%20--%20out%20of%20memory/near/253125260" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Speare <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cargo.20build.20--.20out.20of.20memory.html#253125260">(Sep 13 2021 at 17:08)</a>:</h4>
<p>Well, the bigger issue than the cpu utilization is the devouring of memory. We increased the build server from 16 to 32 gb, but that seems very excessive to me.</p>



<a name="253125845"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20build%20--%20out%20of%20memory/near/253125845" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cargo.20build.20--.20out.20of.20memory.html#253125845">(Sep 13 2021 at 17:12)</a>:</h4>
<p>Is the code available? Generally speaking, this is almost certainly a performance bug at least.</p>



<a name="253126159"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20build%20--%20out%20of%20memory/near/253126159" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Timothy Maloney <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cargo.20build.20--.20out.20of.20memory.html#253126159">(Sep 13 2021 at 17:14)</a>:</h4>
<p>Not sure if this is relevant or helpful, but the query system <em>is</em> parallel in the nightly compiler. You have to turn it on by enabling it in the config.toml. That might be why it's only running on one thread.</p>
<p>also; according to the rustc-dev-guide, performance degrades if there are more than 4 threads.</p>



<a name="253126608"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20build%20--%20out%20of%20memory/near/253126608" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Speare <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cargo.20build.20--.20out.20of.20memory.html#253126608">(Sep 13 2021 at 17:17)</a>:</h4>
<p><span class="user-mention" data-user-id="116122">@simulacrum</span> not publicly available, unfortunately</p>



<a name="253127251"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20build%20--%20out%20of%20memory/near/253127251" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cargo.20build.20--.20out.20of.20memory.html#253127251">(Sep 13 2021 at 17:21)</a>:</h4>
<p>The query system isn't parallel in rustup distributed builds</p>



<a name="253127378"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20build%20--%20out%20of%20memory/near/253127378" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cargo.20build.20--.20out.20of.20memory.html#253127378">(Sep 13 2021 at 17:22)</a>:</h4>
<p>If the devguide says otherwise, it's wrong</p>



<a name="253128299"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20build%20--%20out%20of%20memory/near/253128299" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Timothy Maloney <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cargo.20build.20--.20out.20of.20memory.html#253128299">(Sep 13 2021 at 17:27)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116122">simulacrum</span> <a href="#narrow/stream/122651-general/topic/cargo.20build.20--.20out.20of.20memory/near/253127378">said</a>:</p>
<blockquote>
<p>If the devguide says otherwise, it's wrong</p>
</blockquote>
<p>I don't think it does. This was an incorrect assumption on my part.</p>



<a name="253131957"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20build%20--%20out%20of%20memory/near/253131957" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cargo.20build.20--.20out.20of.20memory.html#253131957">(Sep 13 2021 at 17:53)</a>:</h4>
<p>Wasn't there some script or compiler flag that monitors RSS?</p>



<a name="253132593"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20build%20--%20out%20of%20memory/near/253132593" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cargo.20build.20--.20out.20of.20memory.html#253132593">(Sep 13 2021 at 17:57)</a>:</h4>
<p>something like <code>-Z time-passes</code> you mean ?</p>



<a name="253132873"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20build%20--%20out%20of%20memory/near/253132873" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cargo.20build.20--.20out.20of.20memory.html#253132873">(Sep 13 2021 at 17:59)</a>:</h4>
<p>that's the one</p>



<a name="253255379"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20build%20--%20out%20of%20memory/near/253255379" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Trevor Arjeski <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cargo.20build.20--.20out.20of.20memory.html#253255379">(Sep 14 2021 at 13:58)</a>:</h4>
<p>i'm getting this too on the most recent nightly. does not happen on an older version</p>



<a name="253255822"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20build%20--%20out%20of%20memory/near/253255822" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Trevor Arjeski <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cargo.20build.20--.20out.20of.20memory.html#253255822">(Sep 14 2021 at 14:00)</a>:</h4>
<p>is there a way to get more debug information? memory keeps going up and then cargo gets SIGKILL'd</p>



<a name="253255970"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20build%20--%20out%20of%20memory/near/253255970" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Trevor Arjeski <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cargo.20build.20--.20out.20of.20memory.html#253255970">(Sep 14 2021 at 14:01)</a>:</h4>
<p>i'm in the process of adding extra codegen options, just to see, but the project is quite large and takes a long time to build so it's taking up a ton of time</p>



<a name="253277891"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20build%20--%20out%20of%20memory/near/253277891" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cargo.20build.20--.20out.20of.20memory.html#253277891">(Sep 14 2021 at 16:12)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116113">lqd</span> <a href="#narrow/stream/122651-general/topic/cargo.20build.20--.20out.20of.20memory/near/253132593">said</a>:</p>
<blockquote>
<p>something like <code>-Z time-passes</code> you mean ?</p>
</blockquote>
<p><span aria-label="point up" class="emoji emoji-1f446" role="img" title="point up">:point_up:</span></p>



<a name="253284774"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20build%20--%20out%20of%20memory/near/253284774" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Trevor Arjeski <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cargo.20build.20--.20out.20of.20memory.html#253284774">(Sep 14 2021 at 16:57)</a>:</h4>
<p>yeah, i figured that one out actually. it doesn't really help me since i can't figure out where the endless loop it. the times seems pretty reasonable in time-passes</p>



<a name="253286000"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20build%20--%20out%20of%20memory/near/253286000" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cargo.20build.20--.20out.20of.20memory.html#253286000">(Sep 14 2021 at 17:04)</a>:</h4>
<p><span class="user-mention" data-user-id="439914">@Trevor Arjeski</span> this is silly, but it sometimes works - try running it under gdb, then hit control+c after like 10-15 seconds, and wherever it stops must be part of the loop</p>



<a name="253286014"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20build%20--%20out%20of%20memory/near/253286014" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cargo.20build.20--.20out.20of.20memory.html#253286014">(Sep 14 2021 at 17:04)</a>:</h4>
<p>in that case attaching gdb and getting a stack trace may help</p>



<a name="253286662"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20build%20--%20out%20of%20memory/near/253286662" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Trevor Arjeski <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cargo.20build.20--.20out.20of.20memory.html#253286662">(Sep 14 2021 at 17:08)</a>:</h4>
<p>lol ok i will try it</p>



<a name="253286849"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20build%20--%20out%20of%20memory/near/253286849" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Trevor Arjeski <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cargo.20build.20--.20out.20of.20memory.html#253286849">(Sep 14 2021 at 17:09)</a>:</h4>
<p>need to figure out how first :D</p>



<a name="253286944"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20build%20--%20out%20of%20memory/near/253286944" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cargo.20build.20--.20out.20of.20memory.html#253286944">(Sep 14 2021 at 17:10)</a>:</h4>
<p><code>gdb $(rustup which rustc)</code> and then <code>run src/lib.rs</code> (or whatever cargo passes)</p>



<a name="253287620"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20build%20--%20out%20of%20memory/near/253287620" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Trevor Arjeski <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cargo.20build.20--.20out.20of.20memory.html#253287620">(Sep 14 2021 at 17:14)</a>:</h4>
<p><span class="user-mention" data-user-id="232545">@Joshua Nelson</span> thanks but i can't even see what <code>cargo b --release</code> evaluates to</p>



<a name="253287658"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20build%20--%20out%20of%20memory/near/253287658" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cargo.20build.20--.20out.20of.20memory.html#253287658">(Sep 14 2021 at 17:14)</a>:</h4>
<p><span class="user-mention silent" data-user-id="439914">Trevor Arjeski</span> <a href="#narrow/stream/122651-general/topic/cargo.20build.20--.20out.20of.20memory/near/253287620">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> thanks but i can't even see what <code>cargo b --release</code> evaluates to</p>
</blockquote>
<p>add <code>-v</code></p>



<a name="253287957"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20build%20--%20out%20of%20memory/near/253287957" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Trevor Arjeski <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cargo.20build.20--.20out.20of.20memory.html#253287957">(Sep 14 2021 at 17:16)</a>:</h4>
<p>ah ok. i guess i need to wait 15 minutes till it gets to the crate that freezes <span aria-label="joy" class="emoji emoji-1f602" role="img" title="joy">:joy:</span></p>



<a name="253292106"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20build%20--%20out%20of%20memory/near/253292106" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Trevor Arjeski <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cargo.20build.20--.20out.20of.20memory.html#253292106">(Sep 14 2021 at 17:41)</a>:</h4>
<p>my god this is tough when you have a <a href="http://build.rs">build.rs</a></p>



<a name="253292532"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20build%20--%20out%20of%20memory/near/253292532" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cargo.20build.20--.20out.20of.20memory.html#253292532">(Sep 14 2021 at 17:44)</a>:</h4>
<p>attaching to an already running process also is an option. check which process is eating memory and then <code>gdb attach &lt;pid&gt;</code></p>



<a name="253296215"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20build%20--%20out%20of%20memory/near/253296215" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Trevor Arjeski <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cargo.20build.20--.20out.20of.20memory.html#253296215">(Sep 14 2021 at 18:08)</a>:</h4>
<p>do i just leave it until it gets SIGKILL'd?</p>



<a name="253299427"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20build%20--%20out%20of%20memory/near/253299427" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Trevor Arjeski <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cargo.20build.20--.20out.20of.20memory.html#253299427">(Sep 14 2021 at 18:27)</a>:</h4>
<p>ok nice at least i got a backtrace now...not that i have any clue how to proceed <span aria-label="sob" class="emoji emoji-1f62d" role="img" title="sob">:sob:</span></p>



<a name="253305182"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20build%20--%20out%20of%20memory/near/253305182" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cargo.20build.20--.20out.20of.20memory.html#253305182">(Sep 14 2021 at 19:03)</a>:</h4>
<p>Can you post the backtrace?</p>



<a name="253305358"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20build%20--%20out%20of%20memory/near/253305358" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cargo.20build.20--.20out.20of.20memory.html#253305358">(Sep 14 2021 at 19:04)</a>:</h4>
<p>By the way I think you need to do <code>thread apply all bt</code> to get a backtrace for all threads including the main rustc thread (which is not the main thread of the rustc process)</p>



<a name="253307280"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20build%20--%20out%20of%20memory/near/253307280" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Trevor Arjeski <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cargo.20build.20--.20out.20of.20memory.html#253307280">(Sep 14 2021 at 19:17)</a>:</h4>
<p><span class="user-mention" data-user-id="133247">@bjorn3</span> sure, let me try that and get the backtrace</p>



<a name="253316581"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20build%20--%20out%20of%20memory/near/253316581" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Trevor Arjeski <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cargo.20build.20--.20out.20of.20memory.html#253316581">(Sep 14 2021 at 20:14)</a>:</h4>
<p><span class="user-mention" data-user-id="133247">@bjorn3</span> not sure if this is very helpful, but i got a random backtrace where it's hanging (on linkage): <a href="https://paste.ee/p/yWP87">https://paste.ee/p/yWP87</a></p>



<a name="253317305"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20build%20--%20out%20of%20memory/near/253317305" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cargo.20build.20--.20out.20of.20memory.html#253317305">(Sep 14 2021 at 20:19)</a>:</h4>
<p>It seems to be hanging during the monomorphization collector or trait selection. Could you select frame 33 and then step and see if it pauses execution again within reasonable time. If not, the hang is within trait selection, if it does the hang is within the monomorphization collector.</p>



<a name="253317334"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20build%20--%20out%20of%20memory/near/253317334" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cargo.20build.20--.20out.20of.20memory.html#253317334">(Sep 14 2021 at 20:19)</a>:</h4>
<div class="codehilite"><pre><span></span><code>(gdb) frame 33
(gdb) step
</code></pre></div>
<p>I think</p>



<a name="253373968"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20build%20--%20out%20of%20memory/near/253373968" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Trevor Arjeski <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cargo.20build.20--.20out.20of.20memory.html#253373968">(Sep 15 2021 at 07:32)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="133247">@bjorn3</span> , it did not hang (went instantly to next frame after <code>step</code>)</p>



<a name="253376109"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20build%20--%20out%20of%20memory/near/253376109" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Trevor Arjeski <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cargo.20build.20--.20out.20of.20memory.html#253376109">(Sep 15 2021 at 07:57)</a>:</h4>
<p>do i need to download the rustc source and compile it myself with debug info on so that i can see what's going on more?</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>