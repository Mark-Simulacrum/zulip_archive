<html>
<head><meta charset="utf-8"><title>Inherit the trait impl of &amp;T for T · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Inherit.20the.20trait.20impl.20of.20.26T.20for.20T.html">Inherit the trait impl of &amp;T for T</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="256894347"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Inherit%20the%20trait%20impl%20of%20%26T%20for%20T/near/256894347" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kev <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Inherit.20the.20trait.20impl.20of.20.26T.20for.20T.html#256894347">(Oct 09 2021 at 19:50)</a>:</h4>
<p>The following code fails to compile because ReadA is implemented for &amp;T and not T, is there a way to have the impl for T be taken from the impl for &amp;T? In the code it is only possible to pass T.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">trait</span><span class="w"> </span><span class="n">ReadA</span><span class="w"> </span>:<span class="nb">Copy</span> <span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">trait</span><span class="w"> </span><span class="n">WriteA</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">write</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">trait</span><span class="w"> </span><span class="n">ReadWriteA</span><span class="w"> </span>: <span class="nc">ReadA</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">WriteA</span><span class="p">{}</span><span class="w"></span>
<span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span>: <span class="nc">ReadA</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">WriteA</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ReadWriteA</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>


<span class="k">struct</span> <span class="nc">DB</span><span class="p">;</span><span class="w"></span>


<span class="k">impl</span><span class="w"> </span><span class="n">ReadA</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">&amp;</span><span class="n">DB</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">impl</span><span class="w"> </span><span class="n">WriteA</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">DB</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">write</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>


<span class="k">fn</span> <span class="nf">read_and_write</span><span class="o">&lt;</span><span class="n">R</span><span class="w"> </span>: <span class="nc">ReadWriteA</span><span class="o">&gt;</span><span class="p">(</span><span class="n">a</span><span class="w"> </span>: <span class="nc">R</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">failing_code</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">db</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DB</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">read_and_write</span><span class="p">(</span><span class="n">db</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="256894808"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Inherit%20the%20trait%20impl%20of%20%26T%20for%20T/near/256894808" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Inherit.20the.20trait.20impl.20of.20.26T.20for.20T.html#256894808">(Oct 09 2021 at 19:58)</a>:</h4>
<p>Can't you use <code>read_and_write(&amp;db);</code>?</p>



<a name="256894826"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Inherit%20the%20trait%20impl%20of%20%26T%20for%20T/near/256894826" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Inherit.20the.20trait.20impl.20of.20.26T.20for.20T.html#256894826">(Oct 09 2021 at 19:58)</a>:</h4>
<p>You couldn't implement <code>ReadA</code> for <code>DB</code> because <code>DB</code> is not <code>Copy</code>.</p>



<a name="256894858"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Inherit%20the%20trait%20impl%20of%20%26T%20for%20T/near/256894858" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kev <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Inherit.20the.20trait.20impl.20of.20.26T.20for.20T.html#256894858">(Oct 09 2021 at 19:59)</a>:</h4>
<p><span class="user-mention silent" data-user-id="303710">Gary Guo</span> <a href="#narrow/stream/122651-general/topic/Inherit.20the.20trait.20impl.20of.20.26T.20for.20T/near/256894808">said</a>:</p>
<blockquote>
<p>Can't you use <code>read_and_write(&amp;db);</code>?</p>
</blockquote>
<p>That fails because WriteA is implemented for &amp;DB</p>



<a name="256894946"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Inherit%20the%20trait%20impl%20of%20%26T%20for%20T/near/256894946" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kev <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Inherit.20the.20trait.20impl.20of.20.26T.20for.20T.html#256894946">(Oct 09 2021 at 20:00)</a>:</h4>
<p><span class="user-mention silent" data-user-id="303710">Gary Guo</span> <a href="#narrow/stream/122651-general/topic/Inherit.20the.20trait.20impl.20of.20.26T.20for.20T/near/256894826">said</a>:</p>
<blockquote>
<p>You couldn't implement <code>ReadA</code> for <code>DB</code> because <code>DB</code> is not <code>Copy</code>.</p>
</blockquote>
<p>Right exactly, but &amp;DB is Copy and it can be gotten from DB, so I thought there would be a way to signal this</p>



<a name="256894984"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Inherit%20the%20trait%20impl%20of%20%26T%20for%20T/near/256894984" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Inherit.20the.20trait.20impl.20of.20.26T.20for.20T.html#256894984">(Oct 09 2021 at 20:00)</a>:</h4>
<p>Do you control the definition of ReadA or WriteA?</p>



<a name="256894993"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Inherit%20the%20trait%20impl%20of%20%26T%20for%20T/near/256894993" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kev <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Inherit.20the.20trait.20impl.20of.20.26T.20for.20T.html#256894993">(Oct 09 2021 at 20:00)</a>:</h4>
<p>Yep</p>



<a name="256895036"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Inherit%20the%20trait%20impl%20of%20%26T%20for%20T/near/256895036" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Inherit.20the.20trait.20impl.20of.20.26T.20for.20T.html#256895036">(Oct 09 2021 at 20:01)</a>:</h4>
<p>Why does ReadA take <code>self</code>? Do you need to implement it for a custom reference-like type?</p>



<a name="256895120"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Inherit%20the%20trait%20impl%20of%20%26T%20for%20T/near/256895120" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kev <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Inherit.20the.20trait.20impl.20of.20.26T.20for.20T.html#256895120">(Oct 09 2021 at 20:02)</a>:</h4>
<p><span class="user-mention silent" data-user-id="303710">Gary Guo</span> <a href="#narrow/stream/122651-general/topic/Inherit.20the.20trait.20impl.20of.20.26T.20for.20T/near/256895036">said</a>:</p>
<blockquote>
<p>Why does ReadA take <code>self</code>? Do you need to implement it for a custom reference-like type?</p>
</blockquote>
<p>Because later on in the code I have something like:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">return_read_only_db</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">impl</span><span class="w"> </span><span class="n">ReadA</span><span class="w"></span>
</code></pre></div>



<a name="256895249"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Inherit%20the%20trait%20impl%20of%20%26T%20for%20T/near/256895249" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kev <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Inherit.20the.20trait.20impl.20of.20.26T.20for.20T.html#256895249">(Oct 09 2021 at 20:04)</a>:</h4>
<p>If I implement ReadA on DB, then I'm a bit stuck because DB is not Copyable and so the above function would fail since it is &amp;self and I cannot move self.DB out from behind the shared reference</p>



<a name="256895392"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Inherit%20the%20trait%20impl%20of%20%26T%20for%20T/near/256895392" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kev <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Inherit.20the.20trait.20impl.20of.20.26T.20for.20T.html#256895392">(Oct 09 2021 at 20:07)</a>:</h4>
<p>There are places in the code which only need a <code>ReadA</code> which is why it's structured a bit funny. </p>
<p>I wonder if I am doing something that fundamentally cannot/should not be done in Rust?</p>



<a name="256897141"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Inherit%20the%20trait%20impl%20of%20%26T%20for%20T/near/256897141" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Inherit.20the.20trait.20impl.20of.20.26T.20for.20T.html#256897141">(Oct 09 2021 at 20:36)</a>:</h4>
<p>You can return <code>&amp;impl ReadA</code></p>



<a name="256897972"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Inherit%20the%20trait%20impl%20of%20%26T%20for%20T/near/256897972" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kev <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Inherit.20the.20trait.20impl.20of.20.26T.20for.20T.html#256897972">(Oct 09 2021 at 20:51)</a>:</h4>
<p><span class="user-mention silent" data-user-id="303710">Gary Guo</span> <a href="#narrow/stream/122651-general/topic/Inherit.20the.20trait.20impl.20of.20.26T.20for.20T/near/256897141">said</a>:</p>
<blockquote>
<p>You can return <code>&amp;impl ReadA</code></p>
</blockquote>
<p>that works, thanks!</p>



<a name="256898421"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Inherit%20the%20trait%20impl%20of%20%26T%20for%20T/near/256898421" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kev <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Inherit.20the.20trait.20impl.20of.20.26T.20for.20T.html#256898421">(Oct 09 2021 at 20:59)</a>:</h4>
<p>Would still be interested to know why the original code was not possible. </p>
<p>Minimised:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">impl</span><span class="w"> </span><span class="n">traitA</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">Foo</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="k">impl</span><span class="w"> </span><span class="n">traitB</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Foo</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="k">trait</span><span class="w"> </span><span class="n">C</span><span class="w"> </span>: <span class="nc">traitA</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">traitB</span><span class="w">  </span><span class="p">{}</span><span class="w"></span>

<span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span>: <span class="nc">traitA</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">traitB</span><span class="o">&gt;</span><span class="w"> </span><span class="n">traitC</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="c1">// Foo implements trait C, because it inherits the impl of trait A from &amp;mut Foo and the impl of trait B from &amp;Foo</span>
</code></pre></div>



<a name="256901113"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Inherit%20the%20trait%20impl%20of%20%26T%20for%20T/near/256901113" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Inherit.20the.20trait.20impl.20of.20.26T.20for.20T.html#256901113">(Oct 09 2021 at 21:44)</a>:</h4>
<p>The issue is that &amp;mut and &amp; are different types</p>



<a name="256901133"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Inherit%20the%20trait%20impl%20of%20%26T%20for%20T/near/256901133" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Inherit.20the.20trait.20impl.20of.20.26T.20for.20T.html#256901133">(Oct 09 2021 at 21:45)</a>:</h4>
<p>And you can't implement traitB for <code>&amp;mut Foo</code> because <code>&amp;mut</code> is not <code>Copy</code>.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>