<html>
<head><meta charset="utf-8"><title>i686-unknown-serenityos · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/i686-unknown-serenityos.html">i686-unknown-serenityos</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="271063037"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/i686-unknown-serenityos/near/271063037" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> infrandomness <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/i686-unknown-serenityos.html#271063037">(Feb 08 2022 at 00:16)</a>:</h4>
<p>This is the continuation to the discussion in <a class="stream" data-stream-id="122651" href="/#narrow/stream/122651-general">#general</a> / New target. <br>
This topic is about implementing a new rust target for i686_serenityos</p>



<a name="271161043"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/i686-unknown-serenityos/near/271161043" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> infrandomness <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/i686-unknown-serenityos.html#271161043">(Feb 08 2022 at 17:22)</a>:</h4>
<p>I appear to be stuck up with LLVM<br>
I have my rust fork, my LLVM fork (it has a branch that's been made from LLVM 13.0.0) (with the changes to make the target supported applied in one of its branches)<br>
I have checked out rust/master to make my branch off of this tag, and I have added to src/llvm-project my llvm fork remote and checked out the branch that contains the LLVM changes, but for whatever reason, everytime I try to run "./x.py build --stage 2 --target=i686-pc-serenity", rust spits this : </p>
<div class="codehilite"><pre><span></span><code>Caused by:
  process didn&#39;t exit successfully: `/home/infrandomness/CLionProjects/rust/build/bootstrap/debug/rustc - --crate-name ___ --print=file-names -Csymbol-mangling-version=legacy -Zunstable-options -Zmacro-backtrace -Clink-args=-Wl,-z,origin &#39;-Clink-args=-Wl,-rpath,$ORIGIN/../lib&#39; -Cprefer-dynamic -Cllvm-args=-import-instr-limit=10 -Cembed-bitcode=yes &#39;-Zcrate-attr=doc(html_root_url=&quot;https://doc.rust-lang.org/nightly/&quot;)&#39; --target i686-pc-serenity --crate-type bin --crate-type rlib --crate-type dylib --crate-type cdylib --crate-type staticlib --crate-type proc-macro --print=sysroot --print=cfg` (exit status: 1)
  --- stderr
  error: Could not create LLVM TargetMachine for triple: i686_pc_serenity: No available targets are compatible with triple &quot;i686_pc_serenity&quot;
</code></pre></div>
<p>After a littlebit of investigating, I tried to do what's written <a href="https://rustc-dev-guide.rust-lang.org/building/new-target.html#using-pre-built-llvm">here</a> and tried to push upstream the updates I brought to the llvm submodules, I saw that everytime I try to run ""./x.py build --stage 2 --target=i686-pc-serenity", the script checks out another version of LLVM in src/llvm-project; so I thought to myself maybe this version is too recent and needs a more recent LLVM version. So I tried creating another branch from the tag 1.56.0, but for some reason, rust now spits this : </p>
<div class="codehilite"><pre><span></span><code>error: failed to load manifest for workspace member `/home/infrandomness/CLionProjects/rust/src/tools/cargo`

Caused by:
  failed to parse manifest at `/home/infrandomness/CLionProjects/rust/src/tools/cargo/Cargo.toml`

Caused by:
  feature `edition2021` is required

  The package requires the Cargo feature called `edition2021`, but that feature is not stabilized in this version of Cargo (1.55.0 (32da73ab1 2021-08-23)).
  Consider trying a newer version of Cargo (this may require the nightly release).
  See https://doc.rust-lang.org/nightly/cargo/reference/unstable.html#edition-2021 for more information about the status of this feature.
</code></pre></div>



<a name="271162022"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/i686-unknown-serenityos/near/271162022" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/i686-unknown-serenityos.html#271162022">(Feb 08 2022 at 17:28)</a>:</h4>
<blockquote>
<p><code>error: Could not create LLVM TargetMachine for triple: i686_pc_serenity: No available targets are compatible with triple "i686_pc_serenity"</code></p>
</blockquote>
<p><code>llvm_triple</code> probably needs to be set to <code>i686-pc-serenity</code> with <code>-</code> and not <code>_</code>.</p>



<a name="271162132"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/i686-unknown-serenityos/near/271162132" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> infrandomness <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/i686-unknown-serenityos.html#271162132">(Feb 08 2022 at 17:29)</a>:</h4>
<p>I hope I did not just overlook something that simple, ugh...</p>



<a name="271177398"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/i686-unknown-serenityos/near/271177398" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> infrandomness <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/i686-unknown-serenityos.html#271177398">(Feb 08 2022 at 19:18)</a>:</h4>
<p>it was just that, thanks for pointing it out <span class="user-mention" data-user-id="133247">@bjorn3</span> !</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>