<html>
<head><meta charset="utf-8"><title>rpath · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/rpath.html">rpath</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="275778090"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/rpath/near/275778090" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> catch22 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/rpath.html#275778090">(Mar 18 2022 at 09:30)</a>:</h4>
<p>Is it possible to set the runtime library search path ( rpath ) from cargo?</p>



<a name="275778685"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/rpath/near/275778685" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/rpath.html#275778685">(Mar 18 2022 at 09:37)</a>:</h4>
<p><span class="user-mention" data-user-id="457263">@catch22</span> You can set <code>rpath = true</code> inside a cargo profile. For example</p>
<div class="codehilite" data-code-language="TOML"><pre><span></span><code><span class="k">[profile.dev]</span><span class="w"></span>
<span class="n">rpath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="w"></span>

<span class="k">[profile.release]</span><span class="w"></span>
<span class="n">rpath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="w"></span>
</code></pre></div>
<p>Note that rustc doesn't directly support choosing what rpath to use. It will use the directory of the executable. To specify a specific rpath that you need to pass <code>-Clink-arg=...</code> to rustc with whatever argument the linker needs to specify a specific rpath.</p>



<a name="275779076"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/rpath/near/275779076" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> catch22 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/rpath.html#275779076">(Mar 18 2022 at 09:40)</a>:</h4>
<p>yes I want to control the actual rpath that is injected. I'll go try <code>-Clink-arg=...</code></p>
<p>Thanks very much</p>



<a name="275782113"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/rpath/near/275782113" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> catch22 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/rpath.html#275782113">(Mar 18 2022 at 10:06)</a>:</h4>
<p>This got the job done, <span class="user-mention" data-user-id="133247">@bjorn3</span> , thanks for the hint</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="fm">println!</span><span class="p">(</span><span class="s">"cargo:rustc-link-arg=-Wl,-rpath={}"</span><span class="p">,</span><span class="w"> </span><span class="n">shared_lib_dir</span><span class="p">.</span><span class="n">display</span><span class="p">());</span><span class="w"></span>
</code></pre></div>



<a name="275782201"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/rpath/near/275782201" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/rpath.html#275782201">(Mar 18 2022 at 10:07)</a>:</h4>
<p>If you want cross platform support you will need to check which linker is used I think. In addition windows unfortunately doesn't support rpath.</p>



<a name="275783897"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/rpath/near/275783897" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Denton <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/rpath.html#275783897">(Mar 18 2022 at 10:25)</a>:</h4>
<p>Windows has a somewhat similar application configuration option called <a href="https://docs.microsoft.com/en-us/windows/win32/sbscs/application-configuration-files#probing">"probing"</a>. Using it is a bit more involved than rpath. I guess someone could make a tool that abstracts over some of the differences.</p>



<a name="275853534"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/rpath/near/275853534" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> catch22 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/rpath.html#275853534">(Mar 18 2022 at 19:45)</a>:</h4>
<p>Interesting you mention cross-platform that's definitely required but all my uses cases are linux, just different architectures, ARM and X86 at the moment.  I need to dig into how cross compiling works with Rust, I've only read the doco</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>