<html>
<head><meta charset="utf-8"><title>reading into buffers consecutively · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/reading.20into.20buffers.20consecutively.html">reading into buffers consecutively</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="261835587"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/reading%20into%20buffers%20consecutively/near/261835587" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Scorpil <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/reading.20into.20buffers.20consecutively.html#261835587">(Nov 17 2021 at 19:31)</a>:</h4>
<p>hey everyone, newbie question here.<br>
There is this annoying pattern with Read/Write traits where</p>
<div class="codehilite"><pre><span></span><code>fn read(&amp;mut self,  mut buf: &amp;mut [u8] ) -&gt; Result&lt;usize, Error&gt; {
     let mut total_n = 0;
     match something.read(&amp;mut buf) {
      Ok(n) =&gt; total_n += n,
      Err(err) =&gt; return Err(err);
    }

    match something_else.read(&amp;mut buf) {
      Ok(n) =&gt; total_n += n,
      Err(err) =&gt; return Err(err);
    }

   Ok(total_n)
}
</code></pre></div>
<p>There must be an utility function to do the bookkeeping for me, like</p>
<div class="codehilite"><pre><span></span><code>fn read(&amp;mut self,  mut buf: &amp;mut [u8] ) -&gt; Result&lt;usize, Error&gt; {
     read_many(something, something_else)
}
</code></pre></div>
<p>Where can I find it?</p>



<a name="261835905"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/reading%20into%20buffers%20consecutively/near/261835905" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/reading.20into.20buffers.20consecutively.html#261835905">(Nov 17 2021 at 19:33)</a>:</h4>
<p>well, uh, your description would have rather destructive behavior, but I think you mean <a href="https://doc.rust-lang.org/std/io/trait.Read.html#method.chain">chain</a>?</p>



<a name="261836974"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/reading%20into%20buffers%20consecutively/near/261836974" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Scorpil <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/reading.20into.20buffers.20consecutively.html#261836974">(Nov 17 2021 at 19:41)</a>:</h4>
<p>thanks <span class="user-mention" data-user-id="330154">@The 8472</span> <code>chain</code> is what I was looking for. What do you mean by destructive behaviour?</p>



<a name="261837183"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/reading%20into%20buffers%20consecutively/near/261837183" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/reading.20into.20buffers.20consecutively.html#261837183">(Nov 17 2021 at 19:42)</a>:</h4>
<p>it would call two readers successively reading into the same buffer, thus the 2nd read overwriting the results of the 1st one. And it would do that on every read.</p>



<a name="261837835"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/reading%20into%20buffers%20consecutively/near/261837835" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Scorpil <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/reading.20into.20buffers.20consecutively.html#261837835">(Nov 17 2021 at 19:47)</a>:</h4>
<p>ah, right, because I didn't slice the output buffer. That was a mistake, idea was to append (like chain does)</p>



<a name="261838065"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/reading%20into%20buffers%20consecutively/near/261838065" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/reading.20into.20buffers.20consecutively.html#261838065">(Nov 17 2021 at 19:48)</a>:</h4>
<p>even then it would still fail if the first reader returns a short read. it would be interleaving the data from both sources instead of appending them.</p>



<a name="261841527"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/reading%20into%20buffers%20consecutively/near/261841527" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Scorpil <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/reading.20into.20buffers.20consecutively.html#261841527">(Nov 17 2021 at 20:10)</a>:</h4>
<p>noted</p>



<a name="261843056"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/reading%20into%20buffers%20consecutively/near/261843056" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Scorpil <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/reading.20into.20buffers.20consecutively.html#261843056">(Nov 17 2021 at 20:21)</a>:</h4>
<p>on a different not, what's the relation between the &amp;[T] and Vec&lt;T&gt;? Is it just that &amp;[T] doesn't allocate? So if I convert a Vec&lt;T&gt; to a &amp;[T], there is no actual conversion taking place, just a different "view" if the same memory on the heap, right? Other way around <code>&amp;[T}.as_vec()</code> must be more complicated (and expensive), since vector has the capacity and re-allocation rules. Besides, it would clone the data to heap if it's on a stack. Am I understanding this right?</p>



<a name="261843744"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/reading%20into%20buffers%20consecutively/near/261843744" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/reading.20into.20buffers.20consecutively.html#261843744">(Nov 17 2021 at 20:27)</a>:</h4>
<p><a href="https://cheats.rs/#data-layout">https://cheats.rs/#data-layout</a><br>
<a href="https://doc.rust-lang.org/book/ch04-03-slices.html">https://doc.rust-lang.org/book/ch04-03-slices.html</a><br>
Vec is an owned data structure, a slice is just a reference + length into some data structure</p>



<a name="261844024"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/reading%20into%20buffers%20consecutively/near/261844024" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/reading.20into.20buffers.20consecutively.html#261844024">(Nov 17 2021 at 20:29)</a>:</h4>
<p>a slice can reference something on the stack too, but if you take a slice from a vec then yeah it's referencing heap memory</p>



<a name="261899929"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/reading%20into%20buffers%20consecutively/near/261899929" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Scorpil <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/reading.20into.20buffers.20consecutively.html#261899929">(Nov 18 2021 at 08:44)</a>:</h4>
<p>thanks <span class="user-mention" data-user-id="330154">@The 8472</span> , you've been very helpful</p>



<a name="261915469"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/reading%20into%20buffers%20consecutively/near/261915469" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/reading.20into.20buffers.20consecutively.html#261915469">(Nov 18 2021 at 11:35)</a>:</h4>
<p>See also: <a href="/user_uploads/4715/-OuwaoEU3pUa3uX6TJ1hbInx/image.png">image.png</a> notice how <code>Vec&lt;T&gt;</code> contains a <code>ptr, len, cap</code> and how <code>&amp;[T]</code> contains a <code>ptr</code>, and thus how the <code>Deref</code> from the former to the latter is just as simple, machine-code-wise, as ignoring the <code>cap</code> field</p>
<div class="message_inline_image"><a href="/user_uploads/4715/-OuwaoEU3pUa3uX6TJ1hbInx/image.png" title="image.png"><img src="/user_uploads/4715/-OuwaoEU3pUa3uX6TJ1hbInx/image.png"></a></div>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>