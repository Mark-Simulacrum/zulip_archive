<html>
<head><meta charset="utf-8"><title>✔ value barrowed here after move · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20value.20barrowed.20here.20after.20move.html">✔ value barrowed here after move</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="270306963"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20value%20barrowed%20here%20after%20move/near/270306963" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kurtis Mullins <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20value.20barrowed.20here.20after.20move.html#270306963">(Feb 01 2022 at 23:31)</a>:</h4>
<p>Hello, I'm trying to understand what's going on under the hood here (and how to fix it):</p>
<div class="codehilite"><pre><span></span><code>fn main() {

    let states: Vec&lt;&amp;str&gt; = vec![&quot;Alaska&quot;, &quot;Alabama&quot;, &quot;Arkansas&quot;];
    for state in states {
        println!(&quot;State: {}&quot;, state);
    }

    println!(&quot;Number of States: {}&quot;, states.len())
}
</code></pre></div>
<p>The compiler complains with some of the following message:</p>
<div class="codehilite"><pre><span></span><code>move occurs because `states` has type `Vec&lt;&amp;str&gt;`, which does not implement the `Copy` trait
[...]
value borrowed here after move
</code></pre></div>
<p>I'm guessing I need to keep a reference to <code>states</code> but am not sure how, or how it's getting clobbered when I iterate.</p>



<a name="270307182"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20value%20barrowed%20here%20after%20move/near/270307182" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Goulet (compiler-errors) <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20value.20barrowed.20here.20after.20move.html#270307182">(Feb 01 2022 at 23:33)</a>:</h4>
<p><code>for state in states</code> moves the <code>states</code> vec.</p>



<a name="270307189"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20value%20barrowed%20here%20after%20move/near/270307189" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Goulet (compiler-errors) <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20value.20barrowed.20here.20after.20move.html#270307189">(Feb 01 2022 at 23:33)</a>:</h4>
<p>If you want to iterate over the <code>states</code> vec in a way that doesn't move/consume the container, you can try <code>for state in &amp;states</code>, which borrows instead of moves <code>states</code>.</p>



<a name="270307504"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20value%20barrowed%20here%20after%20move/near/270307504" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kurtis Mullins <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20value.20barrowed.20here.20after.20move.html#270307504">(Feb 01 2022 at 23:36)</a>:</h4>
<p>Thank you! I did see that working when I gave it a shot. <br>
What docs would I look at to understand why <code>for state in states</code> is actually modifying the variable <code>states</code>? (I assume the reference, not the actual vector/value)</p>



<a name="270308436"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20value%20barrowed%20here%20after%20move/near/270308436" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20value.20barrowed.20here.20after.20move.html#270308436">(Feb 01 2022 at 23:44)</a>:</h4>
<p><span class="user-mention silent" data-user-id="476039">Kurtis Mullins</span> has marked this topic as resolved.</p>



<a name="270312922"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20value%20barrowed%20here%20after%20move/near/270312922" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Félix Saparelli <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20value.20barrowed.20here.20after.20move.html#270312922">(Feb 02 2022 at 00:26)</a>:</h4>
<blockquote>
<p>why <code>for state in states</code> is actually modifying the variable</p>
</blockquote>
<p>That's not really what's happening here.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">for</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">states</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
</code></pre></div>
<p>is "sugar" for (approximately):</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">for</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nb">IntoIterator</span>::<span class="n">into_iter</span><span class="p">(</span><span class="n">states</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
</code></pre></div>
<p>and</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">for</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">&amp;</span><span class="n">states</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
</code></pre></div>
<p>is "sugar" for (approximately):</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">for</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nb">IntoIterator</span>::<span class="n">into_iter</span><span class="p">(</span><span class="o">&amp;</span><span class="n">states</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
</code></pre></div>
<p>This is <a href="https://doc.rust-lang.org/std/iter/index.html#for-loops-and-intoiterator">documented under <code>std::iter</code></a>.</p>
<p><code>::into_iter(value)</code> moves <code>value</code>: it takes ownership of it. You can see that in its definition: <a href="https://doc.rust-lang.org/std/iter/trait.IntoIterator.html#tymethod.into_iter"><code>fn into_iter(self) -&gt; Self::IntoIter</code></a>. "The variable <code>states</code>" (very roughly) doesn't exist anymore in your scope once it's moved. On the other hand, <code>::into_iter(&amp;value)</code> moves the immediately-created reference to <code>value</code> ("borrows <code>value</code>" in common parlance), thus the <code>value</code> binding still exists in your current scope and can be used later for <code>.len()</code> (which is defined as <a href="https://doc.rust-lang.org/std/vec/struct.Vec.html#method.len"><code>fn len(&amp;self) -&gt; usize</code></a> so it "borrows <code>self</code>").</p>
<p>A different way to solve your issue would be to move the length computation before the move, e.g.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">states</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">vec!</span><span class="p">[</span><span class="s">"Northland"</span><span class="p">,</span><span class="w"> </span><span class="s">"Southland"</span><span class="p">];</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">states</span><span class="p">.</span><span class="n">len</span><span class="p">();</span><span class="w"> </span><span class="c1">// borrows states</span>
<span class="k">for</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">states</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// moves states</span>
<span class="w">  </span><span class="fm">println!</span><span class="p">(</span><span class="s">"State: {state}"</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="c1">// states isn't usable anymore</span>
<span class="fm">println!</span><span class="p">(</span><span class="s">"Number of states: {len}"</span><span class="p">);</span><span class="w"> </span><span class="c1">// but len, which was pre-computed, is</span>
</code></pre></div>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>