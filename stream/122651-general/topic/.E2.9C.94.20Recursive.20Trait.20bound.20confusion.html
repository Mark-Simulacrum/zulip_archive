<html>
<head><meta charset="utf-8"><title>✔ Recursive Trait bound confusion · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20Recursive.20Trait.20bound.20confusion.html">✔ Recursive Trait bound confusion</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="262807362"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20Recursive%20Trait%20bound%20confusion/near/262807362" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tom Farmer <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20Recursive.20Trait.20bound.20confusion.html#262807362">(Nov 26 2021 at 15:11)</a>:</h4>
<p>Right okay so an implementation of Trait for Wrapper&lt;&amp;'a T&gt; is not actually a different implementation to Wrapper&lt;T&gt;?</p>



<a name="262807393"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20Recursive%20Trait%20bound%20confusion/near/262807393" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tom Farmer <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20Recursive.20Trait.20bound.20confusion.html#262807393">(Nov 26 2021 at 15:11)</a>:</h4>
<p>And the trait bound Wrapper&lt;T&gt;: Trait is just recursive in general?</p>



<a name="262807514"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20Recursive%20Trait%20bound%20confusion/near/262807514" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tom Farmer <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20Recursive.20Trait.20bound.20confusion.html#262807514">(Nov 26 2021 at 15:13)</a>:</h4>
<p><span class="user-mention silent" data-user-id="256841">Nick Cameron</span> <a href="#narrow/stream/122651-general/topic/Recursive.20Trait.20bound.20confusion/near/262805623">said</a>:</p>
<blockquote>
<p>I'm not sure if it is relevant, but note that in <code>impl&lt;Thing&gt; Trait for Wrapper&lt;Thing&gt; {}</code> you are declaring a new type variable named <code>Thing</code>, not referencing the <code>Thing</code> struct, i.e., it is equivalent to <code>impl&lt;U&gt; Trait for Wrapper&lt;U&gt; {}</code></p>
</blockquote>
<p>Ahhh okay so I'm basically just implementing the Wrapper&lt;T&gt; trait bound but with T called Thing</p>



<a name="262807704"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20Recursive%20Trait%20bound%20confusion/near/262807704" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tom Farmer <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20Recursive.20Trait.20bound.20confusion.html#262807704">(Nov 26 2021 at 15:15)</a>:</h4>
<p><span class="user-mention silent" data-user-id="280891">Frank Steffahn</span> <a href="#narrow/stream/122651-general/topic/Recursive.20Trait.20bound.20confusion/near/262805788">said</a>:</p>
<blockquote>
<p>The overflow error is just a bad diagnostic. The main issue here is that the two implementations of <code>Trait</code> are overlapping. The implementation</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">impl</span><span class="o">&lt;</span><span class="n">Thing</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Trait</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Wrapper</span><span class="o">&lt;</span><span class="n">Thing</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
</code></pre></div>
<p>is <em>generic</em> and overlaps with the other implementation e.g. for <code>Thing == &amp;'static () == &amp;'a T</code>. Your intention might have been a concrete non-generic implementation</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">impl</span><span class="w"> </span><span class="n">Trait</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Wrapper</span><span class="o">&lt;</span><span class="n">Thing</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
</code></pre></div>
<p>which doesn't produce any errors either.</p>
</blockquote>
<p>Ahh of course I've gotten my syntax wrong and introduced a new type variable Thing instead of implementing it for the concrete type Thing</p>



<a name="262807754"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20Recursive%20Trait%20bound%20confusion/near/262807754" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tom Farmer <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20Recursive.20Trait.20bound.20confusion.html#262807754">(Nov 26 2021 at 15:15)</a>:</h4>
<p>Thanks both - that makes it more clear as to what I'm missing here</p>



<a name="262807961"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20Recursive%20Trait%20bound%20confusion/near/262807961" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20Recursive.20Trait.20bound.20confusion.html#262807961">(Nov 26 2021 at 15:17)</a>:</h4>
<p><span class="user-mention silent" data-user-id="448036">Tom Farmer</span> has marked this topic as resolved.</p>



<a name="262808446"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20Recursive%20Trait%20bound%20confusion/near/262808446" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20Recursive.20Trait.20bound.20confusion.html#262808446">(Nov 26 2021 at 15:22)</a>:</h4>
<p>The compiler should really be giving you an 'overlapping impl' error there, but it appears to be getting confused by the 'where' clause</p>



<a name="262808455"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20Recursive%20Trait%20bound%20confusion/near/262808455" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20Recursive.20Trait.20bound.20confusion.html#262808455">(Nov 26 2021 at 15:22)</a>:</h4>
<p>I'll see if I can improve the diagnostic</p>



<a name="262808701"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20Recursive%20Trait%20bound%20confusion/near/262808701" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tom Farmer <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20Recursive.20Trait.20bound.20confusion.html#262808701">(Nov 26 2021 at 15:25)</a>:</h4>
<p>Yeah so I've actually been working on this myself - it's due to the fact that we always output recursion errors as soon as we hit the overflow limit during type checking <a href="https://github.com/rust-lang/rust/pull/91238">this PR</a> has a fix for a fix to prevent that happening when we're trying to provide a suggestion for a method to turn one type into another - however the minimal repro I posted above was ICEing because it comes at the recursion check from a different path during fulfilment</p>



<a name="262808791"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20Recursive%20Trait%20bound%20confusion/near/262808791" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tom Farmer <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20Recursive.20Trait.20bound.20confusion.html#262808791">(Nov 26 2021 at 15:27)</a>:</h4>
<p>So it's likely that we need to either stop emitting infinite recursion errors as soon as we hit them or figure out a way to check when it's actually useful to emit it</p>



<a name="262808851"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20Recursive%20Trait%20bound%20confusion/near/262808851" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tom Farmer <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20Recursive.20Trait.20bound.20confusion.html#262808851">(Nov 26 2021 at 15:27)</a>:</h4>
<p>But the problem I've got is I don't actually understand the type inference engine well enough to be able to check if we're recursing for no reason - just enough to fix annoyances via backtraces</p>



<a name="262808973"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20Recursive%20Trait%20bound%20confusion/near/262808973" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tom Farmer <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20Recursive.20Trait.20bound.20confusion.html#262808973">(Nov 26 2021 at 15:29)</a>:</h4>
<p>But now I know it's the where clause causing &amp; what the correct error should be (considering we already output one if we don't have a where clause) it I might be able to give a go of fixing it myself</p>



<a name="262809549"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20Recursive%20Trait%20bound%20confusion/near/262809549" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tom Farmer <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20Recursive.20Trait.20bound.20confusion.html#262809549">(Nov 26 2021 at 15:33)</a>:</h4>
<p>The minimal repro is actually slightly different &amp; has no shadowing it just recurses because there's no implementation of Trait for Thing and Thing isn't defined but we output the missing definition so I think we're okay there</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>