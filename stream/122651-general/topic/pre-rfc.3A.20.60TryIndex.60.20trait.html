<html>
<head><meta charset="utf-8"><title>pre-rfc: `TryIndex` trait · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/pre-rfc.3A.20.60TryIndex.60.20trait.html">pre-rfc: `TryIndex` trait</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="252120985"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/pre-rfc%3A%20%60TryIndex%60%20trait/near/252120985" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Klim Tsoutsman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/pre-rfc.3A.20.60TryIndex.60.20trait.html#252120985">(Sep 06 2021 at 03:04)</a>:</h4>
<p>Hi, I've been using Rust for a bit and have come to want some form of standardised <code>TryIndex</code> trait. Currently, you either need to check the bounds manually or use a <code>get</code> method that may have a different name or not even be implemented for certain types. The trait would define one function <code>try_index</code> (or <code>get</code>? This name is simpler but more confusing as it doesn't relate to the trait name), which returns an <code>Option&lt;T&gt;</code>.</p>
<p>One of the issues with naming the trait <code>TryIndex</code> is that it implies that the relationship between <code>Index</code> and <code>TryIndex</code> is the same as between <code>From</code> and <code>TryFrom</code>. This isn't entirely true as with <code>Index</code>, the function might panic if the index is incorrect (at least with arrays and vectors, which is probably the most prominent use case for <code>Index</code> anyway). However, <code>From</code>, for most types, will not panic and guarantees that a type can safely be converted to another type. This issue is best shown by the fact that <code>impl TryFrom for T where T: From</code> works but <code>impl TryIndex for T where T: Index</code> does not work (well _technically_ it works but its not what you want). You can't simply wrap the output of the <code>Index</code> trait in an <code>Option</code> to implement <code>TryIndex</code> as the call to <code>index()</code> could still panic. To mitigate this issue, the trait could be named <code>SafeIndex</code> or something along those lines, but I'm not sure about this. </p>
<p>This trait could also be added with some accompanying syntax. My suggestion would be <code>array[?i]</code>. It's not great, but any potential syntax is limited by a few factors. Firstly, I think that the syntax should include a question mark as that is often associated with trying something and <code>Option</code>s. Also, if <code>? = try</code>, the syntax kind of reads like "try index i", which makes sense. The syntax also stems from the fact that the question mark must be placed in such a location as to not be ambiguous with using the <code>Try</code> trait (i.e. <code>a[i?]</code> and <code>a[i]?</code> won't work as syntax for the <code>TryIndex</code> trait).</p>
<p>Just to close off, I've researched a bit about propositions for a <code>TryIndex</code> trait and came across <a href="https://internals.rust-lang.org/t/can-epochs-change-the-definition-of-a-stdlib-trait/7691">this</a>. I think the primary issue with that pre-RFC was that it wanted to redefine the <code>Index</code> trait instead of just adding a separate trait.</p>
<p>My experience with Rust is fairly limited, and I have never worked on the compiler, but I do, perhaps naively, think that this would be <em>relatively</em> simple to implement compared to other RFCs if it were approved.</p>



<a name="252122571"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/pre-rfc%3A%20%60TryIndex%60%20trait/near/252122571" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/pre-rfc.3A.20.60TryIndex.60.20trait.html#252122571">(Sep 06 2021 at 03:32)</a>:</h4>
<p>Can you say more about why <code>.get(i)</code> isn't enough for you?  Is it the lack of a trait, or the lack of special syntax?</p>



<a name="252123029"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/pre-rfc%3A%20%60TryIndex%60%20trait/near/252123029" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Klim Tsoutsman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/pre-rfc.3A.20.60TryIndex.60.20trait.html#252123029">(Sep 06 2021 at 03:41)</a>:</h4>
<p><span class="user-mention silent" data-user-id="125270">scottmcm</span> <a href="#narrow/stream/122651-general/topic/pre-rfc.3A.20.60TryIndex.60.20trait/near/252122571">said</a>:</p>
<blockquote>
<p>Can you say more about why <code>.get(i)</code> isn't enough for you?  Is it the lack of a trait, or the lack of special syntax?</p>
</blockquote>
<p>It's a bit of both. I think that standardising it would help catch unintended potential panics. In the long run, if this gets implemented, it could be added as a Clippy lint, similar to <a href="https://rust-lang.github.io/rust-clippy/master/#as_conversions">as_conversions</a>, that would require you to explicitly allow it, signifying that you have checked that the <code>index()</code> call won't panic.</p>
<p>I think the syntax would be nice to have, but I understand that it is not very readable and just adds to the complexity.</p>



<a name="252124418"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/pre-rfc%3A%20%60TryIndex%60%20trait/near/252124418" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/pre-rfc.3A.20.60TryIndex.60.20trait.html#252124418">(Sep 06 2021 at 04:09)</a>:</h4>
<p>FWIW, that clippy lint could exist just by convention, even without there being a trait.  It could just look for a <code>get</code>/<code>get_mut</code> method with the appropriate argument type.</p>



<a name="252231222"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/pre-rfc%3A%20%60TryIndex%60%20trait/near/252231222" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/pre-rfc.3A.20.60TryIndex.60.20trait.html#252231222">(Sep 06 2021 at 23:08)</a>:</h4>
<p>I think the ship has sailed for this, I would have liked <code>Index</code> to return an Option from the start.</p>



<a name="252231237"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/pre-rfc%3A%20%60TryIndex%60%20trait/near/252231237" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/pre-rfc.3A.20.60TryIndex.60.20trait.html#252231237">(Sep 06 2021 at 23:08)</a>:</h4>
<p>A second indexing syntax would be weird IMO.</p>



<a name="252241537"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/pre-rfc%3A%20%60TryIndex%60%20trait/near/252241537" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Klim Tsoutsman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/pre-rfc.3A.20.60TryIndex.60.20trait.html#252241537">(Sep 07 2021 at 02:09)</a>:</h4>
<p>Fair enough. I dug around in Clippy's docs some more and it seems that Clippy already <a href="https://rust-lang.github.io/rust-clippy/master/#indexing_slicing">has a lint</a> for this issue.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>