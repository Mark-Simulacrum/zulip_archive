<html>
<head><meta charset="utf-8"><title>✔ test falls into infinite loop · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20test.20falls.20into.20infinite.20loop.html">✔ test falls into infinite loop</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="247427660"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20test%20falls%20into%20infinite%20loop/near/247427660" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahdi Faramarzpour <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20test.20falls.20into.20infinite.20loop.html#247427660">(Jul 28 2021 at 06:59)</a>:</h4>
<p>I've recently stuck on an issue, which is that when I run <code>cargo test</code> one of the test cases falls in an infinite loop. I found no way of realizing which test has fallen into a loop. Currently, I have no idea how such situation should be handled.</p>
<ul>
<li>can I set a time limit for the tests to pass? and probably have cargo report which ones exceeded that limit?</li>
<li>could I make the tests execute in an specific order, so that I know on what test cargo stucks?</li>
</ul>



<a name="247427680"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20test%20falls%20into%20infinite%20loop/near/247427680" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20test.20falls.20into.20infinite.20loop.html#247427680">(Jul 28 2021 at 07:00)</a>:</h4>
<p>You can disable multithreading with <code>-j1</code>.</p>



<a name="247427790"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20test%20falls%20into%20infinite%20loop/near/247427790" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahdi Faramarzpour <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20test.20falls.20into.20infinite.20loop.html#247427790">(Jul 28 2021 at 07:00)</a>:</h4>
<p>I know, but does it really make cargo run the tests in the order I have written them?</p>



<a name="247427806"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20test%20falls%20into%20infinite%20loop/near/247427806" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20test.20falls.20into.20infinite.20loop.html#247427806">(Jul 28 2021 at 07:01)</a>:</h4>
<p>Oh, it doesn't print the name of the current test?</p>



<a name="247427813"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20test%20falls%20into%20infinite%20loop/near/247427813" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahdi Faramarzpour <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20test.20falls.20into.20infinite.20loop.html#247427813">(Jul 28 2021 at 07:01)</a>:</h4>
<p>no</p>



<a name="247427837"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20test%20falls%20into%20infinite%20loop/near/247427837" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahdi Faramarzpour <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20test.20falls.20into.20infinite.20loop.html#247427837">(Jul 28 2021 at 07:01)</a>:</h4>
<p>It just says what tests are about to be executed before running them</p>



<a name="247427918"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20test%20falls%20into%20infinite%20loop/near/247427918" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20test.20falls.20into.20infinite.20loop.html#247427918">(Jul 28 2021 at 07:03)</a>:</h4>
<p>"Running 1 test"</p>



<a name="247428022"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20test%20falls%20into%20infinite%20loop/near/247428022" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahdi Faramarzpour <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20test.20falls.20into.20infinite.20loop.html#247428022">(Jul 28 2021 at 07:04)</a>:</h4>
<p>I can have cargo only run one test; but in may case Idk which specific test should I run:(</p>



<a name="247428566"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20test%20falls%20into%20infinite%20loop/near/247428566" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20test.20falls.20into.20infinite.20loop.html#247428566">(Jul 28 2021 at 07:14)</a>:</h4>
<p>Attach a debugger to it <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="247429388"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20test%20falls%20into%20infinite%20loop/near/247429388" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahdi Faramarzpour <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20test.20falls.20into.20infinite.20loop.html#247429388">(Jul 28 2021 at 07:27)</a>:</h4>
<p>Yeah, looks like that's the only way. thanks.</p>



<a name="247429465"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20test%20falls%20into%20infinite%20loop/near/247429465" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20test.20falls.20into.20infinite.20loop.html#247429465">(Jul 28 2021 at 07:28)</a>:</h4>
<p>Or pin it down to a module, then binary-search by commenting out half of them</p>



<a name="247429512"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20test%20falls%20into%20infinite%20loop/near/247429512" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20test.20falls.20into.20infinite.20loop.html#247429512">(Jul 28 2021 at 07:29)</a>:</h4>
<p>if it says "running 1 test" there should only be one and it's the first one that's hanging.</p>



<a name="247429563"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20test%20falls%20into%20infinite%20loop/near/247429563" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahdi Faramarzpour <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20test.20falls.20into.20infinite.20loop.html#247429563">(Jul 28 2021 at 07:30)</a>:</h4>
<p><span class="user-mention silent" data-user-id="203546">Laurențiu</span> <a href="#narrow/stream/122651-general/topic/test.20falls.20into.20infinite.20loop/near/247429465">said</a>:</p>
<blockquote>
<p>Or pin it down to a module, then binary-search by commenting out half of them</p>
</blockquote>
<p>I previously thought about that, but takes so much time.</p>



<a name="247429580"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20test%20falls%20into%20infinite%20loop/near/247429580" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20test.20falls.20into.20infinite.20loop.html#247429580">(Jul 28 2021 at 07:30)</a>:</h4>
<p>Yeah, I was trying to reproduce the problem. It might as well say "running 200 tests"</p>



<a name="247429683"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20test%20falls%20into%20infinite%20loop/near/247429683" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahdi Faramarzpour <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20test.20falls.20into.20infinite.20loop.html#247429683">(Jul 28 2021 at 07:32)</a>:</h4>
<p>The only way is to attach a debugger, and see the call stack of hanging threads.</p>



<a name="247429700"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20test%20falls%20into%20infinite%20loop/near/247429700" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20test.20falls.20into.20infinite.20loop.html#247429700">(Jul 28 2021 at 07:32)</a>:</h4>
<p>also, iirc it prints a warning after 60 seconds, so just wait a bit.</p>



<a name="247430211"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20test%20falls%20into%20infinite%20loop/near/247430211" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahdi Faramarzpour <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20test.20falls.20into.20infinite.20loop.html#247430211">(Jul 28 2021 at 07:42)</a>:</h4>
<blockquote>
<p>also, iirc it prints a warning after 60 seconds, so just wait a bit.</p>
</blockquote>
<p>Are you sure? <code>cargo test</code> does this? For me it doesn't.</p>



<a name="247430281"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20test%20falls%20into%20infinite%20loop/near/247430281" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20test.20falls.20into.20infinite.20loop.html#247430281">(Jul 28 2021 at 07:43)</a>:</h4>
<p>Yeah, it does.</p>



<a name="247430310"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20test%20falls%20into%20infinite%20loop/near/247430310" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20test.20falls.20into.20infinite.20loop.html#247430310">(Jul 28 2021 at 07:44)</a>:</h4>
<p>That's why I was trying to test it, but didn't even notice the message:</p>
<div class="codehilite"><pre><span></span><code>running 1 test
test foo has been running for over 60 seconds
^C
</code></pre></div>



<a name="247431164"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20test%20falls%20into%20infinite%20loop/near/247431164" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahdi Faramarzpour <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20test.20falls.20into.20infinite.20loop.html#247431164">(Jul 28 2021 at 07:54)</a>:</h4>
<p>OK, it printed it for me now. Looks like I didn't notice it or sth.</p>



<a name="247433504"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20test%20falls%20into%20infinite%20loop/near/247433504" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20test.20falls.20into.20infinite.20loop.html#247433504">(Jul 28 2021 at 08:26)</a>:</h4>
<p><span class="user-mention silent" data-user-id="424024">Mahdi Faramarzpour</span> has marked this topic as resolved.</p>



<a name="247475181"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20test%20falls%20into%20infinite%20loop/near/247475181" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20test.20falls.20into.20infinite.20loop.html#247475181">(Jul 28 2021 at 15:35)</a>:</h4>
<p><span class="user-mention silent" data-user-id="203546">Laurențiu</span> <a href="#narrow/stream/122651-general/topic/.E2.9C.94.20test.20falls.20into.20infinite.20loop/near/247427680">said</a>:</p>
<blockquote>
<p>You can disable multithreading with <code>-j1</code>.</p>
</blockquote>
<p>The correct way to disable multithreading is to use <code>--test-threads=1</code> or set the env var <code>RUST_TEST_THREADS=1</code>.  That changes the test runner to print the name of the test <em>before</em> it starts running, specifically to help debug which test hangs (so you don't have to wait 60 seconds).</p>



<a name="247475427"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20test%20falls%20into%20infinite%20loop/near/247475427" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20test.20falls.20into.20infinite.20loop.html#247475427">(Jul 28 2021 at 15:37)</a>:</h4>
<p>TIL. That's <code>cargo test -- --test-threads=1</code>, right? Could <code>cargo test -j</code> pass through the job number? Does <code>-j</code> include the build jobs?</p>



<a name="247483159"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20test%20falls%20into%20infinite%20loop/near/247483159" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20test.20falls.20into.20infinite.20loop.html#247483159">(Jul 28 2021 at 16:35)</a>:</h4>
<p>Yea, right now <code>-j</code> is just the number of concurrent build jobs.</p>
<p>I'm not sure if passing that to the test harness is the right thing to do.  Sometimes people use <code>-j</code> to control memory usage, which may not be an issue with running tests.  Also, the test harness does not allow multiple flags, so it would break anyone already setting it.  Unfortunately the protocol between cargo and the test harness is a little weak.</p>



<a name="247483945"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20test%20falls%20into%20infinite%20loop/near/247483945" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20test.20falls.20into.20infinite.20loop.html#247483945">(Jul 28 2021 at 16:42)</a>:</h4>
<p>Yeah, I just tested, <code>-j1</code> indeed has no effect on the number of test threads</p>



<a name="247483965"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20test%20falls%20into%20infinite%20loop/near/247483965" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20test.20falls.20into.20infinite.20loop.html#247483965">(Jul 28 2021 at 16:42)</a>:</h4>
<p>It might not be the first time I discover this, though :D</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>