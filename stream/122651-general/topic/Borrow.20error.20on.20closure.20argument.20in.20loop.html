<html>
<head><meta charset="utf-8"><title>Borrow error on closure argument in loop · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Borrow.20error.20on.20closure.20argument.20in.20loop.html">Borrow error on closure argument in loop</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="264822915"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Borrow%20error%20on%20closure%20argument%20in%20loop/near/264822915" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Borrow.20error.20on.20closure.20argument.20in.20loop.html#264822915">(Dec 14 2021 at 08:01)</a>:</h4>
<p>Does anyone know what's happening here? <a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2021&amp;gist=eba73e8a76bd62dee8c7d0c5bce35efa">https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2021&amp;gist=eba73e8a76bd62dee8c7d0c5bce35efa</a></p>



<a name="264823088"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Borrow%20error%20on%20closure%20argument%20in%20loop/near/264823088" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Borrow.20error.20on.20closure.20argument.20in.20loop.html#264823088">(Dec 14 2021 at 08:03)</a>:</h4>
<p>Code since the Playground is down:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">|</span><span class="n">s</span><span class="o">|</span><span class="w"> </span><span class="p">{};</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">g</span><span class="p">(</span><span class="n">s</span>: <span class="kp">&amp;</span><span class="nb">String</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">String</span>::<span class="n">new</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">0</span><span class="o">..</span><span class="mi">2</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">g</span><span class="p">(</span><span class="o">&amp;</span><span class="n">s</span><span class="p">);</span><span class="w"> </span><span class="c1">// works</span>
<span class="w">        </span><span class="n">f</span><span class="p">(</span><span class="o">&amp;</span><span class="n">s</span><span class="p">);</span><span class="w"> </span><span class="c1">// error: &amp;s used after assignment</span>
<span class="w">        </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">String</span>::<span class="n">new</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="264823830"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Borrow%20error%20on%20closure%20argument%20in%20loop/near/264823830" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Borrow.20error.20on.20closure.20argument.20in.20loop.html#264823830">(Dec 14 2021 at 08:14)</a>:</h4>
<p>Note that</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">String</span>::<span class="n">new</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">0</span><span class="o">..</span><span class="mi">2</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">|</span><span class="n">s</span><span class="o">|</span><span class="w"> </span><span class="p">{};</span><span class="w"></span>
<span class="w">        </span><span class="n">f</span><span class="p">(</span><span class="o">&amp;</span><span class="n">s</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">String</span>::<span class="n">new</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>works fine.<br>
The closure seems to be effectively pulling the String out of the loop.</p>



<a name="264824318"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Borrow%20error%20on%20closure%20argument%20in%20loop/near/264824318" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Borrow.20error.20on.20closure.20argument.20in.20loop.html#264824318">(Dec 14 2021 at 08:21)</a>:</h4>
<p>note that specifying</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">|</span><span class="n">s</span>: <span class="kp">&amp;</span><span class="nc">_</span><span class="o">|</span><span class="w"> </span><span class="p">{};</span><span class="w"></span>
</code></pre></div>
<p>also works</p>



<a name="264824796"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Borrow%20error%20on%20closure%20argument%20in%20loop/near/264824796" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Borrow.20error.20on.20closure.20argument.20in.20loop.html#264824796">(Dec 14 2021 at 08:27)</a>:</h4>
<p>I can't find an issue for it, I'll try to file one</p>



<a name="264825249"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Borrow%20error%20on%20closure%20argument%20in%20loop/near/264825249" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Borrow.20error.20on.20closure.20argument.20in.20loop.html#264825249">(Dec 14 2021 at 08:32)</a>:</h4>
<p>Looks like <a href="https://github.com/rust-lang/rust/issues/76627">https://github.com/rust-lang/rust/issues/76627</a></p>



<a name="264879456"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Borrow%20error%20on%20closure%20argument%20in%20loop/near/264879456" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Borrow.20error.20on.20closure.20argument.20in.20loop.html#264879456">(Dec 14 2021 at 16:01)</a>:</h4>
<p>Yep; any lifetime parameter discovered through type inference is, itself, inferred rather than higher-order. And there is no single lifetime that can fit both <code>f</code> invocations</p>



<a name="264881506"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Borrow%20error%20on%20closure%20argument%20in%20loop/near/264881506" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Borrow.20error.20on.20closure.20argument.20in.20loop.html#264881506">(Dec 14 2021 at 16:13)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">g</span><span class="o">&lt;'</span><span class="na">turbofishable</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">_</span>: <span class="kp">&amp;</span><span class="o">'</span><span class="na">turbofishable</span> <span class="kt">str</span><span class="p">)</span><span class="w"></span>
<span class="k">where</span><span class="w"></span>
<span class="w">    </span><span class="o">'</span><span class="nb">static</span><span class="w"> </span>: <span class="o">'</span><span class="na">turbofishable</span><span class="p">,</span><span class="w"></span>
<span class="p">{}</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">main</span><span class="w"> </span><span class="p">()</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">String</span>::<span class="n">new</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g</span>::<span class="o">&lt;'</span><span class="nb">_</span><span class="o">&gt;</span><span class="p">;</span><span class="w"> </span><span class="c1">// Let's call this inferred and FIXED lifetime `'i`</span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">f</span><span class="p">(</span><span class="o">&amp;</span><span class="n">s</span><span class="p">);</span><span class="w"> </span><span class="c1">// -&gt;-'i must span at least until-&gt;-+</span>
<span class="w">                                                </span><span class="c1">// |</span>
<span class="w">        </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">String</span>::<span class="n">new</span><span class="p">();</span><span class="w"> </span><span class="c1">// -&gt;- requires &amp;mut -&gt;-💥------------</span>
<span class="w">    </span><span class="p">}</span><span class="w">                                           </span><span class="c1">// |</span>
<span class="w">    </span><span class="p">{</span><span class="w">                                           </span><span class="c1">// v</span>
<span class="w">        </span><span class="n">f</span><span class="p">(</span><span class="o">&amp;</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="c1">// &lt;---------------------------------+</span>
<span class="w">        </span><span class="c1">// s = String::new();</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<ul>
<li><a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2021&amp;gist=36d8a7cb5b1505e0895058e7b74fc17d">Playground</a></li>
</ul>



<a name="264883995"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Borrow%20error%20on%20closure%20argument%20in%20loop/near/264883995" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Borrow.20error.20on.20closure.20argument.20in.20loop.html#264883995">(Dec 14 2021 at 16:29)</a>:</h4>
<p>As to why</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">|</span><span class="n">s</span><span class="o">|</span><span class="w"> </span><span class="p">{};</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">g</span><span class="p">(</span><span class="n">s</span>: <span class="kp">&amp;</span><span class="nb">String</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">String</span>::<span class="n">new</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">0</span><span class="o">..</span><span class="mi">2</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">g</span><span class="p">(</span><span class="o">&amp;</span><span class="n">s</span><span class="p">);</span><span class="w"> </span><span class="c1">// works</span>
<span class="w">        </span><span class="n">f</span><span class="p">(</span><span class="o">&amp;</span><span class="n">s</span><span class="p">);</span><span class="w"> </span><span class="c1">// error: &amp;s used after assignment</span>
<span class="w">        </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">String</span>::<span class="n">new</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>leads to <code>f</code> having an inferred-and-thus-fixed lifetime parameter, consider the following <code>f</code> definition:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">|</span><span class="n">s</span><span class="w"> </span><span class="cm">/*: &amp;'inferred str */</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">_</span>: <span class="kp">&amp;</span><span class="kt">str</span> <span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="p">;</span><span class="w"> </span><span class="c1">// let it be inferred that `s` is a `&amp;str`</span>
<span class="w">    </span><span class="cm">/* free implementation here */</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
</code></pre></div>
<p>it must have the same signature as yours (where <code>/* free implementation here */</code>, in your case, would be empty), and thus also the same as with <code>/* free implementation here */</code> being something that stores/reads <code>s</code>, as in:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>::<span class="n">core</span>::<span class="n">cell</span>::<span class="n">Cell</span>::<span class="n">new</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="nb">None</span>::<span class="o">&lt;&amp;</span><span class="w"> </span><span class="cm">/* 'inferred */</span><span class="w"> </span><span class="kt">str</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="p">);</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">|</span><span class="n">s</span><span class="w"> </span><span class="cm">/*: &amp;'inferred str */</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">_</span>: <span class="kp">&amp;</span><span class="kt">str</span> <span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">prev</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">out</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="nb">Some</span><span class="p">(</span><span class="n">s</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{prev}"</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>

<span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">String</span>::<span class="n">new</span><span class="p">();</span><span class="w"></span>
<span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">0</span><span class="o">..</span><span class="mi">2</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">f</span><span class="p">(</span><span class="o">&amp;</span><span class="n">s</span><span class="p">);</span><span class="w"> </span><span class="c1">// error: &amp;s used after assignment</span>
<span class="w">    </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">String</span>::<span class="n">new</span><span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="264887790"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Borrow%20error%20on%20closure%20argument%20in%20loop/near/264887790" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Borrow.20error.20on.20closure.20argument.20in.20loop.html#264887790">(Dec 14 2021 at 16:53)</a>:</h4>
<p>So why does specifying <code>let f = |s: &amp;_| {};</code> make it work? Does this force the compiler to use a higher order lifetime instead for some reason?</p>



<a name="264888236"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Borrow%20error%20on%20closure%20argument%20in%20loop/near/264888236" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Borrow.20error.20on.20closure.20argument.20in.20loop.html#264888236">(Dec 14 2021 at 16:55)</a>:</h4>
<p>Specifying a closure that way <em>does</em> essentially desugar to <code>let f = for&lt;'anon&gt; |s: &amp;'anon _| {};</code></p>



<a name="264894883"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Borrow%20error%20on%20closure%20argument%20in%20loop/near/264894883" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Borrow.20error.20on.20closure.20argument.20in.20loop.html#264894883">(Dec 14 2021 at 17:33)</a>:</h4>
<p><span class="user-mention silent" data-user-id="300586">Lukas Wirth</span> <a href="#narrow/stream/122651-general/topic/Borrow.20error.20on.20closure.20argument.20in.20loop/near/264887790">said</a>:</p>
<blockquote>
<p>So why does specifying <code>let f = |s: &amp;_| {};</code> make it work? Does this force the compiler to use a higher order lifetime instead for some reason?</p>
</blockquote>
<p>In that case the lifetime parameter is not "discovered through type inference", but rather, known beforehand, so that, indeed, Rust is able to <em>promote</em> the function / closure to be higher-order, in which case each invocation of <code>f</code> gets to pick its own new/fresh/free lifetime (parameter), thus acting kind of similarly to <span class="user-mention" data-user-id="281757">@Jubilee</span>'s example (which instanced a (lifetime-)distinct <code>f</code> per iteration).</p>
<p>As an example of this important change of signature, if we take the latest "evil" example with that <code>out</code> capture:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">|</span><span class="n">s</span>: <span class="kp">&amp;</span><span class="o">'</span><span class="nb">_</span> <span class="kt">str</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">prev</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">out</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="nb">Some</span><span class="p">(</span><span class="n">s</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{prev}"</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">};</span><span class="w"></span>
</code></pre></div>
<p><a href="https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2021&amp;gist=4193b05619ca0b8804e33c60113ae890">we get:</a></p>
<div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="go">error[E0521]: borrowed data escapes outside of closure</span>
<span class="go"> --&gt; src/main.rs:7:29</span>
<span class="go">  |</span>
<span class="go">3 |     let out = ::core::cell::Cell::new(</span>
<span class="go">  |         --- `out` declared here, outside of the closure body</span>
<span class="go">...</span>
<span class="go">6 |     let f = |s: &amp;'_ str| {</span>
<span class="go">  |              - `s` is a reference that is only valid in the closure body</span>
<span class="go">7 |         if let Some(prev) = out.replace(Some(s)) {</span>
<span class="go">  |                             ^^^^^^^^^^^^^^^^^^^^ `s` escapes the closure body here</span>
</code></pre></div>
<blockquote>
<p>that is only valid in the closure body</p>
</blockquote>
<p>is the user-friendly way of saying "its lifetime is higher-order"</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>