<html>
<head><meta charset="utf-8"><title>Compiler bug when testing `library/alloc`? · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Compiler.20bug.20when.20testing.20.60library.2Falloc.60.3F.html">Compiler bug when testing `library/alloc`?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="256924676"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Compiler%20bug%20when%20testing%20%60library/alloc%60%3F/near/256924676" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael de Silva <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Compiler.20bug.20when.20testing.20.60library.2Falloc.60.3F.html#256924676">(Oct 10 2021 at 04:49)</a>:</h4>
<p>Hi all,</p>
<p>Is this a valid issue by any chance?</p>
<div class="codehilite"><pre><span></span><code>running 599 tests
.................................................................................................... 100/599
.................................................................................................... 200/599
..................................i................................................................. 300/599
.................................................................................................... 400/599
...................................F................................................................ 500/599
...................................................................................................
failures:

---- src/string.rs - string::String (line 168) stdout ----
thread &#39;rustc&#39; panicked at &#39;called `Option::unwrap()` on a `None` value&#39;, compiler/rustc_trait_selection/src/traits/error_reporting/suggestions.rs:696:8
1
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace

error: internal compiler error: unexpected panic

note: the compiler unexpectedly panicked. this is a bug.

note: we would appreciate a bug report: https://github.com/rust-lang/rust/issues/new?labels=C-bug%2C+I-ICE%2C+T-compiler&amp;template=ice.md

note: rustc 1.56.0-beta.1 (e784c962e 2021-09-07) running on x86_64-unknown-linux-gnu

note: compiler flags: -Z crate-attr=doc(html_root_url=&quot;https://doc.rust-lang.org/nightly/&quot;) -Z force-unstable-if-unmarked -C codegen-units=1 -C embed-bi
tcode=no --crate-type bin

query stack during panic:
#0 [typeck] type-checking `main::_doctest_main_src_string_rs_168_0`
#1 [typeck_item_bodies] type-checking all item bodies
end of query stack
error: internal compiler error: trimmed_def_paths constructed
  |
  = note: delayed at    0: rustc_errors::Handler::delay_good_path_bug
             1: rustc_middle::ty::print::pretty::trimmed_def_paths
             2: rustc_data_structures::stack::ensure_sufficient_stack
             3: rustc_query_system::query::plumbing::get_query_impl
             4: rustc_query_system::query::plumbing::get_query
             5: &lt;rustc_middle::ty::print::pretty::FmtPrinter&lt;F&gt; as rustc_middle::ty::print::Printer&gt;::print_def_path
             6: rustc_middle::ty::print::pretty::PrettyPrinter::pretty_print_type
             7: rustc_middle::ty::print::pretty::&lt;impl rustc_middle::ty::print::Print&lt;P&gt; for rustc_middle::ty::sty::TypeAndMut&gt;::print
             8: rustc_middle::ty::print::pretty::PrettyPrinter::pretty_print_type
             9: rustc_middle::ty::print::pretty::&lt;impl rustc_middle::ty::print::Print&lt;P&gt; for rustc_middle::ty::TraitPredicate&gt;::print
            10: rustc_middle::ty::print::pretty::&lt;impl rustc_middle::ty::print::Print&lt;P&gt; for rustc_middle::ty::PredicateKind&gt;::print
            11: &lt;rustc_middle::ty::print::pretty::FmtPrinter&lt;F&gt; as rustc_middle::ty::print::pretty::PrettyPrinter&gt;::in_binder
            12: rustc_middle::ty::print::pretty::&lt;impl core::fmt::Display for rustc_middle::ty::Predicate&gt;::fmt
            13: core::fmt::write
                       at /rustc/e784c962ea252f0874a4305168077e7048cb39e9/library/core/src/fmt/mod.rs:1150:17
            14: core::fmt::Write::write_fmt
                       at /rustc/e784c962ea252f0874a4305168077e7048cb39e9/library/core/src/fmt/mod.rs:186:9
            15: alloc::fmt::format
                       at /rustc/e784c962ea252f0874a4305168077e7048cb39e9/library/alloc/src/fmt.rs:583:5
            16: &lt;rustc_infer::infer::InferCtxt as rustc_trait_selection::traits::error_reporting::InferCtxtExt&gt;::report_selection_error
            17: &lt;rustc_infer::infer::InferCtxt as rustc_trait_selection::traits::error_reporting::InferCtxtPrivExt&gt;::report_fulfillment_error
            18: &lt;rustc_infer::infer::InferCtxt as rustc_trait_selection::traits::error_reporting::InferCtxtExt&gt;::report_fulfillment_errors
            19: rustc_typeck::check::fn_ctxt::checks::&lt;impl rustc_typeck::check::fn_ctxt::FnCtxt&gt;::check_argument_types
            20: rustc_typeck::check::callee::&lt;impl rustc_typeck::check::fn_ctxt::FnCtxt&gt;::confirm_builtin_call
            21: rustc_typeck::check::callee::&lt;impl rustc_typeck::check::fn_ctxt::FnCtxt&gt;::check_call
            22: rustc_typeck::check::expr::&lt;impl rustc_typeck::check::fn_ctxt::FnCtxt&gt;::check_expr_kind
            23: rustc_typeck::check::expr::&lt;impl rustc_typeck::check::fn_ctxt::FnCtxt&gt;::check_expr_with_expectation
            24: rustc_typeck::check::fn_ctxt::checks::&lt;impl rustc_typeck::check::fn_ctxt::FnCtxt&gt;::check_stmt
            25: rustc_typeck::check::fn_ctxt::checks::&lt;impl rustc_typeck::check::fn_ctxt::FnCtxt&gt;::check_block_with_expected
            26: rustc_typeck::check::expr::&lt;impl rustc_typeck::check::fn_ctxt::FnCtxt&gt;::check_expr_with_expectation
            27: rustc_typeck::check::expr::&lt;impl rustc_typeck::check::fn_ctxt::FnCtxt&gt;::check_return_expr
            28: rustc_typeck::check::check::check_fn
            29: rustc_infer::infer::InferCtxtBuilder::enter
            30: rustc_typeck::check::typeck
            31: rustc_query_system::query::plumbing::get_query_impl
            32: &lt;rustc_query_impl::Queries as rustc_middle::ty::query::QueryEngine&gt;::typeck
            33: rustc_middle::ty::&lt;impl rustc_middle::ty::context::TyCtxt&gt;::par_body_owners
            34: rustc_typeck::check::typeck_item_bodies
            35: rustc_query_system::query::plumbing::get_query_impl
            36: &lt;rustc_query_impl::Queries as rustc_middle::ty::query::QueryEngine&gt;::typeck_item_bodies
            37: rustc_session::utils::&lt;impl rustc_session::session::Session&gt;::time
            38: rustc_typeck::check_crate
            39: rustc_interface::passes::analysis
            40: rustc_query_system::query::plumbing::get_query_impl
            41: &lt;rustc_query_impl::Queries as rustc_middle::ty::query::QueryEngine&gt;::analysis
            42: rustc_interface::passes::QueryContext::enter
            43: rustc_interface::queries::&lt;impl rustc_interface::interface::Compiler&gt;::enter
            44: rustc_span::with_source_map
            45: scoped_tls::ScopedKey&lt;T&gt;::set
            46: std::sys_common::backtrace::__rust_begin_short_backtrace
            47: core::ops::function::FnOnce::call_once{{vtable.shim}}
            48: &lt;alloc::boxed::Box&lt;F,A&gt; as core::ops::function::FnOnce&lt;Args&gt;&gt;::call_once
                       at /rustc/e784c962ea252f0874a4305168077e7048cb39e9/library/alloc/src/boxed.rs:1636:9
            49: &lt;alloc::boxed::Box&lt;F,A&gt; as core::ops::function::FnOnce&lt;Args&gt;&gt;::call_once
                       at /rustc/e784c962ea252f0874a4305168077e7048cb39e9/library/alloc/src/boxed.rs:1636:9
            50: std::sys::unix::thread::Thread::new::thread_start
                       at /rustc/e784c962ea252f0874a4305168077e7048cb39e9/library/std/src/sys/unix/thread.rs:106:17
            51: start_thread
            52: __clone
</code></pre></div>



<a name="256924744"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Compiler%20bug%20when%20testing%20%60library/alloc%60%3F/near/256924744" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael de Silva <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Compiler.20bug.20when.20testing.20.60library.2Falloc.60.3F.html#256924744">(Oct 10 2021 at 04:50)</a>:</h4>
<div class="codehilite"><pre><span></span><code>thread &#39;rustc&#39; panicked at &#39;no warnings or errors encountered even though `delayed_good_path_bugs` issued&#39;, compiler/rustc_errors/src/lib.rs:1166:13
stack backtrace:
   0:     0x7fee770d94fc - std::backtrace_rs::backtrace::libunwind::trace::h51faa62df48810e4
                               at /rustc/e784c962ea252f0874a4305168077e7048cb39e9/library/std/src/../../backtrace/src/backtrace/libunwind.rs:90:5
   1:     0x7fee770d94fc - std::backtrace_rs::backtrace::trace_unsynchronized::h91de4d8e16d607e4
                               at /rustc/e784c962ea252f0874a4305168077e7048cb39e9/library/std/src/../../backtrace/src/backtrace/mod.rs:66:5
   2:     0x7fee770d94fc - std::sys_common::backtrace::_print_fmt::h71b0935f97e4322c
                               at /rustc/e784c962ea252f0874a4305168077e7048cb39e9/library/std/src/sys_common/backtrace.rs:67:5
   3:     0x7fee770d94fc - &lt;std::sys_common::backtrace::_print::DisplayBacktrace as core::fmt::Display&gt;::fmt::h9a78218788c14e18
                               at /rustc/e784c962ea252f0874a4305168077e7048cb39e9/library/std/src/sys_common/backtrace.rs:46:22
   4:     0x7fee7713720c - core::fmt::write::h3381b3176fe2b3d3
                               at /rustc/e784c962ea252f0874a4305168077e7048cb39e9/library/core/src/fmt/mod.rs:1150:17
   5:     0x7fee770ca435 - std::io::Write::write_fmt::h1d5220480c7a2437
                               at /rustc/e784c962ea252f0874a4305168077e7048cb39e9/library/std/src/io/mod.rs:1667:15
   6:     0x7fee770dca60 - std::sys_common::backtrace::_print::h4b77abc4d907ed0e
                               at /rustc/e784c962ea252f0874a4305168077e7048cb39e9/library/std/src/sys_common/backtrace.rs:49:5
   7:     0x7fee770dca60 - std::sys_common::backtrace::print::hb170c60b542377ad
                               at /rustc/e784c962ea252f0874a4305168077e7048cb39e9/library/std/src/sys_common/backtrace.rs:36:9
   8:     0x7fee770dca60 - std::panicking::default_hook::{{closure}}::h12bbda9af8901ee3
                               at /rustc/e784c962ea252f0874a4305168077e7048cb39e9/library/std/src/panicking.rs:210:50
   9:     0x7fee770dc617 - std::panicking::default_hook::h8c6c66d3f3ba6768
                               at /rustc/e784c962ea252f0874a4305168077e7048cb39e9/library/std/src/panicking.rs:227:9
  10:     0x7fee778b0861 - rustc_driver::DEFAULT_HOOK::{{closure}}::{{closure}}::h5d5f6bcd40777e95
  11:     0x7fee770dd279 - std::panicking::rust_panic_with_hook::h36f2fa0bb09f4069
                               at /rustc/e784c962ea252f0874a4305168077e7048cb39e9/library/std/src/panicking.rs:628:17
  12:     0x7fee770dcd30 - std::panicking::begin_panic_handler::{{closure}}::h9c42b65a42d06a7a
                               at /rustc/e784c962ea252f0874a4305168077e7048cb39e9/library/std/src/panicking.rs:521:13
  13:     0x7fee770d99c4 - std::sys_common::backtrace::__rust_end_short_backtrace::hc791bddfe31e532c
                               at /rustc/e784c962ea252f0874a4305168077e7048cb39e9/library/std/src/sys_common/backtrace.rs:141:18
  14:     0x7fee770dcc99 - rust_begin_unwind
                               at /rustc/e784c962ea252f0874a4305168077e7048cb39e9/library/std/src/panicking.rs:517:5
  15:     0x7fee770a181b - std::panicking::begin_panic_fmt::h32ac317c038a272d
                               at /rustc/e784c962ea252f0874a4305168077e7048cb39e9/library/std/src/panicking.rs:460:5
  16:     0x7fee79e0d54e - rustc_errors::HandlerInner::flush_delayed::hc1a0dc2a3b52b7c5
  17:     0x7fee79e0be41 - &lt;rustc_errors::HandlerInner as core::ops::drop::Drop&gt;::drop::h6b6fa9db3b176321
  18:     0x7fee793cfb16 - core::ptr::drop_in_place&lt;rustc_session::parse::ParseSess&gt;::h0f64c3a6d9ae48b4
  19:     0x7fee793d1b0e - &lt;alloc::rc::Rc&lt;T&gt; as core::ops::drop::Drop&gt;::drop::h38ccacfabbb0cd9a
  20:     0x7fee793a3a8d - core::ptr::drop_in_place&lt;rustc_interface::interface::Compiler&gt;::he462bcfe0a585c06
  21:     0x7fee793a376c - rustc_span::with_source_map::h42000c6d4d4801a0
  22:     0x7fee793b5858 - scoped_tls::ScopedKey&lt;T&gt;::set::h9c4e59a22d2be862
  23:     0x7fee793a49db - std::sys_common::backtrace::__rust_begin_short_backtrace::hb112af792d752f1d
  24:     0x7fee793a1b95 - core::ops::function::FnOnce::call_once{{vtable.shim}}::h9bf5ff18e54ee278
  25:     0x7fee770e98c3 - &lt;alloc::boxed::Box&lt;F,A&gt; as core::ops::function::FnOnce&lt;Args&gt;&gt;::call_once::hbbbb32ef11ea0ad2
                               at /rustc/e784c962ea252f0874a4305168077e7048cb39e9/library/alloc/src/boxed.rs:1636:9
  26:     0x7fee770e98c3 - &lt;alloc::boxed::Box&lt;F,A&gt; as core::ops::function::FnOnce&lt;Args&gt;&gt;::call_once::h3b8ef23699fc5385
                               at /rustc/e784c962ea252f0874a4305168077e7048cb39e9/library/alloc/src/boxed.rs:1636:9
  27:     0x7fee770e98c3 - std::sys::unix::thread::Thread::new::thread_start::ha57f5cba35f709b7
                               at /rustc/e784c962ea252f0874a4305168077e7048cb39e9/library/std/src/sys/unix/thread.rs:106:17
  28:     0x7fee7700a299 - start_thread
  29:     0x7fee76f1e353 - __clone
  30:                0x0 - &lt;unknown&gt;

error: internal compiler error: unexpected panic

note: the compiler unexpectedly panicked. this is a bug.

note: we would appreciate a bug report: https://github.com/rust-lang/rust/issues/new?labels=C-bug%2C+I-ICE%2C+T-compiler&amp;template=ice.md

note: rustc 1.56.0-beta.1 (e784c962e 2021-09-07) running on x86_64-unknown-linux-gnu

note: compiler flags: -Z crate-attr=doc(html_root_url=&quot;https://doc.rust-lang.org/nightly/&quot;) -Z force-unstable-if-unmarked -C codegen-units=1 -C embed-bitcode=no --crate-type bin

query stack during panic:
end of query stack
thread panicked while panicking. aborting.
Some expected error codes were not found: [&quot;E0277&quot;]

failures:
    src/string.rs - string::String (line 168)

test result: FAILED. 597 passed; 1 failed; 1 ignored; 0 measured; 0 filtered out; finished in 11.17s

error: test failed, to rerun pass &#39;--doc&#39;


command did not execute successfully: &quot;/opt/code/rust-projects/rust/build/x86_64-unknown-linux-gnu/stage0/bin/cargo&quot; &quot;test&quot; &quot;--target&quot; &quot;x86_64-unknown-linux-gnu&quot; &quot;-Zbinary-dep-depinfo&quot; &quot;-j&quot; &quot;32&quot; &quot;--release&quot; &quot;--features&quot; &quot;panic-unwind backtrace compiler-builtins-c&quot; &quot;--manifest-path&quot; &quot;/opt/code/rust-projects/rust/library/test/Cargo.toml&quot; &quot;-p&quot; &quot;alloc&quot; &quot;--&quot; &quot;--quiet&quot;
expected success, got: exit status: 101


Build completed unsuccessfully in 0:00:13
</code></pre></div>



<a name="256924777"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Compiler%20bug%20when%20testing%20%60library/alloc%60%3F/near/256924777" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael de Silva <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Compiler.20bug.20when.20testing.20.60library.2Falloc.60.3F.html#256924777">(Oct 10 2021 at 04:51)</a>:</h4>
<p>The  command I ran was <code>./x.py test --keep-stage 1 library/alloc/</code> on a fresh checkout from the master branch on Github.</p>



<a name="256924828"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Compiler%20bug%20when%20testing%20%60library/alloc%60%3F/near/256924828" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael de Silva <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Compiler.20bug.20when.20testing.20.60library.2Falloc.60.3F.html#256924828">(Oct 10 2021 at 04:52)</a>:</h4>
<p>Tests for <code>library/std</code> pass though.</p>



<a name="256927093"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Compiler%20bug%20when%20testing%20%60library/alloc%60%3F/near/256927093" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael de Silva <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Compiler.20bug.20when.20testing.20.60library.2Falloc.60.3F.html#256927093">(Oct 10 2021 at 05:34)</a>:</h4>
<p>Switched to the repo <code>beta</code> branch and tests for <code>library/alloc</code> are passing now.</p>



<a name="256929961"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Compiler%20bug%20when%20testing%20%60library/alloc%60%3F/near/256929961" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael de Silva <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Compiler.20bug.20when.20testing.20.60library.2Falloc.60.3F.html#256929961">(Oct 10 2021 at 06:26)</a>:</h4>
<p>Opened this issue: <a href="https://github.com/rust-lang/rust/issues/89725">https://github.com/rust-lang/rust/issues/89725</a></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>