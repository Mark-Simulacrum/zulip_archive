<html>
<head><meta charset="utf-8"><title>Is introducing a new generic lifetime a semver-incompatib... · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20introducing.20a.20new.20generic.20lifetime.20a.20semver-incompatib.2E.2E.2E.html">Is introducing a new generic lifetime a semver-incompatib...</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="250436973"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20introducing%20a%20new%20generic%20lifetime%20a%20semver-incompatib.../near/250436973" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20introducing.20a.20new.20generic.20lifetime.20a.20semver-incompatib.2E.2E.2E.html#250436973">(Aug 24 2021 at 02:45)</a>:</h4>
<p>During training today, someone asked if this change would be breaking:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">foo</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="p">(</span><span class="n">a</span>: <span class="kp">&amp;</span><span class="o">'</span><span class="na">a</span> <span class="kt">str</span><span class="p">,</span><span class="w"> </span><span class="n">b</span>: <span class="kp">&amp;</span><span class="o">'</span><span class="na">a</span> <span class="kt">str</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="o">'</span><span class="na">a</span> <span class="kt">str</span> <span class="p">{</span><span class="w"> </span><span class="fm">todo!</span><span class="p">()</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="c1">// to</span>

<span class="k">fn</span> <span class="nf">foo</span><span class="o">&lt;'</span><span class="na">a</span><span class="p">,</span><span class="w"> </span><span class="o">'</span><span class="na">x</span><span class="o">&gt;</span><span class="p">(</span><span class="n">a</span>: <span class="kp">&amp;</span><span class="o">'</span><span class="na">a</span> <span class="kt">str</span><span class="p">,</span><span class="w"> </span><span class="n">b</span>: <span class="kp">&amp;</span><span class="o">'</span><span class="na">x</span> <span class="kt">str</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="o">'</span><span class="na">a</span> <span class="kt">str</span> <span class="p">{</span><span class="w"> </span><span class="fm">todo!</span><span class="p">()</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>I’m pretty sure that the answer is “no, it’s not a breaking change”, but I started to doubt myself, then doubt my doubts.</p>



<a name="250438754"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20introducing%20a%20new%20generic%20lifetime%20a%20semver-incompatib.../near/250438754" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20introducing.20a.20new.20generic.20lifetime.20a.20semver-incompatib.2E.2E.2E.html#250438754">(Aug 24 2021 at 03:28)</a>:</h4>
<p>I can't think of a way it would break.  rust-semvever says it would, but I find it gives a lot of false positives.</p>



<a name="250439279"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20introducing%20a%20new%20generic%20lifetime%20a%20semver-incompatib.../near/250439279" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20introducing.20a.20new.20generic.20lifetime.20a.20semver-incompatib.2E.2E.2E.html#250439279">(Aug 24 2021 at 03:40)</a>:</h4>
<p>That seems fine to me - the compiler can always choose 'x to be the same as 'a</p>



<a name="250439301"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20introducing%20a%20new%20generic%20lifetime%20a%20semver-incompatib.../near/250439301" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20introducing.20a.20new.20generic.20lifetime.20a.20semver-incompatib.2E.2E.2E.html#250439301">(Aug 24 2021 at 03:41)</a>:</h4>
<p>Oh hmm, I guess the one way is if someone was using turbofish syntax: <code>foo::&lt;'static&gt;("a", "b")</code> would no longer compile</p>



<a name="250439432"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20introducing%20a%20new%20generic%20lifetime%20a%20semver-incompatib.../near/250439432" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20introducing.20a.20new.20generic.20lifetime.20a.20semver-incompatib.2E.2E.2E.html#250439432">(Aug 24 2021 at 03:44)</a>:</h4>
<p>Never mind, that's not valid apparently</p>
<div class="codehilite"><pre><span></span><code>error: cannot specify lifetime arguments explicitly if late bound lifetime parameters are present
 --&gt; src/main.rs:9:9
  |
9 |   foo::&lt;&#39;static&gt;(&quot;a&quot;, &quot;b&quot;);
  |         ^^^^^^^
  |
note: the late bound lifetime parameter is introduced here
 --&gt; src/main.rs:2:8
  |
2 | fn foo&lt;&#39;a&gt;(a: &amp;&#39;a str, b: &amp;&#39;a str) -&gt; &amp;&#39;a str { todo!() }
  |        ^^
</code></pre></div>
<p>So yeah, this is backwards compatible</p>



<a name="250439509"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20introducing%20a%20new%20generic%20lifetime%20a%20semver-incompatib.../near/250439509" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20introducing.20a.20new.20generic.20lifetime.20a.20semver-incompatib.2E.2E.2E.html#250439509">(Aug 24 2021 at 03:46)</a>:</h4>
<p>you can make <code>'a</code> early bound by doing <code>'a: 'a</code> on the fn def</p>



<a name="250439515"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20introducing%20a%20new%20generic%20lifetime%20a%20semver-incompatib.../near/250439515" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20introducing.20a.20new.20generic.20lifetime.20a.20semver-incompatib.2E.2E.2E.html#250439515">(Aug 24 2021 at 03:46)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">foo</span><span class="o">&lt;'</span><span class="na">a</span>: <span class="o">'</span><span class="na">a</span><span class="o">&gt;</span><span class="p">(</span><span class="n">a</span>: <span class="kp">&amp;</span><span class="o">'</span><span class="na">a</span> <span class="kt">str</span><span class="p">,</span><span class="w"> </span><span class="n">b</span>: <span class="kp">&amp;</span><span class="o">'</span><span class="na">a</span> <span class="kt">str</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="o">'</span><span class="na">a</span> <span class="kt">str</span> <span class="p">{</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">foo</span>::<span class="o">&lt;'</span><span class="nb">static</span><span class="o">&gt;</span><span class="p">(</span><span class="s">"awd"</span><span class="p">,</span><span class="w"> </span><span class="s">"boo"</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="250439518"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20introducing%20a%20new%20generic%20lifetime%20a%20semver-incompatib.../near/250439518" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20introducing.20a.20new.20generic.20lifetime.20a.20semver-incompatib.2E.2E.2E.html#250439518">(Aug 24 2021 at 03:46)</a>:</h4>
<p>Another thing I tried was to pass <code>&amp;mut foo</code> to an argument accepting a <code>&amp;mut for&lt;'a&gt; fn(&amp;'a str, &amp;'a str) -&gt; &amp;'a str</code>, but this doesn't work because the actual type of <code>foo</code> is <code>for&lt;'a&gt; fn(&amp;'a str, &amp;'a str) -&gt; &amp;'a str {foo}</code> and you can't spell that</p>



<a name="250439534"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20introducing%20a%20new%20generic%20lifetime%20a%20semver-incompatib.../near/250439534" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20introducing.20a.20new.20generic.20lifetime.20a.20semver-incompatib.2E.2E.2E.html#250439534">(Aug 24 2021 at 03:47)</a>:</h4>
<p>you can use a coercion, but this applies equally to both versions of <code>foo</code></p>



<a name="250439601"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20introducing%20a%20new%20generic%20lifetime%20a%20semver-incompatib.../near/250439601" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20introducing.20a.20new.20generic.20lifetime.20a.20semver-incompatib.2E.2E.2E.html#250439601">(Aug 24 2021 at 03:48)</a>:</h4>
<p>if we ever get a <code>typeof</code> like operator you might be able to tell the difference</p>



<a name="250440784"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20introducing%20a%20new%20generic%20lifetime%20a%20semver-incompatib.../near/250440784" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20introducing.20a.20new.20generic.20lifetime.20a.20semver-incompatib.2E.2E.2E.html#250440784">(Aug 24 2021 at 04:17)</a>:</h4>
<p>HRTBs make it backwards incompatible, though I doubt your trainee had this in mind:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">foo</span><span class="o">&lt;'</span><span class="na">a</span><span class="p">,</span><span class="w"> </span><span class="o">'</span><span class="na">b</span><span class="o">&gt;</span><span class="p">(</span><span class="n">a</span>: <span class="kp">&amp;</span><span class="o">'</span><span class="na">a</span> <span class="kt">str</span><span class="p">,</span><span class="w"> </span><span class="n">b</span>: <span class="kp">&amp;</span><span class="o">'</span><span class="na">b</span> <span class="kt">str</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="o">'</span><span class="na">a</span> <span class="kt">str</span> <span class="p">{</span><span class="w"> </span><span class="fm">todo!</span><span class="p">()</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">bar</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="p">(</span><span class="n">a</span>: <span class="kp">&amp;</span><span class="o">'</span><span class="na">a</span> <span class="kt">str</span><span class="p">,</span><span class="w"> </span><span class="n">b</span>: <span class="kp">&amp;</span><span class="o">'</span><span class="na">a</span> <span class="kt">str</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="o">'</span><span class="na">a</span> <span class="kt">str</span> <span class="p">{</span><span class="w"> </span><span class="fm">todo!</span><span class="p">()</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">hrtb</span><span class="p">(</span><span class="n">x</span>: <span class="nc">for</span><span class="o">&lt;'</span><span class="na">a</span><span class="p">,</span><span class="w"> </span><span class="o">'</span><span class="na">b</span><span class="o">&gt;</span><span class="w"> </span><span class="k">fn</span><span class="p">(</span><span class="o">&amp;'</span><span class="na">a</span><span class="w"> </span><span class="kt">str</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;'</span><span class="na">b</span><span class="w"> </span><span class="kt">str</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="o">'</span><span class="na">a</span> <span class="kt">str</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="fm">todo!</span><span class="p">()</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">hrtb</span><span class="p">(</span><span class="n">foo</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">hrtb</span><span class="p">(</span><span class="n">bar</span><span class="p">);</span><span class="w"> </span><span class="c1">// ERROR</span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="250440833"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20introducing%20a%20new%20generic%20lifetime%20a%20semver-incompatib.../near/250440833" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20introducing.20a.20new.20generic.20lifetime.20a.20semver-incompatib.2E.2E.2E.html#250440833">(Aug 24 2021 at 04:18)</a>:</h4>
<p>You managed to nerd-snipe half the chat, btw. Congrats!</p>



<a name="250441139"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20introducing%20a%20new%20generic%20lifetime%20a%20semver-incompatib.../near/250441139" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20introducing.20a.20new.20generic.20lifetime.20a.20semver-incompatib.2E.2E.2E.html#250441139">(Aug 24 2021 at 04:27)</a>:</h4>
<p>you got it backwards - <code>bar</code> is the original and we're replacing it with <code>foo</code>, so that isn't breakage, it's fixage</p>



<a name="250441851"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Is%20introducing%20a%20new%20generic%20lifetime%20a%20semver-incompatib.../near/250441851" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Is.20introducing.20a.20new.20generic.20lifetime.20a.20semver-incompatib.2E.2E.2E.html#250441851">(Aug 24 2021 at 04:44)</a>:</h4>
<p>I think OP's change is a minor change, per RFC 1105. RFC 1105 even allows adding a new type parameter, so adding a new lifetime parameter should also be okay.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>