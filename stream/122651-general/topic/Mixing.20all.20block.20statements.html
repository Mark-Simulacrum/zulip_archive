<html>
<head><meta charset="utf-8"><title>Mixing all block statements · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Mixing.20all.20block.20statements.html">Mixing all block statements</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="256492176"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Mixing%20all%20block%20statements/near/256492176" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Doe <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Mixing.20all.20block.20statements.html#256492176">(Oct 06 2021 at 22:06)</a>:</h4>
<p>I had this thought that it would be nice to be able to write non-exhaustive <code>match</code> blocks followed by an <code>else</code>. Basically the use case would be avoiding excessive horizontal drift in cases where a lack of a match results in significantly more code than the matches. Then I thought it would be great to be able to chain it in general, like <code>if condition { code } else match { match block } else if other_condition { code } else { code }</code>.</p>
<p>The idea is that <code>else</code> would be required on a non-exhaustive <code>match</code> block, and a <code>match</code> block would have to be non-exhaustive to allow <code>else</code>.</p>
<p>Then I ran this by the people in the Rust Discord and someone suggested letting it work with all block statements. And I realized, that kind of works. For example, we can't <code>break</code> any value from <code>while</code> or <code>for .. in</code> because it may finish before ending the loop (due to consuming the iterator or the <code>while</code> condition going false). Essentially, the <code>break</code> type needs to match the currently unavoidable potential lack of return value from the block. But if we had an <code>else</code> on them, we could. And <code>else loop</code> or <code>else while</code> are already trivially possible.</p>
<p>Here I have a janky example of the kind of chaining that would be possible:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">condition</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="mi">5</span><span class="w"></span>
<span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="n">stuff</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="nb">Some</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="nb">None</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"></span>
<span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="n">whatever</span><span class="p">.</span><span class="n">len</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="n">blah</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">do_thing</span><span class="p">(</span><span class="n">whatever</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">blah</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">break</span><span class="w"> </span><span class="mi">6</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">loop</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">hmm</span><span class="p">,</span><span class="w"> </span><span class="n">haa</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">try_things_forever</span><span class="p">();</span><span class="w"></span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">haa</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">break</span><span class="w"> </span><span class="n">hmm</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
</code></pre></div>
<p>Then I realized, the difference between this new usage of <code>else</code> and the existing usage, is that the new one basically triggers if the preceding block failed to return a value, whereas the old one cannot trigger at all if the preceding block does. So perhaps a different keyword would be more appropriate. Perhaps <code>or</code>, by analogy to its method usage on <code>Result</code> and <code>Option</code>.</p>
<p>I have zero examples of real-world cases where this is good, that shouldn't probably be written differently already. But still, the elegance made me wanna see if there is any merit to this. As far as I know, none of this would cause any problems with existing code or patterns, but I am pretty new to Rust, so I can't be sure.</p>



<a name="256492960"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Mixing%20all%20block%20statements/near/256492960" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Mixing.20all.20block.20statements.html#256492960">(Oct 06 2021 at 22:13)</a>:</h4>
<p>There was once an RFC for <code>else match</code>: <a href="https://github.com/rust-lang/rfcs/pull/1712">https://github.com/rust-lang/rfcs/pull/1712</a></p>



<a name="256493582"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Mixing%20all%20block%20statements/near/256493582" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Doe <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Mixing.20all.20block.20statements.html#256493582">(Oct 06 2021 at 22:19)</a>:</h4>
<p>This comment basically represents my view: <a href="https://github.com/rust-lang/rfcs/pull/1712#issuecomment-239396686">https://github.com/rust-lang/rfcs/pull/1712#issuecomment-239396686</a></p>
<p>Or half of it. The other half being allowing <code>else</code> (or <code>or</code>) after any "non-exhaustive block".</p>



<a name="256501248"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Mixing%20all%20block%20statements/near/256501248" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Doe <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Mixing.20all.20block.20statements.html#256501248">(Oct 06 2021 at 23:40)</a>:</h4>
<p><code>or</code> is just one suggestion of course. Some other word may be more fitting.</p>



<a name="256502625"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Mixing%20all%20block%20statements/near/256502625" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Mixing.20all.20block.20statements.html#256502625">(Oct 06 2021 at 23:57)</a>:</h4>
<p>By the way, your <code>else while</code> example is not correct, you can't break with value from a <code>while</code> because it always returns <code>()</code> (because you have to be prepared for the while condition to fail, at which point there is no value to pass out)</p>



<a name="256502987"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Mixing%20all%20block%20statements/near/256502987" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Mixing.20all.20block.20statements.html#256502987">(Oct 07 2021 at 00:01)</a>:</h4>
<p>Ah, I see you mention this in the post. But an <code>else</code> on <code>while</code> wouldn't help here, since it's not like the else only runs if the condition fails the first time; it has to run if it ever fails, in which case it's not really that different from just <code>{ while { ... }; 5 }</code> or so</p>



<a name="256506997"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Mixing%20all%20block%20statements/near/256506997" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Doe <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Mixing.20all.20block.20statements.html#256506997">(Oct 07 2021 at 00:48)</a>:</h4>
<p>None of it is very different from things we can do now, structurally. It's just a little nicer, with a little less horizontal drift, and it makes a lot of sense to me. It is basically only two new rules, applied very consistently. One of them basically replacing an existing rule (the one that allows <code>else if</code> and <code>else if let</code>).</p>



<a name="256507491"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Mixing%20all%20block%20statements/near/256507491" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Doe <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Mixing.20all.20block.20statements.html#256507491">(Oct 07 2021 at 00:54)</a>:</h4>
<p>Well, the ability to <code>break</code> values from <code>for .. in</code> loops would be nice, I guess. But I am sure there are already ways to work around it today. Again, I have no practical code example handy that could not be written some other, nice way. Although I would be surprised if none exists.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>