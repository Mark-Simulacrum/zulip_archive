<html>
<head><meta charset="utf-8"><title>Which rustfmt does x.py fmt use? · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Which.20rustfmt.20does.20x.2Epy.20fmt.20use.3F.html">Which rustfmt does x.py fmt use?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="253671724"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Which%20rustfmt%20does%20x.py%20fmt%20use%3F/near/253671724" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Which.20rustfmt.20does.20x.2Epy.20fmt.20use.3F.html#253671724">(Sep 17 2021 at 00:32)</a>:</h4>
<p>I configured vscode in the rustc workspace to use <code>./build/x86_64-unknown-linux-gnu/stage0/bin/rustfmt</code> for formatting, in the hopes that that would mean it uses the same rustfmt as <code>x.py fmt</code> so everything is nicely in sync. However, this does not seem to be the case:<br>
<code>./build/x86_64-unknown-linux-gnu/stage0/bin/rustfmt compiler/rustc_middle/src/mir/interpret/pointer.rs</code> <a href="https://github.com/rust-lang/rustfmt/issues/4348#issuecomment-921353702">fails with a parse error </a>, but <code>x.py fmt</code> is able to format that same file just fine.<br>
So which rustfmt <em>does</em> <code>x.py</code> use, and what is that other rustfmt in stage0/bin about...?</p>



<a name="253672052"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Which%20rustfmt%20does%20x.py%20fmt%20use%3F/near/253672052" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Which.20rustfmt.20does.20x.2Epy.20fmt.20use.3F.html#253672052">(Sep 17 2021 at 00:36)</a>:</h4>
<p><span class="user-mention" data-user-id="120791">@RalfJ</span> This is the correct rustfmt.</p>



<a name="253672061"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Which%20rustfmt%20does%20x.py%20fmt%20use%3F/near/253672061" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Which.20rustfmt.20does.20x.2Epy.20fmt.20use.3F.html#253672061">(Sep 17 2021 at 00:36)</a>:</h4>
<p>I think you are missing <code>--edition=2018</code></p>



<a name="253672200"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Which%20rustfmt%20does%20x.py%20fmt%20use%3F/near/253672200" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Which.20rustfmt.20does.20x.2Epy.20fmt.20use.3F.html#253672200">(Sep 17 2021 at 00:38)</a>:</h4>
<p>That could probably be added to rustfmt.toml</p>



<a name="253672499"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Which%20rustfmt%20does%20x.py%20fmt%20use%3F/near/253672499" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Which.20rustfmt.20does.20x.2Epy.20fmt.20use.3F.html#253672499">(Sep 17 2021 at 00:42)</a>:</h4>
<p><span class="user-mention silent" data-user-id="120518">Eric Huss</span> <a href="#narrow/stream/122651-general/topic/Which.20rustfmt.20does.20x.2Epy.20fmt.20use.3F/near/253672061">said</a>:</p>
<blockquote>
<p>I think you are missing <code>--edition=2018</code></p>
</blockquote>
<p>oh, interesting. so vscode should add that flag?</p>



<a name="253672545"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Which%20rustfmt%20does%20x.py%20fmt%20use%3F/near/253672545" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Which.20rustfmt.20does.20x.2Epy.20fmt.20use.3F.html#253672545">(Sep 17 2021 at 00:43)</a>:</h4>
<p>Sorry, I don't use vscode, I'm not too familiar with its plugins.</p>



<a name="253672551"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Which%20rustfmt%20does%20x.py%20fmt%20use%3F/near/253672551" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Which.20rustfmt.20does.20x.2Epy.20fmt.20use.3F.html#253672551">(Sep 17 2021 at 00:43)</a>:</h4>
<p>I would assume there is a config option somewhere</p>



<a name="253672755"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Which%20rustfmt%20does%20x.py%20fmt%20use%3F/near/253672755" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Which.20rustfmt.20does.20x.2Epy.20fmt.20use.3F.html#253672755">(Sep 17 2021 at 00:46)</a>:</h4>
<p>well it should know the edition from the cargo file. but this is helpful, I will take it back to the RA bug report. Thanks!</p>



<a name="253672796"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Which%20rustfmt%20does%20x.py%20fmt%20use%3F/near/253672796" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Which.20rustfmt.20does.20x.2Epy.20fmt.20use.3F.html#253672796">(Sep 17 2021 at 00:47)</a>:</h4>
<p>there are a few options used -- see <code>src/bootstrap/format.rs</code></p>



<a name="253672892"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Which%20rustfmt%20does%20x.py%20fmt%20use%3F/near/253672892" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Which.20rustfmt.20does.20x.2Epy.20fmt.20use.3F.html#253672892">(Sep 17 2021 at 00:48)</a>:</h4>
<p>The issue is that the instructions at <a href="https://rustc-dev-guide.rust-lang.org/building/suggested.html?highlight=vscode#configuring-rust-analyzer-for-rustc">https://rustc-dev-guide.rust-lang.org/building/suggested.html?highlight=vscode#configuring-rust-analyzer-for-rustc</a> are wrong^^</p>



<a name="253672905"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Which%20rustfmt%20does%20x.py%20fmt%20use%3F/near/253672905" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Which.20rustfmt.20does.20x.2Epy.20fmt.20use.3F.html#253672905">(Sep 17 2021 at 00:48)</a>:</h4>
<p>it should be</p>
<div class="codehilite"><pre><span></span><code>    &quot;rust-analyzer.rustfmt.overrideCommand&quot;: [
        &quot;./build/x86_64-unknown-linux-gnu/stage0/bin/rustfmt&quot;,
        &quot;--edition=2018&quot;
    ],
</code></pre></div>



<a name="253682460"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Which%20rustfmt%20does%20x.py%20fmt%20use%3F/near/253682460" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Which.20rustfmt.20does.20x.2Epy.20fmt.20use.3F.html#253682460">(Sep 17 2021 at 03:02)</a>:</h4>
<p><span class="user-mention" data-user-id="120791">@RalfJ</span> are you interested in making a PR to that effect? ;)</p>



<a name="253742211"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Which%20rustfmt%20does%20x.py%20fmt%20use%3F/near/253742211" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Which.20rustfmt.20does.20x.2Epy.20fmt.20use.3F.html#253742211">(Sep 17 2021 at 13:32)</a>:</h4>
<p>interested, yes. but my backlog is still quite long.^^ this is a sideshow of a sideshow of a rabbit hole I went down...</p>



<a name="253798400"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Which%20rustfmt%20does%20x.py%20fmt%20use%3F/near/253798400" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Frank Steffahn <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Which.20rustfmt.20does.20x.2Epy.20fmt.20use.3F.html#253798400">(Sep 17 2021 at 19:52)</a>:</h4>
<p>Made a PR so you don't have to <span aria-label="wink" class="emoji emoji-1f609" role="img" title="wink">:wink:</span>: <a href="https://github.com/rust-lang/rustc-dev-guide/pull/1207">https://github.com/rust-lang/rustc-dev-guide/pull/1207</a></p>
<p>cc <span class="user-mention" data-user-id="232545">@Joshua Nelson</span> <span class="user-mention" data-user-id="120791">@RalfJ</span></p>



<a name="253798562"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Which%20rustfmt%20does%20x.py%20fmt%20use%3F/near/253798562" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Which.20rustfmt.20does.20x.2Epy.20fmt.20use.3F.html#253798562">(Sep 17 2021 at 19:53)</a>:</h4>
<p>amazing, thank you! <span aria-label="heart" class="emoji emoji-2764" role="img" title="heart">:heart:</span></p>



<a name="253848176"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Which%20rustfmt%20does%20x.py%20fmt%20use%3F/near/253848176" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim McNamara <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Which.20rustfmt.20does.20x.2Epy.20fmt.20use.3F.html#253848176">(Sep 18 2021 at 07:36)</a>:</h4>
<p>Adding the <code>&lt;!-.. date --&gt;</code> comment was a nice touch <span class="user-mention" data-user-id="280891">@Frank Steffahn</span> .</p>



<a name="253861689"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Which%20rustfmt%20does%20x.py%20fmt%20use%3F/near/253861689" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Which.20rustfmt.20does.20x.2Epy.20fmt.20use.3F.html#253861689">(Sep 18 2021 at 11:29)</a>:</h4>
<p>What's the comment for?</p>



<a name="253863168"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Which%20rustfmt%20does%20x.py%20fmt%20use%3F/near/253863168" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Frank Steffahn <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Which.20rustfmt.20does.20x.2Epy.20fmt.20use.3F.html#253863168">(Sep 18 2021 at 11:57)</a>:</h4>
<p><span class="user-mention" data-user-id="203546">@Laurențiu</span> <a href="https://github.com/rust-lang/rustc-dev-guide/pull/1037">https://github.com/rust-lang/rustc-dev-guide/pull/1037</a></p>



<a name="253863763"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Which%20rustfmt%20does%20x.py%20fmt%20use%3F/near/253863763" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Which.20rustfmt.20does.20x.2Epy.20fmt.20use.3F.html#253863763">(Sep 18 2021 at 12:06)</a>:</h4>
<p>Ah, thanks</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>