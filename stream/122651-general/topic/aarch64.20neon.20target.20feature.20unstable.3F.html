<html>
<head><meta charset="utf-8"><title>aarch64 neon target feature unstable? · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/aarch64.20neon.20target.20feature.20unstable.3F.html">aarch64 neon target feature unstable?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="273244372"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/aarch64%20neon%20target%20feature%20unstable%3F/near/273244372" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/aarch64.20neon.20target.20feature.20unstable.3F.html#273244372">(Feb 25 2022 at 15:39)</a>:</h4>
<p>Hello everyone! I was pleased to see that the neon intrinsics where stabilized with rust 1.59.0, however when trying to declare a function annotated with the <code>neon</code> target feature, compiler says that it's still unstable:</p>
<div class="codehilite"><pre><span></span><code>bash-5.1# rustc --version
rustc 1.59.0 (9d1b2106e 2022-02-23)
bash-5.1# cat neon.rs
use std::arch::aarch64::*;

#[target_feature(enable = &quot;neon&quot;)]
unsafe fn aarch64_intrinsic() {
    let a = unsafe { vdupq_n_u8(7) };
    println!(&quot;a = {:?}&quot;, a);
}

pub fn main() {
        unsafe { aarch64_intrinsic() };
}
bash-5.1# rustc neon.rs
error[E0658]: the target feature `neon` is currently unstable
 --&gt; neon.rs:3:18
  |
3 | #[target_feature(enable = &quot;neon&quot;)]
  |                  ^^^^^^^^^^^^^^^
  |
  = note: see issue #44839 &lt;https://github.com/rust-lang/rust/issues/44839&gt; for more information

error: aborting due to previous error

For more information about this error, try `rustc --explain E0658`.
</code></pre></div>
<p>I have also asked in <a href="https://github.com/rust-lang/rust/issues/90972">https://github.com/rust-lang/rust/issues/90972</a> but it's very unclear to me what has been stabilized since the official doc of libstd and libcore are saying that the intrinsics are still unstable like in <a href="https://doc.rust-lang.org/core/arch/aarch64/fn.vdupq_n_u8.html">https://doc.rust-lang.org/core/arch/aarch64/fn.vdupq_n_u8.html</a></p>



<a name="273246632"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/aarch64%20neon%20target%20feature%20unstable%3F/near/273246632" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amanieu <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/aarch64.20neon.20target.20feature.20unstable.3F.html#273246632">(Feb 25 2022 at 16:00)</a>:</h4>
<p>The aarch64 target features are being stabilized in <a href="https://github.com/rust-lang/rust/pull/90621">this</a> PR.</p>



<a name="273246875"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/aarch64%20neon%20target%20feature%20unstable%3F/near/273246875" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/aarch64.20neon.20target.20feature.20unstable.3F.html#273246875">(Feb 25 2022 at 16:01)</a>:</h4>
<p>It can be a little confusing.  The target_feature is on track to be stabilized in 1.61: <a href="https://github.com/rust-lang/rust/pull/90621">https://github.com/rust-lang/rust/pull/90621</a></p>
<p>The intrinsics were stabilized in 1.59, but the documentation on <a href="http://doc.rust-lang.org">doc.rust-lang.org</a> is built for x86_64.  It's not clear to me why the stability attributes are conditioned like that.</p>



<a name="273248438"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/aarch64%20neon%20target%20feature%20unstable%3F/near/273248438" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/aarch64.20neon.20target.20feature.20unstable.3F.html#273248438">(Feb 25 2022 at 16:14)</a>:</h4>
<p>(Just for note, the doc issue is tracked in <a href="https://github.com/rust-lang/stdarch/issues/1268">https://github.com/rust-lang/stdarch/issues/1268</a>)</p>



<a name="273255816"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/aarch64%20neon%20target%20feature%20unstable%3F/near/273255816" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/aarch64.20neon.20target.20feature.20unstable.3F.html#273255816">(Feb 25 2022 at 17:08)</a>:</h4>
<p>Thanks!<br>
I think the version specified in the stabilization PR for the neon target feature is wrong though, because it says <code>1.60.0</code></p>



<a name="273256102"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/aarch64%20neon%20target%20feature%20unstable%3F/near/273256102" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/aarch64.20neon.20target.20feature.20unstable.3F.html#273256102">(Feb 25 2022 at 17:10)</a>:</h4>
<p>So until 1.61.0 is released using those intrinsics is possible only because the neon target feature is enabled by default on aarch64?<br>
Its kind of a weird  situation in stable then because it means we are able to <em>use</em> intrinsics that depend on a target feature that we cannot control</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>