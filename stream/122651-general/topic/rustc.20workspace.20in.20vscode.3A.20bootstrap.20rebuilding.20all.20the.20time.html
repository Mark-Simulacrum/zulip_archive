<html>
<head><meta charset="utf-8"><title>rustc workspace in vscode: bootstrap rebuilding all the time · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/rustc.20workspace.20in.20vscode.3A.20bootstrap.20rebuilding.20all.20the.20time.html">rustc workspace in vscode: bootstrap rebuilding all the time</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="273343341"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/rustc%20workspace%20in%20vscode%3A%20bootstrap%20rebuilding%20all%20the%20time/near/273343341" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/rustc.20workspace.20in.20vscode.3A.20bootstrap.20rebuilding.20all.20the.20time.html#273343341">(Feb 26 2022 at 14:18)</a>:</h4>
<p>When using vscode + r-a to work on rustc itself, it recently started re-building the <code>bootstrap</code> binaries all the time:</p>
<ul>
<li>work in vscode, hit Ctrl-S so it does <code>x.py check</code></li>
<li>on the terminal, use some <code>x.py</code> command. it rebuilds the bootstrap binaries.</li>
<li>some more work in vsocde, Ctrl-S. (not working in bootstrap, just in <code>compiler</code>)</li>
<li>back to the terminal, it rebuilds bootstrap <em>again</em>.</li>
</ul>
<p>This wasn't the case a few months ago, and I haven't changed my settings since then. Not sure what else could have changed to lead to this. does anyone have an idea what might be going on?</p>



<a name="273343345"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/rustc%20workspace%20in%20vscode%3A%20bootstrap%20rebuilding%20all%20the%20time/near/273343345" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/rustc.20workspace.20in.20vscode.3A.20bootstrap.20rebuilding.20all.20the.20time.html#273343345">(Feb 26 2022 at 14:18)</a>:</h4>
<p>my workspace settings are</p>
<div class="codehilite"><pre><span></span><code>{
    &quot;rust-analyzer.checkOnSave.enable&quot;: true,
    &quot;rust-analyzer.checkOnSave.overrideCommand&quot;: [
        &quot;./x.py&quot;,
        &quot;check&quot;,
        &quot;--json-output&quot;,
        &quot;library/std&quot;,
        &quot;compiler/rustc&quot;,
    ],
    &quot;rust-analyzer.rustfmt.overrideCommand&quot;: [
        &quot;./build/x86_64-unknown-linux-gnu/stage0/bin/rustfmt&quot;,
        &quot;--edition=2021&quot;
    ],
    &quot;rust-analyzer.rustcSource&quot;: &quot;./Cargo.toml&quot;,
    &quot;rust-analyzer.cargo.runBuildScripts&quot;: false,
    &quot;rust-analyzer.procMacro.enable&quot;: false,
    /*&quot;rust-analyzer.linkedProjects&quot;: [
        &quot;./Cargo.toml&quot;,
        &quot;./compiler/rustc_codegen_cranelift/Cargo.toml&quot; // see https://github.com/rust-analyzer/rust-analyzer/issues/8937
    ],*/
    &quot;editor.formatOnSave&quot;: false,
    &quot;files.watcherExclude&quot;: {
        &quot;*rustc*/src/llvm-project/**&quot;: true,
        &quot;*rustc*/build/**&quot;: true,
    },
    &quot;files.exclude&quot;: {
        &quot;src/llvm-project/**&quot;: true,
        &quot;build/**&quot;: true
    },
}
</code></pre></div>



<a name="273343365"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/rustc%20workspace%20in%20vscode%3A%20bootstrap%20rebuilding%20all%20the%20time/near/273343365" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/rustc.20workspace.20in.20vscode.3A.20bootstrap.20rebuilding.20all.20the.20time.html#273343365">(Feb 26 2022 at 14:19)</a>:</h4>
<p>Are you using <code>sccache</code> or another <code>RUSTC_WRAPPER</code>?</p>



<a name="273344487"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/rustc%20workspace%20in%20vscode%3A%20bootstrap%20rebuilding%20all%20the%20time/near/273344487" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/rustc.20workspace.20in.20vscode.3A.20bootstrap.20rebuilding.20all.20the.20time.html#273344487">(Feb 26 2022 at 14:42)</a>:</h4>
<p>or RUSTFLAGS?</p>



<a name="273347593"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/rustc%20workspace%20in%20vscode%3A%20bootstrap%20rebuilding%20all%20the%20time/near/273347593" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/rustc.20workspace.20in.20vscode.3A.20bootstrap.20rebuilding.20all.20the.20time.html#273347593">(Feb 26 2022 at 15:42)</a>:</h4>
<p>no</p>



<a name="273347616"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/rustc%20workspace%20in%20vscode%3A%20bootstrap%20rebuilding%20all%20the%20time/near/273347616" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/rustc.20workspace.20in.20vscode.3A.20bootstrap.20rebuilding.20all.20the.20time.html#273347616">(Feb 26 2022 at 15:43)</a>:</h4>
<p>it almost seems like r-a is setting some env var for its invocation that does not apply for my invocation</p>



<a name="273347733"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/rustc%20workspace%20in%20vscode%3A%20bootstrap%20rebuilding%20all%20the%20time/near/273347733" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/rustc.20workspace.20in.20vscode.3A.20bootstrap.20rebuilding.20all.20the.20time.html#273347733">(Feb 26 2022 at 15:45)</a>:</h4>
<p>The only change that sets an env that happened recently is this iirc <a href="https://github.com/rust-analyzer/rust-analyzer/pull/11356">https://github.com/rust-analyzer/rust-analyzer/pull/11356</a></p>



<a name="273347745"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/rustc%20workspace%20in%20vscode%3A%20bootstrap%20rebuilding%20all%20the%20time/near/273347745" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/rustc.20workspace.20in.20vscode.3A.20bootstrap.20rebuilding.20all.20the.20time.html#273347745">(Feb 26 2022 at 15:45)</a>:</h4>
<p>Which shouldn't apply for you here</p>



<a name="273348092"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/rustc%20workspace%20in%20vscode%3A%20bootstrap%20rebuilding%20all%20the%20time/near/273348092" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/rustc.20workspace.20in.20vscode.3A.20bootstrap.20rebuilding.20all.20the.20time.html#273348092">(Feb 26 2022 at 15:53)</a>:</h4>
<p>In the terminal, run x.py with <code>CARGO_LOG=cargo::core::compiler::fingerprint=trace</code>.  If the answer isn't obvious in the output, post it somewhere like a gist and I can help decrypt it for you.</p>



<a name="273348248"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/rustc%20workspace%20in%20vscode%3A%20bootstrap%20rebuilding%20all%20the%20time/near/273348248" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/rustc.20workspace.20in.20vscode.3A.20bootstrap.20rebuilding.20all.20the.20time.html#273348248">(Feb 26 2022 at 15:57)</a>:</h4>
<p>We need that in the RA docs</p>



<a name="273367531"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/rustc%20workspace%20in%20vscode%3A%20bootstrap%20rebuilding%20all%20the%20time/near/273367531" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/rustc.20workspace.20in.20vscode.3A.20bootstrap.20rebuilding.20all.20the.20time.html#273367531">(Feb 26 2022 at 22:48)</a>:</h4>
<p><span class="user-mention silent" data-user-id="120518">Eric Huss</span> <a href="#narrow/stream/122651-general/topic/rustc.20workspace.20in.20vscode.3A.20bootstrap.20rebuilding.20all.20the.20time/near/273348092">said</a>:</p>
<blockquote>
<p>In the terminal, run x.py with <code>CARGO_LOG=cargo::core::compiler::fingerprint=trace</code>.  If the answer isn't obvious in the output, post it somewhere like a gist and I can help decrypt it for you.</p>
</blockquote>
<p>thanks! I am not quite sure what to look for: <a href="https://pastebin.com/3NV6vsgc">https://pastebin.com/3NV6vsgc</a></p>



<a name="273367564"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/rustc%20workspace%20in%20vscode%3A%20bootstrap%20rebuilding%20all%20the%20time/near/273367564" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/rustc.20workspace.20in.20vscode.3A.20bootstrap.20rebuilding.20all.20the.20time.html#273367564">(Feb 26 2022 at 22:49)</a>:</h4>
<p>I guess this is important</p>
<div class="codehilite"><pre><span></span><code>    Caused by:
        new (build_script_build/c6708447b4401654) != old (build_script_build/24ccd4c58836ef88)
</code></pre></div>



<a name="273367693"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/rustc%20workspace%20in%20vscode%3A%20bootstrap%20rebuilding%20all%20the%20time/near/273367693" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/rustc.20workspace.20in.20vscode.3A.20bootstrap.20rebuilding.20all.20the.20time.html#273367693">(Feb 26 2022 at 22:52)</a>:</h4>
<p>looking at the build script <code>src/bootstrap/build.rs</code>, I see this</p>
<div class="codehilite"><pre><span></span><code>println!(&quot;cargo:rerun-if-env-changed=PATH&quot;);
</code></pre></div>
<p>that seems... excessive? vscode most probably doesnt have the same PATH as my terminal</p>



<a name="273368201"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/rustc%20workspace%20in%20vscode%3A%20bootstrap%20rebuilding%20all%20the%20time/near/273368201" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/rustc.20workspace.20in.20vscode.3A.20bootstrap.20rebuilding.20all.20the.20time.html#273368201">(Feb 26 2022 at 23:00)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/issues/94408">https://github.com/rust-lang/rust/issues/94408</a></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>