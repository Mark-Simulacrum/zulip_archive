<html>
<head><meta charset="utf-8"><title>serde skip function pointer · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/serde.20skip.20function.20pointer.html">serde skip function pointer</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="259819475"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/serde%20skip%20function%20pointer/near/259819475" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vitaly Artemiev <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/serde.20skip.20function.20pointer.html#259819475">(Nov 01 2021 at 01:45)</a>:</h4>
<p>Hello, I'm fairly new to Rust and have run into the following issue:</p>
<div class="codehilite"><pre><span></span><code>filename.rs:

pub type MyFnType = fn(usize) -&gt; usize;
pub fn default_fn(index: usize) -&gt; usize {
    0
}

#[derive(Serialize, Deserialize)]
pub struct MyStruct {
    pub some_var: usize,
    #[serde(skip)]
    #[serde(default = &quot;crate::filename::default_fn&quot;)]

    pub fun_var: MyFnType,
}
</code></pre></div>
<p>The issue is serde can't serialize a function pointer, so I am forced to skip it. Serde then tries to find a MyFnType::default() function, but it doesn't exist and can't exist because of orphan trait rule or however it's called. So I try to pass in a default value by hand, but it seems serde's default macro is trying to call the function instead of passing the function pointer. I see two options: write a custom deserializer for MyStruct or write a function that returns a closure of type MyFnType, but both options seem somewhat silly to me. Is there no trivial way to fix this? </p>
<p>Thanks in advance.</p>



<a name="259819748"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/serde%20skip%20function%20pointer/near/259819748" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/serde.20skip.20function.20pointer.html#259819748">(Nov 01 2021 at 01:53)</a>:</h4>
<p>tried wrapping it in an option <code>Option</code>?</p>



<a name="259819821"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/serde%20skip%20function%20pointer/near/259819821" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/serde.20skip.20function.20pointer.html#259819821">(Nov 01 2021 at 01:55)</a>:</h4>
<p>You can define a function that returns <code>crate::filename::default_fn</code> and use that new function with <code>#[serde(default)]</code>. I think that's the way to do it with Serde.</p>



<a name="259820168"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/serde%20skip%20function%20pointer/near/259820168" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vitaly Artemiev <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/serde.20skip.20function.20pointer.html#259820168">(Nov 01 2021 at 02:01)</a>:</h4>
<p>Thanks, for some reason I thought you can only return closures, not functions</p>



<a name="259820411"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/serde%20skip%20function%20pointer/near/259820411" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vitaly Artemiev <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/serde.20skip.20function.20pointer.html#259820411">(Nov 01 2021 at 02:06)</a>:</h4>
<p>Kinda strange that there's no issue about this in serde repository or anywhere, I wouldn't think this is such a rare use case</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>