<html>
<head><meta charset="utf-8"><title>New target · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20target.html">New target</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="270909425"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20target/near/270909425" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> infrandomness <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20target.html#270909425">(Feb 06 2022 at 20:15)</a>:</h4>
<p>Hello everyone, I am trying to add a new target to cargo/rust for an unsupported UNIX operating system, but I am confused on how I am supposed to do such a thing, I have red <a href="https://rustc-dev-guide.rust-lang.org/building/new-target.html">https://rustc-dev-guide.rust-lang.org/building/new-target.html</a> but I'm not sure where I am supposed to define that JSON file and such.<br>
I'd really appreciate for someone to shed some light on the subject! :D</p>



<a name="270910853"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20target/near/270910853" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20target.html#270910853">(Feb 06 2022 at 20:47)</a>:</h4>
<p>You can save it anywhere. The JSON file is for out-of-tree targets. You can point <code>--target</code> to the path of the JSON file. For adding an in-tree target you need to create a new rust file in <code>compiler/rustc_target/src/spec</code> and reference it from <code>mod.rs</code> in the same directory. You can look at other targets for examples. Generally you have one <code>&lt;os_name&gt;_base.rs</code> file for arch independent information and then a <code>&lt;triple_name&gt;.rs</code> for each supported target of the OS using the base target spec in <code>&lt;os_name&gt;_base.rs</code>.</p>



<a name="270911553"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20target/near/270911553" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> infrandomness <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20target.html#270911553">(Feb 06 2022 at 21:00)</a>:</h4>
<p>Alright ! Sounds good, and from there I need to reimplement the new calls to the libc ?</p>



<a name="270912606"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20target/near/270912606" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20target.html#270912606">(Feb 06 2022 at 21:22)</a>:</h4>
<p><span class="user-mention" data-user-id="459607">@infrandomness</span> Those changes would go in a combination of the <code>libc</code> crate and the <code>sys</code> area of rust-lang/rust.</p>



<a name="270912608"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20target/near/270912608" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20target.html#270912608">(Feb 06 2022 at 21:22)</a>:</h4>
<p>(deleted)</p>



<a name="270912623"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20target/near/270912623" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20target.html#270912623">(Feb 06 2022 at 21:22)</a>:</h4>
<p>Though if your OS is UNIX-like, hopefully you can share <em>most</em> of the code from other UNIX-like systems.</p>



<a name="270912837"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20target/near/270912837" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> infrandomness <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20target.html#270912837">(Feb 06 2022 at 21:26)</a>:</h4>
<p>I will start working on this in a fork, thanks for the help ! <br>
May I let this open to ask for help down the line when need arises ?</p>



<a name="270916756"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20target/near/270916756" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20target.html#270916756">(Feb 06 2022 at 22:58)</a>:</h4>
<p>Sure, or you may want to start a new topic with the name of the target.</p>



<a name="270916768"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20target/near/270916768" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20target.html#270916768">(Feb 06 2022 at 22:59)</a>:</h4>
<p>Also, start looking at the target tier policy early, to make sure your target can meet it.</p>



<a name="270916771"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20target/near/270916771" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20target.html#270916771">(Feb 06 2022 at 22:59)</a>:</h4>
<p>Happy to review.</p>



<a name="270916778"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20target/near/270916778" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20target.html#270916778">(Feb 06 2022 at 22:59)</a>:</h4>
<p>You'll want to go over that before you do a large amount of coding.</p>



<a name="271040866"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20target/near/271040866" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20target.html#271040866">(Feb 07 2022 at 20:59)</a>:</h4>
<p><a href="https://doc.rust-lang.org/nightly/rustc/target-tier-policy.html">https://doc.rust-lang.org/nightly/rustc/target-tier-policy.html</a><br>
<a href="https://doc.rust-lang.org/nightly/rustc/platform-support.html">https://doc.rust-lang.org/nightly/rustc/platform-support.html</a></p>



<a name="271041475"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20target/near/271041475" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20target.html#271041475">(Feb 07 2022 at 21:03)</a>:</h4>
<p>Both those pages should probably be linked from the "adding a new target" page with a small explanation.</p>



<a name="271042489"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20target/near/271042489" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20target.html#271042489">(Feb 07 2022 at 21:12)</a>:</h4>
<p><span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="271042515"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20target/near/271042515" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20target.html#271042515">(Feb 07 2022 at 21:12)</a>:</h4>
<p>Would be happy to r+ a PR to that effect.</p>



<a name="271062794"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20target/near/271062794" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> infrandomness <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20target.html#271062794">(Feb 08 2022 at 00:13)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/122651-general/topic/New.20target/near/270916768">said</a>:</p>
<blockquote>
<p>Also, start looking at the target tier policy early, to make sure your target can meet it.</p>
</blockquote>
<p>I think my target is mostly compatible with all of the points of a tier 3 target, and if it turns out this cannot be merged then I will keep it in its own branch with a draft PR until it is ready :D</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>