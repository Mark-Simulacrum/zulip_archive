<html>
<head><meta charset="utf-8"><title>New rustacean confused about lifetimes · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html">New rustacean confused about lifetimes</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="266619211"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266619211" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sergey A New Rustacean <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266619211">(Jan 02 2022 at 15:36)</a>:</h4>
<p>Hello, Rust Community! I have started learning Rust recently (previous experience: x86 assemble, C, C++, Python), today I read about lifetimes and I am very confused. I wonder if there is anybody I can talk to about lifetimes? :)</p>



<a name="266619400"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266619400" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sergey A New Rustacean <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266619400">(Jan 02 2022 at 15:41)</a>:</h4>
<p>The first problem I have with lifetimes is: as I understand, in some cases (which are described in The Book under Lifetime Elision section) the compiler and borrow checker can figure lifetimes out without my help. In other cases I have to specify them manually. As I saw from the examples in The Book, if I get the lifetimes wrong the compiler will still shout at me and refuse to compile the code. Is it always the case? That is, is it possible to get the lifetimes wrong, but in such a way that the compiler will not catch the error? If it is possible, then I guess that would violate Rust's guarantees about no dangling references, which seems to be "impossible" without unsafe. But if the compiler can catch any kind of "the programmer messed the lifetimes up" error, then wouldn't it be able to get them right without my help? Or is it the situation similar to some algorithmic problems being easy to check if the solution is good, but being hard to find the solution in general case? Like, the compiler will always catch the error if I mess the lifetimes up, but will not get them right without manual specifications unless the situation is trivial (three rules)?</p>



<a name="266619494"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266619494" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266619494">(Jan 02 2022 at 15:43)</a>:</h4>
<p>Do you have a Discord account? Your questions would fit better on one of the Rust discord servers, since this Zulip is mainly about working on the language itself</p>



<a name="266619530"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266619530" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266619530">(Jan 02 2022 at 15:44)</a>:</h4>
<p>I'd be happy to answer your questions there</p>



<a name="266619571"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266619571" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sergey A New Rustacean <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266619571">(Jan 02 2022 at 15:45)</a>:</h4>
<p>I tried to get a Discord account, but Discord challenged me with various validations and tests, and at the end locked me out. Seems like my phone number is now associated with one of the partially created accounts, and I can't get the validation code for a seemingly-ok account, because the number is already in use. :(</p>



<a name="266619621"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266619621" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sergey A New Rustacean <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266619621">(Jan 02 2022 at 15:46)</a>:</h4>
<p>Anyway, I will try again, if this question fits better in Discord</p>



<a name="266619625"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266619625" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266619625">(Jan 02 2022 at 15:46)</a>:</h4>
<p>Is there more than one Discord server?</p>



<a name="266619628"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266619628" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266619628">(Jan 02 2022 at 15:46)</a>:</h4>
<p>I can answer it here if you're having problems</p>



<a name="266619638"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266619638" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266619638">(Jan 02 2022 at 15:46)</a>:</h4>
<p>Yes - there's the main Rust language server, and the Rust community server</p>



<a name="266619654"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266619654" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sergey A New Rustacean <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266619654">(Jan 02 2022 at 15:47)</a>:</h4>
<p>It seems like I do have problems with Discord, so if you don't mind, I would be very glad to get answers here)</p>



<a name="266619656"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266619656" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266619656">(Jan 02 2022 at 15:47)</a>:</h4>
<p>There are a couple parts to the answer to your question</p>



<a name="266619657"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266619657" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266619657">(Jan 02 2022 at 15:47)</a>:</h4>
<p>Yeah, I just noticed</p>



<a name="266619662"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266619662" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266619662">(Jan 02 2022 at 15:47)</a>:</h4>
<p>One of the reasons that the compiler requires you to manually specify certain lifetimes is to separate the 'header' of a function from its body</p>



<a name="266619701"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266619701" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266619701">(Jan 02 2022 at 15:48)</a>:</h4>
<p>Here's an example. Consider these two functions:</p>



<a name="266619718"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266619718" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266619718">(Jan 02 2022 at 15:49)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">first</span><span class="o">&lt;'</span><span class="na">a</span><span class="p">,</span><span class="w"> </span><span class="o">'</span><span class="na">b</span><span class="o">&gt;</span><span class="p">(</span><span class="n">first_arg</span>: <span class="kp">&amp;</span><span class="o">'</span><span class="na">a</span> <span class="kt">str</span><span class="p">,</span><span class="w"> </span><span class="n">second_arg</span>: <span class="kp">&amp;</span><span class="o">'</span><span class="na">b</span> <span class="kt">str</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="o">'</span><span class="na">a</span> <span class="kt">str</span> <span class="p">{</span><span class="w"> </span><span class="n">first_arg</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">second</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="p">(</span><span class="n">first_arg</span>: <span class="kp">&amp;</span><span class="o">'</span><span class="na">a</span> <span class="kt">str</span><span class="p">,</span><span class="w"> </span><span class="n">second_arg</span>: <span class="kp">&amp;</span><span class="o">'</span><span class="na">a</span> <span class="kt">str</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="o">'</span><span class="na">a</span> <span class="kt">str</span> <span class="p">{</span><span class="w"> </span><span class="n">second_arg</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="266619736"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266619736" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266619736">(Jan 02 2022 at 15:49)</a>:</h4>
<p>The function <code>first</code> takes in two strings, which can have <em>different</em> lifetimes. It then returns a string with the lifetime of the <em>first</em> argument</p>



<a name="266619766"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266619766" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266619766">(Jan 02 2022 at 15:50)</a>:</h4>
<p>The function <code>second</code> takes in two strings, which must have the <em>same</em> lifetime. It then returns a string with that lifetime</p>



<a name="266619791"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266619791" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266619791">(Jan 02 2022 at 15:50)</a>:</h4>
<p>These functions impose different kind of restrictions on the caller</p>



<a name="266619794"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266619794" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sergey A New Rustacean <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266619794">(Jan 02 2022 at 15:50)</a>:</h4>
<p>So do I get it right, that lifetime annotations (either automatic, or manually provided) are strictly required on the call site, so they must be a part of declaration, even if the body would make everything clear?</p>



<a name="266619798"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266619798" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266619798">(Jan 02 2022 at 15:51)</a>:</h4>
<p>Sort of</p>



<a name="266619817"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266619817" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266619817">(Jan 02 2022 at 15:51)</a>:</h4>
<p>If I had just written those function bodies (with no lifetimes specified), the compiler wouldn't know for sure what the lifetime of the return value should be</p>



<a name="266619822"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266619822" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266619822">(Jan 02 2022 at 15:51)</a>:</h4>
<p>It could try to infer that, based on which of the two arguments I returned</p>



<a name="266619867"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266619867" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266619867">(Jan 02 2022 at 15:52)</a>:</h4>
<p>However, that could make changing the body of the function break some callers of that function, making them stop compiling</p>



<a name="266619879"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266619879" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266619879">(Jan 02 2022 at 15:52)</a>:</h4>
<p>The function <code>first</code> can be called with any two strings - one could be short-lived and the other long-lived, for example</p>



<a name="266619892"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266619892" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266619892">(Jan 02 2022 at 15:53)</a>:</h4>
<p>By writing that down in the signature, the compiler will enforce that fact within the function</p>



<a name="266619897"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266619897" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sergey A New Rustacean <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266619897">(Jan 02 2022 at 15:53)</a>:</h4>
<p>So technically the body is enough to infer the lifetimes, but the lifetimes become part of the API contract, so I manually provide them to define the contract that I am okay with?</p>



<a name="266619898"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266619898" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266619898">(Jan 02 2022 at 15:53)</a>:</h4>
<p>For example, it won't let me return <code>second_arg</code> from <code>first</code>, because it could have a different lifetime</p>



<a name="266619939"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266619939" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266619939">(Jan 02 2022 at 15:54)</a>:</h4>
<p>Essentially, yes. If you write a closure, the compiler will typically infer the lifetimes for you</p>



<a name="266619945"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266619945" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266619945">(Jan 02 2022 at 15:54)</a>:</h4>
<p>Here's a more concrete example:</p>



<a name="266619952"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266619952" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266619952">(Jan 02 2022 at 15:55)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">take_static</span><span class="p">(</span><span class="n">val</span>: <span class="kp">&amp;</span><span class="o">'</span><span class="nb">static</span> <span class="kt">str</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="fm">println!</span><span class="p">(</span><span class="s">"Val: {:?}"</span><span class="p">,</span><span class="w"> </span><span class="n">val</span><span class="p">);</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">take_any_str</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="p">(</span><span class="n">val</span>: <span class="kp">&amp;</span><span class="o">'</span><span class="na">a</span> <span class="kt">str</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="fm">println!</span><span class="p">(</span><span class="s">"Val: {:?}"</span><span class="p">,</span><span class="w"> </span><span class="n">val</span><span class="p">);</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="266619959"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266619959" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266619959">(Jan 02 2022 at 15:55)</a>:</h4>
<p>At runtime, these two functions behave identically</p>



<a name="266619970"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266619970" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266619970">(Jan 02 2022 at 15:56)</a>:</h4>
<p>However, I can do more things with <code>val</code> inside <code>take_static</code>, since I know that it's a <code>&amp;'static str</code>. I could send it to another thread, or store it in a global variable, for example</p>



<a name="266620016"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266620016" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sergey A New Rustacean <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266620016">(Jan 02 2022 at 15:56)</a>:</h4>
<p>Thank you, I get it! And will the compiler always catch me if the lifetimes (either automatic or manually provided) do not align with either the function body or the calling context?</p>



<a name="266620021"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266620021" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266620021">(Jan 02 2022 at 15:56)</a>:</h4>
<p>If you're only writing safe code, then yes</p>



<a name="266620030"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266620030" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266620030">(Jan 02 2022 at 15:56)</a>:</h4>
<p>the compiler won't let you write lifetimes that would lead to unsoundness (use-after frees, memory corruption, etc)</p>



<a name="266620039"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266620039" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266620039">(Jan 02 2022 at 15:57)</a>:</h4>
<p>When you write <code>unsafe</code> code, you need to make sure that the lifetimes you write are actually correct</p>



<a name="266620049"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266620049" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266620049">(Jan 02 2022 at 15:57)</a>:</h4>
<p>since <code>unsafe</code> code lets you bypass some of the checks that the compiler has in place</p>



<a name="266620060"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266620060" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266620060">(Jan 02 2022 at 15:57)</a>:</h4>
<p>For example, you can never actually write a function like this in safe code:</p>



<a name="266620109"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266620109" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266620109">(Jan 02 2022 at 15:58)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">impossible_extend</span><span class="o">&lt;'</span><span class="na">a</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">val</span>: <span class="kp">&amp;</span><span class="o">'</span><span class="na">a</span> <span class="nc">T</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="o">'</span><span class="nb">static</span> <span class="nc">T</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">???</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="266620122"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266620122" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266620122">(Jan 02 2022 at 15:58)</a>:</h4>
<p>(You <em>should</em> never be able to, if you can, probably in a very convoluted way, it's a bug)</p>



<a name="266620124"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266620124" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sergey A New Rustacean <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266620124">(Jan 02 2022 at 15:59)</a>:</h4>
<p>I see. It is impossible to get 'static runtime from "arbitrary" lifetime in general case</p>



<a name="266620127"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266620127" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266620127">(Jan 02 2022 at 15:59)</a>:</h4>
<p>In safe code, you can't pull a new <code>T</code> 'out of thin air', and you can't return an <code>&amp;'a T</code> where a <code>&amp;'static T</code> is expected</p>



<a name="266620131"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266620131" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266620131">(Jan 02 2022 at 15:59)</a>:</h4>
<p>In safe code, yes</p>



<a name="266620137"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266620137" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266620137">(Jan 02 2022 at 15:59)</a>:</h4>
<p>in unsafe code, it's a different story</p>



<a name="266620138"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266620138" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266620138">(Jan 02 2022 at 15:59)</a>:</h4>
<p>For example</p>



<a name="266620145"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266620145" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266620145">(Jan 02 2022 at 15:59)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">unsound_lifetime_extend</span><span class="o">&lt;'</span><span class="na">a</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">val</span>: <span class="kp">&amp;</span><span class="o">'</span><span class="na">a</span> <span class="nc">T</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="o">'</span><span class="nb">static</span> <span class="nc">T</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">unsafe</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span>::<span class="n">mem</span>::<span class="n">transmute</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="266620191"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266620191" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266620191">(Jan 02 2022 at 16:00)</a>:</h4>
<p><code>transmute</code> lets you re-interpret the underlying bytes of one type as another type</p>



<a name="266620229"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266620229" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266620229">(Jan 02 2022 at 16:00)</a>:</h4>
<p>Actually using this function can lead to crashes and memory corruption</p>



<a name="266620261"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266620261" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sergey A New Rustacean <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266620261">(Jan 02 2022 at 16:00)</a>:</h4>
<p>The typical C-style "do as I said" situation :D</p>



<a name="266620281"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266620281" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266620281">(Jan 02 2022 at 16:01)</a>:</h4>
<p>For example, I could write something like this:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">my_string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Hello"</span><span class="p">.</span><span class="n">to_string</span><span class="p">();</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">evil_pointer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unsound_lifetime_extend</span><span class="p">(</span><span class="o">&amp;</span><span class="n">my_string</span><span class="p">);</span><span class="w"></span>
<span class="nb">drop</span><span class="p">(</span><span class="n">my_string</span><span class="p">);</span><span class="w"> </span><span class="c1">// Memory get deallocated here</span>
<span class="fm">println!</span><span class="p">(</span><span class="s">"Oops: {:?}"</span><span class="p">,</span><span class="w"> </span><span class="n">evil_pointer</span><span class="p">);</span><span class="w"></span>
</code></pre></div>



<a name="266620311"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266620311" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266620311">(Jan 02 2022 at 16:01)</a>:</h4>
<p>If you're not writing <code>unsafe</code> code, then you don't need to worry about that (as long as all of the <code>unsafe</code> code that you end up <em>using</em> is written correctly)</p>



<a name="266620364"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266620364" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266620364">(Jan 02 2022 at 16:02)</a>:</h4>
<p>Going back to the <code>take_static</code> and <code>take_any_str</code> example:</p>



<a name="266620370"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266620370" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266620370">(Jan 02 2022 at 16:02)</a>:</h4>
<p>Both of those functions have identical bodies, so the compiler couldn't know which lifetime you wanted just from looking at the body</p>



<a name="266620384"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266620384" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266620384">(Jan 02 2022 at 16:03)</a>:</h4>
<p>However, which lifetime you choose in that situation is very important</p>



<a name="266620398"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266620398" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266620398">(Jan 02 2022 at 16:03)</a>:</h4>
<p>Taking in an <code>&amp;'a str</code> gives the caller maximum flexibility - they can pass in any string that they want</p>



<a name="266620435"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266620435" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266620435">(Jan 02 2022 at 16:04)</a>:</h4>
<p>However, it limits the flexibility of the function body - the compiler will assume that the string can no longer be used after your functions returns, so you can't store the string in a global variable, etc.</p>



<a name="266620455"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266620455" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266620455">(Jan 02 2022 at 16:04)</a>:</h4>
<p>Conversely, taking in an <code>&amp;'static str</code> greatly limits the flexibility of the caller</p>



<a name="266620457"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266620457" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sergey A New Rustacean <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266620457">(Jan 02 2022 at 16:04)</a>:</h4>
<p>Great, thank you! I have one more question about lifetimes: so far the only "named" lifetime I have encountered is 'static. As I understand, if I use it in function signature, it basically serves the same purpose as generic lifetimes, except it matches only the references that are valid for the whole program run time. But what happens if I define a reference with this lifetime? There is an example in The Book:<br>
let s: &amp;'static str = "I have a static lifetime.";<br>
I understand that string literals do have static lifetime in the meaning "they exist while the program runs". However, can I declare a reference to some other variable as having 'static lifetime? Will that ensure that the variable _does_ have 'static lifetime, or will it fail?</p>



<a name="266620476"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266620476" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266620476">(Jan 02 2022 at 16:05)</a>:</h4>
<p>String literals and other constants are special</p>



<a name="266620491"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266620491" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266620491">(Jan 02 2022 at 16:05)</a>:</h4>
<p>when the compiler sees "Hello, world", it will reserve space in the output binary/library for that string</p>



<a name="266620497"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266620497" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266620497">(Jan 02 2022 at 16:05)</a>:</h4>
<p>and construct a pointer that points into that section of the binary</p>



<a name="266620501"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266620501" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266620501">(Jan 02 2022 at 16:05)</a>:</h4>
<p>that's what allows the lifetime to be <code>&amp;'static</code></p>



<a name="266620508"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266620508" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266620508">(Jan 02 2022 at 16:05)</a>:</h4>
<p>the compiler does a similar thing when you write <code>&amp;25</code> or <code>&amp;true</code></p>



<a name="266620552"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266620552" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266620552">(Jan 02 2022 at 16:06)</a>:</h4>
<p>since the value is known at compile-time, the compiler can reserve space for in the binary itself, and create a reference that will always be valid</p>



<a name="266620562"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266620562" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266620562">(Jan 02 2022 at 16:06)</a>:</h4>
<p>In essentially any other case, that is <em>not</em> true</p>



<a name="266620568"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266620568" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sergey A New Rustacean <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266620568">(Jan 02 2022 at 16:06)</a>:</h4>
<p>So the only objects that have 'static lifetime are the ones that are eventually compiled into the binary, such as various hardcoded literals?</p>



<a name="266620575"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266620575" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266620575">(Jan 02 2022 at 16:06)</a>:</h4>
<p>There's a catch - you can leak memory at runtime to get something with a <code>'static</code> lifetime</p>



<a name="266620577"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266620577" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266620577">(Jan 02 2022 at 16:07)</a>:</h4>
<p>However, that's pretty rare in practice</p>



<a name="266620583"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266620583" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266620583">(Jan 02 2022 at 16:07)</a>:</h4>
<p>and you won't usually need to do that</p>



<a name="266620586"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266620586" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sergey A New Rustacean <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266620586">(Jan 02 2022 at 16:07)</a>:</h4>
<p>Does that involve unsafe?</p>



<a name="266620592"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266620592" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266620592">(Jan 02 2022 at 16:07)</a>:</h4>
<p>Interestingly, no - leaking memory is considered safe</p>



<a name="266620598"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266620598" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266620598">(Jan 02 2022 at 16:07)</a>:</h4>
<p>See <a href="https://doc.rust-lang.org/std/boxed/struct.Box.html#method.leak">https://doc.rust-lang.org/std/boxed/struct.Box.html#method.leak</a></p>



<a name="266620603"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266620603" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266620603">(Jan 02 2022 at 16:07)</a>:</h4>
<p>However, it's very very rare for that method to be what you actually want to use</p>



<a name="266620650"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266620650" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sergey A New Rustacean <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266620650">(Jan 02 2022 at 16:08)</a>:</h4>
<p>And after I leak memory, there is no way that the objects residing there are dropped, so they will live "forever" from that point in my program, so it is sort-of-static, right?</p>



<a name="266620656"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266620656" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266620656">(Jan 02 2022 at 16:08)</a>:</h4>
<p>That's right</p>



<a name="266620665"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266620665" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266620665">(Jan 02 2022 at 16:08)</a>:</h4>
<p>The compiler won't let you make a static reference to a local variable, though:</p>



<a name="266620668"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266620668" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266620668">(Jan 02 2022 at 16:09)</a>:</h4>
<p>This code will not compile:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">my_val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">bad_ref</span>: <span class="kp">&amp;</span><span class="o">'</span><span class="nb">static</span> <span class="kt">bool</span> <span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">my_val</span><span class="p">;</span><span class="w"> </span><span class="c1">// ERROR</span>
</code></pre></div>



<a name="266620684"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266620684" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266620684">(Jan 02 2022 at 16:09)</a>:</h4>
<p>that's because <code>my_val</code> is stored on the stack, which will get freed when the function returns</p>



<a name="266620752"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266620752" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266620752">(Jan 02 2022 at 16:10)</a>:</h4>
<p>When I was first learning Rust, it took me quite a bit of practice to get used to lifetimes</p>



<a name="266620770"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266620770" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266620770">(Jan 02 2022 at 16:11)</a>:</h4>
<p>At some point, after seeing enough compiler errors, you'll start to internalize some sense of why the compiler doesn't like your code :)</p>



<a name="266620994"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266620994" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sergey A New Rustacean <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266620994">(Jan 02 2022 at 16:15)</a>:</h4>
<p>Thank you! And one final question: in The Book when the signature with manually specified lifetimes was first introduced, there was the following wording:<br>
"...<br>
fn longest&lt;'a&gt;(x: &amp;'a str, y: &amp;'a str) -&gt; &amp;'a str {<br>
...<br>
The function signature now tells Rust that for some lifetime 'a, the function takes two parameters, both of which are string slices that live at least as long as lifetime 'a. The function signature also tells Rust that the string slice returned from the function will live at least as long as lifetime 'a."</p>
<p>This wording confused me a bit, because I thought: "if x and y have some lifetime that is at least 'a, and the return value also has some lifetime that is at least 'a, nothing guarantees that the lifetimes of x, y are at least as long as the lifetime of the return value". Later I inferred from the examples, that this signature matches 'a to be the intersection of lifetimes of x, y and return value, and ensures that it is so both in the body and the call site. Is this understanding correct? And if I have x: &amp;'a, y: &amp;'b, return value: &amp;'a, than this basically guarantees nothing about y, since anything matches standalone 'b?</p>



<a name="266621158"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266621158" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sergey A New Rustacean <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266621158">(Jan 02 2022 at 16:18)</a>:</h4>
<p>Would it then be right to say, that lifetime rules essentially are about the following:<br>
"whenever there are entities with the same lifetime parameter 'a, ensure that at the function body and at any call site the factual lifetimes have non-empty intersection"?</p>



<a name="266621221"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266621221" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266621221">(Jan 02 2022 at 16:20)</a>:</h4>
<blockquote>
<p>This wording confused me a bit, because I thought: "if x and y have some lifetime that is at least 'a, and the return value also has some lifetime that is at least 'a, nothing guarantees that the lifetimes of x, y are at least as long as the lifetime of the return value".</p>
</blockquote>
<p>You're absolutely correctly - the return value can actually have a <em>longer</em> lifetime than <code>x</code> or <code>y</code></p>



<a name="266621222"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266621222" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266621222">(Jan 02 2022 at 16:20)</a>:</h4>
<p>For example:</p>



<a name="266621232"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266621232" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266621232">(Jan 02 2022 at 16:20)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">longest</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="p">(</span><span class="n">x</span>: <span class="kp">&amp;</span><span class="o">'</span><span class="na">a</span> <span class="kt">str</span><span class="p">,</span><span class="w"> </span><span class="n">y</span>: <span class="kp">&amp;</span><span class="o">'</span><span class="na">a</span> <span class="kt">str</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="o">'</span><span class="na">a</span> <span class="kt">str</span> <span class="p">{</span><span class="w"> </span><span class="s">"Hello"</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="266621246"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266621246" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266621246">(Jan 02 2022 at 16:20)</a>:</h4>
<p>Here, the return <em>value</em> is "Hello", which has a lifetime of <code>'static</code></p>



<a name="266621270"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266621270" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266621270">(Jan 02 2022 at 16:22)</a>:</h4>
<p>I could have called this function with references to local variables</p>



<a name="266621313"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/New%20rustacean%20confused%20about%20lifetimes/near/266621313" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/New.20rustacean.20confused.20about.20lifetimes.html#266621313">(Jan 02 2022 at 16:22)</a>:</h4>
<p>in which case the arguments will <em>not</em> live forever, but the return <em>value</em> will</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>