<html>
<head><meta charset="utf-8"><title>cargo install miri · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/cargo.20install.20miri.html">cargo install miri</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://rust-lang.github.io/zulip_archive/style.css" rel="stylesheet"></head>

<a name="147546988"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20install%20miri/near/147546988" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/cargo.20install.20miri.html#147546988">(Nov 12 2018 at 19:42)</a>:</h4>
<p>@Oli What do you think, can we make it so that <code>cargo install miri</code> will get people to run miri? I assume we'd have to (a) enable the cargo-miri feature per default, and (b) upload miri to <a href="http://creates.io" target="_blank" title="http://creates.io">creates.io</a>, and (c) re-upload it every other day to fix things for latest nightly. I have no idea how much effort the last two parts are, in particular considering that we'd likely have to re-publish fairly frequently. Can several people have publishing rights for the same crate? Do you even think we should do this?</p>



<a name="147548327"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20install%20miri/near/147548327" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/cargo.20install.20miri.html#147548327">(Nov 12 2018 at 20:08)</a>:</h4>
<blockquote>
<p>to <a href="http://creates.io" target="_blank" title="http://creates.io">creates.io</a></p>
</blockquote>
<p>probably not the best place :-)</p>
<blockquote>
<p>Can several people have publishing rights for the same crate</p>
</blockquote>
<p>yes</p>



<a name="147575146"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20install%20miri/near/147575146" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/cargo.20install.20miri.html#147575146">(Nov 13 2018 at 07:29)</a>:</h4>
<p>lol, yes, crates.io.^^ <span class="user-mention" data-user-id="124288">@Oli</span> what do you think?</p>



<a name="147576754"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20install%20miri/near/147576754" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/cargo.20install.20miri.html#147576754">(Nov 13 2018 at 08:15)</a>:</h4>
<p>I think that we've had a lot of pain with this in clippy</p>



<a name="147576815"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20install%20miri/near/147576815" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/cargo.20install.20miri.html#147576815">(Nov 13 2018 at 08:16)</a>:</h4>
<p>but I see no way around it other than adding a miri rustup component</p>



<a name="147577095"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20install%20miri/near/147577095" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/cargo.20install.20miri.html#147577095">(Nov 13 2018 at 08:24)</a>:</h4>
<p>pain of which kind?</p>



<a name="147577446"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20install%20miri/near/147577446" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/cargo.20install.20miri.html#147577446">(Nov 13 2018 at 08:34)</a>:</h4>
<p>keeping the <a href="http://crates.io" target="_blank" title="http://crates.io">crates.io</a> crate up to date takes a lot of effort. People have trouble figuring out which nightly needs which miri version</p>



<a name="147578910"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20install%20miri/near/147578910" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/cargo.20install.20miri.html#147578910">(Nov 13 2018 at 09:12)</a>:</h4>
<p>What is that effort? Can we not have a <code>./publish-new-version</code> script?</p>



<a name="147579163"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20install%20miri/near/147579163" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/cargo.20install.20miri.html#147579163">(Nov 13 2018 at 09:17)</a>:</h4>
<p>the effort on our end is mostly issues being opened about miri not working because of too new or too old nightlies and some nightlies having no valid miri version</p>



<a name="147579224"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20install%20miri/near/147579224" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/cargo.20install.20miri.html#147579224">(Nov 13 2018 at 09:18)</a>:</h4>
<p>I can only speak from the clippy experience. Everything became much more chill once we were going the rustup path</p>



<a name="147579528"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20install%20miri/near/147579528" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/cargo.20install.20miri.html#147579528">(Nov 13 2018 at 09:26)</a>:</h4>
<p>Sure, but that's not currently realistic for miri I think.</p>



<a name="147579532"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20install%20miri/near/147579532" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/cargo.20install.20miri.html#147579532">(Nov 13 2018 at 09:26)</a>:</h4>
<p>The two alternatives are to keep doing what we do now, or to try using <a href="http://crates.io" target="_blank" title="http://crates.io">crates.io</a>.</p>



<a name="147586204"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20install%20miri/near/147586204" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/cargo.20install.20miri.html#147586204">(Nov 13 2018 at 11:55)</a>:</h4>
<p>well, it might be less painful to have miri as a rustup component right now, since we don't block nightlies on missing components</p>



<a name="147586378"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20install%20miri/near/147586378" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/cargo.20install.20miri.html#147586378">(Nov 13 2018 at 11:59)</a>:</h4>
<p>if the team (whichever team is relevant here^^) would be up for that, I'd be delighted. miri is still rather experimental and far from being remotely as polished as e.g. clippy, not sure if that factors into the equation.</p>



<a name="147586382"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20install%20miri/near/147586382" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/cargo.20install.20miri.html#147586382">(Nov 13 2018 at 11:59)</a>:</h4>
<p><span class="user-mention" data-user-id="120791">@RalfJ</span> you might want to look into shipping <code>miri</code> as a <code>component</code>, e.g. <code>rustup component add miri-preview</code></p>



<a name="147586489"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20install%20miri/near/147586489" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/cargo.20install.20miri.html#147586489">(Nov 13 2018 at 12:00)</a>:</h4>
<p>a <code>component</code> is also what clippy etc are, right?</p>



<a name="147586501"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20install%20miri/near/147586501" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/cargo.20install.20miri.html#147586501">(Nov 13 2018 at 12:01)</a>:</h4>
<p>Who makes decisions about adding components?</p>



<a name="147586991"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20install%20miri/near/147586991" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/cargo.20install.20miri.html#147586991">(Nov 13 2018 at 12:12)</a>:</h4>
<p>clippy-preview and llvm-tools-preview were approved by the dev tools team, IIRC</p>



<a name="148637845"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20install%20miri/near/148637845" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/cargo.20install.20miri.html#148637845">(Nov 27 2018 at 13:33)</a>:</h4>
<p><span class="user-mention" data-user-id="124288">@Oli</span> is there a good place I can go to read about (i.e. learn more) the pain clippy had when it was on <code>crates.io</code> instead of being a <code>rustup</code> component?</p>



<a name="148637915"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20install%20miri/near/148637915" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/cargo.20install.20miri.html#148637915">(Nov 27 2018 at 13:34)</a>:</h4>
<p>I ask because I've been privately musing about trying to refactor <code>compiletest</code> so that some/all of it is hosted on <code>crates.io</code> or something like that, or at least is in a separate repo from <code>rust-lang/rust</code> where we can do independent development.</p>



<a name="148637939"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20install%20miri/near/148637939" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/cargo.20install.20miri.html#148637939">(Nov 27 2018 at 13:35)</a>:</h4>
<p>not really, all we have is the big list of issues people were opening when things didn't work because you needed to match nightly versions</p>



<a name="148637965"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20install%20miri/near/148637965" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> centril <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/cargo.20install.20miri.html#148637965">(Nov 27 2018 at 13:35)</a>:</h4>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span>  there's a version of compiletest on <a href="http://crates.io" target="_blank" title="http://crates.io">crates.io</a> that folks use to test proc macros macros and such</p>



<a name="148637966"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20install%20miri/near/148637966" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/cargo.20install.20miri.html#148637966">(Nov 27 2018 at 13:35)</a>:</h4>
<p>some things have improved since then</p>



<a name="148638021"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20install%20miri/near/148638021" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/cargo.20install.20miri.html#148638021">(Nov 27 2018 at 13:36)</a>:</h4>
<p>like clippy's CI using PR rustc instead of nightly rustc</p>



<a name="148638149"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20install%20miri/near/148638149" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/cargo.20install.20miri.html#148638149">(Nov 27 2018 at 13:38)</a>:</h4>
<p>I wish we could have stable <code>compiletest</code>, but all my attempts have ended in chaos so far</p>



<a name="148638164"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20install%20miri/near/148638164" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/cargo.20install.20miri.html#148638164">(Nov 27 2018 at 13:39)</a>:</h4>
<p>I basically decided to give up until custom test frameworks</p>



<a name="148638247"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20install%20miri/near/148638247" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/cargo.20install.20miri.html#148638247">(Nov 27 2018 at 13:40)</a>:</h4>
<blockquote>
<p>I wish we could have stable <code>compiletest</code>, but all my attempts have ended in chaos so far</p>
</blockquote>
<p>sorry, what were your previous attempts? Could you add more detail here, so that I don't go down similar paths in quiet isolation?</p>



<a name="148639030"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20install%20miri/near/148639030" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/cargo.20install.20miri.html#148639030">(Nov 27 2018 at 13:56)</a>:</h4>
<p>My initial naive approach was to rip out whatever <code>libtest</code> and <code>compiletest</code> both need into a stable crate and then get rid of the <code>libtest</code> dependency of <code>compiletest</code>. That doesn't really work, because then you end up with allmost all of <code>libtest</code> in the "stable" crate, which in itself isn't possible because of all the feature gates.</p>



<a name="148639043"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20install%20miri/near/148639043" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/cargo.20install.20miri.html#148639043">(Nov 27 2018 at 13:57)</a>:</h4>
<p>I managed to get a few commits into <code>compiletest</code> that removed a bunch of unnecessary feature gates, but it still shares a large core with <code>libtest</code></p>



<a name="148639132"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20install%20miri/near/148639132" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://rust-lang.github.io/zulip_archive/stream/122651-general/topic/cargo.20install.20miri.html#148639132">(Nov 27 2018 at 13:58)</a>:</h4>
<p>I have never been able to figure out why we need all that, so my next idea was to start removing features from <code>compiletest</code> that depended on <code>libtest</code>. I don't think I ever managed to get something worthwile done that didn't end up affecting all of <code>compiletest</code> and consequently breaking it</p>



<hr><p>Last updated: Aug 07 2021 at 22:04 UTC</p>
</html>