<html>
<head><meta charset="utf-8"><title>help with mutating vector elements · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/help.20with.20mutating.20vector.20elements.html">help with mutating vector elements</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="270181683"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/help%20with%20mutating%20vector%20elements/near/270181683" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Uniconductive <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/help.20with.20mutating.20vector.20elements.html#270181683">(Feb 01 2022 at 10:09)</a>:</h4>
<div class="codehilite"><pre><span></span><code>struct Foo(i32);

impl Foo {
    fn action(mut self) {
        self.0 += 1;
    }
}

fn main() {
    let mut list: Vec&lt;Foo&gt; = vec![Foo(1), Foo(2), Foo(3)];
    list.iter_mut().for_each(|item| {
        item.action();
        println!(&quot;{}&quot;, item.0);
    });
}
</code></pre></div>
<p>Error: <br>
 Compiling playground v0.0.1 (/playground)<br>
error[E0507]: cannot move out of <code>*item</code> which is behind a mutable reference<br>
  --&gt; src/main.rs:13:9<br>
   |<br>
13 |         item.action();<br>
   |         ^^^^^^^^^^^^^ move occurs because <code>*item</code> has type <code>Foo</code>, which does not implement the <code>Copy</code> trait</p>
<p>For more information about this error, try <code>rustc --explain E0507</code>.<br>
error: could not compile <code>playground</code> due to previous error</p>



<a name="270182321"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/help%20with%20mutating%20vector%20elements/near/270182321" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/help.20with.20mutating.20vector.20elements.html#270182321">(Feb 01 2022 at 10:14)</a>:</h4>
<p>You are missing an <code>&amp;</code> in your function signature <code>fn action(mut self)</code> -&gt; <code>fn action(&amp;mut self)</code></p>



<a name="270182336"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/help%20with%20mutating%20vector%20elements/near/270182336" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Xavier Denis <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/help.20with.20mutating.20vector.20elements.html#270182336">(Feb 01 2022 at 10:14)</a>:</h4>
<p>Your <code>action</code> method takes ownership of the <code>Foo</code></p>



<a name="270182349"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/help%20with%20mutating%20vector%20elements/near/270182349" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Xavier Denis <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/help.20with.20mutating.20vector.20elements.html#270182349">(Feb 01 2022 at 10:14)</a>:</h4>
<p>The fix is what <span class="user-mention" data-user-id="300586">@Lukas Wirth</span>  said</p>



<a name="270182687"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/help%20with%20mutating%20vector%20elements/near/270182687" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Uniconductive <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/help.20with.20mutating.20vector.20elements.html#270182687">(Feb 01 2022 at 10:17)</a>:</h4>
<p>Ok, but what to do in this case?</p>
<div class="codehilite"><pre><span></span><code>    let mut list: Vec&lt;tokio::sync::oneshot::Sender&lt;()&gt;&gt;;
    list.iter_mut().for_each(|item| {
        list.send(());
    });
</code></pre></div>



<a name="270182814"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/help%20with%20mutating%20vector%20elements/near/270182814" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Xavier Denis <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/help.20with.20mutating.20vector.20elements.html#270182814">(Feb 01 2022 at 10:18)</a>:</h4>
<p>The iterator <code>iter_mut</code> produces an iterator of mutable references</p>



<a name="270182834"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/help%20with%20mutating%20vector%20elements/near/270182834" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Xavier Denis <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/help.20with.20mutating.20vector.20elements.html#270182834">(Feb 01 2022 at 10:18)</a>:</h4>
<p>which is why you can't call <code>send</code> which consumes your <code>Sender</code></p>



<a name="270182884"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/help%20with%20mutating%20vector%20elements/near/270182884" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Xavier Denis <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/help.20with.20mutating.20vector.20elements.html#270182884">(Feb 01 2022 at 10:19)</a>:</h4>
<p>(which makes sense since <em>after</em> the iterator you recover your <code>list</code> and could do the whole thing again, defeating the one-shotness of <code>Sender</code></p>



<a name="270182896"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/help%20with%20mutating%20vector%20elements/near/270182896" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Xavier Denis <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/help.20with.20mutating.20vector.20elements.html#270182896">(Feb 01 2022 at 10:19)</a>:</h4>
<p>the solution is to use a consuming iterator</p>



<a name="270182919"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/help%20with%20mutating%20vector%20elements/near/270182919" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Xavier Denis <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/help.20with.20mutating.20vector.20elements.html#270182919">(Feb 01 2022 at 10:19)</a>:</h4>
<p>you can do this using <code>list.into_iter()</code> which produces an iterator which consumes the vector</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>