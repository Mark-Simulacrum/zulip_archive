<html>
<head><meta charset="utf-8"><title>Type considered dead code but must be kept alive · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Type.20considered.20dead.20code.20but.20must.20be.20kept.20alive.html">Type considered dead code but must be kept alive</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="258595057"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Type%20considered%20dead%20code%20but%20must%20be%20kept%20alive/near/258595057" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Type.20considered.20dead.20code.20but.20must.20be.20kept.20alive.html#258595057">(Oct 21 2021 at 18:29)</a>:</h4>
<p>Hello! i wanted to ask about an API design decision.</p>
<p>I wrote a safe wrapper for the CUDA Driver API as part of a larger project, but i am running into this mild annoyance. CUDA has the concept of contexts, contexts are basically CPU processes. You must make a new context before you can do anything using cuda. However, the contexts are implicitly bound to an OS thread, and you can make multiple contexts and bind each one to a thread, allowing you to write multi-gpu code fairly easily. </p>
<p>This is great, but it means contexts dont really have many useful methods, so they often go "unused". But in reality, they are not unused, they must be held for the duration of the use of CUDA, otherwise cuda yields an error. But rustc complains if you hold this context in a struct, such as </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">struct</span> <span class="nc">CudaRenderer</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">stream</span>: <span class="nc">Stream</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">context</span>: <span class="nc">Context</span><span class="p">,</span><span class="w"> </span><span class="c1">// unused field</span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>So should i just accept that users will need to suppress the lint? Is there some way of telling rustc that this struct is fine going unused because its basically a "keep alive" flag?</p>



<a name="258595659"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Type%20considered%20dead%20code%20but%20must%20be%20kept%20alive/near/258595659" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Type.20considered.20dead.20code.20but.20must.20be.20kept.20alive.html#258595659">(Oct 21 2021 at 18:33)</a>:</h4>
<p>I can't implicitly keep it alive because i would like to allow users to retain the control since it is important in "serious" applications</p>



<a name="258595814"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Type%20considered%20dead%20code%20but%20must%20be%20kept%20alive/near/258595814" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Type.20considered.20dead.20code.20but.20must.20be.20kept.20alive.html#258595814">(Oct 21 2021 at 18:34)</a>:</h4>
<p>because its sometimes useful to drop cuda structs if you are done using it to save cpu/gpu memory</p>



<a name="258602305"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Type%20considered%20dead%20code%20but%20must%20be%20kept%20alive/near/258602305" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Type.20considered.20dead.20code.20but.20must.20be.20kept.20alive.html#258602305">(Oct 21 2021 at 19:21)</a>:</h4>
<p>You can use <code>_context</code> instead of <code>context</code> as name.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>