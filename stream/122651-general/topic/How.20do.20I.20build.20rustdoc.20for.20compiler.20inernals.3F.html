<html>
<head><meta charset="utf-8"><title>How do I build rustdoc for compiler inernals? · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/How.20do.20I.20build.20rustdoc.20for.20compiler.20inernals.3F.html">How do I build rustdoc for compiler inernals?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="252041689"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/How%20do%20I%20build%20rustdoc%20for%20compiler%20inernals%3F/near/252041689" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gus Wynn <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/How.20do.20I.20build.20rustdoc.20for.20compiler.20inernals.3F.html#252041689">(Sep 05 2021 at 02:05)</a>:</h4>
<p><code>./x.py doc compiler/rustc_middle --open</code> doesn't open anything?</p>



<a name="252045362"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/How%20do%20I%20build%20rustdoc%20for%20compiler%20inernals%3F/near/252045362" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/How.20do.20I.20build.20rustdoc.20for.20compiler.20inernals.3F.html#252045362">(Sep 05 2021 at 03:17)</a>:</h4>
<p>Do you have <code>compiler-docs</code> enabled in config.toml?</p>



<a name="252072239"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/How%20do%20I%20build%20rustdoc%20for%20compiler%20inernals%3F/near/252072239" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/How.20do.20I.20build.20rustdoc.20for.20compiler.20inernals.3F.html#252072239">(Sep 05 2021 at 12:08)</a>:</h4>
<p>Actually, that would be very convenient to have a command to do so, like <code>x.py doc compiler</code>. I'll open a PR to add it because I need it quite often.</p>



<a name="252083262"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/How%20do%20I%20build%20rustdoc%20for%20compiler%20inernals%3F/near/252083262" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/How.20do.20I.20build.20rustdoc.20for.20compiler.20inernals.3F.html#252083262">(Sep 05 2021 at 15:26)</a>:</h4>
<p><span class="user-mention" data-user-id="257428">@Gus Wynn</span> Here you go: <a href="https://github.com/rust-lang/rust/pull/88666">https://github.com/rust-lang/rust/pull/88666</a></p>



<a name="252083521"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/How%20do%20I%20build%20rustdoc%20for%20compiler%20inernals%3F/near/252083521" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gus Wynn <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/How.20do.20I.20build.20rustdoc.20for.20compiler.20inernals.3F.html#252083521">(Sep 05 2021 at 15:31)</a>:</h4>
<p><span class="user-mention" data-user-id="210316">@GuillaumeGomez</span>  this is awesome! Does this not require that <code>compiler-docs</code> be on in config.toml?</p>



<a name="252084126"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/How%20do%20I%20build%20rustdoc%20for%20compiler%20inernals%3F/near/252084126" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gus Wynn <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/How.20do.20I.20build.20rustdoc.20for.20compiler.20inernals.3F.html#252084126">(Sep 05 2021 at 15:43)</a>:</h4>
<p>I got this panic thread 'rustc' panicked at 'no entry found for key', compiler/rustc_query_impl/src/on_disk_cache.rs:175:20 when compiling rustc_serialize when using <code>compiler-docs = true</code> as <span class="user-mention" data-user-id="120518">@Eric Huss</span> suggested, is it worth it to open an issue for this? or because I have local changes, i should just move on?</p>
<p>query stack:</p>
<div class="codehilite"><pre><span></span><code>query stack during panic:
#0 [predicates_of] computing predicates of `json::FormatShim`
#1 [param_env] computing normalized predicates of `json::FormatShim`
#2 [check_item_well_formed] checking that `json::FormatShim` is well-formed
#3 [analysis] running analysis passes on this crate
end of query stack
error: could not compile `rustc_serialize`
warning: build failed, waiting for other jobs to finish...
error: build failed
</code></pre></div>



<a name="252084424"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/How%20do%20I%20build%20rustdoc%20for%20compiler%20inernals%3F/near/252084424" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/How.20do.20I.20build.20rustdoc.20for.20compiler.20inernals.3F.html#252084424">(Sep 05 2021 at 15:48)</a>:</h4>
<p><span class="user-mention" data-user-id="257428">@Gus Wynn</span> there should be more to that message - can you paste the whole thing?</p>



<a name="252084450"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/How%20do%20I%20build%20rustdoc%20for%20compiler%20inernals%3F/near/252084450" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gus Wynn <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/How.20do.20I.20build.20rustdoc.20for.20compiler.20inernals.3F.html#252084450">(Sep 05 2021 at 15:49)</a>:</h4>
<div class="codehilite"><pre><span></span><code>    Checking object v0.26.2
 Documenting rustc_serialize v0.0.0 (/Users/azw/repos/rust/compiler/rustc_serialize)
thread &#39;rustc&#39; panicked at &#39;no entry found for key&#39;, compiler/rustc_query_impl/src/on_disk_cache.rs:175:20
stack backtrace:
   0: _rust_begin_unwind
   1: core::panicking::panic_fmt
   2: core::option::expect_failed
   3: rustc_query_impl::on_disk_cache::CacheDecoder::file_index_to_file
   4: rustc_query_impl::on_disk_cache::&lt;impl rustc_serialize::serialize::Decodable&lt;rustc_query_impl::on_disk_cache::CacheDecoder&gt; for rustc_span::span_encoding::Span&gt;::decode
   5: &lt;core::iter::adapters::map::Map&lt;I,F&gt; as core::iter::traits::iterator::Iterator&gt;::try_fold
   6: &lt;alloc::vec::Vec&lt;T&gt; as alloc::vec::spec_from_iter::SpecFromIter&lt;T,I&gt;&gt;::from_iter
   7: &lt;[(rustc_middle::ty::Predicate,rustc_span::span_encoding::Span)] as rustc_middle::ty::codec::RefDecodable&lt;D&gt;&gt;::decode
   8: rustc_query_impl::on_disk_cache::OnDiskCache::try_load_query_result
   9: rustc_query_impl::plumbing::&lt;impl rustc_query_system::query::config::QueryDescription&lt;rustc_query_impl::plumbing::QueryCtxt&gt; for rustc_query_impl::queries::predicates_of&gt;::try_load_from_disk
  10: rustc_query_system::query::plumbing::load_from_disk_and_cache_in_memory
  11: rustc_data_structures::stack::ensure_sufficient_stack
  12: rustc_query_system::query::plumbing::get_query_impl
  13: &lt;rustc_query_impl::Queries as rustc_middle::ty::query::QueryEngine&gt;::predicates_of
  14: rustc_ty_utils::ty::param_env
  15: rustc_query_system::dep_graph::graph::DepGraph&lt;K&gt;::with_task_impl
  16: rustc_data_structures::stack::ensure_sufficient_stack
  17: rustc_query_system::query::plumbing::force_query_with_job
  18: rustc_query_system::query::plumbing::get_query_impl
  19: &lt;rustc_query_impl::Queries as rustc_middle::ty::query::QueryEngine&gt;::param_env
  20: rustc_typeck::check::wfcheck::for_id
  21: rustc_typeck::check::wfcheck::check_item_well_formed
  22: rustc_query_system::dep_graph::graph::DepGraph&lt;K&gt;::with_task_impl
  23: rustc_data_structures::stack::ensure_sufficient_stack
  24: rustc_query_system::query::plumbing::force_query_with_job
  25: rustc_query_system::query::plumbing::get_query_impl
  26: &lt;rustc_query_impl::Queries as rustc_middle::ty::query::QueryEngine&gt;::check_item_well_formed
  27: &lt;rustc_typeck::check::wfcheck::CheckTypeWellFormedVisitor as rustc_hir::intravisit::Visitor&gt;::visit_item
  28: rustc_data_structures::sync::par_for_each_in
  29: rustc_hir::hir::Crate::par_visit_all_item_likes
  30: rustc_session::session::Session::track_errors
  31: rustc_typeck::check_crate
  32: rustc_interface::passes::analysis
  33: rustc_query_system::dep_graph::graph::DepGraph&lt;K&gt;::with_task_impl
  34: rustc_data_structures::stack::ensure_sufficient_stack
  35: rustc_query_system::query::plumbing::force_query_with_job
  36: rustc_query_system::query::plumbing::get_query_impl
  37: &lt;rustc_query_impl::Queries as rustc_middle::ty::query::QueryEngine&gt;::analysis
  38: rustc_interface::queries::&lt;impl rustc_interface::interface::Compiler&gt;::enter
  39: rustc_span::with_source_map
  40: rustc_interface::interface::create_compiler_and_run
  41: scoped_tls::ScopedKey&lt;T&gt;::set
note: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.

error: internal compiler error: unexpected panic

note: the compiler unexpectedly panicked. this is a bug.

note: we would appreciate a bug report: https://github.com/rust-lang/rust/issues/new?labels=C-bug%2C+I-ICE%2C+T-compiler&amp;template=ice.md
note: rustc 1.55.0-beta.1 (739f8f0a8 2021-07-28) running on x86_64-apple-darwin

note: compiler flags: -Z macro-backtrace -Z osx-rpath-install-name -Z tls-model=initial-exec -Z unstable-options -Z binary-dep-depinfo -Z force-unstable-if-unmarked -C opt-level=3 -C embed-bitcode=no -C debuginfo=0 -C incremental -C link-args=-Wl,-rpath,@loader_path/../lib -C split-debuginfo=unpacked -C prefer-dynamic -C llvm-args=-import-instr-limit=10 --crate-type lib

note: some of the compiler flags provided by cargo are hidden

query stack during panic:
#0 [predicates_of] computing predicates of `json::FormatShim`
#1 [param_env] computing normalized predicates of `json::FormatShim`
#2 [check_item_well_formed] checking that `json::FormatShim` is well-formed
#3 [analysis] running analysis passes on this crate
end of query stack
error: could not compile `rustc_serialize`
warning: build failed, waiting for other jobs to finish...
error: build failed


command did not execute successfully: &quot;/Users/azw/repos/rust/build/x86_64-apple-darwin/stage0/bin/cargo&quot; &quot;doc&quot; &quot;--target&quot; &quot;x86_64-apple-darwin&quot; &quot;-Zbinary-dep-depinfo&quot; &quot;-j&quot; &quot;8&quot; &quot;--release&quot; &quot;--features&quot; &quot; llvm&quot; &quot;--manifest-path&quot; &quot;/Users/azw/repos/rust/compiler/rustc/Cargo.toml&quot; &quot;-Zskip-rustdoc-fingerprint&quot; &quot;--no-deps&quot; &quot;-p&quot; &quot;rustc_codegen_llvm&quot; &quot;-p&quot; &quot;rustc_attr&quot; &quot;-p&quot; &quot;rustc_query_system&quot; &quot;-p&quot; &quot;rustc_ast_pretty&quot;&quot;-p&quot; &quot;rustc_driver&quot; &quot;-p&quot; &quot;rustc_plugin_impl&quot; &quot;-p&quot; &quot;rustc_symbol_mangling&quot; &quot;-p&quot; &quot;rustc_mir&quot; &quot;-p&quot; &quot;rustc_save_analysis&quot; &quot;-p&quot; &quot;rustc_interface&quot; &quot;-p&quot; &quot;rustc_parse&quot; &quot;-p&quot; &quot;rustc_data_structures&quot; &quot;-p&quot; &quot;rustc_session&quot; &quot;-p&quot; &quot;rustc_mir_build&quot; &quot;-p&quot; &quot;rustc_incremental&quot;
expected success, got: exit status: 101
</code></pre></div>



<a name="252084538"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/How%20do%20I%20build%20rustdoc%20for%20compiler%20inernals%3F/near/252084538" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gus Wynn <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/How.20do.20I.20build.20rustdoc.20for.20compiler.20inernals.3F.html#252084538">(Sep 05 2021 at 15:50)</a>:</h4>
<p>even after x.py clean it happened but with </p>
<div class="codehilite"><pre><span></span><code>error[E0460]: found possibly newer version of crate `std` which `synstructure` depends on
 --&gt; compiler/rustc_macros/src/lib.rs:5:5
  |
5 | use synstructure::decl_derive;
  |     ^^^^^^^^^^^^
  |
  = note: perhaps that crate needs to be recompiled?
  = note: the following crate versions were found:
          crate `std`: /Users/azw/repos/rust/build/x86_64-apple-darwin/stage0-sysroot/lib/rustlib/x86_64-apple-darwin/lib/libstd-060cee09e2e82134.rlib
          crate `std`: /Users/azw/repos/rust/build/x86_64-apple-darwin/stage0-sysroot/lib/rustlib/x86_64-apple-darwin/lib/libstd-060cee09e2e82134.dylib
          crate `synstructure`: /Users/azw/repos/rust/build/x86_64-apple-darwin/stage0-rustc/release/deps/libsynstructure-2b52aba3557a132b.rmeta

error: build failed


command did not execute successfully: &quot;/Users/azw/repos/rust/build/x86_64-apple-darwin/stage0/bin/cargo&quot; &quot;doc&quot; &quot;--target&quot; &quot;x86_64-apple-darwin&quot; &quot;-Zbinary-dep-depinfo&quot; &quot;-j&quot; &quot;8&quot; &quot;--release&quot; &quot;--features&quot; &quot; llvm&quot; &quot;--manifest-path&quot; &quot;/Users/azw/repos/rust/compiler/rustc/Cargo.toml&quot; &quot;-Zskip-rustdoc-fingerprint&quot; &quot;--no-deps&quot; &quot;-p&quot; &quot;rustc_fs_util&quot; &quot;-p&quot; &quot;rustc_session&quot; &quot;-p&quot; &quot;rustc_resolve&quot; &quot;-p&quot; &quot;rustc_codegen_llvm&quot; &quot;-p&quot; &quot;rustc_feature&quot; &quot;-p&quot; &quot;rustc_parse_format&quot; &quot;-p&quot; &quot;rustc_privacy&quot; &quot;-p&quot; &quot;rustc_hir_pretty&quot; &quot;-p&quot; &quot;rustc_lint_defs&quot; &quot;-p&quot; &quot;rustc_codegen_ssa&quot; &quot;-p&quot; &quot;coverage_test_macros&quot; &quot;-p&quot; &quot;rustc_llvm&quot; &quot;-p&quot; &quot;rustc_driver&quot; &quot;-p&quot; &quot;rustc_ast&quot; &quot;-p&quot; &quot;rustc_apfloat&quot; &quot;-p&quot; &quot;rustc_macros&quot; &quot;-p&quot; &quot;rustc_ast_pretty&quot; &quot;-p&quot; &quot;rustc_symbol_mangling&quot; &quot;-p&quot; &quot;rustc_infer&quot; &quot;-p&quot; &quot;rustc_lint&quot; &quot;-p&quot; &quot;rustc_lexer&quot; &quot;-p&quot; &quot;rustc_ty_utils&quot; &quot;-p&quot; &quot;rustc_builtin_macros&quot; &quot;-p&quot; &quot;rustc_hir&quot; &quot;-p&quot; &quot;rustc_query_impl&quot; &quot;-p&quot; &quot;rustc_query_system&quot; &quot;-p&quot; &quot;rustc_errors&quot; &quot;-p&quot; &quot;rustc_serialize&quot; &quot;-p&quot; &quot;rustc_data_structures&quot; &quot;-p&quot; &quot;rustc_parse&quot; &quot;-p&quot; &quot;rustc_error_codes&quot; &quot;-p&quot; &quot;rustc_graphviz&quot; &quot;-p&quot; &quot;rustc_expand&quot; &quot;-p&quot; &quot;rustc_span&quot; &quot;-p&quot; &quot;rustc_target&quot; &quot;-p&quot; &quot;rustc_typeck&quot; &quot;-p&quot; &quot;rustc_metadata&quot; &quot;-p&quot; &quot;rustc_mir_build&quot; &quot;-p&quot; &quot;rustc_type_ir&quot; &quot;-p&quot; &quot;rustc_middle&quot; &quot;-p&quot; &quot;rustc_trait_selection&quot; &quot;-p&quot;
&quot;rustc_attr&quot; &quot;-p&quot; &quot;rustc_ast_passes&quot; &quot;-p&quot; &quot;rustc_ast_lowering&quot; &quot;-p&quot; &quot;rustc_mir&quot; &quot;-p&quot; &quot;rustc_save_analysis&quot; &quot;-p&quot; &quot;rustc_plugin_impl&quot; &quot;-p&quot; &quot;rustc_incremental&quot; &quot;-p&quot; &quot;rustc_passes&quot; &quot;-p&quot; &quot;rustc_arena&quot; &quot;-p&quot; &quot;rustc_interface&quot; &quot;-p&quot; &quot;rustc_index&quot; &quot;-p&quot; &quot;rustc_traits&quot;
expected success, got: exit status: 101
</code></pre></div>
<p>in addition</p>
<p>but i guess ./x.py clean doesnt clean the build/cache/ dir?</p>



<a name="252085332"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/How%20do%20I%20build%20rustdoc%20for%20compiler%20inernals%3F/near/252085332" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gus Wynn <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/How.20do.20I.20build.20rustdoc.20for.20compiler.20inernals.3F.html#252085332">(Sep 05 2021 at 16:04)</a>:</h4>
<p>clean --all seemed to work</p>



<a name="252085868"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/How%20do%20I%20build%20rustdoc%20for%20compiler%20inernals%3F/near/252085868" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gus Wynn <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/How.20do.20I.20build.20rustdoc.20for.20compiler.20inernals.3F.html#252085868">(Sep 05 2021 at 16:14)</a>:</h4>
<p><span class="user-mention silent" data-user-id="257428">Gus Wynn</span> <a href="#narrow/stream/122651-general/topic/How.20do.20I.20build.20rustdoc.20for.20compiler.20inernals.3F/near/252084538">said</a>:</p>
<blockquote>
<p>even after x.py clean it happened but with </p>
<div class="codehilite"><pre><span></span><code>error[E0460]: found possibly newer version of crate `std` which `synstructure` depends on
 --&gt; compiler/rustc_macros/src/lib.rs:5:5
  |
5 | use synstructure::decl_derive;
  |     ^^^^^^^^^^^^
  |
  = note: perhaps that crate needs to be recompiled?
  = note: the following crate versions were found:
          crate `std`: /Users/azw/repos/rust/build/x86_64-apple-darwin/stage0-sysroot/lib/rustlib/x86_64-apple-darwin/lib/libstd-060cee09e2e82134.rlib
          crate `std`: /Users/azw/repos/rust/build/x86_64-apple-darwin/stage0-sysroot/lib/rustlib/x86_64-apple-darwin/lib/libstd-060cee09e2e82134.dylib
          crate `synstructure`: /Users/azw/repos/rust/build/x86_64-apple-darwin/stage0-rustc/release/deps/libsynstructure-2b52aba3557a132b.rmeta

error: build failed


command did not execute successfully: &quot;/Users/azw/repos/rust/build/x86_64-apple-darwin/stage0/bin/cargo&quot; &quot;doc&quot; &quot;--target&quot; &quot;x86_64-apple-darwin&quot; &quot;-Zbinary-dep-depinfo&quot; &quot;-j&quot; &quot;8&quot; &quot;--release&quot; &quot;--features&quot; &quot; llvm&quot; &quot;--manifest-path&quot; &quot;/Users/azw/repos/rust/compiler/rustc/Cargo.toml&quot; &quot;-Zskip-rustdoc-fingerprint&quot; &quot;--no-deps&quot; &quot;-p&quot; &quot;rustc_fs_util&quot; &quot;-p&quot; &quot;rustc_session&quot; &quot;-p&quot; &quot;rustc_resolve&quot; &quot;-p&quot; &quot;rustc_codegen_llvm&quot; &quot;-p&quot; &quot;rustc_feature&quot; &quot;-p&quot; &quot;rustc_parse_format&quot; &quot;-p&quot; &quot;rustc_privacy&quot; &quot;-p&quot; &quot;rustc_hir_pretty&quot; &quot;-p&quot; &quot;rustc_lint_defs&quot; &quot;-p&quot; &quot;rustc_codegen_ssa&quot; &quot;-p&quot; &quot;coverage_test_macros&quot; &quot;-p&quot; &quot;rustc_llvm&quot; &quot;-p&quot; &quot;rustc_driver&quot; &quot;-p&quot; &quot;rustc_ast&quot; &quot;-p&quot; &quot;rustc_apfloat&quot; &quot;-p&quot; &quot;rustc_macros&quot; &quot;-p&quot; &quot;rustc_ast_pretty&quot; &quot;-p&quot; &quot;rustc_symbol_mangling&quot; &quot;-p&quot; &quot;rustc_infer&quot; &quot;-p&quot; &quot;rustc_lint&quot; &quot;-p&quot; &quot;rustc_lexer&quot; &quot;-p&quot; &quot;rustc_ty_utils&quot; &quot;-p&quot; &quot;rustc_builtin_macros&quot; &quot;-p&quot; &quot;rustc_hir&quot; &quot;-p&quot; &quot;rustc_query_impl&quot; &quot;-p&quot; &quot;rustc_query_system&quot; &quot;-p&quot; &quot;rustc_errors&quot; &quot;-p&quot; &quot;rustc_serialize&quot; &quot;-p&quot; &quot;rustc_data_structures&quot; &quot;-p&quot; &quot;rustc_parse&quot; &quot;-p&quot; &quot;rustc_error_codes&quot; &quot;-p&quot; &quot;rustc_graphviz&quot; &quot;-p&quot; &quot;rustc_expand&quot; &quot;-p&quot; &quot;rustc_span&quot; &quot;-p&quot; &quot;rustc_target&quot; &quot;-p&quot; &quot;rustc_typeck&quot; &quot;-p&quot; &quot;rustc_metadata&quot; &quot;-p&quot; &quot;rustc_mir_build&quot; &quot;-p&quot; &quot;rustc_type_ir&quot; &quot;-p&quot; &quot;rustc_middle&quot; &quot;-p&quot; &quot;rustc_trait_selection&quot; &quot;-p&quot;
&quot;rustc_attr&quot; &quot;-p&quot; &quot;rustc_ast_passes&quot; &quot;-p&quot; &quot;rustc_ast_lowering&quot; &quot;-p&quot; &quot;rustc_mir&quot; &quot;-p&quot; &quot;rustc_save_analysis&quot; &quot;-p&quot; &quot;rustc_plugin_impl&quot; &quot;-p&quot; &quot;rustc_incremental&quot; &quot;-p&quot; &quot;rustc_passes&quot; &quot;-p&quot; &quot;rustc_arena&quot; &quot;-p&quot; &quot;rustc_interface&quot; &quot;-p&quot; &quot;rustc_index&quot; &quot;-p&quot; &quot;rustc_traits&quot;
expected success, got: exit status: 101
</code></pre></div>
<p>in addition</p>
<p>but i guess ./x.py clean doesnt clean the build/cache/ dir?</p>
</blockquote>
<p>weirdly, I keep getting this "found possibly newer version of crate <code>std</code>" error, which manifests with different deps, but it seems to be transient with <code>build</code> and consistent with <code>doc</code>?</p>



<a name="252086241"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/How%20do%20I%20build%20rustdoc%20for%20compiler%20inernals%3F/near/252086241" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gus Wynn <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/How.20do.20I.20build.20rustdoc.20for.20compiler.20inernals.3F.html#252086241">(Sep 05 2021 at 16:21)</a>:</h4>
<p>there are some other zulip streams with people reporting RA as causing it, and there is this: <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/Can't.20document.20compiler.20crate">https://rust-lang.zulipchat.com/#narrow/stream/182449-t-compiler.2Fhelp/topic/Can't.20document.20compiler.20crate</a> that is specifically about <code>doc</code>, seems like <code>--stage 1</code> works? looks like the original issue is unresolved tho</p>



<a name="252087520"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/How%20do%20I%20build%20rustdoc%20for%20compiler%20inernals%3F/near/252087520" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/How.20do.20I.20build.20rustdoc.20for.20compiler.20inernals.3F.html#252087520">(Sep 05 2021 at 16:44)</a>:</h4>
<p><span class="user-mention" data-user-id="257428">@Gus Wynn</span> this is probably <a href="https://github.com/rust-lang/rust/pull/88310">https://github.com/rust-lang/rust/pull/88310</a></p>



<a name="252091426"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/How%20do%20I%20build%20rustdoc%20for%20compiler%20inernals%3F/near/252091426" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GuillaumeGomez <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/How.20do.20I.20build.20rustdoc.20for.20compiler.20inernals.3F.html#252091426">(Sep 05 2021 at 17:56)</a>:</h4>
<p><span class="user-mention silent" data-user-id="257428">Gus Wynn</span> <a href="#narrow/stream/122651-general/topic/How.20do.20I.20build.20rustdoc.20for.20compiler.20inernals.3F/near/252083521">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="210316">GuillaumeGomez</span>  this is awesome! Does this not require that <code>compiler-docs</code> be on in config.toml?</p>
</blockquote>
<p>No, not with this option. However if you run more "global" commands, then it'll be skipped just like currently.</p>



<a name="252097256"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/How%20do%20I%20build%20rustdoc%20for%20compiler%20inernals%3F/near/252097256" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Frank Steffahn <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/How.20do.20I.20build.20rustdoc.20for.20compiler.20inernals.3F.html#252097256">(Sep 05 2021 at 19:41)</a>:</h4>
<p>Something that I feel is missing from <code>x.py doc</code> is skipping <em>building</em> the thing first that’s then going to be documented. If I do <code>x.py doc library/std</code>, it’s doing a full <code>Building stage0 std artifacts</code> before documenting <code>std</code>. Similarly, <code>x.py doc compiler/rustc --stage 1</code> or similar commands (e.g. <code>compiler/rustc_middle</code>) will (after building <code>stage1</code> compiler) do a full <code>Building stage1 compiler artifacts</code> before documenting them, in effect building the compiler <em>twice</em>, then documenting it (which takes a long time). I could understand that <code>stage1 std artifacts</code> might be necessary to be built for documenting <code>stage1</code> compiler artifacts, but compiling the whole <code>stage2</code> compile goes too far (i.e. shouldn’t be necessary; please correct me if I’m wrong) and is IMO something that should be fixed.</p>



<a name="252097763"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/How%20do%20I%20build%20rustdoc%20for%20compiler%20inernals%3F/near/252097763" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/How.20do.20I.20build.20rustdoc.20for.20compiler.20inernals.3F.html#252097763">(Sep 05 2021 at 19:50)</a>:</h4>
<p><span class="user-mention" data-user-id="280891">@Frank Steffahn</span> I think you're expecting --stage 0 to be the default for documenting the compiler (actually, I was under the impression it was). If you pass --stage 0 does it behave like you expect?</p>



<a name="252097796"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/How%20do%20I%20build%20rustdoc%20for%20compiler%20inernals%3F/near/252097796" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/How.20do.20I.20build.20rustdoc.20for.20compiler.20inernals.3F.html#252097796">(Sep 05 2021 at 19:51)</a>:</h4>
<p>x.py doc does need to <em>check</em> the artifacts, it needs metadata available. But it doesn't need a full build.</p>



<a name="252097922"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/How%20do%20I%20build%20rustdoc%20for%20compiler%20inernals%3F/near/252097922" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/How.20do.20I.20build.20rustdoc.20for.20compiler.20inernals.3F.html#252097922">(Sep 05 2021 at 19:53)</a>:</h4>
<p>for <code>doc</code>, --stage indicates the compiler used to <em>generate</em> the docs, not the one being documented: <a href="https://rustc-dev-guide.rust-lang.org/building/bootstrapping.html#understanding-stages-of-bootstrap">https://rustc-dev-guide.rust-lang.org/building/bootstrapping.html#understanding-stages-of-bootstrap</a></p>



<a name="252098081"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/How%20do%20I%20build%20rustdoc%20for%20compiler%20inernals%3F/near/252098081" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Frank Steffahn <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/How.20do.20I.20build.20rustdoc.20for.20compiler.20inernals.3F.html#252098081">(Sep 05 2021 at 19:55)</a>:</h4>
<p><span class="user-mention" data-user-id="232545">@Joshua Nelson</span> It does a full build though, AFAICT. You’ll see <code>Compiling …</code> for the whole rust compiler <em>twice</em> before it starts <code>Documenting</code> anything with <code>x.py doc compiler/rustc --stage 1</code>; similarly for <code>library/std</code> (<a href="https://rustc-dev-guide.rust-lang.org/building/bootstrapping.html#default-stages">and b.t.w. for <code>doc</code> command <code>--stage 0</code> *is* the default</a>).</p>
<p>Can’t give you an output for <code>x.py doc compiler/rustc --stage 1</code> (because that would take forever), but for example for <code>std</code>:</p>
<div class="codehilite"><pre><span></span><code>$ x.px doc library/std --stage 0
Updating only changed submodules
Submodules updated in 0.01 seconds
    Finished dev [unoptimized + debuginfo] target(s) in 0.14s
Documenting stage0 std (x86_64-unknown-linux-gnu)
Building stage0 std artifacts (x86_64-unknown-linux-gnu -&gt; x86_64-unknown-linux-gnu)
   Compiling cc v1.0.69
   Compiling core v0.0.0 (/home/frank/forks/rust/library/core)
   Compiling libc v0.2.99
   Compiling memchr v2.4.1
   Compiling std v0.0.0 (/home/frank/forks/rust/library/std)
   Compiling compiler_builtins v0.1.49
   Compiling unwind v0.0.0 (/home/frank/forks/rust/library/unwind)
   Compiling rustc-std-workspace-core v1.99.0 (/home/frank/forks/rust/library/rustc-std-workspace-core)
   Compiling alloc v0.0.0 (/home/frank/forks/rust/library/alloc)
   Compiling cfg-if v0.1.10
   Compiling adler v0.2.3
   Compiling rustc-demangle v0.1.21
   Compiling rustc-std-workspace-alloc v1.99.0 (/home/frank/forks/rust/library/rustc-std-workspace-alloc)
   Compiling panic_unwind v0.0.0 (/home/frank/forks/rust/library/panic_unwind)
   Compiling panic_abort v0.0.0 (/home/frank/forks/rust/library/panic_abort)
   Compiling gimli v0.25.0
   Compiling hashbrown v0.11.0
   Compiling std_detect v0.1.5 (/home/frank/forks/rust/library/stdarch/crates/std_detect)
   Compiling miniz_oxide v0.4.0
   Compiling object v0.26.2
   Compiling addr2line v0.16.0
   Compiling rustc-std-workspace-std v1.99.0 (/home/frank/forks/rust/library/rustc-std-workspace-std)
   Compiling proc_macro v0.0.0 (/home/frank/forks/rust/library/proc_macro)
   Compiling unicode-width v0.1.8
   Compiling getopts v0.2.21
   Compiling test v0.0.0 (/home/frank/forks/rust/library/test)
    Finished release [optimized] target(s) in 50.10s
Copying stage0 std from stage0 (x86_64-unknown-linux-gnu -&gt; x86_64-unknown-linux-gnu / x86_64-unknown-linux-gnu)
 Documenting core v0.0.0 (/home/frank/forks/rust/library/core)
    Finished release [optimized] target(s) in 16.24s
    Checking core v0.0.0 (/home/frank/forks/rust/library/core)
    Checking rustc-std-workspace-core v1.99.0 (/home/frank/forks/rust/library/rustc-std-workspace-core)
    Checking compiler_builtins v0.1.49
 Documenting alloc v0.0.0 (/home/frank/forks/rust/library/alloc)
    Finished release [optimized] target(s) in 23.22s
    Checking libc v0.2.99
   Compiling std v0.0.0 (/home/frank/forks/rust/library/std)
    Checking alloc v0.0.0 (/home/frank/forks/rust/library/alloc)
    Checking cfg-if v0.1.10
    Checking adler v0.2.3
    Checking memchr v2.4.1
    Checking rustc-demangle v0.1.21
    Checking unwind v0.0.0 (/home/frank/forks/rust/library/unwind)
    Checking rustc-std-workspace-alloc v1.99.0 (/home/frank/forks/rust/library/rustc-std-workspace-alloc)
    Checking panic_unwind v0.0.0 (/home/frank/forks/rust/library/panic_unwind)
    Checking panic_abort v0.0.0 (/home/frank/forks/rust/library/panic_abort)
    Checking gimli v0.25.0
    Checking std_detect v0.1.5 (/home/frank/forks/rust/library/stdarch/crates/std_detect)
    Checking hashbrown v0.11.0
    Checking miniz_oxide v0.4.0
    Checking object v0.26.2
    Checking addr2line v0.16.0
 Documenting std v0.0.0 (/home/frank/forks/rust/library/std)
    Finished release [optimized] target(s) in 14.06s
Build completed successfully in 0:01:45
</code></pre></div>



<a name="252098175"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/How%20do%20I%20build%20rustdoc%20for%20compiler%20inernals%3F/near/252098175" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/How.20do.20I.20build.20rustdoc.20for.20compiler.20inernals.3F.html#252098175">(Sep 05 2021 at 19:57)</a>:</h4>
<p>Hmm, ok, that does look incorrect. I wonder if it regressed at some point, I don't remember it doing that before</p>



<a name="252098406"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/How%20do%20I%20build%20rustdoc%20for%20compiler%20inernals%3F/near/252098406" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/How.20do.20I.20build.20rustdoc.20for.20compiler.20inernals.3F.html#252098406">(Sep 05 2021 at 20:00)</a>:</h4>
<p>yeah this bit looks odd: <a href="https://github.com/rust-lang/rust/blob/e2750baf53aaa60db95f10759f6cf9463dc5a6bd/src/bootstrap/doc.rs#L569">https://github.com/rust-lang/rust/blob/e2750baf53aaa60db95f10759f6cf9463dc5a6bd/src/bootstrap/doc.rs#L569</a></p>



<a name="252098600"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/How%20do%20I%20build%20rustdoc%20for%20compiler%20inernals%3F/near/252098600" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/How.20do.20I.20build.20rustdoc.20for.20compiler.20inernals.3F.html#252098600">(Sep 05 2021 at 20:04)</a>:</h4>
<p>(it's also possible I've just never tried to use --stage 1 with <code>doc compiler/rustc</code> before)</p>



<a name="252099279"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/How%20do%20I%20build%20rustdoc%20for%20compiler%20inernals%3F/near/252099279" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/How.20do.20I.20build.20rustdoc.20for.20compiler.20inernals.3F.html#252099279">(Sep 05 2021 at 20:16)</a>:</h4>
<blockquote>
<p>weirdly, I keep getting this "found possibly newer version of crate std" error, which manifests with different deps, but it seems to be transient with build and consistent with doc?</p>
</blockquote>
<p>oh, yeah that one is <a href="https://github.com/rust-lang/rust/issues/79980">https://github.com/rust-lang/rust/issues/79980</a></p>



<a name="252099720"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/How%20do%20I%20build%20rustdoc%20for%20compiler%20inernals%3F/near/252099720" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/How.20do.20I.20build.20rustdoc.20for.20compiler.20inernals.3F.html#252099720">(Sep 05 2021 at 20:24)</a>:</h4>
<blockquote>
<p>/home/joshua/rustc/build/x86_64-unknown-linux-gnu/stage1/bin/rustdoc: error while loading shared libraries: <a href="http://libtest-3be2459aaa99892c.so">libtest-3be2459aaa99892c.so</a>: cannot open shared object file: No such file or directory</p>
</blockquote>
<p>well this is odd - this is after I changed <code>doc</code> not to build the standard library:</p>
<div class="codehilite" data-code-language="Diff"><pre><span></span><code><span class="gh">diff --git a/src/bootstrap/doc.rs b/src/bootstrap/doc.rs</span>
<span class="gh">index c8714117930..6eb8df13689 100644</span>
<span class="gd">--- a/src/bootstrap/doc.rs</span>
<span class="gi">+++ b/src/bootstrap/doc.rs</span>
<span class="gu">@@ -446,7 +446,6 @@ fn run(self, builder: &amp;Builder&lt;'_&gt;) {</span>
         t!(fs::create_dir_all(&amp;out));
         let compiler = builder.compiler(stage, builder.config.build);

<span class="gd">-        builder.ensure(compile::Std { compiler, target });</span>
         let out_dir = builder.stage_out(compiler, Mode::Std).join(target.triple).join("doc");

         t!(fs::copy(builder.src.join("src/doc/rust.css"), out.join("rust.css")));
<span class="gu">@@ -564,9 +563,10 @@ fn run(self, builder: &amp;Builder&lt;'_&gt;) {</span>
         let out = builder.compiler_doc_out(target);
         t!(fs::create_dir_all(&amp;out));

<span class="gd">-        // Build rustc.</span>
<span class="gi">+        // Build the standard library, so that proc-macros can use it.</span>
<span class="gi">+        // (Normally, only the metadata would be necessary, but proc-macros are special since they run at compile-time.)</span>
         let compiler = builder.compiler(stage, builder.config.build);
<span class="gd">-        builder.ensure(compile::Rustc { compiler, target });</span>
<span class="gi">+        builder.ensure(compile::Std { compiler, target: builder.config.build });</span>

         // This uses a shared directory so that librustdoc documentation gets
         // correctly built and merged with the rustc documentation. This is
</code></pre></div>
<p>But that library was built, it just wasn't uplifted to the correct sysroot for some reason:</p>
<div class="codehilite"><pre><span></span><code>$ fd libtest-3be2459aaa99892c.so build/x86_64-unknown-linux-gnu/
build/x86_64-unknown-linux-gnu/stage0-std/x86_64-unknown-linux-gnu/release/deps/libtest-3be2459aaa99892c.so
build/x86_64-unknown-linux-gnu/stage0-sysroot/lib/rustlib/x86_64-unknown-linux-gnu/lib/libtest-3be2459aaa99892c.so
</code></pre></div>



<a name="252099866"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/How%20do%20I%20build%20rustdoc%20for%20compiler%20inernals%3F/near/252099866" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/How.20do.20I.20build.20rustdoc.20for.20compiler.20inernals.3F.html#252099866">(Sep 05 2021 at 20:27)</a>:</h4>
<p>instead it seems to have a completely different version of libstd???</p>
<div class="codehilite"><pre><span></span><code>$ fd libtest build/x86_64-unknown-linux-gnu/stage1
build/x86_64-unknown-linux-gnu/stage1/lib/libtest-6860eda207d50773.so
build/x86_64-unknown-linux-gnu/stage1/lib/rustlib/x86_64-unknown-linux-gnu/lib/libtest-6860eda207d50773.rlib
build/x86_64-unknown-linux-gnu/stage1/lib/rustlib/x86_64-unknown-linux-gnu/lib/libtest-6860eda207d50773.so
$ fd libtest build/x86_64-unknown-linux-gnu/stage0
build/x86_64-unknown-linux-gnu/stage0/lib/libtest-6e9019ff2cdb2237.so
build/x86_64-unknown-linux-gnu/stage0/lib/rustlib/x86_64-unknown-linux-gnu/lib/libtest-6e9019ff2cdb2237.rlib
build/x86_64-unknown-linux-gnu/stage0/lib/rustlib/x86_64-unknown-linux-gnu/lib/libtest-6e9019ff2cdb2237.so
$ fd libtest build/x86_64-unknown-linux-gnu/stage0-sysroot
build/x86_64-unknown-linux-gnu/stage0-sysroot/lib/rustlib/x86_64-unknown-linux-gnu/lib/libtest-3be2459aaa99892c.rlib
build/x86_64-unknown-linux-gnu/stage0-sysroot/lib/rustlib/x86_64-unknown-linux-gnu/lib/libtest-3be2459aaa99892c.so
</code></pre></div>



<a name="252100060"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/How%20do%20I%20build%20rustdoc%20for%20compiler%20inernals%3F/near/252100060" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/How.20do.20I.20build.20rustdoc.20for.20compiler.20inernals.3F.html#252100060">(Sep 05 2021 at 20:31)</a>:</h4>
<p>ok, according to what I wrote in <a href="https://rustc-dev-guide.rust-lang.org/building/bootstrapping.html#what-is-a-sysroot">https://rustc-dev-guide.rust-lang.org/building/bootstrapping.html#what-is-a-sysroot</a>, <code>lib/</code> is for rustc and <code>lib/rustlib</code> is for the standard library. I think it's wrong for the versions in lib/ and rustlib/ to be the same, <code>stage1/lib/libtest.so</code> should be the same as the one in <code>stage0-std</code>.</p>



<a name="252100085"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/How%20do%20I%20build%20rustdoc%20for%20compiler%20inernals%3F/near/252100085" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/How.20do.20I.20build.20rustdoc.20for.20compiler.20inernals.3F.html#252100085">(Sep 05 2021 at 20:31)</a>:</h4>
<p>and in fact that <em>is</em> the case for <code>stage0-sysroot</code>, it's only wrong for <code>stage1</code> <span aria-label="confused" class="emoji emoji-1f615" role="img" title="confused">:confused:</span></p>



<a name="252100452"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/How%20do%20I%20build%20rustdoc%20for%20compiler%20inernals%3F/near/252100452" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/How.20do.20I.20build.20rustdoc.20for.20compiler.20inernals.3F.html#252100452">(Sep 05 2021 at 20:38)</a>:</h4>
<p>and it's even being copied, because it's in the stamp file! is it being deleted ??</p>
<div class="codehilite"><pre><span></span><code>$ tr &#39;\0&#39; &#39;\n&#39; &lt; build/x86_64-unknown-linux-gnu/stage0-std/x86_64-unknown-linux-gnu/release/.libstd.stamp | grep libtest
t/home/joshua/rustc/build/x86_64-unknown-linux-gnu/stage0-std/x86_64-unknown-linux-gnu/release/deps/libtest-3be2459aaa99892c.rlib
t/home/joshua/rustc/build/x86_64-unknown-linux-gnu/stage0-std/x86_64-unknown-linux-gnu/release/deps/libtest-3be2459aaa99892c.so
</code></pre></div>



<a name="252114814"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/How%20do%20I%20build%20rustdoc%20for%20compiler%20inernals%3F/near/252114814" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gus Wynn <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/How.20do.20I.20build.20rustdoc.20for.20compiler.20inernals.3F.html#252114814">(Sep 06 2021 at 01:17)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/122651-general/topic/How.20do.20I.20build.20rustdoc.20for.20compiler.20inernals.3F/near/252087520">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="257428">Gus Wynn</span> this is probably <a href="https://github.com/rust-lang/rust/pull/88310">https://github.com/rust-lang/rust/pull/88310</a></p>
</blockquote>
<p>oh sweeet, so ra's x.py check and manual x.py runs wont interfere!</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>