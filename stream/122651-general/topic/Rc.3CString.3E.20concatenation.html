<html>
<head><meta charset="utf-8"><title>Rc&lt;String&gt; concatenation · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Rc.3CString.3E.20concatenation.html">Rc&lt;String&gt; concatenation</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="267816643"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Rc%3CString%3E%20concatenation/near/267816643" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Rc.3CString.3E.20concatenation.html#267816643">(Jan 13 2022 at 02:38)</a>:</h4>
<p>Hey folks - I'm currently working on a blog post, and I ended up confusing myself with one of the examples I wanted to use. As far as I understand, <code>Rc&lt;T&gt;</code> should roughly behave the same as <code>T</code>, right?</p>
<p>I have this code:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">String</span>::<span class="n">from</span><span class="p">(</span><span class="s">"foo"</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">string_closure</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="fm">println!</span><span class="p">(</span><span class="s">"String plus </span><span class="se">\"</span><span class="s">bar</span><span class="se">\"</span><span class="s"> is </span><span class="se">\"</span><span class="s">{}</span><span class="se">\"</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="n">string</span><span class="p">.</span><span class="n">clone</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">"bar"</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">};</span><span class="w"></span>
</code></pre></div>
<p>When I use <code>let string = Rc::new(String::from("foo"));</code> for the first line, I get this error:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">error</span><span class="p">[</span><span class="n">E0369</span><span class="p">]</span>: <span class="nc">cannot</span><span class="w"> </span><span class="n">add</span><span class="w"> </span><span class="err">`</span><span class="o">&amp;</span><span class="kt">str</span><span class="err">`</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="err">`</span><span class="n">Rc</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="err">`</span><span class="w"></span>
<span class="w"> </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">7</span>:<span class="mi">66</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"></span>
<span class="mi">7</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="fm">println!</span><span class="p">(</span><span class="s">"String plus </span><span class="se">\"</span><span class="s">bar</span><span class="se">\"</span><span class="s"> is </span><span class="se">\"</span><span class="s">{}</span><span class="se">\"</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="n">string</span><span class="p">.</span><span class="n">clone</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">"bar"</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w">                                                   </span><span class="o">--------------</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="o">-----</span><span class="w"> </span><span class="o">&amp;</span><span class="kt">str</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w">                                                   </span><span class="o">|</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w">                                                   </span><span class="n">Rc</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="w"></span>
</code></pre></div>
<p>I'm not sure what the right thing to do here in order to concatenate the string as usual, without needing to mess with mutability (not what I want for the example I'm writing)</p>



<a name="267821234"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Rc%3CString%3E%20concatenation/near/267821234" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Rc.3CString.3E.20concatenation.html#267821234">(Jan 13 2022 at 04:00)</a>:</h4>
<blockquote>
<p>As far as I understand, Rc&lt;T&gt; should roughly behave the same as T, right?</p>
</blockquote>
<p>Sort of. It behaves more like <code>&amp;T</code> and, even then, only in some situations.</p>



<a name="267821271"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Rc%3CString%3E%20concatenation/near/267821271" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Rc.3CString.3E.20concatenation.html#267821271">(Jan 13 2022 at 04:01)</a>:</h4>
<p>Btw, your code doesn't match the error. In the code, <code>string</code> has type <code>String</code>, while in the error, <code>string: Rc&lt;String&gt;</code>.</p>



<a name="267821539"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Rc%3CString%3E%20concatenation/near/267821539" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Rc.3CString.3E.20concatenation.html#267821539">(Jan 13 2022 at 04:05)</a>:</h4>
<p>I think replacing <code>string.clone()</code> with <code>string.as_ref().clone()</code> should solve your problem. This will convert <code>string</code> as follows:</p>
<ul>
<li><code>Rc&lt;String&gt;</code></li>
<li><code>&amp;Rc&lt;String&gt;</code></li>
<li><code>&amp;String</code></li>
<li><code>String</code></li>
</ul>



<a name="267821558"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Rc%3CString%3E%20concatenation/near/267821558" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Rc.3CString.3E.20concatenation.html#267821558">(Jan 13 2022 at 04:05)</a>:</h4>
<p><code>string.clone()</code> by itself just makes a new <code>Rc&lt;String&gt;</code>, which is not what you want in this particular case; you need an owned <code>String</code>.</p>



<a name="267825919"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Rc%3CString%3E%20concatenation/near/267825919" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Rc.3CString.3E.20concatenation.html#267825919">(Jan 13 2022 at 05:30)</a>:</h4>
<p>Thanks - <code>as_ref ()</code> works for the <code>Rc</code> case.<br>
<span class="user-mention silent" data-user-id="307537">Noah Lev</span> <a href="#narrow/stream/122651-general/topic/Rc.3CString.3E.20concatenation/near/267821271">said</a>:</p>
<blockquote>
<p>Btw, your code doesn't match the error. In the code, <code>string</code> has type <code>String</code>, while in the error, <code>string: Rc&lt;String&gt;</code>.</p>
</blockquote>
<p>I mentioned that I changed the line, causing the error ;)</p>
<blockquote>
<p>When I use <code>let string = Rc::new(String::from("foo"));</code> for the first line...</p>
</blockquote>



<a name="267914934"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Rc%3CString%3E%20concatenation/near/267914934" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Rc.3CString.3E.20concatenation.html#267914934">(Jan 13 2022 at 19:03)</a>:</h4>
<blockquote>
<p>I mentioned that I changed the line, causing the error ;)</p>
</blockquote>
<p>Ah, I missed that part :)</p>



<a name="267941614"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Rc%3CString%3E%20concatenation/near/267941614" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Rc.3CString.3E.20concatenation.html#267941614">(Jan 13 2022 at 22:38)</a>:</h4>
<p>I actually have another issue, in that <code>as_ref()</code> actually doesn't do what I want here, as I'd need to do <code>as_ref().clone()</code>, which allocates a new String. I'm trying to demonstrate that Rc lets you "clone" things without cloning the data.</p>



<a name="267955953"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Rc%3CString%3E%20concatenation/near/267955953" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Rc.3CString.3E.20concatenation.html#267955953">(Jan 14 2022 at 01:18)</a>:</h4>
<p>Clone then deref, and don't add, just use a second format argument</p>



<a name="267956495"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Rc%3CString%3E%20concatenation/near/267956495" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Rc.3CString.3E.20concatenation.html#267956495">(Jan 14 2022 at 01:26)</a>:</h4>
<blockquote>
<p>I'm trying to demonstrate that Rc lets you "clone" things without cloning the data.</p>
</blockquote>
<p>You need ownership of the left-hand string in order to concatenate it with something, so cloning an Rc is not sufficient</p>



<a name="267956571"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Rc%3CString%3E%20concatenation/near/267956571" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Rc.3CString.3E.20concatenation.html#267956571">(Jan 14 2022 at 01:27)</a>:</h4>
<p><span class="user-mention silent" data-user-id="363998">Ibraheem Ahmed</span>'s suggestion of just using another <code>format!</code> argument would be more idiomatic, but I suspect in your case you want to actually use concatenation</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>