<html>
<head><meta charset="utf-8"><title>Why can&#x27;t I specialize on `Clone` with `min_specialization`? · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Why.20can&#x27;t.20I.20specialize.20on.20.60Clone.60.20with.20.60min_specialization.60.3F.html">Why can&#x27;t I specialize on `Clone` with `min_specialization`?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="263691103"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Why%20can%27t%20I%20specialize%20on%20%60Clone%60%20with%20%60min_specialization%60%3F/near/263691103" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Why.20can&#x27;t.20I.20specialize.20on.20.60Clone.60.20with.20.60min_specialization.60.3F.html#263691103">(Dec 04 2021 at 07:48)</a>:</h4>
<p>If I try, I get &lt;<a href="https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2021&amp;gist=c7d82b089b685e819dde48c86f4809d8">https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2021&amp;gist=c7d82b089b685e819dde48c86f4809d8</a>&gt;</p>
<div class="codehilite"><pre><span></span><code>error: cannot specialize on trait `Clone`
</code></pre></div>
<p>But it works if the default impl has an additional <code>Clone</code> bound &lt;<a href="https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2021&amp;gist=a4c2ac42f6c7c6fc2c001888efdd4860">https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2021&amp;gist=a4c2ac42f6c7c6fc2c001888efdd4860</a>&gt;</p>
<p>What's special about the <code>Copy</code> case that makes it work?</p>
<p>(Context, to hopefully avoid XY: I'm trying to specialize in the standard library for Copy types to avoid some extra work.  And it works great for <code>repeat</code>-type scenarios (<a href="https://github.com/rust-lang/rust/issues/91506">#91506</a>), but without the <code>T: Clone</code> it doesn't work any more, which seemed weird.)</p>



<a name="263701814"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Why%20can%27t%20I%20specialize%20on%20%60Clone%60%20with%20%60min_specialization%60%3F/near/263701814" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Why.20can&#x27;t.20I.20specialize.20on.20.60Clone.60.20with.20.60min_specialization.60.3F.html#263701814">(Dec 04 2021 at 12:01)</a>:</h4>
<p>because</p>
<div class="codehilite"><pre><span></span><code>// FIXME(matthewjasper) This allows copying a type that doesn&#39;t implement
// `Copy` because of unsatisfied lifetime bounds (copying `A&lt;&#39;_&gt;` when only
// `A&lt;&#39;static&gt;: Copy` and `A&lt;&#39;_&gt;: Clone`).
// We have this attribute here for now only because there are quite a few
// existing specializations on `Copy` that already exist in the standard
// library, and there&#39;s no way to safely have this behavior right now.
#[rustc_unsafe_specialization_marker]
#[rustc_diagnostic_item = &quot;Copy&quot;]
pub trait Copy: Clone {
    // Empty.
}
</code></pre></div>
<p>And this has caused some safety holes but as the comment says it's grandfathered in because we'd lose some juicy optimizations without it.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>