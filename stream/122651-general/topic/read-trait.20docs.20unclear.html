<html>
<head><meta charset="utf-8"><title>read-trait docs unclear · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/read-trait.20docs.20unclear.html">read-trait docs unclear</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="250333289"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/read-trait%20docs%20unclear/near/250333289" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hannahE2 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/read-trait.20docs.20unclear.html#250333289">(Aug 23 2021 at 10:27)</a>:</h4>
<blockquote>
<p>Calling read with an uninitialized buf (of the kind one obtains via MaybeUninit&lt;T&gt;) is not safe, and can lead to undefined behavior.</p>
</blockquote>



<a name="250333314"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/read-trait%20docs%20unclear/near/250333314" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hannahE2 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/read-trait.20docs.20unclear.html#250333314">(Aug 23 2021 at 10:27)</a>:</h4>
<p>in <a href="https://doc.rust-lang.org/std/io/trait.Read.html">https://doc.rust-lang.org/std/io/trait.Read.html</a></p>



<a name="250333321"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/read-trait%20docs%20unclear/near/250333321" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hannahE2 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/read-trait.20docs.20unclear.html#250333321">(Aug 23 2021 at 10:27)</a>:</h4>
<p>What does that mean ?</p>



<a name="250333387"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/read-trait%20docs%20unclear/near/250333387" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hannahE2 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/read-trait.20docs.20unclear.html#250333387">(Aug 23 2021 at 10:28)</a>:</h4>
<p>AFAICT it's saying, in one sentence, at the end of the docs, that calling a safe API is unsound, without giving any examples, context, nothing.</p>



<a name="250333397"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/read-trait%20docs%20unclear/near/250333397" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hannahE2 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/read-trait.20docs.20unclear.html#250333397">(Aug 23 2021 at 10:28)</a>:</h4>
<p>Does this mean that the <code>Read</code> trait is unsound ?</p>



<a name="250333433"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/read-trait%20docs%20unclear/near/250333433" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/read-trait.20docs.20unclear.html#250333433">(Aug 23 2021 at 10:29)</a>:</h4>
<p>obtaining a <code>&amp;mut [u8]</code> that points to uninitialized memory is what's UB, the <code>Read</code> trait just reiterates that</p>



<a name="250333447"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/read-trait%20docs%20unclear/near/250333447" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hannahE2 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/read-trait.20docs.20unclear.html#250333447">(Aug 23 2021 at 10:29)</a>:</h4>
<p>Sure, but a <code>&amp;mut [MaybeUninit&lt;u8&gt;]</code> isn't</p>



<a name="250333463"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/read-trait%20docs%20unclear/near/250333463" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hannahE2 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/read-trait.20docs.20unclear.html#250333463">(Aug 23 2021 at 10:29)</a>:</h4>
<p>and the docs suggest that using MaybeUnit with the Read trait is UB</p>



<a name="250333577"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/read-trait%20docs%20unclear/near/250333577" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hannahE2 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/read-trait.20docs.20unclear.html#250333577">(Aug 23 2021 at 10:31)</a>:</h4>
<p>This sentence is superconfusing.</p>



<a name="250333674"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/read-trait%20docs%20unclear/near/250333674" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hannahE2 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/read-trait.20docs.20unclear.html#250333674">(Aug 23 2021 at 10:32)</a>:</h4>
<p>So can someone clarify whether the <code>Read</code> trait is sound or not ? <code>&amp;mut [MaybeUninit&lt;u8&gt;]</code> is a buffer containing uninitialized memory, that AFAICT is safe to use everywhere.</p>



<a name="250333704"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/read-trait%20docs%20unclear/near/250333704" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hannahE2 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/read-trait.20docs.20unclear.html#250333704">(Aug 23 2021 at 10:32)</a>:</h4>
<p>If it isn't safe to use it with the <code>Read</code> trait, then AFAICT that means it is not sound, and people should just stop using the trait altogether.</p>



<a name="250333737"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/read-trait%20docs%20unclear/near/250333737" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hannahE2 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/read-trait.20docs.20unclear.html#250333737">(Aug 23 2021 at 10:33)</a>:</h4>
<p>And documenting this with a tiny unclear sentence at the end of the docs isn't great TBH.</p>



<a name="250333762"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/read-trait%20docs%20unclear/near/250333762" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hannahE2 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/read-trait.20docs.20unclear.html#250333762">(Aug 23 2021 at 10:33)</a>:</h4>
<p>If <code>Read</code> isn't sound it should fail to compile or warn or something, at least until it is fixed.</p>



<a name="250333770"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/read-trait%20docs%20unclear/near/250333770" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/read-trait.20docs.20unclear.html#250333770">(Aug 23 2021 at 10:33)</a>:</h4>
<p><code>MaybeUninit</code> can be used to obtain the <code>&amp;mut [u8]</code> to uninitialized data, you can't use <code>Read</code> with just <code>MaybeUninit</code></p>



<a name="250333771"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/read-trait%20docs%20unclear/near/250333771" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/read-trait.20docs.20unclear.html#250333771">(Aug 23 2021 at 10:33)</a>:</h4>
<p>To be able to use <code>&amp;mut [MaybeUninit&lt;u8&gt;]</code> with <code>Read</code> you would have to turn it into a <code>&amp;mut [u8]</code> somehow which is only possible via unsafe. This conversion is the unsound part.</p>



<a name="250335271"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/read-trait%20docs%20unclear/near/250335271" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hannahE2 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/read-trait.20docs.20unclear.html#250335271">(Aug 23 2021 at 10:53)</a>:</h4>
<p>Right, but doing the conversion is instant UB, so UB happens way before you use <code>Read</code>.</p>



<a name="250335287"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/read-trait%20docs%20unclear/near/250335287" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hannahE2 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/read-trait.20docs.20unclear.html#250335287">(Aug 23 2021 at 10:53)</a>:</h4>
<p>And UB happens independently of whether you use Read or not.</p>



<a name="250335444"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/read-trait%20docs%20unclear/near/250335444" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hannahE2 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/read-trait.20docs.20unclear.html#250335444">(Aug 23 2021 at 10:55)</a>:</h4>
<p>If what this sentence tries to say is that "Getting a <code>&amp;mut [u8]</code> from a <code>&amp;mut [MaybeUninit&lt;u8&gt;]</code> is UB _iffffffff_ not all <code>MaybeUninit&lt;u8&gt;</code> have been properly initialized.", then it needs a complete rewrite. Ideally with one example showing the problem, and another one showing how to fix it (e.g. by initializing the memory). And a link to the <code>MaybeUninit</code> docs which already explain all of this.</p>



<a name="250335540"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/read-trait%20docs%20unclear/near/250335540" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hannahE2 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/read-trait.20docs.20unclear.html#250335540">(Aug 23 2021 at 10:56)</a>:</h4>
<p>If the goal here is instead to say that, "If a program exhibits UB _before_ reaching the <code>Read</code> API, then the <code>Read</code> API won't fix that UB." or something like that, then that's an unnecessary thing to state anywhere. If your program has UB, we make no guarantees, period. <code>Read</code> has nothing to do with that.</p>



<a name="250337720"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/read-trait%20docs%20unclear/near/250337720" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/read-trait.20docs.20unclear.html#250337720">(Aug 23 2021 at 11:21)</a>:</h4>
<p>The problem will go away once the ReadBuf API lands (<a href="https://github.com/rust-lang/rust/issues/81156">#81156</a>)</p>



<a name="250352891"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/read-trait%20docs%20unclear/near/250352891" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> sjud <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/read-trait.20docs.20unclear.html#250352891">(Aug 23 2021 at 13:41)</a>:</h4>
<p><span class="user-mention" data-user-id="203546">@Laurențiu</span> thank you!</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>