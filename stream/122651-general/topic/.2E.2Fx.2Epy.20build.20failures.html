<html>
<head><meta charset="utf-8"><title>./x.py build failures · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.2E.2Fx.2Epy.20build.20failures.html">./x.py build failures</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="247266679"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/./x.py%20build%20failures/near/247266679" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hudson Ayers <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.2E.2Fx.2Epy.20build.20failures.html#247266679">(Jul 26 2021 at 21:32)</a>:</h4>
<p>Trying to build the compiler for the first time, and ./x.py build is trying to access what appears to be an incorrect URL for CI artifacts: <a href="https://ci-artifacts.rust-lang.org/rustc-builds/7d8e7b14a7ccfeca85f7206c0a7e27a3f144ce9e">https://ci-artifacts.rust-lang.org/rustc-builds/7d8e7b14a7ccfeca85f7206c0a7e27a3f144ce9e</a> . Is this an indication I have done something wrong? I just cloned the rust repo, ran x.py setup, chose option 2, then x.py build</p>



<a name="247266791"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/./x.py%20build%20failures/near/247266791" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.2E.2Fx.2Epy.20build.20failures.html#247266791">(Jul 26 2021 at 21:34)</a>:</h4>
<p>How old is the commit you have checked out?</p>



<a name="247267049"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/./x.py%20build%20failures/near/247267049" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hudson Ayers <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.2E.2Fx.2Epy.20build.20failures.html#247267049">(Jul 26 2021 at 21:36)</a>:</h4>
<p>like 2 hours probably</p>



<a name="247267101"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/./x.py%20build%20failures/near/247267101" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.2E.2Fx.2Epy.20build.20failures.html#247267101">(Jul 26 2021 at 21:37)</a>:</h4>
<p>Does it work of you set <code>download-ci-llvm</code> to false in the <code>[llvm]</code> section of config.toml?</p>



<a name="247267256"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/./x.py%20build%20failures/near/247267256" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.2E.2Fx.2Epy.20build.20failures.html#247267256">(Jul 26 2021 at 21:38)</a>:</h4>
<p>This avoids downloading a pre-built llvm. It should work fine for commits this new though.</p>



<a name="247268253"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/./x.py%20build%20failures/near/247268253" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hudson Ayers <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.2E.2Fx.2Epy.20build.20failures.html#247268253">(Jul 26 2021 at 21:48)</a>:</h4>
<p>yeah, that seems to work. At least, it starts building something rather than failing immediately</p>



<a name="247271814"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/./x.py%20build%20failures/near/247271814" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.2E.2Fx.2Epy.20build.20failures.html#247271814">(Jul 26 2021 at 22:24)</a>:</h4>
<p>Hmm, that commit seems wrong, HEAD is <a href="https://github.com/rust-lang/rust/commit/08095fc1f875c89e507f17cf6c6a780c8ffa4c01">https://github.com/rust-lang/rust/commit/08095fc1f875c89e507f17cf6c6a780c8ffa4c01</a> right now. <span class="user-mention" data-user-id="301759">@Hudson Ayers</span> can you run <code>git rev-parse HEAD</code> and send me the output?</p>



<a name="247271924"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/./x.py%20build%20failures/near/247271924" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hudson Ayers <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.2E.2Fx.2Epy.20build.20failures.html#247271924">(Jul 26 2021 at 22:26)</a>:</h4>
<div class="codehilite"><pre><span></span><code>hudsonayers: ~/rust (master) $ git rev-parse HEAD
fc24bcead1d401ae061538d011e4a319c4195b56
</code></pre></div>



<a name="247272039"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/./x.py%20build%20failures/near/247272039" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.2E.2Fx.2Epy.20build.20failures.html#247272039">(Jul 26 2021 at 22:27)</a>:</h4>
<p>That looks like the stable branch - the download-* options are only supported on nightly</p>



<a name="247272126"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/./x.py%20build%20failures/near/247272126" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hudson Ayers <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.2E.2Fx.2Epy.20build.20failures.html#247272126">(Jul 26 2021 at 22:28)</a>:</h4>
<p>I think it is just one commit behind HEAD on master?</p>



<a name="247272132"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/./x.py%20build%20failures/near/247272132" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hudson Ayers <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.2E.2Fx.2Epy.20build.20failures.html#247272132">(Jul 26 2021 at 22:28)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/commits/master">https://github.com/rust-lang/rust/commits/master</a></p>



<a name="247272168"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/./x.py%20build%20failures/near/247272168" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.2E.2Fx.2Epy.20build.20failures.html#247272168">(Jul 26 2021 at 22:28)</a>:</h4>
<p>Err hmm you're right that's <a href="https://github.com/rust-lang/rust/pull/86696">https://github.com/rust-lang/rust/pull/86696</a> which is 1.56</p>



<a name="247272191"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/./x.py%20build%20failures/near/247272191" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.2E.2Fx.2Epy.20build.20failures.html#247272191">(Jul 26 2021 at 22:29)</a>:</h4>
<p>Yeah that's very strange, I wonder if it's related to release week somehow?</p>



<a name="247272467"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/./x.py%20build%20failures/near/247272467" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.2E.2Fx.2Epy.20build.20failures.html#247272467">(Jul 26 2021 at 22:32)</a>:</h4>
<p>Oh actually the commit it picked is the version bump - it's strange a) that it didn't pick the commit you're on and b) that there's no artifacts for that commit</p>



<a name="247272983"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/./x.py%20build%20failures/near/247272983" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.2E.2Fx.2Epy.20build.20failures.html#247272983">(Jul 26 2021 at 22:38)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/122651-general/topic/.2E.2Fx.2Epy.20build.20failures/near/247272467">said</a>:</p>
<blockquote>
<p>Oh actually the commit it picked is the version bump - it's strange a) that it didn't pick the commit you're on and b) that there's no artifacts for that commit</p>
</blockquote>
<p>oh right, it tries to pick the oldest possible commit so you have fewer spurious downloads. So yeah I'm confused why that commit doesn't have CI artifacts. <span class="user-mention" data-user-id="116122">@simulacrum</span> <span class="user-mention" data-user-id="121055">@Pietro Albini</span> do you happen to know why <a href="https://github.com/rust-lang/rust/commit/7d8e7b14a7ccfeca85f7206c0a7e27a3f144ce9e">https://github.com/rust-lang/rust/commit/7d8e7b14a7ccfeca85f7206c0a7e27a3f144ce9e</a> doesn't have artifacts on static.rlo?</p>



<a name="247273042"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/./x.py%20build%20failures/near/247273042" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.2E.2Fx.2Epy.20build.20failures.html#247273042">(Jul 26 2021 at 22:39)</a>:</h4>
<p>Do you have the URL you're trying to download from?</p>



<a name="247273056"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/./x.py%20build%20failures/near/247273056" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.2E.2Fx.2Epy.20build.20failures.html#247273056">(Jul 26 2021 at 22:39)</a>:</h4>
<p><a href="https://ci-artifacts.rust-lang.org/rustc-builds/7d8e7b14a7ccfeca85f7206c0a7e27a3f144ce9e">https://ci-artifacts.rust-lang.org/rustc-builds/7d8e7b14a7ccfeca85f7206c0a7e27a3f144ce9e</a></p>



<a name="247273176"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/./x.py%20build%20failures/near/247273176" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.2E.2Fx.2Epy.20build.20failures.html#247273176">(Jul 26 2021 at 22:40)</a>:</h4>
<p>That's.. not a specific artifact though? Like that'll never work for any commit, right?</p>



<a name="247273188"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/./x.py%20build%20failures/near/247273188" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.2E.2Fx.2Epy.20build.20failures.html#247273188">(Jul 26 2021 at 22:41)</a>:</h4>
<p>oh good point</p>



<a name="247273200"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/./x.py%20build%20failures/near/247273200" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.2E.2Fx.2Epy.20build.20failures.html#247273200">(Jul 26 2021 at 22:41)</a>:</h4>
<p><span class="user-mention" data-user-id="301759">@Hudson Ayers</span> can you post the full output of the command that failed?</p>



<a name="247273204"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/./x.py%20build%20failures/near/247273204" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.2E.2Fx.2Epy.20build.20failures.html#247273204">(Jul 26 2021 at 22:41)</a>:</h4>
<p>rustup-toolchain-install-master seems to install just fine for me</p>



<a name="247273209"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/./x.py%20build%20failures/near/247273209" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.2E.2Fx.2Epy.20build.20failures.html#247273209">(Jul 26 2021 at 22:41)</a>:</h4>
<p>(for that commit)</p>



<a name="247274340"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/./x.py%20build%20failures/near/247274340" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hudson Ayers <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.2E.2Fx.2Epy.20build.20failures.html#247274340">(Jul 26 2021 at 22:57)</a>:</h4>
<div class="codehilite"><pre><span></span><code>(.venv) hudsonayers: ~/rust (master) $ ./x.py build
Updating only changed submodules
Submodules updated in 0.05 seconds
downloading https://static.rust-lang.org/dist/2021-06-23/rust-std-beta-x86_64-unknown-linux-gnu.tar.xz
########################################################################### 100.0%
extracting /usr/local/google/home/hudsonayers/rust/build/cache/2021-06-23/rust-std-beta-x86_64-unknown-linux-gnu.tar.xz
downloading https://static.rust-lang.org/dist/2021-06-23/rustc-beta-x86_64-unknown-linux-gnu.tar.xz
########################################################################### 100.0%
extracting /usr/local/google/home/hudsonayers/rust/build/cache/2021-06-23/rustc-beta-x86_64-unknown-linux-gnu.tar.xz
downloading https://static.rust-lang.org/dist/2021-06-23/cargo-beta-x86_64-unknown-linux-gnu.tar.xz
########################################################################### 100.0%
extracting /usr/local/google/home/hudsonayers/rust/build/cache/2021-06-23/cargo-beta-x86_64-unknown-linux-gnu.tar.xz
downloading https://static.rust-lang.org/dist/2021-03-25/rustfmt-nightly-x86_64-unknown-linux-gnu.tar.xz
########################################################################### 100.0%
extracting /usr/local/google/home/hudsonayers/rust/build/cache/2021-03-25/rustfmt-nightly-x86_64-unknown-linux-gnu.tar.xz
downloading https://ci-artifacts.rust-lang.org/rustc-builds/7d8e7b14a7ccfeca85f7206c0a7e27a3f144ce9e

diff --git a/src/version b/src/version
index 094d6ad00ce..3ebf789f5a8 100644
--- a/src/version
+++ b/src/version
@@ -1 +1 @@
-1.55.0
+1.56.0/rust-dev-nightly-x86_64-unknown-linux-gnu.tar.xz
curl: (3) URL using bad/illegal format or missing URL

spurious failure, trying again
downloading https://ci-artifacts.rust-lang.org/rustc-builds/7d8e7b14a7ccfeca85f7206c0a7e27a3f144ce9e

diff --git a/src/version b/src/version
index 094d6ad00ce..3ebf789f5a8 100644
--- a/src/version
+++ b/src/version
@@ -1 +1 @@
-1.55.0
+1.56.0/rust-dev-nightly-x86_64-unknown-linux-gnu.tar.xz
curl: (3) URL using bad/illegal format or missing URL

spurious failure, trying again
downloading https://ci-artifacts.rust-lang.org/rustc-builds/7d8e7b14a7ccfeca85f7206c0a7e27a3f144ce9e

diff --git a/src/version b/src/version
index 094d6ad00ce..3ebf789f5a8 100644
--- a/src/version
+++ b/src/version
@@ -1 +1 @@
-1.55.0
+1.56.0/rust-dev-nightly-x86_64-unknown-linux-gnu.tar.xz
curl: (3) URL using bad/illegal format or missing URL

spurious failure, trying again
downloading https://ci-artifacts.rust-lang.org/rustc-builds/7d8e7b14a7ccfeca85f7206c0a7e27a3f144ce9e

diff --git a/src/version b/src/version
index 094d6ad00ce..3ebf789f5a8 100644
--- a/src/version
+++ b/src/version
@@ -1 +1 @@
-1.55.0
+1.56.0/rust-dev-nightly-x86_64-unknown-linux-gnu.tar.xz
curl: (3) URL using bad/illegal format or missing URL

spurious failure, trying again
downloading https://ci-artifacts.rust-lang.org/rustc-builds/7d8e7b14a7ccfeca85f7206c0a7e27a3f144ce9e

diff --git a/src/version b/src/version
index 094d6ad00ce..3ebf789f5a8 100644
--- a/src/version
+++ b/src/version
@@ -1 +1 @@
-1.55.0
+1.56.0/rust-dev-nightly-x86_64-unknown-linux-gnu.tar.xz
curl: (3) URL using bad/illegal format or missing URL
failed to run: curl -# -y 30 -Y 10 --connect-timeout 30 --retry 3 -Sf -o /tmp/tmp08g8agoq https://ci-artifacts.rust-lang.org/rustc-builds/7d8e7b14a7ccfeca85f7206c0a7e27a3f144ce9e

diff --git a/src/version b/src/version
index 094d6ad00ce..3ebf789f5a8 100644
--- a/src/version
+++ b/src/version
@@ -1 +1 @@
-1.55.0
+1.56.0/rust-dev-nightly-x86_64-unknown-linux-gnu.tar.xz
Build completed unsuccessfully in 0:00:19
</code></pre></div>



<a name="247276026"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/./x.py%20build%20failures/near/247276026" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.2E.2Fx.2Epy.20build.20failures.html#247276026">(Jul 26 2021 at 23:19)</a>:</h4>
<p>this looks like <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/Can't.20run.20x.2Epy">https://rust-lang.zulipchat.com/#narrow/stream/182449-t-compiler.2Fhelp/topic/Can't.20run.20x.2Epy</a> - what version of git do you have?</p>



<a name="247276039"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/./x.py%20build%20failures/near/247276039" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.2E.2Fx.2Epy.20build.20failures.html#247276039">(Jul 26 2021 at 23:19)</a>:</h4>
<p>it would be nice to track down why this is happening, git has a bug somehow</p>



<a name="247276685"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/./x.py%20build%20failures/near/247276685" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hudson Ayers <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.2E.2Fx.2Epy.20build.20failures.html#247276685">(Jul 26 2021 at 23:28)</a>:</h4>
<p>git version 2.32.0.432.gabb21c7263-goog</p>



<a name="247276721"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/./x.py%20build%20failures/near/247276721" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.2E.2Fx.2Epy.20build.20failures.html#247276721">(Jul 26 2021 at 23:29)</a>:</h4>
<p>what's <code>-goog</code>? how did you install git, that doesn't look like my version number:</p>
<div class="codehilite"><pre><span></span><code>git version 2.25.1
</code></pre></div>



<a name="247276751"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/./x.py%20build%20failures/near/247276751" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hudson Ayers <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.2E.2Fx.2Epy.20build.20failures.html#247276751">(Jul 26 2021 at 23:29)</a>:</h4>
<p>Looking at the other user who had this issue, they are also at google, so now I am guessing this is a bug with the version of git that google provides on corp machines...sorry about this</p>



<a name="247276812"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/./x.py%20build%20failures/near/247276812" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.2E.2Fx.2Epy.20build.20failures.html#247276812">(Jul 26 2021 at 23:30)</a>:</h4>
<p><span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span>  would be nice if you could raise this internally at google</p>



<a name="247276839"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/./x.py%20build%20failures/near/247276839" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.2E.2Fx.2Epy.20build.20failures.html#247276839">(Jul 26 2021 at 23:30)</a>:</h4>
<p>cc <span class="user-mention" data-user-id="116883">@tmandry</span></p>



<a name="247277397"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/./x.py%20build%20failures/near/247277397" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.2E.2Fx.2Epy.20build.20failures.html#247277397">(Jul 26 2021 at 23:40)</a>:</h4>
<p>oh I hit this too</p>



<a name="247277405"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/./x.py%20build%20failures/near/247277405" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.2E.2Fx.2Epy.20build.20failures.html#247277405">(Jul 26 2021 at 23:40)</a>:</h4>
<p>I want to say my workaround was to build LLVM from source</p>



<a name="247277642"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/./x.py%20build%20failures/near/247277642" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.2E.2Fx.2Epy.20build.20failures.html#247277642">(Jul 26 2021 at 23:44)</a>:</h4>
<p>yeah that would work - <code>x.py</code> does slightly fancy git things to determine the right commit to download, so you can choose to just not download</p>



<a name="247277652"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/./x.py%20build%20failures/near/247277652" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.2E.2Fx.2Epy.20build.20failures.html#247277652">(Jul 26 2021 at 23:44)</a>:</h4>
<p>can you bring this up to whoever packages git at google?</p>



<a name="247279397"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/./x.py%20build%20failures/near/247279397" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.2E.2Fx.2Epy.20build.20failures.html#247279397">(Jul 27 2021 at 00:12)</a>:</h4>
<p>I can submit a bug report, but I don't have time to write one up at the moment. I don't have a lot of context on what's going on here.</p>



<a name="247279425"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/./x.py%20build%20failures/near/247279425" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.2E.2Fx.2Epy.20build.20failures.html#247279425">(Jul 27 2021 at 00:13)</a>:</h4>
<p><span class="user-mention" data-user-id="116883">@tmandry</span> the bug to report is <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/Can't.20run.20x.2Epy/near/244465299">https://rust-lang.zulipchat.com/#narrow/stream/182449-t-compiler.2Fhelp/topic/Can't.20run.20x.2Epy/near/244465299</a> - it should only be outputting a commit hash, but instead it's outputting a full git diff</p>



<a name="247279432"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/./x.py%20build%20failures/near/247279432" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.2E.2Fx.2Epy.20build.20failures.html#247279432">(Jul 27 2021 at 00:13)</a>:</h4>
<p>(<code>--format=%H</code> means "only the hash")</p>



<a name="247280479"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/./x.py%20build%20failures/near/247280479" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.2E.2Fx.2Epy.20build.20failures.html#247280479">(Jul 27 2021 at 00:31)</a>:</h4>
<p>okay, done. thanks for pointing me in the right direction <span class="user-mention" data-user-id="232545">@Joshua Nelson</span> :-)</p>



<a name="247280541"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/./x.py%20build%20failures/near/247280541" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.2E.2Fx.2Epy.20build.20failures.html#247280541">(Jul 27 2021 at 00:32)</a>:</h4>
<p>Thank you!</p>



<a name="247341104"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/./x.py%20build%20failures/near/247341104" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hudson Ayers <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.2E.2Fx.2Epy.20build.20failures.html#247341104">(Jul 27 2021 at 14:32)</a>:</h4>
<p>Digging into this more, I think part of the issue is that the existing command passed <code>-m</code>, which does nothing unless <code>-p</code> is also passed (which it is not). The google version of git modifies <code>-m</code> to imply <code>-p</code> rather than having standalone <code>-m</code> do nothing. I went ahead and submitted <a href="https://github.com/rust-lang/rust/pull/87513">https://github.com/rust-lang/rust/pull/87513</a> as I believe that would solve the issue for users on google's git without breaking anyone else (and updates to Google's git are likely to propagate much more slowly, whereas most people building rust from source will be using the tip of the master rust branch)</p>



<a name="247341176"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/./x.py%20build%20failures/near/247341176" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Yu [they/she] <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.2E.2Fx.2Epy.20build.20failures.html#247341176">(Jul 27 2021 at 14:33)</a>:</h4>
<p><span class="user-mention" data-user-id="301759">@Hudson Ayers</span> <span class="user-mention" data-user-id="116883">@tmandry</span> <br>
if you have a moment, could you please try running these commands from the top of your rust working directory and let us know which ones (if any) output only a single line containing a SHA-1 hash? thanks!</p>
<div class="codehilite"><pre><span></span><code>git log --no-patch --author=bors --format=%H -n1 --first-parent -- src/llvm-project src/bootstrap/download-ci-llvm-stamp src/version
git log --author=bors --format=%H -n1 --first-parent -- src/llvm-project src/bootstrap/download-ci-llvm-stamp src/version
</code></pre></div>



<a name="247341253"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/./x.py%20build%20failures/near/247341253" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Yu [they/she] <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.2E.2Fx.2Epy.20build.20failures.html#247341253">(Jul 27 2021 at 14:33)</a>:</h4>
<p><span class="user-mention" data-user-id="301759">@Hudson Ayers</span> oh, thanks for the update! i think <code>--no-patch</code> might override that local change, so if you could try that as well, that would be useful information</p>



<a name="247341685"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/./x.py%20build%20failures/near/247341685" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hudson Ayers <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.2E.2Fx.2Epy.20build.20failures.html#247341685">(Jul 27 2021 at 14:36)</a>:</h4>
<p><span class="user-mention silent" data-user-id="411291">Taylor Yu [they/she]</span> <a href="#narrow/stream/122651-general/topic/.2E.2Fx.2Epy.20build.20failures/near/247341176">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="301759">Hudson Ayers</span> <span class="user-mention silent" data-user-id="116883">tmandry</span> <br>
if you have a moment, could you please try running these commands from the top of your rust working directory and let us know which ones (if any) output only a single line containing a SHA-1 hash? thanks!</p>
<p><div class="codehilite"><pre><span></span><code>git log --no-patch --author=bors --format=%H -n1 --first-parent -- src/llvm-project src/bootstrap/download-ci-llvm-stamp src/version
git log --author=bors --format=%H -n1 --first-parent -- src/llvm-project src/bootstrap/download-ci-llvm-stamp src/version
</code></pre></div><br>
</p>
</blockquote>
<p>Both commands output a single line containing the correct SHA-1 hash</p>



<a name="247341756"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/./x.py%20build%20failures/near/247341756" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Yu [they/she] <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.2E.2Fx.2Epy.20build.20failures.html#247341756">(Jul 27 2021 at 14:37)</a>:</h4>
<p>cool, thanks!</p>



<a name="247341970"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/./x.py%20build%20failures/near/247341970" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hudson Ayers <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.2E.2Fx.2Epy.20build.20failures.html#247341970">(Jul 27 2021 at 14:39)</a>:</h4>
<p>I am happy to update my PR to either of those approaches as well. I chose to use <code>--diff-merges=off</code> because I think that is actually the desired behavior here, and it makes that explicit</p>



<a name="247342368"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/./x.py%20build%20failures/near/247342368" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Yu [they/she] <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.2E.2Fx.2Epy.20build.20failures.html#247342368">(Jul 27 2021 at 14:42)</a>:</h4>
<p>i think <code>--no-patch</code> is slightly safer than <code>--diff-merges=off</code>, in the unlikely event that bors ever pushes a non-merge commit for some reason. (removing the unneeded <code>-m</code> is still good.) we could also do more robust error handling in case we get back more than one line from the command, but that could be a separate PR.</p>



<a name="247407260"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/./x.py%20build%20failures/near/247407260" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Yu [they/she] <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.2E.2Fx.2Epy.20build.20failures.html#247407260">(Jul 27 2021 at 23:45)</a>:</h4>
<p>following up, i created <a href="https://github.com/rust-lang/rust/pull/87532">https://github.com/rust-lang/rust/pull/87532</a> which is somewhat more aggressive but should make things even more robust. (it uses <code>git rev-parse</code>, among other things.) Hudson's should probably get merged first because it's more minimal. there are some open questions that i could use some feedback on.</p>



<a name="247533149"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/./x.py%20build%20failures/near/247533149" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonathan Nieder <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.2E.2Fx.2Epy.20build.20failures.html#247533149">(Jul 29 2021 at 00:27)</a>:</h4>
<p>Just a quick note: Google's git is built from branch "next" of <a href="https://git.kernel.org/pub/scm/git/git.git/">https://git.kernel.org/pub/scm/git/git.git/</a>. One can get the same version from Debian experimental, for example.</p>



<a name="247533209"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/./x.py%20build%20failures/near/247533209" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonathan Nieder <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.2E.2Fx.2Epy.20build.20failures.html#247533209">(Jul 29 2021 at 00:28)</a>:</h4>
<p>I'll bring this up in Git upstream (<a href="https://lore.kernel.org/git/20210520214703.27323-11-sorganov@gmail.com/">https://lore.kernel.org/git/20210520214703.27323-11-sorganov@gmail.com/</a>) in case there were other scripts that were using <code>-m</code> this way.</p>



<a name="247533232"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/./x.py%20build%20failures/near/247533232" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Yu [they/she] <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.2E.2Fx.2Epy.20build.20failures.html#247533232">(Jul 29 2021 at 00:29)</a>:</h4>
<p>it's not clear to me what that <code>-m</code> was intended to do. maybe they meant to use <code>--merges</code>?</p>



<a name="247533357"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/./x.py%20build%20failures/near/247533357" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Yu [they/she] <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.2E.2Fx.2Epy.20build.20failures.html#247533357">(Jul 29 2021 at 00:31)</a>:</h4>
<p>anyway <span class="user-mention" data-user-id="301759">@Hudson Ayers</span> and any other affected people, i have an improved patch in <a href="https://github.com/rust-lang/rust/pull/87532">https://github.com/rust-lang/rust/pull/87532</a> that uses <code>git rev-list</code> instead (and also fixes an additional inappropriate use of <code>git log</code>) if you have time to try it out. that should be much more robust (and is probably what the code should have been using in the first place)</p>



<a name="248434264"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/./x.py%20build%20failures/near/248434264" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonathan Nieder <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.2E.2Fx.2Epy.20build.20failures.html#248434264">(Aug 05 2021 at 03:20)</a>:</h4>
<p>Thanks. I do like the <code>rev-list</code> example (it's more readable) so a rebase would be appreciated.</p>
<p>I've reported the impact of Git's <code>-m</code> change at <a href="https://lore.kernel.org/git/YQtYEftByY8cNMml@google.com/">https://lore.kernel.org/git/YQtYEftByY8cNMml@google.com/</a>. Feel free to reply there with thoughts on that topic.</p>



<a name="248434621"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/./x.py%20build%20failures/near/248434621" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.2E.2Fx.2Epy.20build.20failures.html#248434621">(Aug 05 2021 at 03:29)</a>:</h4>
<p>I think that was a good summary :) thanks!</p>



<a name="248435295"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/./x.py%20build%20failures/near/248435295" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.2E.2Fx.2Epy.20build.20failures.html#248435295">(Aug 05 2021 at 03:47)</a>:</h4>
<p>also FWIW almost no one builds old versions of rust except for distros, and distros wouldn't ever set download-ci-llvm = true</p>



<a name="248435298"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/./x.py%20build%20failures/near/248435298" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.2E.2Fx.2Epy.20build.20failures.html#248435298">(Aug 05 2021 at 03:47)</a>:</h4>
<p>so it's not going to affect anyone in practice</p>



<a name="248435778"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/./x.py%20build%20failures/near/248435778" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.2E.2Fx.2Epy.20build.20failures.html#248435778">(Aug 05 2021 at 03:58)</a>:</h4>
<p>/me just wasted 10 minutes setting gmail to be my default email client so I can click mailto links</p>



<a name="248435979"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/./x.py%20build%20failures/near/248435979" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.2E.2Fx.2Epy.20build.20failures.html#248435979">(Aug 05 2021 at 04:02)</a>:</h4>
<p>and apparently gmail doesn't support In-Reply-To anyway <span aria-label="face palm" class="emoji emoji-1f926" role="img" title="face palm">:face_palm:</span></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>