<html>
<head><meta charset="utf-8"><title>`Rc&lt;[T]&gt;` and `make_mut` · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60Rc.3C.5BT.5D.3E.60.20and.20.60make_mut.60.html">`Rc&lt;[T]&gt;` and `make_mut`</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="271900882"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60Rc%3C%5BT%5D%3E%60%20and%20%60make_mut%60/near/271900882" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60Rc.3C.5BT.5D.3E.60.20and.20.60make_mut.60.html#271900882">(Feb 14 2022 at 22:48)</a>:</h4>
<p>I'm trying to use <code>Rc&lt;[T]&gt;</code> and <code>make_mut</code> but they don't go together. <a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=12077508f9d509c4f149081a68d6268c">Here</a> is an example. Am I overlooking something?</p>



<a name="271901071"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60Rc%3C%5BT%5D%3E%60%20and%20%60make_mut%60/near/271901071" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60Rc.3C.5BT.5D.3E.60.20and.20.60make_mut.60.html#271901071">(Feb 14 2022 at 22:50)</a>:</h4>
<p>I guess I could instead use <code>get_mut</code>, and if it fails then I could manually clone the slice?</p>



<a name="271901851"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60Rc%3C%5BT%5D%3E%60%20and%20%60make_mut%60/near/271901851" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60Rc.3C.5BT.5D.3E.60.20and.20.60make_mut.60.html#271901851">(Feb 14 2022 at 22:59)</a>:</h4>
<div class="codehilite"><pre><span></span><code>the trait `Clone` is not implemented for `[u32]`
</code></pre></div>

<p>well that's not surprising in general, but it's unfortunate here</p>



<a name="271902116"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60Rc%3C%5BT%5D%3E%60%20and%20%60make_mut%60/near/271902116" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60Rc.3C.5BT.5D.3E.60.20and.20.60make_mut.60.html#271902116">(Feb 14 2022 at 23:01)</a>:</h4>
<p>there's a similar case with cloning <code>Box&lt;[T]&gt;</code>, but we have an explicit <code>Clone</code> for that</p>



<a name="271902136"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60Rc%3C%5BT%5D%3E%60%20and%20%60make_mut%60/near/271902136" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60Rc.3C.5BT.5D.3E.60.20and.20.60make_mut.60.html#271902136">(Feb 14 2022 at 23:02)</a>:</h4>
<p>maybe we can add duplicate <code>make_mut</code> for the same reason?</p>



<a name="271902246"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60Rc%3C%5BT%5D%3E%60%20and%20%60make_mut%60/near/271902246" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60Rc.3C.5BT.5D.3E.60.20and.20.60make_mut.60.html#271902246">(Feb 14 2022 at 23:02)</a>:</h4>
<p>Hmm, and I guess <code>ToOwned</code> doesn't fix it here, since getting a <code>Vec&lt;T&gt;</code> isn't really what the implementation wants either.</p>



<a name="271902691"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60Rc%3C%5BT%5D%3E%60%20and%20%60make_mut%60/near/271902691" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60Rc.3C.5BT.5D.3E.60.20and.20.60make_mut.60.html#271902691">(Feb 14 2022 at 23:07)</a>:</h4>
<p>with just a <code>todo!()</code> version added, duplicating the method does cause ambiguity already in existing tests</p>



<a name="271902706"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60Rc%3C%5BT%5D%3E%60%20and%20%60make_mut%60/near/271902706" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60Rc.3C.5BT.5D.3E.60.20and.20.60make_mut.60.html#271902706">(Feb 14 2022 at 23:07)</a>:</h4>
<p>so maybe call it <code>make_mut_slice</code> to be safe</p>



<a name="271902786"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60Rc%3C%5BT%5D%3E%60%20and%20%60make_mut%60/near/271902786" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Frank Steffahn <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60Rc.3C.5BT.5D.3E.60.20and.20.60make_mut.60.html#271902786">(Feb 14 2022 at 23:08)</a>:</h4>
<p>creating a new helper trait (with a generic implementation bound on <code>Clone</code>) and bounding <code>make_mut</code> on that trait instead of <code>Clone</code> might be reasonable?</p>



<a name="271903085"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60Rc%3C%5BT%5D%3E%60%20and%20%60make_mut%60/near/271903085" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60Rc.3C.5BT.5D.3E.60.20and.20.60make_mut.60.html#271903085">(Feb 14 2022 at 23:11)</a>:</h4>
<p>maybe so</p>



<a name="271903179"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60Rc%3C%5BT%5D%3E%60%20and%20%60make_mut%60/near/271903179" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60Rc.3C.5BT.5D.3E.60.20and.20.60make_mut.60.html#271903179">(Feb 14 2022 at 23:12)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">trait</span><span class="w"> </span><span class="n">DynClone</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">clone_into</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">target</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">MaybeUninit</span><span class="o">&lt;</span><span class="bp">Self</span><span class="o">&gt;</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="271903244"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60Rc%3C%5BT%5D%3E%60%20and%20%60make_mut%60/near/271903244" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60Rc.3C.5BT.5D.3E.60.20and.20.60make_mut.60.html#271903244">(Feb 14 2022 at 23:12)</a>:</h4>
<p>(although I think <code>MaybeUninit</code> is still <code>Sized</code>)</p>



<a name="271903322"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60Rc%3C%5BT%5D%3E%60%20and%20%60make_mut%60/near/271903322" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60Rc.3C.5BT.5D.3E.60.20and.20.60make_mut.60.html#271903322">(Feb 14 2022 at 23:13)</a>:</h4>
<p>that's roughly reinventing "place" again :)</p>



<a name="271903502"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60Rc%3C%5BT%5D%3E%60%20and%20%60make_mut%60/near/271903502" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Frank Steffahn <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60Rc.3C.5BT.5D.3E.60.20and.20.60make_mut.60.html#271903502">(Feb 14 2022 at 23:15)</a>:</h4>
<p>a less general approach could just feature a <code>fn(&amp;self) -&gt; Rc&lt;Self&gt;</code> method. And the same thing for <code>Arc</code>, potentially even as yet another trait. As long as the trait and its method is still unstable the details shouldn't matter anyways, right? Of course the additional capabilities of <code>make_mut</code> <em>would</em> be instantly stable, I suppose</p>



<a name="271903599"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60Rc%3C%5BT%5D%3E%60%20and%20%60make_mut%60/near/271903599" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60Rc.3C.5BT.5D.3E.60.20and.20.60make_mut.60.html#271903599">(Feb 14 2022 at 23:16)</a>:</h4>
<p>I don't like the habit of perm-unstable stuff though</p>



<a name="271903621"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60Rc%3C%5BT%5D%3E%60%20and%20%60make_mut%60/near/271903621" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60Rc.3C.5BT.5D.3E.60.20and.20.60make_mut.60.html#271903621">(Feb 14 2022 at 23:17)</a>:</h4>
<p>if nothing else, it means 3rd-party code can't be generic in the same way</p>



<a name="271903657"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60Rc%3C%5BT%5D%3E%60%20and%20%60make_mut%60/near/271903657" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60Rc.3C.5BT.5D.3E.60.20and.20.60make_mut.60.html#271903657">(Feb 14 2022 at 23:17)</a>:</h4>
<p>(like <code>Pattern</code>, <code>Step</code>, <code>Try</code>, ...)</p>



<a name="271903724"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60Rc%3C%5BT%5D%3E%60%20and%20%60make_mut%60/near/271903724" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60Rc.3C.5BT.5D.3E.60.20and.20.60make_mut.60.html#271903724">(Feb 14 2022 at 23:18)</a>:</h4>
<p>not that those are definitely unstable forever, but it's been a long time</p>



<a name="271903742"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60Rc%3C%5BT%5D%3E%60%20and%20%60make_mut%60/near/271903742" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60Rc.3C.5BT.5D.3E.60.20and.20.60make_mut.60.html#271903742">(Feb 14 2022 at 23:18)</a>:</h4>
<blockquote>
<p>that's roughly reinventing "place" again :)</p>
</blockquote>
<p>I was thinking of a ContainerBuilder that can produce Box, Arc, Rc and similar, with specific handling for [T]s. Initializing the value would be one part of that.</p>



<a name="271903779"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60Rc%3C%5BT%5D%3E%60%20and%20%60make_mut%60/near/271903779" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60Rc.3C.5BT.5D.3E.60.20and.20.60make_mut.60.html#271903779">(Feb 14 2022 at 23:19)</a>:</h4>
<p><code>Box</code> and it's stuff, <code>Unsize</code>, <code>CoerceUnsized</code>.<br>
Side note, pls give <code>CoerceUnsized</code>.</p>



<a name="271903802"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60Rc%3C%5BT%5D%3E%60%20and%20%60make_mut%60/near/271903802" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Frank Steffahn <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60Rc.3C.5BT.5D.3E.60.20and.20.60make_mut.60.html#271903802">(Feb 14 2022 at 23:19)</a>:</h4>
<p>Yes, certainly a general approach along the lines of what you propose seems desirable. The unstable stuff is just about what one <em>could</em> use as long as no eventually stabilizable general solution has been implemented yet. E. g. perhaps unions such as <code>MaybeUninit</code> will eventually support unsized types, etc.</p>



<a name="271904851"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60Rc%3C%5BT%5D%3E%60%20and%20%60make_mut%60/near/271904851" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60Rc.3C.5BT.5D.3E.60.20and.20.60make_mut.60.html#271904851">(Feb 14 2022 at 23:31)</a>:</h4>
<p>I'm trying to write this <code>make_mut_slice</code>, I'm not sure if it can be done without <code>unsafe</code></p>



<a name="271910287"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60Rc%3C%5BT%5D%3E%60%20and%20%60make_mut%60/near/271910287" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60Rc.3C.5BT.5D.3E.60.20and.20.60make_mut.60.html#271910287">(Feb 15 2022 at 00:33)</a>:</h4>
<p>huh, I forgot about that <code>write_clone_into_raw</code> optimization I added :)</p>



<a name="271910431"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60Rc%3C%5BT%5D%3E%60%20and%20%60make_mut%60/near/271910431" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60Rc.3C.5BT.5D.3E.60.20and.20.60make_mut.60.html#271910431">(Feb 15 2022 at 00:35)</a>:</h4>
<p>I think <code>make_mut_slice</code> will basically be the same as <code>make_mut</code>, just looping multiple of those write calls, and probably guarded to drop previous entries if a clone panics</p>



<a name="271910463"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60Rc%3C%5BT%5D%3E%60%20and%20%60make_mut%60/near/271910463" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60Rc.3C.5BT.5D.3E.60.20and.20.60make_mut.60.html#271910463">(Feb 15 2022 at 00:35)</a>:</h4>
<p>but yes, that will involve <code>unsafe</code></p>



<a name="271912827"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60Rc%3C%5BT%5D%3E%60%20and%20%60make_mut%60/near/271912827" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60Rc.3C.5BT.5D.3E.60.20and.20.60make_mut.60.html#271912827">(Feb 15 2022 at 01:05)</a>:</h4>
<p>oh, <code>MaybeUninit::write_slice_cloned</code> already does that guarded looping</p>



<a name="271929733"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60Rc%3C%5BT%5D%3E%60%20and%20%60make_mut%60/near/271929733" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60Rc.3C.5BT.5D.3E.60.20and.20.60make_mut.60.html#271929733">(Feb 15 2022 at 05:41)</a>:</h4>
<p>Here's a version that doesn't involve <code>unsafe</code>, but is ugly:</p>
<div class="codehilite"><pre><span></span><code>/// `Rc::make_mut` works with `Rc&lt;T&gt;` but not `Rc&lt;[T]&gt;`, so we do it ourselves
/// here.
fn make_mut_slice(words: &amp;mut Rc&lt;[Word]&gt;) -&gt; &amp;mut [Word] {
    match Rc::get_mut(words) {
        Some(_) =&gt; {}
        None =&gt; *words = words.iter().cloned().collect(),
    }
    Rc::get_mut(words).unwrap()
}
</code></pre></div>



<a name="271929788"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60Rc%3C%5BT%5D%3E%60%20and%20%60make_mut%60/near/271929788" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60Rc.3C.5BT.5D.3E.60.20and.20.60make_mut.60.html#271929788">(Feb 15 2022 at 05:42)</a>:</h4>
<p>(<code>Word</code> is just a typedef for <code>u64</code> in my case)</p>



<a name="271949024"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60Rc%3C%5BT%5D%3E%60%20and%20%60make_mut%60/near/271949024" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60Rc.3C.5BT.5D.3E.60.20and.20.60make_mut.60.html#271949024">(Feb 15 2022 at 09:46)</a>:</h4>
<p>TIL <a href="https://doc.rust-lang.org/1.58.1/std/iter/trait.FromIterator.html#impl-FromIterator%3CT%3E-6">https://doc.rust-lang.org/1.58.1/std/iter/trait.FromIterator.html#impl-FromIterator%3CT%3E-6</a></p>
<p>I think that with that very tool, the solution is actually quite nice / elegant</p>



<a name="271957262"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60Rc%3C%5BT%5D%3E%60%20and%20%60make_mut%60/near/271957262" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> theseus yang <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60Rc.3C.5BT.5D.3E.60.20and.20.60make_mut.60.html#271957262">(Feb 15 2022 at 11:00)</a>:</h4>
<p>hi all , has Rust a library for direct memory access and management?</p>



<a name="271966626"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%60Rc%3C%5BT%5D%3E%60%20and%20%60make_mut%60/near/271966626" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Giacomo Stevanato <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.60Rc.3C.5BT.5D.3E.60.20and.20.60make_mut.60.html#271966626">(Feb 15 2022 at 12:30)</a>:</h4>
<p><span class="user-mention silent" data-user-id="125270">scottmcm</span> <a href="#narrow/stream/122651-general/topic/.60Rc.3C.5BT.5D.3E.60.20and.20.60make_mut.60/near/271902246">said</a>:</p>
<blockquote>
<p>Hmm, and I guess <code>ToOwned</code> doesn't fix it here, since getting a <code>Vec&lt;T&gt;</code> isn't really what the implementation wants either.</p>
</blockquote>
<p>You could require <code>T: ToOwned</code> and <code>Self: From&lt;T::Owned&gt;</code> then use <code>Self::from(t.to_owned())</code>. This should cover the existing cases because <code>T: Clone</code> implied <code>T: ToOwned&lt;Owned=T&gt;</code> and <code>Rc&lt;T&gt;: From&lt;T&gt;</code> for sized <code>T</code>s (and <code>T: Clone</code> implies <code>T: Sized</code>). This is of course not ideal for performance, but I guess it could be improved with specialization.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>