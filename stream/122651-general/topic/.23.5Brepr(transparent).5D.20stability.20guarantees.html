<html>
<head><meta charset="utf-8"><title>#[repr(transparent)] stability guarantees · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.23.5Brepr(transparent).5D.20stability.20guarantees.html">#[repr(transparent)] stability guarantees</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="267243489"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%23%5Brepr%28transparent%29%5D%20stability%20guarantees/near/267243489" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nilstrieb <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.23.5Brepr(transparent).5D.20stability.20guarantees.html#267243489">(Jan 07 2022 at 21:12)</a>:</h4>
<p>If I understand this correctly, removing <code>#[repr(transparent))]</code> from a type is not considered a breaking change currently, even though it may break something (or at least make it UB).</p>
<p>In my opinion, changing the <code>repr</code> of a type from something well-defined (like <code>transparent</code> or <code>C</code>) to anything else should be considered a breaking change in <a href="https://doc.rust-lang.org/cargo/reference/semver.html">https://doc.rust-lang.org/cargo/reference/semver.html</a></p>
<p>There seems to have been discussion on this before, but I'm still interested to know what you'd think of this?</p>
<p>Related:<br>
<a href="https://github.com/rust-lang/rust/issues/78586">https://github.com/rust-lang/rust/issues/78586</a></p>



<a name="267247981"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%23%5Brepr%28transparent%29%5D%20stability%20guarantees/near/267247981" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> inquisitivecrystal <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.23.5Brepr(transparent).5D.20stability.20guarantees.html#267247981">(Jan 07 2022 at 21:58)</a>:</h4>
<p>Wait, why wouldn't that be considered a breaking change?</p>



<a name="267250616"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%23%5Brepr%28transparent%29%5D%20stability%20guarantees/near/267250616" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.23.5Brepr(transparent).5D.20stability.20guarantees.html#267250616">(Jan 07 2022 at 22:22)</a>:</h4>
<p>It's a breaking change if one of the following is true:</p>
<ul>
<li>The fields are public</li>
<li>The layout is otherwise given publically and documented</li>
</ul>
<p>There can be use cases for a public type being <code>#[repr(transparent)]</code> only privately. It shouldn't be a breaking change to remove <code>#[repr(transparent)]</code> from such a type because the transparency isn't exposed as part of the API.</p>



<a name="267251956"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%23%5Brepr%28transparent%29%5D%20stability%20guarantees/near/267251956" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.23.5Brepr(transparent).5D.20stability.20guarantees.html#267251956">(Jan 07 2022 at 22:35)</a>:</h4>
<p>(Note that the above conditions are not exclusive: Any time that a type's ABI would become part of it's API <code>repr(transparent)</code> to <code>repr(C)</code>, and any guaranteed repr to <code>repr(Rust)</code> becomes breaking.)</p>



<a name="267265149"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%23%5Brepr%28transparent%29%5D%20stability%20guarantees/near/267265149" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Reeves <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.23.5Brepr(transparent).5D.20stability.20guarantees.html#267265149">(Jan 08 2022 at 01:09)</a>:</h4>
<p>There's an open issue suggesting that we change rustdoc to hide repr(transparent) on types where showing that in the public API might give users the wrong idea of what's guaranteed</p>



<a name="267265255"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%23%5Brepr%28transparent%29%5D%20stability%20guarantees/near/267265255" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.23.5Brepr(transparent).5D.20stability.20guarantees.html#267265255">(Jan 08 2022 at 01:11)</a>:</h4>
<p>Confirming what <span class="user-mention" data-user-id="257758">@Connor Horman</span> said is correct. <code>#[repr(transparent)]</code> by itself is meaningless for external users.</p>



<a name="267265325"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%23%5Brepr%28transparent%29%5D%20stability%20guarantees/near/267265325" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Reeves <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.23.5Brepr(transparent).5D.20stability.20guarantees.html#267265325">(Jan 08 2022 at 01:12)</a>:</h4>
<p><span class="user-mention" data-user-id="245610">@Jacob Pratt</span> aside from when the fields are public? Or not even then?</p>



<a name="267265343"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%23%5Brepr%28transparent%29%5D%20stability%20guarantees/near/267265343" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.23.5Brepr(transparent).5D.20stability.20guarantees.html#267265343">(Jan 08 2022 at 01:13)</a>:</h4>
<p>That's why I said by itself. If the field is public, it's a guarantee.</p>



<a name="267265348"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%23%5Brepr%28transparent%29%5D%20stability%20guarantees/near/267265348" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.23.5Brepr(transparent).5D.20stability.20guarantees.html#267265348">(Jan 08 2022 at 01:13)</a>:</h4>
<p>When fields are public yes (also when the non 1-ZST field is public)</p>



<a name="267265358"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%23%5Brepr%28transparent%29%5D%20stability%20guarantees/near/267265358" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.23.5Brepr(transparent).5D.20stability.20guarantees.html#267265358">(Jan 08 2022 at 01:13)</a>:</h4>
<p>And of course, if it's documented, but documentation alone provides the guaranteed.</p>



<a name="267284680"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%23%5Brepr%28transparent%29%5D%20stability%20guarantees/near/267284680" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nilstrieb <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.23.5Brepr(transparent).5D.20stability.20guarantees.html#267284680">(Jan 08 2022 at 08:45)</a>:</h4>
<p>Would it make sense to add this to the cargo book's semver rules?</p>



<a name="267287319"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%23%5Brepr%28transparent%29%5D%20stability%20guarantees/near/267287319" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.23.5Brepr(transparent).5D.20stability.20guarantees.html#267287319">(Jan 08 2022 at 09:50)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/issues/90435">#90435</a> would be useful too</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>