<html>
<head><meta charset="utf-8"><title>✔ Unsafe rust and compiler internals · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20Unsafe.20rust.20and.20compiler.20internals.html">✔ Unsafe rust and compiler internals</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="276346669"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20Unsafe%20rust%20and%20compiler%20internals/near/276346669" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Reed <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20Unsafe.20rust.20and.20compiler.20internals.html#276346669">(Mar 23 2022 at 15:03)</a>:</h4>
<p>I was hoping to get a pointer to any internal compiler documentation that clearly lists out the safety checks that are not enforced in unsafe code. The goal here is to guide a coding standard for Rust usage and the standard should look at unsafe Rust usage. I know the 'nomicon exists but I previously gotten the impression that it was not complete.</p>



<a name="276347095"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20Unsafe%20rust%20and%20compiler%20internals/near/276347095" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20Unsafe.20rust.20and.20compiler.20internals.html#276347095">(Mar 23 2022 at 15:06)</a>:</h4>
<p>I think defining that list is still a wip. I think the discussions is at <a href="https://github.com/rust-lang/unsafe-code-guidelines">https://github.com/rust-lang/unsafe-code-guidelines</a></p>



<a name="276347915"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20Unsafe%20rust%20and%20compiler%20internals/near/276347915" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20Unsafe.20rust.20and.20compiler.20internals.html#276347915">(Mar 23 2022 at 15:11)</a>:</h4>
<p>If you're asking for the specific restrictions that are lifted in unsafe, I believe the 5 listed <a href="https://doc.rust-lang.org/nightly/reference/unsafety.html">here</a> are complete.</p>



<a name="276348140"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20Unsafe%20rust%20and%20compiler%20internals/near/276348140" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20Unsafe.20rust.20and.20compiler.20internals.html#276348140">(Mar 23 2022 at 15:12)</a>:</h4>
<p>yep, that's the list basically</p>



<a name="276352688"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20Unsafe%20rust%20and%20compiler%20internals/near/276352688" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Reed <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20Unsafe.20rust.20and.20compiler.20internals.html#276352688">(Mar 23 2022 at 15:42)</a>:</h4>
<p>Thank you! This is great.</p>



<a name="276352963"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20Unsafe%20rust%20and%20compiler%20internals/near/276352963" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20Unsafe.20rust.20and.20compiler.20internals.html#276352963">(Mar 23 2022 at 15:44)</a>:</h4>
<p><span class="user-mention silent" data-user-id="488218">Tim Reed</span> has marked this topic as resolved.</p>



<a name="276354006"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20Unsafe%20rust%20and%20compiler%20internals/near/276354006" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20Unsafe.20rust.20and.20compiler.20internals.html#276354006">(Mar 23 2022 at 15:50)</a>:</h4>
<p>I believe that in the near future this list will need to be expanded to account for <a href="https://github.com/rust-lang/rust/issues/27060">https://github.com/rust-lang/rust/issues/27060</a> , yes?</p>



<a name="276359506"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20Unsafe%20rust%20and%20compiler%20internals/near/276359506" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20Unsafe.20rust.20and.20compiler.20internals.html#276359506">(Mar 23 2022 at 16:19)</a>:</h4>
<p>even unsafe code can't take a reference to a mis-aligned field of a packed struct, it would be instant-UB. You'd have to use addr_of</p>



<a name="276359556"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20Unsafe%20rust%20and%20compiler%20internals/near/276359556" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20Unsafe.20rust.20and.20compiler.20internals.html#276359556">(Mar 23 2022 at 16:20)</a>:</h4>
<p>That the compiler lets you do it in safe code today is just a bug</p>



<a name="276359879"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20Unsafe%20rust%20and%20compiler%20internals/near/276359879" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20Unsafe.20rust.20and.20compiler.20internals.html#276359879">(Mar 23 2022 at 16:21)</a>:</h4>
<p>If the "fix" involves letting unsafe code take the reference and then letting stuff blow up in your face if you dynamically did it wrong that's probably a very bad design for the fix. You should really just use addr_of</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>