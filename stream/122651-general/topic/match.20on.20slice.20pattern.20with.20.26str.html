<html>
<head><meta charset="utf-8"><title>match on slice pattern with &amp;str · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/match.20on.20slice.20pattern.20with.20.26str.html">match on slice pattern with &amp;str</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="262170367"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/match%20on%20slice%20pattern%20with%20%26str/near/262170367" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> AstOhm <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/match.20on.20slice.20pattern.20with.20.26str.html#262170367">(Nov 20 2021 at 08:07)</a>:</h4>
<p>Am I onto something completely stupid here or is there a way to get matching the last char in a str to work?</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">strip_unit</span><span class="p">(</span><span class="n">v</span>: <span class="kp">&amp;</span><span class="kt">str</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="p">(</span><span class="o">&amp;</span><span class="kt">str</span><span class="p">,</span><span class="w"> </span><span class="kt">u8</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="p">[</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="sc">'k'</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="sc">'K'</span><span class="p">]</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="p">[</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="sc">'m'</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="sc">'M'</span><span class="p">]</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="p">[</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="sc">'g'</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="sc">'G'</span><span class="p">]</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="p">[</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="sc">'t'</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="sc">'T'</span><span class="p">]</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="p">[</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="sc">'p'</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="sc">'P'</span><span class="p">]</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="p">[</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="p">};</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>I'd find something like that more concise/readable as what I'm doing currently:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="c1">// ...</span>
<span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="n">strip_suffix</span><span class="p">(</span><span class="o">&amp;</span><span class="p">[</span><span class="sc">'k'</span><span class="p">,</span><span class="w"> </span><span class="sc">'K'</span><span class="p">][</span><span class="o">..</span><span class="p">])</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="n">strip_suffix</span><span class="p">(</span><span class="o">&amp;</span><span class="p">[</span><span class="sc">'m'</span><span class="p">,</span><span class="w"> </span><span class="sc">'M'</span><span class="p">][</span><span class="o">..</span><span class="p">])</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="c1">// ...</span>
</code></pre></div>



<a name="262170688"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/match%20on%20slice%20pattern%20with%20%26str/near/262170688" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/match.20on.20slice.20pattern.20with.20.26str.html#262170688">(Nov 20 2021 at 08:15)</a>:</h4>
<p>strings aren't slices of char, they're slices of bytes, but even that is behind a wrapper</p>



<a name="262170689"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/match%20on%20slice%20pattern%20with%20%26str/near/262170689" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/match.20on.20slice.20pattern.20with.20.26str.html#262170689">(Nov 20 2021 at 08:15)</a>:</h4>
<p><a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2021&amp;gist=73b31e9b427a55be41127c68927045b6">https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2021&amp;gist=73b31e9b427a55be41127c68927045b6</a> would work</p>



<a name="262170736"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/match%20on%20slice%20pattern%20with%20%26str/near/262170736" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/match.20on.20slice.20pattern.20with.20.26str.html#262170736">(Nov 20 2021 at 08:16)</a>:</h4>
<p>but i don't know if it's clearer</p>



<a name="262171740"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/match%20on%20slice%20pattern%20with%20%26str/near/262171740" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Félix Saparelli <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/match.20on.20slice.20pattern.20with.20.26str.html#262171740">(Nov 20 2021 at 08:41)</a>:</h4>
<p>Or use the <code>fn</code> pattern:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">strip_unit</span><span class="p">(</span><span class="n">v</span>: <span class="kp">&amp;</span><span class="kt">str</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="p">(</span><span class="o">&amp;</span><span class="kt">str</span><span class="p">,</span><span class="w"> </span><span class="kt">u8</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">strip_suffix</span><span class="p">(</span><span class="o">|</span><span class="n">c</span>: <span class="kt">char</span><span class="o">|</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="sc">'k'</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="sc">'K'</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="sc">'m'</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="sc">'M'</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="p">;</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="sc">'g'</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="sc">'G'</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">9</span><span class="p">;</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="sc">'t'</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="sc">'T'</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">12</span><span class="p">;</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="sc">'p'</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="sc">'P'</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">15</span><span class="p">;</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kc">false</span><span class="w"></span>
<span class="w">    </span><span class="p">}).</span><span class="n">unwrap_or</span><span class="p">(</span><span class="n">v</span><span class="p">),</span><span class="w"> </span><span class="n">u</span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="262172095"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/match%20on%20slice%20pattern%20with%20%26str/near/262172095" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/match.20on.20slice.20pattern.20with.20.26str.html#262172095">(Nov 20 2021 at 08:49)</a>:</h4>
<p>yeah thats probably the cleanest</p>



<a name="262174717"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/match%20on%20slice%20pattern%20with%20%26str/near/262174717" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> AstOhm <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/match.20on.20slice.20pattern.20with.20.26str.html#262174717">(Nov 20 2021 at 10:00)</a>:</h4>
<p>great, many thanks to both of you for solutions</p>



<a name="262174901"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/match%20on%20slice%20pattern%20with%20%26str/near/262174901" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sofia <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/match.20on.20slice.20pattern.20with.20.26str.html#262174901">(Nov 20 2021 at 10:05)</a>:</h4>
<p>How about this?</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">strip_unit</span><span class="p">(</span><span class="n">v</span>: <span class="kp">&amp;</span><span class="kt">str</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="p">(</span><span class="o">&amp;</span><span class="kt">str</span><span class="p">,</span><span class="w"> </span><span class="kt">u8</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">v</span><span class="p">[</span><span class="o">..</span><span class="n">v</span><span class="p">.</span><span class="n">len</span><span class="p">().</span><span class="n">saturating_sub</span><span class="p">(</span><span class="mi">1</span><span class="p">)];</span><span class="w"></span>

<span class="w">    </span><span class="k">match</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="n">as_bytes</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="p">[</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="sc">b'k'</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="sc">b'K'</span><span class="p">]</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="p">[</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="sc">b'm'</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="sc">b'M'</span><span class="p">]</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="p">[</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="sc">b'g'</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="sc">b'G'</span><span class="p">]</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="p">[</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="sc">b't'</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="sc">b'T'</span><span class="p">]</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="p">[</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="sc">b'p'</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="sc">b'P'</span><span class="p">]</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="262175213"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/match%20on%20slice%20pattern%20with%20%26str/near/262175213" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sofia <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/match.20on.20slice.20pattern.20with.20.26str.html#262175213">(Nov 20 2021 at 10:11)</a>:</h4>
<p>Or better.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">strip_unit</span><span class="p">(</span><span class="n">v</span>: <span class="kp">&amp;</span><span class="kt">str</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="p">(</span><span class="o">&amp;</span><span class="kt">str</span><span class="p">,</span><span class="w"> </span><span class="kt">u8</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">rest</span><span class="p">,</span><span class="w"> </span><span class="n">last</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="n">split_at</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">len</span><span class="p">().</span><span class="n">saturating_sub</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span><span class="w"></span>

<span class="w">    </span><span class="k">match</span><span class="w"> </span><span class="n">last</span><span class="p">.</span><span class="n">as_bytes</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="p">[</span><span class="sc">b'k'</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="sc">b'K'</span><span class="p">]</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">rest</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="p">[</span><span class="sc">b'm'</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="sc">b'M'</span><span class="p">]</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">rest</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="p">[</span><span class="sc">b'g'</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="sc">b'G'</span><span class="p">]</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">rest</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="p">[</span><span class="sc">b't'</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="sc">b'T'</span><span class="p">]</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">rest</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="p">[</span><span class="sc">b'p'</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="sc">b'P'</span><span class="p">]</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">rest</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="262175718"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/match%20on%20slice%20pattern%20with%20%26str/near/262175718" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sofia <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/match.20on.20slice.20pattern.20with.20.26str.html#262175718">(Nov 20 2021 at 10:21)</a>:</h4>
<p><span class="user-mention" data-user-id="368654">@AstOhm</span> IMHO it'd be cleaner to do match against the <code>last</code> substring directly without the byte-wise indirection. Simpler.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">strip_unit</span><span class="p">(</span><span class="n">v</span>: <span class="kp">&amp;</span><span class="kt">str</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="p">(</span><span class="o">&amp;</span><span class="kt">str</span><span class="p">,</span><span class="w"> </span><span class="kt">u8</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">rest</span><span class="p">,</span><span class="w"> </span><span class="n">last</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="n">split_at</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">len</span><span class="p">().</span><span class="n">saturating_sub</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span><span class="w"></span>

<span class="w">    </span><span class="k">match</span><span class="w"> </span><span class="n">last</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s">"k"</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">"K"</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">rest</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="s">"m"</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">"M"</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">rest</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="s">"g"</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">"G"</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">rest</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="s">"t"</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">"T"</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">rest</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="s">"p"</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">"P"</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">rest</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="262175893"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/match%20on%20slice%20pattern%20with%20%26str/near/262175893" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hans Kratz <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/match.20on.20slice.20pattern.20with.20.26str.html#262175893">(Nov 20 2021 at 10:25)</a>:</h4>
<p><span class="user-mention" data-user-id="457100">@Sofia</span> All of those panic if the last char is not an ASCII character.</p>



<a name="262175948"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/match%20on%20slice%20pattern%20with%20%26str/near/262175948" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sofia <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/match.20on.20slice.20pattern.20with.20.26str.html#262175948">(Nov 20 2021 at 10:26)</a>:</h4>
<p>Huh. That split_at didn't work as I thought it did... thanks... Hmm.</p>



<a name="262176075"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/match%20on%20slice%20pattern%20with%20%26str/near/262176075" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sofia <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/match.20on.20slice.20pattern.20with.20.26str.html#262176075">(Nov 20 2021 at 10:30)</a>:</h4>
<p><span class="user-mention" data-user-id="407656">@Hans Kratz</span> Easy to guard the case... at least.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">strip_unit</span><span class="p">(</span><span class="n">v</span>: <span class="kp">&amp;</span><span class="kt">str</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="p">(</span><span class="o">&amp;</span><span class="kt">str</span><span class="p">,</span><span class="w"> </span><span class="kt">u8</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="n">ends_with</span><span class="p">(</span><span class="o">|</span><span class="n">x</span><span class="o">|</span><span class="w"> </span><span class="s">"kKmMgGtTpP"</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">rest</span><span class="p">,</span><span class="w"> </span><span class="n">last</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="n">split_at</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">len</span><span class="p">().</span><span class="n">saturating_sub</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span><span class="w"></span>

<span class="w">        </span><span class="k">match</span><span class="w"> </span><span class="n">last</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="s">"k"</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">"K"</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">rest</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">),</span><span class="w"></span>
<span class="w">            </span><span class="s">"m"</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">"M"</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">rest</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">),</span><span class="w"></span>
<span class="w">            </span><span class="s">"g"</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">"G"</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">rest</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">),</span><span class="w"></span>
<span class="w">            </span><span class="s">"t"</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">"T"</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">rest</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">),</span><span class="w"></span>
<span class="w">            </span><span class="s">"p"</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">"P"</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">rest</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">),</span><span class="w"></span>
<span class="w">            </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="c1">// now unreachable</span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="262176119"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/match%20on%20slice%20pattern%20with%20%26str/near/262176119" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sofia <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/match.20on.20slice.20pattern.20with.20.26str.html#262176119">(Nov 20 2021 at 10:31)</a>:</h4>
<p>Not as nice anymore. Oh well. :)</p>



<a name="262176241"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/match%20on%20slice%20pattern%20with%20%26str/near/262176241" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/match.20on.20slice.20pattern.20with.20.26str.html#262176241">(Nov 20 2021 at 10:34)</a>:</h4>
<p>you could match on the last byte and then slice based on the result. avoids the contains.</p>



<a name="262176257"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/match%20on%20slice%20pattern%20with%20%26str/near/262176257" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/match.20on.20slice.20pattern.20with.20.26str.html#262176257">(Nov 20 2021 at 10:35)</a>:</h4>
<p>yeah, thats what i suggested above (in the playground link) you could also be a little more clever about only actually slicing when you need to</p>



<a name="262176262"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/match%20on%20slice%20pattern%20with%20%26str/near/262176262" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/match.20on.20slice.20pattern.20with.20.26str.html#262176262">(Nov 20 2021 at 10:35)</a>:</h4>
<p>i still think thats how i'd write it</p>



<a name="262176327"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/match%20on%20slice%20pattern%20with%20%26str/near/262176327" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sofia <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/match.20on.20slice.20pattern.20with.20.26str.html#262176327">(Nov 20 2021 at 10:37)</a>:</h4>
<p>Not seeing better tools on str. <strong>shrugs</strong></p>



<a name="262178908"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/match%20on%20slice%20pattern%20with%20%26str/near/262178908" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> AstOhm <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/match.20on.20slice.20pattern.20with.20.26str.html#262178908">(Nov 20 2021 at 11:38)</a>:</h4>
<p><span class="user-mention" data-user-id="457100">@Sofia</span> hmm, with the non-ASCII handling it seems a bit more convoluted to me personally, and it seems it produces less efficient assembly compared to the fn-pattern: <a href="https://rust.godbolt.org/z/dYv1sh7Ks">https://rust.godbolt.org/z/dYv1sh7Ks</a> - thanks for your input though!</p>



<a name="262178936"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/match%20on%20slice%20pattern%20with%20%26str/near/262178936" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sofia <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/match.20on.20slice.20pattern.20with.20.26str.html#262178936">(Nov 20 2021 at 11:39)</a>:</h4>
<p>Yeah, it quickly degraded when handling that edge case. :)</p>



<a name="262179232"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/match%20on%20slice%20pattern%20with%20%26str/near/262179232" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sofia <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/match.20on.20slice.20pattern.20with.20.26str.html#262179232">(Nov 20 2021 at 11:47)</a>:</h4>
<p><span class="user-mention" data-user-id="368654">@AstOhm</span> If you only needed a lookup for the specific characters. You only need two bit-ANDs and one shift for a LUT. <a href="https://godbolt.org/z/zsnqnndWc">https://godbolt.org/z/zsnqnndWc</a></p>
<p>The output is undefined for any other value.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="c1">//    TP MKG</span>
<span class="w">   </span><span class="p">(</span><span class="mh">0xcf_6390</span><span class="k">u32</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">v</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x1c</span><span class="p">))</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0xf</span><span class="w"></span>
</code></pre></div>



<a name="262179648"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/match%20on%20slice%20pattern%20with%20%26str/near/262179648" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sofia <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/match.20on.20slice.20pattern.20with.20.26str.html#262179648">(Nov 20 2021 at 11:57)</a>:</h4>
<p><a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2021&amp;gist=d316c64b6bffc6d31638efdc8e7efcce">https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2021&amp;gist=d316c64b6bffc6d31638efdc8e7efcce</a></p>



<a name="262179956"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/match%20on%20slice%20pattern%20with%20%26str/near/262179956" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sofia <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/match.20on.20slice.20pattern.20with.20.26str.html#262179956">(Nov 20 2021 at 12:03)</a>:</h4>
<p>Undefined in the sense that it was specified for the exact key-&gt;value lookup you specified. The other keys do not map to 1, they map to whatever the arithmetic lands it on.</p>



<a name="262180309"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/match%20on%20slice%20pattern%20with%20%26str/near/262180309" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Frank Steffahn <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/match.20on.20slice.20pattern.20with.20.26str.html#262180309">(Nov 20 2021 at 12:09)</a>:</h4>
<p>Adapting one of <span class="user-mention" data-user-id="457100">@Sofia</span>'s solutions, something like</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">strip_unit</span><span class="p">(</span><span class="n">v</span>: <span class="kp">&amp;</span><span class="kt">str</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="p">(</span><span class="o">&amp;</span><span class="kt">str</span><span class="p">,</span><span class="w"> </span><span class="kt">u8</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="n">last</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="n">as_bytes</span><span class="p">().</span><span class="n">split_at</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">len</span><span class="p">().</span><span class="n">saturating_sub</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">rest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">&amp;</span><span class="n">v</span><span class="p">[</span><span class="o">..</span><span class="n">v</span><span class="p">.</span><span class="n">len</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="k">match</span><span class="w"> </span><span class="n">last</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="p">[</span><span class="sc">b'k'</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="sc">b'K'</span><span class="p">]</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">rest</span><span class="p">(),</span><span class="w"> </span><span class="mi">3</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="p">[</span><span class="sc">b'm'</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="sc">b'M'</span><span class="p">]</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">rest</span><span class="p">(),</span><span class="w"> </span><span class="mi">6</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="p">[</span><span class="sc">b'g'</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="sc">b'G'</span><span class="p">]</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">rest</span><span class="p">(),</span><span class="w"> </span><span class="mi">9</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="p">[</span><span class="sc">b't'</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="sc">b'T'</span><span class="p">]</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">rest</span><span class="p">(),</span><span class="w"> </span><span class="mi">12</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="p">[</span><span class="sc">b'p'</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="sc">b'P'</span><span class="p">]</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">rest</span><span class="p">(),</span><span class="w"> </span><span class="mi">15</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>might be nice enough?</p>



<a name="262181743"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/match%20on%20slice%20pattern%20with%20%26str/near/262181743" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sofia <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/match.20on.20slice.20pattern.20with.20.26str.html#262181743">(Nov 20 2021 at 12:37)</a>:</h4>
<p><span class="user-mention" data-user-id="368654">@AstOhm</span> Optimized lookup. Ignoring the slice details.</p>
<p><a href="https://godbolt.org/z/EhqfdeK5T">https://godbolt.org/z/EhqfdeK5T</a></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">opt</span><span class="p">(</span><span class="k">mut</span><span class="w"> </span><span class="n">v</span>: <span class="kt">u8</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">u32</span> <span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// upper case</span>
<span class="w">    </span><span class="n">v</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="o">!</span><span class="mh">0x20</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="sc">b'A'</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="sc">b'Z'</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="mh">0x89440</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">v</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="sc">b'A'</span><span class="p">))</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// TP MKG</span>
<span class="w">        </span><span class="p">(</span><span class="mh">0xcf_6390</span><span class="k">u32</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">v</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x1c</span><span class="p">))</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0xf</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="mi">1</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p><code>0x89440</code> is <code>0b00000010001001010001000000</code>, a bitmask a-z for kmgtp.</p>



<a name="262181794"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/match%20on%20slice%20pattern%20with%20%26str/near/262181794" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sofia <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/match.20on.20slice.20pattern.20with.20.26str.html#262181794">(Nov 20 2021 at 12:38)</a>:</h4>
<p>Not recommending you use such obscure code. Just a little fun. :-)</p>



<a name="262181798"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/match%20on%20slice%20pattern%20with%20%26str/near/262181798" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sofia <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/match.20on.20slice.20pattern.20with.20.26str.html#262181798">(Nov 20 2021 at 12:39)</a>:</h4>
<p>I'm sure someone can code-golf it even better.</p>



<a name="262181958"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/match%20on%20slice%20pattern%20with%20%26str/near/262181958" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sofia <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/match.20on.20slice.20pattern.20with.20.26str.html#262181958">(Nov 20 2021 at 12:44)</a>:</h4>
<p>The spec should have just been the match. <a href="https://godbolt.org/z/WdYvejT51">https://godbolt.org/z/WdYvejT51</a></p>



<a name="262182023"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/match%20on%20slice%20pattern%20with%20%26str/near/262182023" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sofia <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/match.20on.20slice.20pattern.20with.20.26str.html#262182023">(Nov 20 2021 at 12:45)</a>:</h4>
<p>The match might even be faster. But isn't as fun to write. :P</p>



<a name="262183006"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/match%20on%20slice%20pattern%20with%20%26str/near/262183006" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sofia <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/match.20on.20slice.20pattern.20with.20.26str.html#262183006">(Nov 20 2021 at 13:09)</a>:</h4>
<p>You can save one instruction using <code>.wrapping_sub(b'A')</code>. Yeah... I'm done. No more silly code golf. Have fun. o/</p>



<a name="262183239"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/match%20on%20slice%20pattern%20with%20%26str/near/262183239" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hans Kratz <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/match.20on.20slice.20pattern.20with.20.26str.html#262183239">(Nov 20 2021 at 13:15)</a>:</h4>
<p>Or in one expression (and not fast at all) <span aria-label="stuck out tongue" class="emoji emoji-1f61b" role="img" title="stuck out tongue">:stuck_out_tongue:</span></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">strip_unit</span><span class="p">(</span><span class="n">v</span>: <span class="kp">&amp;</span><span class="kt">str</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="p">(</span><span class="o">&amp;</span><span class="kt">str</span><span class="p">,</span><span class="w"> </span><span class="kt">u8</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">v</span><span class="p">.</span><span class="n">as_bytes</span><span class="p">()</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">last</span><span class="p">()</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="kt">u8</span>::<span class="n">to_ascii_lowercase</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">and_then</span><span class="p">(</span><span class="o">|</span><span class="n">ch</span><span class="o">|</span><span class="w"> </span><span class="s">b"kmgtp"</span><span class="p">.</span><span class="n">iter</span><span class="p">().</span><span class="n">position</span><span class="p">(</span><span class="o">|&amp;</span><span class="n">x</span><span class="o">|</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ch</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">map_or</span><span class="p">((</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="o">|</span><span class="n">num</span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="o">&amp;</span><span class="n">v</span><span class="p">[</span><span class="o">..</span><span class="n">v</span><span class="p">.</span><span class="n">len</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="p">(</span><span class="n">num</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">u8</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">3</span><span class="p">))</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>(for amusement only)</p>



<a name="262187592"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/match%20on%20slice%20pattern%20with%20%26str/near/262187592" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/match.20on.20slice.20pattern.20with.20.26str.html#262187592">(Nov 20 2021 at 14:57)</a>:</h4>
<p>Whatever the code, I'm confused by the <code>(v, 1)</code> default case. If you're returning the unit in log10, like "k" = 1000 = 10^3 -&gt; 3, shouldn't the unit-less return be 0? (10^0 = 1)</p>



<a name="262187986"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/match%20on%20slice%20pattern%20with%20%26str/near/262187986" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/match.20on.20slice.20pattern.20with.20.26str.html#262187986">(Nov 20 2021 at 15:05)</a>:</h4>
<p>('m' should give -3, 'p' should give -12</p>



<a name="262189945"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/match%20on%20slice%20pattern%20with%20%26str/near/262189945" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sofia <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/match.20on.20slice.20pattern.20with.20.26str.html#262189945">(Nov 20 2021 at 15:50)</a>:</h4>
<p>Oh I forgot to send my last iteration... This assumes the input is in the range <code>A..z</code>. Only 12 RV64GC instructions. Branchless. No memory lookups. Note the <code>&amp; 31</code> is free because RISC-V shifts only use the lower 5-6 bits.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">opt</span><span class="p">(</span><span class="k">mut</span><span class="w"> </span><span class="n">v</span>: <span class="kt">u8</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">u32</span> <span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">v</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="mh">0x1c</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">((</span><span class="o">-</span><span class="mh">0x225101</span><span class="k">i32</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">wrapping_sub</span><span class="p">(</span><span class="sc">b'A'</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mi">31</span><span class="p">))</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">u8</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="mh">0xcf_6391</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">v</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mi">31</span><span class="p">))</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0xf</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>