<html>
<head><meta charset="utf-8"><title>lang = &quot;start&quot; · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/lang.20.3D.20.22start.22.html">lang = &quot;start&quot;</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="275604902"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/lang%20%3D%20%22start%22/near/275604902" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brandon Falk <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/lang.20.3D.20.22start.22.html#275604902">(Mar 17 2022 at 03:54)</a>:</h4>
<p>Is there any documentation on how lang = "start" works? I'm working on an embedded library and would like for users to be able to make <code>fn main()</code>and have the _start implemented in the library</p>



<a name="275617867"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/lang%20%3D%20%22start%22/near/275617867" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/lang.20.3D.20.22start.22.html#275617867">(Mar 17 2022 at 08:07)</a>:</h4>
<p>When using <code>#[lang = "start"]</code> the compiler will make a <code>main</code> function that calls the lang=starr function with the user main function as argument.</p>



<a name="275617965"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/lang%20%3D%20%22start%22/near/275617965" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/lang.20.3D.20.22start.22.html#275617965">(Mar 17 2022 at 08:08)</a>:</h4>
<p>The generated function is always main and not _start.</p>



<a name="275618006"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/lang%20%3D%20%22start%22/near/275618006" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/lang.20.3D.20.22start.22.html#275618006">(Mar 17 2022 at 08:09)</a>:</h4>
<p>Maybe a custom <code>#[entry]</code> proc macro attribute is more suitable for your purposes. This attribute could generate the <code>_start</code> function calling whatever initialization function your library has (if any) before running the user main.</p>



<a name="275620219"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/lang%20%3D%20%22start%22/near/275620219" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/lang.20.3D.20.22start.22.html#275620219">(Mar 17 2022 at 08:35)</a>:</h4>
<p>There's also a proposal to stabilize <code>use somecrate::main</code>, with which you could define your main function in a crate and then let the user define a function called by main.</p>



<a name="275634601"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/lang%20%3D%20%22start%22/near/275634601" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/lang.20.3D.20.22start.22.html#275634601">(Mar 17 2022 at 10:55)</a>:</h4>
<p>That won't generate an _start function. Normally this is provided by the crt1.o object.</p>



<a name="275663385"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/lang%20%3D%20%22start%22/near/275663385" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/lang.20.3D.20.22start.22.html#275663385">(Mar 17 2022 at 14:44)</a>:</h4>
<p>yeah the ability to import a <code>main</code> instead of defining a main is basically ineffective for embedded needs. Most importantly, a rust ABI main fn (as all main fns are) is UB for the rt0 to call.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>