<html>
<head><meta charset="utf-8"><title>serde-transcode opposite · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/serde-transcode.20opposite.html">serde-transcode opposite</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="262191872"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/serde-transcode%20opposite/near/262191872" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> panstromek <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/serde-transcode.20opposite.html#262191872">(Nov 20 2021 at 16:33)</a>:</h4>
<p>Is there something like opposite of serde-transcode? Serde transcode can transform one serialized format to other one without going through intermediate structure, ie. Deserialize -&gt; serialize. I want to transform one struct into another through serde, ie. Serialize -&gt; deserialize. Basically I am looking for JSON.parse(JSON.stringify(val)) equivalent, without going through the serialized string.</p>



<a name="262193110"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/serde-transcode%20opposite/near/262193110" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/serde-transcode.20opposite.html#262193110">(Nov 20 2021 at 16:59)</a>:</h4>
<p><code>.clone()</code>?</p>



<a name="262193511"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/serde-transcode%20opposite/near/262193511" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> panstromek <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/serde-transcode.20opposite.html#262193511">(Nov 20 2021 at 17:05)</a>:</h4>
<p>No, the point is that the input structure is different than the output one</p>



<a name="262193602"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/serde-transcode%20opposite/near/262193602" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> panstromek <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/serde-transcode.20opposite.html#262193602">(Nov 20 2021 at 17:07)</a>:</h4>
<p>That's also the case in the JavaScript version btw.</p>



<a name="262195677"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/serde-transcode%20opposite/near/262195677" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/serde-transcode.20opposite.html#262195677">(Nov 20 2021 at 17:53)</a>:</h4>
<p>I'm not sure if that's possible <code>Deserialize</code> implementations can specify that they borrow bytes from the serialized form so the borrow has to come from somewhere which normally is the &amp;[u8]</p>



<a name="262198227"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/serde-transcode%20opposite/near/262198227" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/serde-transcode.20opposite.html#262198227">(Nov 20 2021 at 18:42)</a>:</h4>
<p>If you use serde_json, such code can't borrow it from somewhere either.</p>



<a name="262211219"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/serde-transcode%20opposite/near/262211219" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Félix Saparelli <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/serde-transcode.20opposite.html#262211219">(Nov 20 2021 at 23:41)</a>:</h4>
<p>Why do you want to use serde for this? (instead of converting between the structs directly)</p>



<a name="262226825"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/serde-transcode%20opposite/near/262226825" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> panstromek <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/serde-transcode.20opposite.html#262226825">(Nov 21 2021 at 07:27)</a>:</h4>
<p><span class="user-mention silent" data-user-id="453559">Félix Saparelli</span> <a href="#narrow/stream/122651-general/topic/serde-transcode.20opposite/near/262211219">said</a>:</p>
<blockquote>
<p>Why do you want to use serde for this? (instead of converting between the structs directly)</p>
</blockquote>
<p>It's more like an idea I was curious about. I implemented Serialize for Sqlite row, which allows me to quickly serialize it without going through intermediate Rust struct, which I don't need most of the time. So the idea is that I could use something like this if I actually want rust struct, just by defining the struct with derive(Deserialize) and  running the Sqlite row through serialize-deserialize chain.</p>



<a name="262226883"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/serde-transcode%20opposite/near/262226883" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> panstromek <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/serde-transcode.20opposite.html#262226883">(Nov 21 2021 at 07:29)</a>:</h4>
<p>The "right" way to do this would be to implement Deserializer for Sqlite row directly (which is what <code>serde-wasm-bindgen</code> does, I think, that's a similar idea).</p>



<a name="262226938"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/serde-transcode%20opposite/near/262226938" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> panstromek <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/serde-transcode.20opposite.html#262226938">(Nov 21 2021 at 07:31)</a>:</h4>
<p>but <code>serde-transcode</code> opposite would be more general solution</p>



<a name="262510388"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/serde-transcode%20opposite/near/262510388" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kestrer <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/serde-transcode.20opposite.html#262510388">(Nov 23 2021 at 20:37)</a>:</h4>
<p>Because both <code>Serialize</code> and <code>Deserialize</code> are internal functions they can't be directly plugged into one another. <code>serde-transcode</code> works because <code>Deserializer</code> is an external API, so it can easily become <code>Serialize</code>, an internal API, simply by writing the driver code. There could also theoretically be another crate that wraps an implementation of <code>Serializer</code> and implements <code>Deserialize</code>, though I don't know if it exists. Either way, to bridge the two internal functions you would need to use channels, or an intermediary data structure. Or alternatively you could implement <code>Deserializer</code> on that data structure and then pass it to that function.</p>



<a name="262558577"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/serde-transcode%20opposite/near/262558577" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> panstromek <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/serde-transcode.20opposite.html#262558577">(Nov 24 2021 at 08:35)</a>:</h4>
<p>I couldn't resist and tried to implement this by implementing Serializer-Deserializer pair (Deserializer calls <code>input.serialize()</code> and passes custom Serializer to it, which calls visitor methods like <code>serialize_bool -&gt; visitor.deserialize_bool</code>). It works for simple cases like primitive types, but for anything nested and more complicated the lifetimes just make it impossible without intermediate data structure. Even a simple case like <code>serialize_some -&gt; visit_some</code> turned out to be difficult to implement this way.</p>



<a name="262562181"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/serde-transcode%20opposite/near/262562181" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Frank Steffahn <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/serde-transcode.20opposite.html#262562181">(Nov 24 2021 at 09:10)</a>:</h4>
<p>I tried, too. The problem is - I think - that both the <code>Serialize</code> and <code>Deserialize</code> implementation each can use their own stack frame(s) throughout the entire duration of the (de)serialization process. So to connect the two, you'd need two separate threads that communicate over some channel, or some form of green-thread (some ways to have two stacks and cooperative multitasking between them). Or an <code>async</code> trait equivalent of serde's traits. The alternative is to use an intermediate in-memory representation, so you can do the full serialization first, and deserialization only afterwards.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>