<html>
<head><meta charset="utf-8"><title>cargo rebuilding codegen every time · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cargo.20rebuilding.20codegen.20every.20time.html">cargo rebuilding codegen every time</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="266969512"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20rebuilding%20codegen%20every%20time/near/266969512" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cargo.20rebuilding.20codegen.20every.20time.html#266969512">(Jan 05 2022 at 18:09)</a>:</h4>
<p>Im having a weird issue that im not sure how to solve, maybe someone who is a build script god could help. My CUDA codegen has a build script for doing build scripty things like building an llvm shim, as well as downloading prebuilt llvm on windows. The issue is for some reason cargo rebuilds the entire codegen and the entire kernel crate on miniscule changes, which is annoying and slow. I tried removing <code>rerun-if</code> commands in both <a href="https://github.com/Rust-GPU/Rust-CUDA/tree/master/crates/rustc_codegen_nvvm">rustc_codegen_nvvm</a> and <a href="https://github.com/Rust-GPU/Rust-CUDA/blob/master/crates/cuda_builder/src/lib.rs">cuda_builder</a> but for some reason that did nothing. Making a change like adding a space to <a href="https://github.com/Rust-GPU/Rust-CUDA/tree/master/examples/cuda/gpu/path_tracer_gpu">path_tracer_gpu</a> then building <a href="https://github.com/Rust-GPU/Rust-CUDA/tree/master/examples/cuda/cpu/path_tracer">path_tracer</a> causes the entire codegen to be rebuilt again. Not just the codegen, but the builder too.</p>



<a name="266969695"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20rebuilding%20codegen%20every%20time/near/266969695" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cargo.20rebuilding.20codegen.20every.20time.html#266969695">(Jan 05 2022 at 18:10)</a>:</h4>
<p>Maybe the problem is that <code>path_tracer </code>relies on <code>path_tracer_gpu</code> as a normal dep (for  cpu rendering), so cargo sees it changed so now it rebuilds path_tracer and therefore its <a href="http://build.rs">build.rs</a>? that would not explain why it is rebuilding the codegen</p>



<a name="266970488"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20rebuilding%20codegen%20every%20time/near/266970488" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cargo.20rebuilding.20codegen.20every.20time.html#266970488">(Jan 05 2022 at 18:17)</a>:</h4>
<p>cc <span class="user-mention" data-user-id="330900">@Ashley Hauck</span> rust-gpu uses something similar (i took inspiration from rust-gpu after all <span aria-label="stuck out tongue" class="emoji emoji-1f61b" role="img" title="stuck out tongue">:stuck_out_tongue:</span>), have you encountered this issue before?</p>



<a name="266971048"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20rebuilding%20codegen%20every%20time/near/266971048" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cargo.20rebuilding.20codegen.20every.20time.html#266971048">(Jan 05 2022 at 18:22)</a>:</h4>
<p><a href="#narrow/stream/122651-general/topic/.E2.9C.94.20cargo.20explain.20reason.20for.20running.20build.2Ers.20again.3F">https://rust-lang.zulipchat.com/#narrow/stream/122651-general/topic/.E2.9C.94.20cargo.20explain.20reason.20for.20running.20build.2Ers.20again.3F</a></p>



<a name="266971210"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20rebuilding%20codegen%20every%20time/near/266971210" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cargo.20rebuilding.20codegen.20every.20time.html#266971210">(Jan 05 2022 at 18:24)</a>:</h4>
<p>i JUST said in discord "i wish we had a way for cargo to tell me why its rebuilding"</p>



<a name="266971257"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20rebuilding%20codegen%20every%20time/near/266971257" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cargo.20rebuilding.20codegen.20every.20time.html#266971257">(Jan 05 2022 at 18:24)</a>:</h4>
<p>thanks <span aria-label="heart" class="emoji emoji-2764" role="img" title="heart">:heart:</span></p>



<a name="266976387"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20rebuilding%20codegen%20every%20time/near/266976387" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cargo.20rebuilding.20codegen.20every.20time.html#266976387">(Jan 05 2022 at 19:03)</a>:</h4>
<p>I wonder if it would be useful to have an command-line option that automatically applies the correct env var</p>



<a name="266976549"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20rebuilding%20codegen%20every%20time/near/266976549" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cargo.20rebuilding.20codegen.20every.20time.html#266976549">(Jan 05 2022 at 19:05)</a>:</h4>
<p>I think its fairly common to want this information</p>



<a name="266992318"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/cargo%20rebuilding%20codegen%20every%20time/near/266992318" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/cargo.20rebuilding.20codegen.20every.20time.html#266992318">(Jan 05 2022 at 21:17)</a>:</h4>
<p>I think just documenting it somewhere would be nice</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>