<html>
<head><meta charset="utf-8"><title>impl &lt;A, B: From&lt;A&gt;&gt; From&lt;Vec&lt;A&gt;&gt; for Vec&lt;B&gt; · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/impl.20.3CA.2C.20B.3A.20From.3CA.3E.3E.20From.3CVec.3CA.3E.3E.20for.20Vec.3CB.3E.html">impl &lt;A, B: From&lt;A&gt;&gt; From&lt;Vec&lt;A&gt;&gt; for Vec&lt;B&gt;</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="257231019"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/impl%20%3CA%2C%20B%3A%20From%3CA%3E%3E%20From%3CVec%3CA%3E%3E%20for%20Vec%3CB%3E/near/257231019" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Beknar <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/impl.20.3CA.2C.20B.3A.20From.3CA.3E.3E.20From.3CVec.3CA.3E.3E.20for.20Vec.3CB.3E.html#257231019">(Oct 12 2021 at 16:25)</a>:</h4>
<p>It will be useful to have impl &lt;A, B: From&lt;A&gt;&gt; From&lt;Vec&lt;A&gt;&gt; for Vec&lt;B&gt; in std<br>
WDYT?</p>



<a name="257231703"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/impl%20%3CA%2C%20B%3A%20From%3CA%3E%3E%20From%3CVec%3CA%3E%3E%20for%20Vec%3CB%3E/near/257231703" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tavian Barnes <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/impl.20.3CA.2C.20B.3A.20From.3CA.3E.3E.20From.3CVec.3CA.3E.3E.20for.20Vec.3CB.3E.html#257231703">(Oct 12 2021 at 16:29)</a>:</h4>
<p>I think it would violate coherence because there is already <code>From&lt;Vec&lt;T&gt;&gt; for Vec&lt;T&gt;</code></p>



<a name="257234844"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/impl%20%3CA%2C%20B%3A%20From%3CA%3E%3E%20From%3CVec%3CA%3E%3E%20for%20Vec%3CB%3E/near/257234844" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/impl.20.3CA.2C.20B.3A.20From.3CA.3E.3E.20From.3CVec.3CA.3E.3E.20for.20Vec.3CB.3E.html#257234844">(Oct 12 2021 at 16:49)</a>:</h4>
<p>yes, this comes up often that such proposals run afoul of coherence in the <code>A=B</code> identity case</p>



<a name="257234956"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/impl%20%3CA%2C%20B%3A%20From%3CA%3E%3E%20From%3CVec%3CA%3E%3E%20for%20Vec%3CB%3E/near/257234956" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Beknar <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/impl.20.3CA.2C.20B.3A.20From.3CA.3E.3E.20From.3CVec.3CA.3E.3E.20for.20Vec.3CB.3E.html#257234956">(Oct 12 2021 at 16:50)</a>:</h4>
<p><span class="user-mention silent" data-user-id="306504">Tavian Barnes</span> <a href="#narrow/stream/122651-general/topic/impl.20.3CA.2C.20B.3A.20From.3CA.3E.3E.20From.3CVec.3CA.3E.3E.20for.20Vec.3CB.3E/near/257231703">said</a>:</p>
<blockquote>
<p>I think it would violate coherence because there is already <code>From&lt;Vec&lt;T&gt;&gt; for Vec&lt;T&gt;</code></p>
</blockquote>
<p>Dont see that in docs</p>



<a name="257235059"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/impl%20%3CA%2C%20B%3A%20From%3CA%3E%3E%20From%3CVec%3CA%3E%3E%20for%20Vec%3CB%3E/near/257235059" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/impl.20.3CA.2C.20B.3A.20From.3CA.3E.3E.20From.3CVec.3CA.3E.3E.20for.20Vec.3CB.3E.html#257235059">(Oct 12 2021 at 16:51)</a>:</h4>
<p>it's <code>impl&lt;T&gt; From&lt;T&gt; for T</code>, where it could be <code>T = Vec&lt;U&gt;</code></p>



<a name="257235285"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/impl%20%3CA%2C%20B%3A%20From%3CA%3E%3E%20From%3CVec%3CA%3E%3E%20for%20Vec%3CB%3E/near/257235285" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/impl.20.3CA.2C.20B.3A.20From.3CA.3E.3E.20From.3CVec.3CA.3E.3E.20for.20Vec.3CB.3E.html#257235285">(Oct 12 2021 at 16:52)</a>:</h4>
<p>so any other <code>impl From</code> must avoid that identity case</p>



<a name="257236127"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/impl%20%3CA%2C%20B%3A%20From%3CA%3E%3E%20From%3CVec%3CA%3E%3E%20for%20Vec%3CB%3E/near/257236127" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/impl.20.3CA.2C.20B.3A.20From.3CA.3E.3E.20From.3CVec.3CA.3E.3E.20for.20Vec.3CB.3E.html#257236127">(Oct 12 2021 at 16:58)</a>:</h4>
<p>doesn't <code>vec.into_iter().map(From::from).collect()</code> do the job?</p>



<a name="257241459"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/impl%20%3CA%2C%20B%3A%20From%3CA%3E%3E%20From%3CVec%3CA%3E%3E%20for%20Vec%3CB%3E/near/257241459" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Beknar <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/impl.20.3CA.2C.20B.3A.20From.3CA.3E.3E.20From.3CVec.3CA.3E.3E.20for.20Vec.3CB.3E.html#257241459">(Oct 12 2021 at 17:32)</a>:</h4>
<p><span class="user-mention silent" data-user-id="330154">The 8472</span> <a href="#narrow/stream/122651-general/topic/impl.20.3CA.2C.20B.3A.20From.3CA.3E.3E.20From.3CVec.3CA.3E.3E.20for.20Vec.3CB.3E/near/257236127">said</a>:</p>
<blockquote>
<p>doesn't <code>vec.into_iter().map(From::from).collect()</code> do the job?</p>
</blockquote>
<p>It does, but could be shorter and be optimised with_capacity</p>
<p><span class="user-mention silent" data-user-id="138448">cuviper</span> <a href="#narrow/stream/122651-general/topic/impl.20.3CA.2C.20B.3A.20From.3CA.3E.3E.20From.3CVec.3CA.3E.3E.20for.20Vec.3CB.3E/near/257235059">said</a>:</p>
<blockquote>
<p>it's <code>impl&lt;T&gt; From&lt;T&gt; for T</code>, where it could be <code>T = Vec&lt;U&gt;</code></p>
</blockquote>
<p>Thanks. No I get it</p>



<a name="257242608"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/impl%20%3CA%2C%20B%3A%20From%3CA%3E%3E%20From%3CVec%3CA%3E%3E%20for%20Vec%3CB%3E/near/257242608" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/impl.20.3CA.2C.20B.3A.20From.3CA.3E.3E.20From.3CVec.3CA.3E.3E.20for.20Vec.3CB.3E.html#257242608">(Oct 12 2021 at 17:40)</a>:</h4>
<blockquote>
<p>be optimised with_capacity </p>
</blockquote>
<p>It already does that.</p>



<a name="257244852"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/impl%20%3CA%2C%20B%3A%20From%3CA%3E%3E%20From%3CVec%3CA%3E%3E%20for%20Vec%3CB%3E/near/257244852" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Beknar <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/impl.20.3CA.2C.20B.3A.20From.3CA.3E.3E.20From.3CVec.3CA.3E.3E.20for.20Vec.3CB.3E.html#257244852">(Oct 12 2021 at 17:55)</a>:</h4>
<p><span class="user-mention silent" data-user-id="330154">The 8472</span> <a href="#narrow/stream/122651-general/topic/impl.20.3CA.2C.20B.3A.20From.3CA.3E.3E.20From.3CVec.3CA.3E.3E.20for.20Vec.3CB.3E/near/257242608">said</a>:</p>
<blockquote>
<blockquote>
<p>be optimised with_capacity </p>
</blockquote>
<p>It already does that.</p>
</blockquote>
<p>I see it returns iterator that implements ExactSizeIterator in into_iterator. but FromIterator collect delegates to <a href="https://stdrs.dev/nightly/x86_64-unknown-linux-gnu/src/alloc/vec/spec_from_iter.rs.html#58">https://stdrs.dev/nightly/x86_64-unknown-linux-gnu/src/alloc/vec/spec_from_iter.rs.html#58</a>.<br>
Where I am not sure if size optimisation is applied</p>



<a name="257245776"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/impl%20%3CA%2C%20B%3A%20From%3CA%3E%3E%20From%3CVec%3CA%3E%3E%20for%20Vec%3CB%3E/near/257245776" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/impl.20.3CA.2C.20B.3A.20From.3CA.3E.3E.20From.3CVec.3CA.3E.3E.20for.20Vec.3CB.3E.html#257245776">(Oct 12 2021 at 18:00)</a>:</h4>
<p>all specialized implementations in that graph either use the lower bound size hint or don't need to allocate at all since they reuse the input allocation</p>



<a name="257253179"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/impl%20%3CA%2C%20B%3A%20From%3CA%3E%3E%20From%3CVec%3CA%3E%3E%20for%20Vec%3CB%3E/near/257253179" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/impl.20.3CA.2C.20B.3A.20From.3CA.3E.3E.20From.3CVec.3CA.3E.3E.20for.20Vec.3CB.3E.html#257253179">(Oct 12 2021 at 18:51)</a>:</h4>
<p>If the layout matches then the input allocation is used (SpecInPlaceCollect), otherwise it'll use the upper bound size hint, since the iterator is TrustedLen.</p>



<a name="257343100"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/impl%20%3CA%2C%20B%3A%20From%3CA%3E%3E%20From%3CVec%3CA%3E%3E%20for%20Vec%3CB%3E/near/257343100" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Beknar <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/impl.20.3CA.2C.20B.3A.20From.3CA.3E.3E.20From.3CVec.3CA.3E.3E.20for.20Vec.3CB.3E.html#257343100">(Oct 13 2021 at 10:30)</a>:</h4>
<p><span class="user-mention silent" data-user-id="330154">The 8472</span> <a href="#narrow/stream/122651-general/topic/impl.20.3CA.2C.20B.3A.20From.3CA.3E.3E.20From.3CVec.3CA.3E.3E.20for.20Vec.3CB.3E/near/257245776">said</a>:</p>
<blockquote>
<p>all specialized implementations in that graph either use the lower bound size hint or don't need to allocate at all since they reuse the input allocation</p>
</blockquote>
<p><span class="user-mention silent" data-user-id="303710">Gary Guo</span> <a href="#narrow/stream/122651-general/topic/impl.20.3CA.2C.20B.3A.20From.3CA.3E.3E.20From.3CVec.3CA.3E.3E.20for.20Vec.3CB.3E/near/257253179">said</a>:</p>
<blockquote>
<p>If the layout matches then the input allocation is used (SpecInPlaceCollect), otherwise it'll use the upper bound size hint, since the iterator is TrustedLen.</p>
</blockquote>
<p>Thanks. makes sense. I will read up on it</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>