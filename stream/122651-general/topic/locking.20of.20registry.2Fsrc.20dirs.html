<html>
<head><meta charset="utf-8"><title>locking of registry/src dirs · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/locking.20of.20registry.2Fsrc.20dirs.html">locking of registry/src dirs</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="275786910"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/locking%20of%20registry/src%20dirs/near/275786910" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Conrad Ludgate <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/locking.20of.20registry.2Fsrc.20dirs.html#275786910">(Mar 18 2022 at 10:58)</a>:</h4>
<p>So I've been bitten by this a few times and now someone at work has run into this same problem.</p>
<p>Essentially, VSCode/RA makes it very easy to accidentally modify the downloaded crate src code, when clicking through to see the src of a method from a crate, that is used when compiling a new project. </p>
<p>A quick fix I can see would be adding a step at the end of this <a href="https://github.com/rust-lang/cargo/blob/109bfbd055325ef87a6e7f63d67da7e838f8300b/src/cargo/sources/registry/mod.rs#L587">unpack_package</a> function to set recursively set the dir to read-only, but I might be missing something obvious that this breaks</p>



<a name="275787419"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/locking%20of%20registry/src%20dirs/near/275787419" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Conrad Ludgate <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/locking.20of.20registry.2Fsrc.20dirs.html#275787419">(Mar 18 2022 at 11:03)</a>:</h4>
<p>For a demo of what I mean:</p>
<ol>
<li>Open an existing project in VSCode which uses an external crate</li>
<li>Use the click-through feature of VSCode/RA to view the source inside that crate</li>
<li>Change some code inside that editor window, save and close.</li>
<li>Start a new project, add that crate/version to your Cargo.toml</li>
<li>Unexpected behaviour</li>
</ol>



<a name="275787511"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/locking%20of%20registry/src%20dirs/near/275787511" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Conrad Ludgate <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/locking.20of.20registry.2Fsrc.20dirs.html#275787511">(Mar 18 2022 at 11:04)</a>:</h4>
<p>A more complex solution would be storing some integrity hash and checking it, but that seems like it'll touch a lot more code</p>



<a name="275790182"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/locking%20of%20registry/src%20dirs/near/275790182" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Denton <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/locking.20of.20registry.2Fsrc.20dirs.html#275790182">(Mar 18 2022 at 11:33)</a>:</h4>
<p>Or VSCode/RA could open files in a kind of readonly view if they come from outside the current project. However, I'm not sure how feasible this is.</p>



<a name="275790684"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/locking%20of%20registry/src%20dirs/near/275790684" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Conrad Ludgate <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/locking.20of.20registry.2Fsrc.20dirs.html#275790684">(Mar 18 2022 at 11:39)</a>:</h4>
<p>As far as I saw when doing some quick research was that VSCode did not support read-only mode, but maybe that was outdated info</p>



<a name="275791338"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/locking%20of%20registry/src%20dirs/near/275791338" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Denton <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/locking.20of.20registry.2Fsrc.20dirs.html#275791338">(Mar 18 2022 at 11:47)</a>:</h4>
<p>Oh, that's a shame.</p>



<a name="275791486"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/locking%20of%20registry/src%20dirs/near/275791486" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Conrad Ludgate <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/locking.20of.20registry.2Fsrc.20dirs.html#275791486">(Mar 18 2022 at 11:49)</a>:</h4>
<p>Reference: <a href="https://github.com/microsoft/vscode/issues/4873">https://github.com/microsoft/vscode/issues/4873</a><br>
It seems bits of the editor have partial support (eg monaco supports <code>readOnly</code>). Depending on how RA click through works, it could make use of <a href="https://code.visualstudio.com/api/references/vscode-api#CustomReadonlyEditorProvider">https://code.visualstudio.com/api/references/vscode-api#CustomReadonlyEditorProvider</a> to open external references in this mode</p>



<a name="275791515"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/locking%20of%20registry/src%20dirs/near/275791515" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Conrad Ludgate <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/locking.20of.20registry.2Fsrc.20dirs.html#275791515">(Mar 18 2022 at 11:49)</a>:</h4>
<p>So I guess it's not off the table completely, but it's not exactly just a toggle either</p>



<a name="275796133"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/locking%20of%20registry/src%20dirs/near/275796133" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/locking.20of.20registry.2Fsrc.20dirs.html#275796133">(Mar 18 2022 at 12:39)</a>:</h4>
<p><a href="https://github.com/rust-analyzer/rust-analyzer/issues/5847">rust-analyzer#5847</a></p>



<a name="275808150"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/locking%20of%20registry/src%20dirs/near/275808150" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Conrad Ludgate <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/locking.20of.20registry.2Fsrc.20dirs.html#275808150">(Mar 18 2022 at 14:15)</a>:</h4>
<p>Ultimately I would still like this if it wasn't a specific fix for VSCode, but in general, hence my read-only folder suggestion. But I'll try take a peek into RA vscode extension and see if I can fix it</p>



<a name="275811724"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/locking%20of%20registry/src%20dirs/near/275811724" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/locking.20of.20registry.2Fsrc.20dirs.html#275811724">(Mar 18 2022 at 14:43)</a>:</h4>
<p>I could have sworn we had a Cargo issue about making it read only... found it <a href="https://github.com/rust-lang/cargo/issues/9455">https://github.com/rust-lang/cargo/issues/9455</a></p>



<a name="275812005"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/locking%20of%20registry/src%20dirs/near/275812005" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/locking.20of.20registry.2Fsrc.20dirs.html#275812005">(Mar 18 2022 at 14:45)</a>:</h4>
<p>I think a PR would be welcomed!</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>