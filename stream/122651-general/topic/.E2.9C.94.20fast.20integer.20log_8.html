<html>
<head><meta charset="utf-8"><title>✔ fast integer log_8 · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20fast.20integer.20log_8.html">✔ fast integer log_8</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="272017717"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20fast%20integer%20log_8/near/272017717" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20fast.20integer.20log_8.html#272017717">(Feb 15 2022 at 18:31)</a>:</h4>
<p>yeah my bad, i need ceil(log_8(x))</p>



<a name="272018730"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20fast%20integer%20log_8/near/272018730" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> LegionMammal978 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20fast.20integer.20log_8.html#272018730">(Feb 15 2022 at 18:38)</a>:</h4>
<p>Do you mean <code>ceil(log8(x))</code> or <code>floor(log8(x)) + 1</code>? The two differ when <code>x</code> is a power of 8, and the latter is the usual expression for the number of digits in a value.</p>



<a name="272018834"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20fast%20integer%20log_8/near/272018834" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20fast.20integer.20log_8.html#272018834">(Feb 15 2022 at 18:39)</a>:</h4>
<p>If <code>x</code> does not yield a whole number it should be the "rounded up" result, i.e. <code>16</code> =&gt; <code>2</code> and <code>512</code> =&gt; <code>3</code></p>



<a name="272019007"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20fast%20integer%20log_8/near/272019007" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20fast.20integer.20log_8.html#272019007">(Feb 15 2022 at 18:40)</a>:</h4>
<p>Although maybe <code>floor(log8(x)) + 1</code> works, because i need <code>0</code> =&gt; <code>1</code></p>



<a name="272019069"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20fast%20integer%20log_8/near/272019069" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20fast.20integer.20log_8.html#272019069">(Feb 15 2022 at 18:41)</a>:</h4>
<p>But then <code>512</code> yields <code>4</code> :/</p>



<a name="272019103"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20fast%20integer%20log_8/near/272019103" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20fast.20integer.20log_8.html#272019103">(Feb 15 2022 at 18:41)</a>:</h4>
<p>ceil(log8(x)): <a href="https://play.rust-lang.org/?version=stable&amp;mode=release&amp;edition=2021&amp;gist=f56dff7ed78a5b0c4972f072ec0e79b9">https://play.rust-lang.org/?version=stable&amp;mode=release&amp;edition=2021&amp;gist=f56dff7ed78a5b0c4972f072ec0e79b9</a></p>



<a name="272019230"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20fast%20integer%20log_8/near/272019230" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20fast.20integer.20log_8.html#272019230">(Feb 15 2022 at 18:42)</a>:</h4>
<p>if you need 0 -&gt; 1, add a special case</p>



<a name="272019242"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20fast%20integer%20log_8/near/272019242" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20fast.20integer.20log_8.html#272019242">(Feb 15 2022 at 18:42)</a>:</h4>
<p>Yeah</p>



<a name="272019283"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20fast%20integer%20log_8/near/272019283" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20fast.20integer.20log_8.html#272019283">(Feb 15 2022 at 18:42)</a>:</h4>
<p>Yup that seems to work, thanks :)</p>



<a name="272019288"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20fast%20integer%20log_8/near/272019288" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20fast.20integer.20log_8.html#272019288">(Feb 15 2022 at 18:43)</a>:</h4>
<p><span class="user-mention silent" data-user-id="276242">Riccardo D'Ambrosio</span> has marked this topic as resolved.</p>



<a name="272021243"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20fast%20integer%20log_8/near/272021243" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hans Kratz <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20fast.20integer.20log_8.html#272021243">(Feb 15 2022 at 18:57)</a>:</h4>
<p>Or without the comparison:<br>
<code>(1u64.leading_bits() - (v * 8 - 1).leading_bits()) / 3</code></p>
<p><a href="https://play.rust-lang.org/?version=stable&amp;mode=release&amp;edition=2021&amp;gist=23356d99b777d2a5505e635cd2a20058">https://play.rust-lang.org/?version=stable&amp;mode=release&amp;edition=2021&amp;gist=23356d99b777d2a5505e635cd2a20058</a></p>



<a name="272021998"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20fast%20integer%20log_8/near/272021998" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20fast.20integer.20log_8.html#272021998">(Feb 15 2022 at 19:02)</a>:</h4>
<p>Oh awesome</p>



<a name="272033473"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20fast%20integer%20log_8/near/272033473" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20fast.20integer.20log_8.html#272033473">(Feb 15 2022 at 20:29)</a>:</h4>
<p>Minor thing to add, <span class="user-mention" data-user-id="276242">@Riccardo D'Ambrosio</span>: if you do need a special case for <code>0</code>, then you can go via &lt;<a href="https://doc.rust-lang.org/std/num/struct.NonZeroU64.html#method.leading_zeros">https://doc.rust-lang.org/std/num/struct.NonZeroU64.html#method.leading_zeros</a>&gt; to get slightly better codegen on the default x64 target.</p>



<a name="272033562"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20fast%20integer%20log_8/near/272033562" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20fast.20integer.20log_8.html#272033562">(Feb 15 2022 at 20:30)</a>:</h4>
<p>oh cool</p>



<a name="272034259"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/%E2%9C%94%20fast%20integer%20log_8/near/272034259" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/.E2.9C.94.20fast.20integer.20log_8.html#272034259">(Feb 15 2022 at 20:36)</a>:</h4>
<p>(if you want to get <code>64</code> for <code>0.leading_zeros()</code>, then the codegen is better when you do it on <code>u64</code> directly, but if you want something else when calling it on <code>0</code>, or if it's not possible for it to be <code>0</code>, then <code>NonZeroU64</code> will be a slight improvement.)</p>
<p>One other thing: you might want to consider what you want this to do on overflow in that multiplication.  It's probably not worth making it UB, but you could consider <code>v.checked_mul(8).expect("won't actually get this big")</code> so that LLVM automatically knows the overflow is unlikely.  (Like it does for all conditions that lead to a panic.)</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>