<html>
<head><meta charset="utf-8"><title>Constant from generic $ty · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Constant.20from.20generic.20.24ty.html">Constant from generic $ty</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="254389482"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Constant%20from%20generic%20%24ty/near/254389482" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brandon Falk <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Constant.20from.20generic.20.24ty.html#254389482">(Sep 22 2021 at 15:47)</a>:</h4>
<p>Is there a way to get the constant generic for a given type, assuming you pass a type to a macro. Eg, macro!(Foo&lt;32&gt;), and do something like <code>$foo::N</code> in the macro, if <code>const N: usize</code> for the generic</p>



<a name="254397111"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Constant%20from%20generic%20%24ty/near/254397111" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Giacomo Stevanato <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Constant.20from.20generic.20.24ty.html#254397111">(Sep 22 2021 at 16:34)</a>:</h4>
<p>Macros only work at the token level, even when you pass a type (e.g. match a <code>$foo:ty</code>) it only try to match the syntax of a type but it won't know if that type exists or not, and if it does what fields/constants/ecc ecc it has.</p>



<a name="254403720"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Constant%20from%20generic%20%24ty/near/254403720" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simon Sapin <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Constant.20from.20generic.20.24ty.html#254403720">(Sep 22 2021 at 17:14)</a>:</h4>
<p>Is it a <code>macro_rules</code> macro? Try <code>$foo: path</code> instead of <code>$foo: ty</code>, then <code>$foo::N</code> should expand to a new path like <code>Foo::&lt;32&gt;::N</code> in your example</p>



<a name="254403760"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Constant%20from%20generic%20%24ty/near/254403760" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simon Sapin <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Constant.20from.20generic.20.24ty.html#254403760">(Sep 22 2021 at 17:14)</a>:</h4>
<p>… I think, hopefully</p>



<a name="254403810"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Constant%20from%20generic%20%24ty/near/254403810" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Constant.20from.20generic.20.24ty.html#254403810">(Sep 22 2021 at 17:14)</a>:</h4>
<p>I think <code>&lt;$foo&gt;::N</code> would also work.</p>



<a name="254523044"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Constant%20from%20generic%20%24ty/near/254523044" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Constant.20from.20generic.20.24ty.html#254523044">(Sep 23 2021 at 12:04)</a>:</h4>
<p><span class="user-mention silent" data-user-id="219747">Simon Sapin</span> <a href="#narrow/stream/122651-general/topic/Constant.20from.20generic.20.24ty/near/254403760">said</a>:</p>
<blockquote>
<p>… I think, hopefully</p>
</blockquote>
<p>That won't work, AFAIK, since the path grammar does not have a <code>Path &lt;-&gt; Path :: AnotherSegment</code> "rule", and <code>macro_rules!</code> "high-level" captures (such as <code>:ty</code> and <code>:path</code> (and <code>:expr</code>, <em>etc.</em>)) make it so the capture is seen as the corresponding non-terminals (So a <code>$foo:path</code> which captures <code>Foo&lt;32&gt;</code> does not expand to a path segment but to a path).</p>
<p>So, while keeping a higher-order metavariable capture, the only solution is to find a way in the grammar which operates of that full node, such as <code>&lt; $_:ty &gt; :: $_:ident</code>, leading to <span class="user-mention" data-user-id="133247">@bjorn3</span>'s solution here.</p>
<p>Another option is to avoid using high-level captures, and stick to <code>$($_:tt)*</code>, which you can just re-emit <em>verbatim</em>.</p>
<p>A final option is to "unwrap" that invisible group thanks to a proc-macro, or through a <a href="https://docs.rs/defile">proc-macro helper</a></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>