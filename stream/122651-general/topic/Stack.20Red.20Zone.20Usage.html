<html>
<head><meta charset="utf-8"><title>Stack Red Zone Usage · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Stack.20Red.20Zone.20Usage.html">Stack Red Zone Usage</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="254289486"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Stack%20Red%20Zone%20Usage/near/254289486" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Stack.20Red.20Zone.20Usage.html#254289486">(Sep 21 2021 at 22:44)</a>:</h4>
<p>Inline assembly allows you to declare that LLVM must not use the stack red zone during an inline assembly block, but is there some sort of setting, such as in a target's description, that LLVM must <em>never ever</em> use the stack red zone?</p>
<p>Particularly, this is of issue for bare metal systems where interrupts are involved. If the interrupt handler pushes anything to the stack while LLVM is working beyond the stack pointer then that could get trashed during the interrupt handling. However, you don't ever know when an interrupt will happen, so essentially LLVM must be told to never use the red zone somehow.</p>



<a name="254290221"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Stack%20Red%20Zone%20Usage/near/254290221" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Stack.20Red.20Zone.20Usage.html#254290221">(Sep 21 2021 at 22:53)</a>:</h4>
<p>Doesn't rustc have an equivalent of the -fno-red-zone gcc option?</p>



<a name="254290863"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Stack%20Red%20Zone%20Usage/near/254290863" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Stack.20Red.20Zone.20Usage.html#254290863">(Sep 21 2021 at 23:01)</a>:</h4>
<p>Ah ha, it wasn't in <a href="https://doc.rust-lang.org/cargo/?search=red%20zone">cargo</a>, but it's in <a href="https://doc.rust-lang.org/rustc/codegen-options/index.html?highlight=red%20zone#no-redzone">rustc</a>. Excellent.</p>



<a name="254339106"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Stack%20Red%20Zone%20Usage/near/254339106" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Stack.20Red.20Zone.20Usage.html#254339106">(Sep 22 2021 at 09:24)</a>:</h4>
<p>Target specs also have an option to disable the redzone.</p>



<a name="254362358"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Stack%20Red%20Zone%20Usage/near/254362358" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Stack.20Red.20Zone.20Usage.html#254362358">(Sep 22 2021 at 12:59)</a>:</h4>
<p>yeah, it seems they don't by default</p>



<a name="254366004"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Stack%20Red%20Zone%20Usage/near/254366004" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amanieu <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Stack.20Red.20Zone.20Usage.html#254366004">(Sep 22 2021 at 13:24)</a>:</h4>
<p>To be fair, the only targets that use a red zone are x86_64 and Apple's ARM64 ABI.</p>



<a name="254373260"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Stack%20Red%20Zone%20Usage/near/254373260" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Stack.20Red.20Zone.20Usage.html#254373260">(Sep 22 2021 at 14:07)</a>:</h4>
<p>ah, so ARM32 won't use a red zone even without that flag set?</p>



<a name="254376050"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Stack%20Red%20Zone%20Usage/near/254376050" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Stack.20Red.20Zone.20Usage.html#254376050">(Sep 22 2021 at 14:24)</a>:</h4>
<p>windows on arm does have one. <a href="https://devblogs.microsoft.com/oldnewthing/20190111-00/?p=100685">https://devblogs.microsoft.com/oldnewthing/20190111-00/?p=100685</a></p>



<a name="254392321"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Stack%20Red%20Zone%20Usage/near/254392321" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Stack.20Red.20Zone.20Usage.html#254392321">(Sep 22 2021 at 16:04)</a>:</h4>
<p>hm, well I'm most worried about the bare metal ARM32 situation</p>



<a name="254437636"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Stack%20Red%20Zone%20Usage/near/254437636" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Stack.20Red.20Zone.20Usage.html#254437636">(Sep 22 2021 at 20:54)</a>:</h4>
<p>FWIW, the bare-metal x86_64 target won't use the red zone by default, and you'd have to explicitly enable it.</p>



<a name="254462805"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Stack%20Red%20Zone%20Usage/near/254462805" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Stack.20Red.20Zone.20Usage.html#254462805">(Sep 23 2021 at 00:48)</a>:</h4>
<p>powerpc64le also has a red-zone</p>



<a name="254472499"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Stack%20Red%20Zone%20Usage/near/254472499" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Stack.20Red.20Zone.20Usage.html#254472499">(Sep 23 2021 at 02:52)</a>:</h4>
<p>I shall assume that llvm isn't using the red zone on me then, but i will keep this in mind for when i eventually submit a dedicated GBA target for rustc</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>