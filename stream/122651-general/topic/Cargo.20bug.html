<html>
<head><meta charset="utf-8"><title>Cargo bug · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Cargo.20bug.html">Cargo bug</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="260531956"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Cargo%20bug/near/260531956" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Asaf Fisher <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Cargo.20bug.html#260531956">(Nov 06 2021 at 19:35)</a>:</h4>
<p>Hello! I think I found a bug in cargo where when you specify a dep with <code>defp = {git = "http://example.com", default-feature = false}</code><br>
The <code>default-feature = false</code> will not work</p>
<p>Can anyone confirm? And if so, can I open a PR to fix this bug?</p>



<a name="260532189"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Cargo%20bug/near/260532189" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Cargo.20bug.html#260532189">(Nov 06 2021 at 19:40)</a>:</h4>
<p>Do you mean <code>default-features</code>?</p>



<a name="260533554"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Cargo%20bug/near/260533554" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Asaf Fisher <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Cargo.20bug.html#260533554">(Nov 06 2021 at 20:08)</a>:</h4>
<p><span class="user-mention silent" data-user-id="203546">Laurențiu</span> <a href="#narrow/stream/122651-general/topic/Cargo.20bug/near/260532189">said</a>:</p>
<blockquote>
<p>Do you mean <code>default-features</code>?</p>
</blockquote>
<p>Yes</p>



<a name="260533582"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Cargo%20bug/near/260533582" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Cargo.20bug.html#260533582">(Nov 06 2021 at 20:08)</a>:</h4>
<p>It worked last time I tried it IIRC. Are you sure you don't have another dependency which enables those features?</p>



<a name="260533769"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Cargo%20bug/near/260533769" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Asaf Fisher <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Cargo.20bug.html#260533769">(Nov 06 2021 at 20:12)</a>:</h4>
<p><a href="https://github.com/AsafFisher/byteorder">https://github.com/AsafFisher/byteorder</a><br>
Try using this as a dep and set default-features to false and check the feature tree</p>



<a name="260533797"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Cargo%20bug/near/260533797" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Asaf Fisher <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Cargo.20bug.html#260533797">(Nov 06 2021 at 20:13)</a>:</h4>
<p>I still see the std feature added from this dep</p>



<a name="260533916"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Cargo%20bug/near/260533916" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Asaf Fisher <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Cargo.20bug.html#260533916">(Nov 06 2021 at 20:16)</a>:</h4>
<p>When I type <code>cargo tree -e features</code> I get std in the <code>core2</code> package.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="err">├──</span><span class="w"> </span><span class="n">byteorder</span><span class="w"> </span><span class="n">v1</span><span class="p">.</span><span class="mf">4.3</span><span class="w"> </span><span class="p">(</span><span class="n">https</span>:<span class="c1">//github.com/AsafFisher/byteorder#d7d443a8)</span>
<span class="err">│</span><span class="w">   </span><span class="err">└──</span><span class="w"> </span><span class="n">core2</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="s">"default"</span><span class="w"></span>
<span class="err">│</span><span class="w">       </span><span class="err">├──</span><span class="w"> </span><span class="n">core2</span><span class="w"> </span><span class="n">v0</span><span class="p">.</span><span class="mf">3.2</span><span class="w"></span>
<span class="err">│</span><span class="w">       </span><span class="err">│</span><span class="w">   </span><span class="err">└──</span><span class="w"> </span><span class="n">memchr</span><span class="w"> </span><span class="n">v2</span><span class="p">.</span><span class="mf">4.1</span><span class="w"></span>
<span class="err">│</span><span class="w">       </span><span class="err">└──</span><span class="w"> </span><span class="n">core2</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="s">"std"</span><span class="w"></span>
<span class="err">│</span><span class="w">           </span><span class="err">├──</span><span class="w"> </span><span class="n">core2</span><span class="w"> </span><span class="n">v0</span><span class="p">.</span><span class="mf">3.2</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"></span>
<span class="err">│</span><span class="w">           </span><span class="err">└──</span><span class="w"> </span><span class="n">core2</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="s">"alloc"</span><span class="w"></span>
<span class="err">│</span><span class="w">               </span><span class="err">└──</span><span class="w"> </span><span class="n">core2</span><span class="w"> </span><span class="n">v0</span><span class="p">.</span><span class="mf">3.2</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<p>This is weird because this is the toml of <code>byteorder</code>:</p>
<div class="codehilite" data-code-language="TOML"><pre><span></span><code><span class="k">[package]</span>
<span class="n">name</span> <span class="o">=</span> <span class="s">"byteorder"</span>
<span class="n">version</span> <span class="o">=</span> <span class="s">"1.4.3"</span>  <span class="c1">#:version</span>
<span class="n">authors</span> <span class="o">=</span> <span class="p">[</span><span class="s">"Andrew Gallant &lt;jamslam@gmail.com&gt;"</span><span class="p">]</span>
<span class="n">description</span> <span class="o">=</span> <span class="s">"Library for reading/writing numbers in big-endian and little-endian."</span>
<span class="n">documentation</span> <span class="o">=</span> <span class="s">"https://docs.rs/byteorder"</span>
<span class="n">homepage</span> <span class="o">=</span> <span class="s">"https://github.com/BurntSushi/byteorder"</span>
<span class="n">repository</span> <span class="o">=</span> <span class="s">"https://github.com/BurntSushi/byteorder"</span>
<span class="n">readme</span> <span class="o">=</span> <span class="s">"README.md"</span>
<span class="n">categories</span> <span class="o">=</span> <span class="p">[</span><span class="s">"encoding"</span><span class="p">,</span> <span class="s">"parsing"</span><span class="p">,</span> <span class="s">"no-std"</span><span class="p">]</span>
<span class="n">keywords</span> <span class="o">=</span> <span class="p">[</span><span class="s">"byte"</span><span class="p">,</span> <span class="s">"endian"</span><span class="p">,</span> <span class="s">"big-endian"</span><span class="p">,</span> <span class="s">"little-endian"</span><span class="p">,</span> <span class="s">"binary"</span><span class="p">]</span>
<span class="n">license</span> <span class="o">=</span> <span class="s">"Unlicense OR MIT"</span>
<span class="n">exclude</span> <span class="o">=</span> <span class="p">[</span><span class="s">"/ci/*"</span><span class="p">]</span>
<span class="n">edition</span> <span class="o">=</span> <span class="s">"2018"</span>

<span class="k">[lib]</span>
<span class="n">name</span> <span class="o">=</span> <span class="s">"byteorder"</span>
<span class="n">bench</span> <span class="o">=</span> <span class="kc">false</span>

<span class="p">[</span><span class="n">dependencies</span><span class="p">.</span><span class="n">core2</span><span class="p">]</span> <span class="c1"># &lt;=============================</span>
<span class="n">version</span> <span class="o">=</span> <span class="s">"0.3.2"</span>
<span class="n">default-features</span> <span class="o">=</span> <span class="kc">false</span>

<span class="k">[dev-dependencies]</span>
<span class="n">quickcheck</span> <span class="o">=</span> <span class="p">{</span> <span class="n">version</span> <span class="o">=</span> <span class="s">"0.9.2"</span><span class="p">,</span> <span class="n">default-features</span> <span class="o">=</span> <span class="n">false</span> <span class="p">}</span>
<span class="n">rand</span> <span class="o">=</span> <span class="s">"0.7"</span>

<span class="k">[features]</span>
<span class="n">default</span> <span class="o">=</span> <span class="p">[</span><span class="s">"std"</span><span class="p">]</span>
<span class="n">std</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># This feature is no longer used and is DEPRECATED. This crate now</span>
<span class="c1"># automatically enables i128 support for Rust compilers that support it. The</span>
<span class="c1"># feature will be removed if and when a new major version is released.</span>
<span class="n">i128</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">[profile.bench]</span>
<span class="n">opt-level</span> <span class="o">=</span> <span class="mi">3</span>
</code></pre></div>



<a name="260534272"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Cargo%20bug/near/260534272" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Denton <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Cargo.20bug.html#260534272">(Nov 06 2021 at 20:24)</a>:</h4>
<p>Is there anything else using the crate with the std feature? I tried it by creating a default "hello world" project (with <code>cargo new</code>) and adding the dependency. I don't have that issue. My cargo.toml:</p>
<div class="codehilite" data-code-language="TOML"><pre><span></span><code><span class="k">[dependencies.byteorder]</span>
<span class="n">git</span> <span class="o">=</span> <span class="s">"https://github.com/AsafFisher/byteorder.git"</span>
<span class="n">default_features</span> <span class="o">=</span> <span class="kc">false</span>
</code></pre></div>
<p><code>cargo tree -e features</code></p>
<div class="codehilite" data-code-language="plain"><pre><span></span><code>temp v0.1.0 (Z:\test\temp)
└── byteorder v1.4.3 (https://github.com/AsafFisher/byteorder.git#683d3114)
    └── core2 v0.3.2
        └── memchr v2.4.1
</code></pre></div>



<a name="260534461"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Cargo%20bug/near/260534461" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Asaf Fisher <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Cargo.20bug.html#260534461">(Nov 06 2021 at 20:28)</a>:</h4>
<p>That is weird ….<br>
Here is my toml test:</p>
<div class="codehilite" data-code-language="TOML"><pre><span></span><code><span class="n">cargo-features</span> <span class="o">=</span> <span class="p">[</span><span class="s">"edition2021"</span><span class="p">]</span>
<span class="k">[package]</span>
<span class="n">name</span> <span class="o">=</span> <span class="s">"coregdb"</span>
<span class="n">version</span> <span class="o">=</span> <span class="s">"0.1.0"</span>
<span class="n">edition</span> <span class="o">=</span> <span class="s">"2021"</span>

<span class="k">[lib]</span>
<span class="n">name</span> <span class="o">=</span> <span class="s">"libcore"</span>
<span class="n">path</span> <span class="o">=</span> <span class="s">"src/lib.rs"</span>

<span class="k">[dependencies]</span>
<span class="n">common</span> <span class="o">=</span> <span class="p">{</span><span class="n">version</span> <span class="o">=</span> <span class="s">"0.1.0"</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s">"../common"</span><span class="p">}</span>

<span class="c1">#hal-stdgdb = {version = "0.1.0",path="../hal/stdgdb"}</span>
<span class="n">byteorder</span> <span class="o">=</span> <span class="p">{</span><span class="n">git</span> <span class="o">=</span> <span class="s">"https://github.com/AsafFisher/byteorder"</span><span class="p">,</span> <span class="n">default-features</span> <span class="o">=</span> <span class="n">false</span><span class="p">}</span>
<span class="n">num-traits</span> <span class="o">=</span> <span class="p">{</span><span class="n">version</span><span class="o">=</span><span class="s">"0.2"</span><span class="p">,</span> <span class="n">default-features</span> <span class="o">=</span> <span class="n">false</span><span class="p">}</span>
<span class="n">num-derive</span> <span class="o">=</span> <span class="p">{</span><span class="n">version</span><span class="o">=</span><span class="s">"0.3"</span><span class="p">,</span> <span class="n">default-features</span> <span class="o">=</span> <span class="n">false</span><span class="p">}</span>
<span class="n">libc</span> <span class="o">=</span> <span class="p">{</span><span class="n">version</span><span class="o">=</span><span class="s">"0.2.103"</span><span class="p">,</span> <span class="n">default-features</span> <span class="o">=</span> <span class="n">false</span><span class="p">}</span>
<span class="n">serde</span> <span class="o">=</span> <span class="p">{</span><span class="n">version</span><span class="o">=</span><span class="s">"1.0.130"</span><span class="p">,</span> <span class="n">default-features</span> <span class="o">=</span> <span class="n">false</span><span class="p">,</span> <span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="s">"derive"</span><span class="p">]}</span>
<span class="n">num</span> <span class="o">=</span> <span class="p">{</span><span class="n">version</span><span class="o">=</span><span class="s">"0.4.0"</span><span class="p">,</span> <span class="n">default-features</span> <span class="o">=</span> <span class="n">false</span><span class="p">}</span>
<span class="n">anyhow</span> <span class="o">=</span> <span class="p">{</span><span class="n">version</span><span class="o">=</span><span class="s">"1.0.44"</span><span class="p">,</span> <span class="n">default-features</span><span class="o">=</span><span class="n">false</span><span class="p">}</span>
<span class="n">base64</span> <span class="o">=</span> <span class="p">{</span><span class="n">version</span><span class="o">=</span><span class="s">"0.13.0"</span><span class="p">,</span> <span class="n">default-features</span><span class="o">=</span><span class="n">false</span><span class="p">,</span> <span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="s">"alloc"</span><span class="p">]}</span>
<span class="n">thiserror</span> <span class="o">=</span> <span class="s">"1.0.30"</span>

<span class="n">serde-json-core</span> <span class="o">=</span> <span class="s">"0.4.0"</span>
<span class="n">static-alloc</span> <span class="o">=</span> <span class="s">"0.2.3"</span>
</code></pre></div>



<a name="260534476"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Cargo%20bug/near/260534476" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Asaf Fisher <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Cargo.20bug.html#260534476">(Nov 06 2021 at 20:29)</a>:</h4>
<p>When I use the tree I see std on byteorder</p>



<a name="260534784"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Cargo%20bug/near/260534784" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Denton <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Cargo.20bug.html#260534784">(Nov 06 2021 at 20:35)</a>:</h4>
<p>Does "common" depend on byteorder?</p>



<a name="260536761"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Cargo%20bug/near/260536761" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Asaf Fisher <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Cargo.20bug.html#260536761">(Nov 06 2021 at 21:22)</a>:</h4>
<p><span class="user-mention silent" data-user-id="260325">Chris Denton</span> <a href="#narrow/stream/122651-general/topic/Cargo.20bug/near/260534784">said</a>:</p>
<blockquote>
<p>Does "common" depend on byteorder?</p>
</blockquote>
<p>Why does it matter? In the tree I see std is coming from byteorder</p>



<a name="260537051"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Cargo%20bug/near/260537051" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Cargo.20bug.html#260537051">(Nov 06 2021 at 21:28)</a>:</h4>
<p>If there is another crate in your dependency graph that depends on byteorder that doesn't set <code>default-features = false</code> for it then it will pull in std due to that</p>



<a name="260538263"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Cargo%20bug/near/260538263" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Asaf Fisher <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Cargo.20bug.html#260538263">(Nov 06 2021 at 21:54)</a>:</h4>
<p><span class="user-mention silent" data-user-id="300586">Lukas Wirth</span> <a href="#narrow/stream/122651-general/topic/Cargo.20bug/near/260537051">said</a>:</p>
<blockquote>
<p>If there is another crate in your dependency graph that depends on byteorder that doesn't set <code>default-features = false</code> for it then it will pull in std due to that</p>
</blockquote>
<p>Ohhh I need to check that.</p>



<a name="260542353"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Cargo%20bug/near/260542353" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Asaf Fisher <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Cargo.20bug.html#260542353">(Nov 06 2021 at 23:30)</a>:</h4>
<p>It seems like there are not other crates that I know of</p>



<a name="260542665"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Cargo%20bug/near/260542665" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Cargo.20bug.html#260542665">(Nov 06 2021 at 23:39)</a>:</h4>
<p><span class="user-mention" data-user-id="455787">@Asaf Fisher</span> You can run <code>cargo tree -i byteorder -e features</code> to see which package is setting the <code>std</code> feature.</p>



<a name="260542730"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Cargo%20bug/near/260542730" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Cargo.20bug.html#260542730">(Nov 06 2021 at 23:40)</a>:</h4>
<p>There is an example of the bottom of <a href="https://doc.rust-lang.org/cargo/commands/cargo-tree.html">https://doc.rust-lang.org/cargo/commands/cargo-tree.html</a> on how to read the output.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>