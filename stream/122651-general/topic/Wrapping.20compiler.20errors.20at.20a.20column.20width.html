<html>
<head><meta charset="utf-8"><title>Wrapping compiler errors at a column width · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Wrapping.20compiler.20errors.20at.20a.20column.20width.html">Wrapping compiler errors at a column width</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="276523770"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Wrapping%20compiler%20errors%20at%20a%20column%20width/near/276523770" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Wrapping.20compiler.20errors.20at.20a.20column.20width.html#276523770">(Mar 24 2022 at 18:52)</a>:</h4>
<p>A typical rustc error message can be pretty long:</p>
<div class="codehilite" data-code-language="Text only"><pre><span></span><code>2 |     println!("{}", vec![1, 2, 3]);
  |                    ^^^^^^^^^^^^^ `Vec&lt;{integer}&gt;` cannot be formatted with the default formatter
</code></pre></div>
<p>For my training slides, I usually wrap these by hand so that they are more palatable for a slide format:</p>
<div class="codehilite" data-code-language="Text only"><pre><span></span><code>2 |     println!("{}", vec![1, 2, 3]);
  |                    ^^^^^^^^^^^^^ `Vec&lt;{integer}&gt;` cannot be formatted
  |                                  with the default formatter
</code></pre></div>
<p>Is there a secret rustc option to do that for me? If not, any ideas on Fun Command Line Tools that I could string together to automate this?</p>



<a name="276524631"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Wrapping%20compiler%20errors%20at%20a%20column%20width/near/276524631" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Wrapping.20compiler.20errors.20at.20a.20column.20width.html#276524631">(Mar 24 2022 at 18:58)</a>:</h4>
<p>There is a <code>-Zterminal-width</code> option. I think it currently only trims the actual source code though.</p>



<a name="276525138"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Wrapping%20compiler%20errors%20at%20a%20column%20width/near/276525138" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Wrapping.20compiler.20errors.20at.20a.20column.20width.html#276525138">(Mar 24 2022 at 19:02)</a>:</h4>
<p>Here is an example of <code>-Zterminal-width</code>: <a href="https://doc.rust-lang.org/cargo/reference/unstable.html#terminal-width">https://doc.rust-lang.org/cargo/reference/unstable.html#terminal-width</a></p>



<a name="276542864"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Wrapping%20compiler%20errors%20at%20a%20column%20width/near/276542864" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Wrapping.20compiler.20errors.20at.20a.20column.20width.html#276542864">(Mar 24 2022 at 21:38)</a>:</h4>
<p>Yeah, that doesn't help with the error text itself, it appears <span aria-label="crying cat" class="emoji emoji-1f63f" role="img" title="crying cat">:crying_cat:</span></p>



<a name="276563777"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/Wrapping%20compiler%20errors%20at%20a%20column%20width/near/276563777" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/Wrapping.20compiler.20errors.20at.20a.20column.20width.html#276563777">(Mar 25 2022 at 02:09)</a>:</h4>
<p>So, in order to get someone to appear magically and show me the better way, here's the quick thing I threw together which seems to work</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">use</span><span class="w"> </span><span class="n">once_cell</span>::<span class="n">sync</span>::<span class="n">Lazy</span><span class="p">;</span><span class="w"></span>
<span class="k">use</span><span class="w"> </span><span class="n">regex</span>::<span class="n">Regex</span><span class="p">;</span><span class="w"></span>
<span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">io</span>::<span class="p">{</span><span class="n">stdin</span><span class="p">,</span><span class="w"> </span><span class="n">BufRead</span><span class="p">};</span><span class="w"></span>

<span class="k">const</span><span class="w"> </span><span class="n">WIDTH</span>: <span class="kt">usize</span> <span class="o">=</span><span class="w"> </span><span class="mi">80</span><span class="p">;</span><span class="w"></span>
<span class="k">static</span><span class="w"> </span><span class="n">RUSTC_ERROR_LINE_PARTS</span>: <span class="nc">Lazy</span><span class="o">&lt;</span><span class="n">Regex</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Lazy</span>::<span class="n">new</span><span class="p">(</span><span class="o">||</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">Regex</span>::<span class="n">new</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="s">r"(?x)</span>
<span class="s">        # Beginning of line</span>
<span class="s">        ^</span>

<span class="s">        # Things we want to repeat for continuity</span>
<span class="s">        ([\ |=]*)</span>

<span class="s">        # Things we want to show once</span>
<span class="s">        ((?:error\[E\d+\]:|note:|help:|\^*)\ *)</span>

<span class="s">        # The useful error text</span>
<span class="s">        (.*)</span>

<span class="s">        # End of line</span>
<span class="s">        $</span>
<span class="s">        "</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="n">unwrap</span><span class="p">()</span><span class="w"></span>
<span class="p">});</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">stdin</span><span class="p">().</span><span class="n">lock</span><span class="p">().</span><span class="n">lines</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">line</span><span class="p">.</span><span class="n">unwrap</span><span class="p">();</span><span class="w"></span>

<span class="w">        </span><span class="c1">// TODO: Unicode</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">line</span><span class="p">.</span><span class="n">len</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">WIDTH</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{line}"</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="k">continue</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">captures</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RUSTC_ERROR_LINE_PARTS</span><span class="w"></span>
<span class="w">            </span><span class="p">.</span><span class="n">captures</span><span class="p">(</span><span class="o">&amp;</span><span class="n">line</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">"Couldn't deconstruct error line"</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">continuity_prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">captures</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span><span class="w"></span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">one_time_info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">captures</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span><span class="w"></span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">useful_text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">captures</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span><span class="w"></span>

<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">useful_text_max_width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WIDTH</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">continuity_prefix</span><span class="p">.</span><span class="n">len</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">one_time_info</span><span class="p">.</span><span class="n">len</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">padding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">" "</span><span class="p">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">one_time_info</span><span class="p">.</span><span class="n">len</span><span class="p">());</span><span class="w"></span>

<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">useful_text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">useful_text</span><span class="p">.</span><span class="n">to_owned</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">first</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="o">!</span><span class="n">useful_text</span><span class="p">.</span><span class="n">is_empty</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">head</span><span class="p">,</span><span class="w"> </span><span class="n">tail</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">useful_text</span><span class="p">.</span><span class="n">len</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">useful_text_max_width</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="kd">let</span><span class="w"> </span><span class="n">max_head</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">useful_text</span><span class="p">[</span><span class="o">..</span><span class="n">useful_text_max_width</span><span class="p">];</span><span class="w"></span>
<span class="w">                </span><span class="kd">let</span><span class="w"> </span><span class="n">breakpoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max_head</span><span class="w"></span>
<span class="w">                    </span><span class="p">.</span><span class="n">rfind</span><span class="p">(</span><span class="kt">char</span>::<span class="n">is_whitespace</span><span class="p">)</span><span class="w"></span>
<span class="w">                    </span><span class="p">.</span><span class="n">unwrap_or</span><span class="p">(</span><span class="n">useful_text_max_width</span><span class="p">);</span><span class="w"></span>

<span class="w">                </span><span class="n">useful_text</span><span class="p">.</span><span class="n">split_at</span><span class="p">(</span><span class="n">breakpoint</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="p">(</span><span class="o">&amp;*</span><span class="n">useful_text</span><span class="p">,</span><span class="w"> </span><span class="s">""</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="p">};</span><span class="w"></span>

<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">head</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">head</span><span class="p">.</span><span class="n">trim</span><span class="p">();</span><span class="w"></span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">tail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tail</span><span class="p">.</span><span class="n">trim</span><span class="p">();</span><span class="w"></span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">first</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{continuity_prefix}{one_time_info}{head}"</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{continuity_prefix}{padding}{head}"</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>

<span class="w">            </span><span class="n">useful_text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tail</span><span class="p">.</span><span class="n">to_owned</span><span class="p">();</span><span class="w"></span>
<span class="w">            </span><span class="n">first</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>