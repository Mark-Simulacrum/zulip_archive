<html>
<head><meta charset="utf-8"><title>auto traits · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/index.html">general</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/auto.20traits.html">auto traits</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="272254590"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/auto%20traits/near/272254590" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mejrs <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/auto.20traits.html#272254590">(Feb 17 2022 at 12:57)</a>:</h4>
<p>What are the prospects of (a subset of) auto_traits + negative_impls getting stabilized? I would like to design a Send-like trait but it seems these features are stuck in limbo. (Would there be a better place to ask this?)</p>



<a name="272261824"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/auto%20traits/near/272261824" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/auto.20traits.html#272261824">(Feb 17 2022 at 13:54)</a>:</h4>
<p><code>negative_impls</code> is pretty likely.  There's active work on them to integrate them into coherence, even: <a href="https://github.com/rust-lang/negative-impls-initiative/issues/1">https://github.com/rust-lang/negative-impls-initiative/issues/1</a></p>



<a name="272262105"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/auto%20traits/near/272262105" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/auto.20traits.html#272262105">(Feb 17 2022 at 13:56)</a>:</h4>
<p><code>auto trait</code>s, however, have some pretty fundamental ecosystem worries that might mean they're never stable: <a href="https://github.com/rust-lang/rust/issues/13231#event-5599097027">https://github.com/rust-lang/rust/issues/13231#event-5599097027</a></p>



<a name="272262271"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/auto%20traits/near/272262271" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/auto.20traits.html#272262271">(Feb 17 2022 at 13:57)</a>:</h4>
<p>(There's always <a class="stream" data-stream-id="213817" href="/#narrow/stream/213817-t-lang">#t-lang</a> for questions about language features which aren't about the implementation of them.)</p>



<a name="272392221"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/auto%20traits/near/272392221" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/auto.20traits.html#272392221">(Feb 18 2022 at 11:52)</a>:</h4>
<p>Speaking of which, when experimenting a bit with <code>negative_impls</code> (as in, "integrated into coherence"), <em>vs.</em> the "legacy" negative impl of an auto-trait, I ended up with this code (that I was tweaking to also compare remote negative impl vs local negative impl):</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#![feature(negative_impls, trivial_bounds)]</span><span class="w"></span>

<span class="c1">// use ::core::marker::PhantomPinned; /* test upstream negative impl */</span>
<span class="k">enum</span> <span class="nc">PhantomPinned</span><span class="w"> </span><span class="p">{}</span><span class="w">  </span><span class="k">impl</span><span class="w"> </span><span class="o">!</span><span class="nb">Unpin</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">PhantomPinned</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="c1">// type NotClone = &amp;'static mut (); /* test upstream negative impl */</span>
<span class="k">enum</span> <span class="nc">NotClone</span><span class="w"> </span><span class="p">{}</span><span class="w">       </span><span class="k">impl</span><span class="w"> </span><span class="o">!</span><span class="nb">Clone</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">NotClone</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="k">trait</span><span class="w"> </span><span class="n">Trait</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="k">enum</span> <span class="nc">Foo</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="k">impl</span><span class="w"> </span><span class="n">Trait</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Foo</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="k">impl</span><span class="w"> </span><span class="n">Trait</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Foo</span><span class="w"></span>
<span class="k">where</span><span class="w"></span>
<span class="w">    </span><span class="n">PhantomPinned</span><span class="w"> </span>: <span class="nb">Unpin</span><span class="p">,</span><span class="w"></span>
<span class="p">{}</span><span class="w"></span>

<span class="k">enum</span> <span class="nc">Bar</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="k">impl</span><span class="w"> </span><span class="n">Trait</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Bar</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="k">impl</span><span class="w"> </span><span class="n">Trait</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Bar</span><span class="w"></span>
<span class="k">where</span><span class="w"></span>
<span class="w">    </span><span class="n">NotClone</span><span class="w"> </span>: <span class="nb">Clone</span><span class="p">,</span><span class="w"></span>
<span class="p">{}</span><span class="w"></span>
</code></pre></div>
<ul>
<li><a href="https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2018&amp;gist=d10bea262b0516326f0d7ada80023131">Playground</a></li>
</ul>
<p>And it seems like that currently passes coherence, leading to a weird inference error later on:</p>
<div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="go">error[E0283]: type annotations needed</span>
<span class="go">  --&gt; src/lib.rs:12:6</span>
<span class="go">   |</span>
<span class="go">12 | impl Trait for Foo</span>
<span class="go">   |      ^^^^^ cannot infer type for enum `Foo`</span>
<span class="go">   |</span>
<span class="go">note: multiple `impl`s satisfying `Foo: Trait` found</span>
<span class="go">  --&gt; src/lib.rs:11:1</span>
<span class="go">   |</span>
<span class="go">11 |   impl Trait for Foo {}</span>
<span class="go">   |   ^^^^^^^^^^^^^^^^^^</span>
<span class="go">12 | / impl Trait for Foo</span>
<span class="go">13 | | where</span>
<span class="go">14 | |     PhantomPinned : Unpin,</span>
<span class="go">15 | | {}</span>
<span class="go">   | |__^</span>
</code></pre></div>
<ul>
<li>(same for <code>NotClone</code>).</li>
</ul>
<p>So there seems to be a misinteraction with <code>trivial_bounds</code>, and that shouldn't be dismissed since <code>trivial_bounds</code> is not really a feature in and of itself; injecting a dummy generic allows stable code to circumvent it, and by getting a bit creative using a HRTB, it is possible to have the generic not infect the implementor nor the trait (and thus hide it from downstream users), leading to <code>trivial_bounds</code> being <em>trivial</em> to circumvent.</p>
<ul>
<li>
<p>Demo of "use generics to avoid <code>trivial_bounds</code>": <a href="https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2021&amp;gist=c3d6296a100e35d93ba9291ff063dc4d">https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2021&amp;gist=c3d6296a100e35d93ba9291ff063dc4d</a></p>
</li>
<li>
<p>Demo of "hide that generic within a hrtb to make the workaround invisible": <a href="https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2018&amp;gist=3cdcf2f451b33d3c6726a744eb36ca2f">https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2018&amp;gist=3cdcf2f451b33d3c6726a744eb36ca2f</a></p>
</li>
</ul>



<a name="272392339"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/auto%20traits/near/272392339" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/auto.20traits.html#272392339">(Feb 18 2022 at 11:54)</a>:</h4>
<p><span class="user-mention silent" data-user-id="300586">Lukas Wirth</span> has marked this topic as resolved.</p>



<a name="272392367"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122651-general/topic/auto%20traits/near/272392367" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://zulip-archive.rust-lang.org/stream/122651-general/topic/auto.20traits.html#272392367">(Feb 18 2022 at 11:54)</a>:</h4>
<p><span class="user-mention silent" data-user-id="300586">Lukas Wirth</span> has marked this topic as unresolved.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>