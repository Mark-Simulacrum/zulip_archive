<html>
<head><meta charset="utf-8"><title>uintptr_t and ISO C · t-lang/wg-unsafe-code-guidelines · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/index.html">t-lang/wg-unsafe-code-guidelines</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/uintptr_t.20and.20ISO.20C.html">uintptr_t and ISO C</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="276107170"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/uintptr_t%20and%20ISO%20C/near/276107170" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/uintptr_t.20and.20ISO.20C.html#276107170">(Mar 21 2022 at 20:12)</a>:</h4>
<p><span class="user-mention silent" data-user-id="143798">Talchas</span> <a href="#narrow/stream/136281-t-lang.2Fwg-unsafe-code-guidelines/topic/ptr-.3Eint-.3Eptr.20as.20side.20effect.20destroys.20modular.20reasoning/near/276106464">said</a>:</p>
<blockquote>
<p>This is (effectively) not true, you are missing the (placed later, lol C standard) statement:</p>
<blockquote>
<p>The following type designates an unsigned integer type with the property that any valid pointer to void can be converted to this type, then converted back to pointer to void, and the result will compare equal to the original pointer. <code>uintptr_t</code></p>
</blockquote>
<p>So that's only true in the sense that uintptr_t is optional, and thus is irrelevant to these arguments.</p>
</blockquote>
<p>So my understanding is that if Rust is lowered to C (for the sake of argument here!) and <code>ptr.wrapping_offset(HUGE).wrapping_offset(-HUGE) does the appropriate motions on </code>uintptr_t`, even if the resulting integer is the same, I think it was altered and thus not required to actually return the original pointer.</p>



<a name="276108222"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/uintptr_t%20and%20ISO%20C/near/276108222" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Talchas <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/uintptr_t.20and.20ISO.20C.html#276108222">(Mar 21 2022 at 20:22)</a>:</h4>
<p>certainly it's well defined in any of actually-formal provenance proposals, but technically on the current version of the standard it would depend if you claim that integers are not substitutable (for purposes other than restrict, which has extremely broad wording that definitely permits this through its gate)</p>



<a name="276108307"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/uintptr_t%20and%20ISO%20C/near/276108307" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/uintptr_t.20and.20ISO.20C.html#276108307">(Mar 21 2022 at 20:22)</a>:</h4>
<p>Right, it basically depends on optimization things, which aren't what the Standard specifies, essentially.</p>



<a name="276108540"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/uintptr_t%20and%20ISO%20C/near/276108540" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Talchas <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/uintptr_t.20and.20ISO.20C.html#276108540">(Mar 21 2022 at 20:24)</a>:</h4>
<p>I mean, a sane language spec might say that integers are substitutable (and then CHERI is right out with uintptr_t definitely not being an integer by spec as well as in practice)</p>



<a name="276108592"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/uintptr_t%20and%20ISO%20C/near/276108592" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/uintptr_t.20and.20ISO.20C.html#276108592">(Mar 21 2022 at 20:25)</a>:</h4>
<p>Ah, yes. I agree, I just insist that ISO C is not a sane language spec.</p>



<a name="276108673"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/uintptr_t%20and%20ISO%20C/near/276108673" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Talchas <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/uintptr_t.20and.20ISO.20C.html#276108673">(Mar 21 2022 at 20:26)</a>:</h4>
<p>"I totally want my max function to maybe have to care about which integer it returns on =="</p>



<a name="276108729"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/uintptr_t%20and%20ISO%20C/near/276108729" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick12 <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/uintptr_t.20and.20ISO.20C.html#276108729">(Mar 21 2022 at 20:26)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281757">Jubilee</span> <a href="#narrow/stream/136281-t-lang.2Fwg-unsafe-code-guidelines/topic/uintptr_t.20and.20ISO.20C/near/276108307">said</a>:</p>
<blockquote>
<p>Right, it basically depends on optimization things, which aren't what the Standard specifies, essentially.</p>
</blockquote>
<p>If the C standard adopts the PNVI-ae proposal wouldn't it be fine?</p>



<a name="276108755"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/uintptr_t%20and%20ISO%20C/near/276108755" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Talchas <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/uintptr_t.20and.20ISO.20C.html#276108755">(Mar 21 2022 at 20:26)</a>:</h4>
<p>yes, all of the proposals, even PVI permit it currently</p>



<a name="276108815"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/uintptr_t%20and%20ISO%20C/near/276108815" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Talchas <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/uintptr_t.20and.20ISO.20C.html#276108815">(Mar 21 2022 at 20:27)</a>:</h4>
<p>(though PVI is particularly not fleshed out in the copy I read, and left tons of the int provenance stuff as "TBD given that we aren't suggesting PVI anyways")</p>



<a name="276110519"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/uintptr_t%20and%20ISO%20C/near/276110519" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/uintptr_t.20and.20ISO.20C.html#276110519">(Mar 21 2022 at 20:42)</a>:</h4>
<p>Right.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>