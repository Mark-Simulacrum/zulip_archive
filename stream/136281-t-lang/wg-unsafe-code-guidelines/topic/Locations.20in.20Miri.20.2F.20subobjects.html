<html>
<head><meta charset="utf-8"><title>Locations in Miri / subobjects · t-lang/wg-unsafe-code-guidelines · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/index.html">t-lang/wg-unsafe-code-guidelines</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Locations.20in.20Miri.20.2F.20subobjects.html">Locations in Miri / subobjects</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="278006614"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Locations%20in%20Miri%20/%20subobjects/near/278006614" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bram Geron <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Locations.20in.20Miri.20.2F.20subobjects.html#278006614">(Apr 06 2022 at 10:59)</a>:</h4>
<p>How do SB locations map to Miri? When you have a composite variable like a struct, is there only a location for the whole struct, or does each subobject have its own location? </p>
<p>The SB paper seems to keep this abstract.</p>



<a name="278007963"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Locations%20in%20Miri%20/%20subobjects/near/278007963" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jak{e,ob} Degen <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Locations.20in.20Miri.20.2F.20subobjects.html#278007963">(Apr 06 2022 at 11:13)</a>:</h4>
<p>What do you mean by "locations"? The AM has one borrow stack per byte of memory, if that is what you're asking</p>



<a name="278008353"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Locations%20in%20Miri%20/%20subobjects/near/278008353" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jak{e,ob} Degen <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Locations.20in.20Miri.20.2F.20subobjects.html#278008353">(Apr 06 2022 at 11:17)</a>:</h4>
<p>Rust doesn't have typed memory, so there's no notion of objects/sub-objects in memory</p>



<a name="278025789"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Locations%20in%20Miri%20/%20subobjects/near/278025789" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bram Geron <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Locations.20in.20Miri.20.2F.20subobjects.html#278025789">(Apr 06 2022 at 13:48)</a>:</h4>
<p>That answers my question indeed, thanks</p>



<a name="278026367"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Locations%20in%20Miri%20/%20subobjects/near/278026367" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bram Geron <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Locations.20in.20Miri.20.2F.20subobjects.html#278026367">(Apr 06 2022 at 13:53)</a>:</h4>
<p>Sounds potentially expensive</p>



<a name="278026732"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Locations%20in%20Miri%20/%20subobjects/near/278026732" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Locations.20in.20Miri.20.2F.20subobjects.html#278026732">(Apr 06 2022 at 13:55)</a>:</h4>
<p>If consecutive bytes have the same borrow stack the borrow stack is optimized together I believe.</p>



<a name="278026832"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Locations%20in%20Miri%20/%20subobjects/near/278026832" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Kimock (Saethlin) <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Locations.20in.20Miri.20.2F.20subobjects.html#278026832">(Apr 06 2022 at 13:56)</a>:</h4>
<p>That is correct</p>



<a name="278027142"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Locations%20in%20Miri%20/%20subobjects/near/278027142" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Kimock (Saethlin) <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Locations.20in.20Miri.20.2F.20subobjects.html#278027142">(Apr 06 2022 at 13:58)</a>:</h4>
<p>It's unclear to me how impactful this optimization is. In practice, I think it's less impactful on large borrow stacks because the memory use patterns of often-used allocations are not perfectly uniform</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>