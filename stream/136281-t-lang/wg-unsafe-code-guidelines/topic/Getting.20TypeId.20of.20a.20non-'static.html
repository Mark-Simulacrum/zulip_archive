<html>
<head><meta charset="utf-8"><title>Getting TypeId of a non-&#x27;static · t-lang/wg-unsafe-code-guidelines · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/index.html">t-lang/wg-unsafe-code-guidelines</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Getting.20TypeId.20of.20a.20non-&#x27;static.html">Getting TypeId of a non-&#x27;static</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="277797718"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Getting%20TypeId%20of%20a%20non-%27static/near/277797718" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brandon Falk <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Getting.20TypeId.20of.20a.20non-&#x27;static.html#277797718">(Apr 04 2022 at 21:41)</a>:</h4>
<p>Heya. I'm working with a datastructure in the same class of <code>GhostCell</code> where a token is given out and all accesses to the data structure have the same lifetime. I'm under the impression that it would be okay to get a TypeId of a non-'static lifetime internal to the structure, as all references will have the exact same <code>'id</code> (the invariant + closured lifetime). I assume TypeId only works on <code>'static</code> to ensure that you don't compare types of different lifetimes? But in my case all the lifetimes inside the structure will always be identical at compile time.</p>
<p>Although, I'm not even sure if it's possible to do <code>T: 'id</code> -&gt; <code>T: 'static</code> in any way in Rust?</p>



<a name="277798893"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Getting%20TypeId%20of%20a%20non-%27static/near/277798893" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Getting.20TypeId.20of.20a.20non-&#x27;static.html#277798893">(Apr 04 2022 at 21:52)</a>:</h4>
<p>Not for a generic <code>T</code>.</p>



<a name="277798935"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Getting%20TypeId%20of%20a%20non-%27static/near/277798935" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Getting.20TypeId.20of.20a.20non-&#x27;static.html#277798935">(Apr 04 2022 at 21:53)</a>:</h4>
<p>If you know the specific <code>T</code>, you can just instantiate it with <code>'static</code> instead.</p>



<a name="277798998"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Getting%20TypeId%20of%20a%20non-%27static/near/277798998" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Getting.20TypeId.20of.20a.20non-&#x27;static.html#277798998">(Apr 04 2022 at 21:53)</a>:</h4>
<p>I wonder if there should be a library way to get a <code>TypeId</code> for a non-<code>'static</code> type by erasing lifetimes. Something like <code>TypeId::of_erased::&lt;T&gt;()</code>.</p>



<a name="277799089"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Getting%20TypeId%20of%20a%20non-%27static/near/277799089" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brandon Falk <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Getting.20TypeId.20of.20a.20non-&#x27;static.html#277799089">(Apr 04 2022 at 21:54)</a>:</h4>
<p><span class="user-mention silent" data-user-id="257758">Connor Horman</span> <a href="#narrow/stream/136281-t-lang.2Fwg-unsafe-code-guidelines/topic/Getting.20TypeId.20of.20a.20non-'static/near/277798935">said</a>:</p>
<blockquote>
<p>If you know the specific <code>T</code>, you can just instantiate it with <code>'static</code> instead.</p>
</blockquote>
<p>Hmm, sadly I don't think I can do that here. I'll have to think about my design a bit</p>



<a name="277799149"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Getting%20TypeId%20of%20a%20non-%27static/near/277799149" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brandon Falk <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Getting.20TypeId.20of.20a.20non-&#x27;static.html#277799149">(Apr 04 2022 at 21:55)</a>:</h4>
<p>Yeah, with the influx of new code doing the invariant lifetimes, being able to compare types at compile time, when you know all types _only_ contain references using that invariant lifetime I think there's some crazy stuff that could be done</p>



<a name="277799190"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Getting%20TypeId%20of%20a%20non-%27static/near/277799190" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brandon Falk <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Getting.20TypeId.20of.20a.20non-&#x27;static.html#277799190">(Apr 04 2022 at 21:55)</a>:</h4>
<p>I think that's sound? Assuming you only ever compare types of the same invariant lifetime, I think TypeId is always okay there?</p>



<a name="277800221"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Getting%20TypeId%20of%20a%20non-%27static/near/277800221" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Talchas <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Getting.20TypeId.20of.20a.20non-&#x27;static.html#277800221">(Apr 04 2022 at 22:04)</a>:</h4>
<p>depending on what exactly you're doing you might accidentally allow turning <code>Foo&lt;Tag&lt;'a&gt;, &amp;'x i32&gt;</code> into <code>Foo&lt;Tag&lt;'a&gt;, &amp;'y i32&gt;</code>, but that might be impossible in your use case</p>



<a name="277800453"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Getting%20TypeId%20of%20a%20non-%27static/near/277800453" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brandon Falk <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Getting.20TypeId.20of.20a.20non-&#x27;static.html#277800453">(Apr 04 2022 at 22:06)</a>:</h4>
<p><span class="user-mention silent" data-user-id="143798">Talchas</span> <a href="#narrow/stream/136281-t-lang.2Fwg-unsafe-code-guidelines/topic/Getting.20TypeId.20of.20a.20non-'static/near/277800221">said</a>:</p>
<blockquote>
<p>depending on what exactly you're doing you might accidentally allow turning <code>Foo&lt;Tag&lt;'a&gt;, &amp;'x i32&gt;</code> into <code>Foo&lt;Tag&lt;'a&gt;, &amp;'y i32&gt;</code>, but that might be impossible in your use case</p>
</blockquote>
<p>I think it should be in my case. It's a shared pool allocator where multiple threads can allocate from, initialize (once), and then share the references <code>usize</code>s with different cores (if the <code>T</code> is <code>Sync</code>). All types are a <code>NumaRef&lt;'id, T&gt;</code> where <code>T: ?Sized + 'id</code> and <code>'id</code> is the invariant reference itself. It's a complex design, still kinda working on it in my head but I think it all checks out.</p>



<a name="277800600"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Getting%20TypeId%20of%20a%20non-%27static/near/277800600" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brandon Falk <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Getting.20TypeId.20of.20a.20non-&#x27;static.html#277800600">(Apr 04 2022 at 22:08)</a>:</h4>
<p>Since all the references are <code>usize</code>, and only ever in the <code>NumaPool</code>, it allows the pool to be moved, and for threads to use their thread-local copy by simply a different pointer. All data structures thus only can reference other <code>NumaRef</code>s with the same <code>'id</code>, everything is kept "internal" to the pool and immutable<br>
My specific goal with the <code>TypeId</code> stuff here, is that I can maintain a map of <code>TypeId, Vec&lt;NumaRef&lt;'id&gt;&gt;</code> which allows me to get any <code>T: 'id</code> in the database.</p>



<a name="277802741"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Getting%20TypeId%20of%20a%20non-%27static/near/277802741" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brandon Falk <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Getting.20TypeId.20of.20a.20non-&#x27;static.html#277802741">(Apr 04 2022 at 22:31)</a>:</h4>
<p>Here's the current "implementation" I think it's fairly solid, but I'm sure there are still some edge cases <a href="https://gist.github.com/gamozolabs/364312aaf6db32c57c31a0abad1e6da2">https://gist.github.com/gamozolabs/364312aaf6db32c57c31a0abad1e6da2</a></p>



<a name="277866829"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Getting%20TypeId%20of%20a%20non-%27static/near/277866829" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Giacomo Stevanato <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Getting.20TypeId.20of.20a.20non-&#x27;static.html#277866829">(Apr 05 2022 at 12:06)</a>:</h4>
<p>If you're talking about <a href="https://gist.github.com/gamozolabs/364312aaf6db32c57c31a0abad1e6da2#file-numapool-rs-L429-L461">https://gist.github.com/gamozolabs/364312aaf6db32c57c31a0abad1e6da2#file-numapool-rs-L429-L461</a> then you need <code>T: 'static</code> for it to be sound. if you don't do that then you could register a <code>NumaRef&lt;'id, &amp;'id Something&gt;</code> and then get an <code>&amp;'static Something</code> out of it later. Remember that <code>T: 'id</code> doesn't mean "the only lifetime that appears in <code>T</code> is <code>'id</code>, but rather that any lifetime that appears in <code>T</code> lives longer than <code>'id</code>.</p>



<a name="277867003"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Getting%20TypeId%20of%20a%20non-%27static/near/277867003" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Getting.20TypeId.20of.20a.20non-&#x27;static.html#277867003">(Apr 05 2022 at 12:08)</a>:</h4>
<p>Not if <code>NumaRef</code> is invariant in both <code>'id</code> and <code>T</code>.</p>



<a name="277867048"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Getting%20TypeId%20of%20a%20non-%27static/near/277867048" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Getting.20TypeId.20of.20a.20non-&#x27;static.html#277867048">(Apr 05 2022 at 12:08)</a>:</h4>
<p>(And same with the <code>Pool</code>)</p>



<a name="277883745"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Getting%20TypeId%20of%20a%20non-%27static/near/277883745" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Giacomo Stevanato <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Getting.20TypeId.20of.20a.20non-&#x27;static.html#277883745">(Apr 05 2022 at 14:05)</a>:</h4>
<p>I don't see how that costrains the signature of <code>values</code>. There I can freely choose <code>T</code> without variance requirements.</p>



<a name="277944907"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Getting%20TypeId%20of%20a%20non-%27static/near/277944907" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brandon Falk <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Getting.20TypeId.20of.20a.20non-&#x27;static.html#277944907">(Apr 05 2022 at 21:19)</a>:</h4>
<p>Yeah. This is kinda tough. I've decided to do an unsafe trait:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">unsafe</span><span class="w"> </span><span class="k">trait</span><span class="w"> </span><span class="n">Poolable</span>: <span class="nb">Sync</span> <span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">POOL_TYPE</span>: <span class="nc">TypeId</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="cp">#[derive(Clone, Copy, Debug)]</span><span class="w"></span>
<span class="k">struct</span> <span class="nc">Fleen</span><span class="o">&lt;'</span><span class="na">id</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">val</span>: <span class="kt">i32</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">other</span>: <span class="nc">NumaRef</span><span class="o">&lt;'</span><span class="na">id</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="k">unsafe</span><span class="w"> </span><span class="k">impl</span><span class="o">&lt;'</span><span class="na">id</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Poolable</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Fleen</span><span class="o">&lt;'</span><span class="na">id</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">POOL_TYPE</span>: <span class="nc">TypeId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TypeId</span>::<span class="n">of</span>::<span class="o">&lt;</span><span class="n">Fleen</span><span class="o">&lt;'</span><span class="nb">static</span><span class="o">&gt;&gt;</span><span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>Where it is unsafe, and you have to define a globally unique type ID for that value. All the functions that operate on <code>NumaRef</code>s expect <code>'id</code> to match the invariant lifetime of the pool itself, thus I think it's "fine" to use the typeid of <code>'static</code> for <code>'id</code>, as to the pool, it's a unique type ID, and impossible to put a non-<code>'id</code> reference into it where typeids could collide based on differing lifetimes</p>



<a name="277946732"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Getting%20TypeId%20of%20a%20non-%27static/near/277946732" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Giacomo Stevanato <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Getting.20TypeId.20of.20a.20non-&#x27;static.html#277946732">(Apr 05 2022 at 21:35)</a>:</h4>
<p>With this it looks like you can't insert types with non-<code>id</code> lifetimes, but you can still retrieve them with different lifetimes.</p>



<a name="277947209"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Getting%20TypeId%20of%20a%20non-%27static/near/277947209" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Giacomo Stevanato <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Getting.20TypeId.20of.20a.20non-&#x27;static.html#277947209">(Apr 05 2022 at 21:39)</a>:</h4>
<p>I think you should take a look at how the <code>better_any</code> crate does this.</p>



<a name="277947431"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Getting%20TypeId%20of%20a%20non-%27static/near/277947431" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brandon Falk <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Getting.20TypeId.20of.20a.20non-&#x27;static.html#277947431">(Apr 05 2022 at 21:41)</a>:</h4>
<p>Hmm. I'm not using <code>Any</code> though, if it's impossible to insert a non-<code>'id</code> type, then it's also impossible to get a non-<code>'id</code> type as none exist in the database with a differing lifetime. I'm also using a procedural macro where you can only make structures with PoD types and <code>NumaRef&lt;'id&gt;</code> it's impossible to ever have a non-<code>'id</code> numa ref at any point</p>



<a name="277947460"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Getting%20TypeId%20of%20a%20non-%27static/near/277947460" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brandon Falk <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Getting.20TypeId.20of.20a.20non-&#x27;static.html#277947460">(Apr 05 2022 at 21:41)</a>:</h4>
<p>All interactions with the pool require an <code>'id</code> from the pool</p>



<a name="277949732"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Getting%20TypeId%20of%20a%20non-%27static/near/277949732" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brandon Falk <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Getting.20TypeId.20of.20a.20non-&#x27;static.html#277949732">(Apr 05 2022 at 22:04)</a>:</h4>
<p>I can further restrict this by doing:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">unsafe</span><span class="w"> </span><span class="k">trait</span><span class="w"> </span><span class="n">Poolable</span><span class="o">&lt;'</span><span class="na">id</span><span class="o">&gt;</span>: <span class="o">'</span><span class="na">id</span> <span class="o">+</span><span class="w"> </span><span class="nb">Sync</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">POOL_TYPE</span>: <span class="nc">TypeId</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="cp">#[derive(Clone, Copy, Debug)]</span><span class="w"></span>
<span class="k">struct</span> <span class="nc">Fleen</span><span class="o">&lt;'</span><span class="na">id</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">val</span>: <span class="kt">i32</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">other</span>: <span class="nc">NumaRef</span><span class="o">&lt;'</span><span class="na">id</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="k">unsafe</span><span class="w"> </span><span class="k">impl</span><span class="o">&lt;'</span><span class="na">id</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Poolable</span><span class="o">&lt;'</span><span class="na">id</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Fleen</span><span class="o">&lt;'</span><span class="na">id</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">POOL_TYPE</span>: <span class="nc">TypeId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TypeId</span>::<span class="n">of</span>::<span class="o">&lt;</span><span class="n">Fleen</span><span class="o">&lt;'</span><span class="nb">static</span><span class="o">&gt;&gt;</span><span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>Thus any place where I get values by type it requires that <code>: 'id</code> bound on <code>Poolable</code></p>



<a name="277967673"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Getting%20TypeId%20of%20a%20non-%27static/near/277967673" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brandon Falk <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Getting.20TypeId.20of.20a.20non-&#x27;static.html#277967673">(Apr 06 2022 at 02:13)</a>:</h4>
<p>Updated the code quite a bit to a new API and added really strict <code>'id</code> bounds on everything <a href="https://gist.github.com/gamozolabs/82c50abe8cfeb17c36921cd7e0f58f4a">https://gist.github.com/gamozolabs/82c50abe8cfeb17c36921cd7e0f58f4a</a></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>