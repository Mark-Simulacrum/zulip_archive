<html>
<head><meta charset="utf-8"><title>portability lint using where clauses · t-lang/wg-unsafe-code-guidelines · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/index.html">t-lang/wg-unsafe-code-guidelines</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/portability.20lint.20using.20where.20clauses.html">portability lint using where clauses</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="276113205"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/portability%20lint%20using%20where%20clauses/near/276113205" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/portability.20lint.20using.20where.20clauses.html#276113205">(Mar 21 2022 at 21:01)</a>:</h4>
<p>(roughly a quick parent-traversal loop in one function in typeck)</p>



<a name="276113309"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/portability%20lint%20using%20where%20clauses/near/276113309" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/portability.20lint.20using.20where.20clauses.html#276113309">(Mar 21 2022 at 21:02)</a>:</h4>
<p>(the actual mechanism and design here should go in another thread, I was just mentioning it because the portability lint is feeling more in-reach now so things based on it might be feasible)</p>



<a name="276113330"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/portability%20lint%20using%20where%20clauses/near/276113330" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/portability.20lint.20using.20where.20clauses.html#276113330">(Mar 21 2022 at 21:02)</a>:</h4>
<p>yeah I'm tempted to fork threads already lol</p>



<a name="276113366"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/portability%20lint%20using%20where%20clauses/near/276113366" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/portability.20lint.20using.20where.20clauses.html#276113366">(Mar 21 2022 at 21:03)</a>:</h4>
<p>I do think having some way to say, explicitly, "I do funky things with pointers" vs "I want to run on architectures that won't let me do funky things with pointers" and detect that at compile time would be a feature.</p>



<a name="276113572"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/portability%20lint%20using%20where%20clauses/near/276113572" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/portability.20lint.20using.20where.20clauses.html#276113572">(Mar 21 2022 at 21:04)</a>:</h4>
<p>("scoped assumptions"/axioms &gt; "conditional compilation"/<code>#[cfg]</code>, everywhere the former is feasible, IMO)</p>



<a name="276113733"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/portability%20lint%20using%20where%20clauses/near/276113733" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/portability.20lint.20using.20where.20clauses.html#276113733">(Mar 21 2022 at 21:06)</a>:</h4>
<p>Sounds <em>fun</em>, tbh. And by <em>fun</em> I mean, uh...</p>



<a name="276113762"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/portability%20lint%20using%20where%20clauses/near/276113762" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/portability.20lint.20using.20where.20clauses.html#276113762">(Mar 21 2022 at 21:06)</a>:</h4>
<p><span class="user-mention silent" data-user-id="119009">eddyb</span> <a href="#narrow/stream/136281-t-lang.2Fwg-unsafe-code-guidelines/topic/portability.20lint.20using.20where.20clauses/near/276113572">said</a>:</p>
<blockquote>
<p>("scoped assumptions"/axioms &gt; "conditional compilation"/<code>#[cfg]</code>, everywhere the former is feasible, IMO)</p>
</blockquote>
<p>Agreed, that's the primary motivation for using <code>where</code>. Among other things, if done carefully, that means we can actually compile-check code meant for other targets.</p>



<a name="276240330"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/portability%20lint%20using%20where%20clauses/near/276240330" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/portability.20lint.20using.20where.20clauses.html#276240330">(Mar 22 2022 at 19:10)</a>:</h4>
<p><span class="user-mention" data-user-id="239881">@Josh Triplett</span> idk where to put this but I was thinking about Cargo features and came up with <code>where crate: HasFeature&lt;"foo"&gt;</code></p>



<a name="276240448"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/portability%20lint%20using%20where%20clauses/near/276240448" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/portability.20lint.20using.20where.20clauses.html#276240448">(Mar 22 2022 at 19:11)</a>:</h4>
<p>or even <code>where crate: HasConfig&lt;"feature", {Some("foo")}&gt;</code> - you can replace a lot of <code>#[cfg]</code> stuff like this heh</p>



<a name="276240523"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/portability%20lint%20using%20where%20clauses/near/276240523" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/portability.20lint.20using.20where.20clauses.html#276240523">(Mar 22 2022 at 19:12)</a>:</h4>
<p>(and it also reifies the idea that <code>--cfg</code> is passed to each crate separately)</p>



<a name="276243991"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/portability%20lint%20using%20where%20clauses/near/276243991" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> HeroicKatora <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/portability.20lint.20using.20where.20clauses.html#276243991">(Mar 22 2022 at 19:40)</a>:</h4>
<p>You mean: <code>crate: HasConfig&lt;"feature", Val={Some("")}&gt;</code>with associated constant, because it's a map and not a multiset. I'm glad that idea is finding new traction. Can we get <code>where</code>-clauses on enum-variants, too, to gate some <code>io::ErrorKind</code>'s on system families or to enable representations only when building with allocator, to build <code>OpenFlags</code>.</p>



<a name="276313137"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/portability%20lint%20using%20where%20clauses/near/276313137" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/portability.20lint.20using.20where.20clauses.html#276313137">(Mar 23 2022 at 10:32)</a>:</h4>
<p>it's not a map, it's a <code>(K, Option&lt;V&gt;)</code> set. and Cargo features exploit that, which is why I used them as an example, i.e., <code>#[cfg(and(feature = "foo", feature = "bar"))]</code> is sensible</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>