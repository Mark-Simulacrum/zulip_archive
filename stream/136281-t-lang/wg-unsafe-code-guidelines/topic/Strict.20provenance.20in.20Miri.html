<html>
<head><meta charset="utf-8"><title>Strict provenance in Miri · t-lang/wg-unsafe-code-guidelines · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/index.html">t-lang/wg-unsafe-code-guidelines</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Strict.20provenance.20in.20Miri.html">Strict provenance in Miri</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="277459594"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Strict%20provenance%20in%20Miri/near/277459594" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Strict.20provenance.20in.20Miri.html#277459594">(Apr 01 2022 at 18:20)</a>:</h4>
<p>Soon coming to a Miri near you: <a href="https://github.com/rust-lang/miri/pull/2045">https://github.com/rust-lang/miri/pull/2045</a></p>



<a name="277460554"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Strict%20provenance%20in%20Miri/near/277460554" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Kimock (Saethlin) <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Strict.20provenance.20in.20Miri.html#277460554">(Apr 01 2022 at 18:27)</a>:</h4>
<p>Threads don't need isolation disabled?</p>



<a name="277462096"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Strict%20provenance%20in%20Miri/near/277462096" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Strict.20provenance.20in.20Miri.html#277462096">(Apr 01 2022 at 18:38)</a>:</h4>
<p>not sure how that's related to the PR, but... no they don't</p>



<a name="277463759"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Strict%20provenance%20in%20Miri/near/277463759" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Kimock (Saethlin) <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Strict.20provenance.20in.20Miri.html#277463759">(Apr 01 2022 at 18:54)</a>:</h4>
<p>I was just looking over the PR, and it removes disable-isolation in tests/run-pass/concurrency</p>



<a name="277486565"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Strict%20provenance%20in%20Miri/near/277486565" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Strict.20provenance.20in.20Miri.html#277486565">(Apr 01 2022 at 22:36)</a>:</h4>
<p>yeah I realized I had left that flag in there by accident</p>



<a name="277491636"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Strict%20provenance%20in%20Miri/near/277491636" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Strict.20provenance.20in.20Miri.html#277491636">(Apr 01 2022 at 23:49)</a>:</h4>
<p>all right this is on its way to the next nightly now: <a href="https://github.com/rust-lang/rust/pull/95578">https://github.com/rust-lang/rust/pull/95578</a></p>



<a name="277491714"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Strict%20provenance%20in%20Miri/near/277491714" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Strict.20provenance.20in.20Miri.html#277491714">(Apr 01 2022 at 23:50)</a>:</h4>
<p><span class="user-mention" data-user-id="384014">@Patrick Walton</span> once this lands, <code>MIRIFLAGS="-Zmiri-disable-stacked-borrows -Zmiri-strict-provenance -Zmiri-check-number-validity"</code> can check code against strict provenance without stacked borrows</p>



<a name="277491752"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Strict%20provenance%20in%20Miri/near/277491752" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Strict.20provenance.20in.20Miri.html#277491752">(Apr 01 2022 at 23:51)</a>:</h4>
<p>hm, given <a href="#narrow/stream/136281-t-lang.2Fwg-unsafe-code-guidelines/topic/Strict.20provenance/near/277489704">my summary here</a> maybe <code>-Zstrict-provenance</code> <em>should</em> include <code>-Zmiri-check-number-validity</code>...</p>



<a name="277500612"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Strict%20provenance%20in%20Miri/near/277500612" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Strict.20provenance.20in.20Miri.html#277500612">(Apr 02 2022 at 02:35)</a>:</h4>
<p>(as in, it should also ensure no ptr2int transmutes happen)</p>



<a name="277500795"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Strict%20provenance%20in%20Miri/near/277500795" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bram Geron <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Strict.20provenance.20in.20Miri.html#277500795">(Apr 02 2022 at 02:39)</a>:</h4>
<p>It’s not clear to me that this is to be disallowed. The strict_provenance set of features explicitly have a conversion from pointer to integer. Maybe miri supports the new function instead.</p>



<a name="277502981"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Strict%20provenance%20in%20Miri/near/277502981" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Strict.20provenance.20in.20Miri.html#277502981">(Apr 02 2022 at 03:27)</a>:</h4>
<p><span class="user-mention" data-user-id="465167">@Bram Geron</span> it has a <em>conversion</em> from pointer to integer, but not a <em>transmute</em> from pointer to integer.</p>



<a name="277503535"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Strict%20provenance%20in%20Miri/near/277503535" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Strict.20provenance.20in.20Miri.html#277503535">(Apr 02 2022 at 03:38)</a>:</h4>
<p><span class="user-mention silent" data-user-id="465167">Bram Geron</span> <a href="#narrow/stream/136281-t-lang.2Fwg-unsafe-code-guidelines/topic/Strict.20provenance.20in.20Miri/near/277500795">said</a>:</p>
<blockquote>
<p>It’s not clear to me that this is to be disallowed. The strict_provenance set of features explicitly have a conversion from pointer to integer. Maybe miri supports the new function instead.</p>
</blockquote>
<p>the new functions are all just implemented as a library. miri has supported them from the start, just like all codegen backends, without any adjustments.</p>



<a name="277503573"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Strict%20provenance%20in%20Miri/near/277503573" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Strict.20provenance.20in.20Miri.html#277503573">(Apr 02 2022 at 03:39)</a>:</h4>
<p>strict provenance is mostly about <em>not</em> using certain language features (in particular, not using ptr2int2ptr roundtrips), so it's easy to support ;)</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>