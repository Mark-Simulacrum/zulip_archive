<html>
<head><meta charset="utf-8"><title>Self-reference · t-lang/wg-unsafe-code-guidelines · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/index.html">t-lang/wg-unsafe-code-guidelines</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Self-reference.html">Self-reference</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="276220912"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Self-reference/near/276220912" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alice Ryhl <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Self-reference.html#276220912">(Mar 22 2022 at 16:59)</a>:</h4>
<p>I haven't kept up with all of the discussion, but I see that there is a lot of provenance and stuff for raw pointers recently, and some proposed solutions in that gankra blog post. I was wondering — does any of this do anything about the self-referential struct troubles?</p>



<a name="276224721"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Self-reference/near/276224721" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Self-reference.html#276224721">(Mar 22 2022 at 17:24)</a>:</h4>
<p>Which self-referential struct troubles? The ability to understand that a mutable reference to a self-referential struct is not noalias?</p>



<a name="276225256"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Self-reference/near/276225256" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alice Ryhl <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Self-reference.html#276225256">(Mar 22 2022 at 17:28)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/issues/63818">https://github.com/rust-lang/rust/issues/63818</a></p>



<a name="276293665"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Self-reference/near/276293665" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kestrer <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Self-reference.html#276293665">(Mar 23 2022 at 06:39)</a>:</h4>
<p>Don't think so, this is to do with what happens when you convert a pointer to an integer and back again - the uniqueness of references isn't really involved.</p>
<p>The impact I'd imagine it having on async is whether it's sound to smuggle pointers through <code>io-uring</code>'s user data field (&lt;<a href="https://docs.rs/io-uring/0.5/io_uring/squeue/struct.Entry.html#method.user_data">https://docs.rs/io-uring/0.5/io_uring/squeue/struct.Entry.html#method.user_data</a>&gt;)</p>



<a name="276323027"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Self-reference/near/276323027" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Self-reference.html#276323027">(Mar 23 2022 at 12:04)</a>:</h4>
<p>but if adopting and enforcing these restrictions on pointers allows rust to have a working aliasing model, would that solve this problem?</p>



<a name="276325170"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Self-reference/near/276325170" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kestrer <a href="https://zulip-archive.rust-lang.org/stream/136281-t-lang/wg-unsafe-code-guidelines/topic/Self-reference.html#276325170">(Mar 23 2022 at 12:26)</a>:</h4>
<p>I suppose, and that would be a nice outcome, but I don't think that will necessarily happen as a result of this. The central question right now is "should int2ptr be allowed?" and that can be answered without answering whether <code>&amp;mut</code> universally enforces uniqueness or not.</p>
<p>Maybe if PNVI-ae were to be chosen then it would have a small impact because you could make each node in an intrusive linked list have an exposed address, thus allowing you to magic up provenance to any of them at any time. But it doesn't look like that model will be used, and it doesn't solve the "async fn is unsound" issue anyway since that's about references not raw pointers.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>