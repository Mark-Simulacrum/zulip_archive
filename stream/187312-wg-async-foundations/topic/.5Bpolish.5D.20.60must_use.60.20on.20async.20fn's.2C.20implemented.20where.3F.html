<html>
<head><meta charset="utf-8"><title>[polish] `must_use` on async fn&#x27;s, implemented where? · wg-async-foundations · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/index.html">wg-async-foundations</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.5Bpolish.5D.20.60must_use.60.20on.20async.20fn&#x27;s.2C.20implemented.20where.3F.html">[polish] `must_use` on async fn&#x27;s, implemented where?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="256484125"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%5Bpolish%5D%20%60must_use%60%20on%20async%20fn%27s%2C%20implemented%20where%3F/near/256484125" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gus Wynn <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.5Bpolish.5D.20.60must_use.60.20on.20async.20fn&#x27;s.2C.20implemented.20where.3F.html#256484125">(Oct 06 2021 at 21:02)</a>:</h4>
<p>Should this warning be in clippy: issue: <a href="https://github.com/rust-lang/rust/issues/78149">https://github.com/rust-lang/rust/issues/78149</a>, my basic pr: <a href="https://github.com/rust-lang/rust/pull/89610">https://github.com/rust-lang/rust/pull/89610</a> ?<br>
to easily be able to make the warning work, not just on <code>async</code> fns, but also on things that use <code>async-trait</code> (so basically, <code>Box&lt;dyn Future&gt;</code>), it seems like its easiest to do this check after typechecking, and clippy has some really nice helpers to figure out if types are <code>Box</code> and what not</p>



<a name="256488380"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%5Bpolish%5D%20%60must_use%60%20on%20async%20fn%27s%2C%20implemented%20where%3F/near/256488380" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eholk <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.5Bpolish.5D.20.60must_use.60.20on.20async.20fn&#x27;s.2C.20implemented.20where.3F.html#256488380">(Oct 06 2021 at 21:33)</a>:</h4>
<p>Hmm, good question. I'm never really clear on what should go in clippy versus in rustc.</p>



<a name="256488510"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%5Bpolish%5D%20%60must_use%60%20on%20async%20fn%27s%2C%20implemented%20where%3F/near/256488510" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eholk <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.5Bpolish.5D.20.60must_use.60.20on.20async.20fn&#x27;s.2C.20implemented.20where.3F.html#256488510">(Oct 06 2021 at 21:34)</a>:</h4>
<p>My first impression is that since <code>must_use</code> is already in rustc, it makes sense for it to stay there. Is the main reason to move it out to be able to make more use of clippy's helpers?</p>



<a name="256489584"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%5Bpolish%5D%20%60must_use%60%20on%20async%20fn%27s%2C%20implemented%20where%3F/near/256489584" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gus Wynn <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.5Bpolish.5D.20.60must_use.60.20on.20async.20fn&#x27;s.2C.20implemented.20where.3F.html#256489584">(Oct 06 2021 at 21:43)</a>:</h4>
<p>I suppose. Also because clippy is a place that does wanting after typecking, not sure where else we do that? I did ask in compiler/help if the check_attrs pass has access to typck results, awaiting a reply</p>



<a name="256489791"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%5Bpolish%5D%20%60must_use%60%20on%20async%20fn%27s%2C%20implemented%20where%3F/near/256489791" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gus Wynn <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.5Bpolish.5D.20.60must_use.60.20on.20async.20fn&#x27;s.2C.20implemented.20where.3F.html#256489791">(Oct 06 2021 at 21:45)</a>:</h4>
<p>*warning after linting, and I think to make this warning work on more than just async fn's, I need typecking</p>



<a name="256489944"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%5Bpolish%5D%20%60must_use%60%20on%20async%20fn%27s%2C%20implemented%20where%3F/near/256489944" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eholk <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.5Bpolish.5D.20.60must_use.60.20on.20async.20fn&#x27;s.2C.20implemented.20where.3F.html#256489944">(Oct 06 2021 at 21:46)</a>:</h4>
<p>When does <code>check_attrs</code> happen now?</p>



<a name="256490076"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%5Bpolish%5D%20%60must_use%60%20on%20async%20fn%27s%2C%20implemented%20where%3F/near/256490076" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gus Wynn <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.5Bpolish.5D.20.60must_use.60.20on.20async.20fn&#x27;s.2C.20implemented.20where.3F.html#256490076">(Oct 06 2021 at 21:47)</a>:</h4>
<p>It's in <code>Providers</code>, which makes me think it's a query, but I think typecking is also a provider.</p>



<a name="256490192"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%5Bpolish%5D%20%60must_use%60%20on%20async%20fn%27s%2C%20implemented%20where%3F/near/256490192" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eholk <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.5Bpolish.5D.20.60must_use.60.20on.20async.20fn&#x27;s.2C.20implemented.20where.3F.html#256490192">(Oct 06 2021 at 21:48)</a>:</h4>
<p>Yeah, you <em>might</em> be able to ask for type checking in <code>check_attrs</code>, but there's a good chance you'll create cycles.</p>



<a name="256490586"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%5Bpolish%5D%20%60must_use%60%20on%20async%20fn%27s%2C%20implemented%20where%3F/near/256490586" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gus Wynn <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.5Bpolish.5D.20.60must_use.60.20on.20async.20fn&#x27;s.2C.20implemented.20where.3F.html#256490586">(Oct 06 2021 at 21:52)</a>:</h4>
<p>Hmm, I'll wait to see what compiler/help people say, they may have a good non-clippy place to locate this. The language and basic structure is definitely reviewable before the sprint meeting tomorrow tho!</p>



<a name="256490626"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%5Bpolish%5D%20%60must_use%60%20on%20async%20fn%27s%2C%20implemented%20where%3F/near/256490626" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eholk <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.5Bpolish.5D.20.60must_use.60.20on.20async.20fn&#x27;s.2C.20implemented.20where.3F.html#256490626">(Oct 06 2021 at 21:52)</a>:</h4>
<p>Nice!</p>



<a name="256490654"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%5Bpolish%5D%20%60must_use%60%20on%20async%20fn%27s%2C%20implemented%20where%3F/near/256490654" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eholk <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.5Bpolish.5D.20.60must_use.60.20on.20async.20fn&#x27;s.2C.20implemented.20where.3F.html#256490654">(Oct 06 2021 at 21:53)</a>:</h4>
<p>Although, I don't think there's a sprint meeting tomorrow. They're every two weeks.</p>



<a name="256491064"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%5Bpolish%5D%20%60must_use%60%20on%20async%20fn%27s%2C%20implemented%20where%3F/near/256491064" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gus Wynn <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.5Bpolish.5D.20.60must_use.60.20on.20async.20fn&#x27;s.2C.20implemented.20where.3F.html#256491064">(Oct 06 2021 at 21:56)</a>:</h4>
<p>Ugh, why is my calendar all messed up <span aria-label="frown" class="emoji emoji-1f641" role="img" title="frown">:frown:</span></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>