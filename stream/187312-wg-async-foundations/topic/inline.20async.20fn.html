<html>
<head><meta charset="utf-8"><title>inline async fn · wg-async-foundations · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/index.html">wg-async-foundations</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/inline.20async.20fn.html">inline async fn</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="249868804"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/inline%20async%20fn/near/249868804" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/inline.20async.20fn.html#249868804">(Aug 18 2021 at 15:40)</a>:</h4>
<p>So <span class="user-mention" data-user-id="116883">@tmandry</span> I was thinking more about inline async functions and whether they are necessary</p>



<a name="249868865"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/inline%20async%20fn/near/249868865" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/inline.20async.20fn.html#249868865">(Aug 18 2021 at 15:41)</a>:</h4>
<p>I think maybe if we focus instead on "dyn async traits", we solve the problem a better way</p>



<a name="249868909"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/inline%20async%20fn/near/249868909" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/inline.20async.20fn.html#249868909">(Aug 18 2021 at 15:41)</a>:</h4>
<p>It's worth remembering that -- if <code>AsyncDrop</code> is like <code>Drop</code> -- it is "very special" in terms of how it is treated by the language</p>



<a name="249868938"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/inline%20async%20fn/near/249868938" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/inline.20async.20fn.html#249868938">(Aug 18 2021 at 15:41)</a>:</h4>
<p>The main reason that I was arguing that inline async fn were important for Drop is that we want to be able to use auto traits on types</p>



<a name="249868962"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/inline%20async%20fn/near/249868962" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/inline.20async.20fn.html#249868962">(Aug 18 2021 at 15:41)</a>:</h4>
<p>but the rules for autotraits for things that implement AsyncDrop can be special</p>



<a name="249869037"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/inline%20async%20fn/near/249869037" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/inline.20async.20fn.html#249869037">(Aug 18 2021 at 15:42)</a>:</h4>
<p>for example, we might say: </p>
<ul>
<li>If <code>T</code> implements <code>AsyncDrop</code>, then <code>T: Send</code> requires <em>also</em> that <code>&lt;T as AsyncDrop&gt;::drop: Send</code> (where that names the future)</li>
</ul>



<a name="249869064"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/inline%20async%20fn/near/249869064" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/inline.20async.20fn.html#249869064">(Aug 18 2021 at 15:42)</a>:</h4>
<p>Now, you ask, what about <code>Box&lt;dyn Trait&gt;</code> stuff and auto-traits?</p>



<a name="249869081"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/inline%20async%20fn/near/249869081" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/inline.20async.20fn.html#249869081">(Aug 18 2021 at 15:42)</a>:</h4>
<p>Well, indeed, that is a very good question</p>



<a name="249869149"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/inline%20async%20fn/near/249869149" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/inline.20async.20fn.html#249869149">(Aug 18 2021 at 15:43)</a>:</h4>
<p>We can impose  rules about what can be made into a <code>dyn Trait</code>, though</p>



<a name="249869211"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/inline%20async%20fn/near/249869211" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/inline.20async.20fn.html#249869211">(Aug 18 2021 at 15:43)</a>:</h4>
<p>The most draconian would be "nothing that implements <code>AsyncDrop</code>"</p>



<a name="249869241"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/inline%20async%20fn/near/249869241" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/inline.20async.20fn.html#249869241">(Aug 18 2021 at 15:43)</a>:</h4>
<p>this is, I guess, where your ideas about "send if Self: Send" come into play</p>



<a name="249869271"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/inline%20async%20fn/near/249869271" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/inline.20async.20fn.html#249869271">(Aug 18 2021 at 15:44)</a>:</h4>
<p>er, wait, sorry</p>



<a name="249869273"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/inline%20async%20fn/near/249869273" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/inline.20async.20fn.html#249869273">(Aug 18 2021 at 15:44)</a>:</h4>
<p>let me back up</p>



<a name="249869337"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/inline%20async%20fn/near/249869337" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/inline.20async.20fn.html#249869337">(Aug 18 2021 at 15:44)</a>:</h4>
<p>what I realized is: this is basically the <em>same question</em> as any other <code>async fn</code> that goes behind a <code>dyn Trait</code></p>



<a name="249869387"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/inline%20async%20fn/near/249869387" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/inline.20async.20fn.html#249869387">(Aug 18 2021 at 15:44)</a>:</h4>
<p>in other words, if we are saying that when you have an <code>async fn</code>, the "dyn version" of the trait returns some kind of boxed future, the same is true for <code>async fn drop</code></p>



<a name="249869407"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/inline%20async%20fn/near/249869407" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/inline.20async.20fn.html#249869407">(Aug 18 2021 at 15:44)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/187312-wg-async-foundations/topic/inline.20async.20fn/near/249869037">said</a>:</p>
<blockquote>
<p>for example, we might say: </p>
<ul>
<li>If <code>T</code> implements <code>AsyncDrop</code>, then <code>T: Send</code> requires <em>also</em> that <code>&lt;T as AsyncDrop&gt;::drop: Send</code> (where that names the future)</li>
</ul>
</blockquote>
<p>and hence this same rule just applies to that type</p>



<a name="249869513"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/inline%20async%20fn/near/249869513" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/inline.20async.20fn.html#249869513">(Aug 18 2021 at 15:45)</a>:</h4>
<p>so if that boxed type that gets returned by <code>async fn drop(&amp;mut self)</code> is (e.g.) a <code>Box&lt;dyn Future + Send&gt;</code>, then <code>Foo&lt;T&gt;: Send</code> is true, but if it is <code>Box&lt;dyn Future&gt;</code>, then <code>Foo&lt;T&gt;: Send</code> is false</p>



<a name="249869531"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/inline%20async%20fn/near/249869531" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/inline.20async.20fn.html#249869531">(Aug 18 2021 at 15:45)</a>:</h4>
<p>importantly, this applies equally well to all auto traits</p>



<a name="249869593"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/inline%20async%20fn/near/249869593" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/inline.20async.20fn.html#249869593">(Aug 18 2021 at 15:46)</a>:</h4>
<p>so this bottoms out in having control over what kind of type is used to make your async fn "dyn executable"</p>



<a name="249869685"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/inline%20async%20fn/near/249869685" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/inline.20async.20fn.html#249869685">(Aug 18 2021 at 15:46)</a>:</h4>
<p>importantly:</p>



<a name="249869717"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/inline%20async%20fn/near/249869717" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/inline.20async.20fn.html#249869717">(Aug 18 2021 at 15:46)</a>:</h4>
<p>you were talking about specifying <em>on the trait</em> whether the async fn "inherit" send-ness from the self-type</p>



<a name="249870562"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/inline%20async%20fn/near/249870562" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/inline.20async.20fn.html#249870562">(Aug 18 2021 at 15:53)</a>:</h4>
<p>because in an "inherit" case, I would like to have 2 dyn impls, something like</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">impl</span><span class="w"> </span><span class="n">Trait</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nb">Box</span><span class="o">&lt;</span><span class="k">dyn</span><span class="w"> </span><span class="n">Trait</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">Send</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">AsyncFnFuture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Box</span><span class="o">&lt;</span><span class="k">dyn</span><span class="w"> </span><span class="n">Future</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">Send</span><span class="o">&gt;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">impl</span><span class="w"> </span><span class="n">Trait</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nb">Box</span><span class="o">&lt;</span><span class="k">dyn</span><span class="w"> </span><span class="n">Trait</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">AsyncFnFuture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Box</span><span class="o">&lt;</span><span class="k">dyn</span><span class="w"> </span><span class="n">Future</span><span class="o">&gt;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="249882139"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/inline%20async%20fn/near/249882139" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/inline.20async.20fn.html#249882139">(Aug 18 2021 at 17:16)</a>:</h4>
<p>^^ yeah and then we need a way to express the existence of the first as a bound I guess, in the non-<code>AsyncDrop</code> case</p>



<a name="249882194"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/inline%20async%20fn/near/249882194" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/inline.20async.20fn.html#249882194">(Aug 18 2021 at 17:16)</a>:</h4>
<p>unless we just apply the same "auto trait equivalence" to <em>all</em> async fn futures in traits, which I guess is one option</p>



<a name="249882406"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/inline%20async%20fn/near/249882406" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/inline.20async.20fn.html#249882406">(Aug 18 2021 at 17:18)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/187312-wg-async-foundations/topic/inline.20async.20fn/near/249869717">said</a>:</p>
<blockquote>
<p>you were talking about specifying <em>on the trait</em> whether the async fn "inherit" send-ness from the self-type</p>
</blockquote>
<p>if it is an <code>AsyncDrop</code> specific thing, I think we can still express the "inheritance" of auto traits on the <code>AsyncDrop</code> trait itself and reason about it that way</p>



<a name="249887072"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/inline%20async%20fn/near/249887072" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gus Wynn <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/inline.20async.20fn.html#249887072">(Aug 18 2021 at 17:53)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/187312-wg-async-foundations/topic/inline.20async.20fn/near/249870562">said</a>:</p>
<blockquote>
<p>because in an "inherit" case, I would like to have 2 dyn impls, something like</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">impl</span><span class="w"> </span><span class="n">Trait</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nb">Box</span><span class="o">&lt;</span><span class="k">dyn</span><span class="w"> </span><span class="n">Trait</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">Send</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">AsyncFnFuture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Box</span><span class="o">&lt;</span><span class="k">dyn</span><span class="w"> </span><span class="n">Future</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">Send</span><span class="o">&gt;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">impl</span><span class="w"> </span><span class="n">Trait</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nb">Box</span><span class="o">&lt;</span><span class="k">dyn</span><span class="w"> </span><span class="n">Trait</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">AsyncFnFuture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Box</span><span class="o">&lt;</span><span class="k">dyn</span><span class="w"> </span><span class="n">Future</span><span class="o">&gt;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div><br>
</p>
</blockquote>
<p>do non-async traits currently effectively have just this impl:</p>
<div class="codehilite"><pre><span></span><code>impl Trait for Box&lt;dyn Trait&gt; {
    fn item(&amp;self) {
        *self.item()
   }
}
</code></pre></div>
<p>?</p>



<a name="249901765"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/inline%20async%20fn/near/249901765" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/inline.20async.20fn.html#249901765">(Aug 18 2021 at 19:41)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116883">tmandry</span> <a href="#narrow/stream/187312-wg-async-foundations/topic/inline.20async.20fn/near/249882194">said</a>:</p>
<blockquote>
<p>unless we just apply the same "auto trait equivalence" to <em>all</em> async fn futures in traits, which I guess is one option</p>
</blockquote>
<p>I'm not sure what "auto trait equivalence" you mean exactly here</p>



<a name="249901821"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/inline%20async%20fn/near/249901821" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/inline.20async.20fn.html#249901821">(Aug 18 2021 at 19:41)</a>:</h4>
<p><span class="user-mention" data-user-id="257428">@Gus Wynn</span> something like that, yes</p>



<a name="249902226"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/inline%20async%20fn/near/249902226" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/inline.20async.20fn.html#249902226">(Aug 18 2021 at 19:44)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/187312-wg-async-foundations/topic/inline.20async.20fn/near/249901765">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="116883">tmandry</span> <a href="#narrow/stream/187312-wg-async-foundations/topic/inline.20async.20fn/near/249882194">said</a>:</p>
<blockquote>
<p>unless we just apply the same "auto trait equivalence" to <em>all</em> async fn futures in traits, which I guess is one option</p>
</blockquote>
<p>I'm not sure what "auto trait equivalence" you mean exactly here</p>
</blockquote>
<p><code>&lt;T as MyTrait&gt;::MyAsyncFnOutput</code> is <code>Send</code> if <code>T</code> is <code>Send</code></p>



<a name="249902392"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/inline%20async%20fn/near/249902392" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/inline.20async.20fn.html#249902392">(Aug 18 2021 at 19:46)</a>:</h4>
<p>we could make this the default for all async fns in traits</p>



<a name="249903061"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/inline%20async%20fn/near/249903061" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/inline.20async.20fn.html#249903061">(Aug 18 2021 at 19:52)</a>:</h4>
<p>I see</p>



<a name="249903079"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/inline%20async%20fn/near/249903079" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/inline.20async.20fn.html#249903079">(Aug 18 2021 at 19:52)</a>:</h4>
<p>Yes, that we could do, I'm just not sure if it's the right default</p>



<a name="249903098"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/inline%20async%20fn/near/249903098" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/inline.20async.20fn.html#249903098">(Aug 18 2021 at 19:52)</a>:</h4>
<p>I don't know how common it is to want to invoke async fns and then send the result over a new thread</p>



<a name="249903110"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/inline%20async%20fn/near/249903110" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/inline.20async.20fn.html#249903110">(Aug 18 2021 at 19:52)</a>:</h4>
<p>It seems...probably fairly uncommon</p>



<a name="249903137"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/inline%20async%20fn/near/249903137" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/inline.20async.20fn.html#249903137">(Aug 18 2021 at 19:53)</a>:</h4>
<p>well ok I guess I'm wrong</p>



<a name="249903172"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/inline%20async%20fn/near/249903172" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/inline.20async.20fn.html#249903172">(Aug 18 2021 at 19:53)</a>:</h4>
<p>I mean that probably <em>is</em> uncommon, but I was forgetting that futures often want to be <code>Send</code> <em>at each await point</em></p>



<a name="249903211"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/inline%20async%20fn/near/249903211" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/inline.20async.20fn.html#249903211">(Aug 18 2021 at 19:53)</a>:</h4>
<p>in which case it's probably super common</p>



<a name="249910689"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/inline%20async%20fn/near/249910689" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/inline.20async.20fn.html#249910689">(Aug 18 2021 at 20:58)</a>:</h4>
<p>yeah, I'm not sure if it's right either, but it might be</p>



<a name="269033699"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/inline%20async%20fn/near/269033699" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Justin Karneges <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/inline.20async.20fn.html#269033699">(Jan 23 2022 at 19:05)</a>:</h4>
<p>Just came across <a href="https://rust-lang.github.io/async-fundamentals-initiative/evaluation/design/inline_async_fn.html#proposal-inline-futures">repr(inline_async)</a>, as a way to store the state for futures within the parent struct and avoid boxing. It looks almost too magical. I wonder if <a href="https://github.com/rust-lang/rust/issues/63063">Permit impl Trait in type aliases</a> would be a sufficient alternative, as I think that would allow declaring a variable within a struct to hold a generated future. basically a more explicit way to achieve the same result</p>



<a name="269132410"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/inline%20async%20fn/near/269132410" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/inline.20async.20fn.html#269132410">(Jan 24 2022 at 16:37)</a>:</h4>
<p>In the latest evolution of that idea</p>



<a name="269132442"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/inline%20async%20fn/near/269132442" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/inline.20async.20fn.html#269132442">(Jan 24 2022 at 16:37)</a>:</h4>
<p>I have prototype a procedural macro that generates a wrapper</p>



<a name="269132461"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/inline%20async%20fn/near/269132461" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/inline.20async.20fn.html#269132461">(Jan 24 2022 at 16:37)</a>:</h4>
<p>perhaps along the lines of what you are suggesting</p>



<a name="269132465"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/inline%20async%20fn/near/269132465" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/inline.20async.20fn.html#269132465">(Jan 24 2022 at 16:37)</a>:</h4>
<p>it does rely on TAIT</p>



<a name="269485009"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/inline%20async%20fn/near/269485009" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/inline.20async.20fn.html#269485009">(Jan 26 2022 at 21:27)</a>:</h4>
<p>ah, I like that idea</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>