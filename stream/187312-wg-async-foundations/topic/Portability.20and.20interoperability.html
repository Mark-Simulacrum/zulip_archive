<html>
<head><meta charset="utf-8"><title>Portability and interoperability · wg-async-foundations · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/index.html">wg-async-foundations</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html">Portability and interoperability</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="264001282"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264001282" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264001282">(Dec 07 2021 at 13:35)</a>:</h4>
<p>I am looking to 'officially' get started on the portability and interoperability initiative. This is a thread for anyone who wants to be involved to say 'hi', or for anyone with concerns/ideas/thoughts (especially around planning) to share them.</p>



<a name="264001384"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264001384" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264001384">(Dec 07 2021 at 13:35)</a>:</h4>
<p>I've just published a blog post with things I think are important and some vague semblance of a plan for tackling the topic: <a href="https://www.ncameron.org/blog/portable-and-interoperable-async-rust/">https://www.ncameron.org/blog/portable-and-interoperable-async-rust/</a></p>



<a name="264001521"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264001521" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264001521">(Dec 07 2021 at 13:36)</a>:</h4>
<p>I think the next step for me will be clarifying the problems around AsyncRead and AsyncWrite, and generally starting a discussion there.</p>



<a name="264002874"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264002874" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264002874">(Dec 07 2021 at 13:46)</a>:</h4>
<p>Hi <span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span></p>



<a name="264002920"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264002920" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264002920">(Dec 07 2021 at 13:47)</a>:</h4>
<p>I think you forgot to edit this TODO out :)</p>
<blockquote>
<p>(e.g., Tokio's requirement that all async code (TODO clarify) is within the context of an executor)</p>
</blockquote>



<a name="264004549"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264004549" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264004549">(Dec 07 2021 at 13:59)</a>:</h4>
<p>Heh, thanks, I did</p>



<a name="264005720"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264005720" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264005720">(Dec 07 2021 at 14:06)</a>:</h4>
<p><span class="user-mention" data-user-id="363998">@Ibraheem Ahmed</span> anything in particular you're interested in? Thoughts on priorities etc.?</p>



<a name="264006517"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264006517" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dirkjan Ochtman <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264006517">(Dec 07 2021 at 14:12)</a>:</h4>
<p>Also "hi" I guess</p>



<a name="264006585"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264006585" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dirkjan Ochtman <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264006585">(Dec 07 2021 at 14:12)</a>:</h4>
<p>I'm very interested in having a solution for <code>AsyncRead</code>/<code>AsyncWrite</code> that is shared across tokio and other runtimes</p>



<a name="264006620"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264006620" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dirkjan Ochtman <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264006620">(Dec 07 2021 at 14:13)</a>:</h4>
<p>it's too bad that the <code>ReadBuf</code> PR seems to be stalled :(</p>



<a name="264006936"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264006936" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264006936">(Dec 07 2021 at 14:15)</a>:</h4>
<p>Which ReadBuf PR?</p>



<a name="264007860"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264007860" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dirkjan Ochtman <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264007860">(Dec 07 2021 at 14:22)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/pull/81156">https://github.com/rust-lang/rust/pull/81156</a></p>



<a name="264009075"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264009075" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dirkjan Ochtman <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264009075">(Dec 07 2021 at 14:30)</a>:</h4>
<p>FWIW my interest is mainly as a maintainer of quinn and trust-dns, for both of which I/O abstraction is of course very important</p>



<a name="264009189"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264009189" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dirkjan Ochtman <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264009189">(Dec 07 2021 at 14:31)</a>:</h4>
<p>Quinn currently only supports Tokio, Trust-DNS has a custom trait to abstract over runtimes (one important user is Fuchsia)</p>



<a name="264014257"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264014257" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264014257">(Dec 07 2021 at 15:11)</a>:</h4>
<p>I agree that AsyncRead/Write are the highest priority items right now</p>



<a name="264016311"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264016311" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Xuanwo <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264016311">(Dec 07 2021 at 15:27)</a>:</h4>
<p>Hi, I have read a Twitter about this issue, is there anything I can help or contribute?</p>



<a name="264018764"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264018764" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264018764">(Dec 07 2021 at 15:43)</a>:</h4>
<p>Hi! Yes there is lots to do! At the moment we’re at the planning and requirements gathering stage, so the most useful thing to do is share experiences, constraints, or wishes. I’ll have some links soon for places to follow for more concrete ways to contribute</p>



<a name="264019295"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264019295" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Xuanwo <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264019295">(Dec 07 2021 at 15:46)</a>:</h4>
<p>For wish: as a lib developer, I don't want to make decisions of async runtime for my end users. As described in the blog post, <code>AsyncRead</code> / <code>AsyncWrite</code> in std makes it possible to develop libs that no depends on async runtime.</p>



<a name="264020068"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264020068" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264020068">(Dec 07 2021 at 15:51)</a>:</h4>
<p>There's also the question of when we're ready to start adding async primitives to std, that are already runtime agnostic</p>



<a name="264020119"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264020119" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264020119">(Dec 07 2021 at 15:52)</a>:</h4>
<p>e.g future combinators, locks, channels</p>



<a name="264020166"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264020166" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264020166">(Dec 07 2021 at 15:52)</a>:</h4>
<p>I suppose that mostly just needs an RFC</p>



<a name="264024663"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264024663" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264024663">(Dec 07 2021 at 16:19)</a>:</h4>
<p>We should talk with the libs team about the specifics. My impression is that currently a lot of the  things like locks and channels are tied to the runtime and we will need to do some work to separate them out. The futures combinators could be added to std, but I'm not sure how much motivation there is to do so - using async/await is the preferred way to use futures and then the combinators aren't needed. If the combinators are only used by a relatively small number of users, then leaving them in the futures crate seems fine</p>



<a name="264025352"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264025352" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264025352">(Dec 07 2021 at 16:23)</a>:</h4>
<p>Locks and channels aren't tied to the runtime</p>



<a name="264025382"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264025382" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264025382">(Dec 07 2021 at 16:23)</a>:</h4>
<p>All of tokio::sync is runtime agnostic</p>



<a name="264030511"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264030511" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alice Ryhl <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264030511">(Dec 07 2021 at 16:51)</a>:</h4>
<p>The stuff in <code>tokio::sync</code> does have some runtime specific stuff, e.g. support for Tokio's coop system and there are PRs for (unstable) tracing integration, though these features will just disable themselves when used outside of a Tokio runtime, so they don't really tie them to the runtime.</p>



<a name="264030523"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264030523" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264030523">(Dec 07 2021 at 16:51)</a>:</h4>
<p>Is it? That would make things much easier if true. I thought that the Tokio libraries allow for pre-emption of Tokio tasks in various places? My understanding is also that even if they are runtime agnostic, they are different from the equivalents in the futures crate (and async std/smol)</p>



<a name="264036494"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264036494" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264036494">(Dec 07 2021 at 17:24)</a>:</h4>
<p>There is a repo for discussing this work: <a href="https://github.com/nrc/portable-interoperable">https://github.com/nrc/portable-interoperable</a> I created some issues today to discuss high level goals and principles. I also created an issue specifically for AsyncRead/AsyncWrite. Following that repo (or a specific issue/label) will probably be the best way to keep up to date with this work.</p>



<a name="264040244"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264040244" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264040244">(Dec 07 2021 at 17:46)</a>:</h4>
<blockquote>
<p>using async/await is the preferred way to use futures and then the combinators aren't needed.</p>
</blockquote>
<p>That doesn’t appear to account for things like join/select/buffer_unordered/etc.  — any of the combinators that do interesting async-smart operations.</p>



<a name="264043892"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264043892" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264043892">(Dec 07 2021 at 17:59)</a>:</h4>
<p>Yeah, join and select are definitely still relevant. I don't know buffer_unordered so well. I'd hope to move join/select macros into std, though again there are runtime-specific complications</p>



<a name="264044459"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264044459" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264044459">(Dec 07 2021 at 18:01)</a>:</h4>
<p>What runtime specific complications are there for join or select?</p>



<a name="264044642"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264044642" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264044642">(Dec 07 2021 at 18:02)</a>:</h4>
<p>I don't believe there are any</p>



<a name="264044718"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264044718" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264044718">(Dec 07 2021 at 18:03)</a>:</h4>
<p>Also, buffer_unordered is a stream combinator, there are a ton of those that would be useful</p>



<a name="264045117"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264045117" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264045117">(Dec 07 2021 at 18:05)</a>:</h4>
<p>Many of those are blocked/waiting for on async closures, and the stream rfc chose to leave them out for now</p>



<a name="264049995"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264049995" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264049995">(Dec 07 2021 at 18:33)</a>:</h4>
<p>I’m not totally up to speed on the macros, iirc they are not integrated with the runtimes or anything, but the different runtimes do have different implementations</p>



<a name="264050193"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264050193" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264050193">(Dec 07 2021 at 18:34)</a>:</h4>
<p>Async iteration/streams are a topic all of their own, so are out of scope for the interoperability initiative</p>



<a name="264050235"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264050235" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264050235">(Dec 07 2021 at 18:35)</a>:</h4>
<p>For select, yeah there is a difference between the futures and tokio version</p>



<a name="264050282"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264050282" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264050282">(Dec 07 2021 at 18:35)</a>:</h4>
<p>Futures should move to the tokio method though</p>



<a name="264050422"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264050422" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264050422">(Dec 07 2021 at 18:36)</a>:</h4>
<p>There's an open issue about it, it's just that no one's done it yet :)</p>



<a name="264050887"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264050887" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264050887">(Dec 07 2021 at 18:38)</a>:</h4>
<p><a href="https://github.com/rust-lang/futures-rs/issues/1989">https://github.com/rust-lang/futures-rs/issues/1989</a></p>



<a name="264051063"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264051063" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264051063">(Dec 07 2021 at 18:39)</a>:</h4>
<p>Tokio based their version on ^</p>



<a name="264051331"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264051331" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264051331">(Dec 07 2021 at 18:41)</a>:</h4>
<p>I'm not sure whether this fits into the interoperability initiative though</p>



<a name="264051808"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264051808" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264051808">(Dec 07 2021 at 18:43)</a>:</h4>
<p>Good to know, thanks!</p>



<a name="264051933"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264051933" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264051933">(Dec 07 2021 at 18:44)</a>:</h4>
<p>I think it does, I want things like select to be in std, not each runtime having their own version</p>



<a name="264055285"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264055285" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264055285">(Dec 07 2021 at 19:05)</a>:</h4>
<p>I agree on wanting them in std (eventually), but the current ones in the crates <em>are</em> interoperable, AFAICT. That's why it seems out of scope for the <strong>interoperability</strong> initiative. Maybe the name is artificially limiting?</p>



<a name="264055585"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264055585" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264055585">(Dec 07 2021 at 19:07)</a>:</h4>
<p>About "eventually" — it'd be nice if a "good amount" of the stdlib combinators stabilized when <code>std::Stream</code> does, to minimize the amount of churn as people could switch once.</p>



<a name="264056209"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264056209" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264056209">(Dec 07 2021 at 19:12)</a>:</h4>
<p>There shouldn't be much churn, futures::Stream will just become <code>pub use std::stream::Stream</code></p>



<a name="264056474"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264056474" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264056474">(Dec 07 2021 at 19:14)</a>:</h4>
<p>assuming that it's unchanged, sure.</p>



<a name="264056938"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264056938" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264056938">(Dec 07 2021 at 19:17)</a>:</h4>
<p>re the <code>select</code> macros, this had recent activity: <a href="https://stackoverflow.com/q/60811657/155423">What is the difference between futures::select! and tokio::select?</a></p>



<a name="264059013"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264059013" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264059013">(Dec 07 2021 at 19:32)</a>:</h4>
<p>I think select! will need an RFC as there's quite a bit of design work there, but join! is more straightforward</p>



<a name="264060094"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264060094" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264060094">(Dec 07 2021 at 19:40)</a>:</h4>
<p><span class="user-mention silent" data-user-id="256841">Nick Cameron</span> <a href="#narrow/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability/near/264001282">said</a>:</p>
<blockquote>
<p>I am looking to 'officially' get started on the portability and interoperability initiative. This is a thread for anyone who wants to be involved to say 'hi', or for anyone with concerns/ideas/thoughts (especially around planning) to share them.</p>
</blockquote>
<p>"hi". :)</p>



<a name="264060446"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264060446" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264060446">(Dec 07 2021 at 19:43)</a>:</h4>
<p><span class="user-mention silent" data-user-id="256841">Nick Cameron</span> <a href="#narrow/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability/near/264030523">said</a>:</p>
<blockquote>
<p>Is it? That would make things much easier if true. I thought that the Tokio libraries allow for pre-emption of Tokio tasks in various places? My understanding is also that even if they are runtime agnostic, they are different from the equivalents in the futures crate (and async std/smol)</p>
</blockquote>
<p>That's a key issue, yeah. People don't like ending up with 400 dependencies because they end up pulling in <em>three different</em> implementations of channels, locks, primitives, futures, etc.</p>



<a name="264060541"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264060541" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264060541">(Dec 07 2021 at 19:44)</a>:</h4>
<p>Having <em>one</em> is fine, but then that means all your dependencies have to be prepared to work with that <em>one</em>, which means being more ecosystem-agnostic and having lots of feature flags, which is painful.</p>



<a name="264061001"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264061001" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264061001">(Dec 07 2021 at 19:46)</a>:</h4>
<p>Also, in addition to portability, I'm personally very interested in the proposals that have been discussed to use <code>impl Future</code> to support implementing traits without using <code>Poll</code>.</p>



<a name="264071738"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264071738" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kestrer <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264071738">(Dec 07 2021 at 21:06)</a>:</h4>
<p><code>select!</code> is more complex, but <code>race!</code> is simpler and could be implemented</p>



<a name="264071784"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264071784" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kestrer <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264071784">(Dec 07 2021 at 21:07)</a>:</h4>
<p><code>race!</code> being the macro that takes a list of futures that all resolve to the same type and gives the output of the first one</p>



<a name="264084082"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264084082" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264084082">(Dec 07 2021 at 22:39)</a>:</h4>
<p><span class="user-mention" data-user-id="226095">@Dirkjan Ochtman</span> I took some time and read through the 1000+ line patch today. <a href="https://github.com/rust-lang/rust/pull/81156#issuecomment-988298256">https://github.com/rust-lang/rust/pull/81156#issuecomment-988298256</a></p>



<a name="264115314"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264115314" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Justin Karneges <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264115314">(Dec 08 2021 at 05:59)</a>:</h4>
<p>Hi folks, I've written my own async runtime, and would love to see better interop. I agree with what others have said, that the IO traits are probably the most important thing. it would also be nice to see an agreed upon approach for select (right now my pref would be tokio-style that works on bare futures, unlike futures-rs, unless I misunderstand something; also ideally the impl wouldn't need to alloc or else people may still drag around their own select like me)</p>



<a name="264119085"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264119085" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dirkjan Ochtman <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264119085">(Dec 08 2021 at 07:08)</a>:</h4>
<p><span class="user-mention" data-user-id="239881">@Josh Triplett</span> awesome, thanks!</p>



<a name="264136890"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264136890" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264136890">(Dec 08 2021 at 10:33)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability/near/264061001">said</a>:</p>
<blockquote>
<p>Also, in addition to portability, I'm personally very interested in the proposals that have been discussed to use <code>impl Future</code> to support implementing traits without using <code>Poll</code>.</p>
</blockquote>
<p>is that specific to join/select macros or is this a more general proposal?</p>



<a name="264138768"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264138768" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264138768">(Dec 08 2021 at 10:52)</a>:</h4>
<p>I filed an issue about select: <a href="https://github.com/nrc/portable-interoperable/issues/6">https://github.com/nrc/portable-interoperable/issues/6</a></p>



<a name="264161041"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264161041" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264161041">(Dec 08 2021 at 14:18)</a>:</h4>
<p><span class="user-mention" data-user-id="218683">@Alice Ryhl</span> Do you know how Tokio folk feel about the RFC 2930 approach to reading into an uninit buffer? Does it cover all the motivations for a similar setup in Tokio's AsyncRead trait?</p>



<a name="264166208"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264166208" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264166208">(Dec 08 2021 at 14:57)</a>:</h4>
<p><span class="user-mention" data-user-id="256841">@Nick Cameron</span> what's the solution to dyn-safe async traits that doesn't require inline async?</p>



<a name="264166492"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264166492" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264166492">(Dec 08 2021 at 14:59)</a>:</h4>
<p>A proc macro currently named dyner, basically it creates a proxy trait with the argument boxed when using trait objects</p>



<a name="264167211"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264167211" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264167211">(Dec 08 2021 at 15:03)</a>:</h4>
<p>I'm not sure that approach is a good idea for AsyncRead/Write</p>



<a name="264167759"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264167759" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264167759">(Dec 08 2021 at 15:06)</a>:</h4>
<p>why not?</p>



<a name="264168085"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264168085" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264168085">(Dec 08 2021 at 15:09)</a>:</h4>
<p>It adds an allocation to a common hot path</p>



<a name="264168746"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264168746" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264168746">(Dec 08 2021 at 15:14)</a>:</h4>
<p>The boxing only happens once when the future is created (not while it is being polled), so it seems to me like a pretty minimal allocation. Given that the context is that IO is happening, it seems like a single allocation shouldn't make a difference relative to the time the IO takes</p>



<a name="264173793"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264173793" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264173793">(Dec 08 2021 at 15:43)</a>:</h4>
<p>It adds an allocation every time you read or write from/to the stream</p>



<a name="264174263"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264174263" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264174263">(Dec 08 2021 at 15:46)</a>:</h4>
<p>Why?</p>



<a name="264177575"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264177575" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264177575">(Dec 08 2021 at 16:06)</a>:</h4>
<p>Because it would be:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">read</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="p">[</span><span class="kt">u8</span><span class="p">])</span><span class="w"> </span>-&gt; <span class="nc">BoxFuture</span><span class="o">&lt;'</span><span class="nb">_</span><span class="p">,</span><span class="w"> </span><span class="n">io</span>::<span class="nb">Result</span><span class="o">&lt;</span><span class="kt">usize</span><span class="o">&gt;&gt;</span><span class="p">;</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">write</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span>: <span class="kp">&amp;</span><span class="p">[</span><span class="kt">u8</span><span class="p">])</span><span class="w"> </span>-&gt; <span class="nc">BoxFuture</span><span class="o">&lt;'</span><span class="nb">_</span><span class="p">,</span><span class="w"> </span><span class="n">io</span>::<span class="nb">Result</span><span class="o">&lt;</span><span class="kt">usize</span><span class="o">&gt;&gt;</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
<p>In a dyn context.</p>



<a name="264178719"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264178719" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264178719">(Dec 08 2021 at 16:14)</a>:</h4>
<p>So something like <code>read_to_end</code> on a <code>Box&lt;dyn AsyncRead&gt;</code> could potentially need a bunch more allocations.</p>



<a name="264180162"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264180162" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264180162">(Dec 08 2021 at 16:25)</a>:</h4>
<p>Ah I see, you’re thinking of functions which call read or write multiple times, that makes sense, thanks!</p>



<a name="264181083"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264181083" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Sartor <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264181083">(Dec 08 2021 at 16:31)</a>:</h4>
<p>Is the plan at this point for AsyncRead/Write to define async functions or poll functions?</p>



<a name="264181286"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264181286" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264181286">(Dec 08 2021 at 16:32)</a>:</h4>
<p>There is no plan at present. Existing versions use poll functions, many people assume we should use async functions (and that is mentioned in the vision doc) but I don’t think it has been discussed in depth</p>



<a name="264181552"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264181552" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264181552">(Dec 08 2021 at 16:34)</a>:</h4>
<p><span class="user-mention" data-user-id="363998">@Ibraheem Ahmed</span> thinking about this a bit more, something like read_to_end should be implemented outside the dynamic context, so will call read directly (ie there is no allocation), the allocation happens in the stub for read_to_end</p>



<a name="264181625"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264181625" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264181625">(Dec 08 2021 at 16:35)</a>:</h4>
<p>This would still be a problem for external functions calling read repeatedly though</p>



<a name="264186682"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264186682" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264186682">(Dec 08 2021 at 17:07)</a>:</h4>
<p>Ah yeah, you're right</p>



<a name="264187495"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Portability%20and%20interoperability/near/264187495" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Portability.20and.20interoperability.html#264187495">(Dec 08 2021 at 17:13)</a>:</h4>
<blockquote>
<p>This would still be a problem for external functions calling read repeatedly though</p>
</blockquote>
<p>Yes, something like streaming a <a href="https://docs.rs/http-types/latest/src/http_types/body.rs.html#56"><code>tide::Body</code></a>.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>