<html>
<head><meta charset="utf-8"><title>#65147 check_mod_item_types slowdown · wg-async-foundations · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/index.html">wg-async-foundations</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html">#65147 check_mod_item_types slowdown</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="177573271"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177573271" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177573271">(Oct 08 2019 at 00:14)</a>:</h4>
<p>I'm profiling a really long compile with <code>perf record -F99 --call-graph dwarf</code>, like it says in the <a href="https://rust-lang.github.io/rustc-guide/profiling/with_perf.html#gathering-a-perf-profile" target="_blank" title="https://rust-lang.github.io/rustc-guide/profiling/with_perf.html#gathering-a-perf-profile">guide</a></p>



<a name="177573287"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177573287" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177573287">(Oct 08 2019 at 00:15)</a>:</h4>
<p>the top entry from <code>perf report</code> is <code>&lt;smallvec::SmallVec&lt;A&gt; as core::iter::traits::collect::FromIterator&lt;&lt;A as smallvec::Array&gt;::Item&gt;&gt;::from_iter</code></p>



<a name="177573292"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177573292" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177573292">(Oct 08 2019 at 00:15)</a>:</h4>
<p>it seems we spend a ton of time building SmallVecs, but I can't figure out <em>why</em></p>



<a name="177573295"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177573295" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177573295">(Oct 08 2019 at 00:15)</a>:</h4>
<p>there are no callers listed in the call graph for some reason</p>



<a name="177573366"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177573366" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177573366">(Oct 08 2019 at 00:17)</a>:</h4>
<p>I tried using <code>perf focus --tree-callers</code> (cc <span class="user-mention" data-user-id="116009">@nikomatsakis</span>) and it showed the same thing</p>



<a name="177573382"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177573382" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177573382">(Oct 08 2019 at 00:17)</a>:</h4>
<p>also, <code>main</code> isn't listed anywhere, and almost no query-related frames seem to be showing up, even though <code>-Z self-profile</code> says we spend almost all our time inside one kind of query</p>



<a name="177573461"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177573461" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177573461">(Oct 08 2019 at 00:19)</a>:</h4>
<p>(this is in order to debug <a href="https://github.com/rust-lang/rust/issues/65147" target="_blank" title="https://github.com/rust-lang/rust/issues/65147">#65147</a> since so far I haven't been able to minimize an example.. it seems the compile time correlates with the complexity of the underlying call graph of async fns)</p>



<a name="177574227"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177574227" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177574227">(Oct 08 2019 at 00:36)</a>:</h4>
<p><span class="user-mention" data-user-id="116883">@tmandry</span> hm, so there's no parent information (i.e., callchain) in the perf output?</p>



<a name="177574326"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177574326" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177574326">(Oct 08 2019 at 00:38)</a>:</h4>
<p>I can see what that function is calling, but not what's calling it</p>



<a name="177574337"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177574337" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177574337">(Oct 08 2019 at 00:38)</a>:</h4>
<p>hm, that's odd -- one thing to try might be <code>--call-graph dwarf,16000</code> or some higher number to increase the stack depth</p>



<a name="177574349"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177574349" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177574349">(Oct 08 2019 at 00:39)</a>:</h4>
<p>yes, I tried that, all the way up to the max, no change :(</p>



<a name="177574357"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177574357" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177574357">(Oct 08 2019 at 00:39)</a>:</h4>
<p>it's possible I'm misreading something ofc</p>



<a name="177574364"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177574364" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177574364">(Oct 08 2019 at 00:39)</a>:</h4>
<div class="codehilite"><pre><span></span># Children      Self  Command  Shared Object                               Symbol
#
    43.60%    43.60%  rustc    librustc_driver-fd1d337d61819709.so         [.] &lt;smallvec::SmallVec&lt;A&gt; as core::iter::traits::collect::FromIterator&lt;&lt;A as smallvec::Array&gt;::Item&gt;&gt;::from_iter
            |
            ---&lt;smallvec::SmallVec&lt;A&gt; as core::iter::traits::collect::FromIterator&lt;&lt;A as smallvec::Array&gt;::Item&gt;&gt;::from_iter
               |
                --26.36%--&lt;smallvec::SmallVec&lt;A&gt; as core::iter::traits::collect::Extend&lt;&lt;A as smallvec::Array&gt;::Item&gt;&gt;::extend (inlined)
                          |
                          |--3.49%--smallvec::SmallVec&lt;A&gt;::triple_mut (inlined)
                          |          |
                          |           --0.92%--smallvec::SmallVec&lt;A&gt;::spilled (inlined)
                          |
                          |--2.86%--&lt;core::iter::adapters::Map&lt;I,F&gt; as core::iter::traits::iterator::Iterator&gt;::size_hint (inlined)
                          |          &lt;core::slice::Iter&lt;T&gt; as core::iter::traits::iterator::Iterator&gt;::size_hint (inlined)
                          |
                          |--2.18%--&lt;core::iter::adapters::Map&lt;I,F&gt; as core::iter::traits::iterator::Iterator&gt;::next (inlined)
                          |          |
                          |          |--1.60%--&lt;core::slice::Iter&lt;T&gt; as core::iter::traits::iterator::Iterator&gt;::next (inlined)
                          |          |
                          |           --0.57%--core::option::Option&lt;T&gt;::map (inlined)
                          |
                          |--1.95%--smallvec::SmallVec&lt;A&gt;::reserve (inlined)
                          |
                           --0.75%--core::ptr::write (inlined)
</pre></div>



<a name="177574370"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177574370" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177574370">(Oct 08 2019 at 00:39)</a>:</h4>
<p>that's the very top entry in <code>perf report</code></p>



<a name="177574431"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177574431" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177574431">(Oct 08 2019 at 00:40)</a>:</h4>
<p>yeah, so we're clearly spending a lot of time in collecting SmallVecs from iterators</p>



<a name="177574454"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177574454" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177574454">(Oct 08 2019 at 00:41)</a>:</h4>
<p>I would try maybe looking at flamegraph output via e.g. inferno <a href="https://github.com/jonhoo/inferno" target="_blank" title="https://github.com/jonhoo/inferno">https://github.com/jonhoo/inferno</a> if you don't have a pre-existing setup with the perl scripts, and as a starter maybe just <code>perf script</code> output</p>



<a name="177574461"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177574461" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177574461">(Oct 08 2019 at 00:41)</a>:</h4>
<p>I would kind of expect the top entry to be something like <code>main</code>, though</p>



<a name="177574522"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177574522" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177574522">(Oct 08 2019 at 00:42)</a>:</h4>
<p>well, perf can't get the whole callchain usually</p>



<a name="177574544"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177574544" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177574544">(Oct 08 2019 at 00:43)</a>:</h4>
<p>at some point dwarf is not good enough to go up through the stack frames afaik, though I've never tried to find out why that is</p>



<a name="177574567"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177574567" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177574567">(Oct 08 2019 at 00:44)</a>:</h4>
<p>is this output from a local compiler?</p>



<a name="177574632"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177574632" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177574632">(Oct 08 2019 at 00:44)</a>:</h4>
<p>yes</p>



<a name="177574878"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177574878" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177574878">(Oct 08 2019 at 00:50)</a>:</h4>
<p>here's a flamegraph... <a href="/user_uploads/4715/68Ukpek5yxdtsYmE1A5aHVdq/flamegraph.svg" target="_blank" title="flamegraph.svg">flamegraph.svg</a></p>



<a name="177574910"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177574910" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177574910">(Oct 08 2019 at 00:51)</a>:</h4>
<p>that looks.. very odd</p>



<a name="177574911"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177574911" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177574911">(Oct 08 2019 at 00:51)</a>:</h4>
<p>maybe try removing -F99 from collection?</p>



<a name="177574916"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177574916" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177574916">(Oct 08 2019 at 00:51)</a>:</h4>
<p>it might be that you happen to only be hitting inside the smallvec code I guess...</p>



<a name="177574919"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177574919" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177574919">(Oct 08 2019 at 00:52)</a>:</h4>
<p>(the default is way higher, I believe)</p>



<a name="177574959"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177574959" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177574959">(Oct 08 2019 at 00:52)</a>:</h4>
<p>there's substantial time spent in <code>TypeFoldable::fold_with</code>, which makes sense because all time is being spent in <code>check_mod_item_types</code> according to <code>-Z self-profile</code></p>



<a name="177574973"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177574973" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177574973">(Oct 08 2019 at 00:52)</a>:</h4>
<p>I've done at least several profiles at this point, but I'll try</p>



<a name="177575100"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177575100" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177575100">(Oct 08 2019 at 00:55)</a>:</h4>
<p>It might be the InternalSubsts::identity_for_item call because that's AFAICT recollecting all the generic parameters each time it's called</p>



<a name="177575113"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177575113" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177575113">(Oct 08 2019 at 00:55)</a>:</h4>
<p>not sure why _two_ awaits would cause a problem whereas one doesn't, but perhaps it has something to do with the temporaries we're forcing to live longer?</p>



<a name="177575179"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177575179" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177575179">(Oct 08 2019 at 00:56)</a>:</h4>
<p>it's gotten more complicated since I wrote that description</p>



<a name="177575192"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177575192" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177575192">(Oct 08 2019 at 00:57)</a>:</h4>
<p>as it turns out, both of those awaits are in a single "critical chain" of awaits that causes the slowdown</p>



<a name="177575194"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177575194" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177575194">(Oct 08 2019 at 00:57)</a>:</h4>
<p>if you take one of them out, you break the chain</p>



<a name="177575241"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177575241" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177575241">(Oct 08 2019 at 00:58)</a>:</h4>
<p>the chain leads to one function in particular that awaits many other async fns in a match</p>



<a name="177575259"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177575259" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177575259">(Oct 08 2019 at 00:59)</a>:</h4>
<p>removing awaits from that function speeds up compiles, and the more you remove the faster the compile is</p>



<a name="177575267"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177575267" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177575267">(Oct 08 2019 at 00:59)</a>:</h4>
<p>yeah, so my experience with await has been that you create a ton of generics (lifetimes, mostly, but that doesn't matter here)</p>



<a name="177575273"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177575273" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177575273">(Oct 08 2019 at 00:59)</a>:</h4>
<p>since ~every temporary gets uplifted to be a lifetime param</p>



<a name="177575359"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177575359" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177575359">(Oct 08 2019 at 01:01)</a>:</h4>
<p>and I believe this code is creating a fresh SmallVec from the list whenever it encounters an opaque ty (e.g. impl trait) which is again common in async land</p>



<a name="177575376"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177575376" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177575376">(Oct 08 2019 at 01:01)</a>:</h4>
<p>though how you'd be able to confirm this theory I'm not sure</p>



<a name="177575427"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177575427" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177575427">(Oct 08 2019 at 01:02)</a>:</h4>
<p>I guess you can try with a compiler that does not have <a href="https://github.com/rust-lang/rust/blob/f3c9cece7b6829e6fd7854a1aee6a1619a81a38c/src/librustc_typeck/check/mod.rs#L1570-L1573" target="_blank" title="https://github.com/rust-lang/rust/blob/f3c9cece7b6829e6fd7854a1aee6a1619a81a38c/src/librustc_typeck/check/mod.rs#L1570-L1573">these three lines</a> by just commenting them out</p>



<a name="177575449"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177575449" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177575449">(Oct 08 2019 at 01:03)</a>:</h4>
<p>okay, I can try that</p>



<a name="177575515"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177575515" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177575515">(Oct 08 2019 at 01:04)</a>:</h4>
<p>one unfortunate bit is that it might be that this is just "bad defaults"</p>



<a name="177575525"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177575525" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177575525">(Oct 08 2019 at 01:05)</a>:</h4>
<p>previously, before async/await, we sort of always expected lists of generics etc in the compiler to be short, so all queries assume 8 elements as the default length before switching from a SmallVec to a Vec</p>



<a name="177575531"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177575531" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177575531">(Oct 08 2019 at 01:05)</a>:</h4>
<p>if we're going over that frequently that can be a performance cliff I imagine</p>



<a name="177575676"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177575676" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177575676">(Oct 08 2019 at 01:08)</a>:</h4>
<p>yeah, but this slowdown didn't happen in a compiler from a month ago</p>



<a name="177575700"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177575700" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177575700">(Oct 08 2019 at 01:09)</a>:</h4>
<p>true, yeah</p>



<a name="177575710"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177575710" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177575710">(Oct 08 2019 at 01:09)</a>:</h4>
<p>I think something went from <code>O(N)</code> to <code>O(N^2)</code> or similar</p>



<a name="177575768"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177575768" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177575768">(Oct 08 2019 at 01:10)</a>:</h4>
<p>possibly -- this is a pretty weird query to be seeing the slow down in, since it's not really responsible for much</p>



<a name="177576025"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177576025" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177576025">(Oct 08 2019 at 01:17)</a>:</h4>
<p>flamegraph with many more samples: <a href="/user_uploads/4715/7LMFsUpTUfZAVz1BQSW430kY/flamegraph.1.svg" target="_blank" title="flamegraph.1.svg">flamegraph.1.svg</a></p>



<a name="177576039"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177576039" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177576039">(Oct 08 2019 at 01:17)</a>:</h4>
<p>hm that's really weird</p>



<a name="177576085"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177576085" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177576085">(Oct 08 2019 at 01:18)</a>:</h4>
<p><code>perf script</code> doesn't show anything either I presume? i.e., if you look for the smallvec bits</p>



<a name="177576113"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177576113" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177576113">(Oct 08 2019 at 01:19)</a>:</h4>
<p>I guess technically one thing you could try beyond just commenting the 3 lines is just sticking a <code>return;</code> at the top of the function - I believe this is strictly checking not inference etc so it should be a working (if buggy, in the sense that errors are no longer caught) compiler</p>



<a name="177576176"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177576176" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177576176">(Oct 08 2019 at 01:20)</a>:</h4>
<p>I am surprised at the lack of callchains though</p>



<a name="177576179"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177576179" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177576179">(Oct 08 2019 at 01:20)</a>:</h4>
<p>maybe incremental is to blame? that's the only thing I can think of</p>



<a name="177576190"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177576190" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177576190">(Oct 08 2019 at 01:21)</a>:</h4>
<p>one thing from <code>perf script</code> that looks interesting:</p>
<div class="codehilite"><pre><span></span>&lt;rustc::ty::util::&lt;impl rustc::ty::context::TyCtxt&gt;::try_expand_impl_trait_type::OpaqueTypeExpander as rustc::ty::fold::TypeFolder&gt;::fold_ty+0x113 (inlined)
</pre></div>



<a name="177576202"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177576202" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177576202">(Oct 08 2019 at 01:22)</a>:</h4>
<p>that's <a href="https://github.com/rust-lang/rust/blob/f3c9cece7b6829e6fd7854a1aee6a1619a81a38c/src/librustc/ty/util.rs#L694" target="_blank" title="https://github.com/rust-lang/rust/blob/f3c9cece7b6829e6fd7854a1aee6a1619a81a38c/src/librustc/ty/util.rs#L694">https://github.com/rust-lang/rust/blob/f3c9cece7b6829e6fd7854a1aee6a1619a81a38c/src/librustc/ty/util.rs#L694</a></p>



<a name="177576252"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177576252" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177576252">(Oct 08 2019 at 01:22)</a>:</h4>
<p>which could be slow, I guess</p>



<a name="177576262"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177576262" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177576262">(Oct 08 2019 at 01:23)</a>:</h4>
<p>I mean I'm just cherry picking</p>



<a name="177576271"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177576271" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177576271">(Oct 08 2019 at 01:23)</a>:</h4>
<p>that's from the 3 lines I suggested to comment out though</p>



<a name="177576274"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177576274" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177576274">(Oct 08 2019 at 01:23)</a>:</h4>
<p>(did you try that yet?)</p>



<a name="177576276"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177576276" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177576276">(Oct 08 2019 at 01:23)</a>:</h4>
<p>yeah, I'm building it now</p>



<a name="177576279"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177576279" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177576279">(Oct 08 2019 at 01:23)</a>:</h4>
<p>ah okay :)</p>



<a name="177576322"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177576322" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177576322">(Oct 08 2019 at 01:24)</a>:</h4>
<p>it's slow because I have to build a stage2 compiler (cross compiling)</p>



<a name="177576334"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177576334" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177576334">(Oct 08 2019 at 01:24)</a>:</h4>
<p>not sure how hard it would be to build this for my linux machine</p>



<a name="177576337"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177576337" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177576337">(Oct 08 2019 at 01:25)</a>:</h4>
<p>this crate that is</p>



<a name="177576351"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177576351" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177576351">(Oct 08 2019 at 01:25)</a>:</h4>
<p>I do have to head out though.. I'll check back later and post anything I learn in here and on the issue</p>



<a name="177576352"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177576352" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177576352">(Oct 08 2019 at 01:25)</a>:</h4>
<p>unless there's e.g. <a href="http://build.rs" target="_blank" title="http://build.rs">build.rs</a> involved a cargo check --target would likely work w/o stage 2 build, I imagine?</p>



<a name="177576359"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177576359" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177576359">(Oct 08 2019 at 01:25)</a>:</h4>
<p>mm maybe, but we don't use cargo :P</p>



<a name="177576362"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177576362" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177576362">(Oct 08 2019 at 01:26)</a>:</h4>
<p>e.g. <code>x.py build --stage 1 --target &lt;target&gt; src/libtest</code> and then <code>cargo +stage1 check --target &lt;target&gt;</code></p>



<a name="177576411"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177576411" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177576411">(Oct 08 2019 at 01:26)</a>:</h4>
<p>well, the rustc binary would just work for that target if you did the x.py build first</p>



<a name="177576412"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177576412" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177576412">(Oct 08 2019 at 01:26)</a>:</h4>
<p>in theory</p>



<a name="177576418"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177576418" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177576418">(Oct 08 2019 at 01:26)</a>:</h4>
<p>good to know. I don't think we have the ability to do <code>check</code> in our build system but I could hack it in</p>



<a name="177576426"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177576426" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177576426">(Oct 08 2019 at 01:27)</a>:</h4>
<p>to be clear you could plausibly even do build, but that has a linker dependency and you might not be able to satisfy that for said target</p>



<a name="177576434"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177576434" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177576434">(Oct 08 2019 at 01:27)</a>:</h4>
<p>I guess you'd need the linker to get a std for said target in stage 2, so it should "just work" I would think</p>



<a name="177576475"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177576475" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177576475">(Oct 08 2019 at 01:28)</a>:</h4>
<p>if not feel free to bug me :)</p>



<a name="177576589"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177576589" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177576589">(Oct 08 2019 at 01:31)</a>:</h4>
<p>okay, I'll start building it that way, this should save me some time :)</p>



<a name="177576597"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177576597" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177576597">(Oct 08 2019 at 01:31)</a>:</h4>
<p>I have to go now though</p>



<a name="177576600"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177576600" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177576600">(Oct 08 2019 at 01:31)</a>:</h4>
<p>thanks for all your help!!</p>



<a name="177576905"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177576905" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177576905">(Oct 08 2019 at 01:36)</a>:</h4>
<p>There was a PR somewhere around related to collecting into SmallVec</p>



<a name="177576917"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177576917" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177576917">(Oct 08 2019 at 01:36)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/pull/64949" target="_blank" title="https://github.com/rust-lang/rust/pull/64949">https://github.com/rust-lang/rust/pull/64949</a></p>



<a name="177576946"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177576946" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177576946">(Oct 08 2019 at 01:37)</a>:</h4>
<p>(<code>from_iter</code> == <code>collect</code> pretty much)</p>



<a name="177577008"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177577008" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177577008">(Oct 08 2019 at 01:38)</a>:</h4>
<p><span class="user-mention" data-user-id="116883">@tmandry</span> ^ pinging just so you notice before you spend too much time on it</p>



<a name="177584160"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177584160" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177584160">(Oct 08 2019 at 04:50)</a>:</h4>
<p>thanks. unfortunately I lost access to my workstation so I'll have to wait until tomorrow to make more progress.</p>



<a name="177619693"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177619693" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177619693">(Oct 08 2019 at 14:21)</a>:</h4>
<p>there are some problems with perf and deep stacks</p>



<a name="177619725"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177619725" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177619725">(Oct 08 2019 at 14:21)</a>:</h4>
<p>there's a hard coded limit of 2^16 bytes of stack data being collected or something</p>



<a name="177619735"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177619735" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177619735">(Oct 08 2019 at 14:21)</a>:</h4>
<p>which is rather hard to circumvent</p>



<a name="177619746"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177619746" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177619746">(Oct 08 2019 at 14:21)</a>:</h4>
<p>that leads to the "bottom" of a stack trace being cut off</p>



<a name="177619769"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177619769" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177619769">(Oct 08 2019 at 14:21)</a>:</h4>
<p>in general, I've found perf has become quite unuseful lately</p>



<a name="177639365"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177639365" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177639365">(Oct 08 2019 at 17:35)</a>:</h4>
<p>I just confirmed that the slowdown is indeed inside <code>check_item_type</code> for opaque types</p>



<a name="177647425"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177647425" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177647425">(Oct 08 2019 at 18:58)</a>:</h4>
<p><span class="user-mention" data-user-id="116883">@tmandry</span> I guess digging in by just commenting and rebuilding would be the next step unfortunately -- maybe you could try eprintln!(...) at some random places since the number of queries executed is low</p>



<a name="177664672"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177664672" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177664672">(Oct 08 2019 at 22:18)</a>:</h4>
<p>ah, so the PR that <span class="user-mention" data-user-id="123586">@nagisa</span> linked does indeed seem to fix this issue</p>



<a name="177664847"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177664847" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177664847">(Oct 08 2019 at 22:21)</a>:</h4>
<p>that's.. a crazy speedup</p>



<a name="177669144"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177669144" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177669144">(Oct 08 2019 at 23:28)</a>:</h4>
<p>glad my wikipedia could save you some effort!</p>



<a name="177674382"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177674382" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177674382">(Oct 09 2019 at 01:24)</a>:</h4>
<p>ah, nevermind.. I may have been confused</p>



<a name="177674395"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177674395" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177674395">(Oct 09 2019 at 01:25)</a>:</h4>
<p>Welp. I was worried that it would not help, as the stack trace you have is in an entirely different place.</p>



<a name="177674402"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177674402" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177674402">(Oct 09 2019 at 01:25)</a>:</h4>
<p>but perhaps something similar in the location you are seeing issues would be beneficial</p>



<a name="177674523"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177674523" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177674523">(Oct 09 2019 at 01:28)</a>:</h4>
<p>yeah, maybe</p>



<a name="177674528"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177674528" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177674528">(Oct 09 2019 at 01:28)</a>:</h4>
<p>it happens when checking for cycles inside opaque types</p>



<a name="177674540"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177674540" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177674540">(Oct 09 2019 at 01:29)</a>:</h4>
<p>which is one of the backtraces I posted yesterday, but I wasn't sure then</p>



<a name="177674541"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177674541" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177674541">(Oct 09 2019 at 01:29)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/blob/f3c9cece7b6829e6fd7854a1aee6a1619a81a38c/src/librustc/ty/util.rs#L694" target="_blank" title="https://github.com/rust-lang/rust/blob/f3c9cece7b6829e6fd7854a1aee6a1619a81a38c/src/librustc/ty/util.rs#L694">https://github.com/rust-lang/rust/blob/f3c9cece7b6829e6fd7854a1aee6a1619a81a38c/src/librustc/ty/util.rs#L694</a></p>



<a name="177674692"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177674692" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177674692">(Oct 09 2019 at 01:32)</a>:</h4>
<p>which I think actually delegates to some of the code changed in that PR (the <code>substs.fold_with(self)</code>)</p>



<a name="177674712"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177674712" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177674712">(Oct 09 2019 at 01:33)</a>:</h4>
<p>It would be good to be sure that that expander is responsible (easiest way is probably to comment it out)</p>



<a name="177674765"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177674765" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177674765">(Oct 09 2019 at 01:34)</a>:</h4>
<p>though I suspect you are right that it is</p>



<a name="177675777"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177675777" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177675777">(Oct 09 2019 at 01:59)</a>:</h4>
<p>working on double checking that..</p>



<a name="177675780"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177675780" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177675780">(Oct 09 2019 at 01:59)</a>:</h4>
<p>in the meantime, I tried building with the stage 1 compiler and it complains about not finding std</p>



<a name="177676044"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177676044" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177676044">(Oct 09 2019 at 02:05)</a>:</h4>
<p>cargo also doesn't get put in <code>stage1/bin</code>, so I symlinked it (we use cargo for third-party crates right now)</p>



<a name="177676089"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177676089" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177676089">(Oct 09 2019 at 02:06)</a>:</h4>
<p>but when it comes to rustbuild hackery I mostly have no idea what I'm doing <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="177676839"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177676839" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177676839">(Oct 09 2019 at 02:23)</a>:</h4>
<p>double checked and the slowdown is definitely happening inside <code>check_opaque_for_cycles</code>, btw</p>



<a name="177676909"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177676909" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177676909">(Oct 09 2019 at 02:24)</a>:</h4>
<p>I added a log to see all the types it folds.. this may have been a mistake :D</p>



<a name="177677137"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177677137" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177677137">(Oct 09 2019 at 02:32)</a>:</h4>
<p><a href="https://gist.githubusercontent.com/tmandry/f172f0ac2f2bfc21d0e3fc1b89eeb9d6/raw/acdeeceda8145a650f081e30eba86fd4a8e5501d/rustc.log" target="_blank" title="https://gist.githubusercontent.com/tmandry/f172f0ac2f2bfc21d0e3fc1b89eeb9d6/raw/acdeeceda8145a650f081e30eba86fd4a8e5501d/rustc.log">https://gist.githubusercontent.com/tmandry/f172f0ac2f2bfc21d0e3fc1b89eeb9d6/raw/acdeeceda8145a650f081e30eba86fd4a8e5501d/rustc.log</a></p>



<a name="177677185"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177677185" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177677185">(Oct 09 2019 at 02:32)</a>:</h4>
<p>there's the type that kills rustc</p>



<a name="177682950"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177682950" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177682950">(Oct 09 2019 at 05:01)</a>:</h4>
<p>(actually nevermind what I said about the stage1 compiler.. I'm able to build the target I care about with it)</p>



<a name="177685521"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177685521" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177685521">(Oct 09 2019 at 06:09)</a>:</h4>
<p>So I'm thinking that when one OpaqueTypeExpander visits &gt;3 billion types, something's gone wrong?</p>



<a name="177685749"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177685749" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177685749">(Oct 09 2019 at 06:14)</a>:</h4>
<p>here's a <a href="https://gist.githubusercontent.com/tmandry/8db91623488977f038b8e75e8b9902d6/raw/248b864707715561cce6464f72175f05140ac132/debug.log" target="_blank" title="https://gist.githubusercontent.com/tmandry/8db91623488977f038b8e75e8b9902d6/raw/248b864707715561cce6464f72175f05140ac132/debug.log">log of try_expand_impl_trait_type</a>, search for <code>seen=</code></p>



<a name="177685755"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177685755" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177685755">(Oct 09 2019 at 06:14)</a>:</h4>
<p>produced by <a href="https://github.com/tmandry/rust/commit/ca8b798d96b2dcd0d17c787116416f46e733232b" target="_blank" title="https://github.com/tmandry/rust/commit/ca8b798d96b2dcd0d17c787116416f46e733232b">these debug logs</a></p>



<a name="177685785"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177685785" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177685785">(Oct 09 2019 at 06:15)</a>:</h4>
<p>some very gnarly types in there..</p>



<a name="177686288"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177686288" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177686288">(Oct 09 2019 at 06:29)</a>:</h4>
<p>cc <span class="user-mention" data-user-id="116118">@Matthew Jasper</span></p>



<a name="177686427"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177686427" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177686427">(Oct 09 2019 at 06:33)</a>:</h4>
<p>to summarize, <code>try_expand_impl_trait_type</code> takes a long time on some nasty types produced by deep async fn call stacks; see the two links I pasted above, as well as <a href="https://github.com/rust-lang/rust/issues/65147" target="_blank" title="https://github.com/rust-lang/rust/issues/65147">#65147</a></p>



<a name="177744886"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177744886" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177744886">(Oct 09 2019 at 18:57)</a>:</h4>
<p>that type has 386 regions...</p>



<a name="177746966"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177746966" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177746966">(Oct 09 2019 at 19:22)</a>:</h4>
<p>A couple of things to try:</p>
<ol>
<li>Change this to <code>else if t.has_projections() { ... } else { t }</code>https://github.com/rust-lang/rust/blob/9b91bef78b15dfecc5144b0575f40a2d84ea795a/src/librustc/ty/util.rs#L738</li>
<li>Store a cache of opaque types and what they expand to in the visitor.</li>
</ol>



<a name="177761701"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177761701" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177761701">(Oct 09 2019 at 22:27)</a>:</h4>
<p><span class="user-mention" data-user-id="116118">@Matthew Jasper</span> thank you. your first suggestion helped a lot!</p>



<a name="177761759"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177761759" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177761759">(Oct 09 2019 at 22:28)</a>:</h4>
<p>it brought the number of types visited down from 3 billion to a modest 21 million <span aria-label="smile" class="emoji emoji-263a" role="img" title="smile">:smile:</span></p>



<a name="177761766"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177761766" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177761766">(Oct 09 2019 at 22:28)</a>:</h4>
<p>more importantly, the compile time is sane again</p>



<a name="177762792"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177762792" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177762792">(Oct 09 2019 at 22:45)</a>:</h4>
<p>it's still a significant regression from a month ago, so I'm working on tracking down what changed.</p>



<a name="177774172"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177774172" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177774172">(Oct 10 2019 at 02:35)</a>:</h4>
<p>oh wow, adding a cache brought it down to around a thousand, and the compile time is better than it ever was before <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="177775697"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177775697" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177775697">(Oct 10 2019 at 03:16)</a>:</h4>
<p><span class="user-mention" data-user-id="116118">@Matthew Jasper</span> can you explain why (1) is correct? like, what if I had <code>Vec&lt;Foo::Item&gt;</code>, or <code>Vec&lt;Bar&gt;</code> where <code>Bar</code> is an existential type?</p>



<a name="177775836"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177775836" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177775836">(Oct 10 2019 at 03:20)</a>:</h4>
<p>(I'm assuming having generic params is not considering having projections.. but maybe I'm wrong)</p>



<a name="177800622"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177800622" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177800622">(Oct 10 2019 at 11:33)</a>:</h4>
<p><code>has_projections</code> will return true for both of those type: it recurses on the generic arguments of a type. So <code>Vec&lt;impl X&gt;</code> <code>has_projections</code> because <code>impl X</code> <code>has_projections</code>.</p>



<a name="177800778"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177800778" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177800778">(Oct 10 2019 at 11:36)</a>:</h4>
<p>Type flags are cached so calling <code>has_projections</code> doesn't have to do the recursion here.</p>



<a name="177858502"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177858502" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177858502">(Oct 10 2019 at 22:10)</a>:</h4>
<p>ohh, makes sense, thanks!</p>



<a name="177860356"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177860356" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177860356">(Oct 10 2019 at 22:37)</a>:</h4>
<p>Well done!</p>



<a name="177860383"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/177860383" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#177860383">(Oct 10 2019 at 22:37)</a>:</h4>
<p>Nothing beats the feeling making O(unreasonable) a N(effectively 1) :D</p>



<a name="178220888"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/178220888" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#178220888">(Oct 15 2019 at 18:29)</a>:</h4>
<p><span class="user-mention" data-user-id="116118">@Matthew Jasper</span> Can you take another look at <a href="https://github.com/rust-lang/rust/issues/65293" target="_blank" title="https://github.com/rust-lang/rust/issues/65293">#65293</a> today? I think it's ready to go</p>



<a name="178221070"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/178221070" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#178221070">(Oct 15 2019 at 18:31)</a>:</h4>
<p>Have you forgotten to push? I can't see any changes since I reviewed.</p>



<a name="178225299"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/178225299" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#178225299">(Oct 15 2019 at 19:17)</a>:</h4>
<p><span class="user-mention" data-user-id="116118">@Matthew Jasper</span> sigh.. yes, sorry about that. my tracking branch was misconfigured somehow.</p>



<a name="178225433"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/%2365147%20check_mod_item_types%20slowdown/near/178225433" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/.2365147.20check_mod_item_types.20slowdown.html#178225433">(Oct 15 2019 at 19:19)</a>:</h4>
<p>it's pushed now.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>