<html>
<head><meta charset="utf-8"><title>Paths of async APIs in std · wg-async-foundations · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/index.html">wg-async-foundations</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html">Paths of async APIs in std</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="264964236"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/264964236" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#264964236">(Dec 15 2021 at 04:29)</a>:</h4>
<p>Who remembers the rationale for the current approach of putting async APIs behind top-level modules like <code>std::future</code> and <code>std::task</code>?</p>
<p>As we're talking about <a href="https://github.com/rust-lang/rfcs/pull/3208">renaming <code>std::stream::Stream</code> to <code>std::async_iter::AsyncIterator</code></a> I'm thinking about how many other modules like this will be introduced (I/O traits, executor traits, and so on) and wondering if we shouldn't have a central "entry point" for finding all of them in the module hierarchy itself.</p>



<a name="264964671"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/264964671" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#264964671">(Dec 15 2021 at 04:36)</a>:</h4>
<p>Personally I would love it if we could do this:</p>
<ul>
<li><code>std::async::iter::AsyncIterator</code> - predictable naming for async things that have analogues in the sync world</li>
<li><code>std::async::task::Task</code> - discoverability for things that <em>don't</em> have direct analogues, using the path to make it more obvious what they're <em>for</em></li>
</ul>
<p>But of course we can't now due to async being a keyword (and it might not even be possible to allow, though I don't actually see why not).</p>



<a name="264965744"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/264965744" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#264965744">(Dec 15 2021 at 04:55)</a>:</h4>
<p><span class="user-mention" data-user-id="116883">@tmandry</span> General <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span> for putting most things into a common module hierarchy, but I do think there's value in not having a single module for things that on the sync side would be in multiple places.</p>



<a name="264965802"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/264965802" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#264965802">(Dec 15 2021 at 04:56)</a>:</h4>
<p>For instance, I/O is in <code>std::io</code>, and filesystem stuff is in <code>std::fs</code>, and process stuff is in <code>std::process</code>, and I don't think the async equivalents should all be in the same module.</p>



<a name="264965830"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/264965830" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#264965830">(Dec 15 2021 at 04:57)</a>:</h4>
<p>So what I'm wondering is if we should have <code>std::async::io</code> and <code>std::async::fs</code> and so on</p>



<a name="264965917"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/264965917" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#264965917">(Dec 15 2021 at 04:58)</a>:</h4>
<p>(You could even imagine inverting the order.. <code>std::io::async</code>.. but that advantages discovering "there is an async version of this thing" over discovering "here are all the things you can do with async")</p>



<a name="264989794"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/264989794" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#264989794">(Dec 15 2021 at 10:35)</a>:</h4>
<p>+1 for std::async::io etc, however, we have already stabilised at least std::future, so not everything async will be in std::async</p>



<a name="264989823"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/264989823" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#264989823">(Dec 15 2021 at 10:35)</a>:</h4>
<p>not sure how/if that affects the consistency argument</p>



<a name="264994994"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/264994994" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#264994994">(Dec 15 2021 at 11:19)</a>:</h4>
<p><span class="user-mention" data-user-id="256841">@Nick Cameron</span> we could have a re-export to fix that consistency issue</p>



<a name="264995443"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/264995443" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#264995443">(Dec 15 2021 at 11:23)</a>:</h4>
<p>FWIW, I'd love to have an (opt-in) <code>async</code> prelude. <em>e.g.</em>, having to refer to three distinct modules in:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code>::<span class="n">core</span>::<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">future</span>::<span class="n">Future</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">marker</span>::<span class="n">PhantomPinned</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">pin</span>::<span class="n">Pin</span><span class="p">,</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
</code></pre></div>
<p>seems quite silly every time I write it <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="264996130"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/264996130" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#264996130">(Dec 15 2021 at 11:29)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232018">Daniel Henry-Mantilla</span> <a href="#narrow/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std/near/264994994">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="256841">Nick Cameron</span> we could have a re-export to fix that consistency issue</p>
</blockquote>
<p>True! It would still be a bit messy, but perhaps worth it for a long-term better scenario</p>



<a name="265003783"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265003783" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265003783">(Dec 15 2021 at 12:43)</a>:</h4>
<p>There's also the question of async overloading, which would let everything stay where it is now.</p>



<a name="265587250"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265587250" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265587250">(Dec 20 2021 at 16:43)</a>:</h4>
<p>Yeah, ideally we could follow Swift's example and expose the same APIs for both async and non-async Rust from their existing locations. <span class="user-mention" data-user-id="256841">@Nick Cameron</span> and I talked about taking a closer look at the feasibility of <a href="https://blog.yoshuawuyts.com/async-overloading/">async overloading</a> to hopefully provide some more clarity on this.</p>



<a name="265587601"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265587601" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265587601">(Dec 20 2021 at 16:46)</a>:</h4>
<p>+1 to consolidating the hierarchy; I'm not sure about having the overloaded API or not, though it is definitely appealing</p>



<a name="265587627"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265587627" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265587627">(Dec 20 2021 at 16:46)</a>:</h4>
<p>Coming from Node.js which has both <a href="https://nodejs.org/docs/latest-v15.x/api/fs.html"><code>fs.readdir</code> and <code>fs.readdirSync</code></a>-style  duplicates <em>everywhere</em>, if we could avoid that type of split in the stdlib it would be incredible.</p>



<a name="265599067"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265599067" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265599067">(Dec 20 2021 at 18:17)</a>:</h4>
<p>On the one hand, the idea of being able to just use <code>std::fs::FIle</code> sounds interesting and handy. On the other hand, I'm having a hard time imagining how we could reasonably do that without introducing issues. Sometimes you want to reference a sync API from an async function or vice versa. And conversely, how would we catch errors? If you forget the <code>.await</code>, does that mean you want the sync API or that you want the async API but forgot the <code>.await</code>?</p>



<a name="265599196"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265599196" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265599196">(Dec 20 2021 at 18:18)</a>:</h4>
<p>I'm rather tempted to have a parallel hierarchy, like <code>async::fs::File</code> (modulo keywordiness).</p>



<a name="265599839"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265599839" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265599839">(Dec 20 2021 at 18:24)</a>:</h4>
<p>I suppose it's possible to have both <code>sync</code> and <code>async</code> parallel hierarchies, and to have the default ones resolve based on where they're used.</p>



<a name="265600156"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265600156" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tmandry <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265600156">(Dec 20 2021 at 18:27)</a>:</h4>
<p>though we may want a more general convenient way to force sync/async resolution than with module hierarchies</p>



<a name="265609836"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265609836" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eholk <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265609836">(Dec 20 2021 at 20:04)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std/near/265599067">said</a>:</p>
<blockquote>
<p>Sometimes you want to reference a sync API from an async function or vice versa.</p>
</blockquote>
<p>Maybe if we support async overloading we also need to include something like a <code>sync { ... }</code> block that explicitly marks a section of code as sync.</p>



<a name="265610690"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265610690" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265610690">(Dec 20 2021 at 20:13)</a>:</h4>
<p>Or closures?</p>



<a name="265610756"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265610756" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265610756">(Dec 20 2021 at 20:14)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">async</span><span class="w"> </span><span class="k">fn</span> <span class="nf">bar</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">spawn_blocking</span><span class="p">(</span><span class="o">||</span><span class="w"> </span><span class="n">foo</span><span class="p">())</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="265610780"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265610780" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265610780">(Dec 20 2021 at 20:14)</a>:</h4>
<p>I would expect this to resolve to the sync version of <code>foo</code>.</p>



<a name="265610873"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265610873" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265610873">(Dec 20 2021 at 20:15)</a>:</h4>
<p>Not that I know why you would ever want to use the sync version over the async version.</p>



<a name="265610943"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265610943" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265610943">(Dec 20 2021 at 20:16)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">bar</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">async</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">foo</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="k">async</span><span class="w"> </span><span class="k">move</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">foo</span><span class="p">()</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="265610950"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265610950" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265610950">(Dec 20 2021 at 20:16)</a>:</h4>
<p>Would both use the async version then.</p>



<a name="265611515"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265611515" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265611515">(Dec 20 2021 at 20:22)</a>:</h4>
<p>So then the rules would be:</p>
<ul>
<li>In a sync fn/closure: sync version</li>
<li>In a async fn/closure/block: async version</li>
</ul>



<a name="265611563"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265611563" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265611563">(Dec 20 2021 at 20:23)</a>:</h4>
<p>I think that would work.</p>



<a name="265623401"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265623401" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265623401">(Dec 20 2021 at 22:28)</a>:</h4>
<p>That would effectively be adopting the "implicit await" proposal from a while back.</p>



<a name="265623421"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265623421" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265623421">(Dec 20 2021 at 22:29)</a>:</h4>
<p>I think all the discussion points raised during that proposal would apply.</p>



<a name="265624128"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265624128" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265624128">(Dec 20 2021 at 22:37)</a>:</h4>
<blockquote>
<p>That would effectively be adopting the "implicit await" proposal from a while back.</p>
</blockquote>
<p>How so?</p>



<a name="265624135"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265624135" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265624135">(Dec 20 2021 at 22:37)</a>:</h4>
<p>There's no implicit await here</p>



<a name="265624221"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265624221" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265624221">(Dec 20 2021 at 22:38)</a>:</h4>
<p>You just have to enter an async context to call the async version of the function.</p>



<a name="265624243"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265624243" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265624243">(Dec 20 2021 at 22:39)</a>:</h4>
<p>Which, in a sync function, means wrapping the call in an async block/closure</p>



<a name="265624258"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265624258" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265624258">(Dec 20 2021 at 22:39)</a>:</h4>
<p>You still have to await the async block to run the future</p>



<a name="265624389"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265624389" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265624389">(Dec 20 2021 at 22:40)</a>:</h4>
<p><span class="user-mention" data-user-id="363998">@Ibraheem Ahmed</span> OK, then just part of that proposal. But still: that means you can't call <code>async_func()</code> to get a future, in a sync function, then <em>pass</em> that future to an async context.</p>



<a name="265624550"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265624550" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265624550">(Dec 20 2021 at 22:42)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="c1">// sync context</span>
<span class="kd">let</span><span class="w"> </span><span class="n">fut</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">async_func</span><span class="p">();</span><span class="w"></span>
<span class="n">work_with_future</span><span class="p">(</span><span class="n">fut</span><span class="p">);</span><span class="w"></span>
</code></pre></div>



<a name="265624575"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265624575" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265624575">(Dec 20 2021 at 22:43)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="c1">// sync context</span>
<span class="kd">let</span><span class="w"> </span><span class="n">fut</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">func</span><span class="p">().</span><span class="k">await</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
<span class="n">work_with_future</span><span class="p">(</span><span class="n">fut</span><span class="p">);</span><span class="w"></span>
</code></pre></div>



<a name="265624592"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265624592" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265624592">(Dec 20 2021 at 22:43)</a>:</h4>
<p>Oh, sorry, maybe the confusion is from my example.</p>



<a name="265624593"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265624593" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265624593">(Dec 20 2021 at 22:43)</a>:</h4>
<p><span class="user-mention" data-user-id="363998">@Ibraheem Ahmed</span> I realize that's <em>possible</em>, but that's the same kind of problem that existed in the implicit-await proposal.</p>



<a name="265624601"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265624601" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265624601">(Dec 20 2021 at 22:43)</a>:</h4>
<p>It should be <code>async || foo().await</code>, not <code>async || foo()</code></p>



<a name="265624679"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265624679" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265624679">(Dec 20 2021 at 22:44)</a>:</h4>
<p>The failure mode here goes from "you called an async function in a sync context and that doesn't work" to "you called an async function in a sync context so it did an unexpected sync thing instead".</p>



<a name="265624763"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265624763" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265624763">(Dec 20 2021 at 22:45)</a>:</h4>
<p>Well in a sync context, the default is calling the sync thing. If you expected to call the async thing and get a future, then somewhere down the line you will get a type error <code>Expected impl Future&lt;Output = T&gt;, found T</code></p>



<a name="265624768"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265624768" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265624768">(Dec 20 2021 at 22:45)</a>:</h4>
<p>And I think that's fine.</p>



<a name="265624776"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265624776" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265624776">(Dec 20 2021 at 22:45)</a>:</h4>
<p>Interesting point.</p>



<a name="265624828"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265624828" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265624828">(Dec 20 2021 at 22:46)</a>:</h4>
<p>In the interests of fairness, I should also note that a <em>similar</em> failure mode applies to accidentally calling the sync version of an async function, even if it has a different path; after all, you could accidentally call <code>std::fs::File</code> instead of <code>std::async::fs::File</code> or equivalent, especially if you have imports such that that's just <code>fs::File</code> or <code>File</code> and you don't realize it's the wrong one.</p>



<a name="265624904"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265624904" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265624904">(Dec 20 2021 at 22:47)</a>:</h4>
<p>I would also note that <code>async { async_func().await }</code> seems excessively verbose compared to <code>async_func()</code>, especially if you need to do it more than once for different futures, such as if you're calling <code>or</code> or similar.</p>



<a name="265624917"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265624917" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265624917">(Dec 20 2021 at 22:47)</a>:</h4>
<p>Comparison:</p>



<a name="265624943"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265624943" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265624943">(Dec 20 2021 at 22:47)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">fut</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">or</span><span class="o">!</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">async_func1</span><span class="p">().</span><span class="k">await</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">async_func2</span><span class="p">().</span><span class="k">await</span><span class="w"> </span><span class="p">});</span><span class="w"></span>
</code></pre></div>



<a name="265625002"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265625002" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265625002">(Dec 20 2021 at 22:48)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">fut</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">or</span><span class="o">!</span><span class="p">(</span><span class="n">async_func1</span><span class="p">(),</span><span class="w"> </span><span class="n">async_func2</span><span class="p">());</span><span class="w"></span>
</code></pre></div>



<a name="265625016"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265625016" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265625016">(Dec 20 2021 at 22:48)</a>:</h4>
<p>Well, you just have to enter an async context.</p>



<a name="265625039"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265625039" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265625039">(Dec 20 2021 at 22:48)</a>:</h4>
<p>Every future doesn't have to be wrapped in an individual async block.</p>



<a name="265625046"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265625046" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265625046">(Dec 20 2021 at 22:48)</a>:</h4>
<p>I suppose you could <em>also</em> spell that as:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">fut</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">or</span><span class="o">!</span><span class="p">(</span><span class="n">async_func1</span><span class="p">(),</span><span class="w"> </span><span class="n">async_func2</span><span class="p">()).</span><span class="k">await</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
</code></pre></div>



<a name="265625048"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265625048" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265625048">(Dec 20 2021 at 22:49)</a>:</h4>
<p>Yeah</p>



<a name="265625065"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265625065" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265625065">(Dec 20 2021 at 22:49)</a>:</h4>
<p>I don't think that's too bad.</p>



<a name="265625081"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265625081" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265625081">(Dec 20 2021 at 22:49)</a>:</h4>
<p>That still feels like a verbose cost to impose, just so that we can do async overloading.</p>



<a name="265625108"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265625108" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265625108">(Dec 20 2021 at 22:49)</a>:</h4>
<p>Plus, it adds to the context-sensitivity of the language, versus having a given path just be a given function.</p>



<a name="265625403"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265625403" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265625403">(Dec 20 2021 at 22:52)</a>:</h4>
<p><code>async</code> as a call-site modifier is also an option.</p>



<a name="265625415"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265625415" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265625415">(Dec 20 2021 at 22:52)</a>:</h4>
<p>I know that was discussed a lot during the async/await bikeshed.</p>



<a name="265625431"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265625431" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265625431">(Dec 20 2021 at 22:52)</a>:</h4>
<p>Along the lines of <code>async f()</code> rather than <code>async { f().await }</code>?</p>



<a name="265625438"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265625438" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265625438">(Dec 20 2021 at 22:52)</a>:</h4>
<p>It's also what Zig does for their "colourless async"</p>



<a name="265625441"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265625441" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265625441">(Dec 20 2021 at 22:52)</a>:</h4>
<p>Yeah</p>



<a name="265625472"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265625472" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265625472">(Dec 20 2021 at 22:53)</a>:</h4>
<p>Do you mean <em>everywhere</em>, or everywhere that's not in an async context already?</p>



<a name="265625483"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265625483" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265625483">(Dec 20 2021 at 22:53)</a>:</h4>
<p>(and in the latter case, wouldn't we also need a sync modifier?)</p>



<a name="265625525"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265625525" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265625525">(Dec 20 2021 at 22:53)</a>:</h4>
<p>Well, I think it is probably too late for <em>everywhere</em> :)</p>



<a name="265625599"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265625599" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265625599">(Dec 20 2021 at 22:54)</a>:</h4>
<p>I think <em>everywhere</em> would also be an even more verbose cost.</p>



<a name="265625607"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265625607" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265625607">(Dec 20 2021 at 22:54)</a>:</h4>
<p>True</p>



<a name="265625641"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265625641" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265625641">(Dec 20 2021 at 22:55)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">fut</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="n">or</span><span class="o">!</span><span class="p">(</span><span class="n">async_func1</span><span class="p">(),</span><span class="w"> </span><span class="n">async_func2</span><span class="p">());</span><span class="w"></span>
<span class="c1">// =&gt; let fut = async { or!(async_func1(), async_func2()).await };</span>
</code></pre></div>



<a name="265625678"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265625678" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265625678">(Dec 20 2021 at 22:55)</a>:</h4>
<p>To be fair the cost of the async wrapping is only imposed on the odd case.</p>



<a name="265625779"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265625779" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265625779">(Dec 20 2021 at 22:56)</a>:</h4>
<p>For <em>most</em> users, it would ideally "just work"</p>



<a name="265625827"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265625827" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265625827">(Dec 20 2021 at 22:57)</a>:</h4>
<p>There's already an extra cost to do things like setup work before returning a future.</p>



<a name="265625939"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265625939" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265625939">(Dec 20 2021 at 22:58)</a>:</h4>
<p>Where the default async/await semantics don't quite work.</p>



<a name="265626030"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265626030" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265626030">(Dec 20 2021 at 22:59)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">foo</span><span class="o">&lt;'</span><span class="na">a</span><span class="p">,</span><span class="w"> </span><span class="o">'</span><span class="na">b</span><span class="o">&gt;</span><span class="p">(</span><span class="n">a</span>: <span class="kp">&amp;</span><span class="o">'</span><span class="na">a</span> <span class="kt">str</span><span class="p">,</span><span class="w"> </span><span class="n">b</span>: <span class="kp">&amp;</span><span class="o">'</span><span class="na">b</span> <span class="kt">str</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">impl</span><span class="w"> </span><span class="n">Future</span><span class="o">&lt;</span><span class="n">Output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">'</span><span class="na">b</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">async</span><span class="w"> </span><span class="k">move</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="265635357"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/187312-wg-async-foundations/topic/Paths%20of%20async%20APIs%20in%20std/near/265635357" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/187312-wg-async-foundations/topic/Paths.20of.20async.20APIs.20in.20std.html#265635357">(Dec 21 2021 at 01:00)</a>:</h4>
<p>On that tangent: <a href="https://docs.rs/async_fn/0.0.2/async_fn/macro.before_async.html#eager-vs-lazy--suspended-code">https://docs.rs/async_fn/0.0.2/async_fn/macro.before_async.html#eager-vs-lazy--suspended-code</a></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>