<html>
<head><meta charset="utf-8"><title>&quot;Improving trust in the Rust compiler&quot; design meeting · t-lang · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/index.html">t-lang</a></h2>
<h3>Topic: <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.22Improving.20trust.20in.20the.20Rust.20compiler.22.20design.20meeting.html">&quot;Improving trust in the Rust compiler&quot; design meeting</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://rust-lang.github.io/zulip_archive/style.css" rel="stylesheet"></head>

<a name="225414979"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%22Improving%20trust%20in%20the%20Rust%20compiler%22%20design%20meeting/near/225414979" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.22Improving.20trust.20in.20the.20Rust.20compiler.22.20design.20meeting.html#225414979">(Feb 06 2021 at 14:47)</a>:</h4>
<p><span class="user-mention" data-user-id="215333">@Florian Gilcher</span> so regarding <a href="https://github.com/rust-lang/lang-team/issues/79">https://github.com/rust-lang/lang-team/issues/79</a>, I am not sure I understand your comment in that issue</p>
<blockquote>
<p>I think for the scope of that meeting, "MIR and MIRI fit the picture well" is probably the level discussed on, but anything regarding sharp plans there is the scope for more focused sessions.</p>
</blockquote>
<p>Are you saying the first meeting will not be very technical (and thus likely not be very interesting for me)?</p>



<a name="225465664"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%22Improving%20trust%20in%20the%20Rust%20compiler%22%20design%20meeting/near/225465664" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Gilcher <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.22Improving.20trust.20in.20the.20Rust.20compiler.22.20design.20meeting.html#225465664">(Feb 07 2021 at 14:10)</a>:</h4>
<p><span class="user-mention" data-user-id="120791">@RalfJ</span> Ah! It will be somewhat technical, but as there's such a broad picture and aspects to discuss, I just assume that what we discuss will not go very deep into every aspect. I'd love to have your technical perspective around and it will definitely be interesting, but if it can't be made happen, I think it will be easy to watch a recording and pick the conversation up from there.</p>



<a name="226700355"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%22Improving%20trust%20in%20the%20Rust%20compiler%22%20design%20meeting/near/226700355" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.22Improving.20trust.20in.20the.20Rust.20compiler.22.20design.20meeting.html#226700355">(Feb 17 2021 at 18:14)</a>:</h4>
<p><a href="https://github.com/rust-lang/lang-team/files/5997688/lang-team-proposal-trust-levels-1613584473422.pdf">https://github.com/rust-lang/lang-team/files/5997688/lang-team-proposal-trust-levels-1613584473422.pdf</a> talks about versioned MIR. Would this just be a highlevel description, or would it be a binary format that could be used as part of .rmeta files?</p>



<a name="226702111"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%22Improving%20trust%20in%20the%20Rust%20compiler%22%20design%20meeting/near/226702111" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.22Improving.20trust.20in.20the.20Rust.20compiler.22.20design.20meeting.html#226702111">(Feb 17 2021 at 18:25)</a>:</h4>
<p>Based on reading the meeting notes, having a binary format is the intention.</p>



<a name="226702167"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%22Improving%20trust%20in%20the%20Rust%20compiler%22%20design%20meeting/near/226702167" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.22Improving.20trust.20in.20the.20Rust.20compiler.22.20design.20meeting.html#226702167">(Feb 17 2021 at 18:25)</a>:</h4>
<p>In that case it would also be necessary to somehow serialize the whole typesystem.</p>



<a name="226703248"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%22Improving%20trust%20in%20the%20Rust%20compiler%22%20design%20meeting/near/226703248" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.22Improving.20trust.20in.20the.20Rust.20compiler.22.20design.20meeting.html#226703248">(Feb 17 2021 at 18:30)</a>:</h4>
<p>As for the point of Josh against letting others produce MIR that some things are less well tested, miri has an open issue about wanting to create arbitrary MIR to be able to test that miri catches certain UB that only happens on MIR that a bug-free rustc wouldn't produce.</p>



<a name="226703364"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%22Improving%20trust%20in%20the%20Rust%20compiler%22%20design%20meeting/near/226703364" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.22Improving.20trust.20in.20the.20Rust.20compiler.22.20design.20meeting.html#226703364">(Feb 17 2021 at 18:31)</a>:</h4>
<p><a href="https://github.com/rust-lang/miri/issues/196">https://github.com/rust-lang/miri/issues/196</a></p>



<a name="226703488"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%22Improving%20trust%20in%20the%20Rust%20compiler%22%20design%20meeting/near/226703488" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.22Improving.20trust.20in.20the.20Rust.20compiler.22.20design.20meeting.html#226703488">(Feb 17 2021 at 18:32)</a>:</h4>
<p><span class="user-mention" data-user-id="133247">@bjorn3</span> Absolutely, and I think that's a good idea. The only reason I mentioned it was that <em>until</em> we've done that, the "surface area" of MIR that isn't generated by rustc is more problematic.</p>



<a name="226703552"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%22Improving%20trust%20in%20the%20Rust%20compiler%22%20design%20meeting/near/226703552" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.22Improving.20trust.20in.20the.20Rust.20compiler.22.20design.20meeting.html#226703552">(Feb 17 2021 at 18:32)</a>:</h4>
<p>So if there's a desire to be able to do that, we'd want to look closely at that verification work.</p>



<a name="226703773"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%22Improving%20trust%20in%20the%20Rust%20compiler%22%20design%20meeting/near/226703773" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.22Improving.20trust.20in.20the.20Rust.20compiler.22.20design.20meeting.html#226703773">(Feb 17 2021 at 18:34)</a>:</h4>
<p>Also, the idea of generating MIR from another language entirely is really interesting.</p>



<a name="226703866"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%22Improving%20trust%20in%20the%20Rust%20compiler%22%20design%20meeting/near/226703866" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.22Improving.20trust.20in.20the.20Rust.20compiler.22.20design.20meeting.html#226703866">(Feb 17 2021 at 18:34)</a>:</h4>
<p>Indeed</p>



<a name="226703874"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%22Improving%20trust%20in%20the%20Rust%20compiler%22%20design%20meeting/near/226703874" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.22Improving.20trust.20in.20the.20Rust.20compiler.22.20design.20meeting.html#226703874">(Feb 17 2021 at 18:34)</a>:</h4>
<p>/me wonders how hard it would be to build a C-to-MIR compiler.</p>



<a name="226704134"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%22Improving%20trust%20in%20the%20Rust%20compiler%22%20design%20meeting/near/226704134" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.22Improving.20trust.20in.20the.20Rust.20compiler.22.20design.20meeting.html#226704134">(Feb 17 2021 at 18:36)</a>:</h4>
<p>Hmmm. Is the expectation that borrow checking will always be based on MIR (in the NLL/Polonius world), or in theory could there be a better way to borrow-check that this would limit us from?</p>



<a name="226704950"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%22Improving%20trust%20in%20the%20Rust%20compiler%22%20design%20meeting/near/226704950" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.22Improving.20trust.20in.20the.20Rust.20compiler.22.20design.20meeting.html#226704950">(Feb 17 2021 at 18:42)</a>:</h4>
<p>there's an MCP for moving it to THIR</p>



<a name="226704984"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%22Improving%20trust%20in%20the%20Rust%20compiler%22%20design%20meeting/near/226704984" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.22Improving.20trust.20in.20the.20Rust.20compiler.22.20design.20meeting.html#226704984">(Feb 17 2021 at 18:42)</a>:</h4>
<p>accepted MCP, actually <a href="#narrow/stream/233931-t-compiler.2Fmajor-changes/topic/refactor.20the.20unsafe.20checking.20to.20work.20on.20t.E2.80.A6.20compiler-team.23402">https://rust-lang.zulipchat.com/#narrow/stream/233931-t-compiler.2Fmajor-changes/topic/refactor.20the.20unsafe.20checking.20to.20work.20on.20t.E2.80.A6.20compiler-team.23402</a></p>



<a name="226704992"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%22Improving%20trust%20in%20the%20Rust%20compiler%22%20design%20meeting/near/226704992" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.22Improving.20trust.20in.20the.20Rust.20compiler.22.20design.20meeting.html#226704992">(Feb 17 2021 at 18:42)</a>:</h4>
<p>That seems relevant.</p>



<a name="226705059"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%22Improving%20trust%20in%20the%20Rust%20compiler%22%20design%20meeting/near/226705059" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.22Improving.20trust.20in.20the.20Rust.20compiler.22.20design.20meeting.html#226705059">(Feb 17 2021 at 18:43)</a>:</h4>
<p>"unsafe checking" != "borrow checking"</p>



<a name="226705102"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%22Improving%20trust%20in%20the%20Rust%20compiler%22%20design%20meeting/near/226705102" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.22Improving.20trust.20in.20the.20Rust.20compiler.22.20design.20meeting.html#226705102">(Feb 17 2021 at 18:43)</a>:</h4>
<p>(i dont think borrow-checking is going to move to THIR.)</p>



<a name="226705111"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%22Improving%20trust%20in%20the%20Rust%20compiler%22%20design%20meeting/near/226705111" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.22Improving.20trust.20in.20the.20Rust.20compiler.22.20design.20meeting.html#226705111">(Feb 17 2021 at 18:43)</a>:</h4>
<p>oh oops, sorry</p>



<a name="226705352"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%22Improving%20trust%20in%20the%20Rust%20compiler%22%20design%20meeting/near/226705352" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.22Improving.20trust.20in.20the.20Rust.20compiler.22.20design.20meeting.html#226705352">(Feb 17 2021 at 18:45)</a>:</h4>
<p>The current borrow checking needs a CFG of some sort. MIR is <strong>the</strong> CFG representation of rustc.</p>



<a name="226707051"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%22Improving%20trust%20in%20the%20Rust%20compiler%22%20design%20meeting/near/226707051" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.22Improving.20trust.20in.20the.20Rust.20compiler.22.20design.20meeting.html#226707051">(Feb 17 2021 at 18:56)</a>:</h4>
<p>I have been thinking about a way to stabilize part of the crate metadata without stabilizing it completely in the past. While I was thinking about having tools like bindgen generate metadata that could directly be embedded into C static archives, I think it would also be useful for this case. Basically the metadata is split into multiple tables. One defining the basic structure of a crate with all module, type and function names. One for type definitions. One for MIR, one for spans and so on. The individual tables could be independently stabilized and versioned. Each tool and compiler would also be allowed to define new table types that are private to that tool. At the time I was thinking about the MIR, span tables and things like that being private to rustc, but in this case the MIR table would not be private, but instead versioned without stabilizing. In my idea the table defining the basic structure of a crate and the one defining type definitions would eventually be stable, but the <code>Rust</code> <code>#[repr]</code> wouldn't be. Only things like <code>C</code> and <code>packed</code>.</p>



<a name="226707195"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%22Improving%20trust%20in%20the%20Rust%20compiler%22%20design%20meeting/near/226707195" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.22Improving.20trust.20in.20the.20Rust.20compiler.22.20design.20meeting.html#226707195">(Feb 17 2021 at 18:57)</a>:</h4>
<p>I think it would be <em>plausible</em> to move borrow checking to THIR in a polonius-based world</p>



<a name="227178971"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%22Improving%20trust%20in%20the%20Rust%20compiler%22%20design%20meeting/near/227178971" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.22Improving.20trust.20in.20the.20Rust.20compiler.22.20design.20meeting.html#227178971">(Feb 21 2021 at 16:39)</a>:</h4>
<blockquote>
<p>There could be UB in Rust surface syntax that doesn't surface in MIR</p>
</blockquote>
<p>This is also a concern for Miri. It can be mitigated by adding special MIR instructions to represent the surface-level UB. I think representing all UB on the MIR level should be an explicit goal of a proper MIR spec -- if we cannot reach that code, surface Rust needs a full self-contained spec on its own, duplicating a lot of effort. If we want to specify surface Rust by translation to (a dialect of) MIR, we need all UB represented in MIR.</p>



<a name="227179111"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%22Improving%20trust%20in%20the%20Rust%20compiler%22%20design%20meeting/near/227179111" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.22Improving.20trust.20in.20the.20Rust.20compiler.22.20design.20meeting.html#227179111">(Feb 21 2021 at 16:41)</a>:</h4>
<blockquote>
<p>stablish MIRI as a minimal but extendable automated prover for MIR</p>
</blockquote>
<p>I am not entirely sure what you mean by "prover" -- do you really mean to extend Miri with e.g. symbolic execution, or do you mean "interpreter that is able to 'prove' UB-freedom of a single execution"?</p>



<a name="227244497"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%22Improving%20trust%20in%20the%20Rust%20compiler%22%20design%20meeting/near/227244497" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Gilcher <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.22Improving.20trust.20in.20the.20Rust.20compiler.22.20design.20meeting.html#227244497">(Feb 22 2021 at 10:16)</a>:</h4>
<p><span class="user-mention" data-user-id="120791">@RalfJ</span> I'm wondering if that case can occur outside of unsafe Rust?</p>



<a name="227244579"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%22Improving%20trust%20in%20the%20Rust%20compiler%22%20design%20meeting/near/227244579" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Gilcher <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.22Improving.20trust.20in.20the.20Rust.20compiler.22.20design.20meeting.html#227244579">(Feb 22 2021 at 10:17)</a>:</h4>
<p>From an industry perspective, "unsafe is out of scope" for the first iteration is okay.</p>



<a name="227245267"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%22Improving%20trust%20in%20the%20Rust%20compiler%22%20design%20meeting/near/227245267" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.22Improving.20trust.20in.20the.20Rust.20compiler.22.20design.20meeting.html#227245267">(Feb 22 2021 at 10:23)</a>:</h4>
<p>outside unsafe Rust there's no UB (or so we think :D)... I don't think I understand the question</p>



<a name="227252131"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%22Improving%20trust%20in%20the%20Rust%20compiler%22%20design%20meeting/near/227252131" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Gilcher <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.22Improving.20trust.20in.20the.20Rust.20compiler.22.20design.20meeting.html#227252131">(Feb 22 2021 at 11:26)</a>:</h4>
<p>Well, I just wanted to understand in which section of the specification process that would become an issue.</p>



<a name="227287829"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%22Improving%20trust%20in%20the%20Rust%20compiler%22%20design%20meeting/near/227287829" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.22Improving.20trust.20in.20the.20Rust.20compiler.22.20design.20meeting.html#227287829">(Feb 22 2021 at 15:53)</a>:</h4>
<p>Fundamentally, safe rust is a <em>subset</em> of the "full" unsafe rust language. So, saying that we can skip over it means that i think your initial specification will have some unfortunate holes. Like saying you want to specify "English but without adverbs".</p>



<a name="227288249"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%22Improving%20trust%20in%20the%20Rust%20compiler%22%20design%20meeting/near/227288249" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Gilcher <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.22Improving.20trust.20in.20the.20Rust.20compiler.22.20design.20meeting.html#227288249">(Feb 22 2021 at 15:56)</a>:</h4>
<p><span class="user-mention" data-user-id="224471">@Lokathor</span> which, in safety-critical industries is - and that's unintuitive - fine. you don't need completeness, you need to know where the holes are.</p>



<a name="227288597"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%22Improving%20trust%20in%20the%20Rust%20compiler%22%20design%20meeting/near/227288597" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.22Improving.20trust.20in.20the.20Rust.20compiler.22.20design.20meeting.html#227288597">(Feb 22 2021 at 15:58)</a>:</h4>
<p>well if you think so then i won't stop you, but you're right that it feels unintuitive.</p>



<a name="227288726"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%22Improving%20trust%20in%20the%20Rust%20compiler%22%20design%20meeting/near/227288726" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Gilcher <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.22Improving.20trust.20in.20the.20Rust.20compiler.22.20design.20meeting.html#227288726">(Feb 22 2021 at 15:59)</a>:</h4>
<p>Well, the thorny bit is: "is it blocking anything if we take that approach as a priority guidance"?</p>



<a name="227396303"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%22Improving%20trust%20in%20the%20Rust%20compiler%22%20design%20meeting/near/227396303" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.22Improving.20trust.20in.20the.20Rust.20compiler.22.20design.20meeting.html#227396303">(Feb 23 2021 at 08:29)</a>:</h4>
<p><span class="user-mention" data-user-id="215333">@Florian Gilcher</span> when you mean "unsafe is out of scope", do you mean "unsafe code the user writes" or "unsafe code anywhere in the program"? The latter seems impractical, but if there's unsafe code <em>anywhere</em> in the program then the spec better be able to talk about it, no?</p>



<a name="227402452"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%22Improving%20trust%20in%20the%20Rust%20compiler%22%20design%20meeting/near/227402452" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> isHavvy <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.22Improving.20trust.20in.20the.20Rust.20compiler.22.20design.20meeting.html#227402452">(Feb 23 2021 at 09:29)</a>:</h4>
<p>You can treat functions with unsafe e.g. stdlib functions as black boxes at that point.</p>



<a name="227403682"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%22Improving%20trust%20in%20the%20Rust%20compiler%22%20design%20meeting/near/227403682" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Gilcher <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.22Improving.20trust.20in.20the.20Rust.20compiler.22.20design.20meeting.html#227403682">(Feb 23 2021 at 09:40)</a>:</h4>
<p>exactly</p>



<a name="227403850"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%22Improving%20trust%20in%20the%20Rust%20compiler%22%20design%20meeting/near/227403850" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Gilcher <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.22Improving.20trust.20in.20the.20Rust.20compiler.22.20design.20meeting.html#227403850">(Feb 23 2021 at 09:42)</a>:</h4>
<p><span class="user-mention silent" data-user-id="120791">RalfJ</span> <a href="#narrow/stream/213817-t-lang/topic/.22Improving.20trust.20in.20the.20Rust.20compiler.22.20design.20meeting/near/227396303">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="215333">Florian Gilcher</span> when you mean "unsafe is out of scope", do you mean "unsafe code the user writes" or "unsafe code anywhere in the program"? The latter seems impractical, but if there's unsafe code <em>anywhere</em> in the program then the spec better be able to talk about it, no?</p>
</blockquote>
<p>What I'm trying to convey is that we have choice of path here. The reason I'm asking for dependencies is that, as Havvy says "assume all unsafe blocks correct" is a possible starting point if there's not dependencies.</p>



<a name="227474429"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%22Improving%20trust%20in%20the%20Rust%20compiler%22%20design%20meeting/near/227474429" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.22Improving.20trust.20in.20the.20Rust.20compiler.22.20design.20meeting.html#227474429">(Feb 23 2021 at 17:57)</a>:</h4>
<p>ah, yes, if we just assume unsafe is correct it does narrow the scope quite a bit</p>



<a name="228054452"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%22Improving%20trust%20in%20the%20Rust%20compiler%22%20design%20meeting/near/228054452" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.22Improving.20trust.20in.20the.20Rust.20compiler.22.20design.20meeting.html#228054452">(Feb 27 2021 at 12:11)</a>:</h4>
<p>I am confused now. This was (I think) a reaction to my reaction to the statement "There could be UB in Rust surface syntax that doesn't surface in MIR". How is that even a concern if we assume unsafe code in the stdlib is correct?</p>



<a name="228207028"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%22Improving%20trust%20in%20the%20Rust%20compiler%22%20design%20meeting/near/228207028" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Gilcher <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.22Improving.20trust.20in.20the.20Rust.20compiler.22.20design.20meeting.html#228207028">(Mar 01 2021 at 10:23)</a>:</h4>
<p><span class="user-mention" data-user-id="120791">@RalfJ</span> well, my question is rather: _if_ we made the assumption that unsafe blocks are correct for now, would that cause the problems down the line? i'm also not sure where stdlib comes in, because checking libstd is a whole different can of worms.</p>



<a name="228207068"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%22Improving%20trust%20in%20the%20Rust%20compiler%22%20design%20meeting/near/228207068" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Gilcher <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.22Improving.20trust.20in.20the.20Rust.20compiler.22.20design.20meeting.html#228207068">(Mar 01 2021 at 10:23)</a>:</h4>
<p>It's rather a question of ordering and untangling the process.</p>



<a name="228209576"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%22Improving%20trust%20in%20the%20Rust%20compiler%22%20design%20meeting/near/228209576" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.22Improving.20trust.20in.20the.20Rust.20compiler.22.20design.20meeting.html#228209576">(Mar 01 2021 at 10:43)</a>:</h4>
<p>I think what Ralf is trying to say is that if "unsafe blocks are correct" then "there is no UB at all", so the question is what the purpose of the statement "unsafe blocks are correct" is.</p>



<a name="228216328"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%22Improving%20trust%20in%20the%20Rust%20compiler%22%20design%20meeting/near/228216328" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Gilcher <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.22Improving.20trust.20in.20the.20Rust.20compiler.22.20design.20meeting.html#228216328">(Mar 01 2021 at 11:45)</a>:</h4>
<p>ah, i guess we're talking on different levels here. i don't think that statement is useful.</p>



<a name="228216355"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%22Improving%20trust%20in%20the%20Rust%20compiler%22%20design%20meeting/near/228216355" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Gilcher <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.22Improving.20trust.20in.20the.20Rust.20compiler.22.20design.20meeting.html#228216355">(Mar 01 2021 at 11:45)</a>:</h4>
<p>I'd call it "unsafe blocks are unknown and need to be manually verified for now" is the statement I'm going for.</p>



<a name="228304776"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%22Improving%20trust%20in%20the%20Rust%20compiler%22%20design%20meeting/near/228304776" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.22Improving.20trust.20in.20the.20Rust.20compiler.22.20design.20meeting.html#228304776">(Mar 01 2021 at 20:58)</a>:</h4>
<p>the challenge is: manually verified against <em>what</em></p>



<a name="228387604"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%22Improving%20trust%20in%20the%20Rust%20compiler%22%20design%20meeting/near/228387604" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.22Improving.20trust.20in.20the.20Rust.20compiler.22.20design.20meeting.html#228387604">(Mar 02 2021 at 10:38)</a>:</h4>
<p><span class="user-mention" data-user-id="215333">@Florian Gilcher</span> if we ignore <code>unsafe</code> blocks we could write a spec where UB isn't a thing (or where we just cover the "obvious" UB but dont try to make it exhaustive). I think that is a useful stepping-stone indeed. However, I'd still do that entirely on the MIR level, and I foresee no problems there -- precisely <em>because</em> we do not want to fully capture UB.<br>
It is only when capturing UB becomes a goal that we have to worry "does MIR reflect all the UB we want to have on the surface level".</p>



<hr><p>Last updated: Aug 07 2021 at 22:04 UTC</p>
</html>