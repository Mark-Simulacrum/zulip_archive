<html>
<head><meta charset="utf-8"><title>const-if-const syntax (`~const`) · t-lang · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/index.html">t-lang</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/const-if-const.20syntax.20(.60~const.60).html">const-if-const syntax (`~const`)</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="265840826"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/const-if-const%20syntax%20%28%60~const%60%29/near/265840826" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/const-if-const.20syntax.20(.60~const.60).html#265840826">(Dec 22 2021 at 19:06)</a>:</h4>
<p>We have implemented and hypothetical syntax for various const things. The current status is essentially</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">const</span><span class="w"> </span><span class="k">fn</span> <span class="nf">foo1</span><span class="o">&lt;</span><span class="n">T</span>: <span class="nc">Debug</span><span class="o">&gt;</span><span class="p">(</span><span class="n">t</span>: <span class="kp">&amp;</span><span class="nc">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="c1">// cannot use trait methods at all, but can call without a const impl</span>
<span class="p">}</span><span class="w"></span>

<span class="k">const</span><span class="w"> </span><span class="k">fn</span> <span class="nf">foo2</span><span class="o">&lt;</span><span class="n">T</span>: <span class="o">~</span><span class="k">const</span><span class="w"> </span><span class="n">Debug</span><span class="o">&gt;</span><span class="p">(</span><span class="n">t</span>: <span class="kp">&amp;</span><span class="nc">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// can use trait methods, but must with a const impl if in a const context</span>
<span class="w">    </span><span class="c1">//</span>
<span class="w">    </span><span class="c1">// cannot use methods in a const context</span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// hypothetical syntax</span>
<span class="k">const</span><span class="w"> </span><span class="k">fn</span> <span class="nf">foo3</span><span class="o">&lt;</span><span class="n">T</span>: <span class="nc">const</span><span class="w"> </span><span class="n">Debug</span><span class="o">&gt;</span><span class="p">(</span><span class="n">t</span>: <span class="kp">&amp;</span><span class="nc">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// can use trait methods in any context</span>
<span class="w">    </span><span class="c1">//</span>
<span class="w">    </span><span class="c1">// must always supply a const impl</span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// hypothetical syntax</span>
<span class="k">fn</span> <span class="nf">foo4</span><span class="o">&lt;</span><span class="n">T</span>: <span class="nc">const</span><span class="w"> </span><span class="n">Debug</span><span class="o">&gt;</span><span class="p">(</span><span class="n">t</span>: <span class="kp">&amp;</span><span class="nc">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// same as foo4</span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>The question is whether we want "awkward" syntax for the common case (<code>foo2</code>), or whether we want a potentially confusing (no evidence, but the point has been brought up) syntax for <code>foo2</code> by using just plain <code>T: const Trait</code> bounds to mean "const if const" and have something like <code>T: const(always) Trait</code> for <code>foo3</code> and <code>foo4</code> or not even any syntax for that at all and require people to use associated consts or something else entirely</p>



<a name="265841162"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/const-if-const%20syntax%20%28%60~const%60%29/near/265841162" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/const-if-const.20syntax.20(.60~const.60).html#265841162">(Dec 22 2021 at 19:10)</a>:</h4>
<p>I personally see three different sets of related questions here:<br>
1) Should we use a simpler syntax for <code>foo2</code> than <code>foo3</code>/<code>foo4</code>? For instance, just <code>const</code>, and then <code>foo3</code> and <code>foo4</code> need a syntax for unconditional const?<br>
2) What syntax should we actually use? If <code>foo2</code> gets the unusual syntax, we could use something like <code>?const</code>. But if <code>foo3</code> and <code>foo4</code> need a different "unconditional const" syntax, we could spell that something like <code>+const</code> or similar.<br>
3) Do we need a more general mechanism for "make something in the type system conditional on whether we're in a const context"? The equivalent of <code>const ? T : U</code>?</p>



<a name="265841177"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/const-if-const%20syntax%20%28%60~const%60%29/near/265841177" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Cramer <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/const-if-const.20syntax.20(.60~const.60).html#265841177">(Dec 22 2021 at 19:10)</a>:</h4>
<p>I like the idea of giving <code>foo2</code> a better syntax (<code>const</code> instead of <code>~const</code>), but I think eventually (via an edition or some other migration path) we're going to want const type parameters to  const contexts to be opt-out rather than opt-in</p>



<a name="265841214"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/const-if-const%20syntax%20%28%60~const%60%29/near/265841214" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/const-if-const.20syntax.20(.60~const.60).html#265841214">(Dec 22 2021 at 19:11)</a>:</h4>
<p>I personally think we'll want a shorthand regardless, and I'd be in favor of spelling <code>foo2</code> with <code>T: const Trait</code> and <code>foo3</code>/<code>foo4</code> with <code>T: +const Trait</code>.</p>



<a name="265841345"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/const-if-const%20syntax%20%28%60~const%60%29/near/265841345" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Cramer <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/const-if-const.20syntax.20(.60~const.60).html#265841345">(Dec 22 2021 at 19:12)</a>:</h4>
<p>The problem with spelling <code>foo2</code> with <code>const Trait</code> IMO is that if we ever wanted to drop the <code>const</code> before <code>const Trait</code> for the <code>foo2</code> case, we'd probably want to re-use the <code>const</code> syntax for the <code>const(always)</code> case, which would be an awkward transition</p>



<a name="265841367"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/const-if-const%20syntax%20%28%60~const%60%29/near/265841367" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Cramer <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/const-if-const.20syntax.20(.60~const.60).html#265841367">(Dec 22 2021 at 19:12)</a>:</h4>
<p>(this is assuming that the opt-out is something like <code>?const Trait</code>)</p>



<a name="265841422"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/const-if-const%20syntax%20%28%60~const%60%29/near/265841422" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Cramer <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/const-if-const.20syntax.20(.60~const.60).html#265841422">(Dec 22 2021 at 19:13)</a>:</h4>
<p>note that I do also think this should apply to trait impls and their generic parameters: for the "i'm only using an associated constant" case, both <code>const fn</code> and <code>const</code> trait impls would use <code>: ?const Trait</code> bounds</p>



<a name="265841630"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/const-if-const%20syntax%20%28%60~const%60%29/near/265841630" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/const-if-const.20syntax.20(.60~const.60).html#265841630">(Dec 22 2021 at 19:15)</a>:</h4>
<p>yea, all syntax is shared between const fn and const trait impls</p>



<a name="265842213"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/const-if-const%20syntax%20%28%60~const%60%29/near/265842213" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/const-if-const.20syntax.20(.60~const.60).html#265842213">(Dec 22 2021 at 19:21)</a>:</h4>
<p>in any case. Are there any objections to opening an FCP on allowing <code>T: Trait</code> on const fn to mean "can't call methods, but use associated consts and types"?</p>



<a name="265842239"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/const-if-const%20syntax%20%28%60~const%60%29/near/265842239" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/const-if-const.20syntax.20(.60~const.60).html#265842239">(Dec 22 2021 at 19:21)</a>:</h4>
<p>Considering that <code>where (T,): Trait</code> already exists as a workaround for that</p>



<a name="267622376"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/const-if-const%20syntax%20%28%60~const%60%29/near/267622376" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/const-if-const.20syntax.20(.60~const.60).html#267622376">(Jan 11 2022 at 18:10)</a>:</h4>
<p><span class="user-mention silent" data-user-id="127859">Taylor Cramer</span> <a href="#narrow/stream/213817-t-lang/topic/const-if-const.20syntax.20.28.60~const.60.29/near/265841177">said</a>:</p>
<blockquote>
<p>we're going to want const type parameters to  const contexts to be opt-out rather than opt-in</p>
</blockquote>
<p>Might be interesting to pick syntaxes for both directions, so that we can require one for now, then pivot to the other direction in the next edition if we want a breaking change to fit the nicer default.</p>



<a name="267623565"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/const-if-const%20syntax%20%28%60~const%60%29/near/267623565" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fee1-dead <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/const-if-const.20syntax.20(.60~const.60).html#267623565">(Jan 11 2022 at 18:19)</a>:</h4>
<p>It looks like the "<code>const</code> means const-if-const, and something else to mean always-const" scheme has already been suggested (originally meant as a joke), <a href="https://internals.rust-lang.org/t/pre-rfc-revamped-const-trait-impl-aka-rfc-2632/15192/25?u=fee1-dead">on internals</a>:</p>
<blockquote>
<p>In pure jest, I counterpropose that <code>T: const Trait</code> is only const when the defining item is used as const, and that a new syntax <code>T: const!!! Trait</code> is added for when T needs to always provide a const impl of <code>Trait</code>.</p>
</blockquote>



<a name="267624853"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/const-if-const%20syntax%20%28%60~const%60%29/near/267624853" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/const-if-const.20syntax.20(.60~const.60).html#267624853">(Jan 11 2022 at 18:28)</a>:</h4>
<p>Time to suggest the triple-exclamation-mark modifier for all keywords</p>



<a name="267624893"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/const-if-const%20syntax%20%28%60~const%60%29/near/267624893" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/const-if-const.20syntax.20(.60~const.60).html#267624893">(Jan 11 2022 at 18:28)</a>:</h4>
<p><code>unsafe!!! { *0 }</code></p>



<a name="267627192"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/const-if-const%20syntax%20%28%60~const%60%29/near/267627192" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/const-if-const.20syntax.20(.60~const.60).html#267627192">(Jan 11 2022 at 18:45)</a>:</h4>
<p>I think one question would be:<br>
What would each of the syntaxes mean in a non-<code>const</code> fn? <br>
In particular, what is:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">trait</span><span class="w"> </span><span class="n">Foo</span><span class="p">{}</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">foo</span><span class="o">&lt;</span><span class="n">T</span>: <span class="nc">const</span><span class="w"> </span><span class="n">Foo</span><span class="o">&gt;</span><span class="p">(){}</span><span class="w"></span>
</code></pre></div>
<p>If we go with making <code>foo2</code> have the nice syntax, then I think there's a catch-22 that this will be confusing:<br>
1) <code>foo&lt;T: const Foo&gt;()</code> does what <code>foo4</code> does: it always requires <code>const</code>, and you can call trait methods on <code>T</code> in a <code>const</code> context, then it's different behaviour between a <code>const fn</code> and a non-<code>const fn</code>.<br>
2) If its the same, then the <code>T: const Foo</code> bound is useless (identical to <code>T: Foo</code>). <br>
This should likely be considered if <code>foo2&lt;T: const Foo&gt;()</code> and <code>foo3&lt;T: +const Foo&gt;</code> is the solution chosen. Not necessarily a huge issue, but definately something to think about</p>



<a name="267627875"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/const-if-const%20syntax%20%28%60~const%60%29/near/267627875" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/const-if-const.20syntax.20(.60~const.60).html#267627875">(Jan 11 2022 at 18:50)</a>:</h4>
<p>The other thing is, IDK if this is the proper place, but imo the <code>~const Drop</code> syntax should be fixed.<br>
It's somewhat confusing (as, at least to me, it seems to imply that <code>T: Drop</code> but is satisfied for primitive types), and has already result in one (albeit now fixed) <a href="https://github.com/rust-lang/rust/issues/92111">regression</a>.</p>



<a name="267627896"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/const-if-const%20syntax%20%28%60~const%60%29/near/267627896" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/const-if-const.20syntax.20(.60~const.60).html#267627896">(Jan 11 2022 at 18:50)</a>:</h4>
<p><code>where fn: const → T: const</code></p>



<a name="267628054"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/const-if-const%20syntax%20%28%60~const%60%29/near/267628054" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/const-if-const.20syntax.20(.60~const.60).html#267628054">(Jan 11 2022 at 18:51)</a>:</h4>
<p>I think we should not allow writing <code>const</code> bounds in non-const fn</p>



<a name="267628091"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/const-if-const%20syntax%20%28%60~const%60%29/near/267628091" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/const-if-const.20syntax.20(.60~const.60).html#267628091">(Jan 11 2022 at 18:51)</a>:</h4>
<p>I think it's useful to have a way to use <code>const_trait_impl</code> in constants within a function.</p>



<a name="267629064"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/const-if-const%20syntax%20%28%60~const%60%29/near/267629064" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/const-if-const.20syntax.20(.60~const.60).html#267629064">(Jan 11 2022 at 18:58)</a>:</h4>
<p><span class="user-mention silent" data-user-id="330154">The 8472</span> <a href="#narrow/stream/213817-t-lang/topic/const-if-const.20syntax.20.28.60~const.60.29/near/267627896">said</a>:</p>
<blockquote>
<p><code>where fn: const → T: const</code></p>
</blockquote>
<p>I'd love to have a syntax for that.</p>



<a name="267629095"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/const-if-const%20syntax%20%28%60~const%60%29/near/267629095" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/const-if-const.20syntax.20(.60~const.60).html#267629095">(Jan 11 2022 at 18:59)</a>:</h4>
<p>We've wanted, in the past, things like <code>where T: Send -&gt; U: Send</code>.</p>



<a name="267630399"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/const-if-const%20syntax%20%28%60~const%60%29/near/267630399" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/const-if-const.20syntax.20(.60~const.60).html#267630399">(Jan 11 2022 at 19:09)</a>:</h4>
<p><span class="user-mention silent" data-user-id="124288">oli</span> <a href="#narrow/stream/213817-t-lang/topic/const-if-const.20syntax.20.28.60~const.60.29/near/267628054">said</a>:</p>
<blockquote>
<p>I think we should not allow writing <code>const</code> bounds in non-const fn</p>
</blockquote>
<p>I disagree. With inline const I definitely see a always-const bound being potentially useful even on non-const fns.</p>



<a name="267630438"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/const-if-const%20syntax%20%28%60~const%60%29/near/267630438" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/const-if-const.20syntax.20(.60~const.60).html#267630438">(Jan 11 2022 at 19:09)</a>:</h4>
<p>Oh, I mean const-if-const bounds</p>



<a name="267630459"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/const-if-const%20syntax%20%28%60~const%60%29/near/267630459" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/const-if-const.20syntax.20(.60~const.60).html#267630459">(Jan 11 2022 at 19:09)</a>:</h4>
<p>Always const bounds are def useful</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>