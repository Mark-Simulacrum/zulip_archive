<html>
<head><meta charset="utf-8"><title>Duplicate Label Warning · t-lang · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/index.html">t-lang</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Duplicate.20Label.20Warning.html">Duplicate Label Warning</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="263281889"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Duplicate%20Label%20Warning/near/263281889" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Duplicate.20Label.20Warning.html#263281889">(Dec 01 2021 at 12:29)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/issues/24162">#24162</a> introduced a warning for this code:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="o">'</span><span class="na">a</span>: <span class="nc">loop</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">break</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="o">'</span><span class="na">a</span>: <span class="nc">loop</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">break</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>Citing "labeling arbitrary blocks and using those labels in borrow expressions" as a future possibility that we want to reserve syntax for. Is there an actual plan to make use of this? The only unstable feature I could find in this direction <a href="https://github.com/rust-lang/rust/issues/48594">#48594</a> , which does not actually need this warning. The diagnostic for this reads:</p>
<div class="codehilite"><pre><span></span><code>warning: label name `&#39;a` shadows a label name that is already in scope
</code></pre></div>
<p>which is imo definitely confusing, but before I file an issue/pr to fix that I wanted to check if this check could be removed entirely (obviously genuinely nested labels will still warn/error/whatever they do now)</p>



<a name="263291429"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Duplicate%20Label%20Warning/near/263291429" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Duplicate.20Label.20Warning.html#263291429">(Dec 01 2021 at 13:43)</a>:</h4>
<p>cc <span class="user-mention" data-user-id="224471">@Lokathor</span> <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span></p>



<a name="263449391"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Duplicate%20Label%20Warning/near/263449391" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Duplicate.20Label.20Warning.html#263449391">(Dec 02 2021 at 15:00)</a>:</h4>
<p>theer’s no current initiative or concrete plan. To my memory, I’m not sure there’s even a notion that the ability to write <code>&amp;’a &lt;expr&gt;</code> would provide value to practitioners (unless it let them start being able to express borrows that were otherwise not encodable, but AFAIK that was not expected). The main anticipated value I think was for <em>pedagogy</em>: helping people debug their own mental model of how borrow-checking worked when they were learning Rust.</p>



<a name="263449606"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Duplicate%20Label%20Warning/near/263449606" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Duplicate.20Label.20Warning.html#263449606">(Dec 02 2021 at 15:01)</a>:</h4>
<p>So, I guess I would prefer to consult with educators or people doing usability studies (to determine if such a feature <em>could</em> provide pedagogocial value) before removing the check.</p>



<a name="263449617"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Duplicate%20Label%20Warning/near/263449617" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Duplicate.20Label.20Warning.html#263449617">(Dec 02 2021 at 15:01)</a>:</h4>
<p>Cc <span class="user-mention" data-user-id="219211">@Jack Wrenn</span> ^</p>



<a name="264056769"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Duplicate%20Label%20Warning/near/264056769" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Duplicate.20Label.20Warning.html#264056769">(Dec 07 2021 at 19:16)</a>:</h4>
<p>I would strongly prefer if this warning went away, or at least if it got a lot smarter before saying anything.</p>



<a name="264058225"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Duplicate%20Label%20Warning/near/264058225" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Wrenn <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Duplicate.20Label.20Warning.html#264058225">(Dec 07 2021 at 19:26)</a>:</h4>
<p>I'd love the ability to write <code>&amp;'a &lt;expr&gt;</code>, especially because it's something I often <em>accidentally</em> write. But:</p>
<ul>
<li>I'm not clear on why having that ability would block duplicate labels. Most (all?) of the time that <code>&amp;'foo &lt;expr&gt;</code> is referencing a label <code>'foo</code> introduced by a block, I'd expect <code>&amp;'foo &lt;expr&gt;</code> to appear <em>inside</em> the <code>'foo</code> block. Are there exceptions to this?</li>
<li>I'd expect we'd be able to come up with some sort of sane semantics for lifetime/label shadowing.</li>
<li>Introducing <code>&amp;'foo &lt;expr&gt;</code> feels pretty far-out. Even if having that ability would conflict with duplicate labels on blocks, that seems like something we could just resolve with an edition.</li>
</ul>



<a name="264059320"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Duplicate%20Label%20Warning/near/264059320" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Duplicate.20Label.20Warning.html#264059320">(Dec 07 2021 at 19:35)</a>:</h4>
<p>The problem to me is that currently this triggers in cases with labels where it don't even make sense to claim that they're "shadowing" each other:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">match</span><span class="w"> </span><span class="n">compression</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">BmpCompression</span>::<span class="n">RLE8</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// setup stuff</span>
<span class="w">    </span><span class="o">'</span><span class="na">iter_pull</span>: <span class="nc">while</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="o">..</span><span class="p">.)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">whatever</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="n">BmpCompression</span>::<span class="n">RLE4</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// different setup stuff</span>
<span class="w">    </span><span class="o">'</span><span class="na">iter_pull</span>: <span class="nc">while</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="o">..</span><span class="p">.)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">whatever</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">todo!</span><span class="p">()</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>This will warn that <code>'iter_pull</code> in one match arm is shadowing the same-named label in a totally different match arm.</p>



<a name="265960365"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Duplicate%20Label%20Warning/near/265960365" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Duplicate.20Label.20Warning.html#265960365">(Dec 23 2021 at 22:48)</a>:</h4>
<p>Someone came into the Rust community discord today and had the following error message:</p>
<div class="codehilite"><pre><span></span><code>error[E0495]: cannot infer an appropriate lifetime due to conflicting requirements
   --&gt; src\rt.rs:201:30
    |
201 |                 let anchor = frozen.anchor;
    |                              ^^^^^^^^^^^^^
    |
note: first, the lifetime cannot outlive the anonymous lifetime #3 defined here...
   --&gt; src\rt.rs:200:22
    |
200 |               gc.no_gc(|frozen| {
    |  ______________________^
201 | |                 let anchor = frozen.anchor;
202 | |                 let anchor = &amp;anchor;
203 | |
...   |
214 | |                 }
215 | |             });
    | |_____________^
note: ...so that the expression is assignable
   --&gt; src\rt.rs:201:30
    |
201 |                 let anchor = frozen.anchor;
    |                              ^^^^^^^^^^^^^
    = note: expected `NoGcLifetime&lt;&#39;_&gt;`
               found `NoGcLifetime&lt;&#39;_&gt;`
note: but, the lifetime must be valid for the anonymous lifetime #2 defined here...
   --&gt; src\rt.rs:200:22
    |
200 |               gc.no_gc(|frozen| {
    |  ______________________^
201 | |                 let anchor = frozen.anchor;
202 | |                 let anchor = &amp;anchor;
203 | |
...   |
214 | |                 }
215 | |             });
    | |_____________^
note: ...so that the types are compatible
   --&gt; src\rt.rs:207:55
    |
207 |                     let (old_data, new_data) = frozen.as_two_slice_mut(&amp;old_data.unroot(anchor), &amp;new_data);
    |                                                       ^^^^^^^^^^^^^^^^
    = note: expected `&lt;FrozenGcContext&lt;&#39;_, &#39;_&gt; as GcHeap&lt;&#39;_&gt;&gt;`
               found `&lt;FrozenGcContext&lt;&#39;_, &#39;_&gt; as GcHeap&lt;&#39;_&gt;&gt;`
</code></pre></div>
<p>Their question was how to change their code to get a more useful error message. I recommended that they extract the body of the closure out into a function so that they can name some of the anonymous lifetimes, but was reminded of this discussion and wanted to post here as well. I don't have a suggestion or anything, but possibly ideas along the line of being able to name more lifetimes could have use for this kind of situation too</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>