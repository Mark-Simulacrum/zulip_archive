<html>
<head><meta charset="utf-8"><title>Local variables are dropped when they go out of scope · t-lang · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/index.html">t-lang</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Local.20variables.20are.20dropped.20when.20they.20go.20out.20of.20scope.html">Local variables are dropped when they go out of scope</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="261955765"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Local%20variables%20are%20dropped%20when%20they%20go%20out%20of%20scope/near/261955765" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Local.20variables.20are.20dropped.20when.20they.20go.20out.20of.20scope.html#261955765">(Nov 18 2021 at 16:55)</a>:</h4>
<p>The reference goes into great detail about when local variables have their <a href="https://doc.rust-lang.org/reference/destructors.html?highlight=destructors#destructors"><code>Drop</code> implementations called</a>. However, at the very end of that section, it claims that</p>
<blockquote>
<p>Not running destructors in Rust is safe even if it has a type that isn't 'static. std::mem::ManuallyDrop provides a wrapper to prevent a variable or field from being dropped automatically.</p>
</blockquote>
<p>The genesis of this statement is the leakpocalypse, but this is misleading for values that are never made available to the user (like locals). See discussion <a href="#narrow/stream/131828-t-compiler/topic/Guarantees.20around.20Drop.20.28.2390752.29">here</a> for why guaranteeing that these values are dropped is important.</p>



<a name="261956684"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Local%20variables%20are%20dropped%20when%20they%20go%20out%20of%20scope/near/261956684" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Local.20variables.20are.20dropped.20when.20they.20go.20out.20of.20scope.html#261956684">(Nov 18 2021 at 17:00)</a>:</h4>
<p>Does <span class="user-group-mention" data-user-group-id="1977">@T-lang</span> agree with this assessment? What kind of process is required to change the language? An MCP? Just a PR? What should we put in its place (if anything)?</p>



<a name="261959238"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Local%20variables%20are%20dropped%20when%20they%20go%20out%20of%20scope/near/261959238" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Local.20variables.20are.20dropped.20when.20they.20go.20out.20of.20scope.html#261959238">(Nov 18 2021 at 17:17)</a>:</h4>
<p>For me, <a href="https://github.com/rust-lang/reference/issues/1107">rust-lang/reference#1107</a> is the answer to the last question.</p>



<a name="261960834"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Local%20variables%20are%20dropped%20when%20they%20go%20out%20of%20scope/near/261960834" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Local.20variables.20are.20dropped.20when.20they.20go.20out.20of.20scope.html#261960834">(Nov 18 2021 at 17:28)</a>:</h4>
<p>Any live local is dropped at the end of the enclosing scope in reverse order of declaration. A local becomes live when it is initialized, and ceases to be live when it is moved out of.</p>



<a name="261963481"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Local%20variables%20are%20dropped%20when%20they%20go%20out%20of%20scope/near/261963481" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Local.20variables.20are.20dropped.20when.20they.20go.20out.20of.20scope.html#261963481">(Nov 18 2021 at 17:47)</a>:</h4>
<p><span class="user-mention" data-user-id="118594">@Dylan MacKenzie (ecstatic-morse)</span> I think it'd be appropriate to clarify the reference to make it clear that under normal circumstances <code>Drop</code> impls will get called, and then explaining the circumstances under which they won't be.</p>



<a name="261963564"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Local%20variables%20are%20dropped%20when%20they%20go%20out%20of%20scope/near/261963564" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Local.20variables.20are.20dropped.20when.20they.20go.20out.20of.20scope.html#261963564">(Nov 18 2021 at 17:47)</a>:</h4>
<p>We should cover the common case before covering corner cases.</p>



<a name="261966638"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Local%20variables%20are%20dropped%20when%20they%20go%20out%20of%20scope/near/261966638" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Local.20variables.20are.20dropped.20when.20they.20go.20out.20of.20scope.html#261966638">(Nov 18 2021 at 18:07)</a>:</h4>
<p><span class="user-mention" data-user-id="118594">@Dylan MacKenzie (ecstatic-morse)</span> agree. We usually use FCP on the PR for minor clarifications of this kind.</p>



<a name="262102962"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Local%20variables%20are%20dropped%20when%20they%20go%20out%20of%20scope/near/262102962" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Local.20variables.20are.20dropped.20when.20they.20go.20out.20of.20scope.html#262102962">(Nov 19 2021 at 17:52)</a>:</h4>
<p><span class="user-mention" data-user-id="118594">@Dylan MacKenzie (ecstatic-morse)</span> Maybe it can re-use some of the same kind of verbiage that probably exists somewhere for the "unsafe code can't trust safe code" stuff -- that's true in general, but if all the code is under your control and you audit it then you can rely on it.  It's just if you're giving it away to other code that you can't rely on these things any more.</p>



<a name="262165242"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Local%20variables%20are%20dropped%20when%20they%20go%20out%20of%20scope/near/262165242" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> isHavvy <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Local.20variables.20are.20dropped.20when.20they.20go.20out.20of.20scope.html#262165242">(Nov 20 2021 at 05:50)</a>:</h4>
<p><a href="https://doc.rust-lang.org/stable/reference/behavior-not-considered-unsafe.html#leaks-of-memory-and-other-resources">https://doc.rust-lang.org/stable/reference/behavior-not-considered-unsafe.html#leaks-of-memory-and-other-resources</a> Probably this section could be filled out, and the linked to from the destructors chapter.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>