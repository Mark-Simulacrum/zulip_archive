<html>
<head><meta charset="utf-8"><title>cfg-accessible · t-lang · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/index.html">t-lang</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/cfg-accessible.html">cfg-accessible</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="269301337"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/cfg-accessible/near/269301337" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/cfg-accessible.html#269301337">(Jan 25 2022 at 18:28)</a>:</h4>
<p><span class="user-mention" data-user-id="239881">@Josh Triplett</span> is there a reason we can't make cfg-accessible specific to external crates? i.e., the syntax could be <code>cratename::path</code></p>



<a name="269301362"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/cfg-accessible/near/269301362" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/cfg-accessible.html#269301362">(Jan 25 2022 at 18:29)</a>:</h4>
<p>There doesn't seem to be a strong case for "crate-local"</p>



<a name="269302108"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/cfg-accessible/near/269302108" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/cfg-accessible.html#269302108">(Jan 25 2022 at 18:34)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> We could define that it only works with external crates and ignores any local renamings, yeah.</p>



<a name="269302153"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/cfg-accessible/near/269302153" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/cfg-accessible.html#269302153">(Jan 25 2022 at 18:34)</a>:</h4>
<p>That'd be easy.</p>



<a name="269302164"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/cfg-accessible/near/269302164" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Cramer <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/cfg-accessible.html#269302164">(Jan 25 2022 at 18:34)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> In older editions, it was fairly common to <code>extern crate std as core;</code> or similar, which was often added via a macro and would mean that following uses of <code>core::...</code>/<code>use core::...</code> wouldn't actually use core but would use <code>std</code>. I think, though, that now that <code>extern crate</code> is mostly not used, it makes more sense.</p>



<a name="269302287"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/cfg-accessible/near/269302287" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Cramer <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/cfg-accessible.html#269302287">(Jan 25 2022 at 18:34)</a>:</h4>
<blockquote>
<p>ignores any local renamings</p>
</blockquote>
<p>Nowadays, renamings would have to be local to the file in which the <code>#[cfg(accessible)]</code> appears, right? (or introduced by a macro into the same file)</p>



<a name="269302451"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/cfg-accessible/near/269302451" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Cramer <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/cfg-accessible.html#269302451">(Jan 25 2022 at 18:36)</a>:</h4>
<p>That is, it wouldn't work if you did</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">mod</span> <span class="nn">std</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="c1">// or `use ... as std;`</span>
<span class="cp">#[cfg(accessible(std::...))]</span><span class="w"></span>
</code></pre></div>



<a name="269302595"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/cfg-accessible/near/269302595" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Cramer <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/cfg-accessible.html#269302595">(Jan 25 2022 at 18:36)</a>:</h4>
<p>But we no longer have <code>extern crate</code> annotations that may, when placed at top-level, have provided a crate-wide alias.</p>



<a name="269302630"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/cfg-accessible/near/269302630" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/cfg-accessible.html#269302630">(Jan 25 2022 at 18:37)</a>:</h4>
<p><span class="user-mention" data-user-id="127859">@Taylor Cramer</span> it does seem possible for us to issue errors in cases like that too, or at least warnings (we can remember all the paths that were used and then resolve them at the end)</p>



<a name="269302663"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/cfg-accessible/near/269302663" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/cfg-accessible.html#269302663">(Jan 25 2022 at 18:37)</a>:</h4>
<p>but yeah aliases come from cargo.toml now, at least in our preferred style</p>



<a name="269302760"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/cfg-accessible/near/269302760" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Cramer <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/cfg-accessible.html#269302760">(Jan 25 2022 at 18:37)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> that's a good point-- we can avoid being "wrong", and keep track of what paths we've used, erroring if they're overwritten by later-introduced <code>mod</code> or <code>use</code> statements</p>



<a name="269303043"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/cfg-accessible/near/269303043" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/cfg-accessible.html#269303043">(Jan 25 2022 at 18:39)</a>:</h4>
<p>Ah, interesting. So instead of "you can only access external crates", we could instead do "if you have renamings that make this not just external crates, we'll error out"?</p>



<a name="269303077"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/cfg-accessible/near/269303077" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/cfg-accessible.html#269303077">(Jan 25 2022 at 18:39)</a>:</h4>
<p>(which is forward-compatible with being more clever about renamings?)</p>



<a name="269303818"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/cfg-accessible/near/269303818" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/cfg-accessible.html#269303818">(Jan 25 2022 at 18:44)</a>:</h4>
<p>What about unambiguous paths? <em>e.g.</em>, <code>#[cfg_accessible(::std::…)]</code> </p>
<p>If support for local paths has not yet been settled, then at least the "ambiguous cases" that try to refer to an external crate could still be allowed by requiring that leading <code>::</code> disambiguation, right?</p>



<a name="269304908"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/cfg-accessible/near/269304908" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/cfg-accessible.html#269304908">(Jan 25 2022 at 18:52)</a>:</h4>
<p><span class="user-mention" data-user-id="232018">@Daniel Henry-Mantilla</span> Is <code>::std</code> unambiguous even in the face of renamings?</p>



<a name="269306049"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/cfg-accessible/near/269306049" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/cfg-accessible.html#269306049">(Jan 25 2022 at 18:59)</a>:</h4>
<p><span class="user-mention" data-user-id="239881">@Josh Triplett</span> ah, maybe there was ambiguity in the term <em>ambiguity</em> <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span> </p>
<p>I was talking of:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">mod</span> <span class="nn">std</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="c1">// or `use ... as std;`</span>
<span class="cp">#[cfg(accessible(std::...))]</span><span class="w"></span>
</code></pre></div>
<p>form of ambiguity (regarding which <code>::std</code> unambiguously refers to <em>some</em> eponymous extern crate); <code>::</code>-prefixed paths always refer to the new name of an extern crate, if renamed, so if <em>that</em> leads to ambiguity, then using <code>::std::…</code> won't help compared to just using <code>std::…</code>.</p>



<a name="269306738"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/cfg-accessible/near/269306738" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/cfg-accessible.html#269306738">(Jan 25 2022 at 19:03)</a>:</h4>
<p>I think if we only allow references to external crates, and ignore all internal renamings, then in theory we shouldn't have to deal with the cyclic issue with macros that blocked the general case.</p>



<a name="269306799"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/cfg-accessible/near/269306799" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/cfg-accessible.html#269306799">(Jan 25 2022 at 19:03)</a>:</h4>
<p>cc <span class="user-group-mention" data-user-group-id="492">@T-compiler</span> If we required that all arguments to <code>cfg(accessible(...))</code> must start with <code>::</code>, does that make an implementation of it feasible?</p>



<a name="269306813"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/cfg-accessible/near/269306813" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/cfg-accessible.html#269306813">(Jan 25 2022 at 19:03)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/213817-t-lang/topic/cfg-accessible/near/269301362">said</a>:</p>
<blockquote>
<p>There doesn't seem to be a strong case for "crate-local"</p>
</blockquote>
<p>It would be useful to have a simple way to refer to another type that is gated by &lt;complex set of cfgs&gt; to avoid repetition and inconsistent use of those cfgs. This might become even more useful as core/alloc/std are getting sliced into more features. E.g. if you want to make a type only available on unix, if certain atomics are available and fallible methods haven't been cfg'd out (due to rust-for-linux).</p>



<a name="269306874"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/cfg-accessible/near/269306874" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/cfg-accessible.html#269306874">(Jan 25 2022 at 19:04)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/213817-t-lang/topic/cfg-accessible/near/269306799">said</a>:</p>
<blockquote>
<p>cc <span class="user-group-mention silent" data-user-group-id="492">T-compiler</span> If we required that all arguments to <code>cfg(accessible(...))</code> must start with <code>::</code>, does that make an implementation of it feasible?</p>
</blockquote>
<p>oooh, I forgot we had that syntax</p>



<a name="269306906"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/cfg-accessible/near/269306906" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/cfg-accessible.html#269306906">(Jan 25 2022 at 19:04)</a>:</h4>
<p>that seems like it should work, once you are talking about external crates, all the info you need is in the metadata</p>



<a name="269306910"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/cfg-accessible/near/269306910" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/cfg-accessible.html#269306910">(Jan 25 2022 at 19:04)</a>:</h4>
<p>accessible() would allow those things to compose</p>



<a name="269306968"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/cfg-accessible/near/269306968" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/cfg-accessible.html#269306968">(Jan 25 2022 at 19:04)</a>:</h4>
<p><span class="user-mention" data-user-id="330154">@The 8472</span> sure, but there are other solutions we might do for that</p>



<a name="269306981"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/cfg-accessible/near/269306981" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/cfg-accessible.html#269306981">(Jan 25 2022 at 19:04)</a>:</h4>
<p>in any case, crate-local that is fixed to be external is very useful</p>



<a name="269307078"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/cfg-accessible/near/269307078" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/cfg-accessible.html#269307078">(Jan 25 2022 at 19:05)</a>:</h4>
<p>I don't parse the fixed to be external thing</p>



<a name="269307502"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/cfg-accessible/near/269307502" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/cfg-accessible.html#269307502">(Jan 25 2022 at 19:08)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/213817-t-lang/topic/cfg-accessible/near/269306799">said</a>:</p>
<blockquote>
<p>cc <span class="user-group-mention silent" data-user-group-id="492">T-compiler</span> If we required that all arguments to <code>cfg(accessible(...))</code> must start with <code>::</code>, does that make an implementation of it feasible?</p>
</blockquote>
<p>From my perspective, I don't see an issue with that for the implementation, though rustc is different and not in my area of expertiese.</p>



<a name="269346477"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/cfg-accessible/near/269346477" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vadim Petrochenkov <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/cfg-accessible.html#269346477">(Jan 26 2022 at 00:26)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/213817-t-lang/topic/cfg-accessible/near/269306799">said</a>:</p>
<blockquote>
<p>cc <span class="user-group-mention silent" data-user-group-id="492">T-compiler</span> If we required that all arguments to <code>cfg(accessible(...))</code> must start with <code>::</code>, does that make an implementation of it feasible?</p>
</blockquote>
<p>It's already feasible, the restrictions like <code>::</code> are irrelevant, someone just needs to do the work.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>