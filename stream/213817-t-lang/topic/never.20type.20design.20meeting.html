<html>
<head><meta charset="utf-8"><title>never type design meeting · t-lang · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/index.html">t-lang</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html">never type design meeting</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="272726173"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272726173" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272726173">(Feb 21 2022 at 19:16)</a>:</h4>
<p>Started putting together an initial set of notes for the design meeting later this week -- will likely iterate some more, but if folks have time initial questions or comments would likely help to polish the doc up a little, since there's quite a bit of context to try and embed in a short amount of space.</p>



<a name="272728216"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272728216" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Goulet (compiler-errors) <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272728216">(Feb 21 2022 at 19:40)</a>:</h4>
<p>Are these notes available for pre-read? I'm very interested in the never type implementation changes needed to get it stabilized, and I'd love to give it a read/comments.</p>



<a name="272728299"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272728299" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272728299">(Feb 21 2022 at 19:41)</a>:</h4>
<p>heh</p>



<a name="272728309"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272728309" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272728309">(Feb 21 2022 at 19:41)</a>:</h4>
<p>I meant to link them  <a href="https://hackmd.io/9sTGmQ_VQ_mX_bdQhuqVRA">https://hackmd.io/9sTGmQ_VQ_mX_bdQhuqVRA</a></p>



<a name="272728383"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272728383" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272728383">(Feb 21 2022 at 19:42)</a>:</h4>
<p>the short summary is that current trajectory is towards not stabilizing, but there's some options potentially and maybe other design points I/Niko haven't thought of yet</p>



<a name="272729568"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272729568" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272729568">(Feb 21 2022 at 19:56)</a>:</h4>
<blockquote>
<p>Motivation for ! having special coercion behavior seems weak</p>
</blockquote>
<p>The biggest one I know is that people like writing things like <code>fn from(x: !) -&gt; Foo { x }</code>.  If it's a normal enum, then one has to write <code>{ match x {} }</code> instead.  But that's not <em>that</em> bad, and it's certainly clearer, so it may well be fine.</p>
<p>It's more annoying in things like <a href="https://github.com/SergioBenitez/Rocket/pull/1645/files?diff=unified&amp;w=0#diff-f67fece1f153ba05053cb505d78f11abfb3fc7866f7f1d9b83adc5699fd56c5aR618">https://github.com/SergioBenitez/Rocket/pull/1645/files?diff=unified&amp;w=0#diff-f67fece1f153ba05053cb505d78f11abfb3fc7866f7f1d9b83adc5699fd56c5aR618</a>, but something like "<code>!</code> patterns" could solve that instead of a coercion, so since coercions are generally evil, that's probably further evidence to not have the coercion for <code>!</code>.</p>



<a name="272729665"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272729665" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272729665">(Feb 21 2022 at 19:58)</a>:</h4>
<p>Pondering a whole different direction: if people replace <code>-&gt; !</code> functions with <code>-&gt; Never</code> (for an <code>enum Never {}</code> in the prelude or something), what breaks?</p>



<a name="272729736"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272729736" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272729736">(Feb 21 2022 at 19:58)</a>:</h4>
<p>Coercion behavior -- it's necessary for things like unreachable!() or panic!() (which are just -&gt; ! functions under the hood) to work in functions with e.g. u32 return type</p>



<a name="272729932"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272729932" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Goulet (compiler-errors) <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272729932">(Feb 21 2022 at 20:00)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116122">simulacrum</span> <a href="#narrow/stream/213817-t-lang/topic/never.20type.20design.20meeting/near/272729736">said</a>:</p>
<blockquote>
<p>Coercion behavior -- it's necessary for things like unreachable!() or panic!() (which are just -&gt; ! functions under the hood) to work in functions with e.g. u32 return type</p>
</blockquote>
<p>at least for backwards compat with common macros that diverge, could we desugar <code>unreachable!()</code>, etc., into <code>match something_returning_Never_enum() {}</code> instead?</p>



<a name="272729990"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272729990" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Goulet (compiler-errors) <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272729990">(Feb 21 2022 at 20:01)</a>:</h4>
<p>(<code>something_returning_Never_enum()</code> doesn't necessarily have to be a fn call, just an expression evaluating to that type)</p>



<a name="272730055"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272730055" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Goulet (compiler-errors) <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272730055">(Feb 21 2022 at 20:01)</a>:</h4>
<p>also don't want to get into the weeds of discussion here I guess, perhaps I should hold off on suggesting things</p>



<a name="272730130"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272730130" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272730130">(Feb 21 2022 at 20:02)</a>:</h4>
<p>No, I think discussion here is fine -- in general, that's possible, but obviously anyone can today define -&gt; ! functions (that's not feature gated)</p>



<a name="272730134"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272730134" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272730134">(Feb 21 2022 at 20:02)</a>:</h4>
<p>More random thoughts: while I certainly like the terseness of <code>Option&lt;!&gt;</code> when I write things like <code>Try</code>, it does seem kinda weird to me that a relatively-niche feature has such a short name.</p>
<p>Having people use a canonical library type for it instead of a symbol seems perfectly reasonable.</p>
<p>(And edition-gating the <code>-&gt; !</code> syntax would be pretty simple.)</p>



<a name="272730214"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272730214" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272730214">(Feb 21 2022 at 20:03)</a>:</h4>
<p>yeah, across an edition we could go for</p>
<blockquote>
<p>! is syntax sugar for Infallible inside types (e.g., Result&lt;!, T&gt; == Result&lt;Infallible, T&gt;) but behaves as current stable ! at the top level</p>
</blockquote>



<a name="272730286"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272730286" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272730286">(Feb 21 2022 at 20:04)</a>:</h4>
<p>(well, make regular ! always go for Infallible, and insert match x {} automatically where necessary, with panic etc desugaring to that directly)</p>



<a name="272730456"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272730456" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272730456">(Feb 21 2022 at 20:06)</a>:</h4>
<p>I kinda like the "<code>-&gt; whatever::we::make::the::canonical::Never</code> gets the magic behaviour and we cargo fix <code>-&gt; !</code> to that".  Now to see if I can figure out <em>why</em> I like it...</p>



<a name="272730496"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272730496" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272730496">(Feb 21 2022 at 20:07)</a>:</h4>
<p>Sorry if I missed this earlier in the conversation, but I'm curious what we gain by not using the name <code>!</code>?</p>



<a name="272730497"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272730497" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272730497">(Feb 21 2022 at 20:07)</a>:</h4>
<p>well, I think my proposal is rather the opposite: <em>not</em> have magic behavior for any !-like type</p>



<a name="272730594"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272730594" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272730594">(Feb 21 2022 at 20:08)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/213817-t-lang/topic/never.20type.20design.20meeting/near/272730496">said</a>:</p>
<blockquote>
<p>Sorry if I missed this earlier in the conversation, but I'm curious what we gain by not using the name <code>!</code>?</p>
</blockquote>
<p>The main advantage to immediate-term proposals that don't use <code>!</code> directly is that there is existing stable behavior attached to <code>!</code>; across an edition that behavior is maybe changeable.</p>



<a name="272730606"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272730606" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272730606">(Feb 21 2022 at 20:08)</a>:</h4>
<p>the type of <code>match x {}</code> still needs to be a magic metavariable though</p>



<a name="272730625"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272730625" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272730625">(Feb 21 2022 at 20:08)</a>:</h4>
<p>"diverging type variable" I think it's called</p>



<a name="272730637"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272730637" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272730637">(Feb 21 2022 at 20:08)</a>:</h4>
<p><span class="user-mention silent" data-user-id="271719">Mario Carneiro</span> <a href="#narrow/stream/213817-t-lang/topic/never.20type.20design.20meeting/near/272730606">said</a>:</p>
<blockquote>
<p>the type of <code>match x {}</code> still needs to be a magic metavariable though</p>
</blockquote>
<p>I think it already is on stable, though?</p>



<a name="272730682"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272730682" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272730682">(Feb 21 2022 at 20:09)</a>:</h4>
<p>Well, if you constrain to just <code>match x {}</code> rather than any coercion site, a bunch of things become much simpler, so I think it could still be worthwhile</p>



<a name="272730800"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272730800" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272730800">(Feb 21 2022 at 20:10)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116122">simulacrum</span> <a href="#narrow/stream/213817-t-lang/topic/never.20type.20design.20meeting/near/272730497">said</a>:</p>
<blockquote>
<p>well, I think my proposal is rather the opposite: <em>not</em> have magic behavior for any !-like type</p>
</blockquote>
<p>I feel like this runs into the risk of not having any canonical <code>!</code>-like type, especially given that the name for the best candidate we currently have (<code>std::convert::Infallible</code>) is really poorly suited for that</p>



<a name="272730854"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272730854" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272730854">(Feb 21 2022 at 20:11)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/213817-t-lang/topic/never.20type.20design.20meeting/near/272730496">said</a>:</p>
<blockquote>
<p>Sorry if I missed this earlier in the conversation, but I'm curious what we gain by not using the name <code>!</code>?</p>
</blockquote>
<p>No, you didn't miss anything.  Maybe we don't gain anything, though I think that people might expect more smarts from something with a special name than they do something that looks like a normal type.</p>



<a name="272730895"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272730895" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272730895">(Feb 21 2022 at 20:11)</a>:</h4>
<p><code>()</code> has a special name but not much smarts AFAIK</p>



<a name="272730988"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272730988" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272730988">(Feb 21 2022 at 20:12)</a>:</h4>
<p><span class="user-mention silent" data-user-id="271719">Mario Carneiro</span> <a href="#narrow/stream/213817-t-lang/topic/never.20type.20design.20meeting/near/272730895">said</a>:</p>
<blockquote>
<p><code>()</code> has a special name but not much smarts AFAIK</p>
</blockquote>
<p>The automatic <code>else { () }</code> is pretty special, though I agree that's not exactly "smarts".</p>



<a name="272731044"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272731044" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272731044">(Feb 21 2022 at 20:13)</a>:</h4>
<p>I think of <code>!</code> as the co-<code>()</code>, the 0-ary anonymous enum</p>



<a name="272731089"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272731089" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272731089">(Feb 21 2022 at 20:13)</a>:</h4>
<p>so a snappy symbol name seems fine</p>



<a name="272731162"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272731162" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272731162">(Feb 21 2022 at 20:14)</a>:</h4>
<p><span class="user-mention silent" data-user-id="271719">Mario Carneiro</span> <a href="#narrow/stream/213817-t-lang/topic/never.20type.20design.20meeting/near/272731044">said</a>:</p>
<blockquote>
<p>I think of <code>!</code> as the co-<code>()</code>, the 0-ary anonymous enum</p>
</blockquote>
<p>It's just the <code>NonZeroU0</code> to <code>()</code>s <code>u0</code>.</p>



<a name="272731216"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272731216" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272731216">(Feb 21 2022 at 20:15)</a>:</h4>
<p>Actually, <span class="user-mention" data-user-id="116122">@simulacrum</span>, I don't see anything about <code>match</code> being smart about uninhabited variants in the doc.</p>
<p>I remember that being the same feature gate as <code>!</code>.  Is it no longer, and thus out of scope for this conversation?</p>
<p>Because we might say that  the special behaviour it does have would be that <code>let None: Option&lt;!&gt; = None;</code> is infallible, even if perhaps it wouldn't be for any other uninhabited type.</p>



<a name="272731237"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272731237" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272731237">(Feb 21 2022 at 20:15)</a>:</h4>
<p>It's not related to ! -- IIRC, it's either stabilized already or a separate feature gate, I can look</p>



<a name="272731303"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272731303" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272731303">(Feb 21 2022 at 20:16)</a>:</h4>
<p>(Or, perhaps more realistically, <code>let Ok(x) = u32::try_from(0_u8);</code> being allowed once that impl uses magic-Never.)</p>



<a name="272731327"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272731327" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272731327">(Feb 21 2022 at 20:16)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/issues/51085">https://github.com/rust-lang/rust/issues/51085</a></p>



<a name="272731374"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272731374" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272731374">(Feb 21 2022 at 20:17)</a>:</h4>
<p>I would not intuitively expect that ! should be different from 'any other uninhabited type', personally, but I think in either case it's sort of a separate discussion -- I think worthwhile to add a short section on though</p>



<a name="272731547"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272731547" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272731547">(Feb 21 2022 at 20:19)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116122">simulacrum</span> <a href="#narrow/stream/213817-t-lang/topic/never.20type.20design.20meeting/near/272731374">said</a>:</p>
<blockquote>
<p>I would not intuitively expect that ! should be different from 'any other uninhabited type', personally</p>
</blockquote>
<p>That's not completely obvious to me, because <code>()</code> is more special than any other ZST, for example.</p>
<p>Maybe not <em>substantially</em> more special, especially in behaviour of instances, but it definitely has a privileged position.</p>
<p>(<code>-&gt; !</code> being special being kinda like how <code>-&gt; ()</code> is special comes to mind.)</p>



<a name="272731573"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272731573" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272731573">(Feb 21 2022 at 20:19)</a>:</h4>
<p>Added a short section</p>



<a name="272731649"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272731649" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272731649">(Feb 21 2022 at 20:20)</a>:</h4>
<p>Yeah, in general, I agree with <code>!</code> being special -- but not in patterns, I think. Not sure there.</p>



<a name="272731864"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272731864" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272731864">(Feb 21 2022 at 20:23)</a>:</h4>
<p>One of my <code>?</code> PRs implied to me that <code>exhaustive_patterns</code> is surprisingly expensive, perhaps because it needs to handle things like <code>Result&lt;!, !&gt;</code> and not just <code>!</code> -- though maybe that's not an "only <code>!</code> should be special" but an "only zero-variant enums should be special".</p>
<p>(Thought after some of the recent things we've hit, my brain immediately pipes up with "zero-variant enums that aren't <code>#[non_exhaustive]</code>!"...)</p>



<a name="272732068"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272732068" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272732068">(Feb 21 2022 at 20:26)</a>:</h4>
<p>But back to the actual topic, I'm sad that the fallback change looks like it's impractical, since <code>Err(x)</code> being <code>Result&lt;!, _&gt;</code> would really have been pretty nice, but the doc says to me that we just shouldn't change it.</p>



<a name="272732884"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272732884" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272732884">(Feb 21 2022 at 20:37)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310518">Jake</span> <a href="#narrow/stream/213817-t-lang/topic/never.20type.20design.20meeting/near/272730800">said</a>:</p>
<blockquote>
<p>I feel like this runs into the risk of not having any canonical <code>!</code>-like type, especially given that the name for the best candidate we currently have (<code>std::convert::Infallible</code>) is really poorly suited for that</p>
</blockquote>
<p>I think it's very important that we have <em>a</em> canonical never type, since libraries all through the ecosystem will want to implement their traits for it.</p>
<p><span class="user-mention" data-user-id="116122">@simulacrum</span> The biggest reason I think it's important that <code>Infallible</code> becomes a type alias for whatever-it-is that we make the canonical type -- be that <code>!</code> or <code>core::something::Never</code> or ... -- is that people are today implementing traits for <code>Infallible</code>, so having it become a type alias for <em>the</em> canonical thing means that they immediately support that type.  If it's not an alias, then there will be an MSRV-annoying rust to impl traits for whatever the new thing is.</p>
<p>(And I agree that it would be a shame if it that canonical type was named <code>Infallible</code> forever, as that's an ok name in <code>convert</code> but globally is pretty bad -- especially since <code>-&gt; Infallible</code> basically does the opposite of what it appears to say.)</p>



<a name="272734806"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272734806" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272734806">(Feb 21 2022 at 21:02)</a>:</h4>
<p><span class="user-mention silent" data-user-id="125270">scottmcm</span> <a href="#narrow/stream/213817-t-lang/topic/never.20type.20design.20meeting/near/272731864">said</a>:</p>
<blockquote>
<p>One of my <code>?</code> PRs implied to me that <code>exhaustive_patterns</code> is surprisingly expensive, perhaps because it needs to handle things like <code>Result&lt;!, !&gt;</code> and not just <code>!</code> -- though maybe that's not an "only <code>!</code> should be special" but an "only zero-variant enums should be special".</p>
<p>(Thought after some of the recent things we've hit, my brain immediately pipes up with "zero-variant enums that aren't <code>#[non_exhaustive]</code>!"...)</p>
</blockquote>
<p>patterns are surprisingly expensive and underdeveloped in general IMO. There's a lot of missed optimizations concerning them. I mean perhaps you mean something more uniquely particular, but</p>



<a name="272796242"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272796242" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272796242">(Feb 22 2022 at 12:35)</a>:</h4>
<p>exhaustive_patterns + never_type is extremely nice and I'd be very sad if it was ruled out forever</p>



<a name="272796291"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272796291" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272796291">(Feb 22 2022 at 12:36)</a>:</h4>
<p>I'd support changing the name, <code>!</code> is cryptic and heard to search for</p>



<a name="272796352"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272796352" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272796352">(Feb 22 2022 at 12:37)</a>:</h4>
<p><code>!</code> is a meme source, though. </p>
<blockquote>
<p>When will that divergent type be stabilized?<br>
<code>!</code></p>
</blockquote>



<a name="272796603"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272796603" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272796603">(Feb 22 2022 at 12:39)</a>:</h4>
<p>I would also like to see exhaustive_patterns performance bugfixed if that's the issue. It doesn't seem like it should be a huge expense, any more than regular pattern matching, even accounting for stuff like <code>Result&lt;!, !&gt;</code> being uninhabited</p>



<a name="272796830"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272796830" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272796830">(Feb 22 2022 at 12:41)</a>:</h4>
<p>And also I've used Lean for years which has exhaustive_patterns from the start and it's never been a problem. (It's extra cool when you add dependent types, since then you can pattern match on <code>{v: Vec&lt;A&gt; | v.len() == 3}</code> and only have one case <code>([a, b, c], _) =&gt; ...</code>)</p>



<a name="272798336"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272798336" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272798336">(Feb 22 2022 at 12:56)</a>:</h4>
<p>if you're looking for an intuitive name for <code>!</code> then we can reuse existing terminology and  call it <code>Unreachable</code></p>



<a name="272799086"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272799086" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272799086">(Feb 22 2022 at 13:03)</a>:</h4>
<p><span class="user-mention silent" data-user-id="256342">bstrie</span> <a href="#narrow/stream/213817-t-lang/topic/never.20type.20design.20meeting/near/272796242">said</a>:</p>
<blockquote>
<p>exhaustive_patterns + never_type is extremely nice and I'd be very sad if it was ruled out forever</p>
</blockquote>
<p>FWIW, it does seem like <code>exhaustive_patterns</code> does not necessarily require <code>never_type</code> to shine, any uninhabited type will do (<em>e.g.</em>, <code>enum Never {} let None::&lt;Never&gt;;</code>).</p>



<a name="272799089"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272799089" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272799089">(Feb 22 2022 at 13:03)</a>:</h4>
<p>That being said, I personally agree that in the same fashion that we use <code>()</code> over <code>Unit</code>, "divergence" seems special enough for some canonical form of it being being sigil-based (I wouldn't be fond of seeing <code>fn handle_alloc_error(…) -&gt; Never</code> kind of signatures).</p>



<a name="272817819"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272817819" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272817819">(Feb 22 2022 at 15:24)</a>:</h4>
<p>Given that we already support <code>!</code> as function return type for ages I don't think we should change it.</p>



<a name="272818002"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272818002" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272818002">(Feb 22 2022 at 15:25)</a>:</h4>
<p>See, that was rust's first mistake wrt. <code>!</code>.</p>



<a name="272819301"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272819301" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272819301">(Feb 22 2022 at 15:33)</a>:</h4>
<p>I wouldn't call it a mistake, having some kind of access to the bottom type was pretty much non-negotiable for 1.0. the problem was that the syntax dates back to before even 0.1, so it never really got any rigorous consideration :P</p>



<a name="272819530"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272819530" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272819530">(Feb 22 2022 at 15:35)</a>:</h4>
<p>I mean, it was arguably a mistake to let people name the type at all, if you can't name the type normally.</p>



<a name="272819557"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272819557" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272819557">(Feb 22 2022 at 15:35)</a>:</h4>
<p>Because people will just name it anyways anywhere they want.</p>



<a name="272820087"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272820087" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272820087">(Feb 22 2022 at 15:38)</a>:</h4>
<p>well, it's deliberately <em>not</em> naming the type. from the 0.1 manual: 'The ! annotation does not denote a type. Rather, the result type of a diverging function is a special type called $\bot$ ("bottom") that unifies with any type. Rust has no syntax for $\bot$.' So it was never intended to be the type itself, it's just that people thought it would be consistent to reuse the same syntax.</p>



<a name="272820216"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272820216" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272820216">(Feb 22 2022 at 15:39)</a>:</h4>
<p>But you can write <code>impl&lt;R&gt; fn()-&gt;R</code>, to name <code>R</code>.</p>



<a name="272820748"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272820748" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272820748">(Feb 22 2022 at 15:42)</a>:</h4>
<p>Can someone explain why changing inference from <code>()</code> to <code>!</code> can lead to UB? The whole discussion about the need of a complex inference algorithm seems to be all based on this, but I never understand the original issue in the first place.</p>



<a name="272820883"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272820883" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272820883">(Feb 22 2022 at 15:43)</a>:</h4>
<p>I know there can be breakages due to this change, but that's something that could be done via the next edition.</p>



<a name="272821014"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272821014" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272821014">(Feb 22 2022 at 15:44)</a>:</h4>
<p><span class="user-mention" data-user-id="303710">@Gary Guo</span> did you read <a href="https://rust-lang.github.io/never-type-initiative/explainer/conditional-fallback-v1.html#bug-66173-unsoundness-introduced-by-changing-fallback-from--to-">https://rust-lang.github.io/never-type-initiative/explainer/conditional-fallback-v1.html#bug-66173-unsoundness-introduced-by-changing-fallback-from--to-</a>?</p>



<a name="272821096"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272821096" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272821096">(Feb 22 2022 at 15:45)</a>:</h4>
<p>today that code is weird &amp; probably not what's intended, but safe code and produces <code>()</code></p>



<a name="272821140"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272821140" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272821140">(Feb 22 2022 at 15:45)</a>:</h4>
<p>but if we just change inference to <code>!</code> you get unsoundness, because you've produced a type indicating divergence in live code.</p>



<a name="272821217"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272821217" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272821217">(Feb 22 2022 at 15:46)</a>:</h4>
<p>I've read that. But that wouldn't compile if <code>()</code> is changed to <code>!</code>. The linked issue gives a <code>unconstrained_return</code> which I think is unsound in the first place.</p>



<a name="272821613"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272821613" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272821613">(Feb 22 2022 at 15:48)</a>:</h4>
<p>So from my understanding the inference can cause breakage in poorly written safe code, and can cause previously-not-exhibited UB in poorly written (and unsound) unsafe code.</p>



<a name="272821646"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272821646" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272821646">(Feb 22 2022 at 15:48)</a>:</h4>
<p>So a new edition should suffice?</p>



<a name="272822368"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272822368" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272822368">(Feb 22 2022 at 15:53)</a>:</h4>
<p>yeah, I'm not sure if there's purely safe code that can change behavior -- it seems not impossible. In particular, you could impl for () and Infallible and if we change Infallible to alias !, things change. An edition doesn't really work here because the Infallible = ! change basically has to be global I think</p>



<a name="272822407"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272822407" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272822407">(Feb 22 2022 at 15:53)</a>:</h4>
<p><span class="user-mention silent" data-user-id="303710">Gary Guo</span> <a href="#narrow/stream/213817-t-lang/topic/never.20type.20design.20meeting/near/272821217">said</a>:</p>
<blockquote>
<p>I've read that. But that wouldn't compile if <code>()</code> is changed to <code>!</code>. The linked issue gives a <code>unconstrained_return</code> which I think is unsound in the first place.</p>
</blockquote>
<p>I mean, the only thing you need to do is mark <code>unconstrained_return</code> as <code>unsafe</code>, and then its no longer unsound (under some safety contract) and you get the UB with the fallback change</p>



<a name="272823793"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272823793" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272823793">(Feb 22 2022 at 16:01)</a>:</h4>
<p>Can we use the v2 inference algorithm just for lint production? I.e. change inference fallback to <code>!</code> in the next edition and have the current v2 inference algorithm produces a lint whenever <code>()</code> needs to be inferred?</p>



<a name="272824128"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272824128" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272824128">(Feb 22 2022 at 16:03)</a>:</h4>
<p>edition-dependent inference doesn't really work: you can't change Infallible to be ! if you don't have inference changes too, and you need the first of those to be on all editions -- this is something I tried to express in the doc, but maybe not very well? Suggestions on how to make that clearer definitely appreciated.</p>



<a name="272825543"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272825543" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272825543">(Feb 22 2022 at 16:12)</a>:</h4>
<p>I think I need to ingest more code example <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="272828374"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272828374" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272828374">(Feb 22 2022 at 16:28)</a>:</h4>
<p>Just thinking out loud: can we:</p>
<ul>
<li>Have two flavours of never type, i'll call it <code>never </code> and  <code>never_legacy</code>.</li>
<li>Inference variables created by <code>never_legacy</code> coercion falls back to <code>()</code>.</li>
<li>Inference variables created by <code>never</code> falls backs to <code>never</code>.</li>
<li>All current way of producing <code>!</code> becomes <code>never_legacy</code> (e.g. return <code>!</code> ,<code>loop {}</code>)</li>
<li><code>!</code> (except as function return value) and <code>Infallible</code> becomes alias to <code>never</code>.</li>
<li>Change <code>never_legacy</code> to also falls back to <code>never</code> in the next edition.</li>
</ul>



<a name="272952558"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272952558" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272952558">(Feb 23 2022 at 14:05)</a>:</h4>
<blockquote>
<p>In particular, you could impl for () and Infallible and if we change Infallible to alias !, things change. An edition doesn't really work here because the Infallible = ! change basically has to be global I think</p>
</blockquote>
<p>Yeah, but the documentation explicitly forbids doing that. If you do that and your code breaks when the compiler updates, well that's your fault. As long as it doesn't result in unsound code, it shouldn't be a problem.</p>



<a name="272952800"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272952800" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272952800">(Feb 23 2022 at 14:07)</a>:</h4>
<p>Two flavors is essentially 'Edition-dependent migration away from special coercion behavior for !, letting us avoid inference algorithm changes while changing Infallible = ! aliasing.', I think, just with an early-opt-in of some kind on earlier editions under some other name (or context-dependent, in theory).</p>



<a name="272952891"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272952891" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272952891">(Feb 23 2022 at 14:08)</a>:</h4>
<p><span class="user-mention silent" data-user-id="263609">Olivier FAURE</span> <a href="#narrow/stream/213817-t-lang/topic/never.20type.20design.20meeting/near/272952558">said</a>:</p>
<blockquote>
<blockquote>
<p>In particular, you could impl for () and Infallible and if we change Infallible to alias !, things change. An edition doesn't really work here because the Infallible = ! change basically has to be global I think</p>
</blockquote>
<p>Yeah, but the documentation explicitly forbids doing that. If you do that and your code breaks when the compiler updates, well that's your fault. As long as it doesn't result in unsound code, it shouldn't be a problem.</p>
</blockquote>
<p>Documentation doesn't forbid impls for () and Infallible? The only thing we ask users not to do is impl for Infallible and ! (e.g., for function pointers with those return types), but that's pretty unlikely compared to impling for () and Infallible, which is not unreasonable.</p>



<a name="272952984"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272952984" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272952984">(Feb 23 2022 at 14:08)</a>:</h4>
<p>And it seems pretty clear that such a behavior change could result in unsound code since it's changing what gets called. Not necessarily currently <em>good</em> code changing, but still.</p>



<a name="272953194"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272953194" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272953194">(Feb 23 2022 at 14:10)</a>:</h4>
<p>Was there ever a crater run done for unsafe code which would be impacted by the inference change?</p>



<a name="272953529"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272953529" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272953529">(Feb 23 2022 at 14:13)</a>:</h4>
<p>Honestly it's not clear to me how we can ever make changes to inference if this example is considered a soundness issue</p>



<a name="272953543"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272953543" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272953543">(Feb 23 2022 at 14:13)</a>:</h4>
<p>I'm not sure on crater, but we definitely have stumbled upon cases when trying to stabilize in user reports</p>



<a name="272953650"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272953650" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272953650">(Feb 23 2022 at 14:14)</a>:</h4>
<p>a future incompatibility lint for this would be great</p>



<a name="272954306"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272954306" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272954306">(Feb 23 2022 at 14:19)</a>:</h4>
<p>IIRC, it's not clear in which cases we should lint to avoid false positives -- and without careful logic, you lint a lot on code that really doesn't care about this, which makes such a lint impractical. Plus, typically we emit such lints when the next step is either an error or a breaking change that's more benign than silently introducing miscompilations effectively (which is what some of the past attempts to land ! did for e.g. Servo).</p>



<a name="272967035"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272967035" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272967035">(Feb 23 2022 at 15:49)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116122">simulacrum</span> <a href="#narrow/stream/213817-t-lang/topic/never.20type.20design.20meeting/near/272952800">said</a>:</p>
<blockquote>
<p>Two flavors is essentially 'Edition-dependent migration away from special coercion behavior for !, letting us avoid inference algorithm changes while changing Infallible = ! aliasing.', I think, just with an early-opt-in of some kind on earlier editions under some other name (or context-dependent, in theory).</p>
</blockquote>
<p>I am not exactly sure what that "migration away from special coercion behavior" mean in that sentence. I interpret that as meaning that we can no longer accept a match where one arm returns <code>T</code> and another returns <code>!</code>? That doesn't sound good for me.</p>



<a name="272967543"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272967543" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272967543">(Feb 23 2022 at 15:53)</a>:</h4>
<p>I think we're somewhat forced into it unless we want the complex inference algorithm</p>



<a name="272967722"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272967722" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272967722">(Feb 23 2022 at 15:54)</a>:</h4>
<p>It's possible that the match desugaring / type check could be changed such that the first arm or something gives the canonical type, rather than trying to find ?M such that all the ?T from each arm can be coerced into it, which is I believe current logic.</p>



<a name="272969292"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272969292" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272969292">(Feb 23 2022 at 16:03)</a>:</h4>
<p>I think we should keep accepting these. What I propose is that:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">foo</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="o">!</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="fm">todo!</span><span class="p">()</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">bar</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">Infallible</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="fm">todo!</span><span class="p">()</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="n">something</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">pattern1</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">unconstrained_return</span><span class="p">(),</span><span class="w"></span>
<span class="w">    </span><span class="n">pattern2</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">foo</span><span class="p">(),</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="n">something</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">pattern1</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">unconstrained_return</span><span class="p">(),</span><span class="w"></span>
<span class="w">    </span><span class="n">pattern2</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">bar</span><span class="p">(),</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
</code></pre></div>
<p>will have <code>x</code> inferred to <code>Infallible</code> in Rust 2024 and <code>()</code> in Rust 2021, while <code>y</code> will always be inferred to <code>Infallible</code>.</p>



<a name="272969537"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272969537" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272969537">(Feb 23 2022 at 16:04)</a>:</h4>
<p>I'm not sure what the advantage of that over just landing the complex inference algorithm onto all editions is -- we'd still have to maintain it, presumably, indefinitely for Rust 2015-2021 code</p>



<a name="272969985"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272969985" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272969985">(Feb 23 2022 at 16:07)</a>:</h4>
<p>This is different from current rules I believe, this just looks at where the <code>!</code> comes from. If it's from a <code>-&gt; !</code> or a non-returning expression, then it falls back to <code>()</code>, and otherwsie it falls back to <code>!</code>.</p>



<a name="272970622"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272970622" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272970622">(Feb 23 2022 at 16:12)</a>:</h4>
<p>It doesn't seem to fix the soundness problem, though? <code>y</code> inferring to Infallible is basically introducing UB into (poorly written, yes) unsafe code where it didn't really exist before</p>



<a name="272970659"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272970659" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272970659">(Feb 23 2022 at 16:12)</a>:</h4>
<p>I agree it's a simpler rule set in theory, though I'm not sure we can plausibly track 'where ! comes from'</p>



<a name="272974914"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272974914" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272974914">(Feb 23 2022 at 16:43)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116122">simulacrum</span> <a href="#narrow/stream/213817-t-lang/topic/never.20type.20design.20meeting/near/272970622">said</a>:</p>
<blockquote>
<p>It doesn't seem to fix the soundness problem, though? <code>y</code> inferring to Infallible is basically introducing UB into (poorly written, yes) unsafe code where it didn't really exist before</p>
</blockquote>
<p>It wouldn't because <code>Infallible</code> can't unify with other types today so unconstrained type vars are already inferred to be <code>Infallible</code>.</p>



<a name="272975486"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272975486" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272975486">(Feb 23 2022 at 16:47)</a>:</h4>
<p>I think the key takeaway is that there's no proposal so far that lets Infallible and ! alias unless we implement the complex inference algorithm</p>



<a name="272975790"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272975790" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272975790">(Feb 23 2022 at 16:49)</a>:</h4>
<p>If we avoid that it's then possible to make changes over an edition boundary, perhaps as you describe.</p>



<a name="272979379"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272979379" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272979379">(Feb 23 2022 at 17:12)</a>:</h4>
<p>My understanding is that Gary's proposal achieves this: <code>Infallible</code> and <code>!</code> are unified, but when written in certain positions like <code>foo() -&gt; !</code> you get the <code>never_legacy</code> type instead</p>



<a name="272979490"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272979490" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272979490">(Feb 23 2022 at 17:13)</a>:</h4>
<p>although I'm not clear on whether <code>never</code> and <code>never_legacy</code> unify as types though; can you have coherent impls on both?</p>



<a name="272979693"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272979693" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272979693">(Feb 23 2022 at 17:14)</a>:</h4>
<p>right, I think that is basically what I mean by don't unify</p>



<a name="272980823"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272980823" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272980823">(Feb 23 2022 at 17:21)</a>:</h4>
<p>it's worth noting that you can get the <code>!</code> type appearing in nested contexts on stable (or the <code>never_legacy</code> type in Gary's proposal):</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">foo</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="o">!</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">loop</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">bar</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">f</span>: <span class="nc">fn</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">T</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Option</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">None</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="cm">/* : Option&lt;!&gt; */</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bar</span><span class="p">(</span><span class="n">foo</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>I don't know how to implement traits on such types though, since you have to name the type to do that</p>



<a name="272981455"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272981455" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272981455">(Feb 23 2022 at 17:25)</a>:</h4>
<p>You can do it by implementing a trait for <code>fn</code> and making an associated type for the return type.</p>
<p>We're explicitly allowed to break people doing that, though.</p>



<a name="272982349"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272982349" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272982349">(Feb 23 2022 at 17:30)</a>:</h4>
<p>Oh cool</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">trait</span><span class="w"> </span><span class="n">Trait</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">type</span> <span class="nc">Ret</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Trait</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="k">fn</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">T</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="k">type</span> <span class="nc">Ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="k">type</span> <span class="nc">Never</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="k">fn</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="o">!</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Trait</span><span class="o">&gt;</span>::<span class="n">Ret</span><span class="p">;</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">foo</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="o">!</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">loop</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">bar</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">f</span>: <span class="nc">fn</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">T</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Option</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">None</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="kd">let</span><span class="w"> </span><span class="n">x</span>: <span class="nb">Option</span><span class="o">&lt;</span><span class="n">Never</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bar</span><span class="p">(</span><span class="n">foo</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="272987205"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272987205" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272987205">(Feb 23 2022 at 17:59)</a>:</h4>
<p>Meeting soon!  Re-linking the doc: <a href="https://hackmd.io/9sTGmQ_VQ_mX_bdQhuqVRA">https://hackmd.io/9sTGmQ_VQ_mX_bdQhuqVRA</a></p>



<a name="272987551"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272987551" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272987551">(Feb 23 2022 at 18:00)</a>:</h4>
<p>Since Niko isn't available, do we need a separate room today?</p>



<a name="272987580"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272987580" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272987580">(Feb 23 2022 at 18:00)</a>:</h4>
<p><span class="user-mention" data-user-id="239881">@Josh Triplett</span> I can spin up a google meet or we can do jitsi</p>



<a name="272987981"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272987981" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272987981">(Feb 23 2022 at 18:03)</a>:</h4>
<p>Let's try Jitsi, if that's OK.</p>



<a name="272988057"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272988057" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272988057">(Feb 23 2022 at 18:03)</a>:</h4>
<p>Sure</p>



<a name="272988079"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272988079" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272988079">(Feb 23 2022 at 18:03)</a>:</h4>
<p>Can you set it up?</p>



<a name="272988186"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272988186" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272988186">(Feb 23 2022 at 18:04)</a>:</h4>
<p><a href="https://meet.jit.si/RBgxW8fHOMCtvKPO">https://meet.jit.si/RBgxW8fHOMCtvKPO</a></p>



<a name="272988534"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272988534" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272988534">(Feb 23 2022 at 18:06)</a>:</h4>
<p>ping <span class="user-group-mention" data-user-group-id="1977">@T-lang</span> Design meeting starting.</p>



<a name="272996060"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%20design%20meeting/near/272996060" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.20design.20meeting.html#272996060">(Feb 23 2022 at 19:02)</a>:</h4>
<p>I think I want to know more about these unsound cases in the wild.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>