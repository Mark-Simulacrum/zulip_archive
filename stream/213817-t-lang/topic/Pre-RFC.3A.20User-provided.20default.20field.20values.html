<html>
<head><meta charset="utf-8"><title>Pre-RFC: User-provided default field values · t-lang · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/index.html">t-lang</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Pre-RFC.3A.20User-provided.20default.20field.20values.html">Pre-RFC: User-provided default field values</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="266382482"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Pre-RFC%3A%20User-provided%20default%20field%20values/near/266382482" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Pre-RFC.3A.20User-provided.20default.20field.20values.html#266382482">(Dec 29 2021 at 22:02)</a>:</h4>
<p>For those that don't follow IRLO, I posted a pre-RFC where the following would be a thing with what I hope is obvious semantics:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#[derive(Default)]</span><span class="w"></span>
<span class="k">struct</span> <span class="nc">Window</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">width</span>: <span class="kt">u16</span> <span class="o">=</span><span class="w"> </span><span class="mi">640</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">height</span>: <span class="kt">u16</span> <span class="o">=</span><span class="w"> </span><span class="mi">480</span><span class="p">,</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>[<a href="https://internals.rust-lang.org/t/pre-rfc-user-provided-default-field-values/15877?u=jhpratt">link</a>]</p>



<a name="266382662"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Pre-RFC%3A%20User-provided%20default%20field%20values/near/266382662" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Pre-RFC.3A.20User-provided.20default.20field.20values.html#266382662">(Dec 29 2021 at 22:05)</a>:</h4>
<p>I read the proposal, and I'm in favor of that syntax. However, I don't think we should limit it to constant expressions. I think <em>if</em> you give a constant expression we can provide a const impl of Default. But if you don't, we can still provide an impl of Default.</p>



<a name="266382676"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Pre-RFC%3A%20User-provided%20default%20field%20values/near/266382676" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Pre-RFC.3A.20User-provided.20default.20field.20values.html#266382676">(Dec 29 2021 at 22:05)</a>:</h4>
<p>We can simply inline whatever non-constant expression you provide into the derived implementation of Default.</p>



<a name="266382746"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Pre-RFC%3A%20User-provided%20default%20field%20values/near/266382746" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Pre-RFC.3A.20User-provided.20default.20field.20values.html#266382746">(Dec 29 2021 at 22:06)</a>:</h4>
<p>I can easily think of reasons to want a non-constant implementation. Consider interning, or a global cache, or an ID generator.</p>



<a name="266383526"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Pre-RFC%3A%20User-provided%20default%20field%20values/near/266383526" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Pre-RFC.3A.20User-provided.20default.20field.20values.html#266383526">(Dec 29 2021 at 22:16)</a>:</h4>
<p>I've been thinking about deriving const impls recently (partly because of this, partly because of something else). Given that derives are just macros without access to type information, I don't think it would be possible to <code>impl const Default</code> based on whether an expression is a const expression (or if other types' defaults <code>impl const Default</code>). Would it make sense to have a more general mechanism such as <code>#[derive(Default(const))]</code>?</p>



<a name="266383535"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Pre-RFC%3A%20User-provided%20default%20field%20values/near/266383535" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Pre-RFC.3A.20User-provided.20default.20field.20values.html#266383535">(Dec 29 2021 at 22:16)</a>:</h4>
<p>obviously not as part of this RFC</p>



<a name="266383571"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Pre-RFC%3A%20User-provided%20default%20field%20values/near/266383571" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Pre-RFC.3A.20User-provided.20default.20field.20values.html#266383571">(Dec 29 2021 at 22:17)</a>:</h4>
<p>I think I would spell that <code>derive(const Default)</code>, but <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span> .</p>



<a name="266383638"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Pre-RFC%3A%20User-provided%20default%20field%20values/near/266383638" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Pre-RFC.3A.20User-provided.20default.20field.20values.html#266383638">(Dec 29 2021 at 22:18)</a>:</h4>
<p>Either way.</p>



<a name="266383688"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Pre-RFC%3A%20User-provided%20default%20field%20values/near/266383688" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Pre-RFC.3A.20User-provided.20default.20field.20values.html#266383688">(Dec 29 2021 at 22:19)</a>:</h4>
<p>Having a mechanism like that raises some other questions, but that's an aside.</p>



<a name="266383698"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Pre-RFC%3A%20User-provided%20default%20field%20values/near/266383698" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Pre-RFC.3A.20User-provided.20default.20field.20values.html#266383698">(Dec 29 2021 at 22:19)</a>:</h4>
<p>(Concrete design principle rather than bikeshedding:  I think it's good to use similar syntax for similar mechanisms, and since we write <code>impl const Trait</code>, we should write <code>derive(const Trait)</code>.)</p>



<a name="266383798"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Pre-RFC%3A%20User-provided%20default%20field%20values/near/266383798" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Pre-RFC.3A.20User-provided.20default.20field.20values.html#266383798">(Dec 29 2021 at 22:20)</a>:</h4>
<p><span class="user-mention silent" data-user-id="245610">Jacob Pratt</span> <a href="#narrow/stream/213817-t-lang/topic/Pre-RFC.3A.20User-provided.20default.20field.20values/near/266383526">said</a>:</p>
<blockquote>
<p>I've been thinking about deriving const impls recently (partly because of this, partly because of something else). Given that derives are just macros without access to type information, I don't think it would be possible to <code>impl const Default</code> based on whether an expression is a const expression (or if other types' defaults <code>impl const Default</code>). Would it make sense to have a more general mechanism such as <code>#[derive(Default(const))]</code>?</p>
</blockquote>
<p>Even if it were possible, I don't think it would be a good idea, since this becomes a semver hazard.</p>



<a name="266383826"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Pre-RFC%3A%20User-provided%20default%20field%20values/near/266383826" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Pre-RFC.3A.20User-provided.20default.20field.20values.html#266383826">(Dec 29 2021 at 22:21)</a>:</h4>
<p><span class="user-mention" data-user-id="310518">@Jake</span> Very good point.</p>



<a name="266383847"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Pre-RFC%3A%20User-provided%20default%20field%20values/near/266383847" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Pre-RFC.3A.20User-provided.20default.20field.20values.html#266383847">(Dec 29 2021 at 22:21)</a>:</h4>
<p>That's partly why the RFC requires const expressions right now.</p>



<a name="266383861"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Pre-RFC%3A%20User-provided%20default%20field%20values/near/266383861" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Pre-RFC.3A.20User-provided.20default.20field.20values.html#266383861">(Dec 29 2021 at 22:21)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/213817-t-lang/topic/Pre-RFC.3A.20User-provided.20default.20field.20values/near/266383571">said</a>:</p>
<blockquote>
<p>I think I would spell that <code>derive(const Default)</code>, but <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span> .</p>
</blockquote>
<p>How would this work in general for Derive macros?</p>



<a name="266383915"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Pre-RFC%3A%20User-provided%20default%20field%20values/near/266383915" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Pre-RFC.3A.20User-provided.20default.20field.20values.html#266383915">(Dec 29 2021 at 22:22)</a>:</h4>
<p><span class="user-mention silent" data-user-id="257758">Connor Horman</span> <a href="#narrow/stream/213817-t-lang/topic/Pre-RFC.3A.20User-provided.20default.20field.20values/near/266383861">said</a>:</p>
<blockquote>
<p>How would this work in general for Derive macros?</p>
</blockquote>
<p>That's the aside that I mentioned <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span> It's not particularly relevant to this specific RFC, though.</p>



<a name="266383968"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Pre-RFC%3A%20User-provided%20default%20field%20values/near/266383968" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Pre-RFC.3A.20User-provided.20default.20field.20values.html#266383968">(Dec 29 2021 at 22:23)</a>:</h4>
<p>Given Jake's observation (which I agree with), I don't think in general we would want <code>derive(Default)</code> to imply a const impl, so I don't see any reason we should limit it to constants.</p>



<a name="266383987"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Pre-RFC%3A%20User-provided%20default%20field%20values/near/266383987" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Pre-RFC.3A.20User-provided.20default.20field.20values.html#266383987">(Dec 29 2021 at 22:24)</a>:</h4>
<p>In any case, as prior art, C++'s default member initializers seem fairly close to this. IIRC, those <em>do</em> require constant expressions, but they might be any expression (as long as you aren't using other fields).</p>



<a name="266384045"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Pre-RFC%3A%20User-provided%20default%20field%20values/near/266384045" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Pre-RFC.3A.20User-provided.20default.20field.20values.html#266384045">(Dec 29 2021 at 22:24)</a>:</h4>
<p><span class="user-mention" data-user-id="257758">@Connor Horman</span> That (const derives) would need some design work, but I think it's worth doing.</p>



<a name="266384221"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Pre-RFC%3A%20User-provided%20default%20field%20values/near/266384221" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Pre-RFC.3A.20User-provided.20default.20field.20values.html#266384221">(Dec 29 2021 at 22:27)</a>:</h4>
<p><span class="user-mention silent" data-user-id="245610">Jacob Pratt</span> <a href="#narrow/stream/213817-t-lang/topic/Pre-RFC.3A.20User-provided.20default.20field.20values/near/266383847">said</a>:</p>
<blockquote>
<p>That's partly why the RFC requires const expressions right now.</p>
</blockquote>
<p>I'm not following this reasoning. If we want const derives in the future, and we want those to be spelled <code>#[derive(const Default)]</code>, doesn't this mean that the proposed enhancement to <code>#[derive(Default)]</code> should be completely ok with non-const values?</p>



<a name="266384230"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Pre-RFC%3A%20User-provided%20default%20field%20values/near/266384230" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Pre-RFC.3A.20User-provided.20default.20field.20values.html#266384230">(Dec 29 2021 at 22:27)</a>:</h4>
<p>Uh, yeah, what Josh said</p>



<a name="266384349"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Pre-RFC%3A%20User-provided%20default%20field%20values/near/266384349" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Pre-RFC.3A.20User-provided.20default.20field.20values.html#266384349">(Dec 29 2021 at 22:29)</a>:</h4>
<p><span class="user-mention silent" data-user-id="257758">Connor Horman</span> <a href="#narrow/stream/213817-t-lang/topic/Pre-RFC.3A.20User-provided.20default.20field.20values/near/266383987">said</a>:</p>
<blockquote>
<p>In any case, as prior art, C++'s default member initializers seem fairly close to this. IIRC, those <em>do</em> require constant expressions, but they might be any expression (as long as you aren't using other fields).</p>
</blockquote>
<div class="codehilite" data-code-language="C++"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="k">struct</span> <span class="nc">S</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">++</span><span class="n">x</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">S</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span><span class="w">                 </span><span class="c1">// uses default member initializer</span>
<span class="w">    </span><span class="n">S</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">arg</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">n</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="c1">// uses member initializer</span>
<span class="p">};</span><span class="w"></span>
</code></pre></div>
<p>Apparently not (to requiring constant expressions - I still think this is close enough to be considered prior art).</p>



<a name="266384766"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Pre-RFC%3A%20User-provided%20default%20field%20values/near/266384766" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Pre-RFC.3A.20User-provided.20default.20field.20values.html#266384766">(Dec 29 2021 at 22:35)</a>:</h4>
<p>Is <code>x</code> incremented when you use the second constructor?</p>



<a name="266384900"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Pre-RFC%3A%20User-provided%20default%20field%20values/near/266384900" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Pre-RFC.3A.20User-provided.20default.20field.20values.html#266384900">(Dec 29 2021 at 22:36)</a>:</h4>
<p>It is not, no. Though, that is likely moot for the application here.</p>



<a name="266385209"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Pre-RFC%3A%20User-provided%20default%20field%20values/near/266385209" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Pre-RFC.3A.20User-provided.20default.20field.20values.html#266385209">(Dec 29 2021 at 22:41)</a>:</h4>
<p>Actually, that may be relevant, because in rust it would be, if you did<code>S{ n: 0, ..Default::default()}</code> (realising that is useless in the equivalent of that example, but in more general examples). That would still increment <code>x</code> in that case.</p>



<a name="266386439"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Pre-RFC%3A%20User-provided%20default%20field%20values/near/266386439" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Pre-RFC.3A.20User-provided.20default.20field.20values.html#266386439">(Dec 29 2021 at 23:00)</a>:</h4>
<p>I think I'm going to go ahead and change it to be a generic expression, deferring to a potential <code>#[derive(const Default)]</code> in a future RFC.</p>



<a name="266443982"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Pre-RFC%3A%20User-provided%20default%20field%20values/near/266443982" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Pre-RFC.3A.20User-provided.20default.20field.20values.html#266443982">(Dec 30 2021 at 17:29)</a>:</h4>
<p>After some additional discussion on IRLO, I'll investigate whether to take it a step farther and adopt most of Centril's RFC. See the post for details.</p>



<a name="266798927"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Pre-RFC%3A%20User-provided%20default%20field%20values/near/266798927" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Pre-RFC.3A.20User-provided.20default.20field.20values.html#266798927">(Jan 04 2022 at 11:52)</a>:</h4>
<p>Previous RFC: <a href="https://github.com/rust-lang/rfcs/pull/1806">https://github.com/rust-lang/rfcs/pull/1806</a> (Sorry if this is mentioned already on irlo)</p>



<a name="266879210"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Pre-RFC%3A%20User-provided%20default%20field%20values/near/266879210" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Pre-RFC.3A.20User-provided.20default.20field.20values.html#266879210">(Jan 04 2022 at 23:34)</a>:</h4>
<p>I actually wasn't aware of that. Thanks!</p>



<a name="266880587"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Pre-RFC%3A%20User-provided%20default%20field%20values/near/266880587" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Cramer <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Pre-RFC.3A.20User-provided.20default.20field.20values.html#266880587">(Jan 04 2022 at 23:52)</a>:</h4>
<p>There's also this one: <a href="https://github.com/Centril/rfcs/blob/rfc/default-field-values/text/0000-default-field-values.md">https://github.com/Centril/rfcs/blob/rfc/default-field-values/text/0000-default-field-values.md</a></p>



<a name="266880639"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Pre-RFC%3A%20User-provided%20default%20field%20values/near/266880639" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Cramer <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Pre-RFC.3A.20User-provided.20default.20field.20values.html#266880639">(Jan 04 2022 at 23:52)</a>:</h4>
<p>which wasn't ever opened officially but was discussed internally by some members of the lang team at the time</p>



<a name="266880918"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Pre-RFC%3A%20User-provided%20default%20field%20values/near/266880918" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Pre-RFC.3A.20User-provided.20default.20field.20values.html#266880918">(Jan 04 2022 at 23:56)</a>:</h4>
<p>^^ that's the one I pulled a chunk of text from (and is linked to in the IRLO thread)</p>



<a name="267623905"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Pre-RFC%3A%20User-provided%20default%20field%20values/near/267623905" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Pre-RFC.3A.20User-provided.20default.20field.20values.html#267623905">(Jan 11 2022 at 18:21)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/213817-t-lang/topic/Pre-RFC.3A.20User-provided.20default.20field.20values/near/266382662">said</a>:</p>
<blockquote>
<p>I read the proposal, and I'm in favor of that syntax. However, I don't think we should limit it to constant expressions. I think <em>if</em> you give a constant expression we can provide a const impl of Default. But if you don't, we can still provide an impl of Default.</p>
</blockquote>
<p>I've said this on IRLO, but I think <code>Foo { .. }</code> doing non-const things is pretty weird, so I really like the restriction to <code>const</code> now that CTFE is quite capable.  (In 2016 it would have been a really annoying restriction, but these days I think it'd be fine.)</p>
<p>I'm still hoping to get Esteban's from &lt;<a href="https://internals.rust-lang.org/t/pre-pre-rfc-syntactic-sugar-for-default-default/13234/75?u=scottmcm">https://internals.rust-lang.org/t/pre-pre-rfc-syntactic-sugar-for-default-default/13234/75?u=scottmcm</a>&gt;, which I thought ended up in a good design place.</p>



<a name="267628481"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Pre-RFC%3A%20User-provided%20default%20field%20values/near/267628481" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Pre-RFC.3A.20User-provided.20default.20field.20values.html#267628481">(Jan 11 2022 at 18:54)</a>:</h4>
<p>I'm in support of limiting it to const for now, though in the future I might want it to be non-const.</p>



<a name="267628584"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Pre-RFC%3A%20User-provided%20default%20field%20values/near/267628584" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Pre-RFC.3A.20User-provided.20default.20field.20values.html#267628584">(Jan 11 2022 at 18:55)</a>:</h4>
<p>The most obvious case I can think of would be something like <code>unique_id: u128 = make_unique_id();</code>.</p>



<a name="267629827"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Pre-RFC%3A%20User-provided%20default%20field%20values/near/267629827" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Pre-RFC.3A.20User-provided.20default.20field.20values.html#267629827">(Jan 11 2022 at 19:04)</a>:</h4>
<p>If we <em>expected</em> to allow non-const in the future, we're probably want to require <code>x: i32 = const { foo() + bar() }</code> initially to be able to remove the constness restriction simply.</p>
<p>But it's non-obvious to me that we'd ever really want side effects in <code>Foo { .. }</code>.  Being able to think of the defaults like they were const items (&lt;<a href="https://internals.rust-lang.org/t/pre-rfc-user-provided-default-field-values/15877/120?u=scottmcm">https://internals.rust-lang.org/t/pre-rfc-user-provided-default-field-values/15877/120?u=scottmcm</a>&gt;) is a nice mental model, even if it might not desugar to exactly that.</p>
<p>(And I definitely don't want <code>Foo { .. .await? }</code> because someone wants a fallible async default for a field...)</p>



<a name="267670368"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Pre-RFC%3A%20User-provided%20default%20field%20values/near/267670368" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Pre-RFC.3A.20User-provided.20default.20field.20values.html#267670368">(Jan 12 2022 at 01:08)</a>:</h4>
<p>I'm rewriting the RFC now and am going to be keeping the <code>const</code> requirement. It seemed in the IRLO thread to be consensus.</p>



<a name="267748082"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Pre-RFC%3A%20User-provided%20default%20field%20values/near/267748082" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Pre-RFC.3A.20User-provided.20default.20field.20values.html#267748082">(Jan 12 2022 at 16:24)</a>:</h4>
<p>If you have a non-const expression, just write the impl out. Having a new shorthand doesn't stop the current way from working.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>