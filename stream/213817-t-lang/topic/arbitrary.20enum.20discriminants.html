<html>
<head><meta charset="utf-8"><title>arbitrary enum discriminants · t-lang · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/index.html">t-lang</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/arbitrary.20enum.20discriminants.html">arbitrary enum discriminants</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="251899236"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/arbitrary%20enum%20discriminants/near/251899236" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/arbitrary.20enum.20discriminants.html#251899236">(Sep 03 2021 at 15:35)</a>:</h4>
<p><span class="user-group-mention" data-user-group-id="1977">@T-lang</span>, I would appreciate some attention to addressing an issue with the new arbitrary enum discriminant feature which is going into beta todayish. There is an edge case where I think the feature introduces some confusion and complexity. There is a PR open at <a href="https://github.com/rust-lang/rust/issues/88203">#88203</a> to address this, and I think it would be good to fix this before release.</p>
<p>In summary, this feature creates three kinds of enums:</p>
<p>Kind 1: Unit-only variants:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="c1">// Does not require repr</span>
<span class="k">enum</span> <span class="nc">Kind1</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">Foo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">Bar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">Baz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// Can be cast to its discriminant:</span>
<span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Kind1</span>::<span class="n">Foo</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">u8</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
<p>Kind 2: Tuple or struct variants without fields:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#[repr(u8)]</span><span class="w">   </span><span class="c1">// Required repr</span>
<span class="k">enum</span> <span class="nc">Kind2</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">Foo</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">Bar</span><span class="p">{}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">Baz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// Can be cast to its discriminant:</span>
<span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Kind2</span>::<span class="n">Foo</span><span class="p">()</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">u8</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
<p>Kind 3: Tuple or struct variants with fields:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#[repr(u8)]</span><span class="w">   </span><span class="c1">// Required repr</span>
<span class="k">enum</span> <span class="nc">Kind3</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">Foo</span><span class="p">(</span><span class="kt">i32</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">Bar</span><span class="p">{</span><span class="n">f</span>: <span class="kt">i32</span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">Bar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// ERROR: Does not allow casting.</span>
<span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Kind3</span>::<span class="n">Foo</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">u8</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
<p>PR <a href="https://github.com/rust-lang/rust/issues/88203">#88203</a> changes it so that Kind2 does not require a repr, making it the same as Kind1.  I don't have a strong opinion if that's the right direction to go (it could also move in the other direction and not allow casting like Kind3), but I would appreciate a decision on this.  I think adding a third kind of enum makes the language more complicated and it would be nice to avoid that.</p>



<a name="251899865"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/arbitrary%20enum%20discriminants/near/251899865" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/arbitrary.20enum.20discriminants.html#251899865">(Sep 03 2021 at 15:39)</a>:</h4>
<p>It's surprising to me that Kind2 casting is allowed.</p>



<a name="251900037"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/arbitrary%20enum%20discriminants/near/251900037" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/arbitrary.20enum.20discriminants.html#251900037">(Sep 03 2021 at 15:40)</a>:</h4>
<p>Is there any good use case for that? Can we instead add a forward-compatibility lint and disallow such casting?</p>



<a name="251901557"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/arbitrary%20enum%20discriminants/near/251901557" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/arbitrary.20enum.20discriminants.html#251901557">(Sep 03 2021 at 15:50)</a>:</h4>
<p><span class="user-mention" data-user-id="120518">@Eric Huss</span> I don't think we should treat Kind2 like Kind1, and certainly not on short notice.</p>



<a name="251903353"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/arbitrary%20enum%20discriminants/near/251903353" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/arbitrary.20enum.20discriminants.html#251903353">(Sep 03 2021 at 16:02)</a>:</h4>
<p><span class="user-mention" data-user-id="239881">@Josh Triplett</span> Can you comment on <a href="https://github.com/rust-lang/rust/issues/88203">#88203</a> to that effect?  And do you think it should be treated as Kind3 (that is, do not allow casting)?</p>



<a name="251903508"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/arbitrary%20enum%20discriminants/near/251903508" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/arbitrary.20enum.20discriminants.html#251903508">(Sep 03 2021 at 16:03)</a>:</h4>
<p>I also find it surprising that we allow casting Kind1 to its discriminant without an explicit size, but I guess that's established behavior. Hopefully <a href="https://github.com/rust-lang/rust/pull/81642">https://github.com/rust-lang/rust/pull/81642</a> will help provide a better replacement for <code>as</code>.</p>



<a name="251903544"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/arbitrary%20enum%20discriminants/near/251903544" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/arbitrary.20enum.20discriminants.html#251903544">(Sep 03 2021 at 16:03)</a>:</h4>
<p><span class="user-mention silent" data-user-id="120518">Eric Huss</span> <a href="#narrow/stream/213817-t-lang/topic/arbitrary.20enum.20discriminants/near/251903353">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> Can you comment on <a href="https://github.com/rust-lang/rust/issues/88203">#88203</a> to that effect?  And do you think it should be treated as Kind3 (that is, do not allow casting)?</p>
</blockquote>
<p>Sure. And yes, but not if that breaks backwards compatibility.</p>



<a name="251903707"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/arbitrary%20enum%20discriminants/near/251903707" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/arbitrary.20enum.20discriminants.html#251903707">(Sep 03 2021 at 16:04)</a>:</h4>
<p>I personally would love to see even <code>Kind1</code> require the repr, if you want to get the discriminant out. But again, that's a backwards compatibility issue.</p>



<a name="251903726"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/arbitrary%20enum%20discriminants/near/251903726" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/arbitrary.20enum.20discriminants.html#251903726">(Sep 03 2021 at 16:04)</a>:</h4>
<p>It seems like we should file an issue to track this and backport a de-stabilization perhaps</p>



<a name="251904228"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/arbitrary%20enum%20discriminants/near/251904228" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/arbitrary.20enum.20discriminants.html#251904228">(Sep 03 2021 at 16:07)</a>:</h4>
<p>Sure I can do that.</p>



<a name="251904274"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/arbitrary%20enum%20discriminants/near/251904274" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/arbitrary.20enum.20discriminants.html#251904274">(Sep 03 2021 at 16:08)</a>:</h4>
<p>For reference, this is stablised in <a href="https://github.com/rust-lang/rust/issues/86860">#86860</a>, which hasn't made its way to beta yet.</p>



<a name="251904359"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/arbitrary%20enum%20discriminants/near/251904359" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/arbitrary.20enum.20discriminants.html#251904359">(Sep 03 2021 at 16:08)</a>:</h4>
<p>De-stabilize so that we can fix this behavior and re-stabilize?</p>



<a name="251904368"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/arbitrary%20enum%20discriminants/near/251904368" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/arbitrary.20enum.20discriminants.html#251904368">(Sep 03 2021 at 16:08)</a>:</h4>
<p>I mean beta as it branches today or tomorrow.</p>



<a name="251904381"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/arbitrary%20enum%20discriminants/near/251904381" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/arbitrary.20enum.20discriminants.html#251904381">(Sep 03 2021 at 16:08)</a>:</h4>
<p>That seems reasonable, to avoid rushing a fix.</p>



<a name="251904407"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/arbitrary%20enum%20discriminants/near/251904407" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/arbitrary.20enum.20discriminants.html#251904407">(Sep 03 2021 at 16:08)</a>:</h4>
<p>Oh but casting is already allowed</p>



<a name="251904435"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/arbitrary%20enum%20discriminants/near/251904435" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/arbitrary.20enum.20discriminants.html#251904435">(Sep 03 2021 at 16:09)</a>:</h4>
<p>It's just that discriminant can't be specified</p>



<a name="251904460"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/arbitrary%20enum%20discriminants/near/251904460" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fee1-dead <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/arbitrary.20enum.20discriminants.html#251904460">(Sep 03 2021 at 16:09)</a>:</h4>
<p>There is an argument for making Kind1 and Kind2 consistent because it can just be surprising. Especially in documentation we should avoid "c-like" (Kind1) and use "fieldless" (Kind1 and Kind2).</p>



<a name="251904581"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/arbitrary%20enum%20discriminants/near/251904581" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/arbitrary.20enum.20discriminants.html#251904581">(Sep 03 2021 at 16:10)</a>:</h4>
<p><span class="user-mention silent" data-user-id="361356">fee1-dead</span> <a href="#narrow/stream/213817-t-lang/topic/arbitrary.20enum.20discriminants/near/251904460">said</a>:</p>
<blockquote>
<p>There is an argument for making Kind1 and Kind2 consistent because it can just be surprising. Especially in documentation we should avoid "c-like" (Kind1) and use "fieldless" (Kind1 and Kind2).</p>
</blockquote>
<p>My inclination would be to keep using "c-like", to intentionally mean only Kind1.</p>



<a name="251904701"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/arbitrary%20enum%20discriminants/near/251904701" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/arbitrary.20enum.20discriminants.html#251904701">(Sep 03 2021 at 16:10)</a>:</h4>
<p>As I understand it, the original intent was to change the documentation to say "fieldless" but with the intention of it being a synonym for "c-like" and still mean Kind1.</p>



<a name="251904766"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/arbitrary%20enum%20discriminants/near/251904766" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/arbitrary.20enum.20discriminants.html#251904766">(Sep 03 2021 at 16:11)</a>:</h4>
<p>But "fieldless" <em>is</em> somewhat ambiguous, and could mean Kind2, so we either need a different term that unambiguously means Kind1 or we need to stick with "c-like".</p>



<a name="251904831"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/arbitrary%20enum%20discriminants/near/251904831" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/arbitrary.20enum.20discriminants.html#251904831">(Sep 03 2021 at 16:11)</a>:</h4>
<p>Apparently the casting is already allowed in Rust 1.15 <a href="https://godbolt.org/z/98K3cGhaf">https://godbolt.org/z/98K3cGhaf</a></p>



<a name="251904888"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/arbitrary%20enum%20discriminants/near/251904888" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/arbitrary.20enum.20discriminants.html#251904888">(Sep 03 2021 at 16:12)</a>:</h4>
<p>Yea, this started by trying to determine what "fieldless" means, and it came to light (to me) that the phrase is confusing.</p>



<a name="251904904"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/arbitrary%20enum%20discriminants/near/251904904" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fee1-dead <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/arbitrary.20enum.20discriminants.html#251904904">(Sep 03 2021 at 16:12)</a>:</h4>
<p>The original PR to rust-lang/reference did have some confusion around "fieldless", but I think the PR author intended to mean both Kind1 and Kind2.</p>



<a name="251905063"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/arbitrary%20enum%20discriminants/near/251905063" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fee1-dead <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/arbitrary.20enum.20discriminants.html#251905063">(Sep 03 2021 at 16:13)</a>:</h4>
<p>The term "c-like" could be hard to understand for newcomers who don't know about C enumerations at all.</p>



<a name="251906559"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/arbitrary%20enum%20discriminants/near/251906559" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/arbitrary.20enum.20discriminants.html#251906559">(Sep 03 2021 at 16:23)</a>:</h4>
<p>Posted <a href="https://github.com/rust-lang/rust/issues/88621">#88621</a> to track making a decision.  I'm not sure what labels to put on it, though.</p>



<a name="251906870"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/arbitrary%20enum%20discriminants/near/251906870" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/arbitrary.20enum.20discriminants.html#251906870">(Sep 03 2021 at 16:25)</a>:</h4>
<p>(Thanks all for taking a look, I know I'm being a little pedantic.  I just feel that rust is already pretty complex, and I think it helps to avoid weird edge cases.)</p>



<a name="251920525"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/arbitrary%20enum%20discriminants/near/251920525" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/arbitrary.20enum.20discriminants.html#251920525">(Sep 03 2021 at 18:05)</a>:</h4>
<p>I think I would separate Kind-2 from Kind-1 as well</p>



<a name="251953822"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/arbitrary%20enum%20discriminants/near/251953822" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Wagner-Hall <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/arbitrary.20enum.20discriminants.html#251953822">(Sep 03 2021 at 23:15)</a>:</h4>
<p>To add some extra fun to this:</p>
<div class="codehilite"><pre><span></span><code>#[repr(u8)]
enum Kind2 {
    Foo() = 1,
    Bar{} = 2,
    Baz = 3,
}

Kind2::Foo as u8
Kind2::Foo() as u8
</code></pre></div>
<p>These casts are _both_ allowed and do _very_ different things.</p>



<a name="251953957"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/arbitrary%20enum%20discriminants/near/251953957" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Wagner-Hall <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/arbitrary.20enum.20discriminants.html#251953957">(Sep 03 2021 at 23:17)</a>:</h4>
<p><span class="user-mention" data-user-id="239881">@Josh Triplett</span> I'm also very much hoping <a href="https://github.com/rust-lang/rust/pull/81642">https://github.com/rust-lang/rust/pull/81642</a> can help us clean this up, ideally eventually deprecating <code>as</code> conversions for enums (in the long, long future!) - is there anything I can do to help get some eyes on it?</p>
<p>For instance, would it help to separate out the top commit (auto-implementing the trait for all enums via weird expansion-time hacks) from the rest of it (adding a hopefully uncontroversial derive macro)?</p>



<a name="251955545"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/arbitrary%20enum%20discriminants/near/251955545" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/arbitrary.20enum.20discriminants.html#251955545">(Sep 03 2021 at 23:39)</a>:</h4>
<p>I don't think it needs separating, it just needs reviewing. I can provide review from a language perspective; I'm not qualified to review the compiler changes though.</p>



<a name="251996734"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/arbitrary%20enum%20discriminants/near/251996734" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Wagner-Hall <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/arbitrary.20enum.20discriminants.html#251996734">(Sep 04 2021 at 12:19)</a>:</h4>
<p><span class="user-mention" data-user-id="239881">@Josh Triplett</span> that's kind of why I was suggesting maybe separating - it feels like "add a derive macro" is a libs thing, and "auto-derive it" is a lang thing, so maybe separating makes it easier to pick up and gather consensus on? But I'm new to this world, so defer to you!</p>



<a name="252007907"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/arbitrary%20enum%20discriminants/near/252007907" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/arbitrary.20enum.20discriminants.html#252007907">(Sep 04 2021 at 15:27)</a>:</h4>
<p>I don't know for sure, but I just provided signoff from a lang and libs perspective and asked for a compiler reviewer to look at the implementation.</p>



<a name="252011052"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/arbitrary%20enum%20discriminants/near/252011052" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Wagner-Hall <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/arbitrary.20enum.20discriminants.html#252011052">(Sep 04 2021 at 16:22)</a>:</h4>
<p>Fantastic, thanks! <span aria-label="heart" class="emoji emoji-2764" role="img" title="heart">:heart:</span>️</p>



<a name="254772157"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/arbitrary%20enum%20discriminants/near/254772157" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/arbitrary.20enum.20discriminants.html#254772157">(Sep 24 2021 at 21:03)</a>:</h4>
<p>I filed PR <a href="https://github.com/rust-lang/rust/issues/89234">#89234</a> to disallow Kind2 from being casted to integer (if arbitrary enum discriminant is used)</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>