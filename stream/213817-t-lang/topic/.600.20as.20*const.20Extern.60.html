<html>
<head><meta charset="utf-8"><title>`0 as *const Extern` · t-lang · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/index.html">t-lang</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.600.20as.20*const.20Extern.60.html">`0 as *const Extern`</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="271735277"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%600%20as%20%2Aconst%20Extern%60/near/271735277" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simon Sapin <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.600.20as.20*const.20Extern.60.html#271735277">(Feb 13 2022 at 08:38)</a>:</h4>
<p>What do you think of extending <code>integer as *const T</code> and <code>integer as *mut T</code> casts to <code>T: ?Sized + Thin</code>? Currently they’re only allowed for <code>T: Sized</code>, which excludes <code>extern</code> types.</p>



<a name="271735284"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%600%20as%20%2Aconst%20Extern%60/near/271735284" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simon Sapin <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.600.20as.20*const.20Extern.60.html#271735284">(Feb 13 2022 at 08:38)</a>:</h4>
<p>Should this proposal get its own RFC?</p>



<a name="271735290"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%600%20as%20%2Aconst%20Extern%60/near/271735290" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simon Sapin <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.600.20as.20*const.20Extern.60.html#271735290">(Feb 13 2022 at 08:39)</a>:</h4>
<p>This is mostly in support <a href="https://github.com/rust-lang/rust/issues/93959">https://github.com/rust-lang/rust/issues/93959</a>, where a similar change for <code>ptr::null</code> and friends is in an accepted RFC but not implemented yet</p>



<a name="271735652"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%600%20as%20%2Aconst%20Extern%60/near/271735652" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.600.20as.20*const.20Extern.60.html#271735652">(Feb 13 2022 at 08:48)</a>:</h4>
<p>Hmm, the alternative to enabling <code>integer as *const T</code> would be to use <code>&lt;*const T&gt;::from_raw_parts(integer as _, ())</code>, I guess?</p>



<a name="271735796"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%600%20as%20%2Aconst%20Extern%60/near/271735796" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.600.20as.20*const.20Extern.60.html#271735796">(Feb 13 2022 at 08:53)</a>:</h4>
<p>On one hand it feels totally reasonable to allow the <code>as</code>, but on the other I don't like <code>as</code> and would prefer more things went via functions.</p>



<a name="271735902"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%600%20as%20%2Aconst%20Extern%60/near/271735902" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.600.20as.20*const.20Extern.60.html#271735902">(Feb 13 2022 at 08:56)</a>:</h4>
<p>Maybe instead of the <code>as</code> we change <a href="https://doc.rust-lang.org/nightly/std/primitive.pointer.html#method.from_bits"><code>from_bits</code></a> to have <code>where T: Thin</code> instead of <code>where T: Sized</code>?</p>
<p>Then it's be <code>&lt;*const T&gt;::from_bits(integer)</code>, assuming <code>integer</code> is <code>usize</code> already.  (But I'm perfectly happy to require people to give us a <code>usize</code> instead of silently allowing to cast an <code>i128</code> or something.  And it just takes an <code>as _</code> if they don't care.)</p>



<a name="271758722"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%600%20as%20%2Aconst%20Extern%60/near/271758722" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simon Sapin <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.600.20as.20*const.20Extern.60.html#271758722">(Feb 13 2022 at 18:30)</a>:</h4>
<p>Oh I didn’t think of <code>&lt;*const T&gt;::from_raw_parts(int, ())</code>, that’s a good idea! It should be enough for <code>null</code>, <code>null_mut</code>, and <code>dangling</code></p>



<a name="271758740"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%600%20as%20%2Aconst%20Extern%60/near/271758740" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simon Sapin <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.600.20as.20*const.20Extern.60.html#271758740">(Feb 13 2022 at 18:32)</a>:</h4>
<p>I think it makes sense for <code>from_bits</code> too. <span class="user-mention" data-user-id="125270">@scottmcm</span> Do you want me to extend it in the same PR?</p>



<a name="271760423"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%600%20as%20%2Aconst%20Extern%60/near/271760423" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.600.20as.20*const.20Extern.60.html#271760423">(Feb 13 2022 at 19:10)</a>:</h4>
<p>Might as well, I guess?  It's unstable, after all.  And then <code>null</code> is just <code>Self::from_bits(0)</code> and <code>dangling</code> is <code>Self::from_bits(align_of::&lt;T&gt;())</code>.</p>
<p>(Hmm, I guess I never added to/from bits for NonNull.  I'll go do that.)</p>



<a name="271761338"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%600%20as%20%2Aconst%20Extern%60/near/271761338" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simon Sapin <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.600.20as.20*const.20Extern.60.html#271761338">(Feb 13 2022 at 19:33)</a>:</h4>
<p><code>NonNull::from_bits</code> needs to return <code>Option</code>, unless you make it take <code>NonZeroUsize</code>?</p>



<a name="271761386"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%600%20as%20%2Aconst%20Extern%60/near/271761386" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simon Sapin <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.600.20as.20*const.20Extern.60.html#271761386">(Feb 13 2022 at 19:34)</a>:</h4>
<p><code>dangling</code> is tricky. Let’s not get into <code>align_of</code> for extern types: <a href="https://github.com/rust-lang/rust/issues/93959#issuecomment-1038348610">https://github.com/rust-lang/rust/issues/93959#issuecomment-1038348610</a></p>



<a name="271761716"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%600%20as%20%2Aconst%20Extern%60/near/271761716" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.600.20as.20*const.20Extern.60.html#271761716">(Feb 13 2022 at 19:42)</a>:</h4>
<p><span class="user-mention silent" data-user-id="219747">Simon Sapin</span> <a href="#narrow/stream/213817-t-lang/topic/.600.20as.20*const.20Extern.60/near/271761338">said</a>:</p>
<blockquote>
<p><code>NonNull::from_bits</code> needs to return <code>Option</code>, unless you make it take <code>NonZeroUsize</code>?</p>
</blockquote>
<p>I was thinking <code>NonZeroUsize</code>, yeah.  <code>to_bits</code> might as well return one -- otherwise it's losing information at the type level -- and thus <code>from_bits</code> should probably take one too.</p>



<a name="271761789"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%600%20as%20%2Aconst%20Extern%60/near/271761789" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.600.20as.20*const.20Extern.60.html#271761789">(Feb 13 2022 at 19:44)</a>:</h4>
<p>Very good point about <code>dangling</code>.</p>



<a name="271761814"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%600%20as%20%2Aconst%20Extern%60/near/271761814" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simon Sapin <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.600.20as.20*const.20Extern.60.html#271761814">(Feb 13 2022 at 19:45)</a>:</h4>
<p>More implementation trickiness with <code>Sized: Thin</code> <a href="#narrow/stream/131828-t-compiler/topic/.60T.3A.20Sized.60.20doesn.E2.80.99t.20imply.20.60T.3A.20Pointee.3CMetadata.20.3D.20.28.29.3E.60/near/271761557">https://rust-lang.zulipchat.com/#narrow/stream/131828-t-compiler/topic/.60T.3A.20Sized.60.20doesn.E2.80.99t.20imply.20.60T.3A.20Pointee.3CMetadata.20.3D.20.28.29.3E.60/near/271761557</a></p>



<a name="271883569"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%600%20as%20%2Aconst%20Extern%60/near/271883569" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.600.20as.20*const.20Extern.60.html#271883569">(Feb 14 2022 at 20:26)</a>:</h4>
<p><span class="user-mention silent" data-user-id="220273">Jane Lusby [she/her]</span> has marked this topic as unresolved.</p>



<a name="271883589"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%600%20as%20%2Aconst%20Extern%60/near/271883589" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.600.20as.20*const.20Extern.60.html#271883589">(Feb 14 2022 at 20:27)</a>:</h4>
<p>oops, misclick</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>