<html>
<head><meta charset="utf-8"><title>never type: use cases · t-lang · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/index.html">t-lang</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.3A.20use.20cases.html">never type: use cases</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="272996101"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%3A%20use%20cases/near/272996101" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.3A.20use.20cases.html#272996101">(Feb 23 2022 at 19:02)</a>:</h4>
<p>Starting a Zulip thread so we can try to collect use cases / motivations for never type / infallible, with a goal of identifying how we can meet those</p>



<a name="272996173"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%3A%20use%20cases/near/272996173" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.3A.20use.20cases.html#272996173">(Feb 23 2022 at 19:03)</a>:</h4>
<p>Use case: <code>fn func() -&gt; Result&lt;!, E&gt;</code>, the compiler should know that <code>func()?</code> diverges and code after it is unreachable, just like <code>panic!()</code>.</p>



<a name="272999520"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%3A%20use%20cases/near/272999520" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.3A.20use.20cases.html#272999520">(Feb 23 2022 at 19:29)</a>:</h4>
<p>Copying some discussion from elsewhere:<br>
This also means that <code>let Some(x) = y() else { func()? }</code> should work, and <code>let x = if cond { y() } else { func()? }</code> should work.</p>



<a name="272999566"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%3A%20use%20cases/near/272999566" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.3A.20use.20cases.html#272999566">(Feb 23 2022 at 19:29)</a>:</h4>
<p>Both of those work if you use <code>panic!()</code>, as far as I know, and should work just as well if you use <code>func()?</code>.</p>



<a name="273000213"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%3A%20use%20cases/near/273000213" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.3A.20use.20cases.html#273000213">(Feb 23 2022 at 19:34)</a>:</h4>
<p>most use of never type ive seen has basically been to simulate a pattern based refinement typing thing i.e. <code>Option&lt;T&gt; is None</code> for a <code>Option</code> that's matches the <code>None</code> pattern</p>



<a name="273000282"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%3A%20use%20cases/near/273000282" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.3A.20use.20cases.html#273000282">(Feb 23 2022 at 19:34)</a>:</h4>
<p>Which is an argument that we may want to consider enum variant types as an alternative.</p>



<a name="273000506"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%3A%20use%20cases/near/273000506" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.3A.20use.20cases.html#273000506">(Feb 23 2022 at 19:36)</a>:</h4>
<p>enum variant types as proposed in the RFC are not exactly enough because they do not let you express</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">enum</span> <span class="nc">MyEnum</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">U</span><span class="p">,</span><span class="w"> </span><span class="n">V</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">A</span><span class="p">(</span><span class="n">T</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="n">B</span><span class="p">(</span><span class="n">U</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="n">c</span><span class="p">(</span><span class="n">V</span><span class="p">),</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">foo</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">MyEnum</span><span class="o">&lt;!</span><span class="p">,</span><span class="w"> </span><span class="kt">u8</span><span class="p">,</span><span class="w"> </span><span class="kt">u8</span><span class="o">&gt;</span><span class="w"></span>
</code></pre></div>
<p>for an <code>MyEnum</code> thats never <code>A</code></p>



<a name="273000733"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%3A%20use%20cases/near/273000733" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.3A.20use.20cases.html#273000733">(Feb 23 2022 at 19:38)</a>:</h4>
<p>(that feature in the closed RFC also fails for enums inside of other types i.e. I cant have a <code>struct Foo(Option&lt;u8&gt;, u8)</code> that i know has a <code>Some</code> inside because i matched on it)</p>



<a name="273001221"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%3A%20use%20cases/near/273001221" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.3A.20use.20cases.html#273001221">(Feb 23 2022 at 19:42)</a>:</h4>
<p>True.</p>



<a name="273001238"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%3A%20use%20cases/near/273001238" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.3A.20use.20cases.html#273001238">(Feb 23 2022 at 19:43)</a>:</h4>
<p>That case also doesn't work with <code>!</code> either.</p>



<a name="273001264"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%3A%20use%20cases/near/273001264" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.3A.20use.20cases.html#273001264">(Feb 23 2022 at 19:43)</a>:</h4>
<p>But I think we could get value without a <em>full</em> refinement-types system that's that capable.</p>



<a name="273001489"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%3A%20use%20cases/near/273001489" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.3A.20use.20cases.html#273001489">(Feb 23 2022 at 19:45)</a>:</h4>
<p>What <em>other</em> use cases exist for <code>!</code> besides use in generic type arguments and in type signatures?</p>



<a name="273001631"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%3A%20use%20cases/near/273001631" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.3A.20use.20cases.html#273001631">(Feb 23 2022 at 19:46)</a>:</h4>
<p>Not sure if it's ever been used like this but you could take an argument <code>[!; N]</code> to assert <code>N = 0</code></p>



<a name="273001885"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%3A%20use%20cases/near/273001885" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.3A.20use.20cases.html#273001885">(Feb 23 2022 at 19:48)</a>:</h4>
<p>Although, it's hard to come up with a way to use <em>any</em> type that isn't "in generic type arguments and in type signatures"</p>



<a name="273002452"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%3A%20use%20cases/near/273002452" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.3A.20use.20cases.html#273002452">(Feb 23 2022 at 19:52)</a>:</h4>
<p>It seems like <code>pub struct Foo(!);</code> is analogous to the <code>pub struct Bar(());</code> pattern for creating a struct that can't be instantiated externally; the difference being that <code>Foo</code> is actually uninhabited from the library's POV, can be used in <code>match foo {}</code> and so on. You wouldn't want <code>pub enum Foo {}</code> because the uninhabitedness is externally visible and you might want to make it inhabited later.</p>



<a name="273002741"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%3A%20use%20cases/near/273002741" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.3A.20use.20cases.html#273002741">(Feb 23 2022 at 19:54)</a>:</h4>
<p><code>Foo</code> and <code>Bar</code> are different. <code>Foo</code> is not only "can't be instantiated externally", it is "can't be instantiated" period.</p>



<a name="273002968"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%3A%20use%20cases/near/273002968" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.3A.20use.20cases.html#273002968">(Feb 23 2022 at 19:56)</a>:</h4>
<p>right, that's my point</p>



<a name="273003043"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%3A%20use%20cases/near/273003043" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.3A.20use.20cases.html#273003043">(Feb 23 2022 at 19:57)</a>:</h4>
<p><code>Foo</code> and <code>Bar</code> both present the same external interface, a type that can't be instantiated except maybe through the library API</p>



<a name="273003142"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%3A%20use%20cases/near/273003142" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.3A.20use.20cases.html#273003142">(Feb 23 2022 at 19:58)</a>:</h4>
<p>but inside the library these types are different, <code>Foo</code> is uninhabited (but it would be non-breaking to make it inhabited later) while <code>Bar</code> is inhabited</p>



<a name="273003373"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%3A%20use%20cases/near/273003373" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.3A.20use.20cases.html#273003373">(Feb 23 2022 at 19:59)</a>:</h4>
<p>You don't strictly need <code>!</code> for this, you could use any uninhabited type, but it is nice to use the canonical one if it becomes available because the specific empty enum used here is not conveying any information</p>



<a name="273007542"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%3A%20use%20cases/near/273007542" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mejrs <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.3A.20use.20cases.html#273007542">(Feb 23 2022 at 20:32)</a>:</h4>
<p>An <code>Option&lt;!&gt;</code> is a nice return type for functions where you return nothing but would like to use <code>?</code> like</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">maybe_print_item</span><span class="p">(</span><span class="n">map</span>: <span class="nc">HashMap</span><span class="o">&lt;</span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="nb">Option</span><span class="o">&lt;</span><span class="kt">i32</span><span class="o">&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">key</span>: <span class="kt">i32</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Option</span><span class="o">&lt;!&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">map</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="o">&amp;</span><span class="n">key</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">item</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span><span class="w"> </span><span class="n">item</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="nb">None</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="273008732"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%3A%20use%20cases/near/273008732" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.3A.20use.20cases.html#273008732">(Feb 23 2022 at 20:43)</a>:</h4>
<p>I have seen at least one case of "The return type is <code>!</code> because I am implementing the OS, which never returns to the OS, because where would it go?"</p>



<a name="273009180"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%3A%20use%20cases/near/273009180" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mejrs <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.3A.20use.20cases.html#273009180">(Feb 23 2022 at 20:47)</a>:</h4>
<p>Also, the FerrisFsck emoji uses it <a href="/user_uploads/4715/7cPftOXSzaccGdxKs6mzw0lG/afbeelding.png">afbeelding.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/7cPftOXSzaccGdxKs6mzw0lG/afbeelding.png" title="afbeelding.png"><img src="/user_uploads/4715/7cPftOXSzaccGdxKs6mzw0lG/afbeelding.png"></a></div>



<a name="273010103"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%3A%20use%20cases/near/273010103" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.3A.20use.20cases.html#273010103">(Feb 23 2022 at 20:54)</a>:</h4>
<p><span class="user-mention silent" data-user-id="433532">mejrs</span> <a href="#narrow/stream/213817-t-lang/topic/never.20type.3A.20use.20cases/near/273007542">said</a>:</p>
<blockquote>
<p>An <code>Option&lt;!&gt;</code> is a nice return type for functions where you return nothing but would like to use <code>?</code> like</p>
</blockquote>
<p>I think this is a use for <code>try</code> blocks, not something that should be exposed to the caller.</p>



<a name="273062700"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%3A%20use%20cases/near/273062700" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.3A.20use.20cases.html#273062700">(Feb 24 2022 at 09:05)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310518">Jake</span> brought up this example in <a href="#narrow/stream/213817-t-lang/topic/When.20is.20inference.20fallback.20important.3F/near/272998677">https://rust-lang.zulipchat.com/#narrow/stream/213817-t-lang/topic/When.20is.20inference.20fallback.20important.3F/near/272998677</a></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">test</span><span class="p">(</span><span class="n">a</span>: <span class="kt">bool</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">i32</span> <span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">match</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kc">true</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kc">false</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="fm">panic!</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>I actually have no idea how that works today, since no matter what type unconstrained type inference variable does from the <code>panic!</code> expression, I don't know how it "gets past the <code>;</code>" to make that block have a type other than <code>()</code>-because-block-with-no-trailing-expression.</p>
<p>There's definitely some shenanigans going on, since this <em>doesn't</em> work:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">test</span><span class="p">(</span><span class="n">a</span>: <span class="kt">bool</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">i32</span> <span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">match</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kc">true</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kc">false</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="fm">panic!</span><span class="p">();</span><span class="w"></span>
<span class="w">            </span><span class="p">()</span><span class="w"></span>
<span class="w">        </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="273067585"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%3A%20use%20cases/near/273067585" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.3A.20use.20cases.html#273067585">(Feb 24 2022 at 09:52)</a>:</h4>
<p>it's here: <a href="https://github.com/rust-lang/rust/blob/1204400ab8da9830f6f77a5e40e7ad3ea459676a/compiler/rustc_typeck/src/check/fn_ctxt/checks.rs#L791-L797">https://github.com/rust-lang/rust/blob/1204400ab8da9830f6f77a5e40e7ad3ea459676a/compiler/rustc_typeck/src/check/fn_ctxt/checks.rs#L791-L797</a><br>
basically, rustc sees that the block diverges and doesn't add the implicit <code>()</code> at the end, which results in <code>!</code> if there are no other exits from the block</p>



<a name="273079022"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%3A%20use%20cases/near/273079022" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amanieu <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.3A.20use.20cases.html#273079022">(Feb 24 2022 at 11:53)</a>:</h4>
<p>I use <code>!</code> in 2 places in my code base:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">create_thread</span><span class="o">&lt;</span><span class="n">F</span><span class="o">&gt;</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="n">interrupt_flag</span>: <span class="kp">&amp;</span><span class="nc">InterruptFlag</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="k">mut</span><span class="w"> </span><span class="n">clone_flags</span>: <span class="kt">u32</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">ptid</span>: <span class="nc">UserPtr</span><span class="o">&lt;</span><span class="kt">i32</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">ctid</span>: <span class="nc">UserPtr</span><span class="o">&lt;</span><span class="kt">i32</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">f</span>: <span class="nc">F</span><span class="p">,</span><span class="w"></span>
<span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">InterruptibleSyscallResult</span><span class="o">&lt;</span><span class="kt">i32</span><span class="o">&gt;</span><span class="w"></span>
<span class="k">where</span><span class="w"></span>
<span class="w">    </span><span class="n">F</span>: <span class="nb">FnOnce</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="o">!</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">F</span>: <span class="nb">Send</span> <span class="o">+</span><span class="w"> </span><span class="o">'</span><span class="nb">static</span><span class="p">,</span><span class="w"></span>
</code></pre></div>
<p>and </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">exit_thread</span><span class="o">&lt;</span><span class="n">F</span>: <span class="nb">FnOnce</span><span class="p">(</span><span class="kt">bool</span><span class="p">)</span><span class="o">&gt;</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="n">interrupt_flag</span>: <span class="kp">&amp;</span><span class="nc">InterruptFlag</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">status</span>: <span class="kt">i32</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">callback</span>: <span class="nc">F</span><span class="p">,</span><span class="w"></span>
<span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Interruptible</span><span class="o">&lt;!&gt;</span><span class="w"></span>
</code></pre></div>



<a name="273081241"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%3A%20use%20cases/near/273081241" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> NeoRaider <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.3A.20use.20cases.html#273081241">(Feb 24 2022 at 12:18)</a>:</h4>
<p>I've wanted a <code>Channel&lt;!&gt;</code> to mark a channel for which the only valid operation is to close it.</p>



<a name="273113905"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%3A%20use%20cases/near/273113905" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.3A.20use.20cases.html#273113905">(Feb 24 2022 at 16:34)</a>:</h4>
<p>I'm not sure it's valid, but I've wanted to do this:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">const</span><span class="w"> </span><span class="n">OK</span>: <span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span><span class="w"> </span><span class="o">!&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Ok</span><span class="p">(());</span><span class="w"></span>

<span class="c1">// ...</span>

<span class="k">fn</span> <span class="nf">foobar</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span><span class="w"> </span><span class="n">MyError</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">OK</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="273117164"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%3A%20use%20cases/near/273117164" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.3A.20use.20cases.html#273117164">(Feb 24 2022 at 16:55)</a>:</h4>
<p>That's not going to work I think as they have a different layout.</p>



<a name="273130880"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%3A%20use%20cases/near/273130880" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.3A.20use.20cases.html#273130880">(Feb 24 2022 at 18:34)</a>:</h4>
<p>Well, it's not impossible that it could coerce, but given this conversation started from coercion complications, I suspect we don't want to do that.</p>
<p>I'd predict that is there was a language change to do something like that, it'd be something like "generic constants".  Maybe</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">const</span><span class="w"> </span><span class="n">OK</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span>: <span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span><span class="w"> </span><span class="n">E</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Ok</span><span class="p">(());</span><span class="w"></span>
</code></pre></div>



<a name="273499874"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%3A%20use%20cases/near/273499874" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.3A.20use.20cases.html#273499874">(Feb 28 2022 at 14:50)</a>:</h4>
<p>I have a use case for this in stacker/psm where I would like to ensure a callback never returns as an optimization for stack switch.</p>



<a name="273502229"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%3A%20use%20cases/near/273502229" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.3A.20use.20cases.html#273502229">(Feb 28 2022 at 15:05)</a>:</h4>
<p>a never returning function can still unwind.</p>



<a name="273510574"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%3A%20use%20cases/near/273510574" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.3A.20use.20cases.html#273510574">(Feb 28 2022 at 15:56)</a>:</h4>
<p>Sure. And it can still be a #safety invariant or caught-to-abort.</p>



<a name="273571557"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%3A%20use%20cases/near/273571557" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.3A.20use.20cases.html#273571557">(Feb 28 2022 at 23:52)</a>:</h4>
<p><a href="https://github.com/rust-lang/stacker/blob/547807f03246783ada94b956a575b9ce257dc2ca/psm/src/lib.rs#L250-L270">https://github.com/rust-lang/stacker/blob/547807f03246783ada94b956a575b9ce257dc2ca/psm/src/lib.rs#L250-L270</a> is the relevant code in psm.</p>



<a name="273571757"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/never%20type%3A%20use%20cases/near/273571757" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/never.20type.3A.20use.20cases.html#273571757">(Feb 28 2022 at 23:55)</a>:</h4>
<p>Oh, I'm surprised this isn't allowed. <code>fn() -&gt; !</code> works but not <code>FnOnce() -&gt; !</code></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>